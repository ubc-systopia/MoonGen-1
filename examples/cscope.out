cscope 15 $HOME/msc-project/MoonGen-1/examples               0003414891
	@/home/asabzi/msc-project/MoonGen-1/examples/device-statistics.lua

1 -- 
This
 
‹¡
 
dÛs
 
the
 
	gfŞlowšg
:

2 -- 1. 
Execu‹
 
ARP
 
so
 
th©
 
the
 
deviûs
 
exchªge
 
MAC
-
add»s£s


3 -- 2. 
S’d
 
UDP
 
·ck‘s
 
äom
 
NIC
 1 
to
 NIC 2

4 -- 3. 
R—d
 
the
 
¡©i¡ics
 
äom
h
»c›všg
 
deviû


6 -- 
This
 
süt
 
demÚ¡¿‹s
 
how
 
to
 
acûss
 
deviû
 
¥ecific
 
¡©i¡ics
 ("nÜm®" 
¡©s
 
ªd
 
x¡©s
è
vŸ
 
DPDK


8 
loÿl
 
mg
 = 
»quœe
 "moongen"

9 
loÿl
 
memÜy
 = 
»quœe
 "memory"

10 
loÿl
 
deviû
 = 
»quœe
 "device"

11 
loÿl
 
ts
 = 
»quœe
 "timestamping"

12 
loÿl
 
f‹r
 = 
»quœe
 "filter"

13 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

14 
loÿl
 
¡©s
 = 
»quœe
 "stats"

15 
loÿl
 
tim”
 = 
»quœe
 "timer"

16 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

17 
loÿl
 
log
 = 
»quœe
 "log"

19 
loÿl
 
ffi
 = 
»quœe
 "ffi"

21 -- 
£t
 
add»s£s
 
h”e


22 
loÿl
 
DST_MAC
 = 
n
 -- 
»sŞved
 
vŸ
 
ARP
 
Ú
 
GW_IP
 
Ü
 
DST_IP
, 
ÿn
 
be
 
ov”rid’
 
w™h
 
a
 
¡ršg
 
h”e


23 
loÿl
 
	gSRC_IP_BASE
 = "10.0.0.10"

24 
loÿl
 
DST_IP
 = "10.1.0.10"

25 
loÿl
 
SRC_PORT
 = 1234

26 
loÿl
 
DST_PORT
 = 319

28 -- 
ªsw”
 
ARP
 
»que¡s
 
this
 
IP
 
Ú
 
the
 
rx
 
pÜt


29 -- 
chªge
 
this
 
b’chm¬kšg
 
som‘hšg
 
like
 
a
 
NAT
 
deviû


30 
loÿl
 
RX_IP
 = 
DST_IP


31 -- 
u£d
 
to
 
»sŞve
 
DST_MAC


32 
loÿl
 
GW_IP
 = 
DST_IP


33 -- 
u£d
 
as
 
sourû
 
IP
 
to
 
»sŞve
 
GW_IP
Ø
DST_MAC


34 
loÿl
 
ARP_IP
 = 
SRC_IP_BASE


37 
loÿl
 
C
 = 
ffi
.C

39 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

40 
·r£r
:
	`desütiÚ
("Generates UDPraffic‡nd…rints out device statistics. Edithe sourceo modify constants†ike IPs.")

41 
·r£r
:
	`¬gum’t
("txDev", "DeviûØŒªsm™ from."):
	$cÚv”t
(
tÚumb”
)

42 
·r£r
:
	`¬gum’t
("rxDev", "DeviûØ»ûiväom."):
	$cÚv”t
(
tÚumb”
)

43 
·r£r
:
	`İtiÚ
("-¸--¿‹", "T¿nsm™„©š Mb™/s."):(10000):
	$cÚv”t
(
tÚumb”
)

44 
·r£r
:
	`İtiÚ
("- --size", "Pack‘ size."):(60):
	$cÚv”t
(
tÚumb”
)

45 
’d


47 
funùiÚ
 
	$ma¡”
(
¬gs
)

48 
txDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.txDev, 
rxQueues
 = 4, 
txQueues
 = 4
	}
}

49 
	grxDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
rxDev
, 
	grxQueues
 = 4, 
	gtxQueues
 = 4}

50 
	gdeviû
.
wa™FÜLšks
()

51 -- 
	gmax
 1
kµs
 
time¡ampšg
 
Œaffic
 
	gtime¡ampšg


52 -- 
¿‹
 
wl
 
be
 
somewh©
 
off
 
	ghigh
-
Ï‹ncy
 
lšks
 
©
 
low
 
¿‹s


53 
	g¬gs
.
	g¿‹
 > 0 
th’


54 
	gtxDev
:
	$g‘TxQueue
(0):
	`£tR©e
(
¬gs
.
¿‹
 - (¬gs.
size
 + 4) * 8 / 1000)

55 
’d


56 
rxDev
:
	`g‘TxQueue
(0).
dev
:
	`UdpG’”icF‹r
ÔxDev:
	$g‘RxQueue
(3))

58 
mg
.
	`¡¬tTask
("lßdSÏve", 
txDev
:
	`g‘TxQueue
(0), 
rxDev
, 
¬gs
.
size
)

59 
mg
.
	`¡¬tTask
("»ûiveSÏve", 
rxDev
:
	`g‘RxQueue
(3), 
¬gs
.
size
)

60 
¬p
.
¡¬tA½Task
{

61 -- 
run
 
ARP
 
Ú
 
bÙh
 
pÜts


62 { 
rxQueue
 = 
rxDev
:
	`g‘RxQueue
(2), 
txQueue
 =„xDev:
	`g‘TxQueue
(2), 
s
 = 
RX_IP
 },

63 -- 
we
 
Ãed
 
ª
 
IP
 
add»ss
 
to
 dØ
ARP
 
»que¡s
 
Ú
 
this
 
š‹rçû


64 { 
rxQueue
 = 
txDev
:
	`g‘RxQueue
(2), 
txQueue
 =xDev:
	`g‘TxQueue
(2), 
s
 = 
ARP_IP
 }

65 
	}
}

66 
	gmg
.
	$wa™FÜTasks
()

67 
’d


69 
loÿl
 
funùiÚ
 
	$flUdpPack‘
(
buf
, 
Ën
)

70 
buf
:
	$g‘UdpPack‘
():
fl
{

71 
‘hSrc
 = 
queue
,

72 
‘hD¡
 = 
DST_MAC
,

73 
4Src
 = 
SRC_IP
,

74 
4D¡
 = 
DST_IP
,

75 
udpSrc
 = 
SRC_PORT
,

76 
udpD¡
 = 
DST_PORT
,

77 
pktL’gth
 = 
Ën


78 
	}
}

79 
’d


81 
loÿl
 
funùiÚ
 
	$doA½
()

82 
nÙ
 
DST_MAC
 
th’


83 
log
:
	`šfo
("P”fÜmšg ARP†ooku°Ú %s", 
GW_IP
)

84 
DST_MAC
 = 
¬p
.
	$blockšgLookup
(
GW_IP
, 5)

85 
nÙ
 
DST_MAC
 
th’


86 
log
:
	`šfo
("ARP†ookup failed, using default destination mac‡ddress")

88 
’d


89 
’d


90 
log
:
	`šfo
("De¡š©iÚ mac: %s", 
DST_MAC
)

91 
’d


94 --- 
Runs
 
Ú
 
the
 
£ndšg
 
NIC


95 --- 
G’”©es
 
UDP
 
Œaffic
 
ªd
 
®so
 
ãtches
 
the
 
¡©s


96 
funùiÚ
 
	$lßdSÏve
(
queue
, 
rxDev
, 
size
)

98 
log
:
	`šfo
(
	`g»’
("Starting up: LoadSlave"))

101 -- 
»Œ›ve
 
the
 
numb”
 
of
 
x¡©s
 
Ú
h
»c›všg
 
NIC


102 -- 
x¡©s
 
»Ï‹d
 
C
 
defš™iÚs
 
¬e
 
š
 
deviû
.
lua


103 
loÿl
 
numx¡©s
 = 0

104 
loÿl
 
x¡©s
 = 
ffi
.
	`Ãw
("¡ruù„‹_‘h_x¡©[?]", 
numx¡©s
)

106 -- 
beÿu£
 
th”e
 
is
 
no
 
—sy
 
funùiÚ
 
which
 
»tuºs
 
the
 
numb”
 
of
 
x¡©s
 
we
 
Œy
 
to
 
»Œ›ve


107 -- 
the
 
x¡©s
 
w™h
 
a
 
z”o
 
sized
 
¬¿y


108 -- 
»suÉ
 > 
	`numx¡©s
 (0 
š
 
our
 ), 
th’
„esuÉ 
equ®s
 
the
 
»®
 
numb”
 
of
 
x¡©s


109 
loÿl
 
»suÉ
 = 
C
.
	$¹e_‘h_x¡©s_g‘
(
rxDev
.
id
, 
x¡©s
, 
numx¡©s
)

110 
numx¡©s
 = 
	$tÚumb”
(
»suÉ
)

113 
	$doA½
()

114 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

115 
	$flUdpPack‘
(
buf
, 
size
)

116 
’d
)

117 
loÿl
 
bufs
 = 
mempoŞ
:
	$bufA¼ay
()

118 
loÿl
 
txCŒ
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
queue
, "plain")

119 
loÿl
 
rxCŒ
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
rxDev
, "plain")

120 
loÿl
 
ba£IP
 = 
	`·r£IPAdd»ss
(
SRC_IP_BASE
)

122 -- 
£nd
 
out
 
UDP
 
·ck‘s
 
uÁ
 
the
 
u£r
 
¡İs
h
süt


123 
mg
.
	$ruÂšg
() do

124 
bufs
:
	$®loc
(
size
)

125 
i
, 
buf
 
š
 
	$aœs
(
bufs
) do

126 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

127 
pkt
.
4
.
¤c
:
	$£t
(
ba£IP
)

128 
’d


129 -- 
UDP
 
checksums
 
¬e
 
İtiÚ®
, 
so
 
usšg
 
ju¡
 
IPv4
 checksum 
would
 
be
 
suffic›Á
 
h”e


130 
bufs
:
	$ofæßdUdpChecksums
()

131 
queue
:
	$£nd
(
bufs
)

132 
txCŒ
:
	$upd©e
()

133 
rxCŒ
:
	$upd©e
()

134 
’d


135 
txCŒ
:
	$fš®ize
()

136 
rxCŒ
:
	`fš®ize
()

138 -- 
»Œ›ve
 
difã»Á
 
¡©s


140 
log
:
	`šfo
(
	`g»’
("---------------------Moongen STATS---------------------------"))

142 
loÿl
 
¡©s
 = 
rxCŒ
:
	$g‘Sts
()

143 
key
,
v®ue
 
š
 
	$·œs
(
¡©s
èdØ
log
:
	`šfo
(
	`to¡ršg
(
key
è.. " - " .. 
	$to¡ršg
(
v®ue
)è
’d


145 
log
:
	`šfo
(
	`g»’
("------------------------STATS--------------------------------"))

146 
loÿl
 
rxSts
 = 
rxDev
:
	$g‘Sts
()

147 
log
:
	`šfo
("ack‹s: " .. 
	$to¡ršg
(
rxSts
.
ack‘s
))

148 
log
:
	`šfo
("İack‹s: " .. 
	$to¡ršg
(
rxSts
.
İack‘s
))

149 
log
:
	`šfo
("iby‹s: " .. 
	$to¡ršg
(
rxSts
.
iby‹s
))

150 
log
:
	`šfo
("oby‹s: " .. 
	$to¡ršg
(
rxSts
.
oby‹s
))

151 
log
:
	`šfo
("imis£d: " .. 
	$to¡ršg
(
rxSts
.
imis£d
))

152 
log
:
	`šfo
("›¼Üs: " .. 
	$to¡ršg
(
rxSts
.
›¼Üs
))

153 
log
:
	`šfo
("Û¼Üs: " .. 
	$to¡ršg
(
rxSts
.
Û¼Üs
))

154 
log
:
	`šfo
("rx_nombuf: " .. 
	$to¡ršg
(
rxSts
.
rx_nombuf
))

155 
log
:
	`šfo
("q_ack‹s[0]: " .. 
	$to¡ršg
(
rxSts
.
q_ack‘s
[0]))

156 
log
:
	`šfo
("q_ack‹s[1]: " .. 
	$to¡ršg
(
rxSts
.
q_ack‘s
[1]))

157 
log
:
	`šfo
("q_ack‹s[2]: " .. 
	$to¡ršg
(
rxSts
.
q_ack‘s
[2]))

158 
log
:
	`šfo
("q_ack‹s[3]: " .. 
	`to¡ršg
(
rxSts
.
q_ack‘s
[3]))

160 -- 
no
 
x¡©s
 
¬e
 
avaabË
 
we
 
wl
 
sk
 
them


161 
numx¡©s
 > 0 
th’


162 
x¡©s
 = 
ffi
.
	`Ãw
("¡ruù„‹_‘h_x¡©[?]", 
numx¡©s
)

163 
C
.
	$¹e_‘h_x¡©s_g‘
(
rxDev
.
id
, 
x¡©s
, 
numx¡©s
)

164 
x¡©Names
 = 
ffi
.
	`Ãw
("¡ruù„‹_‘h_x¡©_Çme[?]", 
numx¡©s
)

165 
C
.
	$¹e_‘h_x¡©s_g‘_Çmes
(
rxDev
.
id
, 
x¡©Names
, 
numx¡©s
)

166 
log
:
	`šfo
(
	`g»’
("------------------------XSTATS-------------------------------"))

167 
log
:
	`šfo
("Numb” oàx¡©s: " .. 
numx¡©s
)

169 
i
=0,
»suÉ
-1 do

170 
log
:
	`šfo
(
ffi
.
	`¡ršg
(
x¡©Names
[
i
].
Çme
, 64è.. ": " .. 
	$to¡ršg
(
x¡©s
[
i
].
v®ue
))

171 
’d


173 
log
:
	`w¬n
("This device does‚ot…rovide‡ny xstats")

174 
’d


175 
’d


177 --- 
Runs
 
Ú
 
the
 
»c›všg
 
NIC


178 --- 
BasiÿÎy
 
Œ›s
 
to
 
ãtch
 
a
 
ãw
 
·ck‘s
Ø
show
 
some
 
mÜe
 
š‹»¡šg
 
¡©i¡ics


179 
funùiÚ
 
	$»ûiveSÏve
(
rxQueue
, 
size
)

180 
log
:
	`šfo
(
	`g»’
("Starting up: ReceiveSlave"))

181 
	$doA½
()

183 
loÿl
 
mempoŞ
 = 
memÜy
.
	$ü—‹MemPoŞ
()

184 
loÿl
 
rxBufs
 = 
mempoŞ
:
	`bufA¼ay
()

186 -- 
this
 
wl
 
ÿtch
 
a
 
ãw
 
·ck‘
 
but
 
®so
 
ÿu£
 
out_of_bufãr
 
”rÜs
 
to
 
show
 
some
 
¡©s


187 
mg
.
	$ruÂšg
() do

188 
rxQueue
:
	$ŒyRecvIdË
(
rxBufs
, 10)

189 
rxBufs
:
	$ä“AÎ
()

190 
’d


191 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/dump.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
¡©s
 = 
»quœe
 "stats"

5 
loÿl
 
log
 = 
»quœe
 "log"

7 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

8 
·r£r
:
	`¬gum’t
("rxDev", "ThdeviûØ»ûiväom"):
	$cÚv”t
(
tÚumb”
)

9 
’d


11 
funùiÚ
 
	$ma¡”
(
¬gs
)

12 
loÿl
 
rxDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.rxDev, 
drİEÇbË
 = 
çl£
}

13 
	gdeviû
.
	$wa™FÜLšks
()

14 
mg
.
	`¡¬tTask
("dumpSÏve", 
rxDev
:
	$g‘RxQueue
(0))

15 
mg
.
	$wa™FÜTasks
()

16 
’d


19 
funùiÚ
 
	$dumpSÏve
(
queue
)

20 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

21 
loÿl
 
pktCŒ
 = 
¡©s
:
	`ÃwPktRxCouÁ”
("Packets counted", "plain")

22 
mg
.
	$ruÂšg
() do

23 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 100)

24 
i
 = 1, 
rx
 do

25 
loÿl
 
buf
 = 
bufs
[
i
]

26 
buf
:
	$dump
()

27 
pktCŒ
:
	$couÁPack‘
(
buf
)

28 
’d


29 
bufs
:
	$ä“
(
rx
)

30 
pktCŒ
:
	$upd©e
()

31 
’d


32 
pktCŒ
:
	$fš®ize
()

33 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/icmp-arp-responder.lua

1 
loÿl
 
	gdpdk
 = 
»quœe
 "dpdk"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
uts
 = 
»quœe
 "utils"

5 
loÿl
 
log
 = 
»quœe
 "log"

7 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

8 
loÿl
 

 = 
»quœe
 "proto.ip4"

9 
loÿl
 
icmp
 = 
»quœe
 "proto.icmp"

12 
funùiÚ
 
	$ma¡”
(
fuÂy
, 
pÜt
, ...)

13 
fuÂy
 
ªd
 fuÂy ~ğ"--do-fuÂy-thšgs" 
th’


14  
	$ma¡”
(
n
, 
fuÂy
, 
pÜt
, ...)

15 
’d


16 
pÜt
 = 
	$tÚumb”
(
pÜt
)

17 
nÙ
 
pÜt
 
Ü
 
	`£Ëù
("#", ...è=ğ0 o¸... =ğ
n
 
th’


18 
log
:
	`šfo
("usage: [--do-funny-things]…ort ip [ip...]")

20 
’d


22 
loÿl
 
dev
 = 
deviû
.
	$cÚfig
(
pÜt
, 2, 2)

23 
deviû
.
	$wa™FÜLšks
()

25 
dpdk
.
	`ÏunchLua
(
¬p
.
¬pTask
, {

26 { 
rxQueue
 = 
dev
:
	`g‘RxQueue
(1), 
txQueue
 = dev:
	`g‘TxQueue
(1), 
s
 = { ... } }

27 
	}
})

29 
	$pšgRe¥Úd”
(
dev
, 
fuÂy
)

30 
’d


32 
loÿl
 
DIGITS
 = { 1, 8 
	}
}

34 
loÿl
 
¡©es
 = {

47 
i
, 
v
 
š
 
	$aœs
(
¡©es
) do

48 
¡©es
[
i
] = 
	`tÚumb”
((
v
:
	`gsub
(" ", 
DIGITS
[1]):gsub("X", DIGITS[2])))

49 
’d


51 
loÿl
 
funùiÚ
 
	$g‘SymbŞ
(
¡•
)

52  
¡©es
[
¡•
 % #states + 1]

53 
’d


56 
funùiÚ
 
	$pšgRe¥Úd”
(
dev
, 
fuÂy
)

57 
fuÂy
 
th’


58 
log
:
	`šfo
("Most…ing 'clients' do‚ot supporthe --do-funny-things option‡nd ignore our„esponses :(")

59 
log
:
	`šfo
("One‚otableƒxception is Linux…ing fromhe iputils…ackage")

60 
’d


62 
loÿl
 
devMac
 = 
dev
:
	$g‘Mac
(
Œue
)

63 
loÿl
 
rxQueue
 = 
dev
:
	$g‘RxQueue
(0)

64 
loÿl
 
txQueue
 = 
dev
:
	$g‘TxQueue
(0)

66 
loÿl
 
rxMem
 = 
memÜy
.
	$ü—‹MemPoŞ
()

67 
loÿl
 
rxBufs
 = 
rxMem
:
	$bufA¼ay
(1)

68 
dpdk
.
	$ruÂšg
() do

69 
rx
 = 
rxQueue
:
	$»cv
(
rxBufs
)

70 
rx
 > 0 
th’


71 
loÿl
 
buf
 = 
rxBufs
[1]

72 
loÿl
 
pkt
 = 
buf
:
	$g‘IcmpPack‘
()

73 
pkt
.
4
:
	`g‘PrÙocŞ
(è=ğ

.
PROTO_ICMP
 
th’


74 
loÿl
 
tmp
 = 
pkt
.
4
.
¤c
:
	$g‘
()

75 
pkt
.
‘h
.
d¡
:
	`£t
Õkt.‘h.
¤c
:
	$g‘
())

76 
pkt
.
‘h
.
¤c
:
	$£t
(
devMac
)

77 
pkt
.
4
.
¤c
:
	`£t
Õkt.4.
d¡
:
	$g‘
())

78 
pkt
.
4
.
d¡
:
	$£t
(
tmp
)

79 
pkt
.
icmp
:
	$£tTy³
(
icmp
.
ECHO_REPLY
.
ty³
)

80 
fuÂy
 
th’


81 
loÿl
 
ts
 = 
pkt
.
icmp
.
body
.
ušt32
[1]

82 
loÿl
 
£q
 = 
	$bsw­16
(
pkt
.
icmp
.
body
.
ušt16
[1])

83 
loÿl
 
symbŞ
 = 
	$g‘SymbŞ
(
£q
)

84 
ts
 = - 
symbŞ


85 
£q
 = seq + 10000

86 
pkt
.
4
.
‰l
 = 
m©h
.
	`mš
(63 -…kt.ip4.ttl + 100, 200)

87 
pkt
.
icmp
.
body
.
ušt32
[1] = 
ts


88 
pkt
.
icmp
.
body
.
ušt16
[1] = 
	$bsw­16
(
£q
)

89 
’d


90 
pkt
.
4
:
	$£tChecksum
(0)

91 
pkt
.
icmp
:
	`ÿlcuÏ‹Checksum
Õkt.
4
:
	`g‘L’gth
(è-…kt.4:
	`g‘H—d”L’gth
() * 4)

92 
rxBufs
:
	$ofæßdIPChecksums
()

93 
txQueue
:
	$£nd
(
rxBufs
)

95 
rxBufs
:
	$ä“AÎ
()

96 
’d


97 
’d


98 
’d


99 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/inter-arrival-times.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

5 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

6 
loÿl
 
log
 = 
»quœe
 "log"

7 
loÿl
 
tim”
 = 
»quœe
 "timer"

9 
funùiÚ
 
	$ma¡”
(
rxPÜt
, 
wa™Time
)

10 
nÙ
 
rxPÜt
 
th’


11 
	`”rÜf
("usage:„xPort [waitTime]")

12 
’d


13 
rxDev
 = 
deviû
.
cÚfig
{ 
pÜt
 = 
rxPÜt
, 
rxDescs
 = 4096, 
drİEÇbË
 = 
çl£
 
	}
}

14 
	grxDev
:
	$wa™
()

15 
loÿl
 
queue
 = 
rxDev
:
	$g‘RxQueue
(0)

16 
queue
:
	$’abËTime¡ampsAÎPack‘s
()

17 
loÿl
 
tÙ®
 = 0

18 
loÿl
 
bufs
 = 
memÜy
.
	$ü—‹BufA¼ay
()

19 
loÿl
 
times
 = {
	}
}

20 
loÿl
 
tim”
 =im”:
	$Ãw
(
wa™Time
)

21 
mg
.
	$ruÂšg
() do

22 
loÿl
 
n
 = 
queue
:
	$»cv
(
bufs
)

23 
i
 = 1, 
n
 do

24 
tim”
:
	$expœed
(è
th’


25 
loÿl
 
ts
 = 
bufs
[
i
]:
	$g‘Time¡amp
()

26 
times
[#time + 1] = 
ts


27 
’d


28 
’d


29 
tÙ®
 =Ù® + 
n


30 
bufs
:
	$ä“
(
n
)

31 
’d


32 
loÿl
 
pkts
 = 
rxDev
:
	$g‘RxSts
(
pÜt
)

33 
loÿl
 
h
 = 
hi¡
:
	$ü—‹
()

34 
loÿl
 
Ï¡


35 
i
, 
v
 
š
 
	$aœs
(
times
) do

36 
Ï¡
 
th’


37 
loÿl
 
diff
 = 
v
 - 
Ï¡


38 
h
:
	$upd©e
(
diff
)

39 
’d


40 
Ï¡
 = 
v


41 
’d


42 
h
:
	$´št
()

43 
h
:
	`§ve
("histogram.csv")

44 
log
[(
pkts
 - 
tÙ®
 > 0 
ªd
 "w¬n" 
Ü
 "info")](log, "Lost…ackets: " ..…kts -otal

46 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/ipfix-generation.lua

1 
loÿl
 
	gdpdk
 = 
»quœe
 "dpdk"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

5 
loÿl
 
f‹r
 = 
»quœe
 "filter"

6 
loÿl
 
¡©s
 = 
»quœe
 "stats"

7 
loÿl
 
ffi
 = 
»quœe
 "ffi"

8 
loÿl
 
h—d”s
 = 
»quœe
 "headers"

9 
loÿl
 
fix
 = 
»quœe
 "proto.ipfix"

11 -- 
Ex³rim’t
 
CÚ¡ªts


12 
loÿl
 
IP_SRC
 = "192.168.0.1"

13 
loÿl
 
ETH_DST
 = "90:e2:ba:1f:8d:44"

14 
loÿl
 
IP_DST
 = "10.0.10.10"

15 
loÿl
 
PORT_SRC
 = 1234

16 
loÿl
 
PORT_DST
 = 4739 -- 
IPFIX
 
pÜt


17 
loÿl
 
SEND_RATE
 = 5 -- 
MB™s
/
s


18 
loÿl
 
SEND_TIME
 = 6000 -- 6 
£cs


19 
loÿl
 
BURST_TIME
 = 2000 -- 2 
£cs


20 
loÿl
 
RECORDS_PER_PACKET
= 1

22 -- 
MoÚg’
 
CÚ¡ªts


23 
loÿl
 
MAX_PKT_SIZE
 = 512

25 -- 
IPFIX
 
Pack‘
 
CÚ¡ªts


26 
loÿl
 
PREV_HEADERS_LENGTH
 = 42 -- 
In
 
où‘s


27 
loÿl
 
OBSERVATION_DOMAIN
 = 67108864 -- 
Ob£rv©iÚ
 
Domaš


28 
loÿl
 
SELECTOR_ALGORITHM
 = 1 -- 
Sy¡em©ic
 
couÁ
-
ba£d
 
Sam¶šg


29 
loÿl
 
SAMPLING_PKT_INTERVAL
 = 1 -- 
Sam¶šg
 
Pack‘
 
IÁ”v®


30 
loÿl
 
SAMPLING_PKT_SPACE
 = 9999 -- 
Sam¶šg
 
Pack‘
 
S·û


31 
loÿl
 
PROTO_ID
 = { 6, 17 } -- 
PrÙocŞ
 
Id’tif›r


32 
loÿl
 
SRC_TRANS
 = { 80, 100 } -- 
Sourû
 
T¿n¥Üt
 
PÜt


33 
loÿl
 
DST_TRANS
 = { 180, 200 } -- 
De¡š©iÚ
 
T¿n¥Üt
 
PÜt


34 
loÿl
 
IPV4_ADDR
 = {
·r£IPAdd»ss
("72.0.0.1"),…¬£IPAdd»ss("144.255.255.255")} -- 
Rªge
 
of
 
IPv4
 
Add»s£s


36 
loÿl
 
SEQUENCE_NUMBER
 = 0

37 
loÿl
 
TOTAL_MESSAGES
 = 0

38 
loÿl
 
TOTAL_FLOWS
 = 0

40 
loÿl
 
TMPL_SET
 =

42 {
id
 = 8, 
	gËngth
 = 4, 
	gv®ue
 = 
funùiÚ
(è 
m©h
.
¿ndom
(
IPV4_ADDR
[1], IPV4_ADDR[2]è
	g’d
}, -- 
sourûIPv4Add»ss
 (
v4Add»ss
)

43 {
	gid
 = 12, 
	gËngth
 = 4, 
	gv®ue
 = 
funùiÚ
(è 
m©h
.
¿ndom
(
IPV4_ADDR
[1], IPV4_ADDR[2]è
	g’d
}, -- 
de¡š©iÚIPv4Add»ss
(
v4Add»ss
)

44 {
	gid
 = 4, 
	gËngth
 = 1, 
	gv®ue
 = 
funùiÚ
(è 
PROTO_ID
[
m©h
.
¿ndom
(
bË
.
g‘n
(PROTO_ID))] 
’d
}, -- 
´ÙocŞId’tif›r
 (
unsigÃd8
)

45 {
	gid
 = 7, 
	gËngth
 = 2, 
	gv®ue
 = 
funùiÚ
(è 
m©h
.
¿ndom
(
SRC_TRANS
[1], SRC_TRANS[2]è
	g’d
}, -- 
sourûT¿n¥ÜtPÜt
 (
unsigÃd16
)

46 {
	gid
 = 11, 
	gËngth
 = 2, 
	gv®ue
 = 
funùiÚ
(è 
m©h
.
¿ndom
(
DST_TRANS
[1], DST_TRANS[2]è
	g’d
} -- 
de¡š©iÚT¿n¥ÜtPÜt
 (
unsigÃd16
)

49 
loÿl
 
	gOPTS_TMPL_SET
 =

51 {
id
 = 149, 
	gËngth
 = 4, 
	gv®ue
 = 
funùiÚ
(è 
OBSERVATION_DOMAIN
 
’d
}, -- 
ob£rv©iÚDomašId
 (
unsigÃd32
)

52 {
	gid
 = 304, 
	gËngth
 = 2, 
	gv®ue
 = 
funùiÚ
(è 
SELECTOR_ALGORITHM
 
’d
}, -- 
£ËùÜAlgÜ™hm
 (
unsigÃd16
)

53 {
	gid
 = 305, 
	gËngth
 = 4, 
	gv®ue
 = 
funùiÚ
(è 
SAMPLING_PKT_INTERVAL
 
’d
}, -- 
§m¶šgPack‘IÁ”v®
 (
unsigÃd32
)

54 {
	gid
 = 306, 
	gËngth
 = 4, 
	gv®ue
 = 
funùiÚ
(è 
SAMPLING_PKT_SPACE
 
’d
} -- 
§m¶šgPack‘S·û
 (
unsigÃd32
)

57 --- 
Maš
 
funùiÚ
 
ªd
 
’Œy
 
pošt
 
—ch
 
	gMoÚG’
's script. Its funcion iso configure queues

58 --- 
ªd
 
f‹rs
 
Ú
 
the
 
u£d
 
NICs
‡nd 
th’
 
¡¬t
 
Úe
 
Ü
 
mÜe
 
¦ave
 
	gsks
. 
It
 
®so
 
cÚfigu»s
 
	gthe


59 --- 
¿‹s
 
©
 
which
 
the
 
expÜtšg
 
´oûss
 
£nds
h
	g·ck‘s
.

60 --- @
·¿m
 
txPÜt
 
	gNIC
's…ort

61 --- @
·¿m
 
¿‹
„©
©
 
which
 
·ck‘s
 
wl
 
be
 
	g£Á


62 --- @
·¿m
 
»cÜdsP”Pkt
 
numb”
 
of
 
d©a
 
»cÜds
 
³r
 
	g·ck‘


63 --- @
·¿m
 
bur¡
 
	gbur¡
 =ğ1, 
th’
 
g’”©e
 
bur¡y
 
Œaffic


64 
funùiÚ
 
	$ma¡”
(
txPÜt
, 
¿‹
, 
»cÜdsP”Pkt
, 
bur¡
)

65 
nÙ
 
txPÜt
 
th’


66  
	`´št
("usage:xPort [rate [recordsPerPkt [burst]]]")

67 
’d


69 -- 
¿‹
 
is
 
nÙ
 
´ovided
 
th’
 
u£
 
a
  
v®ue
 
of
 2.5 
MB™s
/
s


70 
¿‹
 =„©
Ü
 
SEND_RATE


71 
time
 = 
SEND_TIME


73 -- 
»cÜdsP”Pkt
 
is
 
nÙ
 
´ovided
 
th’
 
u£
 
a
  
v®ue
 
of
 1 
»cÜd
 
³r
 
·ck‘


74 
»cÜdsP”Pkt
 =„ecÜdsP”Pkˆ
Ü
 
RECORDS_PER_PACKET


76 -- 
¿‹
 
bur¡y
 
Œaffic


77 
bur¡R©e
 = 
¿‹
 * 2

79 
loÿl
 
¥“d
 = 0

81 -- 
the
 
mšimum
 
¿‹
 
of
h
h¬dw¬e
„©
cÚŒŞ
 
is
 0.1% oàth
lšk
„©e, 
i
.
e
. 10 
mb™
/
s
.

82 -- 
low”
 
¿‹s
 
we
 
have
 
to
 
cÚfigu»
 
the
 
lšk
 
¿‹
 
¥“d
Ø
a
 
¦ow”
„ate

83 -- 
i
.
e
. 
¿‹
 = 1 
mb™
/
s
, 
lšk
„©ğ1 
Gb™
/s

84 ià(
¿‹
 < 10è
th’


85 
¥“d
 = 1000

86 
’d


88 -- 
cÚfigu»
 
tx
 
deviû


89 
loÿl
 
txDev
 = 
deviû
.
	`cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 3, 
¥“d
 = 
	}
speed})

90 
	gtxDev
:
	$g‘TxQueue
(0):
	`£tR©e
(
¿‹
)

92 -- 
wa™
 
uÁ
 
the
 
lšks
 
¬e
 
up


93 
deviû
.
	$wa™FÜLšks
()

95 
	`´štf
("S’dšg %àMB™/ IPFIX¿ffiøtØUDP…Üˆ%d", 
¿‹
, 
PORT_DST
)

97 
bur¡
 =ğ1 
th’


98 -- 
¡¬t
 
bur¡
 
	$¦ave
 (
¿‹
 
mªag”
)

99 
dpdk
.
	`ÏunchLua
("fixBur¡SÏve", 
txDev
:
	`g‘TxQueue
(0), 
¿‹
, 
SEND_TIME
, 
bur¡R©e
, 
BURST_TIME
)

100 
’d


102 -- 
¡¬t
 
fx
 
	$¦ave
 (
expÜtšg
 
´oûss
)

103 
dpdk
.
	`ÏunchLua
("fixSÏve", 
txDev
:
	`g‘TxQueue
(0), 
»cÜdsP”Pkt
, 
PORT_DST
)

105 -- 
wa™
 
uÁ
 
®l
 
sks
 
¬e
 
fšished


106 
dpdk
.
	$wa™FÜSÏves
()

107 
’d


109 --- 
Task
 
th©
 
modif›s
 
the
 
¿‹s
 
©
 
which
h
expÜtšg
 
´oûss
 
£nds
 
·ck‘s


110 --- 
to
 
the
 
cŞËùÜ
 
´oûss
. 
This
 
´ove
Ø
be
 
v”y
 
u£ful
 
duršg
 
our
 
‹¡šg


111 --- 
as
 
™
 
’abËd
 
us
 
to
 
simuÏ‹
 
a
 
mÜe
 
»®
 
sûÇrio
 
š
 
which
 
¿‹s
 
¬e
 
nÙ
 
cÚ¡ªts
.

112 --- @
·¿m
 
queue
 
NIC
's queue over which…ackets‡re sent

113 --- @
·¿m
 
¿‹
 
nÜm®
„©
©
 
which
 
·ck‘s
 
wl
 
be
 
£Á


114 --- @
·¿m
 
time
 
nÜm®
im
Ïp£
 
š
 
which
 "nÜm®" 
Œaffic
 
is
 
g’”©ed


115 --- @
·¿m
 
bur¡R©e
 
bur¡
 
¿‹
 
©
 
which
 
·ck‘s
 
wl
 
be
 
£Á


116 --- @
·¿m
 
bur¡Time
 
bur¡
 
time
 
Ïp£
 
š
 
which
 "nÜm®" 
Œaffic
 
is
 
g’”©ed


117 
funùiÚ
 
	`fixBur¡SÏve
(
queue
, 
¿‹
, 
time
, 
bur¡R©e
, 
bur¡Time
)

118 -- 
wa™
 
the
 
fixSÏve
 
sk
 
to
 
¡¬t


119 
dpdk
.
	$¦“pMlis
(100)

120 
dpdk
.
	$ruÂšg
() do

121 -- 
£t
 
nÜm®
 
¿‹
 
ªd
 
wa™
 
befÜe
 
to
 
bur¡
„ate

122 
queue
:
	$£tR©e
(
¿‹
)

123 
dpdk
.
	`¦“pMlis
(
time
)

125 -- 
£t
 
bur¡
 
¿‹
 
ªd
 
wa™
 
befÜe
 
to
 
nÜm®
„ate

126 
queue
:
	$£tR©e
(
bur¡R©e
)

127 
dpdk
.
	$¦“pMlis
(
bur¡Time
)

128 
’d


129 
’d


131 --- 
G’”©es
 
ªd
 
£nds
 
fix
 
·ck‘s
 
to
 
the
 
cŞËùÜ
 
´oûss
.

132 --- @
·¿m
 
queue
 
NIC
's queue over which…ackets‡re sent

133 --- @
·¿m
 
»cÜdsP”Pkt
 
numb”
 
of
 
d©a
 
»cÜds
 
³r
 
·ck‘


134 --- @
·¿m
 
pÜt
 
Tx
…ort

135 
funùiÚ
 
	$fixSÏve
(
queue
, 
»cÜdsP”Pkt
, 
pÜt
)

136 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	`funùiÚ
(
buf
)

137 -- 
ü—‹s
 
ª
 
fix
 
·ck‘
 
w™h
 
the
 
fŞlowšg
 
v®ues


138 
buf
:
	$g‘IpfixPack‘
():
fl
{

139 -- 
ü—‹s
 
ª
 
fix
 
·ck‘
 
w™h
 
the
 
fŞlowšg
 
v®ues


140 
‘hSrc
 = 
queue
,

141 
‘hD¡
 = 
ETH_DST
,

142 
4Src
 = 
IP_SRC
,

143 
4D¡
 = 
IP_DST
,

144 
udpSrc
 = 
PORT_SRC
,

145 
udpD¡
 = 
pÜt
,

146 
fixOb£rv©iÚDomaš
 = 
OBSERVATION_DOMAIN


147 
	}
}

148 -- 
v®ues
 
nÙ
 
£t
 
š
 
	gh”e
, 
MoÚG’
 
u£s
 
the
 

149 -- 
v®ues
 
¥ecif›d
 
š
 
	glua
/
	gšşude
/
	g´Ùo
/
	gfix
.
lua


150 
	g’d
)

152 
loÿl
 
	gtxCŒ
 = 
¡©s
:
ÃwMªu®TxCouÁ”
("PÜˆ" .. 
pÜt
, "plain")

154 
loÿl
 
	gbufs
 = 
mem
:
	$bufA¼ay
()

155 
loÿl
 
isFœ¡
 = 
Œue


156 
loÿl
 
tm¶L’gth
 = 
fix
:
	$g‘RecÜdL’gth
(
TMPL_SET
)

157 
loÿl
 
İtsTm¶L’gth
 = 
fix
:
	$g‘RecÜdL’gth
(
OPTS_TMPL_SET
)

158 
loÿl
 
pktSize
 = 0

160 -- 
¡©s
 
couÁ”s


161 
loÿl
 
d–Time
 = 
dpdk
.
	$g‘Time
()

162 
loÿl
 
d–Flows
 = 0

163 
loÿl
 
d–Pkts
 = 0

164 
loÿl
 
d–By‹s
 = 0

166 -- 
ü—‹s
 
hi¡og¿m
.
csv
 
fe
 
ªd
 
wr™es
 
™s
 
h—d”s


167 
loÿl
 
hi¡Fe
 = 
io
.
	`İ’
("histogram.csv", "w+")

168 
hi¡Fe
:
	`wr™e
("delta_time,delta_flows,delta_packets,delta_bytes\n")

169 
hi¡Fe
:
	$æush
()

171 
dpdk
.
	$ruÂšg
() do

172 -- 
®loÿ‹
 
bufãrs
 
äom
 
the
 
mem
 
poŞ
 
ªd
 
¡Üe
 
them
 
š
 
this
 
¬¿y


173 
bufs
:
	$®loc
(
MAX_PKT_SIZE
)

175 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

176 
loÿl
 
pkt
 = 
buf
:
	$g‘IpfixPack‘
()

177 
loÿl
 
msgSize
 = 0

179 -- 
modify
 
·ck‘
's fields

180 
pkt
.
fix
:
	`£tExpÜtTime
(
os
.
	$time
())

181 
pkt
.
fix
:
	$£tSeq
(
SEQUENCE_NUMBER
)

183 
isFœ¡
 
th’
 -- 
C»©e
 
‹m¶©e
 
£t
 
Úly
 
the
 
fœ¡
 
time


184 -- 
C»©e
 
‹m¶©e
 
£t


185 
loÿl
 
tm¶S‘
 = 
fix
:
	$ü—‹Tm¶S‘
(998, 
TMPL_SET
)

186 
msgSize
 = 
fix
:
	`cİyTo
(
pkt
.
·ylßd
.
ušt8
, 0, 
tm¶S‘
)

188 -- 
C»©e
 
d©a
 
£t


189 
loÿl
 
d©aS‘
 = 
fix
:
	$ü—‹D©aS‘
(998, 
TMPL_SET
, 
tm¶L’gth
, 1)

190 
msgSize
 = 
fix
:
	$cİyTo
(
pkt
.
·ylßd
.
ušt8
, 
msgSize
, 
d©aS‘
)

191 
TOTAL_FLOWS
 = TOTAL_FLOWS + 1

192 
SEQUENCE_NUMBER
 = SEQUENCE_NUMBER + 1

194 
isFœ¡
 = 
çl£


195 -- 
C»©e
 
Úly
 
d©a
 
£ts


196 
loÿl
 
d©aS‘
 = 
fix
:
	$ü—‹D©aS‘
(998, 
TMPL_SET
, 
tm¶L’gth
, 
»cÜdsP”Pkt
)

197 
msgSize
 = 
fix
:
	$cİyTo
(
pkt
.
·ylßd
.
ušt8
, 0, 
d©aS‘
)

198 
TOTAL_FLOWS
 = TOTAL_FLOWS + 
»cÜdsP”Pkt


199 
SEQUENCE_NUMBER
 = SEQUENCE_NUMBER + 
»cÜdsP”Pkt


200 
’d


202 -- 
·ck‘
's size is given byhe sum ofhe IPFIX headers‡nd message†ength

203 -- 
¶us
 
´evious
 
h—d”s
 
Ëngth
 
e
.
g
. (
‘h
, 
4
, 
udp
)

204 
pktSize
 = 
msgSize
 + 
PREV_HEADERS_LENGTH
 + 
fix
:
	$g‘H—d”sL’gth
()

205 
pkt
:
	$£tL’gth
(
pktSize
)

206 
buf
:
	`£tSize
(
pktSize
)

208 -- 
upd©e
 
expÜ‹dMes§geTÙ®CouÁ
 
v®ue


209 
TOTAL_MESSAGES
 = TOTAL_MESSAGES + 1

210 
’d


211 -- 
£nd
 
·ck‘s


212 
bufs
:
	$ofæßdUdpChecksums
()

213 
txCŒ
:
	`upd©eW™hSize
(
queue
:
	`£nd
(
bufs
), 
pktSize
)

215 -- 
upd©e
 
¡©s


216 
loÿl
 
time
 = 
dpdk
.
	$g‘Time
()

217 
time
 - 
d–Time
 >ğ1 
th’


218 
d–Time
 = 
time
 - deltaTime

219 
d–Flows
 = 
SEQUENCE_NUMBER
 - deltaFlows

220 
d–Pkts
 = 
txCŒ
.
tÙ®
 - deltaPkts

221 
d–By‹s
 = 
txCŒ
.
tÙ®By‹s
 - deltaBytes

223 -- 
wr™e
 
¡©s


224 
hi¡Fe
:
	`wr™e
(("%s,%s,%s,%s\n"):
	$fÜm©
(
d–Time
, 
d–Flows
, 
d–Pkts
, 
d–By‹s
))

225 
hi¡Fe
:
	$æush
()

227 
d–Time
 = 
time


228 
d–Flows
 = 
SEQUENCE_NUMBER


229 
d–Pkts
 = 
txCŒ
.
tÙ®


230 
d–By‹s
 = 
txCŒ
.
tÙ®By‹s


231 
’d


232 
’d


234 
txCŒ
:
	`fš®ize
()

236 -- 
upd©e
 
¡©s


237 
d–Time
 = 
dpdk
.
	`g‘Time
() - deltaTime

238 
d–Flows
 = 
SEQUENCE_NUMBER
 - deltaFlows

239 
d–Pkts
 = 
txCŒ
.
tÙ®
 - deltaPkts

240 
d–By‹s
 = 
txCŒ
.
tÙ®By‹s
 - deltaBytes

242 -- 
wr™e
 
¡©s


243 
hi¡Fe
:
	`wr™e
(("%s,%s,%s,%s\n"):
	$fÜm©
(
d–Time
, 
d–Flows
, 
d–Pkts
, 
d–By‹s
))

244 
hi¡Fe
:
	$æush
()

245 
hi¡Fe
:
	$şo£
()

246 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/l2-load-latency.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

5 
loÿl
 
¡©s
 = 
»quœe
 "stats"

6 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

8 
loÿl
 
PKT_SIZE
 = 60

9 
loÿl
 
ETH_DST
 = "11:12:13:14:15:16"

11 
loÿl
 
funùiÚ
 
	$g‘R¡Fe
(...)

12 
loÿl
 
¬gs
 = { ... 
	}
}

13 
i
, 
v
 
š
 
	$aœs
(
¬gs
) do

14 
»suÉ
, 
couÁ
 = 
¡ršg
.
	`gsub
(
v
, "%-%-result%=", "")

15 ià(
couÁ
 =ğ1è
th’


16  
i
, 
»suÉ


17 
’d


18 
’d


19  
n
,‚il

20 
’d


22 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

23 
·r£r
:
	`desütiÚ
("Generates bidirectional CBRraffic with hardware„ate control‡nd measure†atencies.")

24 
·r£r
:
	`¬gum’t
("dev1", "DeviûØŒªsm™/»ûiväom."):
	$cÚv”t
(
tÚumb”
)

25 
·r£r
:
	`¬gum’t
("dev2", "DeviûØŒªsm™/»ûiväom."):
	$cÚv”t
(
tÚumb”
)

26 
·r£r
:
	`İtiÚ
("-¸--¿‹", "T¿nsm™„©š Mb™/s."):(10000):
	$cÚv”t
(
tÚumb”
)

27 
·r£r
:
	`İtiÚ
("-f --file", "Filename ofhe†atency histogram."):("histogram.csv")

28 
’d


30 
funùiÚ
 
	$ma¡”
(
¬gs
)

31 
loÿl
 
dev1
 = 
deviû
.
	`cÚfig
({
pÜt
 = 
¬gs
.dev1, 
rxQueues
 = 2, 
txQueues
 = 2
	}
})

32 
loÿl
 
	gdev2
 = 
deviû
.
cÚfig
({
pÜt
 = 
¬gs
.
dev2
, 
rxQueues
 = 2, 
txQueues
 = 2})

33 
	gdeviû
.
	$wa™FÜLšks
()

34 
dev1
:
	$g‘TxQueue
(0):
	$£tR©e
(
¬gs
.
¿‹
)

35 
dev2
:
	$g‘TxQueue
(0):
	$£tR©e
(
¬gs
.
¿‹
)

36 
mg
.
	`¡¬tTask
("lßdSÏve", 
dev1
:
	$g‘TxQueue
(0))

37 
dev1
 ~ğ
dev2
 
th’


38 
mg
.
	`¡¬tTask
("lßdSÏve", 
dev2
:
	$g‘TxQueue
(0))

39 
’d


40 
¡©s
.
¡¬tStsTask
{
dev1
, 
dev2
}

41 
	gmg
.
¡¬tSh¬edTask
("tim”SÏve", 
dev1
:
g‘TxQueue
(1), 
dev2
:
g‘RxQueue
(1), 
¬gs
.
fe
)

42 
	gmg
.
	$wa™FÜTasks
()

43 
’d


45 
funùiÚ
 
	$lßdSÏve
(
queue
)

46 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

47 
buf
:
	$g‘Eth”ÃtPack‘
():
fl
{

48 
‘hSrc
 = 
txDev
,

49 
‘hD¡
 = 
ETH_DST
,

50 
‘hTy³
 = 0x1234

51 
	}
}

52 
	g’d
)

53 
loÿl
 
	gbufs
 = 
mem
:
	$bufA¼ay
()

54 
mg
.
	$ruÂšg
() do

55 
bufs
:
	$®loc
(
PKT_SIZE
)

56 
queue
:
	$£nd
(
bufs
)

57 
’d


58 
’d


60 
funùiÚ
 
	$tim”SÏve
(
txQueue
, 
rxQueue
, 
hi¡fe
)

61 
loÿl
 
time¡am³r
 = 
ts
:
	$ÃwTime¡am³r
(
txQueue
, 
rxQueue
)

62 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

63 
mg
.
	`¦“pMlis
(1000è-- 
’su»
 
th©
 
the
 
lßd
 
sk
 
is
 
ruÂšg


64 
mg
.
	$ruÂšg
() do

65 
hi¡
:
	`upd©e
(
time¡am³r
:
	`m—su»L©’cy
(
	$funùiÚ
(
buf
èbuf:
	`g‘Eth”ÃtPack‘
().
‘h
.
d¡
:
	$£tSŒšg
(
ETH_DST
è
’d
))

66 
’d


67 
hi¡
:
	$´št
()

68 
hi¡
:
	$§ve
(
hi¡fe
)

69 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/l2-poisson-load-latency.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
ts
 = 
»quœe
 "timestamping"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

5 
loÿl
 
¡©s
 = 
»quœe
 "stats"

6 
loÿl
 
tim”
 = 
»quœe
 "timer"

7 
loÿl
 
hi¡og¿m
 = 
»quœe
 "histogram"

8 
loÿl
 
log
 = 
»quœe
 "log"

10 
loÿl
 
PKT_SIZE
 = 60

12 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

13 
·r£r
:
	`desütiÚ
("Generatesraffic based on‡…oisson…rocess with CRC-based„ate control.")

14 
·r£r
:
	`¬gum’t
("txDev", "DeviûØŒªsm™ from."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

15 
·r£r
:
	`¬gum’t
("rxDev", "DeviûØ»ûiväom."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

16 
·r£r
:
	`İtiÚ
("-¸--¿‹", "T¿nsm™„©š Mµs."):
	$¬gs
(1):(2)

17 
’d


19 
funùiÚ
 
	$ma¡”
(
¬gs
)

20 
loÿl
 
txDev
 = 
deviû
.
	`cÚfig
({
pÜt
 = 
¬gs
.txDev, 
txQueues
 = 2, 
rxQueues
 = 2
	}
})

21 
loÿl
 
	grxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
¬gs
.
rxDev
, 
txQueues
 = 2, 
rxQueues
 = 2})

22 
	gdeviû
.
	$wa™FÜLšks
()

23 
mg
.
	`¡¬tTask
("lßdSÏve", 
txDev
, 
rxDev
,xDev:
	`g‘TxQueue
(0), 
¬gs
.
¿‹
, 
PKT_SIZE
)

24 
mg
.
	`¡¬tTask
("tim”SÏve", 
txDev
:
	`g‘TxQueue
(1), 
rxDev
:
	`g‘RxQueue
(1), 
PKT_SIZE
)

25 
mg
.
	$wa™FÜTasks
()

26 
’d


28 
funùiÚ
 
	$lßdSÏve
(
dev
, 
rxDev
, 
queue
, 
¿‹
, 
size
)

29 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

30 
buf
:
	$g‘Eth”ÃtPack‘
():
fl
{

31 
‘hTy³
 = 0x1234

32 
	}
}

33 
’d
)

34 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
()

35 
loÿl
 
rxSts
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
rxDev
, "plain")

36 
loÿl
 
txSts
 = 
¡©s
:
	`ÃwMªu®TxCouÁ”
(
dev
, "plain")

37 
mg
.
	$ruÂšg
() do

38 
bufs
:
	$®loc
(
size
)

39 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

40 -- 
this
 
süt
 
u£s
 
Mµs
 
š¡—d
 
of
 
	$Mb™
 (
like
 
the
 
Ùh”
 
süts
)

41 
buf
:
	`£tD–ay
(
	`poissÚD–ay
(10^10 / 8 / (
¿‹
 * 10^6è- 
size
 - 24))

42 --
buf
:
	$£tR©e
(
¿‹
)

43 
’d


44 
txSts
:
	`upd©eW™hSize
(
queue
:
	`£ndW™hD–ay
(
bufs
), 
size
)

45 
rxSts
:
	`upd©e
()

46 --
txSts
:
	$upd©e
()

47 
’d


48 
rxSts
:
	$fš®ize
()

49 
txSts
:
	$fš®ize
()

50 
’d


52 
funùiÚ
 
	$tim”SÏve
(
txQueue
, 
rxQueue
, 
size
)

53 
loÿl
 
time¡am³r
 = 
ts
:
	$ÃwTime¡am³r
(
txQueue
, 
rxQueue
)

54 
loÿl
 
hi¡
 = 
hi¡og¿m
:
	`Ãw
()

55 -- 
wa™
 
a
 
£cÚd
 
to
 
give
 
the
 
Ùh”
 
sk
‡ 
chªû
Ø
¡¬t


56 
mg
.
	$¦“pMlis
(1000)

57 
loÿl
 
¿‹Lim™”
 = 
tim”
:
	$Ãw
(0.001)

58 
mg
.
	$ruÂšg
() do

59 
¿‹Lim™”
:
	$»£t
()

60 
hi¡
:
	`upd©e
(
time¡am³r
:
	$m—su»L©’cy
(
size
))

61 
¿‹Lim™”
:
	$busyWa™
()

62 
’d


63 
hi¡
:
	$´št
()

64 
hi¡
:
	`§ve
("histogram.csv")

65 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/l3-load-latency.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

5 
loÿl
 
f‹r
 = 
»quœe
 "filter"

6 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

7 
loÿl
 
¡©s
 = 
»quœe
 "stats"

8 
loÿl
 
tim”
 = 
»quœe
 "timer"

9 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

10 
loÿl
 
log
 = 
»quœe
 "log"

12 -- 
£t
 
add»s£s
 
h”e


13 
loÿl
 
DST_MAC
 = 
n
 -- 
»sŞved
 
vŸ
 
ARP
 
Ú
 
GW_IP
 
Ü
 
DST_IP
, 
ÿn
 
be
 
ov”rid’
 
w™h
 
a
 
¡ršg
 
h”e


14 
loÿl
 
	gSRC_IP_BASE
 = "10.0.0.10" -- 
aùu®
 
add»ss
 
wl
 
be
 
SRC_IP_BASE
 + 
	$¿ndom
(0, 
æows
)

15 
loÿl
 
DST_IP
 = "10.1.0.10"

16 
loÿl
 
SRC_PORT
 = 1234

17 
loÿl
 
DST_PORT
 = 319

19 -- 
ªsw”
 
ARP
 
»que¡s
 
this
 
IP
 
Ú
 
the
 
rx
 
pÜt


20 -- 
chªge
 
this
 
b’chm¬kšg
 
som‘hšg
 
like
 
a
 
NAT
 
deviû


21 
loÿl
 
RX_IP
 = 
DST_IP


22 -- 
u£d
 
to
 
»sŞve
 
DST_MAC


23 
loÿl
 
GW_IP
 = 
DST_IP


24 -- 
u£d
 
as
 
sourû
 
IP
 
to
 
»sŞve
 
GW_IP
Ø
DST_MAC


25 
loÿl
 
ARP_IP
 = 
SRC_IP_BASE


27 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

28 
·r£r
:
	`desütiÚ
("Generates UDPraffic‡nd measure†atencies. Edithe sourceo modify constants†ike IPs.")

29 
·r£r
:
	`¬gum’t
("txDev", "DeviûØŒªsm™ from."):
	$cÚv”t
(
tÚumb”
)

30 
·r£r
:
	`¬gum’t
("rxDev", "DeviûØ»ûiväom."):
	$cÚv”t
(
tÚumb”
)

31 
·r£r
:
	`İtiÚ
("-¸--¿‹", "T¿nsm™„©š Mb™/s."):(10000):
	$cÚv”t
(
tÚumb”
)

32 
·r£r
:
	`İtiÚ
("-à--æows", "Numb” oàæow Ôªdomized sourû IP)."):(4):
	$cÚv”t
(
tÚumb”
)

33 
·r£r
:
	`İtiÚ
("- --size", "Pack‘ size."):(60):
	$cÚv”t
(
tÚumb”
)

34 
’d


36 
funùiÚ
 
	`ma¡”
(
¬gs
)

37 -- 
H”e
 
they
 
ju¡
 
Çmed
 
the
 
rx
 
ªd
 
tx
. 
Th”e
 
is
 
no
 
di¡šguishšg
 
cÚfigu¿tiÚ
 
h”e
.

38 
txDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.txDev, 
rxQueues
 = 3, 
txQueues
 = 3
	}
}

39 
	grxDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
rxDev
, 
	grxQueues
 = 3, 
	gtxQueues
 = 3}

40 
	gdeviû
.
wa™FÜLšks
()

41 -- 
	gmax
 1
kµs
 
time¡ampšg
 
Œaffic
 
	gtime¡ampšg


42 -- 
¿‹
 
wl
 
be
 
somewh©
 
off
 
	ghigh
-
Ï‹ncy
 
lšks
 
©
 
low
 
¿‹s


43 
	g¬gs
.
	g¿‹
 > 0 
th’


44 
	gtxDev
:
	$g‘TxQueue
(0):
	`£tR©e
(
¬gs
.
¿‹
 - (¬gs.
size
 + 4) * 8 / 1000)

45 
’d


46 -- 
TODO
: 
Why
 
did
 
they
 
Úly
 
ÿÎ
 
¦ave
 
the
 
TX
 
side
?

47 ---- 
It
 
makes
 
£n£
 
beÿu£
 
we
 
Ãed
 
to
 
£nd
 
·ck‘s
 
w™h
 
¦ave
. 
Howev”
, 
š
 
l2
-
lßd
-
Ï‹ncy
.
lua
 
they
 
e¡ablished
 
two


48 ---- 
two
 
§·»‹d
 
queue
 
ju¡
 
Œªsm™
!

50 -- 
H”e
 
the
 
pošt
 
©
 
which
 
they
 
§·»‹d
 
queues
 
d©a
, 
time¡ampšg
 
·ck‘s
, 
ªd
 
¬p
 
»¥eù›vly
.

51 
mg
.
	`¡¬tTask
("lßdSÏve", 
txDev
:
	`g‘TxQueue
(0), 
rxDev
, 
¬gs
.
size
,‡rgs.
æows
)

52 
mg
.
	`¡¬tTask
("tim”SÏve", 
txDev
:
	`g‘TxQueue
(1), 
rxDev
:
	`g‘RxQueue
(1), 
¬gs
.
size
,‡rgs.
æows
)

53 
¬p
.
¡¬tA½Task
{

54 -- 
run
 
ARP
 
Ú
 
bÙh
 
pÜts


55 { 
rxQueue
 = 
rxDev
:
	`g‘RxQueue
(2), 
txQueue
 =„xDev:
	`g‘TxQueue
(2), 
s
 = 
RX_IP
 },

56 -- 
we
 
Ãed
 
ª
 
IP
 
add»ss
 
to
 dØ
ARP
 
»que¡s
 
Ú
 
this
 
š‹rçû


57 { 
rxQueue
 = 
txDev
:
	`g‘RxQueue
(2), 
txQueue
 =xDev:
	`g‘TxQueue
(2), 
s
 = 
ARP_IP
 }

58 
	}
}

59 
	gmg
.
	$wa™FÜTasks
()

60 
’d


62 
loÿl
 
funùiÚ
 
	$flUdpPack‘
(
buf
, 
Ën
)

63 
buf
:
	$g‘UdpPack‘
():
fl
{

64 
‘hSrc
 = 
queue
,

65 
‘hD¡
 = 
DST_MAC
,

66 
4Src
 = 
SRC_IP
,

67 
4D¡
 = 
DST_IP
,

68 
udpSrc
 = 
SRC_PORT
,

69 
udpD¡
 = 
DST_PORT
,

70 
pktL’gth
 = 
Ën


71 
	}
}

72 
’d


74 
loÿl
 
funùiÚ
 
	$doA½
()

75 
nÙ
 
DST_MAC
 
th’


76 
log
:
	`šfo
("P”fÜmšg ARP†ooku°Ú %s", 
GW_IP
)

77 
DST_MAC
 = 
¬p
.
	$blockšgLookup
(
GW_IP
, 5)

78 
nÙ
 
DST_MAC
 
th’


79 
log
:
	`šfo
("ARP†ookup failed, using default destination mac‡ddress")

81 
’d


82 
’d


83 
log
:
	`šfo
("De¡š©iÚ mac: %s", 
DST_MAC
)

84 
’d


86 
funùiÚ
 
	$lßdSÏve
(
queue
, 
rxDev
, 
size
, 
æows
)

87 
	$doA½
()

88 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

89 
	$flUdpPack‘
(
buf
, 
size
)

90 
’d
)

91 
loÿl
 
bufs
 = 
mempoŞ
:
	$bufA¼ay
()

92 
loÿl
 
couÁ”
 = 0

93 
loÿl
 
txCŒ
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
queue
, "plain")

94 
loÿl
 
rxCŒ
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
rxDev
, "plain")

95 
loÿl
 
ba£IP
 = 
	$·r£IPAdd»ss
(
SRC_IP_BASE
)

96 
mg
.
	$ruÂšg
() do

97 
bufs
:
	$®loc
(
size
)

98 
i
, 
buf
 
š
 
	$aœs
(
bufs
) do

99 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

100 
pkt
.
4
.
¤c
:
	`£t
(
ba£IP
 + 
couÁ”
)

101 
couÁ”
 = 
	$šcAndW¿p
(
couÁ”
, 
æows
)

102 
’d


103 -- 
UDP
 
checksums
 
¬e
 
İtiÚ®
, 
so
 
usšg
 
ju¡
 
IPv4
 checksum 
would
 
be
 
suffic›Á
 
h”e


104 
bufs
:
	$ofæßdUdpChecksums
()

105 
queue
:
	$£nd
(
bufs
)

106 
txCŒ
:
	$upd©e
()

107 
rxCŒ
:
	$upd©e
()

108 
’d


109 
txCŒ
:
	$fš®ize
()

110 
rxCŒ
:
	$fš®ize
()

111 
’d


113 
funùiÚ
 
	$tim”SÏve
(
txQueue
, 
rxQueue
, 
size
, 
æows
)

114 
	$doA½
()

115 
size
 < 84 
th’


116 
log
:
	`w¬n
("Pack‘ siz%d i sm®Ë¸thª mšimumime¡am°siz84. Time¡am³d…ack‘ wÈbÏrg”hª†ßd…ack‘s.", 
size
)

117 
size
 = 84

118 
’d


119 
loÿl
 
time¡am³r
 = 
ts
:
	$ÃwUdpTime¡am³r
(
txQueue
, 
rxQueue
)

120 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

121 
mg
.
	`¦“pMlis
(1000è-- 
’su»
 
th©
 
the
 
lßd
 
sk
 
is
 
ruÂšg


122 
loÿl
 
couÁ”
 = 0

123 
loÿl
 
¿‹Lim™
 = 
tim”
:
	$Ãw
(0.001)

124 
loÿl
 
ba£IP
 = 
	$·r£IPAdd»ss
(
SRC_IP_BASE
)

125 
mg
.
	$ruÂšg
() do

126 
hi¡
:
	`upd©e
(
time¡am³r
:
	`m—su»L©’cy
(
size
, 
	$funùiÚ
(
buf
)

127 
	$flUdpPack‘
(
buf
, 
size
)

128 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

129 
pkt
.
4
.
¤c
:
	`£t
(
ba£IP
 + 
couÁ”
)

130 
couÁ”
 = 
	$šcAndW¿p
(
couÁ”
, 
æows
)

131 
’d
))

132 
¿‹Lim™
:
	$wa™
()

133 
¿‹Lim™
:
	$»£t
()

134 
’d


135 -- 
´št
 
the
 
Ï‹ncy
 
¡©s
 
aá”
 
®l
h
Ùh”
 
¡uff


136 
mg
.
	$¦“pMlis
(300)

137 
hi¡
:
	$´št
()

138 
hi¡
:
	`§ve
("histogram.csv")

139 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/l3-tcp-syn-flood.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
¡©s
 = 
»quœe
 "stats"

5 
loÿl
 
log
 = 
»quœe
 "log"

7 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

8 
·r£r
:
	`desütiÚ
("Generates TCP SYN flood from varying source IPs, supports both IPv4‡nd IPv6")

9 
·r£r
:
	`¬gum’t
("dev", "Deviû tØŒªsm™ from."):
	`¬gs
("*"):
	$cÚv”t
(
tÚumb”
)

10 
·r£r
:
	`İtiÚ
("-¸--¿‹", "T¿nsm™„©š Mb™/s."):(10000):
	$cÚv”t
(
tÚumb”
)

11 
·r£r
:
	`İtiÚ
("-i --ip", "Source IP (IPv4 or IPv6)."):("10.0.0.1")

12 
·r£r
:
	`İtiÚ
("-d --destination", "Destination IP (IPv4 or IPv6).")

13 
·r£r
:
	`İtiÚ
("-à--æows", "Numb” oàdifã»Á IP tØu£."):(100):
	$cÚv”t
(
tÚumb”
)

14 
’d


16 
funùiÚ
 
	$ma¡”
(
¬gs
)

17 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

18 
loÿl
 
dev
 = 
deviû
.
cÚfig
{
pÜt
 = 
	}
dev}

19 
	gdev
:
	$wa™
()

20 
dev
:
	$g‘TxQueue
(0):
	$£tR©e
(
¬gs
.
¿‹
)

21 
mg
.
	`¡¬tTask
("lßdSÏve", 
dev
:
	`g‘TxQueue
(0), 
¬gs
.

,‡rgs.
æows
,‡rgs.
de¡š©iÚ
)

22 
’d


23 
mg
.
	$wa™FÜTasks
()

24 
’d


26 
funùiÚ
 
	`lßdSÏve
(
queue
, 
mšA
, 
numIPs
, 
de¡
)

27 --- 
·r£
 
ªd
 
check
 

 
add»s£s


28 
loÿl
 
mšIP
, 
v4
 = 
	$·r£IPAdd»ss
(
mšA
)

29 
mšIP
 
th’


30 
log
:
	`šfo
("D‘eùed‡À% add»ss.", 
mšIP
 
ªd
 "IPv4" 
Ü
 "IPv6")

32 
log
:
	`çl
("Inv®id mšIP: %s", 
mšA
)

33 
’d


35 -- 
mš
 
TCP
 
·ck‘
 
size
 
IPv6
 
is
 74 
	`by‹s
 (+ 
CRC
)

36 
loÿl
 
·ck‘L’
 = 
v4
 
ªd
 60 
Ü
 74

38 --  
nÜm®ly


39 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

40 
buf
:
	$g‘TıPack‘
(
v4
):
fl
{

41 
‘hSrc
 = 
queue
,

42 
‘hD¡
 = "12:34:56:78:90",

43 
4D¡
 = 
de¡
,

44 
6D¡
 = 
de¡
,

45 
tıSyn
 = 1,

46 
tıSeqNumb”
 = 1,

47 
tıWšdow
 = 10,

48 
pktL’gth
 = 
·ck‘L’


49 
	}
}

50 
	g’d
)

52 
loÿl
 
	gbufs
 = 
mem
:
	$bufA¼ay
(128)

53 
loÿl
 
couÁ”
 = 0

54 
loÿl
 
c
 = 0

56 
loÿl
 
txSts
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
queue
, "plain")

57 
mg
.
	$ruÂšg
() do

58 -- 
fl
 
·ck‘s
 
ªd
 
£t
 
theœ
 
size


59 
bufs
:
	$®loc
(
·ck‘L’
)

60 
i
, 
buf
 
š
 
	$aœs
(
bufs
) do

61 
loÿl
 
pkt
 = 
buf
:
	`g‘TıPack‘
(
v4
)

63 --
šüem’t
 
IP


64 
v4
 
th’


65 
pkt
.
4
.
¤c
:
	$£t
(
mšIP
)

66 
pkt
.
4
.
¤c
:
	$add
(
couÁ”
)

68 
pkt
.
6
.
¤c
:
	$£t
(
mšIP
)

69 
pkt
.
6
.
¤c
:
	$add
(
couÁ”
)

70 
’d


71 
couÁ”
 = 
	`šcAndW¿p
(couÁ”, 
numIPs
)

73 -- 
dump
 
fœ¡
 3 
·ck‘s


74 
c
 < 3 
th’


75 
buf
:
	$dump
()

76 
c
 = c + 1

77 
’d


78 
’d


79 --
ofæßd
 
checksums
 
to
 
NIC


80 
bufs
:
	$ofæßdTıChecksums
(
v4
)

82 
queue
:
	$£nd
(
bufs
)

83 
txSts
:
	$upd©e
()

84 
’d


85 
txSts
:
	$fš®ize
()

86 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/lacp.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

5 
loÿl
 
¡©s
 = 
»quœe
 "stats"

6 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

7 
loÿl
 
Ïı
 = 
»quœe
 "proto.lacp"

9 
loÿl
 
PKT_SIZE
 = 60

10 
loÿl
 
ETH_DST
 = "90:E2:BA:C0:EE:8C"

11 
loÿl
 
SRC_IP
 = "10.10.10.1"

12 
loÿl
 
DST_IP
 = "10.10.10.2"

13 
loÿl
 
SRC_PORT_BASE
 = 3000 -- + 
NIC
 
id


14 
loÿl
 
DST_PORT_BASE
 = 4000 -- + 
	$couÁ
(
NUM_FLOWS
)

15 
loÿl
 
NUM_FLOWS
 = 100 -- 
³r
 
pÜt


17 
funùiÚ
 
	$ma¡”
(...)

18 
	`£Ëù
("#", ...è< 2 
th’


19  
	`´št
("usage:…ort [ports...]„atePerPort")

20 
’d


21 
loÿl
 
¿‹
 = 
	`£Ëù
(select("#", ...), ...)

22 
loÿl
 
pÜts
 = { ... 
	}
}

23 
pÜts
[#pÜts] = 
n


24 
¿‹
 =„©
Ü
 10000

25 
loÿl
 
ÏıQueues
 = {}

26 
loÿl
 
pšgQueues
 = {}

27 
i
 = 1, 
£Ëù
("#", ...) - 1 do

28 
loÿl
 
	gpÜt
 = 
deviû
.
cÚfig
{
pÜt
 = 
pÜts
[
i
], 
	grxQueues
 = 3, 
	gtxQueues
 = 3}

29 
	gÏıQueues
[#ÏıQueue + 1] = {
rxQueue
 = 
pÜt
:
g‘RxQueue
(1), 
	gtxQueue
 =…Üt:
g‘TxQueue
(1)}

30 
pšgQueues
[#pšgQueue + 1] = {
rx
 = 
pÜt
:
g‘RxQueue
(2), 
	gtx
 =…Üt:
g‘TxQueue
(2)}

31 
pÜts
[
i
] = 
pÜt


32 
’d


33 
deviû
.
	$wa™FÜLšks
()

34 
Ïı
.
	`¡¬tLaıTask
("bÚd0", 
ÏıQueues
)

35 
Ïı
.
	`wa™FÜLšk
("bond0")

36 
loÿl
 
ÏıSourû
 = 
Ïı
.
	`g‘Mac
("bond0")

37 
i
, 
pÜt
 
š
 
	$aœs
(
pÜts
) do

38 
loÿl
 
queue
 = 
pÜt
:
	$g‘TxQueue
(0)

39 
queue
:
	$£tR©e
(
¿‹
)

40 
mg
.
	`¡¬tTask
("lßdSÏve", 
queue
, 
ÏıSourû
)

41 
’d


42 --
mg
.
	`¡¬tTask
("tim”SÏve", 
pšgQueues
, 
ÏıSourû
)

43 
mg
.
	$wa™FÜTasks
()

44 
’d


46 
loÿl
 
funùiÚ
 
	$flPack‘
(
buf
, 
¤cMac
, 
qid
, 
size
)

47 
buf
:
	$g‘UdpPack‘
():
fl
{

48 
‘hSrc
 = 
¤cMac
,

49 
‘hD¡
 = 
ETH_DST
,

50 
4Src
 = 
SRC_IP
,

51 
4D¡
 = 
DST_IP
,

52 
udpSrc
 = 
SRC_PORT_BASE
 + 
qid
,

53 
pktL’gth
 = 
size
 
Ü
 
PKT_SIZE


54 
	}
}

55 
’d


57 
funùiÚ
 
	$lßdSÏve
(
queue
, 
ÏıSourû
)

58 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

59 
	$flPack‘
(
buf
, 
ÏıSourû
, 
queue
.
id
)

60 
’d
)

61 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
()

62 
loÿl
 
txCŒ
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
queue
.
dev
, "plain")

63 
loÿl
 
rxCŒ
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
queue
.
dev
, "plain")

64 
loÿl
 
couÁ”
 = 0

65 
mg
.
	$ruÂšg
() do

66 
bufs
:
	$®loc
(
PKT_SIZE
)

67 
i
, 
buf
 
š
 
	$aœs
(
bufs
) do

68 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

69 
pkt
.
udp
:
	`£tD¡PÜt
(
DST_PORT_BASE
 + 
couÁ”
)

70 
couÁ”
 = 
	$šcAndW¿p
(
couÁ”
, 
NUM_FLOWS
)

71 
’d


72 
bufs
:
	`ofæßdUdpChecksums
()

73 --
bufs
:
	$£tVÏns
(1234)

74 
queue
:
	$£nd
(
bufs
)

75 
txCŒ
:
	$upd©e
()

76 
rxCŒ
:
	$upd©e
()

77 
’d


78 
txCŒ
:
	$fš®ize
()

79 
rxCŒ
:
	$fš®ize
()

80 
’d


82 -- 
FIXME
: 
this
 
obviou¦y
 
lo£s
 
®l
 
·k‘s
 
th©
 
¬rive
 
Ú
 
the
 
wrÚg
 
Ïı
 
memb”


83 
funùiÚ
 
	$tim”SÏve
(
queues
, 
ÏıSourû
)

84 
loÿl
 
time¡am³rs
 = {
	}
}

85 
i
, 
queue
 
š
 
	$aœs
(
queues
) do

86 
time¡am³rs
[#time¡am³r + 1] = 
ts
:
	$ÃwUdpTime¡am³r
(
queue
.
tx
, queue.
rx
)

87 
’d


88 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

89 
mg
.
	`¦“pMlis
(1000è-- 
’su»
 
th©
 
the
 
lßd
 
sk
 
is
 
ruÂšg


90 
loÿl
 
size
 = 
m©h
.
	$max
(84, 
PKT_SIZE
)

91 
loÿl
 
couÁ”
 = 0

92 
mg
.
	$ruÂšg
() do

93 
i
, 
queue
 
š
 
	$aœs
(
queues
) do

94 
loÿl
 
time¡am³r
 = 
time¡am³rs
[
i
]

95 
loÿl
 
Ït
 = 
time¡am³r
:
	`m—su»L©’cy
(
size
, 
	$funùiÚ
(
buf
)

96 
	$flPack‘
(
buf
, 
ÏıSourû
, 
queue
.
tx
.
id
, 
size
)

97 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

98 
pkt
.
udp
:
	`£tSrcPÜt
(
DST_PORT_BASE
 + 
couÁ”
)

99 
pkt
.
4
.
d¡
:
	`£t
(
m©h
.
	`¿ndom
(0, 2^32 - 1))--
	`£tD¡PÜt
(
DST_PORT_BASE
 + 
couÁ”
)

100 
couÁ”
 = 
	$šcAndW¿p
(
couÁ”
, 
NUM_FLOWS
)

101 
’d
)

102 -- 
hi¡
:
	$´št
()

103 
’d


104 
’d


105 
hi¡
:
	$´št
()

106 
hi¡
:
	$§ve
(
hi¡fe
)

107 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/arrmatch.lua

1 --- 
M©chšg
 
msÿp
 
fes


3 
loÿl
 
	gmod
 = {}

5 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

6 
loÿl
 
log
 = 
»quœe
 "log"

7 
loÿl
 
ms
 = 
»quœe
 "moonsniff-io"

8 
loÿl
 
b™
 = 
»quœe
 "bit"

9 
loÿl
 
mem
 = 
»quœe
 "memory"

11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
loÿl
 
C
 = 
ffi
.C

13 
loÿl
 
bªd
 = 
b™
.band

15 --  
v®ues


16 
loÿl
 
INDEX_BITMASK
 = 0x0FFFFFFF

17 
loÿl
 
TIME_THRESH
 = -50 -- 
Ãg©ive
 
timev®ues
 
sm®Ër
 
thª
 
this
 
v®ue
 
¬e
 
nÙ
 
®lowed


19 -- 
poš‹rs
 
ªd
 
ùy³s


20 
loÿl
 
INT64_T
 = 
ffi
.
ty³of
("int64_t")

21 
loÿl
 
UINT64_T
 = 
ffi
.
ty³of
("uint64_t")

22 
loÿl
 
UINT64_P
 = 
ffi
.
ty³of
("uint64_t *")

24 
ffi
.
cdef
 [[

25 
	s’Œy
 {

26 
ušt64_t
 
time¡amp
;

27 
ušt32_t
 
id’tif›r
;

28 } 
__©Œibu‹__
((
__·cked__
));

31 
loÿl
 
	gENTRY_T
 = 
ffi
.
ty³of
("structƒntry")

32 
loÿl
 
ENTRY_P
 = 
ffi
.
ty³of
("structƒntry *")

34 --- 
Maš
 
m©chšg
 
funùiÚ


35 --- 
Tr›s
 
to
 
m©ch
 
time¡amps
 
ªd
 
id’tifiÿtiÚs
 
äom
 
two
 
msÿp
 
fes


36 --- 
C®l
 
this
 
funùiÚ
 
äom
 
the
 
outside


38 -- @
·¿m
 
PRE
, 
f’ame
 
of
 
the
 
msÿp
 
fe
 
cÚššg
 
	g´e
-
DuT
 
	gm—su»m’ts


39 -- @
·¿m
 
	gPOST
, 
f’ame
 
of
 
the
 
msÿp
 
fe
 
cÚššg
 
	gpo¡
-
DuT
 
	gm—su»m’ts


40 -- @
·¿m
 
	g¬gs
, 
	g¬gum’ts
. 
S“
 
	gpo¡
-
	g´oûssšg
.
lua
 
a
 
li¡
 
of
 
suµÜ‹d
 
¬gum’ts


41 
funùiÚ
 
	gmod
.
	$m©ch
(
PRE
, 
POST
, 
¬gs
)

42 
¬gs
.
debug
 
th’


43 
log
:
	`šfo
("Debug mode MSCAP")

44 
	`wr™eMSCAPasText
(
PRE
, "pre-ts.csv", 1000)

45 
	`wr™eMSCAPasText
(
POST
, "post-ts.csv", 1000)

47 
’d


49 
log
:
	`šfo
("Using‡rray matching")

51 -- 
šü—£
 
the
 
size
 
of
 
m­
 
by
 
Úe
 
to
 
make
 
BITMASK
 
a
 
v®id
 
id’tif›r


52 
loÿl
 
m­
 = 
C
.
	`m®loc
(
ffi
.(
ENTRY_T
è* (
INDEX_BITMASK
 + 1))

53 
m­
 = 
ffi
.
	`ÿ¡
(
ENTRY_P
, map)

55 -- 
make
 
su»
 
the
 
com¶‘e
 
m­
 
is
 
z”o
 
š™Ÿlized


56 
	$z”oIn™
(
m­
)

58 
C
.
	$hs_š™Ÿlize
(
¬gs
.
Äbuck‘s
)

60 
´”—d”
 = 
ms
:
	$ÃwR—d”
(
PRE
)

61 
po¡»ad”
 = 
ms
:
	$ÃwR—d”
(
POST
)

63 
loÿl
 
´eÿp
 = 
	$»adSšgË
(
´”—d”
)

64 
loÿl
 
po¡ÿp
 = 
	$»adSšgË
(
po¡»ad”
)

65 
log
:
	`šfo
("P» id’tif›r: " .. 
	`to¡ršg
(
	`g‘Id
(
´eÿp
)è.. ", Po¡ id’tif›r: " ..o¡ršg(g‘Id(
po¡ÿp
)))

67 -- 
debug
 
ªd
 
šfÜm©iÚ
 
v®ues


68 
loÿl
 
ov”wr™es
 = 0

69 
loÿl
 
mis£s
 = 0

70 
loÿl
 
´e_pkts
 = 0 -- 
numb”
 
of
 
·ck‘s
 
»ûived
 
Ú
 
´e
 
pÜt


71 
loÿl
 
po¡_pkts
 = 0 -- 
numb”
 
of
 
·ck‘s
 
»ûived
 
Ú
 
po¡
 
pÜt


73 
log
:
	`šfo
("Prefilling Map")

75 
´eÿp
 =ğ
n
 
Ü
 
po¡ÿp
 =ğn 
th’


76 
log
:
	`”r
("Detectedƒither‚o…re or…ostimestamps. Aborting ..")

77 
’d


79 
´e_pkts
, 
ov”wr™es
 = 
	`š™ŸlFl
(
´eÿp
, 
´”—d”
, 
m­
)

81 -- 
m­
 
is
 
sucûssfuÎy
 
´efËd


82 
log
:
	`šfo
("Map is‚ow hot")

84 -- 
begš
 
aùu®
 
m©chšg


85 
´eÿp
 
ªd
 
po¡ÿp
 do

86 
´e_pkts
 =…re_pkts + 1

87 
po¡_pkts
 =…ost_pkts + 1

89 
loÿl
 
id’t
 = 
	`bªd
(
	`g‘Id
(
´eÿp
), 
INDEX_BITMASK
)

91 
m­
[
id’t
].
time¡amp
 ~ğ0 
th’


92 
ov”wr™es
 = overwrites + 1

93 
’d


95 
m­
[
id’t
].
time¡amp
 = 
	$g‘Ts
(
´eÿp
)

96 
m­
[
id’t
].
id’tif›r
 = 
	$g‘Id
(
´eÿp
)

98 
´eÿp
 = 
	$»adSšgË
(
´”—d”
)

100 
po¡ÿp
, 
mis£s
 = 
	$compu‹L©’cy
(
po¡ÿp
, 
po¡»ad”
, 
m­
, 
mis£s
)

101 
’d


103 -- 
®l
 
´e
-
DuT
 
v®ues
 
¬e
 
®»ady
 
šşuded
 
š
 
the
 
m­


104 -- 
´oûss
 
Ëáov”
 
po¡
-
DuT
 
v®ues


105 
po¡ÿp
 do

106 
po¡_pkts
 =…ost_pkts + 1

108 
po¡ÿp
, 
mis£s
 = 
	$compu‹L©’cy
(
po¡ÿp
, 
po¡»ad”
, 
m­
, 
mis£s
)

109 
’d


111 
log
:
	`šfo
("Finishedimestamp matching")

113 -- 
ş—n
 
up


114 
´”—d”
:
	$şo£
()

115 
po¡»ad”
:
	$şo£
()

116 
C
.
	$ä“
(
m­
)

118 
C
.
	`hs_fš®ize
()

120 -- 
´št
 
fš®
 
¡©i¡ics


121 
	$´štSts
(
´e_pkts
, 
po¡_pkts
, 
ov”wr™es
, 
mis£s
)

123 
log
:
	`šfo
("Finished…rocessing. Writing histogram ...")

124 
C
.
	`hs_wr™e
(
¬gs
.
ouut
 .. ".csv")

125 
C
.
	$hs_de¡roy
()

127  
´e_pkts
 + 
po¡_pkts


128 
’d


130 --- 
Z”o
 
š™Ÿlize
 
the
 
¬¿y
 
Ú
 
which
h
m­pšg
 
wl
 
be
 
³rfÜmed


132 -- @
·¿m
 
m­
, 
poš‹r
 
to
 
the
 
m©chšg
-
¬¿y


133 
funùiÚ
 
	$z”oIn™
(
m­
)

134 
i
 = 0, 
INDEX_BITMASK
 do

135 
m­
[
i
].
time¡amp
 = 0

136 
m­
[
i
].
id’tif›r
 = 0

137 
’d


138 
’d


140 --- 
Fl
 
the
 
¬¿y
 
Ú
 
which
 
is
 
m©ched
 
w™h
 
´e
-
DuT
 
v®ues


142 -- @
·¿m
 
´eÿp
, 
the
 
fœ¡
 
´e
-
DuT
 
msÿp
 
fe


143 -- @
·¿m
 
´”—d”
, 
the
 
»ad”
 
®l
 
sub£qu’t
 
msÿps


144 -- @
·¿m
 
m­
, 
poš‹r
 
to
 
the
 
¬¿y
 
Ú
 
which
h
m©chšg
 
is
 
³rfÜmed


145 
funùiÚ
 
	$š™ŸlFl
(
´eÿp
, 
´”—d”
, 
m­
)

146 
loÿl
 
´e_id’t
 = 
	`bªd
(
	`g‘Id
(
´eÿp
), 
INDEX_BITMASK
)

147 
loÿl
 
š™Ÿl_id
 = 
´e_id’t


149 
loÿl
 
ov”wr™es
 = 0

151 
loÿl
 
´e_pkts
 = 0

153 
log
:
	`šfo
("’d : " .. 
INDEX_BITMASK
 - 100)

155 
´eÿp
 
ªd
 
´e_id’t
 >ğ
š™Ÿl_id
‡nd…»_id’ˆ< 
INDEX_BITMASK
 - 100 do

156 
´e_pkts
 =…re_pkts + 1

158 
m­
[
´e_id’t
].
time¡amp
 ~ğ0 
th’
 
ov”wr™es
 = ov”wr™e + 1 
’d


159 
m­
[
´e_id’t
].
time¡amp
 = 
	$g‘Ts
(
´eÿp
)

160 
m­
[
´e_id’t
].
id’tif›r
 = 
	$g‘Id
(
´eÿp
)

162 
´eÿp
 = 
	$»adSšgË
(
´”—d”
)

163 
´eÿp
 
th’


164 
´e_id’t
 = 
	`bªd
(
	`g‘Id
(
´eÿp
), 
INDEX_BITMASK
)

165 
’d


166 
’d


167  
´e_pkts
, 
ov”wr™es


168 
’d


170 --- 
FunùiÚ
 
to
 
´oûss
 
a
 
sšgË
 
’Œy
 
of
 
the
 
po¡
 .
msÿp
 
fe


171 --- 
Compu‹s
 
the
 
cÜ»ù
 
šdex
 
š
h
¬¿y
 
ªd
 
checks
 
™s
 
cÚ‹Ás


172 --- 
If
 
compu‹d
 
Ï‹nc›s
 
exûed
 
the
 
Ãg©ive
 
	`th»shŞd
 (
e
.
g
. -2 
mli£cÚds
è
a
 
w¬nšg
 
is
 
´š‹d


174 -- @
·¿m
 
po¡ÿp
, 
the
 
cu¼’t
 
msÿp
 
’Œy


175 -- @
·¿m
 
po¡»ad”
, 
the
 
»ad”
 
assocŸ‹d
 
w™h
h
po¡
 
msÿp
 
fe


176 -- @
·¿m
 
m­
, 
the
 
¬¿y
 
š
 
which
h
´e
 
time¡amps
 
¬e
 
¡Üed


177 -- @
·¿m
 
mis£s
, 
the
 
numb”
 
of
 mis£ 
which
 
have
 
occu¼ed
 
uÁ
 
now


178 -- @ 
the
 
Ãxt
 
msÿp
 
’Œy
, 
Ü
 
n
 msÿ°
fe
 
is
 
d•Ë‹d


179 -- @ 
the
 
Ãw
 
numb”
 
of
 
	`mis£s
 (
e™h”
h
§me
 
Ü
 
mis£s
 + 1)

180 
funùiÚ
 
	$compu‹L©’cy
(
po¡ÿp
, 
po¡»ad”
, 
m­
, 
mis£s
)

181 
loÿl
 
id’t
 = 
	`bªd
(
	`g‘Id
(
po¡ÿp
), 
INDEX_BITMASK
)

182 
loÿl
 
ts
 = 
m­
[
id’t
].
time¡amp


183 
loÿl
 
´e_id’tif›r
 = 
m­
[
id’t
].
id’tif›r


184 
loÿl
 
po¡_id’tif›r
 = 
	$g‘Id
(
po¡ÿp
)

186 
´e_id’tif›r
 =ğ
po¡_id’tif›r
 
th’


187 
loÿl
 
diff
 = 
ffi
.
	`ÿ¡
(
INT64_T
, 
	`g‘Ts
(
po¡ÿp
è- 
ts
)

188 -- 
hªdË
 
weœd
 
ov”æow
 
bug
 
th©
 
was
 
šŒoduûd
 
wh’
 
we
 
moved
 
to
 
the
 
C
++ 
ÿ±u»r


189 -- 
no
 
id—
 
wh©
 
exaùly
 
ÿu£s
 
this
, 
but
hi 
wÜk
-
¬ound
 
fixes
 
™
 
®l
 
Ï‹nc›s
 
Ëss
 
thª
 2 
£cÚds


190 
ts
 ~ğ0 
ªd
 
diff
 < -2^31‡nd difà> -2^32 
th’


191 
diff
 = diff + 2^32

192 
’d


193 
ts
 ~ğ0 
ªd
 
diff
 < 
TIME_THRESH
 
th’


194 
log
:
	`w¬n
("Got†atency smallerhan definedhresh value")

195 
log
:
	`w¬n
("Id’tifiÿtiÚ " .. 
id’t
)

196 
log
:
	`w¬n
("P»: " .. 
	`to¡ršg
(
ts
è.. ";…o¡: " ..o¡ršg(
	$g‘Ts
(
po¡ÿp
)))

197 
log
:
	`w¬n
("Difã»nû: " .. 
	`to¡ršg
(
diff
è.. ",h»sh: " .. 
	$to¡ršg
(
TIME_THRESH
))

199 
ts
 ~ğ0 
th’


200 
C
.
	$hs_upd©e
(
diff
)

202 
mis£s
 = misses + 1

203 
’d


204 
’d


206 
mis£s
 = misses + 1

207 
’d


209 
m­
[
id’t
].
time¡amp
 = 0

210 
m­
[
id’t
].
id’tif›r
 = 0

212  
	`»adSšgË
(
po¡»ad”
), 
mis£s


213 
’d


216 --- 
Pršts
 
the
 
¡©i¡ics
 
©
h
’d
 
of
h
´og¿m


217 
funùiÚ
 
	$´štSts
(
´e_pkts
, 
po¡_pkts
, 
ov”wr™es
, 
mis£s
)

218 
	$´št
()

219 
log
:
	`šfo
("#…kt ´e: " .. 
´e_pkts
 .. ", #…kt po¡ " .. 
po¡_pkts
)

220 
log
:
	`šfo
("Pack‘†oss: " .. (1 - (
po¡_pkts
 / 
´e_pkts
)) * 100 .. " %%")

221 
log
:
	`šfo
("")

222 
log
:
	`šfo
("# oàid’tifiÿtiÚ possibË: " .. 
INDEX_BITMASK
)

223 
log
:
	`šfo
("Ov”wr™es: " .. 
ov”wr™es
 .. " from " .. 
´e_pkts
)

224 
log
:
	`šfo
("\tP”ûÁage: " .. (
ov”wr™es
 / 
´e_pkts
) * 100 .. " %%")

225 
log
:
	`šfo
("")

226 
log
:
	`šfo
("Mis£s: " .. 
mis£s
 .. " from " .. 
po¡_pkts
)

227 
log
:
	`šfo
("\tP”ûÁage: " .. (
mis£s
 / 
po¡_pkts
) * 100 .. " %%")

228 
log
:
	`šfo
("")

229 
log
:
	`šfo
("M—n: " .. 
C
.
	`hs_g‘M—n
(è.. " [ns], V¬Ÿnû: " .. C.
	`hs_g‘V¬Ÿnû
() .. " [ns]\n")

230 
’d


234 --- 
U£d
 
debug
 
mode
 
Úly


235 --- 
Pršts
 
up
 
to
 
¿nge
 
’Œ›s
 
äom
 
¥ecif›d
 .
msÿp
 
fe
 
as
 
csv


236 --- 
CŞumns
: 
fuÎ
 
id’tifiÿtiÚ
, 
efãùive
 id’tifiÿtiÚ, 
time¡amp


238 -- @
·¿m
 
šfe
, 
the
 
msÿp
 
fe
 
to
 
»ad
 
äom


239 -- @
·¿m
 
outfe
, 
the
 
Çme
 
of
h
fe
 
to
 
wr™e
o

240 -- @
·¿m
 
¿nge
, 
´št
 
up
 
to
„ªg
’Œ›s
 
th”e
 
¬e
 
’ough
ƒntries

241 
funùiÚ
 
	$wr™eMSCAPasText
(
šfe
, 
outfe
, 
¿nge
)

242 
loÿl
 
»ad”
 = 
ms
:
	$ÃwR—d”
(
šfe
)

243 
loÿl
 
msÿp
 = 
»ad”
:
	$»adSšgË
()

245 
loÿl
 
‹xtf
 = 
io
.
	`İ’
(
outfe
, "w")

247 
i
 = 0, 
¿nge
 do

248 
loÿl
 
id’t
 = 
	$bªd
(
msÿp
.
id’tifiÿtiÚ
, 
INDEX_BITMASK
)

250 
‹xtf
:
	`wr™e
(
	`to¡ršg
(
msÿp
.
id’tifiÿtiÚ
), ", ",o¡ršg(
id’t
), ", ",o¡ršg(msÿp.
time¡amp
), "\n")

251 
msÿp
 = 
»ad”
:
	$»adSšgË
()

253 
msÿp
 =ğ
n
 
th’
  
’d


254 
’d


256 
»ad”
:
	$şo£
()

257 
io
.
	$şo£
(
‹xtf
)

258 
’d


260 --- 
R—d
 
the
 
fœ¡
 
´e
-
DuT
 
ªd
 
po¡
-DuT 
v®ues


261 
funùiÚ
 
	$š™R—d”
(
PRE
, 
POST
)

262  
ms
:
	`ÃwR—d”
(
PRE
), ms:
	$ÃwR—d”
(
POST
)

263 
’d


266 --- 
Ab¡¿ù
 
difã»Á
 
»ad”s
 
äom
 
—ch
 
Ùh”


267 
funùiÚ
 
	$»adSšgË
(
»ad”
)

268  
»ad”
:
	$»adSšgË
()

269 
’d


272 --- 
Compu‹
 
ª
 
id’tifiÿtiÚ
 
of
 
pÿp
 
fes


273 --- 
Has
 
no
 
efãù
 
Ú
 
msÿp
 
fes


274 
funùiÚ
 
	$g‘Id
(
ÿp
)

275  
ÿp
.
id’tifiÿtiÚ


276 
’d


278 --- 
ExŒaù
 
time¡amp
 
äom
 
pÿp
 
ªd
 
msÿps


279 
funùiÚ
 
	$g‘Ts
(
ÿp
)

280  
ÿp
.
time¡amp


281 
’d


283 -- 
G‘
 
the
 
·ylßd
 
id’tifiÿtiÚ
 
äom
 
msÿp
 
fe


284 -- 
Undefšed
 
behaviÜ
 
·ck‘s
 
w™hout
 
id’tifiÿtiÚ
 
š
 
the
 
·ylßd


285 
funùiÚ
 
	$g‘PaylßdId
(
ÿp
)

286  
ÿp
.
id’tifiÿtiÚ


287 
’d


289  
mod


	@/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/pkt-matcher.lua

1 --- 
This
 
fe
 
hŞds
 
a
 
funùiÚ
 
which
 
should
 
be
 
cu¡omized
 
to
 
£rve
 
your
 
Ãeds
 
·ck‘
 
m©chšg


3 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

4 
loÿl
 
memÜy
 = 
»quœe
 "memory"

5 
loÿl
 
log
 = 
»quœe
 "log"

6 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

7 
loÿl
 
pÿp
 = 
»quœe
 "pcap"

9 
loÿl
 
ffi
 = 
»quœe
 "ffi"

10 
loÿl
 
C
 = 
ffi
.C

12 
loÿl
 
MS_TYPE
 = 0b01010101

14 --- 
ExŒaùs
 
d©a
 
äom
 
ª
 
mbuf
 
što
 
a
 
sü©ch·d


15 --- 
D•’dšg
 
Ú
 
the
 
·ck‘
 
is
 
a
 
´e
-
DuT
 
Ü
 
po¡
-DuT…ack‘ 
this
 
funùiÚ
 
may
 
Ãed
 
to
 
behave
 
difã»Ály


16 --- 
This
 
may
 
be
 
u£ful
 
wh’
 
the
 
DuT
 
chªges
 
·ck‘s
 
š
 
a
 
d‘”mši¡ic
 
way


18 -- @
·¿m
 
mbuf
, 
the
 mbuà
cÚššg
h
	g·ck‘


19 -- @
·¿m
 
	gsü©ch·d
, 
¬¿y
 
to
 
cİy
 
the
 
¦eùed
 
d©a
 
	gto


20 -- @
·¿m
 
	gsize
, 
the
 
size
 
of
h
sü©ch·d
 
š
 
	gby‹s


21 -- @
·¿m
 
	g´e
, 
Œue
 ´e-
DuT
 
	g·ck‘
, 
çl£
 
Ùh”wi£


22  
	$funùiÚ
(
mbuf
, 
sü©ch·d
, 
size
, 
´e
)

23 
loÿl
 
fËd
 = 0 -- 
the
 
numb”
 
of
 
by‹s
 fËd 
š
h
sü©ch·d


26 -- 
cu¡omize
 
b–ow
 
h”e


28 
pkt
 = 
mbuf
:
	$g‘UdpPack‘
()

30 
pkt
.
·ylßd
.
ušt8
[4] =ğ
MS_TYPE
 
th’


31 
ffi
.
	$cİy
(
sü©ch·d
, 
pkt
.
·ylßd
.
ušt8
, 4)

32 
fËd
 = 4

34 
	`´št
("Non moonsniff…acket detected")

35 
’d


37 -- 
cu¡omize
 
above
 
h”e


40 -- 
make
 
su»
 
we
 
did
 
nÙ
 
ov”fl
 
the
 
sü©ch·d


41 
fËd
 > 
size
 
th’
 
log
:
	`”r
("UDFƒxûeded sü©ch·d size!"è
’d


43  
fËd


44 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/post-processing.lua

1 --- 
DemÚ¡¿‹s
 
the
 
basic
 
u§ge
 
of
 
moÚ¢iff
 
š
 
Üd”
 
to
 
d‘”mše
 
deviû
 
šduûd
 
	gÏ‹nc›s


2 --- 
This
 
fe
 
is
 
the
 
’Œy
 
pošt
 
	g´oûssšg
 .
msÿp
 
	gªd
 .
pÿp
 
	gfes


3 --- 
In
 
Üd”
 
pÿp
 
fes
 
to
 
be
 
´oûs£d
 
cÜ»ùly
 
they
 
mu¡
 
ã©u»
 
	ga
 64 
b™
 
time¡amp
 
©
 
the
 
	g’d


5 --- 
V®id
 
fes
 
ÿn
 
be
 
g’”©ed
 
by
 
	g¢ifãr
.
lua
 
w™h
 
no
 
	$æags
 (
msÿp
è
Ü
 
w™h
 
the
 
æag
 --
	$ÿ±u»
 (
pÿp
)

7 
»quœe
 "utils"

8 
loÿl
 
log
 = 
»quœe
 "log"

9 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

10 
loÿl
 
pÿp
 = 
»quœe
 "pcap"

11 
loÿl
 
´ofe
 = 
»quœe
 "jit.p"

13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
loÿl
 
C
 = 
ffi
.C

16 
loÿl
 
MODE_MSCAP
, 
MODE_PCAP
 = 0, 1

17 
loÿl
 
MODE
 = 
MODE_MSCAP


19 -- 
sk
 
the
 
š™Ÿliz©iÚ
 
of
 
DPDK
, 
as
 
™
 
is
 
nÙ
 
Ãeded
 
this
 
süt


20 
dpdk
.
	$skIn™
()

22 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

23 
·r£r
:
	`desütiÚ
("Demonstrate‡ndest hardware†atency induced by‡ device underest.\nThe idealest setup iso use 2aps, one should be connectedohe ingress cable,he other oneoheƒgress one.\n\nTheype ofhe input is‡utomatically detected based onhe fileƒxtension. Make sure input files‡reƒither .pcap or .mscap files.\n\nTo determine which ishe…re‡nd which ishe…ost file, files must‡dhereohe following‚aming conventions:\n\t<name>-pre.pcap‡nd <name>-post.pcap\n\tor\n\t<name>-pre.mscap‡nd <name>-post.mscap\n\nNotehat <name>‚eed‚ot behe same‚ame.")

24 
·r£r
:
	`İtiÚ
("-˜--šput", "P©hØšpuˆfe. SuµÜt .msÿ°Ü .pÿ°fes."):
	$¬gs
(1)

25 
·r£r
:
	`İtiÚ
("- --£cÚd-šput", "P©hØ£cÚd iÅuˆfe. SuµÜt .msÿ°Ü .pÿ°fes."):
	$¬gs
(1):
	`rg‘
("second")

26 
·r£r
:
	`İtiÚ
("-Ø--ouut", "Namoàthhi¡og¿m which i g’”©ed."):
	$¬gs
(1):("hist")

27 
·r£r
:
	`İtiÚ
("-À--Äbuck‘s", "Sizoà¨buck‘ fÜh»suÉšg hi¡og¿m."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1)

28 
·r£r
:
	`æag
("-d --debug", "Create debug information. Instead of…rocessinghe input files‚ormally,hey‡reranslated into human„eadable csv files.")

29 
·r£r
:
	`æag
("-p --profile", "Profilehe‡pplication. May decreasehe overall…erformance.")

30  
·r£r
:
	$·r£
()

31 
’d


34 --- 
Maš
 
’Œy
 
of
 
the
 
´og¿m


35 
funùiÚ
 
	$ma¡”
(
¬gs
)

36 
¬gs
.
šput
 
th’
 
INPUT_PATH
 =‡rgs.špuˆ
’d


38 -- 
d‘”mše
 
the
 
šput
 
ty³


39 
¡ršg
.
	`m©ch
(
¬gs
.
šput
, ".*%.pÿp"è
th’


40 
MODE
 = 
MODE_PCAP


41 
–£if
 
¡ršg
.
	`m©ch
(
¬gs
.
šput
, ".*%.msÿp"è
th’


42 
MODE
 = 
MODE_MSCAP


44 
log
:
	`”r
("Input with unknown fileƒxtension. Can only…rocess .pcap or .mscap files.")

45 
’d


47 
	$´št
(
MODE
)

48 
loÿl
 
PRE


49 
loÿl
 
POST


52 -- 
d‘”mše
 
which
 
is
 
the
 
po¡
 
ªd
 which i th
´e
 
fe


53 
MODE
 =ğ
MODE_MSCAP
 
th’


54 
nÙ
 
¬gs
.
£cÚd
 
th’
 
log
:
	`çl
("D‘eùed .msÿ°fbuˆth”wa nØ£cÚd fe. SšgË .msÿ°fe ÿÂÙ b´oûs£d."è
’d


56 
¡ršg
.
	`m©ch
(
¬gs
.
šput
, ".*%-´e%.msÿp"è
ªd
 sŒšg.m©ch×rgs.
£cÚd
, ".*%-po¡%.msÿp"è
th’


57 
PRE
 = 
¬gs
.
šput


58 
POST
 = 
¬gs
.
£cÚd


60 
–£if
 
¡ršg
.
	`m©ch
(
¬gs
.
£cÚd
, ".*%-´e%.msÿp"è
ªd
 sŒšg.m©ch×rgs.
šput
, ".*%-po¡%.msÿp"è
th’


61 
POST
 = 
¬gs
.
šput


62 
PRE
 = 
¬gs
.
£cÚd


64 
log
:
	`çl
("Could‚ot decide which file is…re‡nd which…ost. Pre shouldƒnd with -pre.mscap‡nd…ost with -post.mscap.")

65 
’d


66 
’d


68 
MODE
 =ğ
MODE_PCAP
 
th’


70 
nÙ
 
¬gs
.
£cÚd
 
th’
 
log
:
	`çl
("D‘eùed .pÿ°fbuˆth”wa nØ£cÚd fe. SšgË .pÿ°fe ÿÂÙ b´oûs£d."è
’d


72 
¡ršg
.
	`m©ch
(
¬gs
.
šput
, ".*%-´e%.pÿp"è
ªd
 sŒšg.m©ch×rgs.
£cÚd
, ".*%-po¡%.pÿp"è
th’


73 
PRE
 = 
¬gs
.
šput


74 
POST
 = 
¬gs
.
£cÚd


76 
–£if
 
¡ršg
.
	`m©ch
(
¬gs
.
£cÚd
, ".*%-´e%.pÿp"è
ªd
 sŒšg.m©ch×rgs.
šput
, ".*%-po¡%.pÿp"è
th’


77 
POST
 = 
¬gs
.
šput


78 
PRE
 = 
¬gs
.
£cÚd


80 
log
:
	`çl
("Could‚ot decide which file is…re‡nd which…ost. Pre shouldƒnd with -pre.mscap‡nd…ost with -post.mscap.")

81 
’d


82 
’d


85 
	$´št
(
PRE
)

86 
	`´št
(
POST
)

89 -- 
»Œ›ve
 
fe
 
size
 
š
 
Üd”
 
to
 
give
 
ª
 
e¡im©iÚ
 
the
 
´oûssšg
 
¥“d


90 
loÿl
 
fe
 = 
	`as£¹
(
io
.
	`İ’
(
PRE
, "r"))

91 
loÿl
 
size
 = 
	$fsize
(
fe
)

92 
fe
:
	$şo£
()

93 
fe
 = 
	`as£¹
(
io
.
	`İ’
(
POST
, "r"))

94 
size
 = siz+ 
	$fsize
(
fe
)

95 
fe
:
	$şo£
()

96 
log
:
	`šfo
("Fsize: " .. 
size
 / 1e9 .. " [GB]")

97 
loÿl
 
¡¬tTime
 = 
	$g‘MÚÙÚicTime
()

98 
¬gs
.
´ofe
 
th’
…rofe.
	`¡¬t
("-æ", "´ofe.log"è
’d


100 
loÿl
 
·ck‘s
 = 0

102 -- 
run
 
cÜ»ù
 
m©chšg
 
fe


103 
MODE
 =ğ
MODE_PCAP
 
th’


104 
loÿl
 
tbb
 = 
»quœe
 "tbbmatch"

105 
·ck‘s
 = 
tbb
.
	$m©ch
(
PRE
, 
POST
, 
¬gs
)

106 
–£if
 
MODE
 =ğ
MODE_MSCAP
 
th’


107 
loÿl
 
¬r
 = 
»quœe
 "arrmatch"

108 
·ck‘s
 = 
¬r
.
	$m©ch
(
PRE
, 
POST
, 
¬gs
)

109 
’d


111 -- 
fšish
 
İ”©iÚs


112 
¬gs
.
´ofe
 
th’
…rofe.
	$¡İ
(è
’d


114 
loÿl
 
–­£d
 = 
	`g‘MÚÙÚicTime
(è- 
¡¬tTime


115 
log
:
	`šfo
("EÏp£dimcÜe: " .. 
–­£d
 .. " [sec]")

116 
log
:
	`šfo
("Proûssšg s³ed:\n\t" .. (
size
 / 1e6è/ 
–­£d
 .. " [MB/s]\n\t" .. (
·ck‘s
 / 1e6) /ƒlapsed .. " [mpps]")

117 
’d


119 --- 
Compu‹
 
the
 
size
 
of
 
a
 
fe


120 
funùiÚ
 
	$fsize
(
fe
)

121 
loÿl
 
cu¼’t
 = 
fe
:
	$£ek
()

122 
loÿl
 
size
 = 
fe
:
	`£ek
("end")

123 
fe
:
	`£ek
("£t", 
cu¼’t
)

124  
size


125 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/sniffer.lua

1 --- 
DemÚ¡¿‹s
 
the
 
basic
 
u§ge
 
of
 
moÚ¢iff
 
š
 
Üd”
 
to
 
d‘”mše
 
deviû
 
šduûd
 
Ï‹nc›s


3 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
ts
 = 
»quœe
 "timestamping"

7 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

8 
loÿl
 
tim”
 = 
»quœe
 "timer"

9 
loÿl
 
log
 = 
»quœe
 "log"

10 
loÿl
 
¡©s
 = 
»quœe
 "stats"

11 
loÿl
 
b¬r›r
 = 
»quœe
 "barrier"

12 
loÿl
 
pÿp
 = 
»quœe
 "pcap"

13 
loÿl
 
ms
 = 
»quœe
 "moonsniff-io"

15 
loÿl
 
ffi
 = 
»quœe
 "ffi"

16 
loÿl
 
C
 = 
ffi
.C

18 
loÿl
 
MS_THRESH
 = -50 -- 
Live
 
mode
 
Úly
! 
AÎ
 
Ï‹nc›s
 
b–ow
 
this
 
v®ue
 [
ns
] 
wl
 
´št
 
a
 
w¬nšg


19 -- 
Tho£
 
v®ues
 
wl
 
nÙ
 
be
 
šşuded
 
š
 
the
 
Ï‹ncy
 
e¡im©iÚ


21 
loÿl
 
MS_TYPE
 = 0b01010101

23 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

24 
·r£r
:
	`desütiÚ
("Demonstrate‡ndest hardware†atency induced by‡ device underest.\nThe idealest setup iso use 2aps, one should be connectedohe ingress cable,he other oneoheƒgress one.\n\n For more detailed information on…ossible setups‡nd usage ofhis script have‡†ook‡t moonsniff.md.")

25 
·r£r
:
	`¬gum’t
("dev", "deviû tØu£."):
	$¬gs
(2):
	$cÚv”t
(
tÚumb”
)

26 
·r£r
:
	`İtiÚ
("-Ø--ouut", "P©hØouuˆfe."):
	$¬gs
(1):("latencies")

27 
·r£r
:
	`İtiÚ
("-ˆ--time", "S‘ thËngth oàthm—su»m’ˆ³riod iÀ£cÚds."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(10)

28 
·r£r
:
	`İtiÚ
("--£q-off£t", "Off£ˆoàth£qu’û‚umb” iÀby‹s."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

29 
·r£r
:
	`æag
("-l --live", "Do some†ive…rocessing during…acket capture. Lower…erformancehan standard mode.")

30 
·r£r
:
	`æag
("-f --fast", "Set fast flago„educehe‡mount of†ive…rocessing for higher…erformance. Only hasƒffect if†ive flag is‡lso set")

31 
·r£r
:
	`æag
("-c --capture", "If set,‡ll incoming…ackets‡re captured‡s‡ whole.")

32 
·r£r
:
	`æag
("-d --debug", "Insted of„eading„eal input, some fake input is generated‡nd writtenohe output files.")

33  
·r£r
:
	$·r£
()

34 
’d


36 
funùiÚ
 
	$ma¡”
(
¬gs
)

37 
¬gs
.
debug
 
th’


38 -- 
u£d
 
mašly
 
to
 
‹¡
 
funùiÚ®™y
 
of
 
io


39 
	$iodebug
(
¬gs
)

41 
¬gs
.
dev
[1] = 
deviû
.
cÚfig
{
pÜt
 =‡rgs.dev[1], 
txQueues
 = 1, 
rxQueues
 = 1, 
rxDescs
 = 4096, 
drİEÇbË
 = 
çl£
}

42 
	g¬gs
.
	gdev
[2] = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
dev
[2], 
	gtxQueues
 = 1, 
	grxQueues
 = 1, 
	grxDescs
 = 4096, 
	gdrİEÇbË
 = 
çl£
}

43 
	gdeviû
.
	$wa™FÜLšks
()

44 
loÿl
 
dev0tx
 = 
¬gs
.
dev
[1]:
	$g‘TxQueue
(0)

45 
loÿl
 
dev0rx
 = 
¬gs
.
dev
[1]:
	$g‘RxQueue
(0)

46 
loÿl
 
dev1tx
 = 
¬gs
.
dev
[2]:
	$g‘TxQueue
(0)

47 
loÿl
 
dev1rx
 = 
¬gs
.
dev
[2]:
	$g‘RxQueue
(0)

49 
¬gs
.
live
 
th’


50 
¡©s
.
¡¬tStsTask
{
rxDeviûs
 = {
¬gs
.
dev
[1],‡rgs.dev[2]}
	}
}

52 -- 
we
 
¬e
 
nÙ
 
live
 w
wªt
 
to
 
´št
 
the
 
¡©s
Ø
a
 
£³¿‹
 
fe
 
so
 
they
‡» 
	g—sy


53 -- 
avaabË
 
	gpo¡
-
´oûssšg


54 
	g¡©s
.
	g¡¬tStsTask
{
	grxDeviûs
 = {
¬gs
.
dev
[1],‡rgs.dev[2]}, 
	gfe
 =‡rgs.
ouut
 .. "-¡©s.csv", 
	gfÜm©
 = "csv"}

55 
’d


56 
	g¬gs
.
	gdev
[1]:
	$’abËRxTime¡ampsAÎPack‘s
(
dev0rx
)

57 
¬gs
.
dev
[2]:
	$’abËRxTime¡ampsAÎPack‘s
(
dev1rx
)

59 
loÿl
 
b¬
 = 
b¬r›r
:
	$Ãw
(2)

61 
ts
.
	$syncClocks
(
¬gs
.
dev
[1],‡rgs.dev[2])

62 
¬gs
.
dev
[1]:
	$ş—rTime¡amps
()

63 
¬gs
.
dev
[2]:
	`ş—rTime¡amps
()

66 -- 
¡¬t
 
the
 
sks
 
to
 
§m¶e
 
šcomšg
 
·ck‘s


67 -- 
cÜ»ù
 
mesu»m’t
 
»quœes
 
a
 
·ck‘
 
to
 
¬rive
 
©
 
P»
 
befÜe
 
Po¡


68 
loÿl
 
»ûiv”0
 = 
lm
.
	`¡¬tTask
("time¡amp", 
dev0rx
, 
¬gs
.
dev
[2], 
b¬
, 
Œue
,‡rgs)

69 
loÿl
 
»ûiv”1
 = 
lm
.
	`¡¬tTask
("time¡amp", 
dev1rx
, 
¬gs
.
dev
[1], 
b¬
, 
çl£
,‡rgs)

72 
»ûiv”0
:
	$wa™
()

73 
»ûiv”1
:
	$wa™
()

74 
lm
.
	$¡İ
()

76 
log
:
	`šfo
("Finished‡ll capturing/writing operations")

78 
¬gs
.
live
 
th’
 
	$´štSts
(
¬gs
è
’d


79 
’d


80 
’d


82 
funùiÚ
 
	`time¡amp
(
queue
, 
Ùh”dev
, 
b¬
, 
´e
, 
¬gs
)

83 -- 
queue
.
dev
:
	$’abËRxTime¡ampsAÎPack‘s
(
queue
)

84 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

85 
loÿl
 
d¿šQueue
 = 
tim”
:
	$Ãw
(0.5)

86 
lm
.
ruÂšg
 
ªd
 
d¿šQueue
:
	$ruÂšg
() do

87 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 1000)

88 
bufs
:
	$ä“
(
rx
)

89 
’d


91 -- 
b¬
:
	$wa™
()

93 
¬gs
.
live
 
th’


94 
C
.
	$ms_£t_th»sh
(
MS_THRESH
)

95 
loÿl
 
hi¡
 = 
nÙ
 
¬gs
.
ç¡
 
ªd
 hi¡:
	$Ãw
()

96 
	$cÜe_Úlše
(
queue
, 
bufs
, 
´e
, 
hi¡
, 
¬gs
)

98 
nÙ
 
¬gs
.
ç¡
 
th’


99 
log
:
	`šfo
("Inter-arrivalime distribution,his will„eport 0 on unsupported NICs")

100 
hi¡
:
	$´št
()

101 
hi¡
.
numSam¶es
 =ğ0 
th’


102 
log
:
	`”rÜ
("Received‚oimestamped…ackets.")

103 
’d


104 
’d


105 
	$´št
()

107 
–£if
 
¬gs
.
ÿ±u»
 
th’


108 
loÿl
 
wr™”


109 
´e
 
th’


110 -- 
£t
 
the
 
»Ïtive
 
¡¬tšg
 
time¡amp
 
to
 0

111 
wr™”
 = 
pÿp
:
	`ÃwWr™”
(
¬gs
.
ouut
 .. "-pre.pcap", 0)

113 
wr™”
 = 
pÿp
:
	`ÃwWr™”
(
¬gs
.
ouut
 .. "-post.pcap", 0)

114 
’d


116 
b¬
:
	$wa™
()

117 
	$cÜe_ÿ±u»
(
queue
, 
bufs
, 
wr™”
, 
¬gs
)

118 
wr™”
:
	$şo£
()

121 
loÿl
 
f’ame


122 
´e
 
th’


123 
f’ame
 = 
¬gs
.
ouut
 .. "-pre.mscap"

125 
f’ame
 = 
¬gs
.
ouut
 .. "-post.mscap"

126 
’d


128 
nÙ
 
¬gs
.
£q_off£t
 
th’


129 
log
:
	`”rÜ
("Specify offset of sequence‚umber with --seq-offset.")

131 
b¬
:
	$wa™
()

132 
	$cÜe_ofæše
(
queue
, 
bufs
, 
f’ame
, 
¬gs
)

133 
’d


134 
’d


135 
’d


137 
funùiÚ
 
	$cÜe_Úlše
(
queue
, 
bufs
, 
´e
, 
hi¡
, 
¬gs
)

138 
loÿl
 
ruÁime
 = 
tim”
:
	`Ãw
(
¬gs
.
time
 + 0.5)

139 
loÿl
 
Ï¡Time¡amp


141 
lm
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

142 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 1000)

143 
i
 = 1, 
rx
 do

144 
loÿl
 
time¡amp
 = 
bufs
[
i
]:
	$g‘Time¡amp
(
queue
.
dev
)

145 
nÙ
 
¬gs
.
ç¡
 
ªd
 
time¡amp
 
th’


146 -- 
time¡amp
 
som‘imes
 
jumps
 
by
 ~3 
£cÚds
 
Ú
 
	`ixgbe
 (
š
 
Ëss
 
thª
 
a
 
ãw
 
mli£cÚds
 
w®l
-
şock
 
time
)

147 
Ï¡Time¡amp
 
ªd
 
time¡amp
 -†a¡Time¡am°< 10^9 
th’


148 
hi¡
:
	`upd©e
(
time¡amp
 - 
Ï¡Time¡amp
)

149 
’d


150 
Ï¡Time¡amp
 = 
time¡amp


151 
’d


152 -- 
	`´št
("P»: " .. 
time¡amp
)

153 
loÿl
 
pkt
 = 
bufs
[
i
]:
	$g‘UdpPack‘
()

155 
´e
 
th’


156 
C
.
	$ms_add_’Œy
(
pkt
.
·ylßd
.
ušt32
[0], 
time¡amp
)

158 
C
.
	$ms_‹¡_fÜ
(
pkt
.
·ylßd
.
ušt32
[0], 
time¡amp
)

159 
’d


160 
’d


161 
bufs
:
	$ä“
(
rx
)

162 
’d


164 
’d


166 
funùiÚ
 
	$cÜe_ofæše
(
queue
, 
bufs
, 
f’ame
, 
¬gs
)

167 
C
.
	$ms_log_pkts
(
queue
.
id
, queue.
qid
, 
bufs
.
¬¿y
, bufs.
size
, 
¬gs
.
£q_off£t
, 
f’ame
)

168 
’d


170 
funùiÚ
 
	$cÜe_ÿ±u»
(
queue
, 
bufs
, 
wr™”
, 
¬gs
)

171 
loÿl
 
ruÁime
 = 
tim”
:
	`Ãw
(
¬gs
.
time
 + 0.5)

173 
lm
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

174 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 1000)

175 
i
 = 1, 
rx
 do

176 
loÿl
 
time¡amp
 = 
bufs
[
i
]:
	`g‘Time¡amp
(
queue
.
dev
)

177 -- 
time¡amps
 
h”e
 
¬e
 
giv’
 
š
 
ns


178 -- 
the
 
pÿp
 
moduË
 
assumes
 
æßts
 
ba£d
 
Ú
 
£cÚds


179 
time¡amp
 
th’


180 -- 
cÚv”t
 
to
 
£cÚds


181 
time¡amp
 =imestamp / 1e9

182 
wr™”
:
	$wr™eBuf
(
time¡amp
, 
bufs
[
i
])

183 
’d


184 
’d


185 
bufs
:
	$ä“
(
rx
)

186 
’d


187 
’d


189 
funùiÚ
 
	$´štSts
(
¬gs
)

190 
lm
.
	$¦“pMlis
(500)

191 
	$´št
()

193 
¡©s
 = 
C
.
	$ms_ãtch_¡©s
()

194 
h™s
 = 
¡©s
.hits

195 
mis£s
 = 
¡©s
.misses

196 
šv®idTS
 = 
¡©s
.
šv®_ts


197 
	`´št
("Reûived: " .. 
h™s
 + 
mis£s
)

198 
	`´št
("\tH™s: " .. 
h™s
)

199 
	`´št
("\tH™ w™h inv®idime¡amps: " .. 
šv®idTS
)

200 
	`´št
("\tMis£s: " .. 
mis£s
)

201 
	`´št
("\tLos by mis£s: " .. (
mis£s
/(mis£ + 
h™s
)) * 100 .. "%")

202 
	`´št
("\tTÙ®†oss: " .. ((
mis£s
 + 
šv®idTS
)/(mis£ + 
h™s
)) * 100 .. "%")

203 
	`´št
("Av”agÏ‹ncy: " .. 
	`to¡ršg
(
	`tÚumb”
(
¡©s
.
av”age_Ï‹ncy
)/10^3) .. " us")

204 
	`´št
("V¬Ÿnû oàÏ‹ncy: " .. 
	`to¡ršg
(
	`tÚumb”
(
¡©s
.
v¬Ÿnû_Ï‹ncy
)/10^3) .. " us")

205 
’d


207 
funùiÚ
 
	$iodebug
(
¬gs
)

208 
loÿl
 
wr™”_´e
 = 
ms
:
	`ÃwWr™”
(
¬gs
.
ouut
 .. "-pre.mscap")

209 
loÿl
 
wr™”_po¡
 = 
ms
:
	`ÃwWr™”
(
¬gs
.
ouut
 .. "-post.mscap")

211 
wr™”_´e
:
	$wr™e
(10, 1000002)

212 
wr™”_po¡
:
	$wr™e
(10, 0000002)

213 
wr™”_´e
:
	$wr™e
(11, 2000004)

214 
wr™”_po¡
:
	$wr™e
(11, 3000004)

215 
wr™”_´e
:
	$wr™e
(12, 4000008)

216 
wr™”_po¡
:
	$wr™e
(12, 5000008)

218 
wr™”_´e
:
	$şo£
()

219 
wr™”_po¡
:
	$şo£
()

221 
loÿl
 
»ad”
 = 
ms
:
	`ÃwR—d”
(
¬gs
.
ouut
 .. "-pre.mscap")

223 
loÿl
 
msÿp
 = 
»ad”
:
	$»adSšgË
()

225 
msÿp
 do

226 
	$´št
(
msÿp
.
id’tifiÿtiÚ
)

227 
	$´št
(
msÿp
.
time¡amp
)

229 
msÿp
 = 
»ad”
:
	$»adSšgË
()

230 
’d


231 
»ad”
:
	`şo£
()

234 -- 
C
.
	`ms_š™
(
OUTPUT_PATH
, 
OUTPUT_MODE
)

236 -- 
C
.
	`ms_add_’Œy
(10, 10000000)

237 -- 
C
.
	`ms_add_’Œy
(11, 20000000)

238 -- 
C
.
	`ms_‹¡_fÜ
(10, 20000000)

239 -- 
C
.
	`ms_‹¡_fÜ
(11, 30000000)

242 -- 
C
.
	$ms_fšish
()

244 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/tbbmatch.lua

1 --- 
M©chšg
 
pÿp
 
fes


3 
loÿl
 
	gmod
 = {}

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
ts
 = 
»quœe
 "timestamping"

7 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

8 
loÿl
 
log
 = 
»quœe
 "log"

9 
loÿl
 
ms
 = 
»quœe
 "moonsniff-io"

10 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

11 
loÿl
 
pÿp
 = 
»quœe
 "pcap"

12 
loÿl
 
hm­
 = 
»quœe
 "hmap"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
C
 = 
ffi
.C

17 -- 
poš‹rs
 
ªd
 
ùy³s


18 
loÿl
 
CHAR_P
 = 
ffi
.
ty³of
("char *")

19 
loÿl
 
INT64_T
 = 
ffi
.
ty³of
("int64_t")

20 
loÿl
 
UINT64_P
 = 
ffi
.
ty³of
("uint64_t *")

21 
loÿl
 
UINT8_T
 = 
ffi
.
ty³of
("uint8_t")

22 
loÿl
 
UINT8_P
 = 
ffi
.
ty³of
("uint8_t*")

24 
loÿl
 
ä“
 = 
C
.
¹e_pktmbuf_ä“_expÜt


25 
loÿl
 
bªd
 = 
b™
.band

27 
loÿl
 
pktm©ch
 = 
n


28 
loÿl
 
sü©ch·d
 = 
n


29 
loÿl
 
SCR_SIZE
 = 16 -- 
size
 
of
 
the
 
sü©ch·d
 
š
 
by‹s
, 
mu¡
 
®ways
 
be
 
muÉË
 
	gof
 8 
hash
 
to
 
	gwÜk


30 -- 
	gmaximum
: 64 (
Ïrge¡
 
suµÜ‹d
 
key
 
size
 
hashm­
)

32 
loÿl
 
TIME_THRESH
 = -50 -- 
Ãg©ive
 
timev®ues
 
sm®Ër
 
thª
 
this
 
v®ue
 
¬e
 
nÙ
 
®lowed


34 
loÿl
 
mempoŞ0
 = 
n


35 
loÿl
 
mempoŞ1
 = 
n


36 
loÿl
 
Ãxt_mempoŞ
 = 0 -- 
u£d
 
to
 
b‘w“n
 
mempoŞ
 0 
ªd
 mempool 1

38 
loÿl
 
TABLE_TARGET_SIZE
 = 10000 -- 
­´oxim©e
 
size
 
the
 
u£d
 
bË


39 
loÿl
 
TABLE_THRESH_SIZE
 = 1000 -- 
bË
 
size
 
exûeds
 
rg‘
 siz+ 
th»sh
 siz
the
abË 
wl
 
be
 
£¬ched
 

40 -- 
Ëáov”
 
’Œ›s
 
which
 
ÿn
 
be
 
d–‘ed


41 -- 
this
 
v®ue
 
is
 
dyÇmiÿÎy
 
šü—£d
 
duršg
 
ruÁime


42 
loÿl
 
DELETION_THRESH
 = 1e9 -- 
d–‘e
 
’Œ›s
 
Úly
 
theœ
 
time¡amp
 
is
 
this
 
v®ue
 
of
 
Çno£cÚds
 
Şd”


43 -- 
thª
 
the
 
Ï‹¡
 
’Œy
 
which
 
was
 
sucûssfuÎy
 
m©ched


46 --- 
Maš
 
m©chšg
 
funùiÚ


47 --- 
M©ches
 
time¡amps
 
ªd
 
id’tifiÿtiÚs
 
äom
 
pÿp
 
fes


48 --- 
C®l
 
this
 
funùiÚ
 
äom
 
the
 
outside


50 -- @
·¿m
 
PRE
, 
f’ame
 
of
 
the
 
pÿp
 
fe
 
cÚššg
h
	g´e
-
DuT
 
	gm—su»m’ts


51 -- @
·¿m
 
	gPOST
, 
f’ame
 
fo
 
the
 
pÿp
 
fe
 
cÚššg
h
	gpo¡
-
DuT
 
	gm—su»m’ts


52 -- @
·¿m
 
	g¬gs
, 
	g¬gum’ts
. 
S“
 
	gpo¡
-
	g´oûssšg
.
lua
 
a
 
li¡
 
of
 
suµÜ‹d
 
¬gum’ts


53 
funùiÚ
 
	gmod
.
m©ch
(
PRE
, 
POST
, 
¬gs
)

54 -- 
š
 
of
 
pÿp
 
fes
 
we
 
Ãed
 
DPDK
 
funùiÚs


55 
	gdpdk
.
	$š™
()

57 
¬gs
.
debug
 
th’


58 
log
:
	`šfo
("Debug mode PCAP")

59 
	`wr™ePCAPasText
(
PRE
, "pre-ts.csv", 1000)

60 
	`wr™ePCAPasText
(
POST
, "post-ts.csv", 1000)

62 
’d


64 -- 
u£
 
Ãw
 
tbb
 
m©chšg
 
mode


65 
log
:
	`šfo
("Using TBB")

66  
	$tbbCÜe
(
¬gs
, 
PRE
, 
POST
)

67 
’d


69 --- 
D‘”mše
 
the
 
absŞu‹
 
·th
 
of
 
this
 
süt


70 --- 
N“ded
 
beÿu£
 
»Ïtive
 
·ths
 dØ
nÙ
 
wÜk
, 
d•’dšg
 
Ú
 
the
 
wÜkšg
 
dœeùÜy


71 
funùiÚ
 
	$süt_·th
()

72 
loÿl
 
¡r
 = 
debug
.
	`g‘šfo
(2, "S").
sourû
:
	$sub
(2)

73  
¡r
:
	`m©ch
("(.*/)")

74 
’d


76 --- 
S‘up
 
by
 
lßdšg
 
u£r
 
defšed
 
funùiÚ
 
ªd
 
š™Ÿlizšg
 
the
 
sü©ch·d


77 
funùiÚ
 
	`£tUp
()

78 -- 
ãtch
 
u£r
 
defšed
 
funùiÚ


79 
loÿl
 
lßded_chunk
 = 
	`as£¹
(
	`lßdfe
(
	`süt_·th
() .. "pkt-matcher.lua"))

80 
pktm©ch
 = 
	`lßded_chunk
()

82 -- 
š™Ÿlize
 
sü©ch·d


83 
sü©ch·d
 = 
C
.
	`m®loc
(
ffi
.(
UINT8_T
è* 
SCR_SIZE
)

84 
sü©ch·d
 = 
ffi
.
	`ÿ¡
(
UINT8_P
, scratchpad)

86 -- 
£tup
 
the
 
mempoŞ


87 
mempoŞ0
 = 
memÜy
.
	$ü—‹MemPoŞ
()

88 
mempoŞ1
 = 
memÜy
.
	$ü—‹MemPoŞ
()

89 
’d


91 
funùiÚ
 
	$‹¬Down
()

92 
C
.
	$ä“
(
sü©ch·d
)

93 
’d


95 
funùiÚ
 
	$š™R—d”
(
PRE
, 
POST
)

96  
pÿp
:
	`ÃwR—d”
(
PRE
),…ÿp:
	$ÃwR—d”
(
POST
)

97 
’d


100 --- 
Ab¡¿ù
 
difã»Á
 
»ad”s
 
äom
 
—ch
 
Ùh”


101 --- 
Mªage
 
two
 
difã»Á
 
mempoŞs


103 -- @
·¿m
 
»ad”
, 
the
 
pÿp
„eader

104 
funùiÚ
 
	$»adSšgË
(
»ad”
)

105 
Ãxt_mempoŞ
 =ğ0 
th’


106 
Ãxt_mempoŞ
 = 1

107  
»ad”
:
	$»adSšgË
(
mempoŞ0
)

109 
Ãxt_mempoŞ
 = 0

110  
»ad”
:
	$»adSšgË
(
mempoŞ1
)

111 
’d


112  
»ad”
:
	$»adSšgË
()

113 
’d


115 --- 
Save
 
ä“
, 
wl
 f»
mbufs


117 -- @
·¿m
 
the
 
mbuf
 
which
 
should
 
be
 
ä“d


118 
funùiÚ
 
	$sä“
(
ÿp
)

119 
	$ä“
(
ÿp
)

120 
’d


123 --- 
ExŒaù
 
time¡amp
 
äom
 
pÿps


124 --- 
This
 
funùiÚ
 
is
 
desigÃd
 
the
 
IÁ–
 
X552
, 
Ùh”
 
deviûs
h
computiÚ
 
of


125 --- 
the
 
time¡amp
 
could
 
be
 
¦ighy
 
difã»Á


127 -- @
·¿m
 
ÿp
, 
mbuf
 
to
 
exŒaù
 
the
 
time¡amp
 
äom


128 
funùiÚ
 
	`g‘Ts
(
ÿp
)

129 -- 
g‘
 
X552
 
time¡amps


130 
loÿl
 
time¡amp
 = 
ffi
.
	`ÿ¡
("ušt32_t*", ffi.ÿ¡("ušt8_t*", 
ÿp
:
	`g‘D©a
()è+ c­:
	`g‘Size
() - 8)

131 
loÿl
 
low
 = 
time¡amp
[0]

132 
loÿl
 
high
 = 
time¡amp
[1]

133  
high
 * 10 ^ 9 + 
low


134 
’d


137 --- 
P»·»
 
HashM­
 
İ”©iÚ


138 --- 
In™Ÿlizes
 
bufãrs


139 
funùiÚ
 
	`š™HashM­
()

140 -- 
we
 
Ãed
 
the
 
v®ues
 
ev”ywh”e
, 
th”efÜe
, 
glob®


141 
tbbm­
 = 
hm­
.
	$ü—‹Hashm­
(
SCR_SIZE
, 8)

142 
tbbm­
:
	$ş—r
()

143 
acc
 = 
tbbm­
.
	$ÃwAcûssÜ
()

144 
loÿl
 
keyBuf
 = 
	`ü—‹By‹s
(
SCR_SIZE
)

146 -- 8 
by‹
 
time¡amps


147 
loÿl
 
tsBuf
 = 
	$ü—‹By‹s
(8)

148 
tsBuf
 = 
ffi
.
	`ÿ¡
(ffi.
	`ty³of
("uint64_t *"),sBuf)

149  
keyBuf
, 
tsBuf


150 
’d


152 --- 
C»©e
 
a
 
nÚ
 
g¬bage
 
cŞËùed
 
z”o
 
š™Ÿlized
 
by‹
 
¬¿y


154 -- @
·¿m
 
Ëngth
,†’gth 
of
 
the
 
¬¿y
 
š
 
by‹s


155 
funùiÚ
 
	$ü—‹By‹s
(
Ëngth
)

156 
loÿl
 
by‹s
 = 
C
.
	`m®loc
(
ffi
.(
UINT8_T
è* 
Ëngth
)

157 
by‹s
 = 
ffi
.
	$ÿ¡
(
UINT8_P
, 
by‹s
)

159 
ffi
.
	$fl
(
by‹s
, 
Ëngth
)

160  
by‹s


161 
’d


164 --- 
ExŒaù
 
d©a
 
äom
 
ª
 
pÿp
 
fe


165 --- 
This
 
is
 
dÚe
 
by
 
ª
 
ex‹º®
 
u£rdefšed
 
funùiÚ
 
pktm©ch
 
which
 
£Ëùs
 
some


166 --- 
v®ues
 
of
 
the
 
pÿp
 
fe
 
ªd
 
cİ›s
 
them
 
što
h
giv’
 
bufãr


167 --- 
Add™iÚ®ly
 
h¬dw¬e
 
time¡amps
 
which
 
¬e
 
loÿ‹d
 
©
 
the
 
’d
 
of
h
pÿp
 
fe


168 --- 
wl
 
be
 
exŒaùed
 
što
 
a
 
£³¿‹
 
bufãr


170 -- @
·¿m
 
ÿp
 
the
 
pÿp
 
fe
 
to
 
exŒaù
h
d©a
 
äom


171 -- @
·¿m
 
keyBuf
 
a
 
bufãr
 
što
 
which
 
the
 
d©a
 
£lûtd
 
by
h
udf
 
is
 
cİ›d


172 -- @
·¿m
 
tsBuf
 
a
 
bufãr
 
što
 
which
 
the
 
time¡amp
 
is
 
cİ›d


173 -- @
·¿m
 
´e
, 
Œue
 ´e-
DuT
 
·ck‘
, 
çl£
 
Ùh”wi£


174 
funùiÚ
 
	`exŒaùD©a
(
ÿp
, 
keyBuf
, 
tsBuf
, 
´e
)

175 -- 
z”o
 
fl
 
sü©ch·d
 
agaš


176 
ffi
.
	`fl
(
sü©ch·d
, 
SCR_SIZE
)

178 -- 
as
 
the
 
sü©ch·d
 
has
 
b“n
 
z”ofËd
, 
fËd
 
ÿn
 
§ãly
 
be
 
ignÜed


179 
loÿl
 
fËd
 = 
	$pktm©ch
(
ÿp
, 
sü©ch·d
, 
SCR_SIZE
, 
´e
)

181 
ffi
.
	$cİy
(
keyBuf
, 
sü©ch·d
, 
SCR_SIZE
)

183 
tsBuf
[0] = 
	$g‘Ts
(
ÿp
)

184 
’d


187 --- 
Adds
 
a
 
giv’
 
v®ue
 
to
 
the
 
HashM­


188 --- 
Should
 
be
 
ÿÎed
 
´e
-
DuT
 
·ck‘s


190 -- @
·¿m
 
ÿp
, 
the
 
cÜ»¥Údšg
 
mbuf
 th
·ck‘


191 -- @
·¿m
 
keyBuf
, 
»u§bË
 
bufãr
 
keys
. 
N“d
 
nÙ
 
be
 
z”o
 
š™Ÿlized


192 -- @
·¿m
 
tsBuf
, 
»u§bË
 
bufãr
 
time¡amps
. 
N“d
 
nÙ
 
be
 
z”o
 
š™®ized


193 
funùiÚ
 
	$addKeyV®
(
ÿp
, 
keyBuf
, 
tsBuf
)

194 
	`exŒaùD©a
(
ÿp
, 
keyBuf
, 
tsBuf
, 
Œue
)

196 -- 
add
 
the
 
d©a
 
to
h
hashm­


197 
tbbm­
:
	$acûss
(
acc
, 
keyBuf
)

198 
ffi
.
	`cİy
(
acc
:
	`g‘
(), 
tsBuf
, 8)

200 
acc
:
	$»Ëa£
()

201 
’d


204 --- 
Try
 
to
 
fšd
 
a
 
m©ch
 
š
 
the
 
bË
 ¨
giv’
 
key


205 --- 
The
 
key
 
is
 
exŒaùed
 
äom
 
the
 
mbuf
 
»´e£Ášg
 
a
 
po¡
-
DuT
 
deviû


207 -- @
·¿m
 
ÿp
, 
the
 
po¡
-
DuT
 
mbuf


208 -- @
·¿m
 
mis£s
, 
couÁ”
 
®l
 misses

209 -- @
·¿m
 
keyBuf
, 
»u§bË
 
bufãr
 
keys
. 
N“d
 
nÙ
 
be
 
z”o
 
š™Ÿlized


210 -- @
·¿m
 
tsBuf
, 
»u§bË
 
bufãr
 
time¡amps
. 
N“d
 
nÙ
 
be
 
z”o
 
š™®ized


211 -- @
·¿m
 
Ï¡H™
, 
time¡amp
 
of
 
the
 
Ï¡
 
sucûssful
 
m©chšg
 
İ”©iÚ


212 -- @
·¿m
 
bËSize
, 
the
 
cu¼’t
 
numb”
 
of
 
’Œ›s
 
š
h
bË


213 
funùiÚ
 
	$g‘KeyV®
(
ÿp
, 
mis£s
, 
keyBuf
, 
tsBuf
, 
Ï¡H™
, 
bËSize
)

214 
	$exŒaùD©a
(
ÿp
, 
keyBuf
, 
tsBuf
, 
çl£
)

216 
loÿl
 
found
 = 
tbbm­
:
	$fšd
(
acc
, 
keyBuf
)

217 
found
 
th’


218 
loÿl
 
´e_ts
 = 
acc
:
	$g‘
()

219 
loÿl
 
po¡_ts
 = 
tsBuf


221 
´e_ts
 = 
ffi
.
	$ÿ¡
(
UINT64_P
, 
´e_ts
)

223 
loÿl
 
diff
 = 
ffi
.
	`ÿ¡
(
INT64_T
, 
po¡_ts
[0] - 
´e_ts
[0])

225 
diff
 < 
TIME_THRESH
 
th’


226 
log
:
	`w¬n
("Got†atency smallerhan definedhresh value")

227 
log
:
	`w¬n
("P»: " .. 
	`to¡ršg
(
´e_ts
[0]è.. ";…o¡: " .. 
	$to¡ršg
(
po¡_ts
[0]))

228 
log
:
	`w¬n
("Difã»nû: " .. 
	`to¡ršg
(
diff
è.. ",h»sh: " .. 
	$to¡ršg
(
TIME_THRESH
))

230 
C
.
	$hs_upd©e
(
diff
)

231 
’d


233 -- 
d–‘e
 
assocŸ‹d
 
d©a


234 
tbbm­
:
	$”a£
(
acc
)

236 
acc
:
	$»Ëa£
()

237 
bËSize
 =ableSize - 1

239 
mis£s
 = misses + 1

240 
’d


242  
mis£s
, 
Ï¡H™
, 
bËSize


243 
’d


246 --- 
CÜe
 
loİ
 
of
 
the
 
´og¿m


248 -- @
·¿m
 
¬gs
, 
¬gum’ts
. 
S“
 
po¡
-
´oûssšg
.
lua
 
d‘as
 
Ú
‡rguments

249 -- @
·¿m
 
PRE
, 
f’ame
 
of
 
the
 
pÿp
 
fe
 
´e
-
DuT
 
m—su»m’ts


250 -- @
·¿m
 
POST
, 
f’ame
 
of
 
the
 
pÿp
 
fe
 
po¡
-
DuT
 
m—su»m’ts


251 
funùiÚ
 
	`tbbCÜe
(
¬gs
, 
PRE
, 
POST
)

252 -- 
š™Ÿlize
 
sü©ch·d
 
ªd
 
mbufs


253 
	$£tUp
()

254 
C
.
	$hs_š™Ÿlize
(
¬gs
.
Äbuck‘s
)

255 
loÿl
 
keyBuf
, 
tsBuf
 = 
	$š™HashM­
()

257 
loÿl
 
Ï¡H™
 = 0

258 
loÿl
 
bËSize
 = 0

259 
loÿl
 
·ck‘s
 = 0

261 
log
:
	`šfo
("finished init")

263 
loÿl
 
´”—d”
, 
po¡»ad”
 = 
	$š™R—d”
(
PRE
, 
POST
)

264 
loÿl
 
´eÿp
 = 
	$»adSšgË
(
´”—d”
)

265 
log
:
	`šfo
("initialized„eader")

267 -- 
´eflšg


268 
loÿl
 
ùr
 = 
TABLE_TARGET_SIZE


269 
´eÿp
 
ªd
 
ùr
 > 0 do

270 
	$addKeyV®
(
´eÿp
, 
keyBuf
, 
tsBuf
)

271 
bËSize
 =ableSize + 1

272 -- 
log
:
	`šfo
("added key")

273 
	`sä“
(
´eÿp
)

274 -- 
log
:
	`šfo
("freeing")

275 
´eÿp
 = 
	$»adSšgË
(
´”—d”
)

276 
ùr
 = ctr - 1

277 
·ck‘s
 =…ackets + 1

278 
’d


281 
loÿl
 
po¡ÿp
 = 
	$»adSšgË
(
po¡»ad”
)

282 
loÿl
 
mis£s
 = 0

283 
loÿl
 
Œash
 = 0

284 -- 
m­
 
is
 
now
 
hÙ


285 
´eÿp
 
ªd
 
po¡ÿp
 do

286 
	$addKeyV®
(
´eÿp
, 
keyBuf
, 
tsBuf
)

287 
bËSize
 =ableSize + 1

288 
	$sä“
(
´eÿp
)

289 
´eÿp
 = 
	`»adSšgË
(
´”—d”
)

291 -- 
now
 
Œy
 
m©ch


292 
mis£s
, 
Ï¡H™
, 
bËSize
 = 
	$g‘KeyV®
(
po¡ÿp
, 
mis£s
, 
keyBuf
, 
tsBuf
, 
Ï¡H™
, 
bËSize
)

293 
	$sä“
(
po¡ÿp
)

294 
po¡ÿp
 = 
	`»adSšgË
(
po¡»ad”
)

296 -- 
»move
 
Şd
 
v®ues
 
bË
 
is
 
too
 
big


297 
bËSize
 = 
	$checkCËª
(
Ï¡H™
, 
bËSize
)

299 
·ck‘s
 =…ackets + 2

300 
’d


302 -- 
´oûss
 
Ëáov”s


303 
po¡ÿp
 do

304 
mis£s
, 
Ï¡H™
, 
bËSize
 = 
	$g‘KeyV®
(
po¡ÿp
, 
mis£s
, 
keyBuf
, 
tsBuf
, 
Ï¡H™
, 
bËSize
)

305 
	$sä“
(
po¡ÿp
)

306 
po¡ÿp
 = 
	$»adSšgË
(
po¡»ad”
)

308 
·ck‘s
 =…ackets + 1

309 
’d


312 
´”—d”
:
	$şo£
()

313 
po¡»ad”
:
	`şo£
()

315 -- 
ä“
 
sü©ch·d


316 
	$‹¬Down
()

318 
C
.
	$hs_fš®ize
()

320 
log
:
	`šfo
("M—n: " .. 
C
.
	`hs_g‘M—n
(è.. " [ns], V¬Ÿnû: " .. C.
	`hs_g‘V¬Ÿnû
() .. " [ns]\n")

322 
log
:
	`šfo
("Mis£s: " .. 
mis£s
)

323 
C
.
	`hs_wr™e
(
¬gs
.
ouut
 .. ".csv")

324 
C
.
	$hs_de¡roy
()

326  
·ck‘s


327 
’d


330 --- 
Check
 
cu¼’t
 
bË
 
size
 
ªd
 
Œy
 
to
 
d–‘e
 
Şd
 
’Œ›s
 siz
exûeded
 
th»shŞd


332 -- @
·¿m
 
Ï¡Hi¡
, 
the
 
time¡amp
 
of
h
Ï¡
 
sucûssful
 
m©chšg
 
İ”©iÚ


333 -- @
·¿m
 
bËSize
, 
the
 
cu¼’t
 
numb”
 
of
 
’Œ›s
 
š
h
bË


334 
funùiÚ
 
	$checkCËª
(
Ï¡H™
, 
bËSize
)

335 
bËSize
 > 
TABLE_TARGET_SIZE
 + 
TABLE_THRESH_SIZE
 
th’


336 
log
:
	`šfo
("Cleaning: ")

337 
loÿl
 
ş—Ãd
 = 
tbbm­
:
	`ş—n
(
m©h
.
	`max
(
Ï¡H™
 - 
DELETION_THRESH
, 0))

338 
bËSize
 =abËSiz- 
ş—Ãd


339 
log
:
	`šfo
("Finished cleaning")

340 
ş—Ãd
 =ğ0 
th’


341 
TABLE_THRESH_SIZE
 = TABLE_THRESH_SIZE * 1.4

342 
’d


343 
’d


344  
bËSize


345 
’d


348 --- 
Wr™e
 
up
 
to
 
¿nge
 
’Œ›s
 
äom
 
the
 
pÿp
 
fe
 
as
 
humª
 
»adabË
 
csv
 file

350 -- @
·¿m
 
šfe
, 
Çme
 
of
 
the
 
pÿp
 
fe


351 -- @
·¿m
 
outfe
, 
Çme
 
of
 
the
 
csv
 
fe
 
to
 
wr™e
o

352 -- @
·¿m
 
¿nge
, 
wr™es
 
up
 
to
„ªg
	$’Œ›s
 (
´ovided
 
th”e
 
¬e
 
’ough
 
’Œ›s
)

353 
funùiÚ
 
	$wr™ePCAPasText
(
šfe
, 
outfe
, 
¿nge
)

354 
	$£tUp
()

355 
loÿl
 
»ad”
 = 
pÿp
:
	$ÃwR—d”
(
šfe
)

356 
loÿl
 
ÿp
 = 
	$»adSšgË
(
»ad”
)

358 
loÿl
 
keyBuf
 = 
	`ü—‹By‹s
(
SCR_SIZE
)

360 -- 8 
by‹
 
time¡amps


361 
loÿl
 
tsBuf
 = 
	$ü—‹By‹s
(8)

362 
tsBuf
 = 
ffi
.
	`ÿ¡
(ffi.
	`ty³of
("uint64_t *"),sBuf)

365 
loÿl
 
‹xtf
 = 
io
.
	`İ’
(
outfe
, "w")

367 
i
 = 0, 
¿nge
 do

368 
loÿl
 
pkt
 = 
ÿp
:
	$g‘UdpPack‘
()

369 
	$exŒaùD©a
(
ÿp
, 
keyBuf
, 
tsBuf
)

371 
‹xtf
:
	`wr™e
(
	`to¡ršg
(
pkt
.
·ylßd
.
ušt32
[0]è.. ", " ..o¡ršg(
tsBuf
[0]), "\n")

372 
	$sä“
(
ÿp
)

373 
ÿp
 = 
	$»adSšgË
(
»ad”
)

375 
ÿp
 =ğ
n
 
th’
  
’d


376 
’d


378 
»ad”
:
	$şo£
()

379 
io
.
	$şo£
(
‹xtf
)

381 
	$‹¬Down
()

382 
’d


384  
mod


	@/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/test-dev.lua

1 --- 
FÜw¬d
 
·ck‘s
 
b‘w“n
 
two
 
pÜts


2 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
¡©s
 = 
»quœe
 "stats"

5 
loÿl
 
log
 = 
»quœe
 "log"

6 
loÿl
 
memÜy
 = 
»quœe
 "memory"

8 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

9 
·r£r
:
	`¬gum’t
("dev", "Deviû tØu£, s³cifyh§mdeviûwiûØechØ·ck‘s."):
	$¬gs
(2):
	$cÚv”t
(
tÚumb”
)

10 
·r£r
:
	`İtiÚ
("-ˆ--th»ads", "Numb” oàth»ad ³¸fÜw¬dšg dœeùiÚ usšg RSS."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1)

11  
·r£r
:
	$·r£
()

12 
’d


14 
funùiÚ
 
	`ma¡”
(
¬gs
)

15 -- 
cÚfigu»
 
deviûs


16 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

17 
¬gs
.
dev
[
i
] = 
deviû
.
cÚfig
{

18 
pÜt
 = 
dev
,

19 
txQueues
 = 
¬gs
.
th»ads
,

20 
rxQueues
 = 
¬gs
.
th»ads
,

21 
rssQueues
 = 
¬gs
.
th»ads


22 
	}
}

23 
’d


24 
	gdeviû
.
wa™FÜLšks
()

26 -- 
´št
 
¡©s


27 
	g¡©s
.
	g¡¬tStsTask
{
	gdeviûs
 = 
¬gs
.
dev
}

29 -- 
¡¬t
 
fÜw¬dšg
 
sks


30 
	gi
 = 1, 
	g¬gs
.
th»ads
 do

31 
	glm
.
¡¬tTask
("fÜw¬d", 
¬gs
.
dev
[1]:
g‘RxQueue
(
i
 - 1),‡rgs.dev[2]:
g‘TxQueue
(i - 1))

32 -- 
bidœeùiÚ®
 
fow¬dšg
 
Úly
 
two
 
difã»Á
 
deviûs
 
wh”e
 
·s£d


33 
¬gs
.
dev
[1] ~ğ¬gs.dev[2] 
th’


34 
lm
.
¡¬tTask
("fÜw¬d", 
¬gs
.
dev
[2]:
g‘RxQueue
(
i
 - 1),‡rgs.dev[1]:
g‘TxQueue
(i - 1))

35 
’d


36 
’d


37 
lm
.
	$wa™FÜTasks
()

38 
’d


40 
funùiÚ
 
	`fÜw¬d
(
rxQueue
, 
txQueue
)

41 -- 
a
 
bufA¼ay
 
is
 
ju¡
‡ 
li¡
 
of
 
bufãrs
 
th©
 
we
 
wl
 
u£
 
b©ched
 
fÜw¬dšg


42 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

43 
lm
.
	$ruÂšg
(èdØ-- 
check
 
CŒl
+
c
 
was
 
´es£d


44 -- 
»ûive
 
Úe
 
Ü
 
mÜe
 
·ck‘s
 
äom
 
the
 
queue


45 
loÿl
 
couÁ
 = 
rxQueue
:
	`»cv
(
bufs
)

46 -- 
£nd
 
out
 
®l
 
»ûived
 
bufs
 
Ú
 
the
 
Ùh”
 
queue


47 -- 
the
 
bufs
 
¬e
 
ä“
'd implicitly byhis function

48 
txQueue
:
	$£ndN
(
bufs
, 
couÁ
)

49 
’d


50 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/traffic-gen.lua

1 --- 
G’”©es
 
MoÚSniff
 
	gŒaffic
, 
	gi
.
	ge
. 
·ck‘s
 
cÚš
 
ª
 
id’tif›r
 
ªd
 
a
 
fixed
 
b™
 
	g·‰”n


2 --- 
Live
 
mode
 
ªd
 
MSCAP
 mod
»quœe
 
this
 
ty³
 
of
 
Œaffic


4 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

5 
loÿl
 
deviû
 = 
»quœe
 "device"

6 
loÿl
 
memÜy
 = 
»quœe
 "memory"

7 
loÿl
 
ts
 = 
»quœe
 "timestamping"

8 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

9 
loÿl
 
tim”
 = 
»quœe
 "timer"

10 
loÿl
 
log
 = 
»quœe
 "log"

11 
loÿl
 
¡©s
 = 
»quœe
 "stats"

12 
loÿl
 
b™
 = 
»quœe
 "bit"

14 
loÿl
 
PKT_LEN
 = 100 -- 
š
 
by‹


15 
loÿl
 
MS_TYPE
 = 0b01010101

16 
loÿl
 
bªd
 = 
b™
.band

18 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

19 
·r£r
:
	`desütiÚ
("Generateraffic which can be used by moonsniffoƒstablish†atencies induced by‡ device underest.")

20 
·r£r
:
	`¬gum’t
("dev", "Deviû tØu£."):
	$¬gs
(2):
	$cÚv”t
(
tÚumb”
)

21 
·r£r
:
	`İtiÚ
("-ˆ--time", "D‘”mše how†Úg…ack‘ wÈb£nd iÀ£cÚds."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(10)

22 
·r£r
:
	`İtiÚ
("-¸--¿‹", "Aµroxim©£nd„©š mb™/s. DutØIFGƒtc.„©Úhwœmay bhigh”."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1000)

23  
·r£r
:
	$·r£
()

24 
’d


26 
funùiÚ
 
	$ma¡”
(
¬gs
)

27 
¬gs
.
dev
[1] = 
deviû
.
cÚfig
 { 
pÜt
 =‡rgs.dev[1], 
txQueues
 = 1 
	}
}

28 
	g¬gs
.
	gdev
[2] = 
deviû
.
cÚfig
 { 
pÜt
 = 
¬gs
.
dev
[2], 
	grxQueues
 = 1 }

29 
	gdeviû
.
	$wa™FÜLšks
()

30 
loÿl
 
dev0tx
 = 
¬gs
.
dev
[1]:
	$g‘TxQueue
(0)

31 
loÿl
 
dev1rx
 = 
¬gs
.
dev
[2]:
	$g‘RxQueue
(0)

33 
¡©s
.
¡¬tStsTask
 { 
txDeviûs
 = { 
¬gs
.
dev
[1] }, 
rxDeviûs
 = {‡rgs.dev[2] } 
	}
}

35 
loÿl
 
	g£nd”0
 = 
lm
.
¡¬tTask
("g’”©eT¿ffic", 
dev0tx
, 
¬gs
)

37 
	g£nd”0
:
	$wa™
()

38 
lm
.
	$¡İ
()

39 
lm
.
	$wa™FÜTasks
()

40 
’d


42 
funùiÚ
 
	$g’”©eT¿ffic
(
queue
, 
¬gs
)

43 
log
:
	`šfo
("Tryingoƒnable„ximestamping of‡ll…ackets,his isn't supported by most‚ics")

44 
loÿl
 
pkt_id
 = 0

45 
loÿl
 
ruÁime
 = 
tim”
:
	$Ãw
(
¬gs
.
time
)

46 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

47 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

48 
buf
:
	$g‘UdpPack‘
():
fl
 {

49 
pktL’gth
 = 
PKT_LEN
;

50 
	}
}

51 
	g’d
)

52 
loÿl
 
	gbufs
 = 
mempoŞ
:
	$bufA¼ay
()

53 
lm
.
	$ruÂšg
(è
th’


54 
lm
.
	$¦“pMlis
(500)

55 
’d


56 
log
:
	`šfo
("TryšgØg’”©~" .. 
¬gs
.
¿‹
 .. " Mbit/s")

57 
queue
:
	$£tR©e
(
¬gs
.
¿‹
)

58 
loÿl
 
ruÁime
 = 
tim”
:
	$Ãw
(
¬gs
.
time
)

59 
lm
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

60 
bufs
:
	$®loc
(
PKT_LEN
)

62 
i
, 
buf
 
š
 
	$aœs
(
bufs
) do

63 
loÿl
 
pkt
 = 
buf
:
	`g‘UdpPack‘
()

64 -- 
£‰”s
 
to
 
wÜk
 
cÜ»ùly
, 
the
 
numb”
 
is
 
nÙ
 
®lowed
Ø
exûed
 16 
b™


65 
pkt
.
4
:
	`£tID
(
	$bªd
(
pkt_id
, 0xFFFF))

66 
pkt
.
·ylßd
.
ušt32
[0] = 
pkt_id


67 
pkt
.
·ylßd
.
ušt8
[4] = 
MS_TYPE


68 
pkt_id
 =…kt_id + 1

69 
’d


71 
queue
:
	$£nd
(
bufs
)

72 
’d


73 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/netronome-packetgen/packetgen.lua

3 
Cİyright
 (
C
è2016 
N‘rÚome
 
Sy¡ems
, 
Inc
. 
AÎ
 
rights
 
»£rved
.

5 
DesütiÚ
 : 
G’”©es
 
a
 
bur¡y
 
Œaffic
 
·‰”n
 
usšg
 
the
 
ruËs
 
¥ecif›d


6 
b–ow
.

8 -- 
AÎ
 
·ck‘s
 
g’”©ed
 
wl
 
sh¬e
 
the
 
§me
 
sourû
 
IP
, sourû 
MAC
 
ªd
 
size


9 
´ofe
 (
fixed
 
Ü
 
IMIX
).

10 -- 
The
 
de¡š©iÚ
 
IP
 
ªd
 
MAC
 
¬e
 
£Ëùed
 
£qu’tŸÎy
 
š
 
the
 
fŞlowšg


11 
·‰”n
:

13 
a
è
The
 
¡»am
 
numb”
 
is
 
£t
 
to
 0.

14 
b
è
The
 
¡»am
 
ba£
 
is
 
ÿlcuÏ‹d
 
by
 
muÉlyšg
 
the
 sŒ—m 
numb”
 
w™h
he

15 
MAC
 
ªd
 
IP
 
¡ride
.

16 
c
è
The
 
bur¡
 
numb”
 
is
 
£t
 
to
 0.

17 
d
è
The
 
æow
 
numb”
 
is
 
£t
 
to
 0.

18 
e
è
A
 
·ck‘
 
is
 
g’”©ed
 
w™h
 
the
 
de¡š©iÚ
 
IP
 
ªd
 
MAC
 
£t
 
to
 "stream

19 
ba£
" + "
æow
 
numb”
".

20 
f
è
The
 
æow
 
numb”
 
is
 
šü—£d
, 
™
 i 
Ëss
 
thª
 
the
‚umb” 
of
 
æows
 
³r


21 
¡»am
, 
loİ
 
back
 
to
 (
e
), Ø(
g
).

22 
g
è
The
 
bur¡
 
numb”
 
is
 
šü—£d
, 
™
 i 
Ëss
 
thª
 
the
‚umb” 
of
 
bur¡s


23 
³r
 
¡»am
, 
loİ
 
back
 
to
 (
d
), Ø(
h
).

24 
h
è
The
 
¡»am
 
ba£
 
is
 
šüem’‹d
, 
™
 i 
Ëss
 
thª
 
the
 
numb”
 
of
 
¡»ams
,

25 
loİ
 
back
 
to
 (
a
).

27 -- 
This
 
»suÉs
 
š
 
a
 
£t
 
of
 
¡»ams
 
th©
 
¬e
 
£·¿‹d
 
by
 
the
 
MAC
 
ªd
 
IP


28 
¡ride
 
ªd
 
»³©
 
š
 
bur¡s
. 
The
 
de¡š©iÚ
 
IP
‡nd 
MAC
 
šü—£
 in

29 
lock
-
¡•
.

30 -- 
Pack‘
 
size
 
ÿn
 
be
 
cÚ¡ªt
, 
Ü
 
£Ëùed
 
äom
 
a
 7:4:1 
IMIX
 
´ofe
 
w™h


31 
·ck‘
 
sizes
 1514, 570, 
ªd
 64, 
»¥eùiv–y
.

34 
loÿl
 
	glibmoÚ
 = 
»quœe
 "libmoon"

35 
loÿl
 
mg
 = 
»quœe
 "moongen"

36 
loÿl
 
moÚg’
 = 
»quœe
 "dpdk"

37 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

38 
loÿl
 
memÜy
 = 
»quœe
 "memory"

39 
loÿl
 
deviû
 = 
»quœe
 "device"

40 
loÿl
 
ffi
 = 
»quœe
 "ffi"

41 
loÿl
 
log
 = 
»quœe
 "log"

42 
loÿl
 
b™
 = 
»quœe
 "bit"

44 
loÿl
 
lshiá
 , 
	grshiá
 , 
	gbªd
 , 
	gbsw­
 , 
	gbÜ
 , 
	grÜ
 =

45 
b™
.
lshiá
, 
	gb™
.
	grshiá
, b™.
	gbªd
, b™.
	gbsw­
 , b™.
	gbÜ
, b™.
	grÜ


48 -- 
TabË
 
RX
 
	g¡©s
:

50 -- 
by‹s
 : 
TÙ®
 
numb”
 
of
 by‹ 
»ûived
.

51 -- 
´evBy‹s
 : 
Numb”
 
of
 
by‹s
 
»ûived
 
©
 
the
 
´evious
 
™”©iÚ
.

52 -- 
·ck‘s
 : 
TÙ®
 
numb”
 
of
…ack‘ 
»ûived
.

53 -- 
´evPack‘s
 : 
Numb”
 
of
 
·ck‘s
 
»ûived
 
©
 
the
 
´evious
 
™”©iÚ
.

54 -- 
drİ³d
 : 
Numb”
 
of
 
»ûived
 
·ck‘s
 
which
 
have
 
b“n
 dropped.

55 -- 
t¡ampPack‘s
 : 
Numb”
 
of
 
»ûived
 
·ck‘s
 
w™h
 
a
 
time¡amp
.

56 -- 
m—nL©’cy
 : 
M—n
 
Ï‹ncy
 
of
 
»ûived
 
·ck‘s
 
w™h
 
time¡amps
.

57 -- 
–­£dTime
 : 
Time
 
–­£d
 
sšû
 
the
 
¡¬t
 
of
h
run
.

58 -- 
d–Time
 : 
Time
 
sšû
 
the
 
Ï¡
 
™”©iÚ
.

60 
loÿl
 
¡©sRx
 = {

61 
by‹s
 = 0,

62 
	g´evBy‹s
 = 0,

63 
	g·ck‘s
 = 0,

64 
	g´evPack‘s
 = 0,

65 
	gdrİ³d
 = 0,

66 
	gt¡ampPack‘s
 = 0,

67 
	gm—nL©’cy
 = 0,

68 
	g–­£dTime
 = 0,

69 
	gd–Time
 = 0

73 -- 
TabË
 
TX
 
	g¡©s
:

75 -- 
by‹s
 : 
TÙ®
 
numb”
 
of
 by‹ 
£Á
.

76 -- 
´evBy‹s
 : 
Numb”
 
of
 
by‹s
 
£Á
 
©
 
the
 
´evious
 
™”©iÚ
.

77 -- 
·ck‘s
 : 
TÙ®
 
numb”
 
of
…ack‘ 
£Á
.

78 -- 
´evPack‘s
 : 
Numb”
 
of
 
·ck‘s
 
£Á
 
©
 
the
 
´evious
 
™”©iÚ
.

79 -- 
bur¡s
 : 
Numb”
 
of
 bur¡ 
£Á
.

80 -- : 
Numb”
 
of
 
g’”©ed
 
by
 
nÙ
 
£Á
 
·ck‘s
.

81 -- 
–­£dTime
 : 
Time
 
–­£d
 
sšû
 
the
 
¡¬t
 
of
h
run
.

82 -- 
d–Time
 : 
Time
 
sšû
 
the
 
Ï¡
 
™”©iÚ
.

84 
loÿl
 
¡©sTx
 = {

85 
by‹s
 = 0,

86 
	g´evBy‹s
 = 0,

87 
	g·ck‘s
 = 0,

88 
	g´evPack‘s
 = 0,

89 
	gbur¡s
 = 0,

91 
	g–­£dTime
 = 0,

92 
	gd–Time
 = 0

96 -- 
TabË
 
commªd
 
lše
 
cÚfigu¿tiÚ
 
	g·¿m‘”s
, 
the
 
fŞlowšg
 
¬e
 
	gİtiÚs
:

98 -- 
rxSÏvePÜts
 : 
PÜts
 
to
 
u£
 
the
 
RX
 
¦aves
.

99 -- 
txSÏvePÜts
 : 
PÜts
 
to
 
u£
 
the
 
TX
 
¦aves
.

100 -- 
rxDescs
 : 
Numb”
 
of
 
RX
 
desütÜs
.

101 -- 
txDescs
 : 
Numb”
 
of
 
TX
 
desütÜs
.

102 -- 
numb”OfSŒ—ms
 : 
Numb”
 
of
 
¡»ams
 
to
 
ü—‹
.

103 -- 
æowsP”SŒ—m
 : 
The
 
numb”
 
of
 
æows
 
š
 
—ch
 oà
the
 
¡»ams
.

104 -- 
bur¡sP”SŒ—m
 : 
The
 
numb”
 
of
 
bur¡s
 
to
 
£nd
 
—ch
 
¡»am
.

105 -- 
tÙ®Flows
 : 
The
 
tÙÏ
 
numb”
 
of
 
æows
 
to
 
g’”©e
.

106 -- 
·¿mDi¥Ïy
 : 
The
 
numb”
 
of
 
mli£cÚds
 
to
 
di¥Ïy
 
the
 
·¿m‘”s
 .

107 -- 
¡©sDi¥Ïy
 : 
The
 
amouÁ
 
of
 
time
 
b‘w“n
 
—ch
 
deviû
 
¡©s
 
di¥Ïy
.

108 -- 
txD–
 : 
AmouÁ
 
of
 
time
 
to
 
·ss
 
befÜe
 
£ndšg
 
a
 
bur¡
.

109 -- 
·ck‘Size
 : 
The
 
size
 
of
 
—ch
 
·ck‘
, 
š
 
	gby‹s
.

110 -- 
	gmu¡Imix
 : 
If
 
IMIXšg
 
mu¡
 
be
 
u£d
 
to
 
d‘”mše
 
·ck‘
 
sizes
.

111 -- 
™”©iÚs
 : 
Numb”
 
of
 i‹¿tiÚ 
to
 
run
 .

112 -- 
timeout
 : 
Numb”
 
of
 
£cÚds
 
to
 
run
 .

113 -- 
f•»fix
 : 
The
 
´efix
 
of
 
the
 
fe
 
to
 
wr™e
o.

114 -- 
wr™emode
 : 
Wr™e
 
mode
: 0-
off
, 1-
	g´št
, 1-
	gglob®fe
, 2-
	g³rcÜefe


115 -- 
	g»¡
 : 
P¬am‘”s
 
u£d
 
to
 
g’”©e
 
the
 
Œaffic
 
·‰”n
.

117 
loÿl
 
şP¬ams
 = {

118 
rxSÏvePÜts
 = {} ,

119 
	gtxSÏvePÜts
 = {} ,

120 
	grxDescs
 = 1024 ,

121 
	gtxDescs
 = 1024 ,

122 
	gnumb”OfSŒ—ms
 = 1 ,

123 
	gæowsP”SŒ—m
 = 2047 ,

124 
	gbur¡sP”SŒ—m
 = 1 ,

125 
	gtÙ®Flows
 = 0 ,

126 
	g·¿mDi¥Ïy
 = 3000 ,

127 
	g¡©sDi¥Ïy
 = 1000 ,

128 
	gtxD–
 = 0 ,

129 
	g·ck‘Size
 = 64 ,

130 
	gmu¡Imix
 = 
çl£
 ,

131 
	g™”©iÚs
 = 0 ,

132 
	gtimeout
 = 0 ,

133 
	gf•»fix
 = "" ,

134 
	gwr™emode
 = 1 ,

135 
	g¤cMacBa£
 = 0x021100000000 ,

136 
	gd¡MacBa£
 = 0x022200000000 ,

137 
	g¤cIpBa£
 = 3232238337 ,

138 
	gd¡IpBa£
 = 3232241153 ,

139 
	g¤cPÜtBa£
 = 50110 ,

140 
	gd¡PÜtBa£
 = 50220 ,

141 
	g¤cPÜtV¬y
 = 1 ,

142 
	gd¡PÜtV¬y
 = 0 ,

143 
	g¤cIpV¬y
 = 0 ,

144 
	gd¡IpV¬y
 = 1 ,

145 
	g¤cMacV¬y
 = 0 ,

146 
	gd¡MacV¬y
 = 1 ,

147 
	g¤cPÜtSŒide
 = 0 ,

148 
	gd¡PÜtSŒide
 = 0 ,

149 
	g¤cIpSŒide
 = 0 ,

150 
	gd¡IpSŒide
 = 0 ,

151 
	g¤cMacSŒide
 = 0 ,

152 
	gd¡MacSŒide
 = 0

156 -- 
Defšes
 
·¿m‘”s
 
timšg
 
	gfunùiÚ®™y
.

158 -- 
	g´evtsc
 : 
The
 
´evious
 
şock
 
couÁ
.

159 -- 
cu¼tsc
 : 
The
 
cu¼’t
 
şock
 
couÁ
.

160 -- 
difásc
 : 
The
 
difã»nû
 
b‘w“n
 
the
 
şock
 
couÁs
.

162 
loÿl
 
timeP¬ams
 = {

163 
´evtsc
 = 0 ,

164 
	gcu¼tsc
 = 0 ,

165 
	gdifásc
 = 0

169 -- 
TabË
 
	gcÚ¡ªts
:

171 -- 
maxSÏvePÜt
 : 
Maximum
 
pÜt
 
numb”
 
a
 
¦ave
 
may
 
u£
.

172 -- 
maxSÏves
 : 
Maximum
 
numb”
 
of
 
tÙ®
 
¦aves
 (
lim™ed
 
by
 
cÜes
).

173 -- 
maxFlowsP”SŒ—m
 : 
Maximum
 
numb”
 
of
 
æows
 
³r
 
¡»am
.

174 -- 
maxPack‘Size
 : 
Maximum
 
size
 
of
 
a
 
·ck‘
.

175 -- 
rxBur¡Size
 : 
The
 
size
 
of
 
—ch
 oà
the
 
RX
 
bur¡
.

176 -- 
txBur¡Size
 : 
The
 
size
 
of
 
—ch
 oà
the
 
TX
 
bur¡s
.

177 -- 
»ûiveTimeout
 : 
Time
 
to
 
Œy
 
»ûive
 
ms
)

178 -- 
‘hH—d”L’gth
 : 
Numb”
 
of
 
by‹s
 
š
 
‘h”Ãt
 
h—d”
.

179 -- 
H—d”L’gth
 : 
Numb”
 
of
 
by‹s
 
š
 

 
h—d”
.

180 -- 
udpH—d”L’gth
 : 
Numb”
 
of
 
by‹s
 
š
 
udp
 
h—d”


181 -- 
‘hTy³Ipv4
 : 
Ty³
 
code
 
‘h”Ãt
 
v4
.

182 -- 
´štTimePassPút
 : % 
of
 
´št
 
time
 
which
 
mu¡
 
·ss
 
sšû
 
Ï¡
…rint.

183 -- 
deçuÉPaylßd
 : 
DeçuÉ
 
·ylßd
 
to
 
u£
 
·ck‘s
.

185 
cÚ¡ªts
 = {

186 
maxSÏvePÜt
 = 32 ,

187 
	gmaxSÏves
 = 32 ,

188 
	gmaxFlowsP”SŒ—m
 = 2047 ,

189 
	gmaxPack‘Size
 = 64 ,

190 
	gmaxPack‘Size
 = 1522 ,

191 
	grxBur¡Size
 = 128 ,

192 
	gtxBur¡Size
 = 32 ,

193 
	g»ûiveTimeout
 = 100 ,

194 
	g‘hH—d”L’gth
 = 14 ,

195 
	gH—d”L’gth
 = 20 ,

196 
	gudpH—d”L’gth
 = 8 ,

197 
	g‘hTy³Ipv4
 = 0x0800,

198 
	g´štTimePassPút
 = 0.8 ,

199 
	gdeçuÉPaylßd
 = "\x01\x02 MoonGen Payload"

202 -- 
S¹
 
time
 
of
 
the
 
	g­¶iùiÚ
. 
This
 
is
 
u£d
 
to
 
	gsync


203 -- 
the
 
´štšg
 
ªd
 
loggšg
 
acüoss
h
	g¦aves
.

204 
loÿl
 
	gglob®S¹Time
 = 
mg
.
g‘Time
()

207 -- 
Ma¡”
 
funùiÚ
 
to
 dØ
the
 
¦ave
 
£tup
 
ªd
 
švoke
h¦av
š¡ªûs
.

209 
funùiÚ
 
	$ma¡”
(...)

210 
loÿl
  = 
	$·r£Args
(
şP¬ams
, ...)

211  =ğ
çl£
 
th’


212 
os
.
	$ex™
()

213 
’d


215 
loÿl
 
tÙ®SÏves
 = #şP¬ams.
rxSÏvePÜts
 + #şP¬ams.
txSÏvePÜts


216 
tÙ®SÏves
 =ğ0 
th’


217 
	`´št
("No slaves„equested. Packetgen will‚owƒxit.")

218 
os
.
	$ex™
()

219 
’d


220 
tÙ®SÏves
 > 
cÚ¡ªts
.
maxSÏves
 
th’


221 
	`´št
(
¡ršg
.
	`fÜm©
("Too many slaves„equested:\n %u„equested, " ..

223 
tÙ®SÏves
, 
cÚ¡ªts
.
maxSÏves
)

225 
’d


227 -- 
C»©e
 
a
 
li¡
 
of
 
pÜts
,  
to
 
the
 
tx
…orts:

228 
loÿl
 
pÜtLi¡
 = 
	`d“pCİy
(
şP¬ams
.
txSÏvePÜts
)

230 -- 
Check
 
which
 
of
 
the
 
rx
 
pÜts
 
w”e
 
®»ady
 
added
 
as
 
tx
…orts,

231 -- 
ªd
 
add
 
ªy
 
of
 
the
 
rx
 
pÜts
 
which
 
¬e
 
nÙ
 
®»ady
 
š
h
li¡
:

232 
i
, 
rxPÜtId
 
š
 
	$aœs
(
şP¬ams
.
rxSÏvePÜts
) do

233 
loÿl
 
ÿnAdd
 = 
Œue


234 
_
, 
pÜtId
 
š
 
	$aœs
(
pÜtLi¡
) do

235 
rxPÜtId
 =ğ
pÜtId
 
th’


236 
ÿnAdd
 = 
çl£


238 
’d


239 
’d


240 
ÿnAdd
 
th’


241 
pÜtLi¡
[#pÜtLi¡ + 1] = 
rxPÜtId


242 
’d


243 
’d


245 -- 
TabË
 
of
 
MoÚG’
 
deviûs
:

246 
loÿl
 
deviûs
 = {
	}
}

247 -- 
CÚfigu»
 
the
 
deviûs
:

248 
_
, 
pÜt
 
š
 
	$aœs
(
pÜtLi¡
) do

249 
loÿl
 
deviûIdx
 = #devices + 1

250 
deviûs
[
deviûIdx
] = 
deviû
.
cÚfig
{

251 
pÜt
 =…ort ,

252 
rxQueues
 = 1 , -- 
OÆy
 1 
suµÜ‹d
 
now
.

253 
txQueues
 = 1 , -- 
OÆy
 1 
suµÜ‹d
 
now
.

254 
rxDescs
 = 
şP¬ams
.rxDescs,

255 
txDescs
 = 
şP¬ams
.txDescs

256 
	}
}

257 
	g’d


259 -- 
If
 
wr™šg
 
	gglob®ly
, 
wr™e
 
the
 
h—d”
 th
glob®
 
	gfe
:

260 
şP¬ams
.
wr™emode
 =ğ2 
th’


261 
wr™eStsH—d”
(
şP¬ams
.
f•»fix
 .. ".txt")

262 
’d


264 -- 
Di¥Ïy
 
the
 
·¿m‘”s
:

265 
şP¬ams
:
	$´št
()

266 
mg
.
	$¦“pMlis
(
şP¬ams
.
·¿mDi¥Ïy
)

268 
loÿl
 
¦aveId
 = 0

269 -- 
Launch
 
the
 
¦aves
:

270 
i
, 
pÜtId
 
š
 
	$aœs
(
pÜtLi¡
) do

271 -- 
Check
 
the
 
pÜt
 
mu¡
 
be
 
u£d
 
as
 
a
 
TX
 
¦ave
:

272 
_
, 
txPÜtId
 
š
 
	$aœs
(
şP¬ams
.
txSÏvePÜts
) do

273 
txPÜtId
 =ğ
pÜtId
 
th’


274 
libmoÚ
.
	`¡¬tTask
("txSÏve", 
deviûs
[
i
], 
pÜtId
, 
¦aveId
, 
şP¬ams
)

275 
¦aveId
 = slaveId + 1

277 
’d


278 
’d


279 -- 
Check
 
the
 
pÜt
 
mu¡
 
be
 
u£d
 
as
 
a
 
RX
 
¦ave
:

280 
_
, 
rxPÜtId
 
š
 
	$aœs
(
şP¬ams
.
rxSÏvePÜts
) do

281 
rxPÜtId
 =ğ
pÜtId
 
th’


282 
libmoÚ
.
	`¡¬tTask
("rxSÏve", 
deviûs
[
i
], 
pÜtId
, 
¦aveId
, 
şP¬ams
)

283 
¦aveId
 = slaveId + 1

285 
’d


286 
’d


287 
’d


289 
mg
.
	$wa™FÜTasks
()

290 
’d


292 ---- 
RX
 
FunùiÚ®™y
 ---------------------------------------------------------

295 -- 
SÏve
 
funùiÚ
 
to
 
³rfÜm
 
RX
.

296 -- 
deviû
 : 
The
 
MoÚG’
 deviû 
to
 
£Á
 
the
 
·ck‘s
 
äom
.

297 -- 
pÜtId
 : 
The
 
pÜt
 
the
 
deviû
 
is
 
cÚfigu»d
 
to
 
u£
.

298 -- 
¦aveId
 : 
The
 
	$id’tif›r
 (
šdex
è
of
 
the
 
¦ave
.

299 -- 
şP¬ams
 : 
The
 
commªd
 
lše
 
·¿m‘”s
.

301 
funùiÚ
 
	$rxSÏve
(
deviû
, 
pÜtId
, 
¦aveId
, 
şP¬ams
)

302 
	`´št
(
¡ršg
.
	`fÜm©
("Launchšg RX sÏve: %u, CÜe: %u, PÜt: %u", 
¦aveId
, 
mg
:
	`g‘CÜe
(), 
pÜtId
))

304 -- 
V¬ŸbËs
 
»ûivšg
:

305 
loÿl
 
rxPack‘s
 = 0

306 
loÿl
 
rxQueue
 = 
deviû
:
	$g‘RxQueue
(0)

307 
loÿl
 
rxBur¡
 = 
memÜy
.
	$bufA¼ay
(
cÚ¡ªts
.
rxBur¡Size
)

308 
loÿl
 
Ï‹ncy
 = 0

309 
loÿl
 
ÏtD–
 = 0

311 -- 
V¬ŸbËs
 
loggšg
, 
´štšg
, 
¡İpšg
:

312 
loÿl
 
¡©e
 = "canrun"

313 
loÿl
 
¡©s
 = 
	$d“pCİy
(
¡©sRx
)

314 
loÿl
 
¡¬tTime
 = 
mg
.
	$g‘Time
()

315 
loÿl
 
Ï¡PrštTime
 = 0

316 
loÿl
 
™”©iÚ
 = 0

318 -- 
C»©e
 
the
 
f’ame
 
of
h
fe
 
to
 
wr™e
o.

319 
şP¬ams
.
wr™emode
 =ğ2 
th’


320 
outFe
 = 
şP¬ams
.
f•»fix
 .. ".txt"

321 
–£if
 
şP¬ams
.
wr™emode
 =ğ3 
th’


322 -- 
P»r
 
cÜe
 
mode
 - 
ü—‹
 
fe
 
ªd
 
wr™e
 
h—d”
:

323 
outFe
 = 
şP¬ams
.
f•»fix
 ..

324 "-c" .. 
	`to¡ršg
(
mg
:
	`g‘CÜe
()) ..

325 "-p" .. 
	`to¡ršg
(
pÜtId
) .. ".txt";

326 
	$wr™eStsH—d”
(
outFe
)

327 
’d


329 
¡©e
 =ğ"ÿÄun" 
ªd
 
mg
.
	$ruÂšg
() do

330 
rxPack‘s
 = 
rxQueue
:
	$ŒyRecv
(
rxBur¡
, 
cÚ¡ªts
.
»ûiveTimeout
)

331 
¡©s
.
·ck‘s
 = sts.·ck‘ + 
rxPack‘s


332 
¡©s
.
drİ³d
 = sts.drİ³d + 
rxPack‘s


334 
i
 = 1, 
rxPack‘s
 do

335 
¡©s
.
by‹s
 = sts.by‹ + 
rxBur¡
[
i
].
pkt_Ën


336 
Ï‹ncy
 = 
	$ÿlcuÏ‹L©’cy
(
rxBur¡
[
i
])

338 
Ï‹ncy
 ~ğ0 
th’


339 
¡©s
.
t¡ampPack‘s
 = stats.tstampPackets + 1

340 
ÏtD–
 = 
Ï‹ncy
 - 
¡©s
.
m—nL©’cy


341 
¡©s
.
m—nL©’cy
 = stats.meanLatency +

342 (
ÏtD–
 / 
¡©s
.
t¡ampPack‘s
)

343 
’d


344 
’d


345 
	`sim¶eDrİ
(
rxBur¡
)

347 -- 
Upd©e
 
‹rmš©iÚ
 
·¿ms
:

348 
™”©iÚ
 = iteration + 1

349 
¡©s
.
d–Time
 = (
mg
.
	`g‘Time
(è- 
¡¬tTime
è- sts.
–­£dTime


350 
¡©s
.
–­£dTime
 = 
mg
.
	`g‘Time
(è- 
¡¬tTime


352 -- 
If
 
´štšg
 
Ü
 
loggšg
 
mu¡
 
be
 
dÚe
:

353 
şP¬ams
.
wr™emode
 > 0 
th’


354 -- 
To
 
make
 
su»
 
th©
 
’ough
 
time
 
has
 
·s£d
 
sšû
 
loggšg


355 -- 
ªd
 
´štšg
 
was
 
dÚe
 
the
 
cÜe
.

356 
suffic›ÁTimeSšûPršt
 =

357 (
¡©s
.
–­£dTime
 - 
Ï¡PrštTime
) >=

358 (
cÚ¡ªts
.
´štTimePassPút
 * 
şP¬ams
.
¡©sDi¥Ïy
 / 1000)

360 -- 
Prštšg
 
ªd
 
loggšg
:

361 
	$ÿnPršt
(
¦aveId
, 
şP¬ams
è
ªd
 
suffic›ÁTimeSšûPršt
 
th’


362 
Ï¡PrštTime
 = 
mg
.
	`g‘Time
(è- 
¡¬tTime


363 
şP¬ams
.
wr™emode
 =ğ1 
th’


364 
os
.
	`execu‹
("clear")

365 
¡©s
:
	$´št
(
pÜtId
)

367 
¡©s
:
	$wr™e
(
outFe
, 
pÜtId
)

368 
’d


369 
’d


370 
’d


372 -- 
Upd©e
 
¡©s
:

373 
¡©s
.
´evPack‘s
 = sts.
·ck‘s


374 
¡©s
.
´evBy‹s
 = sts.
by‹s


376 -- 
Check
 
ex™
 
cÚd™iÚs
:

377 
şP¬ams
.
™”©iÚs
 ~ğ0 
ªd
 
™”©iÚ
 >ğşP¬ams.™”©iÚ 
th’


378 
¡©e
 = "stop"

379 
–£if
 
şP¬ams
.
timeout
 ~ğ0 
ªd


380 
¡©s
.
–­£dTime
 >ğ
şP¬ams
.
timeout
 
th’


381 
¡©e
 = "stop"

382 
’d


383 
’d


385 
şP¬ams
.
wr™emode
 =ğ0 
th’


386 
¡©s
:
	$´št
(
pÜtId
)

387 
’d


388 
’d


391 -- 
Drİs
 
the
 
»ûived
 
·ck‘s


392 -- 
rxPack‘s
 : 
The
 
»ûived
 
·ck‘s
 
to
 
drİ
.

394 
funùiÚ
 
	$sim¶eDrİ
(
rxPack‘s
)

395 
rxPack‘s
:
	$ä“AÎ
()

396 
’d


399 -- 
G‘s
 
the
 
time¡amp
 
äom
 
a
 
·ck‘
 
ªd
 
th’
 
ÿlcuÏ‹s
h
Ï‹ncy


400 -- 
buf
 : 
The
 
bufãr
 
to
 
g‘
 
the
 
time¡amp
 
äom
 
ªd
 
th’
 
ÿlcuÏ‹
h
Ï‹ncy
.

402 
funùiÚ
 
	$ÿlcuÏ‹L©’cy
(
buf
)

403 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

404 
loÿl
 
cyşes
 = 
	`tÚumb”
(
mg
:
	$g‘Cyşes
())

405 
loÿl
 
time¡amp
 = 
	$tÚumb”
(
pkt
.
·ylßd
.
ušt64
[0])

406 
loÿl
 
Ï‹ncy
 = 0

408 
time¡amp
 ~ğ0 
th’


409 
Ï‹ncy
 = 
	`tÚumb”
(
cyşes
 - 
time¡amp
)

410 / 
	`tÚumb”
(
mg
:
	$g‘CyşesF»qu’cy
())

411 
’d


412  
Ï‹ncy


413 
’d


416 -- 
Pršts
 
RX
 
¡©s


417 -- 
pÜtId
 : 
The
 
id
 
of
 
the
 
pÜt
 
to
 
´št
h
¡©s
 

419 
funùiÚ
 
¡©sRx
:
	$´št
(
pÜtId
)

420 
loÿl
 
¡©sSŒšg
 = 
¡ršg
.
	`fÜm©
(

431 
mg
:
	`g‘CÜe
() ,

432 
pÜtId
 ,

433 
£lf
.
·ck‘s
 ,

434 (
£lf
.
·ck‘s
 - s–f.
´evPack‘s
è/ s–f.
d–Time
 ,

435 
£lf
.
·ck‘s
 / s–f.
–­£dTime
 ,

436 
£lf
.
by‹s
 ,

437 (
£lf
.
by‹s
 - s–f.
´evBy‹s
è/ s–f.
d–Time
 ,

438 
£lf
.
by‹s
 / s–f.
–­£dTime
 ,

439 
£lf
.
drİ³d
 ,

440 
£lf
.
m—nL©’cy


442 
	$´št
(
¡©sSŒšg
)

443 
’d


446 -- 
Wr™es
 
RX
 
a
 
¡©s
 
’Œy
 
to
‡ 
fe
. 
The
 
row
ƒÁry 
cÚšs
 
the
 
fŞlowšg


447 -- 
f›lds
:

449 -- 
Time
, 
tx
 
·ck‘s
,x 
·ck‘
 
¿‹
, 
avg
x…ack‘„©e, 
rx
…ackets,

450 -- 
rx
 
·ck‘
 
¿‹
, 
avg
„x…ack‘„©e, 
cÜe
, 
pÜt


452 -- 
f’ame
 : 
Name
 
of
 
the
 
fe
 
to
 
wr™e
o.

453 -- 
pÜtId
 : 
The
 
pÜt
 
the
 
¡©s
 
¬e
 
bešg
 
wr™‹n
 .

455 
funùiÚ
 
¡©sRx
:
	$wr™e
(
f’ame
, 
pÜtId
)

456 
fe
 = 
io
.
	`İ’
(
f’ame
, "a")

458 
loÿl
 
time
 = 
mg
.
	`g‘Time
(è- 
glob®S¹Time


460 
loÿl
 
¡©sSŒšg
 = 
¡ršg
.
	`fÜm©
(

462 
time
 ,

466 
£lf
.
·ck‘s
 ,

467 (
£lf
.
·ck‘s
 - s–f.
´evPack‘s
è/ s–f.
d–Time
 ,

468 
£lf
.
·ck‘s
 / s–f.
–­£dTime
 ,

469 
mg
:
	`g‘CÜe
() ,

470 
pÜtId


473 
fe
:
	$wr™e
(
¡©sSŒšg
)

474 
fe
:
	$şo£
()

475 
’d


477 ---- 
TX
 
FunùiÚ®™y
 ---------------------------------------------------------

480 -- 
SÏve
 
funùiÚ
 
to
 
³rfÜm
 
TX
.

481 -- 
deviû
 : 
The
 
MoÚG’
 deviû 
to
 
£Á
 
the
 
·ck‘s
 
äom
.

482 -- 
pÜtId
 : 
The
 
pÜt
 
the
 
deviû
 
is
 
cÚfigu»s
 
to
 
u£
.

483 -- 
¦aveId
 : 
The
 
	$id’tif›r
 (
šdex
è
of
 
the
 
¦ave
.

484 -- 
şP¬ams
 : 
The
 
commªd
 
lše
 
·¿m‘”s


486 
funùiÚ
 
	$txSÏve
(
deviû
, 
pÜtId
, 
¦aveId
, 
şP¬ams
)

487 
	`´št
(
¡ršg
.
	`fÜm©
("Launching TX slave: %u, Core: %u, Port: %u",

488 
¦aveId
, 
mg
:
	`g‘CÜe
(), 
pÜtId
))

490 
loÿl
 
¡©e
 = "canrun"

491 
loÿl
 
¡©s
 = 
	$d“pCİy
(
¡©sTx
)

492 
loÿl
 
txQueue
 = 
deviû
:
	$g‘TxQueue
(0)

493 
loÿl
 
tim”P¬ams
 = 
	$d“pCİy
(
timeP¬ams
)

494 
loÿl
 
outFe
 = ""

496 -- 
C»©e
 
the
 
f’ame
 
of
h
fe
 
to
 
wr™e
o.

497 
şP¬ams
.
wr™emode
 =ğ2 
th’


498 
outFe
 = 
şP¬ams
.
f•»fix
 .. ".txt"

499 
–£if
 
şP¬ams
.
wr™emode
 =ğ3 
th’


500 -- 
P”
 
cÜe
 
mode
: 
wr™e
 
h—d”


501 
outFe
 = 
şP¬ams
.
f•»fix
 ..

502 "-c" .. 
	`to¡ršg
(
mg
:
	`g‘CÜe
()) ..

503 "-p" .. 
	`to¡ršg
(
pÜtId
) .. ".txt";

504 
	$wr™eStsH—d”
(
outFe
)

505 
’d


507 -- 
AÎoÿ‹
 
memÜy
 
®l
 
the
 
¡»ams
. 
Each
 
of
h¡»am 
ÿn
 
have


508 -- 
a
 
maximum
 
of
 2047 
æows
 
due
 
to
 
mbuf
 
®loÿtiÚ
 
lim™s
.

509 
loÿl
 
¡»ams
 = {
	}
}

510 
i
 = 1, 
	gşP¬ams
.
numb”OfSŒ—ms
 do

511 
	g¡»ams
[
i
] = {

512 
mempoŞ
 = {},

513 
	gbufA¼ay
 = 
n


516 -- 
C»©e
 
a
 
mempoŞ
 
the
 
	g¡»am
:

517 
¡»ams
[
i
].
mempoŞ
 = 
memÜy
:
ü—‹MemPoŞ
(

518 
	$funùiÚ
(
buf
)

519 
buf
:
	$g‘UdpPack‘
():
fl
{

520 
pktL’gth
 = 
şP¬ams
.
·ck‘Size
 - 4,

521 
‘hL’gth
 = 
cÚ¡ªts
.
‘hH—d”L’gth


522 
	}
}

523 
’d


525 -- 
AÎoÿ‹
 
bufãrs
 
äom
 
the
 
	gmempoŞ
:

526 
¡»ams
[
i
].
bufA¼ay
 = sŒ—ms[i].
mempoŞ
:
	$bufA¼ay
(
şP¬ams
.
æowsP”SŒ—m
)

527 
’d


529 
loÿl
 
couÁ”
 = 0

530 -- 
Modify
 
®l
 
the
 
·ck‘s
 
so
 
th©
 
theœ
 
d©a
 
fŞlows
h
Œaffic
 
·‰”n
:

531 
¡»amid
, 
¡»am
 
š
 
	$aœs
(
¡»ams
) do

532 -- 
SubŒaùiÚ
 
of
 4 
is
 
the
 
FCS


533 
loÿl
 
maxPack‘Size
 = 
şP¬ams
.
·ck‘Size
 - 4

534 
şP¬ams
.
mu¡Imix
 
th’


535 
maxPack‘Size
 = 
cÚ¡ªts
.maxPacketSize - 4

536 
’d


538 -- 
AÎoÿ‹
 
bufãrs
 
usšg
 
the
 
max
 
possibË
 
·ck‘
 
size
. 
If
 usšg 
Imix


539 -- 
th’
 
—ch
 
of
 
the
 
£Á
 
·ck‘s
 
wl
 
v¬y
 
š
 
size
, 
de¥™e
h
cÚ¡ªt


540 -- 
size
 
®loÿtiÚ
 
dÚe
 
h”e
.

541 
¡»am
.
bufA¼ay
:
	`®loc
(
maxPack‘Size
)

543 -- 
Modify
 
the
 
·ck‘s
:

544 
æowid
, 
buf
 
š
 
	$aœs
(
¡»am
.
bufA¼ay
) do

545 
şP¬ams
.
mu¡Imix
 
th’


546 
loÿl
 
pktSize
 = 
	`imixSize
() - 4

547 
buf
.
pkt_Ën
 = 
pktSize


548 
buf
.
d©a_Ën
 = 
pktSize


549 
’d


551 
	`budTxF¿me
(
deviû
.
id
, 
buf
, 
¡»amid
 - 1, 
æowid
 - 1, 
şP¬ams
)

552 
’d


554 -- 
Ofæßd
 
the
 
checksum
 
to
h
NIC
:

555 
¡»am
.
bufA¼ay
:
	$ofæßdUdpChecksums
()

556 
’d


558 -- 
Do
 
£ndšg
:

559 
loÿl
 
™”©iÚ
 = 0

560 
loÿl
 
Ï¡PrštTime
 = 0

561 
loÿl
 
¡¬tTime
 = 
mg
.
	$g‘Time
()

563 
¡©e
 =ğ"ÿÄun" 
ªd
 
mg
.
	$ruÂšg
() do

564 
_
, 
¡»am
 
š
 
	$aœs
(
¡»ams
) do

565 
tim”P¬ams
.
cu¼tsc
 = 
	`tÚumb”
(
mg
:
	$g‘Cyşes
())

566 
tim”P¬ams
.
difásc
 =im”P¬ams.
cu¼tsc
 -im”P¬ams.
´evtsc


568 
	$£ndBur¡s
(
txQueue
, 
¡©s
, 
tim”P¬ams
, 
şP¬ams
, 
¡»am
)

569 
’d


571 -- 
Upd©e
 
the
 
™”©iÚ
 
ªd
 
timeout
 
·¿ms
:

572 
™”©iÚ
 = iteration + 1

573 
¡©s
.
d–Time
 = (
mg
.
	`g‘Time
(è- 
¡¬tTime
è- sts.
–­£dTime


574 
¡©s
.
–­£dTime
 = 
mg
.
	`g‘Time
(è- 
¡¬tTime


576 -- 
Prštšg
 
ªd
 
wr™šg
:

577 
şP¬ams
.
wr™emode
 > 0 
th’


578 -- 
To
 
make
 
su»
 
th©
 
’ough
 
time
 
has
 
·s£d
 
sšû
 
loggšg


579 -- 
ªd
 
´štšg
 
was
 
dÚe
 
the
 
cÜe
.

580 
suffic›ÁTimeSšûPršt
 =

581 ((
¡©s
.
–­£dTime
 - 
Ï¡PrštTime
) >=

582 (
cÚ¡ªts
.
´štTimePassPút
 * 
şP¬ams
.
¡©sDi¥Ïy
 / 1000))

584 -- 
Prštšg
 
ªd
 
loggšg
:

585 
	$ÿnPršt
(
¦aveId
, 
şP¬ams
è
ªd
 
suffic›ÁTimeSšûPršt
 
th’


586 
Ï¡PrštTime
 = 
mg
.
	`g‘Time
(è- 
¡¬tTime


587 
şP¬ams
.
wr™emode
 =ğ1 
th’


588 
os
.
	`execu‹
("clear")

589 
¡©s
:
	$´št
(
pÜtId
)

591 
¡©s
:
	$wr™e
(
outFe
, 
pÜtId
)

592 
’d


593 
’d


594 
’d


596 -- 
Upd©e
 
¡©s
:

597 
¡©s
.
´evPack‘s
 = sts.
·ck‘s


598 
¡©s
.
´evBy‹s
 = sts.
by‹s


600 -- 
Check
 
ex™
 
cÚd™iÚs
:

601 
şP¬ams
.
™”©iÚs
 ~ğ0 
ªd
 
™”©iÚ
 >ğşP¬ams.™”©iÚ 
th’


602 
¡©e
 = "stop"

603 
–£if
 
şP¬ams
.
timeout
 ~ğ0 
ªd


604 
¡©s
.
–­£dTime
 >ğ
şP¬ams
.
timeout
 
th’


605 
¡©e
 = "stop"

606 
’d


607 
’d


609 
şP¬ams
.
wr™emode
 =ğ0 
th’


610 
¡©s
:
	$´št
(
pÜtId
)

611 
’d


612 
’d


615 -- 
Buds
 
a
 
äame
 
TX
.

616 -- 
pÜtId
 : 
The
 
pÜt
 
of
 
the
 
deviû
 
to
 
bud
h
äame
 .

617 -- 
buf
 : 
The
 
bufãr
 
the
 
·ck‘
 
hŞdšg
h
äame
.

618 -- 
¡»amid
 : 
The
 
id
 
of
 
the
 
¡»am
 th
äame
.

619 -- 
æowid
 : 
The
 
id
 
of
 
the
 
æow
 th
äame
.

620 -- 
şP¬ams
 : 
The
 
commªd
 
lše
 
·¿m‘”s
.

622 
funùiÚ
 
	$budTxF¿me
(
pÜtId
, 
buf
, 
¡»amid
, 
æowid
, 
şP¬ams
)

623 
loÿl
 
¤cMac
 = 
şP¬ams
.
¤cMacBa£
 + (
¡»amid
 * clP¬ams.
¤cMacSŒide
)

624 + (
æowid
 * 
şP¬ams
.
¤cMacV¬y
)

625 
loÿl
 
d¡Mac
 = 
şP¬ams
.
d¡MacBa£
 + (
¡»amid
 * clP¬ams.
d¡MacSŒide
)

626 + (
æowid
 * 
şP¬ams
.
d¡MacV¬y
)

627 
loÿl
 
¤cIp
 = 
şP¬ams
.
¤cIpBa£
 + (
¡»amid
 * clP¬ams.
¤cIpSŒide
)

628 + (
æowid
 * 
şP¬ams
.
¤cIpV¬y
)

629 
loÿl
 
d¡Ip
 = 
şP¬ams
.
d¡IpBa£
 + (
¡»amid
 * clP¬ams.
d¡IpSŒide
)

630 + (
æowid
 * 
şP¬ams
.
d¡IpV¬y
)

631 
loÿl
 
¤cPÜt
 = 
	`bªd
(
şP¬ams
.
¤cPÜtBa£


632 + (
¡»amid
 * 
şP¬ams
.
¤cPÜtSŒide
)

633 + (
æowid
 * 
şP¬ams
.
¤cPÜtV¬y
),

635 
loÿl
 
d¡PÜt
 = 
	`bªd
(
şP¬ams
.
d¡PÜtBa£


636 + (
¡»amid
 * 
şP¬ams
.
d¡PÜtSŒide
)

637 + (
æowid
 * 
şP¬ams
.
d¡PÜtV¬y
),

640 
loÿl
 
¤cMacFl³d
 = 
	`rshiá
(
	`bsw­
(
¤cMac
 + 0ULL), 16)

641 
loÿl
 
d¡macFl³d
 = 
	`rshiá
(
	`bsw­
(
d¡Mac
 + 0ULL), 16)

643 
loÿl
 
äameSize
 = 
buf
.
pkt_Ën


644 
loÿl
 
‘hL’gth
 = 
cÚ¡ªts
.
‘hH—d”L’gth


645 
loÿl
 
L’gth
 = 
äameSize
 - 
‘hL’gth


646 
loÿl
 
udpL’gth
 = 
L’gth
 - 
cÚ¡ªts
.
H—d”L’gth


648 
loÿl
 
pkt
 = 
buf
:
	`g‘UdpPack‘
()

650 -- 
ETH
 
mod
:

651 
pkt
.
‘h
:
	$£tTy³
(
cÚ¡ªts
.
‘hTy³Ipv4
)

652 
pkt
.
‘h
:
	$£tSrc
(
¤cMacFl³d
)

653 
pkt
.
‘h
:
	`£tD¡
(
d¡macFl³d
)

655 -- 
IP
 
mod
:

656 
pkt
.
4
:
	$£tL’gth
(
L’gth
)

657 
pkt
.
4
:
	`£tH—d”L’gth
(5è-- 
Numb”
 
of
 32 
b™
 
wÜds
 : 
u£
 
mš
 
v®ue
.

658 
pkt
.
4
:
	$£tPrÙocŞ
(17)

659 
pkt
.
4
:
	$£tTTL
(64)

660 
pkt
.
4
:
	$£tSrc
(
¤cIp
)

661 
pkt
.
4
:
	$£tD¡
(
d¡Ip
)

662 
pkt
.
4
:
	`£tV”siÚ
(4)

664 -- 
UDP
 
mod
:

665 
pkt
.
udp
:
	$£tL’gth
(
udpL’gth
)

666 
pkt
.
udp
:
	$£tSrcPÜt
(
¤cPÜt
)

667 
pkt
.
udp
:
	`£tD¡PÜt
(
d¡PÜt
)

669 -- 
S¹
 
of
 
·ylßd
 
looks
 
as
 
fŞlows
:

671 -- | 
By‹
 0 | Byte 4 | Byte 8 | Byte 12 |

673 -- | 
time¡amp
 | 
æowid
 | 
¡»amid
 |

676 -- 
The
 
time¡amp
 
is
 
®»dy
 
£t
, 
so
 s‘ 
æow
 
ªd
 
¡»am
 
id
.

677 
pkt
.
·ylßd
.
ušt32
[2] = 
æowid


678 
pkt
.
·ylßd
.
ušt32
[3] = 
¡»amid


680 -- 
Fl
 
the
 
»¡
 
of
h
·ylßd


681 
loÿl
 
·yL’gth
 = 
udpL’gth
 - 
cÚ¡ªts
.
udpH—d”L’gth


682 
loÿl
 
i
 = 16 -- 
t¡amp
, 
æowid
, 
¡»amid
 = 16 
by‹s


683 
loÿl
 
off£t
 = 
i
 -- 
S¹
 off£ˆ
što
 
·ylßd
 
by‹s


685 -- 
Cİy
 
the
  
·ylßd
 
što
h
·ck‘
.

686 
i
 < 
·yL’gth
 do

687 -- 
NOTE
: (
i
 - 
off£t
è
is
 
to
 
»move
 
the
 16 
by‹
 
š™Ÿl
 offset.

688 
pkt
.
·ylßd
.
ušt8
[
i
] =

689 
¡ršg
.
	`by‹
(
cÚ¡ªts
.
deçuÉPaylßd
, 
i
 - 
off£t
 + 1è
Ü
 0

690 
i
 = i + 1

691 
’d


692 
’d


695 -- 
G’”©es
 
ªd
 
£nds
 
a
 
bur¡
 
’ough
 
time
 
has
 
·s£d
 
to
 
ach›ve
 
the
 
desœed


696 -- 
·ck‘
 
¿‹
, 
Ùh”wi£
 
nÙhšg
 
h­³ns
.

697 -- 
txQueue
 : 
The
 
queue
 
to
 
£nd
 
the
 
bur¡
 
Ú
.

698 -- 
¡©s
 : 
The
 st 
to
 
upd©e
.

699 -- 
tim”P¬ams
 : 
The
 
·¿m‘”s
 
the
 
bur¡
 
to
 
£nd
.

700 -- 
şP¬ams
 : 
The
 
commªd
 
lše
 
·¿m‘”s
.

701 -- 
¡»am
 : 
The
 sŒ—m 
to
 
£nd
.

703 
funùiÚ
 
	`£ndBur¡s
(
txQueue
, 
¡©s
 , 
tim”P¬ams
, 
şP¬ams
, 
¡»am
)

704 -- 
If
 
’ough
 
time
 
has
 
·s£d
 
to
 
ach›ve
 
the
 
»que¡ed
 
¿‹
.

705 
tim”P¬ams
.
difásc
 > 
şP¬ams
.
txD–
 
th’


706 
loÿl
 
nbtx
 = 0

707 
i
 = 1, 
şP¬ams
.
bur¡sP”SŒ—m
 do

708 
¡©s
.
bur¡s
 = stats.bursts + 1

709 
_
, 
buf
 
š
 
	$aœs
(
¡»am
.
bufA¼ay
) do

710 
	$upd©eTime¡amp
(
buf
)

711 
’d


712 
nbtx
 =‚btx + 
txQueue
:
	$£nd
(
¡»am
.
bufA¼ay
)

713 
’d


715 
¡©s
.
·ck‘s
 = sts.·ck‘ + 
nbtx


717 
_
, 
buf
 
š
 
	$aœs
(
¡»am
.
bufA¼ay
) do

718 -- 
Add
 
four
 
the
 
FCS
.

719 
¡©s
.
by‹s
 = 4 + stats.bytes +

720 (
şP¬ams
.
bur¡sP”SŒ—m
 * 
buf
.
pkt_Ën
)

721 
’d


723 
nbtx
 < 
cÚ¡ªts
.
txBur¡Size
 
th’


724 
¡©s
.= stats.+ 1

725 
’d


727 
tim”P¬ams
.
´evtsc
 =im”P¬ams.
cu¼tsc


728 
’d


729 
’d


732 -- 
Upd©es
 
the
 
time¡amp
 
a
 
·ck‘
. 
The
 
fœ¡
 8 
by‹s
 
of
h·ck‘ 
·ylßd


733 -- 
¬e
 
u£d
 
the
 
time¡amp
.

734 -- 
buf
 : 
The
 
bufãr
 
to
 
upd©e
 
the
 
time¡amp
 
of
.

736 
funùiÚ
 
	$upd©eTime¡amp
(
buf
)

737 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

738 
loÿl
 
cyşes
 = 
mg
:
	$g‘Cyşes
()

739 
pkt
.
·ylßd
.
ušt64
[0] = 
cyşes


740 
’d


743 -- 
Pršts
 
TX
 
¡©s


744 -- 
pÜtId
 : 
The
 
id
 
of
 
the
 
pÜt
 
to
 
´št
h
¡©s
 

746 
funùiÚ
 
¡©sTx
:
	$´št
(
pÜtId
)

747 
loÿl
 
¡©sSŒšg
 = 
¡ršg
.
	`fÜm©
(

758 
mg
:
	`g‘CÜe
() ,

759 
pÜtId
 ,

760 
£lf
.
·ck‘s
 ,

761 (
£lf
.
·ck‘s
 - s–f.
´evPack‘s
è/ s–f.
d–Time
 ,

762 
£lf
.
·ck‘s
 / s–f.
–­£dTime
 ,

763 
£lf
.
by‹s
 ,

764 (
£lf
.
by‹s
 - s–f.
´evBy‹s
è/ s–f.
d–Time
 ,

765 
£lf
.
by‹s
 / s–f.
–­£dTime
 ,

766 
£lf
.,

767 
£lf
.
bur¡s


769 
	$´št
(
¡©sSŒšg
)

770 
’d


773 -- 
Wr™es
 
TX
 
a
 
¡©s
 
’Œy
 
to
‡ 
fe
. 
The
 
row
ƒÁry 
cÚšs
 
the
 
fŞlowšg


774 -- 
f›lds
:

776 -- 
Time
, 
tx
 
·ck‘s
,x 
·ck‘
 
¿‹
, 
avg
x…ack‘„©e, 
rx
…ackets,

777 -- 
rx
 
·ck‘
 
¿‹
, 
avg
„x…ack‘„©e, 
cÜe
, 
pÜt


779 -- 
f’ame
 : 
Name
 
of
 
the
 
fe
 
to
 
wr™e
o.

780 -- 
pÜtId
 : 
The
 
pÜt
 
the
 
¡©s
 
¬e
 
bešg
 
wr™‹n
 .

782 
funùiÚ
 
¡©sTx
:
	$wr™e
(
f’ame
, 
pÜtId
)

783 
fe
 = 
io
.
	`İ’
(
f’ame
, "a")

785 
loÿl
 
time
 = 
mg
.
	`g‘Time
(è- 
glob®S¹Time


787 
loÿl
 
¡©sSŒšg
 = 
¡ršg
.
	`fÜm©
(

789 
time
,

790 
£lf
.
·ck‘s
 ,

791 (
£lf
.
·ck‘s
 - s–f.
´evPack‘s
è/ s–f.
d–Time
 ,

792 
£lf
.
·ck‘s
 / s–f.
–­£dTime
 ,

796 
mg
:
	`g‘CÜe
() ,

797 
pÜtId


800 
fe
:
	$wr™e
(
¡©sSŒšg
)

801 
fe
:
	$şo£
()

802 
’d


804 ---- 
Ut™y
 
FunùiÚs
 --------------------------------------------------------

807 -- 
Wr™e
 
the
 
h—d”
 
a
 
¡©s
 
fe
.

808 -- 
f’ame
 : 
The
 
Çme
 
of
 
the
 
fe
 
to
 
wr™e
h
h—d”to
.

810 
funùiÚ
 
	$wr™eStsH—d”
(
f’ame
)

811 
fe
 = 
io
.
	`İ’
(
f’ame
, "a")

813 
loÿl
 
h—d”SŒšg
 = 
¡ršg
.
	`fÜm©
(

826 
fe
:
	$wr™e
(
h—d”SŒšg
)

827 
fe
:
	$şo£
()

828 
’d


831 -- 
D‘”mšes
 
a
 
cÜe
 
is
 
®lowed
 
to
 
´št
 
™
's stats.

832 -- 
¦aveId
 : 
Id’tif›r
 
the
 
¦ave
 
»que¡šg
 
to
 
´št
.

833 -- 
şP¬ams
 : 
The
 
commªd
 
lše
 
·¿m‘”s


835 
funùiÚ
 
	$ÿnPršt
(
¦aveId
, 
şP¬ams
)

836 
loÿl
 
–­£dTime
 = 
mg
.
	`g‘Time
(è- 
glob®S¹Time


837 
loÿl
 
timeP”CÜe
 = 
şP¬ams
.
¡©sDi¥Ïy
 /

838 (#şP¬ams.
rxSÏvePÜts
 + #şP¬ams.
txSÏvePÜts
)

840 
loÿl
 
timeMod
 = 
m©h
.
	`æoÜ
(

841 
m©h
.
	$fmod
(
–­£dTime
 * 1000, 
şP¬ams
.
¡©sDi¥Ïy
))

843  
timeMod
 =ğ
m©h
.
	$æoÜ
(
timeP”CÜe
 * 
¦aveId
)

844 
’d


847 -- 
Pršts
 
the
 
commªd
 
lše
 
¬gum’ts
.

849 
funùiÚ
 
şP¬ams
:
	$´št
()

850 
loÿl
 
·¿mSŒšg
 = 
¡ršg
.
	`fÜm©
(

887 #£lf.
rxSÏvePÜts
 ,

888 #£lf.
txSÏvePÜts
 ,

889 
£lf
.
rxDescs
 ,

890 
£lf
.
txDescs
 ,

891 
£lf
.
·¿mDi¥Ïy
 / 1000 ,

892 
£lf
.
¡©sDi¥Ïy
 / 1000 ,

893 
£lf
.
numb”OfSŒ—ms
 ,

894 
£lf
.
bur¡sP”SŒ—m
 ,

895 
£lf
.
æowsP”SŒ—m
 ,

896 
£lf
.
tÙ®Flows
 ,

897 
£lf
.
™”©iÚs
 ,

898 
£lf
.
timeout
 ,

899 
£lf
.
·ck‘Size
 ,

900 
	`to¡ršg
(
£lf
.
mu¡Imix
) ,

901 
£lf
.
f•»fix
 ,

902 
£lf
.
wr™emode
 ,

903 
¡ršg
.
	`fÜm©
("%012x", 
£lf
.
¤cMacBa£
) ,

904 
¡ršg
.
	`fÜm©
("%012x", 
£lf
.
d¡MacBa£
) ,

905 
¡ršg
.
	`fÜm©
("%012x", 
£lf
.
¤cMacV¬y
) ,

906 
¡ršg
.
	`fÜm©
("%012x", 
£lf
.
d¡MacV¬y
 ),

907 
¡ršg
.
	`fÜm©
("%012x", 
£lf
.
¤cMacSŒide
),

908 
¡ršg
.
	`fÜm©
("%012x", 
£lf
.
d¡MacSŒide
),

909 
	`fÜm©AsIp
(
£lf
.
¤cIpBa£
) ,

910 
	`fÜm©AsIp
(
£lf
.
d¡IpBa£
) ,

911 
	`fÜm©AsIp
(
£lf
.
¤cIpV¬y
) ,

912 
	`fÜm©AsIp
(
£lf
.
d¡IpV¬y
) ,

913 
	`fÜm©AsIp
(
£lf
.
¤cIpSŒide
) ,

914 
	`fÜm©AsIp
(
£lf
.
d¡IpSŒide
) ,

915 
£lf
.
¤cPÜtBa£
 ,

916 
£lf
.
d¡PÜtBa£
 ,

917 
£lf
.
¤cPÜtV¬y
 ,

918 
£lf
.
d¡PÜtV¬y
 ,

919 
£lf
.
¤cPÜtSŒide
 ,

920 
£lf
.
d¡PÜtSŒide


923 
	$´št
(
·¿mSŒšg
)

924 
’d


926 ---- 
Argum’t
 
P¬sšg
 ---------------------------------------------------------

929 -- 
CÚv”ts
 
a
 
MAC
 
add»ss
 
äom
 
™s
 
¡ršg
 
»´e£Á©iÚ
 
to
‡ 
num”ic
 
Úe
, 
š


930 -- 
ÃtwÜk
 
by‹
 
Üd”
.

931 -- 
add»ss
 : 
The
‡dd»s 
to
 
cÚv”t
.

933 
funùiÚ
 
	$cÚv”tMacAdd»ss
(
add»ss
)

934 
loÿl
 
by‹s
 = {
¡ršg
.
	`m©ch
(
add»ss
,

935 '(%x+)[-:](%x+)[-:](%x+)[-:](%x+)[-:](%x+)[-:](%x+)')
	}
}

937 
loÿl
 
cÚv”‹dAdd»ss
 = 0

938 
i
 = 1, 6 do

939 
	gcÚv”‹dAdd»ss
 = 
cÚv”‹dAdd»ss
 +

940 
tÚumb”
(
by‹s
[#by‹ + 1 - 
i
], 16è* 256 ^ (
	gi
 - 1)

941 
’d


942  
cÚv”‹dAdd»ss


943 
	g’d


947 -- 
FÜm©s
 
	ga
 32 
b™
 
v®ue
 
as
 
ª
 
IP
 
	gadd»ss
.

948 -- 
	g
 : 
The
 
num”ic
 
»´e£Á©iÚ
 
of
 
the
 
IP
 
add»ss
 
to
 
fÜm©
.

950 
funùiÚ
 
	$fÜm©AsIp
(

)

951  
¡ršg
.
	`fÜm©
("%d.%d.%d.%d",

952 
	`bªd
(
	`rshiá
(

, 24), 0xff), band(rshift(ip, 16), 0xff),

953 
	`bªd
(
	`rshiá
(

, 8 ), 0xff), 
	$bªd
(

, 0xff))

954 
’d


957 -- 
P¬£s
 
the
 
commªd
 
lše
 
¬gum’ts
.

958 -- 
·¿ms
 : 
The
 
a
 
bË
 
of
 
·¿m‘”s
 
to
 
modify
 
ba£d
 
Ú
 
the
 
commªd
 
lše


959 -- 
·¿m‘”s


960 -- ... : 
A
 
bË
 
of
 
commªd
 
lše
 
·¿m‘”s
 
to
 
·r£
.

962 
funùiÚ
 
	$·r£Args
(
·¿ms
, ...)

963 
loÿl
 
commªd
 = 
Œue


964 
loÿl
 
¬gs
 = {...
	}
}

966 
i
,
v
 
š
 
	$aœs
(
¬gs
) do

967 
	`ty³
(
v
è=ğ"¡ršg" 
th’


968 
v
 =ğ"--tx-¦ave" 
Ü
 v =ğ"-tx" 
th’


969 
loÿl
 
¦avePÜt
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

970 
¦avePÜt
 < 0 
Ü
 sÏvePÜˆ> 
cÚ¡ªts
.
maxSÏvePÜt
 
th’


971 
	`´št
("Inv®id TX sÏvpÜt: ", 
¦avePÜt
)

972 
	$´štU§ge
()

973  
çl£


974 
’d


975 
loÿl
 
ÿnAdd
 = 
Œue


976 
_
, 
v
 
š
 
	$aœs
(
·¿ms
.
txSÏvePÜts
) do

977 
v
 =ğ
¦avePÜt
 
th’


978 
ÿnAdd
 = 
çl£


979 
	`´št
("Ignoring second specification of TX slave " ..

980 "pÜt: ", 
¦avePÜt
)

981 
’d


982 
’d


983 
ÿnAdd
 
th’


984 
·¿ms
.
txSÏvePÜts
[#·¿ms.txSÏvePÜt + 1] = 
¦avePÜt


985 
’d


986 
–£if
 
v
 =ğ"--rx-¦ave" 
Ü
 v =ğ"-rx" 
th’


987 
loÿl
 
¦avePÜt
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

988 
¦avePÜt
 < 0 
Ü
 sÏvePÜˆ> 
cÚ¡ªts
.
maxSÏvePÜt
 
th’


989 
	`´št
("Inv®id RX sÏvpÜt: ", 
¦avePÜt
)

990 
	$´štU§ge
()

991  
çl£


992 
’d


993 
loÿl
 
ÿnAdd
 = 
Œue


994 
_
, 
v
 
š
 
	$aœs
(
·¿ms
.
rxSÏvePÜts
) do

995 
v
 =ğ
¦avePÜt
 
th’


996 
ÿnAdd
 = 
çl£


997 
	`´št
("Ignoring second specification of RX slave " ..

998 "pÜt: ", 
¦avePÜt
)

999 
’d


1000 
’d


1001 
ÿnAdd
 
th’


1002 
·¿ms
.
rxSÏvePÜts
[#·¿ms.rxSÏvePÜt + 1] = 
¦avePÜt


1003 
’d


1004 
–£if
 
v
 =ğ"--tx-descs" 
Ü
 v =ğ"-txd" 
th’


1005 
loÿl
 
txDescs
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1006 
txDescs
 < 0 
th’


1007 
	`´št
("Inv®id TX desütÜs: ", 
txDescs
)

1008 
	$´štU§ge
()

1009  
çl£


1010 
’d


1011 
·¿ms
.
txDescs
 =xDescs

1012 
–£if
 
v
 =ğ"--rx-descs" 
Ü
 v =ğ"-rxd" 
th’


1013 
loÿl
 
rxDescs
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1014 
rxDescs
 < 0 
th’


1015 
	`´št
("Inv®id RX desütÜs: ", 
rxDescs
)

1016 
	$´štU§ge
()

1017  
çl£


1018 
’d


1019 
·¿ms
.
rxDescs
 =„xDescs

1020 
–£if
 
v
 =ğ"--¡»ams" 
Ü
 v =ğ"-s" 
th’


1021 
loÿl
 
¡»ams
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1022 ià(
¡»ams
 < 0è
th’


1023 
	`´št
("Inv®id‚umb” oà¡»ams:", 
¡»ams
)

1024 
	$´štU§ge
()

1025  
çl£


1026 
’d


1027 
·¿ms
.
numb”OfSŒ—ms
 = 
¡»ams


1028 
–£if
 
v
 =ğ"--bur¡s-³r-¡»am" 
Ü
 v =ğ"-bps" 
th’


1029 
loÿl
 
bps
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1030 ià(
bps
 < 0è
th’


1031 
	`´št
("Inv®id‚umb” oàbur¡ ³¸¡»am:", 
bps
)

1032 
	$´štU§ge
()

1033  
çl£


1034 
’d


1035 
·¿ms
.
bur¡sP”SŒ—m
 = 
bps


1036 
–£if
 
v
 =ğ"--æows-³r-¡»am" 
Ü
 v =ğ"-ås" 
th’


1037 
loÿl
 
ås
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1038 
ås
 < 0 
Ü
 fp > 
cÚ¡ªts
.
maxFlowsP”SŒ—m
 
th’


1039 
	`´št
("Inv®id‚umb” oàæow ³¸¡»am:", 
ås
)

1040 
	$´štU§ge
()

1041  
çl£


1042 
’d


1043 
·¿ms
.
æowsP”SŒ—m
 = 
ås


1044 
–£if
 
v
 =ğ"--·¿m-di¥Ïy" 
Ü
 v =ğ"-pd" 
th’


1045 
loÿl
 
·¿mDi¥Ïy
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1046 
·¿mDi¥Ïy
 < 0 
th’


1047 
	`´št
(
¡ršg
.
	`fÜm©
("Invalid…aram displayime: %u, " ..

1049 
·¿mDi¥Ïy
, (
·¿ms
.paramDisplay / 1000)))

1051 
·¿ms
.
·¿mDi¥Ïy
 =…aramDisplay * 1000

1052 
’d


1053 
–£if
 
v
 =ğ"--¡©s-di¥Ïy" 
Ü
 v =ğ"-sd" 
th’


1054 
loÿl
 
³riod
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1055 
³riod
 < 0 
Ü
…”iod > 86400 
th’


1056 
	`´št
(
¡ršg
.
	`fÜm©
("Invalid…ort stats displayime: " ..

1057 "%u, usšg deçuÉ: %u", 
³riod
,

1058 (
·¿ms
.
¡©sDi¥Ïy
 / 1000))

1060  
çl£


1061 
’d


1062 
·¿ms
.
¡©sDi¥Ïy
 = 
³riod
 * 1000

1063 
–£if
 
v
 =ğ"--pkt-size" 
Ü
 v =ğ"-ps" 
th’


1064 
loÿl
 
pktSize
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1065 
pktSize
 =ğ0 
th’


1066 
·¿ms
.
mu¡Imix
 = 
Œue


1067 
·¿ms
.
·ck‘Size
 = 
pktSize


1068 
–£if
 
pktSize
 < 64 
Ü
…ktSiz> 1514 
th’


1069 
	`´št
("Invalid…acket size")

1070 
	$´štU§ge
()

1071  
çl£


1073 
·¿ms
.
·ck‘Size
 = 
pktSize


1074 
’d


1075 
–£if
 
v
 =ğ"--timeout" 
Ü
 v =ğ"-to" 
th’


1076 
loÿl
 
timeout
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1077 
timeout
 < 0 
th’


1078 
	`´št
("Invalidimeout…eriod, can't be‚egative.")

1079 
	$´štU§ge
()

1080  
çl£


1082 
·¿ms
.
timeout
 =imeout

1083 
’d


1084 
·¿ms
.
wr™emode
 = 0

1085 
–£if
 
v
 =ğ"--™”©iÚs" 
Ü
 v =ğ"-™" 
th’


1086 
loÿl
 
™”©iÚs
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1087 
™”©iÚs
 < 0 
th’


1088 
	`´št
("Invalid‚umber of iterations, cannot be‚egative.")

1089 
	$´štU§ge
()

1090  
çl£


1092 
·¿ms
.
™”©iÚs
 = iterations

1093 
’d


1094 
·¿ms
.
wr™emode
 = 0

1095 
–£if
 
v
 =ğ"--pkts-³r-£c" 
Ü
 v =ğ"-µs" 
th’


1096 
	`´št
("NOTE: flows…er stream‡nd burst…er stream " ..

1099 
loÿl
 
txPps
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1100 
txPps
 < 0 
th’


1101 
	`´št
("Invalid…ackets…er second, can't be‚egaive.")

1102 
	$´štU§ge
()

1103  
çl£


1104 
’d


1106 
·¿ms
.
txD–
 =

1107 
m©h
.
	`æoÜ
(
mg
:
	`g‘CyşesF»qu’cy
(è/ 
txPps
) *

1108 
·¿ms
.
æowsP”SŒ—m
 *…¬ams.
bur¡sP”SŒ—m


1109 
–£if
 
v
 =ğ"--fe-´efix" 
Ü
 v =ğ"-å" 
th’


1110 
·¿ms
.
f•»fix
 = 
¬gs
[
i
 + 1]

1111 
·¿ms
.
wr™emode
 < 2 
th’


1112 
·¿ms
.
wr™emode
 = 2 -- 
wr™e
 
to
 
glob®
 
fe


1113 
’d


1114 
–£if
 
v
 =ğ"--wr™e-mode" 
Ü
 v =ğ"-wm" 
th’


1115 
loÿl
 
wr™emode
 = 
	`tÚumb”
(
¬gs
[
i
 +1])

1116 
wr™emode
 < 0 
Ü
 wr™emod> 3 
th’


1117 
	`´št
("Invalid write mode, must be 0 - 3.")

1118 
	$´štU§ge
()

1119  
çl£


1120 
’d


1121 
·¿ms
.
wr™emode
 = writemode

1122 
–£if
 
v
 =ğ"--¤c-pÜt" 
Ü
 v =ğ"-¥t" 
th’


1123 
·¿ms
.
¤cPÜtBa£
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1124 
–£if
 
v
 =ğ"--d¡-pÜt" 
Ü
 v =ğ"-d±" 
th’


1125 
·¿ms
.
d¡PÜtBa£
 = 
	`tÚumb”
(
¬gs
[
i
 + 1])

1126 
–£if
 
v
 =ğ"--¤c-" 
Ü
 v =ğ"-s" 
th’


1127 
·¿ms
.
¤cIpBa£
 = 
	`·r£IPAdd»ss
(

1128 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1130 
Œue
)

1131 
–£if
 
v
 =ğ"--d¡-" 
Ü
 v =ğ"-d" 
th’


1132 
·¿ms
.
d¡IpBa£
 = 
	`·r£IPAdd»ss
(

1133 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1135 
Œue
)

1136 
–£if
 
v
 =ğ"--¤c-mac" 
Ü
 v =ğ"-sm" 
th’


1137 
·¿ms
.
¤cMacBa£
 = 
	`cÚv”tMacAdd»ss
(

1138 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1140 
–£if
 
v
 =ğ"--d¡-mac" 
Ü
 v =ğ"-dm" 
th’


1141 
·¿ms
.
d¡MacBa£
 = 
	`cÚv”tMacAdd»ss
(

1142 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1144 
–£if
 
v
 =ğ"--¤c-pÜt-v¬y" 
Ü
 v =ğ"-¥tv" 
th’


1145 
·¿ms
.
¤cPÜtV¬y
 = 
	`tÚumb”
(
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1], "%d+"))

1146 
–£if
 
v
 =ğ"--d¡-pÜt-v¬y" 
Ü
 v =ğ"-d±v" 
th’


1147 
·¿ms
.
d¡PÜtV¬y
 = 
	`tÚumb”
(
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1], "%d+"))

1148 
–£if
 
v
 =ğ"--¤c--v¬y" 
Ü
 v =ğ"-sv" 
th’


1149 
·¿ms
.
¤cIpV¬y
 = 
	`·r£IPAdd»ss
(

1150 
¡ršg
.
	`m©ch
(
¬gs
[
i
 +1 ],

1152 
Œue
)

1153 
–£if
 
v
 =ğ"--d¡--v¬y" 
Ü
 v =ğ"-dv" 
th’


1154 
·¿ms
.
d¡IpV¬y
 = 
	`·r£IPAdd»ss
(

1155 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1157 
Œue
)

1158 
–£if
 
v
 =ğ"--¤c-mac-v¬y" 
Ü
 v =ğ"-smv" 
th’


1159 
·¿ms
.
¤cMacV¬y
 = 
	`cÚv”tMacAdd»ss
(

1160 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1162 
–£if
 
v
 =ğ"--d¡-mac-v¬y" 
Ü
 v =ğ"-dmv" 
th’


1163 
·¿ms
.
d¡MacV¬y
 = 
	`cÚv”tMacAdd»ss
(

1164 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1166 
–£if
 
v
 =ğ"--¤c-pÜt-¡ride" 
Ü
 v =ğ"-¥ts" 
th’


1167 
·¿ms
.
¤cPÜtSŒide
 = 
	`tÚumb”
(
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1], "%d+"))

1168 
–£if
 
v
 =ğ"--d¡-pÜt-¡ride" 
Ü
 v =ğ"-d±s" 
th’


1169 
·¿ms
.
d¡PÜtSŒide
 = 
	`tÚumb”
(
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1], "%d+"))

1170 
–£if
 
v
 =ğ"--¤c--¡ride" 
Ü
 v =ğ"-ss" 
th’


1171 
·¿ms
.
¤cIpSŒide
 = 
	`·r£IPAdd»ss
(

1172 
¡ršg
.
	`m©ch
(
¬gs
[
i
 +1 ],

1174 
Œue
)

1175 
–£if
 
v
 =ğ"--d¡--¡ride" 
Ü
 v =ğ"-ds" 
th’


1176 
·¿ms
.
d¡IpSŒide
 = 
	`·r£IPAdd»ss
(

1177 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1179 
Œue
)

1180 
–£if
 
v
 =ğ"--¤c-mac-¡ride" 
Ü
 v =ğ"-sms" 
th’


1181 
·¿ms
.
¤cMacSŒide
 = 
	`cÚv”tMacAdd»ss
(

1182 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1184 
–£if
 
v
 =ğ"--d¡-mac-¡ride" 
Ü
 v =ğ"-dms" 
th’


1185 
·¿ms
.
d¡MacSŒide
 = 
	`cÚv”tMacAdd»ss
(

1186 
¡ršg
.
	`m©ch
(
¬gs
[
i
 + 1],

1189 
–£if
 
v
 =ğ"--h–p" 
Ü
 v =ğ"-h" 
th’


1190 
	$´štU§ge
()

1191  
çl£


1192 
’d


1193 
’d


1194 
’d


1195 
·¿ms
.
tÙ®Flows
 =…¬ams.
numb”OfSŒ—ms
 *…¬ams.
æowsP”SŒ—m


1197 -- 
Check
 
th©
 
the
 
¡rides
 
¬e
 
v®id
:

1198 
	$checkSŒideV®id™y
(
·¿ms
)

1200  
Œue


1201 
’d


1204 -- 
Checks
 
th©
 
the
 
¡rides
 th
·¿m‘”s
 
¬e
 
v®id


1205 -- 
·¿ms
 : 
The
 
·¿m‘”s
 
who£
 
¡rides
 
v®id™y
 
mu¡
 
be
 
checked


1207 
funùiÚ
 
	$checkSŒideV®id™y
(
·¿ms
)

1208 
·¿ms
.
¤cMacSŒide
 =ğ0 
th’


1209 
·¿ms
.
¤sMacSŒide
 = 
	$bªd
(
·¿ms
.
æowsP”SŒ—m
, 0xffffffffffff)

1210 
’d


1211 
·¿ms
.
d¡MacSŒide
 =ğ0 
th’


1212 
·¿ms
.
d¡MacSŒide
 = 
	$bªd
(
·¿ms
.
æowsP”SŒ—m
, 0xffffffffffff)

1213 
’d


1214 
·¿ms
.
¤cIpSŒide
 =ğ0 
th’


1215 
·¿ms
.
¤cIpSŒide
 = 
	$bªd
(
·¿ms
.
æowsP”SŒ—m
, 0xffffffff)

1216 
’d


1217 
·¿ms
.
d¡IpSŒide
 =ğ0 
th’


1218 
·¿ms
.
d¡IpSŒide
 = 
	$bªd
(
·¿ms
.
æowsP”SŒ—m
, 0xffffffff)

1219 
’d


1220 
·¿ms
.
¤cPÜtSŒide
 =ğ0 
th’


1221 
·¿ms
.
¤cPÜtSŒide
 = 
	$bªd
(
·¿ms
.
æowsP”SŒ—m
, 0xffff)

1222 
’d


1223 
·¿ms
.
d¡PÜtSŒide
 =ğ0 
th’


1224 
·¿ms
.
d¡PÜtSŒide
 = 
	$bªd
(
·¿ms
.
æowsP”SŒ—m
, 0xffff)

1225 
’d


1226 
’d


1229 -- 
Pršts
 
the
 
exam¶e
 
u§ge
 th
·ck‘
 
g’”©iÚ
.

1231 
funùiÚ
 
	$´štU§ge
()

1232 
loÿl
 
u§ge
 = 
¡ršg
.
	`fÜm©
(

1335 
	$´št
(
u§ge
)

1336 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/pcap/replay-pcap.lua

1 --- 
R•Ïy
 
a
 
pÿp
 
	gfe
.

3 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
¡©s
 = 
»quœe
 "stats"

7 
loÿl
 
log
 = 
»quœe
 "log"

8 
loÿl
 
pÿp
 = 
»quœe
 "pcap"

9 
loÿl
 
lim™”
 = 
»quœe
 "software-ratecontrol"

11 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

12 
·r£r
:
	`¬gum’t
("dev", "DeviûØu£."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

13 
·r£r
:
	`¬gum’t
("fe", "FtØ»¶ay."):
	$¬gs
(1)

14 
·r£r
:
	`İtiÚ
("-¸--¿‹-muÉl›r", "S³ed u°Ü slow dowÀ»¶ay, 1 = u£ iÁ”v® äom fe, deçuÉ =„•Ïy‡ ç¡‡ possibË"):(0):
	$cÚv”t
(
tÚumb”
):
	`rg‘
("rateMultiplier")

15 
·r£r
:
	`İtiÚ
("- --bufãr-æush-time", "TimtØwa™ befÜ¡İpšg MoÚG’‡á”ƒnqueušg‡Î…ack‘s. Inü—£ fÜ…ÿp w™h‡ v”y†ow„©e."):(10):
	$cÚv”t
(
tÚumb”
):
	`rg‘
("bufferFlushTime")

16 
·r£r
:
	`æag
("-l --loop", "Repeat…cap file.")

17 
loÿl
 
¬gs
 = 
·r£r
:
	$·r£
()

18  
¬gs


19 
’d


21 
funùiÚ
 
	$ma¡”
(
¬gs
)

22 
loÿl
 
dev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
	}
dev}

23 
deviû
.
	$wa™FÜLšks
()

24 
loÿl
 
¿‹Lim™”


25 
¬gs
.
¿‹MuÉl›r
 > 0 
th’


26 
¿‹Lim™”
 = 
lim™”
:
	`Ãw
(
dev
:
	`g‘TxQueue
(0), "custom")

27 
’d


28 
loÿl
 
»¶ay”
 = 
mg
.
	`¡¬tTask
("»¶ay", 
dev
:
	`g‘TxQueue
(0), 
¬gs
.
fe
,‡rgs.
loİ
, 
¿‹Lim™”
,‡rgs.
¿‹MuÉl›r
,‡rgs.
bufãrFlushTime
)

29 
¡©s
.
¡¬tStsTask
{
txDeviûs
 = {
dev
}
	}
}

30 
	g»¶ay”
:
	$wa™
()

31 
mg
:
	$¡İ
()

32 
mg
.
	$wa™FÜTasks
()

33 
’d


35 
funùiÚ
 
	$»¶ay
(
queue
, 
fe
, 
loİ
, 
¿‹Lim™”
, 
muÉl›r
, 
¦“pTime
)

36 
loÿl
 
mempoŞ
 = 
memÜy
:
	$ü—‹MemPoŞ
(4096)

37 
loÿl
 
bufs
 = 
mempoŞ
:
	$bufA¼ay
()

38 
loÿl
 
pÿpFe
 = 
pÿp
:
	$ÃwR—d”
(
fe
)

39 
loÿl
 
´ev
 = 0

40 
loÿl
 
lškS³ed
 = 
queue
.
dev
:
	`g‘LškStus
().
¥“d


41 
mg
.
	$ruÂšg
() do

42 
loÿl
 
n
 = 
pÿpFe
:
	$»ad
(
bufs
)

43 
n
 > 0 
th’


44 
¿‹Lim™”
 ~ğ
n
 
th’


45 
´ev
 =ğ0 
th’


46 
´ev
 = 
bufs
.
¬¿y
[0].
ud©a64


47 
’d


48 
i
 = 1, 
n
 do

49 
loÿl
 
buf
 = 
bufs
[
i
]

50 -- 
ts
 
is
 
š
 
miüo£cÚds


51 
loÿl
 
ts
 = 
buf
.
ud©a64


52 
´ev
 > 
ts
 
th’


53 
ts
 = 
´ev


54 
’d


55 
loÿl
 
d–ay
 = 
ts
 - 
´ev


56 
d–ay
 = 
	`tÚumb”
(d–ay * 10^3è/ 
muÉl›r
 -- 
Çno£cÚds


57 
d–ay
 = d–ay / (8000 / 
lškS³ed
è-- d–ay 
š
 
by‹s


58 
buf
:
	$£tD–ay
(
d–ay
)

59 
´ev
 = 
ts


60 
’d


61 
’d


63 
loİ
 
th’


64 
pÿpFe
:
	$»£t
()

67 
’d


68 
’d


69 
¿‹Lim™”
 
th’


70 
¿‹Lim™”
:
	$£ndN
(
bufs
, 
n
)

72 
queue
:
	$£ndN
(
bufs
, 
n
)

73 
’d


74 
’d


75 
log
:
	`šfo
("Enqueued‡Î…ack‘s, wa™šg fÜ %d secÚd fÜ queue tØæush", 
¦“pTime
)

76 
mg
.
	$¦“pMlisIdË
(
¦“pTime
 * 1000)

77 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/quality-of-service-test.lua

1 --- 
This
 
süt
 
im¶em’ts
 
a
 
sim¶e
 
QoS
 
‹¡
 
by
 
g’”©šg
 
two
 
æows
 
ªd
 
m—suršg
 
theœ
 
	gÏ‹nc›s
.

2 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

3 
loÿl
 
memÜy
 = 
»quœe
 "memory"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

5 
loÿl
 
ts
 = 
»quœe
 "timestamping"

6 
loÿl
 
f‹r
 = 
»quœe
 "filter"

7 
loÿl
 
¡©s
 = 
»quœe
 "stats"

8 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

9 
loÿl
 
tim”
 = 
»quœe
 "timer"

10 
loÿl
 
log
 = 
»quœe
 "log"

12 
loÿl
 
PKT_SIZE
 = 124 -- 
w™hout
 
CRC


13 -- 
check
 
out
 
l3
-
lßd
-
Ï‹ncy
.
lua
 
you
 
wªt
 
to
 
g‘
 
this
 
vŸ
 
ARP


14 
loÿl
 
ETH_DST
 = "10:11:12:13:14:15" -- 
¤c
 
mac
 
is
 
k’
 
äom
 
the
 
NIC


15 
loÿl
 
IP_SRC
 = "192.168.0.1"

16 
loÿl
 
NUM_FLOWS
 = 256 -- 
¤c
 

 
wl
 
be
 
IP_SRC
 + 
¿ndom
(0, NUM_FLOWS - 1)

17 
loÿl
 
	gIP_DST
 = "10.0.0.1"

18 
loÿl
 
PORT_SRC
 = 1234

19 
loÿl
 
PORT_FG
 = 42

20 
loÿl
 
PORT_BG
 = 43

22 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

23 
·r£r
:
	`desütiÚ
("Generateswo flows ofraffic‡nd compareshem.Â Thisƒxample„equires‡n ixgbe NIC dueohe used hardware features.")

24 
·r£r
:
	`¬gum’t
("txDev", "DeviûØŒªsm™ from."):
	$cÚv”t
(
tÚumb”
)

25 
·r£r
:
	`¬gum’t
("rxDev", "DeviûØ»ûiväom."):
	$cÚv”t
(
tÚumb”
)

26 
·r£r
:
	`İtiÚ
("-à--fg-¿‹", "FÜeground¿ffiø¿‹ iÀMb™/s."):(1000):
	$cÚv”t
(
tÚumb”
):
	`rg‘
("fgRate")

27 
·r£r
:
	`İtiÚ
("-b --bg-¿‹", "Background¿ffiø¿‹ iÀMb™/s."):(4000):
	$cÚv”t
(
tÚumb”
):
	`rg‘
("bgRate")

28 
’d


30 
funùiÚ
 
	`ma¡”
(
¬gs
)

31 -- 3 
tx
 
queues
: 
Œaffic
, 
background
¿ffic, 
ªd
 
time¡am³d
 
·ck‘s


32 -- 2 
rx
 
queues
: 
Œaffic
 
ªd
 
time¡am³d
 
·ck‘s


33 
loÿl
 
txDev
, 
rxDev


34 -- 
the£
 
two
 
ÿ£s
 
could
 
aùu®ly
 
be
 
m”ged
 
as
 
»
-
cÚfigu¿tiÚs
 
of
 
pÜts
 
¬e
 
ignÜed


35 -- 
the
 
du®
-
pÜt
 
could
 
ju¡
 
cÚfig
h'fœ¡' 
deviû
 
w™h
 2/3 
queues


36 -- 
howev”
, 
this
 
exam¶e
 
süts
 
shows
 
the
 
ex¶ic™
 
cÚfigu¿tiÚ
 
š¡—d
 
of
 
im¶ic™
 
magic


37 
¬gs
.
txDev
 =ğ¬gs.
rxDev
 
th’


38 -- 
£ndšg
 
ªd
 
»ûivšg
 
äom
 
the
 
§me
 
pÜt


39 
txDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.txDev, 
rxQueues
 = 2, 
txQueues
 = 3
	}
}

40 
	grxDev
 = 
txDev


42 -- 
two
 
difã»Á
 
pÜts
, difã»Á 
cÚfigu¿tiÚ


43 
	gtxDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
txDev
, 
	grxQueues
 = 1, 
	gtxQueues
 = 3}

44 
	grxDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
rxDev
, 
	grxQueues
 = 2}

45 
	g’d


46 -- 
wa™
 
uÁ
 
the
 
lšks
 
¬e
 
up


47 
	gdeviû
.
	$wa™FÜLšks
()

48 
log
:
	`šfo
("S’dšg %d MB™/ background¿ffiøtØUDP…Üˆ%d", 
¬gs
.
bgR©e
, 
PORT_BG
)

49 
log
:
	`šfo
("S’dšg %d MB™/ fÜeground¿ffiøtØUDP…Üˆ%d", 
¬gs
.
fgR©e
, 
PORT_FG
)

50 -- 
£tup
 
¿‹
 
lim™”s
 
CBR
 
Œaffic


51 -- 
£e
 
l2
-
poissÚ
.
lua
 
ª
 
exam¶e
 
w™h
 
difã»Á
 
Œaffic
 
·‰”ns


52 
txDev
:
	$g‘TxQueue
(0):
	$£tR©e
(
¬gs
.
bgR©e
)

53 
txDev
:
	$g‘TxQueue
(1):
	`£tR©e
(
¬gs
.
fgR©e
)

54 -- 
background
 
Œaffic


55 
¬gs
.
bgR©e
 > 0 
th’


56 
mg
.
	`¡¬tTask
("lßdSÏve", 
txDev
:
	`g‘TxQueue
(0), 
PORT_BG
)

57 
’d


58 -- 
high
 
´iÜ™y
 
	$Œaffic
 (
difã»Á
 
UDP
 
pÜt
)

59 
¬gs
.
fgR©e
 > 0 
th’


60 
mg
.
	`¡¬tTask
("lßdSÏve", 
txDev
:
	`g‘TxQueue
(1), 
PORT_FG
)

61 
’d


62 -- 
couÁ
 
the
 
šcomšg
 
·ck‘s


63 
mg
.
	`¡¬tTask
("couÁ”SÏve", 
rxDev
:
	`g‘RxQueue
(0))

64 -- 
m—su»
 
Ï‹ncy
 
äom
 
a
 
£cÚd
 
queue


65 
mg
.
	`¡¬tSh¬edTask
("tim”SÏve", 
txDev
:
	`g‘TxQueue
(2), 
rxDev
:
	`g‘RxQueue
(1), 
PORT_BG
, 
PORT_FG
, 
¬gs
.
fgR©e
 / (¬gs.fgR©+‡rgs.
bgR©e
))

66 -- 
wa™
 
uÁ
 
®l
 
sks
 
¬e
 
fšished


67 
mg
.
	$wa™FÜTasks
()

68 
’d


70 
funùiÚ
 
	$lßdSÏve
(
queue
, 
pÜt
)

71 
mg
.
	`¦“pMlis
(100è-- 
wa™
 
a
 
ãw
 
mli£cÚds
 
to
 
’su»
 
th©
 
the
 
rx
 
th»ad
 
is
 
ruÂšg


72 -- 
TODO
: 
im¶em’t
 
b¬r›rs


73 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

74 
buf
:
	$g‘UdpPack‘
():
fl
{

75 
pktL’gth
 = 
PKT_SIZE
, -- 
this
 
£ts
 
®l
 
Ëngth
 
h—d”s
 
f›lds
 
š
‡Î 
u£d
 
´ÙocŞs


76 
‘hSrc
 = 
queue
, -- 
g‘
 
the
 
¤c
 
mac
 
äom
h
deviû


77 
‘hD¡
 = 
ETH_DST
,

78 -- 
Src
 
wl
 
be
 
£t
 
Ï‹r
 
as
 
™
 
v¬›s


79 
4D¡
 = 
IP_DST
,

80 
udpSrc
 = 
PORT_SRC
,

81 
udpD¡
 = 
pÜt
,

82 -- 
·ylßd
 
wl
 
be
 
š™Ÿlized
 
to
 0x00 
as
 
Ãw
 
memÜy
 
poŞs
 
¬e
 
š™ŸÎy
 
em±y


83 
	}
}

84 
	g’d
)

85 -- 
	gTODO
: 
fix
 
³r
-
queue
 
¡©s
 
couÁ”s
 
to
 
u£
 
the
 
¡©i¡ics
 
»gi¡”s
 
h”e


86 
loÿl
 
txCŒ
 = 
¡©s
:
ÃwMªu®TxCouÁ”
("PÜˆ" .. 
pÜt
, "plain")

87 
loÿl
 
	gba£IP
 = 
·r£IPAdd»ss
(
IP_SRC
)

88 -- 
a
 
buf
 
¬¿y
 
is
 
es£ÁŸÎy
‡ 
v”y
 
thšg
 
w¿µ”
 
¬ound
‡ 
¹e_mbuf
*[], 
	gi
.
	ge
. 
ª
‡¼ay 
of
 
poš‹rs
 
to
 
·ck‘
 
bufãrs


89 
loÿl
 
	gbufs
 = 
mem
:
	$bufA¼ay
()

90 
mg
.
	$ruÂšg
() do

91 -- 
®loÿ‹
 
bufãrs
 
äom
 
the
 
mem
 
poŞ
 
ªd
 
¡Üe
 
them
 
š
 
this
 
¬¿y


92 
bufs
:
	$®loc
(
PKT_SIZE
)

93 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

94 -- 
modify
 
some
 
f›lds
 
h”e


95 
loÿl
 
pkt
 = 
buf
:
	`g‘UdpPack‘
()

96 -- 
£Ëù
 
a
 
¿ndomized
 
sourû
 
IP
 
add»ss


97 -- 
you
 
ÿn
 
®so
 
u£
 
a
 
w¿µšg
 
couÁ”
 
š¡—d
 
of
 
¿ndom


98 
pkt
.
4
.
¤c
:
	`£t
(
ba£IP
 + 
m©h
.
	`¿ndom
(
NUM_FLOWS
) - 1)

99 -- 
you
 
ÿn
 
modify
 
Ùh”
 
f›lds
 
	$h”e
 (
e
.
g
. 
difã»Á
 
sourû
 
pÜts
 
Ü
 
de¡š©iÚ
 
add»s£s
)

100 
’d


101 -- 
£nd
 
·ck‘s


102 
bufs
:
	$ofæßdUdpChecksums
()

103 
txCŒ
:
	`upd©eW™hSize
(
queue
:
	`£nd
(
bufs
), 
PKT_SIZE
)

104 
’d


105 
txCŒ
:
	$fš®ize
()

106 
’d


108 
funùiÚ
 
	`couÁ”SÏve
(
queue
)

109 -- 
the
 
sim¶e¡
 
way
 
to
 
couÁ
 
·ck‘s
 
is
 
by
 
»ûivšg
 
them
 
®l


110 -- 
ª
 
®‹º©ive
 
would
 
be
 
usšg
 
æow
 
dœeùÜ
 
to
 
f‹r
 
·ck‘s
 
by
 
pÜt
 
ªd
 
u£
 
the
 
queue
 
¡©i¡ics


111 -- 
howev”
, 
the
 
cu¼’t
 
im¶em’tiÚ
 
is
 
lim™ed
 
to
 
f‹ršg
 
time¡amp
 
·ck‘s


112 -- (
chªgšg
 
this
 
wouldn
't beoo complicated, have‡†ook‡t filter.lua if you wanto implementhis)

113 -- 
howev”
, 
queue
 
¡©i¡ics
 
¬e
 
®so
 
nÙ
 
y‘
 
im¶em’‹d
 
ªd
 
the
 
DPDK
 
ab¡¿ùiÚ
 
is
 
somewh©
 
ªnoyšg


114 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

115 
loÿl
 
ùrs
 = {
	}
}

116 
mg
.
	$ruÂšg
(100) do

117 
loÿl
 
rx
 = 
queue
:
	$»cv
(
bufs
)

118 
i
 = 1, 
rx
 do

119 
loÿl
 
buf
 = 
bufs
[
i
]

120 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

121 
loÿl
 
pÜt
 = 
pkt
.
udp
:
	$g‘D¡PÜt
()

122 
loÿl
 
ùr
 = 
ùrs
[
pÜt
]

123 
nÙ
 
ùr
 
th’


124 
ùr
 = 
¡©s
:
	`ÃwPktRxCouÁ”
("PÜˆ" .. 
pÜt
, "plain")

125 
ùrs
[
pÜt
] = 
ùr


126 
’d


127 
ùr
:
	$couÁPack‘
(
buf
)

128 
’d


129 -- 
	$upd©e
(è
Ú
 
rxPktCouÁ”s
 
mu¡
 
be
 
ÿÎed
 
to
 
´št
 
¡©i¡ics
 
³riodiÿÎy


130 -- 
this
 
is
 
nÙ
 
dÚe
 
š
 
	$couÁPack‘
(è
³rfÜmªû
 
	$»asÚs
 (
Ãeds
 
to
 
check
 
time¡amps
)

131 
k
, 
v
 
š
 
	$·œs
(
ùrs
) do

132 
v
:
	$upd©e
()

133 
’d


134 
bufs
:
	$ä“AÎ
()

135 
’d


136 
k
, 
v
 
š
 
	$·œs
(
ùrs
) do

137 
v
:
	$fš®ize
()

138 
’d


139 -- 
TODO
: 
check
 
the
 
queue
's overflow countero detect†ost…ackets

140 
’d


143 
funùiÚ
 
	$tim”SÏve
(
txQueue
, 
rxQueue
, 
bgPÜt
, 
pÜt
, 
¿tio
)

144 
loÿl
 
txDev
 = 
txQueue
.
dev


145 
loÿl
 
rxDev
 = 
rxQueue
.
dev


146 
loÿl
 
time¡am³r
 = 
ts
:
	$ÃwUdpTime¡am³r
(
txQueue
, 
rxQueue
)

147 
loÿl
 
hi¡Bg
, 
hi¡Fg
 = 
	`hi¡
(), hist()

148 -- 
wa™
 
Úe
 
£cÚd
, 
Ùh”wi£
 
we
 
might
 
¡¬t
 
time¡ampšg
 
befÜe
 
the
 
lßd
 
is
 
­¶›d


149 
mg
.
	$¦“pMlis
(1000)

150 
loÿl
 
ba£IP
 = 
	$·r£IPAdd»ss
(
IP_SRC
)

151 
loÿl
 
¿‹Lim™
 = 
tim”
:
	$Ãw
(0.001)

152 
mg
.
	$ruÂšg
() do

153 
loÿl
 
pÜt
 = 
m©h
.
	`¿ndom
(è<ğ
¿tio
 
ªd
…Üˆ
Ü
 
bgPÜt


154 
loÿl
 
Ït
 = 
time¡am³r
:
	`m—su»L©’cy
(
PKT_SIZE
, 
	$funùiÚ
(
buf
)

155 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

156 
pkt
:
fl
{

157 
pktL’gth
 = 
PKT_SIZE
, -- 
this
 
£ts
 
®l
 
Ëngth
 
h—d”s
 
f›lds
 
š
‡Î 
u£d
 
´ÙocŞs


158 
‘hSrc
 = 
txQueue
, -- 
g‘
 
the
 
¤c
 
mac
 
äom
h
deviû


159 
‘hD¡
 = 
ETH_DST
,

160 -- 
Src
 
wl
 
be
 
£t
 
Ï‹r
 
as
 
™
 
v¬›s


161 
4D¡
 = 
IP_DST
,

162 
udpSrc
 = 
PORT_SRC
,

163 
udpD¡
 = 
pÜt
,

164 
	}
}

165 
	gpkt
.
	g4
.
	g¤c
:
£t
(
ba£IP
 + 
m©h
.
¿ndom
(
NUM_FLOWS
) - 1)

166 
’d
)

167 
Ït
 
th’


168 
pÜt
 =ğ
bgPÜt
 
th’


169 
hi¡Bg
:
	$upd©e
(
Ït
)

171 
hi¡Fg
:
	$upd©e
(
Ït
)

172 
’d


173 
’d


174 
¿‹Lim™
:
	$wa™
()

175 
¿‹Lim™
:
	$»£t
()

176 
’d


177 
mg
.
	`¦“pMlis
(100è-- 
to
 
´ev’t
 
ov”Ïµšg
 
¡dout


178 
hi¡Bg
:
	`§ve
("hist-background.csv")

179 
hi¡Fg
:
	`§ve
("hist-foreground.csv")

180 
hi¡Bg
:
	`´št
("Backgroundraffic")

181 
hi¡Fg
:
	`´št
("Foregroundraffic")

182 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/rate-control-methods.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

5 
loÿl
 
¡©s
 = 
»quœe
 "stats"

6 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

7 
loÿl
 
log
 = 
»quœe
 "log"

8 
loÿl
 
lim™”
 = 
»quœe
 "software-ratecontrol"

10 
loÿl
 
PKT_SIZE
 = 60

11 
loÿl
 
ETH_DST
 = "11:12:13:14:15:16"

13 
funùiÚ
 
	$ma¡”
(
txPÜt
, 
¿‹
, 
rc
, 
·‰”n
, 
th»ads
)

14 
nÙ
 
txPÜt
 
Ü
‚Ù 
¿‹
 o¸nÙ 
rc
 
th’


15  
	`´št
("usage:xPort„ate|us hw|sw|moongen cbr|poisson|custom [threads]")

16 
’d


17 
¿‹
 =„©
Ü
 2

18 
th»ads
 =h»ad 
Ü
 1

19 
·‰”n
 =…©‹º 
Ü
 "cbr"

20 
·‰”n
 =ğ"cbr" 
ªd
 
th»ads
 ~ğ1 
th’


21  
log
:
	`”rÜ
("cbr only supports onehread")

22 
’d


23 
loÿl
 
txDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
txPÜt
, 
txQueues
 = 
th»ads
, 
di§bËOfæßds
 = 
rc
 ~ğ"moÚg’"
	}
}

24 
	gdeviû
.
	$wa™FÜLšks
()

25 
¡©s
.
¡¬tStsTask
{
txDeviûs
 = {
txDev
}
	}
}

26 
	gi
 = 1, 
th»ads
 do

27 
loÿl
 
¿‹Lim™”


28 
	grc
 =ğ"sw" 
th’


29 
¿‹Lim™”
 = 
lim™”
:
Ãw
(
txDev
:
g‘TxQueue
(
i
 - 1), 
·‰”n
, 1 / 
¿‹
 * 1000)

30 
’d


31 
	gmg
.
¡¬tTask
("lßdSÏve", 
txDev
:
g‘TxQueue
(
i
 - 1),xDev, 
¿‹
, 
rc
, 
·‰”n
, 
¿‹Lim™”
, i, 
th»ads
)

32 
’d


33 
	gmg
.
	$wa™FÜTasks
()

34 
’d


36 
funùiÚ
 
	$lßdSÏve
(
queue
, 
txDev
, 
¿‹
, 
rc
, 
·‰”n
, 
¿‹Lim™”
, 
th»adId
, 
numTh»ads
)

37 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(4096, 
	$funùiÚ
(
buf
)

38 
buf
:
	$g‘UdpPack‘
():
fl
{

39 
‘hSrc
 = 
txDev
,

40 
‘hD¡
 = 
ETH_DST
,

41 
pktL’gth
 = 
PKT_SIZE


42 
	}
}

43 
	g’d
)

44 
	grc
 =ğ"hw" 
th’


45 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
()

46 
·‰”n
 ~ğ"cbr" 
th’


47  
log
:
	`”rÜ
("HW only supports CBR")

48 
’d


49 
queue
:
	`£tR©e
(
¿‹
 * (
PKT_SIZE
 + 4) * 8)

50 
mg
.
	`¦“pMlis
(100è-- 
good
 
m—asu»


51 
mg
.
	$ruÂšg
() do

52 
bufs
:
	$®loc
(
PKT_SIZE
)

53 
queue
:
	$£nd
(
bufs
)

54 
’d


55 
–£if
 
rc
 =ğ"sw" 
th’


56 -- 
Ïrg”
 
b©ch
 
size
 
is
 
u£ful
 
wh’
 
£ndšg
 
™
 
through
 
a
 
¿‹
 
lim™”


57 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
(128)

58 
loÿl
 
lškS³ed
 = 
txDev
:
	`g‘LškStus
().
¥“d


59 
mg
.
	$ruÂšg
() do

60 
bufs
:
	$®loc
(
PKT_SIZE
)

61 
·‰”n
 =ğ"cu¡om" 
th’


62 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

63 
buf
:
	`£tD–ay
(
¿‹
 * 
lškS³ed
 / 8)

64 
’d


65 
’d


66 
¿‹Lim™”
:
	$£nd
(
bufs
)

67 
’d


68 
–£if
 
rc
 =ğ"moÚg’" 
th’


69 -- 
Ïrg”
 
b©ch
 
size
 
is
 
u£ful
 
wh’
 
£ndšg
 
™
 
through
 
a
 
¿‹
 
lim™”


70 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
(128)

71 
loÿl
 
di¡
 = 
·‰”n
 =ğ"poissÚ" 
ªd
 
poissÚD–ay
 
Ü
 
	$funùiÚ
(
x
è x 
’d


72 
mg
.
	$ruÂšg
() do

73 
bufs
:
	$®loc
(
PKT_SIZE
)

74 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

75 
buf
:
	`£tD–ay
(
	`di¡
(10^10 / 
numTh»ads
 / 8 / (
¿‹
 * 10^6è- 
PKT_SIZE
 - 24))

76 
’d


77 
queue
:
	$£ndW™hD–ay
(
bufs
, 
¿‹
 * 
numTh»ads
)

78 
’d


80 
log
:
	`”rÜ
("Unknown„ate control method")

81 
’d


82 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/rss.lua

1 -- 
	gvim
:
ts
=4:
sw
=4:
nÛx·ndb


2 --- 
How
 
to
 
cÚfigu»
 
RSS


3 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

4 
loÿl
 
memÜy
 = 
»quœe
 "memory"

5 
loÿl
 
deviû
 = 
»quœe
 "device"

6 
loÿl
 
¡©s
 = 
»quœe
 "stats"

7 
loÿl
 
log
 = 
»quœe
 "log"

9 
loÿl
 
PKT_SIZE
 = 60

10 
loÿl
 
NUM_FLOWS
 = 100

12 
funùiÚ
 
	$ma¡”
(
txPÜt
, 
rxPÜt
, 
rxQueues
)

13 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 
th’


14 
log
:
	`šfo
("Usage:xPort„xPort [rxQueues]")

16 
’d


17 
rxQueues
 =„xQueue 
Ü
 2

18 
loÿl
 
txDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
txPÜt
}

19 
loÿl
 
rxDev
 = 
deviû
.
cÚfig
{

20 
pÜt
 = 
rxPÜt
,

21 
	grxQueues
 = 
rxQueues
 + 1,

22 
	grssQueues
 = 
rxQueues
,

23 
	grssBa£Queue
 = 1 -- 
İtiÚ®
 
ªd
 
deçuÉs
 
to
 0

25 
	gdeviû
.
	$wa™FÜLšks
()

26 
dpdk
.
	`ÏunchLua
("txSÏve", 
txDev
:
	$g‘TxQueue
(0))

27 
i
 = 1, 
rxQueues
 do

28 
dpdk
.
	`ÏunchLua
("rxSÏve", 
rxDev
:
	$g‘RxQueue
(
i
))

29 
’d


30 
dpdk
.
	$wa™FÜSÏves
()

31 
’d


33 
funùiÚ
 
	$txSÏve
(
queue
)

34 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

35 
buf
:
	$g‘UdpPack‘
():
fl
{

36 
‘hSrc
 = 
queue
,

37 
pktL’gth
 = 
PKT_SIZE


38 
	}
}

39 
	g’d
)

40 
loÿl
 
	gbufs
 = 
mempoŞ
:
	$bufA¼ay
()

41 
loÿl
 
couÁ”
 = 0

42 
loÿl
 
txCŒ
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
queue
, "plain")

43 
dpdk
.
	$ruÂšg
() do

44 
bufs
:
	$®loc
(
PKT_SIZE
)

45 
i
, 
buf
 
š
 
	$aœs
(
bufs
) do

46 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

47 
pkt
.
udp
:
	`£tSrcPÜt
(1000 + 
couÁ”
)

48 
couÁ”
 = 
	$šcAndW¿p
(
couÁ”
, 
NUM_FLOWS
)

49 
’d


50 
bufs
:
	$ofæßdUdpChecksums
()

51 
queue
:
	$£nd
(
bufs
)

52 
txCŒ
:
	$upd©e
()

53 
’d


54 
txCŒ
:
	$fš®ize
()

55 
’d


57 
funùiÚ
 
	$rxSÏve
(
queue
)

58 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

59 
ùr
 = 
¡©s
:
	`ÃwPktRxCouÁ”
(
queue
, "plain")

60 
dpdk
.
	$ruÂšg
(100) do

61 
loÿl
 
rx
 = 
queue
:
	$»cv
(
bufs
)

62 
i
 = 1, 
rx
 do

63 
loÿl
 
buf
 = 
bufs
[
i
]

64 
ùr
:
	$couÁPack‘
(
buf
)

65 
’d


66 
ùr
:
	$upd©e
()

67 
bufs
:
	$ä“
(
rx
)

68 
’d


69 
ùr
:
	$fš®ize
()

70 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/rx-pkts-distribution.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "dpdk"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
¡©s
 = 
»quœe
 "stats"

5 
loÿl
 
hi¡og¿m
 = 
»quœe
 "histogram"

6 
loÿl
 
log
 = 
»quœe
 "log"

7 
loÿl
 
tim”
 = 
»quœe
 "timer"

10 
funùiÚ
 
	$ma¡”
(
rxPÜt
, 
§veIÁ”v®
)

11 
nÙ
 
rxPÜt
 
th’


12  
log
:
	`šfo
("usage:„xPort [saveInterval]")

13 
’d


14 -- 
TODO
: 
RSS
?

15 
loÿl
 
§veIÁ”v®
 = saveIÁ”v® 
Ü
 60

16 
loÿl
 
rxDev
 = 
deviû
.
cÚfig
{ 
pÜt
 = 
rxPÜt
, 
drİEÇbË
 = 
çl£
 
	}
}

17 
	gdeviû
.
	$wa™FÜLšks
()

18 
mg
.
	`ÏunchLua
("couÁ”SÏve", 
rxDev
:
	`g‘RxQueue
(0), 
§veIÁ”v®
)

19 
mg
.
	$wa™FÜSÏves
()

20 
’d


23 
funùiÚ
 
	$couÁ”SÏve
(
queue
, 
§veIÁ”v®
)

24 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

25 
loÿl
 
ùrs
 = {
	}
}

26 
loÿl
 
rxCŒ
 = 
¡©s
:
ÃwDevRxCouÁ”
(
queue
.
dev
)

27 -- 
to
 
Œack
 
we
 
lo£
 
·ck‘s
 
Ú
 
the
 
NIC


28 
loÿl
 
pktCŒ
 = 
¡©s
:
ÃwPktRxCouÁ”
("Packets counted", "plain")

29 
loÿl
 
	ghi¡
 = 
hi¡og¿m
:
	$ü—‹
()

30 
loÿl
 
tim”
 =im”:
	$Ãw
(
§veIÁ”v®
)

31 
mg
.
	$ruÂšg
() do

32 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 100)

33 
i
 = 1, 
rx
 do

34 
loÿl
 
buf
 = 
bufs
[
i
]

35 
loÿl
 
size
 = 
buf
:
	$g‘Size
()

36 
hi¡
:
	$upd©e
(
size
)

37 
pktCŒ
:
	$couÁPack‘
(
buf
)

38 
’d


39 
bufs
:
	$ä“
(
rx
)

40 
rxCŒ
:
	$upd©e
()

41 
pktCŒ
:
	$upd©e
()

42 
tim”
:
	$expœed
(è
th’


43 -- 
FIXME
: 
this
 
is
 
»®ly
 
¦ow
 
ªd
 
might
 
lo£
 
·ck‘s


44 -- 
howev”
, 
the
 
hi¡og¿m
 
sucks
 
ªd
 
movšg
 
this
 
to
 
ªÙh”
 
th»ad
 
would
 
»quœe
 
a
 
»wr™e


45 
tim”
:
	$»£t
()

46 
hi¡
:
	$´št
()

47 
hi¡
:
	`§ve
("hi¡" .. 
	`time
() .. ".csv")

48 
’d


49 
’d


50 
rxCŒ
:
	$fš®ize
()

51 
pktCŒ
:
	`fš®ize
()

52 -- 
TODO
: 
check
 
the
 
queue
's overflow countero detect†ost…ackets

53 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/timestamping-tests/drift.lua

1 
loÿl
 
	gdpdk
 = 
»quœe
 "dpdk"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
dev
 = 
»quœe
 "device"

4 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

5 
loÿl
 
ts
 = 
»quœe
 "timestamping"

6 
loÿl
 
ffi
 = 
»quœe
 "ffi"

8 
funùiÚ
 
	$ma¡”
(...)

9 
loÿl
 
pÜt1
, 
pÜt2
 = 
	$tÚumb”®l
(...)

10 
nÙ
 
pÜt1
 
Ü
‚Ù 
pÜt2
 
th’


11 
	`”rÜf
("usage:…ort1…ort2")

12 
’d


13 
loÿl
 
dev1
 = 
dev
.
	$cÚfig
(
pÜt1
)

14 
loÿl
 
dev2
 = 
dev
.
	$cÚfig
(
pÜt2
)

15 
loÿl
 
q1
 = 
dev1
:
	$g‘RxQueue
(0)

16 
loÿl
 
q2
 = 
dev2
:
	$g‘RxQueue
(0)

17 
dev
.
	`wa™FÜLšks
()

19 -- 
this
 
¡¬ts
 
the
 
şock


20 
q1
:
	$’abËTime¡amps
()

21 
q2
:
	$’abËTime¡amps
()

22 
ts
.
	$syncClocks
(
dev1
, 
dev2
)

23 
	`´št
("Clock difference in‚anoseconds, one value…er second")

24 
	`´št
("Caution:his contains some systematicƒrror inhe microsecond-range‡she clocks‡re„ead sequentially")

25 
	`´št
("Only usehese valueso determine clock drift")

26 
	`´št
("Note:heimestamper„e-sycnshe clocks betweenƒvery…acket by defaulto‡void…otential drift. See code.")

27 
dpdk
.
	$ruÂšg
() do

28 
dpdk
.
	$¦“pMlis
(1000, 
Œue
)

29 
	`´št
(
dev1
:
	`»adTime
(è- 
dev2
:
	$»adTime
())

30 
’d


31 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/timestamping-tests/timestamps-software.lua

1 --- 
Soáw¬e
 
time¡ampšg
 
´ecisiÚ
 
	g‹¡
.

2 --- (
U£d
 
ª
 
ev®u©iÚ
 
a
 
	g·³r
)

3 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

5 
loÿl
 
deviû
 = 
»quœe
 "device"

6 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

7 
loÿl
 
memÜy
 = 
»quœe
 "memory"

8 
loÿl
 
¡©s
 = 
»quœe
 "stats"

9 
loÿl
 
tim”
 = 
»quœe
 "timer"

10 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
loÿl
 
PKT_SIZE
 = 60

14 
loÿl
 
NUM_PKTS
 = 10^6

16 
funùiÚ
 
	$ma¡”
(
txPÜt
, 
rxPÜt
, 
lßd
)

17 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 o¸
	`ty³
(
lßd
è~ğ"numb”" 
th’


18 
	`”rÜf
("usage:xPort„xPort†oad")

19 
’d


20 
loÿl
 
txDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 2
	}
}

21 
loÿl
 
	grxDev
 = 
deviû
.
cÚfig
{
pÜt
 = 
rxPÜt
, 
	grxQueues
 = 2, 
	gtxQueues
 = 2}

22 
	gdeviû
.
	$wa™FÜLšks
()

23 
txDev
:
	$g‘TxQueue
(0):
	$£tR©e
(
lßd
)

24 
lßd
 > 0 
th’


25 
mg
.
	`¡¬tTask
("lßdSÏve", 
txDev
:
	$g‘TxQueue
(0))

26 
’d


27 
mg
.
	`¡¬tTask
("txTime¡am³r", 
txDev
:
	$g‘TxQueue
(1))

28 
mg
.
	`¡¬tTask
("rxTime¡am³r", 
rxDev
:
	$g‘RxQueue
(1))

29 
mg
.
	$wa™FÜTasks
()

30 
’d


32 
funùiÚ
 
	$lßdSÏve
(
queue
)

33 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

34 
buf
:
	$g‘EthPack‘
():
fl
{

35 
	}
}

36 
’d
)

37 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
()

38 
loÿl
 
ùr
 = 
¡©s
:
	`ÃwDevTxCouÁ”
("Lßd T¿ffic", 
queue
.
dev
, "plain")

39 
mg
.
	$ruÂšg
() do

40 
bufs
:
	$®loc
(
PKT_SIZE
)

41 
queue
:
	$£nd
(
bufs
)

42 
ùr
:
	$upd©e
()

43 
’d


44 
ùr
:
	$fš®ize
()

45 
’d


47 
funùiÚ
 
	$txTime¡am³r
(
queue
)

48 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	`funùiÚ
(
buf
)

49 -- 
ju¡
 
to
 
u£
 
the
  
f‹r
 
h”e


50 -- 
you
 
ÿn
 
u£
 
wh©ev”
 
·ck‘
 
ty³
 you 
wªt


51 
buf
:
	$g‘UdpPPack‘
():
fl
{

52 
	}
}

53 
’d
)

54 
mg
.
¦“pMlis
(1000è-- 
’su»
 
th©
 
the
 
lßd
 
sk
 
is
 
ruÂšg


55 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
(1)

56 
loÿl
 
¿‹Lim™
 = 
tim”
:
	`Ãw
(0.0001è-- 10
kµs
 
time¡am³d
 
·ck‘s


57 
loÿl
 
i
 = 0

58 
i
 < 
NUM_PKTS
 
ªd
 
mg
.
	$ruÂšg
() do

59 
bufs
:
	$®loc
(
PKT_SIZE
)

60 
queue
:
	$£ndW™hTime¡amp
(
bufs
)

61 
¿‹Lim™
:
	$wa™
()

62 
¿‹Lim™
:
	$»£t
()

63 
i
 = i + 1

64 
’d


65 
mg
.
	$¦“pMlis
(500)

66 
mg
.
	$¡İ
()

67 
’d


69 
funùiÚ
 
	$rxTime¡am³r
(
queue
)

70 
loÿl
 
tscF»q
 = 
mg
.
	$g‘CyşesF»qu’cy
()

71 
loÿl
 
bufs
 = 
memÜy
.
	`bufA¼ay
(64)

72 -- 
u£
 
wh©ev”
 
f‹r
 
­´İrŸ‹
 
your
 
·ck‘
 
ty³


73 
queue
:
	$f‹rUdpTime¡amps
()

74 
loÿl
 
»suÉs
 = {
	}
}

75 
loÿl
 
rxts
 = {}

76 
mg
.
	$ruÂšg
() do

77 
loÿl
 
numPkts
 = 
queue
:
	$»cvW™hTime¡amps
(
bufs
)

78 
i
 = 1, 
numPkts
 do

79 
loÿl
 
rxTs
 = 
bufs
[
i
].
ud©a64


80 
loÿl
 
txTs
 = 
bufs
[
i
]:
	$g‘Soáw¬eTxTime¡amp
()

81 
»suÉs
[#»suÉ + 1] = 
	`tÚumb”
(
rxTs
 - 
txTs
è/ 
tscF»q
 * 10^9 -- 
to
 
Çno£cÚds


82 
rxts
[#rxt + 1] = 
	$tÚumb”
(
rxTs
)

83 
’d


84 
bufs
:
	$ä“
(
numPkts
)

85 
’d


86 
loÿl
 
f
 = 
io
.
	`İ’
("pings.txt", "w+")

87 
i
, 
v
 
š
 
	$aœs
(
»suÉs
) do

88 
f
:
	`wr™e
(
v
 .. "\n")

89 
’d


90 
f
:
	$şo£
()

91 
’d


	@/home/asabzi/msc-project/MoonGen-1/examples/vxlan-example.lua

1 -- 
This
 
süt
 
ÿn
 
be
 
u£d
 
to
 
bÙh
 
simuÏ‹
 
ªd
 
‹¡
 
a
 
	gVTEP


2 -- 
isEndpošt
 
isTuÂ–ed
 
d‘”mše
 
wh©
 
this
 
süt
 
	gdÛs
:

3 -- 0 0: 
S’d
 
‘h”Ãt
 
äames
, 
ex³ù
 
to
 
»ûive
 
VXLAN
 
·ck‘s
 (
the
 
’ÿpsuÏ‹d
ƒth”Ãˆ
äame
)

4 -- 0 1: 
S’d
 
VXLAN
 
·ck‘
, 
ex³ù
 
to
 
»ûive
 
the
 
deÿpsuÏ‹d
 
‘h”Ãt
 
	gäame


5 -- 1 0: 
Reûive
 
‘h”Ãt
 
äames
, 
’ÿpsuÏ‹
 
	gthem
, 
£nd
 
VXLAN
 
	g·ck‘


6 -- 1 1: 
Reûive
 
VXLAN
 
·ck‘s
, 
deÿpsuÏ‹
 
	gthem
, 
£nd
 
‘h”Ãt
 
äame


8 
loÿl
 
	gmg
 = 
»quœe
 "dpdk"

9 
loÿl
 
memÜy
 = 
»quœe
 "memory"

10 
loÿl
 
deviû
 = 
»quœe
 "device"

11 
loÿl
 
¡©s
 = 
»quœe
 "stats"

12 
loÿl
 
´Ùo
 = 
»quœe
 "proto.proto"

13 
loÿl
 
log
 = 
»quœe
 "log"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

16 
funùiÚ
 
	$ma¡”
(
txPÜt
, 
rxPÜt
, 
isEndpošt
, 
isTuÂ–ed
, 
¿‹
)

17 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 o¸nÙ 
isEndpošt
 o¸nÙ 
isTuÂ–ed
 
th’


18 
log
:
	`šfo
("usage:xPort„xPort isEndpoint isTunneled [rate]")

20 
’d


21 
txPÜt
 = 
	$tÚumb”
(
txPÜt
)

22 
rxPÜt
 = 
	$tÚumb”
(
rxPÜt
)

23 
isEndpošt
 = 
	`tÚumb”
(isEndpoint) == 1

24 
isTuÂ–ed
ğ
	`tÚumb”
(isTunneled) == 1

25 
¿‹
 =„©
Ü
 0

27 
loÿl
 
txDev
 = 
deviû
.
cÚfig
{ 
pÜt
 = 
txPÜt
 
	}
}

28 
txDev
:
	$wa™
()

29 
txDev
:
	$g‘TxQueue
(0):
	$£tR©e
(
¿‹
)

30 
loÿl
 
rxDev
 = 
deviû
.
cÚfig
{ 
pÜt
 = 
rxPÜt
 
	}
}

31 
rxDev
:
	$wa™
()

33 
isEndpošt
 
th’


34 
isTuÂ–ed
 
th’


35 
mg
.
	`ÏunchLua
("deÿpsuÏ‹SÏve", 
rxDev
, 
txPÜt
, 0)

37 
mg
.
	`ÏunchLua
("’ÿpsuÏ‹SÏve", 
rxDev
, 
txPÜt
, 0)

38 
’d


40 
mg
.
	`ÏunchLua
("lßdSÏve", 
isTuÂ–ed
, 
txPÜt
, 0)

41 
mg
.
	`ÏunchLua
("couÁ”SÏve", 
isTuÂ–ed
, 
rxDev
)

42 
’d


44 
mg
.
	$wa™FÜSÏves
()

45 
’d


47 -- 
v‹p
 
is
 
the
 
’dpošt
 
wh’
 
MoÚG’
 
de
-/
’ÿpsuÏ‹s
 
Œaffic


48 -- 
	`’c
(
ÿpsuÏ‹d
/
tuÂ–ed
 
Œaffic
è
is
 
çcšg
 
the
 
l3
 
ÃtwÜk
, 
	$dec
(
­suÏ‹d
 
Œaffic
è
is
 
çcšg
 
l2
 
ÃtwÜk


49 -- 
»mÙe
 
is
 
wh”e
 
we
 
tx
/
rx
 
Œaffic
 
w™h
 
	`MoÚG’
 (
lßd
-/
couÁ”¦ave
)

50 -- 
S‘up
: <
š‹rçû
>:<
ho¡
>:<interface>

51 -- :
lßdg’
/
sšk
:
decRemÙe
 <-----> 
decV‹p
:
V‹p
:
’cV‹p
 <-----> 
’cRemÙe
:sink/loadgen:

52 
loÿl
 
’cV‹pEth
 = "90:e2:ba:2c:cb:02" -- 
v‹p
, 
public
/
l3
 
side


53 
loÿl
 
’cV‹pIP
 = "10.0.0.1"

54 
loÿl
 
’cRemÙeEth
 = "90:e2:ba:01:02:03" -- 
MoÚG’
 
lßd
/
couÁ”
 
¦ave


55 
loÿl
 
’cRemÙeIP
 = "10.0.0.2"

57 
loÿl
 
VNI
 = 1000

59 
loÿl
 
decV‹pEth
 = "90:e2:ba:1f:8d:44" -- 
v‹p
, 
´iv©e
/
l2
 
side


60 
loÿl
 
decRemÙeEth
 = "90:e2:ba:0a:0b:0c" -- 
MoÚG’
 
couÁ”
/
lßd
 
¦ave


62 -- 
ÿn
 
be
 
ªy
 
´İ”
 
·ylßd
 
»®ly
, 
we
 
u£
 
this
 
‘h”Ty³
 
to
 
id’tify
 
the
 
·ck‘s


63 
loÿl
 
decEthTy³
 = 1

65 
loÿl
 
decPack‘L’
 = 60

66 
loÿl
 
’ÿpsuÏtiÚL’
 = 14 + 20 + 8 + 8 -- 
Eth
, 
IP
, 
UDP
, 
VXLAN


67 
loÿl
 
’cPack‘L’
 = 
’ÿpsuÏtiÚL’
 + 
decPack‘L’


69 
funùiÚ
 
	$lßdSÏve
(
£ndTuÂ–ed
, 
pÜt
, 
queue
)

71 
loÿl
 
queue
 = 
deviû
.
	$g‘
(
pÜt
):
	$g‘TxQueue
(
queue
)

72 
loÿl
 
·ck‘L’


73 
loÿl
 
mem


75 
£ndTuÂ–ed
 
th’


76 -- 
ü—‹
 
a
 
w™h
 
VXLAN
 
’ÿpsuÏ‹d
 
‘h”Ãt
 
·ck‘


77 
·ck‘L’
 = 
’cPack‘L’


78 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

79 
buf
:
	$g‘VxÏnEth”ÃtPack‘
():
fl
{

80 
‘hSrc
=
’cRemÙeEth
,

81 
‘hD¡
=
’cV‹pEth
,

82 
4Src
=
’cRemÙeIP
,

83 
4D¡
=
’cV‹pIP
,

85 
vxÏnVNI
=
VNI
,

87 
šÃrEthSrc
=
decV‹pEth
,

88 
šÃrEthD¡
=
decRemÙeEth
,

89 
šÃrEthTy³
=
decEthTy³
,

91 
pktL’gth
=
’cPack‘L’


92 
	}
}

93 
	g’d
)

95 -- 
ü—‹
 
ª
 
‘h”Ãt
 
·ck‘


96 
	g·ck‘L’
 = 
decPack‘L’


97 
mem
 = 
memÜy
.
ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

98 
buf
:
	$g‘Eth”ÃtPack‘
():
fl
{

99 
‘hSrc
=
decRemÙeEth
,

100 
‘hD¡
=
decV‹pEth
,

101 
‘hTy³
=
decEthTy³
,

103 
pktL’gth
=
decPack‘L’


104 
	}
}

105 
’d
)

107 
’d


109 
loÿl
 
	gbufs
 = 
mem
:
	$bufA¼ay
()

110 
loÿl
 
c
 = 0

112 
loÿl
 
txSts
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
queue
, "plain")

113 
mg
.
	$ruÂšg
() do

114 -- 
fl
 
·ck‘s
 
ªd
 
£t
 
theœ
 
size


115 
bufs
:
	`®loc
(
·ck‘L’
)

117 -- 
dump
 
fœ¡
 
·ck‘
 
to
 
£e
 
wh©
 
we
 
£nd


118 
c
 < 1 
th’


119 
bufs
[1]:
	$dump
()

120 
c
 = c + 1

121 
’d


123 
£ndTuÂ–ed
 
th’


124 --
ofæßd
 
checksums
 
to
 
NIC


125 
bufs
:
	$ofæßdUdpChecksums
()

126 
’d


128 
queue
:
	$£nd
(
bufs
)

129 
txSts
:
	$upd©e
()

130 
’d


131 
txSts
:
	$fš®ize
()

132 
’d


134 --- 
Checks
 
the
 
cÚ‹Á
 
of
 
a
 
·ck‘
 
·r£d
 
as
 
VxÏn
…ack‘ 
šd“d
 
f™s
 
w™h
‡ Vxlan…acket

135 --- @
·¿m
 
pkt
 
A
 
bufãr
 
·r£d
 
as
 
VxÏn
 
·ck‘


136 --- @ 
Œue
 
the
 
cÚ‹Á
 
f™s
 
a
 
VxÏn
 
	$·ck‘
 (
‘h”Ty³
, 
4PrÙo
 
ªd
 
udpD¡
 
f™
)

137 
funùiÚ
 
	$isVxÏnPack‘
(
pkt
)

138  
pkt
.
‘h
:
	`g‘Ty³
(è=ğ
´Ùo
.‘h.
TYPE_IP


139 
ªd
 
pkt
.
4
:
	`g‘PrÙocŞ
(è=ğ
´Ùo
.4.
PROTO_UDP


140 
ªd
 
pkt
.
udp
:
	`g‘D¡PÜt
(è=ğ
´Ùo
.udp.
PORT_VXLAN


141 
’d


143 
funùiÚ
 
	$couÁ”SÏve
(
»ûiveIÂ”
, 
dev
)

144 
rxSts
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
dev
, "plain")

145 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
(1)

146 
loÿl
 
c
 = 0

148 
mg
.
	$ruÂšg
() do

149 
loÿl
 
rx
 = 
dev
:
	$g‘RxQueue
(0):
	$»cv
(
bufs
)

150 
rx
 > 0 
th’


151 
loÿl
 
buf
 = 
bufs
[1]

152 
»ûiveIÂ”
 
th’


153 -- 
ªy
 
‘h”Ãt
 
äame


154 
loÿl
 
pkt
 = 
buf
:
	$g‘Eth”ÃtPack‘
()

155 
c
 < 1 
th’


156 
	`´štf
(
	`»d
("Received"))

157 
buf
:
	$dump
()

158 
c
 = c + 1

159 
’d


161 
loÿl
 
pkt
 = 
buf
:
	`g‘VxÏnEth”ÃtPack‘
()

162 -- 
ªy
 
vxÏn
 
·ck‘


163 
	$isVxÏnPack‘
(
pkt
è
th’


164 
c
 < 1 
th’


165 
	`´štf
(
	`»d
("Received"))

166 
buf
:
	$dump
()

167 
c
 = c + 1

168 
’d


169 
’d


170 
’d


172 
bufs
:
	$ä“AÎ
()

173 
’d


174 
rxSts
:
	$upd©e
()

175 
’d


176 
rxSts
:
	$fš®ize
()

177 
’d


179 
funùiÚ
 
	$deÿpsuÏ‹SÏve
(
rxDev
, 
txPÜt
, 
queue
)

180 
loÿl
 
txDev
 = 
deviû
.
	$g‘
(
txPÜt
)

182 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

183 
buf
:
	$g‘RawPack‘
():
fl
{

184 -- 
we
 
ke
 
ev”ythšg
 
äom
 
the
 
»ûived
 
’ÿpsuÏ‹d
 
·ck‘
's…ayload

185 
	}
}

186 
’d
)

187 
loÿl
 
rxBufs
 = 
memÜy
.
	$bufA¼ay
()

188 
loÿl
 
txBufs
 = 
mem
:
	$bufA¼ay
()

190 
loÿl
 
rxSts
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
rxDev
, "plain")

191 
loÿl
 
txSts
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
txDev
, "plain")

193 
loÿl
 
rxQ
 = 
rxDev
:
	$g‘RxQueue
(0)

194 
loÿl
 
txQ
 = 
txDev
:
	$g‘TxQueue
(
queue
)

196 
log
:
	`šfo
("Starting vtep decapsulationask")

197 
mg
.
	$ruÂšg
() do

198 
loÿl
 
rx
 = 
rxQ
:
	`ŒyRecv
(
rxBufs
, 0)

200 -- 
®loc
 
em±y
 
tx
 
·ck‘s


201 
txBufs
:
	$®locN
(
decPack‘L’
, 
rx
)

203 
i
 = 1, 
rx
 do

204 
loÿl
 
rxBuf
 = 
rxBufs
[
i
]

205 
loÿl
 
rxPkt
 = 
rxBuf
:
	`g‘VxÏnPack‘
()

206 -- 
™s
 
a
 
vxÏn
 
·ck‘
, 
deÿpsuÏ‹
 
™


207 
	$isVxÏnPack‘
(
rxPkt
è
th’


208 -- 
u£
 
‹m¶©e
 
¿w
 
	$·ck‘
 (
em±y
)

209 
loÿl
 
txPkt
 = 
txBufs
[
i
]:
	`g‘RawPack‘
()

211 -- 
g‘
 
the
 
size
 
of
 
Úly
h
·ylßd


212 
loÿl
 
·ylßdSize
 = 
rxBuf
:
	`g‘Size
(è- 
’ÿpsuÏtiÚL’


214 -- 
cİy
 
·ylßd


215 
ffi
.
	`cİy
(
txPkt
.
·ylßd
, 
rxPkt
.·ylßd, 
·ylßdSize
)

217 -- 
upd©e
 
bufãr
 
size


218 
txBufs
[
i
]:
	$£tSize
(
·ylßdSize
)

219 
’d


220 
’d


221 -- 
£nd
 
deÿpsuÏ‹d
 
·ck‘


222 
txQ
:
	`£nd
(
txBufs
)

224 -- 
ä“
 
»ûived
 
·ck‘


225 
rxBufs
:
	`ä“AÎ
()

227 -- 
upd©e
 
¡©i¡ics


228 
rxSts
:
	$upd©e
()

229 
txSts
:
	$upd©e
()

230 
’d


231 
rxSts
:
	$fš®ize
()

232 
txSts
:
	$fš®ize
()

233 
’d


235 
funùiÚ
 
	$’ÿpsuÏ‹SÏve
(
rxDev
, 
txPÜt
, 
queue
)

236 
loÿl
 
txDev
 = 
deviû
.
	$g‘
(
txPÜt
)

238 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

239 
buf
:
	$g‘VxÏnPack‘
():
fl
{

240 -- 
the
 
ou‹r
 
·ck‘
, 
basiÿÎy
 
defšes
h
VXLAN
 
tuÂ–


241 
‘hSrc
=
’cV‹pEth
,

242 
‘hD¡
=
’cRemÙeEth
,

243 
4Src
=
’cV‹pIP
,

244 
4D¡
=
’cRemÙeIP
,

246 
vxÏnVNI
=
VNI
,
	}
}

247 
	g’d
)

249 
loÿl
 
	grxBufs
 = 
memÜy
.
	$bufA¼ay
()

250 
loÿl
 
txBufs
 = 
mem
:
	$bufA¼ay
()

252 
loÿl
 
rxSts
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
rxDev
, "plain")

253 
loÿl
 
txSts
 = 
¡©s
:
	`ÃwDevTxCouÁ”
(
txDev
, "plain")

255 
loÿl
 
rxQ
 = 
rxDev
:
	$g‘RxQueue
(0)

256 
loÿl
 
txQ
 = 
txDev
:
	$g‘TxQueue
(
queue
)

258 
log
:
	`šfo
("Starting vtepƒncapsulationask")

259 
mg
.
	$ruÂšg
() do

260 
loÿl
 
rx
 = 
rxQ
:
	`ŒyRecv
(
rxBufs
, 0)

262 -- 
®loc
 "rx" 
tx
 
·ck‘s
 
w™h
 
VXLAN
 
‹m¶©e


263 -- 
In
 
the
 
’d
 
we
 
Úly
 
wªt
 
to
 
£nd
 
as
 
mªy
 
·ck‘s
‡ w
have
 
»ûived
 
š
h
fœ¡
 
¶aû
.

264 -- 
In
 
this
 
numb”
 
would
 
be
 
low”
 
thª
 
the
 
size
 
of
h
bufA¼ay
, 
we
 would 
have
 
a
 
memÜy
 
	`Ëak
 (
Úly
 
£ndšg
 
ä“s
h
bufãr
!).

265 -- 
®locN
 
im¶ic™ly
 
»sizes
 
the
 
bufA¼ay
 
to
 
th©
 
®l
 
İ”©iÚs
 
like
 
checksum
 
ofæßdšg
 
Ü
 
£ndšg
h
·ck‘s
 
¬e
 
Úly
 
dÚe
 th·ck‘ th© 
aùu®ly
 
	$exi¡
 (
would
 
üash
 
Ùh”wi£
)

266 
txBufs
:
	`®locN
(
’cPack‘L’
, 
rx
)

268 -- 
check
 
we
 
»ûived
 
ªy
 
·ck‘s


269 
i
 = 1, 
rx
 do

270 -- 
we
 
’ÿpsuÏ‹
 
ev”ythšg
 
th©
 
g‘s
 
h”e
. 
OÃ
 
could
 
®so
 
·r£
 
™
 
as
 
‘h”Ãt
 
äame
 
ªd
 
th’
 
Úly
ƒnÿpsuÏ‹ 
Ú
 
m©chšg
 
¤c
/
d¡
 
add»s£s


271 
loÿl
 
rxPkt
 = 
rxBufs
[
i
]:
	`g‘RawPack‘
()

273 -- 
size
 
of
 
the
 
·ck‘


274 
loÿl
 
¿wSize
 = 
rxBufs
[
i
]:
	`g‘Size
()

276 -- 
u£
 
‹m¶©e
 
VXLAN
 
·ck‘


277 
loÿl
 
txPkt
 = 
txBufs
[
i
]:
	`g‘VxÏnPack‘
()

279 -- 
cİy
 
¿w
 
	$·ylßd
 (
whŞe
 
äame
è
to
 
’ÿpsuÏ‹d
 
·ck‘
 
·ylßd


280 
ffi
.
	`cİy
(
txPkt
.
·ylßd
, 
rxPkt
.·ylßd, 
¿wSize
)

282 -- 
upd©e
 
size


283 
loÿl
 
tÙ®Size
 = 
’ÿpsuÏtiÚL’
 + 
¿wSize


284 -- 
the
 
aùu®
 
bufãr


285 
txBufs
[
i
]:
	`£tSize
(
tÙ®Size
)

286 -- 
the
 
IP
/
UDP
 
h—d”


287 
txPkt
:
	$£tL’gth
(
tÙ®Size
)

288 
’d


289 -- 
ofæßd
 
checksums


290 
txBufs
:
	`ofæßdUdpChecksums
()

292 -- 
£nd
 
’ÿpsuÏ‹d
 
·ck‘


293 
txQ
:
	`£nd
(
txBufs
)

295 -- 
ä“
 
»ûived
 
·ck‘


296 
rxBufs
:
	`ä“AÎ
()

298 -- 
upd©e
 
¡©i¡ics


299 
txSts
:
	$upd©e
()

300 
rxSts
:
	$upd©e
()

301 
’d


302 
rxSts
:
	$fš®ize
()

303 
txSts
:
	$fš®ize
()

304 
’d


	@/home/asabzi/msc-project/MoonGen-1/flows/examples.lua

1 -- 
some
 
æows
 
äom
 
	gMoÚG’
/
exam¶es


3 
	gFlow
{"lßd-Ï‹ncy", 
	gPack‘
.
	gUdp
{

4 
	g‘hSrc
 = 
txQueue
(),

5 
	g‘hD¡
 = 
¬p
("10.1.0.10"),

6 
	g4Src
 = 
¿nge
(

"10.0.0.10", ip"10.0.0.14"),

7 
	g4D¡
 = 

"10.1.0.10",

8 
	gudpSrc
 = 1234,

9 
	gudpD¡
 = 319,

10 
	gpktL’gth
 = 60

12 
	gtime¡amp
 = 
Œue


15 
	gFlow
{"qu®™y-of-£rviû", 
	gPack‘
.
	gUdp
{

16 
	g‘hSrc
 = 
txQueue
(),

17 
	g‘hD¡
 = 
mac
"10:11:12:13:14:15",

18 
	g4Src
 = 
¿nge
(

"192.168.0.1", ip"192.168.0.255"),

19 
	g4D¡
 = 

"10.0.0.1",

20 
	gudpSrc
 = 1234,

21 
	gpktL’gth
 = 124

23 
	gtime¡amp
 = 
Œue


26 
	gFlow
{"qos-fÜeground", 
	gPack‘
.
	gUdp
{

27 
	gudpD¡
 = 42

29 
	g·»Á
 = "quality-of-service",

30 
	g¿‹
 = 1000

32 
	gFlow
{"qos-background", 
	gPack‘
.
	gUdp
{

33 
	gudpD¡
 = 43

35 
	g·»Á
 = "quality-of-service",

36 
	g¿‹
 = 4000

39 
	gFlow
{"tı-syn-æood4", 
	gPack‘
.
	gTı4
{

40 
	g‘hSrc
 = 
txQueue
(),

41 
	g‘hD¡
 = 
mac
"12:34:56:78:90:00",

42 
	g4Src
 = 
¿nge
(

"10.0.0.1", ip"10.0.0.101"),

43 
	gtıSyn
 = 1,

44 
	gtıSeqNumb”
 = 1,

45 
	gtıWšdow
 = 10,

46 
	gpktL’gth
 = 60

50 
	gFlow
{"tı-syn-æood6", 
	gPack‘
.
	gTı6
{

51 
	g‘hSrc
 = 
txQueue
(),

52 
	g‘hD¡
 = 
mac
"12:34:56:78:90:00",

53 
	g6Src
 = 
¿nge
(

"fe80::1", ip"fe80::101"),

54 
	gtıSyn
 = 1,

55 
	gtıSeqNumb”
 = 1,

56 
	gtıWšdow
 = 10,

57 
	gpktL’gth
 = 74

	@/home/asabzi/msc-project/MoonGen-1/flows/udp-load.lua

1 
	gFlow
{"udp-sim¶e", 
	gPack‘
.
	gUdp
{

2 
	g4Src
 = 

"10.0.0.10",

3 
	g4D¡
 = 

"10.1.0.10",

4 
	gudpSrc
 = 1234,

5 
	gudpD¡
 = 319,

6 
	gpktL’gth
 = 60

10 
	gFlow
{"udp-lßd", 
	gPack‘
.
	gUdp
{

11 --
	g‘h_d¡
 = 
¬p
("10.1.0.10"), -- 
TODO
 
figu»
 
out
 
ARP


12 
	g4Src
 = 
li¡
{

13 

"10.0.0.10", ip"10.0.0.11",

14 

"10.0.0.20", ip"10.0.0.21"

16 
	gudpSrc
 = 
¿nge
(1234, 1245),

18 
	g·»Á
 = "udp-simple"

21 
	gFlow
{"udp-¿ndom", 
	gPack‘
.
	gUdp
{

22 
	g4Src
 = 
¿ndomLi¡
{

23 

"10.0.0.10", ip"10.0.0.11",

24 

"10.0.0.20", ip"10.0.0.21"

26 
	gudpSrc
 = 
¿ndomRªge
(1234, 1245),

28 
	g·»Á
 = "udp-simple",

29 
	gmode
 = "random",

	@/home/asabzi/msc-project/MoonGen-1/interface/cli/debug.lua

1 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

3 
loÿl
 
·r£
 = 
»quœe
 "flowparse"

4 
loÿl
 
Flow
 = 
»quœe
 "flow"

6 
loÿl
 
debug
 = {}

8 
ffi
.
cdef
[[

10 
size_t
 
Ëngth
;

11 
ušt8_t
* 
d©a
;

12 } 
debug_·ck‘_t
;

15 
loÿl
 
	gdebug_·ck‘
 = 
ffi
.
m‘©y³
("debug_packet_t", {

16 
__šdex
 = {

17 
g‘L’gth
 = 
funùiÚ
(
£lf
è s–f.
Ëngth
 
’d
,

18 
g‘By‹s
 = 
funùiÚ
(
£lf
è s–f.
d©a
 
’d
,

19 
g‘D©a
 = 
funùiÚ
(
£lf
)

20  
voidPŒTy³
(
£lf
.
d©a
è-- 
luacheck
: 
glob®s
 voidPtrType

21 
’d
,

25 
loÿl
 
funùiÚ
 
	$_´št_debug
(
¬gs
)

26 
Flow
.
	$üawlDœeùÜy
(
¬gs
.
cÚfig
)

28 
loÿl
 
å¬£
 = 
	$·r£
(
¬gs
.
æow
, 
m©h
.
huge
)

29 
loÿl
 
æow
 = 
Flow
.
	`g‘In¡ªû
(
å¬£
.
Çme
, f·r£.
fe
, f·r£.
İtiÚs
, f·r£.
ov”wr™es
,

30 { 
tx
 = {1}, 
rx
 = {1} 
	}
})

32 
nÙ
 
æow
 
th’
  
’d


34 
loÿl
 
	gËngth
 = 
æow
:
	$·ck‘Size
()

35 
loÿl
 
¬¿y
 = 
ffi
.
	`Ãw
("ušt8_t[?]", 
Ëngth
)

36 
loÿl
 
‹¡
 = 
	$debug_·ck‘
(
Ëngth
, 
¬¿y
)

38 
	`´št
(
¡ršg
.
	`fÜm©
("Flow: \27[1m%s\27[0m\n", 
å¬£
.
Çme
))

40 
loÿl
 
dv
 = 
æow
.
·ck‘
.
dynv¬s


41 #dv > 0 
th’


42 
loÿl
 
dynv¬_out
 = {"DyÇmic: "
	}
}

43 
_
,
v
 
š
 
	$aœs
(
dv
) do

44 
bË
.
	$š£¹
(
dynv¬_out
, 
v
.
pkt
)

45 
bË
.
	`š£¹
(
dynv¬_out
, 
¡ršg
.
	`uµ”
(¡ršg.
	$sub
(
v
.
v¬
, 1, 1)))

46 
bË
.
	`š£¹
(
dynv¬_out
, 
¡ršg
.
	$sub
(
v
.
v¬
, 2))

47 
bË
.
	`š£¹
(
dynv¬_out
, ", ")

48 
’d


49 
dynv¬_out
[#dynvar_out] = "\n"

50 
	`´št
(
bË
.
	$cÚÿt
(
dynv¬_out
))

51 
’d


53 
loÿl
 
d•’d’c›s
 = 
æow
.
·ck‘
.
d•v¬s


54 #d•’d’c› > 0 
th’


55 
loÿl
 
d•_out
 = {"EnvœÚm’ˆd•’d’t:\n"
	}
}

56 
i
,
v
 
š
 
	$·œs
(
d•’d’c›s
) do

57 
bË
.
	`š£¹
(
d•_out
, 
¡ršg
.
	`»p
(" ", 4))

58 
bË
.
	$š£¹
(
d•_out
, 
i
)

59 
bË
.
	`š£¹
(
d•_out
, " => ")

60 
bË
.
	`š£¹
(
d•_out
, 
v
.
d•
.
	$debug
(
v
.
tbl
))

61 
bË
.
	`š£¹
(
d•_out
, "\n")

62 
’d


63 
	`´št
(
bË
.
	$cÚÿt
(
d•_out
))

64 
’d


66 
loÿl
 
pkt
 = 
æow
:
	$flBuf
(
‹¡
)

67 
æow
.
upd©ePack‘
 
th’


68 
_
 = 1, 
¬gs
.
couÁ
 do

69 
æow
:
	$upd©eBuf
(
‹¡
):
	$dump
(
Ëngth
)

70 
’d


72 
¬gs
.
couÁ
 > 1 
th’


73 
	`´št
("Multiple…ackets„equested but flow is‚ot dynamic.")

74 
’d


75 
pkt
:
	$dump
()

76 
’d


77 
’d


79 
funùiÚ
 
debug
.
	$cÚfigu»
(
·r£r
)

80 
·r£r
:
	`İtiÚ
("-c --config", "Config file directory."):("flows")

81 
·r£r
:
	`İtiÚ
("-À--couÁ", "AmouÁ oàv¬ŸÁ tØdi¥Ïy."):("1"):
	$cÚv”t
(
tÚumb”
)

82 
·r£r
:
	`¬gum’t
("flow", "Name ofhe flowo display.")

84 
·r£r
:
	`aùiÚ
(
	$funùiÚ
(
¬gs
)

85 
	$_´št_debug
(
¬gs
)

86 
os
.
	$ex™
(0)

87 
’d
)

88 
’d


90  
debug


	@/home/asabzi/msc-project/MoonGen-1/interface/cli/help.lua

1 
loÿl
 
	gh–p
 = {

2 
tİics
 = {}

5 
loÿl
 
funùiÚ
 
	$fÜm©Ind’‹d
(
»suÉ
, 
cŞs
, 
šd’t
, 
‹xt
)

6 
	`ty³
(
šd’t
è=ğ"numb”" 
th’


7 
šd’t
 = 
¡ršg
.
	`»p
(" ", indent)

8 
’d


10 
bË
.
	`š£¹
(
»suÉ
, 
¡ršg
.
	`m©ch
(
‹xt
, "^(\n*)"))

11 
lše
, 
Æ
 
š
 
¡ršg
.
	`gm©ch
(
‹xt
, "([^\n]+)([\n]*)") do

12 
loÿl
 
cu¼’t
, 
ÃxtS·û
 = 0, ""

13 
bË
.
	$š£¹
(
»suÉ
, 
šd’t
)

15 
bË
.
	`š£¹
(
»suÉ
, 
¡ršg
.
	`m©ch
(
lše
, "^(%s*)"))

16 
w
, 
s
 
š
 
¡ršg
.
	`gm©ch
(
lše
, "(%S+)(%s*)") do

17 
loÿl
 
Ãxt
 = 
cu¼’t
 + #w + #nextSpace

19 
Ãxt
 > 
cŞs
 
th’


20 
bË
.
	`š£¹
(
»suÉ
, "\n")

21 
bË
.
	$š£¹
(
»suÉ
, 
šd’t
)

22 
cu¼’t
, 
ÃxtS·û
 = 0, ""

24 
cu¼’t
 = 
Ãxt


25 
’d


27 
bË
.
	$š£¹
(
»suÉ
, 
ÃxtS·û
)

28 
ÃxtS·û
 = 
s


30 
bË
.
	$š£¹
(
»suÉ
, 
w
)

31 
’d


33 
bË
.
	$š£¹
(
»suÉ
, 
Æ
)

34 
’d


35 
’d


37 
loÿl
 
h–p_´š‹r
 = {

38 
»suÉ
 = {}, 
bodyLev–
 = 0,

39 
šd’t
 = 6, 
m¬gš
 = 6

40 
	}
}

42 
funùiÚ
 
	gh–p_´š‹r
:
	$£ùiÚ
(
t™Ë
)

43 
bË
.
	`š£¹
(
£lf
.
»suÉ
, 
¡ršg
.
	$uµ”
(
t™Ë
))

44 
bË
.
	`š£¹
(
£lf
.
»suÉ
, "\n")

45 
£lf
.
bodyLev–
 = 1

46 
’d


48 
funùiÚ
 
h–p_´š‹r
:
	$sub£ùiÚ
(
t™Ë
)

49 
bË
.
	`š£¹
(
£lf
.
»suÉ
, 
¡ršg
.
	`»p
(" ", s–f.
šd’t
))

50 
bË
.
	$š£¹
(
£lf
.
»suÉ
, 
t™Ë
)

51 
bË
.
	`š£¹
(
£lf
.
»suÉ
, "\n")

52 
£lf
.
bodyLev–
 = 2

53 
’d


55 
funùiÚ
 
h–p_´š‹r
:
	$body
(
‹xt
)

56 
loÿl
 
bodycŞs
 = 
£lf
.
cŞs
 - s–f.
šd’t
 * s–f.
bodyLev–
 - s–f.
m¬gš


57 
	$fÜm©Ind’‹d
(
£lf
.
»suÉ
, 
bodycŞs
, s–f.
šd’t
 * s–f.
bodyLev–
, 
‹xt
)

58 
bË
.
	`š£¹
(
£lf
.
»suÉ
, "\n\n")

59 
’d


61 
funùiÚ
 
h–p
.
	$cÚfigu»
(
·r£r
)

62 
·r£r
:
	`¬gum’t
("topic", "Helpopico cover."):("topics")

64 
·r£r
:
	`aùiÚ
(
	$funùiÚ
(
¬gs
)

65 
loÿl
 
ut
 = 
io
.
	`pİ’
("tput cols")

66 
loÿl
 
cŞs
 = 
	`tÚumb”
(
ut
:
	$»ad
())

67 
ut
:
	$şo£
()

69 
h–p_´š‹r
.
cŞs
 = cols

70 
h–p
.
tİics
[
¡ršg
.
	`low”
(
¬gs
.
tİic
)](
h–p_´š‹r
)

71 
bË
.
	`»move
(
h–p_´š‹r
.
»suÉ
è-- 
»move
 
Ï¡
 
Ãwlše


72 
	`´št
(
bË
.
	$cÚÿt
(
h–p_´š‹r
.
»suÉ
))

73 
os
.
	$ex™
(0)

74 
’d
)

75 
’d


77 
funùiÚ
 
h–p
.
	$addTİic
(
Çme
, 
ÿÎback
)

78 
h–p
.
tİics
[
Çme
] = 
ÿÎback


79 
’d


81 
h–p
.
	`addTİic
("İtiÚs", 
	$funùiÚ
(
hp
)

82 
hp
:
	`£ùiÚ
("Options")

83 
hp
:
	`body
("List of options‡vailable when customizing flows using"

86 
hp
:
	`£ùiÚ
("Units")

87 
hp
:
	`sub£ùiÚ
("Size Units '\27[4m<prefix><unit>\27[0m'\n")

88 
hp
:
	`body
("Prefix can be one of '\27[4m[k|M|G[i]]\27[0m'"

90 
hp
:
	`body
("Unit can be one of '\27[4m(B|bit|p)\27[0m',"

93 
hp
:
	`sub£ùiÚ
("Time Units")

94 
hp
:
	`body
("Availableime units‡re '\27[4m(ms|s|m|h)\27[0m'"

97 
loÿl
 
İtiÚs
 = 
»quœe
 "options"

98 
loÿl
 
Çmes
 = {
	}
}

100 
i
 
š
 
	$·œs
(
İtiÚs
èdØ
bË
.
	$š£¹
(
Çmes
, 
i
è
’d


101 
bË
.
	$sÜt
(
Çmes
)

103 
n
 = 1, #names do

104 
loÿl
 
i
 = 
Çmes
[
n
]

105 
loÿl
 
v
 = 
İtiÚs
[
i
]

107 
hp
:
	$£ùiÚ
(
i
)

108 
hp
:
	$body
(
v
.
desütiÚ
)

110 
_
,
fmt
 
š
 
	$aœs
(
v
.
u§ge
) do

111 
fmt
[1] 
th’


112 
hp
:
	`sub£ùiÚ
(
¡ršg
.
	`fÜm©
("% ğ\27[4m%s\27[0m", 
i
, 
fmt
[1]))

114 
hp
:
	$sub£ùiÚ
(
i
)

115 
’d


116 
hp
:
	$body
(
fmt
[2])

117 
’d


119 
v
.
cÚfigH–p
 
th’


120 
hp
:
	`sub£ùiÚ
("Configuration\n")

121 
hp
:
	$body
(
v
.
cÚfigH–p
)

122 
’d


123 
’d


124 
’d
)

126 
h–p
.
	`addTİic
("tİics", 
	$funùiÚ
(
hp
)

127 
loÿl
 
»suÉ
 = {
	}
}

129 
tİic
 
š
 
	$·œs
(
h–p
.
tİics
) do

130 
tİic
 ~ğ"tİics" 
th’


131 
bË
.
	$š£¹
(
»suÉ
, 
tİic
)

132 
’d


133 
’d


134 
bË
.
	$sÜt
(
»suÉ
)

136 
hp
:
	`£ùiÚ
("Available Topics")

137 
hp
:
	`body
(
bË
.
	`cÚÿt
(
»suÉ
, ", "))

138 
’d
)

140 
loÿl
 
æowExam¶e
 = [[

141 
Flow
{"Çme", 
Pack‘
.
Udp
{

142 
udpSrc
 = 1234,

143 
4Src
 = 

"10.100.1.1",

145 
¿‹
 = 1000,

146 
	}
}]]

148 
	gh–p
.
addTİic
("cÚfigu¿tiÚ", 
	$funùiÚ
(
hp
)

149 
hp
:
	`£ùiÚ
("Directory Structure")

150 
hp
:
	`body
("Config files‡re‡ssumedo„eside in‡ single directory. Subdirectories‡re ignored."

153 
hp
:
	`£ùiÚ
("File Contents")

154 
hp
:
	`body
("All files have‡ccesso Lua functions in string,able‡nd math,"

157 
hp
:
	`sub£ùiÚ
("Flows")

158 
hp
:
	`body
("Flows consist of‡‚ame‡nd‡…acket definition."

161 
hp
:
	`sub£ùiÚ
("Example")

162 
hp
:
	$body
(
æowExam¶e
)

164 
hp
:
	`sub£ùiÚ
("Closures")

165 
hp
:
	`body
("Some options‡llow functionso be…assed. Keep in mind,hatƒach flow willypically"

167 
’d
)

169  
h–p


	@/home/asabzi/msc-project/MoonGen-1/interface/cli/init.lua

1 
loÿl
 
	gli¡
 = 
»quœe
 "cli.list"

2 
loÿl
 
debug
 = 
»quœe
 "cli.debug"

3 
loÿl
 
h–p
 = 
»quœe
 "cli.help"

5 
loÿl
 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

6 
li¡
.
	`cÚfigu»
(
·r£r
:
	`commªd
("list", "List‡ll‡vailable flows."))

7 
debug
.
	`cÚfigu»
(
·r£r
:
	`commªd
("debug", "Dump variants of‡ single flow."))

8 
h–p
.
	`cÚfigu»
(
·r£r
:
	`commªd
("help", "Print helpext for‡opic."))

9 
’d


11  
cÚfigu»


	@/home/asabzi/msc-project/MoonGen-1/interface/cli/list.lua

1 
loÿl
 
	gFlow
 = 
»quœe
 "flow"

2 
loÿl
 
lfs
 = 
»quœe
 "syscall.lfs"

3 
loÿl
 
log
 = 
»quœe
 "log"

5 
loÿl
 
li¡
 = {}

7 
loÿl
 
funùiÚ
 
	$_´št_li¡
(
cÚfig
)

8 
_
,
v
 
š
 
	$aœs
(
cÚfig
) do

9 
loÿl
 
ty³
 = 
lfs
.
	`©Œibu‹s
(
v
, "mode")

10 
ty³
 =ğ"fe" 
th’


11 
Flow
.
	$üawlFe
(
v
)

12 
–£if
 
ty³
 =ğ"dœeùÜy" 
th’


13 
Flow
.
	$üawlDœeùÜy
(
v
)

15 
log
:
	`”rÜ
("EÁry % i Ã™h” fnÜ dœeùÜy.", 
v
)

16 
’d


17 
’d


19 
loÿl
 
fes
 = 
	`£tm‘©abË
({
	}
}, {

20 
	g__šdex
 = 
funùiÚ
(
tbl
, 
key
)

21 
loÿl
 
	gr
 = {}; 
	gtbl
[
key
] = 
r
; „

22 
	g’d


25 
loÿl
 
	gcouÁ
 = 0

26 
_
,
f
 
š
 
	$·œs
(
Flow
.
æows
) do

27 
Flow
.
	`g‘In¡ªû
(
f
.
Çme
, 
n
, {
	}
}, 
	gn
, { 
	grx
 = {1}, 
	gtx
 = {1} }è
th’


28 
	gbË
.
	$š£¹
(
fes
[
f
.
fe
], f)

29 
couÁ
 = count + 1

30 
’d


31 
bË
.
	`sÜt
(
fes
[
f
.
fe
], 
	$funùiÚ
(
a
,
b
è‡.
Çme
 < b.Çm
’d
)

32 
’d


34 
couÁ
 =ğ0 
th’


35 
´št
 "No flows found."

37 
’d


39 
loÿl
 
fmt
 = " %-58s%-10s%-5d%-5d"

40 
	`´št
(
¡ršg
.
	`fÜm©
("%-60s%-10s%-5s%-5s", "NAME", "PROTOCOL", "DYN", "DEP"))

41 
	`´št
(
¡ršg
.
	`»p
("=", 80))

42 
i
,
v
 
š
 
	$·œs
(
fes
) do

43 
	$´št
(
i
)

44 
_
,
f
 
š
 
	$aœs
(
v
) do

45 
	`´št
(
¡ršg
.
	`fÜm©
(
fmt
, 
f
.
Çme
, f.
·ck‘
.
´Ùo
, #f.·ck‘.
dynv¬s
, #f.·ck‘.
d•v¬s
))

46 
’d


47 
’d


48 
’d


50 
funùiÚ
 
li¡
.
	$cÚfigu»
(
·r£r
)

51 
·r£r
:
	`¬gum’t
("’Œ›s", "Li¡ oàfe ªd dœeùÜ› tØ£¬ch fÜ flow š."):
	`¬gs
("*"):("flows")

53 
·r£r
:
	`aùiÚ
(
	$funùiÚ
(
¬gs
)

54 
	`_´št_li¡
(
¬gs
.
’Œ›s
 
Ü
 { "æows" 
	}
})

55 
os
.
	$ex™
(0)

56 
’d
)

57 
’d


59  
li¡


	@/home/asabzi/msc-project/MoonGen-1/interface/configenv/init.lua

1 
loÿl
 
	glfs
 = 
»quœe
 "syscall.lfs"

3 
loÿl
 
”rÜs
 = 
»quœe
 "errors"

5 
loÿl
 
mod
 = { 
’v
 = {} }

7 
loÿl
 
	g_§ã_m‘hods
 = {}

8 
v
 
š
 
¡ršg
.
gm©ch
([[

9 
¡ršg
 
bË
 
m©h


10 
g‘m‘©abË
 
£tm‘©abË


11 
aœs
 
Ãxt
 
·œs


12 
¿wequ®
 
¿wg‘
 
¿wËn


13 
tÚumb”
 
to¡ršg
 
ty³


15 
	g_§ã_m‘hods
[
v
] = 
_G
[v]

16 
’d


17 
£tm‘©abË
(
mod
.
’v
, { 
__šdex
 = 
_§ã_m‘hods
 })

19 
	g»quœe
 "cÚfig’v.¿nge" (
	gmod
.
	g’v
)

20 
	g»quœe
 "cÚfig’v.ut" (
	gmod
.
	g’v
)

22 
	g_
,
v
 
š
 
·œs
(
»quœe
 "dependencies") do

23 
	gv
.
	$’v
(
mod
.
’v
)

24 
’d


26 
funùiÚ
 
mod
:
	$£tE¼Hnd
(
hnd
)

27 
£lf
.
’v
.
”rÜ
 = 
hnd
 
Ü
 
	$”rÜs
()

28 
’d


30 
funùiÚ
 
mod
:
	$”rÜ
()

31  
£lf
.
’v
.
”rÜ


32 
’d


34 
loÿl
 
funùiÚ
 
	$run
(
£lf
, 
fe
, 
f
, 
msg
)

35 
	`as£¹
(
£lf
.
’v
.
”rÜ
, "Noƒrror handler set.")

37 
nÙ
 
f
 
th’


38 
£lf
:
	`”rÜ
()(0, 
msg
)

40 
’d


42 
£lf
.
’v
.
_FILE
 = 
fe


43  
	$£tãnv
(
f
, 
£lf
.
’v
)()

44 
’d


46 
loÿl
 
ffi
 = 
»quœe
 "ffi"

48 
loÿl
 
feIndex
 = {
	}
}

49 
loÿl
 
funùiÚ
 
g‘Index
(
·th
)

50 -- 
dev
 
»tuºs
 
a
 
š
 
ljsysÿÎ
 
lfs
 
w™h
 
m‘hods
 
to
 
·r£
 
mšÜ
/
majÜ
; .
deviû
 
is
 
ju¡
 
the
 
¿w
 
id


51  ("%d_%d"):
fÜm©
(
lfs
.
©Œibu‹s
(
·th
, "dev").
deviû
,†fs.attributes(path, "ino"))

52 
’d


54 
funùiÚ
 
	gmod
:
	$·r£Fe
(
f’ame
)

55 
loÿl
 
idx
 = 
	$g‘Index
(
f’ame
)

56 
nÙ
 
feIndex
[
idx
] 
th’


57 
feIndex
[
idx
] = 
Œue


58 
	`run
(
£lf
, 
f’ame
, 
	$lßdfe
(
f’ame
))

59 
’d


60 
’d


62 
funùiÚ
 
mod
:
	$·r£SŒšg
(
¡ršg
, 
chunkÇme
)

63  
	`run
(
£lf
, 
n
, 
	`lßd¡ršg
(
¡ršg
, 
chunkÇme
 
Ü
 "config string"))

64 
’d


66  
mod


	@/home/asabzi/msc-project/MoonGen-1/interface/configenv/range.lua

1  
	$funùiÚ
(
’v
)

3 
funùiÚ
 
’v
.
	$¿nge
(
¡¬t
, 
lim™
, 
¡•
)

4 
¡•
 = s‹°
Ü
 1

5 
loÿl
 
v
 = 
¡¬t
 - 
¡•


7 
nÙ
 
lim™
 
th’


8  
	$funùiÚ
()

9 
v
 = v + 
¡•


10  
v


11 
’d


12 
’d


14  
	$funùiÚ
()

15 
v
 > 
lim™
 
th’


16 
v
 = 
¡¬t


18 
v
 = v + 
¡•


19 
’d


21  
v


22 
’d


23 
’d


25 
funùiÚ
 
’v
.
	$¿ndomRªge
(
¡¬t
, 
lim™
)

26  
	$funùiÚ
()

27  
m©h
.
	$¿ndom
(
¡¬t
, 
lim™
)

28 
’d


29 
’d


31 
funùiÚ
 
’v
.
	$li¡
(
tbl
)

32 
loÿl
 
šdex
, 
Ën
 = 1, #tbl

33  
	$funùiÚ
()

34 
loÿl
 
v
 = 
tbl
[
šdex
]

36 
šdex
 = index + 1

37 
šdex
 > 
Ën
 
th’


38 
šdex
 = 1

39 
’d


41  
v


42 
’d


43 
’d


45 
funùiÚ
 
’v
.
	$¿ndomLi¡
(
tbl
)

46 
loÿl
 
Ën
 = #tbl

47  
	$funùiÚ
()

48  
tbl
[
m©h
.
	`¿ndom
(
Ën
)]

49 
’d


50 
’d


51 
’d


	@/home/asabzi/msc-project/MoonGen-1/interface/configenv/util.lua

1  
	$funùiÚ
(
’v
)

2 
funùiÚ
 
’v
.
	$
(
¡r
)

3 
loÿl
 
t
 = 
	$ty³
(
¡r
)

4 
t
 ~ğ"¡ršg" 
th’


5 
’v
.
	`”rÜ
("FunùiÚ '': sŒšgƒx³ùed, gÙ %s.", 
t
)

7 
’d


9 -- 
luacheck
: 
»ad
 
glob®s
 
·r£IPAdd»ss


10 
loÿl
 

 = 
	$·r£IPAdd»ss
(
¡r
)

11 
’v
.
”rÜ
:
	`as£¹
(

, "Inv®id i°add»s %q.", 
¡r
)

12  



13 
’d


15 
funùiÚ
 
’v
.
	$mac
(
¡r
)

16 
loÿl
 
t
 = 
	$ty³
(
¡r
)

17 
t
 ~ğ"¡ršg" 
th’


18 
’v
.
	`”rÜ
("FunùiÚ 'mac': sŒšgƒx³ùed, gÙ %s.", 
t
)

20 
’d


22 -- 
luacheck
: 
»ad
 
glob®s
 
·r£MacAdd»ss


23 
loÿl
 
mac
 = 
	$·r£MacAdd»ss
(
¡r
, 
Œue
)

24 
’v
.
”rÜ
:
	`as£¹
(
mac
, "Inv®id maøadd»s %q.", 
¡r
)

25  
mac


26 
’d


27 
’d


	@/home/asabzi/msc-project/MoonGen-1/interface/counter.lua

1 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

2 
loÿl
 
memÜy
 = 
»quœe
 "memory"

3 
loÿl
 
lock
 = 
»quœe
 "lock"

5 
loÿl
 
mod
 = {}

7 
ffi
.
cdef
[[

8 
	scouÁ”
 {

9 
ušt8_t
 
aùive
;

10 
ušt32_t
 
couÁ
;

11 
lock
*†ock;

15 
loÿl
 
	gcouÁ”
 = {}

16 
couÁ”
.
__šdex
 = counter

18 
funùiÚ
 
mod
.
	$Ãw
()

19 
loÿl
 
út
 = 
memÜy
.
	`®loc
("¡ruù couÁ”*", 
ffi
.("struct counter"))

20 
út
.
aùive
, cÁ.
couÁ
, cÁ.
lock
 = 0, 0,†ock:
	$Ãw
()

21  
út


22 
’d


25 
funùiÚ
 
couÁ”
:
	$isZ”o
()

26  
£lf
.
aùive
 =ğ1 
ªd
 s–f.
couÁ
 == 0

27 
’d


29 
funùiÚ
 
couÁ”
:
	$šc
()

30 
£lf
.
lock
:
	$lock
()

31 
£lf
.
couÁ
 = self.count + 1

32 
£lf
.
aùive
 = 1

33 
£lf
.
lock
:
	$uÆock
()

34 
’d


36 
funùiÚ
 
couÁ”
:
	$dec
()

37 
£lf
.
lock
:
	$lock
()

38 
£lf
.
couÁ
 = self.count - 1

39 
£lf
.
lock
:
	$uÆock
()

40 
’d


42 
ffi
.
	`m‘©y³
("¡ruù couÁ”", 
couÁ”
)

44  
mod


	@/home/asabzi/msc-project/MoonGen-1/interface/dependencies/arp.lua

1 
loÿl
 
	g¬p
 = 
»quœe
 "proto.arp"

3 
loÿl
 
d•’d’cy
 = {}

5 
funùiÚ
 
d•’d’cy
.
	$’v
(
’v
)

6 
funùiÚ
 
’v
.
	$¬p
(

, 
çÎback
, 
timeout
)

7  { "¬p", 

, 
çÎback
, 
timeout
 
Ü
 5 
	}
}

8 
’d


9 
’d


11 
loÿl
 
funùiÚ
 
	$macSŒšg
(
addr
)

12 
	`ty³
(
addr
è=ğ"numb”" 
th’


13 
loÿl
 
mac
 = 
	`»quœe
("ffi").
	`Ãw
("union mac_address")

14 
mac
:
	$£t
(
addr
)

15  
mac
:
	$g‘SŒšg
()

16 
–£if
 
	`ty³
(
addr
è=ğ"cd©a" 
th’


17  
addr
:
	$g‘SŒšg
()

18 
’d


20  
addr


21 
’d


23 -- 
luacheck
: 
glob®s
 
SŒšg


24 
funùiÚ
 
	$SŒšg
(
addr
)

25 
	`ty³
(
addr
è=ğ"numb”" 
th’


26 
addr
 = 
	`4ToSŒšg
×ddrè-- 
luacheck
: 
»ad
 
glob®s
 
4ToSŒšg


27 
–£if
 
	`ty³
(
addr
è=ğ"cd©a" 
th’


28 
addr
 =‡ddr:
	$g‘SŒšg
(
Œue
)

29 
’d


31  
addr


32 
’d


34 
funùiÚ
 
d•’d’cy
.
	$debug
(
tbl
)

35 
loÿl
 
addr
 = 
	$SŒšg
(
tbl
[2])

37 
tbl
[3] 
th’


38  
¡ršg
.
	`fÜm©
("A½„esuÉ fÜ i°'%s', f®lbackØ'%s'.", 
addr
, 
	$macSŒšg
(
tbl
[3]))

40  
¡ršg
.
	`fÜm©
("A½„esuÉ fÜ i°'%s'.", 
addr
)

41 
’d


42 
’d


44 
funùiÚ
 
d•’d’cy
.
	$g‘V®ue
(
_
, 
tbl
)

45  
¬p
.
	$blockšgLookup
(
tbl
[2],bl[4]è
Ü
bl[3]

46 
’d


48  
d•’d’cy


	@/home/asabzi/msc-project/MoonGen-1/interface/dependencies/init.lua

1 
loÿl
 
	gd•’d’c›s
 = {}

3 
_
,
v
 
š
 
	gaœs
 {

6 
	gd•’d’c›s
[
v
] = 
»quœe
("dependencies." .. v)

7 
’d


9  
d•’d’c›s


	@/home/asabzi/msc-project/MoonGen-1/interface/dependencies/queueMac.lua

1 
loÿl
 
	gdeviû
 = 
»quœe
 "device"

3 
loÿl
 
d•’d’cy
 = {}

5 
funùiÚ
 
d•’d’cy
.
	$’v
(
’v
)

6 
funùiÚ
 
’v
.
	$txQueue
()

7  { "queueMac", "tx" 
	}
}

8 
’d


10 
funùiÚ
 
’v
.
	$rxQueue
()

11  { "queueMac", "rx" 
	}
}

12 
’d


13 
’d


15 
funùiÚ
 
d•’d’cy
.
	$debug
(
tbl
)

16  
¡ršg
.
	`fÜm©
("Maøadd»s oà% deviû.", 
tbl
[2])

17 
’d


19 
funùiÚ
 
d•’d’cy
.
	$g‘V®ue
(
æow
, 
tbl
)

20 
loÿl
 
id
 = 
æow
:
	`´İ”ty
(
tbl
[2] .. "_dev"è
Ü
 flow:property(tbl[2])[1]

21  
deviû
.
	$g‘
(
id
):
	$g‘Mac
(
Œue
)

22 
’d


24  
d•’d’cy


	@/home/asabzi/msc-project/MoonGen-1/interface/devmgr.lua

1 
loÿl
 
	gdeviû
 = 
»quœe
 "device"

3 
loÿl
 
deviûsCÏss
 = {}

5 
funùiÚ
 
deviûsCÏss
:
	$»£rveTx
(
tx
)

6 
£lf
[
tx
].
txq
 = self[tx].txq + 1

7 
’d


9 
funùiÚ
 
deviûsCÏss
:
	$»£rveRx
(
rx
)

10 
£lf
[
rx
].
rxq
 = self[rx].rxq + 1

11 
’d


13 
funùiÚ
 
deviûsCÏss
:
	$»£rveRss
(
rss
)

14 
£lf
[
rss
].
rxq
 = self[rss].rxq + 1

15 
£lf
[
rss
].
rsq
 = self[rss].rsq + 1

16 
’d


18 
loÿl
 
funùiÚ
 
	$_šc
(
tbl
, 
key
)

19 
loÿl
 
»suÉ
 = 
tbl
[
key
]

20 
tbl
[
key
] = 
»suÉ
 + 1

21  
»suÉ


22 
’d


24 
funùiÚ
 
deviûsCÏss
:
	$txQueue
(
tx
)

25  
£lf
[
tx
].
dev
:
	`g‘TxQueue
(
	`_šc
(self[tx], "txqi"))

26 
’d


28 
funùiÚ
 
deviûsCÏss
:
	$rxQueue
(
rx
)

29  
£lf
[
rx
].
dev
:
	`g‘RxQueue
(£lf[rx].
rsq
 + 
	`_šc
(self[rx], "rxqi"))

30 
’d


32 
funùiÚ
 
deviûsCÏss
:
	$rssQueue
(
rx
)

33  
£lf
[
rx
].
dev
:
	`g‘RxQueue
(
	`_šc
(self[rx], "rsqi"))

34 
’d


36 
funùiÚ
 
deviûsCÏss
:
	$cÚfigu»
()

37 
i
,
v
 
š
 
	$·œs
(
£lf
) do

38 
loÿl
 
txq
, 
rxq
 = 
v
.txq, v.rxq

39 
txq
, 
rxq
 = (txq =ğ0è
ªd
 1 
Ü
xq, (rxq == 0)‡nd 1 or„xq

40 
v
.
dev
 = 
deviû
.
cÚfig
{ 
pÜt
 = 
i
, 
rxQueues
 = 
rxq
, 
rssQueues
 = v.
rsq
, 
txQueues
 = 
txq
 
	}
}

41 
’d


43 
	gdeviû
.
	$wa™FÜLšks
()

44 
’d


47 
loÿl
 
mod
 = {
	}
}

49 
funùiÚ
 
mod
.
	$ÃwDevmgr
()

50  
	`£tm‘©abË
({ 
	}
}, {

51 
	g__šdex
 = 
funùiÚ
(
tbl
, 
key
)

52 
	gkey
 =ğ"max" 
th’


53  
deviû
.
numDeviûs
()

54 
–£if
 
ty³
(
key
è~ğ"numb”" 
th’


55  
deviûsCÏss
[
key
]

56 
’d


57 
loÿl
 
r
 = { 
rxq
 = 0, 
	grsq
 = 0, 
	gtxq
 = 0, 
	grxqi
 = 0, 
	grsqi
 = 0, 
	gtxqi
 = 0 }

58 
	gtbl
[
key
] = 
r
; „

59 
	g’d


61 
’d


63  
	gmod


	@/home/asabzi/msc-project/MoonGen-1/interface/errors.lua

1 
loÿl
 
	g”rÜs
 = {}

3 
funùiÚ
 
”rÜs
:
	$´št
(
šfo
, 
â
, ...)

4 
_
,
v
 
š
 
	$aœs
(
£lf
) do

5 
šfo
 
ªd
 
v
.šfØ
th’


6 
	`â
(..., 
¡ršg
.
	`fÜm©
("%s:%d: %s", 
v
.
šfo
.
shÜt_¤c
, v.šfo.
cu¼’še
, v.
msg
))

8 
	$â
(..., 
v
.
msg
)

9 
’d


10 
’d


11 
’d


13 
funùiÚ
 
”rÜs
:
	$£tP»fix
(
´e
, ...)

14 
´e
 
th’


15 
£lf
.
´efix
 = 
¡ršg
.
	$fÜm©
(
´e
, ...)

17 
£lf
.
´efix
 = 
n


18 
’d


19 
’d


21 
funùiÚ
 
”rÜs
:
	$log
(
Ëv–
, 
mes§ge
, ...)

22 
	`ty³
(
Ëv–
è=ğ"¡ršg" 
th’


23 
mes§ge
 = 
¡ršg
.
	$fÜm©
(
Ëv–
, 
mes§ge
, ...)

24 
Ëv–
 = 
£lf
.
deçuÉLev–


26 
mes§ge
 = 
¡ršg
.
	$fÜm©
(
mes§ge
, ...)

27 
Ëv–
 =†evel + 1

28 
’d


30 
£lf
.
´efix
 
th’


31 
mes§ge
 = 
£lf
.
´efix
 .. message

32 
’d


34 
loÿl
 
šfo


35 
Ëv–
 > 1 
th’


36 
šfo
 = 
debug
.
	`g‘šfo
(
Ëv–
, "Sl")

37 
’d


39 
bË
.
	`š£¹
(
£lf
, {

40 
šfo
 = info, 
msg
 = 
mes§ge


41 
	}
})

42 
’d


44 
funùiÚ
 
	g”rÜs
:
	$logInv®id©e
(...)

45 
£lf
.
v®id
 = 
çl£


46 
”rÜs
.
	$log
(
£lf
, ...)

47 
’d


49 
loÿl
 
funùiÚ
 
	$_as£¹
(
£lf
, 
logâ
, 
‹¡
, 
Ëv–
, ...)

50 
nÙ
 
‹¡
 
th’


51 
	`ty³
(
Ëv–
è=ğ"numb”" 
th’


52 
Ëv–
 = (Ëv– > 0è
ªd
†ev– + 1 
Ü
†evel

53 
”rÜs
[
logâ
](
£lf
, 
Ëv–
, ...)

55 
”rÜs
[
logâ
](
£lf
, s–f.
deçuÉLev–
, 
Ëv–
, ...)

56 
’d


57 
’d


58  
‹¡


59 
’d


61 
funùiÚ
 
”rÜs
:
	$as£¹
(...)

62  
	`_as£¹
(
£lf
, "log", ...)

63 
’d


65 
funùiÚ
 
”rÜs
:
	$as£¹Inv®id©e
(...)

66  
	`_as£¹
(
£lf
, "logInvalidate", ...)

67 
’d


69 
funùiÚ
 
”rÜs
:
	$couÁ
()

71 
’d


73  
	$funùiÚ
()

74  
	`£tm‘©abË
({ 
v®id
 = 
Œue
, 
deçuÉLev–
 = 3 
	}
}, {

75 
	g__šdex
 = 
”rÜs
,

76 
	g__ÿÎ
 = 
”rÜs
.
log


78 
	g’d


	@/home/asabzi/msc-project/MoonGen-1/interface/flow/dynvars.lua

1 
loÿl
 
	g´Ùo
 = 
»quœe
 "proto.proto"

3 
loÿl
 
dynv¬
 = {}

4 
dynv¬
.
__šdex
 = dynvar

6 
loÿl
 
_®Ÿ£s
 = {

7 
udpSrc
 = 
´Ùo
.
udp
.
m‘©y³
.
£tSrcPÜt
, 
	gudpD¡
 =…rÙo.udp.m‘©y³.
£tD¡PÜt
,

8 
	gtıSrc
 = 
´Ùo
.
tı
.
m‘©y³
.
£tSrcPÜt
, 
	gtıD¡
 =…rÙo.tı.m‘©y³.
£tD¡PÜt
,

9 
	g‘hSrc
 = 
´Ùo
.
‘h
..
m‘©y³
.
£tSrc
, 
	g‘hD¡
 =…rÙo.‘h..m‘©y³.
£tD¡
,

10 
	g‘hVÏn
 = 
´Ùo
.
‘h
.
vÏn
.
m‘©y³
.
£tVÏnTag
,

11 
	g‘hšÃrVÏnTag
 = 
´Ùo
.
‘h
.
qšq
.
m‘©y³
.
£tIÂ”VÏnTag
,

12 
	g‘hou‹rVÏnId
 = 
´Ùo
.
‘h
.
qšq
.
m‘©y³
.
£tOu‹rVÏnTag
,

13 
	g‘hou‹rVÏnTag
 = 
´Ùo
.
‘h
.
qšq
.
m‘©y³
.
£tOu‹rVÏnTag
,

15 
loÿl
 
funùiÚ
 
	$_fšd_£‰”
(
pkt
, 
v¬
)

16 
loÿl
 
®Ÿs
 = 
_®Ÿ£s
[
pkt
 .. 
v¬
]

17 
®Ÿs
 
th’


18  
®Ÿs


19 
’d


21  
´Ùo
[
pkt
].
m‘©y³
["£t" .. 
v¬
]

22 
’d


24 
loÿl
 
funùiÚ
 
	$_Ãw_dynv¬
(
pkt
, 
v¬
, 
func
)

25 
loÿl
 
£lf
 = { 
pkt
 =…kt, 
v¬
 = v¬, 
func
 = funø
	}
}

26 
	g£lf
.
	g­¶yâ
 = 
	$_fšd_£‰”
(
pkt
, 
v¬
)

27 
	$as£¹
(
£lf
.
­¶yâ
, 
pkt
 .. 
v¬
)

28 
£lf
.
v®ue
 = 
	$func
()

30  
	$£tm‘©abË
(
£lf
, 
dynv¬
)

31 
’d


33 
funùiÚ
 
dynv¬
:
	$upd©e
()

34 
loÿl
 
v
 = 
£lf
.
	$func
()

35 
£lf
.
v®ue
 = 
v


36  
v


37 
’d


39 
funùiÚ
 
dynv¬
:
	$­¶y
(
pkt
)

40 
£lf
.
	$­¶yâ
(
pkt
[
£lf
.pkt], s–f.
v®ue
)

41 
’d


43 
funùiÚ
 
dynv¬
:
	$upd©eAµly
(
pkt
)

44 
dynv¬
.
	$upd©e
(
£lf
)

45 
£lf
.
	$­¶yâ
(
pkt
[
£lf
.pkt], s–f.
v®ue
)

46 
’d


48 
loÿl
 
dynv¬s
, 
dv_fš®
 = {
	}
}, {}

49 
	gdynv¬s
.
	g__šdex
, 
	gdv_fš®
.__šdex = 
dynv¬s
, 
dv_fš®


51 
funùiÚ
 
	gdynv¬s
.
	$Ãw
()

52 
loÿl
 
£lf
 = {

53 
šdex
 = {}, 
couÁ
 = 0

54 
	}
}

55  
	$£tm‘©abË
(
£lf
, 
dynv¬s
)

56 
’d


58 
loÿl
 
funùiÚ
 
	$_add_dv
(
£lf
, 
šdex
, 
dv
)

59 
bË
.
	$š£¹
(
£lf
, 
dv
)

60 
£lf
.
šdex
[šdex] = 
dv


61 
£lf
.
couÁ
 = self.count + 1

62 
’d


64 
funùiÚ
 
dynv¬s
:
	$add
(
pkt
, 
v¬
, 
func
)

65 
loÿl
 
dv
 = 
	$_Ãw_dynv¬
(
pkt
, 
v¬
, 
func
)

66 
	$_add_dv
(
£lf
, 
pkt
 .. 
v¬
, 
dv
)

67  
dv


68 
’d


70 
funùiÚ
 
dynv¬s
:
	$šh”™
(
Ùh”
, 
flTbl
)

71 
i
,
v
 
š
 
	$·œs
(
Ùh”
.
šdex
) do

72 
loÿl
 
áIndex
 = 
v
.
pkt
 .. v.
v¬


73 
nÙ
 
£lf
.
šdex
[
i
] 
ªd
‚Ù 
flTbl
[
áIndex
] 
th’


74 
	$_add_dv
(
£lf
, 
i
, 
v
)

75 
’d


76 
’d


77 
’d


79 
funùiÚ
 
dynv¬s
:
	$fš®ize
()

80 
	$£tm‘©abË
(
£lf
, 
dv_fš®
)

81 
’d


83 
funùiÚ
 
dv_fš®
:
	$upd©eAÎ
()

84 
i
 = 1, 
£lf
.
couÁ
 do

85 
dynv¬
.
	$upd©e
(
£lf
[
i
])

86 
’d


87 
’d


89 
funùiÚ
 
dv_fš®
:
	$­¶yAÎ
(
pkt
)

90 
i
 = 1, 
£lf
.
couÁ
 do

91 
dynv¬
.
	$­¶y
(
£lf
[
i
], 
pkt
)

92 
’d


93 
’d


95 
funùiÚ
 
dv_fš®
:
	$upd©eAµlyAÎ
(
pkt
)

96 
i
 = 1, 
£lf
.
couÁ
 do

97 
dynv¬
.
	$upd©eAµly
(
£lf
[
i
], 
pkt
)

98 
’d


99 
’d


101  
dynv¬s


	@/home/asabzi/msc-project/MoonGen-1/interface/flow/init.lua

1 
loÿl
 
	glfs
 = 
»quœe
 "syscall.lfs"

2 
loÿl
 
log
 = 
»quœe
 "log"

4 
loÿl
 
cÚfig’v
 = 
»quœe
 "configenv"

5 
loÿl
 
İtiÚs
 = 
»quœe
 "options"

6 
loÿl
 
”rÜs
 = 
»quœe
 "errors"

8 
loÿl
 
Flow
 = 
»quœe
 "flow.instance"

9 
loÿl
 
Pack‘
 = 
»quœe
 "flow.packet"

11 
loÿl
 
mod
 = { 
æows
 = {} }

13 
loÿl
 
	g’v
 = 
cÚfig’v
.
’v


14 
funùiÚ
 
’v
.
	$Flow
(
tbl
)

15 
	`ty³
(
tbl
è~ğ"bË" 
th’


16 
’v
.
	`”rÜ
("Invalid usage of Flow. Try Flow{...)")

18 
’d


20 -- 
check
 
Çme
, 
di§Îow
 
ch¬aù”s
 
th©


21 -- - 
would
 
com¶iÿ‹
 
sh–l
 
¬gum’t
 
	`·rsšg
 ( ;)

22 -- - 
š‹rã»
 
w™h
 
æow
 
·¿m‘”
 
	`syÁax
 (/:,)

23 
loÿl
 
Çme
 = 
tbl
[1]

24 
loÿl
 
t
 = 
	$ty³
(
Çme
)

25 
t
 ~ğ"¡ršg" 
th’


26 
’v
.
	`”rÜ
("Inv®id flow‚ame. SŒšgƒx³ùed, gÙ %s.", 
t
)

27 
Çme
 = 
n


28 
–£if
 
Çme
 =ğ"" 
th’


29 
’v
.
	`”rÜ
("Flow‚ame cannot beƒmpty.")

30 
Çme
 = 
n


31 
–£if
 
¡ršg
.
	`fšd
(
Çme
, "[ ;/:,]"è
th’


32 
’v
.
	`”rÜ
("Inv®id flow‚am%q. Name ÿÂÙ inşudthch¬aù” ' ;/:,'.", 
Çme
)

33 
Çme
 = 
n


34 
’d


36 -- 
fšd
 
š¡aû
 
of
 
·»Á
 
æow


37 
loÿl
 
·»Á
 = 
tbl
.parent

38 
t
 = 
	$ty³
(
·»Á
)

39 
t
 =ğ"¡ršg" 
th’


40 
·»Á
 = 
mod
.
æows
[parent]

41 
’v
.
”rÜ
:
	`as£¹
(
·»Á
, "UnknowÀ·»Á %q oàæow %q.",…¬’t, 
Çme
)

42 
–£if
 
t
 ~ğ"bË" 
ªd
 ~ğ"n" 
th’


43 
’v
.
	`”rÜ
("Inv®id v®ufÜ…¬’ˆoàæow %q. SŒšg o¸æowƒx³ùed, gÙ %s.", 
Çme
, 
t
)

44 
·»Á
 = 
n


45 
’d


47 
loÿl
 
·ck‘
 = 
tbl
[2]

48 
’v
.
”rÜ
:
	`as£¹
(
·ck‘
, "Flow %q dÛ nÙ hav¨v®id…ack‘.", 
Çme
è
ªd
 
·»Á
 
th’


49 
·ck‘
:
	$šh”™
(
·»Á
.
·ck‘
)

50 
’d


52 -- 
´oûss
 
İtiÚs


53 
tbl
[1],bl[2],bl.
·»Á
 = 
n
,‚il,‚il

54 
i
 
š
 
	$·œs
(
tbl
) do

55 
’v
.
”rÜ
:
	`as£¹
(
İtiÚs
[
i
], "Unknown option %q.", i)

56 
’d


58 
loÿl
 
İts
, 
·»Á_İts
 = {
	}
}, 
·»Á
 
ªd
 
	g·»Á
.
İtiÚs
 
	gÜ
 {}

59 
i
 
š
 
	$·œs
(
İtiÚs
) do

60 
İts
[
i
] = 
tbl
[i] 
Ü
 
·»Á_İts
[i]

61 
’d


63 -- 
»ady
 
to
 
as£mbË
 
æow
 
´ÙÙy³


64 
loÿl
 
æow
 = { 
Çme
 =‚ame, 
fe
 = 
’v
.
_FILE
, 
·»Á
 =…¬’t, 
·ck‘
 =…ack‘, 
İtiÚs
 = 
İts
}

66 -- 
©‹m±
 
to
 
add
Ø
glob®
 
æow
 
li¡


67 
	gæow
.
Çme
 
th’


68 
loÿl
 
	g‹¡
 = 
mod
.
æows
[
Çme
]

69 
‹¡
 
th’


70 
’v
.
”rÜ
:
as£¹
(
nÙ
 
‹¡
, 3, "Du¶iÿ‹ flow %q. AlsØš f%s.", 
Çme
,e¡.
fe
)

72 
	gmod
.
	gæows
[
Çme
] = 
æow


73 
’d


74 
’d


76  
æow


77 
’d


79 
loÿl
 
·ck‘msg
 = "Invalid usage of Packet. Try Packet.<Proto>{...}."

80 
loÿl
 
funùiÚ
 
	$_·ck‘_”rÜ
(è
’v
.
	$”rÜ
(
·ck‘msg
è
’d


81 
’v
.
Pack‘
 = 
	`£tm‘©abË
({
	}
}, {

82 
	g__Ãwšdex
 = 
_·ck‘_”rÜ
,

83 
	g__ÿÎ
 = 
_·ck‘_”rÜ
,

84 
	g__šdex
 = 
funùiÚ
(
_
, 
´Ùo
)

85 
ty³
(
´Ùo
è~ğ"¡ršg" 
th’


86 
’v
.
”rÜ
(
·ck‘msg
)

87  
funùiÚ
(è
’d


88 
’d


90  
funùiÚ
(
tbl
)

91 
ty³
(
tbl
è~ğ"bË" 
th’


92 
’v
.
”rÜ
(
·ck‘msg
)

94  
Pack‘
.
Ãw
(
´Ùo
, 
tbl
, 
’v
.
”rÜ
)

95 
’d


96 
’d


97 
	g’d


100 
loÿl
 
funùiÚ
 
	$´štE¼Ü
(
s’t
, ...)

101 
nÙ
 
s’t
 
th’


102 
log
:
	$”rÜ
(...)

103 
’d


104 
’d


106 
loÿl
 
funùiÚ
 
	$fš®izeE¼Hnd
(
s’t
, 
”rÜ
, 
msg
, ...)

107 
s’t
 
th’
  
’d


108 
loÿl
 
út
 = 
”rÜ
:
	$couÁ
()

109 
út
 > 0 
th’


110 
log
:
	$”rÜ
(
msg
, 
út
, ...)

111 
”rÜ
:
	$´št
(
Œue
, 
log
.
w¬n
,†og)

112 
’d


113 
’d


115 
funùiÚ
 
mod
.
	$üawlDœeùÜy
(
ba£Dœ
, 
s’t
)

116 
cÚfig’v
:
	$£tE¼Hnd
()

118 
ba£Dœ
 = ba£Dœ 
Ü
 "flows"

119 
f
 
š
 
lfs
.
	$dœ
(
ba£Dœ
) do

120 
f
 = 
ba£Dœ
 .. "/" .. f

121 
lfs
.
	`©Œibu‹s
(
f
, "mode"è=ğ"fe" 
th’


122 
cÚfig’v
:
	$·r£Fe
(
f
)

123 
’d


124 
’d


126 
	`fš®izeE¼Hnd
(
s’t
, 
cÚfig’v
:
	`”rÜ
(),

127 "%dƒ¼Ü found wh´oûssšg dœeùÜy %s:", 
ba£Dœ
)

128 
’d


130 
funùiÚ
 
mod
.
	$üawlFe
(
f’ame
, 
s’t
)

131 
cÚfig’v
:
	$£tE¼Hnd
()

132 
cÚfig’v
:
	$·r£Fe
(
f’ame
)

134 
	`fš®izeE¼Hnd
(
s’t
, 
cÚfig’v
:
	`”rÜ
(),

135 "%dƒ¼Ü found wh´oûssšg f%s:", 
f’ame
)

136 
’d


138 
funùiÚ
 
mod
.
	$g‘In¡ªû
(
Çme
, 
fe
, 
şi_İtiÚs
, 
ov”wr™es
, 
´İ”t›s
, 
s’t
, 
fš®
)

139 
loÿl
 
”rÜ
 = 
	$”rÜs
()

140 
”rÜ
.
deçuÉLev–
 = -1

142 
loÿl
 
æow
 = {

143 
»¡Üe
 = { 
İtiÚs
 = 
şi_İtiÚs
, 
ov”wr™es
 = overwrites },

144 
´Ùo
 = 
mod
.
æows
[
Çme
], -- 
·ck‘
 =…roto.packet,

145 
»suÉs
 = {}, 
´İ”t›s
 =…rİ”t› 
Ü
 {}

146 
	}
}

147 
£tm‘©abË
(
æow
, 
Flow
)

149 -- 
fšd
 
æow
 
´ÙÙy³


150 
fe
 
ªd
 
nÙ
 
	gæow
.
´Ùo
 
th’


151 
	gcÚfig’v
:
	$£tE¼Hnd
()

152 
cÚfig’v
:
	$·r£Fe
(
fe
)

153 
	`fš®izeE¼Hnd
(
s’t
, 
cÚfig’v
:
	`”rÜ
(),

154 "%dƒ¼Ü found wh´oûssšgƒxŒ¨f%s:", 
fe
)

156 
æow
.
´Ùo
 = 
mod
.
æows
[
Çme
]

157 
’d


159 
nÙ
 
æow
.
´Ùo
 
th’


160  
	`´štE¼Ü
(
s’t
, "Flow %q‚Ù found.", 
Çme
)

161 
’d


163 -- 
fšd
 
Ü
 
ü—‹
 
·ck‘


164 
æow
.
·ck‘
 = flow.
´Ùo
.packet

165 
ov”wr™es
 
ªd
 ov”wr™e ~ğ"" 
th’


166 
cÚfig’v
:
	$£tE¼Hnd
(
”rÜ
)

167 
æow
.
·ck‘
 = 
cÚfig’v
:
	`·r£SŒšg
(

168 ("»tuº Pack‘.%s{%s}"):
	`fÜm©
(
æow
.
·ck‘
.
´Ùo
, 
ov”wr™es
),

169 ("Ov”wr™e fÜ flow %q."):
	$fÜm©
(
Çme
)

172 
æow
.
·ck‘
 = 
Pack‘
.
	`Ãw
(æow.
´Ùo
.·ck‘.´Ùo, {
	}
})

173 
’d


175 
nÙ
 
	gæow
.
·ck‘
 
th’


176  
´štE¼Ü
(
s’t
, "Inv®id ov”wr™fÜ flow %q.", 
Çme
)

177 
’d


178 
	gæow
.
	g·ck‘
:
šh”™
(
æow
.
´Ùo
.
·ck‘
)

180 -- 
w¬n
 
about
 
unknown
 
İtiÚs


181 
i
 
š
 
	$·œs
(
şi_İtiÚs
) do

182 
”rÜ
:
	`as£¹
(
İtiÚs
[
i
], "Unknown option %q.", i)

183 
’d


185 -- 
´oûss
 
İtiÚs


186 
loÿl
 
»suÉs
 = 
æow
.results

187 
i
, 
İt
 
š
 
	$·œs
(
İtiÚs
) do

188 
”rÜ
:
	`£tP»fix
("O±iÚ '%s': ", 
i
)

189 
loÿl
 
v
 = 
şi_İtiÚs
[
i
] 
Ü
 
æow
.
´Ùo
.
İtiÚs
[i]

190 
»suÉs
[
i
] = 
İt
.
	$·r£
(
æow
, 
v
, 
”rÜ
)

191 
’d


193 -- 
´•¬e
 
æow


194 
”rÜ
:
	$£tP»fix
()

195 
æow
:
	$´•¬e
(
”rÜ
, 
fš®
)

197 
	`fš®izeE¼Hnd
(
s’t
, 
”rÜ
, "%dƒ¼Ü found wh´oûssšg flow %q.", 
Çme
)

199 
”rÜ
.
v®id
 
th’


200  
æow


201 
’d


202 
’d


204 
funùiÚ
 
mod
.
	$»¡Üe
(
æow
)

205 
loÿl
 
p
, 
r
 = 
æow
.
´Ùo
, flow.
»¡Üe


206  
mod
.
	$g‘In¡ªû
(
p
.
Çme
,….
fe
, 
r
.
İtiÚs
,„.
ov”wr™es
, 
æow
.
´İ”t›s
, 
Œue
,rue)

207 
’d


209  
mod


	@/home/asabzi/msc-project/MoonGen-1/interface/flow/instance.lua

1 
loÿl
 
	gFlow
 = {}

2 
Flow
.
__šdex
 = Flow

4 
loÿl
 
funùiÚ
 
£·¿‹Uid
(
uid
)

5 -- 
luacheck
: 
glob®s
 
»ad
 
b™


7 
b™
.
bªd
(b™.
rshiá
(
uid
, 24), 0xff),

8 
	gb™
.
bªd
(
b™
.
rshiá
(
uid
, 16), 0xff),

9 
	gb™
.
bªd
(
b™
.
rshiá
(
uid
, 8), 0xff),

10 
	gb™
.
bªd
(
b™
.
rshiá
(
uid
, 0), 0xff)

11 
’d


13 
funùiÚ
 
	gFlow
:
	$´•¬e
(
”rÜ
, 
fš®
)

14 
£lf
.
isDyÇmic
 = 
	`ty³
(£lf.
upd©ePack‘
) ~= "nil"

15 
£lf
.
·ck‘
:
	$´•¬e
(
”rÜ
, 
£lf
, 
fš®
)

17 
£lf
:
İtiÚ
 "uniquePaylßd" 
th’


18 
loÿl
 
p0
, 
p1
, 
p2
, 
p3
 = 
	`£·¿‹Uid
(
£lf
:
İtiÚ
 "uid")

19 
loÿl
 
size
 = 
£lf
:
	$·ck‘Size
()

20 
£lf
.
£tPaylßd
 = 
	$funùiÚ
(
pkt
)

21 
loÿl
 
by‹s
 = 
pkt
:
	$g‘By‹s
()

22 
by‹s
[
size
 - 1] = 
p0


23 
by‹s
[
size
 - 2] = 
p1


24 
by‹s
[
size
 - 3] = 
p2


25 
by‹s
[
size
 - 4] = 
p3


26 
’d


28 
£lf
.
£tPaylßd
 = 
	$funùiÚ
(è
’d


29 
’d


30 
’d


32 
funùiÚ
 
Flow
:
	$´İ”ty
(
Çme
)

33  
£lf
.
´İ”t›s
[
Çme
]

34 
’d


36 
funùiÚ
 
Flow
:
	$£tPrİ”ty
(
Çme
, 
v®
)

37 
£lf
.
´İ”t›s
[
Çme
] = 
v®


38 
’d


40 
funùiÚ
 
Flow
:
	$İtiÚ
(
Çme
)

41  
£lf
.
»suÉs
[
Çme
]

42 
’d


44 
funùiÚ
 
Flow
:
	$flBuf
(
buf
)

45 
loÿl
 
pkt
 = 
£lf
.
·ck‘
.
	$g‘Pack‘
(
buf
)

46 
pkt
:
	$fl
(
£lf
.
·ck‘
.
flTbl
)

47 
£lf
.
	$£tPaylßd
(
buf
)

48  
pkt


49 
’d


51 
funùiÚ
 
Flow
:
	$flUpd©eBuf
(
buf
)

52 
loÿl
 
pkt
 = 
£lf
.
·ck‘
.
	$g‘Pack‘
(
buf
)

53 
pkt
:
	$fl
(
£lf
.
·ck‘
.
flTbl
)

54 
£lf
.
	$£tPaylßd
(
buf
)

55 
£lf
.
	$upd©ePack‘
(
£lf
.
·ck‘
.
dynv¬s
, 
pkt
)

56  
pkt


57 
’d


59 
funùiÚ
 
Flow
:
	$upd©eBuf
(
buf
)

60 
loÿl
 
pkt
 = 
£lf
.
·ck‘
.
	$g‘Pack‘
(
buf
)

61 
£lf
.
	$upd©ePack‘
(
£lf
.
·ck‘
.
dynv¬s
, 
pkt
)

62  
pkt


63 
’d


65 
funùiÚ
 
Flow
:
	$·ck‘Size
(
checksum
)

66  (
£lf
.
·ck‘
.
flTbl
.
pktL’gth
 
Ü
 0è+ (
checksum
 
ªd
 4 or 0)

67 
’d


69 
funùiÚ
 
Flow
:
	$şÚe
(
´İ”t›s
)

70 
loÿl
 
şÚe
 = 
	`£tm‘©abË
({
	}
}, 
	gFlow
)

72 
	gi
,
v
 
š
 
	$·œs
(
£lf
) do

73 
i
 =ğ"´İ”t›s" 
th’


74 
şÚe
[
i
] = 
	`m”geTabËs
({
	}
}, 
	gv
, 
	g´İ”t›s
è-- 
	gluacheck
: 
glob®s
 
»ad
 
m”geTabËs


76 
şÚe
[
i
] = 
v


77 
’d


78 
’d


80  
şÚe


81 
’d


83 
funùiÚ
 
Flow
:
	$g‘D–ay
()

84 
loÿl
 
cbr
 = 
£lf
.
»suÉs
.
¿‹


85 
cbr
 
th’


86 
loÿl
 
psize
 = 
£lf
:
	`·ck‘Size
(
Œue
)

87 -- 
cbr
 => 
mb™
/
s
 => 
b™
/1000
ns


88 -- 
psize
 => 
b
/
p
 => 8b
™
/p

89  8000 * 
psize
 / 
cbr
 -- => 
ns
/
p


90 
’d


91 
’d


93  
Flow


	@/home/asabzi/msc-project/MoonGen-1/interface/flow/packet.lua

1 
loÿl
 
	g·ck‘
 = 
»quœe
 "packet"

2 
loÿl
 
ffi
 = 
»quœe
 "ffi"

4 
loÿl
 
d•’d’c›s
 = 
»quœe
 "dependencies"

6 
loÿl
 
Dynv¬s
 = 
»quœe
 "flow.dynvars"

8 
loÿl
 
Pack‘
 = {}

9 
Pack‘
.
__šdex
 = Packet

11 
ffi
.
cdef
[[

12 
	s‹¡_·ck‘_t
 {};

15 
loÿl
 
	g‹¡_·ck‘
 = 
ffi
.
m‘©y³
("structest_packet_t", {

16 
__šdex
 = {

17 
g‘L’gth
 = 
funùiÚ
(è 0 
’d
,

18 
g‘D©a
 = 
funùiÚ
(è 
n
 
’d
,

22 
funùiÚ
 
	gPack‘
.
	$Ãw
(
´Ùo
, 
tbl
, 
”rÜ
)

23 
loÿl
 
£lf
 = {

24 
´Ùo
 =…roto,

25 
flTbl
 = {}, 
d•v¬s
 = {},

26 
dynv¬s
 = 
Dynv¬s
.
	`Ãw
()

27 
	}
}

29 
	gi
,
v
 
š
 
	$·œs
(
tbl
) do

30 
loÿl
 
pkt
, 
v¬
 = 
¡ršg
.
	`m©ch
(
i
, "^([%l%d]+)(%u.*)$");

32 
pkt
 
th’


33 
	`ty³
(
v
è=ğ"funùiÚ" 
th’


34 
£lf
.
flTbl
[
i
] = s–f.
dynv¬s
:
	`add
(
pkt
, 
v¬
, 
v
).
v®ue


35 
–£if
 
	`ty³
(
v
è=ğ"bË" 
th’


36 
loÿl
 
á
 = 
”rÜ
:
	`as£¹
(
v
[1] 
ªd
 
d•’d’c›s
[v[1]],

37 "Inv®idabË…as£dØf›ld '%s'.", 
i
)

38 
£lf
.
d•v¬s
[
i
] = { 
d•
 = 
á
, 
tbl
 = 
v
 
	}
}

39 
	g£lf
.
	gflTbl
[
i
] = 
Œue
 -- 
to
 
ov”wr™e
 
Ú
 
šh”™


41 
£lf
.
flTbl
[
i
] = 
v


42 
’d


44 
”rÜ
("Inv®id…ack‘ f›ld %q. FÜm© i 'Ïy”F›ld' (e.g. ip4D¡).", 
i
)

45 
’d


46 
’d


48 
	g£lf
.
	gg‘Pack‘
 = 
·ck‘
["g‘" .. 
´Ùo
 .. "Packet"]

49 
loÿl
 
pkt
 = 
£lf
.
g‘Pack‘
(
	$‹¡_·ck‘
())

50 
£lf
.
mšSize
 = 
ffi
.(
pkt
:
	$g‘Name
())

51 
£lf
.
hasPaylßd
 = 
	`pÿÎ
(
	$funùiÚ
(è
	$ty³
(
pkt
.
·ylßd
è
’d
)

53  
	$£tm‘©abË
(
£lf
, 
Pack‘
)

54 
’d


56 
loÿl
 
funùiÚ
 
	$_šh”™_d•v¬s
(
£lf
, 
Ùh”
)

57 
i
,
v
 
š
 
	$·œs
(
Ùh”
.
d•v¬s
) do

58 
nÙ
 
£lf
.
d•v¬s
[
i
] 
ªd
‚Ù s–f.
flTbl
[i] 
th’


59 
£lf
.
d•v¬s
[
i
] = 
v


60 
’d


61 
’d


62 
’d


64 
funùiÚ
 
Pack‘
:
	$šh”™
(
Ùh”
)

65 
Ùh”
 
th’


66 
£lf
.
dynv¬s
:
	$šh”™
(
Ùh”
.
dynv¬s
, 
£lf
.
flTbl
)

67 
	$_šh”™_d•v¬s
(
£lf
, 
Ùh”
)

69 
i
,
v
 
š
 
	$·œs
(
Ùh”
.
flTbl
) do

70 
nÙ
 
£lf
.
flTbl
[
i
] 
th’


71 
£lf
.
flTbl
[
i
] = 
v


72 
’d


73 
’d


74 
’d


76  
£lf


77 
’d


79 
funùiÚ
 
Pack‘
:
	$´•¬e
(
”rÜ
, 
æow
, 
fš®
)

80 
”rÜ
:
	`as£¹Inv®id©e
(
	`ty³
(
£lf
.
flTbl
.
pktL’gth
) == "number",

81 "Pack‘ f›ld…ktL’gth ha tØb£ˆtØ¨v®id‚umb”."è
th’


82 
”rÜ
:
	`as£¹Inv®id©e
(
£lf
.
flTbl
.
pktL’gth
 >ğ£lf.
mšSize
,

84 
£lf
.
´Ùo
, s–f.
mšSize
)

85 
’d


87 
fš®
 
th’


88 
i
,
v
 
š
 
	$·œs
(
£lf
.
d•v¬s
) do

89 
£lf
.
flTbl
[
i
] = 
v
.
d•
.
	$g‘V®ue
(
æow
, 
v
.
tbl
)

90 
’d


91 
’d


93 
£lf
.
dynv¬s
:
	$fš®ize
()

94 
’d


96  
Pack‘


	@/home/asabzi/msc-project/MoonGen-1/interface/flowparse.lua

1 
loÿl
 
	glog
 = 
»quœe
 "log"

3 
loÿl
 
funùiÚ
 
	$·r£_deviûs
(
s
, 
devnum
, 
Çme
)

4 
loÿl
 
»suÉ
 = {
	}
}

6 
num
 
š
 
¡ršg
.
gm©ch
(
s
, "([^,]+)") do

7 
	gnum
 ~ğ"" 
th’


8 
loÿl
 
n
 = 
	$tÚumb”
(
num
)

9 
nÙ
 
n
 
Ü
‚ < 0 o¸À>ğ
devnum
 
th’


10 
log
:
	`”rÜ
("Inv®id deviû‚umb” %q fÜ flow %q.", 
num
, 
Çme
)

12 
bË
.
	$š£¹
(
»suÉ
, 
n
)

13 
’d


14 
’d


15 
’d


17  
»suÉ


18 
’d


20 
loÿl
 
fmt
 = "[<file>/]<name>:[<tx-list>]:[<rx-list>]:[<option-list>]:[<overwrites>]"

21  
	$funùiÚ
(
s
, 
devnum
)

22 
loÿl
 
Çme
, 
tx
, 
rx
, 
İt¡ršg
, 
ov”wr™es
 = 
¡ršg
.
	`m©ch
(
s
, "^([^:]+)" .. (":?([^:]*)"):
	`»p
(3) .. ":?(.*)$")

23 
nÙ
 
Çme
 
Ü
‚am=ğ"" 
th’


24 
log
:
	`çl
("Invalid…arameter: %q.\nExpected format: '%s'."

25 .. "\nAÎ†i¡ ¬',' s•”©ed. T¿šg ':' cª bom™‹d.", 
s
, 
fmt
)

27 
’d


29 
loÿl
 
fe
, 
_Çme


30 
fe
, 
_Çme
 = 
¡ršg
.
	`m©ch
(
Çme
, "(.*)/([^/]+)")

31 
Çme
 = 
_Çme
 
Ü
‚ame

33 
loÿl
 
İtiÚs
 = {
	}
}

34 
İt
 
š
 
¡ršg
.
gm©ch
(
İt¡ršg
, "([^,]+)") do

35 
	gİt
 ~ğ"" 
th’


36 
loÿl
 
k
, 
	gv
 = 
¡ršg
.
m©ch
(
İt
, "^([^=]+)=([^=]+)$")

37 
nÙ
 
k
 
th’


38 
	gk
, 
	gv
 = 
İt
, 
Œue


39 
’d


40 
	gİtiÚs
[
k
] = 
v


41 
’d


42 
’d


45 
Çme
 =‚ame, 
	gfe
 = 
fe
,

46 
	gtx
 = 
·r£_deviûs
(
tx
, 
devnum
, 
Çme
),

47 
	grx
 = 
·r£_deviûs
(
rx
, 
devnum
, 
Çme
),

48 
	gİtiÚs
 = 
İtiÚs
, 
	gov”wr™es
 = 
ov”wr™es


50 
	g’d


	@/home/asabzi/msc-project/MoonGen-1/interface/init.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
log
 = 
»quœe
 "log"

5 
loÿl
 
ba£
 = 
debug
.
g‘šfo
(1, "S").
	gsourû
:
sub
(2,-9è-- 
	g»move
 "init.lua"

6 
	g·ckage
.
	g·th
 = ("%s;%s?.lua;%s?/š™.lua"):
	$fÜm©
(
·ckage
.
·th
, 
ba£
, base)

8 
loÿl
 
Flow
 = 
»quœe
 "flow"

9 
loÿl
 
·r£
 = 
»quœe
 "flowparse"

10 
loÿl
 
couÁ”
 = 
»quœe
 "counter"

11 
loÿl
 
devmgr
 = 
»quœe
 "devmgr"

13 
loÿl
 
¬pTh»ad
 = 
»quœe
 "threads.arp"

14 
loÿl
 
lßdTh»ad
 = 
»quœe
 "threads.load"

15 
loÿl
 
deviûStsTh»ad
 = 
»quœe
 "threads.deviceStats"

16 
loÿl
 
couÁTh»ad
 = 
»quœe
 "threads.count"

17 
loÿl
 
time¡ampTh»ad
 = 
»quœe
 "threads.timestamp"

20 
funùiÚ
 
	`cÚfigu»
(
·r£r
è-- 
luacheck
: 
glob®s
 
cÚfigu»


21 
·r£r
:
	`desütiÚ
("Configuration based interface for MoonGen.")

23 
loÿl
 
¡¬t
 = 
·r£r
:
	`commªd
("start", "Send one or more flows.")

24 
¡¬t
:
	`İtiÚ
("-c --config", "Config file directory."):("flows")

25 
¡¬t
:
	`İtiÚ
("-o --output", "Output directory (histogramsƒtc.)."):(".")

26 
¡¬t
:
	`¬gum’t
("æows", "Li¡ oàæow‚ames."):
¬gs
 "+"

28 
»quœe
 "şi" (
·r£r
)

29 
’d


31 
funùiÚ
 
	`ma¡”
(
¬gs
è-- 
luacheck
: 
glob®s
 
ma¡”


32 
Flow
.
	$üawlDœeùÜy
(
¬gs
.
cÚfig
)

34 
loÿl
 
deviûs
 = 
devmgr
.
	$ÃwDevmgr
()

35 
loÿl
 
æows
 = {
	}
}

36 
_
,
¬g
 
š
 
	$aœs
(
¬gs
.
æows
) do

37 
loÿl
 
f
 = 
	$·r£
(
¬g
, 
deviûs
.
max
)

39 #f.
tx
 =ğ0 
ªd
 #f.
rx
 =ğ0 
th’


40 
log
:
	`”rÜ
("Needo…ass‡t†east onex or„x device.")

41 
f
 = 
n


43 
f
 = 
Flow
.
	`g‘In¡ªû
(f.
Çme
, f.
fe
, f.
İtiÚs
, f.
ov”wr™es
, {

44 
couÁ”
 = couÁ”.
	`Ãw
(),

45 
tx
 = 
f
.tx, 
rx
 = f.rx

46 
	}
})

47 
’d


49 
f
 
th’


50 
	gbË
.
	$š£¹
(
æows
, 
f
)

51 
log
:
	`šfo
("Flow % => %#x", 
f
.
´Ùo
.
Çme
, f:
İtiÚ
 "uid")

52 
’d


53 
’d


55 
¬pTh»ad
.
	$´•¬e
(
æows
, 
deviûs
)

56 
lßdTh»ad
.
	$´•¬e
(
æows
, 
deviûs
)

57 
couÁTh»ad
.
	$´•¬e
(
æows
, 
deviûs
)

58 
deviûStsTh»ad
.
	$´•¬e
(
æows
, 
deviûs
)

59 
time¡ampTh»ad
.
	$´•¬e
(
æows
, 
deviûs
)

61 #lßdTh»ad.
æows
 =ğ0 
th’
--
ªd
 #countThread.flows == 0hen

62 
log
:
	`”rÜ
("No valid flows„emaining.")

64 
’d


66 
deviûs
:
	$cÚfigu»
()

68 
¬pTh»ad
.
	$¡¬t
(
deviûs
)

69 
deviûStsTh»ad
.
	$¡¬t
(
deviûs
)

70 
couÁTh»ad
.
	$¡¬t
(
deviûs
)

71 
lßdTh»ad
.
	$¡¬t
(
deviûs
)

72 
time¡ampTh»ad
.
	$¡¬t
(
deviûs
, 
¬gs
.
ouut
)

74 
mg
.
	$wa™FÜTasks
()

75 
’d


	@/home/asabzi/msc-project/MoonGen-1/interface/options/dataLimit.lua

1 
loÿl
 
	gun™s
 = 
»quœe
 "units"

3 
loÿl
 
İtiÚ
 = {}

5 
İtiÚ
.
desütiÚ
 = "Stop sendinghis flow‡fter‡ certain‡mount of data. As"

11 
İtiÚ
.
cÚfigH–p
 = "Passing‡‚umber instead of‡ string will interprethe value‡s megabit."

12 
İtiÚ
.
u§ge
 = { { "<number><sizeUnit>", "Default use case." } }

14 
loÿl
 
funùiÚ
 
	$_·r£_lim™
(
l¡ršg
, 
psize
)

15 
loÿl
 
num
, 
un™
 = 
¡ršg
.
	`m©ch
(
l¡ršg
, "^(%d+%.?%d*)(%a+)$")

16 
nÙ
 
num
 
th’


17  
n
, "Invalid format. Should be '<number><unit>'."

18 
’d


20 
num
, 
un™
 = 
	`tÚumb”
Òum), 
¡ršg
.
	$low”
(
un™
)

21 
un™
 =ğ"" 
th’


22 
un™
 = 
un™s
.
size
.
m
 -- 
is
 
mb™


23 
–£if
 
¡ršg
.
	`fšd
(
un™
, "b™$"è
th’


24 
un™
 = 
un™s
.
size
[
¡ršg
.
	`sub
(unit, 1, -4)]

25 
–£if
 
¡ršg
.
	`fšd
(
un™
, "b$"è
th’


26 
un™
 = 
un™s
.
size
[
¡ršg
.
	`sub
(unit, 1, -2)] * 8

27 
–£if
 
¡ršg
.
	`fšd
(
un™
, "p$"è
th’


28 
un™
 = 
un™s
.
size
[
¡ršg
.
	`sub
(un™, 1, -2)] * 
psize
 * 8

30  
n
, 
un™
.
sizeE¼Ü


31 
’d


33  
num
, 
un™


34 
’d


36 
funùiÚ
 
İtiÚ
.
	$·r£
(
£lf
, 
lim™
, 
”rÜ
)

37 
nÙ
 
lim™
 
th’
  
’d


39 
loÿl
 
psize
 = 
£lf
:
	$·ck‘Size
(
Œue
)

40 
loÿl
 
t
 = 
	$ty³
(
lim™
)

42 
loÿl
 
num
, 
un™


43 
t
 =ğ"numb”" 
th’


44 
num
, 
un™
 = 
lim™
, 
un™s
.
size
.
m


45 
–£if
 
t
 =ğ"¡ršg" 
th’


46 
num
, 
un™
 = 
	$_·r£_lim™
(
lim™
, 
psize
)

47 
”rÜ
:
	$as£¹
(
num
, 
un™
)

49 
	`”rÜ
("Inv®id‡rgum’t. SŒšg o¸numb”ƒx³ùed, gÙ %s.", 
t
)

50 
’d


52 -- 
round
 
up
 
to
 
mimic
 
behaviour
 
of
 
timeLim™


53 
num
 
th’


54  
m©h
.
	`û
(
num
 * 
un™
 / (
psize
 * 8))

55 
’d


56 
’d


58  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/options/init.lua

1 
loÿl
 
	gİtiÚs
 = {}

3 
_
,
v
 
š
 
	gaœs
 {

6 
	gİtiÚs
[
v
] = 
»quœe
("options." .. v)

7 
’d


9  
İtiÚs


	@/home/asabzi/msc-project/MoonGen-1/interface/options/mode.lua

1 
loÿl
 
funùiÚ
 
	$g‘_upd©e_d–ay_Úe
(
æow
)

2  
	$funùiÚ
()

3 
æow
.
upd©ePack‘
 = flow.
_upd©e_·ck‘


4 
æow
.
_upd©e_·ck‘
 = 
n


5 
’d


6 
’d


8 
loÿl
 
funùiÚ
 
	$_¿ndom
(
dv
, 
pkt
)

9 
loÿl
 
šdex
 = 
m©h
.
	$¿ndom
(
dv
.
couÁ
)

10 
dv
[
šdex
]:
	$upd©e
()

11 
dv
:
	$­¶yAÎ
(
pkt
)

12 
’d


14 
loÿl
 
funùiÚ
 
	$_¿ndom_®t
(
dv
, 
pkt
)

15 
loÿl
 
šdex
 = 
m©h
.
	$¿ndom
(
dv
.
couÁ
)

16 
dv
[
šdex
]:
	$upd©eAµly
(
pkt
)

17 
’d


19 
loÿl
 
funùiÚ
 
	$_®l
(
dv
, 
pkt
)

20 
dv
:
	$upd©eAµlyAÎ
(
pkt
)

21 
’d


23 
loÿl
 
_v®id_modes
 = {

24 
sšgË
 = 
	`funùiÚ
()

25 
loÿl
 
šdex
 = 0

26  
	`funùiÚ
(
dv
, 
pkt
)

27 
dv
[
šdex
 + 1]:
	`upd©e
()

28 
dv
:
	`­¶yAÎ
(
pkt
)

29 
šdex
 = 
	`šcAndW¿p
(šdex, 
dv
.
couÁ
è-- 
luacheck
: 
glob®s
 
šcAndW¿p


30 
’d


31 
’d
,

32 
®‹º©šg
 = 
	`funùiÚ
()

33 
loÿl
 
šdex
 = 0

34  
	`funùiÚ
(
dv
, 
pkt
)

35 
dv
[
šdex
 + 1]:
	`upd©eAµly
(
pkt
)

36 
šdex
 = 
	`šcAndW¿p
(šdex, 
dv
.
couÁ
è-- 
luacheck
: 
glob®s
 
šcAndW¿p


37 
’d


38 
’d
,

39 
¿ndom
 = 
	`funùiÚ
(è 
_¿ndom
 
’d
,

40 
¿ndom_®t
 = 
	`funùiÚ
(è 
_¿ndom_®t
 
’d
,

41 
®l
 = 
	`funùiÚ
(è 
_®l
 
’d
,

42 
	}
}

44 
loÿl
 
	g_mod–i¡
 = { "none" }

45 
i
 
š
 
	$·œs
(
_v®id_modes
) do

46 
bË
.
	$š£¹
(
_mod–i¡
, 
i
)

47 
’d


49 
loÿl
 
İtiÚ
 = {
	}
}

51 
İtiÚ
.
desütiÚ
 = "Control how fields of dynamic flows‡re updated‡nd‡pplied."

52 
İtiÚ
.
cÚfigH–p
 = "Will‡lso‡ccept‡ functionhat will be called forƒach"

55 .. [[
funùiÚ
 
mode
(
dynv¬s
, 
·ck‘
)

56 -- 
avaabË
 
­i


57 
dynv¬s
[1]:
	$upd©e
()

58 
dynv¬s
[1]:
	$­¶y
(
·ck‘
)

59 
dynv¬s
[1]:
	`upd©eAµly
(
·ck‘
)

61 -- 
cÚv’›nû
 
­i


62 
dynv¬s
:
	$upd©eAÎ
()

63 
dynv¬s
:
	$­¶yAÎ
(
·ck‘
)

64 
dynv¬s
:
	$upd©eAµlyAÎ
(
·ck‘
)

65 
’d
]]

68 
İtiÚ
.
u§ge
 = {

75 
	}
}

77 
İtiÚ
.
fÜm©SŒšg
 = {}

78 
_
,
v
 
š
 
	$aœs
(
_mod–i¡
) do

79 
bË
.
	$š£¹
(
İtiÚ
.
fÜm©SŒšg
, 
v
)

80 
’d


81 
İtiÚ
.
fÜm©SŒšg
 = "<" .. 
bË
.
	`cÚÿt
(option.formatString, "|") .. ">"

82 
İtiÚ
.
h–pSŒšg
 = "Change how dynamic fields‡re updated. (default = single)"

84 
funùiÚ
 
İtiÚ
.
	$·r£
(
£lf
, 
mode
, 
”rÜ
)

85 #£lf.
·ck‘
.
dynv¬s
 =ğ0 
th’


86 
”rÜ
:
	`as£¹
(
nÙ
 
mode
 
Ü
 mode == "none",

89 
–£if
 
mode
 =ğ"nÚe" 
th’


91 
’d


93 -- 
DÚ
't changehe first…acket

94 
£lf
.
upd©ePack‘
 = 
	$g‘_upd©e_d–ay_Úe
(
£lf
)

96 
loÿl
 
t
 = 
	$ty³
(
mode
)

97 
t
 =ğ"¡ršg" 
th’


98 
mode
 = 
”rÜ
:
	`as£¹
(
_v®id_modes
[
¡ršg
.
	`low”
(mode)], "Invalid value %q. Can be one of %s.",

99 
mode
, 
bË
.
	`cÚÿt
(
_mod–i¡
, ", "))

101 
mode
 
th’


102 
mode
 = 
	$mode
()

103 
’d


104 
–£if
 
t
 ~ğ"funùiÚ" 
ªd
 ~ğ"n" 
th’


105 
	`”rÜ
("Inv®id‡rgum’t. SŒšg o¸funùiÚƒx³ùed, gÙ %s.", 
t
)

106 
’d


108 
£lf
.
_upd©e_·ck‘
 = 
mode
 
Ü
 
_v®id_modes
.
	$sšgË
()

109 
’d


111  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/options/rate.lua

1 
loÿl
 
	gun™s
 = 
»quœe
 "units"

3 
loÿl
 
funùiÚ
 
	$_·r£_¿‹
(
r¡ršg
, 
psize
)

4 
loÿl
 
num
, 
un™
, 
time
 = 
¡ršg
.
	`m©ch
(
r¡ršg
, "^(%d+%.?%d*)(%a*)/?(%a*)$")

5 
nÙ
 
num
 
th’


6  
n
, "Invalid format. Should be '<number>[unit][/<time>]'."

7 
’d


9 
num
, 
un™
, 
time
 = 
	`tÚumb”
Òum), 
¡ršg
.
	`low”
(un™), 
un™s
.time[time]

10 
nÙ
 
time
 
th’


11  
n
, 
un™s
.
timeE¼Ü


12 
’d


14 
un™
 =ğ"" 
th’


15 
un™
 = 
un™s
.
size
.
m
 -- 
is
 
mb™
/
s


16 
–£if
 
¡ršg
.
	`fšd
(
un™
, "b™$"è
th’


17 
un™
 = 
un™s
.
size
[
¡ršg
.
	`sub
(unit, 1, -4)]

18 
–£if
 
¡ršg
.
	`fšd
(
un™
, "b$"è
th’


19 
un™
 = 
un™s
.
size
[
¡ršg
.
	`sub
(unit, 1, -2)] * 8

20 
–£if
 
¡ršg
.
	`fšd
(
un™
, "p$"è
th’


21 
un™
 = 
un™s
.
size
[
¡ršg
.
	`sub
(un™, 1, -2)] * 
psize
 * 8

23  
n
, 
un™s
.
sizeE¼Ü


24 
’d


26 
un™
 = un™ / 10 ^ 6 -- 
cbr
 
is
 
š
 
mb™
/
s


27  
num
 * 
un™
 / 
time


28 
’d


31 
loÿl
 
İtiÚ
 = {
	}
}

33 
İtiÚ
.
desütiÚ
 = "Limithe„ate of data fromhis flow. Will‡utomatically"

35 
İtiÚ
.
cÚfigH–p
 = "Passing‡‚umber instead of‡ string will interprethe value‡s mbit/s."

36 
İtiÚ
.
u§ge
 = {

43 
funùiÚ
 
İtiÚ
.
	$·r£
(
£lf
, 
¿‹
, 
”rÜ
)

44 
nÙ
 
¿‹
 
th’
  
’d


46 
loÿl
 
t
 = 
	$ty³
(
¿‹
)

48 
loÿl
 
cbr


49 
t
 =ğ"numb”" 
th’


50 
cbr
 = 
¿‹


51 
–£if
 
t
 =ğ"¡ršg" 
th’


52 
loÿl
 
msg


53 
cbr
, 
msg
 = 
	`_·r£_¿‹
(
¿‹
, 
£lf
:
	$·ck‘Size
(
Œue
))

54 
”rÜ
:
	$as£¹
(
cbr
, 
msg
)

56 
	`”rÜ
("Inv®id‡rgum’t. SŒšg o¸numb”ƒx³ùed, gÙ %s.", 
t
)

57 
’d


59  
cbr


60 
’d


62  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/options/ratePattern.lua

1 
loÿl
 
	g_·‰”Æi¡
, 
	g_·‰”n£t
 = { "cbr", "poisson" }, {}

2 -- 
TODO
 
	g·‰”n
 = 
cu¡om
 (
şosu»
 
ªd
 
buf
:
£tD–ay
)

3 -- 
TODO
 
æagO±iÚ
 
to
 
’abË
 
üc
 
¿‹cÚŒŞ


4 
_
,
v
 
š
 
	$aœs
(
_·‰”Æi¡
) do

5 
_·‰”n£t
[
v
] = 
Œue


6 
’d


8 
loÿl
 
İtiÚ
 = {
	}
}

10 
İtiÚ
.
desütiÚ
 = "Control how bytes‡re distributed overime, when‡„atelimit is set."

11 
İtiÚ
.
u§ge
 = {

15 
funùiÚ
 
İtiÚ
.
	$·r£
(
_
, 
·‰”n
, 
”rÜ
)

16 
loÿl
 
t
 = 
	$ty³
(
·‰”n
)

18 
t
 =ğ"¡ršg" 
th’


19  
”rÜ
:
	`as£¹
(
_·‰”n£t
[
·‰”n
], "Invalid value %q. Can be one of %s.",

20 
·‰”n
, 
bË
.
	`cÚÿt
(
_·‰”Æi¡
, ", ")è
Ü
 "cbr"

21 
–£if
 
t
 ~ğ"n" 
th’


22 
	`”rÜ
("Inv®id‡rgum’t. SŒšgƒx³ùed, gÙ %s.", 
t
)

23 
’d


26 
’d


28  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/options/timeLimit.lua

1 
loÿl
 
	gun™s
 = 
»quœe
 "units"

3 
loÿl
 
İtiÚ
 = {}

5 
İtiÚ
.
desütiÚ
 = "Stop sendinghis flow‡fter‡ certainime, starting with"

10 
İtiÚ
.
cÚfigH–p
 = "Passing‡‚umber instead of‡ string will interprethe value‡s‚umber of seconds."

11 
İtiÚ
.
u§ge
 = { { "<number><timeUnit>", "Default use case." } }

14 
loÿl
 
funùiÚ
 
	$_·r£_lim™
(
l¡ršg
)

15 
loÿl
 
num
, 
un™
 = 
¡ršg
.
	`m©ch
(
l¡ršg
, "^(%d+%.?%d*)(%a+)$")

16 
nÙ
 
num
 
th’


17  
n
, "Invalid format. Should be '<number><unit>'."

18 
’d


20 
num
, 
un™
 = 
	`tÚumb”
Òum), 
un™s
.
time
[
¡ršg
.
	`low”
(unit)]

21 
nÙ
 
un™
 
th’


22  
n
, 
un™
.
timeE¼Ü


23 
’d


25  
num
, 
un™


26 
’d


28 
funùiÚ
 
İtiÚ
.
	$·r£
(
_
, 
lim™
, 
”rÜ
)

29 
nÙ
 
lim™
 
th’
  
’d


31 
loÿl
 
t
 = 
	$ty³
(
lim™
)

33 
loÿl
 
num
, 
un™


34 
t
 =ğ"numb”" 
th’


35 
num
, 
un™
 = 
lim™
, 
un™s
.
time
.
s


36 
–£if
 
t
 =ğ"¡ršg" 
th’


37 
num
, 
un™
 = 
	$_·r£_lim™
(
lim™
)

38 
”rÜ
:
	$as£¹
(
num
, 
un™
)

40 
	`”rÜ
("Inv®id‡rgum’t. SŒšg o¸numb”ƒx³ùed, gÙ %s.", 
t
)

41 
’d


43 
num
 
th’


44  
num
 * 
un™


45 
’d


46 
’d


48  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/options/timestamp.lua

1 
loÿl
 
	gun™s
 = 
»quœe
 "units"

3 
loÿl
 
İtiÚ
 = {}

5 
İtiÚ
.
desütiÚ
 = "Start‡ secondimestamped version ofhis flow. (default=false)"

6 
İtiÚ
.
cÚfigH–p
 = "Will‡lso‡ccept boolean values."

7 
İtiÚ
.
u§ge
 = {

9 { 
n
, "Set optionorue."},

12 
funùiÚ
 
İtiÚ
.
	$·r£
(
£lf
, 
boŞ
, 
”rÜ
)

13 
boŞ
 = 
un™s
.
	$·r£BoŞ
(
boŞ
, 
çl£
, 
”rÜ
)

15 
boŞ
 
ªd
 
nÙ
 
”rÜ
:
	`as£¹
(#£lf:
	`´İ”ty
("rx") == 1,

16 "CªnÙime¡am°æow w™h mÜthª oÃ„eûivšg deviû."è
th’


17  
çl£


18 
’d


20  
boŞ


21 
’d


23  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/options/uid.lua

1 
loÿl
 
	gİtiÚ
 = {}

3 
İtiÚ
.
desütiÚ
 = "Overwrite uid used forhis flow. Usefulo„eceive flows"

5 
İtiÚ
.
cÚfigH–p
 = "Will‡lso‡ccept‚umber values. Same„estrictions‡sƒxplained‡bove."

6 
İtiÚ
.
u§ge
 = {

10 
loÿl
 
uids
 = {}

12 
loÿl
 
funùiÚ
 
Ãxt_uid
(è-- 
simuÏtšg
 
pu»
 
lua
 #operator + 1

13 
loÿl
 
i
 = 1

14 
uids
[
i
] dØ˜ğ˜+ 1 
’d


15  
i


16 
’d


18 
funùiÚ
 
İtiÚ
.
	$·r£
(
æow
, 
numb”
, 
”rÜ
)

19 
æow
:
´İ”ty
 "uid" 
th’
  flow:´İ”ty "uid" 
’d


21 
loÿl
 
t
 = 
	$ty³
(
numb”
)

22 
	`ty³
(
numb”
è=ğ"¡ršg" 
th’


23 
numb”
 = 
”rÜ
:
	`as£¹
(
	`tÚumb”
(number), "Invalid string. Needso be convertibleo‡‚umber.")

24 
–£if
 
t
 ~ğ"numb”" 
ªd
 ~ğ"n" 
th’


25 
	`”rÜ
("Inv®id‡rgum’t. SŒšg o¸numb”ƒx³ùed, gÙ %s.", 
t
)

26 
numb”
 = 
n


27 
’d


29 
nÙ
 
numb”
 
Ü
‚Ù 
	`as£¹
Òumb” > 0 
ªd
‚Ù 
uids
[number],

30 "Inv®id v®ue. N“d tØb¨uniqupos™ivš‹g”."è
th’


31 
numb”
 = 
	$Ãxt_uid
()

32 
’d


34 
uids
[
numb”
] = 
Œue


35 
æow
:
	`£tPrİ”ty
("uid", 
numb”
)

36  
numb”


37 
’d


39  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/options/uniquePayload.lua

1 
loÿl
 
	gun™s
 = 
»quœe
 "units"

3 
loÿl
 
İtiÚ
 = {}

5 
İtiÚ
.
desütiÚ
 = "Sethe…ayloado‡ unique valueo‡llow generating…er-flow stats."

8 
İtiÚ
.
cÚfigH–p
 = "Will‡lso‡ccept boolean values."

9 
İtiÚ
.
u§ge
 = {

11 { 
n
, "Set optionorue."},

14 
funùiÚ
 
İtiÚ
.
	$·r£
(
£lf
, 
boŞ
, 
”rÜ
)

15 
loÿl
 
Ën
 = 
£lf
:
	$·ck‘Size
()

17 
loÿl
 
hasPaylßd
 = 
£lf
.
·ck‘
.hasPayload

18 
loÿl
 
flsEthF¿me
 = 
Ën
 >= 60

19 
loÿl
 
hasS·û
 = 
Ën
 >ğ
£lf
.
·ck‘
.
mšSize
 + 4

21 
boŞ
 = 
un™s
.
	$·r£BoŞ
(
boŞ
, 
hasPaylßd
 
ªd
 
flsEthF¿me
‡nd 
hasS·û
, 
”rÜ
)

23 
boŞ
 
th’


24 
boŞ
 = boŞ 
ªd
 
”rÜ
:
	`as£¹
(
hasPaylßd
, "Setorue, but…acket cannot carry…ayloads.")

25 
boŞ
 = boŞ 
ªd
 
”rÜ
:
	`as£¹
(
flsEthF¿me
, "Setorue, but…acket is‚ot†argeƒnougho carry uid information."

27 
boŞ
 = boŞ 
ªd
 
”rÜ
:
	`as£¹
(
hasS·û
, "Setorue, but…acket is‚ot†argeƒnougho carry uid information."

28 .. " N“d ©†—¡ 4 by‹ abovthmšimum sizoà%d.", 
£lf
.
·ck‘
.
mšSize
)

29 
’d


31  
boŞ


32 
’d


34  
İtiÚ


	@/home/asabzi/msc-project/MoonGen-1/interface/threads/arp.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

4 
loÿl
 
th»ad
 = { 
¬pDeviûs
 = {}, 
	gæows
 = {} }

6 
loÿl
 
funùiÚ
 
	$dÛsA½
(
æow
)

7 
_
,
d•
 
š
 
	$·œs
(
æow
.
·ck‘
.
d•v¬s
) do

8 
d•
.
tbl
[1] =ğ"¬p" 
th’


9  
Œue


10 
’d


11 
’d


13  
çl£


14 
’d


16 
loÿl
 
funùiÚ
 
	`addIp
(
dev
, 

)

17 -- 
luacheck
: 
»ad
 
glob®s
 
SŒšg


18 

 = 
	`SŒšg
(è-- 
£e
 
d•’d’c›s
/
¬p
.
lua


20 
loÿl
 
tbl
 = 
th»ad
.
¬pDeviûs
[
dev
]

21 
nÙ
 
tbl
 
th’


22 
tbl
 = {
	}
}

23 
th»ad
.
¬pDeviûs
[
dev
] = 
tbl


24 
’d


26 
tbl
[

] = 
Œue


27 
’d


29 
funùiÚ
 
th»ad
.
	$´•¬e
(
æows
, 
deviûs
)

30 
_
,
æow
 
š
 
	$aœs
(
æows
) do

31 
	$dÛsA½
(
æow
è
th’


32 
bË
.
	$š£¹
(
th»ad
.
æows
, 
æow
)

33 
loÿl
 
á
 = 
æow
.
·ck‘
.
flTbl


35 
_
,
dev
 
š
 
	`aœs
(
æow
:
´İ”ty
 "tx") do

36 
	$addIp
(
dev
, 
á
.
4Src
 
Ü
 ft.
6Src
)

37 
’d


39 
_
,
dev
 
š
 
	`aœs
(
æow
:
´İ”ty
 "rx") do

40 
	$addIp
(
dev
, 
á
.
4D¡
 
Ü
 ft.
6D¡
)

41 
’d


42 
’d


43 
’d


45 
dev
 
š
 
	$·œs
(
th»ad
.
¬pDeviûs
) do

46 
deviûs
:
	$»£rveTx
(
dev
)

47 
deviûs
:
	$»£rveRx
(
dev
)

48 
’d


49 
’d


51 
funùiÚ
 
th»ad
.
	$¡¬t
(
deviûs
)

52 #th»ad.
æows
 =ğ0 
th’
  
’d


54 
loÿl
 
queues
 = {
	}
}

56 
dev
, 
s
 
š
 
	$·œs
(
th»ad
.
¬pDeviûs
) do

57 
loÿl
 
Li¡
 = {
	}
}

58 

 
š
 
	$·œs
(
s
) do

59 
bË
.
	$š£¹
(
Li¡
, 

)

60 
’d


62 
bË
.
	`š£¹
(
queues
, {

63 
rxQueue
 = 
deviûs
:
	`rxQueue
(
dev
),

64 
txQueue
 = 
deviûs
:
	`txQueue
(
dev
),

65 
s
 = 
Li¡


66 
	}
})

67 
’d


69 
	g¬p
.
	$¡¬tA½Task
(
queues
)

70 
mg
.
	`¡¬tSh¬edTask
("__INTERFACE_ARP_MANAGER", 
th»ad
.
æows
)

71 
’d


73 
loÿl
 
funùiÚ
 
	$¬pMªag”Th»ad
(
æows
)

74 
loÿl
 
isAùive
 = 
Œue


75 
isAùive
 do

76 
mg
.
	$¦“pMlis
(1000)

78 
isAùive
 = 
çl£


79 
_
,
æow
 
š
 
	$aœs
(
æows
) do

80 
nÙ
 
æow
.
´İ”t›s
.
couÁ”
:
	$isZ”o
(è
th’


81 
isAùive
 = 
Œue


82 
’d


83 
’d


84 
’d


86 
¬p
.
	$¡İA½Task
()

87 
’d


89 
__INTERFACE_ARP_MANAGER
 = 
¬pMªag”Th»ad
 -- 
luacheck
: 
glob®s
 __INTERFACE_ARP_MANAGER

91  
th»ad


	@/home/asabzi/msc-project/MoonGen-1/interface/threads/count.lua

1 
loÿl
 
	gmemÜy
 = 
»quœe
 "memory"

2 
loÿl
 
mg
 = 
»quœe
 "moongen"

3 
loÿl
 
tim”
 = 
»quœe
 "timer"

4 
loÿl
 
¡©s
 = 
»quœe
 "stats"

6 
loÿl
 
Flow
 = 
»quœe
 "flow"

8 
loÿl
 
th»ad
 = { 
æows
 = {} }

10 
funùiÚ
 
	gth»ad
.
	$´•¬e
(
æows
, 
deviûs
)

11 
_
,
æow
 
š
 
	$aœs
(
æows
) do

12 
_
,
rx
 
š
 
	`aœs
(
æow
:
´İ”ty
 "rx") do

13 
bË
.
	`š£¹
(
th»ad
.
æows
, 
æow
:
şÚe
{ 
rx_dev
 = 
rx
 
	}
})

14 
deviûs
:
	$»£rveRss
(
rx
)

15 
’d


16 
’d


17 
’d


19 
funùiÚ
 
th»ad
.
	$¡¬t
(
deviûs
)

20 
_
,
æow
 
š
 
	$aœs
(
th»ad
.
æows
) do

21 
loÿl
 
’dD–ay
 = 1000

22 
æow
:
İtiÚ
 "¿‹" 
th’


23 
’dD–ay
 = 
æow
:
	`g‘D–ay
(è* 70 -- 64 
·ck‘s
 
³r
 
bufãr
 + 
m¬gš


24 
’d


26 
mg
.
	`¡¬tTask
("__INTERFACE_COUNT", 
æow
, 
deviûs
:
	`rssQueue
(æow:
´İ”ty
 "rx_dev"), 
’dD–ay
)

27 
’d


28 
’d


30 
loÿl
 
¡©sMªag”
 = {
	}
}

31 
¡©sMªag”
.
__šdex
 = statsManager

33 
loÿl
 
funùiÚ
 
	$g‘CouÁ”
(
dev
, 
uid
)

34  
¡©s
:
	`ÃwPktRxCouÁ”
(("Flow: dev=% uid=%s"):
	`fÜm©
(
	`to¡ršg
(
dev
), 
uid
))

35 
’d


37 
loÿl
 
funùiÚ
 
	$fš®ize
(
£lf
)

38 
i
,
v
 
š
 
	$·œs
(
£lf
) do

39 
	`ty³
(
i
è=ğ"numb”" 
th’


40 
v
:
	$fš®ize
()

41 
’d


42 
’d


43 
’d


45 
funùiÚ
 
¡©sMªag”
.
	$Ãw
(
dev
)

46  
	`£tm‘©abË
({ 
dev
 = dev, 
fš®ize
 = fš®iz
	}
}, 
	g¡©sMªag”
)

47 
’d


49 
funùiÚ
 
	g¡©sMªag”
:
	$__šdex
(
key
)

50 
loÿl
 
út
 = 
	`g‘CouÁ”
(
£lf
.
dev
, 
key
 =ğ0 
ªd
 "?" 
	`Ü
 ("%#x"):
	$fÜm©
(
key
))

51 
£lf
[
key
] = 
út


52  
út


53 
’d


55 
loÿl
 
funùiÚ
 
	$g‘Uid
(
by‹s
, 
Ëngth
)

56  
by‹s
[
Ëngth
 - 1] * 0xffffff

57 + 
by‹s
[
Ëngth
 - 2] * 0xffff

58 + 
by‹s
[
Ëngth
 - 3] * 0xff

59 + 
by‹s
[
Ëngth
 - 4]

60 
’d


62 
loÿl
 
funùiÚ
 
	$couÁTh»ad
(
æow
, 
rxQueue
, 
d–ay
)

63 
æow
 = 
Flow
.
	$»¡Üe
(
æow
)

65 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

66 
loÿl
 
couÁ”s
 = 
¡©sMªag”
.
	$Ãw
(
rxQueue
.
id
)

67 
loÿl
 
ruÁime


69 
mg
.
	$ruÂšg
(
d–ay
è
	`ªd
 (
nÙ
 
ruÁime
 
Ü
‚Ù„uÁime:
	$ruÂšg
()) do

70 
loÿl
 
rx
 = 
rxQueue
:
	$»cv
(
bufs
)

71 
i
 = 1, 
rx
 do

72 
loÿl
 
buf
 = 
bufs
[
i
]

74 
loÿl
 
uid
 = 
	`g‘Uid
(
buf
:
	`g‘By‹s
(), buf:
	$g‘Size
())

76 
couÁ”s
[
uid
]:
	$couÁPack‘
(
buf
)

77 
couÁ”s
[
uid
]:
	$upd©e
()

78 
’d


80 
bufs
:
	$ä“AÎ
()

81 
nÙ
 
ruÁime
 
ªd
 
æow
:
	`´İ”ty
("couÁ”"):
	$isZ”o
(è
th’


82 
ruÁime
 = 
tim”
:
	`Ãw
(
d–ay
 / 1000)

83 
’d


84 
’d


86 
couÁ”s
:
	`fš®ize
()

87 -- 
TODO
 
check
 
the
 
queue
's overflow countero detect†ost…ackets

88 
’d


90 
__INTERFACE_COUNT
 = 
couÁTh»ad
 -- 
luacheck
: 
glob®s
 __INTERFACE_COUNT

91  
th»ad


	@/home/asabzi/msc-project/MoonGen-1/interface/threads/deviceStats.lua

1 
loÿl
 
	gmg
 = 
»quœe
 "moongen"

2 
loÿl
 
¡©s
 = 
»quœe
 "stats"

4 
loÿl
 
th»ad
 = { 
deviûs
 = {} }

6 
funùiÚ
 
	gth»ad
.
	$´•¬e
(
æows
)

7 
_
,
æow
 
š
 
	$aœs
(
æows
) do

8 
_
,
v
 
š
 
aœs
{ "Tx", "Rx" 
	}
} do

9 
	g_
,
id
 
š
 
aœs
(
æow
:
´İ”ty
(
v
:
	$low”
())) do

10 
bË
.
	`š£¹
(
th»ad
.
deviûs
, { 
v
, 
id
, 
æow
 
	}
})

11 
’d


12 
’d


13 
’d


14 
’d


16 
loÿl
 
funùiÚ
 
	$add_æow
(
tbl
, 
key
, 
æow
, 
deviûs
)

17 
loÿl
 
»suÉ
 = 
tbl
[
key
]

18 
nÙ
 
»suÉ
 
th’


19 
»suÉ
 = { 
dev
 = 
deviûs
[
key
].dev 
	}
}

20 
	gtbl
[
key
] = 
»suÉ


21 
’d


22 
bË
.
	$š£¹
(
»suÉ
, 
æow
)

23 
’d


25 
funùiÚ
 
th»ad
.
	$¡¬t
(
deviûs
)

26 
loÿl
 
devs
 = { 
Tx
 = {}, 
Rx
 = {} 
	}
}

28 
	g_
,
v
 
š
 
	$aœs
(
th»ad
.
deviûs
) do

29 
	$add_æow
(
devs
[
v
[1]], v[2], v[3], 
deviûs
)

30 
’d


32 
mg
.
	`¡¬tSh¬edTask
("__INTERFACE_DEVICE_STATS", 
devs
)

33 
’d


35 
loÿl
 
funùiÚ
 
	$isAùive
(
æows
)

36 
_
,
æow
 
š
 
	$aœs
(
æows
) do

37 
nÙ
 
æow
.
´İ”t›s
.
couÁ”
:
	$isZ”o
(è
th’


38  
Œue


39 
’d


40 
’d


42  
çl£


43 
’d


45 
loÿl
 
funùiÚ
 
	$deviûStsTh»ad
(
devs
)

46 
loÿl
 
couÁ”s
 = {
	}
}

48 
_
,
v
 
š
 
	gaœs
{ "Tx", "Rx" } do

49 
loÿl
 
	gg‘CouÁ”
 = 
¡©s
["ÃwDev" .. 
v
 .. "Counter"]

50 
_
,
æows
 
š
 
	$·œs
(
devs
[
v
]) do

51 
bË
.
	`š£¹
(
couÁ”s
, { 
æows
 = flows, 
couÁ”
 = 
	`g‘CouÁ”
(
¡©s
, flows.
dev
è
	}
})

52 
’d


53 
’d


55 
loÿl
 
	gËn
 = #counters

56 
mg
.
	$ruÂšg
(200è
ªd
 
Ën
 > 0 do

57 
loÿl
 
off£t
 = 0

59 
i
 = 1, 
Ën
 do

60 
loÿl
 
ùr
 = 
couÁ”s
[
i
]

61 
loÿl
 
aùive
 = 
	$isAùive
(
ùr
.
æows
)

63 
aùive
 
th’


64 
ùr
.
couÁ”
:
	$upd©e
()

65 
’d


67 
nÙ
 
aùive
 
th’


68 
ùr
.
couÁ”
:
	$fš®ize
()

69 
couÁ”s
[
i
] = 
n


70 
off£t
 = offset + 1

71 
–£if
 
off£t
 > 0 
th’


72 
couÁ”s
[
i
] = 
n


73 
couÁ”s
[
i
 - 
off£t
] = 
ùr


74 
’d


75 
’d


77 
Ën
 =†’ - 
off£t


78 
mg
.
	$¦“pMlisIdË
(10)

79 
’d


81 
’d


83 
__INTERFACE_DEVICE_STATS
 = 
deviûStsTh»ad
 -- 
luacheck
: 
glob®s
 __INTERFACE_DEVICE_STATS

85  
th»ad


	@/home/asabzi/msc-project/MoonGen-1/interface/threads/load.lua

1 
loÿl
 
	gdpdkc
 = 
»quœe
 "dpdkc"

2 
loÿl
 
lim™”
 = 
»quœe
 "software-ratecontrol"

3 
loÿl
 
memÜy
 = 
»quœe
 "memory"

4 
loÿl
 
mg
 = 
»quœe
 "moongen"

5 
loÿl
 
tim”
 = 
»quœe
 "timer"

6 
loÿl
 
¡©s
 = 
»quœe
 "stats"

8 
loÿl
 
Flow
 = 
»quœe
 "flow"

10 
loÿl
 
th»ad
 = { 
æows
 = {} }

12 
funùiÚ
 
	gth»ad
.
	$´•¬e
(
æows
, 
deviûs
)

13 
_
,
æow
 
š
 
	$aœs
(
æows
) do

14 
_
,
tx
 
š
 
	`aœs
(
æow
:
´İ”ty
 "tx") do

15 
bË
.
	`š£¹
(
th»ad
.
æows
, 
æow
:
şÚe
{ 
tx_dev
 = 
tx
 
	}
})

16 
deviûs
:
	$»£rveTx
(
tx
)

17 
’d


18 
’d


19 
’d


21 
funùiÚ
 
th»ad
.
	$¡¬t
(
deviûs
)

22 
_
,
æow
 
š
 
	$aœs
(
th»ad
.
æows
) do

23 
loÿl
 
txQueue
 = 
deviûs
:
	`txQueue
(
æow
:
´İ”ty
 "tx_dev")

25 -- 
£tup
 
¿‹
 
lim™


26 
æow
:
İtiÚ
 "¿‹" 
th’


27 
æow
:
İtiÚ
 "¿‹P©‹º" =ğ"cbr" 
th’


28 
loÿl
 
rc
 = 
dpdkc
.
	`¹e_‘h_£t_queue_¿‹_lim™
(
txQueue
.
id
,xQueue.
qid
, 
æow
:
İtiÚ
 "rate")

29 
rc
 ~ğ0 
th’
 -- 
çÎback
 
to
 
soáw¬e
 
¿‹lim™šg


30 
txQueue
 = 
lim™”
:
	`Ãw
ÑxQueue, "cbr", 
æow
:
	$g‘D–ay
())

31 
’d


32 
–£if
 
æow
.
»suÉs
.
¿‹P©‹º
 =ğ"poissÚ" 
th’


33 
txQueue
 = 
lim™”
:
	`Ãw
ÑxQueue, "poissÚ", 
æow
:
	$g‘D–ay
())

34 
’d


35 
’d


37 
mg
.
	`¡¬tTask
("__INTERFACE_LOAD", 
æow
, 
txQueue
)

38 
’d


39 
’d


41 
loÿl
 
funùiÚ
 
	$lßdTh»ad
(
æow
, 
£ndQueue
)

42 
æow
 = 
Flow
.
	$»¡Üe
(
æow
)

44 
loÿl
 
couÁ”
 = 
¡©s
:
	`ÃwPktTxCouÁ”
(

45 ("Flow: dev=%d uid=%#x"):
	`fÜm©
(
æow
:
´İ”ty
 "tx_dev", flow:
İtiÚ
 "uid")

48 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
è
æow
:
	$flBuf
(
buf
è
’d
)

49 
loÿl
 
bufs
 = 
mempoŞ
:
	`bufA¼ay
()

51 -- 
d©aLim™
 
š
 
·ck‘s
, 
timeLim™
 iÀ
£cÚds


52 
loÿl
 
d©a
, 
ruÁime
 = 
æow
:
İtiÚ
 "d©aLim™", 
n


53 
æow
:
İtiÚ
 "timeLim™" 
th’


54 
ruÁime
 = 
tim”
:
	`Ãw
(
æow
:
İtiÚ
 "timeLimit")

55 
’d


57 
æow
:
	`´İ”ty
("couÁ”"):
	$šc
()

59 
mg
.
	$ruÂšg
(è
	`ªd
 (
nÙ
 
ruÁime
 
Ü
„uÁime:
	$ruÂšg
()) do

60 
bufs
:
	`®loc
(
æow
:
	$·ck‘Size
())

62 
æow
.
isDyÇmic
 
th’


63 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

64 
æow
:
	$upd©eBuf
(
buf
)

65 
couÁ”
:
	$couÁPack‘
(
buf
)

66 
’d


67 
’d


69 
d©a
 
th’


70 
d©a
 = d©¨- 
bufs
.
size


71 
d©a
 <ğ0 
th’


72 
£ndQueue
:
	`£ndN
(
bufs
, bufs.
size
 + 
d©a
)

74 
’d


75 
’d


77 
bufs
:
	$ofæßdUdpChecksums
()

78 
£ndQueue
:
	$£nd
(
bufs
)

80 
couÁ”
:
	$upd©e
()

81 
’d


83 
æow
:
	`´İ”ty
("couÁ”"):
	$dec
()

85 
£ndQueue
.
¡İ
 
th’


86 
£ndQueue
:
	$¡İ
()

87 
’d


89 
couÁ”
:
	$fš®ize
()

90 
’d


92 
__INTERFACE_LOAD
 = 
lßdTh»ad
 -- 
luacheck
: 
glob®s
 __INTERFACE_LOAD

93  
th»ad


	@/home/asabzi/msc-project/MoonGen-1/interface/threads/timestamp.lua

1 
loÿl
 
	ghi¡
 = 
»quœe
 "histogram"

2 
loÿl
 
mg
 = 
»quœe
 "moongen"

3 
loÿl
 
tim”
 = 
»quœe
 "timer"

4 
loÿl
 
ts
 = 
»quœe
 "timestamping"

6 
loÿl
 
Flow
 = 
»quœe
 "flow"

8 
loÿl
 
th»ad
 = { 
æows
 = {} }

10 
funùiÚ
 
	gth»ad
.
	$´•¬e
(
æows
, 
deviûs
)

11 
_
,
æow
 
š
 
	$aœs
(
æows
) do

12 
æow
:
İtiÚ
 "time¡amp" 
th’


13 
loÿl
 
rx
 = 
æow
:
	`´İ”ty
("rx")[1]

14 
_
,
tx
 
š
 
	`aœs
(
æow
:
´İ”ty
 "tx") do

15 
bË
.
	`š£¹
(
th»ad
.
æows
, 
æow
:
şÚe
{ 
tx_dev
 = 
tx
, 
rx_dev
 = 
rx
 
	}
})

16 
	gdeviûs
:
	$»£rveTx
(
tx
)

17 
deviûs
:
	$»£rveRx
(
rx
)

18 
’d


19 
’d


20 
’d


21 
’d


23 
funùiÚ
 
th»ad
.
	$¡¬t
(
deviûs
, ...)

24 
i
,
æow
 
š
 
	$aœs
(
th»ad
.
æows
) do

25 
æow
:
	`£tPrİ”ty
("txQueue", 
deviûs
:
	`txQueue
(æow:
´İ”ty
 "tx_dev"))

26 
æow
:
	`£tPrİ”ty
("rxQueue", 
deviûs
:
	`rxQueue
(æow:
´İ”ty
 "rx_dev"))

28 
th»ad
.
æows
[
i
] = 
æow


29 
’d


31 #th»ad.
æows
 > 0 
th’


32 
mg
.
	`¡¬tSh¬edTask
("__INTERFACE_TIMESTAMPING", 
th»ad
.
æows
, ...)

33 
’d


34 
’d


36 
loÿl
 
funùiÚ
 
	$time¡ampTh»ad
(
æows
, 
dœeùÜy
)

37 
loÿl
 
timeSm³rs
, 
hi¡s
 = {
	}
}, {}

39 
	gi
,
v
 
š
 
	$aœs
(
æows
) do

40 
loÿl
 
æow
 = 
Flow
.
	$»¡Üe
(
v
)

41 
æows
[
i
] = 
æow


43 
loÿl
 
isUdp
 = 
æow
.
·ck‘
.
´Ùo
 == "Udp"

44 
timeSm³rs
[
i
] = 
ts
:
	`ÃwTime¡am³r
(

45 
æow
:
´İ”ty
 "txQueue", flow:property "rxQueue",

46 
n
, 
isUdp


48 
hi¡s
[
i
] = 
	$hi¡
()

50 
loÿl
 
mšL’gth
 = 
isUdp
 
ªd
 84 
Ü
 68

51 
æow
:
	`·ck‘Size
(è< 
mšL’gth
 
th’


52 
æow
.
·ck‘
.
flTbl
.
pktL’gth
 = 
mšL’gth


53 
’d


54 
’d


56 
loÿl
 
¿‹Lim™
 = 
tim”
:
	$Ãw
(0.001)

57 
loÿl
 
aùiveFlows
 = 1

58 
mg
.
	$ruÂšg
(è
ªd
 
aùiveFlows
 > 0 do

59 
aùiveFlows
 = 0

60 
i
,
æow
 
š
 
	$aœs
(
æows
) do

61 
nÙ
 
æow
:
	`´İ”ty
("couÁ”"):
	$isZ”o
(è
th’


62 
aùiveFlows
 =‡ctiveFlows + 1

63 
hi¡s
[
i
]:
	`upd©e
(
timeSm³rs
[i]:
	`m—su»L©’cy
(

64 
æow
:
	`·ck‘Size
(), 
	$funùiÚ
(
buf
)

65 
æow
.
isDyÇmic
 
th’


66 
æow
:
	$flUpd©eBuf
(
buf
)

68 
æow
:
	$flBuf
(
buf
)

69 
’d


70 
’d


72 
’d


73 
’d


74 
¿‹Lim™
:
	$wa™
()

75 
¿‹Lim™
:
	$»£t
()

76 
’d


78 
i
,
æow
 
š
 
	$aœs
(
æows
) do

79 
hi¡s
[
i
]:
	`§ve
(
¡ršg
.
	`fÜm©
("%s/%s_%d-%d_%d.csv", 
dœeùÜy
,

80 
æow
.
´Ùo
.
Çme
, flow:
İtiÚ
 "uid", flow:
	`´İ”ty
("txQueue").
id
, flow:property("rxQueue").id))

81 
’d


82 
’d


84 
__INTERFACE_TIMESTAMPING
 = 
time¡ampTh»ad
 -- 
luacheck
: 
glob®s
 __INTERFACE_TIMESTAMPING

85  
th»ad


	@/home/asabzi/msc-project/MoonGen-1/interface/units.lua

1 
loÿl
 
	gun™s
 = {}

3 
un™s
.
time
 = {

5 
	gms
 = 1 / 1000,

6 
	gs
 = 1,

7 
	gm
 = 60,

8 
	gh
 = 3600,

10 
	gun™s
.
	gtimeE¼Ü
 = "Invalidime unit. Can be one of 'ms', 's', 'm', 'h'."

12 
un™s
.
size
 = {

14 
	gk
 = 10 ^ 3, 
	gki
 = 2 ^ 10,

15 
	gm
 = 10 ^ 6, 
	gmi
 = 2 ^ 20,

16 
	gg
 = 10 ^ 9, 
	ggi
 = 2 ^ 30,

18 
	gun™s
.
	gsizeE¼Ü
 = "Invalid size unit. Can be <k|m|g>[i]<bit|b|p>"

20 
un™s
.
boŞ
 = {

21 ["0"] = 
çl£
, ["1"] = 
Œue
,

22 ["çl£"] = 
çl£
, ["Œue"] = 
Œue
,

23 ["no"] = 
çl£
, ["yes"] = 
Œue
,

25 
	gun™s
.
	gboŞE¼Ü
 = "Invalid boolean. Can be one of (0|false|no) or (1|true|yes)„espectively."

27 
funùiÚ
 
un™s
.
	$·r£BoŞ
(
boŞ
, , 
”rÜ
)

28 
loÿl
 
t
 = 
	$ty³
(
boŞ
)

30 
t
 =ğ"¡ršg" 
th’


31 
boŞ
 = 
un™s
.bool[bool]

32 
nÙ
 
”rÜ
:
	`as£¹
(
	`ty³
(
boŞ
è=ğ"boŞ—n", 
un™s
.
boŞE¼Ü
è
th’


34 
’d


35 
–£if
 
t
 =ğ"n" 
th’


37 
–£if
 
t
 ~ğ"boŞ—n" 
th’


38 
	`”rÜ
("Inv®id‡rgum’t. SŒšg o¸boŞ—Àex³ùed, gÙ %s.", 
t
)

39 
’d


41  
boŞ


42 
’d


44  
un™s


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_arm.lua

2 -- 
DynASM
 
ARM
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
S“
 
	gdyÇsm
.
lua
 
fuÎ
 
cİyright
 
	gnÙiû
.

8 -- 
ModuË
 
	gšfÜm©iÚ
:

9 
loÿl
 
_šfo
 = {

10 
¬ch
 = "arm",

11 
	gdesütiÚ
 = "DynASM ARM module",

12 
	gv”siÚ
 = "1.4.0",

13 
	gv”num
 = 10400,

14 
	g»Ëa£
 = "2015-10-18",

15 
	gauthÜ
 = "Mike Pall",

16 
	gliûn£
 = "MIT",

19 -- 
ExpÜ‹d
 
glue
 
funùiÚs
 
the
 
	g¬ch
-
¥ecific
 
	gmoduË
.

20 
loÿl
 
	g_M
 = { 
_šfo
 = _info }

22 -- 
Cache
 
lib¿ry
 
	gfunùiÚs
.

23 
loÿl
 
	gty³
, 
	gtÚumb”
, 
	g·œs
, 
	gaœs
 = 
ty³
,Úumb”,…aœs, 
aœs


24 
loÿl
 
	gas£¹
, 
	g£tm‘©abË
, 
	g¿wg‘
 = 
as£¹
, s‘m‘©abË, 
¿wg‘


25 
loÿl
 
	g_s
 = 
¡ršg


26 
loÿl
 
sub
, 
	gfÜm©
, 
	gby‹
, ğ
_s
.sub, 
	g_s
.format, _s.byte, _s.

27 
loÿl
 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
_s
.
m©ch
, 
	g_s
.gm©ch, _s.
gsub


28 
loÿl
 
	gcÚÿt
, 
	gsÜt
, 
	gš£¹
 = 
bË
.
cÚÿt
, 
	gbË
.sÜt,abË.
š£¹


29 
loÿl
 
	gb™
 = 
b™
 
Ü
 
»quœe
("bit")

30 
loÿl
 
bªd
, 
	gshl
, 
	gshr
, 
	g§r
 = 
b™
.bªd, 
	gb™
.
	glshiá
, b™.
	grshiá
, b™.
¬shiá


31 
loÿl
 
	grÜ
, 
	gtohex
 = 
b™
.
rÜ
, 
	gb™
.tohex

33 -- 
Inh”™ed
 
bËs
 
ªd
 
	gÿÎbacks
.

34 
loÿl
 
	gg_İt
, 
g_¬ch


35 
loÿl
 
	gwlše
, 
	gw”rÜ
, 
	gwçl
, 
	gww¬n


37 -- 
AùiÚ
 
Çme
 
	gli¡
.

38 -- 
	gCHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

39 
loÿl
 
aùiÚ_Çmes
 = {

45 -- 
Maximum
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

46 -- 
CHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

47 
loÿl
 
max£ıos
 = 25 -- 
K“p
 
this
 
low
, 
to
 
avoid
 
exûssiv–y
 
C
 
	glšes
.

49 -- 
AùiÚ
 
	gÇme
 -> 
aùiÚ
 
	gnumb”
.

50 
loÿl
 
	gm­_aùiÚ
 = {}

51 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

52 
m­_aùiÚ
[
Çme
] = 
n
-1

53 
’d


55 -- 
AùiÚ
 
li¡
 
bufãr
.

56 
loÿl
 
aùli¡
 = {
	}
}

58 -- 
Argum’t
 
li¡
 
Ãxt
 
dasm_put
(). 
S¹
 
w™h
 
off£t
 0 
što
 
aùiÚ
†ist.

59 
loÿl
 
aù¬gs
 = { 0 }

61 -- 
Cu¼’t
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

62 
loÿl
 
£ıos
 = 1

66 -- 
Dump
 
aùiÚ
 
Çmes
 
ªd
 
numb”s
.

67 
loÿl
 
funùiÚ
 
	$dum·ùiÚs
(
out
)

68 
out
:
	`wr™e
("DynASMƒncodingƒngine‡ction codes:\n")

69 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

70 
loÿl
 
num
 = 
m­_aùiÚ
[
Çme
]

71 
out
:
	`wr™e
(
	`fÜm©
(" %-10 %02X %d\n", 
Çme
, 
num
,‚um))

72 
’d


73 
out
:
	`wr™e
("\n")

74 
’d


76 -- 
Wr™e
 
aùiÚ
 
li¡
 
bufãr
 
as
 
a
 
huge
 
C
 
¬¿y
.

77 
loÿl
 
funùiÚ
 
	$wr™—ùiÚs
(
out
, 
Çme
)

78 
loÿl
 
Â
 = #actlist

79 
Â
 =ğ0 
th’
‚Àğ1; 
aùli¡
[0] = 
m­_aùiÚ
.
STOP
 
’d


80 
out
:
	`wr™e
("¡©iøcÚ¡ unsigÃd iÁ ", 
Çme
, "[", 
Â
, "] = {\n")

81 
i
 = 1,
Â
-1 do

82 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
i
]), ",\n"))

83 
’d


84 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
Â
]), "\n};\n\n"))

85 
’d


89 -- 
Add
 
wÜd
 
to
 
aùiÚ
 
li¡
.

90 
loÿl
 
funùiÚ
 
	$wputxw
(
n
)

91 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

92 
aùli¡
[#aùli¡+1] = 
n


93 
’d


95 -- 
Add
 
aùiÚ
 
to
 
li¡
 
w™h
 
İtiÚ®
 
¬g
. 
Advªû
 
bufãr
 
pos
, 
too
.

96 
loÿl
 
funùiÚ
 
	$waùiÚ
(
aùiÚ
, 
v®
, 
a
, 
num
)

97 
loÿl
 
w
 = 
	`as£¹
(
m­_aùiÚ
[
aùiÚ
], "bad‡ction‚ame `"..action.."'")

98 
	`wputxw
(
w
 * 0x10000 + (
v®
 
Ü
 0))

99 
a
 
th’
 
aù¬gs
[#aù¬gs+1] =‡ 
’d


100 
a
 
Ü
 
num
 
th’
 
£ıos
 = seıo + (num o¸1è
’d


101 
’d


103 -- 
Flush
 
aùiÚ
 
	`li¡
 (
š‹rv’šg
 
C
 
code
 
Ü
 
bufãr
 
pos
 
ov”æow
).

104 
loÿl
 
funùiÚ
 
	$wæush
(
‹rm
)

105 #aùli¡ =ğ
aù¬gs
[1] 
th’
  
’d
 -- 
NÙhšg
 
to
 
æush
.

106 
nÙ
 
‹rm
 
th’
 
	`waùiÚ
("STOP"è
’d
 -- 
T”mš©e
 
aùiÚ
 
li¡
.

107 
	`wlše
(
	`fÜm©
("dasm_put(D¡, %s);", 
	`cÚÿt
(
aù¬gs
, ", ")), 
Œue
)

108 
aù¬gs
 = { #aùli¡ 
	}
} -- 
AùiÚli¡
 
off£t
 
is
 1
¡
 
¬g
 
to
 
Ãxt
 
dasm_put
().

109 
£ıos
 = 1 -- 
The
 
aùiÚli¡
 
off£t
 
occup›s
 
a
 
bufãr
 
pos™iÚ
, 
	gtoo
.

110 
	g’d


112 -- 
Put
 
esÿ³d
 
	gwÜd
.

113 
loÿl
 
funùiÚ
 
	$wputw
(
n
)

114 
n
 <ğ0x000ffffà
th’
 
	`waùiÚ
("ESC"è
’d


115 
	$wputxw
(
n
)

116 
’d


118 -- 
Re£rve
 
pos™iÚ
 
wÜd
.

119 
loÿl
 
funùiÚ
 
	$wpos
()

120 
loÿl
 
pos
 = #actlist+1

121 
aùli¡
[
pos
] = ""

122  
pos


123 
’d


125 -- 
StÜe
 
wÜd
 
to
 
»£rved
 
pos™iÚ
.

126 
loÿl
 
funùiÚ
 
	$wpuos
(
pos
, 
n
)

127 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

128 
n
 <ğ0x000ffffà
th’


129 
	`š£¹
(
aùli¡
, 
pos
+1, 
n
)

130 
n
 = 
m­_aùiÚ
.
ESC
 * 0x10000

131 
’d


132 
aùli¡
[
pos
] = 
n


133 
’d


137 -- 
Glob®
 
Ïb–
 
Çme
 -> 
glob®
†ab– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

138 
loÿl
 
Ãxt_glob®
 = 20

139 
loÿl
 
m­_glob®
 = 
	`£tm‘©abË
({
	}
}, { 
	g__šdex
 = 
funùiÚ
(
t
, 
Çme
)

140 
nÙ
 
m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’
 
w”rÜ
("bad glob®†ab–"è
’d


141 
loÿl
 
	gn
 = 
Ãxt_glob®


142 
n
 > 2047 
th’
 
w”rÜ
("toØmªy glob®†ab–s"è
’d


143 
Ãxt_glob®
 = 
n
 + 1

144 
t
[
Çme
] = 
n


145  
n


146 
’d
})

148 -- 
Dump
 
glob®
 
	gÏb–s
.

149 
loÿl
 
funùiÚ
 
	$dumpglob®s
(
out
, 
lvl
)

150 
loÿl
 
t
 = {
	}
}

151 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


152 
out
:
	`wr™e
("Global†abels:\n")

153 
i
=20,
Ãxt_glob®
-1 do

154 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
t
[
i
]))

155 
’d


156 
out
:
	`wr™e
("\n")

157 
’d


159 -- 
Wr™e
 
glob®
 
Ïb–
 .

160 
loÿl
 
funùiÚ
 
	$wr™eglob®s
(
out
, 
´efix
)

161 
loÿl
 
t
 = {
	}
}

162 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


163 
out
:
	`wr™e
("enum {\n")

164 
i
=20,
Ãxt_glob®
-1 do

165 
out
:
	`wr™e
(" ", 
´efix
, 
t
[
i
], ",\n")

166 
’d


167 
out
:
	`wr™e
(" ", 
´efix
, "_MAX\n};\n")

168 
’d


170 -- 
Wr™e
 
glob®
 
Ïb–
 
Çmes
.

171 
loÿl
 
funùiÚ
 
	$wr™eglob®Çmes
(
out
, 
Çme
)

172 
loÿl
 
t
 = {
	}
}

173 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


174 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

175 
i
=20,
Ãxt_glob®
-1 do

176 
out
:
	`wr™e
(" \"", 
t
[
i
], "\",\n")

177 
’d


178 
out
:
	`wr™e
(" (const char *)0\n};\n")

179 
’d


183 -- 
Ex‹º
 
Ïb–
 
Çme
 -> Ïb– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

184 
loÿl
 
Ãxt_ex‹º
 = 0

185 
loÿl
 
m­_ex‹º_
 = {
	}
}

186 
loÿl
 
m­_ex‹º
 = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
Çme
)

187 -- 
No
 
»¡riùiÚs
 
Ú
 
the
 
Çme
 
now
.

188 
loÿl
 
n
 = 
Ãxt_ex‹º


189 
n
 > 2047 
th’
 
w”rÜ
("toØmªyƒx‹º†ab–s"è
’d


190 
Ãxt_ex‹º
 = 
n
 + 1

191 
t
[
Çme
] = 
n


192 
m­_ex‹º_
[
n
] = 
Çme


193  
n


194 
’d
})

196 -- 
Dump
 
Ïb–s
.

197 
loÿl
 
funùiÚ
 
	$dum³x‹ºs
(
out
, 
lvl
)

198 
out
:
	`wr™e
("Extern†abels:\n")

199 
i
=0,
Ãxt_ex‹º
-1 do

200 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
m­_ex‹º_
[
i
]))

201 
’d


202 
out
:
	`wr™e
("\n")

203 
’d


205 -- 
Wr™e
 
Ïb–
 
Çmes
.

206 
loÿl
 
funùiÚ
 
	$wr™“x‹ºÇmes
(
out
, 
Çme
)

207 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

208 
i
=0,
Ãxt_ex‹º
-1 do

209 
out
:
	`wr™e
(" \"", 
m­_ex‹º_
[
i
], "\",\n")

210 
’d


211 
out
:
	`wr™e
(" (const char *)0\n};\n")

212 
’d


216 -- 
Arch
-
¥ecific
 
m­s
.

218 -- 
Ext
. 
Çme
 -> .‚ame.

219 
loÿl
 
m­_¬chdef
 = { 
¥
 = "r13", 
Ì
 = "r14", 
pc
 = "r15", 
	}
}

221 -- 
IÁ
. 
Çme
 -> 
ext
.‚ame.

222 
loÿl
 
m­_»g_»v
 = { 
r13
 = "¥", 
r14
 = "Ì", 
r15
 = "pc", }

224 
loÿl
 
m­_ty³
 = {} -- 
Ty³
 
Çme
 -> { 
ùy³
, 
»g
 }

225 
loÿl
 
ùy³num
 = 0 -- 
Ty³
 
numb”
 (
Dt
... 
maüos
).

227 -- 
Rev”£
 
defšes
 
»gi¡”s
.

228 
funùiÚ
 
_M
.
	$»vdef
(
s
)

229  
m­_»g_»v
[
s
] 
Ü
 s

230 
’d


232 
loÿl
 
m­_shiá
 = { 
l¦
 = 0, 
l¤
 = 1, 
a¤
 = 2, 
rÜ
 = 3, 
	}
}

234 
loÿl
 
m­_cÚd
 = {

235 
eq
 = 0, 
Ã
 = 1, 
cs
 = 2, 
cc
 = 3, 
mi
 = 4, 
¶
 = 5, 
vs
 = 6, 
vc
 = 7,

236 
hi
 = 8, 
ls
 = 9, 
ge
 = 10, 
É
 = 11, 
gt
 = 12, 
Ë
 = 13, 
®
 = 14,

237 
hs
 = 2, 
lo
 = 3,

242 -- 
Tem¶©e
 
¡ršgs
 
ARM
 
š¡ruùiÚs
.

243 
loÿl
 
m­_İ
 = {

244 -- 
Basic
 
d©a
 
´oûssšg
 
š¡ruùiÚs
.

245 
ªd_3
 = "e0000000DNPs",

246 
eÜ_3
 = "e0200000DNPs",

247 
sub_3
 = "e0400000DNPs",

248 
rsb_3
 = "e0600000DNPs",

249 
add_3
 = "e0800000DNPs",

250 
adc_3
 = "e0a00000DNPs",

251 
sbc_3
 = "e0c00000DNPs",

252 
rsc_3
 = "e0e00000DNPs",

253 
t¡_2
 = "e1100000NP",

254 
‹q_2
 = "e1300000NP",

255 
cmp_2
 = "e1500000NP",

256 
cmn_2
 = "e1700000NP",

257 
Ür_3
 = "e1800000DNPs",

258 
mov_2
 = "e1a00000DPs",

259 
bic_3
 = "e1c00000DNPs",

260 
mvn_2
 = "e1e00000DPs",

262 
ªd_4
 = "e0000000DNMps",

263 
eÜ_4
 = "e0200000DNMps",

264 
sub_4
 = "e0400000DNMps",

265 
rsb_4
 = "e0600000DNMps",

266 
add_4
 = "e0800000DNMps",

267 
adc_4
 = "e0a00000DNMps",

268 
sbc_4
 = "e0c00000DNMps",

269 
rsc_4
 = "e0e00000DNMps",

270 
t¡_3
 = "e1100000NMp",

271 
‹q_3
 = "e1300000NMp",

272 
cmp_3
 = "e1500000NMp",

273 
cmn_3
 = "e1700000NMp",

274 
Ür_4
 = "e1800000DNMps",

275 
mov_3
 = "e1a00000DMps",

276 
bic_4
 = "e1c00000DNMps",

277 
mvn_3
 = "e1e00000DMps",

279 
l¦_3
 = "e1a00000DMws",

280 
l¤_3
 = "e1a00020DMws",

281 
a¤_3
 = "e1a00040DMws",

282 
rÜ_3
 = "e1a00060DMws",

283 
¼x_2
 = "e1a00060DMs",

285 -- 
MuÉly
 
ªd
 
muÉly
-
accumuÏ‹
.

286 
mul_3
 = "e0000090NMSs",

287 
mÏ_4
 = "e0200090NMSDs",

288 
um¯l_4
 = "e0400090DNMSs", -- 
v6


289 
mls_4
 = "e0600090DNMSs", -- 
v6T2


290 
umuÎ_4
 = "e0800090DNMSs",

291 
umÏl_4
 = "e0a00090DNMSs",

292 
smuÎ_4
 = "e0c00090DNMSs",

293 
smÏl_4
 = "e0e00090DNMSs",

295 -- 
H®fwÜd
 
muÉly
 
ªd
 muÉly-
accumuÏ‹
.

296 
smÏbb_4
 = "e1000080NMSD", -- 
v5TE


297 
smÏtb_4
 = "e10000a0NMSD", -- 
v5TE


298 
smÏbt_4
 = "e10000c0NMSD", -- 
v5TE


299 
smÏ‰_4
 = "e10000e0NMSD", -- 
v5TE


300 
smÏwb_4
 = "e1200080NMSD", -- 
v5TE


301 
smulwb_3
 = "e12000a0NMS", -- 
v5TE


302 
smÏwt_4
 = "e12000c0NMSD", -- 
v5TE


303 
smulwt_3
 = "e12000e0NMS", -- 
v5TE


304 
smÏlbb_4
 = "e1400080NMSD", -- 
v5TE


305 
smÏÉb_4
 = "e14000a0NMSD", -- 
v5TE


306 
smÏlbt_4
 = "e14000c0NMSD", -- 
v5TE


307 
smÏÉt_4
 = "e14000e0NMSD", -- 
v5TE


308 
smulbb_3
 = "e1600080NMS", -- 
v5TE


309 
smuÉb_3
 = "e16000a0NMS", -- 
v5TE


310 
smulbt_3
 = "e16000c0NMS", -- 
v5TE


311 
smuÉt_3
 = "e16000e0NMS", -- 
v5TE


313 -- 
MisûÎªeous
 
d©a
 
´oûssšg
 
š¡ruùiÚs
.

314 
şz_2
 = "e16f0f10DM", -- 
v5T


315 
»v_2
 = "e6bf0f30DM", -- 
v6


316 
»v16_2
 = "e6bf0fb0DM", -- 
v6


317 
»vsh_2
 = "e6ff0fb0DM", -- 
v6


318 
£l_3
 = "e6800fb0DNM", -- 
v6


319 
u§d8_3
 = "e780f010NMS", -- 
v6


320 
u§da8_4
 = "e7800010NMSD", -- 
v6


321 
rb™_2
 = "e6ff0f30DM", -- 
v6T2


322 
movw_2
 = "e3000000DW", -- 
v6T2


323 
movt_2
 = "e3400000DW", -- 
v6T2


324 -- 
NÙe
: 
the
 
X
 
’codes
 
width
-1, 
nÙ
 width.

325 
sbfx_4
 = "e7a00050DMvX", -- 
v6T2


326 
ubfx_4
 = "e7e00050DMvX", -- 
v6T2


327 -- 
NÙe
: 
the
 
X
 
’codes
h
msb
 
f›ld
, 
nÙ
h
width
.

328 
bfc_3
 = "e7c0001fDvX", -- 
v6T2


329 
bfi_4
 = "e7c00010DMvX", -- 
v6T2


331 -- 
Packšg
 
ªd
 
uÅackšg
 
š¡ruùiÚs
.

332 
pkhbt_3
 = "e6800010DNM", 
pkhbt_4
 = "e6800010DNMv", -- 
v6


333 
pkhtb_3
 = "e6800050DNM", 
pkhtb_4
 = "e6800050DNMv", -- 
v6


334 
sxb_3
 = "e6a00070DNM", 
sxb_4
 = "e6a00070DNMv", -- 
v6


335 
sxb16_3
 = "e6800070DNM", 
sxb16_4
 = "e6800070DNMv", -- 
v6


336 
sxh_3
 = "e6b00070DNM", 
sxh_4
 = "e6b00070DNMv", -- 
v6


337 
sxtb_2
 = "e6af0070DM", 
sxtb_3
 = "e6af0070DMv", -- 
v6


338 
sxtb16_2
 = "e68f0070DM", 
sxtb16_3
 = "e68f0070DMv", -- 
v6


339 
sxth_2
 = "e6bf0070DM", 
sxth_3
 = "e6bf0070DMv", -- 
v6


340 
uxb_3
 = "e6e00070DNM", 
uxb_4
 = "e6e00070DNMv", -- 
v6


341 
uxb16_3
 = "e6c00070DNM", 
uxb16_4
 = "e6c00070DNMv", -- 
v6


342 
uxh_3
 = "e6f00070DNM", 
uxh_4
 = "e6f00070DNMv", -- 
v6


343 
uxtb_2
 = "e6ef0070DM", 
uxtb_3
 = "e6ef0070DMv", -- 
v6


344 
uxtb16_2
 = "e6cf0070DM", 
uxtb16_3
 = "e6cf0070DMv", -- 
v6


345 
uxth_2
 = "e6ff0070DM", 
uxth_3
 = "e6ff0070DMv", -- 
v6


347 -- 
S©u¿tšg
 
š¡ruùiÚs
.

348 
qadd_3
 = "e1000050DMN", -- 
v5TE


349 
qsub_3
 = "e1200050DMN", -- 
v5TE


350 
qdadd_3
 = "e1400050DMN", -- 
v5TE


351 
qdsub_3
 = "e1600050DMN", -- 
v5TE


352 -- 
NÙe
: 
the
 
X
 
s§t
* 
’codes
 
§t_imm
-1, 
nÙ
 sat_imm.

353 
s§t_3
 = "e6a00010DXM", 
s§t_4
 = "e6a00010DXMp", -- 
v6


354 
u§t_3
 = "e6e00010DXM", 
u§t_4
 = "e6e00010DXMp", -- 
v6


355 
s§t16_3
 = "e6a00f30DXM", -- 
v6


356 
u§t16_3
 = "e6e00f30DXM", -- 
v6


358 -- 
P¬®Ël
 
add™iÚ
 
ªd
 
subŒaùiÚ
.

359 
§dd16_3
 = "e6100f10DNM", -- 
v6


360 
§sx_3
 = "e6100f30DNM", -- 
v6


361 
s§x_3
 = "e6100f50DNM", -- 
v6


362 
ssub16_3
 = "e6100f70DNM", -- 
v6


363 
§dd8_3
 = "e6100f90DNM", -- 
v6


364 
ssub8_3
 = "e6100ff0DNM", -- 
v6


365 
qadd16_3
 = "e6200f10DNM", -- 
v6


366 
qasx_3
 = "e6200f30DNM", -- 
v6


367 
q§x_3
 = "e6200f50DNM", -- 
v6


368 
qsub16_3
 = "e6200f70DNM", -- 
v6


369 
qadd8_3
 = "e6200f90DNM", -- 
v6


370 
qsub8_3
 = "e6200ff0DNM", -- 
v6


371 
shadd16_3
 = "e6300f10DNM", -- 
v6


372 
shasx_3
 = "e6300f30DNM", -- 
v6


373 
sh§x_3
 = "e6300f50DNM", -- 
v6


374 
shsub16_3
 = "e6300f70DNM", -- 
v6


375 
shadd8_3
 = "e6300f90DNM", -- 
v6


376 
shsub8_3
 = "e6300ff0DNM", -- 
v6


377 
uadd16_3
 = "e6500f10DNM", -- 
v6


378 
uasx_3
 = "e6500f30DNM", -- 
v6


379 
u§x_3
 = "e6500f50DNM", -- 
v6


380 
usub16_3
 = "e6500f70DNM", -- 
v6


381 
uadd8_3
 = "e6500f90DNM", -- 
v6


382 
usub8_3
 = "e6500ff0DNM", -- 
v6


383 
uqadd16_3
 = "e6600f10DNM", -- 
v6


384 
uqasx_3
 = "e6600f30DNM", -- 
v6


385 
uq§x_3
 = "e6600f50DNM", -- 
v6


386 
uqsub16_3
 = "e6600f70DNM", -- 
v6


387 
uqadd8_3
 = "e6600f90DNM", -- 
v6


388 
uqsub8_3
 = "e6600ff0DNM", -- 
v6


389 
uhadd16_3
 = "e6700f10DNM", -- 
v6


390 
uhasx_3
 = "e6700f30DNM", -- 
v6


391 
uh§x_3
 = "e6700f50DNM", -- 
v6


392 
uhsub16_3
 = "e6700f70DNM", -- 
v6


393 
uhadd8_3
 = "e6700f90DNM", -- 
v6


394 
uhsub8_3
 = "e6700ff0DNM", -- 
v6


396 -- 
Lßd
/
¡Üe
 
š¡ruùiÚs
.

397 
¡r_2
 = "e4000000DL", 
¡r_3
 = "e4000000DL", 
¡r_4
 = "e4000000DL",

398 
¡rb_2
 = "e4400000DL", 
¡rb_3
 = "e4400000DL", 
¡rb_4
 = "e4400000DL",

399 
ldr_2
 = "e4100000DL", 
ldr_3
 = "e4100000DL", 
ldr_4
 = "e4100000DL",

400 
ldrb_2
 = "e4500000DL", 
ldrb_3
 = "e4500000DL", 
ldrb_4
 = "e4500000DL",

401 
¡rh_2
 = "e00000b0DL", 
¡rh_3
 = "e00000b0DL",

402 
ldrh_2
 = "e01000b0DL", 
ldrh_3
 = "e01000b0DL",

403 
ldrd_2
 = "e00000d0DL", 
ldrd_3
 = "e00000d0DL", -- 
v5TE


404 
ldrsb_2
 = "e01000d0DL", 
ldrsb_3
 = "e01000d0DL",

405 
¡rd_2
 = "e00000f0DL", 
¡rd_3
 = "e00000f0DL", -- 
v5TE


406 
ldrsh_2
 = "e01000f0DL", 
ldrsh_3
 = "e01000f0DL",

408 
ldm_2
 = "e8900000oR", 
ldmŸ_2
 = "e8900000oR", 
ldmfd_2
 = "e8900000oR",

409 
ldmda_2
 = "e8100000oR", 
ldmç_2
 = "e8100000oR",

410 
ldmdb_2
 = "e9100000oR", 
ldm—_2
 = "e9100000oR",

411 
ldmib_2
 = "e9900000oR", 
ldmed_2
 = "e9900000oR",

412 
¡m_2
 = "e8800000oR", 
¡mŸ_2
 = "e8800000oR", 
¡mfd_2
 = "e8800000oR",

413 
¡mda_2
 = "e8000000oR", 
¡mç_2
 = "e8000000oR",

414 
¡mdb_2
 = "e9000000oR", 
¡m—_2
 = "e9000000oR",

415 
¡mib_2
 = "e9800000oR", 
¡med_2
 = "e9800000oR",

416 
pİ_1
 = "e8bd0000R", 
push_1
 = "e92d0000R",

418 -- 
B¿nch
 
š¡ruùiÚs
.

419 
b_1
 = "ea000000B",

420 
bl_1
 = "eb000000B",

421 
blx_1
 = "e12fff30C",

422 
bx_1
 = "e12fff10M",

424 -- 
MisûÎªeous
 
š¡ruùiÚs
.

425 
nİ_0
 = "e1a00000",

426 
mrs_1
 = "e10f0000D",

427 
bk±_1
 = "e1200070K", -- 
v5T


428 
svc_1
 = "ef000000T", 
swi_1
 = "ef000000T",

429 
ud_0
 = "e7f001f0",

431 -- 
VFP
 
š¡ruùiÚs
.

466 
vldr_2
 = "ed100a00dl|ed100b00Gdl",

467 
v¡r_2
 = "ed000a00dl|ed000b00Gdl",

468 
vldm_2
 = "ec900a00or",

469 
vldmŸ_2
 = "ec900a00or",

470 
vldmdb_2
 = "ed100a00or",

471 
vpİ_1
 = "ecbd0a00r",

472 
v¡m_2
 = "ec800a00or",

473 
v¡mŸ_2
 = "ec800a00or",

474 
v¡mdb_2
 = "ed000a00or",

475 
vpush_1
 = "ed2d0a00r",

477 ["vmov.f32_2"] = "“b00a40dm|“b00a00dY", -- #imm 
is
 
VFPv3
 
Úly


478 ["vmov.f64_2"] = "“b00b40Gdm|“b00b00GdY", -- #imm 
is
 
VFPv3
 
Úly


479 
vmov_2
 = "ee100a10Dn|ee000a10nD",

480 
vmov_3
 = "ec500a10DNm|ec400a10mDN|ec500b10GDNm|ec400b10GmDN",

482 
vmrs_0
 = "eef1fa10",

483 
vmrs_1
 = "eef10a10D",

484 
vm¤_1
 = "eee10a10D",

501 -- 
VFPv4
 
Úly
:

511 -- 
NYI
: 
Advªûd
 
SIMD
 
š¡ruùiÚs
.

513 -- 
NYI
: 
I
 
have
 
no
 
Ãed
 
the£
 
š¡ruùiÚs
 
right
 
now
:

514 -- 
swp
, 
swpb
, 
¡»x
, 
ld»x
, 
¡»xd
, 
ld»xd
, 
¡»xb
, 
ld»xb
, 
¡»xh
, 
ld»xh


515 -- 
m¤
, 
nİv6
, 
y›ld
, 
wã
, 
wfi
, 
£v
, 
dbg
, 
bxj
, 
smc
, 
¤s
, 
rã


516 -- 
ıs
, 
£‹nd
, 
¶i
, 
¶d
, 
¶dw
, 
ş»x
, 
dsb
, 
dmb
, 
isb


517 -- 
¡c
, 
ldc
, 
mü
, 
mü2
, 
mrc
, 
mrc2
, 
mür
, 
mür2
, 
m¼c
, 
m¼c2
, 
cdp
, 
cdp2


520 -- 
Add
 
mÃmÚics
 "s" 
v¬ŸÁs
.

522 
loÿl
 
t
 = {}

523 
k
,
v
 
š
 
	$·œs
(
m­_İ
) do

524 
	`sub
(
v
, -1è=ğ"s" 
th’


525 
loÿl
 
v2
 = 
	`sub
(
v
, 1, 2)..(
	`by‹
(v, 3)+1)..sub(v, 4, -2)

526 
t
[
	`sub
(
k
, 1, -3).."s"..sub(k, -2)] = 
v2


527 
’d


528 
’d


529 
k
,
v
 
š
 
	$·œs
(
t
) do

530 
m­_İ
[
k
] = 
v


531 
’d


532 
’d


536 
loÿl
 
funùiÚ
 
	$·r£_g´
(
ex´
)

537 
loÿl
 
Šame
, 
ov»g
 = 
	`m©ch
(
ex´
, "^([%w_]+):(r1?[0-9])$")

538 
loÿl
 

 = 
m­_ty³
[
Šame
 
Ü
 
ex´
]

539 

 
th’


540 
loÿl
 
»g
 = 
ov»g
 
Ü
 

.reg

541 
nÙ
 
»g
 
th’


542 
	`w”rÜ
("ty³ `"..(
Šame
 
Ü
 
ex´
).."'‚eeds‡„egister override")

543 
’d


544 
ex´
 = 
»g


545 
’d


546 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^r(1?[0-9])$")

547 
r
 
th’


548 
r
 = 
	$tÚumb”
(
r
)

549 
r
 <ğ15 
th’
 „, 

 
’d


550 
’d


551 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

552 
’d


554 
loÿl
 
funùiÚ
 
	$·r£_g´_pm
(
ex´
)

555 
loÿl
 
pm
, 
ex´2
 = 
	`m©ch
(
ex´
, "^([+-]?)(.*)$")

556  
	`·r£_g´
(
ex´2
), (
pm
 == "-")

557 
’d


559 
loÿl
 
funùiÚ
 
	$·r£_vr
(
ex´
, 

)

560 
loÿl
 
t
, 
r
 = 
	`m©ch
(
ex´
, "^([sd])([0-9]+)$")

561 
t
 =ğ

 
th’


562 
r
 = 
	$tÚumb”
(
r
)

563 
r
 <ğ31 
th’


564 
t
 =ğ"s" 
th’
  
	`shr
(
r
, 1), 
	$bªd
(
r
, 1è
’d


565  
	`bªd
(
r
, 15), 
	$shr
(
r
, 4)

566 
’d


567 
’d


568 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

569 
’d


571 
loÿl
 
funùiÚ
 
	$·r£_»gli¡
(
»gli¡
)

572 
»gli¡
 = 
	`m©ch
(reglist, "^{%s*([^}]*)}$")

573 
nÙ
 
»gli¡
 
th’
 
	`w”rÜ
("»gi¡”†i¡ƒx³ùed"è
’d


574 
loÿl
 
¼
 = 0

575 
p
 
š
 
	`gm©ch
(
»gli¡
..",", "%s*([^,]*),") do

576 
loÿl
 
rb™
 = 
	`shl
(1, 
	`·r£_g´
(
	`gsub
(
p
, "%s+$", "")))

577 
	`bªd
(
¼
, 
rb™
è~ğ0 
th’


578 
	`w”rÜ
("du¶iÿ‹„egi¡” `"..
p
.."'")

579 
’d


580 
¼
 =„¸+ 
rb™


581 
’d


582  
¼


583 
’d


585 
loÿl
 
funùiÚ
 
	$·r£_v¾i¡
(
»gli¡
)

586 
loÿl
 

, 
¿
, 
tb
, 
rb
 = 
	`m©ch
(
»gli¡
,

588 
¿
, 
rb
 = 
	`tÚumb”
Ôa), 
	$tÚumb”
(
rb
)

589 

 
ªd
¨=ğ
tb
‡nd 
¿
‡nd 
rb
‡nd„¨<ğ31‡nd„b <ğ31‡nd„¨<ğrb 
th’


590 
loÿl
 
Ä
 = 
rb
+1 - 
¿


591 

 =ğ"s" 
th’


592  
	`shl
(
	`shr
(
¿
,1),12)+shl(
	`bªd
Ôa,1),22è+ 
Ä


594  
	`shl
(
	`bªd
(
¿
,15),12)+shl(
	`shr
Ôa,4),22è+ 
Ä
*2 + 0x100

595 
’d


596 
’d


597 
	`w”rÜ
("register†istƒxpected")

598 
’d


600 
loÿl
 
funùiÚ
 
	$·r£_imm
(
imm
, 
b™s
, 
shiá
, 
sÿË
, signed)

601 
imm
 = 
	`m©ch
(imm, "^#(.*)$")

602 
nÙ
 
imm
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ o³¿nd"è
’d


603 
loÿl
 
n
 = 
	$tÚumb”
(
imm
)

604 
n
 
th’


605 
loÿl
 
m
 = 
	$§r
(
n
, 
sÿË
)

606 
	`shl
(
m
, 
sÿË
è=ğ
n
 
th’


607 sigÃd 
th’


608 
loÿl
 
s
 = 
	`§r
(
m
, 
b™s
-1)

609 
s
 =ğ0 
th’
  
	$shl
(
m
, 
shiá
)

610 
–£if
 
s
 =ğ-1 
th’
  
	`shl
(
m
 + shl(1, 
b™s
), 
shiá
è
’d


612 
	`§r
(
m
, 
b™s
è=ğ0 
th’
  
	$shl
(
m
, 
shiá
è
’d


613 
’d


614 
’d


615 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

617 
	`waùiÚ
("IMM", (sigÃd 
ªd
 32768 
Ü
 0)+
sÿË
*1024+
b™s
*32+
shiá
, 
imm
)

619 
’d


620 
’d


622 
loÿl
 
funùiÚ
 
	$·r£_imm12
(
imm
)

623 
loÿl
 
n
 = 
	$tÚumb”
(
imm
)

624 
n
 
th’


625 
loÿl
 
m
 = 
	$bªd
(
n
)

626 
i
=0,-15,-1 do

627 
	`shr
(
m
, 8è=ğ0 
th’
  m + 
	`shl
(
	`bªd
(
i
, 15), 8è
’d


628 
m
 = 
	$rÜ
(
m
, 2)

629 
’d


630 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

632 
	`waùiÚ
("IMM12", 0, 
imm
)

634 
’d


635 
’d


637 
loÿl
 
funùiÚ
 
	$·r£_imm16
(
imm
)

638 
imm
 = 
	`m©ch
(imm, "^#(.*)$")

639 
nÙ
 
imm
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ o³¿nd"è
’d


640 
loÿl
 
n
 = 
	$tÚumb”
(
imm
)

641 
n
 
th’


642 
	`shr
(
n
, 16è=ğ0 
th’
  
	`bªd
Ò, 0x0fffè+ 
	`shl
(bªdÒ, 0xf000), 4è
’d


643 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

645 
	`waùiÚ
("IMM16", 32*16, 
imm
)

647 
’d


648 
’d


650 
loÿl
 
funùiÚ
 
	$·r£_imm_lßd
(
imm
, 
ext
)

651 
loÿl
 
n
 = 
	$tÚumb”
(
imm
)

652 
n
 
th’


653 
ext
 
th’


654 
n
 >ğ-255 
ªd
‚ <ğ255 
th’


655 
loÿl
 
up
 = 0x00800000

656 
n
 < 0 
th’
‚ = -n; 
up
 = 0 
’d


657  
	`shl
(
	`bªd
(
n
, 0xf0), 4è+ bªdÒ, 0x0fè+ 
up


658 
’d


660 
n
 >ğ-4095 
ªd
‚ <ğ4095 
th’


661 
n
 >ğ0 
th’
 ‚+0x00800000 
’d


662  -
n


663 
’d


664 
’d


665 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

667 
	`waùiÚ
(
ext
 
ªd
 "IMML8" 
Ü
 "IMML12", 32768 + 
	`shl
Óxˆªd 8 o¸12, 5), 
imm
)

669 
’d


670 
’d


672 
loÿl
 
funùiÚ
 
	$·r£_shiá
(
shiá
, 
g´ok
)

673 
shiá
 =ğ"¼x" 
th’


676 
loÿl
 
s
, 
s2
 = 
	`m©ch
(
shiá
, "^(%S+)%s*(.*)$")

677 
s
 = 
m­_shiá
[s]

678 
nÙ
 
s
 
th’
 
	`w”rÜ
("ex³ùed shiá o³¿nd"è
’d


679 
	`sub
(
s2
, 1, 1è=ğ"#" 
th’


680  
	`·r£_imm
(
s2
, 5, 7, 0, 
çl£
è+ 
	$shl
(
s
, 5)

682 
nÙ
 
g´ok
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ shiá o³¿nd"è
’d


683  
	`shl
(
	`·r£_g´
(
s2
), 8è+ shl(
s
, 5) + 16

684 
’d


685 
’d


686 
’d


688 
loÿl
 
funùiÚ
 
	$·r£_Ïb–
(
Ïb–
, 
def
)

689 
loÿl
 
´efix
 = 
	`sub
(
Ïb–
, 1, 2)

690 -- =>
	$Ïb–
 (
pc
 
Ïb–
 
»ã»nû
)

691 
´efix
 =ğ"=>" 
th’


692  "PC", 0, 
	$sub
(
Ïb–
, 3)

693 
’d


694 -- ->
	$Çme
 (
glob®
 
Ïb–
 
»ã»nû
)

695 
´efix
 =ğ"->" 
th’


696  "LG", 
m­_glob®
[
	`sub
(
Ïb–
, 3)]

697 
’d


698 
def
 
th’


699 -- [1-9] (
loÿl
 
Ïb–
 
defš™iÚ
)

700 
	`m©ch
(
Ïb–
, "^[1-9]$"è
th’


701  "LG", 10+
	$tÚumb”
(
Ïb–
)

702 
’d


704 -- [<>][1-9] (
loÿl
 
Ïb–
 
»ã»nû
)

705 
loÿl
 
dœ
, 
Êum
 = 
	`m©ch
(
Ïb–
, "^([<>])([1-9])$")

706 
dœ
 
th’
 -- 
Fwd
: 1-9, 
Bkwd
: 11-19.

707  "LG", 
Êum
 + (
dœ
 =ğ">" 
ªd
 0 
Ü
 10)

708 
’d


709 -- 
	$Ïb–
 (
Ïb–
 
»ã»nû
)

710 
loÿl
 
exŠame
 = 
	`m©ch
(
Ïb–
, "^extern%s+(%S+)$")

711 
exŠame
 
th’


712  "EXT", 
m­_ex‹º
[
exŠame
]

713 
’d


714 
’d


715 
	`w”rÜ
("bad†ab– `"..
Ïb–
.."'")

716 
’d


718 
loÿl
 
funùiÚ
 
	$·r£_lßd
(
·¿ms
, 
Å¬ams
, 
n
, 
İ
)

719 
loÿl
 
İlo
 = 
	$bªd
(
İ
, 255)

720 
loÿl
 
ext
, 
ldrd
 = (
İlo
 ~= 0), (oplo == 208)

721 
loÿl
 
d


722 ià(
ldrd
 
Ü
 
İlo
 =ğ240è
th’


723 
d
 = 
	`bªd
(
	`shr
(
İ
, 12), 15)

724 
	`bªd
(
d
, 1è~ğ0 
th’
 
	`w”rÜ
("odd de¡š©iÚ„egi¡”"è
’d


725 
’d


726 
loÿl
 
²
 = 
·¿ms
[
n
]

727 
loÿl
 
p1
, 
wb
 = 
	`m©ch
(
²
, "^%[%s*(.-)%s*%](!?)$")

728 
loÿl
 
p2
 = 
·¿ms
[
n
+1]

729 
nÙ
 
p1
 
th’


730 
nÙ
 
p2
 
th’


731 
	`m©ch
(
²
, "^[<>=%-]"è
Ü
 m©chÕn, "^ex‹º%s+"è
th’


732 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
²
, 
çl£
)

733 
	`waùiÚ
("REL_"..
mode
, 
n
 + (
ext
 
ªd
 0x1800 
Ü
 0x0800), 
s
, 1)

734  
İ
 + 15 * 65536 + 0x01000000 + (
ext
 
ªd
 0x00400000 
Ü
 0)

735 
’d


736 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
²
, "^([%w_:]+)%s*(.*)$")

737 
»g
 
ªd
 
r
 ~ğ"" 
th’


738 
loÿl
 
d
, 

 = 
	$·r£_g´
(
»g
)

739 

 
th’


740 
	`waùiÚ
(
ext
 
ªd
 "IMML8" 
Ü
 "IMML12", 32768 + 32*(ext‡nd 8 or 12),

741 
	$fÜm©
(

.
ùy³fmt
, 
r
))

742  
İ
 + 
	`shl
(
d
, 16è+ 0x01000000 + (
ext
 
ªd
 0x00400000 
Ü
 0)

743 
’d


744 
’d


745 
’d


746 
	`w”rÜ
("expected‡ddress operand")

747 
’d


748 
wb
 =ğ"!" 
th’
 
İ
 = o°+ 0x00200000 
’d


749 
p2
 
th’


750 
wb
 =ğ"!" 
th’
 
	`w”rÜ
("bad u£ oà'!'"è
’d


751 
loÿl
 
p3
 = 
·¿ms
[
n
+2]

752 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
p1
), 16)

753 
loÿl
 
imm
 = 
	`m©ch
(
p2
, "^#(.*)$")

754 
imm
 
th’


755 
loÿl
 
m
 = 
	$·r£_imm_lßd
(
imm
, 
ext
)

756 
p3
 
th’
 
	`w”rÜ
("toØmªy…¬am‘”s"è
’d


757 
İ
 = o°+ 
m
 + (
ext
 
ªd
 0x00400000 
Ü
 0)

759 
loÿl
 
m
, 
Ãg
 = 
	$·r£_g´_pm
(
p2
)

760 
ldrd
 
	`ªd
 (
m
 =ğ
d
 
Ü
 m-1 =ğdè
th’
 
	`w”rÜ
("»gi¡” cÚæiù"è
’d


761 
İ
 = o°+ 
m
 + (
Ãg
 
ªd
 0 
Ü
 0x00800000è+ (
ext
‡nd 0 or 0x02000000)

762 
p3
 
th’
 
İ
 = o°+ 
	$·r£_shiá
(
p3
è
’d


763 
’d


765 
loÿl
 
p1a
, 
p2
 = 
	`m©ch
(
p1
, "^([^,%s]*)%s*(.*)$")

766 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
p1a
), 16) + 0x01000000

767 
p2
 ~ğ"" 
th’


768 
loÿl
 
imm
 = 
	`m©ch
(
p2
, "^,%s*#(.*)$")

769 
imm
 
th’


770 
loÿl
 
m
 = 
	$·r£_imm_lßd
(
imm
, 
ext
)

771 
İ
 = o°+ 
m
 + (
ext
 
ªd
 0x00400000 
Ü
 0)

773 
loÿl
 
p2a
, 
p3
 = 
	`m©ch
(
p2
, "^,%s*([^,%s]*)%s*,?%s*(.*)$")

774 
loÿl
 
m
, 
Ãg
 = 
	$·r£_g´_pm
(
p2a
)

775 
ldrd
 
	`ªd
 (
m
 =ğ
d
 
Ü
 m-1 =ğdè
th’
 
	`w”rÜ
("»gi¡” cÚæiù"è
’d


776 
İ
 = o°+ 
m
 + (
Ãg
 
ªd
 0 
Ü
 0x00800000è+ (
ext
‡nd 0 or 0x02000000)

777 
p3
 ~ğ"" 
th’


778 
ext
 
th’
 
	`w”rÜ
("toØmªy…¬am‘”s"è
’d


779 
İ
 = o°+ 
	$·r£_shiá
(
p3
)

780 
’d


781 
’d


783 
wb
 =ğ"!" 
th’
 
	`w”rÜ
("bad u£ oà'!'"è
’d


784 
İ
 = o°+ (
ext
 
ªd
 0x00c00000 
Ü
 0x00800000)

785 
’d


786 
’d


787  
İ


788 
’d


790 
loÿl
 
funùiÚ
 
	$·r£_vlßd
(
q
)

791 
loÿl
 
»g
, 
imm
 = 
	`m©ch
(
q
, "^%[%s*([^,%s]*)%s*(.*)%]$")

792 
»g
 
th’


793 
loÿl
 
d
 = 
	`shl
(
	`·r£_g´
(
»g
), 16)

794 
imm
 =ğ"" 
th’
  
d
 
’d


795 
imm
 = 
	`m©ch
(imm, "^,%s*#(.*)$")

796 
imm
 
th’


797 
loÿl
 
n
 = 
	$tÚumb”
(
imm
)

798 
n
 
th’


799 
n
 >ğ-1020 
ªd
‚ <ğ1020‡nd‚%4 =ğ0 
th’


800  
d
 + (
n
 >ğ0 
ªd
‚/4+0x00800000 
Ü
 -n/4)

801 
’d


802 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

804 
	`waùiÚ
("IMMV8", 32768 + 32*8, 
imm
)

805  
d


806 
’d


807 
’d


809 
	`m©ch
(
q
, "^[<>=%-]"è
Ü
 m©ch(q, "^ex‹º%s+"è
th’


810 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
q
, 
çl£
)

811 
	`waùiÚ
("REL_"..
mode
, 
n
 + 0x2800, 
s
, 1)

813 
’d


814 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
q
, "^([%w_:]+)%s*(.*)$")

815 
»g
 
ªd
 
r
 ~ğ"" 
th’


816 
loÿl
 
d
, 

 = 
	$·r£_g´
(
»g
)

817 

 
th’


818 
	`waùiÚ
("IMMV8", 32768 + 32*8, 
	$fÜm©
(

.
ùy³fmt
, 
r
))

819  
	$shl
(
d
, 16)

820 
’d


821 
’d


822 
’d


823 
	`w”rÜ
("expected‡ddress operand")

824 
’d


828 -- 
HªdË
 
İcodes
 
defšed
 
w™h
 
‹m¶©e
 
¡ršgs
.

829 
loÿl
 
funùiÚ
 
	$·r£_‹m¶©e
(
·¿ms
, 
‹m¶©e
, 
Å¬ams
, 
pos
)

830 
loÿl
 
İ
 = 
	`tÚumb”
(
	`sub
(
‹m¶©e
, 1, 8), 16)

831 
loÿl
 
n
 = 1

832 
loÿl
 
vr
 = "s"

834 -- 
Proûss
 
—ch
 
ch¬aù”
.

835 
p
 
š
 
	`gm©ch
(
	`sub
(
‹m¶©e
, 9), ".") do

836 
loÿl
 
q
 = 
·¿ms
[
n
]

837 
p
 =ğ"D" 
th’


838 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
q
), 12); 
n
 =‚ + 1

839 
–£if
 
p
 =ğ"N" 
th’


840 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
q
), 16); 
n
 =‚ + 1

841 
–£if
 
p
 =ğ"S" 
th’


842 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
q
), 8); 
n
 =‚ + 1

843 
–£if
 
p
 =ğ"M" 
th’


844 
İ
 = o°+ 
	`·r£_g´
(
q
); 
n
 =‚ + 1

845 
–£if
 
p
 =ğ"d" 
th’


846 
loÿl
 
r
,
h
 = 
	`·r£_vr
(
q
, 
vr
); 
İ
 = op+
	`shl
Ô,12)+shl(h,22); 
n
 =‚ + 1

847 
–£if
 
p
 =ğ"n" 
th’


848 
loÿl
 
r
,
h
 = 
	`·r£_vr
(
q
, 
vr
); 
İ
 = op+
	`shl
Ô,16)+shl(h,7); 
n
 =‚ + 1

849 
–£if
 
p
 =ğ"m" 
th’


850 
loÿl
 
r
,
h
 = 
	`·r£_vr
(
q
, 
vr
); 
İ
 = op+r+
	`shl
(h,5); 
n
 =‚ + 1

851 
–£if
 
p
 =ğ"P" 
th’


852 
loÿl
 
imm
 = 
	`m©ch
(
q
, "^#(.*)$")

853 
imm
 
th’


854 
İ
 = o°+ 
	`·r£_imm12
(
imm
) + 0x02000000

856 
İ
 = o°+ 
	$·r£_g´
(
q
)

857 
’d


858 
n
 =‚ + 1

859 
–£if
 
p
 =ğ"p" 
th’


860 
İ
 = o°+ 
	`·r£_shiá
(
q
, 
Œue
); 
n
 =‚ + 1

861 
–£if
 
p
 =ğ"L" 
th’


862 
İ
 = 
	$·r£_lßd
(
·¿ms
, 
Å¬ams
, 
n
, 
İ
)

863 
–£if
 
p
 =ğ"l" 
th’


864 
İ
 = o°+ 
	$·r£_vlßd
(
q
)

865 
–£if
 
p
 =ğ"B" 
th’


866 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
q
, 
çl£
)

867 
	`waùiÚ
("REL_"..
mode
, 
n
, 
s
, 1)

868 
–£if
 
p
 =ğ"C" 
th’
 -- 
blx
 
g´
 
vs
. blx 
Ïb–
.

869 
	`m©ch
(
q
, "^([%w_]+):Ô1?[0-9])$"è
Ü
 m©ch(q, "^r(1?[0-9])$"è
th’


870 
İ
 = o°+ 
	$·r£_g´
(
q
)

872 
İ
 < 0xe0000000 
th’
 
	`w”rÜ
("uncÚd™iÚ® in¡ruùiÚ"è
’d


873 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
q
, 
çl£
)

874 
	`waùiÚ
("REL_"..
mode
, 
n
, 
s
, 1)

875 
İ
 = 0xfa000000

876 
’d


877 
–£if
 
p
 =ğ"F" 
th’


878 
vr
 = "s"

879 
–£if
 
p
 =ğ"G" 
th’


880 
vr
 = "d"

881 
–£if
 
p
 =ğ"o" 
th’


882 
loÿl
 
r
, 
wb
 = 
	`m©ch
(
q
, "^([^!]*)(!?)$")

883 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
r
), 16è+ (
wb
 =ğ"!" 
ªd
 0x00200000 
Ü
 0)

884 
n
 =‚ + 1

885 
–£if
 
p
 =ğ"R" 
th’


886 
İ
 = o°+ 
	`·r£_»gli¡
(
q
); 
n
 =‚ + 1

887 
–£if
 
p
 =ğ"r" 
th’


888 
İ
 = o°+ 
	`·r£_v¾i¡
(
q
); 
n
 =‚ + 1

889 
–£if
 
p
 =ğ"W" 
th’


890 
İ
 = o°+ 
	`·r£_imm16
(
q
); 
n
 =‚ + 1

891 
–£if
 
p
 =ğ"v" 
th’


892 
İ
 = o°+ 
	`·r£_imm
(
q
, 5, 7, 0, 
çl£
); 
n
 =‚ + 1

893 
–£if
 
p
 =ğ"w" 
th’


894 
loÿl
 
imm
 = 
	`m©ch
(
q
, "^#(.*)$")

895 
imm
 
th’


896 
İ
 = o°+ 
	`·r£_imm
(
q
, 5, 7, 0, 
çl£
); 
n
 =‚ + 1

898 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
q
), 8) + 16

899 
’d


900 
–£if
 
p
 =ğ"X" 
th’


901 
İ
 = o°+ 
	`·r£_imm
(
q
, 5, 16, 0, 
çl£
); 
n
 =‚ + 1

902 
–£if
 
p
 =ğ"Y" 
th’


903 
loÿl
 
imm
 = 
	`tÚumb”
(
	`m©ch
(
q
, "^#(.*)$")); 
n
 =‚ + 1

904 
nÙ
 
imm
 
Ü
 
	`shr
(imm, 8è~ğ0 
th’


905 
	`w”rÜ
("bad immediate operand")

906 
’d


907 
İ
 = o°+ 
	`shl
(
	`bªd
(
imm
, 0xf0), 12è+ 
	$bªd
(
imm
, 0x0f)

908 
–£if
 
p
 =ğ"K" 
th’


909 
loÿl
 
imm
 = 
	`tÚumb”
(
	`m©ch
(
q
, "^#(.*)$")); 
n
 =‚ + 1

910 
nÙ
 
imm
 
Ü
 
	`shr
(imm, 16è~ğ0 
th’


911 
	`w”rÜ
("bad immediate operand")

912 
’d


913 
İ
 = o°+ 
	`shl
(
	`bªd
(
imm
, 0xfff0), 4è+ 
	$bªd
(
imm
, 0x000f)

914 
–£if
 
p
 =ğ"T" 
th’


915 
İ
 = o°+ 
	`·r£_imm
(
q
, 24, 0, 0, 
çl£
); 
n
 =‚ + 1

916 
–£if
 
p
 =ğ"s" 
th’


917 -- 
IgnÜed
.

919 
	$as£¹
(
çl£
)

920 
’d


921 
’d


922 
	$wpuos
(
pos
, 
İ
)

923 
’d


925 
m­_İ
[".‹m¶©e__"] = 
	$funùiÚ
(
·¿ms
, 
‹m¶©e
, 
Å¬ams
)

926 
nÙ
 
·¿ms
 
th’
  
‹m¶©e
:
	`gsub
("%x%x%x%x%x%x%x%x", ""è
’d


928 -- 
Lim™
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
u£d
 
by
 
a
 
sšgË
 
	`dasm_put
().

929 -- 
A
 
sšgË
 
İcode
 
Ãeds
 
a
 
maximum
 
of
 3 
pos™iÚs
.

930 
£ıos
+3 > 
max£ıos
 
th’
 
	$wæush
(è
’d


931 
loÿl
 
pos
 = 
	$wpos
()

932 
loÿl
 
Íos
, 
­os
, 
¥os
 = #aùli¡, #aù¬gs, 
£ıos


934 
loÿl
 
ok
, 
”r


935 
t
 
š
 
	`gm©ch
(
‹m¶©e
, "[^|]+") do

936 
ok
, 
”r
 = 
	$pÿÎ
(
·r£_‹m¶©e
, 
·¿ms
, 
t
, 
Å¬ams
, 
pos
)

937 
ok
 
th’
  
’d


938 
£ıos
 = 
¥os


939 
aùli¡
[
Íos
+1] = 
n


940 
aùli¡
[
Íos
+2] = 
n


941 
aùli¡
[
Íos
+3] = 
n


942 
aù¬gs
[
­os
+1] = 
n


943 
aù¬gs
[
­os
+2] = 
n


944 
aù¬gs
[
­os
+3] = 
n


945 
’d


946 
	$”rÜ
(
”r
, 0)

947 
’d


951 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
aùiÚ
 
li¡
 
is
Ø
be
 
em™‹d
.

952 
m­_İ
[".aùiÚli¡_1"] = 
	$funùiÚ
(
·¿ms
)

953 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


954 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

955 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™—ùiÚs
(
out
, 
Çme
è
’d
)

956 
’d


958 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
is
Ø
be
 
em™‹d
.

959 
m­_İ
[".glob®s_1"] = 
	$funùiÚ
(
·¿ms
)

960 
nÙ
 
·¿ms
 
th’
  "´efix" 
’d


961 
loÿl
 
´efix
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

962 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®s
(
out
, 
´efix
è
’d
)

963 
’d


965 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
Çmes
 
¬e
Ø
be
 
em™‹d
.

966 
m­_İ
[".glob®Çmes_1"] = 
	$funùiÚ
(
·¿ms
)

967 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


968 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

969 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®Çmes
(
out
, 
Çme
è
’d
)

970 
’d


972 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
Çmes
 
¬e
Ø
be
 
em™‹d
.

973 
m­_İ
[".ex‹ºÇmes_1"] = 
	$funùiÚ
(
·¿ms
)

974 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


975 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

976 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™“x‹ºÇmes
(
out
, 
Çme
è
’d
)

977 
’d


981 -- 
Lab–
 
p£udo
-
	`İcode
 (
cÚv”‹d
 
äom
 
Œašg
 
cŞÚ
 
fÜm
).

982 
m­_İ
[".Ïb–_1"] = 
	$funùiÚ
(
·¿ms
)

983 
nÙ
 
·¿ms
 
th’
  "[1-9] | ->glob® | =>pûx´" 
’d


984 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


985 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
·¿ms
[1], 
Œue
)

986 
mode
 =ğ"EXT" 
th’
 
	`w”rÜ
("bad†ab– defš™iÚ"è
’d


987 
	`waùiÚ
("LABEL_"..
mode
, 
n
, 
s
, 1)

988 
’d


992 -- 
P£udo
-
İcodes
 
d©a
 
¡Üage
.

993 
m­_İ
[".lÚg_*"] = 
	$funùiÚ
(
·¿ms
)

994 
nÙ
 
·¿ms
 
th’
  "imm..." 
’d


995 
_
,
p
 
š
 
	$aœs
(
·¿ms
) do

996 
loÿl
 
n
 = 
	$tÚumb”
(
p
)

997 
nÙ
 
n
 
th’
 
	`w”rÜ
("bad immedŸ‹ `"..
p
.."'"è
’d


998 
n
 < 0 
th’
‚ =‚ + 2^32 
’d


999 
	$wputw
(
n
)

1000 
£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1001 
’d


1002 
’d


1004 -- 
Alignm’t
 
p£udo
-
İcode
.

1005 
m­_İ
[".®ign_1"] = 
	$funùiÚ
(
·¿ms
)

1006 
nÙ
 
·¿ms
 
th’
  "numpow2" 
’d


1007 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1008 
loÿl
 
®ign
 = 
	$tÚumb”
(
·¿ms
[1])

1009 
®ign
 
th’


1010 
loÿl
 
x
 = 
®ign


1011 -- 
Mu¡
 
be
 
a
 
pow”
 
of
 2 
š
 
the
 
	`¿nge
 (2 ... 256).

1012 
i
=1,8 do

1013 
x
 = x / 2

1014 
x
 =ğ1 
th’


1015 
	`waùiÚ
("ALIGN", 
®ign
-1, 
n
, 1è-- 
AùiÚ
 
by‹
 
is
 2**
n
-1.

1017 
’d


1018 
’d


1019 
’d


1020 
	`w”rÜ
("bad‡lignment")

1021 
’d


1025 -- 
P£udo
-
İcode
 
´im™ive
è
ty³
 
	`defš™iÚs
 (
m­
 
to
 
C
 
ty³s
).

1026 
m­_İ
[".ty³_3"] = 
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

1027 
nÙ
 
·¿ms
 
th’


1028  
Å¬ams
 =ğ2 
ªd
 "Çme, cty³" 
Ü
 "name, ctype,„eg"

1029 
’d


1030 
loÿl
 
Çme
, 
ùy³
, 
»g
 = 
·¿ms
[1],…arams[2],…arams[3]

1031 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


1032 
	`w”rÜ
("bady³‚am`"..
Çme
.."'")

1033 
’d


1034 
loÿl
 

 = 
m­_ty³
[
Çme
]

1035 

 
th’


1036 
	`w”rÜ
("du¶iÿ‹y³ `"..
Çme
.."'")

1037 
’d


1038 -- 
Add
 #ty³ 
to
 
defšes
. 
A
 
b™
 
unş—n
Ø
put
 
™
 
š
 
m­_¬chdef
.

1039 
m­_¬chdef
["#"..
Çme
] = "sizeof("..
ùy³
..")"

1040 -- 
Add
 
Ãw
 
ty³
 
ªd
 
em™
 
shÜtcut
 
defše
.

1041 
loÿl
 
num
 = 
ùy³num
 + 1

1042 
m­_ty³
[
Çme
] = {

1043 
ùy³
 = ctype,

1044 
ùy³fmt
 = 
	`fÜm©
("Dt%X(%%s)", 
num
),

1045 
»g
 =„eg,

1046 
	}
}

1047 
wlše
(
fÜm©
("#defšDt%X(_Vè(št)ÕŒdiff_t)&(((% *)0)_V)", 
num
, 
ùy³
))

1048 
ùy³num
 = 
num


1049 
’d


1050 
m­_İ
[".type_2"] = map_op[".type_3"]

1052 -- 
Dump
 
ty³
 
defš™iÚs
.

1053 
loÿl
 
funùiÚ
 
	$dum±y³s
(
out
, 
lvl
)

1054 
loÿl
 
t
 = {
	}
}

1055 
Çme
 
š
 
	$·œs
(
m­_ty³
èdØ
t
[#t+1] = 
Çme
 
’d


1056 
	$sÜt
(
t
)

1057 
out
:
	`wr™e
("Type definitions:\n")

1058 
_
,
Çme
 
š
 
	$aœs
(
t
) do

1059 
loÿl
 

 = 
m­_ty³
[
Çme
]

1060 
loÿl
 
»g
 = 

.»g 
Ü
 ""

1061 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %-20 %s\n", 
Çme
, 

.
ùy³
, 
»g
))

1062 
’d


1063 
out
:
	`wr™e
("\n")

1064 
’d


1068 -- 
S‘
 
the
 
cu¼’t
 
£ùiÚ
.

1069 
funùiÚ
 
_M
.
	$£ùiÚ
(
num
)

1070 
	`waùiÚ
("SECTION", 
num
)

1071 
	`wæush
(
Œue
è-- 
SECTION
 
is
 
a
 
‹rmš®
 
aùiÚ
.

1072 
’d


1076 -- 
Dump
 
¬ch™eùu»
 
desütiÚ
.

1077 
funùiÚ
 
_M
.
	$dum·rch
(
out
)

1078 
out
:
	`wr™e
(
	`fÜm©
("DynASM %s version %s,„eleased %s\n\n",

1079 
_šfo
.
¬ch
, _šfo.
v”siÚ
, _šfo.
»Ëa£
))

1080 
	$dum·ùiÚs
(
out
)

1081 
’d


1083 -- 
Dump
 
®l
 
u£r
 
defšed
 
–em’ts
.

1084 
funùiÚ
 
_M
.
	$dumpdef
(
out
, 
lvl
)

1085 
	$dum±y³s
(
out
, 
lvl
)

1086 
	$dumpglob®s
(
out
, 
lvl
)

1087 
	$dum³x‹ºs
(
out
, 
lvl
)

1088 
’d


1092 -- 
Pass
 
ÿÎbacks
 
äom
/
to
 
the
 
DynASM
 
cÜe
.

1093 
funùiÚ
 
_M
.
	$·sscb
(
wl
, 
we
, 
wf
, 
ww
)

1094 
wlše
, 
w”rÜ
, 
wçl
, 
ww¬n
 = 
wl
, 
we
, 
wf
, 
ww


1095  
wæush


1096 
’d


1098 -- 
S‘up
 
the
 
¬ch
-
¥ecific
 
moduË
.

1099 
funùiÚ
 
_M
.
	$£tup
(
¬ch
, 
İt
)

1100 
g_¬ch
, 
g_İt
 = 
¬ch
, 
İt


1101 
’d


1103 -- 
M”ge
 
the
 
cÜe
 
m­s
 
ªd
h
¬ch
-
¥ecific
 maps.

1104 
funùiÚ
 
_M
.
	$m”gem­s
(
m­_cÜeİ
, 
m­_def
)

1105 
	`£tm‘©abË
(
m­_İ
, { 
__šdex
 = 
	`funùiÚ
(
t
, 
k
)

1106 
loÿl
 
v
 = 
m­_cÜeİ
[
k
]

1107 
v
 
th’
  v 
’d


1108 
loÿl
 
k1
, 
cc
, 
k2
 = 
	`m©ch
(
k
, "^(.-)(..)([._].*)$")

1109 
loÿl
 
cv
 = 
m­_cÚd
[
cc
]

1110 
cv
 
th’


1111 
loÿl
 
v
 = 
	`¿wg‘
(
t
, 
k1
..
k2
)

1112 
	`ty³
(
v
è=ğ"¡ršg" 
th’


1113 
loÿl
 
scv
 = 
	`fÜm©
("%x", 
cv
)

1114  
	`gsub
(
scv
..
	`sub
(
v
, 2), "|e", "|"..scv)

1115 
’d


1116 
’d


1117 
’d
 
	}
})

1118 
£tm‘©abË
(
m­_def
, { 
__šdex
 = 
m­_¬chdef
 })

1119  
m­_İ
, 
m­_def


1120 
’d


1122  
_M


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_arm64.lua

2 -- 
DynASM
 
ARM64
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
S“
 
	gdyÇsm
.
lua
 
fuÎ
 
cİyright
 
	gnÙiû
.

8 -- 
ModuË
 
	gšfÜm©iÚ
:

9 
loÿl
 
_šfo
 = {

10 
¬ch
 = "arm",

11 
	gdesütiÚ
 = "DynASM ARM64 module",

12 
	gv”siÚ
 = "1.4.0",

13 
	gv”num
 = 10400,

14 
	g»Ëa£
 = "2015-10-18",

15 
	gauthÜ
 = "Mike Pall",

16 
	gliûn£
 = "MIT",

19 -- 
ExpÜ‹d
 
glue
 
funùiÚs
 
the
 
	g¬ch
-
¥ecific
 
	gmoduË
.

20 
loÿl
 
	g_M
 = { 
_šfo
 = _info }

22 -- 
Cache
 
lib¿ry
 
	gfunùiÚs
.

23 
loÿl
 
	gty³
, 
	gtÚumb”
, 
	g·œs
, 
	gaœs
 = 
ty³
,Úumb”,…aœs, 
aœs


24 
loÿl
 
	gas£¹
, 
	g£tm‘©abË
, 
	g¿wg‘
 = 
as£¹
, s‘m‘©abË, 
¿wg‘


25 
loÿl
 
	g_s
 = 
¡ršg


26 
loÿl
 
sub
, 
	gfÜm©
, 
	gby‹
, ğ
_s
.sub, 
	g_s
.format, _s.byte, _s.

27 
loÿl
 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
_s
.
m©ch
, 
	g_s
.gm©ch, _s.
gsub


28 
loÿl
 
	gcÚÿt
, 
	gsÜt
, 
	gš£¹
 = 
bË
.
cÚÿt
, 
	gbË
.sÜt,abË.
š£¹


29 
loÿl
 
	gb™
 = 
b™
 
Ü
 
»quœe
("bit")

30 
loÿl
 
bªd
, 
	gshl
, 
	gshr
, 
	g§r
 = 
b™
.bªd, 
	gb™
.
	glshiá
, b™.
	grshiá
, b™.
¬shiá


31 
loÿl
 
	grÜ
, 
	gtohex
 = 
b™
.
rÜ
, 
	gb™
.tohex

33 -- 
Inh”™ed
 
bËs
 
ªd
 
	gÿÎbacks
.

34 
loÿl
 
	gg_İt
, 
g_¬ch


35 
loÿl
 
	gwlše
, 
	gw”rÜ
, 
	gwçl
, 
	gww¬n


37 -- 
AùiÚ
 
Çme
 
	gli¡
.

38 -- 
	gCHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

39 
loÿl
 
aùiÚ_Çmes
 = {

45 -- 
Maximum
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

46 -- 
CHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

47 
loÿl
 
max£ıos
 = 25 -- 
K“p
 
this
 
low
, 
to
 
avoid
 
exûssiv–y
 
C
 
	glšes
.

49 -- 
AùiÚ
 
	gÇme
 -> 
aùiÚ
 
	gnumb”
.

50 
loÿl
 
	gm­_aùiÚ
 = {}

51 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

52 
m­_aùiÚ
[
Çme
] = 
n
-1

53 
’d


55 -- 
AùiÚ
 
li¡
 
bufãr
.

56 
loÿl
 
aùli¡
 = {
	}
}

58 -- 
Argum’t
 
li¡
 
Ãxt
 
dasm_put
(). 
S¹
 
w™h
 
off£t
 0 
što
 
aùiÚ
†ist.

59 
loÿl
 
aù¬gs
 = { 0 }

61 -- 
Cu¼’t
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

62 
loÿl
 
£ıos
 = 1

66 -- 
Dump
 
aùiÚ
 
Çmes
 
ªd
 
numb”s
.

67 
loÿl
 
funùiÚ
 
	$dum·ùiÚs
(
out
)

68 
out
:
	`wr™e
("DynASMƒncodingƒngine‡ction codes:\n")

69 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

70 
loÿl
 
num
 = 
m­_aùiÚ
[
Çme
]

71 
out
:
	`wr™e
(
	`fÜm©
(" %-10 %02X %d\n", 
Çme
, 
num
,‚um))

72 
’d


73 
out
:
	`wr™e
("\n")

74 
’d


76 -- 
Wr™e
 
aùiÚ
 
li¡
 
bufãr
 
as
 
a
 
huge
 
C
 
¬¿y
.

77 
loÿl
 
funùiÚ
 
	$wr™—ùiÚs
(
out
, 
Çme
)

78 
loÿl
 
Â
 = #actlist

79 
Â
 =ğ0 
th’
‚Àğ1; 
aùli¡
[0] = 
m­_aùiÚ
.
STOP
 
’d


80 
out
:
	`wr™e
("¡©iøcÚ¡ unsigÃd iÁ ", 
Çme
, "[", 
Â
, "] = {\n")

81 
i
 = 1,
Â
-1 do

82 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
i
]), ",\n"))

83 
’d


84 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
Â
]), "\n};\n\n"))

85 
’d


89 -- 
Add
 
wÜd
 
to
 
aùiÚ
 
li¡
.

90 
loÿl
 
funùiÚ
 
	$wputxw
(
n
)

91 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

92 
aùli¡
[#aùli¡+1] = 
n


93 
’d


95 -- 
Add
 
aùiÚ
 
to
 
li¡
 
w™h
 
İtiÚ®
 
¬g
. 
Advªû
 
bufãr
 
pos
, 
too
.

96 
loÿl
 
funùiÚ
 
	$waùiÚ
(
aùiÚ
, 
v®
, 
a
, 
num
)

97 
loÿl
 
w
 = 
	`as£¹
(
m­_aùiÚ
[
aùiÚ
], "bad‡ction‚ame `"..action.."'")

98 
	`wputxw
(
w
 * 0x10000 + (
v®
 
Ü
 0))

99 
a
 
th’
 
aù¬gs
[#aù¬gs+1] =‡ 
’d


100 
a
 
Ü
 
num
 
th’
 
£ıos
 = seıo + (num o¸1è
’d


101 
’d


103 -- 
Flush
 
aùiÚ
 
	`li¡
 (
š‹rv’šg
 
C
 
code
 
Ü
 
bufãr
 
pos
 
ov”æow
).

104 
loÿl
 
funùiÚ
 
	$wæush
(
‹rm
)

105 #aùli¡ =ğ
aù¬gs
[1] 
th’
  
’d
 -- 
NÙhšg
 
to
 
æush
.

106 
nÙ
 
‹rm
 
th’
 
	`waùiÚ
("STOP"è
’d
 -- 
T”mš©e
 
aùiÚ
 
li¡
.

107 
	`wlše
(
	`fÜm©
("dasm_put(D¡, %s);", 
	`cÚÿt
(
aù¬gs
, ", ")), 
Œue
)

108 
aù¬gs
 = { #aùli¡ 
	}
} -- 
AùiÚli¡
 
off£t
 
is
 1
¡
 
¬g
 
to
 
Ãxt
 
dasm_put
().

109 
£ıos
 = 1 -- 
The
 
aùiÚli¡
 
off£t
 
occup›s
 
a
 
bufãr
 
pos™iÚ
, 
	gtoo
.

110 
	g’d


112 -- 
Put
 
esÿ³d
 
	gwÜd
.

113 
loÿl
 
funùiÚ
 
	$wputw
(
n
)

114 
n
 <ğ0x000ffffà
th’
 
	`waùiÚ
("ESC"è
’d


115 
	$wputxw
(
n
)

116 
’d


118 -- 
Re£rve
 
pos™iÚ
 
wÜd
.

119 
loÿl
 
funùiÚ
 
	$wpos
()

120 
loÿl
 
pos
 = #actlist+1

121 
aùli¡
[
pos
] = ""

122  
pos


123 
’d


125 -- 
StÜe
 
wÜd
 
to
 
»£rved
 
pos™iÚ
.

126 
loÿl
 
funùiÚ
 
	$wpuos
(
pos
, 
n
)

127 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

128 
n
 <ğ0x000ffffà
th’


129 
	`š£¹
(
aùli¡
, 
pos
+1, 
n
)

130 
n
 = 
m­_aùiÚ
.
ESC
 * 0x10000

131 
’d


132 
aùli¡
[
pos
] = 
n


133 
’d


137 -- 
Glob®
 
Ïb–
 
Çme
 -> 
glob®
†ab– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

138 
loÿl
 
Ãxt_glob®
 = 20

139 
loÿl
 
m­_glob®
 = 
	`£tm‘©abË
({
	}
}, { 
	g__šdex
 = 
funùiÚ
(
t
, 
Çme
)

140 
nÙ
 
m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’
 
w”rÜ
("bad glob®†ab–"è
’d


141 
loÿl
 
	gn
 = 
Ãxt_glob®


142 
n
 > 2047 
th’
 
w”rÜ
("toØmªy glob®†ab–s"è
’d


143 
Ãxt_glob®
 = 
n
 + 1

144 
t
[
Çme
] = 
n


145  
n


146 
’d
})

148 -- 
Dump
 
glob®
 
	gÏb–s
.

149 
loÿl
 
funùiÚ
 
	$dumpglob®s
(
out
, 
lvl
)

150 
loÿl
 
t
 = {
	}
}

151 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


152 
out
:
	`wr™e
("Global†abels:\n")

153 
i
=20,
Ãxt_glob®
-1 do

154 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
t
[
i
]))

155 
’d


156 
out
:
	`wr™e
("\n")

157 
’d


159 -- 
Wr™e
 
glob®
 
Ïb–
 .

160 
loÿl
 
funùiÚ
 
	$wr™eglob®s
(
out
, 
´efix
)

161 
loÿl
 
t
 = {
	}
}

162 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


163 
out
:
	`wr™e
("enum {\n")

164 
i
=20,
Ãxt_glob®
-1 do

165 
out
:
	`wr™e
(" ", 
´efix
, 
t
[
i
], ",\n")

166 
’d


167 
out
:
	`wr™e
(" ", 
´efix
, "_MAX\n};\n")

168 
’d


170 -- 
Wr™e
 
glob®
 
Ïb–
 
Çmes
.

171 
loÿl
 
funùiÚ
 
	$wr™eglob®Çmes
(
out
, 
Çme
)

172 
loÿl
 
t
 = {
	}
}

173 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


174 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

175 
i
=20,
Ãxt_glob®
-1 do

176 
out
:
	`wr™e
(" \"", 
t
[
i
], "\",\n")

177 
’d


178 
out
:
	`wr™e
(" (const char *)0\n};\n")

179 
’d


183 -- 
Ex‹º
 
Ïb–
 
Çme
 -> Ïb– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

184 
loÿl
 
Ãxt_ex‹º
 = 0

185 
loÿl
 
m­_ex‹º_
 = {
	}
}

186 
loÿl
 
m­_ex‹º
 = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
Çme
)

187 -- 
No
 
»¡riùiÚs
 
Ú
 
the
 
Çme
 
now
.

188 
loÿl
 
n
 = 
Ãxt_ex‹º


189 
n
 > 2047 
th’
 
w”rÜ
("toØmªyƒx‹º†ab–s"è
’d


190 
Ãxt_ex‹º
 = 
n
 + 1

191 
t
[
Çme
] = 
n


192 
m­_ex‹º_
[
n
] = 
Çme


193  
n


194 
’d
})

196 -- 
Dump
 
Ïb–s
.

197 
loÿl
 
funùiÚ
 
	$dum³x‹ºs
(
out
, 
lvl
)

198 
out
:
	`wr™e
("Extern†abels:\n")

199 
i
=0,
Ãxt_ex‹º
-1 do

200 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
m­_ex‹º_
[
i
]))

201 
’d


202 
out
:
	`wr™e
("\n")

203 
’d


205 -- 
Wr™e
 
Ïb–
 
Çmes
.

206 
loÿl
 
funùiÚ
 
	$wr™“x‹ºÇmes
(
out
, 
Çme
)

207 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

208 
i
=0,
Ãxt_ex‹º
-1 do

209 
out
:
	`wr™e
(" \"", 
m­_ex‹º_
[
i
], "\",\n")

210 
’d


211 
out
:
	`wr™e
(" (const char *)0\n};\n")

212 
’d


216 -- 
Arch
-
¥ecific
 
m­s
.

218 -- 
Ext
. 
Çme
 -> .‚ame.

219 
loÿl
 
m­_¬chdef
 = { 
xzr
 = "@x31", 
wzr
 = "@w31", 
Ì
 = "x30", 
	}
}

221 -- 
IÁ
. 
Çme
 -> 
ext
.‚ame.

222 
loÿl
 
m­_»g_»v
 = { ["@x31"] = "xzr", ["@w31"] = "wzr", 
x30
 = "lr", }

224 
loÿl
 
m­_ty³
 = {} -- 
Ty³
 
Çme
 -> { 
ùy³
, 
»g
 }

225 
loÿl
 
ùy³num
 = 0 -- 
Ty³
 
numb”
 (
Dt
... 
maüos
).

227 -- 
Rev”£
 
defšes
 
»gi¡”s
.

228 
funùiÚ
 
_M
.
	$»vdef
(
s
)

229  
m­_»g_»v
[
s
] 
Ü
 s

230 
’d


232 
loÿl
 
m­_shiá
 = { 
l¦
 = 0, 
l¤
 = 1, 
a¤
 = 2, 
	}
}

234 
loÿl
 
m­_ex‹nd
 = {

235 
uxtb
 = 0, 
uxth
 = 1, 
uxtw
 = 2, 
uxtx
 = 3,

236 
sxtb
 = 4, 
sxth
 = 5, 
sxtw
 = 6, 
sxtx
 = 7,

239 
loÿl
 
m­_cÚd
 = {

240 
eq
 = 0, 
Ã
 = 1, 
cs
 = 2, 
cc
 = 3, 
mi
 = 4, 
¶
 = 5, 
vs
 = 6, 
vc
 = 7,

241 
hi
 = 8, 
ls
 = 9, 
ge
 = 10, 
É
 = 11, 
gt
 = 12, 
Ë
 = 13, 
®
 = 14,

242 
hs
 = 2, 
lo
 = 3,

247 
loÿl
 
·r£_»g_ty³


249 
loÿl
 
funùiÚ
 
	$·r£_»g
(
ex´
)

250 
nÙ
 
ex´
 
th’
 
	`w”rÜ
("ex³ùed„egi¡”‚ame"è
’d


251 
loÿl
 
Šame
, 
ov»g
 = 
	`m©ch
(
ex´
, "^([%w_]+):(@?%l%d+)$")

252 
loÿl
 

 = 
m­_ty³
[
Šame
 
Ü
 
ex´
]

253 

 
th’


254 
loÿl
 
»g
 = 
ov»g
 
Ü
 

.reg

255 
nÙ
 
»g
 
th’


256 
	`w”rÜ
("ty³ `"..(
Šame
 
Ü
 
ex´
).."'‚eeds‡„egister override")

257 
’d


258 
ex´
 = 
»g


259 
’d


260 
loÿl
 
ok31
, 
¹
, 
r
 = 
	`m©ch
(
ex´
, "^(@?)([xwqdshb])([123]?[0-9])$")

261 
r
 
th’


262 
r
 = 
	$tÚumb”
(
r
)

263 
r
 <ğ30 
	`Ü
 (¸=ğ31 
ªd
 
ok31
 ~ğ"" o¸(
¹
 ~ğ"w"‡nd„ˆ~ğ"x")è
th’


264 
nÙ
 
·r£_»g_ty³
 
th’


265 
·r£_»g_ty³
 = 
¹


266 
–£if
 
·r£_»g_ty³
 ~ğ
¹
 
th’


267 
	`w”rÜ
("register size mismatch")

268 
’d


269  
r
, 



270 
’d


271 
’d


272 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

273 
’d


275 
loÿl
 
funùiÚ
 
	$·r£_»g_ba£
(
ex´
)

276 
ex´
 =ğ"¥" 
th’
  0x3e0 
’d


277 
loÿl
 
ba£
, 

 = 
	$·r£_»g
(
ex´
)

278 
·r£_»g_ty³
 ~ğ"x" 
th’
 
	`w”rÜ
("bad„egi¡”y³"è
’d


279 
·r£_»g_ty³
 = 
çl£


280  
	`shl
(
ba£
, 5), 



281 
’d


283 
loÿl
 
·r£_ùx
 = {
	}
}

285 
loÿl
 
lßd’v
 = 
£tãnv
 
ªd
 
	$funùiÚ
(
s
)

286 
loÿl
 
code
 = 
	`lßd¡ršg
(
s
, "")

287 
code
 
th’
 
	$£tãnv
(
code
, 
·r£_ùx
è
’d


288  
code


289 
’d
 
Ü
 
	$funùiÚ
(
s
)

290  
	`lßd
(
s
, "", 
n
, 
·r£_ùx
)

291 
’d


293 -- 
Try
 
to
 
·r£
 
sim¶e
 
¬™hm‘ic
, 
too
, 
sšû
 
some
 
basic
 
İs
 
¬e
 
®Ÿ£s
.

294 
loÿl
 
funùiÚ
 
	$·r£_numb”
(
n
)

295 
loÿl
 
x
 = 
	$tÚumb”
(
n
)

296 
x
 
th’
  x 
’d


297 
loÿl
 
code
 = 
	`lßd’v
("»tuº "..
n
)

298 
code
 
th’


299 
loÿl
 
ok
, 
y
 = 
	$pÿÎ
(
code
)

300 
ok
 
th’
  
y
 
’d


301 
’d


302  
n


303 
’d


305 
loÿl
 
funùiÚ
 
	$·r£_imm
(
imm
, 
b™s
, 
shiá
, 
sÿË
, signed)

306 
imm
 = 
	`m©ch
(imm, "^#(.*)$")

307 
nÙ
 
imm
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ o³¿nd"è
’d


308 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

309 
n
 
th’


310 
loÿl
 
m
 = 
	$§r
(
n
, 
sÿË
)

311 
	`shl
(
m
, 
sÿË
è=ğ
n
 
th’


312 sigÃd 
th’


313 
loÿl
 
s
 = 
	`§r
(
m
, 
b™s
-1)

314 
s
 =ğ0 
th’
  
	$shl
(
m
, 
shiá
)

315 
–£if
 
s
 =ğ-1 
th’
  
	`shl
(
m
 + shl(1, 
b™s
), 
shiá
è
’d


317 
	`§r
(
m
, 
b™s
è=ğ0 
th’
  
	$shl
(
m
, 
shiá
è
’d


318 
’d


319 
’d


320 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

322 
	`waùiÚ
("IMM", (sigÃd 
ªd
 32768 
Ü
 0)+
sÿË
*1024+
b™s
*32+
shiá
, 
imm
)

324 
’d


325 
’d


327 
loÿl
 
funùiÚ
 
	$·r£_imm12
(
imm
)

328 
imm
 = 
	`m©ch
(imm, "^#(.*)$")

329 
nÙ
 
imm
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ o³¿nd"è
’d


330 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

331 
n
 
th’


332 
	`shr
(
n
, 12è=ğ0 
th’


333  
	$shl
(
n
, 10)

334 
–£if
 
	`bªd
(
n
, 0xff000fffè=ğ0 
th’


335  
	`shr
(
n
, 2) + 0x00400000

336 
’d


337 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

339 
	`waùiÚ
("IMM12", 0, 
imm
)

341 
’d


342 
’d


344 
loÿl
 
funùiÚ
 
	$·r£_imm13
(
imm
)

345 
imm
 = 
	`m©ch
(imm, "^#(.*)$")

346 
nÙ
 
imm
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ o³¿nd"è
’d


347 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

348 
loÿl
 
r64
 = 
·r£_»g_ty³
 == "x"

349 
n
 
ªd
‚ % 1 =ğ0‡nd‚ >ğ0‡nd‚ <ğ0xfffffffà
th’


350 
loÿl
 
šv
 = 
çl£


351 
	`bªd
(
n
, 1è=ğ1 
th’
‚ = 
b™
.
	`bnÙ
Ò); 
šv
 = 
Œue
 
’d


352 
loÿl
 
t
 = {
	}
}

353 
i
=1,32 dØ
	gt
[i] = 
bªd
(
n
, 1); 
	gn
 = 
	$shr
(
n
, 1è
’d


354 
loÿl
 
b
 = 
bË
.
	$cÚÿt
(
t
)

355 
b
 = b..(
r64
 
	`ªd
 (
šv
 
ªd
 "1" 
Ü
 "0"):
	$»p
(32è
Ü
 
b
)

356 
loÿl
 
p0
, 
p1
, 
p0a
, 
p1a
 = 
b
:
	`m©ch
("^(0+)(1+)(0*)(1*)")

357 
p0
 
th’


358 
loÿl
 
w
 = 
p1a
 =ğ"" 
	$ªd
 (
r64
 
ªd
 64 
Ü
 32) or #p1+#p0a

359 
	`bªd
(
w
, w-1è=ğ0 
ªd
 
b
 =ğb:
	$sub
(1, 
w
):
	`»p
(64/wè
th’


360 
loÿl
 
s
 = 
	`bªd
(-2*
w
, 0x3f) - 1

361 
w
 =ğ64 
th’
 
s
 = s + 0x1000 
’d


362 
šv
 
th’


363  
	`shl
(
w
-#p1-#p0, 16è+ shl(
s
+w-#p1, 10)

365  
	`shl
(
w
-#p0, 16è+ shl(
s
+#p1, 10)

366 
’d


367 
’d


368 
’d


369 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

370 
–£if
 
r64
 
th’


371 
	`waùiÚ
("IMM13X", 0, 
	`fÜm©
("(unsigÃd iÁ)(%s)", 
imm
))

372 
aù¬gs
[#aù¬gs+1] = 
	`fÜm©
("(unsigÃd iÁ)((unsigÃd†Úg†Úg)(%s)>>32)", 
imm
)

375 
	`waùiÚ
("IMM13W", 0, 
imm
)

377 
’d


378 
’d


380 
loÿl
 
funùiÚ
 
	$·r£_imm6
(
imm
)

381 
imm
 = 
	`m©ch
(imm, "^#(.*)$")

382 
nÙ
 
imm
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ o³¿nd"è
’d


383 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

384 
n
 
th’


385 
n
 >ğ0 
ªd
‚ <ğ63 
th’


386  
	`shl
(
	`bªd
(
n
, 0x1f), 19è+ (À>ğ32 
ªd
 0x80000000 
Ü
 0)

387 
’d


388 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

390 
	`waùiÚ
("IMM6", 0, 
imm
)

392 
’d


393 
’d


395 
loÿl
 
funùiÚ
 
	$·r£_imm_lßd
(
imm
, 
sÿË
)

396 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

397 
n
 
th’


398 
loÿl
 
m
 = 
	$§r
(
n
, 
sÿË
)

399 
	`shl
(
m
, 
sÿË
è=ğ
n
 
ªd
 m >ğ0‡nd m < 0x1000 
th’


400  
	`shl
(
m
, 10è+ 0x01000000 -- 
SÿËd
, 12 
b™
 
off£t
.

401 
–£if
 
n
 >ğ-256 
ªd
‚ < 256 
th’


402  
	`shl
(
	`bªd
(
n
, 511), 12è-- 
UnsÿËd
, sigÃd 9 
b™
 
off£t
.

403 
’d


404 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

406 
	`waùiÚ
("IMML", 0, 
imm
)

408 
’d


409 
’d


411 
loÿl
 
funùiÚ
 
	$·r£_åimm
(
imm
)

412 
imm
 = 
	`m©ch
(imm, "^#(.*)$")

413 
nÙ
 
imm
 
th’
 
	`w”rÜ
("ex³ùed immedŸ‹ o³¿nd"è
’d


414 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

415 
n
 
th’


416 
loÿl
 
m
, 
e
 = 
m©h
.
	$äexp
(
n
)

417 
loÿl
 
s
, 
e2
 = 0, 
	`bªd
(
e
-2, 7)

418 
m
 < 0 
th’
 m = -m; 
s
 = 0x00100000 
’d


419 
m
 = m*32-16

420 
m
 % 1 =ğ0 
ªd
 m >ğ0‡nd m <ğ15‡nd 
	`§r
(
	`shl
(
e2
, 29), 29)+2 =ğ
e
 
th’


421  
s
 + 
	`shl
(
e2
, 17è+ 
	$shl
(
m
, 13)

422 
’d


423 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

425 
	`w”rÜ
("NYI fpimm‡ction")

426 
’d


427 
’d


429 
loÿl
 
funùiÚ
 
	$·r£_shiá
(
ex´
)

430 
loÿl
 
s
, 
s2
 = 
	`m©ch
(
ex´
, "^(%S+)%s*(.*)$")

431 
s
 = 
m­_shiá
[s]

432 
nÙ
 
s
 
th’
 
	`w”rÜ
("ex³ùed shiá o³¿nd"è
’d


433  
	`·r£_imm
(
s2
, 6, 10, 0, 
çl£
è+ 
	$shl
(
s
, 22)

434 
’d


436 
loÿl
 
funùiÚ
 
	$·r£_l¦x16
(
ex´
)

437 
loÿl
 
n
 = 
	`m©ch
(
ex´
, "^lsl%s*#(%d+)$")

438 
n
 = 
	$tÚumb”
(
n
)

439 
nÙ
 
n
 
th’
 
	`w”rÜ
("ex³ùed shiá o³¿nd"è
’d


440 
	`bªd
(
n
, 
·r£_»g_ty³
 =ğ"x" 
ªd
 0xffffffcà
Ü
 0xfffffãfè~ğ0 
th’


441 
	`w”rÜ
("bad shift‡mount")

442 
’d


443  
	$shl
(
n
, 17)

444 
’d


446 
loÿl
 
funùiÚ
 
	$·r£_ex‹nd
(
ex´
)

447 
loÿl
 
s
, 
s2
 = 
	`m©ch
(
ex´
, "^(%S+)%s*(.*)$")

448 
s
 =ğ"l¦" 
th’


449 
s
 = 
·r£_»g_ty³
 =ğ"x" 
ªd
 3 
Ü
 2

451 
s
 = 
m­_ex‹nd
[s]

452 
’d


453 
nÙ
 
s
 
th’
 
	`w”rÜ
("ex³ùedƒx‹nd o³¿nd"è
’d


454  (
s2
 =ğ"" 
ªd
 0 
Ü
 
	`·r£_imm
(s2, 3, 10, 0, 
çl£
)è+ 
	$shl
(
s
, 13)

455 
’d


457 
loÿl
 
funùiÚ
 
	$·r£_cÚd
(
ex´
, 
šv
)

458 
loÿl
 
c
 = 
m­_cÚd
[
ex´
]

459 
nÙ
 
c
 
th’
 
	`w”rÜ
("ex³ùed cÚd™iÚ o³¿nd"è
’d


460  
	`shl
(
b™
.
	`bxÜ
(
c
, 
šv
), 12)

461 
’d


463 
loÿl
 
funùiÚ
 
	$·r£_lßd
(
·¿ms
, 
Å¬ams
, 
n
, 
İ
)

464 
·¿ms
[
n
+2] 
th’
 
	`w”rÜ
("toØmªy o³¿nds"è
’d


465 
loÿl
 
²
, 
p2
 = 
·¿ms
[
n
],…arams[n+1]

466 
loÿl
 
p1
, 
wb
 = 
	`m©ch
(
²
, "^%[%s*(.-)%s*%](!?)$")

467 
nÙ
 
p1
 
th’


468 
nÙ
 
p2
 
th’


469 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
²
, "^([%w_:]+)%s*(.*)$")

470 
»g
 
ªd
 
r
 ~ğ"" 
th’


471 
loÿl
 
ba£
, 

 = 
	$·r£_»g_ba£
(
»g
)

472 

 
th’


473 
	`waùiÚ
("IMML", 0, 
	$fÜm©
(

.
ùy³fmt
, 
r
))

474  
İ
 + 
ba£


475 
’d


476 
’d


477 
’d


478 
	`w”rÜ
("expected‡ddress operand")

479 
’d


480 
loÿl
 
sÿË
 = 
	$shr
(
İ
, 30)

481 
p2
 
th’


482 
wb
 =ğ"!" 
th’
 
	`w”rÜ
("bad u£ oà'!'"è
’d


483 
İ
 = o°+ 
	`·r£_»g_ba£
(
p1
è+ 
	`·r£_imm
(
p2
, 9, 12, 0, 
Œue
) + 0x400

484 
–£if
 
wb
 =ğ"!" 
th’


485 
loÿl
 
p1a
, 
p2a
 = 
	`m©ch
(
p1
, "^([^,%s]*)%s*,%s*(.*)$")

486 
nÙ
 
p1a
 
th’
 
	`w”rÜ
("bad u£ oà'!'"è
’d


487 
İ
 = o°+ 
	`·r£_»g_ba£
(
p1a
è+ 
	`·r£_imm
(
p2a
, 9, 12, 0, 
Œue
) + 0xc00

489 
loÿl
 
p1a
, 
p2a
 = 
	`m©ch
(
p1
, "^([^,%s]*)%s*(.*)$")

490 
İ
 = o°+ 
	$·r£_»g_ba£
(
p1a
)

491 
p2a
 ~ğ"" 
th’


492 
loÿl
 
imm
 = 
	`m©ch
(
p2a
, "^,%s*#(.*)$")

493 
imm
 
th’


494 
İ
 = o°+ 
	$·r£_imm_lßd
(
imm
, 
sÿË
)

496 
loÿl
 
p2b
, 
p3b
, 
p3s
 = 
	`m©ch
(
p2a
, "^,%s*([^,%s]*)%s*,?%s*(%S*)%s*(.*)$")

497 
İ
 = o°+ 
	`shl
(
	`·r£_»g
(
p2b
), 16) + 0x00200800

498 
·r£_»g_ty³
 ~ğ"x" 
ªd
…¬£_»g_ty³ ~ğ"w" 
th’


499 
	`w”rÜ
("bad index„egisterype")

500 
’d


501 
p3b
 =ğ"" 
th’


502 
·r£_»g_ty³
 ~ğ"x" 
th’
 
	`w”rÜ
("bad index„egi¡”y³"è
’d


503 
İ
 = op + 0x6000

505 
p3s
 =ğ"" 
Ü
…3 =ğ"#0" 
th’


506 
–£if
 
p3s
 =ğ"#"..
sÿË
 
th’


507 
İ
 = op + 0x1000

509 
	`w”rÜ
("bad scale")

510 
’d


511 
·r£_»g_ty³
 =ğ"x" 
th’


512 
p3b
 =ğ"l¦" 
ªd
 
p3s
 ~ğ"" 
th’
 
İ
 = op + 0x6000

513 
–£if
 
p3b
 =ğ"sxtx" 
th’
 
İ
 = op + 0xe000

515 
	`w”rÜ
("badƒxtend/shift specifier")

516 
’d


518 
p3b
 =ğ"uxtw" 
th’
 
İ
 = op + 0x4000

519 
–£if
 
p3b
 =ğ"sxtw" 
th’
 
İ
 = op + 0xc000

521 
	`w”rÜ
("badƒxtend/shift specifier")

522 
’d


523 
’d


524 
’d


525 
’d


527 
wb
 =ğ"!" 
th’
 
	`w”rÜ
("bad u£ oà'!'"è
’d


528 
İ
 = op + 0x01000000

529 
’d


530 
’d


531  
İ


532 
’d


534 
loÿl
 
funùiÚ
 
	$·r£_lßd_·œ
(
·¿ms
, 
Å¬ams
, 
n
, 
İ
)

535 
·¿ms
[
n
+2] 
th’
 
	`w”rÜ
("toØmªy o³¿nds"è
’d


536 
loÿl
 
²
, 
p2
 = 
·¿ms
[
n
],…arams[n+1]

537 
loÿl
 
sÿË
 = 
	`shr
(
İ
, 30è=ğ0 
ªd
 2 
Ü
 3

538 
loÿl
 
p1
, 
wb
 = 
	`m©ch
(
²
, "^%[%s*(.-)%s*%](!?)$")

539 
nÙ
 
p1
 
th’


540 
nÙ
 
p2
 
th’


541 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
²
, "^([%w_:]+)%s*(.*)$")

542 
»g
 
ªd
 
r
 ~ğ"" 
th’


543 
loÿl
 
ba£
, 

 = 
	$·r£_»g_ba£
(
»g
)

544 

 
th’


545 
	`waùiÚ
("IMM", 32768+7*32+15+
sÿË
*1024, 
	$fÜm©
(

.
ùy³fmt
, 
r
))

546  
İ
 + 
ba£
 + 0x01000000

547 
’d


548 
’d


549 
’d


550 
	`w”rÜ
("expected‡ddress operand")

551 
’d


552 
p2
 
th’


553 
wb
 =ğ"!" 
th’
 
	`w”rÜ
("bad u£ oà'!'"è
’d


554 
İ
 = op + 0x00800000

556 
loÿl
 
p1a
, 
p2a
 = 
	`m©ch
(
p1
, "^([^,%s]*)%s*,%s*(.*)$")

557 
p1a
 
th’
 
p1
, 
p2
 =…1a, 
p2a
 p2 = "#0" 
’d


558 
İ
 = o°+ (
wb
 =ğ"!" 
ªd
 0x01800000 
Ü
 0x01000000)

559 
’d


560  
İ
 + 
	`·r£_»g_ba£
(
p1
è+ 
	$·r£_imm
(
p2
, 7, 15, 
sÿË
, 
Œue
)

561 
’d


563 
loÿl
 
funùiÚ
 
	$·r£_Ïb–
(
Ïb–
, 
def
)

564 
loÿl
 
´efix
 = 
	`sub
(
Ïb–
, 1, 2)

565 -- =>
	$Ïb–
 (
pc
 
Ïb–
 
»ã»nû
)

566 
´efix
 =ğ"=>" 
th’


567  "PC", 0, 
	$sub
(
Ïb–
, 3)

568 
’d


569 -- ->
	$Çme
 (
glob®
 
Ïb–
 
»ã»nû
)

570 
´efix
 =ğ"->" 
th’


571  "LG", 
m­_glob®
[
	`sub
(
Ïb–
, 3)]

572 
’d


573 
def
 
th’


574 -- [1-9] (
loÿl
 
Ïb–
 
defš™iÚ
)

575 
	`m©ch
(
Ïb–
, "^[1-9]$"è
th’


576  "LG", 10+
	$tÚumb”
(
Ïb–
)

577 
’d


579 -- [<>][1-9] (
loÿl
 
Ïb–
 
»ã»nû
)

580 
loÿl
 
dœ
, 
Êum
 = 
	`m©ch
(
Ïb–
, "^([<>])([1-9])$")

581 
dœ
 
th’
 -- 
Fwd
: 1-9, 
Bkwd
: 11-19.

582  "LG", 
Êum
 + (
dœ
 =ğ">" 
ªd
 0 
Ü
 10)

583 
’d


584 -- 
	$Ïb–
 (
Ïb–
 
»ã»nû
)

585 
loÿl
 
exŠame
 = 
	`m©ch
(
Ïb–
, "^extern%s+(%S+)$")

586 
exŠame
 
th’


587  "EXT", 
m­_ex‹º
[
exŠame
]

588 
’d


589 
’d


590 
	`w”rÜ
("bad†ab– `"..
Ïb–
.."'")

591 
’d


593 
loÿl
 
funùiÚ
 
	$b¿nch_ty³
(
İ
)

594 
	`bªd
(
İ
, 0x7c000000è=ğ0x14000000 
th’
  0 -- 
B
, 
BL


595 
–£if
 
	`shr
(
İ
, 24è=ğ0x54 
Ü
 
	`bªd
(op, 0x7e000000) == 0x34000000 or

596 
	`bªd
(
İ
, 0x3b000000è=ğ0x18000000 
th’


597  0x800 -- 
B
.
cÚd
, 
CBZ
, 
CBNZ
, 
LDR
* 
l™”®


598 
–£if
 
	`bªd
(
İ
, 0x7e000000è=ğ0x36000000 
th’
  0x1000 -- 
TBZ
, 
TBNZ


599 
–£if
 
	`bªd
(
İ
, 0x9f000000è=ğ0x10000000 
th’
  0x2000 -- 
ADR


600 
–£if
 
	`bªd
(
İ
, 0x9f000000è=ğ
	$bªd
(0x90000000è
th’
  0x3000 -- 
ADRP


602 
	`as£¹
(
çl£
, "unknown branchype")

603 
’d


604 
’d


608 
loÿl
 
m­_İ
, 
İ_‹m¶©e


610 
loÿl
 
funùiÚ
 
	$İ_®Ÿs
(
İÇme
, 
f
)

611  
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

612 
nÙ
 
·¿ms
 
th’
  "-> "..
İÇme
:
	`sub
(1, -3è
’d


613 
	$f
(
·¿ms
, 
Å¬ams
)

614 
	$İ_‹m¶©e
(
·¿ms
, 
m­_İ
[
İÇme
], 
Å¬ams
)

615 
’d


616 
’d


618 
loÿl
 
funùiÚ
 
	$®Ÿs_bfx
(
p
)

619 
p
[4] = "#("..p[3]:
	`sub
(2)..")+("..p[4]:sub(2)..")-1"

620 
’d


622 
loÿl
 
funùiÚ
 
	$®Ÿs_bfiz
(
p
)

623 
	$·r£_»g
(
p
[1])

624 
·r£_»g_ty³
 =ğ"w" 
th’


625 
p
[3] = "#-("..p[3]:
	`sub
(2)..")%32"

626 
p
[4] = "#("..p[4]:
	`sub
(2)..")-1"

628 
p
[3] = "#-("..p[3]:
	`sub
(2)..")%64"

629 
p
[4] = "#("..p[4]:
	`sub
(2)..")-1"

630 
’d


631 
’d


633 
loÿl
 
®Ÿs_l¦imm
 = 
	`İ_®Ÿs
("ubfm_4", 
	$funùiÚ
(
p
)

634 
	$·r£_»g
(
p
[1])

635 
loÿl
 
sh
 = 
p
[3]:
	$sub
(2)

636 
·r£_»g_ty³
 =ğ"w" 
th’


637 
p
[3] = "#-("..
sh
..")%32"

638 
p
[4] = "#31-("..
sh
..")"

640 
p
[3] = "#-("..
sh
..")%64"

641 
p
[4] = "#63-("..
sh
..")"

642 
’d


643 
’d
)

645 -- 
Tem¶©e
 
¡ršgs
 
ARM
 
š¡ruùiÚs
.

646 
m­_İ
 = {

647 -- 
Basic
 
d©a
 
´oûssšg
 
š¡ruùiÚs
.

648 
add_3
 = "0b000000DNMg|11000000pDpNIg|8b206000pDpNMx",

649 
add_4
 = "0b000000DNMSg|0b200000DNMXg|8b200000pDpNMXx|8b200000pDpNxMwX",

650 
adds_3
 = "2b000000DNMg|31000000DpNIg|ab206000DpNMx",

651 
adds_4
 = "2b000000DNMSg|2b200000DNMXg|ab200000DpNMXx|ab200000DpNxMwX",

652 
cmn_2
 = "2b00001fNMg|3100001fpNIg|ab20601fpNMx",

653 
cmn_3
 = "2b00001fNMSg|2b20001fNMXg|ab20001fpNMXx|ab20001fpNxMwX",

655 
sub_3
 = "4b000000DNMg|51000000pDpNIg|cb206000pDpNMx",

656 
sub_4
 = "4b000000DNMSg|4b200000DNMXg|cb200000pDpNMXx|cb200000pDpNxMwX",

657 
subs_3
 = "6b000000DNMg|71000000DpNIg|eb206000DpNMx",

658 
subs_4
 = "6b000000DNMSg|6b200000DNMXg|eb200000DpNMXx|eb200000DpNxMwX",

659 
cmp_2
 = "6b00001fNMg|7100001fpNIg|eb20601fpNMx",

660 
cmp_3
 = "6b00001fNMSg|6b20001fNMXg|eb20001fpNMXx|eb20001fpNxMwX",

662 
Ãg_2
 = "4b0003e0DMg",

663 
Ãg_3
 = "4b0003e0DMSg",

664 
Ãgs_2
 = "6b0003e0DMg",

665 
Ãgs_3
 = "6b0003e0DMSg",

667 
adc_3
 = "1a000000DNMg",

668 
adcs_3
 = "3a000000DNMg",

669 
sbc_3
 = "5a000000DNMg",

670 
sbcs_3
 = "7a000000DNMg",

671 
ngc_2
 = "5a0003e0DMg",

672 
ngcs_2
 = "7a0003e0DMg",

674 
ªd_3
 = "0a000000DNMg|12000000pDNig",

675 
ªd_4
 = "0a000000DNMSg",

676 
Ür_3
 = "2a000000DNMg|32000000pDNig",

677 
Ür_4
 = "2a000000DNMSg",

678 
eÜ_3
 = "4a000000DNMg|52000000pDNig",

679 
eÜ_4
 = "4a000000DNMSg",

680 
ªds_3
 = "6a000000DNMg|72000000DNig",

681 
ªds_4
 = "6a000000DNMSg",

682 
t¡_2
 = "6a00001fNMg|7200001fNig",

683 
t¡_3
 = "6a00001fNMSg",

685 
bic_3
 = "0a200000DNMg",

686 
bic_4
 = "0a200000DNMSg",

687 
Ün_3
 = "2a200000DNMg",

688 
Ün_4
 = "2a200000DNMSg",

689 
eÚ_3
 = "4a200000DNMg",

690 
eÚ_4
 = "4a200000DNMSg",

691 
bics_3
 = "6a200000DNMg",

692 
bics_4
 = "6a200000DNMSg",

694 
movn_2
 = "12800000DWg",

695 
movn_3
 = "12800000DWRg",

696 
movz_2
 = "52800000DWg",

697 
movz_3
 = "52800000DWRg",

698 
movk_2
 = "72800000DWg",

699 
movk_3
 = "72800000DWRg",

701 -- 
TODO
: 
this
 
dÛ¢
't cover‡ll valid immediates for mov„eg, #imm.

702 
mov_2
 = "2a0003e0DMg|52800000DW|320003e0pDig|11000000pDpNg",

703 
mov_3
 = "2a0003e0DMSg",

704 
mvn_2
 = "2a2003e0DMg",

705 
mvn_3
 = "2a2003e0DMSg",

707 
adr_2
 = "10000000DBx",

708 
ad½_2
 = "90000000DBx",

710 
c£l_4
 = "1a800000DNMCg",

711 
csšc_4
 = "1a800400DNMCg",

712 
csšv_4
 = "5a800000DNMCg",

713 
c¢eg_4
 = "5a800400DNMCg",

714 
c£t_2
 = "1a9f07e0Dcg",

715 
c£tm_2
 = "5a9f03e0Dcg",

716 
cšc_3
 = "1a800400DNmcg",

717 
cšv_3
 = "5a800000DNmcg",

718 
úeg_3
 = "5a800400DNmcg",

720 
ccmn_4
 = "3a400000NMVCg|3a400800N5VCg",

721 
ccmp_4
 = "7a400000NMVCg|7a400800N5VCg",

723 
madd_4
 = "1b000000DNMAg",

724 
msub_4
 = "1b008000DNMAg",

725 
mul_3
 = "1b007c00DNMg",

726 
mÃg_3
 = "1b00fc00DNMg",

728 
smaddl_4
 = "9b200000DxNMwAx",

729 
smsubl_4
 = "9b208000DxNMwAx",

730 
smuÎ_3
 = "9b207c00DxNMw",

731 
smÃgl_3
 = "9b20fc00DxNMw",

732 
smulh_3
 = "9b407c00DNMx",

733 
umaddl_4
 = "9ba00000DxNMwAx",

734 
umsubl_4
 = "9ba08000DxNMwAx",

735 
umuÎ_3
 = "9ba07c00DxNMw",

736 
umÃgl_3
 = "9ba0fc00DxNMw",

737 
umulh_3
 = "9bc07c00DNMx",

739 
udiv_3
 = "1ac00800DNMg",

740 
sdiv_3
 = "1ac00c00DNMg",

742 -- 
B™
 
İ”©iÚs
.

743 
sbfm_4
 = "13000000DN12w|93400000DN12x",

744 
bfm_4
 = "33000000DN12w|b3400000DN12x",

745 
ubfm_4
 = "53000000DN12w|d3400000DN12x",

746 
exŒ_4
 = "13800000DNM2w|93c00000DNM2x",

748 
sxtb_2
 = "13001c00DNw|93401c00DNx",

749 
sxth_2
 = "13003c00DNw|93403c00DNx",

750 
sxtw_2
 = "93407c00DxNw",

751 
uxtb_2
 = "53001c00DNw",

752 
uxth_2
 = "53003c00DNw",

754 
sbfx_4
 = 
	`İ_®Ÿs
("sbfm_4", 
®Ÿs_bfx
),

755 
bfx_4
 = 
	`İ_®Ÿs
("bfm_4", 
®Ÿs_bfx
),

756 
ubfx_4
 = 
	`İ_®Ÿs
("ubfm_4", 
®Ÿs_bfx
),

757 
sbfiz_4
 = 
	`İ_®Ÿs
("sbfm_4", 
®Ÿs_bfiz
),

758 
bfi_4
 = 
	`İ_®Ÿs
("bfm_4", 
®Ÿs_bfiz
),

759 
ubfiz_4
 = 
	`İ_®Ÿs
("ubfm_4", 
®Ÿs_bfiz
),

761 
l¦_3
 = 
	`funùiÚ
(
·¿ms
, 
Å¬ams
)

762 
·¿ms
 
ªd
…¬ams[3]:
	`by‹
(è=ğ35 
th’


763  
	`®Ÿs_l¦imm
(
·¿ms
, 
Å¬ams
)

765  
	`İ_‹m¶©e
(
·¿ms
, "1ac02000DNMg", 
Å¬ams
)

766 
’d


767 
’d
,

768 
l¤_3
 = "1ac02400DNMg|53007c00DN1w|d340fc00DN1x",

769 
a¤_3
 = "1ac02800DNMg|13007c00DN1w|9340fc00DN1x",

770 
rÜ_3
 = "1ac02c00DNMg|13800000DNm2w|93c00000DNm2x",

772 
şz_2
 = "5ac01000DNg",

773 
şs_2
 = "5ac01400DNg",

774 
rb™_2
 = "5ac00000DNg",

775 
»v_2
 = "5ac00800DNw|dac00c00DNx",

776 
»v16_2
 = "5ac00400DNg",

777 
»v32_2
 = "dac00800DNx",

779 -- 
Lßds
 
ªd
 
¡Ües
.

789 -- 
NOTE
: 
ldur
 
‘c
. 
¬e
 
hªdËd
 
by
 
ldr
 
‘
 
®
.

795 -- 
B¿nches
.

796 
b_1
 = "14000000B",

797 
bl_1
 = "94000000B",

798 
bÌ_1
 = "d63f0000Nx",

799 
br_1
 = "d61f0000Nx",

800 
»t_0
 = "d65f03c0",

801 
»t_1
 = "d65f0000Nx",

802 -- 
b
.
cÚd
 
is
 
added
 
b–ow
.

803 
cbz_2
 = "34000000DBg",

804 
cbnz_2
 = "35000000DBg",

805 
tbz_3
 = "36000000DTBw|36000000DTBx",

806 
tbnz_3
 = "37000000DTBw|37000000DTBx",

808 -- 
MisûÎªeous
 
š¡ruùiÚs
.

809 -- 
TODO
: 
hÉ
, 
hvc
, 
smc
, 
svc
, 
”‘
, 
dıs
[123], 
d½s
, 
mrs
, 
m¤


810 -- 
TODO
: 
sys
, 
sy¦
, 
ic
, 
dc
, 
©
, 
bi


811 -- 
TODO
: 
hšt
, 
y›ld
, 
wã
, 
wfi
, 
£v
, 
£vl


812 -- 
TODO
: 
ş»x
, 
dsb
, 
dmb
, 
isb


813 
nİ_0
 = "d503201f",

814 
brk_0
 = "d4200000",

815 
brk_1
 = "d4200000W",

817 -- 
Flßtšg
 
pošt
 
š¡ruùiÚs
.

818 
fmov_2
 = "1e204000DNf|1e260000DwNs|1e270000DsNw|9e660000DxNd|9e670000DdNx|1e201000DFf",

819 
çbs_2
 = "1e20c000DNf",

820 
âeg_2
 = "1e214000DNf",

821 
fsq¹_2
 = "1e21c000DNf",

823 
fcvt_2
 = "1e22c000DdNs|1e624000DsNd",

825 -- 
TODO
: 
h®f
-
´ecisiÚ
 
ªd
 
fixed
-
pošt
 
cÚv”siÚs
.

826 
fcvs_2
 = "1e240000DwNs|9e240000DxNs|1e640000DwNd|9e640000DxNd",

827 
fcvu_2
 = "1e250000DwNs|9e250000DxNs|1e650000DwNd|9e650000DxNd",

828 
fcvtms_2
 = "1e300000DwNs|9e300000DxNs|1e700000DwNd|9e700000DxNd",

829 
fcvtmu_2
 = "1e310000DwNs|9e310000DxNs|1e710000DwNd|9e710000DxNd",

830 
fcvŠs_2
 = "1e200000DwNs|9e200000DxNs|1e600000DwNd|9e600000DxNd",

831 
fcvŠu_2
 = "1e210000DwNs|9e210000DxNs|1e610000DwNd|9e610000DxNd",

832 
fcvs_2
 = "1e280000DwNs|9e280000DxNs|1e680000DwNd|9e680000DxNd",

833 
fcvu_2
 = "1e290000DwNs|9e290000DxNs|1e690000DwNd|9e690000DxNd",

834 
fcvtzs_2
 = "1e380000DwNs|9e380000DxNs|1e780000DwNd|9e780000DxNd",

835 
fcvtzu_2
 = "1e390000DwNs|9e390000DxNs|1e790000DwNd|9e790000DxNd",

837 
scvtf_2
 = "1e220000DsNw|9e220000DsNx|1e620000DdNw|9e620000DdNx",

838 
ucvtf_2
 = "1e230000DsNw|9e230000DsNx|1e630000DdNw|9e630000DdNx",

840 
äšŠ_2
 = "1e244000DNf",

841 
äš_2
 = "1e24c000DNf",

842 
äštm_2
 = "1e254000DNf",

843 
äštz_2
 = "1e25c000DNf",

844 
äš_2
 = "1e264000DNf",

845 
äštx_2
 = "1e274000DNf",

846 
äšti_2
 = "1e27c000DNf",

848 
çdd_3
 = "1e202800DNMf",

849 
fsub_3
 = "1e203800DNMf",

850 
fmul_3
 = "1e200800DNMf",

851 
âmul_3
 = "1e208800DNMf",

852 
fdiv_3
 = "1e201800DNMf",

854 
fmadd_4
 = "1f000000DNMAf",

855 
fmsub_4
 = "1f008000DNMAf",

856 
âmadd_4
 = "1f200000DNMAf",

857 
âmsub_4
 = "1f208000DNMAf",

859 
fmax_3
 = "1e204800DNMf",

860 
fmaxnm_3
 = "1e206800DNMf",

861 
fmš_3
 = "1e205800DNMf",

862 
fmšnm_3
 = "1e207800DNMf",

864 
fcmp_2
 = "1e202000NMf|1e202008NZf",

865 
fcm³_2
 = "1e202010NMf|1e202018NZf",

867 
fccmp_4
 = "1e200400NMVCf",

868 
fccm³_4
 = "1e200410NMVCf",

870 
fc£l_4
 = "1e200c00DNMCf",

872 -- 
TODO
: 
üc32
*, 
«s
*, 
sha
*, 
pmuÎ


873 -- 
TODO
: 
SIMD
 
š¡ruùiÚs
.

874 
	}
}

876 
cÚd
,
c
 
š
 
	$·œs
(
m­_cÚd
) do

877 
m­_İ
["b"..
cÚd
.."_1"] = 
	`tohex
(0x54000000+
c
).."B"

878 
’d


882 -- 
HªdË
 
İcodes
 
defšed
 
w™h
 
‹m¶©e
 
¡ršgs
.

883 
loÿl
 
funùiÚ
 
	$·r£_‹m¶©e
(
·¿ms
, 
‹m¶©e
, 
Å¬ams
, 
pos
)

884 
loÿl
 
İ
 = 
	`tÚumb”
(
	`sub
(
‹m¶©e
, 1, 8), 16)

885 
loÿl
 
n
 = 1

886 
loÿl
 
¹t
 = {
	}
}

888 
·r£_»g_ty³
 = 
çl£


890 -- 
Proûss
 
—ch
 
ch¬aù”
.

891 
p
 
š
 
gm©ch
(
sub
(
‹m¶©e
, 9), ".") do

892 
loÿl
 
q
 = 
·¿ms
[
n
]

893 
p
 =ğ"D" 
th’


894 
İ
 = o°+ 
·r£_»g
(
q
); 
	gn
 = 
n
 + 1

895 
–£if
 
p
 =ğ"N" 
th’


896 
İ
 = o°+ 
shl
(
·r£_»g
(
q
), 5); 
	gn
 = 
n
 + 1

897 
–£if
 
p
 =ğ"M" 
th’


898 
İ
 = o°+ 
shl
(
·r£_»g
(
q
), 16); 
	gn
 = 
n
 + 1

899 
–£if
 
p
 =ğ"A" 
th’


900 
İ
 = o°+ 
shl
(
·r£_»g
(
q
), 10); 
	gn
 = 
n
 + 1

901 
–£if
 
p
 =ğ"m" 
th’


902 
İ
 = o°+ 
shl
(
·r£_»g
(
·¿ms
[
n
-1]), 16)

904 
–£if
 
	gp
 =ğ"p" 
th’


905 
q
 =ğ"¥" 
th’
 
·¿ms
[
n
] = "@x31" 
’d


906 
–£if
 
p
 =ğ"g" 
th’


907 
·r£_»g_ty³
 =ğ"x" 
th’


908 
İ
 = op + 0x80000000

909 
–£if
 
·r£_»g_ty³
 ~ğ"w" 
th’


910 
w”rÜ
("bad„egisterype")

911 
’d


912 
·r£_»g_ty³
 = 
çl£


913 
–£if
 
p
 =ğ"f" 
th’


914 
·r£_»g_ty³
 =ğ"d" 
th’


915 
İ
 = op + 0x00400000

916 
–£if
 
·r£_»g_ty³
 ~ğ"s" 
th’


917 
w”rÜ
("bad„egisterype")

918 
’d


919 
·r£_»g_ty³
 = 
çl£


920 
–£if
 
p
 =ğ"x" 
Ü
… =ğ"w" o¸°=ğ"d" o¸°=ğ"s" 
th’


921 
·r£_»g_ty³
 ~ğ
p
 
th’


922 
w”rÜ
("register size mismatch")

923 
’d


924 
·r£_»g_ty³
 = 
çl£


926 
–£if
 
p
 =ğ"L" 
th’


927 
İ
 = 
	$·r£_lßd
(
·¿ms
, 
Å¬ams
, 
n
, 
İ
)

928 
–£if
 
p
 =ğ"P" 
th’


929 
İ
 = 
	$·r£_lßd_·œ
(
·¿ms
, 
Å¬ams
, 
n
, 
İ
)

931 
–£if
 
p
 =ğ"B" 
th’


932 
loÿl
 
mode
, 
v
, 
s
 = 
	`·r£_Ïb–
(
q
, 
çl£
); 
n
 =‚ + 1

933 
loÿl
 
m
 = 
	$b¿nch_ty³
(
İ
)

934 
	`waùiÚ
("REL_"..
mode
, 
v
+
m
, 
s
, 1)

936 
–£if
 
p
 =ğ"I" 
th’


937 
İ
 = o°+ 
	`·r£_imm12
(
q
); 
n
 =‚ + 1

938 
–£if
 
p
 =ğ"i" 
th’


939 
İ
 = o°+ 
	`·r£_imm13
(
q
); 
n
 =‚ + 1

940 
–£if
 
p
 =ğ"W" 
th’


941 
İ
 = o°+ 
	`·r£_imm
(
q
, 16, 5, 0, 
çl£
); 
n
 =‚ + 1

942 
–£if
 
p
 =ğ"T" 
th’


943 
İ
 = o°+ 
	`·r£_imm6
(
q
); 
n
 =‚ + 1

944 
–£if
 
p
 =ğ"1" 
th’


945 
İ
 = o°+ 
	`·r£_imm
(
q
, 6, 16, 0, 
çl£
); 
n
 =‚ + 1

946 
–£if
 
p
 =ğ"2" 
th’


947 
İ
 = o°+ 
	`·r£_imm
(
q
, 6, 10, 0, 
çl£
); 
n
 =‚ + 1

948 
–£if
 
p
 =ğ"5" 
th’


949 
İ
 = o°+ 
	`·r£_imm
(
q
, 5, 16, 0, 
çl£
); 
n
 =‚ + 1

950 
–£if
 
p
 =ğ"V" 
th’


951 
İ
 = o°+ 
	`·r£_imm
(
q
, 4, 0, 0, 
çl£
); 
n
 =‚ + 1

952 
–£if
 
p
 =ğ"F" 
th’


953 
İ
 = o°+ 
	`·r£_åimm
(
q
); 
n
 =‚ + 1

954 
–£if
 
p
 =ğ"Z" 
th’


955 
q
 ~ğ"#0" 
ªd
 q ~ğ"#0.0" 
th’
 
	`w”rÜ
("ex³ùed z”ØimmedŸ‹"è
’d


956 
n
 =‚ + 1

958 
–£if
 
p
 =ğ"S" 
th’


959 
İ
 = o°+ 
	`·r£_shiá
(
q
); 
n
 =‚ + 1

960 
–£if
 
p
 =ğ"X" 
th’


961 
İ
 = o°+ 
	`·r£_ex‹nd
(
q
); 
n
 =‚ + 1

962 
–£if
 
p
 =ğ"R" 
th’


963 
İ
 = o°+ 
	`·r£_l¦x16
(
q
); 
n
 =‚ + 1

964 
–£if
 
p
 =ğ"C" 
th’


965 
İ
 = o°+ 
	`·r£_cÚd
(
q
, 0); 
n
 =‚ + 1

966 
–£if
 
p
 =ğ"c" 
th’


967 
İ
 = o°+ 
	`·r£_cÚd
(
q
, 1); 
n
 =‚ + 1

970 
	$as£¹
(
çl£
)

971 
’d


972 
’d


973 
	$wpuos
(
pos
, 
İ
)

974 
’d


976 
funùiÚ
 
	$İ_‹m¶©e
(
·¿ms
, 
‹m¶©e
, 
Å¬ams
)

977 
nÙ
 
·¿ms
 
th’
  
‹m¶©e
:
	`gsub
("%x%x%x%x%x%x%x%x", ""è
’d


979 -- 
Lim™
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
u£d
 
by
 
a
 
sšgË
 
	`dasm_put
().

980 -- 
A
 
sšgË
 
İcode
 
Ãeds
 
a
 
maximum
 
of
 3 
pos™iÚs
.

981 
£ıos
+3 > 
max£ıos
 
th’
 
	$wæush
(è
’d


982 
loÿl
 
pos
 = 
	$wpos
()

983 
loÿl
 
Íos
, 
­os
, 
¥os
 = #aùli¡, #aù¬gs, 
£ıos


985 
loÿl
 
ok
, 
”r


986 
t
 
š
 
	`gm©ch
(
‹m¶©e
, "[^|]+") do

987 
ok
, 
”r
 = 
	$pÿÎ
(
·r£_‹m¶©e
, 
·¿ms
, 
t
, 
Å¬ams
, 
pos
)

988 
ok
 
th’
  
’d


989 
£ıos
 = 
¥os


990 
aùli¡
[
Íos
+1] = 
n


991 
aùli¡
[
Íos
+2] = 
n


992 
aùli¡
[
Íos
+3] = 
n


993 
aù¬gs
[
­os
+1] = 
n


994 
aù¬gs
[
­os
+2] = 
n


995 
aù¬gs
[
­os
+3] = 
n


996 
’d


997 
	$”rÜ
(
”r
, 0)

998 
’d


1000 
m­_İ
[".‹m¶©e__"] = 
İ_‹m¶©e


1004 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
aùiÚ
 
li¡
 
is
Ø
be
 
em™‹d
.

1005 
m­_İ
[".aùiÚli¡_1"] = 
	$funùiÚ
(
·¿ms
)

1006 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


1007 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1008 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™—ùiÚs
(
out
, 
Çme
è
’d
)

1009 
’d


1011 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
is
Ø
be
 
em™‹d
.

1012 
m­_İ
[".glob®s_1"] = 
	$funùiÚ
(
·¿ms
)

1013 
nÙ
 
·¿ms
 
th’
  "´efix" 
’d


1014 
loÿl
 
´efix
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1015 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®s
(
out
, 
´efix
è
’d
)

1016 
’d


1018 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
Çmes
 
¬e
Ø
be
 
em™‹d
.

1019 
m­_İ
[".glob®Çmes_1"] = 
	$funùiÚ
(
·¿ms
)

1020 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


1021 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1022 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®Çmes
(
out
, 
Çme
è
’d
)

1023 
’d


1025 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
Çmes
 
¬e
Ø
be
 
em™‹d
.

1026 
m­_İ
[".ex‹ºÇmes_1"] = 
	$funùiÚ
(
·¿ms
)

1027 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


1028 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1029 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™“x‹ºÇmes
(
out
, 
Çme
è
’d
)

1030 
’d


1034 -- 
Lab–
 
p£udo
-
	`İcode
 (
cÚv”‹d
 
äom
 
Œašg
 
cŞÚ
 
fÜm
).

1035 
m­_İ
[".Ïb–_1"] = 
	$funùiÚ
(
·¿ms
)

1036 
nÙ
 
·¿ms
 
th’
  "[1-9] | ->glob® | =>pûx´" 
’d


1037 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1038 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
·¿ms
[1], 
Œue
)

1039 
mode
 =ğ"EXT" 
th’
 
	`w”rÜ
("bad†ab– defš™iÚ"è
’d


1040 
	`waùiÚ
("LABEL_"..
mode
, 
n
, 
s
, 1)

1041 
’d


1045 -- 
P£udo
-
İcodes
 
d©a
 
¡Üage
.

1046 
m­_İ
[".lÚg_*"] = 
	$funùiÚ
(
·¿ms
)

1047 
nÙ
 
·¿ms
 
th’
  "imm..." 
’d


1048 
_
,
p
 
š
 
	$aœs
(
·¿ms
) do

1049 
loÿl
 
n
 = 
	$tÚumb”
(
p
)

1050 
nÙ
 
n
 
th’
 
	`w”rÜ
("bad immedŸ‹ `"..
p
.."'"è
’d


1051 
n
 < 0 
th’
‚ =‚ + 2^32 
’d


1052 
	$wputw
(
n
)

1053 
£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1054 
’d


1055 
’d


1057 -- 
Alignm’t
 
p£udo
-
İcode
.

1058 
m­_İ
[".®ign_1"] = 
	$funùiÚ
(
·¿ms
)

1059 
nÙ
 
·¿ms
 
th’
  "numpow2" 
’d


1060 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1061 
loÿl
 
®ign
 = 
	$tÚumb”
(
·¿ms
[1])

1062 
®ign
 
th’


1063 
loÿl
 
x
 = 
®ign


1064 -- 
Mu¡
 
be
 
a
 
pow”
 
of
 2 
š
 
the
 
	`¿nge
 (2 ... 256).

1065 
i
=1,8 do

1066 
x
 = x / 2

1067 
x
 =ğ1 
th’


1068 
	`waùiÚ
("ALIGN", 
®ign
-1, 
n
, 1è-- 
AùiÚ
 
by‹
 
is
 2**
n
-1.

1070 
’d


1071 
’d


1072 
’d


1073 
	`w”rÜ
("bad‡lignment")

1074 
’d


1078 -- 
P£udo
-
İcode
 
´im™ive
è
ty³
 
	`defš™iÚs
 (
m­
 
to
 
C
 
ty³s
).

1079 
m­_İ
[".ty³_3"] = 
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

1080 
nÙ
 
·¿ms
 
th’


1081  
Å¬ams
 =ğ2 
ªd
 "Çme, cty³" 
Ü
 "name, ctype,„eg"

1082 
’d


1083 
loÿl
 
Çme
, 
ùy³
, 
»g
 = 
·¿ms
[1],…arams[2],…arams[3]

1084 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


1085 
	`w”rÜ
("bady³‚am`"..
Çme
.."'")

1086 
’d


1087 
loÿl
 

 = 
m­_ty³
[
Çme
]

1088 

 
th’


1089 
	`w”rÜ
("du¶iÿ‹y³ `"..
Çme
.."'")

1090 
’d


1091 -- 
Add
 #ty³ 
to
 
defšes
. 
A
 
b™
 
unş—n
Ø
put
 
™
 
š
 
m­_¬chdef
.

1092 
m­_¬chdef
["#"..
Çme
] = "sizeof("..
ùy³
..")"

1093 -- 
Add
 
Ãw
 
ty³
 
ªd
 
em™
 
shÜtcut
 
defše
.

1094 
loÿl
 
num
 = 
ùy³num
 + 1

1095 
m­_ty³
[
Çme
] = {

1096 
ùy³
 = ctype,

1097 
ùy³fmt
 = 
	`fÜm©
("Dt%X(%%s)", 
num
),

1098 
»g
 =„eg,

1099 
	}
}

1100 
wlše
(
fÜm©
("#defšDt%X(_Vè(št)ÕŒdiff_t)&(((% *)0)_V)", 
num
, 
ùy³
))

1101 
ùy³num
 = 
num


1102 
’d


1103 
m­_İ
[".type_2"] = map_op[".type_3"]

1105 -- 
Dump
 
ty³
 
defš™iÚs
.

1106 
loÿl
 
funùiÚ
 
	$dum±y³s
(
out
, 
lvl
)

1107 
loÿl
 
t
 = {
	}
}

1108 
Çme
 
š
 
	$·œs
(
m­_ty³
èdØ
t
[#t+1] = 
Çme
 
’d


1109 
	$sÜt
(
t
)

1110 
out
:
	`wr™e
("Type definitions:\n")

1111 
_
,
Çme
 
š
 
	$aœs
(
t
) do

1112 
loÿl
 

 = 
m­_ty³
[
Çme
]

1113 
loÿl
 
»g
 = 

.»g 
Ü
 ""

1114 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %-20 %s\n", 
Çme
, 

.
ùy³
, 
»g
))

1115 
’d


1116 
out
:
	`wr™e
("\n")

1117 
’d


1121 -- 
S‘
 
the
 
cu¼’t
 
£ùiÚ
.

1122 
funùiÚ
 
_M
.
	$£ùiÚ
(
num
)

1123 
	`waùiÚ
("SECTION", 
num
)

1124 
	`wæush
(
Œue
è-- 
SECTION
 
is
 
a
 
‹rmš®
 
aùiÚ
.

1125 
’d


1129 -- 
Dump
 
¬ch™eùu»
 
desütiÚ
.

1130 
funùiÚ
 
_M
.
	$dum·rch
(
out
)

1131 
out
:
	`wr™e
(
	`fÜm©
("DynASM %s version %s,„eleased %s\n\n",

1132 
_šfo
.
¬ch
, _šfo.
v”siÚ
, _šfo.
»Ëa£
))

1133 
	$dum·ùiÚs
(
out
)

1134 
’d


1136 -- 
Dump
 
®l
 
u£r
 
defšed
 
–em’ts
.

1137 
funùiÚ
 
_M
.
	$dumpdef
(
out
, 
lvl
)

1138 
	$dum±y³s
(
out
, 
lvl
)

1139 
	$dumpglob®s
(
out
, 
lvl
)

1140 
	$dum³x‹ºs
(
out
, 
lvl
)

1141 
’d


1145 -- 
Pass
 
ÿÎbacks
 
äom
/
to
 
the
 
DynASM
 
cÜe
.

1146 
funùiÚ
 
_M
.
	$·sscb
(
wl
, 
we
, 
wf
, 
ww
)

1147 
wlše
, 
w”rÜ
, 
wçl
, 
ww¬n
 = 
wl
, 
we
, 
wf
, 
ww


1148  
wæush


1149 
’d


1151 -- 
S‘up
 
the
 
¬ch
-
¥ecific
 
moduË
.

1152 
funùiÚ
 
_M
.
	$£tup
(
¬ch
, 
İt
)

1153 
g_¬ch
, 
g_İt
 = 
¬ch
, 
İt


1154 
’d


1156 -- 
M”ge
 
the
 
cÜe
 
m­s
 
ªd
h
¬ch
-
¥ecific
 maps.

1157 
funùiÚ
 
_M
.
	$m”gem­s
(
m­_cÜeİ
, 
m­_def
)

1158 
	`£tm‘©abË
(
m­_İ
, { 
__šdex
 = 
m­_cÜeİ
 
	}
})

1159 
£tm‘©abË
(
m­_def
, { 
__šdex
 = 
m­_¬chdef
 })

1160  
m­_İ
, 
m­_def


1161 
’d


1163  
_M


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_mips.lua

2 -- 
DynASM
 
	gMIPS32
/
MIPS64
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
S“
 
	gdyÇsm
.
lua
 
fuÎ
 
cİyright
 
	gnÙiû
.

8 
loÿl
 
	gms64
 = 
ms64


10 -- 
ModuË
 
šfÜm©iÚ
:

11 
loÿl
 
_šfo
 = {

12 
¬ch
 = 
ms64
 
ªd
 "ms64" 
Ü
 "mips",

13 
	gdesütiÚ
 = "DynASM MIPS32/MIPS64 module",

14 
	gv”siÚ
 = "1.4.0",

15 
	gv”num
 = 10400,

16 
	g»Ëa£
 = "2016-05-24",

17 
	gauthÜ
 = "Mike Pall",

18 
	gliûn£
 = "MIT",

21 -- 
ExpÜ‹d
 
glue
 
funùiÚs
 
the
 
	g¬ch
-
¥ecific
 
	gmoduË
.

22 
loÿl
 
	g_M
 = { 
_šfo
 = _info }

24 -- 
Cache
 
lib¿ry
 
	gfunùiÚs
.

25 
loÿl
 
	gty³
, 
	gtÚumb”
, 
	g·œs
, 
	gaœs
 = 
ty³
,Úumb”,…aœs, 
aœs


26 
loÿl
 
	gas£¹
, 
	g£tm‘©abË
 = 
as£¹
, 
£tm‘©abË


27 
loÿl
 
	g_s
 = 
¡ršg


28 
loÿl
 
sub
, 
	gfÜm©
, 
	gby‹
, ğ
_s
.sub, 
	g_s
.format, _s.byte, _s.

29 
loÿl
 
	gm©ch
, 
	ggm©ch
 = 
_s
.
m©ch
, 
	g_s
.
gm©ch


30 
loÿl
 
	gcÚÿt
, 
	gsÜt
 = 
bË
.
cÚÿt
, 
	gbË
.
sÜt


31 
loÿl
 
	gb™
 = 
b™
 
Ü
 
»quœe
("bit")

32 
loÿl
 
bªd
, 
	gshl
, 
	gshr
, 
	g§r
 = 
b™
.bªd, 
	gb™
.
	glshiá
, b™.
	grshiá
, b™.
¬shiá


33 
loÿl
 
	gtohex
 = 
b™
.
tohex


35 -- 
Inh”™ed
 
bËs
 
ªd
 
ÿÎbacks
.

36 
loÿl
 
g_İt
, 
g_¬ch


37 
loÿl
 
	gwlše
, 
	gw”rÜ
, 
	gwçl
, 
	gww¬n


39 -- 
AùiÚ
 
Çme
 
	gli¡
.

40 -- 
	gCHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

41 
loÿl
 
aùiÚ_Çmes
 = {

47 -- 
Maximum
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

48 -- 
CHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

49 
loÿl
 
max£ıos
 = 25 -- 
K“p
 
this
 
low
, 
to
 
avoid
 
exûssiv–y
 
C
 
	glšes
.

51 -- 
AùiÚ
 
	gÇme
 -> 
aùiÚ
 
	gnumb”
.

52 
loÿl
 
	gm­_aùiÚ
 = {}

53 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

54 
m­_aùiÚ
[
Çme
] = 
n
-1

55 
’d


57 -- 
AùiÚ
 
li¡
 
bufãr
.

58 
loÿl
 
aùli¡
 = {
	}
}

60 -- 
Argum’t
 
li¡
 
Ãxt
 
dasm_put
(). 
S¹
 
w™h
 
off£t
 0 
što
 
aùiÚ
†ist.

61 
loÿl
 
aù¬gs
 = { 0 }

63 -- 
Cu¼’t
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

64 
loÿl
 
£ıos
 = 1

68 -- 
Dump
 
aùiÚ
 
Çmes
 
ªd
 
numb”s
.

69 
loÿl
 
funùiÚ
 
	$dum·ùiÚs
(
out
)

70 
out
:
	`wr™e
("DynASMƒncodingƒngine‡ction codes:\n")

71 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

72 
loÿl
 
num
 = 
m­_aùiÚ
[
Çme
]

73 
out
:
	`wr™e
(
	`fÜm©
(" %-10 %02X %d\n", 
Çme
, 
num
,‚um))

74 
’d


75 
out
:
	`wr™e
("\n")

76 
’d


78 -- 
Wr™e
 
aùiÚ
 
li¡
 
bufãr
 
as
 
a
 
huge
 
C
 
¬¿y
.

79 
loÿl
 
funùiÚ
 
	$wr™—ùiÚs
(
out
, 
Çme
)

80 
loÿl
 
Â
 = #actlist

81 
Â
 =ğ0 
th’
‚Àğ1; 
aùli¡
[0] = 
m­_aùiÚ
.
STOP
 
’d


82 
out
:
	`wr™e
("¡©iøcÚ¡ unsigÃd iÁ ", 
Çme
, "[", 
Â
, "] = {\n")

83 
i
 = 1,
Â
-1 do

84 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
i
]), ",\n"))

85 
’d


86 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
Â
]), "\n};\n\n"))

87 
’d


91 -- 
Add
 
wÜd
 
to
 
aùiÚ
 
li¡
.

92 
loÿl
 
funùiÚ
 
	$wputxw
(
n
)

93 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

94 
aùli¡
[#aùli¡+1] = 
n


95 
’d


97 -- 
Add
 
aùiÚ
 
to
 
li¡
 
w™h
 
İtiÚ®
 
¬g
. 
Advªû
 
bufãr
 
pos
, 
too
.

98 
loÿl
 
funùiÚ
 
	$waùiÚ
(
aùiÚ
, 
v®
, 
a
, 
num
)

99 
loÿl
 
w
 = 
	`as£¹
(
m­_aùiÚ
[
aùiÚ
], "bad‡ction‚ame `"..action.."'")

100 
	`wputxw
(0xff000000 + 
w
 * 0x10000 + (
v®
 
Ü
 0))

101 
a
 
th’
 
aù¬gs
[#aù¬gs+1] =‡ 
’d


102 
a
 
Ü
 
num
 
th’
 
£ıos
 = seıo + (num o¸1è
’d


103 
’d


105 -- 
Flush
 
aùiÚ
 
	`li¡
 (
š‹rv’šg
 
C
 
code
 
Ü
 
bufãr
 
pos
 
ov”æow
).

106 
loÿl
 
funùiÚ
 
	$wæush
(
‹rm
)

107 #aùli¡ =ğ
aù¬gs
[1] 
th’
  
’d
 -- 
NÙhšg
 
to
 
æush
.

108 
nÙ
 
‹rm
 
th’
 
	`waùiÚ
("STOP"è
’d
 -- 
T”mš©e
 
aùiÚ
 
li¡
.

109 
	`wlše
(
	`fÜm©
("dasm_put(D¡, %s);", 
	`cÚÿt
(
aù¬gs
, ", ")), 
Œue
)

110 
aù¬gs
 = { #aùli¡ 
	}
} -- 
AùiÚli¡
 
off£t
 
is
 1
¡
 
¬g
 
to
 
Ãxt
 
dasm_put
().

111 
£ıos
 = 1 -- 
The
 
aùiÚli¡
 
off£t
 
occup›s
 
a
 
bufãr
 
pos™iÚ
, 
	gtoo
.

112 
	g’d


114 -- 
Put
 
esÿ³d
 
	gwÜd
.

115 
loÿl
 
funùiÚ
 
	$wputw
(
n
)

116 
n
 >ğ0xff000000 
th’
 
	`waùiÚ
("ESC"è
’d


117 
	$wputxw
(
n
)

118 
’d


120 -- 
Re£rve
 
pos™iÚ
 
wÜd
.

121 
loÿl
 
funùiÚ
 
	$wpos
()

122 
loÿl
 
pos
 = #actlist+1

123 
aùli¡
[
pos
] = ""

124  
pos


125 
’d


127 -- 
StÜe
 
wÜd
 
to
 
»£rved
 
pos™iÚ
.

128 
loÿl
 
funùiÚ
 
	$wpuos
(
pos
, 
n
)

129 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

130 
aùli¡
[
pos
] = 
n


131 
’d


135 -- 
Glob®
 
Ïb–
 
Çme
 -> 
glob®
†ab– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

136 
loÿl
 
Ãxt_glob®
 = 20

137 
loÿl
 
m­_glob®
 = 
	`£tm‘©abË
({
	}
}, { 
	g__šdex
 = 
funùiÚ
(
t
, 
Çme
)

138 
nÙ
 
m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’
 
w”rÜ
("bad glob®†ab–"è
’d


139 
loÿl
 
	gn
 = 
Ãxt_glob®


140 
n
 > 2047 
th’
 
w”rÜ
("toØmªy glob®†ab–s"è
’d


141 
Ãxt_glob®
 = 
n
 + 1

142 
t
[
Çme
] = 
n


143  
n


144 
’d
})

146 -- 
Dump
 
glob®
 
	gÏb–s
.

147 
loÿl
 
funùiÚ
 
	$dumpglob®s
(
out
, 
lvl
)

148 
loÿl
 
t
 = {
	}
}

149 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


150 
out
:
	`wr™e
("Global†abels:\n")

151 
i
=20,
Ãxt_glob®
-1 do

152 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
t
[
i
]))

153 
’d


154 
out
:
	`wr™e
("\n")

155 
’d


157 -- 
Wr™e
 
glob®
 
Ïb–
 .

158 
loÿl
 
funùiÚ
 
	$wr™eglob®s
(
out
, 
´efix
)

159 
loÿl
 
t
 = {
	}
}

160 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


161 
out
:
	`wr™e
("enum {\n")

162 
i
=20,
Ãxt_glob®
-1 do

163 
out
:
	`wr™e
(" ", 
´efix
, 
t
[
i
], ",\n")

164 
’d


165 
out
:
	`wr™e
(" ", 
´efix
, "_MAX\n};\n")

166 
’d


168 -- 
Wr™e
 
glob®
 
Ïb–
 
Çmes
.

169 
loÿl
 
funùiÚ
 
	$wr™eglob®Çmes
(
out
, 
Çme
)

170 
loÿl
 
t
 = {
	}
}

171 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


172 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

173 
i
=20,
Ãxt_glob®
-1 do

174 
out
:
	`wr™e
(" \"", 
t
[
i
], "\",\n")

175 
’d


176 
out
:
	`wr™e
(" (const char *)0\n};\n")

177 
’d


181 -- 
Ex‹º
 
Ïb–
 
Çme
 -> Ïb– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

182 
loÿl
 
Ãxt_ex‹º
 = 0

183 
loÿl
 
m­_ex‹º_
 = {
	}
}

184 
loÿl
 
m­_ex‹º
 = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
Çme
)

185 -- 
No
 
»¡riùiÚs
 
Ú
 
the
 
Çme
 
now
.

186 
loÿl
 
n
 = 
Ãxt_ex‹º


187 
n
 > 2047 
th’
 
w”rÜ
("toØmªyƒx‹º†ab–s"è
’d


188 
Ãxt_ex‹º
 = 
n
 + 1

189 
t
[
Çme
] = 
n


190 
m­_ex‹º_
[
n
] = 
Çme


191  
n


192 
’d
})

194 -- 
Dump
 
Ïb–s
.

195 
loÿl
 
funùiÚ
 
	$dum³x‹ºs
(
out
, 
lvl
)

196 
out
:
	`wr™e
("Extern†abels:\n")

197 
i
=0,
Ãxt_ex‹º
-1 do

198 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
m­_ex‹º_
[
i
]))

199 
’d


200 
out
:
	`wr™e
("\n")

201 
’d


203 -- 
Wr™e
 
Ïb–
 
Çmes
.

204 
loÿl
 
funùiÚ
 
	$wr™“x‹ºÇmes
(
out
, 
Çme
)

205 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

206 
i
=0,
Ãxt_ex‹º
-1 do

207 
out
:
	`wr™e
(" \"", 
m­_ex‹º_
[
i
], "\",\n")

208 
’d


209 
out
:
	`wr™e
(" (const char *)0\n};\n")

210 
’d


214 -- 
Arch
-
¥ecific
 
m­s
.

215 
loÿl
 
m­_¬chdef
 = { 
¥
="r29", 
¿
="r31" 
	}
} -- 
Ext
. 
Çme
 -> .‚ame.

217 
loÿl
 
m­_ty³
 = {} -- 
Ty³
 
Çme
 -> { 
ùy³
, 
»g
 }

218 
loÿl
 
ùy³num
 = 0 -- 
Ty³
 
numb”
 (
Dt
... 
maüos
).

220 -- 
Rev”£
 
defšes
 
»gi¡”s
.

221 
funùiÚ
 
_M
.
	$»vdef
(
s
)

222 
s
 =ğ"r29" 
th’
  "sp"

223 
–£if
 
s
 =ğ"r31" 
th’
  "¿" 
’d


224  
s


225 
’d


229 -- 
Tem¶©e
 
¡ršgs
 
MIPS
 
š¡ruùiÚs
.

230 
loÿl
 
m­_İ
 = {

231 -- 
Fœ¡
-
Ëv–
 
İcodes
.

232 
j_1
 = "08000000J",

233 
j®_1
 = "0c000000J",

234 
b_1
 = "10000000B",

235 
beqz_2
 = "10000000SB",

236 
beq_3
 = "10000000STB",

237 
bÃz_2
 = "14000000SB",

238 
bÃ_3
 = "14000000STB",

239 
bËz_2
 = "18000000SB",

240 
bgtz_2
 = "1c000000SB",

241 
addi_3
 = "20000000TSI",

242 
li_2
 = "24000000TI",

243 
addiu_3
 = "24000000TSI",

244 
¦ti_3
 = "28000000TSI",

245 
¦tiu_3
 = "2c000000TSI",

246 
ªdi_3
 = "30000000TSU",

247 
lu_2
 = "34000000TU",

248 
Üi_3
 = "34000000TSU",

249 
xÜi_3
 = "38000000TSU",

250 
lui_2
 = "3c000000TU",

251 
beqzl_2
 = "50000000SB",

252 
beql_3
 = "50000000STB",

253 
bÃzl_2
 = "54000000SB",

254 
bÃl_3
 = "54000000STB",

255 
bËzl_2
 = "58000000SB",

256 
bgtzl_2
 = "5c000000SB",

257 
daddi_3
 = 
ms64
 
ªd
 "60000000TSI",

258 
daddiu_3
 = 
ms64
 
ªd
 "64000000TSI",

259 
ldl_2
 = 
ms64
 
ªd
 "68000000TO",

260 
ldr_2
 = 
ms64
 
ªd
 "6c000000TO",

261 
lb_2
 = "80000000TO",

262 
lh_2
 = "84000000TO",

263 
lwl_2
 = "88000000TO",

264 
lw_2
 = "8c000000TO",

265 
lbu_2
 = "90000000TO",

266 
lhu_2
 = "94000000TO",

267 
lwr_2
 = "98000000TO",

268 
lwu_2
 = 
ms64
 
ªd
 "9c000000TO",

269 
sb_2
 = "a0000000TO",

270 
sh_2
 = "a4000000TO",

271 
swl_2
 = "a8000000TO",

272 
sw_2
 = "ac000000TO",

273 
sdl_2
 = 
ms64
 
ªd
 "b0000000TO",

274 
sdr_2
 = 
ms64
 
ªd
 "b1000000TO",

275 
swr_2
 = "b8000000TO",

276 
ÿche_2
 = "bc000000NO",

277 
Î_2
 = "c0000000TO",

278 
lwc1_2
 = "c4000000HO",

279 
´ef_2
 = "cc000000NO",

280 
ldc1_2
 = "d4000000HO",

281 
ld_2
 = 
ms64
 
ªd
 "dc000000TO",

282 
sc_2
 = "e0000000TO",

283 
swc1_2
 = "e4000000HO",

284 
scd_2
 = 
ms64
 
ªd
 "f0000000TO",

285 
sdc1_2
 = "f4000000HO",

286 
sd_2
 = 
ms64
 
ªd
 "fc000000TO",

288 -- 
Opcode
 
SPECIAL
.

289 
nİ_0
 = "00000000",

290 
¦l_3
 = "00000000DTA",

291 
£xtw_2
 = "00000000DT",

292 
movf_2
 = "00000001DS",

293 
movf_3
 = "00000001DSC",

294 
movt_2
 = "00010001DS",

295 
movt_3
 = "00010001DSC",

296 
¤l_3
 = "00000002DTA",

297 
rÙr_3
 = "00200002DTA",

298 
¤a_3
 = "00000003DTA",

299 
¦lv_3
 = "00000004DTS",

300 
¤lv_3
 = "00000006DTS",

301 
rÙrv_3
 = "00000046DTS",

302 
drÙrv_3
 = 
ms64
 
ªd
 "00000056DTS",

303 
¤av_3
 = "00000007DTS",

304 
jr_1
 = "00000008S",

305 
j®r_1
 = "0000f809S",

306 
j®r_2
 = "00000009DS",

307 
movz_3
 = "0000000aDST",

308 
movn_3
 = "0000000bDST",

309 
sysÿÎ_0
 = "0000000c",

310 
sysÿÎ_1
 = "0000000cY",

311 
b»ak_0
 = "0000000d",

312 
b»ak_1
 = "0000000dY",

313 
sync_0
 = "0000000f",

314 
mfhi_1
 = "00000010D",

315 
mthi_1
 = "00000011S",

316 
mæo_1
 = "00000012D",

317 
mo_1
 = "00000013S",

318 
d¦lv_3
 = 
ms64
 
ªd
 "00000014DTS",

319 
d¤lv_3
 = 
ms64
 
ªd
 "00000016DTS",

320 
d¤av_3
 = 
ms64
 
ªd
 "00000017DTS",

321 
muÉ_2
 = "00000018ST",

322 
muÉu_2
 = "00000019ST",

323 
div_2
 = "0000001aST",

324 
divu_2
 = "0000001bST",

325 
dmuÉ_2
 = 
ms64
 
ªd
 "0000001cST",

326 
dmuÉu_2
 = 
ms64
 
ªd
 "0000001dST",

327 
ddiv_2
 = 
ms64
 
ªd
 "0000001eST",

328 
ddivu_2
 = 
ms64
 
ªd
 "0000001fST",

329 
add_3
 = "00000020DST",

330 
move_2
 = 
ms64
 
ªd
 "00000025DS" 
Ü
 "00000021DS",

331 
addu_3
 = "00000021DST",

332 
sub_3
 = "00000022DST",

333 
Ãgu_2
 = 
ms64
 
ªd
 "0000002fDT" 
Ü
 "00000023DT",

334 
subu_3
 = "00000023DST",

335 
ªd_3
 = "00000024DST",

336 
Ü_3
 = "00000025DST",

337 
xÜ_3
 = "00000026DST",

338 
nÙ_2
 = "00000027DS",

339 
nÜ_3
 = "00000027DST",

340 
¦t_3
 = "0000002aDST",

341 
¦tu_3
 = "0000002bDST",

342 
dadd_3
 = 
ms64
 
ªd
 "0000002cDST",

343 
daddu_3
 = 
ms64
 
ªd
 "0000002dDST",

344 
dsub_3
 = 
ms64
 
ªd
 "0000002eDST",

345 
dsubu_3
 = 
ms64
 
ªd
 "0000002fDST",

346 
tge_2
 = "00000030ST",

347 
tge_3
 = "00000030STZ",

348 
tgeu_2
 = "00000031ST",

349 
tgeu_3
 = "00000031STZ",

350 
t_2
 = "00000032ST",

351 
t_3
 = "00000032STZ",

352 
tu_2
 = "00000033ST",

353 
tu_3
 = "00000033STZ",

354 
‹q_2
 = "00000034ST",

355 
‹q_3
 = "00000034STZ",

356 
Še_2
 = "00000036ST",

357 
Še_3
 = "00000036STZ",

358 
d¦l_3
 = 
ms64
 
ªd
 "00000038DTa",

359 
d¤l_3
 = 
ms64
 
ªd
 "0000003aDTa",

360 
drÙr_3
 = 
ms64
 
ªd
 "0020003aDTa",

361 
d¤a_3
 = 
ms64
 
ªd
 "0000003bDTa",

362 
d¦l32_3
 = 
ms64
 
ªd
 "0000003cDTA",

363 
d¤l32_3
 = 
ms64
 
ªd
 "0000003eDTA",

364 
drÙr32_3
 = 
ms64
 
ªd
 "0020003eDTA",

365 
d¤a32_3
 = 
ms64
 
ªd
 "0000003fDTA",

367 -- 
Opcode
 
REGIMM
.

368 
bÉz_2
 = "04000000SB",

369 
bgez_2
 = "04010000SB",

370 
bÉzl_2
 = "04020000SB",

371 
bgezl_2
 = "04030000SB",

372 
tgei_2
 = "04080000SI",

373 
tgeiu_2
 = "04090000SI",

374 
ti_2
 = "040a0000SI",

375 
tiu_2
 = "040b0000SI",

376 
‹qi_2
 = "040c0000SI",

377 
Šei_2
 = "040e0000SI",

378 
bÉz®_2
 = "04100000SB",

379 
b®_1
 = "04110000B",

380 
bgez®_2
 = "04110000SB",

381 
bÉz®l_2
 = "04120000SB",

382 
bgez®l_2
 = "04130000SB",

383 
synci_1
 = "041f0000O",

385 -- 
Opcode
 
SPECIAL2
.

386 
madd_2
 = "70000000ST",

387 
maddu_2
 = "70000001ST",

388 
mul_3
 = "70000002DST",

389 
msub_2
 = "70000004ST",

390 
msubu_2
 = "70000005ST",

391 
şz_2
 = "70000020DS=",

392 
şo_2
 = "70000021DS=",

393 
dşz_2
 = 
ms64
 
ªd
 "70000024DS=",

394 
dşo_2
 = 
ms64
 
ªd
 "70000025DS=",

395 
sdbbp_0
 = "7000003f",

396 
sdbbp_1
 = "7000003fY",

398 -- 
Opcode
 
SPECIAL3
.

399 
ext_4
 = "7c000000TSAM", -- 
NÙe
: 
Ï¡
 
¬g
 
is
 
msbd
 = 
size
-1

400 
dextm_4
 = 
ms64
 
ªd
 "7c000001TSAM", -- 
Args
: 
pos
 | 
size
-1-32

401 
dextu_4
 = 
ms64
 
ªd
 "7c000002TSAM", -- 
Args
: 
pos
-32 | 
size
-1

402 
dext_4
 = 
ms64
 
ªd
 "7c000003TSAM", -- 
Args
: 
pos
 | 
size
-1

403 
zextw_2
 = 
ms64
 
ªd
 "7c00f803TS",

404 
šs_4
 = "7c000004TSAM", -- 
NÙe
: 
Ï¡
 
¬g
 
is
 
msb
 = 
pos
+
size
-1

405 
dšsm_4
 = 
ms64
 
ªd
 "7c000005TSAM", -- 
Args
: 
pos
 |…os+
size
-33

406 
dšsu_4
 = 
ms64
 
ªd
 "7c000006TSAM", -- 
Args
: 
pos
-32 |…os+
size
-33

407 
dšs_4
 = 
ms64
 
ªd
 "7c000007TSAM", -- 
Args
: 
pos
 |…os+
size
-1

408 
wsbh_2
 = "7c0000a0DT",

409 
dsbh_2
 = 
ms64
 
ªd
 "7c0000a4DT",

410 
dshd_2
 = 
ms64
 
ªd
 "7c000164DT",

411 
£b_2
 = "7c000420DT",

412 
£h_2
 = "7c000620DT",

413 
rdhwr_2
 = "7c00003bTD",

415 -- 
Opcode
 
COP0
.

416 
mfc0_2
 = "40000000TD",

417 
mfc0_3
 = "40000000TDW",

418 
dmfc0_2
 = 
ms64
 
ªd
 "40200000TD",

419 
dmfc0_3
 = 
ms64
 
ªd
 "40200000TDW",

420 
mtc0_2
 = "40800000TD",

421 
mtc0_3
 = "40800000TDW",

422 
dmtc0_2
 = 
ms64
 
ªd
 "40a00000TD",

423 
dmtc0_3
 = 
ms64
 
ªd
 "40a00000TDW",

424 
rdpg´_2
 = "41400000DT",

425 
di_0
 = "41606000",

426 
di_1
 = "41606000T",

427 
ei_0
 = "41606020",

428 
ei_1
 = "41606020T",

429 
w½g´_2
 = "41c00000DT",

430 
br_0
 = "42000001",

431 
bwi_0
 = "42000002",

432 
bwr_0
 = "42000006",

433 
bp_0
 = "42000008",

434 
”‘_0
 = "42000018",

435 
d”‘_0
 = "4200001f",

436 
wa™_0
 = "42000020",

438 -- 
Opcode
 
COP1
.

439 
mfc1_2
 = "44000000TG",

440 
dmfc1_2
 = 
ms64
 
ªd
 "44200000TG",

441 
cfc1_2
 = "44400000TG",

442 
mfhc1_2
 = "44600000TG",

443 
mtc1_2
 = "44800000TG",

444 
dmtc1_2
 = 
ms64
 
ªd
 "44a00000TG",

445 
ùc1_2
 = "44c00000TG",

446 
mthc1_2
 = "44e00000TG",

448 
bc1f_1
 = "45000000B",

449 
bc1f_2
 = "45000000CB",

450 
bc1t_1
 = "45010000B",

451 
bc1t_2
 = "45010000CB",

452 
bc1æ_1
 = "45020000B",

453 
bc1æ_2
 = "45020000CB",

454 
bc1_1
 = "45030000B",

455 
bc1_2
 = "45030000CB",

635 -- 
Opcode
 
COP1X
.

636 
lwxc1_2
 = "4c000000FX",

637 
ldxc1_2
 = "4c000001FX",

638 
luxc1_2
 = "4c000005FX",

639 
swxc1_2
 = "4c000008FX",

640 
sdxc1_2
 = "4c000009FX",

641 
suxc1_2
 = "4c00000dFX",

642 
´efx_2
 = "4c00000fMX",

656 
	}
}

660 
loÿl
 
funùiÚ
 
	$·r£_g´
(
ex´
)

661 
loÿl
 
Šame
, 
ov»g
 = 
	`m©ch
(
ex´
, "^([%w_]+):(r[1-3]?[0-9])$")

662 
loÿl
 

 = 
m­_ty³
[
Šame
 
Ü
 
ex´
]

663 

 
th’


664 
loÿl
 
»g
 = 
ov»g
 
Ü
 

.reg

665 
nÙ
 
»g
 
th’


666 
	`w”rÜ
("ty³ `"..(
Šame
 
Ü
 
ex´
).."'‚eeds‡„egister override")

667 
’d


668 
ex´
 = 
»g


669 
’d


670 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^r([1-3]?[0-9])$")

671 
r
 
th’


672 
r
 = 
	$tÚumb”
(
r
)

673 
r
 <ğ31 
th’
 „, 

 
’d


674 
’d


675 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

676 
’d


678 
loÿl
 
funùiÚ
 
	$·r£_år
(
ex´
)

679 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^f([1-3]?[0-9])$")

680 
r
 
th’


681 
r
 = 
	$tÚumb”
(
r
)

682 
r
 <ğ31 
th’
 „ 
’d


683 
’d


684 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

685 
’d


687 
loÿl
 
funùiÚ
 
	$·r£_imm
(
imm
, 
b™s
, 
shiá
, 
sÿË
, sigÃd, 
aùiÚ
)

688 
loÿl
 
n
 = 
	$tÚumb”
(
imm
)

689 
n
 
th’


690 
loÿl
 
m
 = 
	$§r
(
n
, 
sÿË
)

691 
	`shl
(
m
, 
sÿË
è=ğ
n
 
th’


692 sigÃd 
th’


693 
loÿl
 
s
 = 
	`§r
(
m
, 
b™s
-1)

694 
s
 =ğ0 
th’
  
	$shl
(
m
, 
shiá
)

695 
–£if
 
s
 =ğ-1 
th’
  
	`shl
(
m
 + shl(1, 
b™s
), 
shiá
è
’d


697 
	`§r
(
m
, 
b™s
è=ğ0 
th’
  
	$shl
(
m
, 
shiá
è
’d


698 
’d


699 
’d


700 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

701 
–£if
 
	`m©ch
(
imm
, "^[rf]([1-3]?[0-9])$"è
Ü


702 
	`m©ch
(
imm
, "^([%w_]+):([rf][1-3]?[0-9])$"è
th’


703 
	`w”rÜ
("expected immediate operand, got„egister")

705 
	`waùiÚ
(
aùiÚ
 
Ü
 "IMM",

706 (sigÃd 
ªd
 32768 
Ü
 0)+
	`shl
(
sÿË
, 10)+shl(
b™s
, 5)+
shiá
, 
imm
)

708 
’d


709 
’d


711 
loÿl
 
funùiÚ
 
	$·r£_di¥
(
di¥
)

712 
loÿl
 
imm
, 
»g
 = 
	`m©ch
(
di¥
, "^(.*)%(([%w_:]+)%)$")

713 
imm
 
th’


714 
loÿl
 
r
 = 
	`shl
(
	`·r£_g´
(
»g
), 21)

715 
loÿl
 
exŠame
 = 
	`m©ch
(
imm
, "^extern%s+(%S+)$")

716 
exŠame
 
th’


717 
	`waùiÚ
("REL_EXT", 
m­_ex‹º
[
exŠame
], 
n
, 1)

718  
r


720  
r
 + 
	$·r£_imm
(
imm
, 16, 0, 0, 
Œue
)

721 
’d


722 
’d


723 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
di¥
, "^([%w_:]+)%s*(.*)$")

724 
»g
 
ªd
 
r
 ~ğ"" 
th’


725 
loÿl
 
r
, 

 = 
	$·r£_g´
(
»g
)

726 

 
th’


727 
	`waùiÚ
("IMM", 32768+16*32, 
	$fÜm©
(

.
ùy³fmt
, 
r
))

728  
	$shl
(
r
, 21)

729 
’d


730 
’d


731 
	`w”rÜ
("bad di¥Ïûm’ˆ`"..
di¥
.."'")

732 
’d


734 
loÿl
 
funùiÚ
 
	$·r£_šdex
(
idx
)

735 
loÿl
 
¹
, 
rs
 = 
	`m©ch
(
idx
, "^(.*)%(([%w_:]+)%)$")

736 
¹
 
th’


737 
¹
 = 
	$·r£_g´
(
¹
)

738 
rs
 = 
	$·r£_g´
(
rs
)

739  
	`shl
(
¹
, 16è+ 
	$shl
(
rs
, 21)

740 
’d


741 
	`w”rÜ
("bad index `"..
idx
.."'")

742 
’d


744 
loÿl
 
funùiÚ
 
	$·r£_Ïb–
(
Ïb–
, 
def
)

745 
loÿl
 
´efix
 = 
	`sub
(
Ïb–
, 1, 2)

746 -- =>
	$Ïb–
 (
pc
 
Ïb–
 
»ã»nû
)

747 
´efix
 =ğ"=>" 
th’


748  "PC", 0, 
	$sub
(
Ïb–
, 3)

749 
’d


750 -- ->
	$Çme
 (
glob®
 
Ïb–
 
»ã»nû
)

751 
´efix
 =ğ"->" 
th’


752  "LG", 
m­_glob®
[
	`sub
(
Ïb–
, 3)]

753 
’d


754 
def
 
th’


755 -- [1-9] (
loÿl
 
Ïb–
 
defš™iÚ
)

756 
	`m©ch
(
Ïb–
, "^[1-9]$"è
th’


757  "LG", 10+
	$tÚumb”
(
Ïb–
)

758 
’d


760 -- [<>][1-9] (
loÿl
 
Ïb–
 
»ã»nû
)

761 
loÿl
 
dœ
, 
Êum
 = 
	`m©ch
(
Ïb–
, "^([<>])([1-9])$")

762 
dœ
 
th’
 -- 
Fwd
: 1-9, 
Bkwd
: 11-19.

763  "LG", 
Êum
 + (
dœ
 =ğ">" 
ªd
 0 
Ü
 10)

764 
’d


765 -- 
	$Ïb–
 (
Ïb–
 
»ã»nû
)

766 
loÿl
 
exŠame
 = 
	`m©ch
(
Ïb–
, "^extern%s+(%S+)$")

767 
exŠame
 
th’


768  "EXT", 
m­_ex‹º
[
exŠame
]

769 
’d


770 
’d


771 
	`w”rÜ
("bad†ab– `"..
Ïb–
.."'")

772 
’d


776 -- 
HªdË
 
İcodes
 
defšed
 
w™h
 
‹m¶©e
 
¡ršgs
.

777 
m­_İ
[".‹m¶©e__"] = 
	$funùiÚ
(
·¿ms
, 
‹m¶©e
, 
Å¬ams
)

778 
nÙ
 
·¿ms
 
th’
  
	$sub
(
‹m¶©e
, 9è
’d


779 
loÿl
 
İ
 = 
	`tÚumb”
(
	`sub
(
‹m¶©e
, 1, 8), 16)

780 
loÿl
 
n
 = 1

782 -- 
Lim™
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
u£d
 
by
 
a
 
sšgË
 
	`dasm_put
().

783 -- 
A
 
sšgË
 
İcode
 
Ãeds
 
a
 
maximum
 
of
 2 
	`pos™iÚs
 (
šs
/
ext
).

784 
£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


785 
loÿl
 
pos
 = 
	`wpos
()

787 -- 
Proûss
 
—ch
 
ch¬aù”
.

788 
p
 
š
 
	`gm©ch
(
	`sub
(
‹m¶©e
, 9), ".") do

789 
p
 =ğ"D" 
th’


790 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
·¿ms
[
n
]), 11);‚ =‚ + 1

791 
–£if
 
p
 =ğ"T" 
th’


792 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
·¿ms
[
n
]), 16);‚ =‚ + 1

793 
–£if
 
p
 =ğ"S" 
th’


794 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
·¿ms
[
n
]), 21);‚ =‚ + 1

795 
–£if
 
p
 =ğ"F" 
th’


796 
İ
 = o°+ 
	`shl
(
	`·r£_år
(
·¿ms
[
n
]), 6);‚ =‚ + 1

797 
–£if
 
p
 =ğ"G" 
th’


798 
İ
 = o°+ 
	`shl
(
	`·r£_år
(
·¿ms
[
n
]), 11);‚ =‚ + 1

799 
–£if
 
p
 =ğ"H" 
th’


800 
İ
 = o°+ 
	`shl
(
	`·r£_år
(
·¿ms
[
n
]), 16);‚ =‚ + 1

801 
–£if
 
p
 =ğ"R" 
th’


802 
İ
 = o°+ 
	`shl
(
	`·r£_år
(
·¿ms
[
n
]), 21);‚ =‚ + 1

803 
–£if
 
p
 =ğ"I" 
th’


804 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 16, 0, 0, 
Œue
);‚ =‚ + 1

805 
–£if
 
p
 =ğ"U" 
th’


806 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 16, 0, 0, 
çl£
);‚ =‚ + 1

807 
–£if
 
p
 =ğ"O" 
th’


808 
İ
 = o°+ 
	`·r£_di¥
(
·¿ms
[
n
]);‚ =‚ + 1

809 
–£if
 
p
 =ğ"X" 
th’


810 
İ
 = o°+ 
	`·r£_šdex
(
·¿ms
[
n
]);‚ =‚ + 1

811 
–£if
 
p
 =ğ"B" 
Ü
… =ğ"J" 
th’


812 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
·¿ms
[
n
], 
çl£
)

813 
p
 =ğ"B" 
th’
 
n
 =‚ + 2048 
’d


814 
	`waùiÚ
("REL_"..
mode
, 
n
, 
s
, 1)

815 
n
 =‚ + 1

816 
–£if
 
p
 =ğ"A" 
th’


817 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 5, 6, 0, 
çl£
);‚ =‚ + 1

818 
–£if
 
p
 =ğ"a" 
th’


819 
loÿl
 
m
 = 
	`·r£_imm
(
·¿ms
[
n
], 6, 6, 0, 
çl£
, "IMMS");‚ =‚ + 1

820 
İ
 = o°+ 
	`bªd
(
m
, 0x7c0è+ bªd(
	`shr
(m, 9), 4)

821 
–£if
 
p
 =ğ"M" 
th’


822 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 5, 11, 0, 
çl£
);‚ =‚ + 1

823 
–£if
 
p
 =ğ"N" 
th’


824 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 5, 16, 0, 
çl£
);‚ =‚ + 1

825 
–£if
 
p
 =ğ"C" 
th’


826 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 3, 18, 0, 
çl£
);‚ =‚ + 1

827 
–£if
 
p
 =ğ"V" 
th’


828 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 3, 8, 0, 
çl£
);‚ =‚ + 1

829 
–£if
 
p
 =ğ"W" 
th’


830 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 3, 0, 0, 
çl£
);‚ =‚ + 1

831 
–£if
 
p
 =ğ"Y" 
th’


832 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 20, 6, 0, 
çl£
);‚ =‚ + 1

833 
–£if
 
p
 =ğ"Z" 
th’


834 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 10, 6, 0, 
çl£
);‚ =‚ + 1

835 
–£if
 
p
 =ğ"=" 
th’


836 
İ
 = o°+ 
	`shl
(
	`bªd
(İ, 0xf800), 5è-- 
Cİy
 
D
 
to
 
T
 
şz
, 
şo
.

838 
	$as£¹
(
çl£
)

839 
’d


840 
’d


841 
	$wpuos
(
pos
, 
İ
)

842 
’d


846 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
aùiÚ
 
li¡
 
is
Ø
be
 
em™‹d
.

847 
m­_İ
[".aùiÚli¡_1"] = 
	$funùiÚ
(
·¿ms
)

848 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


849 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

850 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™—ùiÚs
(
out
, 
Çme
è
’d
)

851 
’d


853 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
is
Ø
be
 
em™‹d
.

854 
m­_İ
[".glob®s_1"] = 
	$funùiÚ
(
·¿ms
)

855 
nÙ
 
·¿ms
 
th’
  "´efix" 
’d


856 
loÿl
 
´efix
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

857 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®s
(
out
, 
´efix
è
’d
)

858 
’d


860 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
Çmes
 
¬e
Ø
be
 
em™‹d
.

861 
m­_İ
[".glob®Çmes_1"] = 
	$funùiÚ
(
·¿ms
)

862 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


863 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

864 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®Çmes
(
out
, 
Çme
è
’d
)

865 
’d


867 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
Çmes
 
¬e
Ø
be
 
em™‹d
.

868 
m­_İ
[".ex‹ºÇmes_1"] = 
	$funùiÚ
(
·¿ms
)

869 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


870 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

871 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™“x‹ºÇmes
(
out
, 
Çme
è
’d
)

872 
’d


876 -- 
Lab–
 
p£udo
-
	`İcode
 (
cÚv”‹d
 
äom
 
Œašg
 
cŞÚ
 
fÜm
).

877 
m­_İ
[".Ïb–_1"] = 
	$funùiÚ
(
·¿ms
)

878 
nÙ
 
·¿ms
 
th’
  "[1-9] | ->glob® | =>pûx´" 
’d


879 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


880 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
·¿ms
[1], 
Œue
)

881 
mode
 =ğ"EXT" 
th’
 
	`w”rÜ
("bad†ab– defš™iÚ"è
’d


882 
	`waùiÚ
("LABEL_"..
mode
, 
n
, 
s
, 1)

883 
’d


887 -- 
P£udo
-
İcodes
 
d©a
 
¡Üage
.

888 
m­_İ
[".lÚg_*"] = 
	$funùiÚ
(
·¿ms
)

889 
nÙ
 
·¿ms
 
th’
  "imm..." 
’d


890 
_
,
p
 
š
 
	$aœs
(
·¿ms
) do

891 
loÿl
 
n
 = 
	$tÚumb”
(
p
)

892 
nÙ
 
n
 
th’
 
	`w”rÜ
("bad immedŸ‹ `"..
p
.."'"è
’d


893 
n
 < 0 
th’
‚ =‚ + 2^32 
’d


894 
	$wputw
(
n
)

895 
£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


896 
’d


897 
’d


899 -- 
Alignm’t
 
p£udo
-
İcode
.

900 
m­_İ
[".®ign_1"] = 
	$funùiÚ
(
·¿ms
)

901 
nÙ
 
·¿ms
 
th’
  "numpow2" 
’d


902 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


903 
loÿl
 
®ign
 = 
	$tÚumb”
(
·¿ms
[1])

904 
®ign
 
th’


905 
loÿl
 
x
 = 
®ign


906 -- 
Mu¡
 
be
 
a
 
pow”
 
of
 2 
š
 
the
 
	`¿nge
 (2 ... 256).

907 
i
=1,8 do

908 
x
 = x / 2

909 
x
 =ğ1 
th’


910 
	`waùiÚ
("ALIGN", 
®ign
-1, 
n
, 1è-- 
AùiÚ
 
by‹
 
is
 2**
n
-1.

912 
’d


913 
’d


914 
’d


915 
	`w”rÜ
("bad‡lignment")

916 
’d


920 -- 
P£udo
-
İcode
 
´im™ive
è
ty³
 
	`defš™iÚs
 (
m­
 
to
 
C
 
ty³s
).

921 
m­_İ
[".ty³_3"] = 
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

922 
nÙ
 
·¿ms
 
th’


923  
Å¬ams
 =ğ2 
ªd
 "Çme, cty³" 
Ü
 "name, ctype,„eg"

924 
’d


925 
loÿl
 
Çme
, 
ùy³
, 
»g
 = 
·¿ms
[1],…arams[2],…arams[3]

926 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


927 
	`w”rÜ
("bady³‚am`"..
Çme
.."'")

928 
’d


929 
loÿl
 

 = 
m­_ty³
[
Çme
]

930 

 
th’


931 
	`w”rÜ
("du¶iÿ‹y³ `"..
Çme
.."'")

932 
’d


933 -- 
Add
 #ty³ 
to
 
defšes
. 
A
 
b™
 
unş—n
Ø
put
 
™
 
š
 
m­_¬chdef
.

934 
m­_¬chdef
["#"..
Çme
] = "sizeof("..
ùy³
..")"

935 -- 
Add
 
Ãw
 
ty³
 
ªd
 
em™
 
shÜtcut
 
defše
.

936 
loÿl
 
num
 = 
ùy³num
 + 1

937 
m­_ty³
[
Çme
] = {

938 
ùy³
 = ctype,

939 
ùy³fmt
 = 
	`fÜm©
("Dt%X(%%s)", 
num
),

940 
»g
 =„eg,

941 
	}
}

942 
wlše
(
fÜm©
("#defšDt%X(_Vè(št)ÕŒdiff_t)&(((% *)0)_V)", 
num
, 
ùy³
))

943 
ùy³num
 = 
num


944 
’d


945 
m­_İ
[".type_2"] = map_op[".type_3"]

947 -- 
Dump
 
ty³
 
defš™iÚs
.

948 
loÿl
 
funùiÚ
 
	$dum±y³s
(
out
, 
lvl
)

949 
loÿl
 
t
 = {
	}
}

950 
Çme
 
š
 
	$·œs
(
m­_ty³
èdØ
t
[#t+1] = 
Çme
 
’d


951 
	$sÜt
(
t
)

952 
out
:
	`wr™e
("Type definitions:\n")

953 
_
,
Çme
 
š
 
	$aœs
(
t
) do

954 
loÿl
 

 = 
m­_ty³
[
Çme
]

955 
loÿl
 
»g
 = 

.»g 
Ü
 ""

956 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %-20 %s\n", 
Çme
, 

.
ùy³
, 
»g
))

957 
’d


958 
out
:
	`wr™e
("\n")

959 
’d


963 -- 
S‘
 
the
 
cu¼’t
 
£ùiÚ
.

964 
funùiÚ
 
_M
.
	$£ùiÚ
(
num
)

965 
	`waùiÚ
("SECTION", 
num
)

966 
	`wæush
(
Œue
è-- 
SECTION
 
is
 
a
 
‹rmš®
 
aùiÚ
.

967 
’d


971 -- 
Dump
 
¬ch™eùu»
 
desütiÚ
.

972 
funùiÚ
 
_M
.
	$dum·rch
(
out
)

973 
out
:
	`wr™e
(
	`fÜm©
("DynASM %s version %s,„eleased %s\n\n",

974 
_šfo
.
¬ch
, _šfo.
v”siÚ
, _šfo.
»Ëa£
))

975 
	$dum·ùiÚs
(
out
)

976 
’d


978 -- 
Dump
 
®l
 
u£r
 
defšed
 
–em’ts
.

979 
funùiÚ
 
_M
.
	$dumpdef
(
out
, 
lvl
)

980 
	$dum±y³s
(
out
, 
lvl
)

981 
	$dumpglob®s
(
out
, 
lvl
)

982 
	$dum³x‹ºs
(
out
, 
lvl
)

983 
’d


987 -- 
Pass
 
ÿÎbacks
 
äom
/
to
 
the
 
DynASM
 
cÜe
.

988 
funùiÚ
 
_M
.
	$·sscb
(
wl
, 
we
, 
wf
, 
ww
)

989 
wlše
, 
w”rÜ
, 
wçl
, 
ww¬n
 = 
wl
, 
we
, 
wf
, 
ww


990  
wæush


991 
’d


993 -- 
S‘up
 
the
 
¬ch
-
¥ecific
 
moduË
.

994 
funùiÚ
 
_M
.
	$£tup
(
¬ch
, 
İt
)

995 
g_¬ch
, 
g_İt
 = 
¬ch
, 
İt


996 
’d


998 -- 
M”ge
 
the
 
cÜe
 
m­s
 
ªd
h
¬ch
-
¥ecific
 maps.

999 
funùiÚ
 
_M
.
	$m”gem­s
(
m­_cÜeİ
, 
m­_def
)

1000 
	`£tm‘©abË
(
m­_İ
, { 
__šdex
 = 
m­_cÜeİ
 
	}
})

1001 
£tm‘©abË
(
m­_def
, { 
__šdex
 = 
m­_¬chdef
 })

1002  
m­_İ
, 
m­_def


1003 
’d


1005  
_M


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_mips64.lua

2 -- 
DynASM
 
MIPS64
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
S“
 
	gdyÇsm
.
lua
 
fuÎ
 
cİyright
 
	gnÙiû
.

7 -- 
This
 
moduË
 
ju¡
 
	g£ts
 64 
b™
 
mode
 
the
 
combšed
 
	gMIPS
/
MIPS64
 
	gmoduË
.

8 -- 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
	gms64
 = 
Œue
 -- 
Usšg
 
a
 
glob®
 
is
 
ª
 
ugly
, 
but
 
efãùive
 
	gsŞutiÚ
.

12  
»quœe
("dasm_mips")

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_ppc.lua

2 -- 
DynASM
 
	gPPC
/
PPC64
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
S“
 
	gdyÇsm
.
lua
 
fuÎ
 
cİyright
 
	gnÙiû
.

7 -- 
SuµÜt
 
v¬ious
 
ex‹nsiÚs
 
cÚŒibu‹d
 
by
 
Caio
 
Souza
 
	gOliveœa
.

10 -- 
ModuË
 
	gšfÜm©iÚ
:

11 
loÿl
 
_šfo
 = {

12 
¬ch
 = "ppc",

13 
	gdesütiÚ
 = "DynASM PPC module",

14 
	gv”siÚ
 = "1.4.0",

15 
	gv”num
 = 10400,

16 
	g»Ëa£
 = "2015-10-18",

17 
	gauthÜ
 = "Mike Pall",

18 
	gliûn£
 = "MIT",

21 -- 
ExpÜ‹d
 
glue
 
funùiÚs
 
the
 
	g¬ch
-
¥ecific
 
	gmoduË
.

22 
loÿl
 
	g_M
 = { 
_šfo
 = _info }

24 -- 
Cache
 
lib¿ry
 
	gfunùiÚs
.

25 
loÿl
 
	gty³
, 
	gtÚumb”
, 
	g·œs
, 
	gaœs
 = 
ty³
,Úumb”,…aœs, 
aœs


26 
loÿl
 
	gas£¹
, 
	g£tm‘©abË
 = 
as£¹
, 
£tm‘©abË


27 
loÿl
 
	g_s
 = 
¡ršg


28 
loÿl
 
sub
, 
	gfÜm©
, 
	gby‹
, ğ
_s
.sub, 
	g_s
.format, _s.byte, _s.

29 
loÿl
 
	gm©ch
, 
	ggm©ch
 = 
_s
.
m©ch
, 
	g_s
.
gm©ch


30 
loÿl
 
	gcÚÿt
, 
	gsÜt
 = 
bË
.
cÚÿt
, 
	gbË
.
sÜt


31 
loÿl
 
	gb™
 = 
b™
 
Ü
 
»quœe
("bit")

32 
loÿl
 
bªd
, 
	gshl
, 
	gshr
, 
	g§r
 = 
b™
.bªd, 
	gb™
.
	glshiá
, b™.
	grshiá
, b™.
¬shiá


33 
loÿl
 
	gtohex
 = 
b™
.
tohex


35 -- 
Inh”™ed
 
bËs
 
ªd
 
ÿÎbacks
.

36 
loÿl
 
g_İt
, 
g_¬ch


37 
loÿl
 
	gwlše
, 
	gw”rÜ
, 
	gwçl
, 
	gww¬n


39 -- 
AùiÚ
 
Çme
 
	gli¡
.

40 -- 
	gCHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

41 
loÿl
 
aùiÚ_Çmes
 = {

47 -- 
Maximum
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

48 -- 
CHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

49 
loÿl
 
max£ıos
 = 25 -- 
K“p
 
this
 
low
, 
to
 
avoid
 
exûssiv–y
 
C
 
	glšes
.

51 -- 
AùiÚ
 
	gÇme
 -> 
aùiÚ
 
	gnumb”
.

52 
loÿl
 
	gm­_aùiÚ
 = {}

53 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

54 
m­_aùiÚ
[
Çme
] = 
n
-1

55 
’d


57 -- 
AùiÚ
 
li¡
 
bufãr
.

58 
loÿl
 
aùli¡
 = {
	}
}

60 -- 
Argum’t
 
li¡
 
Ãxt
 
dasm_put
(). 
S¹
 
w™h
 
off£t
 0 
što
 
aùiÚ
†ist.

61 
loÿl
 
aù¬gs
 = { 0 }

63 -- 
Cu¼’t
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

64 
loÿl
 
£ıos
 = 1

68 -- 
Dump
 
aùiÚ
 
Çmes
 
ªd
 
numb”s
.

69 
loÿl
 
funùiÚ
 
	$dum·ùiÚs
(
out
)

70 
out
:
	`wr™e
("DynASMƒncodingƒngine‡ction codes:\n")

71 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

72 
loÿl
 
num
 = 
m­_aùiÚ
[
Çme
]

73 
out
:
	`wr™e
(
	`fÜm©
(" %-10 %02X %d\n", 
Çme
, 
num
,‚um))

74 
’d


75 
out
:
	`wr™e
("\n")

76 
’d


78 -- 
Wr™e
 
aùiÚ
 
li¡
 
bufãr
 
as
 
a
 
huge
 
C
 
¬¿y
.

79 
loÿl
 
funùiÚ
 
	$wr™—ùiÚs
(
out
, 
Çme
)

80 
loÿl
 
Â
 = #actlist

81 
Â
 =ğ0 
th’
‚Àğ1; 
aùli¡
[0] = 
m­_aùiÚ
.
STOP
 
’d


82 
out
:
	`wr™e
("¡©iøcÚ¡ unsigÃd iÁ ", 
Çme
, "[", 
Â
, "] = {\n")

83 
i
 = 1,
Â
-1 do

84 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
i
]), ",\n"))

85 
’d


86 
	`as£¹
(
out
:
	`wr™e
("0x", 
	`tohex
(
aùli¡
[
Â
]), "\n};\n\n"))

87 
’d


91 -- 
Add
 
wÜd
 
to
 
aùiÚ
 
li¡
.

92 
loÿl
 
funùiÚ
 
	$wputxw
(
n
)

93 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

94 
aùli¡
[#aùli¡+1] = 
n


95 
’d


97 -- 
Add
 
aùiÚ
 
to
 
li¡
 
w™h
 
İtiÚ®
 
¬g
. 
Advªû
 
bufãr
 
pos
, 
too
.

98 
loÿl
 
funùiÚ
 
	$waùiÚ
(
aùiÚ
, 
v®
, 
a
, 
num
)

99 
loÿl
 
w
 = 
	`as£¹
(
m­_aùiÚ
[
aùiÚ
], "bad‡ction‚ame `"..action.."'")

100 
	`wputxw
(
w
 * 0x10000 + (
v®
 
Ü
 0))

101 
a
 
th’
 
aù¬gs
[#aù¬gs+1] =‡ 
’d


102 
a
 
Ü
 
num
 
th’
 
£ıos
 = seıo + (num o¸1è
’d


103 
’d


105 -- 
Flush
 
aùiÚ
 
	`li¡
 (
š‹rv’šg
 
C
 
code
 
Ü
 
bufãr
 
pos
 
ov”æow
).

106 
loÿl
 
funùiÚ
 
	$wæush
(
‹rm
)

107 #aùli¡ =ğ
aù¬gs
[1] 
th’
  
’d
 -- 
NÙhšg
 
to
 
æush
.

108 
nÙ
 
‹rm
 
th’
 
	`waùiÚ
("STOP"è
’d
 -- 
T”mš©e
 
aùiÚ
 
li¡
.

109 
	`wlše
(
	`fÜm©
("dasm_put(D¡, %s);", 
	`cÚÿt
(
aù¬gs
, ", ")), 
Œue
)

110 
aù¬gs
 = { #aùli¡ 
	}
} -- 
AùiÚli¡
 
off£t
 
is
 1
¡
 
¬g
 
to
 
Ãxt
 
dasm_put
().

111 
£ıos
 = 1 -- 
The
 
aùiÚli¡
 
off£t
 
occup›s
 
a
 
bufãr
 
pos™iÚ
, 
	gtoo
.

112 
	g’d


114 -- 
Put
 
esÿ³d
 
	gwÜd
.

115 
loÿl
 
funùiÚ
 
	$wputw
(
n
)

116 
n
 <ğ0xfffffà
th’
 
	`waùiÚ
("ESC"è
’d


117 
	$wputxw
(
n
)

118 
’d


120 -- 
Re£rve
 
pos™iÚ
 
wÜd
.

121 
loÿl
 
funùiÚ
 
	$wpos
()

122 
loÿl
 
pos
 = #actlist+1

123 
aùli¡
[
pos
] = ""

124  
pos


125 
’d


127 -- 
StÜe
 
wÜd
 
to
 
»£rved
 
pos™iÚ
.

128 
loÿl
 
funùiÚ
 
	$wpuos
(
pos
, 
n
)

129 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 0xffffffff‡nd‚ % 1 == 0, "word out of„ange")

130 
aùli¡
[
pos
] = 
n


131 
’d


135 -- 
Glob®
 
Ïb–
 
Çme
 -> 
glob®
†ab– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

136 
loÿl
 
Ãxt_glob®
 = 20

137 
loÿl
 
m­_glob®
 = 
	`£tm‘©abË
({
	}
}, { 
	g__šdex
 = 
funùiÚ
(
t
, 
Çme
)

138 
nÙ
 
m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’
 
w”rÜ
("bad glob®†ab–"è
’d


139 
loÿl
 
	gn
 = 
Ãxt_glob®


140 
n
 > 2047 
th’
 
w”rÜ
("toØmªy glob®†ab–s"è
’d


141 
Ãxt_glob®
 = 
n
 + 1

142 
t
[
Çme
] = 
n


143  
n


144 
’d
})

146 -- 
Dump
 
glob®
 
	gÏb–s
.

147 
loÿl
 
funùiÚ
 
	$dumpglob®s
(
out
, 
lvl
)

148 
loÿl
 
t
 = {
	}
}

149 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


150 
out
:
	`wr™e
("Global†abels:\n")

151 
i
=20,
Ãxt_glob®
-1 do

152 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
t
[
i
]))

153 
’d


154 
out
:
	`wr™e
("\n")

155 
’d


157 -- 
Wr™e
 
glob®
 
Ïb–
 .

158 
loÿl
 
funùiÚ
 
	$wr™eglob®s
(
out
, 
´efix
)

159 
loÿl
 
t
 = {
	}
}

160 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


161 
out
:
	`wr™e
("enum {\n")

162 
i
=20,
Ãxt_glob®
-1 do

163 
out
:
	`wr™e
(" ", 
´efix
, 
t
[
i
], ",\n")

164 
’d


165 
out
:
	`wr™e
(" ", 
´efix
, "_MAX\n};\n")

166 
’d


168 -- 
Wr™e
 
glob®
 
Ïb–
 
Çmes
.

169 
loÿl
 
funùiÚ
 
	$wr™eglob®Çmes
(
out
, 
Çme
)

170 
loÿl
 
t
 = {
	}
}

171 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


172 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

173 
i
=20,
Ãxt_glob®
-1 do

174 
out
:
	`wr™e
(" \"", 
t
[
i
], "\",\n")

175 
’d


176 
out
:
	`wr™e
(" (const char *)0\n};\n")

177 
’d


181 -- 
Ex‹º
 
Ïb–
 
Çme
 -> Ïb– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

182 
loÿl
 
Ãxt_ex‹º
 = 0

183 
loÿl
 
m­_ex‹º_
 = {
	}
}

184 
loÿl
 
m­_ex‹º
 = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
Çme
)

185 -- 
No
 
»¡riùiÚs
 
Ú
 
the
 
Çme
 
now
.

186 
loÿl
 
n
 = 
Ãxt_ex‹º


187 
n
 > 2047 
th’
 
w”rÜ
("toØmªyƒx‹º†ab–s"è
’d


188 
Ãxt_ex‹º
 = 
n
 + 1

189 
t
[
Çme
] = 
n


190 
m­_ex‹º_
[
n
] = 
Çme


191  
n


192 
’d
})

194 -- 
Dump
 
Ïb–s
.

195 
loÿl
 
funùiÚ
 
	$dum³x‹ºs
(
out
, 
lvl
)

196 
out
:
	`wr™e
("Extern†abels:\n")

197 
i
=0,
Ãxt_ex‹º
-1 do

198 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
m­_ex‹º_
[
i
]))

199 
’d


200 
out
:
	`wr™e
("\n")

201 
’d


203 -- 
Wr™e
 
Ïb–
 
Çmes
.

204 
loÿl
 
funùiÚ
 
	$wr™“x‹ºÇmes
(
out
, 
Çme
)

205 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

206 
i
=0,
Ãxt_ex‹º
-1 do

207 
out
:
	`wr™e
(" \"", 
m­_ex‹º_
[
i
], "\",\n")

208 
’d


209 
out
:
	`wr™e
(" (const char *)0\n};\n")

210 
’d


214 -- 
Arch
-
¥ecific
 
m­s
.

215 
loÿl
 
m­_¬chdef
 = { 
¥
 = "r1" 
	}
} -- 
Ext
. 
Çme
 -> .‚ame.

217 
loÿl
 
m­_ty³
 = {} -- 
Ty³
 
Çme
 -> { 
ùy³
, 
»g
 }

218 
loÿl
 
ùy³num
 = 0 -- 
Ty³
 
numb”
 (
Dt
... 
maüos
).

220 -- 
Rev”£
 
defšes
 
»gi¡”s
.

221 
funùiÚ
 
_M
.
	$»vdef
(
s
)

222 
s
 =ğ"r1" 
th’
  "¥" 
’d


223  
s


224 
’d


226 
loÿl
 
m­_cÚd
 = {

227 
É
 = 0, 
gt
 = 1, 
eq
 = 2, 
so
 = 3,

228 
ge
 = 4, 
Ë
 = 5, 
Ã
 = 6, 
ns
 = 7,

229 
	}
}

233 
loÿl
 
m­_İ
, 
İ_‹m¶©e


235 
loÿl
 
funùiÚ
 
	$İ_®Ÿs
(
İÇme
, 
f
)

236  
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

237 
nÙ
 
·¿ms
 
th’
  "-> "..
İÇme
:
	`sub
(1, -3è
’d


238 
	$f
(
·¿ms
, 
Å¬ams
)

239 
	$İ_‹m¶©e
(
·¿ms
, 
m­_İ
[
İÇme
], 
Å¬ams
)

240 
’d


241 
’d


243 -- 
Tem¶©e
 
¡ršgs
 
PPC
 
š¡ruùiÚs
.

244 
m­_İ
 = {

245 
tdi_3
 = "08000000ARI",

246 
twi_3
 = "0c000000ARI",

247 
muÎi_3
 = "1c000000RRI",

248 
subfic_3
 = "20000000RRI",

249 
cm¶wi_3
 = "28000000XRU",

250 
cm¶wi_2
 = "28000000-RU",

251 
cm¶di_3
 = "28200000XRU",

252 
cm¶di_2
 = "28200000-RU",

253 
cmpwi_3
 = "2c000000XRI",

254 
cmpwi_2
 = "2c000000-RI",

255 
cmpdi_3
 = "2c200000XRI",

256 
cmpdi_2
 = "2c200000-RI",

257 
addic_3
 = "30000000RRI",

259 
addi_3
 = "38000000RR0I",

260 
li_2
 = "38000000RI",

261 
Ï_2
 = "38000000RD",

262 
addis_3
 = "3c000000RR0I",

263 
lis_2
 = "3c000000RI",

264 
lus_2
 = "3c000000RU",

265 
bc_3
 = "40000000AAK",

266 
bş_3
 = "40000001AAK",

267 
bdnz_1
 = "42000000K",

268 
bdz_1
 = "42400000K",

269 
sc_0
 = "44000000",

270 
b_1
 = "48000000J",

271 
bl_1
 = "48000001J",

272 
¾wimi_5
 = "50000000RR~AAA.",

273 
¾wšm_5
 = "54000000RR~AAA.",

274 
¾wnm_5
 = "5c000000RR~RAA.",

275 
Üi_3
 = "60000000RR~U",

276 
nİ_0
 = "60000000",

277 
Üis_3
 = "64000000RR~U",

278 
xÜi_3
 = "68000000RR~U",

279 
xÜis_3
 = "6c000000RR~U",

282 
lwz_2
 = "80000000RD",

283 
lwzu_2
 = "84000000RD",

284 
lbz_2
 = "88000000RD",

285 
lbzu_2
 = "8c000000RD",

286 
¡w_2
 = "90000000RD",

287 
¡wu_2
 = "94000000RD",

288 
¡b_2
 = "98000000RD",

289 
¡bu_2
 = "9c000000RD",

290 
lhz_2
 = "a0000000RD",

291 
lhzu_2
 = "a4000000RD",

292 
lha_2
 = "a8000000RD",

293 
lhau_2
 = "ac000000RD",

294 
¡h_2
 = "b0000000RD",

295 
¡hu_2
 = "b4000000RD",

296 
lmw_2
 = "b8000000RD",

297 
¡mw_2
 = "bc000000RD",

298 
lfs_2
 = "c0000000FD",

299 
lfsu_2
 = "c4000000FD",

300 
lfd_2
 = "c8000000FD",

301 
lfdu_2
 = "cc000000FD",

302 
¡fs_2
 = "d0000000FD",

303 
¡fsu_2
 = "d4000000FD",

304 
¡fd_2
 = "d8000000FD",

305 
¡fdu_2
 = "dc000000FD",

306 
ld_2
 = "e8000000RD", -- 
NYI
: 
di¥Ïûm’t
 
mu¡
 
be
 
divisibË
 
by
 4.

307 
ldu_2
 = "e8000001RD",

308 
lwa_2
 = "e8000002RD",

309 
¡d_2
 = "f8000000RD",

310 
¡du_2
 = "f8000001RD",

312 
subi_3
 = 
	`İ_®Ÿs
("addi_3", 
	`funùiÚ
(
p
èp[3] = "-("..p[3]..")" 
’d
),

313 
subis_3
 = 
	`İ_®Ÿs
("addis_3", 
	`funùiÚ
(
p
èp[3] = "-("..p[3]..")" 
’d
),

314 
subic_3
 = 
	`İ_®Ÿs
("addic_3", 
	`funùiÚ
(
p
èp[3] = "-("..p[3]..")" 
’d
),

315 ["subic._3"] = 
	`İ_®Ÿs
("addic._3", 
	`funùiÚ
(
p
èp[3] = "-("..p[3]..")" 
’d
),

317 
rÙlwi_3
 = 
	`İ_®Ÿs
("¾wšm_5", 
	`funùiÚ
(
p
)

318 
p
[4] = "0";…[5] = "31"

319 
’d
),

320 
rÙrwi_3
 = 
	`İ_®Ÿs
("¾wšm_5", 
	`funùiÚ
(
p
)

321 
p
[3] = "32-("..p[3]..")";…[4] = "0";…[5] = "31"

322 
’d
),

323 
rÙlw_3
 = 
	`İ_®Ÿs
("¾wnm_5", 
	`funùiÚ
(
p
)

324 
p
[4] = "0";…[5] = "31"

325 
’d
),

326 
¦wi_3
 = 
	`İ_®Ÿs
("¾wšm_5", 
	`funùiÚ
(
p
)

327 
p
[5] = "31-("..p[3]..")";…[4] = "0"

328 
’d
),

329 
¤wi_3
 = 
	`İ_®Ÿs
("¾wšm_5", 
	`funùiÚ
(
p
)

330 
p
[4] =…[3];…[3] = "32-("..p[3]..")";…[5] = "31"

331 
’d
),

332 
ş¾wi_3
 = 
	`İ_®Ÿs
("¾wšm_5", 
	`funùiÚ
(
p
)

333 
p
[4] =…[3];…[3] = "0";…[5] = "31"

334 
’d
),

335 
ş¼wi_3
 = 
	`İ_®Ÿs
("¾wšm_5", 
	`funùiÚ
(
p
)

336 
p
[5] = "31-("..p[3]..")";…[3] = "0";…[4] = "0"

337 
’d
),

339 -- 
Prim¬y
 
İcode
 4:

340 
mulhhwu_3
 = "10000010RRR.",

341 
machhwu_3
 = "10000018RRR.",

342 
mulhhw_3
 = "10000050RRR.",

343 
nmachhw_3
 = "1000005cRRR.",

344 
machhwsu_3
 = "10000098RRR.",

345 
machhws_3
 = "100000d8RRR.",

346 
nmachhws_3
 = "100000dcRRR.",

347 
mulchwu_3
 = "10000110RRR.",

348 
macchwu_3
 = "10000118RRR.",

349 
mulchw_3
 = "10000150RRR.",

350 
macchw_3
 = "10000158RRR.",

351 
nmacchw_3
 = "1000015cRRR.",

352 
macchwsu_3
 = "10000198RRR.",

353 
macchws_3
 = "100001d8RRR.",

354 
nmacchws_3
 = "100001dcRRR.",

355 
muÎhw_3
 = "10000350RRR.",

356 
maşhw_3
 = "10000358RRR.",

357 
nmaşhw_3
 = "1000035cRRR.",

358 
maşhwsu_3
 = "10000398RRR.",

359 
maşhws_3
 = "100003d8RRR.",

360 
nmaşhws_3
 = "100003dcRRR.",

361 
machhwuo_3
 = "10000418RRR.",

362 
nmachhwo_3
 = "1000045cRRR.",

363 
machhwsuo_3
 = "10000498RRR.",

364 
machhwso_3
 = "100004d8RRR.",

365 
nmachhwso_3
 = "100004dcRRR.",

366 
macchwuo_3
 = "10000518RRR.",

367 
macchwo_3
 = "10000558RRR.",

368 
nmacchwo_3
 = "1000055cRRR.",

369 
macchwsuo_3
 = "10000598RRR.",

370 
macchwso_3
 = "100005d8RRR.",

371 
nmacchwso_3
 = "100005dcRRR.",

372 
maşhwo_3
 = "10000758RRR.",

373 
nmaşhwo_3
 = "1000075cRRR.",

374 
maşhwsuo_3
 = "10000798RRR.",

375 
maşhwso_3
 = "100007d8RRR.",

376 
nmaşhwso_3
 = "100007dcRRR.",

378 
vaddubm_3
 = "10000000VVV",

379 
vmaxub_3
 = "10000002VVV",

380 
v¾b_3
 = "10000004VVV",

381 
vcm³qub_3
 = "10000006VVV",

382 
vmuloub_3
 = "10000008VVV",

383 
vaddå_3
 = "1000000aVVV",

384 
vmrghb_3
 = "1000000cVVV",

385 
vpkuhum_3
 = "1000000eVVV",

386 
vmhaddshs_4
 = "10000020VVVV",

387 
vmh¿ddshs_4
 = "10000021VVVV",

388 
vmÏdduhm_4
 = "10000022VVVV",

389 
vmsumubm_4
 = "10000024VVVV",

390 
vmsummbm_4
 = "10000025VVVV",

391 
vmsumuhm_4
 = "10000026VVVV",

392 
vmsumuhs_4
 = "10000027VVVV",

393 
vmsumshm_4
 = "10000028VVVV",

394 
vmsumshs_4
 = "10000029VVVV",

395 
v£l_4
 = "1000002aVVVV",

396 
v³rm_4
 = "1000002bVVVV",

397 
v¦doi_4
 = "1000002cVVVP",

398 
v³rmxÜ_4
 = "1000002dVVVV",

399 
vmaddå_4
 = "1000002eVVVV~",

400 
vnmsubå_4
 = "1000002fVVVV~",

401 
vaddeuqm_4
 = "1000003cVVVV",

402 
vaddecuq_4
 = "1000003dVVVV",

403 
vsubeuqm_4
 = "1000003eVVVV",

404 
vsubecuq_4
 = "1000003fVVVV",

405 
vadduhm_3
 = "10000040VVV",

406 
vmaxuh_3
 = "10000042VVV",

407 
v¾h_3
 = "10000044VVV",

408 
vcm³quh_3
 = "10000046VVV",

409 
vmulouh_3
 = "10000048VVV",

410 
vsubå_3
 = "1000004aVVV",

411 
vmrghh_3
 = "1000004cVVV",

412 
vpkuwum_3
 = "1000004eVVV",

413 
vadduwm_3
 = "10000080VVV",

414 
vmaxuw_3
 = "10000082VVV",

415 
v¾w_3
 = "10000084VVV",

416 
vcm³quw_3
 = "10000086VVV",

417 
vmulouw_3
 = "10000088VVV",

418 
vmuluwm_3
 = "10000089VVV",

419 
vmrghw_3
 = "1000008cVVV",

420 
vpkuhus_3
 = "1000008eVVV",

421 
vaddudm_3
 = "100000c0VVV",

422 
vmaxud_3
 = "100000c2VVV",

423 
v¾d_3
 = "100000c4VVV",

424 
vcm³qå_3
 = "100000c6VVV",

425 
vcm³qud_3
 = "100000c7VVV",

426 
vpkuwus_3
 = "100000ceVVV",

427 
vadduqm_3
 = "10000100VVV",

428 
vmaxsb_3
 = "10000102VVV",

429 
v¦b_3
 = "10000104VVV",

430 
vmulosb_3
 = "10000108VVV",

431 
v»å_2
 = "1000010aV-V",

432 
vmrglb_3
 = "1000010cVVV",

433 
vpkshus_3
 = "1000010eVVV",

434 
vaddcuq_3
 = "10000140VVV",

435 
vmaxsh_3
 = "10000142VVV",

436 
v¦h_3
 = "10000144VVV",

437 
vmulosh_3
 = "10000148VVV",

438 
vrsq¹eå_2
 = "1000014aV-V",

439 
vmrglh_3
 = "1000014cVVV",

440 
vpkswus_3
 = "1000014eVVV",

441 
vaddcuw_3
 = "10000180VVV",

442 
vmaxsw_3
 = "10000182VVV",

443 
v¦w_3
 = "10000184VVV",

444 
vmulosw_3
 = "10000188VVV",

445 
vex±eå_2
 = "1000018aV-V",

446 
vmrglw_3
 = "1000018cVVV",

447 
vpkshss_3
 = "1000018eVVV",

448 
vmaxsd_3
 = "100001c2VVV",

449 
v¦_3
 = "100001c4VVV",

450 
vcmpgeå_3
 = "100001c6VVV",

451 
vlogeå_2
 = "100001caV-V",

452 
vpkswss_3
 = "100001ceVVV",

453 
vadduhs_3
 = "10000240VVV",

454 
vmšuh_3
 = "10000242VVV",

455 
v¤h_3
 = "10000244VVV",

456 
vcmpgtuh_3
 = "10000246VVV",

457 
vmuËuh_3
 = "10000248VVV",

458 
vrfiz_2
 = "1000024aV-V",

459 
v¥Éh_3
 = "1000024cVV3",

460 
vupkhsh_2
 = "1000024eV-V",

461 
vmšuw_3
 = "10000282VVV",

462 
vmšud_3
 = "100002c2VVV",

463 
vcmpgtud_3
 = "100002c7VVV",

464 
vrfim_2
 = "100002caV-V",

465 
vcmpgtsb_3
 = "10000306VVV",

466 
vcfux_3
 = "1000030aVVA~",

467 
vaddshs_3
 = "10000340VVV",

468 
vmšsh_3
 = "10000342VVV",

469 
v¤ah_3
 = "10000344VVV",

470 
vcmpgtsh_3
 = "10000346VVV",

471 
vmuËsh_3
 = "10000348VVV",

472 
vcfsx_3
 = "1000034aVVA~",

473 
v¥Éish_2
 = "1000034cVS",

474 
vupkhpx_2
 = "1000034eV-V",

475 
vaddsws_3
 = "10000380VVV",

476 
vmšsw_3
 = "10000382VVV",

477 
v¤aw_3
 = "10000384VVV",

478 
vcmpgtsw_3
 = "10000386VVV",

479 
vmuËsw_3
 = "10000388VVV",

480 
vùuxs_3
 = "1000038aVVA~",

481 
v¥Éisw_2
 = "1000038cVS",

482 
vmšsd_3
 = "100003c2VVV",

483 
v¤ad_3
 = "100003c4VVV",

484 
vcmpbå_3
 = "100003c6VVV",

485 
vcmpgtsd_3
 = "100003c7VVV",

486 
vùsxs_3
 = "100003caVVA~",

487 
vupkÍx_2
 = "100003ceV-V",

488 
vsububm_3
 = "10000400VVV",

490 
vavgub_3
 = "10000402VVV",

491 
vªd_3
 = "10000404VVV",

493 
vmaxå_3
 = "1000040aVVV",

494 
vsubuhm_3
 = "10000440VVV",

496 
vavguh_3
 = "10000442VVV",

497 
vªdc_3
 = "10000444VVV",

499 
vmšå_3
 = "1000044aVVV",

500 
vpkudum_3
 = "1000044eVVV",

501 
vsubuwm_3
 = "10000480VVV",

502 
vavguw_3
 = "10000482VVV",

503 
vÜ_3
 = "10000484VVV",

505 
vpmsumw_3
 = "10000488VVV",

508 
vpkudus_3
 = "100004ceVVV",

509 
vavgsb_3
 = "10000502VVV",

510 
vavgsh_3
 = "10000542VVV",

511 
vÜc_3
 = "10000544VVV",

512 
vb³rmq_3
 = "1000054cVVV",

513 
vpksdus_3
 = "1000054eVVV",

514 
vavgsw_3
 = "10000582VVV",

515 
v¦d_3
 = "100005c4VVV",

517 
vpksdss_3
 = "100005ceVVV",

518 
vsububs_3
 = "10000600VVV",

519 
mfvsü_1
 = "10000604V--",

520 
vsum4ubs_3
 = "10000608VVV",

521 
vsubuhs_3
 = "10000640VVV",

522 
mtvsü_1
 = "10000644--V",

524 
vsum4shs_3
 = "10000648VVV",

525 
vupkhsw_2
 = "1000064eV-V",

526 
vsubuws_3
 = "10000680VVV",

527 
vshasigmaw_4
 = "10000682VVYp",

528 
veqv_3
 = "10000684VVV",

529 
vsum2sws_3
 = "10000688VVV",

530 
vmrgow_3
 = "1000068cVVV",

531 
vshasigmad_4
 = "100006c2VVYp",

532 
v¤d_3
 = "100006c4VVV",

534 
vupklsw_2
 = "100006ceV-V",

535 
vupk¦w_2
 = "100006ceV-V",

536 
vsubsbs_3
 = "10000700VVV",

537 
vşzb_2
 = "10000702V-V",

538 
vpİútb_2
 = "10000703V-V",

540 
vsum4sbs_3
 = "10000708VVV",

541 
vsubshs_3
 = "10000740VVV",

542 
vşzh_2
 = "10000742V-V",

543 
vpİúth_2
 = "10000743V-V",

545 
vsubsws_3
 = "10000780VVV",

546 
vşzw_2
 = "10000782V-V",

547 
vpİútw_2
 = "10000783V-V",

549 
vsumsws_3
 = "10000788VVV",

550 
vmrgew_3
 = "1000078cVVV",

551 
vşzd_2
 = "100007c2V-V",

552 
vpİútd_2
 = "100007c3V-V",

556 -- 
Prim¬y
 
İcode
 19:

557 
müf_2
 = "4c000000XX",

558 
isync_0
 = "4c00012c",

559 
ünÜ_3
 = "4c000042CCC",

560 
ünÙ_2
 = "4c000042CC=",

561 
üªdc_3
 = "4c000102CCC",

562 
üxÜ_3
 = "4c000182CCC",

563 
üşr_1
 = "4c000182C==",

564 
üÇnd_3
 = "4c0001c2CCC",

565 
üªd_3
 = "4c000202CCC",

566 
üeqv_3
 = "4c000242CCC",

567 
ü£t_1
 = "4c000242C==",

568 
üÜc_3
 = "4c000342CCC",

569 
üÜ_3
 = "4c000382CCC",

570 
ümove_2
 = "4c000382CC=",

571 
bşr_2
 = "4c000020AA",

572 
bş¾_2
 = "4c000021AA",

573 
bcùr_2
 = "4c000420AA",

574 
bcù¾_2
 = "4c000421AA",

575 
bù¬_2
 = "4c000460AA",

576 
bù¬l_2
 = "4c000461AA",

577 
bÌ_0
 = "4e800020",

578 
bÌl_0
 = "4e800021",

579 
bùr_0
 = "4e800420",

580 
bù¾_0
 = "4e800421",

582 -- 
Prim¬y
 
İcode
 31:

583 
cmpw_3
 = "7c000000XRR",

584 
cmpw_2
 = "7c000000-RR",

585 
cmpd_3
 = "7c200000XRR",

586 
cmpd_2
 = "7c200000-RR",

587 
tw_3
 = "7c000008ARR",

588 
lv¦_3
 = "7c00000cVRR",

589 
subfc_3
 = "7c000010RRR.",

590 
subc_3
 = "7c000010RRR~.",

591 
mulhdu_3
 = "7c000012RRR.",

592 
addc_3
 = "7c000014RRR.",

593 
mulhwu_3
 = "7c000016RRR.",

594 
i£l_4
 = "7c00001eRRRC",

595 
i£Ît_3
 = "7c00001eRRR",

596 
i£lgt_3
 = "7c00005eRRR",

597 
i£Ëq_3
 = "7c00009eRRR",

598 
mfü_1
 = "7c000026R",

599 
mfoüf_2
 = "7c100026RG",

600 
mtüf_2
 = "7c000120GR",

601 
mtoüf_2
 = "7c100120GR",

602 
lw¬x_3
 = "7c000028RR0R",

603 
ldx_3
 = "7c00002aRR0R",

604 
lwzx_3
 = "7c00002eRR0R",

605 
¦w_3
 = "7c000030RR~R.",

606 
úzw_2
 = "7c000034RR~",

607 
¦d_3
 = "7c000036RR~R.",

608 
ªd_3
 = "7c000038RR~R.",

609 
cm¶w_3
 = "7c000040XRR",

610 
cm¶w_2
 = "7c000040-RR",

611 
cm¶d_3
 = "7c200040XRR",

612 
cm¶d_2
 = "7c200040-RR",

613 
lv¤_3
 = "7c00004cVRR",

614 
subf_3
 = "7c000050RRR.",

615 
sub_3
 = "7c000050RRR~.",

616 
lb¬x_3
 = "7c000068RR0R",

617 
ldux_3
 = "7c00006aRR0R",

618 
dcb¡_2
 = "7c00006c-RR",

619 
lwzux_3
 = "7c00006eRR0R",

620 
úzd_2
 = "7c000074RR~",

621 
ªdc_3
 = "7c000078RR~R.",

622 
td_3
 = "7c000088ARR",

623 
lvewx_3
 = "7c00008eVRR",

624 
mulhd_3
 = "7c000092RRR.",

625 
addg6s_3
 = "7c000094RRR",

626 
mulhw_3
 = "7c000096RRR.",

627 
dlmzb_3
 = "7c00009cRR~R.",

628 
ld¬x_3
 = "7c0000a8RR0R",

629 
dcbf_2
 = "7c0000ac-RR",

630 
lbzx_3
 = "7c0000aeRR0R",

631 
lvx_3
 = "7c0000ceVRR",

632 
Ãg_2
 = "7c0000d0RR.",

633 
lh¬x_3
 = "7c0000e8RR0R",

634 
lbzux_3
 = "7c0000eeRR0R",

635 
pİútb_2
 = "7c0000f4RR~",

636 
nÙ_2
 = "7c0000f8RR~%.",

637 
nÜ_3
 = "7c0000f8RR~R.",

638 
¡vebx_3
 = "7c00010eVRR",

639 
subã_3
 = "7c000110RRR.",

640 
sube_3
 = "7c000110RRR~.",

641 
adde_3
 = "7c000114RRR.",

642 
¡dx_3
 = "7c00012aRR0R",

644 
¡wx_3
 = "7c00012eRR0R",

645 
´tyw_2
 = "7c000134RR~",

646 
¡vehx_3
 = "7c00014eVRR",

647 
¡dux_3
 = "7c00016aRR0R",

649 
¡wux_3
 = "7c00016eRR0R",

650 
´tyd_2
 = "7c000174RR~",

651 
¡vewx_3
 = "7c00018eVRR",

652 
subfze_2
 = "7c000190RR.",

653 
addze_2
 = "7c000194RR.",

655 
¡bx_3
 = "7c0001aeRR0R",

656 
¡vx_3
 = "7c0001ceVRR",

657 
subfme_2
 = "7c0001d0RR.",

658 
muÎd_3
 = "7c0001d2RRR.",

659 
addme_2
 = "7c0001d4RR.",

660 
muÎw_3
 = "7c0001d6RRR.",

661 
dcbt¡_2
 = "7c0001ec-RR",

662 
¡bux_3
 = "7c0001eeRR0R",

663 
b³rmd_3
 = "7c0001f8RR~R",

664 
lv•xl_3
 = "7c00020eVRR",

665 
add_3
 = "7c000214RRR.",

666 
lq¬x_3
 = "7c000228R:R0R",

667 
dcbt_2
 = "7c00022c-RR",

668 
lhzx_3
 = "7c00022eRR0R",

669 
cdtbcd_2
 = "7c000234RR~",

670 
eqv_3
 = "7c000238RR~R.",

671 
lv•x_3
 = "7c00024eVRR",

672 
eciwx_3
 = "7c00026cRR0R",

673 
lhzux_3
 = "7c00026eRR0R",

674 
cbcdtd_2
 = "7c000274RR~",

675 
xÜ_3
 = "7c000278RR~R.",

676 
mf¥efsü_1
 = "7c0082a6R",

677 
mfx”_1
 = "7c0102a6R",

678 
mær_1
 = "7c0802a6R",

679 
mfùr_1
 = "7c0902a6R",

680 
lwax_3
 = "7c0002aaRR0R",

681 
lhax_3
 = "7c0002aeRR0R",

682 
máb_1
 = "7c0c42e6R",

683 
mábu_1
 = "7c0d42e6R",

684 
lvxl_3
 = "7c0002ceVRR",

685 
lwaux_3
 = "7c0002eaRR0R",

686 
lhaux_3
 = "7c0002eeRR0R",

687 
pİútw_2
 = "7c0002f4RR~",

688 
divdeu_3
 = "7c000312RRR.",

689 
divweu_3
 = "7c000316RRR.",

690 
¡hx_3
 = "7c00032eRR0R",

691 
Üc_3
 = "7c000338RR~R.",

692 
ecowx_3
 = "7c00036cRR0R",

693 
¡hux_3
 = "7c00036eRR0R",

694 
Ü_3
 = "7c000378RR~R.",

695 
mr_2
 = "7c000378RR~%.",

696 
divdu_3
 = "7c000392RRR.",

697 
divwu_3
 = "7c000396RRR.",

698 
mt¥efsü_1
 = "7c0083a6R",

699 
mtx”_1
 = "7c0103a6R",

700 
mr_1
 = "7c0803a6R",

701 
mtùr_1
 = "7c0903a6R",

702 
dcbi_2
 = "7c0003ac-RR",

703 
Çnd_3
 = "7c0003b8RR~R.",

704 
d¢_2
 = "7c0003c6-RR",

705 
¡vxl_3
 = "7c0003ceVRR",

706 
divd_3
 = "7c0003d2RRR.",

707 
divw_3
 = "7c0003d6RRR.",

708 
pİútd_2
 = "7c0003f4RR~",

709 
cmpb_3
 = "7c0003f8RR~R.",

710 
müxr_1
 = "7c000400X",

711 
lbdx_3
 = "7c000406RRR",

712 
subfco_3
 = "7c000410RRR.",

713 
subco_3
 = "7c000410RRR~.",

714 
addco_3
 = "7c000414RRR.",

715 
ldbrx_3
 = "7c000428RR0R",

716 
lswx_3
 = "7c00042aRR0R",

717 
lwbrx_3
 = "7c00042cRR0R",

718 
lfsx_3
 = "7c00042eFR0R",

719 
¤w_3
 = "7c000430RR~R.",

720 
¤d_3
 = "7c000436RR~R.",

721 
lhdx_3
 = "7c000446RRR",

722 
subfo_3
 = "7c000450RRR.",

723 
subo_3
 = "7c000450RRR~.",

724 
lfsux_3
 = "7c00046eFR0R",

725 
lwdx_3
 = "7c000486RRR",

726 
lswi_3
 = "7c0004aaRR0A",

727 
sync_0
 = "7c0004ac",

728 
lwsync_0
 = "7c2004ac",

729 
±esync_0
 = "7c4004ac",

730 
lfdx_3
 = "7c0004aeFR0R",

731 
lddx_3
 = "7c0004c6RRR",

732 
Ãgo_2
 = "7c0004d0RR.",

733 
lfdux_3
 = "7c0004eeFR0R",

734 
¡bdx_3
 = "7c000506RRR",

735 
subão_3
 = "7c000510RRR.",

736 
subeo_3
 = "7c000510RRR~.",

737 
addeo_3
 = "7c000514RRR.",

738 
¡dbrx_3
 = "7c000528RR0R",

739 
¡swx_3
 = "7c00052aRR0R",

740 
¡wbrx_3
 = "7c00052cRR0R",

741 
¡fsx_3
 = "7c00052eFR0R",

742 
¡hdx_3
 = "7c000546RRR",

744 
¡fsux_3
 = "7c00056eFR0R",

745 
¡wdx_3
 = "7c000586RRR",

746 
subfzeo_2
 = "7c000590RR.",

747 
addzeo_2
 = "7c000594RR.",

748 
¡swi_3
 = "7c0005aaRR0A",

750 
¡fdx_3
 = "7c0005aeFR0R",

751 
¡ddx_3
 = "7c0005c6RRR",

752 
subfmeo_2
 = "7c0005d0RR.",

753 
muÎdo_3
 = "7c0005d2RRR.",

754 
addmeo_2
 = "7c0005d4RR.",

755 
muÎwo_3
 = "7c0005d6RRR.",

756 
dcba_2
 = "7c0005ec-RR",

757 
¡fdux_3
 = "7c0005eeFR0R",

758 
¡v•xl_3
 = "7c00060eVRR",

759 
addo_3
 = "7c000614RRR.",

760 
lhbrx_3
 = "7c00062cRR0R",

761 
lfdpx_3
 = "7c00062eF:RR",

762 
¤aw_3
 = "7c000630RR~R.",

763 
¤ad_3
 = "7c000634RR~R.",

764 
lfddx_3
 = "7c000646FRR",

765 
¡v•x_3
 = "7c00064eVRR",

766 
¤awi_3
 = "7c000670RR~A.",

767 
¤adi_3
 = "7c000674RR~H.",

768 
e›io_0
 = "7c0006ac",

769 
lfiwax_3
 = "7c0006aeFR0R",

770 
divdeuo_3
 = "7c000712RRR.",

771 
divweuo_3
 = "7c000716RRR.",

772 
¡hbrx_3
 = "7c00072cRR0R",

773 
¡fdpx_3
 = "7c00072eF:RR",

774 
extsh_2
 = "7c000734RR~.",

775 
¡fddx_3
 = "7c000746FRR",

776 
divdeo_3
 = "7c000752RRR.",

777 
divweo_3
 = "7c000756RRR.",

778 
extsb_2
 = "7c000774RR~.",

779 
divduo_3
 = "7c000792RRR.",

780 
divwou_3
 = "7c000796RRR.",

781 
icbi_2
 = "7c0007ac-RR",

782 
¡fiwx_3
 = "7c0007aeFR0R",

783 
extsw_2
 = "7c0007b4RR~.",

784 
divdo_3
 = "7c0007d2RRR.",

785 
divwo_3
 = "7c0007d6RRR.",

786 
dcbz_2
 = "7c0007ec-RR",

793 
tcheck_1
 = "7c00059cX",

805 
lxsiwzx_3
 = "7c000018QRR",

806 
lxsiwax_3
 = "7c000098QRR",

807 
mfv¤d_2
 = "7c000066-Rq",

808 
mfv¤wz_2
 = "7c0000e6-Rq",

809 
¡xsiwx_3
 = "7c000118QRR",

810 
mtv¤d_2
 = "7c000166QR",

811 
mtv¤wa_2
 = "7c0001a6QR",

812 
lxvdsx_3
 = "7c000298QRR",

813 
lxs¥x_3
 = "7c000418QRR",

814 
lxsdx_3
 = "7c000498QRR",

815 
¡xs¥x_3
 = "7c000518QRR",

816 
¡xsdx_3
 = "7c000598QRR",

817 
lxvw4x_3
 = "7c000618QRR",

818 
lxvd2x_3
 = "7c000698QRR",

819 
¡xvw4x_3
 = "7c000718QRR",

820 
¡xvd2x_3
 = "7c000798QRR",

822 -- 
Prim¬y
 
İcode
 30:

823 
¾diş_4
 = "78000000RR~HM.",

824 
¾diü_4
 = "78000004RR~HM.",

825 
¾dic_4
 = "78000008RR~HM.",

826 
¾dimi_4
 = "7800000cRR~HM.",

827 
¾dş_4
 = "78000010RR~RM.",

828 
¾dü_4
 = "78000012RR~RM.",

830 
rÙldi_3
 = 
	`İ_®Ÿs
("¾diş_4", 
	`funùiÚ
(
p
)

831 
p
[4] = "0"

832 
’d
),

833 
rÙrdi_3
 = 
	`İ_®Ÿs
("¾diş_4", 
	`funùiÚ
(
p
)

834 
p
[3] = "64-("..p[3]..")";…[4] = "0"

835 
’d
),

836 
rÙld_3
 = 
	`İ_®Ÿs
("¾dş_4", 
	`funùiÚ
(
p
)

837 
p
[4] = "0"

838 
’d
),

839 
¦di_3
 = 
	`İ_®Ÿs
("¾diü_4", 
	`funùiÚ
(
p
)

840 
p
[4] = "63-("..p[3]..")"

841 
’d
),

842 
¤di_3
 = 
	`İ_®Ÿs
("¾diş_4", 
	`funùiÚ
(
p
)

843 
p
[4] =…[3];…[3] = "64-("..p[3]..")"

844 
’d
),

845 
ş¾di_3
 = 
	`İ_®Ÿs
("¾diş_4", 
	`funùiÚ
(
p
)

846 
p
[4] =…[3];…[3] = "0"

847 
’d
),

848 
ş¼di_3
 = 
	`İ_®Ÿs
("¾diü_4", 
	`funùiÚ
(
p
)

849 
p
[4] = "63-("..p[3]..")";…[3] = "0"

850 
’d
),

852 -- 
Prim¬y
 
İcode
 56:

853 
lq_2
 = "e0000000R:D", -- 
NYI
: 
di¥Ïûm’t
 
mu¡
 
be
 
divisibË
 
by
 8.

855 -- 
Prim¬y
 
İcode
 57:

856 
lfdp_2
 = "e4000000F:D", -- 
NYI
: 
di¥Ïûm’t
 
mu¡
 
be
 
divisibË
 
by
 4.

858 -- 
Prim¬y
 
İcode
 59:

859 
fdivs_3
 = "ec000024FFF.",

860 
fsubs_3
 = "ec000028FFF.",

861 
çdds_3
 = "ec00002aFFF.",

862 
fsq¹s_2
 = "ec00002cF-F.",

863 
äes_2
 = "ec000030F-F.",

864 
fmuls_3
 = "ec000032FF-F.",

865 
äsq¹es_2
 = "ec000034F-F.",

866 
fmsubs_4
 = "ec000038FFFF~.",

867 
fmadds_4
 = "ec00003aFFFF~.",

868 
âmsubs_4
 = "ec00003cFFFF~.",

869 
âmadds_4
 = "ec00003eFFFF~.",

870 
fcfids_2
 = "ec00069cF-F.",

871 
fcfidus_2
 = "ec00079cF-F.",

873 
dadd_3
 = "ec000004FFF.",

874 
dqua_4
 = "ec000006FFFZ.",

875 
dmul_3
 = "ec000044FFF.",

876 
d¼nd_4
 = "ec000046FFFZ.",

877 
dsşi_3
 = "ec000084FF6.",

878 
dquai_4
 = "ec000086SF~FZ.",

879 
dsüi_3
 = "ec0000c4FF6.",

880 
drštx_4
 = "ec0000c61F~FZ.",

881 
dcmpo_3
 = "ec000104XFF",

882 
dt¡ex_3
 = "ec000144XFF",

883 
dt¡dc_3
 = "ec000184XF6",

884 
dt¡dg_3
 = "ec0001c4XF6",

885 
dršŠ_4
 = "ec0001c61F~FZ.",

886 
dùdp_2
 = "ec000204F-F.",

887 
dùfix_2
 = "ec000244F-F.",

888 
ddedpd_3
 = "ec000284ZF~F.",

889 
dxex_2
 = "ec0002c4F-F.",

890 
dsub_3
 = "ec000404FFF.",

891 
ddiv_3
 = "ec000444FFF.",

892 
dcmpu_3
 = "ec000504XFF",

893 
dt¡sf_3
 = "ec000544XFF",

894 
dr¥_2
 = "ec000604F-F.",

895 
dcffix_2
 = "ec000644F-F.",

896 
d’bcd_3
 = "ec000684YF~F.",

897 
d›x_3
 = "ec0006c4FFF.",

899 -- 
Prim¬y
 
İcode
 60:

900 
x§dd¥_3
 = "f0000000QQQ",

901 
xsmadda¥_3
 = "f0000008QQQ",

902 
xx¦dwi_4
 = "f0000010QQQz",

903 
x¤sq¹e¥_2
 = "f0000028Q-Q",

904 
xssq¹¥_2
 = "f000002cQ-Q",

905 
xx£l_4
 = "f0000030QQQQ",

906 
xssub¥_3
 = "f0000040QQQ",

907 
xsmaddm¥_3
 = "f0000048QQQ",

908 
xx³rmdi_4
 = "f0000050QQQz",

909 
x¤e¥_2
 = "f0000068Q-Q",

910 
xsmul¥_3
 = "f0000080QQQ",

911 
xsmsuba¥_3
 = "f0000088QQQ",

912 
xxmrghw_3
 = "f0000090QQQ",

913 
xsdiv¥_3
 = "f00000c0QQQ",

914 
xsmsubm¥_3
 = "f00000c8QQQ",

915 
x§dddp_3
 = "f0000100QQQ",

916 
xsmaddadp_3
 = "f0000108QQQ",

917 
xscmpudp_3
 = "f0000118XQQ",

918 
xscvdpuxws_2
 = "f0000120Q-Q",

919 
x¤dpi_2
 = "f0000124Q-Q",

920 
x¤sq¹edp_2
 = "f0000128Q-Q",

921 
xssq¹dp_2
 = "f000012cQ-Q",

922 
xssubdp_3
 = "f0000140QQQ",

923 
xsmaddmdp_3
 = "f0000148QQQ",

924 
xscmpodp_3
 = "f0000158XQQ",

925 
xscvdpsxws_2
 = "f0000160Q-Q",

926 
x¤dpiz_2
 = "f0000164Q-Q",

927 
x¤edp_2
 = "f0000168Q-Q",

928 
xsmuldp_3
 = "f0000180QQQ",

929 
xsmsubadp_3
 = "f0000188QQQ",

930 
xxmrglw_3
 = "f0000190QQQ",

931 
x¤dp_2
 = "f00001a4Q-Q",

932 
x¡sq¹dp_2
 = "f00001a8X-Q",

933 
x¤dpic_2
 = "f00001acQ-Q",

934 
xsdivdp_3
 = "f00001c0QQQ",

935 
xsmsubmdp_3
 = "f00001c8QQQ",

936 
x¤dpim_2
 = "f00001e4Q-Q",

937 
x¡divdp_3
 = "f00001e8XQQ",

938 
xvadd¥_3
 = "f0000200QQQ",

939 
xvmadda¥_3
 = "f0000208QQQ",

940 
xvcm³q¥_3
 = "f0000218QQQ",

941 
xvcv¥uxws_2
 = "f0000220Q-Q",

942 
xvr¥i_2
 = "f0000224Q-Q",

943 
xvrsq¹e¥_2
 = "f0000228Q-Q",

944 
xvsq¹¥_2
 = "f000022cQ-Q",

945 
xvsub¥_3
 = "f0000240QQQ",

946 
xvmaddm¥_3
 = "f0000248QQQ",

947 
xvcmpgt¥_3
 = "f0000258QQQ",

948 
xvcv¥sxws_2
 = "f0000260Q-Q",

949 
xvr¥iz_2
 = "f0000264Q-Q",

950 
xv»¥_2
 = "f0000268Q-Q",

951 
xvmul¥_3
 = "f0000280QQQ",

952 
xvmsuba¥_3
 = "f0000288QQQ",

953 
xx¥Éw_3
 = "f0000290QQg~",

954 
xvcmpge¥_3
 = "f0000298QQQ",

955 
xvcvuxw¥_2
 = "f00002a0Q-Q",

956 
xvr¥_2
 = "f00002a4Q-Q",

957 
xvtsq¹¥_2
 = "f00002a8X-Q",

958 
xvr¥ic_2
 = "f00002acQ-Q",

959 
xvdiv¥_3
 = "f00002c0QQQ",

960 
xvmsubm¥_3
 = "f00002c8QQQ",

961 
xvcvsxw¥_2
 = "f00002e0Q-Q",

962 
xvr¥im_2
 = "f00002e4Q-Q",

963 
xvtdiv¥_3
 = "f00002e8XQQ",

964 
xvadddp_3
 = "f0000300QQQ",

965 
xvmaddadp_3
 = "f0000308QQQ",

966 
xvcm³qdp_3
 = "f0000318QQQ",

967 
xvcvdpuxws_2
 = "f0000320Q-Q",

968 
xvrdpi_2
 = "f0000324Q-Q",

969 
xvrsq¹edp_2
 = "f0000328Q-Q",

970 
xvsq¹dp_2
 = "f000032cQ-Q",

971 
xvsubdp_3
 = "f0000340QQQ",

972 
xvmaddmdp_3
 = "f0000348QQQ",

973 
xvcmpgtdp_3
 = "f0000358QQQ",

974 
xvcvdpsxws_2
 = "f0000360Q-Q",

975 
xvrdpiz_2
 = "f0000364Q-Q",

976 
xv»dp_2
 = "f0000368Q-Q",

977 
xvmuldp_3
 = "f0000380QQQ",

978 
xvmsubadp_3
 = "f0000388QQQ",

979 
xvcmpgedp_3
 = "f0000398QQQ",

980 
xvcvuxwdp_2
 = "f00003a0Q-Q",

981 
xvrdp_2
 = "f00003a4Q-Q",

982 
xvtsq¹dp_2
 = "f00003a8X-Q",

983 
xvrdpic_2
 = "f00003acQ-Q",

984 
xvdivdp_3
 = "f00003c0QQQ",

985 
xvmsubmdp_3
 = "f00003c8QQQ",

986 
xvcvsxwdp_2
 = "f00003e0Q-Q",

987 
xvrdpim_2
 = "f00003e4Q-Q",

988 
xvtdivdp_3
 = "f00003e8XQQ",

989 
x¢madda¥_3
 = "f0000408QQQ",

990 
xxÏnd_3
 = "f0000410QQQ",

991 
xscvdp¥_2
 = "f0000424Q-Q",

992 
xscvdp¥n_2
 = "f000042cQ-Q",

993 
x¢maddm¥_3
 = "f0000448QQQ",

994 
xxÏndc_3
 = "f0000450QQQ",

995 
x¤¥_2
 = "f0000464Q-Q",

996 
x¢msuba¥_3
 = "f0000488QQQ",

997 
xxlÜ_3
 = "f0000490QQQ",

998 
xscvuxd¥_2
 = "f00004a0Q-Q",

999 
x¢msubm¥_3
 = "f00004c8QQQ",

1000 
xxlxÜ_3
 = "f00004d0QQQ",

1001 
xscvsxd¥_2
 = "f00004e0Q-Q",

1002 
xsmaxdp_3
 = "f0000500QQQ",

1003 
x¢maddadp_3
 = "f0000508QQQ",

1004 
xxÊÜ_3
 = "f0000510QQQ",

1005 
xscvdpuxds_2
 = "f0000520Q-Q",

1006 
xscv¥dp_2
 = "f0000524Q-Q",

1007 
xscv¥d²_2
 = "f000052cQ-Q",

1008 
xsmšdp_3
 = "f0000540QQQ",

1009 
x¢maddmdp_3
 = "f0000548QQQ",

1010 
xxlÜc_3
 = "f0000550QQQ",

1011 
xscvdpsxds_2
 = "f0000560Q-Q",

1012 
x§bsdp_2
 = "f0000564Q-Q",

1013 
xsısgndp_3
 = "f0000580QQQ",

1014 
x¢msubadp_3
 = "f0000588QQQ",

1015 
xxÊªd_3
 = "f0000590QQQ",

1016 
xscvuxddp_2
 = "f00005a0Q-Q",

1017 
x¢absdp_2
 = "f00005a4Q-Q",

1018 
x¢msubmdp_3
 = "f00005c8QQQ",

1019 
xxËqv_3
 = "f00005d0QQQ",

1020 
xscvsxddp_2
 = "f00005e0Q-Q",

1021 
x¢egdp_2
 = "f00005e4Q-Q",

1022 
xvmax¥_3
 = "f0000600QQQ",

1023 
xvnmadda¥_3
 = "f0000608QQQ",

1025 
xvcv¥uxds_2
 = "f0000620Q-Q",

1026 
xvcvdp¥_2
 = "f0000624Q-Q",

1027 
xvmš¥_3
 = "f0000640QQQ",

1028 
xvnmaddm¥_3
 = "f0000648QQQ",

1030 
xvcv¥sxds_2
 = "f0000660Q-Q",

1031 
xvabs¥_2
 = "f0000664Q-Q",

1032 
xvısgn¥_3
 = "f0000680QQQ",

1033 
xvnmsuba¥_3
 = "f0000688QQQ",

1035 
xvcvuxd¥_2
 = "f00006a0Q-Q",

1036 
xvÇbs¥_2
 = "f00006a4Q-Q",

1037 
xvnmsubm¥_3
 = "f00006c8QQQ",

1038 
xvcvsxd¥_2
 = "f00006e0Q-Q",

1039 
xvÃg¥_2
 = "f00006e4Q-Q",

1040 
xvmaxdp_3
 = "f0000700QQQ",

1041 
xvnmaddadp_3
 = "f0000708QQQ",

1043 
xvcvdpuxds_2
 = "f0000720Q-Q",

1044 
xvcv¥dp_2
 = "f0000724Q-Q",

1045 
xvmšdp_3
 = "f0000740QQQ",

1046 
xvnmaddmdp_3
 = "f0000748QQQ",

1048 
xvcvdpsxds_2
 = "f0000760Q-Q",

1049 
xvabsdp_2
 = "f0000764Q-Q",

1050 
xvısgndp_3
 = "f0000780QQQ",

1051 
xvnmsubadp_3
 = "f0000788QQQ",

1053 
xvcvuxddp_2
 = "f00007a0Q-Q",

1054 
xvÇbsdp_2
 = "f00007a4Q-Q",

1055 
xvnmsubmdp_3
 = "f00007c8QQQ",

1056 
xvcvsxddp_2
 = "f00007e0Q-Q",

1057 
xvÃgdp_2
 = "f00007e4Q-Q",

1059 -- 
Prim¬y
 
İcode
 61:

1060 
¡fdp_2
 = "f4000000F:D", -- 
NYI
: 
di¥Ïûm’t
 
mu¡
 
be
 
divisibË
 
by
 4.

1062 -- 
Prim¬y
 
İcode
 62:

1063 
¡q_2
 = "f8000002R:D", -- 
NYI
: 
di¥Ïûm’t
 
mu¡
 
be
 
divisibË
 
by
 8.

1065 -- 
Prim¬y
 
İcode
 63:

1066 
fdiv_3
 = "fc000024FFF.",

1067 
fsub_3
 = "fc000028FFF.",

1068 
çdd_3
 = "fc00002aFFF.",

1069 
fsq¹_2
 = "fc00002cF-F.",

1070 
f£l_4
 = "fc00002eFFFF~.",

1071 
äe_2
 = "fc000030F-F.",

1072 
fmul_3
 = "fc000032FF-F.",

1073 
äsq¹e_2
 = "fc000034F-F.",

1074 
fmsub_4
 = "fc000038FFFF~.",

1075 
fmadd_4
 = "fc00003aFFFF~.",

1076 
âmsub_4
 = "fc00003cFFFF~.",

1077 
âmadd_4
 = "fc00003eFFFF~.",

1078 
fcmpu_3
 = "fc000000XFF",

1079 
fısgn_3
 = "fc000010FFF.",

1080 
fcmpo_3
 = "fc000040XFF",

1081 
mtfsb1_1
 = "fc00004cA",

1082 
âeg_2
 = "fc000050F-F.",

1083 
müfs_2
 = "fc000080XX",

1084 
mtfsb0_1
 = "fc00008cA",

1085 
fmr_2
 = "fc000090F-F.",

1086 
ä¥_2
 = "fc000018F-F.",

1087 
fùiw_2
 = "fc00001cF-F.",

1088 
fùiwz_2
 = "fc00001eF-F.",

1089 
ádiv_2
 = "fc000100X-F.",

1090 
fùiwu_2
 = "fc00011cF-F.",

1091 
fùiwuz_2
 = "fc00011eF-F.",

1092 
mtfsfi_2
 = "fc00010cAA", -- 
NYI
: 
upshiá
.

1093 
âabs_2
 = "fc000110F-F.",

1094 
ásq¹_2
 = "fc000140X-F.",

1095 
çbs_2
 = "fc000210F-F.",

1096 
äš_2
 = "fc000310F-F.",

1097 
äiz_2
 = "fc000350F-F.",

1098 
ä_2
 = "fc000390F-F.",

1099 
äim_2
 = "fc0003d0F-F.",

1100 
mffs_1
 = "fc00048eF.",

1101 -- 
NYI
: 
mtfsf
, 
mtfsb0
, 
mtfsb1
.

1102 
fùid_2
 = "fc00065cF-F.",

1103 
fùidz_2
 = "fc00065eF-F.",

1104 
fmrgow_3
 = "fc00068cFFF",

1105 
fcfid_2
 = "fc00069cF-F.",

1106 
fùidu_2
 = "fc00075cF-F.",

1107 
fùiduz_2
 = "fc00075eF-F.",

1108 
fmrgew_3
 = "fc00078cFFF",

1109 
fcfidu_2
 = "fc00079cF-F.",

1111 
daddq_3
 = "fc000004F:F:F:.",

1112 
dquaq_4
 = "fc000006F:F:F:Z.",

1113 
dmulq_3
 = "fc000044F:F:F:.",

1114 
d¼ndq_4
 = "fc000046F:F:F:Z.",

1115 
dsşiq_3
 = "fc000084F:F:6.",

1116 
dquaiq_4
 = "fc000086SF:~F:Z.",

1117 
dsüiq_3
 = "fc0000c4F:F:6.",

1118 
drštxq_4
 = "fc0000c61F:~F:Z.",

1119 
dcmpoq_3
 = "fc000104XF:F:",

1120 
dt¡exq_3
 = "fc000144XF:F:",

1121 
dt¡dcq_3
 = "fc000184XF:6",

1122 
dt¡dgq_3
 = "fc0001c4XF:6",

1123 
dršŠq_4
 = "fc0001c61F:~F:Z.",

1124 
dùqpq_2
 = "fc000204F:-F:.",

1125 
dùfixq_2
 = "fc000244F:-F:.",

1126 
ddedpdq_3
 = "fc000284ZF:~F:.",

1127 
dxexq_2
 = "fc0002c4F:-F:.",

1128 
dsubq_3
 = "fc000404F:F:F:.",

1129 
ddivq_3
 = "fc000444F:F:F:.",

1130 
dcmpuq_3
 = "fc000504XF:F:",

1131 
dt¡sfq_3
 = "fc000544XF:F:",

1132 
drdpq_2
 = "fc000604F:-F:.",

1133 
dcffixq_2
 = "fc000644F:-F:.",

1134 
d’bcdq_3
 = "fc000684YF:~F:.",

1135 
d›xq_3
 = "fc0006c4F:FF:.",

1137 -- 
Prim¬y
 
İcode
 4, 
SPE
 
APU
 
ex‹nsiÚ
:

1138 
evaddw_3
 = "10000200RRR",

1139 
evaddiw_3
 = "10000202RAR~",

1140 
evsubw_3
 = "10000204RRR~",

1141 
evsubiw_3
 = "10000206RAR~",

1142 
evabs_2
 = "10000208RR",

1143 
evÃg_2
 = "10000209RR",

1144 
evextsb_2
 = "1000020aRR",

1145 
evextsh_2
 = "1000020bRR",

1146 
evºdw_2
 = "1000020cRR",

1147 
evúzw_2
 = "1000020dRR",

1148 
evúsw_2
 = "1000020eRR",

1149 
bršc_3
 = "1000020fRRR",

1150 
evªd_3
 = "10000211RRR",

1151 
evªdc_3
 = "10000212RRR",

1152 
evxÜ_3
 = "10000216RRR",

1153 
evÜ_3
 = "10000217RRR",

1154 
evmr_2
 = "10000217RR=",

1155 
evnÜ_3
 = "10000218RRR",

1156 
evnÙ_2
 = "10000218RR=",

1157 
eveqv_3
 = "10000219RRR",

1158 
evÜc_3
 = "1000021bRRR",

1159 
evÇnd_3
 = "1000021eRRR",

1160 
ev¤wu_3
 = "10000220RRR",

1161 
ev¤ws_3
 = "10000221RRR",

1162 
ev¤wiu_3
 = "10000222RRA",

1163 
ev¤wis_3
 = "10000223RRA",

1164 
ev¦w_3
 = "10000224RRR",

1165 
ev¦wi_3
 = "10000226RRA",

1166 
ev¾w_3
 = "10000228RRR",

1167 
ev¥Ïti_2
 = "10000229RS",

1168 
ev¾wi_3
 = "1000022aRRA",

1169 
ev¥Ïtfi_2
 = "1000022bRS",

1170 
evm”gehi_3
 = "1000022cRRR",

1171 
evm”g–o_3
 = "1000022dRRR",

1172 
evcmpgtu_3
 = "10000230XRR",

1173 
evcmpgtu_2
 = "10000230-RR",

1174 
evcmpgts_3
 = "10000231XRR",

1175 
evcmpgts_2
 = "10000231-RR",

1176 
evcm¶tu_3
 = "10000232XRR",

1177 
evcm¶tu_2
 = "10000232-RR",

1178 
evcm¶ts_3
 = "10000233XRR",

1179 
evcm¶ts_2
 = "10000233-RR",

1180 
evcm³q_3
 = "10000234XRR",

1181 
evcm³q_2
 = "10000234-RR",

1182 
ev£l_4
 = "10000278RRRW",

1183 
ev£l_3
 = "10000278RRR",

1184 
evf§dd_3
 = "10000280RRR",

1185 
evfssub_3
 = "10000281RRR",

1186 
evf§bs_2
 = "10000284RR",

1187 
evf¢abs_2
 = "10000285RR",

1188 
evf¢eg_2
 = "10000286RR",

1189 
evfsmul_3
 = "10000288RRR",

1190 
evfsdiv_3
 = "10000289RRR",

1191 
evfscmpgt_3
 = "1000028cXRR",

1192 
evfscmpgt_2
 = "1000028c-RR",

1193 
evfscm¶t_3
 = "1000028dXRR",

1194 
evfscm¶t_2
 = "1000028d-RR",

1195 
evfscm³q_3
 = "1000028eXRR",

1196 
evfscm³q_2
 = "1000028e-RR",

1197 
evfscfui_2
 = "10000290R-R",

1198 
evfscfsi_2
 = "10000291R-R",

1199 
evfscfuf_2
 = "10000292R-R",

1200 
evfscfsf_2
 = "10000293R-R",

1201 
evfsùui_2
 = "10000294R-R",

1202 
evfsùsi_2
 = "10000295R-R",

1203 
evfsùuf_2
 = "10000296R-R",

1204 
evfsùsf_2
 = "10000297R-R",

1205 
evfsùuiz_2
 = "10000298R-R",

1206 
evfsùsiz_2
 = "1000029aR-R",

1207 
evf¡¡gt_3
 = "1000029cXRR",

1208 
evf¡¡gt_2
 = "1000029c-RR",

1209 
evf¡¡É_3
 = "1000029dXRR",

1210 
evf¡¡É_2
 = "1000029d-RR",

1211 
evf¡¡eq_3
 = "1000029eXRR",

1212 
evf¡¡eq_2
 = "1000029e-RR",

1213 
ef§dd_3
 = "100002c0RRR",

1214 
efssub_3
 = "100002c1RRR",

1215 
ef§bs_2
 = "100002c4RR",

1216 
ef¢abs_2
 = "100002c5RR",

1217 
ef¢eg_2
 = "100002c6RR",

1218 
efsmul_3
 = "100002c8RRR",

1219 
efsdiv_3
 = "100002c9RRR",

1220 
efscmpgt_3
 = "100002ccXRR",

1221 
efscmpgt_2
 = "100002cc-RR",

1222 
efscm¶t_3
 = "100002cdXRR",

1223 
efscm¶t_2
 = "100002cd-RR",

1224 
efscm³q_3
 = "100002ceXRR",

1225 
efscm³q_2
 = "100002ce-RR",

1226 
efscfd_2
 = "100002cfR-R",

1227 
efscfui_2
 = "100002d0R-R",

1228 
efscfsi_2
 = "100002d1R-R",

1229 
efscfuf_2
 = "100002d2R-R",

1230 
efscfsf_2
 = "100002d3R-R",

1231 
efsùui_2
 = "100002d4R-R",

1232 
efsùsi_2
 = "100002d5R-R",

1233 
efsùuf_2
 = "100002d6R-R",

1234 
efsùsf_2
 = "100002d7R-R",

1235 
efsùuiz_2
 = "100002d8R-R",

1236 
efsùsiz_2
 = "100002daR-R",

1237 
ef¡¡gt_3
 = "100002dcXRR",

1238 
ef¡¡gt_2
 = "100002dc-RR",

1239 
ef¡¡É_3
 = "100002ddXRR",

1240 
ef¡¡É_2
 = "100002dd-RR",

1241 
ef¡¡eq_3
 = "100002deXRR",

1242 
ef¡¡eq_2
 = "100002de-RR",

1243 
efdadd_3
 = "100002e0RRR",

1244 
efdsub_3
 = "100002e1RRR",

1245 
efdcfuid_2
 = "100002e2R-R",

1246 
efdcfsid_2
 = "100002e3R-R",

1247 
efdabs_2
 = "100002e4RR",

1248 
efdÇbs_2
 = "100002e5RR",

1249 
efdÃg_2
 = "100002e6RR",

1250 
efdmul_3
 = "100002e8RRR",

1251 
efddiv_3
 = "100002e9RRR",

1252 
efdùuidz_2
 = "100002eaR-R",

1253 
efdùsidz_2
 = "100002ebR-R",

1254 
efdcmpgt_3
 = "100002ecXRR",

1255 
efdcmpgt_2
 = "100002ec-RR",

1256 
efdcm¶t_3
 = "100002edXRR",

1257 
efdcm¶t_2
 = "100002ed-RR",

1258 
efdcm³q_3
 = "100002eeXRR",

1259 
efdcm³q_2
 = "100002ee-RR",

1260 
efdcfs_2
 = "100002efR-R",

1261 
efdcfui_2
 = "100002f0R-R",

1262 
efdcfsi_2
 = "100002f1R-R",

1263 
efdcfuf_2
 = "100002f2R-R",

1264 
efdcfsf_2
 = "100002f3R-R",

1265 
efdùui_2
 = "100002f4R-R",

1266 
efdùsi_2
 = "100002f5R-R",

1267 
efdùuf_2
 = "100002f6R-R",

1268 
efdùsf_2
 = "100002f7R-R",

1269 
efdùuiz_2
 = "100002f8R-R",

1270 
efdùsiz_2
 = "100002faR-R",

1271 
efdt¡gt_3
 = "100002fcXRR",

1272 
efdt¡gt_2
 = "100002fc-RR",

1273 
efdt¡É_3
 = "100002fdXRR",

1274 
efdt¡É_2
 = "100002fd-RR",

1275 
efdt¡eq_3
 = "100002feXRR",

1276 
efdt¡eq_2
 = "100002fe-RR",

1277 
evlddx_3
 = "10000300RR0R",

1278 
evldd_2
 = "10000301R8",

1279 
evldwx_3
 = "10000302RR0R",

1280 
evldw_2
 = "10000303R8",

1281 
evldhx_3
 = "10000304RR0R",

1282 
evldh_2
 = "10000305R8",

1283 
evlwhex_3
 = "10000310RR0R",

1284 
evlwhe_2
 = "10000311R4",

1285 
evlwhoux_3
 = "10000314RR0R",

1286 
evlwhou_2
 = "10000315R4",

1287 
evlwhosx_3
 = "10000316RR0R",

1288 
evlwhos_2
 = "10000317R4",

1289 
ev¡ddx_3
 = "10000320RR0R",

1290 
ev¡dd_2
 = "10000321R8",

1291 
ev¡dwx_3
 = "10000322RR0R",

1292 
ev¡dw_2
 = "10000323R8",

1293 
ev¡dhx_3
 = "10000324RR0R",

1294 
ev¡dh_2
 = "10000325R8",

1295 
ev¡whex_3
 = "10000330RR0R",

1296 
ev¡whe_2
 = "10000331R4",

1297 
ev¡whox_3
 = "10000334RR0R",

1298 
ev¡who_2
 = "10000335R4",

1299 
ev¡wwex_3
 = "10000338RR0R",

1300 
ev¡wwe_2
 = "10000339R4",

1301 
ev¡wwox_3
 = "1000033cRR0R",

1302 
ev¡wwo_2
 = "1000033dR4",

1303 
evmhessf_3
 = "10000403RRR",

1304 
evmhossf_3
 = "10000407RRR",

1305 
evmheumi_3
 = "10000408RRR",

1306 
evmhesmi_3
 = "10000409RRR",

1307 
evmhesmf_3
 = "1000040bRRR",

1308 
evmhoumi_3
 = "1000040cRRR",

1309 
evmhosmi_3
 = "1000040dRRR",

1310 
evmhosmf_3
 = "1000040fRRR",

1311 
evmhessç_3
 = "10000423RRR",

1312 
evmhossç_3
 = "10000427RRR",

1313 
evmheumŸ_3
 = "10000428RRR",

1314 
evmhesmŸ_3
 = "10000429RRR",

1315 
evmhesmç_3
 = "1000042bRRR",

1316 
evmhoumŸ_3
 = "1000042cRRR",

1317 
evmhosmŸ_3
 = "1000042dRRR",

1318 
evmhosmç_3
 = "1000042fRRR",

1319 
evmwhssf_3
 = "10000447RRR",

1320 
evmwlumi_3
 = "10000448RRR",

1321 
evmwhumi_3
 = "1000044cRRR",

1322 
evmwhsmi_3
 = "1000044dRRR",

1323 
evmwhsmf_3
 = "1000044fRRR",

1324 
evmwssf_3
 = "10000453RRR",

1325 
evmwumi_3
 = "10000458RRR",

1326 
evmwsmi_3
 = "10000459RRR",

1327 
evmwsmf_3
 = "1000045bRRR",

1328 
evmwhssç_3
 = "10000467RRR",

1329 
evmwlumŸ_3
 = "10000468RRR",

1330 
evmwhumŸ_3
 = "1000046cRRR",

1331 
evmwhsmŸ_3
 = "1000046dRRR",

1332 
evmwhsmç_3
 = "1000046fRRR",

1333 
evmwssç_3
 = "10000473RRR",

1334 
evmwumŸ_3
 = "10000478RRR",

1335 
evmwsmŸ_3
 = "10000479RRR",

1336 
evmwsmç_3
 = "1000047bRRR",

1337 
evm¿_2
 = "100004c4RR",

1338 
evdivws_3
 = "100004c6RRR",

1339 
evdivwu_3
 = "100004c7RRR",

1340 
evmwssça_3
 = "10000553RRR",

1341 
evmwumŸa_3
 = "10000558RRR",

1342 
evmwsmŸa_3
 = "10000559RRR",

1343 
evmwsmça_3
 = "1000055bRRR",

1344 
evmwssçn_3
 = "100005d3RRR",

1345 
evmwumŸn_3
 = "100005d8RRR",

1346 
evmwsmŸn_3
 = "100005d9RRR",

1347 
evmwsmçn_3
 = "100005dbRRR",

1348 
evm”geho_3
 = "1000022eRRR",

1349 
evm”g–ohi_3
 = "1000022fRRR",

1350 
evlhhe¥Ïtx_3
 = "10000308RR0R",

1351 
evlhhe¥Ït_2
 = "10000309R2",

1352 
evlhhou¥Ïtx_3
 = "1000030cRR0R",

1353 
evlhhou¥Ït_2
 = "1000030dR2",

1354 
evlhhos¥Ïtx_3
 = "1000030eRR0R",

1355 
evlhhos¥Ït_2
 = "1000030fR2",

1356 
evlww¥Ïtx_3
 = "10000318RR0R",

1357 
evlww¥Ït_2
 = "10000319R4",

1358 
evlwh¥Ïtx_3
 = "1000031cRR0R",

1359 
evlwh¥Ït_2
 = "1000031dR4",

1360 
evaddusŸaw_2
 = "100004c0RR",

1361 
evaddssŸaw_2
 = "100004c1RR",

1362 
evsubfusŸaw_2
 = "100004c2RR",

1363 
evsubfssŸaw_2
 = "100004c3RR",

1364 
evaddumŸaw_2
 = "100004c8RR",

1365 
evaddsmŸaw_2
 = "100004c9RR",

1366 
evsubfumŸaw_2
 = "100004caRR",

1367 
evsubfsmŸaw_2
 = "100004cbRR",

1368 
evmheusŸaw_3
 = "10000500RRR",

1369 
evmhessŸaw_3
 = "10000501RRR",

1370 
evmhessçaw_3
 = "10000503RRR",

1371 
evmhousŸaw_3
 = "10000504RRR",

1372 
evmhossŸaw_3
 = "10000505RRR",

1373 
evmhossçaw_3
 = "10000507RRR",

1374 
evmheumŸaw_3
 = "10000508RRR",

1375 
evmhesmŸaw_3
 = "10000509RRR",

1376 
evmhesmçaw_3
 = "1000050bRRR",

1377 
evmhoumŸaw_3
 = "1000050cRRR",

1378 
evmhosmŸaw_3
 = "1000050dRRR",

1379 
evmhosmçaw_3
 = "1000050fRRR",

1380 
evmhegumŸa_3
 = "10000528RRR",

1381 
evmhegsmŸa_3
 = "10000529RRR",

1382 
evmhegsmça_3
 = "1000052bRRR",

1383 
evmhogumŸa_3
 = "1000052cRRR",

1384 
evmhogsmŸa_3
 = "1000052dRRR",

1385 
evmhogsmça_3
 = "1000052fRRR",

1386 
evmwlusŸaw_3
 = "10000540RRR",

1387 
evmwlssŸaw_3
 = "10000541RRR",

1388 
evmwlumŸaw_3
 = "10000548RRR",

1389 
evmwlsmŸaw_3
 = "10000549RRR",

1390 
evmheusŸnw_3
 = "10000580RRR",

1391 
evmhessŸnw_3
 = "10000581RRR",

1392 
evmhessçnw_3
 = "10000583RRR",

1393 
evmhousŸnw_3
 = "10000584RRR",

1394 
evmhossŸnw_3
 = "10000585RRR",

1395 
evmhossçnw_3
 = "10000587RRR",

1396 
evmheumŸnw_3
 = "10000588RRR",

1397 
evmhesmŸnw_3
 = "10000589RRR",

1398 
evmhesmçnw_3
 = "1000058bRRR",

1399 
evmhoumŸnw_3
 = "1000058cRRR",

1400 
evmhosmŸnw_3
 = "1000058dRRR",

1401 
evmhosmçnw_3
 = "1000058fRRR",

1402 
evmhegumŸn_3
 = "100005a8RRR",

1403 
evmhegsmŸn_3
 = "100005a9RRR",

1404 
evmhegsmçn_3
 = "100005abRRR",

1405 
evmhogumŸn_3
 = "100005acRRR",

1406 
evmhogsmŸn_3
 = "100005adRRR",

1407 
evmhogsmçn_3
 = "100005afRRR",

1408 
evmwlusŸnw_3
 = "100005c0RRR",

1409 
evmwlssŸnw_3
 = "100005c1RRR",

1410 
evmwlumŸnw_3
 = "100005c8RRR",

1411 
evmwlsmŸnw_3
 = "100005c9RRR",

1413 -- 
NYI
: 
Book
 
E
 
š¡ruùiÚs
.

1414 
	}
}

1416 -- 
Add
 
mÃmÚics
 "." 
v¬ŸÁs
.

1418 
loÿl
 
t
 = {}

1419 
k
,
v
 
š
 
	$·œs
(
m­_İ
) do

1420 
	`ty³
(
v
è=ğ"¡ršg" 
ªd
 
	`sub
(v, -1è=ğ"." 
th’


1421 
loÿl
 
v2
 = 
	`sub
(
v
, 1, 7)..(
	`by‹
(v, 8)+1)..sub(v, 9, -2)

1422 
t
[
	`sub
(
k
, 1, -3).."."..sub(k, -2)] = 
v2


1423 
’d


1424 
’d


1425 
k
,
v
 
š
 
	$·œs
(
t
) do

1426 
m­_İ
[
k
] = 
v


1427 
’d


1428 
’d


1430 -- 
Add
 
mÜe
 
b¿nch
 
mÃmÚics
.

1431 
cÚd
,
c
 
š
 
	$·œs
(
m­_cÚd
) do

1432 
loÿl
 
b1
 = "b"..
cÚd


1433 
loÿl
 
c1
 = 
	`shl
(
	`bªd
(
c
, 3), 16è+ (ø< 4 
ªd
 0x01000000 
Ü
 0)

1434 -- 
bX
[
l
]

1435 
m­_İ
[
b1
.."_1"] = 
	`tohex
(0x40800000 + 
c1
).."K"

1436 
m­_İ
[
b1
.."y_1"] = 
	`tohex
(0x40a00000 + 
c1
).."K"

1437 
m­_İ
[
b1
.."l_1"] = 
	`tohex
(0x40800001 + 
c1
).."K"

1438 
m­_İ
[
b1
.."_2"] = 
	`tohex
(0x40800000 + 
c1
).."-XK"

1439 
m­_İ
[
b1
.."y_2"] = 
	`tohex
(0x40a00000 + 
c1
).."-XK"

1440 
m­_İ
[
b1
.."l_2"] = 
	`tohex
(0x40800001 + 
c1
).."-XK"

1441 -- 
bXÌ
[
l
]

1442 
m­_İ
[
b1
.."Ì_0"] = 
	`tohex
(0x4c800020 + 
c1
)

1443 
m­_İ
[
b1
.."Ìl_0"] = 
	`tohex
(0x4c800021 + 
c1
)

1444 
m­_İ
[
b1
.."ùr_0"] = 
	`tohex
(0x4c800420 + 
c1
)

1445 
m­_İ
[
b1
.."ù¾_0"] = 
	`tohex
(0x4c800421 + 
c1
)

1446 -- 
bXùr
[
l
]

1447 
m­_İ
[
b1
.."Ì_1"] = 
	`tohex
(0x4c800020 + 
c1
).."-X"

1448 
m­_İ
[
b1
.."Ìl_1"] = 
	`tohex
(0x4c800021 + 
c1
).."-X"

1449 
m­_İ
[
b1
.."ùr_1"] = 
	`tohex
(0x4c800420 + 
c1
).."-X"

1450 
m­_İ
[
b1
.."ù¾_1"] = 
	`tohex
(0x4c800421 + 
c1
).."-X"

1451 
’d


1455 
loÿl
 
funùiÚ
 
	$·r£_g´
(
ex´
)

1456 
loÿl
 
Šame
, 
ov»g
 = 
	`m©ch
(
ex´
, "^([%w_]+):(r[1-3]?[0-9])$")

1457 
loÿl
 

 = 
m­_ty³
[
Šame
 
Ü
 
ex´
]

1458 

 
th’


1459 
loÿl
 
»g
 = 
ov»g
 
Ü
 

.reg

1460 
nÙ
 
»g
 
th’


1461 
	`w”rÜ
("ty³ `"..(
Šame
 
Ü
 
ex´
).."'‚eeds‡„egister override")

1462 
’d


1463 
ex´
 = 
»g


1464 
’d


1465 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^r([1-3]?[0-9])$")

1466 
r
 
th’


1467 
r
 = 
	$tÚumb”
(
r
)

1468 
r
 <ğ31 
th’
 „, 

 
’d


1469 
’d


1470 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

1471 
’d


1473 
loÿl
 
funùiÚ
 
	$·r£_år
(
ex´
)

1474 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^f([1-3]?[0-9])$")

1475 
r
 
th’


1476 
r
 = 
	$tÚumb”
(
r
)

1477 
r
 <ğ31 
th’
 „ 
’d


1478 
’d


1479 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

1480 
’d


1482 
loÿl
 
funùiÚ
 
	$·r£_vr
(
ex´
)

1483 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^v([1-3]?[0-9])$")

1484 
r
 
th’


1485 
r
 = 
	$tÚumb”
(
r
)

1486 
r
 <ğ31 
th’
 „ 
’d


1487 
’d


1488 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

1489 
’d


1491 
loÿl
 
funùiÚ
 
	$·r£_vs
(
ex´
)

1492 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^vs([1-6]?[0-9])$")

1493 
r
 
th’


1494 
r
 = 
	$tÚumb”
(
r
)

1495 
r
 <ğ63 
th’
 „ 
’d


1496 
’d


1497 
	`w”rÜ
("bad„egi¡”‚am`"..
ex´
.."'")

1498 
’d


1500 
loÿl
 
funùiÚ
 
	$·r£_ü
(
ex´
)

1501 
loÿl
 
r
 = 
	`m©ch
(
ex´
, "^cr([0-7])$")

1502 
r
 
th’
  
	$tÚumb”
(
r
è
’d


1503 
	`w”rÜ
("bad cÚd™iÚ„egi¡”‚am`"..
ex´
.."'")

1504 
’d


1506 
loÿl
 
funùiÚ
 
	$·r£_cÚd
(
ex´
)

1507 
loÿl
 
r
, 
cÚd
 = 
	`m©ch
(
ex´
, "^4%*cr([0-7])%+(%w%w)$")

1508 
r
 
th’


1509 
r
 = 
	$tÚumb”
(
r
)

1510 
loÿl
 
c
 = 
m­_cÚd
[
cÚd
]

1511 
c
 
ªd
 c < 4 
th’
  
r
*4+ø
’d


1512 
’d


1513 
	`w”rÜ
("bad cÚd™iÚ b™‚am`"..
ex´
.."'")

1514 
’d


1516 
loÿl
 
·r£_ùx
 = {
	}
}

1518 
loÿl
 
lßd’v
 = 
£tãnv
 
ªd
 
	$funùiÚ
(
s
)

1519 
loÿl
 
code
 = 
	`lßd¡ršg
(
s
, "")

1520 
code
 
th’
 
	$£tãnv
(
code
, 
·r£_ùx
è
’d


1521  
code


1522 
’d
 
Ü
 
	$funùiÚ
(
s
)

1523  
	`lßd
(
s
, "", 
n
, 
·r£_ùx
)

1524 
’d


1526 -- 
Try
 
to
 
·r£
 
sim¶e
 
¬™hm‘ic
, 
too
, 
sšû
 
some
 
basic
 
İs
 
¬e
 
®Ÿ£s
.

1527 
loÿl
 
funùiÚ
 
	$·r£_numb”
(
n
)

1528 
loÿl
 
x
 = 
	$tÚumb”
(
n
)

1529 
x
 
th’
  x 
’d


1530 
loÿl
 
code
 = 
	`lßd’v
("»tuº "..
n
)

1531 
code
 
th’


1532 
loÿl
 
ok
, 
y
 = 
	$pÿÎ
(
code
)

1533 
ok
 
th’
  
y
 
’d


1534 
’d


1535  
n


1536 
’d


1538 
loÿl
 
funùiÚ
 
	$·r£_imm
(
imm
, 
b™s
, 
shiá
, 
sÿË
, signed)

1539 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

1540 
n
 
th’


1541 
loÿl
 
m
 = 
	$§r
(
n
, 
sÿË
)

1542 
	`shl
(
m
, 
sÿË
è=ğ
n
 
th’


1543 sigÃd 
th’


1544 
loÿl
 
s
 = 
	`§r
(
m
, 
b™s
-1)

1545 
s
 =ğ0 
th’
  
	$shl
(
m
, 
shiá
)

1546 
–£if
 
s
 =ğ-1 
th’
  
	`shl
(
m
 + shl(1, 
b™s
), 
shiá
è
’d


1548 
	`§r
(
m
, 
b™s
è=ğ0 
th’
  
	$shl
(
m
, 
shiá
è
’d


1549 
’d


1550 
’d


1551 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

1552 
–£if
 
	`m©ch
(
imm
, "^[rfv]([1-3]?[0-9])$"è
Ü


1553 
	`m©ch
(
imm
, "^vs([1-6]?[0-9])$"è
Ü


1554 
	`m©ch
(
imm
, "^([%w_]+):Ô[1-3]?[0-9])$"è
th’


1555 
	`w”rÜ
("expected immediate operand, got„egister")

1557 
	`waùiÚ
("IMM", (sigÃd 
ªd
 32768 
Ü
 0)+
sÿË
*1024+
b™s
*32+
shiá
, 
imm
)

1559 
’d


1560 
’d


1562 
loÿl
 
funùiÚ
 
	$·r£_shiámask
(
imm
, 
isshiá
)

1563 
loÿl
 
n
 = 
	$·r£_numb”
(
imm
)

1564 
n
 
th’


1565 
	`shr
(
n
, 6è=ğ0 
th’


1566 
loÿl
 
lsb
 = 
	$bªd
(
n
, 31)

1567 
loÿl
 
msb
 = 
n
 - 
lsb


1568  
isshiá
 
	`ªd
 (
	`shl
(
lsb
, 11)+
	$shr
(
msb
, 4)è
	`Ü
 (
	`shl
(
lsb
, 6)+msb)

1569 
’d


1570 
	`w”rÜ
("ouˆoà¿ngimmedŸ‹ `"..
imm
.."'")

1571 
–£if
 
	`m©ch
(
imm
, "^r([1-3]?[0-9])$"è
Ü


1572 
	`m©ch
(
imm
, "^([%w_]+):Ô[1-3]?[0-9])$"è
th’


1573 
	`w”rÜ
("expected immediate operand, got„egister")

1575 
	`waùiÚ
("IMMSH", 
isshiá
 
ªd
 1 
Ü
 0, 
imm
)

1577 
’d


1578 
’d


1580 
loÿl
 
funùiÚ
 
	$·r£_di¥
(
di¥
)

1581 
loÿl
 
imm
, 
»g
 = 
	`m©ch
(
di¥
, "^(.*)%(([%w_:]+)%)$")

1582 
imm
 
th’


1583 
loÿl
 
r
 = 
	$·r£_g´
(
»g
)

1584 
r
 =ğ0 
th’
 
	`w”rÜ
("ÿÂÙ u£„0 iÀdi¥Ïûm’t"è
’d


1585  
	`shl
(
r
, 16è+ 
	$·r£_imm
(
imm
, 16, 0, 0, 
Œue
)

1586 
’d


1587 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
di¥
, "^([%w_:]+)%s*(.*)$")

1588 
»g
 
ªd
 
r
 ~ğ"" 
th’


1589 
loÿl
 
r
, 

 = 
	$·r£_g´
(
»g
)

1590 
r
 =ğ0 
th’
 
	`w”rÜ
("ÿÂÙ u£„0 iÀdi¥Ïûm’t"è
’d


1591 

 
th’


1592 
	`waùiÚ
("IMM", 32768+16*32, 
	$fÜm©
(

.
ùy³fmt
, 
r
))

1593  
	$shl
(
r
, 16)

1594 
’d


1595 
’d


1596 
	`w”rÜ
("bad di¥Ïûm’ˆ`"..
di¥
.."'")

1597 
’d


1599 
loÿl
 
funùiÚ
 
	$·r£_u5di¥
(
di¥
, 
sÿË
)

1600 
loÿl
 
imm
, 
»g
 = 
	`m©ch
(
di¥
, "^(.*)%(([%w_:]+)%)$")

1601 
imm
 
th’


1602 
loÿl
 
r
 = 
	$·r£_g´
(
»g
)

1603 
r
 =ğ0 
th’
 
	`w”rÜ
("ÿÂÙ u£„0 iÀdi¥Ïûm’t"è
’d


1604  
	`shl
(
r
, 16è+ 
	$·r£_imm
(
imm
, 5, 11, 
sÿË
, 
çl£
)

1605 
’d


1606 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
di¥
, "^([%w_:]+)%s*(.*)$")

1607 
»g
 
ªd
 
r
 ~ğ"" 
th’


1608 
loÿl
 
r
, 

 = 
	$·r£_g´
(
»g
)

1609 
r
 =ğ0 
th’
 
	`w”rÜ
("ÿÂÙ u£„0 iÀdi¥Ïûm’t"è
’d


1610 

 
th’


1611 
	`waùiÚ
("IMM", 
sÿË
*1024+5*32+11, 
	$fÜm©
(

.
ùy³fmt
, 
r
))

1612  
	$shl
(
r
, 16)

1613 
’d


1614 
’d


1615 
	`w”rÜ
("bad di¥Ïûm’ˆ`"..
di¥
.."'")

1616 
’d


1618 
loÿl
 
funùiÚ
 
	$·r£_Ïb–
(
Ïb–
, 
def
)

1619 
loÿl
 
´efix
 = 
	`sub
(
Ïb–
, 1, 2)

1620 -- =>
	$Ïb–
 (
pc
 
Ïb–
 
»ã»nû
)

1621 
´efix
 =ğ"=>" 
th’


1622  "PC", 0, 
	$sub
(
Ïb–
, 3)

1623 
’d


1624 -- ->
	$Çme
 (
glob®
 
Ïb–
 
»ã»nû
)

1625 
´efix
 =ğ"->" 
th’


1626  "LG", 
m­_glob®
[
	`sub
(
Ïb–
, 3)]

1627 
’d


1628 
def
 
th’


1629 -- [1-9] (
loÿl
 
Ïb–
 
defš™iÚ
)

1630 
	`m©ch
(
Ïb–
, "^[1-9]$"è
th’


1631  "LG", 10+
	$tÚumb”
(
Ïb–
)

1632 
’d


1634 -- [<>][1-9] (
loÿl
 
Ïb–
 
»ã»nû
)

1635 
loÿl
 
dœ
, 
Êum
 = 
	`m©ch
(
Ïb–
, "^([<>])([1-9])$")

1636 
dœ
 
th’
 -- 
Fwd
: 1-9, 
Bkwd
: 11-19.

1637  "LG", 
Êum
 + (
dœ
 =ğ">" 
ªd
 0 
Ü
 10)

1638 
’d


1639 -- 
	$Ïb–
 (
Ïb–
 
»ã»nû
)

1640 
loÿl
 
exŠame
 = 
	`m©ch
(
Ïb–
, "^extern%s+(%S+)$")

1641 
exŠame
 
th’


1642  "EXT", 
m­_ex‹º
[
exŠame
]

1643 
’d


1644 
’d


1645 
	`w”rÜ
("bad†ab– `"..
Ïb–
.."'")

1646 
’d


1650 -- 
HªdË
 
İcodes
 
defšed
 
w™h
 
‹m¶©e
 
¡ršgs
.

1651 
İ_‹m¶©e
 = 
	$funùiÚ
(
·¿ms
, 
‹m¶©e
, 
Å¬ams
)

1652 
nÙ
 
·¿ms
 
th’
  
	$sub
(
‹m¶©e
, 9è
’d


1653 
loÿl
 
İ
 = 
	`tÚumb”
(
	`sub
(
‹m¶©e
, 1, 8), 16)

1654 
loÿl
 
n
, 
rs
 = 1, 26

1656 -- 
Lim™
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
u£d
 
by
 
a
 
sšgË
 
	`dasm_put
().

1657 -- 
A
 
sšgË
 
İcode
 
Ãeds
 
a
 
maximum
 
of
 3 
	`pos™iÚs
 (
¾wšm
).

1658 
£ıos
+3 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1659 
loÿl
 
pos
 = 
	`wpos
()

1661 -- 
Proûss
 
—ch
 
ch¬aù”
.

1662 
p
 
š
 
	`gm©ch
(
	`sub
(
‹m¶©e
, 9), ".") do

1663 
p
 =ğ"R" 
th’


1664 
rs
 =„ - 5; 
İ
 = o°+ 
	`shl
(
	`·r£_g´
(
·¿ms
[
n
]),„s);‚ =‚ + 1

1665 
–£if
 
p
 =ğ"F" 
th’


1666 
rs
 =„ - 5; 
İ
 = o°+ 
	`shl
(
	`·r£_år
(
·¿ms
[
n
]),„s);‚ =‚ + 1

1667 
–£if
 
p
 =ğ"V" 
th’


1668 
rs
 =„ - 5; 
İ
 = o°+ 
	`shl
(
	`·r£_vr
(
·¿ms
[
n
]),„s);‚ =‚ + 1

1669 
–£if
 
p
 =ğ"Q" 
th’


1670 
loÿl
 
vs
 = 
	`·r£_vs
(
·¿ms
[
n
]);‚ =‚ + 1; 
rs
 =„s - 5

1671 
loÿl
 
sh
 = 
rs
 =ğ6 
ªd
 2 
Ü
 3 + 
	`bªd
(
	`shr
(rs, 1), 3)

1672 
İ
 = o°+ 
	`shl
(
	`bªd
(
vs
, 31), 
rs
è+ 
	`shr
(bªd(vs, 32), 
sh
)

1673 
–£if
 
p
 =ğ"q" 
th’


1674 
loÿl
 
vs
 = 
	`·r£_vs
(
·¿ms
[
n
]);‚ =‚ + 1

1675 
İ
 = o°+ 
	`shl
(
	`bªd
(
vs
, 31), 21è+ 
	`shr
(band(vs, 32), 5)

1676 
–£if
 
p
 =ğ"A" 
th’


1677 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 5,„s, 0, 
çl£
);‚ =‚ + 1

1678 
–£if
 
p
 =ğ"S" 
th’


1679 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 5,„s, 0, 
Œue
);‚ =‚ + 1

1680 
–£if
 
p
 =ğ"I" 
th’


1681 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 16, 0, 0, 
Œue
);‚ =‚ + 1

1682 
–£if
 
p
 =ğ"U" 
th’


1683 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 16, 0, 0, 
çl£
);‚ =‚ + 1

1684 
–£if
 
p
 =ğ"D" 
th’


1685 
İ
 = o°+ 
	`·r£_di¥
(
·¿ms
[
n
]);‚ =‚ + 1

1686 
–£if
 
p
 =ğ"2" 
th’


1687 
İ
 = o°+ 
	`·r£_u5di¥
(
·¿ms
[
n
], 1);‚ =‚ + 1

1688 
–£if
 
p
 =ğ"4" 
th’


1689 
İ
 = o°+ 
	`·r£_u5di¥
(
·¿ms
[
n
], 2);‚ =‚ + 1

1690 
–£if
 
p
 =ğ"8" 
th’


1691 
İ
 = o°+ 
	`·r£_u5di¥
(
·¿ms
[
n
], 3);‚ =‚ + 1

1692 
–£if
 
p
 =ğ"C" 
th’


1693 
rs
 =„ - 5; 
İ
 = o°+ 
	`shl
(
	`·r£_cÚd
(
·¿ms
[
n
]),„s);‚ =‚ + 1

1694 
–£if
 
p
 =ğ"X" 
th’


1695 
rs
 =„ - 5; 
İ
 = o°+ 
	`shl
(
	`·r£_ü
(
·¿ms
[
n
]),„s+2);‚ =‚ + 1

1696 
–£if
 
p
 =ğ"1" 
th’


1697 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 1,„s, 0, 
çl£
);‚ =‚ + 1

1698 
–£if
 
p
 =ğ"g" 
th’


1699 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 2,„s, 0, 
çl£
);‚ =‚ + 1

1700 
–£if
 
p
 =ğ"3" 
th’


1701 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 3,„s, 0, 
çl£
);‚ =‚ + 1

1702 
–£if
 
p
 =ğ"P" 
th’


1703 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 4,„s, 0, 
çl£
);‚ =‚ + 1

1704 
–£if
 
p
 =ğ"p" 
th’


1705 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 4, 
rs
, 0, 
çl£
);‚ =‚ + 1

1706 
–£if
 
p
 =ğ"6" 
th’


1707 
rs
 =„ - 6; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 6,„s, 0, 
çl£
);‚ =‚ + 1

1708 
–£if
 
p
 =ğ"Y" 
th’


1709 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 1,„s+4, 0, 
çl£
);‚ =‚ + 1

1710 
–£if
 
p
 =ğ"y" 
th’


1711 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 1,„s+3, 0, 
çl£
);‚ =‚ + 1

1712 
–£if
 
p
 =ğ"Z" 
th’


1713 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 2,„s+3, 0, 
çl£
);‚ =‚ + 1

1714 
–£if
 
p
 =ğ"z" 
th’


1715 
rs
 =„ - 5; 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 2,„s+2, 0, 
çl£
);‚ =‚ + 1

1716 
–£if
 
p
 =ğ"W" 
th’


1717 
İ
 = o°+ 
	`·r£_ü
(
·¿ms
[
n
]);‚ =‚ + 1

1718 
–£if
 
p
 =ğ"G" 
th’


1719 
İ
 = o°+ 
	`·r£_imm
(
·¿ms
[
n
], 8, 12, 0, 
çl£
);‚ =‚ + 1

1720 
–£if
 
p
 =ğ"H" 
th’


1721 
İ
 = o°+ 
	`·r£_shiámask
(
·¿ms
[
n
], 
Œue
);‚ =‚ + 1

1722 
–£if
 
p
 =ğ"M" 
th’


1723 
İ
 = o°+ 
	`·r£_shiámask
(
·¿ms
[
n
], 
çl£
);‚ =‚ + 1

1724 
–£if
 
p
 =ğ"J" 
Ü
… =ğ"K" 
th’


1725 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
·¿ms
[
n
], 
çl£
)

1726 
p
 =ğ"K" 
th’
 
n
 =‚ + 2048 
’d


1727 
	`waùiÚ
("REL_"..
mode
, 
n
, 
s
, 1)

1728 
n
 =‚ + 1

1729 
–£if
 
p
 =ğ"0" 
th’


1730 
	`bªd
(
	`shr
(
İ
, 
rs
), 31è=ğ0 
th’
 
	`w”rÜ
("ÿÂÙ u£„0"è
’d


1731 
–£if
 
p
 =ğ"=" 
Ü
… =ğ"%" 
th’


1732 
loÿl
 
t
 = 
	`bªd
(
	`shr
(
İ
, 
p
 =ğ"%" 
ªd
 
rs
+5 
Ü
„s), 31)

1733 
rs
 =„s - 5

1734 
İ
 = o°+ 
	$shl
(
t
, 
rs
)

1735 
–£if
 
p
 =ğ"~" 
th’


1736 
loÿl
 
mm
 = 
	$shl
(31, 
rs
)

1737 
loÿl
 
lo
 = 
	$bªd
(
İ
, 
mm
)

1738 
loÿl
 
hi
 = 
	`bªd
(
İ
, 
	$shl
(
mm
, 5))

1739 
İ
 = o°- 
lo
 - 
hi
 + 
	`shl
Öo, 5è+ 
	$shr
(
hi
, 5)

1740 
–£if
 
p
 =ğ":" 
th’


1741 
	`bªd
(
	`shr
(
İ
, 
rs
), 1è~ğ0 
th’
 
	`w”rÜ
("»gi¡”…aœƒx³ùed"è
’d


1742 
–£if
 
p
 =ğ"-" 
th’


1743 
rs
 =„s - 5

1744 
–£if
 
p
 =ğ"." 
th’


1745 -- 
IgnÜed
.

1747 
	$as£¹
(
çl£
)

1748 
’d


1749 
’d


1750 
	$wpuos
(
pos
, 
İ
)

1751 
’d


1753 
m­_İ
[".‹m¶©e__"] = 
İ_‹m¶©e


1757 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
aùiÚ
 
li¡
 
is
Ø
be
 
em™‹d
.

1758 
m­_İ
[".aùiÚli¡_1"] = 
	$funùiÚ
(
·¿ms
)

1759 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


1760 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1761 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™—ùiÚs
(
out
, 
Çme
è
’d
)

1762 
’d


1764 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
is
Ø
be
 
em™‹d
.

1765 
m­_İ
[".glob®s_1"] = 
	$funùiÚ
(
·¿ms
)

1766 
nÙ
 
·¿ms
 
th’
  "´efix" 
’d


1767 
loÿl
 
´efix
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1768 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®s
(
out
, 
´efix
è
’d
)

1769 
’d


1771 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
Çmes
 
¬e
Ø
be
 
em™‹d
.

1772 
m­_İ
[".glob®Çmes_1"] = 
	$funùiÚ
(
·¿ms
)

1773 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


1774 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1775 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®Çmes
(
out
, 
Çme
è
’d
)

1776 
’d


1778 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
Çmes
 
¬e
Ø
be
 
em™‹d
.

1779 
m­_İ
[".ex‹ºÇmes_1"] = 
	$funùiÚ
(
·¿ms
)

1780 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


1781 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

1782 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™“x‹ºÇmes
(
out
, 
Çme
è
’d
)

1783 
’d


1787 -- 
Lab–
 
p£udo
-
	`İcode
 (
cÚv”‹d
 
äom
 
Œašg
 
cŞÚ
 
fÜm
).

1788 
m­_İ
[".Ïb–_1"] = 
	$funùiÚ
(
·¿ms
)

1789 
nÙ
 
·¿ms
 
th’
  "[1-9] | ->glob® | =>pûx´" 
’d


1790 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1791 
loÿl
 
mode
, 
n
, 
s
 = 
	$·r£_Ïb–
(
·¿ms
[1], 
Œue
)

1792 
mode
 =ğ"EXT" 
th’
 
	`w”rÜ
("bad†ab– defš™iÚ"è
’d


1793 
	`waùiÚ
("LABEL_"..
mode
, 
n
, 
s
, 1)

1794 
’d


1798 -- 
P£udo
-
İcodes
 
d©a
 
¡Üage
.

1799 
m­_İ
[".lÚg_*"] = 
	$funùiÚ
(
·¿ms
)

1800 
nÙ
 
·¿ms
 
th’
  "imm..." 
’d


1801 
_
,
p
 
š
 
	$aœs
(
·¿ms
) do

1802 
loÿl
 
n
 = 
	$tÚumb”
(
p
)

1803 
nÙ
 
n
 
th’
 
	`w”rÜ
("bad immedŸ‹ `"..
p
.."'"è
’d


1804 
n
 < 0 
th’
‚ =‚ + 2^32 
’d


1805 
	$wputw
(
n
)

1806 
£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1807 
’d


1808 
’d


1810 -- 
Alignm’t
 
p£udo
-
İcode
.

1811 
m­_İ
[".®ign_1"] = 
	$funùiÚ
(
·¿ms
)

1812 
nÙ
 
·¿ms
 
th’
  "numpow2" 
’d


1813 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1814 
loÿl
 
®ign
 = 
	$tÚumb”
(
·¿ms
[1])

1815 
®ign
 
th’


1816 
loÿl
 
x
 = 
®ign


1817 -- 
Mu¡
 
be
 
a
 
pow”
 
of
 2 
š
 
the
 
	`¿nge
 (2 ... 256).

1818 
i
=1,8 do

1819 
x
 = x / 2

1820 
x
 =ğ1 
th’


1821 
	`waùiÚ
("ALIGN", 
®ign
-1, 
n
, 1è-- 
AùiÚ
 
by‹
 
is
 2**
n
-1.

1823 
’d


1824 
’d


1825 
’d


1826 
	`w”rÜ
("bad‡lignment")

1827 
’d


1831 -- 
P£udo
-
İcode
 
´im™ive
è
ty³
 
	`defš™iÚs
 (
m­
 
to
 
C
 
ty³s
).

1832 
m­_İ
[".ty³_3"] = 
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

1833 
nÙ
 
·¿ms
 
th’


1834  
Å¬ams
 =ğ2 
ªd
 "Çme, cty³" 
Ü
 "name, ctype,„eg"

1835 
’d


1836 
loÿl
 
Çme
, 
ùy³
, 
»g
 = 
·¿ms
[1],…arams[2],…arams[3]

1837 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


1838 
	`w”rÜ
("bady³‚am`"..
Çme
.."'")

1839 
’d


1840 
loÿl
 

 = 
m­_ty³
[
Çme
]

1841 

 
th’


1842 
	`w”rÜ
("du¶iÿ‹y³ `"..
Çme
.."'")

1843 
’d


1844 -- 
Add
 #ty³ 
to
 
defšes
. 
A
 
b™
 
unş—n
Ø
put
 
™
 
š
 
m­_¬chdef
.

1845 
m­_¬chdef
["#"..
Çme
] = "sizeof("..
ùy³
..")"

1846 -- 
Add
 
Ãw
 
ty³
 
ªd
 
em™
 
shÜtcut
 
defše
.

1847 
loÿl
 
num
 = 
ùy³num
 + 1

1848 
m­_ty³
[
Çme
] = {

1849 
ùy³
 = ctype,

1850 
ùy³fmt
 = 
	`fÜm©
("Dt%X(%%s)", 
num
),

1851 
»g
 =„eg,

1852 
	}
}

1853 
wlše
(
fÜm©
("#defšDt%X(_Vè(št)ÕŒdiff_t)&(((% *)0)_V)", 
num
, 
ùy³
))

1854 
ùy³num
 = 
num


1855 
’d


1856 
m­_İ
[".type_2"] = map_op[".type_3"]

1858 -- 
Dump
 
ty³
 
defš™iÚs
.

1859 
loÿl
 
funùiÚ
 
	$dum±y³s
(
out
, 
lvl
)

1860 
loÿl
 
t
 = {
	}
}

1861 
Çme
 
š
 
	$·œs
(
m­_ty³
èdØ
t
[#t+1] = 
Çme
 
’d


1862 
	$sÜt
(
t
)

1863 
out
:
	`wr™e
("Type definitions:\n")

1864 
_
,
Çme
 
š
 
	$aœs
(
t
) do

1865 
loÿl
 

 = 
m­_ty³
[
Çme
]

1866 
loÿl
 
»g
 = 

.»g 
Ü
 ""

1867 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %-20 %s\n", 
Çme
, 

.
ùy³
, 
»g
))

1868 
’d


1869 
out
:
	`wr™e
("\n")

1870 
’d


1874 -- 
S‘
 
the
 
cu¼’t
 
£ùiÚ
.

1875 
funùiÚ
 
_M
.
	$£ùiÚ
(
num
)

1876 
	`waùiÚ
("SECTION", 
num
)

1877 
	`wæush
(
Œue
è-- 
SECTION
 
is
 
a
 
‹rmš®
 
aùiÚ
.

1878 
’d


1882 -- 
Dump
 
¬ch™eùu»
 
desütiÚ
.

1883 
funùiÚ
 
_M
.
	$dum·rch
(
out
)

1884 
out
:
	`wr™e
(
	`fÜm©
("DynASM %s version %s,„eleased %s\n\n",

1885 
_šfo
.
¬ch
, _šfo.
v”siÚ
, _šfo.
»Ëa£
))

1886 
	$dum·ùiÚs
(
out
)

1887 
’d


1889 -- 
Dump
 
®l
 
u£r
 
defšed
 
–em’ts
.

1890 
funùiÚ
 
_M
.
	$dumpdef
(
out
, 
lvl
)

1891 
	$dum±y³s
(
out
, 
lvl
)

1892 
	$dumpglob®s
(
out
, 
lvl
)

1893 
	$dum³x‹ºs
(
out
, 
lvl
)

1894 
’d


1898 -- 
Pass
 
ÿÎbacks
 
äom
/
to
 
the
 
DynASM
 
cÜe
.

1899 
funùiÚ
 
_M
.
	$·sscb
(
wl
, 
we
, 
wf
, 
ww
)

1900 
wlše
, 
w”rÜ
, 
wçl
, 
ww¬n
 = 
wl
, 
we
, 
wf
, 
ww


1901  
wæush


1902 
’d


1904 -- 
S‘up
 
the
 
¬ch
-
¥ecific
 
moduË
.

1905 
funùiÚ
 
_M
.
	$£tup
(
¬ch
, 
İt
)

1906 
g_¬ch
, 
g_İt
 = 
¬ch
, 
İt


1907 
’d


1909 -- 
M”ge
 
the
 
cÜe
 
m­s
 
ªd
h
¬ch
-
¥ecific
 maps.

1910 
funùiÚ
 
_M
.
	$m”gem­s
(
m­_cÜeİ
, 
m­_def
)

1911 
	`£tm‘©abË
(
m­_İ
, { 
__šdex
 = 
m­_cÜeİ
 
	}
})

1912 
£tm‘©abË
(
m­_def
, { 
__šdex
 = 
m­_¬chdef
 })

1913  
m­_İ
, 
m­_def


1914 
’d


1916  
_M


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_x64.lua

2 -- 
DynASM
 
x64
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
S“
 
	gdyÇsm
.
lua
 
fuÎ
 
cİyright
 
	gnÙiû
.

7 -- 
This
 
moduË
 
ju¡
 
	g£ts
 64 
b™
 
mode
 
the
 
combšed
 
	gx86
/
x64
 
	gmoduË
.

8 -- 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
	gx64
 = 
Œue
 -- 
Usšg
 
a
 
glob®
 
is
 
ª
 
ugly
, 
but
 
efãùive
 
	gsŞutiÚ
.

12  
»quœe
("dasm_x86")

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_x86.lua

2 -- 
DynASM
 
	gx86
/
x64
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
S“
 
	gdyÇsm
.
lua
 
fuÎ
 
cİyright
 
	gnÙiû
.

8 
loÿl
 
	gx64
 = 
x64


10 -- 
ModuË
 
šfÜm©iÚ
:

11 
loÿl
 
_šfo
 = {

12 
¬ch
 = 
x64
 
ªd
 "x64" 
Ü
 "x86",

13 
	gdesütiÚ
 = "DynASM x86/x64 module",

14 
	gv”siÚ
 = "1.4.0",

15 
	gv”num
 = 10400,

16 
	g»Ëa£
 = "2015-10-18",

17 
	gauthÜ
 = "Mike Pall",

18 
	gliûn£
 = "MIT",

21 -- 
ExpÜ‹d
 
glue
 
funùiÚs
 
the
 
	g¬ch
-
¥ecific
 
	gmoduË
.

22 
loÿl
 
	g_M
 = { 
_šfo
 = _info }

24 -- 
Cache
 
lib¿ry
 
	gfunùiÚs
.

25 
loÿl
 
	gty³
, 
	gtÚumb”
, 
	g·œs
, 
	gaœs
 = 
ty³
,Úumb”,…aœs, 
aœs


26 
loÿl
 
	gas£¹
, 
	guÅack
, 
	g£tm‘©abË
 = 
as£¹
, 
uÅack
 
Ü
 
	gbË
.uÅack, 
£tm‘©abË


27 
loÿl
 
	g_s
 = 
¡ršg


28 
loÿl
 
sub
, 
	gfÜm©
, 
	gby‹
, ğ
_s
.sub, 
	g_s
.format, _s.byte, _s.

29 
loÿl
 
	gfšd
, 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
_s
.
fšd
, 
	g_s
.m©ch, _s.gm©ch, _s.
gsub


30 
loÿl
 
	gcÚÿt
, 
	gsÜt
, 
	g»move
 = 
bË
.
cÚÿt
, 
	gbË
.sÜt,abË.
»move


31 
loÿl
 
	gb™
 = 
b™
 
Ü
 
»quœe
("bit")

32 
loÿl
 
bªd
, 
	gbxÜ
, 
	gshl
, 
	gshr
 = 
b™
.bªd, 
	gb™
.bxÜ, b™.
	glshiá
, b™.
	grshiá


34 -- 
Inh”™ed
 
bËs
 
ªd
 
	gÿÎbacks
.

35 
loÿl
 
	gg_İt
, 
g_¬ch


36 
loÿl
 
	gwlše
, 
	gw”rÜ
, 
	gwçl
, 
	gww¬n


38 -- 
AùiÚ
 
Çme
 
	gli¡
.

39 -- 
	gCHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

40 
loÿl
 
aùiÚ_Çmes
 = {

41 -- 
¬g
, 1 
bufãr
 
pos
:

43 -- 
aùiÚ
 
¬g
 (1 
by‹
), ¬g, 1 
bufãr
 
pos
 (
»g
/
num
):

45 -- 
±rdiff_t
 
¬g
, 1 
bufãr
 
pos
 (
add»ss
): !
x64


47 -- 
aùiÚ
 
¬g
 (1 
by‹
è
Ü
 ¬g, 2 
bufãr
 
pos
 (
lšk
, 
off£t
):

49 -- 
aùiÚ
 
¬g
 (1 
by‹
è
Ü
 ¬g, 1 
bufãr
 
pos
 (
lšk
):

51 -- 
aùiÚ
 
¬g
 (1 
by‹
è
Ü
 ¬g, 1 
bufãr
 
pos
 (
off£t
):

53 -- 
aùiÚ
 
¬g
 (1 
by‹
), 1 
bufãr
 
pos
 (
off£t
):

55 -- 
aùiÚ
 
¬gs
 (2 
by‹s
), 
no
 
bufãr
 
pos
.

57 -- 
aùiÚ
 
¬g
 (1 
by‹
), 
no
 
bufãr
 
pos
.

59 -- 
no
 
aùiÚ
 
¬g
,‚Ø
bufãr
 
pos
.

61 -- 
aùiÚ
 
¬g
 (1 
by‹
), 
no
 
bufãr
 
pos
, 
‹rmš®
‡ction:

63 -- 
no
 
¬gs
,‚Ø
bufãr
 
pos
, 
‹rmš®
 
aùiÚ
:

67 -- 
Maximum
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

68 -- 
CHECK
: 
K“p
 
this
 
š
 
sync
 
w™h
 
the
 
C
 
code
!

69 
loÿl
 
max£ıos
 = 25 -- 
K“p
 
this
 
low
, 
to
 
avoid
 
exûssiv–y
 
C
 
	glšes
.

71 -- 
AùiÚ
 
	gÇme
 -> 
aùiÚ
 
numb”
 (
dyÇmiÿÎy
 
g’”©ed
 
b–ow
).

72 
loÿl
 
	gm­_aùiÚ
 = {}

73 -- 
Fœ¡
 
aùiÚ
 
numb”
. 
Ev”ythšg
 
b–ow
 
dÛs
 
nÙ
 
Ãed
 
to
 
be
 
esÿ³d
.

74 
loÿl
 
aùfœ¡
 = 256-#action_names

76 -- 
AùiÚ
 
li¡
 
bufãr
 
ªd
 
¡ršg
 (
Úly
 
u£d
 
to
 
»move
 
du³s
).

77 
loÿl
 
aùli¡
 = {}

78 
loÿl
 
aù¡r
 = ""

80 -- 
Argum’t
 
li¡
 
Ãxt
 
dasm_put
(). 
S¹
 
w™h
 
off£t
 0 
što
 
aùiÚ
†ist.

81 
loÿl
 
aù¬gs
 = { 0 }

83 -- 
Cu¼’t
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
dasm_put
().

84 
loÿl
 
£ıos
 = 1

86 -- 
VREG
 
kšd
 
’codšgs
, 
	g´e
-
shiáed
 
	gby
 5 
	gb™s
.

87 
loÿl
 
	gm­_v»g
 = {

98 -- 
Cu¼’t
 
numb”
 
of
 
VREG
 
aùiÚs
 
cÚŒibutšg
 
to
 
	gREX
/
VEX
 
	gshrškage
.

99 
loÿl
 
	gv»g_shršk_couÁ
 = 0

103 -- 
Compu‹
 
aùiÚ
 
numb”s
 aùiÚ 
Çmes
.

104 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

105 
loÿl
 
num
 = 
aùfœ¡
 + 
n
 - 1

106 
m­_aùiÚ
[
Çme
] = 
num


107 
’d


109 -- 
Dump
 
aùiÚ
 
Çmes
 
ªd
 
numb”s
.

110 
loÿl
 
funùiÚ
 
	$dum·ùiÚs
(
out
)

111 
out
:
	`wr™e
("DynASMƒncodingƒngine‡ction codes:\n")

112 
n
,
Çme
 
š
 
	$aœs
(
aùiÚ_Çmes
) do

113 
loÿl
 
num
 = 
m­_aùiÚ
[
Çme
]

114 
out
:
	`wr™e
(
	`fÜm©
(" %-10 %02X %d\n", 
Çme
, 
num
,‚um))

115 
’d


116 
out
:
	`wr™e
("\n")

117 
’d


119 -- 
Wr™e
 
aùiÚ
 
li¡
 
bufãr
 
as
 
a
 
huge
 
C
 
¬¿y
.

120 
loÿl
 
funùiÚ
 
	$wr™—ùiÚs
(
out
, 
Çme
)

121 
loÿl
 
Â
 = #actlist

122 
loÿl
 
Ï¡
 = 
aùli¡
[
Â
] 
Ü
 255

123 
aùli¡
[
Â
] = 
n
 -- 
Remove
 
Ï¡
 
by‹
.

124 
Â
 =ğ0 
th’
‚Àğ1 
’d


125 
out
:
	`wr™e
("¡©iøcÚ¡ unsigÃd ch¬ ", 
Çme
, "[", 
Â
, "] = {\n")

126 
loÿl
 
s
 = " "

127 
n
,
b
 
š
 
	$aœs
(
aùli¡
) do

128 
s
 = s..
b
..","

129 # >ğ75 
th’


130 
	`as£¹
(
out
:
	`wr™e
(
s
, "\n"))

131 
s
 = " "

132 
’d


133 
’d


134 
out
:
	`wr™e
(
s
, 
Ï¡
, "\n};\n\n"è-- 
Add
†a¡ 
by‹
 
back
.

135 
’d


139 -- 
Add
 
by‹
 
to
 
aùiÚ
 
li¡
.

140 
loÿl
 
funùiÚ
 
	$wputxb
(
n
)

141 
	`as£¹
(
n
 >ğ0 
ªd
‚ <= 255‡nd‚ % 1 == 0, "byte out of„ange")

142 
aùli¡
[#aùli¡+1] = 
n


143 
’d


145 -- 
Add
 
aùiÚ
 
to
 
li¡
 
w™h
 
İtiÚ®
 
¬g
. 
Advªû
 
bufãr
 
pos
, 
too
.

146 
loÿl
 
funùiÚ
 
	$waùiÚ
(
aùiÚ
, 
a
, 
num
)

147 
	`wputxb
(
	`as£¹
(
m­_aùiÚ
[
aùiÚ
], "bad‡ction‚ame `"..action.."'"))

148 
a
 
th’
 
aù¬gs
[#aù¬gs+1] =‡ 
’d


149 
a
 
Ü
 
num
 
th’
 
£ıos
 = seıo + (num o¸1è
’d


150 
’d


152 -- 
O±iÚ®ly
 
add
 
a
 
VREG
 
aùiÚ
.

153 
loÿl
 
funùiÚ
 
	$wv»g
(
kšd
, 
v»g
, 
psz
, 
sk
, 
deãr
)

154 
nÙ
 
v»g
 
th’
  
’d


155 
	`waùiÚ
("VREG", 
v»g
)

156 
loÿl
 
b
 = 
	`as£¹
(
m­_v»g
[
kšd
], "bad v»g kšd `"..
v»g
.."'")

157 
b
 < (
sk
 
Ü
 0è
th’


158 
v»g_shršk_couÁ
 = vreg_shrink_count + 1

159 
’d


160 
nÙ
 
deãr
 
th’


161 
b
 = b + 
v»g_shršk_couÁ
 * 8

162 
v»g_shršk_couÁ
 = 0

163 
’d


164 
	`wputxb
(
b
 + (
psz
 
Ü
 0))

165 
’d


167 -- 
Add
 
ÿÎ
 
to
 
embedded
 
DynASM
 
C
 
code
.

168 
loÿl
 
funùiÚ
 
	$wÿÎ
(
func
, 
¬gs
)

169 
	`wlše
(
	`fÜm©
("dasm_%s(D¡, %s);", 
func
, 
	`cÚÿt
(
¬gs
, ", ")), 
Œue
)

170 
’d


172 -- 
D–‘e
 
du¶iÿ‹
 
aùiÚ
 
li¡
 
chunks
. 
A
 
d
 
¦ow
, 
but
 
so
 
wh©
.

173 
loÿl
 
funùiÚ
 
	$dedu³chunk
(
off£t
)

174 
loÿl
 
®
, 
as
 = 
aùli¡
, 
aù¡r


175 
loÿl
 
chunk
 = (
	`uÅack
(
®
, 
off£t
+1, #al))

176 
loÿl
 
Üig
 = 
	$fšd
(
as
, 
chunk
, 1, 
Œue
)

177 
Üig
 
th’


178 
aù¬gs
[1] = 
Üig
-1 -- 
R•Ïû
 
w™h
 
Üigš®
 
off£t
.

179 
i
=
off£t
+1,#® dØ
®
[i] = 
n
 
’d
 -- 
Kl
 
du³
.

181 
aù¡r
 = 
as
..
chunk


182 
’d


183 
’d


185 -- 
Flush
 
aùiÚ
 
	`li¡
 (
š‹rv’šg
 
C
 
code
 
Ü
 
bufãr
 
pos
 
ov”æow
).

186 
loÿl
 
funùiÚ
 
	$wæush
(
‹rm
)

187 
loÿl
 
off£t
 = 
aù¬gs
[1]

188 #aùli¡ =ğ
off£t
 
th’
  
’d
 -- 
NÙhšg
 
to
 
æush
.

189 
nÙ
 
‹rm
 
th’
 
	`waùiÚ
("STOP"è
’d
 -- 
T”mš©e
 
aùiÚ
 
li¡
.

190 
	$dedu³chunk
(
off£t
)

191 
	`wÿÎ
("put", 
aù¬gs
è-- 
Add
 
ÿÎ
 
to
 
	`dasm_put
().

192 
aù¬gs
 = { #aùli¡ 
	}
} -- 
AùiÚli¡
 
off£t
 
is
 1
¡
 
¬g
 
to
 
Ãxt
 
dasm_put
().

193 
£ıos
 = 1 -- 
The
 
aùiÚli¡
 
off£t
 
occup›s
 
a
 
bufãr
 
pos™iÚ
, 
	gtoo
.

194 
	g’d


196 -- 
Put
 
esÿ³d
 
	gby‹
.

197 
loÿl
 
funùiÚ
 
	$wputb
(
n
)

198 
n
 >ğ
aùfœ¡
 
th’
 
	`waùiÚ
("ESC"è
’d
 -- 
N“d
 
to
 
esÿ³
 
by‹
.

199 
	$wputxb
(
n
)

200 
’d


204 -- 
Glob®
 
Ïb–
 
Çme
 -> 
glob®
†ab– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

205 
loÿl
 
Ãxt_glob®
 = 10

206 
loÿl
 
m­_glob®
 = 
	`£tm‘©abË
({
	}
}, { 
	g__šdex
 = 
funùiÚ
(
t
, 
Çme
)

207 
nÙ
 
m©ch
(
Çme
, "^[%a_][%w_@]*$"è
th’
 
w”rÜ
("bad glob®†ab–"è
’d


208 
loÿl
 
	gn
 = 
Ãxt_glob®


209 
n
 > 246 
th’
 
w”rÜ
("toØmªy glob®†ab–s"è
’d


210 
Ãxt_glob®
 = 
n
 + 1

211 
t
[
Çme
] = 
n


212  
n


213 
’d
})

215 -- 
Dump
 
glob®
 
	gÏb–s
.

216 
loÿl
 
funùiÚ
 
	$dumpglob®s
(
out
, 
lvl
)

217 
loÿl
 
t
 = {
	}
}

218 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


219 
out
:
	`wr™e
("Global†abels:\n")

220 
i
=10,
Ãxt_glob®
-1 do

221 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
t
[
i
]))

222 
’d


223 
out
:
	`wr™e
("\n")

224 
’d


226 -- 
Wr™e
 
glob®
 
Ïb–
 .

227 
loÿl
 
funùiÚ
 
	$wr™eglob®s
(
out
, 
´efix
)

228 
loÿl
 
t
 = {
	}
}

229 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


230 
out
:
	`wr™e
("enum {\n")

231 
i
=10,
Ãxt_glob®
-1 do

232 
out
:
	`wr™e
(" ", 
´efix
, 
	`gsub
(
t
[
i
], "@.*", ""), ",\n")

233 
’d


234 
out
:
	`wr™e
(" ", 
´efix
, "_MAX\n};\n")

235 
’d


237 -- 
Wr™e
 
glob®
 
Ïb–
 
Çmes
.

238 
loÿl
 
funùiÚ
 
	$wr™eglob®Çmes
(
out
, 
Çme
)

239 
loÿl
 
t
 = {
	}
}

240 
Çme
, 
n
 
š
 
	$·œs
(
m­_glob®
èdØ
t
[
n
] = 
Çme
 
’d


241 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

242 
i
=10,
Ãxt_glob®
-1 do

243 
out
:
	`wr™e
(" \"", 
t
[
i
], "\",\n")

244 
’d


245 
out
:
	`wr™e
(" (const char *)0\n};\n")

246 
’d


250 -- 
Ex‹º
 
Ïb–
 
Çme
 -> Ïb– 
numb”
. 
W™h
‡utØ
assignm’t
 
Ú
 1
¡
 
u£
.

251 
loÿl
 
Ãxt_ex‹º
 = -1

252 
loÿl
 
m­_ex‹º
 = 
	`£tm‘©abË
({
	}
}, { 
__šdex
 = 
funùiÚ
(
t
, 
Çme
)

253 -- 
No
 
»¡riùiÚs
 
Ú
 
the
 
Çme
 
now
.

254 
loÿl
 
n
 = 
Ãxt_ex‹º


255 
n
 < -256 
th’
 
w”rÜ
("toØmªyƒx‹º†ab–s"è
’d


256 
Ãxt_ex‹º
 = 
n
 - 1

257 
t
[
Çme
] = 
n


258  
n


259 
’d
})

261 -- 
Dump
 
Ïb–s
.

262 
loÿl
 
funùiÚ
 
	$dum³x‹ºs
(
out
, 
lvl
)

263 
loÿl
 
t
 = {
	}
}

264 
Çme
, 
n
 
š
 
	$·œs
(
m­_ex‹º
èdØ
t
[-
n
] = 
Çme
 
’d


265 
out
:
	`wr™e
("Extern†abels:\n")

266 
i
=1,-
Ãxt_ex‹º
-1 do

267 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
t
[
i
]))

268 
’d


269 
out
:
	`wr™e
("\n")

270 
’d


272 -- 
Wr™e
 
Ïb–
 
Çmes
.

273 
loÿl
 
funùiÚ
 
	$wr™“x‹ºÇmes
(
out
, 
Çme
)

274 
loÿl
 
t
 = {
	}
}

275 
Çme
, 
n
 
š
 
	$·œs
(
m­_ex‹º
èdØ
t
[-
n
] = 
Çme
 
’d


276 
out
:
	`wr™e
("¡©iøcÚ¡ ch¬ *cÚ¡ ", 
Çme
, "[] = {\n")

277 
i
=1,-
Ãxt_ex‹º
-1 do

278 
out
:
	`wr™e
(" \"", 
t
[
i
], "\",\n")

279 
’d


280 
out
:
	`wr™e
(" (const char *)0\n};\n")

281 
’d


285 -- 
Arch
-
¥ecific
 
m­s
.

286 
loÿl
 
m­_¬chdef
 = {
	}
} -- 
Ext
. 
Çme
 -> .‚ame.

287 
loÿl
 
m­_»g_»v
 = {} -- 
IÁ
. 
Çme
 -> 
ext
.‚ame.

288 
loÿl
 
m­_»g_num
 = {} -- 
IÁ
. 
Çme
 -> 
numb”
.

289 
loÿl
 
m­_»g_İsize
 = {} -- 
IÁ
. 
Çme
 -> 
İ”ªd
 
size
.

290 
loÿl
 
m­_»g_v®id_ba£
 = {} -- 
IÁ
. 
Çme
 -> 
v®id
 
ba£
 ?

291 
loÿl
 
m­_»g_v®id_šdex
 = {} -- 
IÁ
. 
Çme
 -> 
v®id
 
šdex
 ?

292 
loÿl
 
m­_»g_Ãed»x
 = {} -- 
IÁ
. 
Çme
 -> 
Ãed
 
»x
 
vs
. 
no
„ex.

293 
loÿl
 
»g_li¡
 = {} -- 
CªÚiÿl
 
li¡
 
of
 . 
Çmes
.

295 
loÿl
 
m­_ty³
 = {} -- 
Ty³
 
Çme
 -> { 
ùy³
, 
»g
 }

296 
loÿl
 
ùy³num
 = 0 -- 
Ty³
 
numb”
 (
_PTx
 
maüos
).

298 
loÿl
 
addrsize
 = 
x64
 
ªd
 "q" 
Ü
 "d" -- 
Size
 
add»ss
 
İ”ªds
.

300 -- 
H–³r
 
funùiÚs
 
to
 
fl
 
m­s
.

301 
loÿl
 
funùiÚ
 
	$mkrm­
(
sz
, 
ş
, 
Çmes
)

302 
loÿl
 
úame
 = 
	`fÜm©
("@%s", 
sz
)

303 
»g_li¡
[#»g_li¡+1] = 
úame


304 
m­_¬chdef
[
ş
] = 
úame


305 
m­_»g_»v
[
úame
] = 
ş


306 
m­_»g_num
[
úame
] = -1

307 
m­_»g_İsize
[
úame
] = 
sz


308 
sz
 =ğ
addrsize
 
Ü
 sz =ğ"d" 
th’


309 
m­_»g_v®id_ba£
[
úame
] = 
Œue


310 
m­_»g_v®id_šdex
[
úame
] = 
Œue


311 
’d


312 
Çmes
 
th’


313 
n
,
Çme
 
š
 
	$aœs
(
Çmes
) do

314 
loÿl
 
šame
 = 
	`fÜm©
("@%s%x", 
sz
, 
n
-1)

315 
»g_li¡
[#»g_li¡+1] = 
šame


316 
m­_¬chdef
[
Çme
] = 
šame


317 
m­_»g_»v
[
šame
] = 
Çme


318 
m­_»g_num
[
šame
] = 
n
-1

319 
m­_»g_İsize
[
šame
] = 
sz


320 
sz
 =ğ"b" 
ªd
 
n
 > 4 
th’
 
m­_»g_Ãed»x
[
šame
] = 
çl£
 
’d


321 
sz
 =ğ
addrsize
 
Ü
 sz =ğ"d" 
th’


322 
m­_»g_v®id_ba£
[
šame
] = 
Œue


323 
m­_»g_v®id_šdex
[
šame
] = 
Œue


324 
’d


325 
’d


326 
’d


327 
i
=0,(
x64
 
ªd
 
sz
 ~ğ"f"èªd 15 
Ü
 7 do

328 
loÿl
 
Ãed»x
 = 
sz
 =ğ"b" 
ªd
 
i
 > 3

329 
loÿl
 
šame
 = 
	`fÜm©
("@%s%x%s", 
sz
, 
i
, 
Ãed»x
 
ªd
 "R" 
Ü
 "")

330 
Ãed»x
 
th’
 
m­_»g_Ãed»x
[
šame
] = 
Œue
 
’d


331 
loÿl
 
Çme


332 
sz
 =ğ"o" 
Ü
 sz =ğ"y" 
th’
 
Çme
 = 
	`fÜm©
("%s%d", 
ş
, 
i
)

333 
–£if
 
sz
 =ğ"f" 
th’
 
Çme
 = 
	`fÜm©
("¡%d", 
i
)

334 
Çme
 = 
	`fÜm©
("r%d%s", 
i
, 
sz
 =ğ
addrsize
 
ªd
 "" 
Ü
 szè
’d


335 
m­_¬chdef
[
Çme
] = 
šame


336 
nÙ
 
m­_»g_»v
[
šame
] 
th’


337 
»g_li¡
[#»g_li¡+1] = 
šame


338 
m­_»g_»v
[
šame
] = 
Çme


339 
m­_»g_num
[
šame
] = 
i


340 
m­_»g_İsize
[
šame
] = 
sz


341 
sz
 =ğ
addrsize
 
Ü
 sz =ğ"d" 
th’


342 
m­_»g_v®id_ba£
[
šame
] = 
Œue


343 
m­_»g_v®id_šdex
[
šame
] = 
Œue


344 
’d


345 
’d


346 
’d


347 
»g_li¡
[#reg_list+1] = ""

348 
’d


350 -- 
IÁeg”
 
	`»gi¡”s
 (
qwÜd
, 
dwÜd
, 
wÜd
 
ªd
 
by‹
 
sized
).

351 
x64
 
th’


352 
	`mkrm­
("q", "Rq", {"¿x", "rcx", "rdx", "rbx", "r¥", "rbp", "rsi", "rdi"
	}
})

353 
’d


354 
mkrm­
("d", "Rd", {"eax", "ecx", "edx", "ebx", "esp", "ebp", "esi", "edi"})

355 
mkrm­
("w", "Rw", {"ax", "cx", "dx", "bx", "sp", "bp", "si", "di"})

356 
mkrm­
("b", "Rb", {"al", "cl", "dl", "bl", "ah", "ch", "dh", "bh"})

357 
m­_»g_v®id_šdex
[
m­_¬chdef
.
e¥
] = 
çl£


358 
x64
 
th’
 
m­_»g_v®id_šdex
[
m­_¬chdef
.
r¥
] = 
çl£
 
’d


359 
x64
 
th’
 
m­_»g_Ãed»x
[
m­_¬chdef
.
Rb
] = 
Œue
 
’d


360 
m­_¬chdef
["Ra"] = "@"..
addrsize


362 -- 
FP
 
»gi¡”s
 (
š‹º®ly
 
twÜd
 
sized
, 
but
 
u£
 "f" 
as
 
İ”ªd
 
size
).

363 
mkrm­
("f", "Rf")

365 -- 
SSE
 
»gi¡”s
 (
owÜd
 
sized
, 
but
 
qwÜd
 
ªd
 
dwÜd
 
acûssibË
).

366 
mkrm­
("o", "xmm")

368 -- 
AVX
 
»gi¡”s
 (
ywÜd
 
sized
, 
but
 
owÜd
, 
qwÜd
 
ªd
 
dwÜd
 
acûssibË
).

369 
mkrm­
("y", "ymm")

371 -- 
O³¿nd
 
size
 
´efixes
 
to
 
codes
.

372 
loÿl
 
m­_İsize
 = {

373 
by‹
 = "b", 
wÜd
 = "w", 
dwÜd
 = "d", 
qwÜd
 = "q", 
owÜd
 = "o", 
ywÜd
 = "y",

374 
twÜd
 = "t", 
awÜd
 = 
addrsize
,

377 -- 
O³¿nd
 
size
 
code
 
to
 
numb”
.

378 
loÿl
 
m­_İsiz’um
 = {

379 
b
 = 1, 
w
 = 2, 
d
 = 4, 
q
 = 8, 
o
 = 16, 
y
 = 32, 
t
 = 10,

382 -- 
O³¿nd
 
size
 
code
 
to
 
Çme
.

383 
loÿl
 
m­_İsiz’ame
 = {

384 
b
 = "by‹", 
w
 = "wÜd", 
d
 = "dwÜd", 
q
 = "qwÜd", 
o
 = "owÜd", 
y
 = "yword",

385 
t
 = "twÜd", 
f
 = "fpword",

388 -- 
V®id
 
šdex
 
sÿË
 
çùÜs
.

389 
loÿl
 
m­_xsc
 = {

393 -- 
CÚd™iÚ
 
codes
.

394 
loÿl
 
m­_cc
 = {

395 
o
 = 0, 
no
 = 1, 
b
 = 2, 
nb
 = 3, 
e
 = 4, 
Ã
 = 5, 
be
 = 6, 
nbe
 = 7,

396 
s
 = 8, 
ns
 = 9, 
p
 = 10, 
Å
 = 11, 
l
 = 12, 
Æ
 = 13, 
Ë
 = 14, 
Æe
 = 15,

397 
c
 = 2, 
Çe
 = 2, 
nc
 = 3, 
«
 = 3, 
z
 = 4, 
nz
 = 5, 
Ç
 = 6, 
a
 = 7,

398 
³
 = 10, 
po
 = 11, 
nge
 = 12, 
ge
 = 13, 
ng
 = 14, 
g
 = 15,

402 -- 
Rev”£
 
defšes
 
»gi¡”s
.

403 
funùiÚ
 
_M
.
	$»vdef
(
s
)

404  
	`gsub
(
s
, "@%w+", 
m­_»g_»v
)

405 
’d


407 -- 
Dump
 
Çmes
 
ªd
 
numb”s


408 
loÿl
 
funùiÚ
 
	$dum´egs
(
out
)

409 
out
:
	`wr™e
("Register‚ames, sizes‡nd internal‚umbers:\n")

410 
_
,
»g
 
š
 
	$aœs
(
»g_li¡
) do

411 
»g
 =ğ"" 
th’


412 
out
:
	`wr™e
("\n")

414 
loÿl
 
Çme
 = 
m­_»g_»v
[
»g
]

415 
loÿl
 
num
 = 
m­_»g_num
[
»g
]

416 
loÿl
 
İsize
 = 
m­_İsiz’ame
[
m­_»g_İsize
[
»g
]]

417 
out
:
	`wr™e
(
	`fÜm©
(" %-5 %-8 %s\n", 
Çme
, 
İsize
,

418 
num
 < 0 
ªd
 "(v¬ŸbË)" 
Ü
‚um))

419 
’d


420 
’d


421 
’d


425 -- 
Put
 
aùiÚ
 
Ïb–
 
	`¬g
 (
IMM_LG
, 
IMM_PC
, 
REL_LG
, 
REL_PC
).

426 
loÿl
 
funùiÚ
 
	$wpuab–
(
­»fix
, 
imm
, 
num
)

427 
	`ty³
(
imm
è=ğ"numb”" 
th’


428 
imm
 < 0 
th’


429 
	`waùiÚ
("EXTERN")

430 
	`wputxb
(
­»fix
 =ğ"IMM_" 
ªd
 0 
Ü
 1)

431 
imm
 = -imm-1

433 
	`waùiÚ
(
­»fix
.."LG", 
n
, 
num
);

434 
’d


435 
	$wputxb
(
imm
)

437 
	`waùiÚ
(
­»fix
.."PC", 
imm
, 
num
)

438 
’d


439 
’d


441 -- 
Put
 sigÃd 
by‹
 
Ü
 
¬g
.

442 
loÿl
 
funùiÚ
 
	$wputsb¬g
(
n
)

443 
	`ty³
(
n
è=ğ"numb”" 
th’


444 
n
 < -128 
Ü
‚ > 127 
th’


445 
	`w”rÜ
("signed immediate byte out of„ange")

446 
’d


447 
n
 < 0 
th’
‚ =‚ + 256 
’d


448 
	$wputb
(
n
)

449 
	`waùiÚ
("IMM_S", 
n
è
’d


450 
’d


452 -- 
Put
 
by‹
 
Ü
 
¬g
.

453 
loÿl
 
funùiÚ
 
	$wputb¬g
(
n
)

454 
	`ty³
(
n
è=ğ"numb”" 
th’


455 
n
 < 0 
Ü
‚ > 255 
th’


456 
	`w”rÜ
("unsigned immediate byte out of„ange")

457 
’d


458 
	$wputb
(
n
)

459 
	`waùiÚ
("IMM_B", 
n
è
’d


460 
’d


462 -- 
Put
 
wÜd
 
Ü
 
¬g
.

463 
loÿl
 
funùiÚ
 
	$wputw¬g
(
n
)

464 
	`ty³
(
n
è=ğ"numb”" 
th’


465 
	`shr
(
n
, 16è~ğ0 
th’


466 
	`w”rÜ
("unsigned immediate word out of„ange")

467 
’d


468 
	`wputb
(
	`bªd
(
n
, 255)); wputb(
	`shr
(n, 8));

469 
	`waùiÚ
("IMM_W", 
n
è
’d


470 
’d


472 -- 
Put
 sigÃd 
Ü
 
dwÜd
 o¸
¬g
.

473 
loÿl
 
funùiÚ
 
	$wputd¬g
(
n
)

474 
loÿl
 
Š
 = 
	$ty³
(
n
)

475 
Š
 =ğ"numb”" 
th’


476 
	`wputb
(
	$bªd
(
n
, 255))

477 
	`wputb
(
	`bªd
(
	`shr
(
n
, 8), 255))

478 
	`wputb
(
	`bªd
(
	`shr
(
n
, 16), 255))

479 
	`wputb
(
	$shr
(
n
, 24))

480 
–£if
 
Š
 =ğ"bË" 
th’


481 
	`wpuab–
("IMM_", 
n
[1], 1)

483 
	`waùiÚ
("IMM_D", 
n
)

484 
’d


485 
’d


487 -- 
Put
 
İ”ªd
-
size
 
d•’d’t
 
numb”
 
Ü
 
	`¬g
 (
deçuÉs
 
to
 
dwÜd
).

488 
loÿl
 
funùiÚ
 
	$wputsz¬g
(
sz
, 
n
)

489 
nÙ
 
sz
 
Ü
 sz =ğ"d" o¸sz =ğ"q" 
th’
 
	$wputd¬g
(
n
)

490 
–£if
 
sz
 =ğ"w" 
th’
 
	$wputw¬g
(
n
)

491 
–£if
 
sz
 =ğ"b" 
th’
 
	$wputb¬g
(
n
)

492 
–£if
 
sz
 =ğ"s" 
th’
 
	$wputsb¬g
(
n
)

493 
	`w”rÜ
("bad o³¿nd size"è
’d


494 
’d


496 -- 
Put
 
muÉi
-
by‹
 
İcode
 
w™h
 
İ”ªd
-
size
 
d•’d’t
 
modifiÿtiÚs
.

497 
loÿl
 
funùiÚ
 
	$wputİ
(
sz
, 
İ
, 
»x
, 
vex
, 
v»gr
, 
v»gxb
)

498 
loÿl
 
psz
, 
sk
 = 0, 
n


499 
vex
 
th’


500 
loÿl
 



501 
vex
.
m
 =ğ1 
ªd
 
	`bªd
(
»x
, 11è=ğ0 
th’


502 
x64
 
ªd
 
v»gxb
 
th’


503 
sk
 = 
m­_v»g
["modrm.reg"]

505 
	$wputb
(0xc5)

506 

 = 
	`shl
(
	`bxÜ
(
	`bªd
(
»x
, 4), 4), 5)

507 
psz
 = 3

508 
’d


509 
’d


510 
nÙ
 

 
th’


511 
	$wputb
(0xc4)

512 
	`wputb
(
	`shl
(
	`bxÜ
(
	`bªd
(
»x
, 7), 7), 5è+ 
vex
.
m
)

513 

 = 
	`shl
(
	`bªd
(
»x
, 8), 4)

514 
psz
 = 4

515 
’d


516 
loÿl
 
»g
, 
v»g
 = 0, 
n


517 
vex
.
v
 
th’


518 
»g
 = 
vex
.
v
.reg

519 
nÙ
 
»g
 
th’
 
	`w”rÜ
("bad vex o³¿nd"è
’d


520 
»g
 < 0 
th’
„eg = 0; 
v»g
 = 
vex
.
v
.v»g 
’d


521 
’d


522 
sz
 =ğ"y" 
Ü
 
vex
.
l
 
th’
 

 =a + 4 
’d


523 
	`wputb
(

 + 
	`shl
(
	`bxÜ
(
»g
, 15), 3è+ 
vex
.
p
)

524 
	`wv»g
("vex.v", 
v»g
)

525 
»x
 = 0

526 
İ
 >ğ256 
th’
 
	`w”rÜ
("bad vex opcode"è
’d


528 
»x
 ~ğ0 
th’


529 
nÙ
 
x64
 
th’
 
	`w”rÜ
("bad o³¿nd size"è
’d


530 
	$–£if
 (
v»gr
 
Ü
 
v»gxb
è
ªd
 
x64
 
th’


531 
»x
 = 0x10

532 
sk
 = 
m­_v»g
["vex.v"]

533 
’d


534 
’d


535 
loÿl
 
r


536 
sz
 =ğ"w" 
th’
 
	$wputb
(102è
’d


537 -- 
N“ds
 >32 
b™
 
numb”s
, 
but
 
Úly
 
üc32
 
—x
, 
wÜd
 [
ebx
]

538 
İ
 >ğ4294967296 
th’
 
r
 = op%4294967296 
	`wputb
((İ-r)/4294967296èİ =„ 
’d


539 
İ
 >ğ16777216 
th’
 
	`wputb
(
	`shr
(İ, 24)); o°ğ
	$bªd
(
İ
, 0xffffffè
’d


540 
İ
 >ğ65536 
th’


541 
»x
 ~ğ0 
th’


542 
loÿl
 
İc3
 = 
	$bªd
(
İ
, 0xffff00)

543 
İc3
 =ğ0x0f3a00 
Ü
 opc3 =ğ0x0f3800 
th’


544 
	`wputb
(64 + 
	`bªd
(
»x
, 15));„ex = 0; 
psz
 = 2

545 
’d


546 
’d


547 
	`wputb
(
	`shr
(
İ
, 16)); o°ğ
	`bªd
(İ, 0xffff); 
psz
 =…sz + 1

548 
’d


549 
İ
 >ğ256 
th’


550 
loÿl
 
b
 = 
	$shr
(
İ
, 8)

551 
b
 =ğ15 
ªd
 
»x
 ~ğ0 
th’
 
	`wputb
(64 + 
	`bªd
Ôex, 15));„ex = 0; 
psz
 = 2 
’d


552 
	`wputb
(
b
); 
İ
 = 
	`bªd
(İ, 255); 
psz
 =…sz + 1

553 
’d


554 
»x
 ~ğ0 
th’
 
	`wputb
(64 + 
	`bªd
Ôex, 15)); 
psz
 = 2 
’d


555 
sz
 =ğ"b" 
th’
 
İ
 = o°- 1 
’d


556 
	$wputb
(
İ
)

557  
psz
, 
sk


558 
’d


560 -- 
Put
 
ModRM
 
Ü
 
SIB
 
fÜm©‹d
 
by‹
.

561 
loÿl
 
funùiÚ
 
	$wputmodrm
(
m
, 
s
, 
rm
, 
vs
, 
vrm
)

562 
	`as£¹
(
m
 < 4 
ªd
 
s
 < 16‡nd 
rm
 < 16, "bad modrm operands")

563 
	`wputb
(
	`shl
(
m
, 6è+ shl(
	`bªd
(
s
, 7), 3è+ 
	$bªd
(
rm
, 7))

564 
’d


566 -- 
Put
 
ModRM
/
SIB
 
¶us
 
İtiÚ®
 
di¥Ïûm’t
.

567 
loÿl
 
funùiÚ
 
	$wputmrmsib
(
t
, 
im¬k
, 
s
, 
v¤eg
, 
psz
, 
sk
)

568 
loÿl
 
v»g
, 
vx»g


569 
loÿl
 
»g
, 
x»g
 = 
t
.reg,.xreg

570 
»g
 
ªd
„eg < 0 
th’
„eg = 0; 
v»g
 = 
t
.v»g 
’d


571 
x»g
 
ªd
 x»g < 0 
th’
 x»g = 0; 
vx»g
 = 
t
.vx»g 
’d


572 
s
 < 0 
th’
 s = 0 
’d


574 -- 
Regi¡”
 
mode
.

575 
	`sub
(
t
.
mode
, 1, 1è=ğ"r" 
th’


576 
	$wputmodrm
(3, 
s
, 
»g
)

577 
	`wv»g
("modrm.»g", 
v¤eg
, 
psz
+1, 
sk
, 
v»g
)

578 
	`wv»g
("modrm.rm.r", 
v»g
, 
psz
+1, 
sk
)

580 
’d


582 
loÿl
 
di¥
 = 
t
.disp

583 
loÿl
 
tdi¥
 = 
	`ty³
(
di¥
)

584 -- 
No
 
ba£
 ?

585 
nÙ
 
»g
 
th’


586 
loÿl
 
r»l
 = 
çl£


587 
x»g
 
th’


588 -- 
Indexed
 
mode
 
w™h
 
šdex
 
Úly
.

589 -- [
x»g
*
xsc
+
di¥
] -> (0, 
s
, 
e¥
è(xsc, x»g, 
ebp
)

590 
	$wputmodrm
(0, 
s
, 4)

591 
im¬k
 =ğ"I" 
th’
 
	`waùiÚ
("MARK"è
’d


592 
	`wv»g
("modrm.»g", 
v¤eg
, 
psz
+1, 
sk
, 
vx»g
)

593 
	$wputmodrm
(
t
.
xsc
, 
x»g
, 5)

594 
	`wv»g
("sib.šdex", 
vx»g
, 
psz
+2, 
sk
)

596 -- 
Pu»
 32 
b™
 
di¥Ïûm’t
.

597 
x64
 
ªd
 
tdi¥
 ~ğ"bË" 
th’


598 
	`wputmodrm
(0, 
s
, 4è-- [
di¥
] -> (0, s, 
e¥
è(0,ƒ¥, 
ebp
)

599 
	`wv»g
("modrm.»g", 
v¤eg
, 
psz
+1, 
sk
)

600 
im¬k
 =ğ"I" 
th’
 
	`waùiÚ
("MARK"è
’d


601 
	$wputmodrm
(0, 4, 5)

603 
r»l
 = 
x64


604 
	`wputmodrm
(0, 
s
, 5è-- [
di¥
|
r
-
Ïb–
] -> (0, s, 
ebp
)

605 
	`wv»g
("modrm.»g", 
v¤eg
, 
psz
+1, 
sk
)

606 
im¬k
 =ğ"I" 
th’
 
	`waùiÚ
("MARK"è
’d


607 
’d


608 
’d


609 
r»l
 
th’
 -- 
Em™
 
r
-
»Ïtive
 
di¥Ïûm’t
.

610 
	`m©ch
("UWSiI", 
im¬k
è
th’


611 
	`w”rÜ
("NYI:„ip-relative displacement followed by immediate")

612 
’d


613 -- 
The
 
´evious
 
by‹
 
š
 
the
 
aùiÚ
 
bufãr
 
ÿÂÙ
 
be
 0xe9 
Ü
 0x80-0x8f.

614 
	`wpuab–
("REL_", 
di¥
[1], 2)

616 
	$wputd¬g
(
di¥
)

617 
’d


619 
’d


621 
loÿl
 
m


622 
tdi¥
 =ğ"numb”" 
th’
 -- 
Check
 
di¥Ïûm’t
 
size
 
©
 
as£mbly
 
time
.

623 
di¥
 =ğ0 
ªd
 
	`bªd
(
»g
, 7è~ğ5 
th’
 -- [
ebp
] -> [ebp+0] (
š
 
SIB
, 
too
)

624 
nÙ
 
v»g
 
th’
 
m
 = 0 
’d
 -- 
FÜû
 
DISP
 
to
 
®low
 [
	`Rd
(5)] -> [
ebp
+0]

625 
–£if
 
di¥
 >ğ-128 
ªd
 di¥ <ğ127 
th’
 
m
 = 1

626 
m
 = 2 
’d


627 
–£if
 
tdi¥
 =ğ"bË" 
th’


628 
m
 = 2

629 
’d


631 -- 
Index
 
´e£Á
 
Ü
 
e¥
 
as
 
ba£
 : 
Ãed
 
SIB
 
’codšg
.

632 
x»g
 
Ü
 
	`bªd
(
»g
, 7è=ğ4 
th’


633 
	`wputmodrm
(
m
 
Ü
 2, 
s
, 4è-- 
ModRM
.

634 
m
 =ğ
n
 
Ü
 
im¬k
 =ğ"I" 
th’
 
	`waùiÚ
("MARK"è
’d


635 
	`wv»g
("modrm.»g", 
v¤eg
, 
psz
+1, 
sk
, 
vx»g
 
Ü
 
v»g
)

636 
	`wputmodrm
(
t
.
xsc
 
Ü
 0, 
x»g
 o¸4, 
»g
è-- 
SIB
.

637 
	`wv»g
("sib.šdex", 
vx»g
, 
psz
+2, 
sk
, 
v»g
)

638 
	`wv»g
("sib.ba£", 
v»g
, 
psz
+2, 
sk
)

640 
	`wputmodrm
(
m
 
Ü
 2, 
s
, 
»g
è-- 
ModRM
.

641 ià(
im¬k
 =ğ"I" 
	$ªd
 (
m
 =ğ1 
Ü
 m == 2)) or

642 (
m
 =ğ
n
 
	$ªd
 (
v¤eg
 
Ü
 
v»g
)è
th’
 
	`waùiÚ
("MARK"è
’d


643 
	`wv»g
("modrm.»g", 
v¤eg
, 
psz
+1, 
sk
, 
v»g
)

644 
	`wv»g
("modrm.rm.m", 
v»g
, 
psz
+1, 
sk
)

645 
’d


647 -- 
Put
 
di¥Ïûm’t
.

648 
m
 =ğ1 
th’
 
	$wputsb¬g
(
di¥
)

649 
–£if
 
m
 =ğ2 
th’
 
	$wputd¬g
(
di¥
)

650 
–£if
 
m
 =ğ
n
 
th’
 
	`waùiÚ
("DISP", 
di¥
è
’d


651 
’d


655 -- 
R‘uº
 
humª
-
»adabË
 
İ”ªd
 
mode
 
¡ršg
.

656 
loÿl
 
funùiÚ
 
	$İmode¡r
(
İ
, 
¬gs
)

657 
loÿl
 
m
 = {
	}
}

658 
i
=1,#args do

659 
loÿl
 
	ga
 = 
¬gs
[
i
]

660 
m
[#m+1] = 
sub
(
a
.
mode
, 1, 1)..(
	ga
.
İsize
 
	gÜ
 "?")

661 
’d


662  
	gİ
.." "..
cÚÿt
(
m
, ",")

663 
	g’d


665 -- 
CÚv”t
 
numb”
 
to
 
v®id
 
š‹g”
 
Ü
 
	gn
.

666 
loÿl
 
funùiÚ
 
	$tošt
(
ex´
)

667 
loÿl
 
n
 = 
	$tÚumb”
(
ex´
)

668 
n
 
th’


669 
n
 % 1 ~ğ0 
Ü
‚ < -2147483648 o¸À> 4294967295 
th’


670 
	`w”rÜ
("bad iÁeg”‚umb” `"..
ex´
.."'")

671 
’d


672  
n


673 
’d


674 
’d


676 -- 
P¬£
 
immedŸ‹
 
ex´essiÚ
.

677 
loÿl
 
funùiÚ
 
	`immex´
(
ex´
)

678 -- &
	$ex´
 (
poš‹r
)

679 
	`sub
(
ex´
, 1, 1è=ğ"&" 
th’


680  "iPJ", 
	`fÜm©
("ÕŒdiff_t)(%s)", 
	$sub
(
ex´
,2))

681 
’d


683 
loÿl
 
´efix
 = 
	`sub
(
ex´
, 1, 2)

684 -- =>
	$ex´
 (
pc
 
Ïb–
 
»ã»nû
)

685 
´efix
 =ğ"=>" 
th’


686  "iJ", 
	$sub
(
ex´
, 3)

687 
’d


688 -- ->
	$Çme
 (
glob®
 
Ïb–
 
»ã»nû
)

689 
´efix
 =ğ"->" 
th’


690  "iJ", 
m­_glob®
[
	`sub
(
ex´
, 3)]

691 
’d


693 -- [<>][1-9] (
loÿl
 
Ïb–
 
»ã»nû
)

694 
loÿl
 
dœ
, 
Êum
 = 
	`m©ch
(
ex´
, "^([<>])([1-9])$")

695 
dœ
 
th’
 -- 
Fwd
: 247-255, 
Bkwd
: 1-9.

696  "iJ", 
Êum
 + (
dœ
 =ğ">" 
ªd
 246 
Ü
 0)

697 
’d


699 
loÿl
 
exŠame
 = 
	`m©ch
(
ex´
, "^extern%s+(%S+)$")

700 
exŠame
 
th’


701  "iJ", 
m­_ex‹º
[
exŠame
]

702 
’d


704 -- 
	$ex´
 (
š‹½»‹d
 
as
 
immedŸ‹
)

705  "iI", 
ex´


706 
’d


708 -- 
P¬£
 
di¥Ïûm’t
 
ex´essiÚ
: +-
num
, +-
ex´
, +-
İsize
*num

709 
loÿl
 
funùiÚ
 
	$di¥ex´
(
ex´
)

710 
loÿl
 
di¥
 = 
ex´
 =ğ"" 
ªd
 0 
Ü
 
	$tošt
(
ex´
)

711 
di¥
 
th’
  di¥ 
’d


712 
loÿl
 
c
, 
di¥t
 = 
	`m©ch
(
ex´
, "^([+-])%s*(.+)$")

713 
c
 =ğ"+" 
th’


714 
ex´
 = 
di¥t


715 
–£if
 
nÙ
 
c
 
th’


716 
	`w”rÜ
("bad di¥Ïûm’ˆex´essiÚ `"..
ex´
.."'")

717 
’d


718 
loÿl
 
İsize
, 
İs
 = 
	`m©ch
(
di¥t
, "^(%w+)%s*%*%s*(.+)$")

719 
loÿl
 
İs
, 
imm
 = 
m­_İsize
[
İsize
], 
	$tošt
(
İs
)

720 
İs
 
ªd
 
imm
 
th’


721 
c
 =ğ"-" 
th’
 
imm
 = -imm 
’d


722  
imm
*
m­_İsiz’um
[
İs
]

723 
’d


724 
loÿl
 
mode
, 
›x´
 = 
	$immex´
(
di¥t
)

725 
mode
 =ğ"iJ" 
th’


726 
c
 =ğ"-" 
th’
 
	`w”rÜ
("ÿÂÙ inv”ˆÏb–„eã»nû"è
’d


727  { 
›x´
 
	}
}

728 
’d


729  
ex´
 -- 
N“d
 
to
  
Üigš®
 sigÃd 
ex´essiÚ
.

730 
’d


732 -- 
P¬£
 
Ü
 
ty³
 
ex´essiÚ
.

733 
loÿl
 
funùiÚ
 
	$¹ex´
(
ex´
)

734 
nÙ
 
ex´
 
th’
  
’d


735 
loÿl
 
Šame
, 
ov»g
 = 
	`m©ch
(
ex´
, "^([%w_]+):(@[%w_]+)$")

736 
loÿl
 

 = 
m­_ty³
[
Šame
 
Ü
 
ex´
]

737 

 
th’


738 
loÿl
 
»g
 = 
ov»g
 
Ü
 

.reg

739 
loÿl
 
ºum
 = 
m­_»g_num
[
»g
]

740 
nÙ
 
ºum
 
th’


741 
	`w”rÜ
("ty³ `"..(
Šame
 
Ü
 
ex´
).."'‚eeds‡„egister override")

742 
’d


743 
nÙ
 
m­_»g_v®id_ba£
[
»g
] 
th’


744 
	`w”rÜ
("bad ba£„egi¡” ov”rid`"..(
m­_»g_»v
[
»g
] 
Ü
„eg).."'")

745 
’d


746  
»g
, 
ºum
, 



747 
’d


748  
ex´
, 
m­_»g_num
[expr]

749 
’d


751 -- 
P¬£
 
İ”ªd
 
ªd
  { 
mode
, 
İsize
, 
»g
, 
x»g
, 
xsc
, 
di¥
, 
imm
 
	}
}.

752 
loÿl
 
funùiÚ
 
	$·r£İ”ªd
(
·¿m
)

753 
loÿl
 
t
 = {
	}
}

755 
loÿl
 
ex´
 = 
·¿m


756 
loÿl
 
İsize
, 
	gİs
 = 
m©ch
(
·¿m
, "^(%w+)%s*(.+)$")

757 
İsize
 
th’


758 
	gt
.
	gİsize
 = 
m­_İsize
[
İsize
]

759 
t
.
İsize
 
th’
 
ex´
 = 
İs
 
’d


760 
’d


762 
loÿl
 
br
 = 
m©ch
(
ex´
, "^%[%s*(.-)%s*%]$")

763 
»³©


764 
br
 
th’


765 
	gt
.
	gmode
 = "xm"

767 -- [
di¥
]

768 
t
.
di¥
 = 
	$tošt
(
br
)

769 
t
.
di¥
 
th’


770 
t
.
mode
 = 
x64
 
ªd
 "xm" 
Ü
 "xmO"

772 
’d


774 -- [
»g
...]

775 
loÿl
 



776 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
br
, "^([@%w_:]+)%s*(.*)$")

777 
»g
, 
t
.»g, 

 = 
	$¹ex´
(
»g
)

778 
nÙ
 
t
.
»g
 
th’


779 -- [
ex´
]

780 
t
.
mode
 = 
x64
 
ªd
 "xm" 
Ü
 "xmO"

781 
t
.
di¥
 = 
	`di¥ex´
("+"..
br
)

783 
’d


785 
t
.
»g
 =ğ-1 
th’


786 
t
.
v»g
, 
r
 = 
	`m©ch
(tailr, "^(%b())(.*)$")

787 
nÙ
 
t
.
v»g
 
th’
 
	`w”rÜ
("bad v¬ŸbË„egi¡”ƒx´essiÚ"è
’d


788 
’d


790 -- [
x»g
*
xsc
] 
Ü
 [x»g*xsc+-
di¥
] o¸[x»g*xsc+-
ex´
]

791 
loÿl
 
xsc
, 
sc
 = 
	`m©ch
(
r
, "^%*%s*([1248])%s*(.*)$")

792 
xsc
 
th’


793 
nÙ
 
m­_»g_v®id_šdex
[
»g
] 
th’


794 
	`w”rÜ
("bad index„egi¡” `"..
m­_»g_»v
[
»g
].."'")

795 
’d


796 
t
.
xsc
 = 
m­_xsc
[xsc]

797 
t
.
x»g
 =.
»g


798 
t
.
vx»g
 =.
v»g


799 
t
.
»g
 = 
n


800 
t
.
v»g
 = 
n


801 
t
.
di¥
 = 
	$di¥ex´
(
sc
)

803 
’d


804 
nÙ
 
m­_»g_v®id_ba£
[
»g
] 
th’


805 
	`w”rÜ
("bad ba£„egi¡” `"..
m­_»g_»v
[
»g
].."'")

806 
’d


808 -- [
»g
] 
Ü
 [»g+-
di¥
]

809 
t
.
di¥
 = 
	$tošt
(
r
è
	`Ü
 (¸=ğ"" 
ªd
 0)

810 
t
.
di¥
 
th’
  
’d


812 -- [
»g
+
x»g
...]

813 
loÿl
 
x»g
, 
x
 = 
	`m©ch
(
r
, "^+%s*([@%w_:]+)%s*(.*)$")

814 
x»g
, 
t
.x»g, 

 = 
	$¹ex´
(
x»g
)

815 
nÙ
 
t
.
x»g
 
th’


816 -- [
»g
+-
ex´
]

817 
t
.
di¥
 = 
	$di¥ex´
(
r
)

819 
’d


820 
nÙ
 
m­_»g_v®id_šdex
[
x»g
] 
th’


821 
	`w”rÜ
("bad index„egi¡” `"..
m­_»g_»v
[
x»g
].."'")

822 
’d


824 
t
.
x»g
 =ğ-1 
th’


825 
t
.
vx»g
, 
x
 = 
	`m©ch
(tailx, "^(%b())(.*)$")

826 
nÙ
 
t
.
vx»g
 
th’
 
	`w”rÜ
("bad v¬ŸbË„egi¡”ƒx´essiÚ"è
’d


827 
’d


829 -- [
»g
+
x»g
*
xsc
...]

830 
loÿl
 
xsc
, 
sc
 = 
	`m©ch
(
x
, "^%*%s*([1248])%s*(.*)$")

831 
xsc
 
th’


832 
t
.
xsc
 = 
m­_xsc
[xsc]

833 
x
 = 
sc


834 
’d


836 -- [...] 
Ü
 [...+-
di¥
] o¸[...+-
ex´
]

837 
t
.
di¥
 = 
	$di¥ex´
(
x
)

839 -- 
imm
 
Ü
 
İsize
*imm

840 
loÿl
 
imm
 = 
	$tošt
(
ex´
)

841 
nÙ
 
imm
 
ªd
 
	`sub
(
ex´
, 1, 1è=ğ"*"‡nd 
t
.
İsize
 
th’


842 
imm
 = 
	`tošt
(
	$sub
(
ex´
, 2))

843 
imm
 
th’


844 
imm
 = imm * 
m­_İsiz’um
[
t
.
İsize
]

845 
t
.
İsize
 = 
n


846 
’d


847 
’d


848 
imm
 
th’


849 
t
.
İsize
 
th’
 
	`w”rÜ
("bad o³¿nd sizov”ride"è
’d


850 
loÿl
 
m
 = "i"

851 
imm
 =ğ1 
th’
 
m
 = m.."1" 
’d


852 
imm
 >ğ4294967168 
ªd
 imm <ğ4294967295 
th’
 imm = imm-4294967296 
’d


853 
imm
 >ğ-128 
ªd
 imm <ğ127 
th’
 
m
 = m.."S" 
’d


854 
t
.
imm
 = imm

855 
t
.
mode
 = 
m


857 
’d


859 
loÿl
 



860 
loÿl
 
»g
, 
r
 = 
	`m©ch
(
ex´
, "^([@%w_:]+)%s*(.*)$")

861 
»g
, 
t
.»g, 

 = 
	$¹ex´
(
»g
)

862 
t
.
»g
 
th’


863 
t
.
»g
 =ğ-1 
th’


864 
t
.
v»g
, 
r
 = 
	`m©ch
(tailr, "^(%b())(.*)$")

865 
nÙ
 
t
.
v»g
 
th’
 
	`w”rÜ
("bad v¬ŸbË„egi¡”ƒx´essiÚ"è
’d


866 
’d


867 -- 
»g


868 
r
 =ğ"" 
th’


869 
t
.
İsize
 
th’
 
	`w”rÜ
("bad o³¿nd sizov”ride"è
’d


870 
t
.
İsize
 = 
m­_»g_İsize
[
»g
]

871 
t
.
İsize
 =ğ"f" 
th’


872 
t
.
mode
 =.
»g
 =ğ0 
ªd
 "fF" 
Ü
 "f"

874 
»g
 =ğ"@w4" 
	`Ü
 (
x64
 
ªd
„eg =ğ"@d4"è
th’


875 
	`ww¬n
("bad id—,ry‡gaš w™h `"..(
x64
 
ªd
 "r¥'" 
Ü
 "esp'"))

876 
’d


877 
t
.
mode
 =.
»g
 =ğ0 
ªd
 "rmR" 
	`Ü
 (»g =ğ"@b1"‡nd "rmC" 
Ü
 "rm")

878 
’d


879 
t
.
Ãed»x
 = 
m­_»g_Ãed»x
[
»g
]

881 
’d


883 -- 
ty³
[
idx
],y³[idx].
f›ld
,y³->f›ld -> [
»g
+
off£t_ex´
]

884 
nÙ
 

 
th’
 
	`w”rÜ
("bad o³¿nd `"..
·¿m
.."'"è
’d


885 
t
.
mode
 = "xm"

886 
t
.
di¥
 = 
	$fÜm©
(

.
ùy³fmt
, 
r
)

888 
t
.
mode
,.
imm
 = 
	$immex´
(
ex´
)

889 
	`sub
(
t
.
mode
, -1è=ğ"J" 
th’


890 
t
.
İsize
 
ªd
.İsiz~ğ
addrsize
 
th’


891 
	`w”rÜ
("bad operand size override")

892 
’d


893 
t
.
İsize
 = 
addrsize


894 
’d


895 
’d


896 
’d


897 
uÁ
 
Œue


898  
t


899 
’d


902 -- 
x86
 
Tem¶©e
 
SŒšg
 
DesütiÚ


905 -- 
Each
 
‹m¶©e
 
¡ršg
 
is
 
a
 
li¡
 
of
 [
m©ch
:]
·‰”n
 
·œs
,

906 -- 
£·¿‹d
 
by
 "|". 
The
 
fœ¡
 
m©ch
 
wšs
. 
No
 m©ch 
m—ns
 
a


907 -- 
bad
 
Ü
 
unsuµÜ‹d
 
combš©iÚ
 
of
 
İ”ªd
 
modes
 o¸
sizes
.

909 -- 
The
 
m©ch
 
·¹
 
ªd
 
the
 ":" 
is
 
om™‹d
 th
İ”©iÚ
 
has


910 -- 
no
 
İ”ªds
. 
Oth”wi£
 
the
 
fœ¡
 
N
 
ch¬aù”s
 
¬e
 
m©ched


911 -- 
agaš¡
 
the
 
mode
 
¡ršgs
 
of
 
—ch
 oàth
N
 
İ”ªds
.

913 -- 
The
 
mode
 
¡ršg
 
—ch
 
İ”ªd
 
ty³
 
	`is
 (
£e
 
	$·r£İ”ªd
()):

914 -- 
IÁeg”
 : "rm", +"R" 
—x
, 
ax
, 
®
, +"C" 
ş


915 -- 
FP
 : "f", +"F" 
¡0


916 -- 
Index
 
İ”ªd
: "xm", +"O" [
di¥
] (
pu»
 
off£t
)

917 -- 
ImmedŸ‹
: "i", +"S" sigÃd 8 
b™
, +"1" 1,

918 -- +"I" 
¬g
, +"P" 
poš‹r


919 -- 
Any
: +"J" 
v®id
 
jump
 
rg‘s


921 -- 
So
 
a
 
m©ch
 
ch¬aù”
 "m" (
mixed
è
m©ches
 
bÙh
 
ª
 
š‹g”
 

922 -- 
ªd
 
ª
 
šdex
 
	`İ”ªd
 (
to
 
be
 
’coded
 
w™h
 
the
 
ModRM
/
SIB
 
scheme
).

923 -- 
But
 "r" 
m©ches
 
Úly
 
a
 
ªd
 "x" oÆy 
ª
 
šdex
 
İ”ªd


924 -- (
e
.
g
. 
FP
 
memÜy
 
acûss
 
İ”©iÚs
).

926 -- 
The
 
İ”ªd
 
size
 
m©ch
 
¡ršg
 
¡¬ts
 
right
 
aá”
 
the
 
mode
 match

927 -- 
ch¬aù”s
 
ªd
 
’ds
 
befÜe
 
the
 ":". "dwb" 
Ü
 "qdwb" 
is
 
assumed
, 
em±y
.

928 -- 
The
 
efãùive
 
d©a
 
size
 
of
 
the
 
İ”©iÚ
 
is
 
m©ched
 
agaš¡
 
this
 
li¡
.

930 -- 
If
 
Úly
 
the
 
»guÏr
 "b", "w", "d", "q", "t" 
İ”ªd
 
sizes
 
¬e


931 -- 
´e£Á
, 
th’
 
®l
 
İ”ªds
 
mu¡
 
be
 
the
 
§me
 
size
. 
Un¥ecif›d
 
sizes


932 -- 
¬e
 
ignÜed
, 
but
 
©
 
Ëa¡
 
Úe
 
İ”ªd
 
mu¡
 
have
 
a
 
size
 
Ü
 
the
 
·‰”n


933 -- 
wÚ
't match (usehe "byte", "word", "dword", "qword", "tword"

934 -- 
İ”ªd
 
size
 
ov”rides
. 
E
.
g
.: 
mov
 
dwÜd
 [
—x
], 1).

936 -- 
If
 
the
 
li¡
 
has
 
a
 "1" 
Ü
 "2" 
´efix
,h
İ”ªd
 
size
 
is
 
k’


937 -- 
äom
 
the
 
»¥eùive
 
İ”ªd
 
ªd
 
ªy
 
Ùh”
 o³¿nd 
sizes
 
¬e
 
ignÜed
.

938 -- 
If
 
the
 
li¡
 
cÚšs
 
Úly
 ".", 
®l
 
İ”ªd
 
sizes
 
¬e
 
ignÜed
.

939 -- 
If
 
the
 
li¡
 
has
 
a
 "/" 
´efix
,h
	$cÚÿ‹Ç‹d
 (
mixed
è
İ”ªd
 
sizes


940 -- 
¬e
 
com·»d
 
to
 
the
 
m©ch
.

942 -- 
E
.
g
. "¼dw" 
m©ches
 
e™h”
 
two
 
dwÜd
 
»gi¡”s
 
Ü
wØ
wÜd


943 -- 
»gi¡”s
. "Fx2dq" 
m©ches
 
ª
 
¡0
 
İ”ªd
 
¶us
‡À
šdex
 operand

944 -- 
poštšg
 
to
 
a
 
	$dwÜd
 (è
Ü
 
	`qwÜd
 ().

946 -- 
Ev”y
 
ch¬aù”
 
aá”
 
the
 ":" 
is
 
·¹
 
of
h
·‰”n
 
¡ršg
:

947 -- 
Hex
 
ch¬s
 
¬e
 
accumuÏ‹d
 
to
 
fÜm
 
the
 
	`İcode
 (
Ëá
Ø
right
).

948 -- "n" 
di§bËs
 
the
 
¡ªd¬d
 
İcode
 
mods


949 -- (
Ùh”wi£
: -1 "b", 
o16
 
´efix
 "w", 
»x
.
w
 "q")

950 -- "X" 
FÜû
 
REX
.
W
.

951 -- "r"/"R" 
adds
 
the
 
»g
. 
numb”
 
äom
h1
¡
/2
nd
 
İ”ªd
 
to
h
İcode
.

952 -- "m"/"M" 
g’”©es
 
ModRM
/
SIB
 
äom
 
the
 1
¡
/2
nd
 
İ”ªd
.

953 -- 
The
 
¥¬e
 3 
b™s
 
¬e
 
e™h”
 
fËd
 
w™h
 
the
 
Ï¡
 
hex
 
dig™
 
Ü


954 -- 
the
 
»suÉ
 
äom
 
a
 
´evious
 "r"/"R". 
The
 
İcode
 
is
 
»¡Üed
.

955 -- "u" 
U£
 
VEX
 
’codšg
, 
vvvv
 
unu£d
.

956 -- "v"/"V" 
U£
 
VEX
 
’codšg
, 
vvvv
 
äom
 1
¡
/2
nd
 
	`İ”ªd
 (
the
 
İ”ªd
 
is


957 -- 
»moved
 
äom
 
the
 
li¡
 
u£d
 
by
 
futu»
 
ch¬aù”s
).

958 -- "L" 
FÜû
 
VEX
.
L


960 -- 
AÎ
 
of
 
the
 
fŞlowšg
 
ch¬aù”s
 
fÜû
 
a
 
æush
 oàth
İcode
:

961 -- "o"/"O" 
¡Ües
 
a
 
pu»
 32 
b™
 
	$di¥
 (
off£t
è
äom
 
the
 1
¡
/2
nd
 
İ”ªd
.

962 -- "s" 
¡Ües
 
a
 4 
b™
 
immedŸ‹
 
äom
 
the
 
Ï¡
 
İ”ªd
,

963 -- 
fŞlowed
 
by
 4 
z”o
 
b™s
.

964 -- "S" 
¡Ües
 
a
 sigÃd 8 
b™
 
immedŸ‹
 
äom
 
the
 
Ï¡
 
İ”ªd
.

965 -- "U" 
¡Ües
 
ª
 8 
b™
 
immedŸ‹
 
äom
 
the
 
Ï¡
 
İ”ªd
.

966 -- "W" 
¡Ües
 
ª
 16 
b™
 
immedŸ‹
 
äom
 
the
 
Ï¡
 
İ”ªd
.

967 -- "i" 
¡Ües
 
ª
 
İ”ªd
 
sized
 
immedŸ‹
 
äom
 
the
 
Ï¡
 operand.

968 -- "I" 
d™o
, 
but
 
g’”©es
 
ª
 
aùiÚ
 
code
 
to
 
İtiÚ®ly
 
modify


969 -- 
the
 
	`İcode
 (+2è
a
 sigÃd 8 
b™
 
immedŸ‹
.

970 -- "J" 
g’”©es
 
Úe
 
of
 
the
 
REL
 
aùiÚ
 
codes
 
äom
h
Ï¡
 
İ”ªd
.

974 -- 
Tem¶©e
 
¡ršgs
 
x86
 
š¡ruùiÚs
. 
Ord”ed
 
by
 
fœ¡
 
İcode
 
by‹
.

975 -- 
Unim¶em’‹d
 
	$İcodes
 (
d–ib”©e
 
omissiÚs
è
¬e
 
m¬ked
 
w™h
 *.

976 
loÿl
 
m­_İ
 = {

977 -- 00-05: 
add
...

978 -- 06: *
push
 
es


979 -- 07: *
pİ
 
es


980 -- 08-0D: 
Ü
...

981 -- 0E: *
push
 
cs


982 -- 0F: 
two
 
by‹
 
İcode
 
´efix


983 -- 10-15: 
adc
...

984 -- 16: *
push
 
ss


985 -- 17: *
pİ
 
ss


986 -- 18-1D: 
sbb
...

987 -- 1E: *
push
 
ds


988 -- 1F: *
pİ
 
ds


989 -- 20-25: 
ªd
...

990 
es_0
 = "26",

991 -- 27: *
d¯


992 -- 28-2D: 
sub
...

993 
cs_0
 = "2E",

994 -- 2F: *
das


995 -- 30-35: 
xÜ
...

996 
ss_0
 = "36",

997 -- 37: *
¯a


998 -- 38-3D: 
cmp
...

999 
ds_0
 = "3E",

1000 -- 3F: *
¯s


1001 
šc_1
 = 
x64
 
ªd
 "m:FF0m" 
Ü
 "rdw:40r|m:FF0m",

1002 
dec_1
 = 
x64
 
ªd
 "m:FF1m" 
Ü
 "rdw:48r|m:FF1m",

1003 
push_1
 = (
x64
 
ªd
 "rq:n50r|rw:50r|mq:nFF6m|mw:FF6m" 
Ü


1005 
pİ_1
 = 
x64
 
ªd
 "rq:n58r|rw:58r|mq:n8F0m|mw:8F0m" 
Ü
 "rdw:58r|mdw:8F0m",

1006 -- 60: *
pusha
, *
pushad
, *
pushaw


1007 -- 61: *
pİa
, *
pİad
, *
pİaw


1008 -- 62: *
bound
 
rdw
,
x


1009 -- 63: 
x86
: *
¬¶
 
mw
,
rw


1010 
movsxd_2
 = 
x64
 
ªd
 "rm/qd:63rM",

1011 
fs_0
 = "64",

1012 
gs_0
 = "65",

1013 
o16_0
 = "66",

1014 
a16_0
 = 
nÙ
 
x64
 
ªd
 "67" 
Ü
 
n
,

1015 
a32_0
 = 
x64
 
ªd
 "67",

1016 -- 68: 
push
 
idw


1017 -- 69: 
imul
 
rdw
,
mdw
,
idw


1018 -- 6A: 
push
 
ib


1019 -- 6B: 
imul
 
rdw
,
mdw
,
S


1020 -- 6C: *
šsb


1021 -- 6D: *
šsd
, *
šsw


1022 -- 6E: *
outsb


1023 -- 6F: *
outsd
, *
outsw


1024 -- 70-7F: 
jcc
 
lb


1025 -- 80: 
add
... 
mb
,
i


1026 -- 81: 
add
... 
mdw
,
i


1027 -- 82: *
undefšed


1028 -- 83: 
add
... 
mdw
,
S


1029 
‹¡_2
 = "mr:85Rm|rm:85rM|Ri:A9ri|mi:F70mi",

1030 -- 86: 
xchg
 
rb
,
mb


1031 -- 87: 
xchg
 
rdw
,
mdw


1032 -- 88: 
mov
 
mb
,
r


1033 -- 89: 
mov
 
mdw
,
r


1034 -- 8A: 
mov
 
r
,
mb


1035 -- 8B: 
mov
 
r
,
mdw


1036 -- 8C: *
mov
 
mdw
,
£g


1037 
Ëa_2
 = "rx1dq:8DrM",

1038 -- 8E: *
mov
 
£g
,
mdw


1039 -- 8F: 
pİ
 
mdw


1040 
nİ_0
 = "90",

1041 
xchg_2
 = "Rrqdw:90R|rRqdw:90r|rm:87rM|mr:87Rm",

1042 
cbw_0
 = "6698",

1043 
cwde_0
 = "98",

1044 
cdqe_0
 = "4898",

1045 
cwd_0
 = "6699",

1046 
cdq_0
 = "99",

1047 
cqo_0
 = "4899",

1048 -- 9A: *
ÿÎ
 
iw
:
idw


1049 
wa™_0
 = "9B",

1050 
fwa™_0
 = "9B",

1051 
pushf_0
 = "9C",

1052 
pushfd_0
 = 
nÙ
 
x64
 
ªd
 "9C",

1053 
pushfq_0
 = 
x64
 
ªd
 "9C",

1054 
pİf_0
 = "9D",

1055 
pİfd_0
 = 
nÙ
 
x64
 
ªd
 "9D",

1056 
pİfq_0
 = 
x64
 
ªd
 "9D",

1057 
§hf_0
 = "9E",

1058 
Ïhf_0
 = "9F",

1059 
mov_2
 = "OR:A3o|RO:A1O|mr:89Rm|rm:8BrM|rib:nB0ri|ridw:B8ri|mi:C70mi",

1060 
movsb_0
 = "A4",

1061 
movsw_0
 = "66A5",

1062 
movsd_0
 = "A5",

1063 
cmpsb_0
 = "A6",

1064 
cmpsw_0
 = "66A7",

1065 
cmpsd_0
 = "A7",

1066 -- 
A8
: 
‹¡
 
Rb
,
i


1067 -- 
A9
: 
‹¡
 
Rdw
,
i


1068 
¡osb_0
 = "AA",

1069 
¡osw_0
 = "66AB",

1070 
¡osd_0
 = "AB",

1071 
lodsb_0
 = "AC",

1072 
lodsw_0
 = "66AD",

1073 
lodsd_0
 = "AD",

1074 
sÿsb_0
 = "AE",

1075 
sÿsw_0
 = "66AF",

1076 
sÿsd_0
 = "AF",

1077 -- 
B0
-
B7
: 
mov
 
rb
,
i


1078 -- 
B8
-
BF
: 
mov
 
rdw
,
i


1079 -- 
C0
: 
rŞ
... 
mb
,
i


1080 -- 
C1
: 
rŞ
... 
mdw
,
i


1081 
»t_1
 = "i.:nC2W",

1082 
»t_0
 = "C3",

1083 -- 
C4
: *
Ës
 
rdw
,
mq


1084 -- 
C5
: *
lds
 
rdw
,
mq


1085 -- 
C6
: 
mov
 
mb
,
i


1086 -- 
C7
: 
mov
 
mdw
,
i


1087 -- 
C8
: *
’‹r
 
iw
,
ib


1088 
Ëave_0
 = "C9",

1089 -- 
CA
: *
»tf
 
iw


1090 -- 
CB
: *
»tf


1091 
št3_0
 = "CC",

1092 
št_1
 = "i.:nCDU",

1093 
što_0
 = "CE",

1094 -- 
CF
: *
œ‘


1095 -- 
D0
: 
rŞ
... 
mb
,1

1096 -- 
D1
: 
rŞ
... 
mdw
,1

1097 -- 
D2
: 
rŞ
... 
mb
,
ş


1098 -- 
D3
: 
rŞ
... 
mb
,
ş


1099 -- 
D4
: *
¯m
 
ib


1100 -- 
D5
: *
¯d
 
ib


1101 -- 
D6
: *
§lc


1102 -- 
D7
: *
xÏt


1103 -- 
D8
-
DF
: 
æßtšg
 
pošt
 
İs


1104 -- 
E0
: *
loİÃ


1105 -- 
E1
: *
loİe


1106 -- 
E2
: *
loİ


1107 -- 
E3
: *
jcxz
, *
jecxz


1108 -- 
E4
: *
š
 
Rb
,
ib


1109 -- 
E5
: *
š
 
Rdw
,
ib


1110 -- 
E6
: *
out
 
ib
,
Rb


1111 -- 
E7
: *
out
 
ib
,
Rdw


1112 
ÿÎ_1
 = 
x64
 
ªd
 "mq:nFF2m|J.:E8nJ" 
Ü
 "md:FF2m|J.:E8J",

1113 
jmp_1
 = 
x64
 
ªd
 "mq:nFF4m|J.:E9nJ" 
Ü
 "md:FF4m|J.:E9J", -- : 
EB


1114 -- 
EA
: *
jmp
 
iw
:
idw


1115 -- 
EB
: 
jmp
 
ib


1116 -- 
EC
: *
š
 
Rb
,
dx


1117 -- 
ED
: *
š
 
Rdw
,
dx


1118 -- 
EE
: *
out
 
dx
,
Rb


1119 -- 
EF
: *
out
 
dx
,
Rdw


1120 
lock_0
 = "F0",

1121 
št1_0
 = "F1",

1122 
»²e_0
 = "F2",

1123 
»²z_0
 = "F2",

1124 
»p_0
 = "F3",

1125 
»³_0
 = "F3",

1126 
»pz_0
 = "F3",

1127 -- 
F4
: *
hÉ


1128 
cmc_0
 = "F5",

1129 -- 
F6
: 
‹¡
... 
mb
,
i
; 
div
... mb

1130 -- 
F7
: 
‹¡
... 
mdw
,
i
; 
div
... mdw

1131 
şc_0
 = "F8",

1132 
¡c_0
 = "F9",

1133 -- 
FA
: *
şi


1134 
şd_0
 = "FC",

1135 
¡d_0
 = "FD",

1136 -- 
FE
: 
šc
... 
mb


1137 -- 
FF
: 
šc
... 
mdw


1139 -- 
misc
 
İs


1140 
nÙ_1
 = "m:F72m",

1141 
Ãg_1
 = "m:F73m",

1142 
mul_1
 = "m:F74m",

1143 
imul_1
 = "m:F75m",

1144 
div_1
 = "m:F76m",

1145 
idiv_1
 = "m:F77m",

1147 
imul_2
 = "rmqdw:0FAFrM|rIqdw:69rmI|rSqdw:6BrmS|riqdw:69rmi",

1148 
imul_3
 = "rmIqdw:69rMI|rmSqdw:6BrMS|rmiqdw:69rMi",

1150 
movzx_2
 = "rm/db:0FB6rM|rm/qb:|rm/wb:0FB6rM|rm/dw:0FB7rM|rm/qw:",

1151 
movsx_2
 = "rm/db:0FBErM|rm/qb:|rm/wb:0FBErM|rm/dw:0FBFrM|rm/qw:",

1153 
bsw­_1
 = "rqd:0FC8r",

1154 
bsf_2
 = "rmqdw:0FBCrM",

1155 
b¤_2
 = "rmqdw:0FBDrM",

1156 
bt_2
 = "mrqdw:0FA3Rm|miqdw:0FBA4mU",

1157 
btc_2
 = "mrqdw:0FBBRm|miqdw:0FBA7mU",

1158 
bŒ_2
 = "mrqdw:0FB3Rm|miqdw:0FBA6mU",

1159 
bts_2
 = "mrqdw:0FABRm|miqdw:0FBA5mU",

1161 
shld_3
 = "mriqdw:0FA4RmU|mrC/qq:0FA5Rm|mrC/dd:|mrC/ww:",

1162 
shrd_3
 = "mriqdw:0FACRmU|mrC/qq:0FADRm|mrC/dd:|mrC/ww:",

1164 
rdtsc_0
 = "0F31", -- 
P1
+

1165 
rdpmc_0
 = "0F33", -- 
P6
+

1166 
ıuid_0
 = "0FA2", -- 
P1
+

1168 -- 
æßtšg
 
pošt
 
İs


1169 
f¡_1
 = "ff:DDD0r|xd:D92m|xq:nDD2m",

1170 
f¡p_1
 = "ff:DDD8r|xd:D93m|xq:nDD3m|xt:DB7m",

1171 
æd_1
 = "ff:D9C0r|xd:D90m|xq:nDD0m|xt:DB5m",

1173 
åİ_0
 = "DDD8", -- 
AlŸs
 
f¡p
 
¡0
.

1175 
fi¡_1
 = "xw:nDF2m|xd:DB2m",

1176 
fi¡p_1
 = "xw:nDF3m|xd:DB3m|xq:nDF7m",

1177 
fd_1
 = "xw:nDF0m|xd:DB0m|xq:nDF5m",

1179 
fxch_0
 = "D9C9",

1180 
fxch_1
 = "ff:D9C8r",

1181 
fxch_2
 = "fFf:D9C8r|Fff:D9C8R",

1183 
fucom_1
 = "ff:DDE0r",

1184 
fucom_2
 = "Fff:DDE0R",

1185 
fucomp_1
 = "ff:DDE8r",

1186 
fucomp_2
 = "Fff:DDE8R",

1187 
fucomi_1
 = "ff:DBE8r", -- 
P6
+

1188 
fucomi_2
 = "Fff:DBE8R", -- 
P6
+

1189 
fucom_1
 = "ff:DFE8r", -- 
P6
+

1190 
fucom_2
 = "Fff:DFE8R", -- 
P6
+

1191 
fcomi_1
 = "ff:DBF0r", -- 
P6
+

1192 
fcomi_2
 = "Fff:DBF0R", -- 
P6
+

1193 
fcom_1
 = "ff:DFF0r", -- 
P6
+

1194 
fcom_2
 = "Fff:DFF0R", -- 
P6
+

1195 
fucomµ_0
 = "DAE9",

1196 
fcomµ_0
 = "DED9",

1198 
æd’v_1
 = "x.:D94m",

1199 
â¡’v_1
 = "x.:D96m",

1200 
f¡’v_1
 = "x.:9BD96m",

1201 
ædcw_1
 = "xw:nD95m",

1202 
f¡cw_1
 = "xw:n9BD97m",

1203 
â¡cw_1
 = "xw:nD97m",

1204 
f¡sw_1
 = "Rw:n9BDFE0|xw:n9BDD7m",

1205 
â¡sw_1
 = "Rw:nDFE0|xw:nDD7m",

1206 
fşex_0
 = "9BDBE2",

1207 
âşex_0
 = "DBE2",

1209 
âİ_0
 = "D9D0",

1210 -- 
D9D1
-
D9DF
: 
uÇssigÃd


1212 
fchs_0
 = "D9E0",

1213 
çbs_0
 = "D9E1",

1214 -- 
D9E2
: 
uÇssigÃd


1215 -- 
D9E3
: 
uÇssigÃd


1216 
á¡_0
 = "D9E4",

1217 
fxam_0
 = "D9E5",

1218 -- 
D9E6
: 
uÇssigÃd


1219 -- 
D9E7
: 
uÇssigÃd


1220 
æd1_0
 = "D9E8",

1221 
ædl2t_0
 = "D9E9",

1222 
ædl2e_0
 = "D9EA",

1223 
ædpi_0
 = "D9EB",

1224 
ædlg2_0
 = "D9EC",

1225 
ædÊ2_0
 = "D9ED",

1226 
ædz_0
 = "D9EE",

1227 -- 
D9EF
: 
uÇssigÃd


1229 
f2xm1_0
 = "D9F0",

1230 
fyl2x_0
 = "D9F1",

1231 
ån_0
 = "D9F2",

1232 
å©ª_0
 = "D9F3",

1233 
fxŒaù_0
 = "D9F4",

1234 
å»m1_0
 = "D9F5",

1235 
fdec¡p_0
 = "D9F6",

1236 
fšc¡p_0
 = "D9F7",

1237 
å»m_0
 = "D9F8",

1238 
fyl2xp1_0
 = "D9F9",

1239 
fsq¹_0
 = "D9FA",

1240 
fsšcos_0
 = "D9FB",

1241 
ändšt_0
 = "D9FC",

1242 
fsÿË_0
 = "D9FD",

1243 
fsš_0
 = "D9FE",

1244 
fcos_0
 = "D9FF",

1246 -- 
SSE
, 
SSE2


1247 
ªdÅd_2
 = "rmo:660F55rM",

1248 
ªdÅs_2
 = "rmo:0F55rM",

1249 
ªdpd_2
 = "rmo:660F54rM",

1250 
ªdps_2
 = "rmo:0F54rM",

1251 
şæush_1
 = "x.:0FAE7m",

1252 
cmµd_3
 = "rmio:660FC2rMU",

1253 
cmµs_3
 = "rmio:0FC2rMU",

1254 
cmpsd_3
 = "rrio:F20FC2rMU|rxi/oq:",

1255 
cmpss_3
 = "rrio:F30FC2rMU|rxi/od:",

1256 
comisd_2
 = "rro:660F2FrM|rx/oq:",

1257 
comiss_2
 = "rro:0F2FrM|rx/od:",

1258 
cvtdq2pd_2
 = "rro:F30FE6rM|rx/oq:",

1259 
cvtdq2ps_2
 = "rmo:0F5BrM",

1260 
cvd2dq_2
 = "rmo:F20FE6rM",

1261 
cvd2ps_2
 = "rmo:660F5ArM",

1262 
cvi2pd_2
 = "rx/oq:660F2ArM",

1263 
cvi2ps_2
 = "rx/oq:0F2ArM",

1264 
cvs2dq_2
 = "rmo:660F5BrM",

1265 
cvs2pd_2
 = "rro:0F5ArM|rx/oq:",

1266 
cvtsd2si_2
 = "rr/do:F20F2DrM|rr/qo:|rx/dq:|rxq:",

1267 
cvtsd2ss_2
 = "rro:F20F5ArM|rx/oq:",

1268 
cvtsi2sd_2
 = "rm/od:F20F2ArM|rm/oq:F20F2ArXM",

1269 
cvtsi2ss_2
 = "rm/od:F30F2ArM|rm/oq:F30F2ArXM",

1270 
cvtss2sd_2
 = "rro:F30F5ArM|rx/od:",

1271 
cvtss2si_2
 = "rr/do:F30F2DrM|rr/qo:|rxd:|rx/qd:",

1272 
cv‰pd2dq_2
 = "rmo:660FE6rM",

1273 
cv‰ps2dq_2
 = "rmo:F30F5BrM",

1274 
cv‰sd2si_2
 = "rr/do:F20F2CrM|rr/qo:|rx/dq:|rxq:",

1275 
cv‰ss2si_2
 = "rr/do:F30F2CrM|rr/qo:|rxd:|rx/qd:",

1276 
fx§ve_1
 = "x.:0FAE0m",

1277 
fxr¡Ü_1
 = "x.:0FAE1m",

1278 
ldmxc¤_1
 = "xd:0FAE2m",

1279 
lãnû_0
 = "0FAEE8",

1280 
maskmovdqu_2
 = "rro:660FF7rM",

1281 
mãnû_0
 = "0FAEF0",

1282 
mov­d_2
 = "rmo:660F28rM|mro:660F29Rm",

1283 
mov­s_2
 = "rmo:0F28rM|mro:0F29Rm",

1284 
movd_2
 = "rm/od:660F6ErM|rm/oq:660F6ErXM|mr/do:660F7ERm|mr/qo:",

1285 
movdqa_2
 = "rmo:660F6FrM|mro:660F7FRm",

1286 
movdqu_2
 = "rmo:F30F6FrM|mro:F30F7FRm",

1287 
movhÍs_2
 = "rro:0F12rM",

1288 
movhpd_2
 = "rx/oq:660F16rM|xr/qo:n660F17Rm",

1289 
movhps_2
 = "rx/oq:0F16rM|xr/qo:n0F17Rm",

1290 
movlhps_2
 = "rro:0F16rM",

1291 
movÍd_2
 = "rx/oq:660F12rM|xr/qo:n660F13Rm",

1292 
movÍs_2
 = "rx/oq:0F12rM|xr/qo:n0F13Rm",

1293 
movmskpd_2
 = "rr/do:660F50rM",

1294 
movmskps_2
 = "rr/do:0F50rM",

1295 
movÁdq_2
 = "xro:660FE7Rm",

1296 
movÁi_2
 = "xrqd:0FC3Rm",

1297 
movÁpd_2
 = "xro:660F2BRm",

1298 
movÁps_2
 = "xro:0F2BRm",

1299 
movq_2
 = "rro:F30F7ErM|rx/oq:|xr/qo:n660FD6Rm",

1300 
movsd_2
 = "rro:F20F10rM|rx/oq:|xr/qo:nF20F11Rm",

1301 
movss_2
 = "rro:F30F10rM|rx/od:|xr/do:F30F11Rm",

1302 
movupd_2
 = "rmo:660F10rM|mro:660F11Rm",

1303 
movups_2
 = "rmo:0F10rM|mro:0F11Rm",

1304 
Üpd_2
 = "rmo:660F56rM",

1305 
Üps_2
 = "rmo:0F56rM",

1306 
·u£_0
 = "F390",

1307 
³xŒw_3
 = "¼i/do:660FC5rMU|xri/wo:660F3A15nRmU", -- 
Mem
 
İ
: 
SSE4
.1 
Úly
.

1308 
pš¤w_3
 = "rri/od:660FC4rMU|rxi/ow:",

1309 
pmovmskb_2
 = "rr/do:660FD7rM",

1310 
´eãtchÁa_1
 = "xb:n0F180m",

1311 
´eãtcht0_1
 = "xb:n0F181m",

1312 
´eãtcht1_1
 = "xb:n0F182m",

1313 
´eãtcht2_1
 = "xb:n0F183m",

1314 
pshufd_3
 = "rmio:660F70rMU",

1315 
pshufhw_3
 = "rmio:F30F70rMU",

1316 
pshuæw_3
 = "rmio:F20F70rMU",

1317 
p¦ld_2
 = "rmo:660FF2rM|rio:660F726mU",

1318 
p¦ldq_2
 = "rio:660F737mU",

1319 
p¦lq_2
 = "rmo:660FF3rM|rio:660F736mU",

1320 
p¦lw_2
 = "rmo:660FF1rM|rio:660F716mU",

1321 
p¤ad_2
 = "rmo:660FE2rM|rio:660F724mU",

1322 
p¤aw_2
 = "rmo:660FE1rM|rio:660F714mU",

1323 
p¤ld_2
 = "rmo:660FD2rM|rio:660F722mU",

1324 
p¤ldq_2
 = "rio:660F733mU",

1325 
p¤lq_2
 = "rmo:660FD3rM|rio:660F732mU",

1326 
p¤lw_2
 = "rmo:660FD1rM|rio:660F712mU",

1327 
rıps_2
 = "rmo:0F53rM",

1328 
rıss_2
 = "rro:F30F53rM|rx/od:",

1329 
rsq¹ps_2
 = "rmo:0F52rM",

1330 
rsq¹ss_2
 = "rmo:F30F52rM",

1331 
sãnû_0
 = "0FAEF8",

1332 
shuåd_3
 = "rmio:660FC6rMU",

1333 
shuås_3
 = "rmio:0FC6rMU",

1334 
¡mxc¤_1
 = "xd:0FAE3m",

1335 
ucomisd_2
 = "rro:660F2ErM|rx/oq:",

1336 
ucomiss_2
 = "rro:0F2ErM|rx/od:",

1337 
uÅckhpd_2
 = "rmo:660F15rM",

1338 
uÅckhps_2
 = "rmo:0F15rM",

1339 
uÅckÍd_2
 = "rmo:660F14rM",

1340 
uÅckÍs_2
 = "rmo:0F14rM",

1341 
xÜpd_2
 = "rmo:660F57rM",

1342 
xÜps_2
 = "rmo:0F57rM",

1344 -- 
SSE3
 
İs


1345 
fi¡_1
 = "xw:nDF1m|xd:DB1m|xq:nDD1m",

1346 
addsubpd_2
 = "rmo:660FD0rM",

1347 
addsubps_2
 = "rmo:F20FD0rM",

1348 
haddpd_2
 = "rmo:660F7CrM",

1349 
haddps_2
 = "rmo:F20F7CrM",

1350 
hsubpd_2
 = "rmo:660F7DrM",

1351 
hsubps_2
 = "rmo:F20F7DrM",

1352 
lddqu_2
 = "rxo:F20FF0rM",

1353 
movddup_2
 = "rmo:F20F12rM",

1354 
movshdup_2
 = "rmo:F30F16rM",

1355 
mov¦dup_2
 = "rmo:F30F12rM",

1357 -- 
SSSE3
 
İs


1358 
·bsb_2
 = "rmo:660F381CrM",

1359 
·bsd_2
 = "rmo:660F381ErM",

1360 
·bsw_2
 = "rmo:660F381DrM",

1361 
·ligÄ_3
 = "rmio:660F3A0FrMU",

1362 
phaddd_2
 = "rmo:660F3802rM",

1363 
phaddsw_2
 = "rmo:660F3803rM",

1364 
phaddw_2
 = "rmo:660F3801rM",

1365 
phsubd_2
 = "rmo:660F3806rM",

1366 
phsubsw_2
 = "rmo:660F3807rM",

1367 
phsubw_2
 = "rmo:660F3805rM",

1368 
pmaddubsw_2
 = "rmo:660F3804rM",

1369 
pmulhrsw_2
 = "rmo:660F380BrM",

1370 
pshufb_2
 = "rmo:660F3800rM",

1371 
psignb_2
 = "rmo:660F3808rM",

1372 
psignd_2
 = "rmo:660F380ArM",

1373 
psignw_2
 = "rmo:660F3809rM",

1375 -- 
SSE4
.1 
İs


1376 
bËndpd_3
 = "rmio:660F3A0DrMU",

1377 
bËndps_3
 = "rmio:660F3A0CrMU",

1378 
bËndvpd_3
 = "rmRo:660F3815rM",

1379 
bËndvps_3
 = "rmRo:660F3814rM",

1380 
dµd_3
 = "rmio:660F3A41rMU",

1381 
dµs_3
 = "rmio:660F3A40rMU",

1382 
exŒaùps_3
 = "mri/do:660F3A17RmU|rri/qo:660F3A17RXmU",

1383 
š£¹ps_3
 = "rrio:660F3A41rMU|rxi/od:",

1384 
movÁdqa_2
 = "rxo:660F382ArM",

1385 
mp§dbw_3
 = "rmio:660F3A42rMU",

1386 
·ckusdw_2
 = "rmo:660F382BrM",

1387 
pbËndvb_3
 = "rmRo:660F3810rM",

1388 
pbËndw_3
 = "rmio:660F3A0ErMU",

1389 
pcm³qq_2
 = "rmo:660F3829rM",

1390 
³xŒb_3
 = "rri/do:660F3A14nRmU|rri/qo:|xri/bo:",

1391 
³xŒd_3
 = "mri/do:660F3A16RmU",

1392 
³xŒq_3
 = "mri/qo:660F3A16RmU",

1393 -- 
³xŒw
 
is
 
SSE2
, 
mem
 
İ”ªd
 i 
SSE4
.1 
Úly


1394 
phmšposuw_2
 = "rmo:660F3841rM",

1395 
pš¤b_3
 = "rri/od:660F3A20nrMU|rxi/ob:",

1396 
pš¤d_3
 = "rmi/od:660F3A22rMU",

1397 
pš¤q_3
 = "rmi/oq:660F3A22rXMU",

1398 
pmaxsb_2
 = "rmo:660F383CrM",

1399 
pmaxsd_2
 = "rmo:660F383DrM",

1400 
pmaxud_2
 = "rmo:660F383FrM",

1401 
pmaxuw_2
 = "rmo:660F383ErM",

1402 
pmšsb_2
 = "rmo:660F3838rM",

1403 
pmšsd_2
 = "rmo:660F3839rM",

1404 
pmšud_2
 = "rmo:660F383BrM",

1405 
pmšuw_2
 = "rmo:660F383ArM",

1406 
pmovsxbd_2
 = "rro:660F3821rM|rx/od:",

1407 
pmovsxbq_2
 = "rro:660F3822rM|rx/ow:",

1408 
pmovsxbw_2
 = "rro:660F3820rM|rx/oq:",

1409 
pmovsxdq_2
 = "rro:660F3825rM|rx/oq:",

1410 
pmovsxwd_2
 = "rro:660F3823rM|rx/oq:",

1411 
pmovsxwq_2
 = "rro:660F3824rM|rx/od:",

1412 
pmovzxbd_2
 = "rro:660F3831rM|rx/od:",

1413 
pmovzxbq_2
 = "rro:660F3832rM|rx/ow:",

1414 
pmovzxbw_2
 = "rro:660F3830rM|rx/oq:",

1415 
pmovzxdq_2
 = "rro:660F3835rM|rx/oq:",

1416 
pmovzxwd_2
 = "rro:660F3833rM|rx/oq:",

1417 
pmovzxwq_2
 = "rro:660F3834rM|rx/od:",

1418 
pmuldq_2
 = "rmo:660F3828rM",

1419 
pmuÎd_2
 = "rmo:660F3840rM",

1420 
±e¡_2
 = "rmo:660F3817rM",

1421 
roundpd_3
 = "rmio:660F3A09rMU",

1422 
roundps_3
 = "rmio:660F3A08rMU",

1423 
roundsd_3
 = "rrio:660F3A0BrMU|rxi/oq:",

1424 
roundss_3
 = "rrio:660F3A0ArMU|rxi/od:",

1426 -- 
SSE4
.2 
İs


1427 
üc32_2
 = "rmqd:F20F38F1rM|rm/dw:66F20F38F1rM|rm/db:F20F38F0rM|rm/qb:",

1428 
pcm³¡ri_3
 = "rmio:660F3A61rMU",

1429 
pcm³¡rm_3
 = "rmio:660F3A60rMU",

1430 
pcmpgtq_2
 = "rmo:660F3837rM",

1431 
pcmpi¡ri_3
 = "rmio:660F3A63rMU",

1432 
pcmpi¡rm_3
 = "rmio:660F3A62rMU",

1433 
pİút_2
 = "rmqdw:F30FB8rM",

1435 -- 
SSE4a


1436 
exŒq_2
 = "rro:660F79rM",

1437 
exŒq_3
 = "riio:660F780mUU",

1438 
š£¹q_2
 = "rro:F20F79rM",

1439 
š£¹q_4
 = "rriio:F20F78rMUU",

1440 
lzút_2
 = "rmqdw:F30FBDrM",

1441 
movÁsd_2
 = "xr/qo:nF20F2BRm",

1442 
movÁss_2
 = "xr/do:F30F2BRm",

1443 -- 
pİút
 
is
 
®so
 
š
 
SSE4
.2

1445 -- 
AES
-
NI


1446 
«sdec_2
 = "rmo:660F38DErM",

1447 
«sdeşa¡_2
 = "rmo:660F38DFrM",

1448 
«£nc_2
 = "rmo:660F38DCrM",

1449 
«£nşa¡_2
 = "rmo:660F38DDrM",

1450 
«simc_2
 = "rmo:660F38DBrM",

1451 
«skeyg’assi¡_3
 = "rmio:660F3ADFrMU",

1452 
pşmulqdq_3
 = "rmio:660F3A44rMU",

1454 -- 
AVX
 
FP
 
İs


1455 
vaddsubpd_3
 = "rrmoy:660FVD0rM",

1456 
vaddsubps_3
 = "rrmoy:F20FVD0rM",

1457 
vªdpd_3
 = "rrmoy:660FV54rM",

1458 
vªdps_3
 = "rrmoy:0FV54rM",

1459 
vªdÅd_3
 = "rrmoy:660FV55rM",

1460 
vªdÅs_3
 = "rrmoy:0FV55rM",

1461 
vbËndpd_4
 = "rrmioy:660F3AV0DrMU",

1462 
vbËndps_4
 = "rrmioy:660F3AV0CrMU",

1463 
vbËndvpd_4
 = "rrmroy:660F3AV4BrMs",

1464 
vbËndvps_4
 = "rrmroy:660F3AV4ArMs",

1465 
vbrßdÿ¡f128_2
 = "rx/yo:660F38u1ArM",

1466 
vcmµd_4
 = "rrmioy:660FVC2rMU",

1467 
vcmµs_4
 = "rrmioy:0FVC2rMU",

1468 
vcmpsd_4
 = "rrrio:F20FVC2rMU|rrxi/ooq:",

1469 
vcmpss_4
 = "rrrio:F30FVC2rMU|rrxi/ood:",

1470 
vcomisd_2
 = "rro:660Fu2FrM|rx/oq:",

1471 
vcomiss_2
 = "rro:0Fu2FrM|rx/od:",

1472 
vcvtdq2pd_2
 = "rro:F30FuE6rM|rx/oq:|rm/yo:",

1473 
vcvtdq2ps_2
 = "rmoy:0Fu5BrM",

1474 
vcvd2dq_2
 = "rmoy:F20FuE6rM",

1475 
vcvd2ps_2
 = "rmoy:660Fu5ArM",

1476 
vcvs2dq_2
 = "rmoy:660Fu5BrM",

1477 
vcvs2pd_2
 = "rro:0Fu5ArM|rx/oq:|rm/yo:",

1478 
vcvtsd2si_2
 = "rr/do:F20Fu2DrM|rx/dq:|rr/qo:|rxq:",

1479 
vcvtsd2ss_3
 = "rrro:F20FV5ArM|rrx/ooq:",

1480 
vcvtsi2sd_3
 = "rrm/ood:F20FV2ArM|rrm/ooq:F20FVX2ArM",

1481 
vcvtsi2ss_3
 = "rrm/ood:F30FV2ArM|rrm/ooq:F30FVX2ArM",

1482 
vcvtss2sd_3
 = "rrro:F30FV5ArM|rrx/ood:",

1483 
vcvtss2si_2
 = "rr/do:F30Fu2DrM|rxd:|rr/qo:|rx/qd:",

1484 
vcv‰pd2dq_2
 = "rmo:660FuE6rM|rm/oy:660FuLE6rM",

1485 
vcv‰ps2dq_2
 = "rmoy:F30Fu5BrM",

1486 
vcv‰sd2si_2
 = "rr/do:F20Fu2CrM|rx/dq:|rr/qo:|rxq:",

1487 
vcv‰ss2si_2
 = "rr/do:F30Fu2CrM|rxd:|rr/qo:|rx/qd:",

1488 
vdµd_4
 = "rrmio:660F3AV41rMU",

1489 
vdµs_4
 = "rrmioy:660F3AV40rMU",

1490 
vexŒaùf128_3
 = "mri/oy:660F3AuL19RmU",

1491 
vexŒaùps_3
 = "mri/do:660F3Au17RmU",

1492 
vhaddpd_3
 = "rrmoy:660FV7CrM",

1493 
vhaddps_3
 = "rrmoy:F20FV7CrM",

1494 
vhsubpd_3
 = "rrmoy:660FV7DrM",

1495 
vhsubps_3
 = "rrmoy:F20FV7DrM",

1496 
vš£¹f128_4
 = "rrmi/yyo:660F3AV18rMU",

1497 
vš£¹ps_4
 = "rrrio:660F3AV21rMU|rrxi/ood:",

1498 
vldmxc¤_1
 = "xd:0FuAE2m",

1499 
vmaskmovps_3
 = "rrxoy:660F38V2CrM|xrroy:660F38V2ERm",

1500 
vmaskmovpd_3
 = "rrxoy:660F38V2DrM|xrroy:660F38V2FRm",

1501 
vmov­d_2
 = "rmoy:660Fu28rM|mroy:660Fu29Rm",

1502 
vmov­s_2
 = "rmoy:0Fu28rM|mroy:0Fu29Rm",

1503 
vmovd_2
 = "rm/od:660Fu6ErM|rm/oq:660FuX6ErM|mr/do:660Fu7ERm|mr/qo:",

1504 
vmovq_2
 = "rro:F30Fu7ErM|rx/oq:|xr/qo:660FuD6Rm",

1505 
vmovddup_2
 = "rmy:F20Fu12rM|rro:|rx/oq:",

1506 
vmovhÍs_3
 = "rrro:0FV12rM",

1507 
vmovhpd_2
 = "xr/qo:660Fu17Rm",

1508 
vmovhpd_3
 = "rrx/ooq:660FV16rM",

1509 
vmovhps_2
 = "xr/qo:0Fu17Rm",

1510 
vmovhps_3
 = "rrx/ooq:0FV16rM",

1511 
vmovlhps_3
 = "rrro:0FV16rM",

1512 
vmovÍd_2
 = "xr/qo:660Fu13Rm",

1513 
vmovÍd_3
 = "rrx/ooq:660FV12rM",

1514 
vmovÍs_2
 = "xr/qo:0Fu13Rm",

1515 
vmovÍs_3
 = "rrx/ooq:0FV12rM",

1516 
vmovmskpd_2
 = "rr/do:660Fu50rM|rr/dy:660FuL50rM",

1517 
vmovmskps_2
 = "rr/do:0Fu50rM|rr/dy:0FuL50rM",

1518 
vmovÁpd_2
 = "xroy:660Fu2BRm",

1519 
vmovÁps_2
 = "xroy:0Fu2BRm",

1520 
vmovsd_2
 = "rx/oq:F20Fu10rM|xr/qo:F20Fu11Rm",

1521 
vmovsd_3
 = "rrro:F20FV10rM",

1522 
vmovshdup_2
 = "rmoy:F30Fu16rM",

1523 
vmov¦dup_2
 = "rmoy:F30Fu12rM",

1524 
vmovss_2
 = "rx/od:F30Fu10rM|xr/do:F30Fu11Rm",

1525 
vmovss_3
 = "rrro:F30FV10rM",

1526 
vmovupd_2
 = "rmoy:660Fu10rM|mroy:660Fu11Rm",

1527 
vmovups_2
 = "rmoy:0Fu10rM|mroy:0Fu11Rm",

1528 
vÜpd_3
 = "rrmoy:660FV56rM",

1529 
vÜps_3
 = "rrmoy:0FV56rM",

1530 
v³rmpd_3
 = "rrmoy:660F38V0DrM|rmioy:660F3Au05rMU",

1531 
v³rmps_3
 = "rrmoy:660F38V0CrM|rmioy:660F3Au04rMU",

1532 
v³rm2f128_4
 = "rrmiy:660F3AV06rMU",

1533 
v±e¡pd_2
 = "rmoy:660F38u0FrM",

1534 
v±e¡ps_2
 = "rmoy:660F38u0ErM",

1535 
vrıps_2
 = "rmoy:0Fu53rM",

1536 
vrıss_3
 = "rrro:F30FV53rM|rrx/ood:",

1537 
vrsq¹ps_2
 = "rmoy:0Fu52rM",

1538 
vrsq¹ss_3
 = "rrro:F30FV52rM|rrx/ood:",

1539 
vroundpd_3
 = "rmioy:660F3AV09rMU",

1540 
vroundps_3
 = "rmioy:660F3AV08rMU",

1541 
vroundsd_4
 = "rrrio:660F3AV0BrMU|rrxi/ooq:",

1542 
vroundss_4
 = "rrrio:660F3AV0ArMU|rrxi/ood:",

1543 
vshuåd_4
 = "rrmioy:660FVC6rMU",

1544 
vshuås_4
 = "rrmioy:0FVC6rMU",

1545 
vsq¹ps_2
 = "rmoy:0Fu51rM",

1546 
vsq¹ss_2
 = "rro:F30Fu51rM|rx/od:",

1547 
vsq¹pd_2
 = "rmoy:660Fu51rM",

1548 
vsq¹sd_2
 = "rro:F20Fu51rM|rx/oq:",

1549 
v¡mxc¤_1
 = "xd:0FuAE3m",

1550 
vucomisd_2
 = "rro:660Fu2ErM|rx/oq:",

1551 
vucomiss_2
 = "rro:0Fu2ErM|rx/od:",

1552 
vuÅckhpd_3
 = "rrmoy:660FV15rM",

1553 
vuÅckhps_3
 = "rrmoy:0FV15rM",

1554 
vuÅckÍd_3
 = "rrmoy:660FV14rM",

1555 
vuÅckÍs_3
 = "rrmoy:0FV14rM",

1556 
vxÜpd_3
 = "rrmoy:660FV57rM",

1557 
vxÜps_3
 = "rrmoy:0FV57rM",

1558 
vz”ßÎ_0
 = "0FuL77",

1559 
vz”ouµ”_0
 = "0Fu77",

1561 -- 
AVX2
 
FP
 
İs


1562 
vbrßdÿ¡ss_2
 = "rx/od:660F38u18rM|rx/yd:|rro:|rr/yo:",

1563 
vbrßdÿ¡sd_2
 = "rx/yq:660F38u19rM|rr/yo:",

1564 -- *
vg©h”
* (!
vsib
)

1565 
v³rmpd_3
 = "rmiy:660F3AuX01rMU",

1566 
v³rmps_3
 = "rrmy:660F38V16rM",

1568 -- 
AVX
, 
AVX2
 
š‹g”
 
İs


1569 -- 
In
 
g’”®
, 
xmm
 
»quœes
 
AVX
, 
ymm
„equœe 
AVX2
.

1570 
v«sdec_3
 = "rrmo:660F38VDErM",

1571 
v«sdeşa¡_3
 = "rrmo:660F38VDFrM",

1572 
v«£nc_3
 = "rrmo:660F38VDCrM",

1573 
v«£nşa¡_3
 = "rrmo:660F38VDDrM",

1574 
v«simc_2
 = "rmo:660F38uDBrM",

1575 
v«skeyg’assi¡_3
 = "rmio:660F3AuDFrMU",

1576 
vlddqu_2
 = "rxoy:F20FuF0rM",

1577 
vmaskmovdqu_2
 = "rro:660FuF7rM",

1578 
vmovdqa_2
 = "rmoy:660Fu6FrM|mroy:660Fu7FRm",

1579 
vmovdqu_2
 = "rmoy:F30Fu6FrM|mroy:F30Fu7FRm",

1580 
vmovÁdq_2
 = "xroy:660FuE7Rm",

1581 
vmovÁdqa_2
 = "rxoy:660F38u2ArM",

1582 
vmp§dbw_4
 = "rrmioy:660F3AV42rMU",

1583 
v·bsb_2
 = "rmoy:660F38u1CrM",

1584 
v·bsd_2
 = "rmoy:660F38u1ErM",

1585 
v·bsw_2
 = "rmoy:660F38u1DrM",

1586 
v·ckusdw_3
 = "rrmoy:660F38V2BrM",

1587 
v·ligÄ_4
 = "rrmioy:660F3AV0FrMU",

1588 
vpbËndvb_4
 = "rrmroy:660F3AV4CrMs",

1589 
vpbËndw_4
 = "rrmioy:660F3AV0ErMU",

1590 
vpşmulqdq_4
 = "rrmio:660F3AV44rMU",

1591 
vpcm³qq_3
 = "rrmoy:660F38V29rM",

1592 
vpcm³¡ri_3
 = "rmio:660F3Au61rMU",

1593 
vpcm³¡rm_3
 = "rmio:660F3Au60rMU",

1594 
vpcmpgtq_3
 = "rrmoy:660F38V37rM",

1595 
vpcmpi¡ri_3
 = "rmio:660F3Au63rMU",

1596 
vpcmpi¡rm_3
 = "rmio:660F3Au62rMU",

1597 
v³xŒb_3
 = "rri/do:660F3Au14nRmU|rri/qo:|xri/bo:",

1598 
v³xŒw_3
 = "rri/do:660FuC5rMU|xri/wo:660F3Au15nRmU",

1599 
v³xŒd_3
 = "mri/do:660F3Au16RmU",

1600 
v³xŒq_3
 = "mri/qo:660F3Au16RmU",

1601 
vphaddw_3
 = "rrmoy:660F38V01rM",

1602 
vphaddd_3
 = "rrmoy:660F38V02rM",

1603 
vphaddsw_3
 = "rrmoy:660F38V03rM",

1604 
vphmšposuw_2
 = "rmo:660F38u41rM",

1605 
vphsubw_3
 = "rrmoy:660F38V05rM",

1606 
vphsubd_3
 = "rrmoy:660F38V06rM",

1607 
vphsubsw_3
 = "rrmoy:660F38V07rM",

1608 
vpš¤b_4
 = "rrri/ood:660F3AV20rMU|rrxi/oob:",

1609 
vpš¤w_4
 = "rrri/ood:660FVC4rMU|rrxi/oow:",

1610 
vpš¤d_4
 = "rrmi/ood:660F3AV22rMU",

1611 
vpš¤q_4
 = "rrmi/ooq:660F3AVX22rMU",

1612 
vpmaddubsw_3
 = "rrmoy:660F38V04rM",

1613 
vpmaxsb_3
 = "rrmoy:660F38V3CrM",

1614 
vpmaxsd_3
 = "rrmoy:660F38V3DrM",

1615 
vpmaxuw_3
 = "rrmoy:660F38V3ErM",

1616 
vpmaxud_3
 = "rrmoy:660F38V3FrM",

1617 
vpmšsb_3
 = "rrmoy:660F38V38rM",

1618 
vpmšsd_3
 = "rrmoy:660F38V39rM",

1619 
vpmšuw_3
 = "rrmoy:660F38V3ArM",

1620 
vpmšud_3
 = "rrmoy:660F38V3BrM",

1621 
vpmovmskb_2
 = "rr/do:660FuD7rM|rr/dy:660FuLD7rM",

1622 
vpmovsxbw_2
 = "rroy:660F38u20rM|rx/oq:|rx/yo:",

1623 
vpmovsxbd_2
 = "rroy:660F38u21rM|rx/od:|rx/yq:",

1624 
vpmovsxbq_2
 = "rroy:660F38u22rM|rx/ow:|rx/yd:",

1625 
vpmovsxwd_2
 = "rroy:660F38u23rM|rx/oq:|rx/yo:",

1626 
vpmovsxwq_2
 = "rroy:660F38u24rM|rx/od:|rx/yq:",

1627 
vpmovsxdq_2
 = "rroy:660F38u25rM|rx/oq:|rx/yo:",

1628 
vpmovzxbw_2
 = "rroy:660F38u30rM|rx/oq:|rx/yo:",

1629 
vpmovzxbd_2
 = "rroy:660F38u31rM|rx/od:|rx/yq:",

1630 
vpmovzxbq_2
 = "rroy:660F38u32rM|rx/ow:|rx/yd:",

1631 
vpmovzxwd_2
 = "rroy:660F38u33rM|rx/oq:|rx/yo:",

1632 
vpmovzxwq_2
 = "rroy:660F38u34rM|rx/od:|rx/yq:",

1633 
vpmovzxdq_2
 = "rroy:660F38u35rM|rx/oq:|rx/yo:",

1634 
vpmuldq_3
 = "rrmoy:660F38V28rM",

1635 
vpmulhrsw_3
 = "rrmoy:660F38V0BrM",

1636 
vpmuÎd_3
 = "rrmoy:660F38V40rM",

1637 
vpshufb_3
 = "rrmoy:660F38V00rM",

1638 
vpshufd_3
 = "rmioy:660Fu70rMU",

1639 
vpshufhw_3
 = "rmioy:F30Fu70rMU",

1640 
vpshuæw_3
 = "rmioy:F20Fu70rMU",

1641 
vpsignb_3
 = "rrmoy:660F38V08rM",

1642 
vpsignw_3
 = "rrmoy:660F38V09rM",

1643 
vpsignd_3
 = "rrmoy:660F38V0ArM",

1644 
vp¦ldq_3
 = "rrioy:660Fv737mU",

1645 
vp¦lw_3
 = "rrmoy:660FVF1rM|rrioy:660Fv716mU",

1646 
vp¦ld_3
 = "rrmoy:660FVF2rM|rrioy:660Fv726mU",

1647 
vp¦lq_3
 = "rrmoy:660FVF3rM|rrioy:660Fv736mU",

1648 
vp¤aw_3
 = "rrmoy:660FVE1rM|rrioy:660Fv714mU",

1649 
vp¤ad_3
 = "rrmoy:660FVE2rM|rrioy:660Fv724mU",

1650 
vp¤ldq_3
 = "rrioy:660Fv733mU",

1651 
vp¤lw_3
 = "rrmoy:660FVD1rM|rrioy:660Fv712mU",

1652 
vp¤ld_3
 = "rrmoy:660FVD2rM|rrioy:660Fv722mU",

1653 
vp¤lq_3
 = "rrmoy:660FVD3rM|rrioy:660Fv732mU",

1654 
v±e¡_2
 = "rmoy:660F38u17rM",

1656 -- 
AVX2
 
š‹g”
 
İs


1657 
vbrßdÿ¡i128_2
 = "rx/yo:660F38u5ArM",

1658 
vš£¹i128_4
 = "rrmi/yyo:660F3AV38rMU",

1659 
vexŒaùi128_3
 = "mri/oy:660F3AuL39RmU",

1660 
vpbËndd_4
 = "rrmioy:660F3AV02rMU",

1661 
vpbrßdÿ¡b_2
 = "rro:660F38u78rM|rx/ob:|rr/yo:|rx/yb:",

1662 
vpbrßdÿ¡w_2
 = "rro:660F38u79rM|rx/ow:|rr/yo:|rx/yw:",

1663 
vpbrßdÿ¡d_2
 = "rro:660F38u58rM|rx/od:|rr/yo:|rx/yd:",

1664 
vpbrßdÿ¡q_2
 = "rro:660F38u59rM|rx/oq:|rr/yo:|rx/yq:",

1665 
v³rmd_3
 = "rrmy:660F38V36rM",

1666 
v³rmq_3
 = "rmiy:660F3AuX00rMU",

1667 -- *
vpg©h”
* (!
vsib
)

1668 
v³rm2i128_4
 = "rrmiy:660F3AV46rMU",

1669 
vpmaskmovd_3
 = "rrxoy:660F38V8CrM|xrroy:660F38V8ERm",

1670 
vpmaskmovq_3
 = "rrxoy:660F38VX8CrM|xrroy:660F38VX8ERm",

1671 
vp¦lvd_3
 = "rrmoy:660F38V47rM",

1672 
vp¦lvq_3
 = "rrmoy:660F38VX47rM",

1673 
vp¤avd_3
 = "rrmoy:660F38V46rM",

1674 
vp¤lvd_3
 = "rrmoy:660F38V45rM",

1675 
vp¤lvq_3
 = "rrmoy:660F38VX45rM",

1677 -- 
IÁ–
 
ADX


1678 
adcx_2
 = "rmqd:660F38F6rM",

1679 
adox_2
 = "rmqd:F30F38F6rM",

1680 
	}
}

1684 -- 
Ar™hm‘ic
 
	gİs
.

1685 
	gÇme
,
n
 
š
 
	g·œs
{ 
	gadd
 = 0, ["Ü"] = 1, 
	gadc
 = 2, 
	gsbb
 = 3,

1686 ["ªd"] = 4, 
	gsub
 = 5, 
	gxÜ
 = 6, 
	gcmp
 = 7 } do

1687 
loÿl
 
	gn8
 = 
	$shl
(
n
, 3)

1688 
m­_İ
[
Çme
.."_2"] = 
	`fÜm©
(

1690 1+
n8
, 3+n8, 
n
,‚, 5+n8,‚)

1691 
’d


1693 -- 
Shiá
 
İs
.

1694 
Çme
,
n
 
š
 
·œs
{ 
rŞ
 = 0, 
rÜ
 = 1, 
rş
 = 2, 
rü
 = 3,

1695 
shl
 = 4, 
shr
 = 5, 
§r
 = 7, 
§l
 = 4 
	}
} do

1696 
	gm­_İ
[
Çme
.."_2"] = 
fÜm©
("m1:D1%Xm|mC1qdwb:D3%Xm|mi:C1%XmU", 
n
,‚,‚)

1697 
	g’d


1699 -- 
CÚd™iÚ®
 
	gİs
.

1700 
	gcc
,
n
 
š
 
	$·œs
(
m­_cc
) do

1701 
m­_İ
["j"..
cc
.."_1"] = 
	`fÜm©
("J.:n0F8%XJ", 
n
è-- : 7%
X


1702 
m­_İ
["£t"..
cc
.."_1"] = 
	`fÜm©
("mb:n0F9%X2m", 
n
)

1703 
m­_İ
["cmov"..
cc
.."_2"] = 
	`fÜm©
("rmqdw:0F4%XrM", 
n
è-- 
P6
+

1704 
’d


1706 -- 
FP
 
¬™hm‘ic
 
İs
.

1707 
Çme
,
n
 
š
 
·œs
{ 
add
 = 0, 
mul
 = 1, 
com
 = 2, 
comp
 = 3,

1708 
sub
 = 4, 
subr
 = 5, 
div
 = 6, 
divr
 = 7 
	}
} do

1709 
loÿl
 
	gnc
 = 0xc0 + 
	$shl
(
n
, 3)

1710 
loÿl
 
Ä
 = 
nc
 + (
n
 < 4 
ªd
 0 
	`Ü
 (À% 2 =ğ0‡nd 8 
Ü
 -8))

1711 
loÿl
 
â
 = "f"..
Çme


1712 
m­_İ
[
â
.."_1"] = 
	`fÜm©
("ff:D8%02Xr|xd:D8%Xm|xq:nDC%Xm", 
nc
, 
n
,‚)

1713 
n
 =ğ2 
Ü
‚ =ğ3 
th’


1714 
m­_İ
[
â
.."_2"] = 
	`fÜm©
("Fff:D8%02XR|Fx2d:D8%XM|Fx2q:nDC%XM", 
nc
, 
n
,‚)

1716 
m­_İ
[
â
.."_2"] = 
	`fÜm©
("Fff:D8%02XR|fFf:DC%02Xr|Fx2d:D8%XM|Fx2q:nDC%XM", 
nc
, 
Ä
, 
n
,‚)

1717 
m­_İ
[
â
.."p_1"] = 
	`fÜm©
("ff:DE%02Xr", 
Ä
)

1718 
m­_İ
[
â
.."p_2"] = 
	`fÜm©
("fFf:DE%02Xr", 
Ä
)

1719 
’d


1720 
m­_İ
["fi"..
Çme
.."_1"] = 
	`fÜm©
("xd:DA%Xm|xw:nDE%Xm", 
n
,‚)

1721 
’d


1723 -- 
FP
 
cÚd™iÚ®
 
moves
.

1724 
cc
,
n
 
š
 
·œs
{ 
b
=0, 
e
=1, 
be
=2, 
u
=3, 
nb
=4, 
Ã
=5, 
nbe
=6, 
nu
=7 
	}
} do

1725 
loÿl
 
	gnc
 = 0xdac0 + 
shl
(
bªd
(
n
, 3), 3) + shl(band(n, 4), 6)

1726 
	gm­_İ
["fcmov"..
cc
.."_1"] = 
fÜm©
("ff:%04Xr", 
nc
è-- 
	gP6
+

1727 
	gm­_İ
["fcmov"..
cc
.."_2"] = 
fÜm©
("Fff:%04XR", 
nc
è-- 
	gP6
+

1728 
	g’d


1730 -- 
	gSSE
 / 
AVX
 
FP
 
¬™hm‘ic
 
	gİs
.

1731 
	gÇme
,
n
 
š
 
	g·œs
{ 
	gsq¹
 = 1, 
	gadd
 = 8, 
	gmul
 = 9,

1732 
	gsub
 = 12, 
	gmš
 = 13, 
	gdiv
 = 14, 
	gmax
 = 15 } do

1733 
	gm­_İ
[
Çme
.."ps_2"] = 
fÜm©
("rmo:0F5%XrM", 
n
)

1734 
	gm­_İ
[
Çme
.."ss_2"] = 
fÜm©
("¼o:F30F5%XrM|rx/od:", 
n
)

1735 
	gm­_İ
[
Çme
.."pd_2"] = 
fÜm©
("rmo:660F5%XrM", 
n
)

1736 
	gm­_İ
[
Çme
.."sd_2"] = 
fÜm©
("¼o:F20F5%XrM|rx/oq:", 
n
)

1737 
	gn
 ~ğ1 
th’


1738 
m­_İ
["v"..
Çme
.."ps_3"] = 
fÜm©
("¼moy:0FV5%XrM", 
n
)

1739 
	gm­_İ
["v"..
Çme
.."ss_3"] = 
fÜm©
("¼ro:F30FV5%XrM|¼x/ood:", 
n
)

1740 
	gm­_İ
["v"..
Çme
.."pd_3"] = 
fÜm©
("¼moy:660FV5%XrM", 
n
)

1741 
	gm­_İ
["v"..
Çme
.."sd_3"] = 
fÜm©
("¼ro:F20FV5%XrM|¼x/ooq:", 
n
)

1742 
’d


1743 
	g’d


1745 -- 
	gSSE2
 / 
	gAVX
 / 
AVX2
 
š‹g”
 
¬™hm‘ic
 
İs
 (66 0F 
Ëaf
).

1746 
	gÇme
,
n
 
š
 
	g·œs
{

1747 
	g·ddb
 = 0xFC, 
	g·ddw
 = 0xFD, 
	g·ddd
 = 0xFE, 
	g·ddq
 = 0xD4,

1748 
	g·ddsb
 = 0xEC, 
	g·ddsw
 = 0xED, 
	g·ckssdw
 = 0x6B,

1749 
	g·cksswb
 = 0x63, 
	g·ckuswb
 = 0x67, 
	g·ddusb
 = 0xDC,

1750 
	g·ddusw
 = 0xDD, 
	g·nd
 = 0xDB, 
	g·ndn
 = 0xDF, 
	g·vgb
 = 0xE0,

1751 
	g·vgw
 = 0xE3, 
	gpcm³qb
 = 0x74, 
	gpcm³qd
 = 0x76,

1752 
	gpcm³qw
 = 0x75, 
	gpcmpgtb
 = 0x64, 
	gpcmpgtd
 = 0x66,

1753 
	gpcmpgtw
 = 0x65, 
	gpmaddwd
 = 0xF5, 
	gpmaxsw
 = 0xEE,

1754 
	gpmaxub
 = 0xDE, 
	gpmšsw
 = 0xEA, 
	gpmšub
 = 0xDA,

1755 
	gpmulhuw
 = 0xE4, 
	gpmulhw
 = 0xE5, 
	gpmuÎw
 = 0xD5,

1756 
	gpmuludq
 = 0xF4, 
	gpÜ
 = 0xEB, 
	gp§dbw
 = 0xF6, 
	gpsubb
 = 0xF8,

1757 
	gpsubw
 = 0xF9, 
	gpsubd
 = 0xFA, 
	gpsubq
 = 0xFB, 
	gpsubsb
 = 0xE8,

1758 
	gpsubsw
 = 0xE9, 
	gpsubusb
 = 0xD8, 
	gpsubusw
 = 0xD9,

1759 
	gpuÅckhbw
 = 0x68, 
	gpuÅckhwd
 = 0x69, 
	gpuÅckhdq
 = 0x6A,

1760 
	gpuÅckhqdq
 = 0x6D, 
	gpuÅcklbw
 = 0x60, 
	gpuÅcklwd
 = 0x61,

1761 
	gpuÅckldq
 = 0x62, 
	gpuÅcklqdq
 = 0x6C, 
	gpxÜ
 = 0xEF

1763 
	gm­_İ
[
Çme
.."_2"] = 
fÜm©
("rmo:660F%02XrM", 
n
)

1764 
	gm­_İ
["v"..
Çme
.."_3"] = 
fÜm©
("¼moy:660FV%02XrM", 
n
)

1765 
	g’d


1769 
loÿl
 
	gm­_vex¬g
 = { 
u
 = 
çl£
, 
	gv
 = 1, 
	gV
 = 2 }

1771 -- 
Proûss
 
·‰”n
 
	g¡ršg
.

1772 
loÿl
 
funùiÚ
 
	$dİ©‹º
(
·t
, 
¬gs
, 
sz
, 
İ
, 
Ãed»x
)

1773 
loÿl
 
dig™
, 
addš
, 
vex


1774 
loÿl
 
İcode
 = 0

1775 
loÿl
 
szov
 = 
sz


1776 
loÿl
 
Çrg
 = 1

1777 
loÿl
 
»x
 = 0

1779 -- 
Lim™
 
numb”
 
of
 
£ùiÚ
 
bufãr
 
pos™iÚs
 
u£d
 
by
 
a
 
sšgË
 
	`dasm_put
().

1780 -- 
A
 
sšgË
 
İcode
 
Ãeds
 
a
 
maximum
 
of
 6 
pos™iÚs
.

1781 
£ıos
+6 > 
max£ıos
 
th’
 
	$wæush
(è
’d


1783 -- 
Proûss
 
—ch
 
ch¬aù”
.

1784 
c
 
š
 
	`gm©ch
(
·t
.."|", ".") do

1785 
	`m©ch
(
c
, "%x"è
th’
 -- 
Hex
 
dig™
.

1786 
dig™
 = 
	`by‹
(
c
) - 48

1787 
dig™
 > 48 
th’
 digit = digit - 39

1788 
–£if
 
dig™
 > 16 
th’
 dig™ = dig™ - 7 
’d


1789 
İcode
 = opcode*16 + 
dig™


1790 
addš
 = 
n


1791 
–£if
 
c
 =ğ"n" 
th’
 -- 
Di§bË
 
İ”ªd
 
size
 
mods
 
İcode
.

1792 
szov
 = 
n


1793 
–£if
 
c
 =ğ"X" 
th’
 -- 
FÜû
 
REX
.
W
.

1794 
»x
 = 8

1795 
–£if
 
c
 =ğ"L" 
th’
 -- 
FÜû
 
VEX
.
L
.

1796 
vex
.
l
 = 
Œue


1797 
–£if
 
c
 =ğ"r" 
th’
 -- 
M”ge
 1
¡
 
İ”ªd
 
»gno
. 
što
 
İcode
.

1798 
addš
 = 
¬gs
[1]; 
İcode
 = opcod+ (addš.
»g
 % 8)

1799 
Çrg
 < 2 
th’
‚¬g = 2 
’d


1800 
–£if
 
c
 =ğ"R" 
th’
 -- 
M”ge
 2
nd
 
İ”ªd
 
»gno
. 
što
 
İcode
.

1801 
addš
 = 
¬gs
[2]; 
İcode
 = opcod+ (addš.
»g
 % 8)

1802 
Çrg
 = 3

1803 
–£if
 
c
 =ğ"m" 
Ü
 c =ğ"M" 
th’
 -- 
Encode
 
ModRM
/
SIB
.

1804 
loÿl
 
s


1805 
addš
 
th’


1806 
s
 = 
addš
.
»g


1807 
İcode
 = opcod- 
	`bªd
(
s
, 7è-- 
Undo
 
»gno
 opcod
m”ge
.

1809 
s
 = 
	`bªd
(
İcode
, 15è-- 
Undo
 
Ï¡
 
dig™
.

1810 
İcode
 = 
	$shr
(
İcode
, 4)

1811 
’d


1812 
loÿl
 
Â
 = 
c
 =ğ"m" 
ªd
 1 
Ü
 2

1813 
loÿl
 
t
 = 
¬gs
[
Â
]

1814 
Çrg
 <ğ
Â
 
th’
‚¬g =‚À+ 1 
’d


1815 
szov
 =ğ"q" 
ªd
 
»x
 =ğ0 
th’
„ex =„ex + 8 
’d


1816 
t
.
»g
 
ªd
.»g > 7 
th’
 
»x
 =„ex + 1 
’d


1817 
t
.
x»g
 
ªd
.x»g > 7 
th’
 
»x
 =„ex + 2 
’d


1818 
s
 > 7 
th’
 
»x
 =„ex + 4 
’d


1819 
Ãed»x
 
th’
 
»x
 =„ex + 16 
’d


1820 
loÿl
 
psz
, 
sk
 = 
	`wputİ
(
szov
, 
İcode
, 
»x
, 
vex
, 
s
 < 0, 
t
.
v»g
 
Ü
.
vx»g
)

1821 
İcode
 = 
n


1822 
loÿl
 
im¬k
 = 
	`sub
(
·t
, -1è-- 
FÜû
 
a
 
	`m¬k
 (
ugly
).

1823 -- 
Put
 
ModRM
/
SIB
 
w™h
 
»gno
/
Ï¡
 
dig™
 
as
 
¥¬e
.

1824 
	$wputmrmsib
(
t
, 
im¬k
, 
s
, 
addš
 
ªd
‡ddš.
v»g
, 
psz
, 
sk
)

1825 
addš
 = 
n


1826 
–£if
 
m­_vex¬g
[
c
] ~ğ
n
 
th’
 -- 
Encode
 
usšg
 
VEX
 
´efix


1827 
loÿl
 
b
 = 
	`bªd
(
İcode
, 255); opcodğ
	$shr
(
İcode
, 8)

1828 
loÿl
 
m
 = 1

1829 
b
 =ğ0x38 
th’
 
m
 = 2

1830 
–£if
 
b
 =ğ0x3¨
th’
 
m
 = 3 
’d


1831 
m
 ~ğ1 
th’
 
b
 = 
	`bªd
(
İcode
, 255); opcodğ
	$shr
(
İcode
, 8è
’d


1832 
b
 ~ğ0x0à
th’


1833 
	`w”rÜ
("ex³ùed `0F', `0F38', o¸`0F3A'Ø´eûd`"..
c
..

1834 "' iÀ·‰”À`"..
·t
.."' fÜ `"..
İ
.."'")

1835 
’d


1836 
loÿl
 
v
 = 
m­_vex¬g
[
c
]

1837 
v
 
th’
 v = 
	$»move
(
¬gs
, 
v
è
’d


1838 
b
 = 
	$bªd
(
İcode
, 255)

1839 
loÿl
 
p
 = 0

1840 
b
 =ğ0x66 
th’
 
p
 = 1

1841 
–£if
 
b
 =ğ0xf3 
th’
 
p
 = 2

1842 
–£if
 
b
 =ğ0xf2 
th’
 
p
 = 3 
’d


1843 
p
 ~ğ0 
th’
 
İcode
 = 
	$shr
(
İcode
, 8è
’d


1844 
İcode
 ~ğ0 
th’
 
	`wputİ
(
n
, opcode, 0); opcodğ0 
’d


1845 
vex
 = { 
m
 = m, 
p
 =…, 
v
 = v 
	}
}

1847 
İcode
 
	gth’
 -- 
Flush
 
	gİcode
.

1848 
	gszov
 =ğ"q" 
ªd
 
»x
 =ğ0 
th’
„ex =„ex + 8 
’d


1849 
Ãed»x
 
th’
 
»x
 =„ex + 16 
’d


1850 
addš
 
ªd
‡ddš.
»g
 =ğ-1 
th’


1851 
loÿl
 
psz
, 
	gsk
 = 
wputİ
(
szov
, 
İcode
 - 7, 
»x
, 
vex
, 
Œue
)

1852 
wv»g
("İcode", 
addš
.
v»g
, 
psz
, 
sk
)

1854 
addš
 
ªd
 
	gaddš
.
	g»g
 > 7 
th’
 
	g»x
 = 
»x
 + 1 
’d


1855 
	$wputİ
(
szov
, 
İcode
, 
»x
, 
vex
)

1856 
’d


1857 
İcode
 = 
n


1858 
’d


1859 
c
 =ğ"|" 
th’
  
’d


1860 
c
 =ğ"o" 
th’
 -- 
	`Off£t
 (
pu»
 32 
b™
 
di¥Ïûm’t
).

1861 
	`wputd¬g
(
¬gs
[1].
di¥
); 
Çrg
 < 2 
th’
‚¬g = 2 
’d


1862 
–£if
 
c
 =ğ"O" 
th’


1863 
	`wputd¬g
(
¬gs
[2].
di¥
); 
Çrg
 = 3

1865 -- 
Anythšg
 
is
 
ª
 
immedŸ‹
 
İ”ªd
.

1866 
loÿl
 
a
 = 
¬gs
[
Çrg
]

1867 
Çrg
 =‚arg + 1

1868 
loÿl
 
mode
, 
imm
 = 
a
.mode,‡.imm

1869 
mode
 =ğ"iJ" 
ªd
 
nÙ
 
	`m©ch
("iIJ", 
c
è
th’


1870 
	`w”rÜ
("bad operand size for†abel")

1871 
’d


1872 
c
 =ğ"S" 
th’


1873 
	$wputsb¬g
(
imm
)

1874 
–£if
 
c
 =ğ"U" 
th’


1875 
	$wputb¬g
(
imm
)

1876 
–£if
 
c
 =ğ"W" 
th’


1877 
	$wputw¬g
(
imm
)

1878 
–£if
 
c
 =ğ"i" 
Ü
 c =ğ"I" 
th’


1879 
mode
 =ğ"iJ" 
th’


1880 
	`wpuab–
("IMM_", 
imm
, 1)

1881 
–£if
 
mode
 =ğ"iI" 
ªd
 
c
 =ğ"I" 
th’


1882 
	`waùiÚ
(
sz
 =ğ"w" 
ªd
 "IMM_WB" 
Ü
 "IMM_DB", 
imm
)

1884 
	$wputsz¬g
(
sz
, 
imm
)

1885 
’d


1886 
–£if
 
c
 =ğ"J" 
th’


1887 
mode
 =ğ"iPJ" 
th’


1888 
	`waùiÚ
("REL_A", 
imm
è-- !
	$x64
 (
£ıos
)

1890 
	`wpuab–
("REL_", 
imm
, 2)

1891 
’d


1892 
–£if
 
c
 =ğ"s" 
th’


1893 
loÿl
 
»g
 = 
a
.reg

1894 
»g
 < 0 
th’


1895 
	$wputb
(0)

1896 
	`wv»g
("imm.hi", 
a
.
v»g
)

1898 
	`wputb
(
	$shl
(
»g
, 4))

1899 
’d


1901 
	`w”rÜ
("bad ch¬ `"..
c
.."' iÀ·‰”À`"..
·t
.."' fÜ `"..
İ
.."'")

1902 
’d


1903 
’d


1904 
’d


1905 
’d


1906 
’d


1910 -- 
M­pšg
 
of
 
İ”ªd
 
modes
 
to
 
Çmes
. 
Suµ»ss
 
ouut
 
w™h
 '#'.

1911 
loÿl
 
m­_mod’ame
 = {

1912 
r
 = "»g", 
R
 = "—x", 
C
 = "ş", 
x
 = "mem", 
m
 = "mrm", 
i
 = "imm",

1913 
f
 = "¡x", 
F
 = "¡0", 
J
 = "lbl", ["1"] = "1",

1914 
I
 = "#", 
S
 = "#", 
O
 = "#",

1915 
	}
}

1917 -- 
R‘uº
 
a
 
	gbË
/
¡ršg
 
showšg
 
®l
 
possibË
 
İ”ªd
 
	gmodes
.

1918 
loÿl
 
funùiÚ
 
	$‹m¶©eh–p
(
‹m¶©e
, 
Å¬ams
)

1919 
Å¬ams
 =ğ0 
th’
  "" 
’d


1920 
loÿl
 
t
 = {
	}
}

1921 
tm
 
š
 
gm©ch
(
‹m¶©e
, "[^%|]+") do

1922 
loÿl
 
	gs
 = 
m­_mod’ame
[
sub
(
tm
, 1, 1)]

1923 
	gs
 = 
s
..
gsub
(
sub
(
tm
, 2, 
Å¬ams
), ".", 
	$funùiÚ
(
c
)

1924  ", "..
m­_mod’ame
[
c
]

1925 
’d
)

1926 
nÙ
 
	`m©ch
(
s
, "#"è
th’
 
t
[#t+1] = s 
’d


1927 
’d


1928  
t


1929 
’d


1931 -- 
M©ch
 
İ”ªd
 
modes
 
agaš¡
 
mode
 
m©ch
 
·¹
 
of
 
‹m¶©e
.

1932 
loÿl
 
funùiÚ
 
	$m©chtm
(
tm
, 
¬gs
)

1933 
i
=1,#args do

1934 
nÙ
 
	`m©ch
(
¬gs
[
i
].
mode
, 
	$sub
(
tm
, 
i
, i)è
th’
  
’d


1935 
’d


1936  
Œue


1937 
’d


1939 -- 
HªdË
 
İcodes
 
defšed
 
w™h
 
‹m¶©e
 
¡ršgs
.

1940 
m­_İ
[".‹m¶©e__"] = 
	$funùiÚ
(
·¿ms
, 
‹m¶©e
, 
Å¬ams
)

1941 
nÙ
 
·¿ms
 
th’
  
	$‹m¶©eh–p
(
‹m¶©e
, 
Å¬ams
è
’d


1942 
loÿl
 
¬gs
 = {
	}
}

1944 -- 
Z”o
-
İ”ªd
 
İcodes
 
have
 
no
 
m©ch
 
·¹
.

1945 #·¿m =ğ0 
th’


1946 
dİ©‹º
(
‹m¶©e
, 
¬gs
, "d", 
·¿ms
.
İ
, 
n
)

1948 
	g’d


1950 -- 
D‘”mše
 
commÚ
 
İ”ªd
 
	$size
 (
cÛrû
 
undefšed
 
size
è
Ü
 
æag
 
as
 
mixed
.

1951 
loÿl
 
sz
, 
szmix
, 
Ãed»x


1952 
i
,
p
 
š
 
	$aœs
(
·¿ms
) do

1953 
¬gs
[
i
] = 
	$·r£İ”ªd
(
p
)

1954 
loÿl
 
nsz
 = 
¬gs
[
i
].
İsize


1955 
nsz
 
th’


1956 
sz
 
ªd
 sz ~ğ
nsz
 
th’
 
szmix
 = 
Œue
 sz =‚sz 
’d


1957 
’d


1958 
loÿl
 
Äex
 = 
¬gs
[
i
].
Ãed»x


1959 
Äex
 ~ğ
n
 
th’


1960 
Ãed»x
 =ğ
n
 
th’


1961 
Ãed»x
 = 
Äex


1962 
–£if
 
Ãed»x
 ~ğ
Äex
 
th’


1963 
	`w”rÜ
("bad mix of byte-addressable„egisters")

1964 
’d


1965 
’d


1966 
’d


1968 -- 
Try
 
®l
 
m©ch
:
·‰”n
 
	`·œs
 (
£·¿‹d
 
by
 '|').

1969 
loÿl
 
gÙm©ch
, 
Ï¡·t


1970 
tm
 
š
 
	`gm©ch
(
‹m¶©e
, "[^%|]+") do

1971 -- 
S¶™
 
off
 
size
 
	$m©ch
 (
¡¬ts
 
aá”
 
mode
 
m©ch
è
ªd
 
·‰”n
 
¡ršg
.

1972 
loÿl
 
szm
, 
·t
 = 
	`m©ch
(
tm
, "^(.-):(.*)$", #args+1)

1973 
·t
 =ğ"" 
th’
…© = 
Ï¡·t
 Ï¡·ˆğ·ˆ
’d


1974 
	$m©chtm
(
tm
, 
¬gs
è
th’


1975 
loÿl
 
´efix
 = 
	$sub
(
szm
, 1, 1)

1976 
´efix
 =ğ"/" 
th’
 -- 
Exaùly
 
m©ch
 
Ëadšg
 
İ”ªd
 
sizes
.

1977 
i
 = #szm,1,-1 do

1978 
i
 =ğ1 
th’


1979 
	`dİ©‹º
(
·t
, 
¬gs
, 
sz
, 
·¿ms
.
İ
, 
Ãed»x
è-- 
Proûss
 
·‰”n
.

1981 
–£if
 
¬gs
[
i
-1].
İsize
 ~ğ
	$sub
(
szm
, 
i
, iè
th’


1983 
’d


1984 
’d


1985 -- 
M©ch
 
commÚ
 
İ”ªd
 
size
.

1986 
loÿl
 
szp
 = 
sz


1987 
szm
 =ğ"" 
th’
 szm = 
x64
 
ªd
 "qdwb" 
Ü
 "dwb" 
’d
 -- 
DeçuÉ
 
sizes
.

1988 
´efix
 =ğ"1" 
th’
 
szp
 = 
¬gs
[1].
İsize
; 
szmix
 = 
n


1989 
–£if
 
´efix
 =ğ"2" 
th’
 
szp
 = 
¬gs
[2].
İsize
; 
szmix
 = 
n
 
’d


1990 
nÙ
 
szmix
 
	`ªd
 (
´efix
 =ğ"." 
Ü
 
	`m©ch
(
szm
, 
szp
 o¸"#")è
th’


1991 
	`dİ©‹º
(
·t
, 
¬gs
, 
szp
, 
·¿ms
.
İ
, 
Ãed»x
è-- 
Proûss
 
·‰”n
.

1993 
’d


1994 
’d


1995 
gÙm©ch
 = 
Œue


1996 
’d


1997 
’d


1999 
loÿl
 
msg
 = "bad operand mode"

2000 
gÙm©ch
 
th’


2001 
szmix
 
th’


2002 
msg
 = "mixed operand size"

2004 
msg
 = 
sz
 
ªd
 "bad o³¿nd size" 
Ü
 "missing operand size"

2005 
’d


2006 
’d


2008 
	`w”rÜ
(
msg
.." iÀ`"..
	`İmode¡r
(
·¿ms
.
İ
, 
¬gs
).."'")

2009 
’d


2013 -- 
x64
-
¥ecific
 
İcode
 64 
b™
 
immedŸ‹s
 
ªd
 
di¥Ïûm’ts
.

2014 
x64
 
th’


2015 
funùiÚ
 
m­_İ
.
	$mov64_2
(
·¿ms
)

2016 
nÙ
 
·¿ms
 
th’
  { "»g, imm", "»g, [di¥]", "[di¥],„eg" 
	}
} 
’d


2017 
	g£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


2018 
loÿl
 
İcode
, 
İ64
, 
sz
, 
»x
, 
v»g


2019 
loÿl
 
İ64
 = 
	`m©ch
(
·¿ms
[1], "^%[%s*(.-)%s*%]$")

2020 
İ64
 
th’


2021 
loÿl
 
a
 = 
	$·r£İ”ªd
(
·¿ms
[2])

2022 
a
.
mode
 ~ğ"rmR" 
th’
 
	`w”rÜ
("bad o³¿nd mode"è
’d


2023 
sz
 = 
a
.
İsize


2024 
»x
 = 
sz
 =ğ"q" 
ªd
 8 
Ü
 0

2025 
İcode
 = 0xa3

2027 
İ64
 = 
	`m©ch
(
·¿ms
[2], "^%[%s*(.-)%s*%]$")

2028 
loÿl
 
a
 = 
	$·r£İ”ªd
(
·¿ms
[1])

2029 
İ64
 
th’


2030 
a
.
mode
 ~ğ"rmR" 
th’
 
	`w”rÜ
("bad o³¿nd mode"è
’d


2031 
sz
 = 
a
.
İsize


2032 
»x
 = 
sz
 =ğ"q" 
ªd
 8 
Ü
 0

2033 
İcode
 = 0xa1

2035 
	`sub
(
a
.
mode
, 1, 1è~ğ"r" 
Ü
‡.
İsize
 ~ğ"q" 
th’


2036 
	`w”rÜ
("bad operand mode")

2037 
’d


2038 
İ64
 = 
·¿ms
[2]

2039 
a
.
»g
 =ğ-1 
th’


2040 
v»g
 = 
a
.vreg

2041 
İcode
 = 0xb8

2043 
İcode
 = 0xb8 + 
	$bªd
(
a
.
»g
, 7)

2044 
’d


2045 
»x
 = 
a
.
»g
 > 7 
ªd
 9 
Ü
 8

2046 
’d


2047 
’d


2048 
loÿl
 
psz
, 
sk
 = 
	$wputİ
(
sz
, 
İcode
, 
»x
, 
n
, 
v»g
)

2049 
	`wv»g
("İcode", 
v»g
, 
psz
, 
sk
)

2050 
	`waùiÚ
("IMM_D", 
	`fÜm©
("(unsigÃd iÁ)(%s)", 
İ64
))

2051 
	`waùiÚ
("IMM_D", 
	`fÜm©
("(unsigÃd iÁ)((%s)>>32)", 
İ64
))

2052 
’d


2053 
’d


2057 -- 
P£udo
-
İcodes
 
d©a
 
¡Üage
.

2058 
loÿl
 
funùiÚ
 
	$İ_d©a
(
·¿ms
)

2059 
nÙ
 
·¿ms
 
th’
  "imm..." 
’d


2060 
loÿl
 
sz
 = 
	$sub
(
·¿ms
.
İ
, 2, 2)

2061 
sz
 =ğ"a" 
th’
 sz = 
addrsize
 
’d


2062 
_
,
p
 
š
 
	$aœs
(
·¿ms
) do

2063 
loÿl
 
a
 = 
	$·r£İ”ªd
(
p
)

2064 
	`sub
(
a
.
mode
, 1, 1è~ğ"i" 
	`Ü
 (a.
İsize
 
ªd
‡.İsiz~ğ
sz
è
th’


2065 
	`w”rÜ
("bad modÜ sizš `"..
p
.."'")

2066 
’d


2067 
a
.
mode
 =ğ"iJ" 
th’


2068 
	`wpuab–
("IMM_", 
a
.
imm
, 1)

2070 
	$wputsz¬g
(
sz
, 
a
.
imm
)

2071 
’d


2072 
£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


2073 
’d


2074 
’d


2076 
m­_İ
[".by‹_*"] = 
İ_d©a


2077 
m­_İ
[".sby‹_*"] = 
İ_d©a


2078 
m­_İ
[".wÜd_*"] = 
İ_d©a


2079 
m­_İ
[".dwÜd_*"] = 
İ_d©a


2080 
m­_İ
[".awÜd_*"] = 
İ_d©a


2084 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
aùiÚ
 
li¡
 
is
Ø
be
 
em™‹d
.

2085 
m­_İ
[".aùiÚli¡_1"] = 
	$funùiÚ
(
·¿ms
)

2086 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


2087 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

2088 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™—ùiÚs
(
out
, 
Çme
è
’d
)

2089 
’d


2091 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
is
Ø
be
 
em™‹d
.

2092 
m­_İ
[".glob®s_1"] = 
	$funùiÚ
(
·¿ms
)

2093 
nÙ
 
·¿ms
 
th’
  "´efix" 
’d


2094 
loÿl
 
´efix
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

2095 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®s
(
out
, 
´efix
è
’d
)

2096 
’d


2098 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
glob®
 
Çmes
 
¬e
Ø
be
 
em™‹d
.

2099 
m­_İ
[".glob®Çmes_1"] = 
	$funùiÚ
(
·¿ms
)

2100 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


2101 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

2102 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™eglob®Çmes
(
out
, 
Çme
è
’d
)

2103 
’d


2105 -- 
P£udo
-
İcode
 
to
 
m¬k
 
the
 
pos™iÚ
 
wh”e
h
Çmes
 
¬e
Ø
be
 
em™‹d
.

2106 
m­_İ
[".ex‹ºÇmes_1"] = 
	$funùiÚ
(
·¿ms
)

2107 
nÙ
 
·¿ms
 
th’
  "cv¬" 
’d


2108 
loÿl
 
Çme
 = 
·¿ms
[1] -- 
No
 
syÁax
 
check
. 
You
 
g‘
 
to
 
k“p
 
the
 
p›ûs
.

2109 
	`wlše
(
	$funùiÚ
(
out
è
	$wr™“x‹ºÇmes
(
out
, 
Çme
è
’d
)

2110 
’d


2114 -- 
Lab–
 
p£udo
-
	`İcode
 (
cÚv”‹d
 
äom
 
Œašg
 
cŞÚ
 
fÜm
).

2115 
m­_İ
[".Ïb–_2"] = 
	$funùiÚ
(
·¿ms
)

2116 
nÙ
 
·¿ms
 
th’
  "[1-9] | ->glob® | =>pûx´ [,‡ddr]" 
’d


2117 
£ıos
+2 > 
max£ıos
 
th’
 
	$wæush
(è
’d


2118 
loÿl
 
a
 = 
	$·r£İ”ªd
(
·¿ms
[1])

2119 
loÿl
 
mode
, 
imm
 = 
a
.mode,‡.imm

2120 
	`ty³
(
imm
è=ğ"numb”" 
	`ªd
 (
mode
 =ğ"iJ" 
	`Ü
 (imm >ğ1 
ªd
 imm <ğ9)è
th’


2121 -- 
Loÿl
 
	$Ïb–
 (1: ... 9:è
Ü
 
glob®
 
	`Ïb–
 (->global:).

2122 
	`waùiÚ
("LABEL_LG", 
n
, 1)

2123 
	$wputxb
(
imm
)

2124 
–£if
 
mode
 =ğ"iJ" 
th’


2125 -- 
PC
 
	`Ïb–
 (=>
pûx´
:).

2126 
	`waùiÚ
("LABEL_PC", 
imm
)

2128 
	`w”rÜ
("bad†abel definition")

2129 
’d


2130 -- 
SETLABEL
 
mu¡
 
immedŸ‹ly
 
fŞlow
 
LABEL_LG
/
LABEL_PC
.

2131 
loÿl
 
addr
 = 
·¿ms
[2]

2132 
addr
 
th’


2133 
loÿl
 
a
 = 
	$·r£İ”ªd
(
addr
)

2134 
a
.
mode
 =ğ"iPJ" 
th’


2135 
	`waùiÚ
("SETLABEL", 
a
.
imm
)

2137 
	`w”rÜ
("bad†abel‡ssignment")

2138 
’d


2139 
’d


2140 
’d


2141 
m­_İ
[".label_1"] = map_op[".label_2"]

2145 -- 
Alignm’t
 
p£udo
-
İcode
.

2146 
m­_İ
[".®ign_1"] = 
	$funùiÚ
(
·¿ms
)

2147 
nÙ
 
·¿ms
 
th’
  "numpow2" 
’d


2148 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


2149 
loÿl
 
®ign
 = 
	$tÚumb”
(
·¿ms
[1]è
Ü
 
m­_İsiz’um
[
m­_İsize
[params[1]]]

2150 
®ign
 
th’


2151 
loÿl
 
x
 = 
®ign


2152 -- 
Mu¡
 
be
 
a
 
pow”
 
of
 2 
š
 
the
 
	`¿nge
 (2 ... 256).

2153 
i
=1,8 do

2154 
x
 = x / 2

2155 
x
 =ğ1 
th’


2156 
	`waùiÚ
("ALIGN", 
n
, 1)

2157 
	`wputxb
(
®ign
-1è-- 
AùiÚ
 
by‹
 
is
 2**
n
-1.

2159 
’d


2160 
’d


2161 
’d


2162 
	`w”rÜ
("bad‡lignment")

2163 
’d


2165 -- 
S·cšg
 
p£udo
-
İcode
.

2166 
m­_İ
[".¥aû_2"] = 
	$funùiÚ
(
·¿ms
)

2167 
nÙ
 
·¿ms
 
th’
  "num [, fËr]" 
’d


2168 
£ıos
+1 > 
max£ıos
 
th’
 
	$wæush
(è
’d


2169 
	`waùiÚ
("SPACE", 
·¿ms
[1])

2170 
loÿl
 
fl
 = 
·¿ms
[2]

2171 
fl
 
th’


2172 
fl
 = 
	$tÚumb”
(
fl
)

2173 
nÙ
 
fl
 
Ü
 fÈ< 0 o¸fÈ> 255 
th’
 
	`w”rÜ
("bad fËr"è
’d


2174 
’d


2175 
	$wputxb
(
fl
 
Ü
 0)

2176 
’d


2177 
m­_İ
[".space_1"] = map_op[".space_2"]

2181 -- 
P£udo
-
İcode
 
´im™ive
è
ty³
 
	`defš™iÚs
 (
m­
 
to
 
C
 
ty³s
).

2182 
m­_İ
[".ty³_3"] = 
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

2183 
nÙ
 
·¿ms
 
th’


2184  
Å¬ams
 =ğ2 
ªd
 "Çme, cty³" 
Ü
 "name, ctype,„eg"

2185 
’d


2186 
loÿl
 
Çme
, 
ùy³
, 
»g
 = 
·¿ms
[1],…arams[2],…arams[3]

2187 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


2188 
	`w”rÜ
("bady³‚am`"..
Çme
.."'")

2189 
’d


2190 
loÿl
 

 = 
m­_ty³
[
Çme
]

2191 

 
th’


2192 
	`w”rÜ
("du¶iÿ‹y³ `"..
Çme
.."'")

2193 
’d


2194 
»g
 
ªd
 
nÙ
 
m­_»g_v®id_ba£
[»g] 
th’


2195 
	`w”rÜ
("bad ba£„egi¡” `"..(
m­_»g_»v
[
»g
] 
Ü
„eg).."'")

2196 
’d


2197 -- 
Add
 #ty³ 
to
 
defšes
. 
A
 
b™
 
unş—n
Ø
put
 
™
 
š
 
m­_¬chdef
.

2198 
m­_¬chdef
["#"..
Çme
] = "sizeof("..
ùy³
..")"

2199 -- 
Add
 
Ãw
 
ty³
 
ªd
 
em™
 
shÜtcut
 
defše
.

2200 
loÿl
 
num
 = 
ùy³num
 + 1

2201 
m­_ty³
[
Çme
] = {

2202 
ùy³
 = ctype,

2203 
ùy³fmt
 = 
	`fÜm©
("Dt%X(%%s)", 
num
),

2204 
»g
 =„eg,

2205 
	}
}

2206 
wlše
(
fÜm©
("#defšDt%X(_Vè(št)ÕŒdiff_t)&(((% *)0)_V)", 
num
, 
ùy³
))

2207 
ùy³num
 = 
num


2208 
’d


2209 
m­_İ
[".type_2"] = map_op[".type_3"]

2211 -- 
Dump
 
ty³
 
defš™iÚs
.

2212 
loÿl
 
funùiÚ
 
	$dum±y³s
(
out
, 
lvl
)

2213 
loÿl
 
t
 = {
	}
}

2214 
Çme
 
š
 
	$·œs
(
m­_ty³
èdØ
t
[#t+1] = 
Çme
 
’d


2215 
	$sÜt
(
t
)

2216 
out
:
	`wr™e
("Type definitions:\n")

2217 
_
,
Çme
 
š
 
	$aœs
(
t
) do

2218 
loÿl
 

 = 
m­_ty³
[
Çme
]

2219 
loÿl
 
»g
 = 

.»g 
ªd
 
m­_»g_»v
[.»g] 
Ü
 ""

2220 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %-20 %s\n", 
Çme
, 

.
ùy³
, 
»g
))

2221 
’d


2222 
out
:
	`wr™e
("\n")

2223 
’d


2227 -- 
S‘
 
the
 
cu¼’t
 
£ùiÚ
.

2228 
funùiÚ
 
_M
.
	$£ùiÚ
(
num
)

2229 
	`waùiÚ
("SECTION")

2230 
	$wputxb
(
num
)

2231 
	`wæush
(
Œue
è-- 
SECTION
 
is
 
a
 
‹rmš®
 
aùiÚ
.

2232 
’d


2236 -- 
Dump
 
¬ch™eùu»
 
desütiÚ
.

2237 
funùiÚ
 
_M
.
	$dum·rch
(
out
)

2238 
out
:
	`wr™e
(
	`fÜm©
("DynASM %s version %s,„eleased %s\n\n",

2239 
_šfo
.
¬ch
, _šfo.
v”siÚ
, _šfo.
»Ëa£
))

2240 
	$dum´egs
(
out
)

2241 
	$dum·ùiÚs
(
out
)

2242 
’d


2244 -- 
Dump
 
®l
 
u£r
 
defšed
 
–em’ts
.

2245 
funùiÚ
 
_M
.
	$dumpdef
(
out
, 
lvl
)

2246 
	$dum±y³s
(
out
, 
lvl
)

2247 
	$dumpglob®s
(
out
, 
lvl
)

2248 
	$dum³x‹ºs
(
out
, 
lvl
)

2249 
’d


2253 -- 
Pass
 
ÿÎbacks
 
äom
/
to
 
the
 
DynASM
 
cÜe
.

2254 
funùiÚ
 
_M
.
	$·sscb
(
wl
, 
we
, 
wf
, 
ww
)

2255 
wlše
, 
w”rÜ
, 
wçl
, 
ww¬n
 = 
wl
, 
we
, 
wf
, 
ww


2256  
wæush


2257 
’d


2259 -- 
S‘up
 
the
 
¬ch
-
¥ecific
 
moduË
.

2260 
funùiÚ
 
_M
.
	$£tup
(
¬ch
, 
İt
)

2261 
g_¬ch
, 
g_İt
 = 
¬ch
, 
İt


2262 
’d


2264 -- 
M”ge
 
the
 
cÜe
 
m­s
 
ªd
h
¬ch
-
¥ecific
 maps.

2265 
funùiÚ
 
_M
.
	$m”gem­s
(
m­_cÜeİ
, 
m­_def
)

2266 
	`£tm‘©abË
(
m­_İ
, { 
__šdex
 = 
m­_cÜeİ
 
	}
})

2267 
£tm‘©abË
(
m­_def
, { 
__šdex
 = 
m­_¬chdef
 })

2268  
m­_İ
, 
m­_def


2269 
’d


2271  
_M


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dynasm.lua

2 -- 
	gDynASM
. 
A
 
dyÇmic
 
as£mbËr
 
code
 
g’”©iÚ
 
	g’gšes
.

3 -- 
Origš®ly
 
desigÃd
 
ªd
 
im¶em’‹d
 
	gLuaJIT
.

5 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

6 -- 
S“
 
b–ow
 
fuÎ
 
cİyright
 
	gnÙiû
.

9 -- 
AµliÿtiÚ
 
	gšfÜm©iÚ
.

10 
loÿl
 
	g_šfo
 = {

11 
Çme
 = "DynASM",

12 
	gdesütiÚ
 = "A dynamic‡ssembler for code generationƒngines",

13 
	gv”siÚ
 = "1.4.0",

14 
	gv”num
 = 10400,

15 
	g»Ëa£
 = "2015-10-18",

16 
	gauthÜ
 = "Mike Pall",

17 
	gu¾
 = "http://luajit.org/dynasm.html",

18 
	gliûn£
 = "MIT",

19 
	gcİyright
 = [[

20 
Cİyright
 (
C
è2005-2017 
Mike
 
P®l
. 
AÎ
 
rights
 
»£rved
.

22 
P”missiÚ
 
is
 
h”eby
 
g¿Áed
, 
ä“
 
of
 
ch¬ge
, 
to
 
ªy
 
³rsÚ
 
obššg


23 
a
 
cİy
 
of
 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the


24 "Soáw¬e"), 
to
 
d—l
 
š
 
the
 
Soáw¬e
 
w™hout
 
»¡riùiÚ
, 
šşudšg


25 
w™hout
 
lim™©iÚ
 
the
 
rights
 
to
 
u£
, 
cİy
, 
modify
, 
m”ge
, 
publish
,

26 
di¡ribu‹
, 
subliûn£
, 
ªd
/
Ü
 
£Î
 
cİ›s
 
of
 
the
 
Soáw¬e
,‡nd 
to


27 
³rm™
 
³rsÚs
 
to
 
whom
 
the
 
Soáw¬e
 
is
 
fuºished
ØdØ
so
, 
subjeù
o

28 
the
 
fŞlowšg
 
cÚd™iÚs
:

30 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be


31 
šşuded
 
š
 
®l
 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

33 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
KIND
,

34 
EXPRESS
 
OR
 
IMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF


35 
MERCHANTABILITY
, 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
NONINFRINGEMENT
.

36 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
AUTHORS
 
OR
 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY


37 
CLAIM
, 
DAMAGES
 
OR
 
OTHER
 
LIABILITY
, 
WHETHER
 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
,

38 
TORT
 
OR
 
OTHERWISE
, 
ARISING
 
FROM
, 
OUT
 
OF
 OR 
IN
 
CONNECTION
 
WITH
 
THE


39 
SOFTWARE
 
OR
 
THE
 
USE
 OR 
OTHER
 
DEALINGS
 
IN
 THE SOFTWARE.

41 [ 
MIT
 
liûn£
: 
h‰p
:

45 -- 
Cache
 
lib¿ry
 
	gfunùiÚs
.

46 
loÿl
 
	gty³
, 
	g·œs
, 
	gaœs
 = 
ty³
,…aœs, 
aœs


47 
loÿl
 
	gpÿÎ
, 
	g”rÜ
, 
	gas£¹
 = 
pÿÎ
,ƒ¼Ü, 
as£¹


48 
loÿl
 
	g_s
 = 
¡ršg


49 
loÿl
 
sub
, 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
_s
.sub, 
	g_s
.m©ch, _s.gm©ch, _s.
gsub


50 
loÿl
 
	gfÜm©
, 
	g»p
, 
	guµ”
 = 
_s
.
fÜm©
, 
	g_s
.»p, _s.
uµ”


51 
loÿl
 
	g_t
 = 
bË


52 
loÿl
 
š£¹
, 
	g»move
, 
	gcÚÿt
, 
	gsÜt
 = 
_t
.š£¹, 
	g_t
.»move, _t.cÚÿt, _t.
sÜt


53 
loÿl
 
	gex™
 = 
os
.
ex™


54 
loÿl
 
io
 = io

55 
loÿl
 
¡dš
, 
	g¡dout
, 
	g¡d”r
 = 
io
.¡dš, 
	gio
.stdout, io.stderr

59 -- 
Prog¿m
 
	gİtiÚs
.

60 
loÿl
 
	gg_İt
 = {}

62 -- 
Glob®
 
¡©e
 
cu¼’t
 
fe
.

63 
loÿl
 
g_âame
, 
	gg_cu¾še
, 
	gg_šd’t
, 
	gg_lš’o
, 
	gg_synşš’o
, 
g_¬ch


64 
loÿl
 
	gg_”rcouÁ
 = 0

66 -- 
Wr™e
 
bufãr
 
ouut
 
fe
.

67 
loÿl
 
g_wbufãr
, 
	gg_ÿpbufãr


71 -- 
Wr™e
 
ª
 
ouut
 
	$lše
 (
Ü
 
ÿÎback
 
funùiÚ
è
to
 
the
 
bufãr
.

72 
loÿl
 
funùiÚ
 
	$wlše
(
lše
, 
Ãedšd’t
)

73 
loÿl
 
buf
 = 
g_ÿpbufãr
 
Ü
 
g_wbufãr


74 
buf
[#buf+1] = 
Ãedšd’t
 
ªd
 
g_šd’t
..
lše
 
Ü
†ine

75 
g_synşš’o
 = g_synclineno + 1

76 
’d


78 -- 
Wr™e
 
as£mbËr
 
lše
 
as
 
a
 
comm’t
, 
»que¡d
.

79 
loÿl
 
funùiÚ
 
	$wcomm’t
(
®še
)

80 
g_İt
.
comm’t
 
th’


81 
	$wlše
(
g_İt
.
comm’t
..
®še
..g_İt.
’dcomm’t
, 
Œue
)

82 
’d


83 
’d


85 -- 
Resync
 
CPP
 
lše
 
numb”s
.

86 
loÿl
 
funùiÚ
 
	$wsync
()

87 
g_synşš’o
 ~ğ
g_lš’o
 
ªd
 
g_İt
.
ıp
 
th’


88 
	`wlše
("#lš"..
g_lš’o
..' "'..
g_âame
..'"')

89 
g_synşš’o
 = 
g_lš’o


90 
’d


91 
’d


93 -- 
Dummy
 
aùiÚ
 
æush
 
funùiÚ
. 
R•Ïûd
 
w™h
 
¬ch
-
¥ecific
 funùiÚ 
Ï‹r
.

94 
loÿl
 
funùiÚ
 
	$wæush
(
‹rm
)

95 
’d


97 -- 
Dump
 
®l
 
bufã»d
 
ouut
 
lšes
.

98 
loÿl
 
funùiÚ
 
	$wdum¶šes
(
out
, 
buf
)

99 
_
,
lše
 
š
 
	$aœs
(
buf
) do

100 
	`ty³
(
lše
è=ğ"¡ršg" 
th’


101 
	`as£¹
(
out
:
	`wr™e
(
lše
, "\n"))

103 -- 
S³cŸl
 
ÿÎback
 
to
 
dyÇmiÿÎy
 
š£¹
 
lšes
 
aá”
 
’d
 
of
 
´oûssšg
.

104 
	$lše
(
out
)

105 
’d


106 
’d


107 
’d


111 -- 
Em™
 
ª
 
”rÜ
. 
Proûssšg
 
cÚtšues
 
w™h
 
Ãxt
 
¡©em’t
.

112 
loÿl
 
funùiÚ
 
	$w”rÜ
(
msg
)

113 
	`”rÜ
(
	`fÜm©
("%s:%s:ƒ¼Ü: %s:\n%s", 
g_âame
, 
g_lš’o
, 
msg
, 
g_cu¾še
), 0)

114 
’d


116 -- 
Em™
 
a
 
çl
 
”rÜ
. 
Proûssšg
 
¡İs
.

117 
loÿl
 
funùiÚ
 
	$wçl
(
msg
)

118 
g_”rcouÁ
 = "fatal"

119 
	$w”rÜ
(
msg
)

120 
’d


122 -- 
Pršt
 
a
 
w¬nšg
. 
Proûssšg
 
cÚtšues
.

123 
loÿl
 
funùiÚ
 
	$ww¬n
(
msg
)

124 
¡d”r
:
	`wr™e
(
	`fÜm©
("%s:%s: warning: %s:\n%s\n",

125 
g_âame
, 
g_lš’o
, 
msg
, 
g_cu¾še
))

126 
’d


128 -- 
Pršt
 
ÿught
 
”rÜ
 
mes§ge
. 
But
 
suµ»ss
 
exûssive
 
”rÜs
.

129 
loÿl
 
funùiÚ
 
	$w´š‹¼
(...)

130 
	`ty³
(
g_”rcouÁ
è=ğ"numb”" 
th’


131 -- 
ReguÏr
 
”rÜ
.

132 
g_”rcouÁ
 = g_errcount + 1

133 
g_”rcouÁ
 < 21 
th’
 -- 
S“ms
 
to
 
be
 
a
 
»asÚabË
 
lim™
.

134 
¡d”r
:
	$wr™e
(...)

135 
–£if
 
g_”rcouÁ
 =ğ21 
th’


136 
¡d”r
:
	`wr™e
(
g_âame
,

138 
’d


140 -- 
F©®
 
”rÜ
.

141 
¡d”r
:
	$wr™e
(...)

142  
Œue
 -- 
Stİ
 
´oûssšg
.

143 
’d


144 
’d


148 -- 
M­
 
hŞdšg
 
®l
 
İtiÚ
 
hªdËrs
.

149 
loÿl
 
İt_m­
 = {
	}
}

150 
loÿl
 
İt_cu¼’t


152 -- 
Pršt
 
”rÜ
 
ªd
 
ex™
 
w™h
ƒ¼Ü 
¡©us
.

153 
loÿl
 
funùiÚ
 
	$İ‹¼Ü
(...)

154 
¡d”r
:
	`wr™e
("dynasm.lua: ERROR: ", ...)

155 
¡d”r
:
	`wr™e
("\n")

156 
	$ex™
(1)

157 
’d


159 -- 
G‘
 
İtiÚ
 
·¿m‘”
.

160 
loÿl
 
funùiÚ
 
	$İ¬am
(
¬gs
)

161 
loÿl
 
¬gn
 = 
¬gs
.argn

162 
loÿl
 
p
 = 
¬gs
[
¬gn
]

163 
nÙ
 
p
 
th’


164 
	`İ‹¼Ü
("missšg…¬am‘” fÜ o±iÚ `", 
İt_cu¼’t
, "'.")

165 
’d


166 
¬gs
.
¬gn
 =‡rgn + 1

167  
p


168 
’d


172 -- 
CÜe
 
p£udo
-
İcodes
.

173 
loÿl
 
m­_cÜeİ
 = {
	}
}

174 -- 
Dummy
 
İcode
 
m­
. 
R•Ïûd
 
by
 
¬ch
-
¥ecific
 map.

175 
loÿl
 
m­_İ
 = {}

177 -- 
FÜw¬d
 
deş¬©iÚs
.

178 
loÿl
 
do¡mt


179 
loÿl
 
»adfe


183 -- 
M­
 
defšes
 (
š™ŸÎy
 
em±y
, 
chašs
 
to
 
¬ch
-
¥ecific
 
m­
).

184 
loÿl
 
	gm­_def
 = {}

186 -- 
P£udo
-
İcode
 
to
 
defše
 
a
 
sub¡™utiÚ
.

187 
m­_cÜeİ
[".defše_2"] = 
	$funùiÚ
(
·¿ms
, 
Å¬ams
)

188 
nÙ
 
·¿ms
 
th’
  
Å¬ams
 =ğ1 
ªd
 "Çme" 
Ü
 "Çme, sub¡" 
’d


189 
loÿl
 
Çme
, 
def
 = 
·¿ms
[1],…¬ams[2] 
Ü
 "1"

190 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’
 
	`w”rÜ
("bad o¸du¶iÿ‹ defše"è
’d


191 
m­_def
[
Çme
] = 
def


192 
’d


193 
m­_cÜeİ
[".define_1"] = map_coreop[".define_2"]

195 -- 
Defše
 
a
 
sub¡™utiÚ
 
Ú
 
the
 
commªd
 
lše
.

196 
funùiÚ
 
İt_m­
.
	$D
(
¬gs
)

197 
loÿl
 
Çmesub¡
 = 
	$İ¬am
(
¬gs
)

198 
loÿl
 
Çme
, 
sub¡
 = 
	`m©ch
(
Çmesub¡
, "^([%a_][%w_]*)=(.*)$")

199 
Çme
 
th’


200 
m­_def
[
Çme
] = 
sub¡


201 
–£if
 
	`m©ch
(
Çmesub¡
, "^[%a_][%w_]*$"è
th’


202 
m­_def
[
Çmesub¡
] = "1"

204 
	`İ‹¼Ü
("bad define")

205 
’d


206 
’d


208 -- 
Undefše
 
a
 
sub¡™utiÚ
 
Ú
 
the
 
commªd
 
lše
.

209 
funùiÚ
 
İt_m­
.
	$U
(
¬gs
)

210 
loÿl
 
Çme
 = 
	$İ¬am
(
¬gs
)

211 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


212 
m­_def
[
Çme
] = 
n


214 
	`İ‹¼Ü
("bad define")

215 
’d


216 
’d


218 -- 
H–³r
 
defšesub¡
.

219 
loÿl
 
gÙsub¡


221 
loÿl
 
funùiÚ
 
	$defšesub¡_Úe
(
wÜd
)

222 
loÿl
 
sub¡
 = 
m­_def
[
wÜd
]

223 
sub¡
 
th’
 
gÙsub¡
 = 
wÜd
;  sub¡  wÜd 
’d


224 
’d


226 -- 
I‹¿tiv–y
 
sub¡™u‹
 
defšes
.

227 
loÿl
 
funùiÚ
 
	`defšesub¡
(
¡mt
)

228 -- 
Lim™
 
numb”
 
of
 
™”©iÚs
.

229 
i
=1,100 do

230 
gÙsub¡
 = 
çl£


231 
¡mt
 = 
	`gsub
(¡mt, "#?[%w_]+", 
defšesub¡_Úe
)

232 
nÙ
 
gÙsub¡
 
th’
  
’d


233 
’d


234 
gÙsub¡
 
th’
 
	`wçl
("»cursivdefššvŞvšg `"..gÙsub¡.."'"è
’d


235  
¡mt


236 
’d


238 -- 
Dump
 
®l
 
defšes
.

239 
loÿl
 
funùiÚ
 
	$dumpdefšes
(
out
, 
lvl
)

240 
loÿl
 
t
 = {
	}
}

241 
Çme
 
š
 
	$·œs
(
m­_def
) do

242 
t
[#t+1] = 
Çme


243 
’d


244 
	$sÜt
(
t
)

245 
out
:
	`wr™e
("Defines:\n")

246 
_
,
Çme
 
š
 
	$aœs
(
t
) do

247 
loÿl
 
sub¡
 = 
m­_def
[
Çme
]

248 
g_¬ch
 
th’
 
sub¡
 = g_¬ch.
	$»vdef
(
sub¡
è
’d


249 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %s\n", 
Çme
, 
sub¡
))

250 
’d


251 
out
:
	`wr™e
("\n")

252 
’d


256 -- 
SuµÜt
 
v¬ŸbËs
 
cÚd™iÚ®
 
as£mbly
.

257 
loÿl
 
cÚdËv–
 = 0

258 
loÿl
 
cÚd¡ack
 = {
	}
}

260 -- 
Ev®u©e
 
cÚd™iÚ
 
w™h
 
a
 
Lua
 
ex´essiÚ
. 
Sub¡™utiÚs
 
®»ady
 
³rfÜmed
.

261 
loÿl
 
funùiÚ
 
	$cÚd_ev®
(
cÚd
)

262 
loÿl
 
func
, 
”r


263 
£tãnv
 
th’


264 
func
, 
”r
 = 
	`lßd¡ršg
("»tuº "..
cÚd
, "=expr")

266 -- 
No
 
glob®s
. 
AÎ
 
unknown
 
id’tif›rs
 
ev®u©e
 
to
 
n
.

267 
func
, 
”r
 = 
	`lßd
("»tuº "..
cÚd
, "óx´", "t", {
	}
})

268 
’d


269 
func
 
th’


270 
£tãnv
 
th’


271 
£tãnv
(
func
, {}è-- 
No
 
	gglob®s
. 
AÎ
 
unknown
 
id’tif›rs
 
ev®u©e
 
to
 
	gn
.

272 
’d


273 
loÿl
 
	gok
, 
	g»s
 = 
	$pÿÎ
(
func
)

274 
ok
 
th’


275 
»s
 =ğ0 
th’
  
çl£
 
’d
 -- 
Oh
 
w–l
.

276  
nÙ
‚Ù 
»s


277 
’d


278 
”r
 = 
»s


279 
’d


280 
	`wçl
("bad cÚd™iÚ: "..
”r
)

281 
’d


283 -- 
Sk
 
¡©em’ts
 
uÁ
 
Ãxt
 
cÚd™iÚ®
 
p£udo
-
İcode
 
©
 
the
 
§me
 
Ëv–
.

284 
loÿl
 
funùiÚ
 
	$¡mtsk
()

285 
loÿl
 
do¡mt_§ve
 = 
do¡mt


286 
loÿl
 
lvl
 = 0

287 
do¡mt
 = 
	$funùiÚ
(
¡mt
)

288 
loÿl
 
İ
 = 
	`m©ch
(
¡mt
, "^%s*(%S+)")

289 
İ
 =ğ".if" 
th’


290 
lvl
 =†vl + 1

291 
–£if
 
lvl
 ~ğ0 
th’


292 
İ
 =ğ".’dif" 
th’
 
lvl
 =†vÈ- 1 
’d


293 
–£if
 
İ
 =ğ".–if" 
Ü
 o°=ğ".–£" o¸İ =ğ".’dif" 
th’


294 
do¡mt
 = 
do¡mt_§ve


295 
	$do¡mt
(
¡mt
)

296 
’d


297 
’d


298 
’d


300 -- 
P£udo
-
İcodes
 
cÚd™iÚ®
 
as£mbly
.

301 
m­_cÜeİ
[".if_1"] = 
	$funùiÚ
(
·¿ms
)

302 
nÙ
 
·¿ms
 
th’
  "cÚd™iÚ" 
’d


303 
loÿl
 
lvl
 = 
cÚdËv–
 + 1

304 
loÿl
 
»s
 = 
	$cÚd_ev®
(
·¿ms
[1])

305 
cÚdËv–
 = 
lvl


306 
cÚd¡ack
[
lvl
] = 
»s


307 
nÙ
 
»s
 
th’
 
	$¡mtsk
(è
’d


308 
’d


310 
m­_cÜeİ
[".–if_1"] = 
	$funùiÚ
(
·¿ms
)

311 
nÙ
 
·¿ms
 
th’
  "cÚd™iÚ" 
’d


312 
cÚdËv–
 =ğ0 
th’
 
	`wçl
(".–iàw™houˆ.if"è
’d


313 
loÿl
 
lvl
 = 
cÚdËv–


314 
loÿl
 
»s
 = 
cÚd¡ack
[
lvl
]

315 
»s
 
th’


316 
»s
 =ğ"–£" 
th’
 
	`wçl
(".–iàaá” .–£"è
’d


318 
»s
 = 
	$cÚd_ev®
(
·¿ms
[1])

319 
»s
 
th’


320 
cÚd¡ack
[
lvl
] = 
»s


322 
’d


323 
’d


324 
	$¡mtsk
()

325 
’d


327 
m­_cÜeİ
[".–£_0"] = 
	$funùiÚ
(
·¿ms
)

328 
cÚdËv–
 =ğ0 
th’
 
	`wçl
(".–£ w™houˆ.if"è
’d


329 
loÿl
 
lvl
 = 
cÚdËv–


330 
loÿl
 
»s
 = 
cÚd¡ack
[
lvl
]

331 
cÚd¡ack
[
lvl
] = "else"

332 
»s
 
th’


333 
»s
 =ğ"–£" 
th’
 
	`wçl
(".–£‡á” .–£"è
’d


334 
	$¡mtsk
()

335 
’d


336 
’d


338 
m­_cÜeİ
[".’dif_0"] = 
	$funùiÚ
(
·¿ms
)

339 
loÿl
 
lvl
 = 
cÚdËv–


340 
lvl
 =ğ0 
th’
 
	`wçl
(".’diàw™houˆ.if"è
’d


341 
cÚdËv–
 = 
lvl
 - 1

342 
’d


344 -- 
Check
 
unfšished
 
cÚd™iÚ®s
.

345 
loÿl
 
funùiÚ
 
	$checkcÚds
()

346 
g_”rcouÁ
 ~ğ"çl" 
ªd
 
cÚdËv–
 ~ğ0 
th’


347 
	`w´š‹¼
(
g_âame
, ":*:ƒrror: unbalanced conditional\n")

348 
’d


349 
’d


353 -- 
S—rch
 
a
 
fe
 
š
 
the
 
giv’
 
·th
 
ªd
 
İ’
 
™
 
»adšg
.

354 
loÿl
 
funùiÚ
 
	$·thİ’
(
·th
, 
Çme
)

355 
loÿl
 
dœ£p
 = 
·ckage
 
ªd
 
	`m©ch
Õackage.
·th
, "\\"èªd "\\" 
Ü
 "/"

356 
_
,
p
 
š
 
	$aœs
(
·th
) do

357 
loÿl
 
fuÎÇme
 = 
p
 =ğ"" 
ªd
 
Çme
 
Ü
…..
dœ£p
..name

358 
loÿl
 
fš
 = 
io
.
	`İ’
(
fuÎÇme
, "r")

359 
fš
 
th’


360 
g_âame
 = 
fuÎÇme


361  
fš


362 
’d


363 
’d


364 
’d


366 -- 
Inşude
 
a
 
fe
.

367 
m­_cÜeİ
[".šşude_1"] = 
	$funùiÚ
(
·¿ms
)

368 
nÙ
 
·¿ms
 
th’
  "f’ame" 
’d


369 
loÿl
 
Çme
 = 
·¿ms
[1]

370 -- 
Save
 
¡©e
. 
Ugly
, 
I
 
know
. 
but
 
upv®ues
 
¬e
 
ç¡
.

371 
loÿl
 
gf
, 
gl
, 
gş
, 
gi
 = 
g_âame
, 
g_lš’o
, 
g_cu¾še
, 
g_šd’t


372 -- 
R—d
 
the
 
šşuded
 
fe
.

373 
loÿl
 
çl
 = 
	`»adfe
(
	$·thİ’
(
g_İt
.
šşude
, 
Çme
è
Ü


374 
	`wçl
("šşudf`"..
Çme
.."'‚ot found"))

375 -- 
Re¡Üe
 
¡©e
.

376 
g_synşš’o
 = -1

377 
g_âame
, 
g_lš’o
, 
g_cu¾še
, 
g_šd’t
 = 
gf
, 
gl
, 
gş
, 
gi


378 
çl
 
th’
 
	`wçl
("š inşudfe"è
’d


379 
’d


381 -- 
Make
 .
šşude
 
ªd
 
cÚd™iÚ®s
 
š™ŸÎy
 
avaabË
, 
too
.

382 
m­_İ
[".šşude_1"] = 
m­_cÜeİ
[".include_1"]

383 
m­_İ
[".if_1"] = 
m­_cÜeİ
[".if_1"]

384 
m­_İ
[".–if_1"] = 
m­_cÜeİ
[".elif_1"]

385 
m­_İ
[".–£_0"] = 
m­_cÜeİ
[".else_0"]

386 
m­_İ
[".’dif_0"] = 
m­_cÜeİ
[".endif_0"]

390 -- 
SuµÜt
 
v¬ŸbËs
 
maüos
.

391 
loÿl
 
mac_ÿ±u»
, 
mac_lš’o
, 
mac_Çme


392 
loÿl
 
mac_aùive
 = {
	}
}

393 
loÿl
 
mac_li¡
 = {}

395 -- 
P£udo
-
İcode
 
to
 
defše
 
a
 
maüo
.

396 
m­_cÜeİ
[".maüo_*"] = 
	$funùiÚ
(
m·¿ms
)

397 
nÙ
 
m·¿ms
 
th’
  "Çm[,…¬ams...]" 
’d


398 -- 
S¶™
 
off
 
ªd
 
v®id©e
 
maüo
 
Çme
.

399 
loÿl
 
Çme
 = 
	$»move
(
m·¿ms
, 1)

400 
nÙ
 
Çme
 
th’
 
	`w”rÜ
("missšg maüØÇme"è
’d


401 
	`nÙ
 (
	`m©ch
(
Çme
, "^[%a_][%w_%.]*$"è
Ü
 m©chÒame, "^%.[%w_%.]*$")è
th’


402 
	`wçl
("bad maüØÇm`"..
Çme
.."'")

403 
’d


404 -- 
V®id©e
 
maüo
 
·¿m‘”
 
Çmes
.

405 
loÿl
 
mdup
 = {
	}
}

406 
_
,
mp
 
š
 
	$aœs
(
m·¿ms
) do

407 
nÙ
 
	`m©ch
(
mp
, "^[%a_][%w_]*$"è
th’


408 
	`wçl
("bad maüØ·¿m‘”‚am`"..
mp
.."'")

409 
’d


410 
mdup
[
mp
] 
th’
 
	`wçl
("du¶iÿ‹ maüØ·¿m‘”‚am`"..mp.."'"è
’d


411 
mdup
[
mp
] = 
Œue


412 
’d


413 -- 
Check
 
du¶iÿ‹
 
Ü
 
»cursive
 
maüo
 
defš™iÚs
.

414 
loÿl
 
İÇme
 = 
Çme
.."_"..#mparams

415 
m­_İ
[
İÇme
] 
Ü
 m­_İ[
Çme
.."_*"] 
th’


416 
	`wçl
("du¶iÿ‹ maüØ`"..
Çme
.."' ("..#mparams.."…arameters)")

417 
’d


418 
mac_ÿ±u»
 
th’
 
	`wçl
("»cursivmaüØdefš™iÚ"è
’d


420 -- 
EÇbË
 
¡©em’t
 
ÿ±u»
.

421 
loÿl
 
lšes
 = {
	}
}

422 
mac_lš’o
 = 
g_lš’o


423 
mac_Çme
 = 
Çme


424 
mac_ÿ±u»
 = 
funùiÚ
(
¡mt
è-- 
S‹m’t
 
ÿ±u»
 function.

425 -- 
Stİ
 
maüo
 
defš™iÚ
 
w™h
 .
’dmaüo
 
p£udo
-
İcode
.

426 
nÙ
 
m©ch
(
¡mt
, "^%s*.’dmaüo%s*$"è
th’


427 
	glšes
[#lšes+1] = 
¡mt


429 
’d


430 
mac_ÿ±u»
 = 
n


431 
mac_lš’o
 = 
n


432 
mac_Çme
 = 
n


433 
mac_li¡
[#mac_li¡+1] = 
İÇme


434 -- 
Add
 
maüo
-
İ
 
defš™iÚ
.

435 
m­_İ
[
İÇme
] = 
	$funùiÚ
(
·¿ms
)

436 
nÙ
 
·¿ms
 
th’
  
m·¿ms
, 
lšes
 
’d


437 -- 
PrÙeù
 
agaš¡
 
»cursive
 
maüo
 
švoÿtiÚ
.

438 
mac_aùive
[
İÇme
] 
th’
 
	`wçl
("»cursivmaüØšvoÿtiÚ"è
’d


439 
mac_aùive
[
İÇme
] = 
Œue


440 -- 
S‘up
 
sub¡™utiÚ
 
m­
.

441 
loÿl
 
sub¡
 = {
	}
}

442 
i
,
mp
 
š
 
	$aœs
(
m·¿ms
èdØ
sub¡
[
mp
] = 
·¿ms
[
i
] 
’d


443 
loÿl
 
mcom


444 
g_İt
.
maccomm’t
 
ªd
 g_İt.
comm’t
 
th’


445 
mcom
 = " MACRO "..
Çme
.." ("..#mparams..")"

446 
	`wcomm’t
("{"..
mcom
)

447 
’d


448 -- 
Loİ
 
through
 
®l
 
ÿ±u»d
 
¡©em’ts


449 
_
,
¡mt
 
š
 
	$aœs
(
lšes
) do

450 -- 
Sub¡™u‹
 
maüo
 
·¿m‘”s
.

451 
loÿl
 
¡
 = 
	`gsub
(
¡mt
, "[%w_]+", 
sub¡
)

452 
¡
 = 
	$defšesub¡
(
¡
)

453 
¡
 = 
	`gsub
(¡, "%s*%.%.%s*", ""è-- 
Tok’
 
·¡e
 
a
..
b
.

454 
mcom
 
ªd
 
	`sub
(
¡
, 1, 1è~ğ"|" 
th’
 
	$wcomm’t
(
¡
è
’d


455 -- 
Em™
 
¡©em’t
. 
U£
 
a
 
´Ùeùed
 
ÿÎ
 
b‘‹r
 
dŸgno¡ics
.

456 
loÿl
 
ok
, 
”r
 = 
	$pÿÎ
(
do¡mt
, 
¡
)

457 
nÙ
 
ok
 
th’


458 -- 
Add
 
the
 
ÿ±u»d
 
¡©em’t
 
to
h
”rÜ
.

459 
	`w´š‹¼
(
”r
, "\n", 
g_šd’t
, "| ", 
¡mt
,

460 "\t[MACRO ", 
Çme
, " (", #mparams, ")]\n")

461 
’d


462 
’d


463 
mcom
 
th’
 
	`wcomm’t
("}"..mcomè
’d


464 
mac_aùive
[
İÇme
] = 
n


465 
’d


466 
’d


467 
’d


469 -- 
An
 .
’dmaüo
 
p£udo
-
İcode
 
outside
 
of
 
a
 
maüo
 
defš™iÚ
 
is
 
ª
 
”rÜ
.

470 
m­_cÜeİ
[".’dmaüo_0"] = 
	$funùiÚ
(
·¿ms
)

471 
	`wçl
(".endmacro without .macro")

472 
’d


474 -- 
Dump
 
®l
 
maüos
 
ªd
 
theœ
 
	`cÚ‹Ás
 (
w™h
 -
PP
 
Úly
).

475 
loÿl
 
funùiÚ
 
	$dumpmaüos
(
out
, 
lvl
)

476 
	$sÜt
(
mac_li¡
)

477 
out
:
	`wr™e
("Macros:\n")

478 
_
,
İÇme
 
š
 
	$aœs
(
mac_li¡
) do

479 
loÿl
 
Çme
 = 
	`sub
(
İÇme
, 1, -3)

480 
loÿl
 
·¿ms
, 
lšes
 = 
m­_İ
[
İÇme
]()

481 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %s\n", 
Çme
, 
	`cÚÿt
(
·¿ms
, ", ")))

482 
lvl
 > 1 
th’


483 
_
,
lše
 
š
 
	$aœs
(
lšes
) do

484 
out
:
	`wr™e
(" |", 
lše
, "\n")

485 
’d


486 
out
:
	`wr™e
("\n")

487 
’d


488 
’d


489 
out
:
	`wr™e
("\n")

490 
’d


492 -- 
Check
 
unfšished
 
maüo
 
defš™iÚs
.

493 
loÿl
 
funùiÚ
 
	$checkmaüos
()

494 
mac_ÿ±u»
 
th’


495 
	`w´š‹¼
(
g_âame
, ":", 
mac_lš’o
,

496 ":ƒ¼Ü: unfšished .maüØ`", 
mac_Çme
 ,"'\n")

497 
’d


498 
’d


502 -- 
SuµÜt
 
v¬ŸbËs
 
ÿ±u»s
.

503 
loÿl
 
ÿp_lš’o
, 
ÿp_Çme


504 
loÿl
 
ÿp_bufãrs
 = {
	}
}

505 
loÿl
 
ÿp_u£d
 = {}

507 -- 
S¹
 
a
 
ÿ±u»
.

508 
m­_cÜeİ
[".ÿ±u»_1"] = 
	$funùiÚ
(
·¿ms
)

509 
nÙ
 
·¿ms
 
th’
  "Çme" 
’d


510 
	$wæush
()

511 
loÿl
 
Çme
 = 
·¿ms
[1]

512 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


513 
	`wçl
("bad c­tu»‚am`"..
Çme
.."'")

514 
’d


515 
ÿp_Çme
 
th’


516 
	`wçl
("®»ady c­turšgØ`"..
ÿp_Çme
.."' sšû†š"..
ÿp_lš’o
)

517 
’d


518 
ÿp_Çme
 = 
Çme


519 
ÿp_lš’o
 = 
g_lš’o


520 -- 
C»©e
 
Ü
  
a
 
ÿ±u»
 
bufãr
 
ªd
 
¡¬t
 
the
 
ouut
 
lše
 capture.

521 
loÿl
 
buf
 = 
ÿp_bufãrs
[
Çme
]

522 
nÙ
 
buf
 
th’
 buàğ{
	}
}; 
	gÿp_bufãrs
[
Çme
] = buà
’d


523 
g_ÿpbufãr
 = 
buf


524 
g_synşš’o
 = 0

525 
’d


527 -- 
Stİ
 
a
 
ÿ±u»
.

528 
m­_cÜeİ
[".’dÿ±u»_0"] = 
	$funùiÚ
(
·¿ms
)

529 
	$wæush
()

530 
nÙ
 
ÿp_Çme
 
th’
 
	`wçl
(".’dÿ±u» w™houˆ¨v®id .ÿ±u»"è
’d


531 
ÿp_Çme
 = 
n


532 
ÿp_lš’o
 = 
n


533 
g_ÿpbufãr
 = 
n


534 
g_synşš’o
 = 0

535 
’d


537 -- 
Dump
 
a
 
ÿ±u»
 
bufãr
.

538 
m­_cÜeİ
[".dumpÿ±u»_1"] = 
	$funùiÚ
(
·¿ms
)

539 
nÙ
 
·¿ms
 
th’
  "Çme" 
’d


540 
	$wæush
()

541 
loÿl
 
Çme
 = 
·¿ms
[1]

542 
nÙ
 
	`m©ch
(
Çme
, "^[%a_][%w_]*$"è
th’


543 
	`wçl
("bad c­tu»‚am`"..
Çme
.."'")

544 
’d


545 
ÿp_u£d
[
Çme
] = 
Œue


546 
	`wlše
(
	$funùiÚ
(
out
)

547 
loÿl
 
buf
 = 
ÿp_bufãrs
[
Çme
]

548 
buf
 
th’
 
	$wdum¶šes
(
out
, 
buf
è
’d


549 
’d
)

550 
g_synşš’o
 = 0

551 
’d


553 -- 
Dump
 
®l
 
ÿ±u»s
 
ªd
 
theœ
 
	`bufãrs
 (
w™h
 -
PP
 
Úly
).

554 
loÿl
 
funùiÚ
 
	$dumpÿ±u»s
(
out
, 
lvl
)

555 
out
:
	`wr™e
("Captures:\n")

556 
Çme
,
buf
 
š
 
	$·œs
(
ÿp_bufãrs
) do

557 
out
:
	`wr™e
(
	`fÜm©
(" %-20 %4s)\n", 
Çme
, "("..#buf))

558 
lvl
 > 1 
th’


559 
loÿl
 
b¬
 = 
	`»p
("=", 76)

560 
out
:
	`wr™e
(" ", 
b¬
, "\n")

561 
_
,
lše
 
š
 
	$aœs
(
buf
) do

562 
out
:
	`wr™e
(" ", 
lše
, "\n")

563 
’d


564 
out
:
	`wr™e
(" ", 
b¬
, "\n\n")

565 
’d


566 
’d


567 
out
:
	`wr™e
("\n")

568 
’d


570 -- 
Check
 
unfšished
 
Ü
 
unu£d
 
ÿ±u»s
.

571 
loÿl
 
funùiÚ
 
	$checkÿ±u»s
()

572 
ÿp_Çme
 
th’


573 
	`w´š‹¼
(
g_âame
, ":", 
ÿp_lš’o
,

574 ":ƒ¼Ü: unfšished .ÿ±u» `", 
ÿp_Çme
,"'\n")

576 
’d


577 
Çme
 
š
 
	$·œs
(
ÿp_bufãrs
) do

578 
nÙ
 
ÿp_u£d
[
Çme
] 
th’


579 
	`w´š‹¼
(
g_âame
, ":*:ƒ¼Ü: missšg .dumpÿ±u» ", 
Çme
 ,"\n")

580 
’d


581 
’d


582 
’d


586 -- 
SeùiÚs
 
Çmes
.

587 
loÿl
 
m­_£ùiÚs
 = {
	}
}

589 -- 
P£udo
-
İcode
 
to
 
defše
 
code
 
£ùiÚs
.

590 -- 
TODO
: 
D©a
 
£ùiÚs
, 
BSS
 
	g£ùiÚs
. 
N“ds
 
exŒa
 
C
 
code
 
ªd
 
	gAPI
.

591 
	gm­_cÜeİ
[".£ùiÚ_*"] = 
	$funùiÚ
(
·¿ms
)

592 
nÙ
 
·¿ms
 
th’
  "Çme..." 
’d


593 #m­_£ùiÚ > 0 
th’
 
	`w”rÜ
("du¶iÿ‹ seùiÚ defš™iÚ"è
’d


594 
	$wæush
()

595 
¢
,
Çme
 
š
 
	$aœs
(
·¿ms
) do

596 
loÿl
 
İÇme
 = "."..
Çme
.."_0"

597 
nÙ
 
	`m©ch
(
Çme
, "^[%a][%w_]*$"è
Ü


598 
m­_İ
[
İÇme
] 
Ü
 m­_İ["."..
Çme
.."_*"] 
th’


599 
	`w”rÜ
("bad seùiÚ‚am`"..
Çme
.."'")

600 
’d


601 
m­_£ùiÚs
[#m­_£ùiÚs+1] = 
Çme


602 
	`wlše
(
	`fÜm©
("#defšDASM_SECTION_%s\t%d", 
	`uµ”
(
Çme
), 
¢
-1))

603 
m­_İ
[
İÇme
] = 
	$funùiÚ
(
·¿ms
è
g_¬ch
.
	`£ùiÚ
(
¢
-1è
’d


604 
’d


605 
	`wlše
(
	`fÜm©
("#define DASM_MAXSECTION\t\t%d", #map_sections))

606 
’d


608 -- 
Dump
 
®l
 
£ùiÚs
.

609 
loÿl
 
funùiÚ
 
	$dump£ùiÚs
(
out
, 
lvl
)

610 
out
:
	`wr™e
("Sections:\n")

611 
_
,
Çme
 
š
 
	$aœs
(
m­_£ùiÚs
) do

612 
out
:
	`wr™e
(
	`fÜm©
(" %s\n", 
Çme
))

613 
’d


614 
out
:
	`wr™e
("\n")

615 
’d


619 -- 
R•Ïûm’t
 
cu¡omized
 
Lua
, 
which
 
Ïcks
 
the
 
·ckage
 
lib¿ry
.

620 
loÿl
 
´efix
 = ""

621 
nÙ
 
»quœe
 
th’


622 
funùiÚ
 
	$»quœe
(
Çme
)

623 
loÿl
 
å
 = 
	`as£¹
(
io
.
	`İ’
(
´efix
..
Çme
..".lua"))

624 
loÿl
 
s
 = 
å
:
	`»ad
("*a")

625 
	`as£¹
(
å
:
	$şo£
())

626  
	`as£¹
(
	`lßd¡ršg
(
s
, "@"..
Çme
..".lua"))()

627 
’d


628 
’d


630 -- 
Lßd
 
¬ch™eùu»
-
¥ecific
 
moduË
.

631 
loÿl
 
funùiÚ
 
	$lßd¬ch
(
¬ch
)

632 
nÙ
 
	`m©ch
(
¬ch
, "^[%w_]+$"è
th’
  "bad‡rch‚ame" 
’d


633 
loÿl
 
ok
, 
m_¬ch
 = 
	`pÿÎ
(
»quœe
, "dasm_"..
¬ch
)

634 
nÙ
 
ok
 
th’
  "ÿÂÙ†ßd moduË: "..
m_¬ch
 
’d


635 
g_¬ch
 = 
m_¬ch


636 
wæush
 = 
m_¬ch
.
	$·sscb
(
wlše
, 
w”rÜ
, 
wçl
, 
ww¬n
)

637 
m_¬ch
.
	$£tup
(
¬ch
, 
g_İt
)

638 
m­_İ
, 
m­_def
 = 
m_¬ch
.
	$m”gem­s
(
m­_cÜeİ
, 
m­_def
)

639 
’d


641 -- 
Dump
 
¬ch™eùu»
 
desütiÚ
.

642 
funùiÚ
 
İt_m­
.
	$dum·rch
(
¬gs
)

643 
loÿl
 
Çme
 = 
	$İ¬am
(
¬gs
)

644 
nÙ
 
g_¬ch
 
th’


645 
loÿl
 
”r
 = 
	$lßd¬ch
(
Çme
)

646 
”r
 
th’
 
	$İ‹¼Ü
(
”r
è
’d


647 
’d


649 
loÿl
 
t
 = {
	}
}

650 
Çme
 
š
 
	$·œs
(
m­_cÜeİ
èdØ
t
[#t+1] = 
Çme
 
’d


651 
Çme
 
š
 
	$·œs
(
m­_İ
èdØ
t
[#t+1] = 
Çme
 
’d


652 
	$sÜt
(
t
)

654 
loÿl
 
out
 = 
¡dout


655 
loÿl
 
_¬ch
 = 
g_¬ch
.
_šfo


656 
out
:
	`wr™e
(
	`fÜm©
("%s version %s,„eleased %s, %s\n",

657 
_šfo
.
Çme
, _šfo.
v”siÚ
, _šfo.
»Ëa£
, _šfo.
u¾
))

658 
g_¬ch
.
	$dum·rch
(
out
)

660 
loÿl
 
p£udo
 = 
Œue


661 
out
:
	`wr™e
("Pseudo-Opcodes:\n")

662 
_
,
¢ame
 
š
 
	$aœs
(
t
) do

663 
loÿl
 
Çme
, 
Å¬am
 = 
	`m©ch
(
¢ame
, "^(.+)_([0-9%*])$")

664 
Çme
 
th’


665 
p£udo
 
ªd
 
	`sub
(
Çme
, 1, 1è~ğ"." 
th’


666 
out
:
	`wr™e
("\nOpcodes:\n")

667 
p£udo
 = 
çl£


668 
’d


669 
loÿl
 
f
 = 
m­_İ
[
¢ame
]

670 
loÿl
 
s


671 
Å¬am
 ~ğ"*" 
th’
‚·¿m =‚·¿m + 0 
’d


672 
Å¬am
 =ğ0 
th’


673 
s
 = ""

674 
–£if
 
	`ty³
(
f
è=ğ"¡ršg" 
th’


675 
s
 = 
m­_İ
[".‹m¶©e__"](
n
, 
f
, 
Å¬am
)

677 
s
 = 
	$f
(
n
, 
Å¬am
)

678 
’d


679 
	`ty³
(
s
è=ğ"bË" 
th’


680 
_
,
s2
 
š
 
	$aœs
(
s
) do

681 
out
:
	`wr™e
(
	`fÜm©
(" %-12 %s\n", 
Çme
, 
s2
))

682 
’d


684 
out
:
	`wr™e
(
	`fÜm©
(" %-12 %s\n", 
Çme
, 
s
))

685 
’d


686 
’d


687 
’d


688 
out
:
	`wr™e
("\n")

689 
	$ex™
(0)

690 
’d


692 -- 
P£udo
-
İcode
 
to
 
£t
 
the
 
¬ch™eùu»
.

693 -- 
OÆy
 
š™ŸÎy
 
	`avaabË
 (
m­_İ
 
is
 
»¶aûd
 
wh’
 
ÿÎed
).

694 
m­_İ
[".¬ch_1"] = 
	$funùiÚ
(
·¿ms
)

695 
nÙ
 
·¿ms
 
th’
  "Çme" 
’d


696 
loÿl
 
”r
 = 
	$lßd¬ch
(
·¿ms
[1])

697 
”r
 
th’
 
	$wçl
(
”r
è
’d


698 
	`wlše
(
	`fÜm©
("#iàDASM_VERSION !ğ%d", 
_šfo
.
v”num
))

699 
	`wlše
('#error "Version mismatch between DynASM‡nd includedƒncodingƒngine"')

700 
	`wlše
("#endif")

701 
’d


703 -- 
Dummy
 .
¬ch
 
p£udo
-
İcode
 
to
 
im´ove
 
the
 
”rÜ
 
»pÜt
.

704 
m­_cÜeİ
[".¬ch_1"] = 
	$funùiÚ
(
·¿ms
)

705 
nÙ
 
·¿ms
 
th’
  "Çme" 
’d


706 
	`wçl
("duplicate .arch statement")

707 
’d


711 -- 
Dummy
 
p£udo
-
İcode
. 
DÚ
'ˆcÚfu£ '.
nİ
' with 'nop'.

712 
m­_cÜeİ
[".nİ_*"] = 
	$funùiÚ
(
·¿ms
)

713 
nÙ
 
·¿ms
 
th’
  "[ignÜed...]" 
’d


714 
’d


716 -- 
P£udo
-
İcodes
 
to
 
¿i£
 
”rÜs
.

717 
m­_cÜeİ
[".”rÜ_1"] = 
	$funùiÚ
(
·¿ms
)

718 
nÙ
 
·¿ms
 
th’
  "mes§ge" 
’d


719 
	$w”rÜ
(
·¿ms
[1])

720 
’d


722 
m­_cÜeİ
[".çl_1"] = 
	$funùiÚ
(
·¿ms
)

723 
nÙ
 
·¿ms
 
th’
  "mes§ge" 
’d


724 
	$wçl
(
·¿ms
[1])

725 
’d


727 -- 
Dump
 
®l
 
u£r
 
defšed
 
–em’ts
.

728 
loÿl
 
funùiÚ
 
	$dumpdef
(
out
)

729 
loÿl
 
lvl
 = 
g_İt
.
dumpdef


730 
lvl
 =ğ0 
th’
  
’d


731 
	$dump£ùiÚs
(
out
, 
lvl
)

732 
	$dumpdefšes
(
out
, 
lvl
)

733 
g_¬ch
 
th’
 g_¬ch.
	$dumpdef
(
out
, 
lvl
è
’d


734 
	$dumpmaüos
(
out
, 
lvl
)

735 
	$dumpÿ±u»s
(
out
, 
lvl
)

736 
’d


740 -- 
H–³r
 
¥l™¡mt
.

741 
loÿl
 
¥l™lvl


743 
loÿl
 
funùiÚ
 
	$¥l™¡mt_Úe
(
c
)

744 
c
 =ğ"(" 
th’


745 
¥l™lvl
 = ")"..splitlvl

746 
–£if
 
c
 =ğ"[" 
th’


747 
¥l™lvl
 = "]"..splitlvl

748 
–£if
 
c
 =ğ"{" 
th’


749 
¥l™lvl
 = "}"..splitlvl

750 
–£if
 
c
 =ğ")" 
Ü
 c =ğ"]" o¸ø=ğ"}" 
th’


751 
	`sub
(
¥l™lvl
, 1, 1è~ğ
c
 
th’
 
	`w”rÜ
("unb®ªûd (), [] o¸{}"è
’d


752 
¥l™lvl
 = 
	$sub
(
¥l™lvl
, 2)

753 
–£if
 
¥l™lvl
 =ğ"" 
th’


755 
’d


756  
c


757 
’d


759 -- 
S¶™
 
¡©em’t
 
	`što
 (
p£udo
-)
İcode
 
ªd
 
·¿ms
.

760 
loÿl
 
funùiÚ
 
	`¥l™¡mt
(
¡mt
)

761 -- 
CÚv”t
 
Ïb–
 
w™h
 
Œašg
-
cŞÚ
 
što
 .Ïb– 
¡©em’t
.

762 
loÿl
 
Ïb–
 = 
	`m©ch
(
¡mt
, "^%s*(.+):%s*$")

763 
Ïb–
 
th’
  ".Ïb–", {
	}
Ïb–} 
	g’d


765 -- 
S¶™
 
©
 
commas
 
ªd
 
equ®
 
	gsigns
, 
but
 
obey
 
·»Áhe£s
‡nd 
	gb¿ck‘s
.

766 
	g¥l™lvl
 = ""

767 
¡mt
 = 
gsub
(¡mt, "[,%(%)%[%]{}]", 
¥l™¡mt_Úe
)

768 
	g¥l™lvl
 ~ğ"" 
th’
 
w”rÜ
("unb®ªûd (èÜ []"è
’d


770 -- 
S¶™
 
off
 
İcode
.

771 
loÿl
 
İ
, 
	gÙh”
 = 
m©ch
(
¡mt
, "^%s*([^%s%z]+)%s*(.*)$")

772 
nÙ
 
İ
 
th’
 
w”rÜ
("bad s‹m’ˆsyÁax"è
	g’d


774 -- 
S¶™
 
	g·¿m‘”s
.

775 
loÿl
 
	g·¿ms
 = {}

776 
p
 
š
 
gm©ch
(
Ùh”
, "%s*(%Z+)%z?") do

777 
	g·¿ms
[#·¿ms+1] = 
gsub
(
p
, "%s+$", "")

778 
’d


779 #·¿m > 16 
th’
 
w”rÜ
("toØmªy…¬am‘”s"è
’d


781 
	g·¿ms
.
	gİ
 = 
İ


782  
İ
, 
·¿ms


783 
	g’d


785 -- 
Proûss
 
a
 
sšgË
 
	g¡©em’t
.

786 
	gdo¡mt
 = 
funùiÚ
(
¡mt
)

787 -- 
IgnÜe
 
em±y
 
¡©em’ts
.

788 
m©ch
(
¡mt
, "^%s*$"è
th’
  
	g’d


790 -- 
C­tu»
 
maüo
 
defs
 
befÜe
 
	gsub¡™utiÚ
.

791 
mac_ÿ±u»
 
th’
  
	$mac_ÿ±u»
(
¡mt
è
’d


792 
¡mt
 = 
	`defšesub¡
(stmt)

794 -- 
Em™
 
C
 
code
 
w™hout
 
·rsšg
 
the
 
lše
.

795 
	`sub
(
¡mt
, 1, 1è=ğ"|" 
th’


796 
loÿl
 

 = 
	$sub
(
¡mt
, 2)

797 
	$wæush
()

798 
	`sub
(

, 1, 2è=ğ"//" 
th’
 
	$wcomm’t
(

è
	$wlše
(

, 
Œue
è
’d


800 
’d


802 -- 
S¶™
 
	`što
 (
p£udo
-)
İcode
 
ªd
 
·¿ms
.

803 
loÿl
 
İ
, 
·¿ms
 = 
	`¥l™¡mt
(
¡mt
)

805 -- 
G‘
 
İcode
 
	`hªdËr
 (
m©chšg
 #oà
·¿m‘”s
 
Ü
 
g’”ic
 
hªdËr
).

806 
loÿl
 
f
 = 
m­_İ
[
İ
.."_"..#·¿ms] 
Ü
 map_op[op.."_*"]

807 
nÙ
 
f
 
th’


808 
nÙ
 
g_¬ch
 
th’
 
	`wçl
("fœ¡ s‹m’ˆmu¡ b.¬ch"è
’d


809 -- 
Im´ove
 
”rÜ
 
»pÜt
.

810 
i
=0,9 do

811 
m­_İ
[
İ
.."_"..
i
] 
th’


812 
	`w”rÜ
("wrÚg‚umb” oà·¿m‘” fÜ `"..
İ
.."'")

813 
’d


814 
’d


815 
	`w”rÜ
("unknowÀ¡©em’ˆ`"..
İ
.."'")

816 
’d


818 -- 
C®l
 
İcode
 
hªdËr
 
Ü
 
¥ecŸl
 hªdË¸
‹m¶©e
 
¡ršgs
.

819 
	`ty³
(
f
è=ğ"¡ršg" 
th’


820 
m­_İ
[".‹m¶©e__"](
·¿ms
, 
f
)

822 
	$f
(
·¿ms
)

823 
’d


824 
’d


826 -- 
Proûss
 
a
 
sšgË
 
lše
.

827 
loÿl
 
funùiÚ
 
	$dŞše
(
lše
)

828 
g_İt
.
æushlše
 
th’
 
	$wæush
(è
’d


830 -- 
As£mbËr
 
lše
?

831 
loÿl
 
šd’t
, 
®še
 = 
	`m©ch
(
lše
, "^(%s*)%|(.*)$")

832 
nÙ
 
®še
 
th’


833 -- 
No
, 
¶aš
 
C
 
code
 
lše
, 
Ãed
 
to
 
æush
 
fœ¡
.

834 
	$wæush
()

835 
	$wsync
()

836 
	$wlše
(
lše
, 
çl£
)

838 
’d


840 
g_šd’t
 = 
šd’t
 -- 
Rememb”
 
cu¼’t
 
lše
 
šd’tiÚ
.

842 -- 
Em™
 
C
 
	`code
 (
ev’
 
äom
 
maüos
). 
Avoids
 
echo
 
ªd
 
lše
 
·rsšg
.

843 
	`sub
(
®še
, 1, 1è=ğ"|" 
th’


844 
nÙ
 
mac_ÿ±u»
 
th’


845 
	$wsync
()

846 
–£if
 
g_İt
.
comm’t
 
th’


847 
	$wsync
()

848 
	$wcomm’t
(
®še
)

849 
’d


850 
	$do¡mt
(
®še
)

852 
’d


854 -- 
Echo
 
as£mbËr
 
lše
 
as
 
a
 
comm’t
.

855 
g_İt
.
comm’t
 
th’


856 
	$wsync
()

857 
	$wcomm’t
(
®še
)

858 
’d


860 -- 
SŒ
 
as£mbËr
 
comm’ts
.

861 
®še
 = 
	`gsub
(aline, "//.*$", "")

863 -- 
S¶™
 
lše
 
što
 
¡©em’ts
 
©
 
£micŞÚs
.

864 
	`m©ch
(
®še
, ";"è
th’


865 
¡mt
 
š
 
	`gm©ch
(
®še
, "[^;]+"èdØ
	$do¡mt
(
¡mt
è
’d


867 
	$do¡mt
(
®še
)

868 
’d


869 
’d


873 -- 
Wr™e
 
DynASM
 
h—d”
.

874 
loÿl
 
funùiÚ
 
	$dasmh—d
(
out
)

875 
out
:
	`wr™e
(
	$fÜm©
([[

883 ]], 
_šfo
.
u¾
,

884 
_šfo
.
v”siÚ
, 
g_¬ch
._šfo.
¬ch
, g_arch._info.version,

885 
g_âame
))

886 
’d


888 -- 
R—d
 
šput
 
fe
.

889 
»adfe
 = 
	$funùiÚ
(
fš
)

890 
g_šd’t
 = ""

891 
g_lš’o
 = 0

892 
g_synşš’o
 = -1

894 -- 
Proûss
 
®l
 
lšes
.

895 
lše
 
š
 
fš
:
	$lšes
() do

896 
g_lš’o
 = g_lineno + 1

897 
g_cu¾še
 = 
lše


898 
loÿl
 
ok
, 
”r
 = 
	$pÿÎ
(
dŞše
, 
lše
)

899 
nÙ
 
ok
 
ªd
 
	`w´š‹¼
(
”r
, "\n"è
th’
  
Œue
 
’d


900 
’d


901 
	`wæush
()

903 -- 
Clo£
 
šput
 
fe
.

904 
	`as£¹
(
fš
 =ğ
¡dš
 
Ü
 fš:
	$şo£
())

905 
’d


907 -- 
Wr™e
 
ouut
 
fe
.

908 
loÿl
 
funùiÚ
 
	$wr™efe
(
outfe
)

909 
loÿl
 
fout


911 -- 
O³n
 
ouut
 
fe
.

912 
outfe
 =ğ
n
 
Ü
 outf=ğ"-" 
th’


913 
fout
 = 
¡dout


915 
fout
 = 
	`as£¹
(
io
.
	`İ’
(
outfe
, "w"))

916 
’d


918 -- 
Wr™e
 
®l
 
bufã»d
 
lšes


919 
	`wdum¶šes
(
fout
, 
g_wbufãr
)

921 -- 
Clo£
 
ouut
 
fe
.

922 
	`as£¹
(
fout
 =ğ
¡dout
 
Ü
 fout:
	`şo£
())

924 -- 
O±iÚ®ly
 
dump
 
defš™iÚs
.

925 
	$dumpdef
(
fout
 =ğ
¡dout
 
ªd
 
¡d”r
 
Ü
 stdout)

926 
’d


928 -- 
T¿n¦©e
 
ª
 
šput
 
fe
 
to
‡À
ouut
 file.

929 
loÿl
 
funùiÚ
 
	$Œª¦©e
(
šfe
, 
outfe
)

930 
g_wbufãr
 = {
	}
}

931 
g_šd’t
 = ""

932 
g_lš’o
 = 0

933 
g_synşš’o
 = -1

935 -- 
Put
 
h—d”
.

936 
wlše
(
dasmh—d
)

938 -- 
R—d
 
šput
 
fe
.

939 
loÿl
 
fš


940 
šfe
 =ğ"-" 
th’


941 
g_âame
 = "(stdin)"

942 
fš
 = 
¡dš


944 
g_âame
 = 
šfe


945 
fš
 = 
as£¹
(
io
.
İ’
(
šfe
, "r"))

946 
’d


947 
»adfe
(
fš
)

949 -- 
Check
 
	g”rÜs
.

950 
nÙ
 
g_¬ch
 
th’


951 
w´š‹¼
(
g_âame
, ":*:ƒrror: missing .arch directive\n")

952 
’d


953 
	$checkcÚds
()

954 
	$checkmaüos
()

955 
	$checkÿ±u»s
()

957 
g_”rcouÁ
 ~ğ0 
th’


958 
¡d”r
:
	`wr™e
(
g_âame
, ":*: info: ", 
g_”rcouÁ
, "ƒrror",

959 (
	`ty³
(
g_”rcouÁ
è=ğ"numb”" 
ªd
 g_”rcouÁ > 1èªd "s" 
Ü
 "",

961 
	$dumpdef
(
¡d”r
)

962 
	$ex™
(1)

963 
’d


965 -- 
Wr™e
 
ouut
 
fe
.

966 
	$wr™efe
(
outfe
)

967 
’d


971 -- 
Pršt
 
h–p
 
‹xt
.

972 
funùiÚ
 
İt_m­
.
	$h–p
()

973 
¡dout
:
	`wr™e
("DynASM -- ", 
_šfo
.
desütiÚ
, ".\n")

974 
¡dout
:
	`wr™e
("DynASM ", 
_šfo
.
v”siÚ
, " ", _šfo.
»Ëa£
, " ", _šfo.
u¾
, "\n")

975 
¡dout
:
wr™e
[[

977 
U§ge
: 
dyÇsm
 [
OPTION
]... 
INFILE
.
dasc
|-

979 -
h
, --
h–p
 
Di¥Ïy
 
this
 h–°
‹xt
.

980 -
V
, --
v”siÚ
 
Di¥Ïy
 v”siÚ 
ªd
 
cİyright
 
šfÜm©iÚ
.

982 -
o
, --
outfe
 
FILE
 
Ouut
 
fe
 
	`Çme
 ( 
is
 
¡dout
).

983 -
I
, --
šşude
 
DIR
 
Add
 
dœeùÜy
 
to
 
the
 inşud
£¬ch
 
·th
.

985 -
c
, --
ccomm’t
 
U£
 
comm’ts
 
as£mbËr
 
lšes
.

986 -
C
, --
ıpcomm’t
 
U£


987 -
N
, --
nocomm’t
 
Suµ»ss
 
as£mbËr
 
lšes
 
š
 
ouut
.

988 -
M
, --
maccomm’t
 
Show
 
maüo
 
ex·nsiÚs
 
as
 
	`comm’ts
 ( 
off
).

990 -
L
, --
nŞš’o
 
Suµ»ss
 
CPP
 
lše
 
numb”
 
šfÜm©iÚ
 
š
 
ouut
.

991 -
F
, --
æushlše
 
Flush
 
aùiÚ
 
li¡
 
ev”y
 
lše
.

993 -
D
 
NAME
[=
SUBST
] 
Defše
 
a
 
sub¡™utiÚ
.

994 -
U
 
NAME
 
Undefše
 
a
 
sub¡™utiÚ
.

996 -
P
, --
dumpdef
 
Dump
 
defšes
, 
maüos
, 
‘c
. 
R•—t
 
mÜe
 
ouut
.

997 -
A
, --
dum·rch
 
ARCH
 
Lßd
 
¬ch™eùu»
 ARCH 
ªd
 
dump
 
desütiÚ
.

999 
	$ex™
(0)

1000 
’d


1002 -- 
Pršt
 
v”siÚ
 
šfÜm©iÚ
.

1003 
funùiÚ
 
İt_m­
.
	$v”siÚ
()

1004 
¡dout
:
	`wr™e
(
	`fÜm©
("%s version %s,„eleased %s\n%s\n\n%s",

1005 
_šfo
.
Çme
, _šfo.
v”siÚ
, _šfo.
»Ëa£
, _šfo.
u¾
, _šfo.
cİyright
))

1006 
	$ex™
(0)

1007 
’d


1009 -- 
Misc
. 
İtiÚs
.

1010 
funùiÚ
 
İt_m­
.
	$outfe
(
¬gs
è
g_İt
.
outfe
 = 
	$İ¬am
(
¬gs
è
’d


1011 
funùiÚ
 
İt_m­
.
	$šşude
(
¬gs
è
	`š£¹
(
g_İt
.
šşude
, 1, 
	$İ¬am
(
¬gs
)è
’d


1012 
funùiÚ
 
İt_m­
.
	$ccomm’t
(è
g_İt
.
comm’t
 = "/*|"; g_İt.
’dcomm’t
 = " */" 
’d


1013 
funùiÚ
 
İt_m­
.
	$ıpcomm’t
(è
g_İt
.
comm’t
 = "//|"; g_İt.
’dcomm’t
 = "" 
’d


1014 
funùiÚ
 
İt_m­
.
	$nocomm’t
(è
g_İt
.
comm’t
 = 
çl£
 
’d


1015 
funùiÚ
 
İt_m­
.
	$maccomm’t
(è
g_İt
.
maccomm’t
 = 
Œue
 
’d


1016 
funùiÚ
 
İt_m­
.
	$nŞš’o
(è
g_İt
.
ıp
 = 
çl£
 
’d


1017 
funùiÚ
 
İt_m­
.
	$æushlše
(è
g_İt
.
æushlše
 = 
Œue
 
’d


1018 
funùiÚ
 
İt_m­
.
	$dumpdef
(è
g_İt
.
dumpdef
 = g_İt.dumpdeà+ 1 
’d


1022 -- 
ShÜt
 
®Ÿ£s
 
İtiÚs
.

1023 
loÿl
 
İt_®Ÿs
 = {

1024 
h
 = "h–p", ["?"] = "h–p", 
V
 = "version",

1025 
o
 = "outfe", 
I
 = "include",

1026 
c
 = "ccomm’t", 
C
 = "ıpcomm’t", 
N
 = "nocomm’t", 
M
 = "maccomment",

1027 
L
 = "nŞš’o", 
F
 = "flushline",

1028 
P
 = "dumpdef", 
A
 = "dumparch",

1029 
	}
}

1031 -- 
P¬£
 
sšgË
 
	gİtiÚ
.

1032 
loÿl
 
funùiÚ
 
	$·r£İt
(
İt
, 
¬gs
)

1033 
İt_cu¼’t
 = #İˆ=ğ1 
ªd
 "-"..
İt
 
Ü
 "--"..opt

1034 
loÿl
 
f
 = 
İt_m­
[
İt
] 
Ü
 o±_m­[
İt_®Ÿs
[opt]]

1035 
nÙ
 
f
 
th’


1036 
	`İ‹¼Ü
("uÄecognized o±iÚ `", 
İt_cu¼’t
, "'. Try `--help'.\n")

1037 
’d


1038 
	$f
(
¬gs
)

1039 
’d


1041 -- 
P¬£
 
¬gum’ts
.

1042 
loÿl
 
funùiÚ
 
	`·r£¬gs
(
¬gs
)

1043 -- 
DeçuÉ
 
İtiÚs
.

1044 
g_İt
.
comm’t
 = "//|"

1045 
g_İt
.
’dcomm’t
 = ""

1046 
g_İt
.
ıp
 = 
Œue


1047 
g_İt
.
dumpdef
 = 0

1048 
g_İt
.
šşude
 = { "" 
	}
}

1050 -- 
Proûss
 
®l
 
İtiÚ
 
¬gum’ts
.

1051 
¬gs
.
¬gn
 = 1

1052 
»³©


1053 
loÿl
 
a
 = 
¬gs
[¬gs.
¬gn
]

1054 
nÙ
 
a
 
th’
  
’d


1055 
loÿl
 
lİt
, 
	gİt
 = 
m©ch
(
a
, "^%-(%-?)(.+)")

1056 
nÙ
 
İt
 
th’
  
’d


1057 
	g¬gs
.
	g¬gn
 = 
¬gs
.
¬gn
 + 1

1058 
lİt
 =ğ"" 
th’


1059 -- 
Loİ
 
through
 
İtiÚs
.

1060 
o
 
š
 
gm©ch
(
İt
, "."èdØ
	$·r£İt
(
o
, 
¬gs
è
’d


1062 -- 
LÚg
 
İtiÚ
.

1063 
	$·r£İt
(
İt
, 
¬gs
)

1064 
’d


1065 
uÁ
 
çl£


1067 -- 
Check
 
´İ”
 
numb”
 
of
 
¬gum’ts
.

1068 
loÿl
 
Çrgs
 = #¬g - 
¬gs
.
¬gn
 + 1

1069 
Çrgs
 ~ğ1 
th’


1070 
Çrgs
 =ğ0 
th’


1071 
g_İt
.
dumpdef
 > 0 
th’
  
	$dumpdef
(
¡dout
è
’d


1072 
’d


1073 
İt_m­
.
	$h–p
()

1074 
’d


1076 -- 
T¿n¦©e
 
a
 
sšgË
 
šput
 
fe
 
to
‡ sšgË 
ouut
 file

1077 -- 
TODO
: 
HªdË
 
muÉË
 
fes
?

1078 
	$Œª¦©e
(
¬gs
[¬gs.
¬gn
], 
g_İt
.
outfe
)

1079 
’d


1083 -- 
Add
 
the
 
dœeùÜy
 
dyÇsm
.
lua
 
»sides
 
š
 
to
h
Lua
 
moduË
 
£¬ch
 
·th
.

1084 
loÿl
 
¬g
 =‡rg

1085 
¬g
 
ªd
‡rg[0] 
th’


1086 
´efix
 = 
	`m©ch
(
¬g
[0], "^(.*[/\\])")

1087 
·ckage
 
ªd
 
´efix
 
th’
…ackage.
·th
 =…»fix.."?.lua;"..·ckage.·th 
’d


1088 
’d


1090 -- 
S¹
 
DynASM
.

1091 
·r£¬gs
{...
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/host/genlibbc.lua

2 -- 
Lua
 
süt
 
to
 
dump
 
the
 
by‹code
 
of
h
lib¿ry
 
funùiÚs
 
wr™‹n
 
š
 
	gLua
.

3 -- 
The
 
	g»suÉšg
 'budvm_libbc.h' 
is
 
u£d
 
the
 
bud
 
´oûss
 
of
 
	gLuaJIT
.

5 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

6 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


9 
loÿl
 
	gffi
 = 
»quœe
("ffi")

10 
loÿl
 
b™
 = 
»quœe
("bit")

11 
loÿl
 
vmdef
 = 
»quœe
("jit.vmdef")

12 
loÿl
 
búames
 = 
vmdef
.bcnames

14 
loÿl
 
fÜm©
 = 
¡ršg
.format

16 
loÿl
 
isbe
 = (
¡ršg
.
by‹
(¡ršg.
dump
(
	$funùiÚ
(è
’d
), 5) % 2 == 1)

18 
loÿl
 
funùiÚ
 
	$u§ge
(
¬g
)

19 
io
.
¡d”r
:
	`wr™e
("U§ge: ", 
¬g
 
ªd
‡rg[0] 
Ü
 "genlibbc",

21 
os
.
	$ex™
(1)

22 
’d


24 
loÿl
 
funùiÚ
 
	$·r£_¬g
(
¬g
)

25 
loÿl
 
outfe
 = "-"

26 
	$nÙ
 (
¬g
 
ªd
‡rg[1]è
th’


27 
	$u§ge
(
¬g
)

28 
’d


29 
¬g
[1] =ğ"-o" 
th’


30 
outfe
 = 
¬g
[2]

31 
nÙ
 
outfe
 
th’
 
	$u§ge
(
¬g
è
’d


32 
bË
.
	$»move
(
¬g
, 1)

33 
bË
.
	$»move
(
¬g
, 1)

34 
’d


35  
outfe


36 
’d


38 
loÿl
 
funùiÚ
 
	$»ad_fes
(
Çmes
)

39 
loÿl
 
¤c
 = ""

40 
_
,
Çme
 
š
 
	$aœs
(
Çmes
) do

41 
loÿl
 
å
 = 
	`as£¹
(
io
.
	$İ’
(
Çme
))

42 
¤c
 = srø.. 
å
:
	`»ad
("*a")

43 
å
:
	$şo£
()

44 
’d


45  
¤c


46 
’d


48 
loÿl
 
funùiÚ
 
	$ŒªsfÜm_lua
(
code
)

49 
loÿl
 
fixup
 = {
	}
}

50 
loÿl
 
n
 = -30000

51 
code
 = 
¡ršg
.
gsub
(code, "CHECK_(%w*)%((.-)%)", 
	$funùiÚ
(

, 
v¬
)

52 
n
 =‚ + 1

53 
fixup
[
n
] = { "CHECK", 

 
	}
}

54  
fÜm©
("%s=%d", 
v¬
, 
n
)

55 
’d
)

56 
	gcode
 = 
¡ršg
.
gsub
(
code
, "PAIRS%((.-)%)", 
	$funùiÚ
(
v¬
)

57 
fixup
.
PAIRS
 = 
Œue


58  
	`fÜm©
("n, %s, 0", 
v¬
)

59 
’d
)

60  "»tuº "..
code
, 
fixup


61 
’d


63 
loÿl
 
funùiÚ
 
	$»ad_uËb128
(
p
)

64 
loÿl
 
v
 = 
p
[0];… =… + 1

65 
v
 >ğ128 
th’


66 
loÿl
 
sh
 = 7; 
v
 = v - 128

67 
»³©


68 
loÿl
 
r
 = 
p
[0]

69 
v
 = v + 
b™
.
	`lshiá
(b™.
	`bªd
(
r
, 127), 
sh
)

70 
sh
 = sh + 7

71 
p
 =… + 1

72 
uÁ
 
r
 < 128

73 
’d


74  
p
, 
v


75 
’d


77 -- 
ORDER
 
LJ_T


78 
loÿl
 
Çme2™y³
 = {

79 
¡r
 = 5, 
func
 = 9, 
b
 = 12, ğ14, 
num
 = 15

80 
	}
}

82 
loÿl
 
	gBC
 = {}

83 
i
=0,#bcnames/6-1 do

84 
	gBC
[
¡ršg
.
gsub
(¡ršg.
sub
(
búames
, 
i
*6+1, i*6+6), " ", "")] = i

85 
’d


86 
loÿl
 
xİ
, 
	gx¿
 = 
isbe
 
ªd
 3 
Ü
 0, isb
	gªd
 2 
	gÜ
 1

87 
loÿl
 
	gxrc
, 
	gxrb
 = 
isbe
 
ªd
 1 
Ü
 2, isb
	gªd
 0 
	gÜ
 3

89 
loÿl
 
funùiÚ
 
	$fixup_dump
(
dump
, 
fixup
)

90 
loÿl
 
buf
 = 
ffi
.
	`Ãw
("ušt8_t[?]", #dump+1, 
dump
)

91 
loÿl
 
p
 = 
buf
+5

92 
loÿl
 
n
, 
sizebc


93 
p
, 
n
 = 
	$»ad_uËb128
(
p
)

94 
loÿl
 
¡¬t
 = 
p


95 
p
 =… + 4

96 
p
 = 
	$»ad_uËb128
(
p
)

97 
p
 = 
	$»ad_uËb128
(
p
)

98 
p
, 
sizebc
 = 
	$»ad_uËb128
(
p
)

99 
loÿl
 
¿wb
 = {
	}
}

100 
i
=0,
	gsizebc
-1 do

101 
loÿl
 
	gİ
 = 
p
[
xİ
]

102 
İ
 =ğ
BC
.
KSHORT
 
th’


103 
loÿl
 
rd
 = 
p
[
xrc
] + 256*p[
xrb
]

104 
rd
 = 
b™
.
¬shiá
(b™.
lshiá
(rd, 16), 16)

105 
loÿl
 
	gf
 = 
fixup
[
rd
]

106 
f
 
th’


107 
f
[1] =ğ"CHECK" 
th’


108 
loÿl
 

 = 
f
[2]

109 

 =ğ"b" 
th’
 
¿wb
[
p
[
x¿
]] = 
Œue
 
’d


110 
p
[
xİ
] = 

 =ğ"num" 
ªd
 
BC
.
ISNUM
 
Ü
 BC.
ISTYPE


111 
p
[
xrb
] = 0

112 
p
[
xrc
] = 
Çme2™y³
[

]

114 
”rÜ
("unhªdËd fixu°ty³: "..
f
[1])

115 
’d


116 
’d


117 
–£if
 
İ
 =ğ
BC
.
TGETV
 
th’


118 
¿wb
[
p
[
xrb
]] 
th’


119 
p
[
xİ
] = 
BC
.
TGETR


120 
’d


121 
–£if
 
İ
 =ğ
BC
.
TSETV
 
th’


122 
¿wb
[
p
[
xrb
]] 
th’


123 
p
[
xİ
] = 
BC
.
TSETR


124 
’d


125 
–£if
 
İ
 =ğ
BC
.
ITERC
 
th’


126 
fixup
.
PAIRS
 
th’


127 
p
[
xİ
] = 
BC
.
ITERN


128 
’d


129 
’d


130 
p
 =… + 4

131 
’d


132  
ffi
.
	$¡ršg
(
¡¬t
, 
n
)

133 
’d


135 
loÿl
 
funùiÚ
 
	$fšd_defs
(
¤c
)

136 
loÿl
 
defs
 = {
	}
}

137 
Çme
, 
code
 
š
 
	g¡ršg
.
gm©ch
(
¤c
, "LJLIB_LUA%(([^)]*)%)%s*/%*(.-)%*/") do

138 
loÿl
 
	g’v
 = {}

139 
loÿl
 
tcode
, 
	gfixup
 = 
	$ŒªsfÜm_lua
(
code
)

140 
loÿl
 
func
 = 
	`as£¹
(
	`lßd
(
tcode
, "", 
n
, 
’v
))()

141 
defs
[
Çme
] = 
	`fixup_dump
(
¡ršg
.
	`dump
(
func
, 
Œue
), 
fixup
)

142 
defs
[#defs+1] = 
Çme


143 
’d


144  
defs


145 
’d


147 
loÿl
 
funùiÚ
 
	$g’_h—d”
(
defs
)

148 
loÿl
 
t
 = {
	}
}

149 
loÿl
 
funùiÚ
 
	$w
(
x
è
t
[#t+1] = x 
’d


150 
	`w
("/* This is‡ generated file. DO NOT EDIT! */\n\n")

151 
	`w
("¡©iøcÚ¡ iÁ†ibbc_’dŸÀğ"è
	$w
(
isbe
 
ªd
 1 
Ü
 0è
	`w
(";\n\n")

152 
loÿl
 
s
 = ""

153 
_
,
Çme
 
š
 
	$aœs
(
defs
) do

154 
s
 = s .. 
defs
[
Çme
]

155 
’d


156 
	`w
("static const uint8_t†ibbc_code[] = {\n")

157 
loÿl
 
n
 = 0

158 
i
=1,#s do

159 
loÿl
 
x
 = 
¡ršg
.
	$by‹
(
s
, 
i
)

160 
	`w
(
x
); w(",")

161 
n
 =‚ + (
x
 < 10 
ªd
 2 
	`Ü
 (x < 100‡nd 3 
Ü
 4))

162 
n
 >ğ75 
th’
‚ = 0; 
	`w
("\n"è
’d


163 
’d


164 
	`w
("0\n};\n\n")

165 
	`w
("static const struct { const char *name; int ofs; }†ibbc_map[] = {\n")

166 
loÿl
 
m
 = 0

167 
_
,
Çme
 
š
 
	$aœs
(
defs
) do

168 
	`w
('{"'); w(
Çme
); w('",'); 
	$w
(
m
è
	`w
('},\n')

169 
m
 = m + #defs[
Çme
]

170 
’d


171 
	`w
("{NULL,"); w(
m
); w("}\n};\n\n")

172  
bË
.
	$cÚÿt
(
t
)

173 
’d


175 
loÿl
 
funùiÚ
 
	$wr™e_fe
(
Çme
, 
d©a
)

176 
Çme
 =ğ"-" 
th’


177 
	`as£¹
(
io
.
	$wr™e
(
d©a
))

178 
	`as£¹
(
io
.
	$æush
())

180 
loÿl
 
å
 = 
io
.
	$İ’
(
Çme
)

181 
å
 
th’


182 
loÿl
 
Şd
 = 
å
:
	`»ad
("*a")

183 
å
:
	$şo£
()

184 
d©a
 =ğ
Şd
 
th’
  
’d


185 
’d


186 
å
 = 
	`as£¹
(
io
.
	`İ’
(
Çme
, "w"))

187 
	`as£¹
(
å
:
	$wr™e
(
d©a
))

188 
	`as£¹
(
å
:
	$şo£
())

189 
’d


190 
’d


192 
loÿl
 
outfe
 = 
	$·r£_¬g
(
¬g
)

193 
loÿl
 
¤c
 = 
	$»ad_fes
(
¬g
)

194 
loÿl
 
defs
 = 
	$fšd_defs
(
¤c
)

195 
loÿl
 
hdr
 = 
	$g’_h—d”
(
defs
)

196 
	`wr™e_fe
(
outfe
, 
hdr
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/host/genminilua.lua

2 -- 
Lua
 
süt
 
to
 
g’”©e
 
a
 
	gcu¡omized
, 
mšif›d
 
v”siÚ
 
of
 
	gLua
.

3 -- 
The
 
	g»suÉšg
 'mšua' 
is
 
u£d
 
the
 
bud
 
´oûss
 
of
 
	gLuaJIT
.

5 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

6 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


9 
loÿl
 
	gsub
, 
	gm©ch
, 
	ggsub
 = 
¡ršg
.
sub
, 
	g¡ršg
.m©ch, sŒšg.
gsub


11 
loÿl
 
	gLUA_VERSION
 = "5.1.5"

12 
loÿl
 
LUA_SOURCE


14 
loÿl
 
funùiÚ
 
	$u§ge
()

15 
io
.
¡d”r
:
	`wr™e
("U§ge: ", 
¬g
 
ªd
‡rg[0] 
Ü
 "genminilua",

16 "†ua-", 
LUA_VERSION
, "-source-dir\n")

17 
os
.
	$ex™
(1)

18 
’d


20 
loÿl
 
funùiÚ
 
	$fšd_sourûs
()

21 
LUA_SOURCE
 = 
¬g
 
ªd
‡rg[1]

22 
nÙ
 
LUA_SOURCE
 
th’
 
	$u§ge
(è
’d


23 
	`sub
(
LUA_SOURCE
, -1è~ğ"/" 
th’
 LUA_SOURCE = LUA_SOURCE.."/" 
’d


24 
loÿl
 
å
 = 
io
.
	`İ’
(
LUA_SOURCE
 .. "lua.h")

25 
nÙ
 
å
 
th’


26 
LUA_SOURCE
 = LUA_SOURCE.."src/"

27 
å
 = 
io
.
	`İ’
(
LUA_SOURCE
 .. "lua.h")

28 
nÙ
 
å
 
th’
 
	$u§ge
(è
’d


29 
’d


30 
loÿl
 
®l
 = 
å
:
	`»ad
("*a")

31 
å
:
	$şo£
()

32 
nÙ
 
	`m©ch
(
®l
, 'LUA_RELEASE%s*"Lu¨'..
LUA_VERSION
..'"'è
th’


33 
io
.
¡d”r
:
	`wr™e
("Error: version mismatch\n")

34 
	$u§ge
()

35 
’d


36 
’d


38 
loÿl
 
LUA_FILES
 = {

43 
	}
}

45 
loÿl
 
REMOVE_LIB
 = {}

46 
gsub
([[

47 
cŞËùg¬bage
 
dofe
 
gcšfo
 
g‘ãnv
 
g‘m‘©abË
 
lßd
 
´št
 
¿wequ®
 
¿w£t


48 
£Ëù
 
to¡ršg
 
xpÿÎ


49 
fÜ—ch
 
fÜ—chi
 
g‘n
 
maxn
 
£Š


50 
pİ’
 
tmpfe
 
£ek
 
£tvbuf
 
__to¡ršg


51 
şock
 
d©e
 
difáime
 
execu‹
 
g‘’v
 
»Çme
 
£oÿË
 
time
 
tm²ame


52 
dump
 
gfšd
 
Ën
 
»v”£


53 
LUA_LOADLIBNAME
 
LUA_MATHLIBNAME
 
LUA_DBLIBNAME


54 ]], "%S+", 
	$funùiÚ
(
Çme
)

55 
REMOVE_LIB
[
Çme
] = 
Œue


56 
’d
)

58 
loÿl
 
REMOVE_EXTINC
 = { ["<as£¹.h>"] = 
Œue
, ["<loÿË.h>"] =rue, 
	}
}

60 
loÿl
 
	gCUSTOM_MAIN
 = [[

61 
UB
;

62 
UB
 
	$b¬g
(
lua_S‹
 *
L
,
idx
){

63 uniÚ{
lua_Numb”
 
n
;
U64
 
b
;}
bn
;

64 
bn
.
n
=
	`lua_tÚumb”
(
L
,
idx
)+6755399441055744.0;

65 ià(
bn
.
n
==0.0&&!
	`lua_i¢umb”
(
L
,
idx
))
	`luaL_ty³¼Ü
(L,idx,"number");

66 (
UB
)
bn
.
b
;

67 
	}
}

68 
	#BRET
(
b
è
	`lua_pushnumb”
(
L
,(
lua_Numb”
)()(b)); 1;

	)

69 
	$tob™
(
lua_S‹
 *
L
){

70 
	`BRET
(
	`b¬g
(
L
,1))
	}
}

71 
	$bnÙ
(
lua_S‹
 *
L
){

72 
	`BRET
(~
	`b¬g
(
L
,1))
	}
}

73 
	$bªd
(
lua_S‹
 *
L
){

74 
i
;
UB
 
b
=
	`b¬g
(
L
,1);i=
	`lua_g‘tİ
(L);i>1;i--)b&=b¬g(L,i);
	`BRET
(b)
	}
}

75 
	$bÜ
(
lua_S‹
 *
L
){

76 
i
;
UB
 
b
=
	`b¬g
(
L
,1);i=
	`lua_g‘tİ
(L);i>1;i--)b|=b¬g(L,i);
	`BRET
(b)
	}
}

77 
	$bxÜ
(
lua_S‹
 *
L
){

78 
i
;
UB
 
b
=
	`b¬g
(
L
,1);i=
	`lua_g‘tİ
(L);i>1;i--)b^=b¬g(L,i);
	`BRET
(b)
	}
}

79 
	$lshiá
(
lua_S‹
 *
L
){

80 
UB
 
b
=
	`b¬g
(
L
,1),
n
=b¬g(L,2)&31;
	`BRET
(b<<n)
	}
}

81 
	$rshiá
(
lua_S‹
 *
L
){

82 
UB
 
b
=
	`b¬g
(
L
,1),
n
=b¬g(L,2)&31;
	`BRET
(b>>n)
	}
}

83 
	$¬shiá
(
lua_S‹
 *
L
){

84 
UB
 
b
=
	`b¬g
(
L
,1),
n
=b¬g(L,2)&31;
	`BRET
(()b>>n)
	}
}

85 
	$rŞ
(
lua_S‹
 *
L
){

86 
UB
 
b
=
	`b¬g
(
L
,1),
n
=b¬g(L,2)&31;
	`BRET
((b<<n)|(b>>(32-n)))
	}
}

87 
	$rÜ
(
lua_S‹
 *
L
){

88 
UB
 
b
=
	`b¬g
(
L
,1),
n
=b¬g(L,2)&31;
	`BRET
((b>>n)|(b<<(32-n)))
	}
}

89 
	$bsw­
(
lua_S‹
 *
L
){

90 
UB
 
b
=
	`b¬g
(
L
,1);b=(b>>24)|((b>>8)&0xff00)|((b&0xff00)<<8)|(b<<24);
	`BRET
(b)
	}
}

91 
	$tohex
(
lua_S‹
 *
L
){

92 
UB
 
b
=
	`b¬g
(
L
,1);

93 
n
=
	`lua_i¢Úe
(
L
,2)?8:()
	`b¬g
(L,2);

94 cÚ¡ *
hexdig™s
="0123456789abcdef";

95 
buf
[8];

96 
i
;

97 if(
n
<0){n=-n;
hexdig™s
="0123456789ABCDEF";}

98 if(
n
>8)n=8;

99 
i
=()
n
;--i>=0;){
buf
[i]=
hexdig™s
[
b
&15];b>>=4;}

100 
	`lua_pushl¡ršg
(
L
,
buf
,(
size_t
)
n
);

102 
	}
}

103 cÚ¡ 
luaL_Reg
 
	gb™lib
[] = {

104 {"tob™",
tob™
},

105 {"bnÙ",
bnÙ
},

106 {"bªd",
bªd
},

107 {"bÜ",
bÜ
},

108 {"bxÜ",
bxÜ
},

109 {"lshiá",
lshiá
},

110 {"rshiá",
rshiá
},

111 {"¬shiá",
¬shiá
},

112 {"rŞ",
rŞ
},

113 {"rÜ",
rÜ
},

114 {"bsw­",
bsw­
},

115 {"tohex",
tohex
},

116 {
NULL
,NULL}

118 
	$maš
(
¬gc
, **
¬gv
){

119 
lua_S‹
 *
L
 = 
	`luaL_Ãw¡©e
();

120 
i
;

121 
	`luaL_İ’libs
(
L
);

122 
	`luaL_»gi¡”
(
L
, "b™", 
b™lib
);

123 ià(
¬gc
 < 2)  (*);

124 
	`lua_ü—‹bË
(
L
, 0, 1);

125 
	`lua_push¡ršg
(
L
, 
¬gv
[1]);

126 
	`lua_¿w£ti
(
L
, -2, 0);

127 
	`lua_£tglob®
(
L
, "arg");

128 ià(
	`luaL_lßdfe
(
L
, 
¬gv
[1]))

129 
”r
;

130 
i
 = 2; i < 
¬gc
; i++)

131 
	`lua_push¡ršg
(
L
, 
¬gv
[
i
]);

132 ià(
	`lua_pÿÎ
(
L
, 
¬gc
 - 2, 0, 0)) {

133 
”r
:

134 
	`årštf
(
¡d”r
, "E¼Ü: %s\n", 
	`lua_to¡ršg
(
L
, -1));

137 
	`lua_şo£
(
L
);

139 
	}
}

142 
loÿl
 
funùiÚ
 
	$»ad_sourûs
()

143 
loÿl
 
t
 = {
	}
}

144 
i
, 
Çme
 
š
 
	$aœs
(
LUA_FILES
) do

145 
loÿl
 
å
 = 
	`as£¹
(
io
.
	`İ’
(
LUA_SOURCE
..
Çme
, "r"))

146 
t
[
i
] = 
å
:
	`»ad
("*a")

147 
	`as£¹
(
å
:
	$şo£
())

148 
’d


149 
t
[#t+1] = 
CUSTOM_MAIN


150  
bË
.
	$cÚÿt
(
t
)

151 
’d


153 
loÿl
 
šşudes
 = {
	}
}

155 
loÿl
 
funùiÚ
 
	$m”ge_šşudes
(
¤c
)

156  
	`gsub
(
¤c
, '#šşude%s*"([^"]*)"%s*\n', 
	$funùiÚ
(
Çme
)

157 
šşudes
[
Çme
] 
th’
  "" 
’d


158 
šşudes
[
Çme
] = 
Œue


159 
loÿl
 
å
 = 
	`as£¹
(
io
.
	`İ’
(
LUA_SOURCE
..
Çme
, "r"))

160 
loÿl
 
šc
 = 
å
:
	`»ad
("*a")

161 
	`as£¹
(
å
:
	$şo£
())

162 
šc
 = 
	`gsub
(inc, "#ifndef%s+%w+_h\n#define%s+%w+_h\n", "")

163 
šc
 = 
	`gsub
(inc, "#endif%s*$", "")

164  
	$m”ge_šşudes
(
šc
)

165 
’d
)

166 
’d


168 
loÿl
 
funùiÚ
 
	$g‘_liûn£
(
¤c
)

169  
	`m©ch
(
¤c
, "/%*+\n%* Copyright %(.-%*/\n")

170 
’d


172 
loÿl
 
funùiÚ
 
	$fŞd_lšes
(
¤c
)

173  
	`gsub
(
¤c
, "\\\n", " ")

174 
’d


176 
loÿl
 
¡ršgs
 = {
	}
}

178 
loÿl
 
funùiÚ
 
	$§ve_¡r
(
¡r
)

179 
loÿl
 
n
 = #strings+1

180 
¡ršgs
[
n
] = 
¡r


181  "\1"..
n
.."\2"

182 
’d


184 
loÿl
 
funùiÚ
 
	$§ve_¡ršgs
(
¤c
)

185 
¤c
 = 
	`gsub
(¤c, '"[^"\n]*"', 
§ve_¡r
)

186  
	`gsub
(
¤c
, "'[^'\n]*'", 
§ve_¡r
)

187 
’d


189 
loÿl
 
funùiÚ
 
	$»¡Üe_¡ršgs
(
¤c
)

190  
	`gsub
(
¤c
, "\1(%d+)\2", 
	$funùiÚ
(
num¡r
)

191  
¡ršgs
[
	`tÚumb”
(
num¡r
)]

192 
’d
)

193 
’d


195 
loÿl
 
funùiÚ
 
	$def_i¡rue
(
def
)

196  
def
 =ğ"INT_MAX > 2147483640L" 
Ü


197 
def
 =ğ"LUAI_BITSINT >ğ32" 
Ü


198 
def
 =ğ"SIZE_Bx < LUAI_BITSINT-1" 
Ü


199 
def
 =ğ"ÿ¡" 
Ü


200 
def
 =ğ"defšed(LUA_CORE)" 
Ü


201 
def
 =ğ"MINSTRTABSIZE" 
Ü


202 
def
 =ğ"LUA_MINBUFFER" 
Ü


203 
def
 =ğ"HARDSTACKTESTS" 
Ü


204 
def
 == "UNUSED"

205 
’d


207 
loÿl
 
h—d
, 
defs
 = {[[

208 #ifdeà
_MSC_VER


209 
__št64
 
U64
;

211 
U64
;

213 
_CRT_glob
 = 0;

214 ]]
	}
}, {}

216 
loÿl
 
funùiÚ
 
	$´•roûss
(
¤c
)

217 
loÿl
 
t
 = { 
	`m©ch
(
¤c
, "^(.-)#"è
	}
}

218 
loÿl
 
lvl
, 
	gÚ
, 
	gŞdÚ
 = 0, 
	gŒue
, {}

219 
	gµ
, 
	gdef
, 
txt
 
š
 
	g¡ršg
.
gm©ch
(
¤c
, "#(%w+) *([^\n]*)\n([^#]*)") do

220 
	gµ
 =ğ"if" 
Ü
 
µ
 =ğ"ifdef" o¸µ =ğ"iâdef" 
th’


221 
lvl
 =†vl + 1

222 
ŞdÚ
[
lvl
] = 
Ú


223 
Ú
 = 
	$def_i¡rue
(
def
)

224 
–£if
 
µ
 =ğ"–£" 
th’


225 
ŞdÚ
[
lvl
] 
th’


226 
Ú
 =ğ
çl£
 
th’
 oÀğ
Œue
 Ú = f®£ 
’d


227 
’d


228 
–£if
 
µ
 =ğ"–if" 
th’


229 
ŞdÚ
[
lvl
] 
th’


230 
Ú
 = 
	$def_i¡rue
(
def
)

231 
’d


232 
–£if
 
µ
 =ğ"’dif" 
th’


233 
Ú
 = 
ŞdÚ
[
lvl
]

234 
lvl
 =†vl - 1

235 
–£if
 
Ú
 
th’


236 
µ
 =ğ"šşude" 
th’


237 
nÙ
 
h—d
[
def
] 
ªd
‚Ù 
REMOVE_EXTINC
[def] 
th’


238 
h—d
[
def
] = 
Œue


239 
h—d
[#h—d+1] = "#šşud"..
def
.."\n"

240 
’d


241 
–£if
 
µ
 =ğ"defše" 
th’


242 
loÿl
 
k
, 
¥
, 
v
 = 
	`m©ch
(
def
, "([%w_]+)(%s*)(.*)")

243 
k
 
ªd
 
	`nÙ
 (
¥
 =ğ""‡nd 
	`sub
(
v
, 1, 1è=ğ"("è
th’


244 
defs
[
k
] = 
	`gsub
(
v
, "%a[%w_]*", 
	$funùiÚ
(
tok
)

245  
defs
[
tok
] 
Ü
ok

246 
’d
)

248 
t
[#t+1] = "#defš"..
def
.."\n"

249 
’d


250 
–£if
 
µ
 ~ğ"undef" 
th’


251 
	`”rÜ
("uÃx³ùed dœeùive: "..
µ
.." "..
def
)

252 
’d


253 
’d


254 
Ú
 
th’
 
t
[#t+1] = 
txt
 
’d


255 
’d


256  
	`gsub
(
bË
.
	`cÚÿt
(
t
), "%a[%w_]*", 
	$funùiÚ
(
tok
)

257  
defs
[
tok
] 
Ü
ok

258 
’d
)

259 
’d


261 
loÿl
 
funùiÚ
 
	$m”ge_h—d”
(
¤c
, 
liûn£
)

262 
loÿl
 
hdr
 = 
¡ršg
.
	$fÜm©
([[

265 ]], 
LUA_VERSION
)

266  
hdr
..
liûn£
..
bË
.
	`cÚÿt
(
h—d
)..
¤c


267 
’d


269 
loÿl
 
funùiÚ
 
	$¡r_unu£d1
(
¤c
)

270  
	`gsub
(
¤c
, 'Ğ {"?([%w_]+)"?,%s+%a[%w_]*},\n)', 
	$funùiÚ
(
lše
, 
func
)

271  
REMOVE_LIB
[
func
] 
ªd
 "" 
Ü
 
lše


272 
’d
)

273 
’d


275 
loÿl
 
funùiÚ
 
	$¡r_unu£d2
(
¤c
)

276  
	`gsub
(
¤c
, "Symbolic Execution.-}=", "")

277 
’d


279 
loÿl
 
funùiÚ
 
	$¡r_unu£d3
(
¤c
)

280 
¤c
 = 
	`gsub
(src, "extern", "static")

281 
¤c
 = 
	`gsub
(src, "\nstatic([^\n]-)%(([^)]*)%)%(", "\nstatic%1 %2(")

282 
¤c
 = 
	`gsub
(src, "#define†ua_assert[^\n]*\n", "")

283 
¤c
 = 
	`gsub
(src, "lua_assert%b();?", "")

284 
¤c
 = 
	`gsub
(src, "default:\n}", "default:;\n}")

285 
¤c
 = 
	`gsub
(src, "lua_lock%b();", "")

286 
¤c
 = 
	`gsub
(src, "lua_unlock%b();", "")

287 
¤c
 = 
	`gsub
(src, "luai_threadyield%b();", "")

288 
¤c
 = 
	`gsub
(src, "luai_userstateopen%b();", "{}")

289 
¤c
 = 
	`gsub
(src, "luai_userstate%w+%b();", "")

290 
¤c
 = 
	`gsub
(src, "%(%(c==.*luaY_parser%)", "luaY_parser")

291 
¤c
 = 
	`gsub
(src, "trydecpoint%(ls,seminfo%)",

293 
¤c
 = 
	`gsub
(src, "int c=luaZ_lookahead%b();", "")

294 
¤c
 = 
	`gsub
(src, "luaL_register%(L,[^,]*,co_funcs%);\nreturn 2;",

296 
¤c
 = 
	`gsub
(src, "getfuncname%b():", "NULL:")

297 
¤c
 = 
	`gsub
(src, "getobjname%b():", "NULL:")

298 
¤c
 = 
	`gsub
(src, "if%([^\n]*hookmask[^\n]*%)\n[^\n]*\n", "")

299 
¤c
 = 
	`gsub
(src, "if%([^\n]*hookmask[^\n]*%)%b{}\n", "")

300 
¤c
 = 
	`gsub
(src, "if%([^\n]*hookmask[^\n]*&&\n[^\n]*%b{}\n", "")

301 
¤c
 = 
	`gsub
(src, "(twoto%b()%()", "%1(size_t)")

302 
¤c
 = 
	`gsub
(src, "i<sizenode", "i<(int)sizenode")

303 
¤c
 = 
	`gsub
(src, "cast%(unsigned int,key%-1%)", "cast(unsigned int,key)-1")

304  
	`gsub
(
¤c
, "\n\n+", "\n")

305 
’d


307 
loÿl
 
funùiÚ
 
	$¡r_comm’ts
(
¤c
)

308  
	`gsub
(
¤c
, "/%*.-%*/", " ")

309 
’d


311 
loÿl
 
funùiÚ
 
	$¡r_wh™e¥aû
(
¤c
)

312 
¤c
 = 
	`gsub
(src, "^%s+", "")

313 
¤c
 = 
	`gsub
(src, "%s*\n%s*", "\n")

314 
¤c
 = 
	`gsub
(src, "[ \t]+", " ")

315 
¤c
 = 
	`gsub
(src, "(%W) ", "%1")

316  
	`gsub
(
¤c
, " (%W)", "%1")

317 
’d


319 
loÿl
 
funùiÚ
 
	$»Çme_tok’s1
(
¤c
)

320 
¤c
 = 
	`gsub
(src, "getline", "getline_")

321 
¤c
 = 
	`gsub
(src, "struct ([%w_]+)", "ZX%1")

322  
	`gsub
(
¤c
, "union ([%w_]+)", "ZY%1")

323 
’d


325 
loÿl
 
funùiÚ
 
	$»Çme_tok’s2
(
¤c
)

326 
¤c
 = 
	`gsub
(src, "ZX([%w_]+)", "struct %1")

327  
	`gsub
(
¤c
, "ZY([%w_]+)", "union %1")

328 
’d


330 
loÿl
 
funùiÚ
 
	$func_g©h”
(
¤c
)

331 
loÿl
 
nodes
, 
li¡
 = {
	}
}, {}

332 
loÿl
 
	gpos
, 
	gËn
 = 1, #src

333 
	gpos
 < 
Ën
 do

334 
loÿl
 
	gd
, 
	gw
 = 
m©ch
(
¤c
, "^(#defš([%w_]+)[^\n]*\n)", 
pos
)

335 
d
 
th’


336 
loÿl
 
	gn
 = #list+1

337 
li¡
[
n
] = 
d


338 
nodes
[
w
] = 
n


340 
loÿl
 
s


341 
d
, 
	gw
, 
	gs
 = 
m©ch
(
¤c
, "^(([%w_]+)[^\n]*([{;])\n)", 
pos
)

342 
nÙ
 
d
 
th’


343 
	gd
, 
	gw
, 
	gs
 = 
m©ch
(
¤c
, "^(([%w_]+)[^(]*%b()([{;])\n)", 
pos
)

344 
nÙ
 
d
 
th’
 
	gd
 = 
m©ch
(
¤c
, "^[^\n]*\n", 
pos
è
’d


345 
’d


346 
	gs
 =ğ"{" 
th’


347 
d
 = d..
sub
(
m©ch
(
¤c
, "^%b{}[^;\n]*;?\n", 
pos
+#d-2), 3)

348 
sub
(
d
, -2è=ğ"{\n" 
th’


349 
d
 = d..
sub
(
m©ch
(
¤c
, "^%b{}[^;\n]*;?\n", 
pos
+#d-2), 3)

350 
’d


351 
’d


352 
loÿl
 
	gk
, 
	gv
 = 
n
, 
d


353 
	gw
 =ğ"ty³def" 
th’


354 
m©ch
(
d
, "^ty³deà’um"è
th’


355 
	gh—d
[#h—d+1] = 
d


357 
k
 = 
m©ch
(
d
, "([%w_]+);\n$")

358 
nÙ
 
k
 
th’
 
	gk
 = 
m©ch
(
d
, "^.-%(.-([%w_]+)%)%("è
’d


359 
’d


360 
–£if
 
	gw
 =ğ"’um" 
th’


361 
h—d
[#h—d+1] = 
v


362 
–£if
 
w
 ~ğ
n
 
th’


363 
k
 = 
m©ch
(
d
, "^[^\n]-([%w_]+)[(%[=]")

364 
k
 
th’


365 
	gw
 ~ğ"¡©ic" 
ªd
 
k
 ~ğ"maš" 
th’
 
v
 = "¡©iø"..
d
 
’d


367 
k
 = 
w


368 
’d


369 
’d


370 
w
 
ªd
 
k
 
th’


371 
loÿl
 
o
 = 
nodes
[
k
]

372 
o
 
th’
 
nodes
["*"..
k
] = o 
’d


373 
loÿl
 
n
 = #list+1

374 
li¡
[
n
] = 
v


375 
nodes
[
k
] = 
n


376 
’d


377 
’d


378 
pos
 =…os + #d

379 
’d


380  
nodes
, 
li¡


381 
’d


383 
loÿl
 
funùiÚ
 
	$func_vis™
(
nodes
, 
li¡
, 
u£d
, 
n
)

384 
loÿl
 
i
 = 
nodes
[
n
]

385 
m
 
š
 
¡ršg
.
	`gm©ch
(
li¡
[
i
], "[%w_]+") do

386 
nodes
[
m
] 
th’


387 
loÿl
 
j
 = 
u£d
[
m
]

388 
nÙ
 
j
 
th’


389 
u£d
[
m
] = 
i


390 
	$func_vis™
(
nodes
, 
li¡
, 
u£d
, 
m
)

391 
–£if
 
i
 < 
j
 
th’


392 
u£d
[
m
] = 
i


393 
’d


394 
’d


395 
’d


396 
’d


398 
loÿl
 
funùiÚ
 
	$func_cŞËù
(
¤c
)

399 
loÿl
 
nodes
, 
li¡
 = 
	$func_g©h”
(
¤c
)

400 
loÿl
 
u£d
 = {
	}
}

401 
func_vis™
(
nodes
, 
li¡
, 
u£d
, "main")

402 
	gn
,
i
 
š
 
	$·œs
(
nodes
) do

403 
loÿl
 
j
 = 
u£d
[
n
]

404 
j
 
ªd
 j < 
i
 
th’
 
u£d
["*"..
n
] = j 
’d


405 
’d


406 
n
,
i
 
š
 
	$·œs
(
nodes
) do

407 
nÙ
 
u£d
[
n
] 
th’
 
li¡
[
i
] = "" 
’d


408 
’d


409  
bË
.
	$cÚÿt
(
li¡
)

410 
’d


412 
	$fšd_sourûs
()

413 
loÿl
 
¤c
 = 
	$»ad_sourûs
()

414 
¤c
 = 
	$m”ge_šşudes
(
¤c
)

415 
loÿl
 
liûn£
 = 
	$g‘_liûn£
(
¤c
)

416 
¤c
 = 
	$fŞd_lšes
(
¤c
)

417 
¤c
 = 
	$¡r_unu£d1
(
¤c
)

418 
¤c
 = 
	$§ve_¡ršgs
(
¤c
)

419 
¤c
 = 
	$¡r_unu£d2
(
¤c
)

420 
¤c
 = 
	$¡r_comm’ts
(
¤c
)

421 
¤c
 = 
	$´•roûss
(
¤c
)

422 
¤c
 = 
	$¡r_wh™e¥aû
(
¤c
)

423 
¤c
 = 
	$¡r_unu£d3
(
¤c
)

424 
¤c
 = 
	$»Çme_tok’s1
(
¤c
)

425 
¤c
 = 
	$func_cŞËù
(
¤c
)

426 
¤c
 = 
	$»Çme_tok’s2
(
¤c
)

427 
¤c
 = 
	$»¡Üe_¡ršgs
(
¤c
)

428 
¤c
 = 
	$m”ge_h—d”
(
¤c
, 
liûn£
)

429 
io
.
	`wr™e
(
¤c
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/bc.lua

2 -- 
LuaJIT
 
by‹code
 
li¡šg
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
li¡s
 
the
 
by‹code
 
of
 
a
 
Lua
 
	gfunùiÚ
. 
If
 
	g™
's†oaded by -jbc

9 -- 
™
 
hooks
 
što
 
the
 
·r£r
 
ªd
 
li¡s
 
®l
 
funùiÚs
 
of
 
a
 
chunk
 
as
 
	gthey


10 -- 
¬e
 
	g·r£d
.

12 -- 
Exam¶e
 
	gu§ge
:

14 -- 
luaj™
 -
jbc
 -
e
 'local x=0; for i=1,1e6 do x=x+iƒnd;…rint(x)'

15 -- 
luaj™
 -
jbc
=- 
foo
.
lua


16 -- 
luaj™
 -
jbc
=
foo
.
li¡
 foo.
lua


18 -- 
DeçuÉ
 
ouut
 
is
 
to
 
¡d”r
. 
To
 
»dœeù
 
the
 ouuˆtØ
a
 
fe
, 
·ss
 
	ga


19 -- 
f’ame
 
as
 
ª
 
¬gum’t
 (
u£
 '-' 
¡dout
è
Ü
 
£t
 
the
 
	g’vœÚm’t


20 -- 
v¬ŸbË
 
	gLUAJIT_LISTFILE
. 
The
 
fe
 
is
 
ov”wr™‹n
 
ev”y
 
time
 
the
 
	gmoduË


21 -- 
is
 
	g¡¬‹d
.

23 -- 
This
 
moduË
 
ÿn
 
®so
 
be
 
u£d
 
	g´og¿mm©iÿÎy
:

25 -- 
loÿl
 
bc
 = 
»quœe
("jit.bc")

27 -- 
loÿl
 
funùiÚ
 
	$foo
(è
	`´št
("h–lo"è
’d


29 -- 
bc
.
	`dump
(
foo
è--> -- 
BYTECODE
 -- [...]

30 -- 
	`´št
(
bc
.
	`lše
(
foo
, 2)è--> 0002 
KSTR
 1 1 ; "hello"

32 -- 
loÿl
 
out
 = {

33 -- -- 
Do
 
som‘hšg
 
w™h
 
—ch
 
lše
:

34 -- 
wr™e
 = 
	`funùiÚ
(
t
, ...è
io
.
	`wr™e
(...è
’d
,

35 -- 
şo£
 = 
	`funùiÚ
(
t
è
’d
,

36 -- 
æush
 = 
	`funùiÚ
(
t
è
’d
,

37 -- 
	}
}

38 -- 
	gbc
.
dump
(
foo
, 
out
)

42 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
	gobjeùs
.

43 
loÿl
 
	gj™
 = 
»quœe
("jit")

44 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

45 
loÿl
 
	gjut
 = 
»quœe
("jit.util")

46 
loÿl
 
vmdef
 = 
»quœe
("jit.vmdef")

47 
loÿl
 
b™
 = 
»quœe
("bit")

48 
loÿl
 
sub
, 
	ggsub
, 
	gfÜm©
 = 
¡ršg
.sub, 
	g¡ršg
.gsub, sŒšg.
fÜm©


49 
loÿl
 
	gby‹
, 
	gbªd
, 
	gshr
 = 
¡ršg
.
by‹
, 
	gb™
.bªd, b™.
rshiá


50 
loÿl
 
	gfuncšfo
, 
	gfuncbc
, 
	gfunck
 = 
jut
.
funcšfo
, 
	gjut
.funcbc, jut.
funck


51 
loÿl
 
	gfuncuvÇme
 = 
jut
.
funcuvÇme


52 
loÿl
 
búames
 = 
vmdef
.bcnames

53 
loÿl
 
¡dout
, 
	g¡d”r
 = 
io
.¡dout, 
	gio
.stderr

57 
loÿl
 
funùiÚ
 
	$ùlsub
(
c
)

58 
c
 =ğ"\n" 
th’
  "\\n"

59 
–£if
 
c
 =ğ"\r" 
th’
  "\\r"

60 
–£if
 
c
 =ğ"\t" 
th’
  "\\t"

61  
	`fÜm©
("\\%03d", 
	$by‹
(
c
))

62 
’d


63 
’d


65 -- 
R‘uº
 
Úe
 
by‹code
 
lše
.

66 
loÿl
 
funùiÚ
 
	$bşše
(
func
, 
pc
, 
´efix
)

67 
loÿl
 
šs
, 
m
 = 
	$funcbc
(
func
, 
pc
)

68 
nÙ
 
šs
 
th’
  
’d


69 
loÿl
 
ma
, 
mb
, 
mc
 = 
	`bªd
(
m
, 7), bªd(m, 15*8), 
	$bªd
(
m
, 15*128)

70 
loÿl
 
a
 = 
	`bªd
(
	`shr
(
šs
, 8), 0xff)

71 
loÿl
 
oidx
 = 6*
	$bªd
(
šs
, 0xff)

72 
loÿl
 
İ
 = 
	`sub
(
búames
, 
oidx
+1, oidx+6)

73 
loÿl
 
s
 = 
	`fÜm©
("%04d %s %-6s %3s ",

74 
pc
, 
´efix
 
Ü
 " ", 
İ
, 
ma
 =ğ0 
ªd
 "" o¸
a
)

75 
loÿl
 
d
 = 
	$shr
(
šs
, 16)

76 
mc
 =ğ13*128 
th’
 -- 
BCMjump


77  
	`fÜm©
("%s=> %04d\n", 
s
, 
pc
+
d
-0x7fff)

78 
’d


79 
mb
 ~ğ0 
th’


80 
d
 = 
	$bªd
(
d
, 0xff)

81 
–£if
 
mc
 =ğ0 
th’


82  
s
.."\n"

83 
’d


84 
loÿl
 
kc


85 
mc
 =ğ10*128 
th’
 -- 
BCM¡r


86 
kc
 = 
	`funck
(
func
, -
d
-1)

87 
kc
 = 
	`fÜm©
(#kø> 40 
ªd
 '"%.40s"~' 
Ü
 '"%s"', 
	`gsub
(kc, "%c", 
ùlsub
))

88 
–£if
 
mc
 =ğ9*128 
th’
 -- 
BCMnum


89 
kc
 = 
	$funck
(
func
, 
d
)

90 
İ
 =ğ"TSETM " 
th’
 
kc
 = kø- 2^52 
’d


91 
–£if
 
mc
 =ğ12*128 
th’
 -- 
BCMfunc


92 
loÿl
 
fi
 = 
	`funcšfo
(
	`funck
(
func
, -
d
-1))

93 
fi
.
ffid
 
th’


94 
kc
 = 
vmdef
.
fâames
[
fi
.
ffid
]

96 
kc
 = 
fi
.
loc


97 
’d


98 
–£if
 
mc
 =ğ5*128 
th’
 -- 
BCMuv


99 
kc
 = 
	$funcuvÇme
(
func
, 
d
)

100 
’d


101 
ma
 =ğ5 
th’
 -- 
BCMuv


102 
loÿl
 
ka
 = 
	$funcuvÇme
(
func
, 
a
)

103 
kc
 
th’
 køğ
ka
.." ; "..køkøğk¨
’d


104 
’d


105 
mb
 ~ğ0 
th’


106 
loÿl
 
b
 = 
	$shr
(
šs
, 24)

107 
kc
 
th’
  
	`fÜm©
("%s%3d %3d ; %s\n", 
s
, 
b
, 
d
, kcè
’d


108  
	`fÜm©
("%s%3d %3d\n", 
s
, 
b
, 
d
)

109 
’d


110 
kc
 
th’
  
	`fÜm©
("%s%3d ; %s\n", 
s
, 
d
, kcè
’d


111 
mc
 =ğ7*128 
ªd
 
d
 > 32767 
th’
 d = d - 65536 
’d
 -- 
BCMl™s


112  
	`fÜm©
("%s%3d\n", 
s
, 
d
)

113 
’d


115 -- 
CŞËù
 
b¿nch
 
rg‘s
 
of
 
a
 
funùiÚ
.

116 
loÿl
 
funùiÚ
 
	$bù¬g‘s
(
func
)

117 
loÿl
 
rg‘
 = {
	}
}

118 
pc
=1,1000000000 do

119 
loÿl
 
	gšs
, 
	gm
 = 
	$funcbc
(
func
, 
pc
)

120 
nÙ
 
šs
 
th’
  
’d


121 
	`bªd
(
m
, 15*128è=ğ13*128 
th’
 
rg‘
[
pc
+
	`shr
(
šs
, 16)-0x7fff] = 
Œue
 
’d


122 
’d


123  
rg‘


124 
’d


126 -- 
Dump
 
by‹code
 
š¡ruùiÚs
 
of
 
a
 
funùiÚ
.

127 
loÿl
 
funùiÚ
 
	$bcdump
(
func
, 
out
, 
®l
)

128 
nÙ
 
out
 
th’
 ouˆğ
¡dout
 
’d


129 
loÿl
 
fi
 = 
	$funcšfo
(
func
)

130 
®l
 
ªd
 
fi
.
chd»n
 
th’


131 
n
=-1,-1000000000,-1 do

132 
loÿl
 
k
 = 
	$funck
(
func
, 
n
)

133 
nÙ
 
k
 
th’
  
’d


134 
	`ty³
(
k
è=ğ"´Ùo" 
th’
 
	$bcdump
(
k
, 
out
, 
Œue
è
’d


135 
’d


136 
’d


137 
out
:
	`wr™e
(
	`fÜm©
("-- BYTECODE -- %s-%d\n", 
fi
.
loc
, fi.
Ï¡lšedefšed
))

138 
loÿl
 
rg‘
 = 
	$bù¬g‘s
(
func
)

139 
pc
=1,1000000000 do

140 
loÿl
 
s
 = 
	`bşše
(
func
, 
pc
, 
rg‘
[pc] 
ªd
 "=>")

141 
nÙ
 
s
 
th’
  
’d


142 
out
:
	$wr™e
(
s
)

143 
’d


144 
out
:
	`wr™e
("\n")

145 
out
:
	$æush
()

146 
’d


150 -- 
Aùive
 
æag
 
ªd
 
ouut
 
fe
 
hªdË
.

151 
loÿl
 
aùive
, 
out


153 -- 
Li¡
 
hªdËr
.

154 
loÿl
 
funùiÚ
 
	$h_li¡
(
func
)

155  
	$bcdump
(
func
, 
out
)

156 
’d


158 -- 
D‘ach
 
li¡
 
hªdËr
.

159 
loÿl
 
funùiÚ
 
	$bşi¡off
()

160 
aùive
 
th’


161 
aùive
 = 
çl£


162 
j™
.
	$©ch
(
h_li¡
)

163 
out
 
ªd
 ouˆ~ğ
¡dout
‡nd ouˆ~ğ
¡d”r
 
th’
 out:
	$şo£
(è
’d


164 
out
 = 
n


165 
’d


166 
’d


168 -- 
O³n
 
the
 
ouut
 
fe
 
ªd
 
©ch
 
li¡
 
hªdËr
.

169 
loÿl
 
funùiÚ
 
	$bşi¡Ú
(
outfe
)

170 
aùive
 
th’
 
	$bşi¡off
(è
’d


171 
nÙ
 
outfe
 
th’
 outfğ
os
.
	`g‘’v
("LUAJIT_LISTFILE"è
’d


172 
outfe
 
th’


173 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
	`as£¹
(
io
.
	`İ’
(outfile, "w"))

175 
out
 = 
¡d”r


176 
’d


177 
j™
.
	`©ch
(
h_li¡
, "bc")

178 
aùive
 = 
Œue


179 
’d


181 -- 
Public
 
moduË
 
funùiÚs
.

183 
lše
 = 
bşše
,

184 
dump
 = 
bcdump
,

185 
rg‘s
 = 
bù¬g‘s
,

186 
Ú
 = 
bşi¡Ú
,

187 
off
 = 
bşi¡off
,

188 
¡¬t
 = 
bşi¡Ú
 -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

189 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/bcsave.lua

2 -- 
LuaJIT
 
moduË
 
to
 
	g§ve
/
li¡
 
	gby‹code
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
§ves
 
Ü
 
li¡s
 
the
 
by‹code
 
ª
 
šput
 
	gfe
.

9 -- 
	gIt
's„un byhe -b command†ine option.

13 
loÿl
 
	gj™
 = 
»quœe
("jit")

14 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

15 
loÿl
 
	gb™
 = 
»quœe
("bit")

17 -- 
SymbŞ
 
Çme
 
´efix
 
LuaJIT
 
by‹code
.

18 
loÿl
 
LJBC_PREFIX
 = "luaJIT_BC_"

22 
loÿl
 
funùiÚ
 
	$u§ge
()

23 
io
.
¡d”r
:
wr™e
[[

24 
Save
 
LuaJIT
 
by‹code
: 
luaj™
 -
b
[
İtiÚs
] 
šput
 
ouut


25 -
l
 
OÆy
 
li¡
 
by‹code
.

26 -
s
 
SŒ
 
debug
 
	`šfo
 ().

27 -
g
 
K“p
 
debug
 
šfo
.

28 -
n
 
Çme
 
S‘
 
moduË
 
	`Çme
 (:‡uto-
d‘eù
 
äom
 
šput
‚ame).

29 -
t
 
ty³
 
S‘
 
ouut
 
fe
 
	`ty³
 (:‡uto-
d‘eù
 
äom
 ouuˆ
Çme
).

30 -
a
 
¬ch
 
Ov”ride
 
¬ch™eùu»
 
objeù
 
	`fes
 (: 
Çtive
).

31 -
o
 
os
 
Ov”ride
 
OS
 
objeù
 
	`fes
 (: 
Çtive
).

32 -
e
 
chunk
 
U£
 chunk 
¡ršg
 
as
 
šput
.

33 -- 
Stİ
 
hªdlšg
 
İtiÚs
.

34 - 
U£
 
¡dš
 
as
 
šput
 
ªd
/
Ü
 
¡dout
‡ 
ouut
.

36 
Fe
 
ty³s
: 
c
 
h
 
obj
 
o
 
	`¿w
 ()

38 
os
.
	$ex™
(1)

39 
’d


41 
loÿl
 
funùiÚ
 
	$check
(
ok
, ...)

42 
ok
 
th’
  ok, ... 
’d


43 
io
.
¡d”r
:
	`wr™e
("luajit: ", ...)

44 
io
.
¡d”r
:
	`wr™e
("\n")

45 
os
.
	$ex™
(1)

46 
’d


48 
loÿl
 
funùiÚ
 
	$»adfe
(
šput
)

49 
	`ty³
(
šput
è=ğ"funùiÚ" 
th’
  iÅuˆ
’d


50 
šput
 =ğ"-" 
th’
 iÅuˆğ
n
 
’d


51  
	`check
(
	$lßdfe
(
šput
))

52 
’d


54 
loÿl
 
funùiÚ
 
	$§vefe
(
Çme
, 
mode
)

55 
Çme
 =ğ"-" 
th’
  
io
.
¡dout
 
’d


56  
	`check
(
io
.
	$İ’
(
Çme
, 
mode
))

57 
’d


61 
loÿl
 
m­_ty³
 = {

62 
¿w
 = "¿w", 
c
 = "c", 
h
 = "h", 
o
 = "obj", 
obj
 = "obj",

63 
	}
}

65 
loÿl
 
	gm­_¬ch
 = {

66 
x86
 = 
Œue
, 
	gx64
 =rue, 
	g¬m
 =rue, 
	g¬m64
 =rue, 
	g¬m64be
 =rue,

67 
	gµc
 = 
Œue
, 
	gms
 =rue, 
	gm£l
 =rue,

70 
loÿl
 
	gm­_os
 = {

71 
lšux
 = 
Œue
, 
	gwšdows
 =rue, 
	gosx
 =rue, 
	gä“bsd
 =rue, 
	gÃtbsd
 =rue,

72 
	gİ’bsd
 = 
Œue
, 
	gd¿gÚæy
 =rue, 
	gsŞ¬is
 =rue,

75 
loÿl
 
funùiÚ
 
	$check¬g
(
¡r
, 
m­
, 
”r
)

76 
¡r
 = 
¡ršg
.
	$low”
(
¡r
)

77 
loÿl
 
s
 = 
	`check
(
m­
[
¡r
], "unknowÀ", 
”r
)

78  
s
 =ğ
Œue
 
ªd
 
¡r
 
Ü
 s

79 
’d


81 
loÿl
 
funùiÚ
 
	$d‘eùty³
(
¡r
)

82 
loÿl
 
ext
 = 
¡ršg
.
	`m©ch
(¡ršg.
	`low”
(
¡r
), "%.(%a+)$")

83  
m­_ty³
[
ext
] 
Ü
 "raw"

84 
’d


86 
loÿl
 
funùiÚ
 
	$checkmodÇme
(
¡r
)

87 
	`check
(
¡ršg
.
	`m©ch
(
¡r
, "^[%w_.%-]+$"), "bad module‚ame")

88  
¡ršg
.
	`gsub
(
¡r
, "[%.%-]", "_")

89 
’d


91 
loÿl
 
funùiÚ
 
	$d‘eùmodÇme
(
¡r
)

92 
	`ty³
(
¡r
è=ğ"¡ršg" 
th’


93 
loÿl
 

 = 
¡ršg
.
	`m©ch
(
¡r
, "[^/\\]+$")

94 

 
th’
 
¡r
 =a 
’d


95 
loÿl
 
h—d
 = 
¡ršg
.
	`m©ch
(
¡r
, "^(.*)%.[^.]*$")

96 
h—d
 
th’
 
¡r
 = h—d 
’d


97 
¡r
 = 
¡ršg
.
	`m©ch
(str, "^[%w_.%-]+")

99 
¡r
 = 
n


100 
’d


101 
	`check
(
¡r
, "cannot derive module‚ame, use -n‚ame")

102  
¡ršg
.
	`gsub
(
¡r
, "[%.%-]", "_")

103 
’d


107 
loÿl
 
funùiÚ
 
	$bc§ve_
(
å
, 
ouut
, 
s
)

108 
loÿl
 
ok
, 
”r
 = 
å
:
	$wr™e
(
s
)

109 
ok
 
ªd
 
ouut
 ~ğ"-" 
th’
 ok, 
”r
 = 
å
:
	$şo£
(è
’d


110 
	`check
(
ok
, "ÿÂÙ wr™", 
ouut
, ": ", 
”r
)

111 
’d


113 
loÿl
 
funùiÚ
 
	$bc§ve_¿w
(
ouut
, 
s
)

114 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

115 
	$bc§ve_
(
å
, 
ouut
, 
s
)

116 
’d


118 
loÿl
 
funùiÚ
 
	$bc§ve_c
(
ùx
, 
ouut
, 
s
)

119 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "w")

120 
ùx
.
ty³
 =ğ"c" 
th’


121 
å
:
	`wr™e
(
¡ršg
.
	`fÜm©
([[

122 #ifdeà
_ılu¥lus


125 #ifdeà
_WIN32


126 
	$__deş¥ec
(
dÎexpÜt
)

128 cÚ¡ %
s
%s[] = {

129 ]], 
LJBC_PREFIX
, 
ùx
.
modÇme
))

131 
å
:
	`wr™e
(
¡ršg
.
	`fÜm©
([[

132 #defš%
s
%
s_SIZE
 %
d


133 cÚ¡ %
s
%s[] = {

134 ]], 
LJBC_PREFIX
, 
ùx
.
modÇme
, #s, LJBC_PREFIX, ctx.modname))

135 
’d


136 
loÿl
 
t
, 
n
, 
m
 = {}, 0, 0

137 
i
=1,#s do

138 
loÿl
 
b
 = 
	`to¡ršg
(
¡ršg
.
	`by‹
(
s
, 
i
))

139 
m
 = m + #b + 1

140 
m
 > 78 
th’


141 
å
:
	`wr™e
(
bË
.
	`cÚÿt
(
t
, ",", 1, 
n
), ",\n")

142 
n
, 
m
 = 0, #b + 1

143 
’d


144 
n
 =‚ + 1

145 
t
[
n
] = 
b


146 
’d


147 
	`bc§ve_
(
å
, 
ouut
, 
bË
.
	`cÚÿt
(
t
, ",", 1, 
n
).."\n};\n")

148 
’d


150 
loÿl
 
funùiÚ
 
	`bc§ve_–fobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

151 
ffi
.
cdef
[[

153 
ušt8_t
 
emagic
[4], 
eşass
, 
“ndŸn
, 
ev”siÚ
, 
eo§bi
, 
—biv”siÚ
, 
•ad
[7];

154 
ušt16_t
 
ty³
, 
machše
;

155 
ušt32_t
 
v”siÚ
;

156 
ušt32_t
 
’Œy
, 
phofs
, 
shofs
;

157 
ušt32_t
 
æags
;

158 
ušt16_t
 
ehsize
, 
ph’tsize
, 
phnum
, 
sh’tsize
, 
shnum
, 
sh¡ridx
;

159 } 
	tELF32h—d”
;

161 
ušt8_t
 
emagic
[4], 
eşass
, 
“ndŸn
, 
ev”siÚ
, 
eo§bi
, 
—biv”siÚ
, 
•ad
[7];

162 
ušt16_t
 
ty³
, 
machše
;

163 
ušt32_t
 
v”siÚ
;

164 
ušt64_t
 
’Œy
, 
phofs
, 
shofs
;

165 
ušt32_t
 
æags
;

166 
ušt16_t
 
ehsize
, 
ph’tsize
, 
phnum
, 
sh’tsize
, 
shnum
, 
sh¡ridx
;

167 } 
	tELF64h—d”
;

169 
ušt32_t
 
Çme
, 
ty³
, 
æags
, 
addr
, 
ofs
, 
size
, 
lšk
, 
šfo
, 
®ign
, 
’tsize
;

170 } 
	tELF32£ùh—d”
;

172 
ušt32_t
 
Çme
, 
ty³
;

173 
ušt64_t
 
æags
, 
addr
, 
ofs
, 
size
;

174 
ušt32_t
 
lšk
, 
šfo
;

175 
ušt64_t
 
®ign
, 
’tsize
;

176 } 
	tELF64£ùh—d”
;

178 
ušt32_t
 
Çme
, 
v®ue
, 
size
;

179 
ušt8_t
 
šfo
, 
Ùh”
;

180 
ušt16_t
 
£ùidx
;

181 } 
	tELF32symbŞ
;

183 
ušt32_t
 
Çme
;

184 
ušt8_t
 
šfo
, 
Ùh”
;

185 
ušt16_t
 
£ùidx
;

186 
ušt64_t
 
v®ue
, 
size
;

187 } 
	tELF64symbŞ
;

189 
ELF32h—d”
 
hdr
;

190 
ELF32£ùh—d”
 
£ù
[6];

191 
ELF32symbŞ
 
sym
[2];

192 
ušt8_t
 
¥aû
[4096];

193 } 
	tELF32obj
;

195 
ELF64h—d”
 
hdr
;

196 
ELF64£ùh—d”
 
£ù
[6];

197 
ELF64symbŞ
 
sym
[2];

198 
ušt8_t
 
¥aû
[4096];

199 } 
	tELF64obj
;

201 
loÿl
 
symÇme
 = 
LJBC_PREFIX
..
ùx
.
modÇme


202 
loÿl
 
is64
, 
isbe
 = 
çl£
, false

203 
ùx
.
¬ch
 =ğ"x64" 
Ü
 ctx.¬ch =ğ"¬m64" o¸ùx.¬ch =ğ"¬m64be" 
th’


204 
is64
 = 
Œue


205 
–£if
 
ùx
.
¬ch
 =ğ"µc" 
Ü
 ctx.¬ch =ğ"ms" 
th’


206 
isbe
 = 
Œue


207 
’d


209 -- 
HªdË
 
difã»Á
 
ho¡
/
rg‘
 
’dŸÃss
.

210 
loÿl
 
funùiÚ
 
	`f32
(
x
è x 
’d


211 
loÿl
 
f16
, 
fofs
 = 
f32
, f32

212 
ffi
.
	`abi
("be"è~ğ
isbe
 
th’


213 
f32
 = 
b™
.
bsw­


214 
funùiÚ
 
	`f16
(
x
è 
b™
.
	`rshiá
(b™.
	`bsw­
(x), 16è
’d


215 
is64
 
th’


216 
loÿl
 
two32
 = 
ffi
.
	`ÿ¡
("int64_t", 2^32)

217 
funùiÚ
 
	`fofs
(
x
è 
b™
.
	`bsw­
(x)*
two32
 
’d


219 
fofs
 = 
f32


220 
’d


221 
’d


223 -- 
C»©e
 
ELF
 
objeù
 
ªd
 
fl
 
š
 
h—d”
.

224 
loÿl
 
o
 = 
ffi
.
	`Ãw
(
is64
 
ªd
 "ELF64obj" 
Ü
 "ELF32obj")

225 
loÿl
 
hdr
 = 
o
.hdr

226 
ùx
.
os
 =ğ"bsd" 
Ü
 ctx.o =ğ"Ùh”" 
th’
 -- 
D‘”mše
 
Çtive
 
hdr
.
eo§bi
.

227 
loÿl
 
bf
 = 
	`as£¹
(
io
.
	`İ’
("/bin/ls", "rb"))

228 
loÿl
 
bs
 = 
bf
:
	`»ad
(9)

229 
bf
:
	`şo£
()

230 
ffi
.
	`cİy
(
o
, 
bs
, 9)

231 
	`check
(
hdr
.
emagic
[0] == 127, "no support for writing‚ative object files")

233 
hdr
.
emagic
 = "\127ELF"

234 
hdr
.
eo§bi
 = ({ 
ä“bsd
=9, 
Ãtbsd
=2, 
İ’bsd
=12, 
sŞ¬is
=6 })[
ùx
.
os
] 
Ü
 0

235 
’d


236 
hdr
.
eşass
 = 
is64
 
ªd
 2 
Ü
 1

237 
hdr
.
“ndŸn
 = 
isbe
 
ªd
 2 
Ü
 1

238 
hdr
.
ev”siÚ
 = 1

239 
hdr
.
ty³
 = 
	`f16
(1)

240 
hdr
.
machše
 = 
	`f16
(({ 
x86
=3, 
x64
=62, 
¬m
=40, 
¬m64
=183, 
¬m64be
=183, 
µc
=20, 
ms
=8, 
m£l
=8 })[
ùx
.
¬ch
])

241 
ùx
.
¬ch
 =ğ"ms" 
Ü
 ctx.¬ch =ğ"m£l" 
th’


242 
hdr
.
æags
 = 
	`f32
(0x50001006)

243 
’d


244 
hdr
.
v”siÚ
 = 
	`f32
(1)

245 
hdr
.
shofs
 = 
	`fofs
(
ffi
.
	`off£tof
(
o
, "sect"))

246 
hdr
.
ehsize
 = 
	`f16
(
ffi
.(hdr))

247 
hdr
.
sh’tsize
 = 
	`f16
(
ffi
.(
o
.
£ù
[0]))

248 
hdr
.
shnum
 = 
	`f16
(6)

249 
hdr
.
sh¡ridx
 = 
	`f16
(2)

251 -- 
Fl
 
š
 
£ùiÚs
 
ªd
 
symbŞs
.

252 
loÿl
 
sofs
, 
ofs
 = 
ffi
.
	`off£tof
(
o
, "space"), 1

253 
i
,
Çme
 
š
 
aœs
{

256 
loÿl
 
£ù
 = 
o
.£ù[
i
]

257 
£ù
.
®ign
 = 
	`fofs
(1)

258 
£ù
.
Çme
 = 
	`f32
(
ofs
)

259 
ffi
.
	`cİy
(
o
.
¥aû
+
ofs
, 
Çme
)

260 
ofs
 = ofs + #name+1

261 
’d


262 
o
.
£ù
[1].
ty³
 = 
	`f32
(2è-- .
symb


263 
o
.
£ù
[1].
lšk
 = 
	`f32
(3)

264 
o
.
£ù
[1].
šfo
 = 
	`f32
(1)

265 
o
.
£ù
[1].
®ign
 = 
	`fofs
(8)

266 
o
.
£ù
[1].
ofs
 = 
	`fofs
(
ffi
.
	`off£tof
(o, "sym"))

267 
o
.
£ù
[1].
’tsize
 = 
	`fofs
(
ffi
.(o.
sym
[0]))

268 
o
.
£ù
[1].
size
 = 
	`fofs
(
ffi
.(o.
sym
))

269 
o
.
sym
[1].
Çme
 = 
	`f32
(1)

270 
o
.
sym
[1].
£ùidx
 = 
	`f16
(4)

271 
o
.
sym
[1].
size
 = 
	`fofs
(#s)

272 
o
.
sym
[1].
šfo
 = 17

273 
o
.
£ù
[2].
ty³
 = 
	`f32
(3è-- .
sh¡¹ab


274 
o
.
£ù
[2].
ofs
 = 
	`fofs
(
sofs
)

275 
o
.
£ù
[2].
size
 = 
	`fofs
(
ofs
)

276 
o
.
£ù
[3].
ty³
 = 
	`f32
(3è-- .
¡¹ab


277 
o
.
£ù
[3].
ofs
 = 
	`fofs
(
sofs
 + ofs)

278 
o
.
£ù
[3].
size
 = 
	`fofs
(#symname+1)

279 
ffi
.
	`cİy
(
o
.
¥aû
+
ofs
+1, 
symÇme
)

280 
ofs
 = ofs + #symname + 2

281 
o
.
£ù
[4].
ty³
 = 
	`f32
(1è-- .
rod©a


282 
o
.
£ù
[4].
æags
 = 
	`fofs
(2)

283 
o
.
£ù
[4].
ofs
 = 
	`fofs
(
sofs
 + ofs)

284 
o
.
£ù
[4].
size
 = 
	`fofs
(#s)

285 
o
.
£ù
[5].
ty³
 = 
	`f32
(1è-- .
nÙe
.
GNU
-
¡ack


286 
o
.
£ù
[5].
ofs
 = 
	`fofs
(
sofs
 + ofs + #s)

288 -- 
Wr™e
 
ELF
 
objeù
 
fe
.

289 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

290 
å
:
	`wr™e
(
ffi
.
	`¡ršg
(
o
, ffi.(o)-4096+
ofs
))

291 
	`bc§ve_
(
å
, 
ouut
, 
s
)

292 
’d


294 
loÿl
 
funùiÚ
 
	`bc§ve_³obj
(
ùx
, 
ouut
, 
s
, 
ffi
)

295 
ffi
.
cdef
[[

297 
ušt16_t
 
¬ch
, 
n£ùs
;

298 
ušt32_t
 
time
, 
symbofs
, 
nsyms
;

299 
ušt16_t
 
İthdrsz
, 
æags
;

300 } 
PEh—d”
;

302 
Çme
[8];

303 
ušt32_t
 
vsize
, 
vaddr
, 
size
, 
ofs
, 
»locofs
, 
lšeofs
;

304 
ušt16_t
 
Ä–oc
, 
Æše
;

305 
ušt32_t
 
æags
;

306 } 
	tPE£ùiÚ
;

307 
	`__©Œibu‹
((
	t·cked
)) {

309 
Çme
[8];

310 
ušt32_t
 
Çm”ef
[2];

312 
ušt32_t
 
v®ue
;

313 
št16_t
 
£ù
;

314 
ušt16_t
 
ty³
;

315 
ušt8_t
 
sş
, 
Çux
;

316 } 
	tPEsym
;

317 
	`__©Œibu‹
((
	t·cked
)) {

318 
ušt32_t
 
size
;

319 
ušt16_t
 
Ä–oc
, 
Æše
;

320 
ušt32_t
 
cksum
;

321 
ušt16_t
 
assoc
;

322 
ušt8_t
 
comd©£l
, 
unu£d
[3];

323 } 
	tPEsymaux
;

325 
PEh—d”
 
hdr
;

326 
PE£ùiÚ
 
£ù
[2];

328 
PEsym
 
sym0
;

329 
PEsymaux
 
sym0aux
;

330 
PEsym
 
sym1
;

331 
PEsymaux
 
sym1aux
;

332 
PEsym
 
sym2
;

333 
PEsym
 
sym3
;

334 
ušt32_t
 
¡¹absize
;

335 
ušt8_t
 
¥aû
[4096];

336 } 
	tPEobj
;

338 
loÿl
 
symÇme
 = 
LJBC_PREFIX
..
ùx
.
modÇme


339 
loÿl
 
is64
 = 
çl£


340 
ùx
.
¬ch
 =ğ"x86" 
th’


341 
symÇme
 = "_"..symname

342 
–£if
 
ùx
.
¬ch
 =ğ"x64" 
th’


343 
is64
 = 
Œue


344 
’d


345 
loÿl
 
symexpÜt
 = " /EXPORT:"..
symÇme
..",DATA "

347 -- 
The
 
fe
 
fÜm©
 
is
 
®ways
 
l™e
-
’dŸn
. 
Sw­
 
the
 
ho¡
 i 
big
-endian.

348 
loÿl
 
funùiÚ
 
	`f32
(
x
è x 
’d


349 
loÿl
 
f16
 = 
f32


350 
ffi
.
	`abi
("be"è
th’


351 
f32
 = 
b™
.
bsw­


352 
funùiÚ
 
	`f16
(
x
è 
b™
.
	`rshiá
(b™.
	`bsw­
(x), 16è
’d


353 
’d


355 -- 
C»©e
 
PE
 
objeù
 
ªd
 
fl
 
š
 
h—d”
.

356 
loÿl
 
o
 = 
ffi
.
	`Ãw
("PEobj")

357 
loÿl
 
hdr
 = 
o
.hdr

358 
hdr
.
¬ch
 = 
	`f16
(({ 
x86
=0x14c, 
x64
=0x8664, 
¬m
=0x1c0, 
µc
=0x1f2, 
ms
=0x366, 
m£l
=0x366 })[
ùx
.arch])

359 
hdr
.
n£ùs
 = 
	`f16
(2)

360 
hdr
.
symbofs
 = 
	`f32
(
ffi
.
	`off£tof
(
o
, "sym0"))

361 
hdr
.
nsyms
 = 
	`f32
(6)

363 -- 
Fl
 
š
 
£ùiÚs
 
ªd
 
symbŞs
.

364 
o
.
£ù
[0].
Çme
 = ".drectve"

365 
o
.
£ù
[0].
size
 = 
	`f32
(#symexport)

366 
o
.
£ù
[0].
æags
 = 
	`f32
(0x00100a00)

367 
o
.
sym0
.
£ù
 = 
	`f16
(1)

368 
o
.
sym0
.
sş
 = 3

369 
o
.
sym0
.
Çme
 = ".drectve"

370 
o
.
sym0
.
Çux
 = 1

371 
o
.
sym0aux
.
size
 = 
	`f32
(#symexport)

372 
o
.
£ù
[1].
Çme
 = ".rdata"

373 
o
.
£ù
[1].
size
 = 
	`f32
(#s)

374 
o
.
£ù
[1].
æags
 = 
	`f32
(0x40300040)

375 
o
.
sym1
.
£ù
 = 
	`f16
(2)

376 
o
.
sym1
.
sş
 = 3

377 
o
.
sym1
.
Çme
 = ".rdata"

378 
o
.
sym1
.
Çux
 = 1

379 
o
.
sym1aux
.
size
 = 
	`f32
(#s)

380 
o
.
sym2
.
£ù
 = 
	`f16
(2)

381 
o
.
sym2
.
sş
 = 2

382 
o
.
sym2
.
Çm”ef
[1] = 
	`f32
(4)

383 
o
.
sym3
.
£ù
 = 
	`f16
(-1)

384 
o
.
sym3
.
sş
 = 2

385 
o
.
sym3
.
v®ue
 = 
	`f32
(1)

386 
o
.
sym3
.
Çme
 = "@ã©.00" -- 
M¬k
 
as
 
SaãSEH
 
com¶ŸÁ
.

387 
ffi
.
	`cİy
(
o
.
¥aû
, 
symÇme
)

388 
loÿl
 
ofs
 = #symname + 1

389 
o
.
¡¹absize
 = 
	`f32
(
ofs
 + 4)

390 
o
.
£ù
[0].
ofs
 = 
	`f32
(
ffi
.
	`off£tof
(o, "space") + ofs)

391 
ffi
.
	`cİy
(
o
.
¥aû
 + 
ofs
, 
symexpÜt
)

392 
ofs
 = ofs + #symexport

393 
o
.
£ù
[1].
ofs
 = 
	`f32
(
ffi
.
	`off£tof
(o, "space") + ofs)

395 -- 
Wr™e
 
PE
 
objeù
 
fe
.

396 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

397 
å
:
	`wr™e
(
ffi
.
	`¡ršg
(
o
, ffi.(o)-4096+
ofs
))

398 
	`bc§ve_
(
å
, 
ouut
, 
s
)

399 
’d


401 
loÿl
 
funùiÚ
 
	`bc§ve_machobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

402 
ffi
.
cdef
[[

405 
ušt32_t
 
magic
, 
ıuty³
, 
ıusubty³
, 
f‘y³
, 
ncmds
, 
sizeofcmds
, 
æags
;

406 } 
mach_h—d”
;

409 
mach_h—d”
; 
ušt32_t
 
»£rved
;

410 } 
mach_h—d”_64
;

412 
ušt32_t
 
cmd
, 
cmdsize
;

413 
£gÇme
[16];

414 
ušt32_t
 
vmaddr
, 
vmsize
, 
feoff
, 
fesize
;

415 
ušt32_t
 
max´Ù
, 
š™´Ù
, 
n£ùs
, 
æags
;

416 } 
	tmach_£gm’t_commªd
;

418 
ušt32_t
 
cmd
, 
cmdsize
;

419 
£gÇme
[16];

420 
ušt64_t
 
vmaddr
, 
vmsize
, 
feoff
, 
fesize
;

421 
ušt32_t
 
max´Ù
, 
š™´Ù
, 
n£ùs
, 
æags
;

422 } 
	tmach_£gm’t_commªd_64
;

424 
£ùÇme
[16], 
£gÇme
[16];

425 
ušt32_t
 
addr
, 
size
;

426 
ušt32_t
 
off£t
, 
®ign
, 
»loff
, 
Ä–oc
, 
æags
;

427 
ušt32_t
 
»£rved1
, 
»£rved2
;

428 } 
	tmach_£ùiÚ
;

430 
£ùÇme
[16], 
£gÇme
[16];

431 
ušt64_t
 
addr
, 
size
;

432 
ušt32_t
 
off£t
, 
®ign
, 
»loff
, 
Ä–oc
, 
æags
;

433 
ušt32_t
 
»£rved1
, 
»£rved2
, 
»£rved3
;

434 } 
	tmach_£ùiÚ_64
;

436 
ušt32_t
 
cmd
, 
cmdsize
, 
symoff
, 
nsyms
, 
¡roff
, 
¡rsize
;

437 } 
	tmach_symb_commªd
;

439 
št32_t
 
¡rx
;

440 
ušt8_t
 
ty³
, 
£ù
;

441 
št16_t
 
desc
;

442 
ušt32_t
 
v®ue
;

443 } 
	tmach_Æi¡
;

445 
ušt32_t
 
¡rx
;

446 
ušt8_t
 
ty³
, 
£ù
;

447 
ušt16_t
 
desc
;

448 
ušt64_t
 
v®ue
;

449 } 
	tmach_Æi¡_64
;

452 
ušt32_t
 
magic
, 
nçt_¬ch
;

453 } 
	tmach_çt_h—d”
;

456 
ušt32_t
 
ıuty³
, 
ıusubty³
, 
off£t
, 
size
, 
®ign
;

457 } 
	tmach_çt_¬ch
;

460 
mach_h—d”
 
hdr
;

461 
mach_£gm’t_commªd
 
£g
;

462 
mach_£ùiÚ
 
£c
;

463 
mach_symb_commªd
 
sym
;

464 } 
¬ch
[1];

465 
mach_Æi¡
 
sym_’Œy
;

466 
ušt8_t
 
¥aû
[4096];

467 } 
	tmach_obj
;

470 
mach_h—d”_64
 
hdr
;

471 
mach_£gm’t_commªd_64
 
£g
;

472 
mach_£ùiÚ_64
 
£c
;

473 
mach_symb_commªd
 
sym
;

474 } 
¬ch
[1];

475 
mach_Æi¡_64
 
sym_’Œy
;

476 
ušt8_t
 
¥aû
[4096];

477 } 
	tmach_obj_64
;

479 
mach_çt_h—d”
 
çt
;

480 
mach_çt_¬ch
 
çt_¬ch
[2];

482 
mach_h—d”
 
hdr
;

483 
mach_£gm’t_commªd
 
£g
;

484 
mach_£ùiÚ
 
£c
;

485 
mach_symb_commªd
 
sym
;

486 } 
¬ch
[2];

487 
mach_Æi¡
 
sym_’Œy
;

488 
ušt8_t
 
¥aû
[4096];

489 } 
	tmach_çt_obj
;

491 
loÿl
 
symÇme
 = '_'..
LJBC_PREFIX
..
ùx
.
modÇme


492 
loÿl
 
isçt
, 
is64
, 
®ign
, 
mobj
 = 
çl£
, false, 4, "mach_obj"

493 
ùx
.
¬ch
 =ğ"x64" 
th’


494 
is64
, 
®ign
, 
mobj
 = 
Œue
, 8, "mach_obj_64"

495 
–£if
 
ùx
.
¬ch
 =ğ"¬m" 
th’


496 
isçt
, 
mobj
 = 
Œue
, "mach_fat_obj"

497 
–£if
 
ùx
.
¬ch
 =ğ"¬m64" 
th’


498 
is64
, 
®ign
, 
isçt
, 
mobj
 = 
Œue
, 8,rue, "mach_fat_obj"

500 
	`check
(
ùx
.
¬ch
 == "x86", "unsupported‡rchitecture for OSX")

501 
’d


502 
loÿl
 
funùiÚ
 
	`®igÃd
(
v
, 
a
è 
b™
.
	`bªd
(v+a-1, -aè
’d


503 
loÿl
 
be32
 = 
b™
.
bsw­
 -- 
Mach
-
O
 
FAT
 
is
 
BE
, 
suµÜ‹d
 
¬chs
 
¬e
 
LE
.

505 -- 
C»©e
 
Mach
-
O
 
objeù
 
ªd
 
fl
 
š
 
h—d”
.

506 
loÿl
 
o
 = 
ffi
.
	`Ãw
(
mobj
)

507 
loÿl
 
mach_size
 = 
	`®igÃd
(
ffi
.
	`off£tof
(
o
, "¥aû")+#symÇme+2, 
®ign
)

508 
loÿl
 
ıuty³
 = ({ 
x86
={7}, 
x64
={0x01000007}, 
¬m
={7,12}, 
¬m64
={0x01000007,0x0100000c} })[
ùx
.
¬ch
]

509 
loÿl
 
ıusubty³
 = ({ 
x86
={3}, 
x64
={3}, 
¬m
={3,9}, 
¬m64
={3,0} })[
ùx
.
¬ch
]

510 
isçt
 
th’


511 
o
.
çt
.
magic
 = 
	`be32
(0xcafebabe)

512 
o
.
çt
.
nçt_¬ch
 = 
	`be32
(#cpusubtype)

513 
’d


515 -- 
Fl
 
š
 
£ùiÚs
 
ªd
 
symbŞs
.

516 
i
=0,#cpusubtype-1 do

517 
loÿl
 
ofs
 = 0

518 
isçt
 
th’


519 
loÿl
 
a
 = 
o
.
çt_¬ch
[
i
]

520 
a
.
ıuty³
 = 
	`be32
(ıuty³[
i
+1])

521 
a
.
ıusubty³
 = 
	`be32
(ıusubty³[
i
+1])

522 -- 
Sub£qu’t
 
¦iûs
 
ov”Ïp
 
—ch
 
Ùh”
 
to
 
sh¬e
 
d©a
.

523 
ofs
 = 
ffi
.
	`off£tof
(
o
, "¬ch"è+ 
i
*ffi.(o.
¬ch
[0])

524 
a
.
off£t
 = 
	`be32
(
ofs
)

525 
a
.
size
 = 
	`be32
(
mach_size
-
ofs
+#s)

526 
’d


527 
loÿl
 
a
 = 
o
.
¬ch
[
i
]

528 
a
.
hdr
.
magic
 = 
is64
 
ªd
 0xãedçcà
Ü
 0xfeedface

529 
a
.
hdr
.
ıuty³
 = cputy³[
i
+1]

530 
a
.
hdr
.
ıusubty³
 = cpusubty³[
i
+1]

531 
a
.
hdr
.
f‘y³
 = 1

532 
a
.
hdr
.
ncmds
 = 2

533 
a
.
hdr
.
sizeofcmds
 = 
ffi
.×.
£g
)+ffi.×.
£c
)+ffi.×.
sym
)

534 
a
.
£g
.
cmd
 = 
is64
 
ªd
 0x19 
Ü
 0x1

535 
a
.
£g
.
cmdsize
 = 
ffi
.×.£g)+ffi.×.
£c
)

536 
a
.
£g
.
vmsize
 = #s

537 
a
.
£g
.
feoff
 = 
mach_size
-
ofs


538 
a
.
£g
.
fesize
 = #s

539 
a
.
£g
.
max´Ù
 = 1

540 
a
.
£g
.
š™´Ù
 = 1

541 
a
.
£g
.
n£ùs
 = 1

542 
ffi
.
	`cİy
(
a
.
£c
.
£ùÇme
, "__data")

543 
ffi
.
	`cİy
(
a
.
£c
.
£gÇme
, "__DATA")

544 
a
.
£c
.
size
 = #s

545 
a
.
£c
.
off£t
 = 
mach_size
-
ofs


546 
a
.
sym
.
cmd
 = 2

547 
a
.
sym
.
cmdsize
 = 
ffi
.(a.sym)

548 
a
.
sym
.
symoff
 = 
ffi
.
	`off£tof
(
o
, "sym_’Œy")-
ofs


549 
a
.
sym
.
nsyms
 = 1

550 
a
.
sym
.
¡roff
 = 
ffi
.
	`off£tof
(
o
, "sym_’Œy")+ffi.(o.
sym_’Œy
)-
ofs


551 
a
.
sym
.
¡rsize
 = 
	`®igÃd
(#symÇme+2, 
®ign
)

552 
’d


553 
o
.
sym_’Œy
.
ty³
 = 0xf

554 
o
.
sym_’Œy
.
£ù
 = 1

555 
o
.
sym_’Œy
.
¡rx
 = 1

556 
ffi
.
	`cİy
(
o
.
¥aû
+1, 
symÇme
)

558 -- 
Wr™e
 
Macho
-
O
 
objeù
 
fe
.

559 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

560 
å
:
	`wr™e
(
ffi
.
	`¡ršg
(
o
, 
mach_size
))

561 
	`bc§ve_
(
å
, 
ouut
, 
s
)

562 
’d


564 
loÿl
 
funùiÚ
 
	`bc§ve_obj
(
ùx
, 
ouut
, 
s
)

565 
loÿl
 
ok
, 
ffi
 = 
	`pÿÎ
(
»quœe
, "ffi")

566 
	`check
(
ok
, "FFI†ibrary„equiredo writehis fileype")

567 
ùx
.
os
 =ğ"wšdows" 
th’


568  
	`bc§ve_³obj
(
ùx
, 
ouut
, 
s
, 
ffi
)

569 
–£if
 
ùx
.
os
 =ğ"osx" 
th’


570  
	`bc§ve_machobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

572  
	`bc§ve_–fobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

573 
’d


574 
’d


578 
loÿl
 
funùiÚ
 
	`bşi¡
(
šput
, 
ouut
)

579 
loÿl
 
f
 = 
	`»adfe
(
šput
)

580 
	`»quœe
("j™.bc").
	`dump
(
f
, 
	`§vefe
(
ouut
, "w"), 
Œue
)

581 
’d


583 
loÿl
 
funùiÚ
 
	`bc§ve
(
ùx
, 
šput
, 
ouut
)

584 
loÿl
 
f
 = 
	`»adfe
(
šput
)

585 
loÿl
 
s
 = 
¡ršg
.
	`dump
(
f
, 
ùx
.
¡r
)

586 
loÿl
 
t
 = 
ùx
.
ty³


587 
nÙ
 
t
 
th’


588 
t
 = 
	`d‘eùty³
(
ouut
)

589 
ùx
.
ty³
 = 
t


590 
’d


591 
t
 =ğ"¿w" 
th’


592 
	`bc§ve_¿w
(
ouut
, 
s
)

594 
nÙ
 
ùx
.
modÇme
 
th’
 ctx.modÇmğ
	`d‘eùmodÇme
(
šput
è
’d


595 
t
 =ğ"obj" 
th’


596 
	`bc§ve_obj
(
ùx
, 
ouut
, 
s
)

598 
	`bc§ve_c
(
ùx
, 
ouut
, 
s
)

599 
’d


600 
’d


601 
’d


603 
loÿl
 
funùiÚ
 
	`docmd
(...)

604 
loÿl
 
¬g
 = {...}

605 
loÿl
 
n
 = 1

606 
loÿl
 
li¡
 = 
çl£


607 
loÿl
 
ùx
 = {

608 
¡r
 = 
Œue
, 
¬ch
 = 
j™
.¬ch, 
os
 = 
¡ršg
.
	`low”
(jit.os),

609 
ty³
 = 
çl£
, 
modÇme
 = false,

611 
n
 <= #arg do

612 
loÿl
 
a
 = 
¬g
[
n
]

613 
	`ty³
(
a
è=ğ"¡ršg" 
ªd
 
¡ršg
.
	`sub
×, 1, 1è=ğ"-"‡nd‡ ~ğ"-" 
th’


614 
bË
.
	`»move
(
¬g
, 
n
)

615 
a
 =ğ"--" 
th’
  
’d


616 
m
=2,#a do

617 
loÿl
 
İt
 = 
¡ršg
.
	`sub
(
a
, 
m
, m)

618 
İt
 =ğ"l" 
th’


619 
li¡
 = 
Œue


620 
–£if
 
İt
 =ğ"s" 
th’


621 
ùx
.
¡r
 = 
Œue


622 
–£if
 
İt
 =ğ"g" 
th’


623 
ùx
.
¡r
 = 
çl£


625 
¬g
[
n
] =ğ
n
 
Ü
 
m
 ~ğ#¨
th’
 
	`u§ge
(è
’d


626 
İt
 =ğ"e" 
th’


627 
n
 ~ğ1 
th’
 
	`u§ge
(è
’d


628 
¬g
[1] = 
	`check
(
	`lßd¡ršg
(arg[1]))

629 
–£if
 
İt
 =ğ"n" 
th’


630 
ùx
.
modÇme
 = 
	`checkmodÇme
(
bË
.
	`»move
(
¬g
, 
n
))

631 
–£if
 
İt
 =ğ"t" 
th’


632 
ùx
.
ty³
 = 
	`check¬g
(
bË
.
	`»move
(
¬g
, 
n
), 
m­_ty³
, "fileype")

633 
–£if
 
İt
 =ğ"a" 
th’


634 
ùx
.
¬ch
 = 
	`check¬g
(
bË
.
	`»move
(
¬g
, 
n
), 
m­_¬ch
, "architecture")

635 
–£if
 
İt
 =ğ"o" 
th’


636 
ùx
.
os
 = 
	`check¬g
(
bË
.
	`»move
(
¬g
, 
n
), 
m­_os
, "OS‚ame")

638 
	`u§ge
()

639 
’d


640 
’d


641 
’d


643 
n
 =‚ + 1

644 
’d


645 
’d


646 
li¡
 
th’


647 #¬g =ğ0 
Ü
 #¬g > 2 
th’
 
	`u§ge
(è
’d


648 
	`bşi¡
(
¬g
[1],‡rg[2] 
Ü
 "-")

650 #¬g ~ğ2 
th’
 
	`u§ge
(è
’d


651 
	`bc§ve
(
ùx
, 
¬g
[1],‡rg[2])

652 
’d


653 
’d


657 -- 
Public
 
moduË
 
funùiÚs
.

659 
¡¬t
 = 
docmd
 -- 
Proûss
 -
b
 
commªd
 
lše
 
İtiÚ
.

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_arm.lua

2 -- 
LuaJIT
 
ARM
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
It
 
di§s£mbËs
 
mo¡
 
	gu£r
-
mode
 
ARMv7
 
	gš¡ruùiÚs


10 -- 
	gNYI
: 
Advªûd
 
SIMD
 
ªd
 
VFP
 
š¡ruùiÚs
.

13 
loÿl
 
ty³
 =ype

14 
loÿl
 
sub
, 
	gby‹
, 
	gfÜm©
 = 
¡ršg
.sub, 
	g¡ršg
.by‹, sŒšg.
fÜm©


15 
loÿl
 
	gm©ch
, 
	ggm©ch
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.
gm©ch


16 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


17 
loÿl
 
b™
 = 
»quœe
("bit")

18 
loÿl
 
bªd
, 
	gbÜ
, 
	grÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.rÜ, b™.
tohex


19 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshift, bit.arshift

22 -- 
Opcode
 
	gm­s


25 
loÿl
 
	gm­_lßdc
 = {

26 
shiá
 = 8, 
	gmask
 = 15,

28 
shiá
 = 20, 
	gmask
 = 1,

30 
shiá
 = 23, 
	gmask
 = 3,

32 
	g_
 = {

33 
shiá
 = 21, 
	gmask
 = 1,

35 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpushFdr", 
	g_
 = "vstmdbFNdr", }

39 
	gshiá
 = 23, 
	gmask
 = 3,

41 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpİFdr", 
	g_
 = "vldmFNdr", },

42 
	g_
 = {

43 
shiá
 = 21, 
	gmask
 = 1,

49 
shiá
 = 20, 
	gmask
 = 1,

51 
shiá
 = 23, 
	gmask
 = 3,

53 
	g_
 = {

54 
shiá
 = 21, 
	gmask
 = 1,

56 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpushGdr", 
	g_
 = "vstmdbGNdr", }

60 
	gshiá
 = 23, 
	gmask
 = 3,

62 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpİGdr", 
	g_
 = "vldmGNdr", },

63 
	g_
 = {

64 
shiá
 = 21, 
	gmask
 = 1,

69 
	g_
 = {

70 
shiá
 = 0, 
	gmask
 = 0 -- 
NYI
 
ldc
, 
	gmür
, 
	gm¼c
.

74 
loÿl
 
	gm­_vås
 = {

75 
shiá
 = 6, 
	gmask
 = 0x2c001,

85 
shiá
 = 7, 
	gmask
 = 0x1e01,

97 
loÿl
 
	gm­_våd
 = {

98 
shiá
 = 6, 
	gmask
 = 0x2c001,

108 
shiá
 = 7, 
	gmask
 = 0x1e01,

120 
loÿl
 
	gm­_d©ac
 = {

121 
shiá
 = 24, 
	gmask
 = 1,

123 
shiá
 = 4, 
	gmask
 = 1,

125 
shiá
 = 8, 
	gmask
 = 15,

126 [10] = 
m­_vås
,

127 [11] = 
m­_våd
,

128 -- 
NYI
 
	gcdp
, 
	gmü
, 
	gmrc
.

131 
	gshiá
 = 8, 
	gmask
 = 15,

133 
shiá
 = 20, 
	gmask
 = 15,

136 [15] = { 
shiá
 = 12, 
	gmask
 = 15, [15] = "vmrs", 
	g_
 = "vmrsD", },

143 
loÿl
 
	gm­_lßdcu
 = {

144 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
uncÚd™iÚ®
 
CP
 
	glßd
/
	g¡Üe
.

147 
loÿl
 
	gm­_d©acu
 = {

148 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
uncÚd™iÚ®
 
CP
 
	gd©a
.

151 
loÿl
 
	gm­_simdd©a
 = {

152 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
SIMD
 
	gd©a
.

155 
loÿl
 
	gm­_simdlßd
 = {

156 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
SIMD
 
	glßd
/
	g¡Üe
, 
	g´–ßd
.

159 
loÿl
 
	gm­_´–ßd
 = {

160 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
	g´–ßd
.

163 
loÿl
 
	gm­_medŸ
 = {

164 
shiá
 = 20, 
	gmask
 = 31,

165 [0] = 
çl£
,

167 
	gshiá
 = 5, 
	gmask
 = 7,

169 "§dd8DNM", 
	gçl£
, false, "ssub8DNM",

172 
	gshiá
 = 5, 
	gmask
 = 7,

174 "qadd8DNM", 
	gçl£
, false, "qsub8DNM",

177 
	gshiá
 = 5, 
	gmask
 = 7,

179 "shadd8DNM", 
	gçl£
, false, "shsub8DNM",

181 
	gçl£
,

183 
	gshiá
 = 5, 
	gmask
 = 7,

185 "uadd8DNM", 
	gçl£
, false, "usub8DNM",

188 
	gshiá
 = 5, 
	gmask
 = 7,

190 "uqadd8DNM", 
	gçl£
, false, "uqsub8DNM",

193 
	gshiá
 = 5, 
	gmask
 = 7,

195 "uhadd8DNM", 
	gçl£
, false, "uhsub8DNM",

198 
	gshiá
 = 5, 
	gmask
 = 7,

199 [0] = "pkhbtDNMU", 
	gçl£
, "pkhtbDNMU",

200 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "sxtb16DMU", 
	g_
 = "sxtab16DNMU", },

203 
	gçl£
,

205 
	gshiá
 = 5, 
	gmask
 = 7,

207 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "sxtbDMU", 
	g_
 = "sxtabDNMU", },

208 "s§tDxMu", 
	gçl£
, "ssatDxMu",

211 
	gshiá
 = 5, 
	gmask
 = 7,

213 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "sxthDMU", 
	g_
 = "sxtahDNMU", },

217 
	gshiá
 = 5, 
	gmask
 = 7,

218 [3] = { 
shiá
 = 16, 
	gmask
 = 15, [15] = "uxtb16DMU", 
	g_
 = "uxtab16DNMU", },

220 
	gçl£
,

222 
	gshiá
 = 5, 
	gmask
 = 7,

224 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "uxtbDMU", 
	g_
 = "uxtabDNMU", },

225 "u§tDwMu", 
	gçl£
, "usatDwMu",

228 
	gshiá
 = 5, 
	gmask
 = 7,

230 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "uxthDMU", 
	g_
 = "uxtahDNMU", },

234 
	gshiá
 = 12, 
	gmask
 = 15,

236 
shiá
 = 5, 
	gmask
 = 7,

239 
	g_
 = {

240 
shiá
 = 5, 
	gmask
 = 7,

244 
	gçl£
, false, false,

246 
	gshiá
 = 5, 
	gmask
 = 7,

250 
	gshiá
 = 5, 
	gmask
 = 7,

251 [0] = { 
shiá
 = 12, 
	gmask
 = 15, [15] = "smmulNMS", 
	g_
 = "smmlaNMSD", },

252 { 
	gshiá
 = 12, 
	gmask
 = 15, [15] = "smmuÌNMS", 
	g_
 = "smmlarNMSD", },

253 
	gçl£
, false, false, false,

256 
	gçl£
, false,

258 
	gshiá
 = 5, 
	gmask
 = 7,

259 [0] = { 
shiá
 = 12, 
	gmask
 = 15, [15] = "u§d8NMS", 
	g_
 = "usada8NMSD", },

261 
	gçl£
,

263 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "sbfxDMvw",

266 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "sbfxDMvw",

269 
	gshiá
 = 5, 
	gmask
 = 3,

270 [0] = { 
shiá
 = 0, 
	gmask
 = 15, [15] = "bfcDvX", 
	g_
 = "bfiDMvX", },

273 
	gshiá
 = 5, 
	gmask
 = 3,

274 [0] = { 
shiá
 = 0, 
	gmask
 = 15, [15] = "bfcDvX", 
	g_
 = "bfiDMvX", },

277 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "ubfxDMvw",

280 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "ubfxDMvw",

284 
loÿl
 
	gm­_lßd
 = {

285 
shiá
 = 21, 
	gmask
 = 9,

287 
	gshiá
 = 20, 
	gmask
 = 5,

290 
	g_
 = {

291 
shiá
 = 20, 
	gmask
 = 5,

296 
loÿl
 
	gm­_lßd1
 = {

297 
shiá
 = 4, 
	gmask
 = 1,

298 [0] = 
m­_lßd
, 
	gm­_medŸ
,

301 
loÿl
 
	gm­_lßdm
 = {

302 
shiá
 = 20, 
	gmask
 = 1,

304 
shiá
 = 23, 
	gmask
 = 3,

306 { 
	gshiá
 = 16, 
	gmask
 = 63, [45] = "pushR", 
	g_
 = "stmdbNR", }, "stmibNR",

309 
	gshiá
 = 23, 
	gmask
 = 3,

310 [0] = "ldmdaNR", { 
	gshiá
 = 16, 
	gmask
 = 63, [61] = "pİR", 
	g_
 = "ldmNR", },

315 
loÿl
 
	gm­_d©a
 = {

316 
shiá
 = 21, 
	gmask
 = 15,

323 
loÿl
 
	gm­_mul
 = {

324 
shiá
 = 21, 
	gmask
 = 7,

329 
loÿl
 
	gm­_sync
 = {

330 
shiá
 = 20, 
	gmask
 = 15, -- 
	gNYI
: 
b¿ck‘s
 
¬ound
 
N
. 
R
(
D
+1è
ld»xd
/
¡»xd
.

331 [0] = "swpDMN", 
	gçl£
, false, false,

332 "swpbDMN", 
	gçl£
, false, false,

337 
loÿl
 
	gm­_mulh
 = {

338 
shiá
 = 21, 
	gmask
 = 3,

339 [0] = { 
shiá
 = 5, 
	gmask
 = 3,

341 { 
	gshiá
 = 5, 
	gmask
 = 3,

343 { 
	gshiá
 = 5, 
	gmask
 = 3,

345 { 
	gshiá
 = 5, 
	gmask
 = 3,

349 
loÿl
 
	gm­_misc
 = {

350 
shiá
 = 4, 
	gmask
 = 7,

351 -- 
	gNYI
: 
decode
 
PSR
 
b™s
 
of
 
m¤
.

352 [0] = { 
shiá
 = 21, 
	gmask
 = 1, [0] = "mrsD", "msrM", },

353 { 
	gshiá
 = 21, 
	gmask
 = 3, "bxM", 
	gçl£
, "clzDM", },

354 { 
	gshiá
 = 21, 
	gmask
 = 3, "bxjM", },

355 { 
	gshiá
 = 21, 
	gmask
 = 3, "blxM", },

356 
	gçl£
,

357 { 
	gshiá
 = 21, 
	gmask
 = 3, [0] = "qaddDMN", "qsubDMN", "qdaddDMN", "qdsubDMN", },

358 
	gçl£
,

359 { 
	gshiá
 = 21, 
	gmask
 = 3, "bkptK", },

362 
loÿl
 
	gm­_d©¬
 = {

363 
shiá
 = 4, 
	gmask
 = 9,

365 
shiá
 = 5, 
	gmask
 = 3,

366 [0] = { 
shiá
 = 24, 
	gmask
 = 1, [0] = 
m­_mul
, 
	gm­_sync
, },

367 { 
	gshiá
 = 20, 
	gmask
 = 1, [0] = "strhDL", "ldrhDL", },

368 { 
	gshiá
 = 20, 
	gmask
 = 1, [0] = "ldrdDL", "ldrsbDL", },

369 { 
	gshiá
 = 20, 
	gmask
 = 1, [0] = "strdDL", "ldrshDL", },

371 
	g_
 = {

372 
shiá
 = 20, 
	gmask
 = 25,

373 [16] = { 
shiá
 = 7, 
	gmask
 = 1, [0] = 
m­_misc
, 
	gm­_mulh
, },

374 
	g_
 = {

375 
shiá
 = 0, 
	gmask
 = 0xffffffff,

376 [
bÜ
(0xe1a00000)] = "nop",

377 
	g_
 = 
m­_d©a
,

382 
loÿl
 
	gm­_d©ai
 = {

383 
shiá
 = 20, 
	gmask
 = 31, -- 
	gNYI
: 
decode
 
PSR
 
b™s
 
of
 
m¤
. 
Decode
 
imm12
.

385 [18] = { 
shiá
 = 0, 
	gmask
 = 0xf00ff, [0] = "nİv6", 
	g_
 = "msrNW", },

387 
	g_
 = 
m­_d©a
,

390 
loÿl
 
	gm­_b¿nch
 = {

391 
shiá
 = 24, 
	gmask
 = 1,

395 
loÿl
 
	gm­_cÚdšs
 = {

396 [0] = 
m­_d©¬
, 
	gm­_d©ai
, 
	gm­_lßd
, 
	gm­_lßd1
,

397 
	gm­_lßdm
, 
	gm­_b¿nch
, 
	gm­_lßdc
, 
	gm­_d©ac


400 -- 
	gNYI
: 
£‹nd
.

401 
loÿl
 
m­_uncÚdšs
 = {

402 [0] = 
çl£
, 
	gm­_simdd©a
, 
	gm­_simdlßd
, 
	gm­_´–ßd
,

403 
	gçl£
, "blxB", 
	gm­_lßdcu
, 
	gm­_d©acu
,

408 
loÿl
 
	gm­_g´
 = {

413 
loÿl
 
	gm­_cÚd
 = {

418 
loÿl
 
	gm­_shiá
 = { [0] = "lsl", "lsr", "asr", "ror", }

422 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

423 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

424 
loÿl
 
pos
 = 
ùx
.pos

425 
loÿl
 
exŒa
 = ""

426 
ùx
.
»l
 
th’


427 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

428 
sym
 
th’


429 
exŒa
 = "\t->"..
sym


430 
–£if
 
	`bªd
(
ùx
.
İ
, 0x0e000000è~ğ0x0a000000 
th’


431 
exŒa
 = "\t; 0x"..
	$tohex
(
ùx
.
»l
)

432 
’d


433 
’d


434 
ùx
.
hexdump
 > 0 
th’


435 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-5s %s%s\n",

436 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

438 
ùx
.
	`out
(
	`fÜm©
("%08x %-5s %s%s\n",

439 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

440 
’d


441 
ùx
.
pos
 =…os + 4

442 
’d


444 -- 
F®lback
 
unknown
 
İcodes
.

445 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

446  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

447 
	g’d


449 -- 
FÜm©
 
	gİ”ªd
 2 
of
 
	glßd
/
¡Üe
 
	gİcodes
.

450 
loÿl
 
funùiÚ
 
	$fmßd
(
ùx
, 
İ
, 
pos
)

451 
loÿl
 
ba£
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 15)]

452 
loÿl
 
x
, 
ofs


453 
loÿl
 
ext
 = (
	`bªd
(
İ
, 0x04000000) == 0)

454 
nÙ
 
ext
 
ªd
 
	`bªd
(
İ
, 0x02000000è=ğ0 
th’


455 
ofs
 = 
	$bªd
(
İ
, 4095)

456 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = -of 
’d


457 
ba£
 =ğ"pc" 
th’
 
ùx
.
»l
 = ctx.
addr
 + 
pos
 + 8 + 
ofs
 
’d


458 
ofs
 = "#"..ofs

459 
–£if
 
ext
 
ªd
 
	`bªd
(
İ
, 0x00400000è~ğ0 
th’


460 
ofs
 = 
	`bªd
(
İ
, 15è+ bªd(
	`rshiá
(op, 4), 0xf0)

461 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = -of 
’d


462 
ba£
 =ğ"pc" 
th’
 
ùx
.
»l
 = ctx.
addr
 + 
pos
 + 8 + 
ofs
 
’d


463 
ofs
 = "#"..ofs

465 
ofs
 = 
m­_g´
[
	`bªd
(
İ
, 15)]

466 
ext
 
Ü
 
	`bªd
(
İ
, 0xã0è=ğ0 
th’


467 
–£if
 
	`bªd
(
İ
, 0xã0è=ğ0x60 
th’


468 
ofs
 = 
	`fÜm©
("%s,„rx", ofs)

470 
loÿl
 
sh
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

471 
sh
 =ğ0 
th’
 sh = 32 
’d


472 
ofs
 = 
	`fÜm©
("%s, % #%d", ofs, 
m­_shiá
[
	`bªd
(
	`rshiá
(
İ
, 5), 3)], 
sh
)

473 
’d


474 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = "-"..of 
’d


475 
’d


476 
ofs
 =ğ"#0" 
th’


477 
x
 = 
	`fÜm©
("[%s]", 
ba£
)

478 
–£if
 
	`bªd
(
İ
, 0x01000000è=ğ0 
th’


479 
x
 = 
	`fÜm©
("[%s], %s", 
ba£
, 
ofs
)

481 
x
 = 
	`fÜm©
("[%s, %s]", 
ba£
, 
ofs
)

482 
’d


483 
	`bªd
(
İ
, 0x01200000è=ğ0x01200000 
th’
 
x
 = x.."!" 
’d


484  
x


485 
’d


487 -- 
FÜm©
 
İ”ªd
 2 
of
 
veùÜ
 
lßd
/
¡Üe
 
İcodes
.

488 
loÿl
 
funùiÚ
 
	$fmtvlßd
(
ùx
, 
İ
, 
pos
)

489 
loÿl
 
ba£
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 15)]

490 
loÿl
 
ofs
 = 
	`bªd
(
İ
, 255)*4

491 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = -of 
’d


492 
ba£
 =ğ"pc" 
th’
 
ùx
.
»l
 = ctx.
addr
 + 
pos
 + 8 + 
ofs
 
’d


493 
ofs
 =ğ0 
th’


494  
	`fÜm©
("[%s]", 
ba£
)

496  
	`fÜm©
("[%s, #%d]", 
ba£
, 
ofs
)

497 
’d


498 
’d


500 
loÿl
 
funùiÚ
 
	$fmtvr
(
İ
, 
vr
, 
sh0
, 
sh1
)

501 
vr
 =ğ"s" 
th’


502  
	`fÜm©
("s%d", 2*
	`bªd
(
	`rshiá
(
İ
, 
sh0
), 15)+bªdÔshiá(İ, 
sh1
), 1))

504  
	`fÜm©
("d%d", 
	`bªd
(
	`rshiá
(
İ
, 
sh0
), 15)+bªdÔshiá(İ, 
sh1
-4), 16))

505 
’d


506 
’d


508 -- 
Di§s£mbË
 
a
 
sšgË
 
š¡ruùiÚ
.

509 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

510 
loÿl
 
pos
 = 
ùx
.pos

511 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

512 
loÿl
 
İ
 = 
	`bÜ
(
	`lshiá
(
b3
, 24),†shiá(
b2
, 16),†shiá(
b1
, 8), 
b0
)

513 
loÿl
 
İ”ªds
 = {
	}
}

514 
loÿl
 
suffix
 = ""

515 
loÿl
 
Ï¡
, 
	gÇme
, 
·t


516 
loÿl
 
vr


517 
	gùx
.
	gİ
 = 
İ


518 
ùx
.
»l
 = 
n


520 
loÿl
 
cÚd
 = 
	$rshiá
(
İ
, 28)

521 
loÿl
 
İ©


522 
cÚd
 =ğ15 
th’


523 
İ©
 = 
m­_uncÚdšs
[
	`bªd
(
	`rshiá
(
İ
, 25), 7)]

525 
cÚd
 ~ğ14 
th’
 
suffix
 = 
m­_cÚd
[cÚd] 
’d


526 
İ©
 = 
m­_cÚdšs
[
	`bªd
(
	`rshiá
(
İ
, 25), 7)]

527 
’d


528 
	`ty³
(
İ©
) ~= "string" do

529 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


530 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)] 
Ü
 o·t.
_


531 
’d


532 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9]*)(.*)")

533 
	`sub
(
·t
, 1, 1è=ğ"." 
th’


534 
loÿl
 
s2
, 
p2
 = 
	`m©ch
(
·t
, "^([a-z0-9.]*)(.*)")

535 
suffix
 = suffix..
s2


536 
·t
 = 
p2


537 
’d


539 
p
 
š
 
	`gm©ch
(
·t
, ".") do

540 
loÿl
 
x
 = 
n


541 
p
 =ğ"D" 
th’


542 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 12), 15)]

543 
–£if
 
p
 =ğ"N" 
th’


544 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 15)]

545 
–£if
 
p
 =ğ"S" 
th’


546 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 8), 15)]

547 
–£if
 
p
 =ğ"M" 
th’


548 
x
 = 
m­_g´
[
	`bªd
(
İ
, 15)]

549 
–£if
 
p
 =ğ"d" 
th’


550 
x
 = 
	$fmtvr
(
İ
, 
vr
, 12, 22)

551 
–£if
 
p
 =ğ"n" 
th’


552 
x
 = 
	$fmtvr
(
İ
, 
vr
, 16, 7)

553 
–£if
 
p
 =ğ"m" 
th’


554 
x
 = 
	$fmtvr
(
İ
, 
vr
, 0, 5)

555 
–£if
 
p
 =ğ"P" 
th’


556 
	`bªd
(
İ
, 0x02000000è~ğ0 
th’


557 
x
 = 
	`rÜ
(
	`bªd
(
İ
, 255), 2*bªd(
	`rshiá
(op, 8), 15))

559 
x
 = 
m­_g´
[
	`bªd
(
İ
, 15)]

560 
	`bªd
(
İ
, 0xff0è~ğ0 
th’


561 
İ”ªds
[#İ”ªds+1] = 
x


562 
loÿl
 
s
 = 
m­_shiá
[
	`bªd
(
	`rshiá
(
İ
, 5), 3)]

563 
loÿl
 
r
 = 
n


564 
	`bªd
(
İ
, 0xf90è=ğ0 
th’


565 
s
 =ğ"rÜ" 
th’
 s = "¼x" 
r
 = "#32" 
’d


566 
–£if
 
	`bªd
(
İ
, 0x10è=ğ0 
th’


567 
r
 = "#"..
	`bªd
(
	`rshiá
(
İ
, 7), 31)

569 
r
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 8), 15)]

570 
’d


571 
Çme
 =ğ"mov" 
th’
‚amğ
s
; 
x
 = 
r


572 
–£if
 
r
 
th’
 
x
 = 
	`fÜm©
("% %s", 
s
,„)

573 
x
 = 
s
 
’d


574 
’d


575 
’d


576 
–£if
 
p
 =ğ"L" 
th’


577 
x
 = 
	$fmßd
(
ùx
, 
İ
, 
pos
)

578 
–£if
 
p
 =ğ"l" 
th’


579 
x
 = 
	$fmtvlßd
(
ùx
, 
İ
, 
pos
)

580 
–£if
 
p
 =ğ"B" 
th’


581 
loÿl
 
addr
 = 
ùx
.add¸+ 
pos
 + 8 + 
	`¬shiá
(
	`lshiá
(
İ
, 8), 6)

582 
cÚd
 =ğ15 
th’
 
addr
 =‡dd¸+ 
	`bªd
(
	`rshiá
(
İ
, 23), 2è
’d


583 
ùx
.
»l
 = 
addr


584 
x
 = "0x"..
	$tohex
(
addr
)

585 
–£if
 
p
 =ğ"F" 
th’


586 
vr
 = "s"

587 
–£if
 
p
 =ğ"G" 
th’


588 
vr
 = "d"

589 
–£if
 
p
 =ğ"." 
th’


590 
suffix
 = suffix..(
vr
 =ğ"s" 
ªd
 ".f32" 
Ü
 ".f64")

591 
–£if
 
p
 =ğ"R" 
th’


592 
	`bªd
(
İ
, 0x00200000è~ğ0 
ªd
 #İ”ªd =ğ1 
th’


593 
İ”ªds
[1] = operands[1].."!"

594 
’d


595 
loÿl
 
t
 = {
	}
}

596 
i
=0,15 do

597 
bªd
(
rshiá
(
İ
, 
i
), 1è=ğ1 
th’
 
t
[#t+1] = 
m­_g´
[i] 
’d


598 
’d


599 
x
 = "{"..
cÚÿt
(
t
, ", ").."}"

600 
–£if
 
	gp
 =ğ"r" 
th’


601 
bªd
(
İ
, 0x00200000è~ğ0 
ªd
 #İ”ªd =ğ2 
th’


602 
İ”ªds
[1] = operands[1].."!"

603 
’d


604 
loÿl
 
s
 = 
tÚumb”
(
	$sub
(
Ï¡
, 2))

605 
loÿl
 
n
 = 
	$bªd
(
İ
, 255)

606 
vr
 =ğ"d" 
th’
 
n
 = 
	$rshiá
(
n
, 1è
’d


607 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("{%s-%s%d}", 
Ï¡
, 
vr
, 
s
+
n
-1)

608 
–£if
 
p
 =ğ"W" 
th’


609 
x
 = 
	`bªd
(
İ
, 0x0fffè+ bªd(
	`rshiá
(op, 4), 0xf000)

610 
–£if
 
p
 =ğ"T" 
th’


611 
x
 = "#0x"..
	`tohex
(
	`bªd
(
İ
, 0x00ffffff), 6)

612 
–£if
 
p
 =ğ"U" 
th’


613 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

614 
x
 =ğ0 
th’
 x = 
n
 
’d


615 
–£if
 
p
 =ğ"u" 
th’


616 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

617 
	`bªd
(
İ
, 0x40è=ğ0 
th’


618 
x
 =ğ0 
th’
 x = 
n
 x = "l¦ #"..x 
’d


620 
x
 =ğ0 
th’
 x = "a¤ #32" x = "a¤ #"..x 
’d


621 
’d


622 
–£if
 
p
 =ğ"v" 
th’


623 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

624 
–£if
 
p
 =ğ"w" 
th’


625 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

626 
–£if
 
p
 =ğ"x" 
th’


627 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31) + 1

628 
–£if
 
p
 =ğ"X" 
th’


629 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31è- 
Ï¡
 + 1

630 
–£if
 
p
 =ğ"Y" 
th’


631 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 12), 0xf0è+ 
	$bªd
(
İ
, 0x0f)

632 
–£if
 
p
 =ğ"K" 
th’


633 
x
 = "#0x"..
	`tohex
(
	`bªd
(
	`rshiá
(
İ
, 4), 0x0000fff0) + band(op, 15), 4)

634 
–£if
 
p
 =ğ"s" 
th’


635 
	`bªd
(
İ
, 0x00100000è~ğ0 
th’
 
suffix
 = "s"..suffix 
’d


637 
	$as£¹
(
çl£
)

638 
’d


639 
x
 
th’


640 
Ï¡
 = 
x


641 
	`ty³
(
x
è=ğ"numb”" 
th’
 x = "#"..x 
’d


642 
İ”ªds
[#İ”ªds+1] = 
x


643 
’d


644 
’d


646  
	$putİ
(
ùx
, 
Çme
..
suffix
, 
İ”ªds
)

647 
’d


651 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

652 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

653 
nÙ
 
ofs
 
th’
 of ğ0 
’d


654 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


655 
ùx
.
pos
 = 
ofs


656 
ùx
.
»l
 = 
n


657 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


658 
’d


660 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

661 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

662 
loÿl
 
ùx
 = {
	}
}

663 
ùx
.
code
 = code

664 
ùx
.
addr
 =‡dd¸
Ü
 0

665 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


666 
ùx
.
symb
 = {}

667 
ùx
.
di§ss
 = 
di§ss_block


668 
ùx
.
hexdump
 = 8

669  
ùx


670 
’d


672 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

673 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

674 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

675 
’d


677 -- 
R‘uº
 
Çme
 
RID
.

678 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

679 
r
 < 16 
th’
  
m­_g´
[r] 
’d


680  "d"..(
r
-16)

681 
’d


683 -- 
Public
 
moduË
 
funùiÚs
.

685 
ü—‹
 = create,

686 
di§ss
 = disass,

687 
»gÇme
 =„egname

688 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_arm64.lua

2 -- 
LuaJIT
 
ARM64
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
CÚŒibu‹d
 
by
 
DjÜdje
 
Kovaûvic
 
ªd
 
S‹çn
 
Pejic
 
äom
 
	gRT
-
	gRK
.
	gcom
.

8 -- 
SpÚsÜed
 
by
 
Cisco
 
	gSy¡ems
, 
	gInc
.

10 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

12 -- 
It
 
di§s£mbËs
 
mo¡
 
	gu£r
-
mode
 
AArch64
 
	gš¡ruùiÚs
.

13 -- 
	gNYI
: 
Advªûd
 
SIMD
 
ªd
 
VFP
 
š¡ruùiÚs
.

16 
loÿl
 
ty³
 =ype

17 
loÿl
 
sub
, 
	gby‹
, 
	gfÜm©
 = 
¡ršg
.sub, 
	g¡ršg
.by‹, sŒšg.
fÜm©


18 
loÿl
 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.gm©ch, sŒšg.
gsub


19 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


20 
loÿl
 
b™
 = 
»quœe
("bit")

21 
loÿl
 
bªd
, 
	gbÜ
, 
	gbxÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.bxÜ, b™.
tohex


22 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshiá, b™.
¬shiá


23 
loÿl
 
	grÜ
 = 
b™
.
rÜ


26 -- 
Opcode
 
m­s


29 
loÿl
 
m­_adr
 = { -- 
PC
-
»Ïtive
 
add»ssšg
.

30 
shiá
 = 31, 
	gmask
 = 1,

34 
loÿl
 
	gm­_addsubi
 = { -- 
Add
/
subŒaù
 
immedŸ‹
.

35 
shiá
 = 29, 
	gmask
 = 3,

39 
loÿl
 
	gm­_logi
 = { -- 
Logiÿl
 
immedŸ‹
.

40 
shiá
 = 31, 
	gmask
 = 1,

42 
shiá
 = 22, 
	gmask
 = 1,

44 
shiá
 = 29, 
	gmask
 = 3,

47 
	gçl£
 -- 
	guÇÎoÿ‹d


50 
	gshiá
 = 29, 
	gmask
 = 3,

55 
loÿl
 
	gm­_movwi
 = { -- 
Move
 
wide
 
immedŸ‹
.

56 
shiá
 = 31, 
	gmask
 = 1,

58 
shiá
 = 22, 
	gmask
 = 1,

60 
shiá
 = 29, 
	gmask
 = 3,

61 [0] = "movnDWRg", 
	gçl£
, "movz|movDYRg", "movkDWRg"

62 }, 
	gçl£
 -- 
	guÇÎoÿ‹d


65 
	gshiá
 = 29, 
	gmask
 = 3,

66 [0] = "movnDWRg", 
	gçl£
, "movz|movDYRg", "movkDWRg"

70 
loÿl
 
	gm­_b™f
 = { -- 
B™f›ld
.

71 
shiá
 = 31, 
	gmask
 = 1,

73 
shiá
 = 22, 
	gmask
 = 1,

75 
shiá
 = 29, 
	gmask
 = 3,

82 
	gshiá
 = 22, 
	gmask
 = 1,

84 
	gshiá
 = 29, 
	gmask
 = 3,

92 
loÿl
 
	gm­_d©ai
 = { -- 
D©a
 
´oûssšg
 - 
immedŸ‹
.

93 
shiá
 = 23, 
	gmask
 = 7,

94 [0] = 
m­_adr
, 
	gm­_adr
, 
	gm­_addsubi
, 
	gçl£
,

95 
	gm­_logi
, 
	gm­_movwi
, 
	gm­_b™f
,

97 
	gshiá
 = 15, 
	gmask
 = 0x1c0c1,

103 
loÿl
 
	gm­_log¤
 = { -- 
Logiÿl
, 
shiáed
 .

104 
shiá
 = 31, 
	gmask
 = 1,

106 
shiá
 = 15, 
	gmask
 = 1,

108 
shiá
 = 29, 
	gmask
 = 3,

110 
shiá
 = 21, 
	gmask
 = 7,

115 
	gshiá
 = 21, 
	gmask
 = 7,

120 
	gshiá
 = 21, 
	gmask
 = 7,

125 
	gshiá
 = 21, 
	gmask
 = 7,

130 
	gçl£
 -- 
	guÇÎoÿ‹d


133 
	gshiá
 = 29, 
	gmask
 = 3,

135 
shiá
 = 21, 
	gmask
 = 7,

140 
	gshiá
 = 21, 
	gmask
 = 7,

145 
	gshiá
 = 21, 
	gmask
 = 7,

150 
	gshiá
 = 21, 
	gmask
 = 7,

157 
loÿl
 
	gm­_assh
 = {

158 
shiá
 = 31, 
	gmask
 = 1,

160 
shiá
 = 15, 
	gmask
 = 1,

162 
shiá
 = 29, 
	gmask
 = 3,

164 
shiá
 = 22, 
	gmask
 = 3,

168 
	gshiá
 = 22, 
	gmask
 = 3,

173 
	gshiá
 = 22, 
	gmask
 = 3,

177 
	gshiá
 = 22, 
	gmask
 = 3,

182 
	gçl£
 -- 
	guÇÎoÿ‹d


185 
	gshiá
 = 29, 
	gmask
 = 3,

187 
shiá
 = 22, 
	gmask
 = 3,

191 
	gshiá
 = 22, 
	gmask
 = 3,

196 
	gshiá
 = 22, 
	gmask
 = 3,

200 
	gshiá
 = 22, 
	gmask
 = 3,

207 
loÿl
 
	gm­_addsubsh
 = { -- 
Add
/
subŒaù
, 
shiáed
 .

208 
shiá
 = 22, 
	gmask
 = 3,

209 [0] = 
m­_assh
, 
	gm­_assh
, map_assh

212 
loÿl
 
	gm­_addsubex
 = { -- 
Add
/
subŒaù
, 
ex‹nded
 .

213 
shiá
 = 22, 
	gmask
 = 3,

215 
shiá
 = 29, 
	gmask
 = 3,

220 
loÿl
 
	gm­_addsubc
 = { -- 
Add
/
subŒaù
, 
w™h
 
ÿ¼y
.

221 
shiá
 = 10, 
	gmask
 = 63,

223 
shiá
 = 29, 
	gmask
 = 3,

228 
loÿl
 
	gm­_ccomp
 = {

229 
shiá
 = 4, 
	gmask
 = 1,

231 
shiá
 = 10, 
	gmask
 = 3,

232 [0] = { -- 
CÚd™iÚ®
 
com·»
 .

233 
shiá
 = 29, 
	gmask
 = 3,

234 "ccmnNMVCg", 
	gçl£
, "ccmpNMVCg",

236 [2] = { -- 
CÚd™iÚ®
 
com·»
 
immedŸ‹
.

237 
shiá
 = 29, 
	gmask
 = 3,

238 "ccmnN5VCg", 
	gçl£
, "ccmpN5VCg",

243 
loÿl
 
	gm­_c£l
 = { -- 
CÚd™iÚ®
 
£Ëù
.

244 
shiá
 = 11, 
	gmask
 = 1,

246 
shiá
 = 10, 
	gmask
 = 1,

248 
shiá
 = 29, 
	gmask
 = 3,

249 [0] = "c£lDNMzCg", 
	gçl£
, "csinv|cinv|csetmDNMcg", false,

252 
	gshiá
 = 29, 
	gmask
 = 3,

253 [0] = "csšc|cšc|c£tDNMcg", 
	gçl£
, "csneg|cnegDNMcg", false,

258 
loÿl
 
	gm­_d©a1s
 = { -- 
D©a
 
´oûssšg
, 1 
sourû
.

259 
shiá
 = 29, 
	gmask
 = 1,

261 
shiá
 = 31, 
	gmask
 = 1,

263 
shiá
 = 10, 
	gmask
 = 0x7ff,

264 [0] = "rb™DNg", "»v16DNg", "»vDNw", 
	gçl£
, "clzDNg", "clsDNg"

267 
	gshiá
 = 10, 
	gmask
 = 0x7ff,

273 
loÿl
 
	gm­_d©a2s
 = { -- 
D©a
 
´oûssšg
, 2 
sourûs
.

274 
shiá
 = 29, 
	gmask
 = 1,

276 
shiá
 = 10, 
	gmask
 = 63,

277 
	gçl£
, "udivDNMg", "sdivDNMg", false, false, false, false, "lslDNMg",

282 
loÿl
 
	gm­_d©a3s
 = { -- 
D©a
 
´oûssšg
, 3 
sourûs
.

283 
shiá
 = 29, 
	gmask
 = 7,

285 
shiá
 = 21, 
	gmask
 = 7,

287 
shiá
 = 15, 
	gmask
 = 1,

290 }, 
	gçl£
, false, false,

292 
	gshiá
 = 15, 
	gmask
 = 1,

294 
shiá
 = 21, 
	gmask
 = 7,

295 [0] = "madd|mulDNMA0g", "smaddl|smuÎDxNMwA0x", "smulhDNMx", 
	gçl£
,

296 
	gçl£
, "umaddl|umullDxNMwA0x", "umulhDNMx"

299 
	gshiá
 = 21, 
	gmask
 = 7,

300 [0] = "msub|mÃgDNMA0g", "smsubl|smÃglDxNMwA0x", 
	gçl£
, false,

301 
	gçl£
, "umsubl|umneglDxNMwA0x"

306 
loÿl
 
	gm­_d©¬
 = { -- 
D©a
 
´oûssšg
, .

307 
shiá
 = 28, 
	gmask
 = 1,

309 
shiá
 = 24, 
	gmask
 = 1,

310 [0] = 
m­_log¤
,

312 
	gshiá
 = 21, 
	gmask
 = 1,

313 [0] = 
m­_addsubsh
, 
	gm­_addsubex


317 
	gshiá
 = 21, 
	gmask
 = 15,

318 [0] = 
m­_addsubc
, 
	gçl£
, 
	gm­_ccomp
, f®£, 
	gm­_c£l
, false,

320 
	gshiá
 = 30, 
	gmask
 = 1,

321 [0] = 
m­_d©a2s
, 
	gm­_d©a1s


323 
	gçl£
, 
	gm­_d©a3s
, map_data3s, map_data3s, map_data3s, map_data3s,

324 
	gm­_d©a3s
, map_data3s, map_data3s

328 
loÿl
 
	gm­_Ìl
 = { -- 
Lßd
 , 
l™”®
.

329 
shiá
 = 26, 
	gmask
 = 1,

331 
shiá
 = 30, 
	gmask
 = 3,

335 
	gshiá
 = 30, 
	gmask
 = 3,

340 
loÿl
 
	gm­_l¤išd
 = { -- 
Lßd
/
¡Üe
 , 
immedŸ‹
 
´e
/
po¡
-
šdexed
.

341 
shiá
 = 30, 
	gmask
 = 3,

343 
shiá
 = 26, 
	gmask
 = 1,

345 
shiá
 = 22, 
	gmask
 = 3,

350 
	gshiá
 = 26, 
	gmask
 = 1,

352 
shiá
 = 22, 
	gmask
 = 3,

357 
	gshiá
 = 26, 
	gmask
 = 1,

359 
shiá
 = 22, 
	gmask
 = 3,

363 
	gshiá
 = 22, 
	gmask
 = 3,

368 
	gshiá
 = 26, 
	gmask
 = 1,

370 
shiá
 = 22, 
	gmask
 = 3,

374 
	gshiá
 = 22, 
	gmask
 = 3,

380 
loÿl
 
	gm­_l¤œo
 = {

381 
shiá
 = 21, 
	gmask
 = 1,

382 [0] = { -- 
Lßd
/
¡Üe
 
immedŸ‹
.

383 
shiá
 = 10, 
	gmask
 = 3,

384 [0] = { -- 
UnsÿËd
 
immedŸ‹
.

385 
shiá
 = 26, 
	gmask
 = 1,

387 
shiá
 = 30, 
	gmask
 = 3,

389 
shiá
 = 22, 
	gmask
 = 3,

393 
	gshiá
 = 22, 
	gmask
 = 3,

397 
	gshiá
 = 22, 
	gmask
 = 3,

401 
	gshiá
 = 22, 
	gmask
 = 3,

405 }, 
	gm­_l¤išd
, 
	gçl£
, map_lsriind

407 { -- 
	gLßd
/
¡Üe
 , 
	goff£t
.

408 
	gshiá
 = 10, 
	gmask
 = 3,

410 
shiá
 = 26, 
	gmask
 = 1,

412 
shiá
 = 30, 
	gmask
 = 3,

414 
shiá
 = 22, 
	gmask
 = 3,

418 
	gshiá
 = 22, 
	gmask
 = 3,

422 
	gshiá
 = 22, 
	gmask
 = 3,

426 
	gshiá
 = 22, 
	gmask
 = 3,

431 
	gshiá
 = 30, 
	gmask
 = 3,

433 
shiá
 = 22, 
	gmask
 = 3,

437 
shiá
 = 22, 
	gmask
 = 3,

445 
loÿl
 
	gm­_l¥
 = { -- 
Lßd
/
¡Üe
 
·œ
, 
off£t
.

446 
shiá
 = 22, 
	gmask
 = 1,

448 
shiá
 = 30, 
	gmask
 = 3,

450 
shiá
 = 26, 
	gmask
 = 1,

454 
	gshiá
 = 26, 
	gmask
 = 1,

458 
	gshiá
 = 26, 
	gmask
 = 1,

463 
	gshiá
 = 30, 
	gmask
 = 3,

465 
shiá
 = 26, 
	gmask
 = 1,

469 
	gshiá
 = 26, 
	gmask
 = 1,

473 
	gshiá
 = 26, 
	gmask
 = 1,

479 
loÿl
 
	gm­_ls
 = { -- 
Lßds
 
ªd
 
¡Ües
.

480 
shiá
 = 24, 
	gmask
 = 0x31,

481 [0x10] = 
m­_Ìl
, [0x30] = 
m­_l¤œo
,

483 
shiá
 = 23, 
	gmask
 = 3,

484 
	gm­_l¥
, map_lsp, map_lsp

487 
shiá
 = 23, 
	gmask
 = 3,

488 
	gm­_l¥
, map_lsp, map_lsp

491 
shiá
 = 26, 
	gmask
 = 1,

493 
shiá
 = 30, 
	gmask
 = 3,

495 
shiá
 = 22, 
	gmask
 = 3,

499 
	gshiá
 = 22, 
	gmask
 = 3,

503 
	gshiá
 = 22, 
	gmask
 = 3,

507 
	gshiá
 = 22, 
	gmask
 = 3,

512 
	gshiá
 = 30, 
	gmask
 = 3,

514 
shiá
 = 22, 
	gmask
 = 3,

518 
shiá
 = 22, 
	gmask
 = 3,

525 
loÿl
 
	gm­_d©aå
 = { -- 
D©a
 
´oûssšg
, 
SIMD
 
ªd
 
FP
.

526 
shiá
 = 28, 
	gmask
 = 7,

528 
	gshiá
 = 24, 
	gmask
 = 1,

530 
shiá
 = 21, 
	gmask
 = 1,

532 
	gshiá
 = 10, 
	gmask
 = 3,

534 
shiá
 = 12, 
	gmask
 = 1,

536 
shiá
 = 13, 
	gmask
 = 1,

538 
shiá
 = 14, 
	gmask
 = 1,

540 
shiá
 = 15, 
	gmask
 = 1,

541 [0] = { -- 
FP
/
cÚv”siÚ
.

542 
shiá
 = 31, 
	gmask
 = 1,

544 
shiá
 = 16, 
	gmask
 = 0xff,

560 
	gshiá
 = 16, 
	gmask
 = 0xff,

577 { -- 
FP
 
	gd©a
-
	g´oûssšg
, 1 
	gsourû
.

578 
	gshiá
 = 31, 
	gmask
 = 1,

580 
shiá
 = 22, 
	gmask
 = 3,

582 
shiá
 = 15, 
	gmask
 = 63,

584 "fsq¹DNf", 
	gçl£
, "fcvtDdNs", false, false,

586 "äšDNf", 
	gçl£
, "frintxDNf", "frintiDNf",

589 
	gshiá
 = 15, 
	gmask
 = 63,

591 "fsq¹DNf", "fcvtDsNd", 
	gçl£
, false, false,

593 "äšDNf", 
	gçl£
, "frintxDNf", "frintiDNf",

598 { -- 
FP
 
	gcom·»
.

599 
	gshiá
 = 31, 
	gmask
 = 1,

601 
shiá
 = 14, 
	gmask
 = 3,

603 
shiá
 = 23, 
	gmask
 = 1,

605 
shiá
 = 0, 
	gmask
 = 31,

613 { -- 
FP
 
	gimmedŸ‹
.

614 
	gshiá
 = 31, 
	gmask
 = 1,

616 
shiá
 = 5, 
	gmask
 = 31,

618 
shiá
 = 23, 
	gmask
 = 1,

624 { -- 
FP
 
cÚd™iÚ®
 
	gcom·»
.

625 
	gshiá
 = 31, 
	gmask
 = 1,

627 
shiá
 = 23, 
	gmask
 = 1,

629 
shiá
 = 4, 
	gmask
 = 1,

634 { -- 
FP
 
	gd©a
-
	g´oûssšg
, 2 
	gsourûs
.

635 
	gshiá
 = 31, 
	gmask
 = 1,

637 
shiá
 = 23, 
	gmask
 = 1,

639 
shiá
 = 12, 
	gmask
 = 15,

646 { -- 
FP
 
cÚd™iÚ®
 
	g£Ëù
.

647 
	gshiá
 = 31, 
	gmask
 = 1,

649 
shiá
 = 23, 
	gmask
 = 1,

655 { -- 
FP
 
	gd©a
-
	g´oûssšg
, 3 
	gsourûs
.

656 
	gshiá
 = 31, 
	gmask
 = 1,

658 
shiá
 = 15, 
	gmask
 = 1,

660 
shiá
 = 21, 
	gmask
 = 5,

664 
	gshiá
 = 21, 
	gmask
 = 5,

672 
loÿl
 
	gm­_br
 = { -- 
B¿nches
, 
exû±iÚ
 
g’”©šg
 
ªd
 
sy¡em
 
š¡ruùiÚs
.

673 
shiá
 = 29, 
	gmask
 = 7,

675 { -- 
	gCom·»
 & 
	gb¿nch
, 
	gimmedŸ‹
.

676 
	gshiá
 = 24, 
	gmask
 = 3,

679 { -- 
CÚd™iÚ®
 
	gb¿nch
, 
	gimmedŸ‹
.

680 
	gshiá
 = 24, 
	gmask
 = 3,

682 
shiá
 = 4, 
	gmask
 = 1,

684 
shiá
 = 0, 
	gmask
 = 15,

689 }, 
	gçl£
, "blB",

690 { -- 
	gCom·»
 & 
	gb¿nch
, 
	gimmedŸ‹
.

691 
	gshiá
 = 24, 
	gmask
 = 3,

695 
	gshiá
 = 24, 
	gmask
 = 3,

696 [0] = { -- 
Exû±iÚ
 
g’”©iÚ
.

697 
shiá
 = 0, 
	gmask
 = 0xe0001f,

700 { -- 
Sy¡em
 
	gš¡ruùiÚs
.

701 
	gshiá
 = 0, 
	gmask
 = 0x3fffff,

704 { -- 
UncÚd™iÚ®
 
	gb¿nch
, .

705 
	gshiá
 = 0, 
	gmask
 = 0xfffc1f,

712 
loÿl
 
	gm­_š™
 = {

713 
shiá
 = 25, 
	gmask
 = 15,

714 [0] = 
çl£
, 
	gçl£
, f®£, f®£, 
	gm­_ls
, 
	gm­_d©¬
, m­_ls, 
	gm­_d©aå
,

715 
	gm­_d©ai
, m­_d©ai, 
	gm­_br
, m­_br, 
	gm­_ls
, 
	gm­_d©¬
, m­_ls, 
	gm­_d©aå


720 
loÿl
 
	gm­_»gs
 = { 
x
 = {}, 
	gw
 = {}, 
	gd
 = {}, 
	gs
 = {} }

722 
	gi
=0,30 do

723 
	gm­_»gs
.
	gx
[
i
] = "x"..i

724 
m­_»gs
.
w
[
i
] = "w"..i

725 
m­_»gs
.
d
[
i
] = "d"..i

726 
m­_»gs
.
s
[
i
] = "s"..i

727 
’d


728 
m­_»gs
.
x
[31] = "sp"

729 
m­_»gs
.
w
[31] = "wsp"

730 
m­_»gs
.
d
[31] = "d31"

731 
m­_»gs
.
s
[31] = "s31"

733 
loÿl
 
m­_cÚd
 = {

738 
loÿl
 
	gm­_shiá
 = { [0] = "lsl", "lsr", "asr", }

740 
loÿl
 
	gm­_ex‹nd
 = {

746 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

747 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

748 
loÿl
 
pos
 = 
ùx
.pos

749 
loÿl
 
exŒa
 = ""

750 
ùx
.
»l
 
th’


751 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

752 
sym
 
th’


753 
exŒa
 = "\t->"..
sym


754 
’d


755 
’d


756 
ùx
.
hexdump
 > 0 
th’


757 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-5s %s%s\n",

758 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

760 
ùx
.
	`out
(
	`fÜm©
("%08x %-5s %s%s\n",

761 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

762 
’d


763 
ùx
.
pos
 =…os + 4

764 
’d


766 -- 
F®lback
 
unknown
 
İcodes
.

767 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

768  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

769 
’d


771 
loÿl
 
funùiÚ
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

772  
m­_»gs
[
	`m©ch
(
·t
, 
p
.."%w-([xwds])")][
»gnum
]

773 
’d


775 
loÿl
 
funùiÚ
 
	$fmt_hex32
(
x
)

776 
x
 < 0 
th’


777  
	$tohex
(
x
)

779  
	`fÜm©
("%x", 
x
)

780 
’d


781 
’d


783 
loÿl
 
imm13_»p
 = { 0x55555555, 0x11111111, 0x01010101, 0x00010001, 0x00000001 
	}
}

785 
loÿl
 
funùiÚ
 
	$decode_imm13
(
İ
)

786 
loÿl
 
imms
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

787 
loÿl
 
immr
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 63)

788 
	`bªd
(
İ
, 0x00400000è=ğ0 
th’


789 
loÿl
 
Ën
 = 5

790 
imms
 >ğ56 
th’


791 
imms
 >ğ60 
th’
 
Ën
 = 1 ËÀğ2 
’d


792 
–£if
 
imms
 >ğ48 
th’
 
Ën
 = 3ƒl£iàimm >ğ32h’†’ = 4 
’d


793 
loÿl
 
l
 = 
	`lshiá
(1, 
Ën
)-1

794 
loÿl
 
s
 = 
	$bªd
(
imms
, 
l
)

795 
loÿl
 
r
 = 
	$bªd
(
immr
, 
l
)

796 
loÿl
 
imm
 = 
	`rÜ
(
	`rshiá
(-1, 31-
s
), 
r
)

797 
Ën
 ~ğ5 
th’
 
imm
 = 
	`bªd
(imm, 
	`lshiá
(1, 
l
)-1è+ 
	`rshiá
(imm, 31-lè
’d


798 
imm
 = imm * 
imm13_»p
[
Ën
]

799 
loÿl
 
ix
 = 
	$fmt_hex32
(
imm
)

800 
	`rshiá
(
İ
, 31è~ğ0 
th’


801  
ix
..
	$tohex
(
imm
)

803  
ix


804 
’d


806 
loÿl
 
lo
, 
hi
 = -1, 0

807 
imms
 < 32 
th’
 
lo
 = 
	`rshiá
(-1, 31-immsè
hi
 =„shiá(-1, 63-immsè
’d


808 
immr
 ~ğ0 
th’


809 
lo
, 
hi
 = 
	`rÜ
Öo, 
immr
), 
	$rÜ
(
hi
, 
immr
)

810 
loÿl
 
x
 = 
immr
 =ğ32 
ªd
 0 
Ü
 
	`bªd
(
	`bxÜ
(
lo
, 
hi
), 
	`lshiá
(-1, 32-immr))

811 
lo
, 
hi
 = 
	`bxÜ
Öo, 
x
), 
	$bxÜ
(
hi
, 
x
)

812 
immr
 >ğ32 
th’
 
lo
, 
hi
 = hi,†Ø
’d


813 
’d


814 
hi
 ~ğ0 
th’


815  
	`fmt_hex32
(
hi
)..
	$tohex
(
lo
)

817  
	$fmt_hex32
(
lo
)

818 
’d


819 
’d


820 
’d


822 
loÿl
 
funùiÚ
 
	$·r£_immpc
(
İ
, 
Çme
)

823 
Çme
 =ğ"b" 
Ü
‚am=ğ"bl" 
th’


824  
	`¬shiá
(
	`lshiá
(
İ
, 6), 4)

825 
–£if
 
Çme
 =ğ"adr" 
Ü
‚am=ğ"ad½" 
th’


826 
loÿl
 
immlo
 = 
	`bªd
(
	`rshiá
(
İ
, 29), 3)

827 
loÿl
 
immhi
 = 
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 8), 13), 2)

828  
	$bÜ
(
immhi
, 
immlo
)

829 
–£if
 
Çme
 =ğ"tbz" 
Ü
‚am=ğ"tbnz" 
th’


830  
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 13), 18), 2)

832  
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 8), 13), 2)

833 
’d


834 
’d


836 
loÿl
 
funùiÚ
 
	$·r£_åimm8
(
İ
)

837 
loÿl
 
sign
 = 
	`bªd
(
İ
, 0x100000è=ğ0 
ªd
 1 
Ü
 -1

838 
loÿl
 
exp
 = 
	`bxÜ
(
	`rshiá
(
	`¬shiá
(
	`lshiá
(
İ
, 12), 5), 24), 0x80) - 131

839 
loÿl
 
äac
 = 16+
	`bªd
(
	`rshiá
(
İ
, 13), 15)

840  
sign
 * 
äac
 * 2^
exp


841 
’d


843 
loÿl
 
funùiÚ
 
	$´eãr_bfx
(
sf
, 
uns
, 
imms
, 
immr
)

844 
imms
 < 
immr
 
Ü
 imm =ğ31 o¸imm =ğ63 
th’


845  
çl£


846 
’d


847 
immr
 =ğ0 
th’


848 
sf
 =ğ0 
	$ªd
 (
imms
 =ğ7 
Ü
 imm =ğ15è
th’


849  
çl£


850 
’d


851 
sf
 ~ğ0 
ªd
 
uns
 =ğ0 
	$ªd
 (
imms
 =ğ7 
Ü
 imm =ğ15 o¸imm =ğ31è
th’


852  
çl£


853 
’d


854 
’d


855  
Œue


856 
’d


858 -- 
Di§s£mbË
 
a
 
sšgË
 
š¡ruùiÚ
.

859 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

860 
loÿl
 
pos
 = 
ùx
.pos

861 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

862 
loÿl
 
İ
 = 
	`bÜ
(
	`lshiá
(
b3
, 24),†shiá(
b2
, 16),†shiá(
b1
, 8), 
b0
)

863 
loÿl
 
İ”ªds
 = {
	}
}

864 
loÿl
 
suffix
 = ""

865 
loÿl
 
Ï¡
, 
	gÇme
, 
·t


866 
loÿl
 
m­_»g


867 
	gùx
.
	gİ
 = 
İ


868 
ùx
.
»l
 = 
n


869 
Ï¡
 = 
n


870 
loÿl
 
İ©


871 
İ©
 = 
m­_š™
[
bªd
(
rshiá
(
İ
, 25), 15)]

872 
ty³
(
İ©
) ~= "string" do

873 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


874 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)] 
Ü
 o·t.
_


875 
’d


876 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9]*)(.*)")

877 
loÿl
 
®Šame
, 
·t2
 = 
	`m©ch
(
·t
, "|([a-z0-9_.|]*)(.*)")

878 
®Šame
 
th’
 
·t
 = 
·t2
 
’d


879 
	`sub
(
·t
, 1, 1è=ğ"." 
th’


880 
loÿl
 
s2
, 
p2
 = 
	`m©ch
(
·t
, "^([a-z0-9.]*)(.*)")

881 
suffix
 = suffix..
s2


882 
·t
 = 
p2


883 
’d


885 
loÿl
 
¹
 = 
	`m©ch
(
·t
, "[gf]")

886 
¹
 
th’


887 
¹
 =ğ"g" 
th’


888 
m­_»g
 = 
	`bªd
(
İ
, 0x80000000è~ğ0 
ªd
 
m­_»gs
.
x
 
Ü
 m­_»gs.
w


890 
m­_»g
 = 
	`bªd
(
İ
, 0x400000è~ğ0 
ªd
 
m­_»gs
.
d
 
Ü
 m­_»gs.
s


891 
’d


892 
’d


894 
loÿl
 
£cÚd0
, 
immr


896 
p
 
š
 
	`gm©ch
(
·t
, ".") do

897 
loÿl
 
x
 = 
n


898 
p
 =ğ"D" 
th’


899 
loÿl
 
»gnum
 = 
	$bªd
(
İ
, 31)

900 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

901 
–£if
 
p
 =ğ"N" 
th’


902 
loÿl
 
»gnum
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31)

903 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

904 
–£if
 
p
 =ğ"M" 
th’


905 
loÿl
 
»gnum
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

906 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

907 
–£if
 
p
 =ğ"A" 
th’


908 
loÿl
 
»gnum
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 31)

909 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

910 
–£if
 
p
 =ğ"B" 
th’


911 
loÿl
 
addr
 = 
ùx
.add¸+ 
pos
 + 
	$·r£_immpc
(
İ
, 
Çme
)

912 
ùx
.
»l
 = 
addr


913 
x
 = "0x"..
	$tohex
(
addr
)

914 
–£if
 
p
 =ğ"T" 
th’


915 
x
 = 
	`bÜ
(
	`bªd
(
	`rshiá
(
İ
, 26), 32), band(rshift(op, 19), 31))

916 
–£if
 
p
 =ğ"V" 
th’


917 
x
 = 
	$bªd
(
İ
, 15)

918 
–£if
 
p
 =ğ"C" 
th’


919 
x
 = 
m­_cÚd
[
	`bªd
(
	`rshiá
(
İ
, 12), 15)]

920 
–£if
 
p
 =ğ"c" 
th’


921 
loÿl
 
º
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31)

922 
loÿl
 
rm
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

923 
loÿl
 
cÚd
 = 
	`bªd
(
	`rshiá
(
İ
, 12), 15)

924 
loÿl
 
švc
 = 
	$bxÜ
(
cÚd
, 1)

925 
x
 = 
m­_cÚd
[
cÚd
]

926 
®Šame
 
ªd
 
cÚd
 ~ğ14‡nd cÚd ~ğ15 
th’


927 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

928 
º
 =ğ
rm
 
th’


929 
loÿl
 
n
 = #operands

930 
İ”ªds
[
n
] = 
n


931 
x
 = 
m­_cÚd
[
švc
]

932 
º
 ~ğ31 
th’


933 
a1
 
th’
 
Çme
 =‡1 Çmğ
®Šame
 
’d


935 
İ”ªds
[
n
-1] = 
n


936 
Çme
 = 
a2


937 
’d


938 
’d


939 
’d


940 
–£if
 
p
 =ğ"W" 
th’


941 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 0xffff)

942 
–£if
 
p
 =ğ"Y" 
th’


943 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 0xffff)

944 
loÿl
 
hw
 = 
	`bªd
(
	`rshiá
(
İ
, 21), 3)

945 
®Šame
 
	`ªd
 (
hw
 =ğ0 
Ü
 
x
 ~ğ0è
th’


946 
Çme
 = 
®Šame


947 
’d


948 
–£if
 
p
 =ğ"L" 
th’


949 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

950 
loÿl
 
imm9
 = 
	`¬shiá
(
	`lshiá
(
İ
, 11), 23)

951 
	`bªd
(
İ
, 0x800è~ğ0 
th’


952 
x
 = "["..
º
..", #"..
imm9
.."]!"

954 
x
 = "["..
º
.."], #"..
imm9


955 
’d


956 
–£if
 
p
 =ğ"U" 
th’


957 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

958 
loÿl
 
sz
 = 
	`bªd
(
	`rshiá
(
İ
, 30), 3)

959 
loÿl
 
imm12
 = 
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 10), 20), 
sz
)

960 
imm12
 ~ğ0 
th’


961 
x
 = "["..
º
..", #"..
imm12
.."]"

963 
x
 = "["..
º
.."]"

964 
’d


965 
–£if
 
p
 =ğ"K" 
th’


966 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

967 
loÿl
 
imm9
 = 
	`¬shiá
(
	`lshiá
(
İ
, 11), 23)

968 
imm9
 ~ğ0 
th’


969 
x
 = "["..
º
..", #"..
imm9
.."]"

971 
x
 = "["..
º
.."]"

972 
’d


973 
–£if
 
p
 =ğ"O" 
th’


974 
loÿl
 
º
, 
rm
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

975 
loÿl
 
m
 = 
	`bªd
(
	`rshiá
(
İ
, 13), 1)

976 
m
 =ğ0 
th’


977 
rm
 = 
m­_»gs
.
w
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

979 
rm
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

980 
’d


981 
x
 = "["..
º
..", "..
rm


982 
loÿl
 
İt
 = 
	`bªd
(
	`rshiá
(
İ
, 13), 7)

983 
loÿl
 
s
 = 
	`bªd
(
	`rshiá
(
İ
, 12), 1)

984 
loÿl
 
sz
 = 
	`bªd
(
	`rshiá
(
İ
, 30), 3)

985 -- 
ex‹nsiÚ
 
to
 
be
 
­¶›d


986 
İt
 =ğ3 
th’


987 
s
 =ğ0 
th’
 
x
 = x.."]"

988 
x
 = x..",†¦ #"..
sz
.."]" 
’d


989 
–£if
 
İt
 =ğ2 
Ü
 o± =ğ6 o¸İˆ=ğ7 
th’


990 
s
 =ğ0 
th’
 
x
 = x..", "..
m­_ex‹nd
[
İt
].."]"

991 
x
 = x..", "..
m­_ex‹nd
[
İt
].." #"..
sz
.."]" 
’d


993 
x
 = x.."]"

994 
’d


995 
–£if
 
p
 =ğ"P" 
th’


996 
loÿl
 
İcv
, 
sh
 = 
	`rshiá
(
İ
, 26), 2

997 
İcv
 >ğ0x2¨
th’
 
sh
 = 4 
–£if
 opcv >ğ0x1bh’ sh = 3 
’d


998 
loÿl
 
imm7
 = 
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 10), 25), 
sh
)

999 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

1000 
loÿl
 
šd
 = 
	`bªd
(
	`rshiá
(
İ
, 23), 3)

1001 
šd
 =ğ1 
th’


1002 
x
 = "["..
º
.."], #"..
imm7


1003 
–£if
 
šd
 =ğ2 
th’


1004 
imm7
 =ğ0 
th’


1005 
x
 = "["..
º
.."]"

1007 
x
 = "["..
º
..", #"..
imm7
.."]"

1008 
’d


1009 
–£if
 
šd
 =ğ3 
th’


1010 
x
 = "["..
º
..", #"..
imm7
.."]!"

1011 
’d


1012 
–£if
 
p
 =ğ"I" 
th’


1013 
loÿl
 
shf
 = 
	`bªd
(
	`rshiá
(
İ
, 22), 3)

1014 
loÿl
 
imm12
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 0x0fff)

1015 
loÿl
 
º
, 
rd
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31), 
	$bªd
(
İ
, 31)

1016 
®Šame
 =ğ"mov" 
ªd
 
shf
 =ğ0‡nd 
imm12
 =ğ0 
	$ªd
 (
º
 =ğ31 
Ü
 
rd
 =ğ31è
th’


1017 
Çme
 = 
®Šame


1018 
x
 = 
n


1019 
–£if
 
shf
 =ğ0 
th’


1020 
x
 = 
imm12


1021 
–£if
 
shf
 =ğ1 
th’


1022 
x
 = 
imm12
..",†sl #12"

1023 
’d


1024 
–£if
 
p
 =ğ"i" 
th’


1025 
x
 = "#0x"..
	$decode_imm13
(
İ
)

1026 
–£if
 
p
 =ğ"1" 
th’


1027 
immr
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 63)

1028 
x
 = 
immr


1029 
–£if
 
p
 =ğ"2" 
th’


1030 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1031 
®Šame
 
th’


1032 
loÿl
 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
 =

1033 
	`m©ch
(
®Šame
, "([^|]*)|([^|]*)|([^|]*)|([^|]*)|([^|]*)|(.*)")

1034 
loÿl
 
sf
 = 
	`bªd
(
	`rshiá
(
İ
, 26), 32)

1035 
loÿl
 
uns
 = 
	`bªd
(
	`rshiá
(
İ
, 30), 1)

1036 
	$´eãr_bfx
(
sf
, 
uns
, 
x
, 
immr
è
th’


1037 
Çme
 = 
a2


1038 
x
 = x - 
immr
 + 1

1039 
–£if
 
immr
 =ğ0 
ªd
 
x
 =ğ7 
th’


1040 
loÿl
 
n
 = #operands

1041 
İ”ªds
[
n
] = 
n


1042 
sf
 ~ğ0 
th’


1043 
İ”ªds
[
n
-1] = 
	`gsub
(operands[n-1], "x", "w")

1044 
’d


1045 
Ï¡
 = 
İ”ªds
[
n
-1]

1046 
Çme
 = 
a6


1047 
x
 = 
n


1048 
–£if
 
immr
 =ğ0 
ªd
 
x
 =ğ15 
th’


1049 
loÿl
 
n
 = #operands

1050 
İ”ªds
[
n
] = 
n


1051 
sf
 ~ğ0 
th’


1052 
İ”ªds
[
n
-1] = 
	`gsub
(operands[n-1], "x", "w")

1053 
’d


1054 
Ï¡
 = 
İ”ªds
[
n
-1]

1055 
Çme
 = 
a5


1056 
x
 = 
n


1057 
–£if
 
x
 =ğ31 
Ü
 x =ğ63 
th’


1058 
x
 =ğ31 
ªd
 
immr
 =ğ0‡nd 
Çme
 =ğ"sbfm" 
th’


1059 
Çme
 = 
a4


1060 
loÿl
 
n
 = #operands

1061 
İ”ªds
[
n
] = 
n


1062 
sf
 ~ğ0 
th’


1063 
İ”ªds
[
n
-1] = 
	`gsub
(operands[n-1], "x", "w")

1064 
’d


1065 
Ï¡
 = 
İ”ªds
[
n
-1]

1067 
Çme
 = 
a3


1068 
’d


1069 
x
 = 
n


1070 
–£if
 
	`bªd
(
x
, 31è~ğ31 
ªd
 
immr
 =ğx+1‡nd 
Çme
 =ğ"ubfm" 
th’


1071 
Çme
 = 
a4


1072 
Ï¡
 = "#"..(
sf
+32 - 
immr
)

1073 
İ”ªds
[#İ”ªds] = 
Ï¡


1074 
x
 = 
n


1075 
–£if
 
x
 < 
immr
 
th’


1076 
Çme
 = 
a1


1077 
Ï¡
 = "#"..(
sf
+32 - 
immr
)

1078 
İ”ªds
[#İ”ªds] = 
Ï¡


1079 
x
 = x + 1

1080 
’d


1081 
’d


1082 
–£if
 
p
 =ğ"3" 
th’


1083 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1084 
®Šame
 
th’


1085 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

1086 
x
 < 
immr
 
th’


1087 
Çme
 = 
a1


1088 
loÿl
 
sf
 = 
	`bªd
(
	`rshiá
(
İ
, 26), 32)

1089 
Ï¡
 = "#"..(
sf
+32 - 
immr
)

1090 
İ”ªds
[#İ”ªds] = 
Ï¡


1091 
x
 = x + 1

1092 
–£if
 
x
 >ğ
immr
 
th’


1093 
Çme
 = 
a2


1094 
x
 = x - 
immr
 + 1

1095 
’d


1096 
’d


1097 
–£if
 
p
 =ğ"4" 
th’


1098 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1099 
loÿl
 
º
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31)

1100 
loÿl
 
rm
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

1101 
®Šame
 
ªd
 
º
 =ğ
rm
 
th’


1102 
loÿl
 
n
 = #operands

1103 
İ”ªds
[
n
] = 
n


1104 
Ï¡
 = 
İ”ªds
[
n
-1]

1105 
Çme
 = 
®Šame


1106 
’d


1107 
–£if
 
p
 =ğ"5" 
th’


1108 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

1109 
–£if
 
p
 =ğ"S" 
th’


1110 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1111 
x
 =ğ0 
th’
 x = 
n


1112 
x
 = 
m­_shiá
[
	`bªd
(
	`rshiá
(
İ
, 22), 3)].." #"..x 
’d


1113 
–£if
 
p
 =ğ"X" 
th’


1114 
loÿl
 
İt
 = 
	`bªd
(
	`rshiá
(
İ
, 13), 7)

1115 -- 
Width
 
¥ecif›r
 <
R
>.

1116 
İt
 ~ğ3 
ªd
 o± ~ğ7 
th’


1117 
Ï¡
 = 
m­_»gs
.
w
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

1118 
İ”ªds
[#İ”ªds] = 
Ï¡


1119 
’d


1120 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 7)

1121 -- 
Ex‹nsiÚ
.

1122 
İt
 =ğ2 + 
	`bªd
(
	`rshiá
(
İ
, 31), 1è
ªd


1123 
	`bªd
(
	`rshiá
(
İ
, 
£cÚd0
 
ªd
 5 
Ü
 0), 31è=ğ31 
th’


1124 
x
 =ğ0 
th’
 x = 
n


1125 
x
 = "l¦ #"..x 
’d


1127 
x
 =ğ0 
th’
 x = 
m­_ex‹nd
[
	`bªd
(
	`rshiá
(
İ
, 13), 7)]

1128 
x
 = 
m­_ex‹nd
[
	`bªd
(
	`rshiá
(
İ
, 13), 7)].." #"..x 
’d


1129 
’d


1130 
–£if
 
p
 =ğ"R" 
th’


1131 
x
 = 
	`bªd
(
	`rshiá
(
İ
,21), 3)

1132 
x
 =ğ0 
th’
 x = 
n


1133 
x
 = "l¦ #"..x*16 
’d


1134 
–£if
 
p
 =ğ"z" 
th’


1135 
loÿl
 
n
 = #operands

1136 
İ”ªds
[
n
] =ğ"¥" 
th’
 operands[n] = "xzr"

1137 
–£if
 
İ”ªds
[
n
] =ğ"w¥" 
th’
 operands[n] = "wzr"

1138 
’d


1139 
–£if
 
p
 =ğ"Z" 
th’


1140 
x
 = 0

1141 
–£if
 
p
 =ğ"F" 
th’


1142 
x
 = 
	$·r£_åimm8
(
İ
)

1143 
–£if
 
p
 =ğ"g" 
Ü
… == "f" or… == "x" or… == "w" or

1144 
p
 =ğ"d" 
Ü
… =ğ"s" 
th’


1145 -- 
The£
 
¬e
 
hªdËd
 
š
 
D
/
N
/
M
/
A
.

1146 
–£if
 
p
 =ğ"0" 
th’


1147 
Ï¡
 =ğ"¥" 
Ü
†a¡ =ğ"w¥" 
th’


1148 
loÿl
 
n
 = #operands

1149 
İ”ªds
[
n
] = 
n


1150 
Ï¡
 = 
İ”ªds
[
n
-1]

1151 
®Šame
 
th’


1152 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

1153 
nÙ
 
a1
 
th’


1154 
Çme
 = 
®Šame


1155 
–£if
 
£cÚd0
 
th’


1156 
Çme
, 
®Šame
 = 
a2
, 
a1


1158 
Çme
, 
®Šame
 = 
a1
, 
a2


1159 
’d


1160 
’d


1161 
’d


1162 
£cÚd0
 = 
Œue


1164 
	$as£¹
(
çl£
)

1165 
’d


1166 
x
 
th’


1167 
Ï¡
 = 
x


1168 
	`ty³
(
x
è=ğ"numb”" 
th’
 x = "#"..x 
’d


1169 
İ”ªds
[#İ”ªds+1] = 
x


1170 
’d


1171 
’d


1173  
	$putİ
(
ùx
, 
Çme
..
suffix
, 
İ”ªds
)

1174 
’d


1178 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

1179 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

1180 
nÙ
 
ofs
 
th’
 of ğ0 
’d


1181 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


1182 
ùx
.
pos
 = 
ofs


1183 
ùx
.
»l
 = 
n


1184 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


1185 
’d


1187 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

1188 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

1189 
loÿl
 
ùx
 = {
	}
}

1190 
ùx
.
code
 = code

1191 
ùx
.
addr
 =‡dd¸
Ü
 0

1192 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


1193 
ùx
.
symb
 = {}

1194 
ùx
.
di§ss
 = 
di§ss_block


1195 
ùx
.
hexdump
 = 8

1196  
ùx


1197 
’d


1199 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

1200 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

1201 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

1202 
’d


1204 -- 
R‘uº
 
Çme
 
RID
.

1205 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

1206 
r
 < 32 
th’
  
m­_»gs
.
x
[r] 
’d


1207  
m­_»gs
.
d
[
r
-32]

1208 
’d


1210 -- 
Public
 
moduË
 
funùiÚs
.

1212 
ü—‹
 = create,

1213 
di§ss
 = disass,

1214 
»gÇme
 =„egname

1215 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_arm64be.lua

2 -- 
LuaJIT
 
ARM64BE
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
ARM64
 
š¡ruùiÚs
 
¬e
 
®ways
 
	gl™e
-
	g’dŸn
. 
So
 
ju¡
 
fÜw¬d
 
to
 
	gthe


8 -- 
commÚ
 
ARM64
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11  
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_arm64")

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mips.lua

2 -- 
LuaJIT
 
MIPS
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
	gMIT
/
X
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
It
 
di§s£mbËs
 
®l
 
¡ªd¬d
 
	gMIPS32R1
/
R2
 
	gš¡ruùiÚs
.

10 -- 
DeçuÉ
 
mode
 
is
 
	gbig
-
	g’dŸn
, 
but
 
	g£e
: 
dis_m£l
.
lua


13 
loÿl
 
ty³
 =ype

14 
loÿl
 
by‹
, 
	gfÜm©
 = 
¡ršg
.by‹, 
	g¡ršg
.
fÜm©


15 
loÿl
 
	gm©ch
, 
	ggm©ch
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.
gm©ch


16 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


17 
loÿl
 
b™
 = 
»quœe
("bit")

18 
loÿl
 
bªd
, 
	gbÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.
tohex


19 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshift, bit.arshift

22 -- 
Prim¬y
 
ªd
 
ex‹nded
 
İcode
 
	gm­s


25 
loÿl
 
	gm­_movci
 = { 
shiá
 = 16, 
	gmask
 = 1, [0] = "movfDSC", "movtDSC", }

26 
loÿl
 
	gm­_¤l
 = { 
shiá
 = 21, 
	gmask
 = 1, [0] = "srlDTA", "rotrDTA", }

27 
loÿl
 
	gm­_¤lv
 = { 
shiá
 = 6, 
	gmask
 = 1, [0] = "srlvDTS", "rotrvDTS", }

29 
loÿl
 
	gm­_¥ecŸl
 = {

30 
shiá
 = 0, 
	gmask
 = 63,

31 [0] = { 
shiá
 = 0, 
	gmask
 = -1, [0] = "nİ", 
	g_
 = "sllDTA" },

32 
	gm­_movci
, 
	gm­_¤l
, "sraDTA",

33 "¦lvDTS", 
	gçl£
, 
	gm­_¤lv
, "sravDTS",

35 "sysÿÎY", "b»akY", 
	gçl£
, "sync",

37 "d¦lvDST", 
	gçl£
, "dsrlvDST", "dsravDST",

42 
	gçl£
, false, "sltDST", "sltuDST",

45 "‹qSTZ", 
	gçl£
, "tneSTZ", false,

46 "d¦lDTA", 
	gçl£
, "dsrlDTA", "dsraDTA",

47 "d¦l32DTA", 
	gçl£
, "dsrl32DTA", "dsra32DTA",

50 
loÿl
 
	gm­_¥ecŸl2
 = {

51 
shiá
 = 0, 
	gmask
 = 63,

52 [0] = "maddST", "madduST", "mulDST", 
	gçl£
,

58 
loÿl
 
	gm­_bshæ
 = {

59 
shiá
 = 6, 
	gmask
 = 31,

65 
loÿl
 
	gm­_dbshæ
 = {

66 
shiá
 = 6, 
	gmask
 = 31,

71 
loÿl
 
	gm­_¥ecŸl3
 = {

72 
shiá
 = 0, 
	gmask
 = 63,

75 [32] = 
m­_bshæ
, [36] = 
m­_dbshæ
, [59] = "rdhwrTD",

78 
loÿl
 
	gm­_»gimm
 = {

79 
shiá
 = 16, 
	gmask
 = 31,

81 
	gçl£
, false, false, false,

83 "‹qiSI", 
	gçl£
, "tneiSI", false,

85 
	gçl£
, false, false, false,

86 
	gçl£
, false, false, false,

87 
	gçl£
, false, false, "synciSO",

90 
loÿl
 
	gm­_cİ0
 = {

91 
shiá
 = 25, 
	gmask
 = 1,

93 
shiá
 = 21, 
	gmask
 = 15,

96 [11] = { 
shiá
 = 5, 
	gmask
 = 1, [0] = "diT0", "eiT0", },

99 
	gshiá
 = 0, 
	gmask
 = 63,

106 
loÿl
 
	gm­_cİ1s
 = {

107 
shiá
 = 0, 
	gmask
 = 63,

112 
	gçl£
,

113 { 
	gshiá
 = 16, 
	gmask
 = 1, [0] = "movf.sFGC", "movt.sFGC" },

115 
	gçl£
, "recip.sFG", "rsqrt.sFG", false,

116 
	gçl£
, false, false, false,

117 
	gçl£
, false, false, false,

118 
	gçl£
, "cvt.d.sFG", false, false,

119 "cvt.w.sFG", "cvt.l.sFG", "cvt.ps.sFGH", 
	gçl£
,

120 
	gçl£
, false, false, false,

121 
	gçl£
, false, false, false,

128 
loÿl
 
	gm­_cİ1d
 = {

129 
shiá
 = 0, 
	gmask
 = 63,

134 
	gçl£
,

135 { 
	gshiá
 = 16, 
	gmask
 = 1, [0] = "movf.dFGC", "movt.dFGC" },

137 
	gçl£
, "recip.dFG", "rsqrt.dFG", false,

138 
	gçl£
, false, false, false,

139 
	gçl£
, false, false, false,

140 "cvt.s.dFG", 
	gçl£
, false, false,

141 "cvt.w.dFG", "cvt.l.dFG", 
	gçl£
, false,

142 
	gçl£
, false, false, false,

143 
	gçl£
, false, false, false,

150 
loÿl
 
	gm­_cİ1ps
 = {

151 
shiá
 = 0, 
	gmask
 = 63,

152 [0] = "add.psFGH", "sub.psFGH", "mul.psFGH", 
	gçl£
,

153 
	gçl£
, "abs.psFG", "mov.psFG", "neg.psFG",

154 
	gçl£
, false, false, false,

155 
	gçl£
, false, false, false,

156 
	gçl£
,

157 { 
	gshiá
 = 16, 
	gmask
 = 1, [0] = "movf.psFGC", "movt.psFGC" },

159 
	gçl£
, false, false, false,

160 
	gçl£
, false, false, false,

161 
	gçl£
, false, false, false,

162 "cvt.s.puFG", 
	gçl£
, false, false,

163 
	gçl£
, false, false, false,

164 "cvt.s.¶FG", 
	gçl£
, false, false,

172 
loÿl
 
	gm­_cİ1w
 = {

173 
shiá
 = 0, 
	gmask
 = 63,

177 
loÿl
 
	gm­_cİ1l
 = {

178 
shiá
 = 0, 
	gmask
 = 63,

182 
loÿl
 
	gm­_cİ1bc
 = {

183 
shiá
 = 16, 
	gmask
 = 3,

187 
loÿl
 
	gm­_cİ1
 = {

188 
shiá
 = 21, 
	gmask
 = 31,

191 
	gm­_cİ1bc
, 
	gçl£
, false, false,

192 
	gçl£
, false, false, false,

193 
	gm­_cİ1s
, 
	gm­_cİ1d
, 
	gçl£
, false,

194 
	gm­_cİ1w
, 
	gm­_cİ1l
, 
	gm­_cİ1ps
,

197 
loÿl
 
	gm­_cİ1x
 = {

198 
shiá
 = 0, 
	gmask
 = 63,

199 [0] = "lwxc1FSX", "ldxc1FSX", 
	gçl£
, false,

200 
	gçl£
, "luxc1FSX", false, false,

201 "swxc1FSX", "sdxc1FSX", 
	gçl£
, false,

202 
	gçl£
, "suxc1FSX", false, "prefxMSX",

203 
	gçl£
, false, false, false,

204 
	gçl£
, false, false, false,

205 
	gçl£
, false, false, false,

206 
	gçl£
, false, "alnv.psFGHS", false,

207 "madd.sFRGH", "madd.dFRGH", 
	gçl£
, false,

208 
	gçl£
, false, "madd.psFRGH", false,

209 "msub.sFRGH", "msub.dFRGH", 
	gçl£
, false,

210 
	gçl£
, false, "msub.psFRGH", false,

211 "nmadd.sFRGH", "nmadd.dFRGH", 
	gçl£
, false,

212 
	gçl£
, false, "nmadd.psFRGH", false,

213 "nmsub.sFRGH", "nmsub.dFRGH", 
	gçl£
, false,

214 
	gçl£
, false, "nmsub.psFRGH", false,

217 
loÿl
 
	gm­_´i
 = {

218 [0] = 
m­_¥ecŸl
, 
	gm­_»gimm
, "jJ", "jalJ",

222 
	gm­_cİ0
, 
	gm­_cİ1
, 
	gçl£
, 
	gm­_cİ1x
,

224 "daddiTSI", "daddiuTSI", 
	gçl£
, false,

225 
	gm­_¥ecŸl2
, "j®xJ", 
	gçl£
, 
	gm­_¥ecŸl3
,

227 "lbuTSO", "lhuTSO", "lwrTSO", 
	gçl£
,

229 
	gçl£
, false, "swrTSO", "cacheNSO",

231 
	gçl£
, "ldc1HSO", "ldc2TSO", "ldTSO",

232 "scTSO", "swc1HSO", "swc2TSO", 
	gçl£
,

233 
	gçl£
, "sdc1HSO", "sdc2TSO", "sdTSO",

238 
loÿl
 
	gm­_g´
 = {

247 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

248 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

249 
loÿl
 
pos
 = 
ùx
.pos

250 
loÿl
 
exŒa
 = ""

251 
ùx
.
»l
 
th’


252 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

253 
sym
 
th’
 
exŒa
 = "\t->"..sym 
’d


254 
’d


255 
ùx
.
hexdump
 > 0 
th’


256 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-7s %s%s\n",

257 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

259 
ùx
.
	`out
(
	`fÜm©
("%08x %-7s %s%s\n",

260 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

261 
’d


262 
ùx
.
pos
 =…os + 4

263 
’d


265 -- 
F®lback
 
unknown
 
İcodes
.

266 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

267  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

268 
’d


270 
loÿl
 
funùiÚ
 
	$g‘_be
(
ùx
)

271 
loÿl
 
pos
 = 
ùx
.pos

272 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

273  
	`bÜ
(
	`lshiá
(
b0
, 24),†shiá(
b1
, 16),†shiá(
b2
, 8), 
b3
)

274 
’d


276 
loÿl
 
funùiÚ
 
	$g‘_Ë
(
ùx
)

277 
loÿl
 
pos
 = 
ùx
.pos

278 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

279  
	`bÜ
(
	`lshiá
(
b3
, 24),†shiá(
b2
, 16),†shiá(
b1
, 8), 
b0
)

280 
’d


282 -- 
Di§s£mbË
 
a
 
sšgË
 
š¡ruùiÚ
.

283 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

284 
loÿl
 
İ
 = 
ùx
:
	$g‘
()

285 
loÿl
 
İ”ªds
 = {
	}
}

286 
loÿl
 
Ï¡
 = 
n


287 
ùx
.
İ
 = op

288 
ùx
.
»l
 = 
n


290 
loÿl
 
İ©
 = 
m­_´i
[
rshiá
(
İ
, 26)]

291 
ty³
(
İ©
) ~= "string" do

292 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


293 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)] 
Ü
 o·t.
_


294 
’d


295 
loÿl
 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9_.]*)(.*)")

296 
loÿl
 
®Šame
, 
·t2
 = 
	`m©ch
(
·t
, "|([a-z0-9_.|]*)(.*)")

297 
®Šame
 
th’
 
·t
 = 
·t2
 
’d


299 
p
 
š
 
	`gm©ch
(
·t
, ".") do

300 
loÿl
 
x
 = 
n


301 
p
 =ğ"S" 
th’


302 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 21), 31)]

303 
–£if
 
p
 =ğ"T" 
th’


304 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

305 
–£if
 
p
 =ğ"D" 
th’


306 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 11), 31)]

307 
–£if
 
p
 =ğ"F" 
th’


308 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 6), 31)

309 
–£if
 
p
 =ğ"G" 
th’


310 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 11), 31)

311 
–£if
 
p
 =ğ"H" 
th’


312 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 16), 31)

313 
–£if
 
p
 =ğ"R" 
th’


314 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 21), 31)

315 
–£if
 
p
 =ğ"A" 
th’


316 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 31)

317 
–£if
 
p
 =ğ"E" 
th’


318 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 31) + 32

319 
–£if
 
p
 =ğ"M" 
th’


320 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31)

321 
–£if
 
p
 =ğ"N" 
th’


322 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

323 
–£if
 
p
 =ğ"C" 
th’


324 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 18), 7)

325 
x
 =ğ0 
th’
 x = 
n
 
’d


326 
–£if
 
p
 =ğ"K" 
th’


327 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31) + 1

328 
–£if
 
p
 =ğ"P" 
th’


329 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31) + 33

330 
–£if
 
p
 =ğ"L" 
th’


331 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31è- 
Ï¡
 + 1

332 
–£if
 
p
 =ğ"Q" 
th’


333 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31è- 
Ï¡
 + 33

334 
–£if
 
p
 =ğ"I" 
th’


335 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

336 
–£if
 
p
 =ğ"U" 
th’


337 
x
 = 
	$bªd
(
İ
, 0xffff)

338 
–£if
 
p
 =ğ"O" 
th’


339 
loÿl
 
di¥
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

340 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%d(%s)", 
di¥
, 
Ï¡
)

341 
–£if
 
p
 =ğ"X" 
th’


342 
loÿl
 
šdex
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

343 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%s(%s)", 
šdex
, 
Ï¡
)

344 
–£if
 
p
 =ğ"B" 
th’


345 
x
 = 
ùx
.
addr
 + ctx.
pos
 + 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)*4 + 4

346 
ùx
.
»l
 = 
x


347 
x
 = 
	`fÜm©
("0x%08x", x)

348 
–£if
 
p
 =ğ"J" 
th’


349 
loÿl
 
a
 = 
ùx
.
addr
 + ctx.
pos


350 
x
 = 
a
 - 
	`bªd
×, 0x0fffffffè+ bªd(
İ
, 0x03ffffff)*4

351 
ùx
.
»l
 = 
x


352 
x
 = 
	`fÜm©
("0x%08x", x)

353 
–£if
 
p
 =ğ"V" 
th’


354 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 8), 7)

355 
x
 =ğ0 
th’
 x = 
n
 
’d


356 
–£if
 
p
 =ğ"W" 
th’


357 
x
 = 
	$bªd
(
İ
, 7)

358 
x
 =ğ0 
th’
 x = 
n
 
’d


359 
–£if
 
p
 =ğ"Y" 
th’


360 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 0x000fffff)

361 
x
 =ğ0 
th’
 x = 
n
 
’d


362 
–£if
 
p
 =ğ"Z" 
th’


363 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 1023)

364 
x
 =ğ0 
th’
 x = 
n
 
’d


365 
–£if
 
p
 =ğ"0" 
th’


366 
Ï¡
 =ğ"r0" 
Ü
†a¡ =ğ0 
th’


367 
loÿl
 
n
 = #operands

368 
İ”ªds
[
n
] = 
n


369 
Ï¡
 = 
İ”ªds
[
n
-1]

370 
®Šame
 
th’


371 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

372 
a1
 
th’
 
Çme
, 
®Šame
 =‡1, 
a2


373 
Çme
 = 
®Šame
 
’d


374 
’d


375 
’d


376 
–£if
 
p
 =ğ"1" 
th’


377 
Ï¡
 =ğ"¿" 
th’


378 
İ”ªds
[#İ”ªds] = 
n


379 
’d


381 
	$as£¹
(
çl£
)

382 
’d


383 
x
 
th’
 
İ”ªds
[#İ”ªds+1] = x; 
Ï¡
 = x 
’d


384 
’d


386  
	$putİ
(
ùx
, 
Çme
, 
İ”ªds
)

387 
’d


391 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

392 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

393 
nÙ
 
ofs
 
th’
 of ğ0 
’d


394 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


395 
¡İ
 = stop - stop % 4

396 
ùx
.
pos
 = 
ofs
 - ofs % 4

397 
ùx
.
»l
 = 
n


398 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


399 
’d


401 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

402 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

403 
loÿl
 
ùx
 = {
	}
}

404 
ùx
.
code
 = code

405 
ùx
.
addr
 =‡dd¸
Ü
 0

406 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


407 
ùx
.
symb
 = {}

408 
ùx
.
di§ss
 = 
di§ss_block


409 
ùx
.
hexdump
 = 8

410 
ùx
.
g‘
 = 
g‘_be


411  
ùx


412 
’d


414 
loÿl
 
funùiÚ
 
	$ü—‹_–
(
code
, 
addr
, 
out
)

415 
loÿl
 
ùx
 = 
	$ü—‹
(
code
, 
addr
, 
out
)

416 
ùx
.
g‘
 = 
g‘_Ë


417  
ùx


418 
’d


420 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

421 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

422 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

423 
’d


425 
loÿl
 
funùiÚ
 
	$di§ss_–
(
code
, 
addr
, 
out
)

426 
	$ü—‹_–
(
code
, 
addr
, 
out
):
	$di§ss
()

427 
’d


429 -- 
R‘uº
 
Çme
 
RID
.

430 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

431 
r
 < 32 
th’
  
m­_g´
[r] 
’d


432  "f"..(
r
-32)

433 
’d


435 -- 
Public
 
moduË
 
funùiÚs
.

437 
ü—‹
 = create,

438 
ü—‹_–
 = create_el,

439 
di§ss
 = disass,

440 
di§ss_–
 = disass_el,

441 
»gÇme
 =„egname

442 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mips64.lua

2 -- 
LuaJIT
 
MIPS64
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
the
 
	gbig
-
’dŸn
 
funùiÚs
 
äom
 
	gthe


8 -- 
MIPS
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_ms
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_mips")

13 
	gü—‹
 = 
dis_ms
.
ü—‹
,

14 
	gdi§ss
 = 
dis_ms
.
di§ss
,

15 
	g»gÇme
 = 
dis_ms
.
»gÇme


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mips64el.lua

2 -- 
LuaJIT
 
MIPS64EL
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
the
 
	gl™e
-
’dŸn
 
funùiÚs
 
äom
 
	gthe


8 -- 
MIPS
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_ms
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_mips")

13 
	gü—‹
 = 
dis_ms
.
ü—‹_–
,

14 
	gdi§ss
 = 
dis_ms
.
di§ss_–
,

15 
	g»gÇme
 = 
dis_ms
.
»gÇme


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mipsel.lua

2 -- 
LuaJIT
 
MIPSEL
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
the
 
	gl™e
-
’dŸn
 
funùiÚs
 
äom
 
	gthe


8 -- 
MIPS
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_ms
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_mips")

13 
	gü—‹
 = 
dis_ms
.
ü—‹_–
,

14 
	gdi§ss
 = 
dis_ms
.
di§ss_–
,

15 
	g»gÇme
 = 
dis_ms
.
»gÇme


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_ppc.lua

2 -- 
LuaJIT
 
PPC
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
	gMIT
/
X
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
It
 
di§s£mbËs
 
®l
 
	gcommÚ
, 
	gnÚ
-
	g´iveged
 32/64 
b™
 
Pow”PC
 
	gš¡ruùiÚs


10 -- 
¶us
 
the
 
e500
 
SPE
 
š¡ruùiÚs
 
ªd
 
some
 
	gC–l
/
X’Ú
 
	gex‹nsiÚs
.

12 -- 
	gNYI
: 
VMX
, 
	gVMX128


15 
loÿl
 
	gty³
 = 
ty³


16 
loÿl
 
by‹
, 
	gfÜm©
 = 
¡ršg
.by‹, 
	g¡ršg
.
fÜm©


17 
loÿl
 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.gm©ch, sŒšg.
gsub


18 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


19 
loÿl
 
b™
 = 
»quœe
("bit")

20 
loÿl
 
bªd
, 
	gbÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.
tohex


21 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshift, bit.arshift

24 -- 
Prim¬y
 
ªd
 
ex‹nded
 
İcode
 
	gm­s


27 
loÿl
 
	gm­_üİs
 = {

28 
shiá
 = 1, 
	gmask
 = 1023,

38 
loÿl
 
	gm­_¾wšm
 = 
£tm‘©abË
({

39 
shiá
 = 0, 
mask
 = -1,

41 { 
__šdex
 = 
funùiÚ
(
t
, 
x
)

42 
loÿl
 
rÙ
 = 
bªd
(
rshiá
(
x
, 11), 31)

43 
loÿl
 
mb
 = 
bªd
(
rshiá
(
x
, 6), 31)

44 
loÿl
 
me
 = 
bªd
(
rshiá
(
x
, 1), 31)

45 
mb
 =ğ0 
ªd
 
me
 =ğ31-
rÙ
 
th’


47 
–£if
 
me
 =ğ31 
ªd
 
mb
 =ğ32-
rÙ
 
th’


51 
’d


52 
’d


55 
loÿl
 
	gm­_¾d
 = {

56 
shiá
 = 2, 
	gmask
 = 7,

59 
	gshiá
 = 1, 
	gmask
 = 1,

64 
loÿl
 
	gm­_ext
 = 
£tm‘©abË
({

65 
shiá
 = 1, 
mask
 = 1023,

94 [144] = { 
shiá
 = 20, 
mask
 = 1, [0] = "mtcrfRZ~", "mtocrfRZ~", },

95 [19] = { 
shiá
 = 20, 
mask
 = 1, [0] = "mfcrR", "mfocrfRZ", },

96 [371] = { 
shiá
 = 11, 
mask
 = 1023, [392] = "mftbR", [424] = "mftbuR", },

98 
shiá
 = 11, 
mask
 = 1023,

102 
shiá
 = 11, 
mask
 = 1023,

127 
shiá
 = 21, 
mask
 = 3,

169 { 
__šdex
 = 
funùiÚ
(
t
, 
x
)

170 
bªd
(
x
, 31è=ğ15 
th’
  "i£lRRRC" 
’d


171 
’d


174 
loÿl
 
	gm­_ld
 = {

175 
shiá
 = 0, 
	gmask
 = 3,

179 
loÿl
 
	gm­_¡d
 = {

180 
shiá
 = 0, 
	gmask
 = 3,

184 
loÿl
 
	gm­_ås
 = {

185 
shiá
 = 5, 
	gmask
 = 1,

187 
	gshiá
 = 1, 
	gmask
 = 15,

188 [0] = 
çl£
, 
	gçl£
, "fdivsFFF.", false,

189 "fsubsFFF.", "çddsFFF.", "fsq¹sF-F.", 
	gçl£
,

190 "äesF-F.", "fmulsFF-F.", "äsq¹esF-F.", 
	gçl£
,

195 
loÿl
 
	gm­_åd
 = {

196 
shiá
 = 5, 
	gmask
 = 1,

198 
shiá
 = 1, 
	gmask
 = 1023,

211 
	gshiá
 = 1, 
	gmask
 = 15,

212 [0] = 
çl£
, 
	gçl£
, "fdivFFF.", false,

214 "äeF-F.", "fmulFF-F.", "äsq¹eF-F.", 
	gçl£
,

219 
loÿl
 
	gm­_¥e
 = {

220 
shiá
 = 0, 
	gmask
 = 2047,

356 
loÿl
 
	gm­_´i
 = {

357 [0] = 
çl£
, 
	gçl£
, "tdiARI", "twiARI",

358 
	gm­_¥e
, 
	gçl£
, false, "mulliRRI",

359 "subficRRI", 
	gçl£
, "cmpl_iYLRU", "cmp_iYLRI",

361 "b_KBJ", "sc", "bKJ", 
	gm­_üİs
,

362 "¾wimiRR~AAA.", 
	gm­_¾wšm
, 
	gçl£
, "rlwnmRR~RAA.",

364 "ªdi.RR~U", "ªdis.RR~U", 
	gm­_¾d
, 
	gm­_ext
,

371 
	gçl£
, f®£, 
	gm­_ld
, 
	gm­_ås
,

372 
	gçl£
, f®£, 
	gm­_¡d
, 
	gm­_åd
,

377 
loÿl
 
	gm­_g´
 = {

384 
loÿl
 
	gm­_cÚd
 = { [0] = "lt", "gt", "eq", "so", "ge", "le", "ne", "ns", }

386 -- 
FÜm©
 
a
 
cÚd™iÚ
 
	gb™
.

387 
loÿl
 
funùiÚ
 
	$cÚdfmt
(
cÚd
)

388 
cÚd
 <ğ3 
th’


389  
m­_cÚd
[
	`bªd
(
cÚd
, 3)]

391  
	`fÜm©
("4*ü%d+%s", 
	`rshiá
(
cÚd
, 2), 
m­_cÚd
[
	`bªd
(cond, 3)])

392 
’d


393 
’d


397 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
İ”ªds
.

398 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

399 
loÿl
 
pos
 = 
ùx
.pos

400 
loÿl
 
exŒa
 = ""

401 
ùx
.
»l
 
th’


402 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

403 
sym
 
th’
 
exŒa
 = "\t->"..sym 
’d


404 
’d


405 
ùx
.
hexdump
 > 0 
th’


406 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-7s %s%s\n",

407 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

409 
ùx
.
	`out
(
	`fÜm©
("%08x %-7s %s%s\n",

410 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

411 
’d


412 
ùx
.
pos
 =…os + 4

413 
’d


415 -- 
F®lback
 
unknown
 
İcodes
.

416 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

417  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

418 
	g’d


420 -- 
Di§s£mbË
 
a
 
sšgË
 
	gš¡ruùiÚ
.

421 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

422 
loÿl
 
pos
 = 
ùx
.pos

423 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

424 
loÿl
 
İ
 = 
	`bÜ
(
	`lshiá
(
b0
, 24),†shiá(
b1
, 16),†shiá(
b2
, 8), 
b3
)

425 
loÿl
 
İ”ªds
 = {
	}
}

426 
loÿl
 
Ï¡
 = 
n


427 
loÿl
 
rs
 = 21

428 
ùx
.
İ
 = op

429 
ùx
.
»l
 = 
n


431 
loÿl
 
İ©
 = 
m­_´i
[
rshiá
(
b0
, 2)]

432 
ty³
(
İ©
) ~= "string" do

433 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


434 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)]

435 
’d


436 
loÿl
 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9_.]*)(.*)")

437 
loÿl
 
®Šame
, 
·t2
 = 
	`m©ch
(
·t
, "|([a-z0-9_.]*)(.*)")

438 
®Šame
 
th’
 
·t
 = 
·t2
 
’d


440 
p
 
š
 
	`gm©ch
(
·t
, ".") do

441 
loÿl
 
x
 = 
n


442 
p
 =ğ"R" 
th’


443 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31)]

444 
rs
 =„s - 5

445 
–£if
 
p
 =ğ"F" 
th’


446 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31)

447 
rs
 =„s - 5

448 
–£if
 
p
 =ğ"A" 
th’


449 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31)

450 
rs
 =„s - 5

451 
–£if
 
p
 =ğ"S" 
th’


452 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 27-
rs
), 27)

453 
rs
 =„s - 5

454 
–£if
 
p
 =ğ"I" 
th’


455 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

456 
–£if
 
p
 =ğ"U" 
th’


457 
x
 = 
	$bªd
(
İ
, 0xffff)

458 
–£if
 
p
 =ğ"D" 
Ü
… =ğ"E" 
th’


459 
loÿl
 
di¥
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

460 
p
 =ğ"E" 
th’
 
di¥
 = 
	`bªd
(di¥, -4è
’d


461 
Ï¡
 =ğ"r0" 
th’
†a¡ = "0" 
’d


462 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%d(%s)", 
di¥
, 
Ï¡
)

463 
–£if
 
p
 >ğ"2" 
ªd
… <ğ"8" 
th’


464 
loÿl
 
di¥
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31è* 
p


465 
Ï¡
 =ğ"r0" 
th’
†a¡ = "0" 
’d


466 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%d(%s)", 
di¥
, 
Ï¡
)

467 
–£if
 
p
 =ğ"H" 
th’


468 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31è+ 
	`lshiá
(band(op, 2), 4)

469 
rs
 =„s - 5

470 
–£if
 
p
 =ğ"M" 
th’


471 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31è+ 
	$bªd
(
İ
, 0x20)

472 
–£if
 
p
 =ğ"C" 
th’


473 
x
 = 
	`cÚdfmt
(
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31))

474 
rs
 =„s - 5

475 
–£if
 
p
 =ğ"B" 
th’


476 
loÿl
 
bo
 = 
	$rshiá
(
İ
, 21)

477 
loÿl
 
cÚd
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

478 
loÿl
 
ú
 = ""

479 
rs
 =„s - 10

480 
	`bªd
(
bo
, 4è=ğ0 
th’


481 
ú
 = 
	`bªd
(
bo
, 2è=ğ0 
ªd
 "dnz" 
Ü
 "dz"

482 
	`bªd
(
bo
, 0x10è=ğ0 
th’


483 
ú
 = cn..(
	`bªd
(
bo
, 8è=ğ0 
ªd
 "f" 
Ü
 "t")

484 
’d


485 
	`bªd
(
bo
, 0x10è=ğ0 
th’
 
x
 = 
	$cÚdfmt
(
cÚd
è
’d


486 
Çme
 =‚ame..(
	`bªd
(
bo
, 1è=ğbªd(
	`rshiá
(
İ
, 15), 1è
ªd
 "-" 
Ü
 "+")

487 
–£if
 
	`bªd
(
bo
, 0x10è=ğ0 
th’


488 
ú
 = 
m­_cÚd
[
	`bªd
(
cÚd
, 3è+ (bªd(
bo
, 8è=ğ0 
ªd
 4 
Ü
 0)]

489 
cÚd
 > 3 
th’
 
x
 = "ü"..
	$rshiá
(
cÚd
, 2è
’d


490 
Çme
 =‚ame..(
	`bªd
(
bo
, 1è=ğbªd(
	`rshiá
(
İ
, 15), 1è
ªd
 "-" 
Ü
 "+")

491 
’d


492 
Çme
 = 
	`gsub
Òame, "_", 
ú
)

493 
–£if
 
p
 =ğ"J" 
th’


494 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 27-
rs
), 29-rs)*4

495 
	`bªd
(
İ
, 2è=ğ0 
th’
 
x
 = 
ùx
.
addr
 + 
pos
 + x 
’d


496 
ùx
.
»l
 = 
x


497 
x
 = "0x"..
	$tohex
(
x
)

498 
–£if
 
p
 =ğ"K" 
th’


499 
	`bªd
(
İ
, 1è~ğ0 
th’
 
Çme
 =‚ame.."l" 
’d


500 
	`bªd
(
İ
, 2è~ğ0 
th’
 
Çme
 =‚ame.."a" 
’d


501 
–£if
 
p
 =ğ"X" 
Ü
… =ğ"Y" 
th’


502 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
+2), 7)

503 
x
 =ğ0 
ªd
 
p
 =ğ"Y" 
th’
 x = 
n
 x = "ü"..x 
’d


504 
rs
 =„s - 5

505 
–£if
 
p
 =ğ"W" 
th’


506 
x
 = "ü"..
	$bªd
(
İ
, 7)

507 
–£if
 
p
 =ğ"Z" 
th’


508 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
-4), 255)

509 
rs
 =„s - 10

510 
–£if
 
p
 =ğ">" 
th’


511 
İ”ªds
[#İ”ªds] = 
	`rshiá
(operands[#operands], 1)

512 
–£if
 
p
 =ğ"0" 
th’


513 
Ï¡
 =ğ"r0" 
th’


514 
İ”ªds
[#İ”ªds] = 
n


515 
®Šame
 
th’
 
Çme
 =‡ÉÇm
’d


516 
’d


517 
–£if
 
p
 =ğ"L" 
th’


518 
Çme
 = 
	`gsub
Òame, "_", 
	`bªd
(
İ
, 0x00200000è~ğ0 
ªd
 "d" 
Ü
 "w")

519 
–£if
 
p
 =ğ"." 
th’


520 
	`bªd
(
İ
, 1è=ğ1 
th’
 
Çme
 =‚ame.."." 
’d


521 
–£if
 
p
 =ğ"N" 
th’


522 
İ
 =ğ0x60000000 
th’
 
Çme
 = "nİ";  
’d


523 
–£if
 
p
 =ğ"~" 
th’


524 
loÿl
 
n
 = #operands

525 
İ”ªds
[
n
-1], operands[n] = operands[n], operands[n-1]

526 
–£if
 
p
 =ğ"=" 
th’


527 
loÿl
 
n
 = #operands

528 
Ï¡
 =ğ
İ”ªds
[
n
-1] 
th’


529 
İ”ªds
[
n
] = 
n


530 
Çme
 = 
®Šame


531 
’d


532 
–£if
 
p
 =ğ"%" 
th’


533 
loÿl
 
n
 = #operands

534 
Ï¡
 =ğ
İ”ªds
[
n
-1] 
ªd
†a¡ =ğİ”ªds[n-2] 
th’


535 
İ”ªds
[
n
] = 
n


536 
İ”ªds
[
n
-1] = 
n


537 
Çme
 = 
®Šame


538 
’d


539 
–£if
 
p
 =ğ"-" 
th’


540 
rs
 =„s - 5

542 
	$as£¹
(
çl£
)

543 
’d


544 
x
 
th’
 
İ”ªds
[#İ”ªds+1] = x; 
Ï¡
 = x 
’d


545 
’d


547  
	$putİ
(
ùx
, 
Çme
, 
İ”ªds
)

548 
’d


552 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

553 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

554 
nÙ
 
ofs
 
th’
 of ğ0 
’d


555 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


556 
¡İ
 = stop - stop % 4

557 
ùx
.
pos
 = 
ofs
 - ofs % 4

558 
ùx
.
»l
 = 
n


559 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


560 
’d


562 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

563 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

564 
loÿl
 
ùx
 = {
	}
}

565 
ùx
.
code
 = code

566 
ùx
.
addr
 =‡dd¸
Ü
 0

567 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


568 
ùx
.
symb
 = {}

569 
ùx
.
di§ss
 = 
di§ss_block


570 
ùx
.
hexdump
 = 8

571  
ùx


572 
’d


574 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

575 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

576 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

577 
’d


579 -- 
R‘uº
 
Çme
 
RID
.

580 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

581 
r
 < 32 
th’
  
m­_g´
[r] 
’d


582  "f"..(
r
-32)

583 
’d


585 -- 
Public
 
moduË
 
funùiÚs
.

587 
ü—‹
 = create,

588 
di§ss
 = disass,

589 
»gÇme
 =„egname

590 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_x64.lua

2 -- 
LuaJIT
 
x64
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
	gthe
 64 
b™
 
funùiÚs
 
äom
 
the
 
	gcombšed


8 -- 
	gx86
/
x64
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_x86
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_x86")

13 
	gü—‹
 = 
dis_x86
.
ü—‹64
,

14 
	gdi§ss
 = 
dis_x86
.
di§ss64
,

15 
	g»gÇme
 = 
dis_x86
.
»gÇme64


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_x86.lua

2 -- 
LuaJIT
 
	gx86
/
x64
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
S’dšg
 
sm®l
 
code
 
¢³ts
 
to
 
ª
 
ex‹º®
 
di§s£mbËr
 
ªd
 
mixšg
 
	gthe


10 -- 
ouut
 
w™h
 
our
 
own
 
¡uff
 
was
 
too
 
	gäage
. 
So
 
I
 
had
 
to
 
b™e
 
the
 
	gbuÎ‘


11 -- 
ªd
 
wr™e
 
y‘
 
ªÙh”
 
x86
 
	gdi§s£mbËr
. 
Oh
 
	gw–l
 ...

13 -- 
The
 
ouut
 
fÜm©
 
is
 
v”y
 
sim¬
 
to
 
wh©
 
ndi§sm
 
	gg’”©es
. 
But
 
™
 
	ghas


14 -- 
b“n
 
dev–İed
 
šd•’d’y
 
by
 
lookšg
 
©
 
the
 
İcode
 
bËs
 
äom
 
	gthe


15 -- 
IÁ–
 
ªd
 
AMD
 
	gmªu®s
. 
The
 
suµÜ‹d
 
š¡ruùiÚ
 
£t
 
is
 
qu™e
 
	gex‹nsive


16 -- 
ªd
 
»æeùs
 
wh©
 
a
 
cu¼’t
 
g’”©iÚ
 
IÁ–
 
Ü
 
AMD
 
CPU
 
im¶em’ts
 
	gš


17 -- 32 
b™
 
	gªd
 64 b™ 
	gmode
. 
	gYes
, 
this
 
šşudes
 
	gMMX
, 
	gSSE
, 
	gSSE2
, 
	gSSE3
, 
	gSSSE3
,

18 -- 
	gSSE4
.1, SSE4.2, 
	gSSE4a
, 
	gAVX
, 
AVX2
 
ªd
 
ev’
 
´iveged
‡nd 
	ghy³rvisÜ


19 -- (
	gVMX
/
	gSVM
è
	gš¡ruùiÚs
.

21 -- 
	gNÙes
:

22 -- * 
	$The
 (
u£Ëss
è
a16
 
´efix
, 3D
Now
 
ªd
 
´e
-586 
İcodes
 
¬e
 
unsuµÜ‹d
.

23 -- * 
No
 
©‹m±
 
©
 
İtimiz©iÚ
 
has
 
b“n
 
made
 -- 
™
's fastƒnough for my‚eeds.

26 
loÿl
 
ty³
 =ype

27 
loÿl
 
sub
, 
by‹
, 
fÜm©
 = 
¡ršg
.sub, string.byte, string.format

28 
loÿl
 
m©ch
, 
gm©ch
, 
gsub
 = 
¡ršg
.match, string.gmatch, string.gsub

29 
loÿl
 
low”
, 
»p
 = 
¡ršg
.lower, string.rep

30 
loÿl
 
b™
 = 
	`»quœe
("bit")

31 
loÿl
 
tohex
 = 
b™
.tohex

33 -- 
M­
 1
¡
 
İcode
 
by‹
 
š
 32 
b™
 
mode
. 
Ugly
? 
W–l
 ... 
»ad
 
Ú
.

34 
loÿl
 
m­_İc1_32
 = {

71 --
Ax


76 --
Bx


79 --
Cx


82 --
Dx


85 --
Ex


89 --
Fx


92 
	}
}

93 
as£¹
(#map_opc1_32 == 255)

95 -- 
M­
 1
¡
 
İcode
 
by‹
 
š
 64 
b™
 
mode
 (
ov”rides
 
Úly
).

96 
loÿl
 
m­_İc1_64
 = 
£tm‘©abË
({

97 [0x06]=
çl£
, [0x07]=false, [0x0e]=false,

98 [0x16]=
çl£
, [0x17]=false, [0x1e]=false, [0x1f]=false,

99 [0x27]=
çl£
, [0x2f]=false, [0x37]=false, [0x3f]=false,

100 [0x60]=
çl£
, [0x61]=false, [0x62]=false, [0x63]="movsxdVrDmt", [0x67]="a32:",

105 [0x82]=
çl£
, [0x9a]=false, [0xc4]="vex*3", [0xc5]="vex*2", [0xce]=false,

106 [0xd4]=
çl£
, [0xd5]=false, [0xd6]=false, [0xea]=false,

107 }, { 
__šdex
 = 
m­_İc1_32
 })

109 -- 
M­
 2
nd
 
İcode
 
by‹
 (0F 
xx
). 
True
 
CISC
 
	gh–l
. 
	gHey
, 
I
 
tŞd
 
	gyou
.

110 -- 
P»fix
 
d•’d’t
 
	gMMX
/
SSE
 
	gİcodes
: (
nÚe
)|
»p
|
o16
|
»²e
, -|
	gF3
|66|
F2


111 
loÿl
 
	gm­_İc2
 = {

113 [0]="¦dt!Dmp","sgdt!Ump","ÏrVrm","l¦Vrm",
	gn
,"syscall","clts","sysret",

114 "švd","wbšvd",
	gn
,"ud1",nil,"$prefetch!Bm","femms","3dnowMrmu",

127 "movUmx$","movUmy$","movUxm$","movUym$","movUmz$",
	gn
,"movUzm$",nil,

137 "wrm¤","rdtsc","rdm¤","rdpmc","sy£Á”","sy£x™",
	gn
,"getsec",

138 "İc3*38",
	gn
,"opc3*3a",nil,nil,nil,nil,nil,

165 
	gn
,nil,

174 --
	gAx


175 "push fs","pİ fs","ıuid","btVmr","shldVmru","shldVmrc",
	gn
,nil,

177 --
	gBx


182 --
	gCx


188 --
	gDx


194 --
	gEx


200 --
	gFx


206 
as£¹
(
m­_İc2
[255] == "ud")

208 -- 
M­
 
th»e
-
by‹
 
İcodes
. 
Cª
't wait forheir‚ext invention.

209 
loÿl
 
m­_İc3
 = {

210 ["38"] = { -- [66] 0à38 
xx


215 "||³rmpsXrvm","||³rmpdXrvm",
	gn
,nil,

217 "||pbËndvbXrma",
	gn
,nil,nil,

219 "||brßdÿ¡ssXrm","||brßdÿ¡sdXrm","||brßdÿ¡f128X¾Xm",
	gn
,

220 "·bsbPrm","·bswPrm","·bsdPrm",
	gn
,

223 "||pmovsxwqXrm","||pmovsxdqXrm",
	gn
,nil,

232 "||pmulddXrvm","||phmšposuwXrm",
	gn
,nil,

233 
	gn
,"||psrlvVSXrvm","||psravdXrvm","||psllvVSXrvm",

242 --
	gDx


245 --
	gFx


250 ["3a"] = { -- [66] 0à3¨
xx


252 [0x00]="||³rmqXrmu","||³rmpdXrmu","||pbËnddXrvmu",
	gn
,

253 "||³rmpsXrmu","||³rmpdXrmu","||³rm2f128Xrvmu",
	gn
,

257 
	gn
,nil,nil,nil,

259 "||š£¹f128XrvlXmu","||exŒaùf128XlXmYru",
	gn
,nil,

260 
	gn
,nil,nil,nil,

262 "||pš¤bXrvVmu","||š£¹psXrvmu","||pš¤XrvVmuS",
	gn
,

277 --
	gFx


282 -- 
M­
 
	gVMX
/
SVM
 
	gİcodes
 0F 01 
	gC0
-
FF
 (
sgdt
 
group
 
w™h
 
İ”ªds
).

283 
loÿl
 
	gm­_İcvm
 = {

291 -- 
M­
 
FP
 
	gİcodes
. 
And
 
you
 
thought
 
¡ack
 
machšes
 
¬e
 
	gsim¶e
?

292 
loÿl
 
	gm­_İcå
 = {

293 -- 
D8
-
DF
 00-
BF
: 
İcodes
 
w™h
 
a
 
memÜy
 
İ”ªd
.

294 -- 
D8


296 "ædFm",
	gn
,"fstFm","fstpFm","fldenvVm","fldcwWm","fnstenvVm","fnstcwWm",

297 -- 
	gDA


300 -- 
	gDB


301 "fdDm","fi¡Dm","fi¡Dm","fi¡pDm",
	gn
,"fldwordFmp",nil,"fstpwordFmp",

302 -- 
	gDC


304 -- 
	gDD


305 "ædGm","fi¡Qm","f¡Gm","f¡pGm","ä¡ÜDmp",
	gn
,"fnsaveDmp","fnstswWm",

306 -- 
	gDE


309 -- 
	gDF


312 -- 
xx
 
	gC0
-
	gFF
: 
İcodes
 
w™h
 
a
 
p£udo
-
İ”ªd
.

313 -- 
D8


315 -- 
	gD9


316 "ædFf","fxchFf",{"âİ"},
	gn
,

317 {"fchs","çbs",
	gn
,nil,"ftst","fxam"},

321 -- 
	gDA


322 "fcmovbFf","fcmoveFf","fcmovbeFf","fcmovuFf",
	gn
,{nil,"fucompp"},nil,nil,

323 -- 
	gDB


325 {
	gn
,nil,"fnclex","fninit"},"fucomiFf","fcomiFf",nil,

326 -- 
	gDC


327 "çddoFf","fmuÈtoFf",
	gn
,nil,

329 -- 
	gDD


330 "fä“Ff",
	gn
,"fstFf","fstpFf","fucomFf","fucompFf",nil,nil,

331 -- 
	gDE


332 "çddpFf","fmuÍFf",
	gn
,{nil,"fcompp"},

334 -- 
DF


335 
	gn
,nil,nil,nil,{"fnstsw‡x"},"fucomipFf","fcomipFf",nil,

337 
as£¹
(
m­_İcå
[126] == "fcomipFf")

339 -- 
M­
 
İcode
 
groups
. 
The
 
subkey
 
is
 
¥
 
äom
 
the
 
ModRM
 
by‹
.

340 
loÿl
 
m­_İcgroup
 = {

341 
¬™h
 = { "add", "or", "adc", "sbb", "and", "sub", "xor", "cmp" },

342 
	gshiá
 = { "rol", "ror", "rcl", "rcr", "shl", "shr", "sal", "sar" },

343 
	g‹¡b
 = { "testBmi", "testBmi", "not", "neg", "mul", "imul", "div", "idiv" },

344 
	g‹¡v
 = { "testVmi", "testVmi", "not", "neg", "mul", "imul", "div", "idiv" },

345 
	gšcb
 = { "inc", "dec" },

346 
	gšcd
 = { "inc", "dec", "callUmp", "$call farDmp",

348 
	g¦dt
 = { "sldt", "str", "lldt", "ltr", "verr", "verw" },

349 
	gsgdt
 = { "vm*$sgdt", "vm*$sidt", "$lgdt", "vm*$lidt",

350 "smsw", 
n
, "lmsw", "vm*$invlpg" },

351 
	gbt
 = { 
n
,‚il,‚il,‚il, "bt", "bts", "btr", "btc" },

352 
	gcmpxchg
 = { 
n
, "sz*,cmpxchg8bQmp,cmpxchg16bXmp",‚il,‚il,

353 
n
,‚il, "vmptrld|vmxon|vmclear", "vmptrst" },

354 
	gpshiáw
 = { 
n
,‚il, "psrlw",‚il, "psraw",‚il, "psllw" },

355 
	gpshiád
 = { 
n
,‚il, "psrld",‚il, "psrad",‚il, "pslld" },

356 
	gpshiáq
 = { 
n
,‚il, "psrlq",‚il,‚il,‚il, "psllq" },

357 
	gpshiádq
 = { 
n
,‚il, "psrlq", "psrldq",‚il,‚il, "psllq", "pslldq" },

358 
	gfx§ve
 = { "$fxsave", "$fxrstor", "$ldmxcsr", "$stmxcsr",

359 
n
, "lfenceDp$", "mfenceDp$", "sfenceDp$clflush" },

360 
	g´eãtch
 = { "prefetch", "prefetchw" },

361 
	g´eãtcht
 = { "prefetchnta", "prefetcht0", "prefetcht1", "prefetcht2" },

366 -- 
M­s
 
	gÇmes
.

367 
loÿl
 
	gm­_»gs
 = {

368 
B
 = { "al", "cl", "dl", "bl", "ah", "ch", "dh", "bh",

370 
	gB64
 = { "al", "cl", "dl", "bl", "spl", "bpl", "sil", "dil",

372 
	gW
 = { "ax", "cx", "dx", "bx", "sp", "bp", "si", "di",

374 
	gD
 = { "eax", "ecx", "edx", "ebx", "esp", "ebp", "esi", "edi",

376 
	gQ
 = { "rax", "rcx", "rdx", "rbx", "rsp", "rbp", "rsi", "rdi",

378 
	gM
 = { "mm0", "mm1", "mm2", "mm3", "mm4", "mm5", "mm6", "mm7",

379 "mm0", "mm1", "mm2", "mm3", "mm4", "mm5", "mm6", "mm7" }, -- 
No
 
x64
 
	gext
!

380 
	gX
 = { "xmm0", "xmm1", "xmm2", "xmm3", "xmm4", "xmm5", "xmm6", "xmm7",

382 
	gY
 = { "ymm0", "ymm1", "ymm2", "ymm3", "ymm4", "ymm5", "ymm6", "ymm7",

385 
loÿl
 
	gm­_£g»gs
 = { "es", "cs", "ss", "ds", "fs", "gs", "segr6", "segr7" }

387 -- 
M­s
 
size
 
Çmes
.

388 
loÿl
 
m­_sz2n
 = {

389 
B
 = 1, 
	gW
 = 2, 
	gD
 = 4, 
	gQ
 = 8, 
	gM
 = 8, 
	gX
 = 16, 
	gY
 = 32,

391 
loÿl
 
	gm­_sz2´efix
 = {

392 
B
 = "by‹", 
	gW
 = "wÜd", 
	gD
 = "dword",

393 
	gQ
 = "qword",

394 
	gM
 = "qwÜd", 
	gX
 = "xwÜd", 
	gY
 = "yword",

395 
	gF
 = "dwÜd", 
	gG
 = "qwÜd", -- 
No
 
Ãed
 
	gsizes
/
Çmes
 
the£
 
	gtwo
.

400 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

401 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

402 
loÿl
 
code
, 
pos
, 
hex
 = 
ùx
.code, ctx.pos, ""

403 
loÿl
 
hmax
 = 
ùx
.
hexdump


404 
hmax
 > 0 
th’


405 
i
=
ùx
.
¡¬t
,
pos
-1 do

406 
hex
 = hex..
	`fÜm©
("%02X", 
	$by‹
(
code
, 
i
, i))

407 
’d


408 #hex > 
hmax
 
th’
 
hex
 = 
	`sub
(hex, 1, hmax)..". "

409 
hex
 = hex..
	`»p
(" ", 
hmax
-#hex+2è
’d


410 
’d


411 
İ”ªds
 
th’
 
‹xt
 =ext.." "..İ”ªd 
’d


412 
ùx
.
o16
 
th’
 
‹xt
 = "o16 "..‹xt; ctx.o16 = 
çl£
 
’d


413 
ùx
.
a32
 
th’
 
‹xt
 = "a32 "..‹xt; ctx.a32 = 
çl£
 
’d


414 
ùx
.
»p
 
th’
 
‹xt
 = ctx.»p.." "..‹xt; ctx.»°ğ
çl£
 
’d


415 
ùx
.
»x
 
th’


416 
loÿl
 
t
 = (
ùx
.
»xw
 
ªd
 "w" 
Ü
 "")..(ùx.
»xr
‡nd "r" or "")..

417 (
ùx
.
»xx
 
ªd
 "x" 
Ü
 "")..(ùx.
»xb
‡nd "b" or "")..

418 (
ùx
.
vexl
 
ªd
 "l" 
Ü
 "")

419 
ùx
.
vexv
 
ªd
 ctx.vexv ~ğ0 
th’
 
t
 =.."v"..ùx.vexv 
’d


420 
t
 ~ğ"" 
th’
 
‹xt
 = 
ùx
.
»x
.."."..t.." "..
	`gsub
(text, "^ ", "")

421 
–£if
 
ùx
.
»x
 =ğ"vex" 
th’
 
‹xt
 = 
	`gsub
("v"..‹xt, "^v ", ""è
’d


422 
ùx
.
»xw
 = 
çl£
; ctx.
»xr
 = f®£; ctx.
»xx
 = f®£; ctx.
»xb
 = false

423 
ùx
.
»x
 = 
çl£
; ctx.
vexl
 = f®£; ctx.
vexv
 = false

424 
’d


425 
ùx
.
£g
 
th’


426 
loÿl
 
‹xt2
, 
n
 = 
	`gsub
(
‹xt
, "%[", "["..
ùx
.
£g
..":")

427 
n
 =ğ0 
th’
 
‹xt
 = 
ùx
.
£g
.." "..‹xˆ‹xˆğ
‹xt2
 
’d


428 
ùx
.
£g
 = 
çl£


429 
’d


430 
ùx
.
lock
 
th’
 
‹xt
 = "lock "..‹xt; ctx.lock = 
çl£
 
’d


431 
loÿl
 
imm
 = 
ùx
.imm

432 
imm
 
th’


433 
loÿl
 
sym
 = 
ùx
.
symb
[
imm
]

434 
sym
 
th’
 
‹xt
 =ext.."\t->"..sym 
’d


435 
’d


436 
ùx
.
	`out
(
	`fÜm©
("%08x %s%s\n", ctx.
addr
+ùx.
¡¬t
, 
hex
, 
‹xt
))

437 
ùx
.
mrm
 = 
çl£


438 
ùx
.
vexv
 = 
çl£


439 
ùx
.
¡¬t
 = 
pos


440 
ùx
.
imm
 = 
n


441 
’d


443 -- 
CË¬
 
®l
 
´efix
 
æags
.

444 
loÿl
 
funùiÚ
 
	$ş—½»fixes
(
ùx
)

445 
ùx
.
o16
 = 
çl£
; ctx.
£g
 = f®£; ctx.
lock
 = f®£; ctx.
»p
 = false

446 
ùx
.
»xw
 = 
çl£
; ctx.
»xr
 = f®£; ctx.
»xx
 = f®£; ctx.
»xb
 = false

447 
ùx
.
»x
 = 
çl£
; ctx.
a32
 = f®£; ctx.
vexl
 = false

448 
’d


450 -- 
F®lback
 
šcom¶‘e
 
İcodes
 
©
 
the
 
’d
.

451 
loÿl
 
funùiÚ
 
	$šcom¶‘e
(
ùx
)

452 
ùx
.
pos
 = ctx.
¡İ
+1

453 
	$ş—½»fixes
(
ùx
)

454  
	`putİ
(
ùx
, "(incomplete)")

455 
’d


457 -- 
F®lback
 
unknown
 
İcodes
.

458 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

459 
	$ş—½»fixes
(
ùx
)

460  
	`putİ
(
ùx
, "(unknown)")

461 
’d


463 -- 
R‘uº
 
ª
 
immedŸ‹
 
of
 
the
 
¥ecif›d
 
size
.

464 
loÿl
 
funùiÚ
 
	$g‘imm
(
ùx
, 
pos
, 
n
)

465 
pos
+
n
-1 > 
ùx
.
¡İ
 
th’
  
	$šcom¶‘e
(
ùx
è
’d


466 
loÿl
 
code
 = 
ùx
.code

467 
n
 =ğ1 
th’


468 
loÿl
 
b1
 = 
	$by‹
(
code
, 
pos
,…os)

469  
b1


470 
–£if
 
n
 =ğ2 
th’


471 
loÿl
 
b1
, 
b2
 = 
	`by‹
(
code
, 
pos
,…os+1)

472  
b1
+
b2
*256

474 
loÿl
 
b1
, 
b2
, 
b3
, 
b4
 = 
	`by‹
(
code
, 
pos
,…os+3)

475 
loÿl
 
imm
 = 
b1
+
b2
*256+
b3
*65536+
b4
*16777216

476 
ùx
.
imm
 = imm

477  
imm


478 
’d


479 
’d


481 -- 
Proûss
 
·‰”n
 
¡ršg
 
ªd
 
g’”©e
 
the
 
İ”ªds
.

482 
loÿl
 
funùiÚ
 
	$pu©
(
ùx
, 
Çme
, 
·t
)

483 
loÿl
 
İ”ªds
, 
»gs
, 
sz
, 
mode
, 
¥
, 
rm
, 
sc
, 
rx
, 
sdi¥


484 
loÿl
 
code
, 
pos
, 
¡İ
, 
vexl
 = 
ùx
.code, ctx.pos, ctx.stop, ctx.vexl

486 -- 
Ch¬s
 
u£d
: 1DF
GIMPQRSTUVWXYabcdfgijlmİr¡uvwxyz


487 
p
 
š
 
	`gm©ch
(
·t
, ".") do

488 
loÿl
 
x
 = 
n


489 
p
 =ğ"V" 
Ü
… =ğ"U" 
th’


490 
ùx
.
»xw
 
th’
 
sz
 = "Q"; ctx.»xw = 
çl£


491 
–£if
 
ùx
.
o16
 
th’
 
sz
 = "W"; ctx.o16 = 
çl£


492 
–£if
 
p
 =ğ"U" 
ªd
 
ùx
.
x64
 
th’
 
sz
 = "Q"

493 
sz
 = "D" 
’d


494 
»gs
 = 
m­_»gs
[
sz
]

495 
–£if
 
p
 =ğ"T" 
th’


496 
ùx
.
»xw
 
th’
 
sz
 = "Q"; ctx.»xw = 
çl£
 sz = "D" 
’d


497 
»gs
 = 
m­_»gs
[
sz
]

498 
–£if
 
p
 =ğ"B" 
th’


499 
sz
 = "B"

500 
»gs
 = 
ùx
.
»x
 
ªd
 
m­_»gs
.
B64
 
Ü
 m­_»gs.
B


501 
–£if
 
	`m©ch
(
p
, "[WDQMXYFG]"è
th’


502 
sz
 = 
p


503 
sz
 =ğ"X" 
ªd
 
vexl
 
th’
 sz = "Y"; 
ùx
.vexÈğ
çl£
 
’d


504 
»gs
 = 
m­_»gs
[
sz
]

505 
–£if
 
p
 =ğ"P" 
th’


506 
sz
 = 
ùx
.
o16
 
ªd
 "X" 
Ü
 "M"; ctx.o16 = 
çl£


507 
sz
 =ğ"X" 
ªd
 
vexl
 
th’
 sz = "Y"; 
ùx
.vexÈğ
çl£
 
’d


508 
»gs
 = 
m­_»gs
[
sz
]

509 
–£if
 
p
 =ğ"S" 
th’


510 
Çme
 =‚ame..
	$low”
(
sz
)

511 
–£if
 
p
 =ğ"s" 
th’


512 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 1); 
nÙ
 imm 
th’
  
’d


513 
x
 = 
imm
 <ğ127 
ªd
 
	`fÜm©
("+0x%02x", imm)

514 
Ü
 
	`fÜm©
("-0x%02x", 256-
imm
)

515 
pos
 =…os+1

516 
–£if
 
p
 =ğ"u" 
th’


517 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 1); 
nÙ
 imm 
th’
  
’d


518 
x
 = 
	`fÜm©
("0x%02x", 
imm
)

519 
pos
 =…os+1

520 
–£if
 
p
 =ğ"b" 
th’


521 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 1); 
nÙ
 imm 
th’
  
’d


522 
x
 = 
»gs
[
imm
/16+1]

523 
pos
 =…os+1

524 
–£if
 
p
 =ğ"w" 
th’


525 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 2); 
nÙ
 imm 
th’
  
’d


526 
x
 = 
	`fÜm©
("0x%x", 
imm
)

527 
pos
 =…os+2

528 
–£if
 
p
 =ğ"o" 
th’
 -- [
off£t
]

529 
ùx
.
x64
 
th’


530 
loÿl
 
imm1
 = 
	`g‘imm
(
ùx
, 
pos
, 4); 
nÙ
 imm1 
th’
  
’d


531 
loÿl
 
imm2
 = 
	`g‘imm
(
ùx
, 
pos
+4, 4); 
nÙ
 imm2 
th’
  
’d


532 
x
 = 
	`fÜm©
("[0x%08x%08x]", 
imm2
, 
imm1
)

533 
pos
 =…os+8

535 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 4); 
nÙ
 imm 
th’
  
’d


536 
x
 = 
	`fÜm©
("[0x%08x]", 
imm
)

537 
pos
 =…os+4

538 
’d


539 
–£if
 
p
 =ğ"i" 
Ü
… =ğ"I" 
th’


540 
loÿl
 
n
 = 
m­_sz2n
[
sz
]

541 
n
 =ğ8 
ªd
 
ùx
.
x64
‡nd 
p
 =ğ"I" 
th’


542 
loÿl
 
imm1
 = 
	`g‘imm
(
ùx
, 
pos
, 4); 
nÙ
 imm1 
th’
  
’d


543 
loÿl
 
imm2
 = 
	`g‘imm
(
ùx
, 
pos
+4, 4); 
nÙ
 imm2 
th’
  
’d


544 
x
 = 
	`fÜm©
("0x%08x%08x", 
imm2
, 
imm1
)

546 
n
 =ğ8 
th’
‚ = 4 
’d


547 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 
n
); 
nÙ
 imm 
th’
  
’d


548 
sz
 =ğ"Q" 
	`ªd
 (
imm
 < 0 
Ü
 imm > 0x7fffffffè
th’


549 
imm
 = (0xffffffff+1)-imm

550 
x
 = 
	`fÜm©
(
imm
 > 65535 
ªd
 "-0x%08x" 
Ü
 "-0x%x", imm)

552 
x
 = 
	`fÜm©
(
imm
 > 65535 
ªd
 "0x%08x" 
Ü
 "0x%x", imm)

553 
’d


554 
’d


555 
pos
 =…os+
n


556 
–£if
 
p
 =ğ"j" 
th’


557 
loÿl
 
n
 = 
m­_sz2n
[
sz
]

558 
n
 =ğ8 
th’
‚ = 4 
’d


559 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 
n
); 
nÙ
 imm 
th’
  
’d


560 
sz
 =ğ"B" 
ªd
 
imm
 > 127 
th’
 imm = imm-256

561 
–£if
 
imm
 > 2147483647 
th’
 imm = imm-4294967296 
’d


562 
pos
 =…os+
n


563 
imm
 = imm + 
pos
 + 
ùx
.
addr


564 
imm
 > 4294967295 
ªd
 
nÙ
 
ùx
.
x64
 
th’
 imm = imm-4294967296 
’d


565 
ùx
.
imm
 = imm

566 
sz
 =ğ"W" 
th’


567 
x
 = 
	`fÜm©
("wÜd 0x%04x", 
imm
%65536)

568 
–£if
 
ùx
.
x64
 
th’


569 
loÿl
 
lo
 = 
imm
 % 0x1000000

570 
x
 = 
	`fÜm©
("0x%02x%06x", (
imm
-
lo
) / 0x1000000,†o)

572 
x
 = "0x"..
	$tohex
(
imm
)

573 
’d


574 
–£if
 
p
 =ğ"R" 
th’


575 
loÿl
 
r
 = 
	`by‹
(
code
, 
pos
-1,…os-1)%8

576 
ùx
.
»xb
 
th’
 
r
 =„ + 8; ctx.»xb = 
çl£
 
’d


577 
x
 = 
»gs
[
r
+1]

578 
–£if
 
p
 =ğ"a" 
th’
 
x
 = 
»gs
[1]

579 
–£if
 
p
 =ğ"c" 
th’
 
x
 = "cl"

580 
–£if
 
p
 =ğ"d" 
th’
 
x
 = "dx"

581 
–£if
 
p
 =ğ"1" 
th’
 
x
 = "1"

583 
nÙ
 
mode
 
th’


584 
mode
 = 
ùx
.
mrm


585 
nÙ
 
mode
 
th’


586 
pos
 > 
¡İ
 
th’
  
	$šcom¶‘e
(
ùx
è
’d


587 
mode
 = 
	$by‹
(
code
, 
pos
,…os)

588 
pos
 =…os+1

589 
’d


590 
rm
 = 
mode
%8; mode = (mode-rm)/8

591 
¥
 = 
mode
%8; mode = (mode-sp)/8

592 
sdi¥
 = ""

593 
mode
 < 3 
th’


594 
rm
 =ğ4 
th’


595 
pos
 > 
¡İ
 
th’
  
	$šcom¶‘e
(
ùx
è
’d


596 
sc
 = 
	$by‹
(
code
, 
pos
,…os)

597 
pos
 =…os+1

598 
rm
 = 
sc
%8; sc = (sc-rm)/8

599 
rx
 = 
sc
%8; sc = (sc-rx)/8

600 
ùx
.
»xx
 
th’
 
rx
 =„x + 8; ctx.»xx = 
çl£
 
’d


601 
rx
 =ğ4 
th’
„x = 
n
 
’d


602 
’d


603 
mode
 > 0 
Ü
 
rm
 =ğ5 
th’


604 
loÿl
 
dsz
 = 
mode


605 
dsz
 ~ğ1 
th’
 dsz = 4 
’d


606 
loÿl
 
di¥
 = 
	`g‘imm
(
ùx
, 
pos
, 
dsz
); 
nÙ
 di¥ 
th’
  
’d


607 
mode
 =ğ0 
th’
 
rm
 = 
n
 
’d


608 
rm
 
Ü
 
rx
 
	$Ü
 (
nÙ
 
sc
 
ªd
 
ùx
.
x64
‡nd‚Ù ctx.
a32
è
th’


609 
dsz
 =ğ1 
ªd
 
di¥
 > 127 
th’


610 
sdi¥
 = 
	`fÜm©
("-0x%x", 256-
di¥
)

611 
–£if
 
di¥
 >ğ0 
ªd
 di¥ <ğ0x7ffffffà
th’


612 
sdi¥
 = 
	`fÜm©
("+0x%x", 
di¥
)

614 
sdi¥
 = 
	`fÜm©
("-0x%x", (0xffffffff+1)-
di¥
)

615 
’d


617 
sdi¥
 = 
	`fÜm©
(
ùx
.
x64
 
ªd
 
nÙ
 ctx.
a32
‡nd

618 
	`nÙ
 (
di¥
 >ğ0 
ªd
 disp <= 0x7fffffff)

619 
ªd
 "0xffffffff%08x" 
Ü
 "0x%08x", 
di¥
)

620 
’d


621 
pos
 =…os+
dsz


622 
’d


623 
’d


624 
rm
 
ªd
 
ùx
.
»xb
 
th’
„m =„m + 8; ctx.»xb = 
çl£
 
’d


625 
ùx
.
»xr
 
th’
 
¥
 = s°+ 8; ctx.»x¸ğ
çl£
 
’d


626 
’d


627 
p
 =ğ"m" 
th’


628 
mode
 =ğ3 
th’
 
x
 = 
»gs
[
rm
+1]

630 
loÿl
 
¬egs
 = 
ùx
.
a32
 
ªd
 
m­_»gs
.
D
 
Ü
 ctx.aregs

631 
loÿl
 
¤m
, 
¤x
 = "", ""

632 
rm
 
th’
 
¤m
 = 
¬egs
[rm+1]

633 
–£if
 
nÙ
 
sc
 
ªd
 
ùx
.
x64
‡nd‚Ù ctx.
a32
 
th’
 
¤m
 = "r" 
’d


634 
ùx
.
a32
 = 
çl£


635 
rx
 
th’


636 
rm
 
th’
 
¤m
 = srm.."+" 
’d


637 
¤x
 = 
¬egs
[
rx
+1]

638 
sc
 > 0 
th’
 
¤x
 = srx.."*"..(2^scè
’d


639 
’d


640 
x
 = 
	`fÜm©
("[%s%s%s]", 
¤m
, 
¤x
, 
sdi¥
)

641 
’d


642 
mode
 < 3 
ªd


643 (
nÙ
 
	`m©ch
(
·t
, "[aRrgp]"è
Ü
 m©chÕ©, "t")è
th’
 -- 
Yuck
.

644 
x
 = 
m­_sz2´efix
[
sz
].." "..x

645 
’d


646 
–£if
 
p
 =ğ"r" 
th’
 
x
 = 
»gs
[
¥
+1]

647 
–£if
 
p
 =ğ"g" 
th’
 
x
 = 
m­_£g»gs
[
¥
+1]

648 
–£if
 
p
 =ğ"p" 
th’
 -- 
Suµ»ss
 
´efix
.

649 
–£if
 
p
 =ğ"f" 
th’
 
x
 = "¡"..
rm


650 
–£if
 
p
 =ğ"x" 
th’


651 
¥
 =ğ0 
ªd
 
ùx
.
lock
‡nd 
nÙ
 ctx.
x64
 
th’


652 
x
 = "CR8"; 
ùx
.
lock
 = 
çl£


654 
x
 = "CR"..
¥


655 
’d


656 
–£if
 
p
 =ğ"v" 
th’


657 
ùx
.
vexv
 
th’


658 
x
 = 
»gs
[
ùx
.
vexv
+1]; ctx.vexv = 
çl£


659 
’d


660 
–£if
 
p
 =ğ"y" 
th’
 
x
 = "DR"..
¥


661 
–£if
 
p
 =ğ"z" 
th’
 
x
 = "TR"..
¥


662 
–£if
 
p
 =ğ"l" 
th’
 
vexl
 = 
çl£


663 
–£if
 
p
 =ğ"t" 
th’


665 
	`”rÜ
("bad…©‹º `"..
·t
.."'")

666 
’d


667 
’d


668 
x
 
th’
 
İ”ªds
 = o³¿nd 
ªd
 o³¿nds..", "..x 
Ü
 x 
’d


669 
’d


670 
ùx
.
pos
 =…os

671  
	$putİ
(
ùx
, 
Çme
, 
İ”ªds
)

672 
’d


674 -- 
FÜw¬d
 
deş¬©iÚ
.

675 
loÿl
 
m­_aù


677 -- 
F‘ch
 
ªd
 
ÿche
 
MRM
 
by‹
.

678 
loÿl
 
funùiÚ
 
	$g‘mrm
(
ùx
)

679 
loÿl
 
mrm
 = 
ùx
.mrm

680 
nÙ
 
mrm
 
th’


681 
loÿl
 
pos
 = 
ùx
.pos

682 
pos
 > 
ùx
.
¡İ
 
th’
  
n
 
’d


683 
mrm
 = 
	$by‹
(
ùx
.
code
, 
pos
,…os)

684 
ùx
.
pos
 =…os+1

685 
ùx
.
mrm
 = mrm

686 
’d


687  
mrm


688 
’d


690 -- 
Di¥©ch
 
to
 
hªdËr
 
d•’dšg
 
Ú
 
·‰”n
.

691 
loÿl
 
funùiÚ
 
	$di¥©ch
(
ùx
, 
İ©
, 
·tg½
)

692 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


693 
	`m©ch
(
İ©
, "%|"è
th’
 -- 
MMX
/
SSE
 
v¬ŸÁs
 
d•’dšg
 
Ú
 
´efix
.

694 
loÿl
 
p


695 
ùx
.
»p
 
th’


696 
p
 = 
ùx
.
»p
=="»p" 
ªd
 "%|([^%|]*)" 
Ü
 "%|[^%|]*%|[^%|]*%|([^%|]*)"

697 
ùx
.
»p
 = 
çl£


698 
–£if
 
ùx
.
o16
 
th’
 
p
 = "%|[^%|]*%|([^%|]*)"; ctx.o16 = 
çl£


699 
p
 = "^[^%|]*" 
’d


700 
İ©
 = 
	$m©ch
(
İ©
, 
p
)

701 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


702 -- 
ùx
.
»p
 = 
çl£
; ctx.
o16
 = false

703 --
XXX
 
çs
 66 
f2
 0à38 
f1
 06 
üc32
 
—x
,
WORD
 
PTR
 [
esi
]

704 --
XXX
 
»move
 
š
 
b¿nches
?

705 
’d


706 
	`m©ch
(
İ©
, "%$"è
th’
 -- 
»g$mem
 
v¬ŸÁs
.

707 
loÿl
 
mrm
 = 
	`g‘mrm
(
ùx
); 
nÙ
 mrm 
th’
  
	$šcom¶‘e
(
ùx
è
’d


708 
İ©
 = 
	`m©ch
(İ©, 
mrm
 >ğ192 
ªd
 "^[^%$]*" 
Ü
 "%$(.*)")

709 
İ©
 =ğ"" 
th’
  
	$unknown
(
ùx
è
’d


710 
’d


711 
İ©
 =ğ"" 
th’
  
	$unknown
(
ùx
è
’d


712 
loÿl
 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9 ]*)(.*)")

713 
·t
 =ğ"" 
ªd
 
·tg½
 
th’
…© =…©g½ 
’d


714  
m­_aù
[
	`sub
(
·t
, 1, 1)](
ùx
, 
Çme
,…at)

715 
’d


717 -- 
G‘
 
a
 
·‰”n
 
äom
 
ª
 
İcode
 
m­
 
ªd
 
di¥©ch
 
to
 
hªdËr
.

718 
loÿl
 
funùiÚ
 
	$di¥©chm­
(
ùx
, 
İcm­
)

719 
loÿl
 
pos
 = 
ùx
.pos

720 
loÿl
 
İ©
 = 
İcm­
[
	`by‹
(
ùx
.
code
, 
pos
,…os)]

721 
pos
 =…os + 1

722 
ùx
.
pos
 =…os

723  
	$di¥©ch
(
ùx
, 
İ©
)

724 
’d


726 -- 
M­
 
aùiÚ
 
codes
. 
The
 
key
 
is
 
the
 
fœ¡
 
aá”
h
Çme
.

727 
m­_aù
 = {

728 -- 
Sim¶e
 
İcodes
 
w™hout
 
İ”ªds
.

729 [""] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

730  
	`putİ
(
ùx
, 
Çme
)

731 
’d
,

733 -- 
O³¿nd
 
size
 
ch¬s
 
çÎ
 
right
 
through
.

734 
B
 = 
pu©
, 
W
 =…u©, 
D
 =…u©, 
Q
 =…utpat,

735 
V
 = 
pu©
, 
U
 =…u©, 
T
 =…utpat,

736 
M
 = 
pu©
, 
X
 =…u©, 
P
 =…utpat,

737 
F
 = 
pu©
, 
G
 =…u©, 
Y
 =…utpat,

739 -- 
CŞËù
 
´efixes
.

740 [":"] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

741 
ùx
[
·t
 =ğ":" 
ªd
 
Çme
 
Ü
 
	`sub
(pat, 2)] =‚ame

742 
ùx
.
pos
 - ctx.
¡¬t
 > 5 
th’
  
	`unknown
(ùxè
’d
 -- 
Lim™
 #prefixes.

743 
’d
,

745 -- 
Chaš
 
to
 
¥ecŸl
 
hªdËr
 
¥ecif›d
 
by
 
Çme
.

746 ["*"] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

747  
m­_aù
[
Çme
](
ùx
,‚ame, 
	`sub
(
·t
, 2))

748 
’d
,

750 -- 
U£
 
Çmed
 
subbË
 
İcode
 
group
.

751 ["!"] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

752 
loÿl
 
mrm
 = 
	`g‘mrm
(
ùx
); 
nÙ
 mrm 
th’
  
	`šcom¶‘e
(ùxè
’d


753  
	`di¥©ch
(
ùx
, 
m­_İcgroup
[
Çme
][((
mrm
-(mrm%8))/8)%8+1], 
	`sub
(
·t
, 2))

754 
’d
,

756 -- 
o16
,
o32
[,
o64
] 
v¬ŸÁs
.

757 
sz
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

758 
ùx
.
o16
 
th’
 ctx.o16 = 
çl£


760 
·t
 = 
	`m©ch
(pat, ",(.*)")

761 
ùx
.
»xw
 
th’


762 
loÿl
 
p
 = 
	`m©ch
(
·t
, ",(.*)")

763 
p
 
th’
 
·t
 =…; 
ùx
.
»xw
 = 
çl£
 
’d


764 
’d


765 
’d


766 
·t
 = 
	`m©ch
(pat, "^[^,]*")

767  
	`di¥©ch
(
ùx
, 
·t
)

768 
’d
,

770 -- 
Two
-
by‹
 
İcode
 
di¥©ch
.

771 
İc2
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

772  
	`di¥©chm­
(
ùx
, 
m­_İc2
)

773 
’d
,

775 -- 
Th»e
-
by‹
 
İcode
 
di¥©ch
.

776 
İc3
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

777  
	`di¥©chm­
(
ùx
, 
m­_İc3
[
·t
])

778 
’d
,

780 -- 
VMX
/
SVM
 
di¥©ch
.

781 
vm
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

782  
	`di¥©ch
(
ùx
, 
m­_İcvm
[ùx.
mrm
])

783 
’d
,

785 -- 
Flßtšg
 
pošt
 
İcode
 
di¥©ch
.

786 
å
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

787 
loÿl
 
mrm
 = 
	`g‘mrm
(
ùx
); 
nÙ
 mrm 
th’
  
	`šcom¶‘e
(ùxè
’d


788 
loÿl
 
rm
 = 
mrm
%8

789 
loÿl
 
idx
 = 
·t
*8 + ((
mrm
-
rm
)/8)%8

790 
mrm
 >ğ192 
th’
 
idx
 = idx + 64 
’d


791 
loÿl
 
İ©
 = 
m­_İcå
[
idx
]

792 
	`ty³
(
İ©
è=ğ"bË" 
th’
 o·ˆğİ©[
rm
+1] 
’d


793  
	`di¥©ch
(
ùx
, 
İ©
)

794 
’d
,

796 -- 
REX
 
´efix
.

797 
»x
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

798 
ùx
.
»x
 
th’
  
	`unknown
(ùxè
’d
 -- 
OÆy
 1 
REX
 
Ü
 
VEX
 
´efix
 
®lowed
.

799 
p
 
š
 
	`gm©ch
(
·t
, "."èdØ
ùx
["»x"..p] = 
Œue
 
’d


800 
ùx
.
»x
 = "rex"

801 
’d
,

803 -- 
VEX
 
´efix
.

804 
vex
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

805 
ùx
.
»x
 
th’
  
	`unknown
(ùxè
’d
 -- 
OÆy
 1 
REX
 
Ü
 
VEX
 
´efix
 
®lowed
.

806 
ùx
.
»x
 = "vex"

807 
loÿl
 
pos
 = 
ùx
.pos

808 
ùx
.
mrm
 
th’


809 
ùx
.
mrm
 = 
n


810 
pos
 =…os-1

811 
’d


812 
loÿl
 
b
 = 
	`by‹
(
ùx
.
code
, 
pos
,…os)

813 
nÙ
 
b
 
th’
  
	`šcom¶‘e
(
ùx
è
’d


814 
pos
 =…os+1

815 
b
 < 128 
th’
 
ùx
.
»xr
 = 
Œue
 
’d


816 
loÿl
 
m
 = 1

817 
·t
 =ğ"3" 
th’


818 
m
 = 
b
%32; b = (b-m)/32

819 
loÿl
 
nb
 = 
b
%2; b = (b-nb)/2

820 
nb
 =ğ0 
th’
 
ùx
.
»xb
 = 
Œue
 
’d


821 
loÿl
 
nx
 = 
b
%2

822 
nx
 =ğ0 
th’
 
ùx
.
»xx
 = 
Œue
 
’d


823 
b
 = 
	`by‹
(
ùx
.
code
, 
pos
,…os)

824 
nÙ
 
b
 
th’
  
	`šcom¶‘e
(
ùx
è
’d


825 
pos
 =…os+1

826 
b
 >ğ128 
th’
 
ùx
.
»xw
 = 
Œue
 
’d


827 
’d


828 
ùx
.
pos
 =…os

829 
loÿl
 
m­


830 
m
 =ğ1 
th’
 
m­
 = 
m­_İc2


831 
–£if
 
m
 =ğ2 
th’
 
m­
 = 
m­_İc3
["38"]

832 
–£if
 
m
 =ğ3 
th’
 
m­
 = 
m­_İc3
["3a"]

833  
	`unknown
(
ùx
è
’d


834 
loÿl
 
p
 = 
b
%4; b = (b-p)/4

835 
p
 =ğ1 
th’
 
ùx
.
o16
 = "o16"

836 
–£if
 
p
 =ğ2 
th’
 
ùx
.
»p
 = "rep"

837 
–£if
 
p
 =ğ3 
th’
 
ùx
.
»p
 = "»²e" 
’d


838 
loÿl
 
l
 = 
b
%2; b = (b-l)/2

839 
l
 ~ğ0 
th’
 
ùx
.
vexl
 = 
Œue
 
’d


840 
ùx
.
vexv
 = (-1-
b
)%16

841  
	`di¥©chm­
(
ùx
, 
m­
)

842 
’d
,

844 -- 
S³cŸl
 
nİ
 
w™h
 
REX
 
´efix
.

845 
nİ
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

846  
	`di¥©ch
(
ùx
, ctx.
»x
 
ªd
 
·t
 
Ü
 "nop")

847 
’d
,

849 -- 
S³cŸl
 0F 77.

850 
emms
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

851 
ùx
.
»x
 ~ğ"vex" 
th’


852  
	`putİ
(
ùx
, "emms")

853 
–£if
 
ùx
.
vexl
 
th’


854 
ùx
.
vexl
 = 
çl£


855  
	`putİ
(
ùx
, "zeroall")

857  
	`putİ
(
ùx
, "zeroupper")

858 
’d


859 
’d
,

860 
	}
}

864 -- 
Di§s£mbË
 
a
 
block
 
of
 
	gcode
.

865 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

866 
nÙ
 
ofs
 
th’
 of ğ0 
’d


867 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


868 
ofs
 = ofs + 1

869 
ùx
.
¡¬t
 = 
ofs


870 
ùx
.
pos
 = 
ofs


871 
ùx
.
¡İ
 = stop

872 
ùx
.
imm
 = 
n


873 
ùx
.
mrm
 = 
çl£


874 
	$ş—½»fixes
(
ùx
)

875 
ùx
.
pos
 <ğ
¡İ
 dØ
	$di¥©chm­
(
ùx
, ctx.
m­1
è
’d


876 
ùx
.
pos
 ~ğùx.
¡¬t
 
th’
 
	$šcom¶‘e
(
ùx
è
’d


877 
’d


879 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

880 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

881 
loÿl
 
ùx
 = {
	}
}

882 
ùx
.
code
 = code

883 
ùx
.
addr
 = (add¸
Ü
 0) - 1

884 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


885 
ùx
.
symb
 = {}

886 
ùx
.
di§ss
 = 
di§ss_block


887 
ùx
.
hexdump
 = 16

888 
ùx
.
x64
 = 
çl£


889 
ùx
.
m­1
 = 
m­_İc1_32


890 
ùx
.
¬egs
 = 
m­_»gs
.
D


891  
ùx


892 
’d


894 
loÿl
 
funùiÚ
 
	$ü—‹64
(
code
, 
addr
, 
out
)

895 
loÿl
 
ùx
 = 
	$ü—‹
(
code
, 
addr
, 
out
)

896 
ùx
.
x64
 = 
Œue


897 
ùx
.
m­1
 = 
m­_İc1_64


898 
ùx
.
¬egs
 = 
m­_»gs
.
Q


899  
ùx


900 
’d


902 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

903 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

904 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

905 
’d


907 
loÿl
 
funùiÚ
 
	$di§ss64
(
code
, 
addr
, 
out
)

908 
	$ü—‹64
(
code
, 
addr
, 
out
):
	$di§ss
()

909 
’d


911 -- 
R‘uº
 
Çme
 
RID
.

912 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

913 
r
 < 8 
th’
  
m­_»gs
.
D
[r+1] 
’d


914  
m­_»gs
.
X
[
r
-7]

915 
’d


917 
loÿl
 
funùiÚ
 
	$»gÇme64
(
r
)

918 
r
 < 16 
th’
  
m­_»gs
.
Q
[r+1] 
’d


919  
m­_»gs
.
X
[
r
-15]

920 
’d


922 -- 
Public
 
moduË
 
funùiÚs
.

924 
ü—‹
 = create,

925 
ü—‹64
 = create64,

926 
di§ss
 = disass,

927 
di§ss64
 = disass64,

928 
»gÇme
 =„egname,

929 
»gÇme64
 =„egname64

930 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dump.lua

2 -- 
LuaJIT
 
comp”
 
dump
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
ÿn
 
be
 
u£d
 
to
 
debug
 
the
 
JIT
 
comp”
 
	g™£lf
. 
It
 
dumps
 
	gthe


9 -- 
code
 
»´e£Á©iÚs
 
ªd
 
¡ruùu»s
 
u£d
 
š
 
v¬ious
 
comp”
 
	g¡ages
.

11 -- 
Exam¶e
 
	gu§ge
:

13 -- 
luaj™
 -
jdump
 -
e
 "local x=0; for i=1,1e6 do x=x+iƒnd;…rint(x)"

14 -- 
luaj™
 -
jdump
=
im
 -
e
 "fÜ i=1,1000 dØfÜ j=1,1000 dØ’dƒnd" | 
Ëss
 -
R


15 -- 
luaj™
 -
jdump
=
is
 
my­p
.
lua
 | 
Ëss
 -
R


16 -- 
luaj™
 -
jdump
=-
b
 
my­p
.
lua


17 -- 
luaj™
 -
jdump
=+
aH
,
	gmy­p
.
html
 my­p.
	glua


18 -- 
	gluaj™
 -
	gjdump
=
ixT
,
	gmy­p
.
dump
 my­p.
	glua


20 -- 
The
 
fœ¡
 
¬gum’t
 
¥ecif›s
 
the
 
dump
 
	gmode
. Th
£cÚd
‡rgum’ˆ
	ggives


21 -- 
the
 
ouut
 
fe
 
	gÇme
. 
DeçuÉ
 ouuˆ
is
 
to
 
	g¡dout
, 
uÆess
h
	g’vœÚm’t


22 -- 
v¬ŸbË
 
LUAJIT_DUMPFILE
 
is
 
	g£t
. 
The
 
fe
 i 
ov”wr™‹n
 
ev”y
 
time
 
	gthe


23 -- 
moduË
 
is
 
	g¡¬‹d
.

25 -- 
Difã»Á
 
ã©u»s
 
ÿn
 
be
 
tuºed
 
Ú
 
Ü
 
off
 
w™h
 
the
 
dump
 
	gmode
. 
If
 
	gthe


26 -- 
mode
 
¡¬ts
 
w™h
 
	ga
 '+', 
the
 
fŞlowšg
 
ã©u»s
 
¬e
 
added
 
to
he 

27 -- 
£t
 
of
 
	gã©u»s
; 
	ga
 '-' 
»moves
 
	gthem
. 
Oth”wi£
 
the
 
ã©u»s
 
¬e
 
	g»¶aûd
.

29 -- 
The
 
fŞlowšg
 
dump
 
ã©u»s
 
¬e
 
	$avaabË
 (* 
m¬ks
 
the
 ):

31 -- * 
t
 
Pršt
 
a
 
lše
 
—ch
 
¡¬‹d
, 
’ded
 
Ü
 
abÜ‹d
 
	`Œaû
 (
£e
 
®so
 -
jv
).

32 -- * 
b
 
Dump
 
the
 
Œaûd
 
by‹code
.

33 -- * 
i
 
Dump
 
the
 
	`IR
 (
š‹rmedŸ‹
 
»´e£Á©iÚ
).

34 -- 
r
 
Augm’t
 
the
 
IR
 
w™h
 /
¡ack
 
¦Ùs
.

35 -- 
s
 
Dump
 
the
 
¢­shÙ
 
m­
.

36 -- * 
m
 
Dump
 
the
 
g’”©ed
 
machše
 
code
.

37 -- 
x
 
Pršt
 
—ch
 
k’
 
Œaû
 
ex™
.

38 -- 
X
 
Pršt
 
—ch
 
k’
 
Œaû
 
ex™
 
ªd
 
the
 
cÚ‹Ás
 
of
 
®l
 
»gi¡”s
.

39 -- 
a
 
Pršt
 
the
 
IR
 
of
 
abÜ‹d
 
Œaûs
, 
too
.

41 -- 
The
 
ouut
 
fÜm©
 
ÿn
 
be
 
£t
 
w™h
 
the
 
fŞlowšg
 
ch¬aù”s
:

43 -- 
T
 
PÏš
 
‹xt
 
ouut
.

44 -- 
A
 
ANSI
-
cŞÜed
 
‹xt
 
ouut


45 -- 
H
 
CŞÜized
 
HTML
 + 
CSS
 
ouut
.

47 -- 
The
  
ouut
 
fÜm©
 
is
 
¶aš
 
‹xt
. 
It
's seto ANSI-coloredext

48 -- 
the
 
COLORTERM
 
v¬ŸbË
 
is
 
£t
. 
NÙe
: 
this
 i 
šd•’d’t
 
of
 
ªy
 
ouut


49 -- 
»dœeùiÚ
, 
which
 
is
 
aùu®ly
 
cÚsid”ed
 
a
 
ã©u»
.

51 -- 
You
 
´obably
 
wªt
 
to
 
u£
 
Ëss
 -
R
Ø
’joy
 
v›wšg
 
ANSI
-
cŞÜed
 
‹xt
 
äom


52 -- 
a
 
pe
 
Ü
‡ 
fe
. 
Add
 
this
 
to
 
your
 ~/.
bashrc
: 
expÜt
 
LESS
="-R"

56 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
objeùs
.

57 
loÿl
 
j™
 = 
	`»quœe
("jit")

58 
	`as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

59 
loÿl
 
jut
 = 
	`»quœe
("jit.util")

60 
loÿl
 
vmdef
 = 
	`»quœe
("jit.vmdef")

61 
loÿl
 
funcšfo
, 
funcbc
 = 
jut
.funcinfo, jutil.funcbc

62 
loÿl
 
Œaûšfo
, 
Œaûœ
, 
Œaûk
 = 
jut
.traceinfo, jutil.traceir, jutil.tracek

63 
loÿl
 
Œaûmc
, 
Œaû¢­
 = 
jut
.tracemc, jutil.tracesnap

64 
loÿl
 
Œaûex™¡ub
, 
œÿÎaddr
 = 
jut
.traceexitstub, jutil.ircalladdr

65 
loÿl
 
b™
 = 
	`»quœe
("bit")

66 
loÿl
 
bªd
, 
shr
, 
tohex
 = 
b™
.bªd, b™.
rshiá
, bit.tohex

67 
loÿl
 
sub
, 
gsub
, 
fÜm©
 = 
¡ršg
.sub, string.gsub, string.format

68 
loÿl
 
by‹
, 
»p
 = 
¡ršg
.byte, string.rep

69 
loÿl
 
ty³
, 
to¡ršg
 =ype,ostring

70 
loÿl
 
¡dout
, 
¡d”r
 = 
io
.stdout, io.stderr

72 -- 
Lßd
 
Ùh”
 
moduËs
 
Ú
-
demªd
.

73 
loÿl
 
bşše
, 
di§ss


75 -- 
Aùive
 
æag
, 
ouut
 
fe
 
hªdË
 
ªd
 
dump
 
mode
.

76 
loÿl
 
aùive
, 
out
, 
dumpmode


80 
loÿl
 
symbmt
 = { 
__šdex
 = 
çl£
 
	}
}

81 
loÿl
 
	gsymb
 = {}

82 
loÿl
 
Ãx™sym
 = 0

84 -- 
Fl
 
Ã¡ed
 
symbŞ
 
bË
 
w™h
 
³r
-
Œaû
 
ex™
 
¡ub
 
add»s£s
.

85 
loÿl
 
funùiÚ
 
	$flsymb_Œ
(
Œ
, 
Ãx™
)

86 
loÿl
 
t
 = {
	}
}

87 
symbmt
.
__šdex
 = 
t


88 
j™
.
¬ch
:
sub
(1, 4è=ğ"ms" 
th’


89 
t
[
Œaûex™¡ub
(
Œ
, 0)] = "exit"

91 
’d


92 
i
=0,
	gÃx™
-1 do

93 
loÿl
 
	gaddr
 = 
	$Œaûex™¡ub
(
Œ
, 
i
)

94 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


95 
t
[
addr
] = 
	$to¡ršg
(
i
)

96 
’d


97 
loÿl
 
addr
 = 
	$Œaûex™¡ub
(
Œ
, 
Ãx™
)

98 
addr
 
th’
 
t
[addr] = "¡ack_check" 
’d


99 
’d


101 -- 
Fl
 
symbŞ
 
bË
 
w™h
 
Œaû
 
ex™
 
¡ub
 
add»s£s
.

102 
loÿl
 
funùiÚ
 
	$flsymb
(
Œ
, 
Ãx™
)

103 
loÿl
 
t
 = 
symb


104 
Ãx™sym
 =ğ0 
th’


105 
loÿl
 
œÿÎ
 = 
vmdef
.ircall

106 
i
=0,#ircall do

107 
loÿl
 
addr
 = 
	$œÿÎaddr
(
i
)

108 
addr
 ~ğ0 
th’


109 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


110 
t
[
addr
] = 
œÿÎ
[
i
]

111 
’d


112 
’d


113 
’d


114 
Ãx™sym
 =ğ1000000 
th’
 -- 
P”
-
Œaû
 
ex™
 
¡ubs
.

115 
	$flsymb_Œ
(
Œ
, 
Ãx™
)

116 
–£if
 
Ãx™
 > 
Ãx™sym
 
th’
 -- 
Sh¬ed
 
ex™
 
¡ubs
.

117 
i
=
Ãx™sym
,
Ãx™
-1 do

118 
loÿl
 
addr
 = 
	$Œaûex™¡ub
(
i
)

119 
addr
 =ğ
n
 
th’
 -- 
F®l
 
back
 
to
 
³r
-
Œaû
 
ex™
 
¡ubs
.

120 
	$flsymb_Œ
(
Œ
, 
Ãx™
)

121 
	$£tm‘©abË
(
symb
, 
symbmt
)

122 
Ãx™
 = 1000000

124 
’d


125 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


126 
t
[
addr
] = 
	$to¡ršg
(
i
)

127 
’d


128 
Ãx™sym
 = 
Ãx™


129 
’d


130  
t


131 
’d


133 
loÿl
 
funùiÚ
 
	$dumpwr™e
(
s
)

134 
out
:
	$wr™e
(
s
)

135 
’d


137 -- 
Di§s£mbË
 
machše
 
code
.

138 
loÿl
 
funùiÚ
 
	$dump_mcode
(
Œ
)

139 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

140 
nÙ
 
šfo
 
th’
  
’d


141 
loÿl
 
mcode
, 
addr
, 
loİ
 = 
	$Œaûmc
(
Œ
)

142 
nÙ
 
mcode
 
th’
  
’d


143 
nÙ
 
di§ss
 
th’
 di§s ğ
	`»quœe
("j™.dis_"..
j™
.
¬ch
è
’d


144 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


145 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " mcode ", #mcode, "\n")

146 
loÿl
 
ùx
 = 
di§ss
.
	$ü—‹
(
mcode
, 
addr
, 
dumpwr™e
)

147 
ùx
.
hexdump
 = 0

148 
ùx
.
symb
 = 
	$flsymb
(
Œ
, 
šfo
.
Ãx™
)

149 
loİ
 ~ğ0 
th’


150 
symb
[
addr
+
loİ
] = "LOOP"

151 
ùx
:
	$di§ss
(0, 
loİ
)

152 
out
:
	`wr™e
("->LOOP:\n")

153 
ùx
:
	`di§ss
(
loİ
, #mcode-loop)

154 
symb
[
addr
+
loİ
] = 
n


156 
ùx
:
	`di§ss
(0, #mcode)

157 
’d


158 
’d


162 
loÿl
 
œty³_‹xt
 = {

187 
	}
}

189 
loÿl
 
	gcŞÜty³_ªsi
 = {

216 
loÿl
 
funùiÚ
 
	$cŞÜize_‹xt
(
s
)

217  
s


218 
’d


220 
loÿl
 
funùiÚ
 
	$cŞÜize_ªsi
(
s
, 
t
)

221  
	$fÜm©
(
cŞÜty³_ªsi
[
t
], 
s
)

222 
’d


224 
loÿl
 
œty³_ªsi
 = 
	`£tm‘©abË
({
	}
},

225 { 
	g__šdex
 = 
funùiÚ
(
b
, 
t
)

226 
loÿl
 
	gs
 = 
cŞÜize_ªsi
(
œty³_‹xt
[
t
],); 
	gb
[t] = 
s
;  s; 
	g’d
 })

228 
loÿl
 
	ghtml_esÿ³
 = { ["<"] = "&lt;", [">"] = "&gt;", ["&"] = "&amp;", }

230 
loÿl
 
funùiÚ
 
	$cŞÜize_html
(
s
, 
t
)

231 
s
 = 
	`gsub
(s, "[<>&]", 
html_esÿ³
)

232  
	`fÜm©
('<¥ª cÏss="œt_%s">%s</¥ª>', 
œty³_‹xt
[
t
], 
s
)

233 
’d


235 
loÿl
 
œty³_html
 = 
	`£tm‘©abË
({
	}
},

236 { 
	g__šdex
 = 
funùiÚ
(
b
, 
t
)

237 
loÿl
 
	gs
 = 
cŞÜize_html
(
œty³_‹xt
[
t
],); 
	gb
[t] = 
s
;  s; 
	g’d
 })

239 
loÿl
 
	gh—d”_html
 = [[

240 <
¡yË
 
ty³
="text/css">

241 
background
 { background: #ffffff; 
cŞÜ
: #000000; }

242 
´e
.
ljdump
 {

243 
fÚt
-
size
: 10
±
;

244 
background
: #f0f4ff;

245 
cŞÜ
: #000000;

246 
bÜd”
: 1
px
 
sŞid
 #bfcfff;

247 
·ddšg
: 0.5e
m
;

248 
m¬gš
-
Ëá
: 2e
m
;

249 
m¬gš
-
right
: 2e
m
;

251 
¥ª
.
œt_¡r
 { 
cŞÜ
: #00a000; }

252 
¥ª
.
œt_thr
, s·n.
œt_fun
 { 
cŞÜ
: #404040; 
fÚt
-
weight
: 
bŞd
; }

253 
¥ª
.
œt_b
 { 
cŞÜ
: #c00000; }

254 
¥ª
.
œt_udt
, s·n.
œt_lud
 { 
cŞÜ
: #00c0c0; }

255 
¥ª
.
œt_num
 { 
cŞÜ
: #4040c0; }

256 
¥ª
.
œt_št
, s·n.
œt_i8
, s·n.
œt_u8
, s·n.
œt_i16
, s·n.
œt_u16
 { 
cŞÜ
: #b040b0; }

257 </
¡yË
>

260 
loÿl
 
	gcŞÜize
, 
	gœty³


262 -- 
Lookup
 
bËs
 
to
 
cÚv”t
 
some
 
l™”®s
 
što
 
	gÇmes
.

263 
loÿl
 
	gl™Çme
 = {

264 ["SLOAD "] = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
mode
)

265 
loÿl
 
s
 = ""

266 
bªd
(
mode
, 1è~ğ0 
th’
 
s
 = s.."P" 
’d


267 
bªd
(
mode
, 2è~ğ0 
th’
 
s
 = s.."F" 
’d


268 
bªd
(
mode
, 4è~ğ0 
th’
 
s
 = s.."T" 
’d


269 
bªd
(
mode
, 8è~ğ0 
th’
 
s
 = s.."C" 
’d


270 
bªd
(
mode
, 16è~ğ0 
th’
 
s
 = s.."R" 
’d


271 
bªd
(
mode
, 32è~ğ0 
th’
 
s
 = s.."I" 
’d


272 
t
[
mode
] = 
s


273  
s


274 
’d
}),

276 ["CONV "] = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
mode
)

277 
loÿl
 
s
 = 
œty³
[
bªd
(
mode
, 31)]

278 
s
 = 
œty³
[
bªd
(
shr
(
mode
, 5), 31)].."."..s

279 
bªd
(
mode
, 0x800è~ğ0 
th’
 
s
 = s.." sext" 
’d


280 
loÿl
 
c
 = 
shr
(
mode
, 14)

281 
c
 =ğ2 
th’
 
s
 = s.." index" 
–£if
 c =ğ3h’ s = s.." check" 
’d


282 
t
[
mode
] = 
s


283  
s


284 
’d
}),

285 ["FLOAD "] = 
vmdef
.
œf›ld
,

286 ["FREF "] = 
vmdef
.
œf›ld
,

287 ["FPMATH"] = 
vmdef
.
œåm
,

292 
loÿl
 
funùiÚ
 
	$ùlsub
(
c
)

293 
c
 =ğ"\n" 
th’
  "\\n"

294 
–£if
 
c
 =ğ"\r" 
th’
  "\\r"

295 
–£if
 
c
 =ğ"\t" 
th’
  "\\t"

296  
	`fÜm©
("\\%03d", 
	$by‹
(
c
))

297 
’d


298 
’d


300 
loÿl
 
funùiÚ
 
	$fmtfunc
(
func
, 
pc
)

301 
loÿl
 
fi
 = 
	$funcšfo
(
func
, 
pc
)

302 
fi
.
loc
 
th’


303  
fi
.
loc


304 
–£if
 
fi
.
ffid
 
th’


305  
vmdef
.
fâames
[
fi
.
ffid
]

306 
–£if
 
fi
.
addr
 
th’


307  
	`fÜm©
("C:%x", 
fi
.
addr
)

310 
’d


311 
’d


313 
loÿl
 
funùiÚ
 
	$fÜm©k
(
Œ
, 
idx
, 
¢
)

314 
loÿl
 
k
, 
t
, 
¦Ù
 = 
	$Œaûk
(
Œ
, 
idx
)

315 
loÿl
 
Š
 = 
	$ty³
(
k
)

316 
loÿl
 
s


317 
Š
 =ğ"numb”" 
th’


318 
	`bªd
(
¢
 
Ü
 0, 0x30000è~ğ0 
th’


319 
s
 = 
	`bªd
(
¢
, 0x20000è~ğ0 
ªd
 "cÚc" 
Ü
 "ftsz"

320 
–£if
 
k
 =ğ2^52+2^51 
th’


321 
s
 = "bias"

323 
s
 = 
	`fÜm©
(0 < 
k
 
ªd
 k < 0x1
p
-1026‡nd "%+a" 
Ü
 "%+.14g", k)

324 
’d


325 
–£if
 
Š
 =ğ"¡ršg" 
th’


326 
s
 = 
	`fÜm©
(#k > 20 
ªd
 '"%.20s"~' 
Ü
 '"%s"', 
	`gsub
(
k
, "%c", 
ùlsub
))

327 
–£if
 
Š
 =ğ"funùiÚ" 
th’


328 
s
 = 
	$fmtfunc
(
k
)

329 
–£if
 
Š
 =ğ"bË" 
th’


330 
s
 = 
	`fÜm©
("{%p}", 
k
)

331 
–£if
 
Š
 =ğ"u£rd©a" 
th’


332 
t
 =ğ12 
th’


333 
s
 = 
	`fÜm©
("u£rd©a:%p", 
k
)

335 
s
 = 
	`fÜm©
("[%p]", 
k
)

336 
s
 =ğ"[NULL]" 
th’
 s = "NULL" 
’d


337 
’d


338 
–£if
 
t
 =ğ21 
th’
 -- 
št64_t


339 
s
 = 
	`sub
(
	`to¡ršg
(
k
), 1, -3)

340 
	`sub
(
s
, 1, 1è~ğ"-" 
th’
 s = "+".. 
’d


341 
–£if
 
¢
 =ğ0x1057ffà
th’
 -- 
	`SNAP
(1, 
SNAP_FRAME
 | 
SNAP_NORESTORE
, 
REF_NIL
)

342  "----" -- 
S³cŸl
 
LJ_FR2
 
¦Ù
 1.

344 
s
 = 
	`to¡ršg
(
k
è-- 
FÜ
 
´im™ives
.

345 
’d


346 
s
 = 
	`cŞÜize
(
	`fÜm©
("%-4s", s), 
t
)

347 
¦Ù
 
th’


348 
s
 = 
	`fÜm©
("% @%d", s, 
¦Ù
)

349 
’d


350  
s


351 
’d


353 
loÿl
 
funùiÚ
 
	$´št¢­
(
Œ
, 
¢­
)

354 
loÿl
 
n
 = 2

355 
s
=0,
¢­
[1]-1 do

356 
loÿl
 
¢
 = 
¢­
[
n
]

357 
	`shr
(
¢
, 24è=ğ
s
 
th’


358 
n
 =‚ + 1

359 
loÿl
 
»f
 = 
	`bªd
(
¢
, 0xffffè- 0x8000 -- 
REF_BIAS


360 
»f
 < 0 
th’


361 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
»f
, 
¢
))

362 
–£if
 
	`bªd
(
¢
, 0x80000è~ğ0 
th’
 -- 
SNAP_SOFTFPNUM


363 
out
:
	`wr™e
(
	`cŞÜize
(
	`fÜm©
("%04d/%04d", 
»f
,„ef+1), 14))

365 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
 = 
	$Œaûœ
(
Œ
, 
»f
)

366 
out
:
	`wr™e
(
	`cŞÜize
(
	`fÜm©
("%04d", 
»f
), 
	$bªd
(
Ù
, 31)))

367 
’d


368 
out
:
	`wr™e
(
	`bªd
(
¢
, 0x10000è=ğ0 
ªd
 " " 
Ü
 "|"è-- 
SNAP_FRAME


370 
out
:
	`wr™e
("---- ")

371 
’d


372 
’d


373 
out
:
	`wr™e
("]\n")

374 
’d


376 -- 
Dump
 
	`¢­shÙs
 (
nÙ
 
š‹¾—ved
 
w™h
 
IR
).

377 
loÿl
 
funùiÚ
 
	$dump_¢­
(
Œ
)

378 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " snapshots\n")

379 
i
=0,1000000000 do

380 
loÿl
 
¢­
 = 
	$Œaû¢­
(
Œ
, 
i
)

381 
nÙ
 
¢­
 
th’
  
’d


382 
out
:
	`wr™e
(
	`fÜm©
("#%-3d %04d [ ", 
i
, 
¢­
[0]))

383 
	$´št¢­
(
Œ
, 
¢­
)

384 
’d


385 
’d


387 -- 
R‘uº
 
a
 
Çme
 
Ü
 
¡ack
 
¦Ù
 ¨
rid
/
¥
 
loÿtiÚ
.

388 
loÿl
 
funùiÚ
 
	$rid¥_Çme
(
rid¥
, 
šs
)

389 
nÙ
 
di§ss
 
th’
 di§s ğ
	`»quœe
("j™.dis_"..
j™
.
¬ch
è
’d


390 
loÿl
 
rid
, 
¦Ù
 = 
	`bªd
(
rid¥
, 0xff), 
	$shr
(
rid¥
, 8)

391 
rid
 =ğ253 
Ü
„id =ğ254 
th’


392  (
¦Ù
 =ğ0 
Ü
 slÙ =ğ255è
ªd
 " {sšk" o¸
	`fÜm©
(" {%04d", 
šs
-slot)

393 
’d


394 
rid¥
 > 255 
th’
  
	`fÜm©
("[%x]", 
¦Ù
*4è
’d


395 
rid
 < 128 
th’
  
di§ss
.
	$»gÇme
(
rid
è
’d


397 
’d


399 -- 
Dump
 
CALL
* 
funùiÚ
 
»f
 
ªd
  
İtiÚ®
 
ùy³
.

400 
loÿl
 
funùiÚ
 
	$dumpÿÎfunc
(
Œ
, 
šs
)

401 
loÿl
 
ùy³


402 
šs
 > 0 
th’


403 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
 = 
	$Œaûœ
(
Œ
, 
šs
)

404 
	`bªd
(
Ù
, 31è=ğ0 
th’
 -- 
n
 
ty³
 
m—ns
 
	`CARG
(
func
, 
ùy³
).

405 
šs
 = 
İ1


406 
ùy³
 = 
	$fÜm©k
(
Œ
, 
İ2
)

407 
’d


408 
’d


409 
šs
 < 0 
th’


410 
out
:
	`wr™e
(
	`fÜm©
("[0x%x](", 
	`tÚumb”
((
	$Œaûk
(
Œ
, 
šs
)))))

412 
out
:
	`wr™e
(
	`fÜm©
("%04d (", 
šs
))

413 
’d


414  
ùy³


415 
’d


417 -- 
Recursiv–y
 
g©h”
 
CALL
* 
¬gs
 
ªd
 
dump
 
them
.

418 
loÿl
 
funùiÚ
 
	$dumpÿÎ¬gs
(
Œ
, 
šs
)

419 
šs
 < 0 
th’


420 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
šs
))

422 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
 = 
	$Œaûœ
(
Œ
, 
šs
)

423 
loÿl
 
oidx
 = 6*
	$shr
(
Ù
, 8)

424 
loÿl
 
İ
 = 
	`sub
(
vmdef
.
œÇmes
, 
oidx
+1, oidx+6)

425 
İ
 =ğ"CARG " 
th’


426 
	$dumpÿÎ¬gs
(
Œ
, 
İ1
)

427 
İ2
 < 0 
th’


428 
out
:
	`wr™e
(" ", 
	$fÜm©k
(
Œ
, 
İ2
))

430 
out
:
	`wr™e
(" ", 
	`fÜm©
("%04d", 
İ2
))

431 
’d


433 
out
:
	`wr™e
(
	`fÜm©
("%04d", 
šs
))

434 
’d


435 
’d


436 
’d


438 -- 
Dump
 
IR
 
ªd
 
š‹¾—ved
 
¢­shÙs
.

439 
loÿl
 
funùiÚ
 
	$dump_œ
(
Œ
, 
dump¢­
, 
dum´eg
)

440 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

441 
nÙ
 
šfo
 
th’
  
’d


442 
loÿl
 
nšs
 = 
šfo
.nins

443 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " IR\n")

444 
loÿl
 
œÇmes
 = 
vmdef
.irnames

445 
loÿl
 
¢­»f
 = 65536

446 
loÿl
 
¢­
, 
¢­no


447 
dump¢­
 
th’


448 
¢­
 = 
	$Œaû¢­
(
Œ
, 0)

449 
¢­»f
 = 
¢­
[0]

450 
¢­no
 = 0

451 
’d


452 
šs
=1,
nšs
 do

453 
šs
 >ğ
¢­»f
 
th’


454 
dum´eg
 
th’


455 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

457 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

458 
’d


459 
	$´št¢­
(
Œ
, 
¢­
)

460 
¢­no
 = snapno + 1

461 
¢­
 = 
	$Œaû¢­
(
Œ
, 
¢­no
)

462 
¢­»f
 = 
¢­
 
ªd
 sÇp[0] 
Ü
 65536

463 
’d


464 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
, 
rid¥
 = 
	$Œaûœ
(
Œ
, 
šs
)

465 
loÿl
 
oidx
, 
t
 = 6*
	`shr
(
Ù
, 8), 
	$bªd
(
Ù
, 31)

466 
loÿl
 
İ
 = 
	`sub
(
œÇmes
, 
oidx
+1, oidx+6)

467 
İ
 =ğ"LOOP " 
th’


468 
dum´eg
 
th’


469 
out
:
	`wr™e
(
	`fÜm©
("%04d ------------ LOOP ------------\n", 
šs
))

471 
out
:
	`wr™e
(
	`fÜm©
("%04d ------ LOOP ------------\n", 
šs
))

472 
’d


473 
–£if
 
İ
 ~ğ"NOP " 
ªd
 op ~= "CARG "‡nd

474 (
dum´eg
 
Ü
 
İ
 ~ğ"RENAME"è
th’


475 
loÿl
 
rid
 = 
	$bªd
(
rid¥
, 255)

476 
dum´eg
 
th’


477 
out
:
	`wr™e
(
	`fÜm©
("%04d %-6s", 
šs
, 
	$rid¥_Çme
(
rid¥
, 
šs
)))

479 
out
:
	`wr™e
(
	`fÜm©
("%04d ", 
šs
))

480 
’d


481 
out
:
	`wr™e
(
	`fÜm©
("%s%s %s %s ",

482 (
rid
 =ğ254 
Ü
„id =ğ253è
ªd
 "}" or

483 (
	`bªd
(
Ù
, 128è=ğ0 
ªd
 " " 
Ü
 ">"),

484 
	`bªd
(
Ù
, 64è=ğ0 
ªd
 " " 
Ü
 "+",

485 
œty³
[
t
], 
İ
))

486 
loÿl
 
m1
, 
m2
 = 
	`bªd
(
m
, 3), 
	$bªd
(
m
, 3*4)

487 
	`sub
(
İ
, 1, 4è=ğ"CALL" 
th’


488 
loÿl
 
ùy³


489 
m2
 =ğ1*4 
th’
 -- 
İ2
 =ğ
IRMl™


490 
out
:
	`wr™e
(
	`fÜm©
("%-10  (", 
vmdef
.
œÿÎ
[
İ2
]))

492 
ùy³
 = 
	$dumpÿÎfunc
(
Œ
, 
İ2
)

493 
’d


494 
İ1
 ~ğ-1 
th’
 
	$dumpÿÎ¬gs
(
Œ
, 
İ1
è
’d


495 
out
:
	`wr™e
(")")

496 
ùy³
 
th’
 
out
:
	`wr™e
(" cty³ ", cty³è
’d


497 
–£if
 
İ
 =ğ"CNEW " 
ªd
 
İ2
 =ğ-1 
th’


498 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
İ1
))

499 
–£if
 
m1
 ~ğ3 
th’
 -- 
İ1
 !ğ
IRMnÚe


500 
İ1
 < 0 
th’


501 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
İ1
))

503 
out
:
	`wr™e
(
	`fÜm©
(
m1
 =ğ0 
ªd
 "%04d" 
Ü
 "#%-3d", 
İ1
))

504 
’d


505 
m2
 ~ğ3*4 
th’
 -- 
İ2
 !ğ
IRMnÚe


506 
m2
 =ğ1*4 
th’
 -- 
İ2
 =ğ
IRMl™


507 
loÿl
 
l™n
 = 
l™Çme
[
İ
]

508 
l™n
 
ªd
†™n[
İ2
] 
th’


509 
out
:
	`wr™e
(" ", 
l™n
[
İ2
])

510 
–£if
 
İ
 =ğ"UREFO " 
Ü
 o°=ğ"UREFC " 
th’


511 
out
:
	`wr™e
(
	`fÜm©
(" #%-3d", 
	$shr
(
İ2
, 8)))

513 
out
:
	`wr™e
(
	`fÜm©
(" #%-3d", 
İ2
))

514 
’d


515 
–£if
 
İ2
 < 0 
th’


516 
out
:
	`wr™e
(" ", 
	$fÜm©k
(
Œ
, 
İ2
))

518 
out
:
	`wr™e
(
	`fÜm©
(" %04d", 
İ2
))

519 
’d


520 
’d


521 
’d


522 
out
:
	`wr™e
("\n")

523 
’d


524 
’d


525 
¢­
 
th’


526 
dum´eg
 
th’


527 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

529 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

530 
’d


531 
	$´št¢­
(
Œ
, 
¢­
)

532 
’d


533 
’d


537 
loÿl
 
»ı»fix
 = ""

538 
loÿl
 
»cd•th
 = 0

540 -- 
FÜm©
 
Œaû
 
”rÜ
 
mes§ge
.

541 
loÿl
 
funùiÚ
 
	$fm‹¼
(
”r
, 
šfo
)

542 
	`ty³
(
”r
è=ğ"numb”" 
th’


543 
	`ty³
(
šfo
è=ğ"funùiÚ" 
th’
 infØğ
	$fmtfunc
(
šfo
è
’d


544 
”r
 = 
	$fÜm©
(
vmdef
.
Œaû”r
[
”r
], 
šfo
)

545 
’d


546  
”r


547 
’d


549 -- 
Dump
 
Œaû
 
¡©es
.

550 
loÿl
 
funùiÚ
 
	$dump_Œaû
(
wh©
, 
Œ
, 
func
, 
pc
, 
Ùr
, 
Ûx
)

551 
wh©
 =ğ"¡İ" 
	`Ü
 (wh© =ğ"abÜt" 
ªd
 
dumpmode
.
a
è
th’


552 
dumpmode
.
i
 
th’
 
	`dump_œ
(
Œ
, dumpmode.
s
, dumpmode.
r
 
ªd
 
wh©
 == "stop")

553 
–£if
 
dumpmode
.
s
 
th’
 
	$dump_¢­
(
Œ
è
’d


554 
dumpmode
.
m
 
th’
 
	$dump_mcode
(
Œ
è
’d


555 
’d


556 
wh©
 =ğ"¡¬t" 
th’


557 
dumpmode
.
H
 
th’
 
out
:
	`wr™e
('<´şass="ljdump">\n'è
’d


558 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " ", 
wh©
)

559 
Ùr
 
th’
 
out
:
	`wr™e
(" ", oŒ, "/", 
Ûx
 =ğ-1 
ªd
 "¡™ch" 
Ü
 oexè
’d


560 
out
:
	`wr™e
(" ", 
	`fmtfunc
(
func
, 
pc
), "\n")

561 
–£if
 
wh©
 =ğ"¡İ" 
Ü
 wh© =ğ"abÜt" 
th’


562 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " ", 
wh©
)

563 
wh©
 =ğ"abÜt" 
th’


564 
out
:
	`wr™e
(" ", 
	`fmtfunc
(
func
, 
pc
), " -- ", 
	`fm‹¼
(
Ùr
, 
Ûx
), "\n")

566 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

567 
loÿl
 
lšk
, 
Éy³
 = 
šfo
.lšk, info.
lškty³


568 
lšk
 =ğ
Œ
 
Ü
†šk =ğ0 
th’


569 
out
:
	`wr™e
(" -> ", 
Éy³
, "\n")

570 
–£if
 
Éy³
 =ğ"roÙ" 
th’


571 
out
:
	`wr™e
(" -> ", 
lšk
, "\n")

573 
out
:
	`wr™e
(" -> ", 
lšk
, " ", 
Éy³
, "\n")

574 
’d


575 
’d


576 
dumpmode
.
H
 
th’
 
out
:
	`wr™e
("</´e>\n\n"èout:wr™e("\n"è
’d


578 
wh©
 =ğ"æush" 
th’
 
symb
, 
Ãx™sym
 = {
	}
}, 0 
’d


579 
	gout
:
wr™e
("---- TRACE ", 
wh©
, "\n\n")

580 
’d


581 
	gout
:
	$æush
()

582 
’d


584 -- 
Dump
 
»cÜded
 
by‹code
.

585 
loÿl
 
funùiÚ
 
	$dump_»cÜd
(
Œ
, 
func
, 
pc
, 
d•th
, 
ÿÎ“
)

586 
d•th
 ~ğ
»cd•th
 
th’


587 
»cd•th
 = 
d•th


588 
»ı»fix
 = 
	`»p
(" .", 
d•th
)

589 
’d


590 
loÿl
 
lše


591 
pc
 >ğ0 
th’


592 
lše
 = 
	$bşše
(
func
, 
pc
, 
»ı»fix
)

593 
dumpmode
.
H
 
th’
 
lše
 = 
	`gsub
Öše, "[<>&]", 
html_esÿ³
è
’d


595 
lše
 = "0000 "..
»ı»fix
.." FUNCC \n"

596 
ÿÎ“
 = 
func


597 
’d


598 
pc
 <ğ0 
th’


599 
out
:
	`wr™e
(
	`sub
(
lše
, 1, -2), " ; ", 
	`fmtfunc
(
func
), "\n")

601 
out
:
	$wr™e
(
lše
)

602 
’d


603 
pc
 >ğ0 
ªd
 
	`bªd
(
	`funcbc
(
func
,…c), 0xffè< 16 
th’
 -- 
ORDER
 
BC


604 
out
:
	`wr™e
(
	`bşše
(
func
, 
pc
+1, 
»ı»fix
)è-- 
Wr™e
 
JMP
 
cÚd
.

605 
’d


606 
’d


610 -- 
Dump
 
k’
 
Œaû
 
ex™s
.

611 
loÿl
 
funùiÚ
 
	$dump_‹x™
(
Œ
, 
ex
, 
ng´
, 
når
, ...)

612 
out
:
	`wr™e
("---- TRACE ", 
Œ
, "ƒx™ ", 
ex
, "\n")

613 
dumpmode
.
X
 
th’


614 
loÿl
 
»gs
 = {...
	}
}

615 
j™
.
¬ch
 =ğ"x64" 
th’


616 
i
=1,
ng´
 do

617 
	gout
:
wr™e
(
fÜm©
(" %016x", 
»gs
[
i
]))

618 
	gi
 % 4 =ğ0 
th’
 
out
:
wr™e
("\n"è
’d


619 
’d


621 
i
=1,
ng´
 do

622 
	gout
:
wr™e
(" ", 
	$tohex
(
»gs
[
i
]))

623 
i
 % 8 =ğ0 
th’
 
out
:
	`wr™e
("\n"è
’d


624 
’d


625 
’d


626 
j™
.
¬ch
 =ğ"ms" 
Ü
 j™.¬ch =ğ"m£l" 
th’


627 
i
=1,
når
,2 do

628 
out
:
	`wr™e
(
	`fÜm©
(" %+17.14g", 
»gs
[
ng´
+
i
]))

629 
i
 % 8 =ğ7 
th’
 
out
:
	`wr™e
("\n"è
’d


630 
’d


632 
i
=1,
når
 do

633 
out
:
	`wr™e
(
	`fÜm©
(" %+17.14g", 
»gs
[
ng´
+
i
]))

634 
i
 % 4 =ğ0 
th’
 
out
:
	`wr™e
("\n"è
’d


635 
’d


636 
’d


637 
’d


638 
’d


642 -- 
D‘ach
 
dump
 
hªdËrs
.

643 
loÿl
 
funùiÚ
 
	$dumpoff
()

644 
aùive
 
th’


645 
aùive
 = 
çl£


646 
j™
.
	$©ch
(
dump_‹x™
)

647 
j™
.
	$©ch
(
dump_»cÜd
)

648 
j™
.
	$©ch
(
dump_Œaû
)

649 
out
 
ªd
 ouˆ~ğ
¡dout
‡nd ouˆ~ğ
¡d”r
 
th’
 out:
	$şo£
(è
’d


650 
out
 = 
n


651 
’d


652 
’d


654 -- 
O³n
 
the
 
ouut
 
fe
 
ªd
 
©ch
 
dump
 
hªdËrs
.

655 
loÿl
 
funùiÚ
 
	$dumpÚ
(
İt
, 
outfe
)

656 
aùive
 
th’
 
	$dumpoff
(è
’d


658 
loÿl
 
‹rm
 = 
os
.
	`g‘’v
("TERM")

659 
loÿl
 
cŞÜmode
 = (
‹rm
 
ªd
”m:
	`m©ch
("cŞÜ"è
Ü
 
os
.
	`g‘’v
("COLORTERM"))‡nd "A" or "T"

660 
İt
 
th’


661 
İt
 = 
	`gsub
(İt, "[TAH]", 
	$funùiÚ
(
mode
è
cŞÜmode
 = mode;  ""; 
’d
)

662 
’d


664 
loÿl
 
m
 = { 
t
=
Œue
, 
b
ñrue, 
i
ñrue, mñrue, 
	}
}

665 
İt
 
ªd
 
	gİt
 ~ğ"" 
th’


666 
loÿl
 
o
 = 
	$sub
(
İt
, 1, 1)

667 
o
 ~ğ"+" 
ªd
 o ~ğ"-" 
th’
 
m
 = {
	}
} 
’d


668 
i
=1,#İˆdØ
	gm
[
sub
(
İt
, i, i)] = (
o
 ~ğ"-"è
’d


669 
’d


670 
dumpmode
 = 
m


672 
m
.
t
 
Ü
 m.
b
 o¸m.
i
 o¸m.
s
 o¸m.m 
th’


673 
j™
.
©ch
(
dump_Œaû
, "trace")

674 
’d


675 
	gm
.
b
 
th’


676 
	gj™
.
©ch
(
dump_»cÜd
, "record")

677 
nÙ
 
bşše
 
th’
 
	gbşše
 = 
»quœe
("j™.bc").
lše
 
’d


678 
’d


679 
m
.
x
 
Ü
 m.
X
 
th’


680 
j™
.
©ch
(
dump_‹x™
, "texit")

681 
’d


683 
nÙ
 
outfe
 
th’
 
	goutfe
 = 
os
.
g‘’v
("LUAJIT_DUMPFILE"è
’d


684 
outfe
 
th’


685 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
as£¹
(
io
.
İ’
(outfile, "w"))

687 
	gout
 = 
¡dout


688 
’d


690 
m
[
cŞÜmode
] = 
Œue


691 
cŞÜmode
 =ğ"A" 
th’


692 
cŞÜize
 = 
cŞÜize_ªsi


693 
œty³
 = 
œty³_ªsi


694 
–£if
 
cŞÜmode
 =ğ"H" 
th’


695 
cŞÜize
 = 
cŞÜize_html


696 
œty³
 = 
œty³_html


697 
out
:
	$wr™e
(
h—d”_html
)

699 
cŞÜize
 = 
cŞÜize_‹xt


700 
œty³
 = 
œty³_‹xt


701 
’d


703 
aùive
 = 
Œue


704 
’d


706 -- 
Public
 
moduË
 
funùiÚs
.

708 
Ú
 = 
dumpÚ
,

709 
off
 = 
dumpoff
,

710 
¡¬t
 = 
dumpÚ
 -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

711 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/p.lua

2 -- 
LuaJIT
 
	g´of”
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
is
 
a
 
sim¶e
 
commªd
 
lše
 
š‹rçû
 
to
 
the
 
	gbut
-
	gš


9 -- 
	glow
-
ov”h—d
 
´of”
 
of
 
	gLuaJIT
.

11 -- 
The
 
	glow”
-
Ëv–
 
API
 
of
 
the
 
´of”
 
is
 
acûssibË
 
vŸ
 
	gthe
 "jit.profile"

12 -- 
moduË
 
Ü
 
the
 
luaJIT_´ofe_
* 
C
 
	gAPI
.

14 -- 
Exam¶e
 
	gu§ge
:

16 -- 
luaj™
 -
jp
 
my­p
.
lua


17 -- 
luaj™
 -
jp
=
s
 
my­p
.
lua


18 -- 
luaj™
 -
jp
=-
s
 
my­p
.
lua


19 -- 
luaj™
 -
jp
=
vl
 
my­p
.
lua


20 -- 
luaj™
 -
jp
=
G
,
	g´ofe
.
txt
 
	gmy­p
.
	glua


22 -- 
The
 
fŞlowšg
 
dump
 
ã©u»s
 
¬e
 
	gavaabË
:

24 -- 
f
 
Sck
 
dump
: 
funùiÚ
 
Çme
, 
Ùh”wi£
 
	gmoduË
:
lše
. 
DeçuÉ
 
mode
.

25 -- 
F
 
Sck
 
dump
: 
d™to
, 
but
 
®ways
 
´•’d
 
	gmoduË
.

26 -- 
l
 
Sck
 
	gdump
: 
moduË
:
lše
.

27 -- <
numb”
> 
¡ack
 
dump
 
d•th
 (
ÿÎ“
 < 
ÿÎ”
). 
DeçuÉ
: 1.

28 -- -<
numb”
> 
Inv”£
 
¡ack
 
dump
 
d•th
 (
ÿÎ”
 > 
ÿÎ“
).

29 -- 
s
 
S¶™
 
¡ack
 
dump
 
aá”
 
fœ¡
 sck 
Ëv–
. 
Im¶›s
 
abs
(
d•th
) >= 2.

30 -- 
p
 
Show
 
fuÎ
 
·th
 
moduË
 
Çmes
.

31 -- 
v
 
Show
 
VM
 
¡©es
. 
Cª
 
be
 
combšed
 
w™h
 
¡ack
 
dumps
, 
	ge
.
	gg
. 
vf
 
Ü
 
	gfv
.

32 -- 
z
 
Show
 
	gzÚes
. 
Cª
 
be
 
combšed
 
w™h
 
¡ack
 
	gdumps
, 
	ge
.
	gg
. 
zf
 
Ü
 
	gfz
.

33 -- 
r
 
Show
 
¿w
 
§m¶e
 
	gcouÁs
. 
	gDeçuÉ
: 
show
 
³rûÁages
.

34 -- 
a
 
AÂÙ©e
 
exû½ts
 
äom
 
sourû
 
code
 
fes
.

35 -- 
A
 
AÂÙ©e
 
com¶‘e
 
sourû
 
code
 
fes
.

36 -- 
G
 
Produû
 
¿w
 
ouut
 
su™abË
 
g¿phiÿl
 
toŞs
 (
e
.
g
. 
æame
 
g¿phs
).

37 -- 
m
<
numb”
> 
Mšimum
 
§m¶e
 
³rûÁage
 
to
 
be
 
shown
. 
DeçuÉ
: 3.

38 -- 
i
<
numb”
> 
Sam¶šg
 
š‹rv®
 
š
 
mli£cÚds
. 
DeçuÉ
: 10.

42 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
objeùs
.

43 
loÿl
 
j™
 = 
»quœe
("jit")

44 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

45 
loÿl
 
	g´ofe
 = 
»quœe
("jit.profile")

46 
loÿl
 
vmdef
 = 
»quœe
("jit.vmdef")

47 
loÿl
 
m©h
 = math

48 
loÿl
 
·œs
, 
	gaœs
, 
	gtÚumb”
, 
	gæoÜ
 =…aœs, i·œs,Úumb”, 
	gm©h
.
æoÜ


49 
loÿl
 
	gsÜt
, 
	gfÜm©
 = 
bË
.
sÜt
, 
	g¡ršg
.
fÜm©


50 
loÿl
 
	g¡dout
 = 
io
.
¡dout


51 
loÿl
 
zÚe
 -- 
Lßd
 
j™
.zÚ
moduË
 
Ú
 
demªd
.

53 -- 
Ouut
 
fe
 
hªdË
.

54 
loÿl
 
out


58 
loÿl
 
´of_ud


59 
loÿl
 
´of_¡©es
, 
	g´of_¥l™
, 
	g´of_mš
, 
	g´of_¿w
, 
	g´of_fmt
, 
´of_d•th


60 
loÿl
 
	g´of_ªn
, 
	g´of_couÁ1
, 
	g´of_couÁ2
, 
´of_§m¶es


62 
loÿl
 
	gm­_vmmode
 = {

63 
N
 = "Compiled",

64 
	gI
 = "Interpreted",

65 
	gC
 = "C code",

66 
	gG
 = "Garbage Collector",

67 
	gJ
 = "JIT Compiler",

70 -- 
Prof”
 
	gÿÎback
.

71 
loÿl
 
funùiÚ
 
	$´of_cb
(
th
, 
§m¶es
, 
vmmode
)

72 
´of_§m¶es
 =…rof_§m¶e + 
§m¶es


73 
loÿl
 
key_¡ack
, 
key_¡ack2
, 
key_¡©e


74 -- 
CŞËù
 
keys
 
§m¶e
.

75 
´of_¡©es
 
th’


76 
´of_¡©es
 =ğ"v" 
th’


77 
key_¡©e
 = 
m­_vmmode
[
vmmode
] 
Ü
 vmmode

79 
key_¡©e
 = 
zÚe
:
	$g‘
(è
Ü
 "(none)"

80 
’d


81 
’d


82 
´of_fmt
 
th’


83 
key_¡ack
 = 
´ofe
.
	$dump¡ack
(
th
, 
´of_fmt
, 
´of_d•th
)

84 
key_¡ack
 = key_¡ack:
	`gsub
("%[butš#(%d+)%]", 
	$funùiÚ
(
x
)

85  
vmdef
.
fâames
[
	`tÚumb”
(
x
)]

86 
’d
)

87 
´of_¥l™
 =ğ2 
th’


88 
loÿl
 
k1
, 
k2
 = 
key_¡ack
:
	`m©ch
("(.-) [<>] (.*)")

89 
k2
 
th’
 
key_¡ack
, 
key_¡ack2
 = 
k1
, k2 
’d


90 
–£if
 
´of_¥l™
 =ğ3 
th’


91 
key_¡ack2
 = 
´ofe
.
	`dump¡ack
(
th
, "l", 1)

92 
’d


93 
’d


94 -- 
Ord”
 
keys
.

95 
loÿl
 
k1
, 
k2


96 
´of_¥l™
 =ğ1 
th’


97 
key_¡©e
 
th’


98 
k1
 = 
key_¡©e


99 
key_¡ack
 
th’
 
k2
 = key_¡ack 
’d


100 
’d


101 
–£if
 
key_¡ack
 
th’


102 
k1
 = 
key_¡ack


103 
key_¡ack2
 
th’
 
k2
 = key_¡ack2 
–£if
 
key_¡©e
h’ k2 = key_¡©
’d


104 
’d


105 -- 
CßËsû
 
§m¶es
 
š
 
Úe
 
Ü
 
two
 
Ëv–s
.

106 
k1
 
th’


107 
loÿl
 
t1
 = 
´of_couÁ1


108 
t1
[
k1
] = (t1[k1] 
Ü
 0è+ 
§m¶es


109 
k2
 
th’


110 
loÿl
 
t2
 = 
´of_couÁ2


111 
loÿl
 
t3
 = 
t2
[
k1
]

112 
nÙ
 
t3
 
th’
3 = {
	}
}; 
	gt2
[
k1
] =3 
’d


113 
t3
[
k2
] = (t3[k2] 
Ü
 0è+ 
§m¶es


114 
’d


115 
’d


116 
’d


120 -- 
Show
 
tİ
 
N
 
li¡
.

121 
loÿl
 
funùiÚ
 
	$´of_tİ
(
couÁ1
, 
couÁ2
, 
§m¶es
, 
šd’t
)

122 
loÿl
 
t
, 
n
 = {
	}
}, 0

123 
k
 
š
 
	$·œs
(
couÁ1
) do

124 
n
 =‚ + 1

125 
t
[
n
] = 
k


126 
’d


127 
	`sÜt
(
t
, 
	$funùiÚ
(
a
, 
b
è 
couÁ1
[a] > couÁ1[b] 
’d
)

128 
i
=1,
n
 do

129 
loÿl
 
k
 = 
t
[
i
]

130 
loÿl
 
v
 = 
couÁ1
[
k
]

131 
loÿl
 
pù
 = 
	`æoÜ
(
v
*100/
§m¶es
 + 0.5)

132 
pù
 < 
´of_mš
 
th’
  
’d


133 
nÙ
 
´of_¿w
 
th’


134 
out
:
	`wr™e
(
	`fÜm©
("%s%2d%% %s\n", 
šd’t
, 
pù
, 
k
))

135 
–£if
 
´of_¿w
 =ğ"r" 
th’


136 
out
:
	`wr™e
(
	`fÜm©
("%s%5d %s\n", 
šd’t
, 
v
, 
k
))

138 
out
:
	`wr™e
(
	`fÜm©
("% %d\n", 
k
, 
v
))

139 
’d


140 
couÁ2
 
th’


141 
loÿl
 
r
 = 
couÁ2
[
k
]

142 
r
 
th’


143 
	`´of_tİ
(
r
, 
n
, 
v
, (
´of_¥l™
 =ğ3 
Ü
…rof_¥l™ =ğ1è
ªd
 " -- " or

144 (
´of_d•th
 < 0 
ªd
 " -> " 
Ü
 " <- "))

145 
’d


146 
’d


147 
’d


148 
’d


150 -- 
AÂÙ©e
 
sourû
 
code


151 
loÿl
 
funùiÚ
 
	$´of_ªnÙ©e
(
couÁ1
, 
§m¶es
)

152 
loÿl
 
fes
 = {
	}
}

153 
loÿl
 
ms
 = 0

154 
k
, 
v
 
š
 
	$·œs
(
couÁ1
) do

155 
loÿl
 
pù
 = 
	`æoÜ
(
v
*100/
§m¶es
 + 0.5)

156 
ms
 = 
m©h
.
	$max
(
ms
, 
v
)

157 
pù
 >ğ
´of_mš
 
th’


158 
loÿl
 
fe
, 
lše
 = 
k
:
	`m©ch
("^(.*):(%d+)$")

159 
nÙ
 
fe
 
th’
 fğ
k
; 
lše
 = 0 
’d


160 
loÿl
 
æ
 = 
fes
[
fe
]

161 
nÙ
 
æ
 
th’
 fÈğ{
	}
}; 
	gfes
[
fe
] = fl; fes[#fes+1] = f
’d


162 
lše
 = 
	$tÚumb”
(
lše
)

163 
æ
[
lše
] = 
´of_¿w
 
ªd
 
v
 
Ü
 
pù


164 
’d


165 
’d


166 
	$sÜt
(
fes
)

167 
loÿl
 
fmtv
, 
fmŠ
 = " %3d%% | %s\n", " | %s\n"

168 
´of_¿w
 
th’


169 
loÿl
 
n
 = 
m©h
.
	`max
(5, m©h.
	`û
(m©h.
	$log10
(
ms
)))

170 
fmtv
 = "%"..
n
.."d | %s\n"

171 
fmŠ
 = (" "):
	`»p
(
n
).." | %s\n"

172 
’d


173 
loÿl
 
ªn
 = 
´of_ªn


174 
_
, 
fe
 
š
 
	$aœs
(
fes
) do

175 
loÿl
 
f0
 = 
fe
:
	$by‹
()

176 
f0
 =ğ40 
Ü
 f0 =ğ91 
th’


177 
out
:
	`wr™e
(
	`fÜm©
("\n=====ğ% ======\n[CªnÙ‡ÂÙ©nÚ-fe]\n", 
fe
))

179 
’d


180 
loÿl
 
å
, 
”r
 = 
io
.
	$İ’
(
fe
)

181 
nÙ
 
å
 
th’


182 
out
:
	`wr™e
(
	`fÜm©
("=====ğERROR: %s: %s\n", 
fe
, 
”r
))

184 
’d


185 
out
:
	`wr™e
(
	`fÜm©
("\n=====ğ% ======\n", 
fe
))

186 
loÿl
 
æ
 = 
fes
[
fe
]

187 
loÿl
 
n
, 
show
 = 1, 
çl£


188 
ªn
 ~ğ0 
th’


189 
i
=1,
ªn
 do

190 
æ
[
i
] 
th’
 
show
 = 
Œue
; 
out
:
	`wr™e
("@@ 1 @@\n");  
’d


191 
’d


192 
’d


193 
lše
 
š
 
å
:
	$lšes
() do

194 
lše
:
	`by‹
(è=ğ27 
th’


195 
out
:
	`wr™e
("[Cannot‡nnotate bytecode file]\n")

197 
’d


198 
loÿl
 
v
 = 
æ
[
n
]

199 
ªn
 ~ğ0 
th’


200 
loÿl
 
v2
 = 
æ
[
n
+
ªn
]

201 
show
 
th’


202 
v2
 
th’
 
show
 = 
n
+
ªn
 
–£if
 
v
hen show =‚

203 
–£if
 
show
+
ªn
 < 
n
 
th’
 show = 
çl£
 
’d


204 
–£if
 
v2
 
th’


205 
show
 = 
n
+
ªn


206 
out
:
	`wr™e
(
	`fÜm©
("@@ %d @@\n", 
n
))

207 
’d


208 
nÙ
 
show
 
th’
 
Ãxt
 
’d


209 
’d


210 
v
 
th’


211 
out
:
	`wr™e
(
	$fÜm©
(
fmtv
, 
v
, 
lše
))

213 
out
:
	`wr™e
(
	$fÜm©
(
fmŠ
, 
lše
))

214 
’d


215 ::
Ãxt
::

216 
n
 =‚ + 1

217 
’d


218 
å
:
	$şo£
()

219 
’d


220 
’d


224 -- 
Fšish
 
´ofšg
 
ªd
 
dump
 
»suÉ
.

225 
loÿl
 
funùiÚ
 
	$´of_fšish
()

226 
´of_ud
 
th’


227 
´ofe
.
	$¡İ
()

228 
loÿl
 
§m¶es
 = 
´of_§m¶es


229 
§m¶es
 =ğ0 
th’


230 
´of_¿w
 ~ğ
Œue
 
th’
 
out
:
	`wr™e
("[NØ§m¶e cŞËùed]\n"è
’d


232 
’d


233 
´of_ªn
 
th’


234 
	$´of_ªnÙ©e
(
´of_couÁ1
, 
§m¶es
)

236 
	`´of_tİ
(
´of_couÁ1
, 
´of_couÁ2
, 
§m¶es
, "")

237 
’d


238 
´of_couÁ1
 = 
n


239 
´of_couÁ2
 = 
n


240 
´of_ud
 = 
n


241 
’d


242 
’d


244 -- 
S¹
 
´ofšg
.

245 
loÿl
 
funùiÚ
 
	$´of_¡¬t
(
mode
)

246 
loÿl
 
š‹rv®
 = ""

247 
mode
 = mode:
	`gsub
("i%d*", 
	$funùiÚ
(
s
è
š‹rv®
 = s;  "" 
’d
)

248 
´of_mš
 = 3

249 
mode
 = mode:
	`gsub
("m(%d+)", 
	$funùiÚ
(
s
è
´of_mš
 = 
	`tÚumb”
(s);  "" 
’d
)

250 
´of_d•th
 = 1

251 
mode
 = mode:
	`gsub
("%-?%d+", 
	$funùiÚ
(
s
è
´of_d•th
 = 
	`tÚumb”
(s);  "" 
’d
)

252 
loÿl
 
m
 = {
	}
}

253 
c
 
š
 
mode
:
gm©ch
("."èdØ
m
[c] = c 
’d


254 
´of_¡©es
 = 
m
.
z
 
Ü
 m.
v


255 
´of_¡©es
 =ğ"z" 
th’
 
zÚe
 = 
»quœe
("j™.zÚe"è
’d


256 
loÿl
 
scİe
 = 
m
.
l
 
Ü
 m.
f
 o¸m.
F
 o¸(
´of_¡©es
 
ªd
 "" or "f")

257 
loÿl
 
æags
 = (
m
.
p
 
Ü
 "")

258 
´of_¿w
 = 
m
.
r


259 
m
.
s
 
th’


260 
´of_¥l™
 = 2

261 
´of_d•th
 =ğ-1 
Ü
 
m
["-"] 
th’
…rof_depth = -2

262 
–£if
 
´of_d•th
 =ğ1 
th’
…rof_d•th = 2 
’d


263 
–£if
 
mode
:
fšd
("[fF].*l"è
th’


264 
scİe
 = "l"

265 
´of_¥l™
 = 3

267 
´of_¥l™
 = (
scİe
 =ğ"" 
Ü
 
mode
:
fšd
("[zv].*[lfF]")è
ªd
 1 or 0

268 
’d


269 
´of_ªn
 = 
m
.
A
 
ªd
 0 
	$Ü
 (
m
.
a
 
ªd
 3)

270 
´of_ªn
 
th’


271 
scİe
 = "l"

272 
´of_fmt
 = "pl"

273 
´of_¥l™
 = 0

274 
´of_d•th
 = 1

275 
–£if
 
m
.
G
 
ªd
 
scİe
 ~ğ"" 
th’


276 
´of_fmt
 = 
æags
..
scİe
.."Z;"

277 
´of_d•th
 = -100

278 
´of_¿w
 = 
Œue


279 
´of_mš
 = 0

280 
–£if
 
scİe
 =ğ"" 
th’


281 
´of_fmt
 = 
çl£


283 
loÿl
 
sc
 = 
´of_¥l™
 =ğ3 
ªd
 
m
.
f
 
Ü
 m.
F
 o¸
scİe


284 
´of_fmt
 = 
æags
..
sc
..(
´of_d•th
 >ğ0 
ªd
 "Z < " 
Ü
 "Z > ")

285 
’d


286 
´of_couÁ1
 = {
	}
}

287 
´of_couÁ2
 = {}

288 
´of_§m¶es
 = 0

289 
´ofe
.
¡¬t
(
scİe
:
low”
()..
š‹rv®
, 
´of_cb
)

290 
	g´of_ud
 = 
	$Ãw´oxy
(
Œue
)

291 
	`g‘m‘©abË
(
´of_ud
).
__gc
 = 
´of_fšish


292 
’d


296 
loÿl
 
funùiÚ
 
	$¡¬t
(
mode
, 
outfe
)

297 
nÙ
 
outfe
 
th’
 outfğ
os
.
	`g‘’v
("LUAJIT_PROFILEFILE"è
’d


298 
outfe
 
th’


299 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
	`as£¹
(
io
.
	`İ’
(outfile, "w"))

301 
out
 = 
¡dout


302 
’d


303 
	`´of_¡¬t
(
mode
 
Ü
 "f")

304 
’d


306 -- 
Public
 
moduË
 
funùiÚs
.

308 
¡¬t
 = s¹, -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

309 
¡İ
 = 
´of_fšish


310 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/v.lua

2 -- 
V”bo£
 
mode
 
of
 
the
 
LuaJIT
 
	gcomp”
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
shows
 
v”bo£
 
šfÜm©iÚ
 
about
 
the
 
´og»ss
 
of
 
	gthe


9 -- 
JIT
 
	gcomp”
. 
It
 
´šts
 
Úe
 
lše
 
—ch
 
g’”©ed
 
	gŒaû
. 
This
 
	gmoduË


10 -- 
is
 
u£ful
 
to
 
£e
 
which
 
code
 
has
 
b“n
 
comped
 
Ü
 
wh”e
 
the
 
	gcomp”


11 -- 
puÁs
 
ªd
 
çÎs
 
back
 
to
 
the
 
	gš‹½»‹r
.

13 -- 
Exam¶e
 
	gu§ge
:

15 -- 
luaj™
 -
jv
 -
e
 "for i=1,1000 do for j=1,1000 doƒndƒnd"

16 -- 
luaj™
 -
jv
=
my­p
.
out
 my­p.
lua


18 -- 
DeçuÉ
 
ouut
 
is
 
to
 
¡d”r
. 
To
 
»dœeù
 
the
 ouuˆtØ
a
 
fe
, 
·ss
 
	ga


19 -- 
f’ame
 
as
 
ª
 
¬gum’t
 (
u£
 '-' 
¡dout
è
Ü
 
£t
 
the
 
	g’vœÚm’t


20 -- 
v¬ŸbË
 
	gLUAJIT_VERBOSEFILE
. 
The
 
fe
 
is
 
ov”wr™‹n
 
ev”y
 
time
 
	gthe


21 -- 
moduË
 
is
 
	g¡¬‹d
.

23 -- 
The
 
ouut
 
äom
 
the
 
fœ¡
 
exam¶e
 
should
 
look
 
like
 
	gthis
:

25 -- [
TRACE
 1 (
commªd
 
lše
):1 
loİ
]

26 -- [
TRACE
 2 (1/3è(
commªd
 
lše
):1 -> 1]

28 -- 
The
 
fœ¡
 
numb”
 
š
 
—ch
 
lše
 
is
 
the
 
š‹º®
 
Œaû
‚umb”. 
Next
 
¬e


29 -- 
the
 
fe
 
Çme
 ('(commªd†še)'è
ªd
h
lše
 
numb”
 (':1'è
wh”e
he

30 -- 
Œaû
 
has
 
¡¬‹d
. 
Side
 
Œaûs
 
®so
 
show
 
the
 
·»Á
¿û 
numb”
 
ªd


31 -- 
the
 
ex™
 
numb”
 
wh”e
 
they
 
¬e
 
©ched
 
to
 
š
 
·»Áhe£s
 ('(1/3)').

32 -- 
An
 
¬row
 
©
 
the
 
’d
 
shows
 
wh”e
h
Œaû
 
lšks
 
to
 ('-> 1'), 
	guÆess


33 -- 
™
 
loİs
 
to
 
	g™£lf
.

35 -- 
In
 
this
 
the
 
šÃr
 
loİ
 
g‘s
 
hÙ
 
ªd
 
is
 
Œaûd
 
	gfœ¡
, 
	gg’”©šg


36 -- 
a
 
roÙ
 
	gŒaû
. 
Th’
 
the
 
Ï¡
 
ex™
 
äom
 
	gthe
 1
¡
 
Œaû
 
g‘s
 
	ghÙ
, 
	gtoo
,

37 -- 
ªd
 
Œigg”s
 
g’”©iÚ
 
of
 
	gthe
 2
nd
 
	gŒaû
. 
The
 
side
 
Œaû
 
fŞlows
he

38 -- 
·th
 
®Úg
 
the
 
ou‹r
 
loİ
 
ªd
 *
¬ound
*h
šÃr
 
	gloİ
, 
back
 
to
 
	g™s


39 -- 
	g¡¬t
, 
ªd
 
th’
 
lšks
 
to
 
	gthe
 1
¡
 
	gŒaû
. 
	gYes
, 
this
 
may
 
£em
 
	gunusu®
,

40 -- 
you
 
know
 
how
 
Œad™iÚ®
 
comp”s
 
	gwÜk
. 
T¿û
 comp” 
¬e
 
	gfuÎ


41 -- 
of
 
su½ri£s
 
like
 
	gthis
 -- 
have
 
	gfun
! :-)

43 -- 
AbÜ‹d
 
Œaûs
 
¬e
 
shown
 
like
 
this
:

45 -- [
TRACE
 --- 
foo
.
lua
:44 -- 
Ëavšg
 
loİ
 
š
 
roÙ
 
Œaû
 
©
 foo:lua:50]

47 -- 
DÚ
't worry --race‡borts‡re quite common,ƒven in…rograms which

48 -- 
ÿn
 
be
 
fuÎy
 
comped
. 
The
 
comp”
 
may
 
»Œy
 
£v”®
 
times
 
uÁ
 
™


49 -- 
fšds
 
a
 
su™abË
 
Œaû
.

51 -- 
Of
 
cour£
 
this
 
dÛ¢
't work with featureshat‡re‚ot-yet-implemented

52 -- (
NYI
 
”rÜ
 
mes§ges
). 
The
 
VM
 
sim¶y
 
çÎs
 
back
 
to
 
the
 
š‹½»‹r
. 
This


53 -- 
may
 
nÙ
 
m©‹r
 
©
 
®l
 
the
 
·¹icuÏr
 
Œaû
 
is
‚Ù 
v”y
 
high
 
up
 
š


54 -- 
the
 
CPU
 
u§ge
 
´ofe
. 
Oh
, 
ªd
h
š‹½»‹r
 
is
 
qu™e
 
	gç¡
, 
	gtoo
.

56 -- 
Also
 
check
 
out
 
	gthe
 -
jdump
 
	gmoduË
, 
which
 
´šts
 
®l
 
the
 
gÜy
 
	gd‘as
.

60 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
	gobjeùs
.

61 
loÿl
 
	gj™
 = 
»quœe
("jit")

62 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

63 
loÿl
 
	gjut
 = 
»quœe
("jit.util")

64 
loÿl
 
vmdef
 = 
»quœe
("jit.vmdef")

65 
loÿl
 
funcšfo
, 
	gŒaûšfo
 = 
jut
.funcšfo, 
	gjut
.
Œaûšfo


66 
loÿl
 
	gty³
, 
	gfÜm©
 = 
ty³
, 
	g¡ršg
.
fÜm©


67 
loÿl
 
	g¡dout
, 
	g¡d”r
 = 
io
.
¡dout
, 
	gio
.stderr

69 -- 
Aùive
 
æag
 
ªd
 
ouut
 
fe
 
	ghªdË
.

70 
loÿl
 
	gaùive
, 
	gout


74 
loÿl
 
	g¡¬oc
, 
¡¬‹x


76 
loÿl
 
funùiÚ
 
	$fmtfunc
(
func
, 
pc
)

77 
loÿl
 
fi
 = 
	$funcšfo
(
func
, 
pc
)

78 
fi
.
loc
 
th’


79  
fi
.
loc


80 
–£if
 
fi
.
ffid
 
th’


81  
vmdef
.
fâames
[
fi
.
ffid
]

82 
–£if
 
fi
.
addr
 
th’


83  
	`fÜm©
("C:%x", 
fi
.
addr
)

86 
’d


87 
’d


89 -- 
FÜm©
 
Œaû
 
”rÜ
 
mes§ge
.

90 
loÿl
 
funùiÚ
 
	$fm‹¼
(
”r
, 
šfo
)

91 
	`ty³
(
”r
è=ğ"numb”" 
th’


92 
	`ty³
(
šfo
è=ğ"funùiÚ" 
th’
 infØğ
	$fmtfunc
(
šfo
è
’d


93 
”r
 = 
	$fÜm©
(
vmdef
.
Œaû”r
[
”r
], 
šfo
)

94 
’d


95  
”r


96 
’d


98 -- 
Dump
 
Œaû
 
¡©es
.

99 
loÿl
 
funùiÚ
 
	$dump_Œaû
(
wh©
, 
Œ
, 
func
, 
pc
, 
Ùr
, 
Ûx
)

100 
wh©
 =ğ"¡¬t" 
th’


101 
¡¬oc
 = 
	$fmtfunc
(
func
, 
pc
)

102 
¡¬‹x
 = 
Ùr
 
ªd
 "("..Ùr.."/"..(
Ûx
 =ğ-1‡nd "¡™ch" 
Ü
 oex)..") " or ""

104 
wh©
 =ğ"abÜt" 
th’


105 
loÿl
 
loc
 = 
	$fmtfunc
(
func
, 
pc
)

106 
loc
 ~ğ
¡¬oc
 
th’


107 
out
:
	`wr™e
(
	`fÜm©
("[TRACE --- %s%s -- %s‡t %s]\n",

108 
¡¬‹x
, 
¡¬oc
, 
	`fm‹¼
(
Ùr
, 
Ûx
), 
loc
))

110 
out
:
	`wr™e
(
	`fÜm©
("[TRACE --- %s%s -- %s]\n",

111 
¡¬‹x
, 
¡¬oc
, 
	$fm‹¼
(
Ùr
, 
Ûx
)))

112 
’d


113 
–£if
 
wh©
 =ğ"¡İ" 
th’


114 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

115 
loÿl
 
lšk
, 
Éy³
 = 
šfo
.lšk, info.
lškty³


116 
Éy³
 =ğ"š‹½»‹r" 
th’


117 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s -- fallbacko interpreter]\n",

118 
Œ
, 
¡¬‹x
, 
¡¬oc
))

119 
–£if
 
Éy³
 =ğ"¡™ch" 
th’


120 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s %s %s]\n",

121 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
Éy³
, 
	$fmtfunc
(
func
, 
pc
)))

122 
–£if
 
lšk
 =ğ
Œ
 
Ü
†šk =ğ0 
th’


123 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s %s]\n",

124 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
Éy³
))

125 
–£if
 
Éy³
 =ğ"roÙ" 
th’


126 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s -> %d]\n",

127 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
lšk
))

129 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s -> %d %s]\n",

130 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
lšk
, 
Éy³
))

131 
’d


133 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %s]\n", 
wh©
))

134 
’d


135 
out
:
	$æush
()

136 
’d


137 
’d


141 -- 
D‘ach
 
dump
 
hªdËrs
.

142 
loÿl
 
funùiÚ
 
	$dumpoff
()

143 
aùive
 
th’


144 
aùive
 = 
çl£


145 
j™
.
	$©ch
(
dump_Œaû
)

146 
out
 
ªd
 ouˆ~ğ
¡dout
‡nd ouˆ~ğ
¡d”r
 
th’
 out:
	$şo£
(è
’d


147 
out
 = 
n


148 
’d


149 
’d


151 -- 
O³n
 
the
 
ouut
 
fe
 
ªd
 
©ch
 
dump
 
hªdËrs
.

152 
loÿl
 
funùiÚ
 
	$dumpÚ
(
outfe
)

153 
aùive
 
th’
 
	$dumpoff
(è
’d


154 
nÙ
 
outfe
 
th’
 outfğ
os
.
	`g‘’v
("LUAJIT_VERBOSEFILE"è
’d


155 
outfe
 
th’


156 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
	`as£¹
(
io
.
	`İ’
(outfile, "w"))

158 
out
 = 
¡d”r


159 
’d


160 
j™
.
	`©ch
(
dump_Œaû
, "trace")

161 
aùive
 = 
Œue


162 
’d


164 -- 
Public
 
moduË
 
funùiÚs
.

166 
Ú
 = 
dumpÚ
,

167 
off
 = 
dumpoff
,

168 
¡¬t
 = 
dumpÚ
 -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

169 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/vmdef.lua

1 -- 
This
 
is
 
a
 
g’”©ed
 
	gfe
. 
DO
 
NOT
 
	gEDIT
!

5 
	gbúames
 = "ISLT ISGE ISLE ISGT ISEQV ISNEV ISEQS ISNES ISEQN ISNEN ISEQP ISNEP ISTC ISFC IST ISF ISTYPEISNUM MOV NOT UNM LEN ADDVN SUBVN MULVN DIVVN MODVN ADDNV SUBNV MULNV DIVNV MODNV ADDVV SUBVV MULVV DIVVV MODVV POW CAT KSTR KCDATAKSHORTKNUM KPRI KNIL UGET USETV USETS USETN USETP UCLO FNEW TNEW TDUP GGET GSET TGETV TGETS TGETB TGETR TSETV TSETS TSETB TSETM TSETR CALLM CALL CALLMTCALLT ITERC ITERN VARG ISNEXTRETM RET RET0 RET1 FORI JFORI FORL IFORL JFORL ITERL IITERLJITERLLOOP ILOOP JLOOP JMP FUNCF IFUNCFJFUNCFFUNCV IFUNCVJFUNCVFUNCC FUNCCW",

7 
	gœÇmes
 = "LT GE LE GT ULT UGE ULE UGT EQ NE ABC RETF NOP BASE PVAL GCSTEPHIOP LOOP USE PHI RENAMEPROF KPRI KINT KGC KPTR KKPTR KNULL KNUM KINT64KSLOT BNOT BSWAP BAND BOR BXOR BSHL BSHR BSAR BROL BROR ADD SUB MUL DIV MOD POW NEG ABS ATAN2 LDEXP MIN MAX FPMATHADDOV SUBOV MULOV AREF HREFK HREF NEWREFUREFO UREFC FREF STRREFLREF ALOAD HLOAD ULOAD FLOAD XLOAD SLOAD VLOAD ASTOREHSTOREUSTOREFSTOREXSTORESNEW XSNEW TNEW TDUP CNEW CNEWI BUFHDRBUFPUTBUFSTRTBAR OBAR XBAR CONV TOBIT TOSTR STRTO CALLN CALLA CALLL CALLS CALLXSCARG ",

9 
	gœåm
 = { [0]="floor", "ceil", "trunc", "sqrt", "exp", "exp2", "log", "log2", "log10", "sin", "cos", "tan", "other", },

11 
	gœf›ld
 = { [0]="str.len", "func.env", "func.pc", "func.ffid", "thread.env", "tab.meta", "tab.array", "tab.node", "tab.asize", "tab.hmask", "tab.nomm", "udata.meta", "udata.udtype", "udata.file", "cdata.ctypeid", "cdata.ptr", "cdata.int", "cdata.int64", "cdata.int64_4", },

13 
	gœÿÎ
 = {

118 
	gŒaû”r
 = {

156 
	gfâames
 = {

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/zone.lua

2 -- 
LuaJIT
 
´of”
 
	gzÚes
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
im¶em’ts
 
a
 
sim¶e
 
h›¿rchiÿl
 
zÚe
 
	gmod–
.

10 -- 
Exam¶e
 
	gu§ge
:

12 -- 
loÿl
 
zÚe
 = 
»quœe
("jit.zone")

13 -- 
zÚe
("AI")

15 -- 
zÚe
("A*")

17 -- 
´št
(
zÚe
:
g‘
()) --> "A*"

19 -- 
zÚe
()

21 -- 
´št
(
zÚe
:
g‘
()) --> "AI"

23 -- 
zÚe
()

27 
loÿl
 
»move
 = 
bË
.remove

29  
£tm‘©abË
({

30 
æush
 = 
funùiÚ
(
t
)

31 
i
=#t,1,-1 dØ
t
[i] = 
n
 
’d


32 
’d
,

33 
g‘
 = 
funùiÚ
(
t
)

34  
t
[#t]

35 
’d


37 
__ÿÎ
 = 
funùiÚ
(
t
, 
zÚe
)

38 
zÚe
 
th’


39 
t
[#t+1] = 
zÚe


41  (
as£¹
(
»move
(
t
), "empty zone stack"))

42 
’d


43 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/bc.lua

2 -- 
LuaJIT
 
by‹code
 
li¡šg
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
li¡s
 
the
 
by‹code
 
of
 
a
 
Lua
 
	gfunùiÚ
. 
If
 
	g™
's†oaded by -jbc

9 -- 
™
 
hooks
 
što
 
the
 
·r£r
 
ªd
 
li¡s
 
®l
 
funùiÚs
 
of
 
a
 
chunk
 
as
 
	gthey


10 -- 
¬e
 
	g·r£d
.

12 -- 
Exam¶e
 
	gu§ge
:

14 -- 
luaj™
 -
jbc
 -
e
 'local x=0; for i=1,1e6 do x=x+iƒnd;…rint(x)'

15 -- 
luaj™
 -
jbc
=- 
foo
.
lua


16 -- 
luaj™
 -
jbc
=
foo
.
li¡
 foo.
lua


18 -- 
DeçuÉ
 
ouut
 
is
 
to
 
¡d”r
. 
To
 
»dœeù
 
the
 ouuˆtØ
a
 
fe
, 
·ss
 
	ga


19 -- 
f’ame
 
as
 
ª
 
¬gum’t
 (
u£
 '-' 
¡dout
è
Ü
 
£t
 
the
 
	g’vœÚm’t


20 -- 
v¬ŸbË
 
	gLUAJIT_LISTFILE
. 
The
 
fe
 
is
 
ov”wr™‹n
 
ev”y
 
time
 
the
 
	gmoduË


21 -- 
is
 
	g¡¬‹d
.

23 -- 
This
 
moduË
 
ÿn
 
®so
 
be
 
u£d
 
	g´og¿mm©iÿÎy
:

25 -- 
loÿl
 
bc
 = 
»quœe
("jit.bc")

27 -- 
loÿl
 
funùiÚ
 
	$foo
(è
	`´št
("h–lo"è
’d


29 -- 
bc
.
	`dump
(
foo
è--> -- 
BYTECODE
 -- [...]

30 -- 
	`´št
(
bc
.
	`lše
(
foo
, 2)è--> 0002 
KSTR
 1 1 ; "hello"

32 -- 
loÿl
 
out
 = {

33 -- -- 
Do
 
som‘hšg
 
w™h
 
—ch
 
lše
:

34 -- 
wr™e
 = 
	`funùiÚ
(
t
, ...è
io
.
	`wr™e
(...è
’d
,

35 -- 
şo£
 = 
	`funùiÚ
(
t
è
’d
,

36 -- 
æush
 = 
	`funùiÚ
(
t
è
’d
,

37 -- 
	}
}

38 -- 
	gbc
.
dump
(
foo
, 
out
)

42 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
	gobjeùs
.

43 
loÿl
 
	gj™
 = 
»quœe
("jit")

44 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

45 
loÿl
 
	gjut
 = 
»quœe
("jit.util")

46 
loÿl
 
vmdef
 = 
»quœe
("jit.vmdef")

47 
loÿl
 
b™
 = 
»quœe
("bit")

48 
loÿl
 
sub
, 
	ggsub
, 
	gfÜm©
 = 
¡ršg
.sub, 
	g¡ršg
.gsub, sŒšg.
fÜm©


49 
loÿl
 
	gby‹
, 
	gbªd
, 
	gshr
 = 
¡ršg
.
by‹
, 
	gb™
.bªd, b™.
rshiá


50 
loÿl
 
	gfuncšfo
, 
	gfuncbc
, 
	gfunck
 = 
jut
.
funcšfo
, 
	gjut
.funcbc, jut.
funck


51 
loÿl
 
	gfuncuvÇme
 = 
jut
.
funcuvÇme


52 
loÿl
 
búames
 = 
vmdef
.bcnames

53 
loÿl
 
¡dout
, 
	g¡d”r
 = 
io
.¡dout, 
	gio
.stderr

57 
loÿl
 
funùiÚ
 
	$ùlsub
(
c
)

58 
c
 =ğ"\n" 
th’
  "\\n"

59 
–£if
 
c
 =ğ"\r" 
th’
  "\\r"

60 
–£if
 
c
 =ğ"\t" 
th’
  "\\t"

61  
	`fÜm©
("\\%03d", 
	$by‹
(
c
))

62 
’d


63 
’d


65 -- 
R‘uº
 
Úe
 
by‹code
 
lše
.

66 
loÿl
 
funùiÚ
 
	$bşše
(
func
, 
pc
, 
´efix
)

67 
loÿl
 
šs
, 
m
 = 
	$funcbc
(
func
, 
pc
)

68 
nÙ
 
šs
 
th’
  
’d


69 
loÿl
 
ma
, 
mb
, 
mc
 = 
	`bªd
(
m
, 7), bªd(m, 15*8), 
	$bªd
(
m
, 15*128)

70 
loÿl
 
a
 = 
	`bªd
(
	`shr
(
šs
, 8), 0xff)

71 
loÿl
 
oidx
 = 6*
	$bªd
(
šs
, 0xff)

72 
loÿl
 
İ
 = 
	`sub
(
búames
, 
oidx
+1, oidx+6)

73 
loÿl
 
s
 = 
	`fÜm©
("%04d %s %-6s %3s ",

74 
pc
, 
´efix
 
Ü
 " ", 
İ
, 
ma
 =ğ0 
ªd
 "" o¸
a
)

75 
loÿl
 
d
 = 
	$shr
(
šs
, 16)

76 
mc
 =ğ13*128 
th’
 -- 
BCMjump


77  
	`fÜm©
("%s=> %04d\n", 
s
, 
pc
+
d
-0x7fff)

78 
’d


79 
mb
 ~ğ0 
th’


80 
d
 = 
	$bªd
(
d
, 0xff)

81 
–£if
 
mc
 =ğ0 
th’


82  
s
.."\n"

83 
’d


84 
loÿl
 
kc


85 
mc
 =ğ10*128 
th’
 -- 
BCM¡r


86 
kc
 = 
	`funck
(
func
, -
d
-1)

87 
kc
 = 
	`fÜm©
(#kø> 40 
ªd
 '"%.40s"~' 
Ü
 '"%s"', 
	`gsub
(kc, "%c", 
ùlsub
))

88 
–£if
 
mc
 =ğ9*128 
th’
 -- 
BCMnum


89 
kc
 = 
	$funck
(
func
, 
d
)

90 
İ
 =ğ"TSETM " 
th’
 
kc
 = kø- 2^52 
’d


91 
–£if
 
mc
 =ğ12*128 
th’
 -- 
BCMfunc


92 
loÿl
 
fi
 = 
	`funcšfo
(
	`funck
(
func
, -
d
-1))

93 
fi
.
ffid
 
th’


94 
kc
 = 
vmdef
.
fâames
[
fi
.
ffid
]

96 
kc
 = 
fi
.
loc


97 
’d


98 
–£if
 
mc
 =ğ5*128 
th’
 -- 
BCMuv


99 
kc
 = 
	$funcuvÇme
(
func
, 
d
)

100 
’d


101 
ma
 =ğ5 
th’
 -- 
BCMuv


102 
loÿl
 
ka
 = 
	$funcuvÇme
(
func
, 
a
)

103 
kc
 
th’
 køğ
ka
.." ; "..køkøğk¨
’d


104 
’d


105 
mb
 ~ğ0 
th’


106 
loÿl
 
b
 = 
	$shr
(
šs
, 24)

107 
kc
 
th’
  
	`fÜm©
("%s%3d %3d ; %s\n", 
s
, 
b
, 
d
, kcè
’d


108  
	`fÜm©
("%s%3d %3d\n", 
s
, 
b
, 
d
)

109 
’d


110 
kc
 
th’
  
	`fÜm©
("%s%3d ; %s\n", 
s
, 
d
, kcè
’d


111 
mc
 =ğ7*128 
ªd
 
d
 > 32767 
th’
 d = d - 65536 
’d
 -- 
BCMl™s


112  
	`fÜm©
("%s%3d\n", 
s
, 
d
)

113 
’d


115 -- 
CŞËù
 
b¿nch
 
rg‘s
 
of
 
a
 
funùiÚ
.

116 
loÿl
 
funùiÚ
 
	$bù¬g‘s
(
func
)

117 
loÿl
 
rg‘
 = {
	}
}

118 
pc
=1,1000000000 do

119 
loÿl
 
	gšs
, 
	gm
 = 
	$funcbc
(
func
, 
pc
)

120 
nÙ
 
šs
 
th’
  
’d


121 
	`bªd
(
m
, 15*128è=ğ13*128 
th’
 
rg‘
[
pc
+
	`shr
(
šs
, 16)-0x7fff] = 
Œue
 
’d


122 
’d


123  
rg‘


124 
’d


126 -- 
Dump
 
by‹code
 
š¡ruùiÚs
 
of
 
a
 
funùiÚ
.

127 
loÿl
 
funùiÚ
 
	$bcdump
(
func
, 
out
, 
®l
)

128 
nÙ
 
out
 
th’
 ouˆğ
¡dout
 
’d


129 
loÿl
 
fi
 = 
	$funcšfo
(
func
)

130 
®l
 
ªd
 
fi
.
chd»n
 
th’


131 
n
=-1,-1000000000,-1 do

132 
loÿl
 
k
 = 
	$funck
(
func
, 
n
)

133 
nÙ
 
k
 
th’
  
’d


134 
	`ty³
(
k
è=ğ"´Ùo" 
th’
 
	$bcdump
(
k
, 
out
, 
Œue
è
’d


135 
’d


136 
’d


137 
out
:
	`wr™e
(
	`fÜm©
("-- BYTECODE -- %s-%d\n", 
fi
.
loc
, fi.
Ï¡lšedefšed
))

138 
loÿl
 
rg‘
 = 
	$bù¬g‘s
(
func
)

139 
pc
=1,1000000000 do

140 
loÿl
 
s
 = 
	`bşše
(
func
, 
pc
, 
rg‘
[pc] 
ªd
 "=>")

141 
nÙ
 
s
 
th’
  
’d


142 
out
:
	$wr™e
(
s
)

143 
’d


144 
out
:
	`wr™e
("\n")

145 
out
:
	$æush
()

146 
’d


150 -- 
Aùive
 
æag
 
ªd
 
ouut
 
fe
 
hªdË
.

151 
loÿl
 
aùive
, 
out


153 -- 
Li¡
 
hªdËr
.

154 
loÿl
 
funùiÚ
 
	$h_li¡
(
func
)

155  
	$bcdump
(
func
, 
out
)

156 
’d


158 -- 
D‘ach
 
li¡
 
hªdËr
.

159 
loÿl
 
funùiÚ
 
	$bşi¡off
()

160 
aùive
 
th’


161 
aùive
 = 
çl£


162 
j™
.
	$©ch
(
h_li¡
)

163 
out
 
ªd
 ouˆ~ğ
¡dout
‡nd ouˆ~ğ
¡d”r
 
th’
 out:
	$şo£
(è
’d


164 
out
 = 
n


165 
’d


166 
’d


168 -- 
O³n
 
the
 
ouut
 
fe
 
ªd
 
©ch
 
li¡
 
hªdËr
.

169 
loÿl
 
funùiÚ
 
	$bşi¡Ú
(
outfe
)

170 
aùive
 
th’
 
	$bşi¡off
(è
’d


171 
nÙ
 
outfe
 
th’
 outfğ
os
.
	`g‘’v
("LUAJIT_LISTFILE"è
’d


172 
outfe
 
th’


173 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
	`as£¹
(
io
.
	`İ’
(outfile, "w"))

175 
out
 = 
¡d”r


176 
’d


177 
j™
.
	`©ch
(
h_li¡
, "bc")

178 
aùive
 = 
Œue


179 
’d


181 -- 
Public
 
moduË
 
funùiÚs
.

183 
lše
 = 
bşše
,

184 
dump
 = 
bcdump
,

185 
rg‘s
 = 
bù¬g‘s
,

186 
Ú
 = 
bşi¡Ú
,

187 
off
 = 
bşi¡off
,

188 
¡¬t
 = 
bşi¡Ú
 -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

189 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/bcsave.lua

2 -- 
LuaJIT
 
moduË
 
to
 
	g§ve
/
li¡
 
	gby‹code
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
§ves
 
Ü
 
li¡s
 
the
 
by‹code
 
ª
 
šput
 
	gfe
.

9 -- 
	gIt
's„un byhe -b command†ine option.

13 
loÿl
 
	gj™
 = 
»quœe
("jit")

14 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

15 
loÿl
 
	gb™
 = 
»quœe
("bit")

17 -- 
SymbŞ
 
Çme
 
´efix
 
LuaJIT
 
by‹code
.

18 
loÿl
 
LJBC_PREFIX
 = "luaJIT_BC_"

22 
loÿl
 
funùiÚ
 
	$u§ge
()

23 
io
.
¡d”r
:
wr™e
[[

24 
Save
 
LuaJIT
 
by‹code
: 
luaj™
 -
b
[
İtiÚs
] 
šput
 
ouut


25 -
l
 
OÆy
 
li¡
 
by‹code
.

26 -
s
 
SŒ
 
debug
 
	`šfo
 ().

27 -
g
 
K“p
 
debug
 
šfo
.

28 -
n
 
Çme
 
S‘
 
moduË
 
	`Çme
 (:‡uto-
d‘eù
 
äom
 
šput
‚ame).

29 -
t
 
ty³
 
S‘
 
ouut
 
fe
 
	`ty³
 (:‡uto-
d‘eù
 
äom
 ouuˆ
Çme
).

30 -
a
 
¬ch
 
Ov”ride
 
¬ch™eùu»
 
objeù
 
	`fes
 (: 
Çtive
).

31 -
o
 
os
 
Ov”ride
 
OS
 
objeù
 
	`fes
 (: 
Çtive
).

32 -
e
 
chunk
 
U£
 chunk 
¡ršg
 
as
 
šput
.

33 -- 
Stİ
 
hªdlšg
 
İtiÚs
.

34 - 
U£
 
¡dš
 
as
 
šput
 
ªd
/
Ü
 
¡dout
‡ 
ouut
.

36 
Fe
 
ty³s
: 
c
 
h
 
obj
 
o
 
	`¿w
 ()

38 
os
.
	$ex™
(1)

39 
’d


41 
loÿl
 
funùiÚ
 
	$check
(
ok
, ...)

42 
ok
 
th’
  ok, ... 
’d


43 
io
.
¡d”r
:
	`wr™e
("luajit: ", ...)

44 
io
.
¡d”r
:
	`wr™e
("\n")

45 
os
.
	$ex™
(1)

46 
’d


48 
loÿl
 
funùiÚ
 
	$»adfe
(
šput
)

49 
	`ty³
(
šput
è=ğ"funùiÚ" 
th’
  iÅuˆ
’d


50 
šput
 =ğ"-" 
th’
 iÅuˆğ
n
 
’d


51  
	`check
(
	$lßdfe
(
šput
))

52 
’d


54 
loÿl
 
funùiÚ
 
	$§vefe
(
Çme
, 
mode
)

55 
Çme
 =ğ"-" 
th’
  
io
.
¡dout
 
’d


56  
	`check
(
io
.
	$İ’
(
Çme
, 
mode
))

57 
’d


61 
loÿl
 
m­_ty³
 = {

62 
¿w
 = "¿w", 
c
 = "c", 
h
 = "h", 
o
 = "obj", 
obj
 = "obj",

63 
	}
}

65 
loÿl
 
	gm­_¬ch
 = {

66 
x86
 = 
Œue
, 
	gx64
 =rue, 
	g¬m
 =rue, 
	g¬m64
 =rue, 
	g¬m64be
 =rue,

67 
	gµc
 = 
Œue
, 
	gms
 =rue, 
	gm£l
 =rue,

70 
loÿl
 
	gm­_os
 = {

71 
lšux
 = 
Œue
, 
	gwšdows
 =rue, 
	gosx
 =rue, 
	gä“bsd
 =rue, 
	gÃtbsd
 =rue,

72 
	gİ’bsd
 = 
Œue
, 
	gd¿gÚæy
 =rue, 
	gsŞ¬is
 =rue,

75 
loÿl
 
funùiÚ
 
	$check¬g
(
¡r
, 
m­
, 
”r
)

76 
¡r
 = 
¡ršg
.
	$low”
(
¡r
)

77 
loÿl
 
s
 = 
	`check
(
m­
[
¡r
], "unknowÀ", 
”r
)

78  
s
 =ğ
Œue
 
ªd
 
¡r
 
Ü
 s

79 
’d


81 
loÿl
 
funùiÚ
 
	$d‘eùty³
(
¡r
)

82 
loÿl
 
ext
 = 
¡ršg
.
	`m©ch
(¡ršg.
	`low”
(
¡r
), "%.(%a+)$")

83  
m­_ty³
[
ext
] 
Ü
 "raw"

84 
’d


86 
loÿl
 
funùiÚ
 
	$checkmodÇme
(
¡r
)

87 
	`check
(
¡ršg
.
	`m©ch
(
¡r
, "^[%w_.%-]+$"), "bad module‚ame")

88  
¡ršg
.
	`gsub
(
¡r
, "[%.%-]", "_")

89 
’d


91 
loÿl
 
funùiÚ
 
	$d‘eùmodÇme
(
¡r
)

92 
	`ty³
(
¡r
è=ğ"¡ršg" 
th’


93 
loÿl
 

 = 
¡ršg
.
	`m©ch
(
¡r
, "[^/\\]+$")

94 

 
th’
 
¡r
 =a 
’d


95 
loÿl
 
h—d
 = 
¡ršg
.
	`m©ch
(
¡r
, "^(.*)%.[^.]*$")

96 
h—d
 
th’
 
¡r
 = h—d 
’d


97 
¡r
 = 
¡ršg
.
	`m©ch
(str, "^[%w_.%-]+")

99 
¡r
 = 
n


100 
’d


101 
	`check
(
¡r
, "cannot derive module‚ame, use -n‚ame")

102  
¡ršg
.
	`gsub
(
¡r
, "[%.%-]", "_")

103 
’d


107 
loÿl
 
funùiÚ
 
	$bc§ve_
(
å
, 
ouut
, 
s
)

108 
loÿl
 
ok
, 
”r
 = 
å
:
	$wr™e
(
s
)

109 
ok
 
ªd
 
ouut
 ~ğ"-" 
th’
 ok, 
”r
 = 
å
:
	$şo£
(è
’d


110 
	`check
(
ok
, "ÿÂÙ wr™", 
ouut
, ": ", 
”r
)

111 
’d


113 
loÿl
 
funùiÚ
 
	$bc§ve_¿w
(
ouut
, 
s
)

114 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

115 
	$bc§ve_
(
å
, 
ouut
, 
s
)

116 
’d


118 
loÿl
 
funùiÚ
 
	$bc§ve_c
(
ùx
, 
ouut
, 
s
)

119 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "w")

120 
ùx
.
ty³
 =ğ"c" 
th’


121 
å
:
	`wr™e
(
¡ršg
.
	`fÜm©
([[

122 #ifdeà
_ılu¥lus


125 #ifdeà
_WIN32


126 
	$__deş¥ec
(
dÎexpÜt
)

128 cÚ¡ %
s
%s[] = {

129 ]], 
LJBC_PREFIX
, 
ùx
.
modÇme
))

131 
å
:
	`wr™e
(
¡ršg
.
	`fÜm©
([[

132 #defš%
s
%
s_SIZE
 %
d


133 cÚ¡ %
s
%s[] = {

134 ]], 
LJBC_PREFIX
, 
ùx
.
modÇme
, #s, LJBC_PREFIX, ctx.modname))

135 
’d


136 
loÿl
 
t
, 
n
, 
m
 = {}, 0, 0

137 
i
=1,#s do

138 
loÿl
 
b
 = 
	`to¡ršg
(
¡ršg
.
	`by‹
(
s
, 
i
))

139 
m
 = m + #b + 1

140 
m
 > 78 
th’


141 
å
:
	`wr™e
(
bË
.
	`cÚÿt
(
t
, ",", 1, 
n
), ",\n")

142 
n
, 
m
 = 0, #b + 1

143 
’d


144 
n
 =‚ + 1

145 
t
[
n
] = 
b


146 
’d


147 
	`bc§ve_
(
å
, 
ouut
, 
bË
.
	`cÚÿt
(
t
, ",", 1, 
n
).."\n};\n")

148 
’d


150 
loÿl
 
funùiÚ
 
	`bc§ve_–fobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

151 
ffi
.
cdef
[[

153 
ušt8_t
 
emagic
[4], 
eşass
, 
“ndŸn
, 
ev”siÚ
, 
eo§bi
, 
—biv”siÚ
, 
•ad
[7];

154 
ušt16_t
 
ty³
, 
machše
;

155 
ušt32_t
 
v”siÚ
;

156 
ušt32_t
 
’Œy
, 
phofs
, 
shofs
;

157 
ušt32_t
 
æags
;

158 
ušt16_t
 
ehsize
, 
ph’tsize
, 
phnum
, 
sh’tsize
, 
shnum
, 
sh¡ridx
;

159 } 
	tELF32h—d”
;

161 
ušt8_t
 
emagic
[4], 
eşass
, 
“ndŸn
, 
ev”siÚ
, 
eo§bi
, 
—biv”siÚ
, 
•ad
[7];

162 
ušt16_t
 
ty³
, 
machše
;

163 
ušt32_t
 
v”siÚ
;

164 
ušt64_t
 
’Œy
, 
phofs
, 
shofs
;

165 
ušt32_t
 
æags
;

166 
ušt16_t
 
ehsize
, 
ph’tsize
, 
phnum
, 
sh’tsize
, 
shnum
, 
sh¡ridx
;

167 } 
	tELF64h—d”
;

169 
ušt32_t
 
Çme
, 
ty³
, 
æags
, 
addr
, 
ofs
, 
size
, 
lšk
, 
šfo
, 
®ign
, 
’tsize
;

170 } 
	tELF32£ùh—d”
;

172 
ušt32_t
 
Çme
, 
ty³
;

173 
ušt64_t
 
æags
, 
addr
, 
ofs
, 
size
;

174 
ušt32_t
 
lšk
, 
šfo
;

175 
ušt64_t
 
®ign
, 
’tsize
;

176 } 
	tELF64£ùh—d”
;

178 
ušt32_t
 
Çme
, 
v®ue
, 
size
;

179 
ušt8_t
 
šfo
, 
Ùh”
;

180 
ušt16_t
 
£ùidx
;

181 } 
	tELF32symbŞ
;

183 
ušt32_t
 
Çme
;

184 
ušt8_t
 
šfo
, 
Ùh”
;

185 
ušt16_t
 
£ùidx
;

186 
ušt64_t
 
v®ue
, 
size
;

187 } 
	tELF64symbŞ
;

189 
ELF32h—d”
 
hdr
;

190 
ELF32£ùh—d”
 
£ù
[6];

191 
ELF32symbŞ
 
sym
[2];

192 
ušt8_t
 
¥aû
[4096];

193 } 
	tELF32obj
;

195 
ELF64h—d”
 
hdr
;

196 
ELF64£ùh—d”
 
£ù
[6];

197 
ELF64symbŞ
 
sym
[2];

198 
ušt8_t
 
¥aû
[4096];

199 } 
	tELF64obj
;

201 
loÿl
 
symÇme
 = 
LJBC_PREFIX
..
ùx
.
modÇme


202 
loÿl
 
is64
, 
isbe
 = 
çl£
, false

203 
ùx
.
¬ch
 =ğ"x64" 
Ü
 ctx.¬ch =ğ"¬m64" o¸ùx.¬ch =ğ"¬m64be" 
th’


204 
is64
 = 
Œue


205 
–£if
 
ùx
.
¬ch
 =ğ"µc" 
Ü
 ctx.¬ch =ğ"ms" 
th’


206 
isbe
 = 
Œue


207 
’d


209 -- 
HªdË
 
difã»Á
 
ho¡
/
rg‘
 
’dŸÃss
.

210 
loÿl
 
funùiÚ
 
	`f32
(
x
è x 
’d


211 
loÿl
 
f16
, 
fofs
 = 
f32
, f32

212 
ffi
.
	`abi
("be"è~ğ
isbe
 
th’


213 
f32
 = 
b™
.
bsw­


214 
funùiÚ
 
	`f16
(
x
è 
b™
.
	`rshiá
(b™.
	`bsw­
(x), 16è
’d


215 
is64
 
th’


216 
loÿl
 
two32
 = 
ffi
.
	`ÿ¡
("int64_t", 2^32)

217 
funùiÚ
 
	`fofs
(
x
è 
b™
.
	`bsw­
(x)*
two32
 
’d


219 
fofs
 = 
f32


220 
’d


221 
’d


223 -- 
C»©e
 
ELF
 
objeù
 
ªd
 
fl
 
š
 
h—d”
.

224 
loÿl
 
o
 = 
ffi
.
	`Ãw
(
is64
 
ªd
 "ELF64obj" 
Ü
 "ELF32obj")

225 
loÿl
 
hdr
 = 
o
.hdr

226 
ùx
.
os
 =ğ"bsd" 
Ü
 ctx.o =ğ"Ùh”" 
th’
 -- 
D‘”mše
 
Çtive
 
hdr
.
eo§bi
.

227 
loÿl
 
bf
 = 
	`as£¹
(
io
.
	`İ’
("/bin/ls", "rb"))

228 
loÿl
 
bs
 = 
bf
:
	`»ad
(9)

229 
bf
:
	`şo£
()

230 
ffi
.
	`cİy
(
o
, 
bs
, 9)

231 
	`check
(
hdr
.
emagic
[0] == 127, "no support for writing‚ative object files")

233 
hdr
.
emagic
 = "\127ELF"

234 
hdr
.
eo§bi
 = ({ 
ä“bsd
=9, 
Ãtbsd
=2, 
İ’bsd
=12, 
sŞ¬is
=6 })[
ùx
.
os
] 
Ü
 0

235 
’d


236 
hdr
.
eşass
 = 
is64
 
ªd
 2 
Ü
 1

237 
hdr
.
“ndŸn
 = 
isbe
 
ªd
 2 
Ü
 1

238 
hdr
.
ev”siÚ
 = 1

239 
hdr
.
ty³
 = 
	`f16
(1)

240 
hdr
.
machše
 = 
	`f16
(({ 
x86
=3, 
x64
=62, 
¬m
=40, 
¬m64
=183, 
¬m64be
=183, 
µc
=20, 
ms
=8, 
m£l
=8 })[
ùx
.
¬ch
])

241 
ùx
.
¬ch
 =ğ"ms" 
Ü
 ctx.¬ch =ğ"m£l" 
th’


242 
hdr
.
æags
 = 
	`f32
(0x50001006)

243 
’d


244 
hdr
.
v”siÚ
 = 
	`f32
(1)

245 
hdr
.
shofs
 = 
	`fofs
(
ffi
.
	`off£tof
(
o
, "sect"))

246 
hdr
.
ehsize
 = 
	`f16
(
ffi
.(hdr))

247 
hdr
.
sh’tsize
 = 
	`f16
(
ffi
.(
o
.
£ù
[0]))

248 
hdr
.
shnum
 = 
	`f16
(6)

249 
hdr
.
sh¡ridx
 = 
	`f16
(2)

251 -- 
Fl
 
š
 
£ùiÚs
 
ªd
 
symbŞs
.

252 
loÿl
 
sofs
, 
ofs
 = 
ffi
.
	`off£tof
(
o
, "space"), 1

253 
i
,
Çme
 
š
 
aœs
{

256 
loÿl
 
£ù
 = 
o
.£ù[
i
]

257 
£ù
.
®ign
 = 
	`fofs
(1)

258 
£ù
.
Çme
 = 
	`f32
(
ofs
)

259 
ffi
.
	`cİy
(
o
.
¥aû
+
ofs
, 
Çme
)

260 
ofs
 = ofs + #name+1

261 
’d


262 
o
.
£ù
[1].
ty³
 = 
	`f32
(2è-- .
symb


263 
o
.
£ù
[1].
lšk
 = 
	`f32
(3)

264 
o
.
£ù
[1].
šfo
 = 
	`f32
(1)

265 
o
.
£ù
[1].
®ign
 = 
	`fofs
(8)

266 
o
.
£ù
[1].
ofs
 = 
	`fofs
(
ffi
.
	`off£tof
(o, "sym"))

267 
o
.
£ù
[1].
’tsize
 = 
	`fofs
(
ffi
.(o.
sym
[0]))

268 
o
.
£ù
[1].
size
 = 
	`fofs
(
ffi
.(o.
sym
))

269 
o
.
sym
[1].
Çme
 = 
	`f32
(1)

270 
o
.
sym
[1].
£ùidx
 = 
	`f16
(4)

271 
o
.
sym
[1].
size
 = 
	`fofs
(#s)

272 
o
.
sym
[1].
šfo
 = 17

273 
o
.
£ù
[2].
ty³
 = 
	`f32
(3è-- .
sh¡¹ab


274 
o
.
£ù
[2].
ofs
 = 
	`fofs
(
sofs
)

275 
o
.
£ù
[2].
size
 = 
	`fofs
(
ofs
)

276 
o
.
£ù
[3].
ty³
 = 
	`f32
(3è-- .
¡¹ab


277 
o
.
£ù
[3].
ofs
 = 
	`fofs
(
sofs
 + ofs)

278 
o
.
£ù
[3].
size
 = 
	`fofs
(#symname+1)

279 
ffi
.
	`cİy
(
o
.
¥aû
+
ofs
+1, 
symÇme
)

280 
ofs
 = ofs + #symname + 2

281 
o
.
£ù
[4].
ty³
 = 
	`f32
(1è-- .
rod©a


282 
o
.
£ù
[4].
æags
 = 
	`fofs
(2)

283 
o
.
£ù
[4].
ofs
 = 
	`fofs
(
sofs
 + ofs)

284 
o
.
£ù
[4].
size
 = 
	`fofs
(#s)

285 
o
.
£ù
[5].
ty³
 = 
	`f32
(1è-- .
nÙe
.
GNU
-
¡ack


286 
o
.
£ù
[5].
ofs
 = 
	`fofs
(
sofs
 + ofs + #s)

288 -- 
Wr™e
 
ELF
 
objeù
 
fe
.

289 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

290 
å
:
	`wr™e
(
ffi
.
	`¡ršg
(
o
, ffi.(o)-4096+
ofs
))

291 
	`bc§ve_
(
å
, 
ouut
, 
s
)

292 
’d


294 
loÿl
 
funùiÚ
 
	`bc§ve_³obj
(
ùx
, 
ouut
, 
s
, 
ffi
)

295 
ffi
.
cdef
[[

297 
ušt16_t
 
¬ch
, 
n£ùs
;

298 
ušt32_t
 
time
, 
symbofs
, 
nsyms
;

299 
ušt16_t
 
İthdrsz
, 
æags
;

300 } 
PEh—d”
;

302 
Çme
[8];

303 
ušt32_t
 
vsize
, 
vaddr
, 
size
, 
ofs
, 
»locofs
, 
lšeofs
;

304 
ušt16_t
 
Ä–oc
, 
Æše
;

305 
ušt32_t
 
æags
;

306 } 
	tPE£ùiÚ
;

307 
	`__©Œibu‹
((
	t·cked
)) {

309 
Çme
[8];

310 
ušt32_t
 
Çm”ef
[2];

312 
ušt32_t
 
v®ue
;

313 
št16_t
 
£ù
;

314 
ušt16_t
 
ty³
;

315 
ušt8_t
 
sş
, 
Çux
;

316 } 
	tPEsym
;

317 
	`__©Œibu‹
((
	t·cked
)) {

318 
ušt32_t
 
size
;

319 
ušt16_t
 
Ä–oc
, 
Æše
;

320 
ušt32_t
 
cksum
;

321 
ušt16_t
 
assoc
;

322 
ušt8_t
 
comd©£l
, 
unu£d
[3];

323 } 
	tPEsymaux
;

325 
PEh—d”
 
hdr
;

326 
PE£ùiÚ
 
£ù
[2];

328 
PEsym
 
sym0
;

329 
PEsymaux
 
sym0aux
;

330 
PEsym
 
sym1
;

331 
PEsymaux
 
sym1aux
;

332 
PEsym
 
sym2
;

333 
PEsym
 
sym3
;

334 
ušt32_t
 
¡¹absize
;

335 
ušt8_t
 
¥aû
[4096];

336 } 
	tPEobj
;

338 
loÿl
 
symÇme
 = 
LJBC_PREFIX
..
ùx
.
modÇme


339 
loÿl
 
is64
 = 
çl£


340 
ùx
.
¬ch
 =ğ"x86" 
th’


341 
symÇme
 = "_"..symname

342 
–£if
 
ùx
.
¬ch
 =ğ"x64" 
th’


343 
is64
 = 
Œue


344 
’d


345 
loÿl
 
symexpÜt
 = " /EXPORT:"..
symÇme
..",DATA "

347 -- 
The
 
fe
 
fÜm©
 
is
 
®ways
 
l™e
-
’dŸn
. 
Sw­
 
the
 
ho¡
 i 
big
-endian.

348 
loÿl
 
funùiÚ
 
	`f32
(
x
è x 
’d


349 
loÿl
 
f16
 = 
f32


350 
ffi
.
	`abi
("be"è
th’


351 
f32
 = 
b™
.
bsw­


352 
funùiÚ
 
	`f16
(
x
è 
b™
.
	`rshiá
(b™.
	`bsw­
(x), 16è
’d


353 
’d


355 -- 
C»©e
 
PE
 
objeù
 
ªd
 
fl
 
š
 
h—d”
.

356 
loÿl
 
o
 = 
ffi
.
	`Ãw
("PEobj")

357 
loÿl
 
hdr
 = 
o
.hdr

358 
hdr
.
¬ch
 = 
	`f16
(({ 
x86
=0x14c, 
x64
=0x8664, 
¬m
=0x1c0, 
µc
=0x1f2, 
ms
=0x366, 
m£l
=0x366 })[
ùx
.arch])

359 
hdr
.
n£ùs
 = 
	`f16
(2)

360 
hdr
.
symbofs
 = 
	`f32
(
ffi
.
	`off£tof
(
o
, "sym0"))

361 
hdr
.
nsyms
 = 
	`f32
(6)

363 -- 
Fl
 
š
 
£ùiÚs
 
ªd
 
symbŞs
.

364 
o
.
£ù
[0].
Çme
 = ".drectve"

365 
o
.
£ù
[0].
size
 = 
	`f32
(#symexport)

366 
o
.
£ù
[0].
æags
 = 
	`f32
(0x00100a00)

367 
o
.
sym0
.
£ù
 = 
	`f16
(1)

368 
o
.
sym0
.
sş
 = 3

369 
o
.
sym0
.
Çme
 = ".drectve"

370 
o
.
sym0
.
Çux
 = 1

371 
o
.
sym0aux
.
size
 = 
	`f32
(#symexport)

372 
o
.
£ù
[1].
Çme
 = ".rdata"

373 
o
.
£ù
[1].
size
 = 
	`f32
(#s)

374 
o
.
£ù
[1].
æags
 = 
	`f32
(0x40300040)

375 
o
.
sym1
.
£ù
 = 
	`f16
(2)

376 
o
.
sym1
.
sş
 = 3

377 
o
.
sym1
.
Çme
 = ".rdata"

378 
o
.
sym1
.
Çux
 = 1

379 
o
.
sym1aux
.
size
 = 
	`f32
(#s)

380 
o
.
sym2
.
£ù
 = 
	`f16
(2)

381 
o
.
sym2
.
sş
 = 2

382 
o
.
sym2
.
Çm”ef
[1] = 
	`f32
(4)

383 
o
.
sym3
.
£ù
 = 
	`f16
(-1)

384 
o
.
sym3
.
sş
 = 2

385 
o
.
sym3
.
v®ue
 = 
	`f32
(1)

386 
o
.
sym3
.
Çme
 = "@ã©.00" -- 
M¬k
 
as
 
SaãSEH
 
com¶ŸÁ
.

387 
ffi
.
	`cİy
(
o
.
¥aû
, 
symÇme
)

388 
loÿl
 
ofs
 = #symname + 1

389 
o
.
¡¹absize
 = 
	`f32
(
ofs
 + 4)

390 
o
.
£ù
[0].
ofs
 = 
	`f32
(
ffi
.
	`off£tof
(o, "space") + ofs)

391 
ffi
.
	`cİy
(
o
.
¥aû
 + 
ofs
, 
symexpÜt
)

392 
ofs
 = ofs + #symexport

393 
o
.
£ù
[1].
ofs
 = 
	`f32
(
ffi
.
	`off£tof
(o, "space") + ofs)

395 -- 
Wr™e
 
PE
 
objeù
 
fe
.

396 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

397 
å
:
	`wr™e
(
ffi
.
	`¡ršg
(
o
, ffi.(o)-4096+
ofs
))

398 
	`bc§ve_
(
å
, 
ouut
, 
s
)

399 
’d


401 
loÿl
 
funùiÚ
 
	`bc§ve_machobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

402 
ffi
.
cdef
[[

405 
ušt32_t
 
magic
, 
ıuty³
, 
ıusubty³
, 
f‘y³
, 
ncmds
, 
sizeofcmds
, 
æags
;

406 } 
mach_h—d”
;

409 
mach_h—d”
; 
ušt32_t
 
»£rved
;

410 } 
mach_h—d”_64
;

412 
ušt32_t
 
cmd
, 
cmdsize
;

413 
£gÇme
[16];

414 
ušt32_t
 
vmaddr
, 
vmsize
, 
feoff
, 
fesize
;

415 
ušt32_t
 
max´Ù
, 
š™´Ù
, 
n£ùs
, 
æags
;

416 } 
	tmach_£gm’t_commªd
;

418 
ušt32_t
 
cmd
, 
cmdsize
;

419 
£gÇme
[16];

420 
ušt64_t
 
vmaddr
, 
vmsize
, 
feoff
, 
fesize
;

421 
ušt32_t
 
max´Ù
, 
š™´Ù
, 
n£ùs
, 
æags
;

422 } 
	tmach_£gm’t_commªd_64
;

424 
£ùÇme
[16], 
£gÇme
[16];

425 
ušt32_t
 
addr
, 
size
;

426 
ušt32_t
 
off£t
, 
®ign
, 
»loff
, 
Ä–oc
, 
æags
;

427 
ušt32_t
 
»£rved1
, 
»£rved2
;

428 } 
	tmach_£ùiÚ
;

430 
£ùÇme
[16], 
£gÇme
[16];

431 
ušt64_t
 
addr
, 
size
;

432 
ušt32_t
 
off£t
, 
®ign
, 
»loff
, 
Ä–oc
, 
æags
;

433 
ušt32_t
 
»£rved1
, 
»£rved2
, 
»£rved3
;

434 } 
	tmach_£ùiÚ_64
;

436 
ušt32_t
 
cmd
, 
cmdsize
, 
symoff
, 
nsyms
, 
¡roff
, 
¡rsize
;

437 } 
	tmach_symb_commªd
;

439 
št32_t
 
¡rx
;

440 
ušt8_t
 
ty³
, 
£ù
;

441 
št16_t
 
desc
;

442 
ušt32_t
 
v®ue
;

443 } 
	tmach_Æi¡
;

445 
ušt32_t
 
¡rx
;

446 
ušt8_t
 
ty³
, 
£ù
;

447 
ušt16_t
 
desc
;

448 
ušt64_t
 
v®ue
;

449 } 
	tmach_Æi¡_64
;

452 
ušt32_t
 
magic
, 
nçt_¬ch
;

453 } 
	tmach_çt_h—d”
;

456 
ušt32_t
 
ıuty³
, 
ıusubty³
, 
off£t
, 
size
, 
®ign
;

457 } 
	tmach_çt_¬ch
;

460 
mach_h—d”
 
hdr
;

461 
mach_£gm’t_commªd
 
£g
;

462 
mach_£ùiÚ
 
£c
;

463 
mach_symb_commªd
 
sym
;

464 } 
¬ch
[1];

465 
mach_Æi¡
 
sym_’Œy
;

466 
ušt8_t
 
¥aû
[4096];

467 } 
	tmach_obj
;

470 
mach_h—d”_64
 
hdr
;

471 
mach_£gm’t_commªd_64
 
£g
;

472 
mach_£ùiÚ_64
 
£c
;

473 
mach_symb_commªd
 
sym
;

474 } 
¬ch
[1];

475 
mach_Æi¡_64
 
sym_’Œy
;

476 
ušt8_t
 
¥aû
[4096];

477 } 
	tmach_obj_64
;

479 
mach_çt_h—d”
 
çt
;

480 
mach_çt_¬ch
 
çt_¬ch
[2];

482 
mach_h—d”
 
hdr
;

483 
mach_£gm’t_commªd
 
£g
;

484 
mach_£ùiÚ
 
£c
;

485 
mach_symb_commªd
 
sym
;

486 } 
¬ch
[2];

487 
mach_Æi¡
 
sym_’Œy
;

488 
ušt8_t
 
¥aû
[4096];

489 } 
	tmach_çt_obj
;

491 
loÿl
 
symÇme
 = '_'..
LJBC_PREFIX
..
ùx
.
modÇme


492 
loÿl
 
isçt
, 
is64
, 
®ign
, 
mobj
 = 
çl£
, false, 4, "mach_obj"

493 
ùx
.
¬ch
 =ğ"x64" 
th’


494 
is64
, 
®ign
, 
mobj
 = 
Œue
, 8, "mach_obj_64"

495 
–£if
 
ùx
.
¬ch
 =ğ"¬m" 
th’


496 
isçt
, 
mobj
 = 
Œue
, "mach_fat_obj"

497 
–£if
 
ùx
.
¬ch
 =ğ"¬m64" 
th’


498 
is64
, 
®ign
, 
isçt
, 
mobj
 = 
Œue
, 8,rue, "mach_fat_obj"

500 
	`check
(
ùx
.
¬ch
 == "x86", "unsupported‡rchitecture for OSX")

501 
’d


502 
loÿl
 
funùiÚ
 
	`®igÃd
(
v
, 
a
è 
b™
.
	`bªd
(v+a-1, -aè
’d


503 
loÿl
 
be32
 = 
b™
.
bsw­
 -- 
Mach
-
O
 
FAT
 
is
 
BE
, 
suµÜ‹d
 
¬chs
 
¬e
 
LE
.

505 -- 
C»©e
 
Mach
-
O
 
objeù
 
ªd
 
fl
 
š
 
h—d”
.

506 
loÿl
 
o
 = 
ffi
.
	`Ãw
(
mobj
)

507 
loÿl
 
mach_size
 = 
	`®igÃd
(
ffi
.
	`off£tof
(
o
, "¥aû")+#symÇme+2, 
®ign
)

508 
loÿl
 
ıuty³
 = ({ 
x86
={7}, 
x64
={0x01000007}, 
¬m
={7,12}, 
¬m64
={0x01000007,0x0100000c} })[
ùx
.
¬ch
]

509 
loÿl
 
ıusubty³
 = ({ 
x86
={3}, 
x64
={3}, 
¬m
={3,9}, 
¬m64
={3,0} })[
ùx
.
¬ch
]

510 
isçt
 
th’


511 
o
.
çt
.
magic
 = 
	`be32
(0xcafebabe)

512 
o
.
çt
.
nçt_¬ch
 = 
	`be32
(#cpusubtype)

513 
’d


515 -- 
Fl
 
š
 
£ùiÚs
 
ªd
 
symbŞs
.

516 
i
=0,#cpusubtype-1 do

517 
loÿl
 
ofs
 = 0

518 
isçt
 
th’


519 
loÿl
 
a
 = 
o
.
çt_¬ch
[
i
]

520 
a
.
ıuty³
 = 
	`be32
(ıuty³[
i
+1])

521 
a
.
ıusubty³
 = 
	`be32
(ıusubty³[
i
+1])

522 -- 
Sub£qu’t
 
¦iûs
 
ov”Ïp
 
—ch
 
Ùh”
 
to
 
sh¬e
 
d©a
.

523 
ofs
 = 
ffi
.
	`off£tof
(
o
, "¬ch"è+ 
i
*ffi.(o.
¬ch
[0])

524 
a
.
off£t
 = 
	`be32
(
ofs
)

525 
a
.
size
 = 
	`be32
(
mach_size
-
ofs
+#s)

526 
’d


527 
loÿl
 
a
 = 
o
.
¬ch
[
i
]

528 
a
.
hdr
.
magic
 = 
is64
 
ªd
 0xãedçcà
Ü
 0xfeedface

529 
a
.
hdr
.
ıuty³
 = cputy³[
i
+1]

530 
a
.
hdr
.
ıusubty³
 = cpusubty³[
i
+1]

531 
a
.
hdr
.
f‘y³
 = 1

532 
a
.
hdr
.
ncmds
 = 2

533 
a
.
hdr
.
sizeofcmds
 = 
ffi
.×.
£g
)+ffi.×.
£c
)+ffi.×.
sym
)

534 
a
.
£g
.
cmd
 = 
is64
 
ªd
 0x19 
Ü
 0x1

535 
a
.
£g
.
cmdsize
 = 
ffi
.×.£g)+ffi.×.
£c
)

536 
a
.
£g
.
vmsize
 = #s

537 
a
.
£g
.
feoff
 = 
mach_size
-
ofs


538 
a
.
£g
.
fesize
 = #s

539 
a
.
£g
.
max´Ù
 = 1

540 
a
.
£g
.
š™´Ù
 = 1

541 
a
.
£g
.
n£ùs
 = 1

542 
ffi
.
	`cİy
(
a
.
£c
.
£ùÇme
, "__data")

543 
ffi
.
	`cİy
(
a
.
£c
.
£gÇme
, "__DATA")

544 
a
.
£c
.
size
 = #s

545 
a
.
£c
.
off£t
 = 
mach_size
-
ofs


546 
a
.
sym
.
cmd
 = 2

547 
a
.
sym
.
cmdsize
 = 
ffi
.(a.sym)

548 
a
.
sym
.
symoff
 = 
ffi
.
	`off£tof
(
o
, "sym_’Œy")-
ofs


549 
a
.
sym
.
nsyms
 = 1

550 
a
.
sym
.
¡roff
 = 
ffi
.
	`off£tof
(
o
, "sym_’Œy")+ffi.(o.
sym_’Œy
)-
ofs


551 
a
.
sym
.
¡rsize
 = 
	`®igÃd
(#symÇme+2, 
®ign
)

552 
’d


553 
o
.
sym_’Œy
.
ty³
 = 0xf

554 
o
.
sym_’Œy
.
£ù
 = 1

555 
o
.
sym_’Œy
.
¡rx
 = 1

556 
ffi
.
	`cİy
(
o
.
¥aû
+1, 
symÇme
)

558 -- 
Wr™e
 
Macho
-
O
 
objeù
 
fe
.

559 
loÿl
 
å
 = 
	`§vefe
(
ouut
, "wb")

560 
å
:
	`wr™e
(
ffi
.
	`¡ršg
(
o
, 
mach_size
))

561 
	`bc§ve_
(
å
, 
ouut
, 
s
)

562 
’d


564 
loÿl
 
funùiÚ
 
	`bc§ve_obj
(
ùx
, 
ouut
, 
s
)

565 
loÿl
 
ok
, 
ffi
 = 
	`pÿÎ
(
»quœe
, "ffi")

566 
	`check
(
ok
, "FFI†ibrary„equiredo writehis fileype")

567 
ùx
.
os
 =ğ"wšdows" 
th’


568  
	`bc§ve_³obj
(
ùx
, 
ouut
, 
s
, 
ffi
)

569 
–£if
 
ùx
.
os
 =ğ"osx" 
th’


570  
	`bc§ve_machobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

572  
	`bc§ve_–fobj
(
ùx
, 
ouut
, 
s
, 
ffi
)

573 
’d


574 
’d


578 
loÿl
 
funùiÚ
 
	`bşi¡
(
šput
, 
ouut
)

579 
loÿl
 
f
 = 
	`»adfe
(
šput
)

580 
	`»quœe
("j™.bc").
	`dump
(
f
, 
	`§vefe
(
ouut
, "w"), 
Œue
)

581 
’d


583 
loÿl
 
funùiÚ
 
	`bc§ve
(
ùx
, 
šput
, 
ouut
)

584 
loÿl
 
f
 = 
	`»adfe
(
šput
)

585 
loÿl
 
s
 = 
¡ršg
.
	`dump
(
f
, 
ùx
.
¡r
)

586 
loÿl
 
t
 = 
ùx
.
ty³


587 
nÙ
 
t
 
th’


588 
t
 = 
	`d‘eùty³
(
ouut
)

589 
ùx
.
ty³
 = 
t


590 
’d


591 
t
 =ğ"¿w" 
th’


592 
	`bc§ve_¿w
(
ouut
, 
s
)

594 
nÙ
 
ùx
.
modÇme
 
th’
 ctx.modÇmğ
	`d‘eùmodÇme
(
šput
è
’d


595 
t
 =ğ"obj" 
th’


596 
	`bc§ve_obj
(
ùx
, 
ouut
, 
s
)

598 
	`bc§ve_c
(
ùx
, 
ouut
, 
s
)

599 
’d


600 
’d


601 
’d


603 
loÿl
 
funùiÚ
 
	`docmd
(...)

604 
loÿl
 
¬g
 = {...}

605 
loÿl
 
n
 = 1

606 
loÿl
 
li¡
 = 
çl£


607 
loÿl
 
ùx
 = {

608 
¡r
 = 
Œue
, 
¬ch
 = 
j™
.¬ch, 
os
 = 
¡ršg
.
	`low”
(jit.os),

609 
ty³
 = 
çl£
, 
modÇme
 = false,

611 
n
 <= #arg do

612 
loÿl
 
a
 = 
¬g
[
n
]

613 
	`ty³
(
a
è=ğ"¡ršg" 
ªd
 
¡ršg
.
	`sub
×, 1, 1è=ğ"-"‡nd‡ ~ğ"-" 
th’


614 
bË
.
	`»move
(
¬g
, 
n
)

615 
a
 =ğ"--" 
th’
  
’d


616 
m
=2,#a do

617 
loÿl
 
İt
 = 
¡ršg
.
	`sub
(
a
, 
m
, m)

618 
İt
 =ğ"l" 
th’


619 
li¡
 = 
Œue


620 
–£if
 
İt
 =ğ"s" 
th’


621 
ùx
.
¡r
 = 
Œue


622 
–£if
 
İt
 =ğ"g" 
th’


623 
ùx
.
¡r
 = 
çl£


625 
¬g
[
n
] =ğ
n
 
Ü
 
m
 ~ğ#¨
th’
 
	`u§ge
(è
’d


626 
İt
 =ğ"e" 
th’


627 
n
 ~ğ1 
th’
 
	`u§ge
(è
’d


628 
¬g
[1] = 
	`check
(
	`lßd¡ršg
(arg[1]))

629 
–£if
 
İt
 =ğ"n" 
th’


630 
ùx
.
modÇme
 = 
	`checkmodÇme
(
bË
.
	`»move
(
¬g
, 
n
))

631 
–£if
 
İt
 =ğ"t" 
th’


632 
ùx
.
ty³
 = 
	`check¬g
(
bË
.
	`»move
(
¬g
, 
n
), 
m­_ty³
, "fileype")

633 
–£if
 
İt
 =ğ"a" 
th’


634 
ùx
.
¬ch
 = 
	`check¬g
(
bË
.
	`»move
(
¬g
, 
n
), 
m­_¬ch
, "architecture")

635 
–£if
 
İt
 =ğ"o" 
th’


636 
ùx
.
os
 = 
	`check¬g
(
bË
.
	`»move
(
¬g
, 
n
), 
m­_os
, "OS‚ame")

638 
	`u§ge
()

639 
’d


640 
’d


641 
’d


643 
n
 =‚ + 1

644 
’d


645 
’d


646 
li¡
 
th’


647 #¬g =ğ0 
Ü
 #¬g > 2 
th’
 
	`u§ge
(è
’d


648 
	`bşi¡
(
¬g
[1],‡rg[2] 
Ü
 "-")

650 #¬g ~ğ2 
th’
 
	`u§ge
(è
’d


651 
	`bc§ve
(
ùx
, 
¬g
[1],‡rg[2])

652 
’d


653 
’d


657 -- 
Public
 
moduË
 
funùiÚs
.

659 
¡¬t
 = 
docmd
 -- 
Proûss
 -
b
 
commªd
 
lše
 
İtiÚ
.

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_arm.lua

2 -- 
LuaJIT
 
ARM
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
It
 
di§s£mbËs
 
mo¡
 
	gu£r
-
mode
 
ARMv7
 
	gš¡ruùiÚs


10 -- 
	gNYI
: 
Advªûd
 
SIMD
 
ªd
 
VFP
 
š¡ruùiÚs
.

13 
loÿl
 
ty³
 =ype

14 
loÿl
 
sub
, 
	gby‹
, 
	gfÜm©
 = 
¡ršg
.sub, 
	g¡ršg
.by‹, sŒšg.
fÜm©


15 
loÿl
 
	gm©ch
, 
	ggm©ch
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.
gm©ch


16 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


17 
loÿl
 
b™
 = 
»quœe
("bit")

18 
loÿl
 
bªd
, 
	gbÜ
, 
	grÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.rÜ, b™.
tohex


19 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshift, bit.arshift

22 -- 
Opcode
 
	gm­s


25 
loÿl
 
	gm­_lßdc
 = {

26 
shiá
 = 8, 
	gmask
 = 15,

28 
shiá
 = 20, 
	gmask
 = 1,

30 
shiá
 = 23, 
	gmask
 = 3,

32 
	g_
 = {

33 
shiá
 = 21, 
	gmask
 = 1,

35 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpushFdr", 
	g_
 = "vstmdbFNdr", }

39 
	gshiá
 = 23, 
	gmask
 = 3,

41 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpİFdr", 
	g_
 = "vldmFNdr", },

42 
	g_
 = {

43 
shiá
 = 21, 
	gmask
 = 1,

49 
shiá
 = 20, 
	gmask
 = 1,

51 
shiá
 = 23, 
	gmask
 = 3,

53 
	g_
 = {

54 
shiá
 = 21, 
	gmask
 = 1,

56 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpushGdr", 
	g_
 = "vstmdbGNdr", }

60 
	gshiá
 = 23, 
	gmask
 = 3,

62 { 
	gshiá
 = 16, 
	gmask
 = 15, [13] = "vpİGdr", 
	g_
 = "vldmGNdr", },

63 
	g_
 = {

64 
shiá
 = 21, 
	gmask
 = 1,

69 
	g_
 = {

70 
shiá
 = 0, 
	gmask
 = 0 -- 
NYI
 
ldc
, 
	gmür
, 
	gm¼c
.

74 
loÿl
 
	gm­_vås
 = {

75 
shiá
 = 6, 
	gmask
 = 0x2c001,

85 
shiá
 = 7, 
	gmask
 = 0x1e01,

97 
loÿl
 
	gm­_våd
 = {

98 
shiá
 = 6, 
	gmask
 = 0x2c001,

108 
shiá
 = 7, 
	gmask
 = 0x1e01,

120 
loÿl
 
	gm­_d©ac
 = {

121 
shiá
 = 24, 
	gmask
 = 1,

123 
shiá
 = 4, 
	gmask
 = 1,

125 
shiá
 = 8, 
	gmask
 = 15,

126 [10] = 
m­_vås
,

127 [11] = 
m­_våd
,

128 -- 
NYI
 
	gcdp
, 
	gmü
, 
	gmrc
.

131 
	gshiá
 = 8, 
	gmask
 = 15,

133 
shiá
 = 20, 
	gmask
 = 15,

136 [15] = { 
shiá
 = 12, 
	gmask
 = 15, [15] = "vmrs", 
	g_
 = "vmrsD", },

143 
loÿl
 
	gm­_lßdcu
 = {

144 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
uncÚd™iÚ®
 
CP
 
	glßd
/
	g¡Üe
.

147 
loÿl
 
	gm­_d©acu
 = {

148 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
uncÚd™iÚ®
 
CP
 
	gd©a
.

151 
loÿl
 
	gm­_simdd©a
 = {

152 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
SIMD
 
	gd©a
.

155 
loÿl
 
	gm­_simdlßd
 = {

156 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
SIMD
 
	glßd
/
	g¡Üe
, 
	g´–ßd
.

159 
loÿl
 
	gm­_´–ßd
 = {

160 
shiá
 = 0, 
	gmask
 = 0, -- 
NYI
 
	g´–ßd
.

163 
loÿl
 
	gm­_medŸ
 = {

164 
shiá
 = 20, 
	gmask
 = 31,

165 [0] = 
çl£
,

167 
	gshiá
 = 5, 
	gmask
 = 7,

169 "§dd8DNM", 
	gçl£
, false, "ssub8DNM",

172 
	gshiá
 = 5, 
	gmask
 = 7,

174 "qadd8DNM", 
	gçl£
, false, "qsub8DNM",

177 
	gshiá
 = 5, 
	gmask
 = 7,

179 "shadd8DNM", 
	gçl£
, false, "shsub8DNM",

181 
	gçl£
,

183 
	gshiá
 = 5, 
	gmask
 = 7,

185 "uadd8DNM", 
	gçl£
, false, "usub8DNM",

188 
	gshiá
 = 5, 
	gmask
 = 7,

190 "uqadd8DNM", 
	gçl£
, false, "uqsub8DNM",

193 
	gshiá
 = 5, 
	gmask
 = 7,

195 "uhadd8DNM", 
	gçl£
, false, "uhsub8DNM",

198 
	gshiá
 = 5, 
	gmask
 = 7,

199 [0] = "pkhbtDNMU", 
	gçl£
, "pkhtbDNMU",

200 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "sxtb16DMU", 
	g_
 = "sxtab16DNMU", },

203 
	gçl£
,

205 
	gshiá
 = 5, 
	gmask
 = 7,

207 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "sxtbDMU", 
	g_
 = "sxtabDNMU", },

208 "s§tDxMu", 
	gçl£
, "ssatDxMu",

211 
	gshiá
 = 5, 
	gmask
 = 7,

213 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "sxthDMU", 
	g_
 = "sxtahDNMU", },

217 
	gshiá
 = 5, 
	gmask
 = 7,

218 [3] = { 
shiá
 = 16, 
	gmask
 = 15, [15] = "uxtb16DMU", 
	g_
 = "uxtab16DNMU", },

220 
	gçl£
,

222 
	gshiá
 = 5, 
	gmask
 = 7,

224 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "uxtbDMU", 
	g_
 = "uxtabDNMU", },

225 "u§tDwMu", 
	gçl£
, "usatDwMu",

228 
	gshiá
 = 5, 
	gmask
 = 7,

230 { 
	gshiá
 = 16, 
	gmask
 = 15, [15] = "uxthDMU", 
	g_
 = "uxtahDNMU", },

234 
	gshiá
 = 12, 
	gmask
 = 15,

236 
shiá
 = 5, 
	gmask
 = 7,

239 
	g_
 = {

240 
shiá
 = 5, 
	gmask
 = 7,

244 
	gçl£
, false, false,

246 
	gshiá
 = 5, 
	gmask
 = 7,

250 
	gshiá
 = 5, 
	gmask
 = 7,

251 [0] = { 
shiá
 = 12, 
	gmask
 = 15, [15] = "smmulNMS", 
	g_
 = "smmlaNMSD", },

252 { 
	gshiá
 = 12, 
	gmask
 = 15, [15] = "smmuÌNMS", 
	g_
 = "smmlarNMSD", },

253 
	gçl£
, false, false, false,

256 
	gçl£
, false,

258 
	gshiá
 = 5, 
	gmask
 = 7,

259 [0] = { 
shiá
 = 12, 
	gmask
 = 15, [15] = "u§d8NMS", 
	g_
 = "usada8NMSD", },

261 
	gçl£
,

263 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "sbfxDMvw",

266 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "sbfxDMvw",

269 
	gshiá
 = 5, 
	gmask
 = 3,

270 [0] = { 
shiá
 = 0, 
	gmask
 = 15, [15] = "bfcDvX", 
	g_
 = "bfiDMvX", },

273 
	gshiá
 = 5, 
	gmask
 = 3,

274 [0] = { 
shiá
 = 0, 
	gmask
 = 15, [15] = "bfcDvX", 
	g_
 = "bfiDMvX", },

277 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "ubfxDMvw",

280 
	gshiá
 = 5, 
	gmask
 = 3, [2] = "ubfxDMvw",

284 
loÿl
 
	gm­_lßd
 = {

285 
shiá
 = 21, 
	gmask
 = 9,

287 
	gshiá
 = 20, 
	gmask
 = 5,

290 
	g_
 = {

291 
shiá
 = 20, 
	gmask
 = 5,

296 
loÿl
 
	gm­_lßd1
 = {

297 
shiá
 = 4, 
	gmask
 = 1,

298 [0] = 
m­_lßd
, 
	gm­_medŸ
,

301 
loÿl
 
	gm­_lßdm
 = {

302 
shiá
 = 20, 
	gmask
 = 1,

304 
shiá
 = 23, 
	gmask
 = 3,

306 { 
	gshiá
 = 16, 
	gmask
 = 63, [45] = "pushR", 
	g_
 = "stmdbNR", }, "stmibNR",

309 
	gshiá
 = 23, 
	gmask
 = 3,

310 [0] = "ldmdaNR", { 
	gshiá
 = 16, 
	gmask
 = 63, [61] = "pİR", 
	g_
 = "ldmNR", },

315 
loÿl
 
	gm­_d©a
 = {

316 
shiá
 = 21, 
	gmask
 = 15,

323 
loÿl
 
	gm­_mul
 = {

324 
shiá
 = 21, 
	gmask
 = 7,

329 
loÿl
 
	gm­_sync
 = {

330 
shiá
 = 20, 
	gmask
 = 15, -- 
	gNYI
: 
b¿ck‘s
 
¬ound
 
N
. 
R
(
D
+1è
ld»xd
/
¡»xd
.

331 [0] = "swpDMN", 
	gçl£
, false, false,

332 "swpbDMN", 
	gçl£
, false, false,

337 
loÿl
 
	gm­_mulh
 = {

338 
shiá
 = 21, 
	gmask
 = 3,

339 [0] = { 
shiá
 = 5, 
	gmask
 = 3,

341 { 
	gshiá
 = 5, 
	gmask
 = 3,

343 { 
	gshiá
 = 5, 
	gmask
 = 3,

345 { 
	gshiá
 = 5, 
	gmask
 = 3,

349 
loÿl
 
	gm­_misc
 = {

350 
shiá
 = 4, 
	gmask
 = 7,

351 -- 
	gNYI
: 
decode
 
PSR
 
b™s
 
of
 
m¤
.

352 [0] = { 
shiá
 = 21, 
	gmask
 = 1, [0] = "mrsD", "msrM", },

353 { 
	gshiá
 = 21, 
	gmask
 = 3, "bxM", 
	gçl£
, "clzDM", },

354 { 
	gshiá
 = 21, 
	gmask
 = 3, "bxjM", },

355 { 
	gshiá
 = 21, 
	gmask
 = 3, "blxM", },

356 
	gçl£
,

357 { 
	gshiá
 = 21, 
	gmask
 = 3, [0] = "qaddDMN", "qsubDMN", "qdaddDMN", "qdsubDMN", },

358 
	gçl£
,

359 { 
	gshiá
 = 21, 
	gmask
 = 3, "bkptK", },

362 
loÿl
 
	gm­_d©¬
 = {

363 
shiá
 = 4, 
	gmask
 = 9,

365 
shiá
 = 5, 
	gmask
 = 3,

366 [0] = { 
shiá
 = 24, 
	gmask
 = 1, [0] = 
m­_mul
, 
	gm­_sync
, },

367 { 
	gshiá
 = 20, 
	gmask
 = 1, [0] = "strhDL", "ldrhDL", },

368 { 
	gshiá
 = 20, 
	gmask
 = 1, [0] = "ldrdDL", "ldrsbDL", },

369 { 
	gshiá
 = 20, 
	gmask
 = 1, [0] = "strdDL", "ldrshDL", },

371 
	g_
 = {

372 
shiá
 = 20, 
	gmask
 = 25,

373 [16] = { 
shiá
 = 7, 
	gmask
 = 1, [0] = 
m­_misc
, 
	gm­_mulh
, },

374 
	g_
 = {

375 
shiá
 = 0, 
	gmask
 = 0xffffffff,

376 [
bÜ
(0xe1a00000)] = "nop",

377 
	g_
 = 
m­_d©a
,

382 
loÿl
 
	gm­_d©ai
 = {

383 
shiá
 = 20, 
	gmask
 = 31, -- 
	gNYI
: 
decode
 
PSR
 
b™s
 
of
 
m¤
. 
Decode
 
imm12
.

385 [18] = { 
shiá
 = 0, 
	gmask
 = 0xf00ff, [0] = "nİv6", 
	g_
 = "msrNW", },

387 
	g_
 = 
m­_d©a
,

390 
loÿl
 
	gm­_b¿nch
 = {

391 
shiá
 = 24, 
	gmask
 = 1,

395 
loÿl
 
	gm­_cÚdšs
 = {

396 [0] = 
m­_d©¬
, 
	gm­_d©ai
, 
	gm­_lßd
, 
	gm­_lßd1
,

397 
	gm­_lßdm
, 
	gm­_b¿nch
, 
	gm­_lßdc
, 
	gm­_d©ac


400 -- 
	gNYI
: 
£‹nd
.

401 
loÿl
 
m­_uncÚdšs
 = {

402 [0] = 
çl£
, 
	gm­_simdd©a
, 
	gm­_simdlßd
, 
	gm­_´–ßd
,

403 
	gçl£
, "blxB", 
	gm­_lßdcu
, 
	gm­_d©acu
,

408 
loÿl
 
	gm­_g´
 = {

413 
loÿl
 
	gm­_cÚd
 = {

418 
loÿl
 
	gm­_shiá
 = { [0] = "lsl", "lsr", "asr", "ror", }

422 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

423 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

424 
loÿl
 
pos
 = 
ùx
.pos

425 
loÿl
 
exŒa
 = ""

426 
ùx
.
»l
 
th’


427 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

428 
sym
 
th’


429 
exŒa
 = "\t->"..
sym


430 
–£if
 
	`bªd
(
ùx
.
İ
, 0x0e000000è~ğ0x0a000000 
th’


431 
exŒa
 = "\t; 0x"..
	$tohex
(
ùx
.
»l
)

432 
’d


433 
’d


434 
ùx
.
hexdump
 > 0 
th’


435 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-5s %s%s\n",

436 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

438 
ùx
.
	`out
(
	`fÜm©
("%08x %-5s %s%s\n",

439 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

440 
’d


441 
ùx
.
pos
 =…os + 4

442 
’d


444 -- 
F®lback
 
unknown
 
İcodes
.

445 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

446  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

447 
	g’d


449 -- 
FÜm©
 
	gİ”ªd
 2 
of
 
	glßd
/
¡Üe
 
	gİcodes
.

450 
loÿl
 
funùiÚ
 
	$fmßd
(
ùx
, 
İ
, 
pos
)

451 
loÿl
 
ba£
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 15)]

452 
loÿl
 
x
, 
ofs


453 
loÿl
 
ext
 = (
	`bªd
(
İ
, 0x04000000) == 0)

454 
nÙ
 
ext
 
ªd
 
	`bªd
(
İ
, 0x02000000è=ğ0 
th’


455 
ofs
 = 
	$bªd
(
İ
, 4095)

456 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = -of 
’d


457 
ba£
 =ğ"pc" 
th’
 
ùx
.
»l
 = ctx.
addr
 + 
pos
 + 8 + 
ofs
 
’d


458 
ofs
 = "#"..ofs

459 
–£if
 
ext
 
ªd
 
	`bªd
(
İ
, 0x00400000è~ğ0 
th’


460 
ofs
 = 
	`bªd
(
İ
, 15è+ bªd(
	`rshiá
(op, 4), 0xf0)

461 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = -of 
’d


462 
ba£
 =ğ"pc" 
th’
 
ùx
.
»l
 = ctx.
addr
 + 
pos
 + 8 + 
ofs
 
’d


463 
ofs
 = "#"..ofs

465 
ofs
 = 
m­_g´
[
	`bªd
(
İ
, 15)]

466 
ext
 
Ü
 
	`bªd
(
İ
, 0xã0è=ğ0 
th’


467 
–£if
 
	`bªd
(
İ
, 0xã0è=ğ0x60 
th’


468 
ofs
 = 
	`fÜm©
("%s,„rx", ofs)

470 
loÿl
 
sh
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

471 
sh
 =ğ0 
th’
 sh = 32 
’d


472 
ofs
 = 
	`fÜm©
("%s, % #%d", ofs, 
m­_shiá
[
	`bªd
(
	`rshiá
(
İ
, 5), 3)], 
sh
)

473 
’d


474 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = "-"..of 
’d


475 
’d


476 
ofs
 =ğ"#0" 
th’


477 
x
 = 
	`fÜm©
("[%s]", 
ba£
)

478 
–£if
 
	`bªd
(
İ
, 0x01000000è=ğ0 
th’


479 
x
 = 
	`fÜm©
("[%s], %s", 
ba£
, 
ofs
)

481 
x
 = 
	`fÜm©
("[%s, %s]", 
ba£
, 
ofs
)

482 
’d


483 
	`bªd
(
İ
, 0x01200000è=ğ0x01200000 
th’
 
x
 = x.."!" 
’d


484  
x


485 
’d


487 -- 
FÜm©
 
İ”ªd
 2 
of
 
veùÜ
 
lßd
/
¡Üe
 
İcodes
.

488 
loÿl
 
funùiÚ
 
	$fmtvlßd
(
ùx
, 
İ
, 
pos
)

489 
loÿl
 
ba£
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 15)]

490 
loÿl
 
ofs
 = 
	`bªd
(
İ
, 255)*4

491 
	`bªd
(
İ
, 0x00800000è=ğ0 
th’
 
ofs
 = -of 
’d


492 
ba£
 =ğ"pc" 
th’
 
ùx
.
»l
 = ctx.
addr
 + 
pos
 + 8 + 
ofs
 
’d


493 
ofs
 =ğ0 
th’


494  
	`fÜm©
("[%s]", 
ba£
)

496  
	`fÜm©
("[%s, #%d]", 
ba£
, 
ofs
)

497 
’d


498 
’d


500 
loÿl
 
funùiÚ
 
	$fmtvr
(
İ
, 
vr
, 
sh0
, 
sh1
)

501 
vr
 =ğ"s" 
th’


502  
	`fÜm©
("s%d", 2*
	`bªd
(
	`rshiá
(
İ
, 
sh0
), 15)+bªdÔshiá(İ, 
sh1
), 1))

504  
	`fÜm©
("d%d", 
	`bªd
(
	`rshiá
(
İ
, 
sh0
), 15)+bªdÔshiá(İ, 
sh1
-4), 16))

505 
’d


506 
’d


508 -- 
Di§s£mbË
 
a
 
sšgË
 
š¡ruùiÚ
.

509 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

510 
loÿl
 
pos
 = 
ùx
.pos

511 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

512 
loÿl
 
İ
 = 
	`bÜ
(
	`lshiá
(
b3
, 24),†shiá(
b2
, 16),†shiá(
b1
, 8), 
b0
)

513 
loÿl
 
İ”ªds
 = {
	}
}

514 
loÿl
 
suffix
 = ""

515 
loÿl
 
Ï¡
, 
	gÇme
, 
·t


516 
loÿl
 
vr


517 
	gùx
.
	gİ
 = 
İ


518 
ùx
.
»l
 = 
n


520 
loÿl
 
cÚd
 = 
	$rshiá
(
İ
, 28)

521 
loÿl
 
İ©


522 
cÚd
 =ğ15 
th’


523 
İ©
 = 
m­_uncÚdšs
[
	`bªd
(
	`rshiá
(
İ
, 25), 7)]

525 
cÚd
 ~ğ14 
th’
 
suffix
 = 
m­_cÚd
[cÚd] 
’d


526 
İ©
 = 
m­_cÚdšs
[
	`bªd
(
	`rshiá
(
İ
, 25), 7)]

527 
’d


528 
	`ty³
(
İ©
) ~= "string" do

529 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


530 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)] 
Ü
 o·t.
_


531 
’d


532 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9]*)(.*)")

533 
	`sub
(
·t
, 1, 1è=ğ"." 
th’


534 
loÿl
 
s2
, 
p2
 = 
	`m©ch
(
·t
, "^([a-z0-9.]*)(.*)")

535 
suffix
 = suffix..
s2


536 
·t
 = 
p2


537 
’d


539 
p
 
š
 
	`gm©ch
(
·t
, ".") do

540 
loÿl
 
x
 = 
n


541 
p
 =ğ"D" 
th’


542 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 12), 15)]

543 
–£if
 
p
 =ğ"N" 
th’


544 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 15)]

545 
–£if
 
p
 =ğ"S" 
th’


546 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 8), 15)]

547 
–£if
 
p
 =ğ"M" 
th’


548 
x
 = 
m­_g´
[
	`bªd
(
İ
, 15)]

549 
–£if
 
p
 =ğ"d" 
th’


550 
x
 = 
	$fmtvr
(
İ
, 
vr
, 12, 22)

551 
–£if
 
p
 =ğ"n" 
th’


552 
x
 = 
	$fmtvr
(
İ
, 
vr
, 16, 7)

553 
–£if
 
p
 =ğ"m" 
th’


554 
x
 = 
	$fmtvr
(
İ
, 
vr
, 0, 5)

555 
–£if
 
p
 =ğ"P" 
th’


556 
	`bªd
(
İ
, 0x02000000è~ğ0 
th’


557 
x
 = 
	`rÜ
(
	`bªd
(
İ
, 255), 2*bªd(
	`rshiá
(op, 8), 15))

559 
x
 = 
m­_g´
[
	`bªd
(
İ
, 15)]

560 
	`bªd
(
İ
, 0xff0è~ğ0 
th’


561 
İ”ªds
[#İ”ªds+1] = 
x


562 
loÿl
 
s
 = 
m­_shiá
[
	`bªd
(
	`rshiá
(
İ
, 5), 3)]

563 
loÿl
 
r
 = 
n


564 
	`bªd
(
İ
, 0xf90è=ğ0 
th’


565 
s
 =ğ"rÜ" 
th’
 s = "¼x" 
r
 = "#32" 
’d


566 
–£if
 
	`bªd
(
İ
, 0x10è=ğ0 
th’


567 
r
 = "#"..
	`bªd
(
	`rshiá
(
İ
, 7), 31)

569 
r
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 8), 15)]

570 
’d


571 
Çme
 =ğ"mov" 
th’
‚amğ
s
; 
x
 = 
r


572 
–£if
 
r
 
th’
 
x
 = 
	`fÜm©
("% %s", 
s
,„)

573 
x
 = 
s
 
’d


574 
’d


575 
’d


576 
–£if
 
p
 =ğ"L" 
th’


577 
x
 = 
	$fmßd
(
ùx
, 
İ
, 
pos
)

578 
–£if
 
p
 =ğ"l" 
th’


579 
x
 = 
	$fmtvlßd
(
ùx
, 
İ
, 
pos
)

580 
–£if
 
p
 =ğ"B" 
th’


581 
loÿl
 
addr
 = 
ùx
.add¸+ 
pos
 + 8 + 
	`¬shiá
(
	`lshiá
(
İ
, 8), 6)

582 
cÚd
 =ğ15 
th’
 
addr
 =‡dd¸+ 
	`bªd
(
	`rshiá
(
İ
, 23), 2è
’d


583 
ùx
.
»l
 = 
addr


584 
x
 = "0x"..
	$tohex
(
addr
)

585 
–£if
 
p
 =ğ"F" 
th’


586 
vr
 = "s"

587 
–£if
 
p
 =ğ"G" 
th’


588 
vr
 = "d"

589 
–£if
 
p
 =ğ"." 
th’


590 
suffix
 = suffix..(
vr
 =ğ"s" 
ªd
 ".f32" 
Ü
 ".f64")

591 
–£if
 
p
 =ğ"R" 
th’


592 
	`bªd
(
İ
, 0x00200000è~ğ0 
ªd
 #İ”ªd =ğ1 
th’


593 
İ”ªds
[1] = operands[1].."!"

594 
’d


595 
loÿl
 
t
 = {
	}
}

596 
i
=0,15 do

597 
bªd
(
rshiá
(
İ
, 
i
), 1è=ğ1 
th’
 
t
[#t+1] = 
m­_g´
[i] 
’d


598 
’d


599 
x
 = "{"..
cÚÿt
(
t
, ", ").."}"

600 
–£if
 
	gp
 =ğ"r" 
th’


601 
bªd
(
İ
, 0x00200000è~ğ0 
ªd
 #İ”ªd =ğ2 
th’


602 
İ”ªds
[1] = operands[1].."!"

603 
’d


604 
loÿl
 
s
 = 
tÚumb”
(
	$sub
(
Ï¡
, 2))

605 
loÿl
 
n
 = 
	$bªd
(
İ
, 255)

606 
vr
 =ğ"d" 
th’
 
n
 = 
	$rshiá
(
n
, 1è
’d


607 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("{%s-%s%d}", 
Ï¡
, 
vr
, 
s
+
n
-1)

608 
–£if
 
p
 =ğ"W" 
th’


609 
x
 = 
	`bªd
(
İ
, 0x0fffè+ bªd(
	`rshiá
(op, 4), 0xf000)

610 
–£if
 
p
 =ğ"T" 
th’


611 
x
 = "#0x"..
	`tohex
(
	`bªd
(
İ
, 0x00ffffff), 6)

612 
–£if
 
p
 =ğ"U" 
th’


613 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

614 
x
 =ğ0 
th’
 x = 
n
 
’d


615 
–£if
 
p
 =ğ"u" 
th’


616 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

617 
	`bªd
(
İ
, 0x40è=ğ0 
th’


618 
x
 =ğ0 
th’
 x = 
n
 x = "l¦ #"..x 
’d


620 
x
 =ğ0 
th’
 x = "a¤ #32" x = "a¤ #"..x 
’d


621 
’d


622 
–£if
 
p
 =ğ"v" 
th’


623 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 7), 31)

624 
–£if
 
p
 =ğ"w" 
th’


625 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

626 
–£if
 
p
 =ğ"x" 
th’


627 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31) + 1

628 
–£if
 
p
 =ğ"X" 
th’


629 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31è- 
Ï¡
 + 1

630 
–£if
 
p
 =ğ"Y" 
th’


631 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 12), 0xf0è+ 
	$bªd
(
İ
, 0x0f)

632 
–£if
 
p
 =ğ"K" 
th’


633 
x
 = "#0x"..
	`tohex
(
	`bªd
(
	`rshiá
(
İ
, 4), 0x0000fff0) + band(op, 15), 4)

634 
–£if
 
p
 =ğ"s" 
th’


635 
	`bªd
(
İ
, 0x00100000è~ğ0 
th’
 
suffix
 = "s"..suffix 
’d


637 
	$as£¹
(
çl£
)

638 
’d


639 
x
 
th’


640 
Ï¡
 = 
x


641 
	`ty³
(
x
è=ğ"numb”" 
th’
 x = "#"..x 
’d


642 
İ”ªds
[#İ”ªds+1] = 
x


643 
’d


644 
’d


646  
	$putİ
(
ùx
, 
Çme
..
suffix
, 
İ”ªds
)

647 
’d


651 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

652 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

653 
nÙ
 
ofs
 
th’
 of ğ0 
’d


654 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


655 
ùx
.
pos
 = 
ofs


656 
ùx
.
»l
 = 
n


657 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


658 
’d


660 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

661 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

662 
loÿl
 
ùx
 = {
	}
}

663 
ùx
.
code
 = code

664 
ùx
.
addr
 =‡dd¸
Ü
 0

665 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


666 
ùx
.
symb
 = {}

667 
ùx
.
di§ss
 = 
di§ss_block


668 
ùx
.
hexdump
 = 8

669  
ùx


670 
’d


672 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

673 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

674 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

675 
’d


677 -- 
R‘uº
 
Çme
 
RID
.

678 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

679 
r
 < 16 
th’
  
m­_g´
[r] 
’d


680  "d"..(
r
-16)

681 
’d


683 -- 
Public
 
moduË
 
funùiÚs
.

685 
ü—‹
 = create,

686 
di§ss
 = disass,

687 
»gÇme
 =„egname

688 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_arm64.lua

2 -- 
LuaJIT
 
ARM64
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
CÚŒibu‹d
 
by
 
DjÜdje
 
Kovaûvic
 
ªd
 
S‹çn
 
Pejic
 
äom
 
	gRT
-
	gRK
.
	gcom
.

8 -- 
SpÚsÜed
 
by
 
Cisco
 
	gSy¡ems
, 
	gInc
.

10 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

12 -- 
It
 
di§s£mbËs
 
mo¡
 
	gu£r
-
mode
 
AArch64
 
	gš¡ruùiÚs
.

13 -- 
	gNYI
: 
Advªûd
 
SIMD
 
ªd
 
VFP
 
š¡ruùiÚs
.

16 
loÿl
 
ty³
 =ype

17 
loÿl
 
sub
, 
	gby‹
, 
	gfÜm©
 = 
¡ršg
.sub, 
	g¡ršg
.by‹, sŒšg.
fÜm©


18 
loÿl
 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.gm©ch, sŒšg.
gsub


19 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


20 
loÿl
 
b™
 = 
»quœe
("bit")

21 
loÿl
 
bªd
, 
	gbÜ
, 
	gbxÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.bxÜ, b™.
tohex


22 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshiá, b™.
¬shiá


23 
loÿl
 
	grÜ
 = 
b™
.
rÜ


26 -- 
Opcode
 
m­s


29 
loÿl
 
m­_adr
 = { -- 
PC
-
»Ïtive
 
add»ssšg
.

30 
shiá
 = 31, 
	gmask
 = 1,

34 
loÿl
 
	gm­_addsubi
 = { -- 
Add
/
subŒaù
 
immedŸ‹
.

35 
shiá
 = 29, 
	gmask
 = 3,

39 
loÿl
 
	gm­_logi
 = { -- 
Logiÿl
 
immedŸ‹
.

40 
shiá
 = 31, 
	gmask
 = 1,

42 
shiá
 = 22, 
	gmask
 = 1,

44 
shiá
 = 29, 
	gmask
 = 3,

47 
	gçl£
 -- 
	guÇÎoÿ‹d


50 
	gshiá
 = 29, 
	gmask
 = 3,

55 
loÿl
 
	gm­_movwi
 = { -- 
Move
 
wide
 
immedŸ‹
.

56 
shiá
 = 31, 
	gmask
 = 1,

58 
shiá
 = 22, 
	gmask
 = 1,

60 
shiá
 = 29, 
	gmask
 = 3,

61 [0] = "movnDWRg", 
	gçl£
, "movz|movDYRg", "movkDWRg"

62 }, 
	gçl£
 -- 
	guÇÎoÿ‹d


65 
	gshiá
 = 29, 
	gmask
 = 3,

66 [0] = "movnDWRg", 
	gçl£
, "movz|movDYRg", "movkDWRg"

70 
loÿl
 
	gm­_b™f
 = { -- 
B™f›ld
.

71 
shiá
 = 31, 
	gmask
 = 1,

73 
shiá
 = 22, 
	gmask
 = 1,

75 
shiá
 = 29, 
	gmask
 = 3,

82 
	gshiá
 = 22, 
	gmask
 = 1,

84 
	gshiá
 = 29, 
	gmask
 = 3,

92 
loÿl
 
	gm­_d©ai
 = { -- 
D©a
 
´oûssšg
 - 
immedŸ‹
.

93 
shiá
 = 23, 
	gmask
 = 7,

94 [0] = 
m­_adr
, 
	gm­_adr
, 
	gm­_addsubi
, 
	gçl£
,

95 
	gm­_logi
, 
	gm­_movwi
, 
	gm­_b™f
,

97 
	gshiá
 = 15, 
	gmask
 = 0x1c0c1,

103 
loÿl
 
	gm­_log¤
 = { -- 
Logiÿl
, 
shiáed
 .

104 
shiá
 = 31, 
	gmask
 = 1,

106 
shiá
 = 15, 
	gmask
 = 1,

108 
shiá
 = 29, 
	gmask
 = 3,

110 
shiá
 = 21, 
	gmask
 = 7,

115 
	gshiá
 = 21, 
	gmask
 = 7,

120 
	gshiá
 = 21, 
	gmask
 = 7,

125 
	gshiá
 = 21, 
	gmask
 = 7,

130 
	gçl£
 -- 
	guÇÎoÿ‹d


133 
	gshiá
 = 29, 
	gmask
 = 3,

135 
shiá
 = 21, 
	gmask
 = 7,

140 
	gshiá
 = 21, 
	gmask
 = 7,

145 
	gshiá
 = 21, 
	gmask
 = 7,

150 
	gshiá
 = 21, 
	gmask
 = 7,

157 
loÿl
 
	gm­_assh
 = {

158 
shiá
 = 31, 
	gmask
 = 1,

160 
shiá
 = 15, 
	gmask
 = 1,

162 
shiá
 = 29, 
	gmask
 = 3,

164 
shiá
 = 22, 
	gmask
 = 3,

168 
	gshiá
 = 22, 
	gmask
 = 3,

173 
	gshiá
 = 22, 
	gmask
 = 3,

177 
	gshiá
 = 22, 
	gmask
 = 3,

182 
	gçl£
 -- 
	guÇÎoÿ‹d


185 
	gshiá
 = 29, 
	gmask
 = 3,

187 
shiá
 = 22, 
	gmask
 = 3,

191 
	gshiá
 = 22, 
	gmask
 = 3,

196 
	gshiá
 = 22, 
	gmask
 = 3,

200 
	gshiá
 = 22, 
	gmask
 = 3,

207 
loÿl
 
	gm­_addsubsh
 = { -- 
Add
/
subŒaù
, 
shiáed
 .

208 
shiá
 = 22, 
	gmask
 = 3,

209 [0] = 
m­_assh
, 
	gm­_assh
, map_assh

212 
loÿl
 
	gm­_addsubex
 = { -- 
Add
/
subŒaù
, 
ex‹nded
 .

213 
shiá
 = 22, 
	gmask
 = 3,

215 
shiá
 = 29, 
	gmask
 = 3,

220 
loÿl
 
	gm­_addsubc
 = { -- 
Add
/
subŒaù
, 
w™h
 
ÿ¼y
.

221 
shiá
 = 10, 
	gmask
 = 63,

223 
shiá
 = 29, 
	gmask
 = 3,

228 
loÿl
 
	gm­_ccomp
 = {

229 
shiá
 = 4, 
	gmask
 = 1,

231 
shiá
 = 10, 
	gmask
 = 3,

232 [0] = { -- 
CÚd™iÚ®
 
com·»
 .

233 
shiá
 = 29, 
	gmask
 = 3,

234 "ccmnNMVCg", 
	gçl£
, "ccmpNMVCg",

236 [2] = { -- 
CÚd™iÚ®
 
com·»
 
immedŸ‹
.

237 
shiá
 = 29, 
	gmask
 = 3,

238 "ccmnN5VCg", 
	gçl£
, "ccmpN5VCg",

243 
loÿl
 
	gm­_c£l
 = { -- 
CÚd™iÚ®
 
£Ëù
.

244 
shiá
 = 11, 
	gmask
 = 1,

246 
shiá
 = 10, 
	gmask
 = 1,

248 
shiá
 = 29, 
	gmask
 = 3,

249 [0] = "c£lDNMzCg", 
	gçl£
, "csinv|cinv|csetmDNMcg", false,

252 
	gshiá
 = 29, 
	gmask
 = 3,

253 [0] = "csšc|cšc|c£tDNMcg", 
	gçl£
, "csneg|cnegDNMcg", false,

258 
loÿl
 
	gm­_d©a1s
 = { -- 
D©a
 
´oûssšg
, 1 
sourû
.

259 
shiá
 = 29, 
	gmask
 = 1,

261 
shiá
 = 31, 
	gmask
 = 1,

263 
shiá
 = 10, 
	gmask
 = 0x7ff,

264 [0] = "rb™DNg", "»v16DNg", "»vDNw", 
	gçl£
, "clzDNg", "clsDNg"

267 
	gshiá
 = 10, 
	gmask
 = 0x7ff,

273 
loÿl
 
	gm­_d©a2s
 = { -- 
D©a
 
´oûssšg
, 2 
sourûs
.

274 
shiá
 = 29, 
	gmask
 = 1,

276 
shiá
 = 10, 
	gmask
 = 63,

277 
	gçl£
, "udivDNMg", "sdivDNMg", false, false, false, false, "lslDNMg",

282 
loÿl
 
	gm­_d©a3s
 = { -- 
D©a
 
´oûssšg
, 3 
sourûs
.

283 
shiá
 = 29, 
	gmask
 = 7,

285 
shiá
 = 21, 
	gmask
 = 7,

287 
shiá
 = 15, 
	gmask
 = 1,

290 }, 
	gçl£
, false, false,

292 
	gshiá
 = 15, 
	gmask
 = 1,

294 
shiá
 = 21, 
	gmask
 = 7,

295 [0] = "madd|mulDNMA0g", "smaddl|smuÎDxNMwA0x", "smulhDNMx", 
	gçl£
,

296 
	gçl£
, "umaddl|umullDxNMwA0x", "umulhDNMx"

299 
	gshiá
 = 21, 
	gmask
 = 7,

300 [0] = "msub|mÃgDNMA0g", "smsubl|smÃglDxNMwA0x", 
	gçl£
, false,

301 
	gçl£
, "umsubl|umneglDxNMwA0x"

306 
loÿl
 
	gm­_d©¬
 = { -- 
D©a
 
´oûssšg
, .

307 
shiá
 = 28, 
	gmask
 = 1,

309 
shiá
 = 24, 
	gmask
 = 1,

310 [0] = 
m­_log¤
,

312 
	gshiá
 = 21, 
	gmask
 = 1,

313 [0] = 
m­_addsubsh
, 
	gm­_addsubex


317 
	gshiá
 = 21, 
	gmask
 = 15,

318 [0] = 
m­_addsubc
, 
	gçl£
, 
	gm­_ccomp
, f®£, 
	gm­_c£l
, false,

320 
	gshiá
 = 30, 
	gmask
 = 1,

321 [0] = 
m­_d©a2s
, 
	gm­_d©a1s


323 
	gçl£
, 
	gm­_d©a3s
, map_data3s, map_data3s, map_data3s, map_data3s,

324 
	gm­_d©a3s
, map_data3s, map_data3s

328 
loÿl
 
	gm­_Ìl
 = { -- 
Lßd
 , 
l™”®
.

329 
shiá
 = 26, 
	gmask
 = 1,

331 
shiá
 = 30, 
	gmask
 = 3,

335 
	gshiá
 = 30, 
	gmask
 = 3,

340 
loÿl
 
	gm­_l¤išd
 = { -- 
Lßd
/
¡Üe
 , 
immedŸ‹
 
´e
/
po¡
-
šdexed
.

341 
shiá
 = 30, 
	gmask
 = 3,

343 
shiá
 = 26, 
	gmask
 = 1,

345 
shiá
 = 22, 
	gmask
 = 3,

350 
	gshiá
 = 26, 
	gmask
 = 1,

352 
shiá
 = 22, 
	gmask
 = 3,

357 
	gshiá
 = 26, 
	gmask
 = 1,

359 
shiá
 = 22, 
	gmask
 = 3,

363 
	gshiá
 = 22, 
	gmask
 = 3,

368 
	gshiá
 = 26, 
	gmask
 = 1,

370 
shiá
 = 22, 
	gmask
 = 3,

374 
	gshiá
 = 22, 
	gmask
 = 3,

380 
loÿl
 
	gm­_l¤œo
 = {

381 
shiá
 = 21, 
	gmask
 = 1,

382 [0] = { -- 
Lßd
/
¡Üe
 
immedŸ‹
.

383 
shiá
 = 10, 
	gmask
 = 3,

384 [0] = { -- 
UnsÿËd
 
immedŸ‹
.

385 
shiá
 = 26, 
	gmask
 = 1,

387 
shiá
 = 30, 
	gmask
 = 3,

389 
shiá
 = 22, 
	gmask
 = 3,

393 
	gshiá
 = 22, 
	gmask
 = 3,

397 
	gshiá
 = 22, 
	gmask
 = 3,

401 
	gshiá
 = 22, 
	gmask
 = 3,

405 }, 
	gm­_l¤išd
, 
	gçl£
, map_lsriind

407 { -- 
	gLßd
/
¡Üe
 , 
	goff£t
.

408 
	gshiá
 = 10, 
	gmask
 = 3,

410 
shiá
 = 26, 
	gmask
 = 1,

412 
shiá
 = 30, 
	gmask
 = 3,

414 
shiá
 = 22, 
	gmask
 = 3,

418 
	gshiá
 = 22, 
	gmask
 = 3,

422 
	gshiá
 = 22, 
	gmask
 = 3,

426 
	gshiá
 = 22, 
	gmask
 = 3,

431 
	gshiá
 = 30, 
	gmask
 = 3,

433 
shiá
 = 22, 
	gmask
 = 3,

437 
shiá
 = 22, 
	gmask
 = 3,

445 
loÿl
 
	gm­_l¥
 = { -- 
Lßd
/
¡Üe
 
·œ
, 
off£t
.

446 
shiá
 = 22, 
	gmask
 = 1,

448 
shiá
 = 30, 
	gmask
 = 3,

450 
shiá
 = 26, 
	gmask
 = 1,

454 
	gshiá
 = 26, 
	gmask
 = 1,

458 
	gshiá
 = 26, 
	gmask
 = 1,

463 
	gshiá
 = 30, 
	gmask
 = 3,

465 
shiá
 = 26, 
	gmask
 = 1,

469 
	gshiá
 = 26, 
	gmask
 = 1,

473 
	gshiá
 = 26, 
	gmask
 = 1,

479 
loÿl
 
	gm­_ls
 = { -- 
Lßds
 
ªd
 
¡Ües
.

480 
shiá
 = 24, 
	gmask
 = 0x31,

481 [0x10] = 
m­_Ìl
, [0x30] = 
m­_l¤œo
,

483 
shiá
 = 23, 
	gmask
 = 3,

484 
	gm­_l¥
, map_lsp, map_lsp

487 
shiá
 = 23, 
	gmask
 = 3,

488 
	gm­_l¥
, map_lsp, map_lsp

491 
shiá
 = 26, 
	gmask
 = 1,

493 
shiá
 = 30, 
	gmask
 = 3,

495 
shiá
 = 22, 
	gmask
 = 3,

499 
	gshiá
 = 22, 
	gmask
 = 3,

503 
	gshiá
 = 22, 
	gmask
 = 3,

507 
	gshiá
 = 22, 
	gmask
 = 3,

512 
	gshiá
 = 30, 
	gmask
 = 3,

514 
shiá
 = 22, 
	gmask
 = 3,

518 
shiá
 = 22, 
	gmask
 = 3,

525 
loÿl
 
	gm­_d©aå
 = { -- 
D©a
 
´oûssšg
, 
SIMD
 
ªd
 
FP
.

526 
shiá
 = 28, 
	gmask
 = 7,

528 
	gshiá
 = 24, 
	gmask
 = 1,

530 
shiá
 = 21, 
	gmask
 = 1,

532 
	gshiá
 = 10, 
	gmask
 = 3,

534 
shiá
 = 12, 
	gmask
 = 1,

536 
shiá
 = 13, 
	gmask
 = 1,

538 
shiá
 = 14, 
	gmask
 = 1,

540 
shiá
 = 15, 
	gmask
 = 1,

541 [0] = { -- 
FP
/
cÚv”siÚ
.

542 
shiá
 = 31, 
	gmask
 = 1,

544 
shiá
 = 16, 
	gmask
 = 0xff,

560 
	gshiá
 = 16, 
	gmask
 = 0xff,

577 { -- 
FP
 
	gd©a
-
	g´oûssšg
, 1 
	gsourû
.

578 
	gshiá
 = 31, 
	gmask
 = 1,

580 
shiá
 = 22, 
	gmask
 = 3,

582 
shiá
 = 15, 
	gmask
 = 63,

584 "fsq¹DNf", 
	gçl£
, "fcvtDdNs", false, false,

586 "äšDNf", 
	gçl£
, "frintxDNf", "frintiDNf",

589 
	gshiá
 = 15, 
	gmask
 = 63,

591 "fsq¹DNf", "fcvtDsNd", 
	gçl£
, false, false,

593 "äšDNf", 
	gçl£
, "frintxDNf", "frintiDNf",

598 { -- 
FP
 
	gcom·»
.

599 
	gshiá
 = 31, 
	gmask
 = 1,

601 
shiá
 = 14, 
	gmask
 = 3,

603 
shiá
 = 23, 
	gmask
 = 1,

605 
shiá
 = 0, 
	gmask
 = 31,

613 { -- 
FP
 
	gimmedŸ‹
.

614 
	gshiá
 = 31, 
	gmask
 = 1,

616 
shiá
 = 5, 
	gmask
 = 31,

618 
shiá
 = 23, 
	gmask
 = 1,

624 { -- 
FP
 
cÚd™iÚ®
 
	gcom·»
.

625 
	gshiá
 = 31, 
	gmask
 = 1,

627 
shiá
 = 23, 
	gmask
 = 1,

629 
shiá
 = 4, 
	gmask
 = 1,

634 { -- 
FP
 
	gd©a
-
	g´oûssšg
, 2 
	gsourûs
.

635 
	gshiá
 = 31, 
	gmask
 = 1,

637 
shiá
 = 23, 
	gmask
 = 1,

639 
shiá
 = 12, 
	gmask
 = 15,

646 { -- 
FP
 
cÚd™iÚ®
 
	g£Ëù
.

647 
	gshiá
 = 31, 
	gmask
 = 1,

649 
shiá
 = 23, 
	gmask
 = 1,

655 { -- 
FP
 
	gd©a
-
	g´oûssšg
, 3 
	gsourûs
.

656 
	gshiá
 = 31, 
	gmask
 = 1,

658 
shiá
 = 15, 
	gmask
 = 1,

660 
shiá
 = 21, 
	gmask
 = 5,

664 
	gshiá
 = 21, 
	gmask
 = 5,

672 
loÿl
 
	gm­_br
 = { -- 
B¿nches
, 
exû±iÚ
 
g’”©šg
 
ªd
 
sy¡em
 
š¡ruùiÚs
.

673 
shiá
 = 29, 
	gmask
 = 7,

675 { -- 
	gCom·»
 & 
	gb¿nch
, 
	gimmedŸ‹
.

676 
	gshiá
 = 24, 
	gmask
 = 3,

679 { -- 
CÚd™iÚ®
 
	gb¿nch
, 
	gimmedŸ‹
.

680 
	gshiá
 = 24, 
	gmask
 = 3,

682 
shiá
 = 4, 
	gmask
 = 1,

684 
shiá
 = 0, 
	gmask
 = 15,

689 }, 
	gçl£
, "blB",

690 { -- 
	gCom·»
 & 
	gb¿nch
, 
	gimmedŸ‹
.

691 
	gshiá
 = 24, 
	gmask
 = 3,

695 
	gshiá
 = 24, 
	gmask
 = 3,

696 [0] = { -- 
Exû±iÚ
 
g’”©iÚ
.

697 
shiá
 = 0, 
	gmask
 = 0xe0001f,

700 { -- 
Sy¡em
 
	gš¡ruùiÚs
.

701 
	gshiá
 = 0, 
	gmask
 = 0x3fffff,

704 { -- 
UncÚd™iÚ®
 
	gb¿nch
, .

705 
	gshiá
 = 0, 
	gmask
 = 0xfffc1f,

712 
loÿl
 
	gm­_š™
 = {

713 
shiá
 = 25, 
	gmask
 = 15,

714 [0] = 
çl£
, 
	gçl£
, f®£, f®£, 
	gm­_ls
, 
	gm­_d©¬
, m­_ls, 
	gm­_d©aå
,

715 
	gm­_d©ai
, m­_d©ai, 
	gm­_br
, m­_br, 
	gm­_ls
, 
	gm­_d©¬
, m­_ls, 
	gm­_d©aå


720 
loÿl
 
	gm­_»gs
 = { 
x
 = {}, 
	gw
 = {}, 
	gd
 = {}, 
	gs
 = {} }

722 
	gi
=0,30 do

723 
	gm­_»gs
.
	gx
[
i
] = "x"..i

724 
m­_»gs
.
w
[
i
] = "w"..i

725 
m­_»gs
.
d
[
i
] = "d"..i

726 
m­_»gs
.
s
[
i
] = "s"..i

727 
’d


728 
m­_»gs
.
x
[31] = "sp"

729 
m­_»gs
.
w
[31] = "wsp"

730 
m­_»gs
.
d
[31] = "d31"

731 
m­_»gs
.
s
[31] = "s31"

733 
loÿl
 
m­_cÚd
 = {

738 
loÿl
 
	gm­_shiá
 = { [0] = "lsl", "lsr", "asr", }

740 
loÿl
 
	gm­_ex‹nd
 = {

746 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

747 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

748 
loÿl
 
pos
 = 
ùx
.pos

749 
loÿl
 
exŒa
 = ""

750 
ùx
.
»l
 
th’


751 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

752 
sym
 
th’


753 
exŒa
 = "\t->"..
sym


754 
’d


755 
’d


756 
ùx
.
hexdump
 > 0 
th’


757 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-5s %s%s\n",

758 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

760 
ùx
.
	`out
(
	`fÜm©
("%08x %-5s %s%s\n",

761 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

762 
’d


763 
ùx
.
pos
 =…os + 4

764 
’d


766 -- 
F®lback
 
unknown
 
İcodes
.

767 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

768  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

769 
’d


771 
loÿl
 
funùiÚ
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

772  
m­_»gs
[
	`m©ch
(
·t
, 
p
.."%w-([xwds])")][
»gnum
]

773 
’d


775 
loÿl
 
funùiÚ
 
	$fmt_hex32
(
x
)

776 
x
 < 0 
th’


777  
	$tohex
(
x
)

779  
	`fÜm©
("%x", 
x
)

780 
’d


781 
’d


783 
loÿl
 
imm13_»p
 = { 0x55555555, 0x11111111, 0x01010101, 0x00010001, 0x00000001 
	}
}

785 
loÿl
 
funùiÚ
 
	$decode_imm13
(
İ
)

786 
loÿl
 
imms
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

787 
loÿl
 
immr
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 63)

788 
	`bªd
(
İ
, 0x00400000è=ğ0 
th’


789 
loÿl
 
Ën
 = 5

790 
imms
 >ğ56 
th’


791 
imms
 >ğ60 
th’
 
Ën
 = 1 ËÀğ2 
’d


792 
–£if
 
imms
 >ğ48 
th’
 
Ën
 = 3ƒl£iàimm >ğ32h’†’ = 4 
’d


793 
loÿl
 
l
 = 
	`lshiá
(1, 
Ën
)-1

794 
loÿl
 
s
 = 
	$bªd
(
imms
, 
l
)

795 
loÿl
 
r
 = 
	$bªd
(
immr
, 
l
)

796 
loÿl
 
imm
 = 
	`rÜ
(
	`rshiá
(-1, 31-
s
), 
r
)

797 
Ën
 ~ğ5 
th’
 
imm
 = 
	`bªd
(imm, 
	`lshiá
(1, 
l
)-1è+ 
	`rshiá
(imm, 31-lè
’d


798 
imm
 = imm * 
imm13_»p
[
Ën
]

799 
loÿl
 
ix
 = 
	$fmt_hex32
(
imm
)

800 
	`rshiá
(
İ
, 31è~ğ0 
th’


801  
ix
..
	$tohex
(
imm
)

803  
ix


804 
’d


806 
loÿl
 
lo
, 
hi
 = -1, 0

807 
imms
 < 32 
th’
 
lo
 = 
	`rshiá
(-1, 31-immsè
hi
 =„shiá(-1, 63-immsè
’d


808 
immr
 ~ğ0 
th’


809 
lo
, 
hi
 = 
	`rÜ
Öo, 
immr
), 
	$rÜ
(
hi
, 
immr
)

810 
loÿl
 
x
 = 
immr
 =ğ32 
ªd
 0 
Ü
 
	`bªd
(
	`bxÜ
(
lo
, 
hi
), 
	`lshiá
(-1, 32-immr))

811 
lo
, 
hi
 = 
	`bxÜ
Öo, 
x
), 
	$bxÜ
(
hi
, 
x
)

812 
immr
 >ğ32 
th’
 
lo
, 
hi
 = hi,†Ø
’d


813 
’d


814 
hi
 ~ğ0 
th’


815  
	`fmt_hex32
(
hi
)..
	$tohex
(
lo
)

817  
	$fmt_hex32
(
lo
)

818 
’d


819 
’d


820 
’d


822 
loÿl
 
funùiÚ
 
	$·r£_immpc
(
İ
, 
Çme
)

823 
Çme
 =ğ"b" 
Ü
‚am=ğ"bl" 
th’


824  
	`¬shiá
(
	`lshiá
(
İ
, 6), 4)

825 
–£if
 
Çme
 =ğ"adr" 
Ü
‚am=ğ"ad½" 
th’


826 
loÿl
 
immlo
 = 
	`bªd
(
	`rshiá
(
İ
, 29), 3)

827 
loÿl
 
immhi
 = 
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 8), 13), 2)

828  
	$bÜ
(
immhi
, 
immlo
)

829 
–£if
 
Çme
 =ğ"tbz" 
Ü
‚am=ğ"tbnz" 
th’


830  
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 13), 18), 2)

832  
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 8), 13), 2)

833 
’d


834 
’d


836 
loÿl
 
funùiÚ
 
	$·r£_åimm8
(
İ
)

837 
loÿl
 
sign
 = 
	`bªd
(
İ
, 0x100000è=ğ0 
ªd
 1 
Ü
 -1

838 
loÿl
 
exp
 = 
	`bxÜ
(
	`rshiá
(
	`¬shiá
(
	`lshiá
(
İ
, 12), 5), 24), 0x80) - 131

839 
loÿl
 
äac
 = 16+
	`bªd
(
	`rshiá
(
İ
, 13), 15)

840  
sign
 * 
äac
 * 2^
exp


841 
’d


843 
loÿl
 
funùiÚ
 
	$´eãr_bfx
(
sf
, 
uns
, 
imms
, 
immr
)

844 
imms
 < 
immr
 
Ü
 imm =ğ31 o¸imm =ğ63 
th’


845  
çl£


846 
’d


847 
immr
 =ğ0 
th’


848 
sf
 =ğ0 
	$ªd
 (
imms
 =ğ7 
Ü
 imm =ğ15è
th’


849  
çl£


850 
’d


851 
sf
 ~ğ0 
ªd
 
uns
 =ğ0 
	$ªd
 (
imms
 =ğ7 
Ü
 imm =ğ15 o¸imm =ğ31è
th’


852  
çl£


853 
’d


854 
’d


855  
Œue


856 
’d


858 -- 
Di§s£mbË
 
a
 
sšgË
 
š¡ruùiÚ
.

859 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

860 
loÿl
 
pos
 = 
ùx
.pos

861 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

862 
loÿl
 
İ
 = 
	`bÜ
(
	`lshiá
(
b3
, 24),†shiá(
b2
, 16),†shiá(
b1
, 8), 
b0
)

863 
loÿl
 
İ”ªds
 = {
	}
}

864 
loÿl
 
suffix
 = ""

865 
loÿl
 
Ï¡
, 
	gÇme
, 
·t


866 
loÿl
 
m­_»g


867 
	gùx
.
	gİ
 = 
İ


868 
ùx
.
»l
 = 
n


869 
Ï¡
 = 
n


870 
loÿl
 
İ©


871 
İ©
 = 
m­_š™
[
bªd
(
rshiá
(
İ
, 25), 15)]

872 
ty³
(
İ©
) ~= "string" do

873 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


874 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)] 
Ü
 o·t.
_


875 
’d


876 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9]*)(.*)")

877 
loÿl
 
®Šame
, 
·t2
 = 
	`m©ch
(
·t
, "|([a-z0-9_.|]*)(.*)")

878 
®Šame
 
th’
 
·t
 = 
·t2
 
’d


879 
	`sub
(
·t
, 1, 1è=ğ"." 
th’


880 
loÿl
 
s2
, 
p2
 = 
	`m©ch
(
·t
, "^([a-z0-9.]*)(.*)")

881 
suffix
 = suffix..
s2


882 
·t
 = 
p2


883 
’d


885 
loÿl
 
¹
 = 
	`m©ch
(
·t
, "[gf]")

886 
¹
 
th’


887 
¹
 =ğ"g" 
th’


888 
m­_»g
 = 
	`bªd
(
İ
, 0x80000000è~ğ0 
ªd
 
m­_»gs
.
x
 
Ü
 m­_»gs.
w


890 
m­_»g
 = 
	`bªd
(
İ
, 0x400000è~ğ0 
ªd
 
m­_»gs
.
d
 
Ü
 m­_»gs.
s


891 
’d


892 
’d


894 
loÿl
 
£cÚd0
, 
immr


896 
p
 
š
 
	`gm©ch
(
·t
, ".") do

897 
loÿl
 
x
 = 
n


898 
p
 =ğ"D" 
th’


899 
loÿl
 
»gnum
 = 
	$bªd
(
İ
, 31)

900 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

901 
–£if
 
p
 =ğ"N" 
th’


902 
loÿl
 
»gnum
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31)

903 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

904 
–£if
 
p
 =ğ"M" 
th’


905 
loÿl
 
»gnum
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

906 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

907 
–£if
 
p
 =ğ"A" 
th’


908 
loÿl
 
»gnum
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 31)

909 
x
 = 
¹
 
ªd
 
m­_»g
[
»gnum
] 
Ü
 
	$m©ch_»g
(
p
, 
·t
, 
»gnum
)

910 
–£if
 
p
 =ğ"B" 
th’


911 
loÿl
 
addr
 = 
ùx
.add¸+ 
pos
 + 
	$·r£_immpc
(
İ
, 
Çme
)

912 
ùx
.
»l
 = 
addr


913 
x
 = "0x"..
	$tohex
(
addr
)

914 
–£if
 
p
 =ğ"T" 
th’


915 
x
 = 
	`bÜ
(
	`bªd
(
	`rshiá
(
İ
, 26), 32), band(rshift(op, 19), 31))

916 
–£if
 
p
 =ğ"V" 
th’


917 
x
 = 
	$bªd
(
İ
, 15)

918 
–£if
 
p
 =ğ"C" 
th’


919 
x
 = 
m­_cÚd
[
	`bªd
(
	`rshiá
(
İ
, 12), 15)]

920 
–£if
 
p
 =ğ"c" 
th’


921 
loÿl
 
º
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31)

922 
loÿl
 
rm
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

923 
loÿl
 
cÚd
 = 
	`bªd
(
	`rshiá
(
İ
, 12), 15)

924 
loÿl
 
švc
 = 
	$bxÜ
(
cÚd
, 1)

925 
x
 = 
m­_cÚd
[
cÚd
]

926 
®Šame
 
ªd
 
cÚd
 ~ğ14‡nd cÚd ~ğ15 
th’


927 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

928 
º
 =ğ
rm
 
th’


929 
loÿl
 
n
 = #operands

930 
İ”ªds
[
n
] = 
n


931 
x
 = 
m­_cÚd
[
švc
]

932 
º
 ~ğ31 
th’


933 
a1
 
th’
 
Çme
 =‡1 Çmğ
®Šame
 
’d


935 
İ”ªds
[
n
-1] = 
n


936 
Çme
 = 
a2


937 
’d


938 
’d


939 
’d


940 
–£if
 
p
 =ğ"W" 
th’


941 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 0xffff)

942 
–£if
 
p
 =ğ"Y" 
th’


943 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 0xffff)

944 
loÿl
 
hw
 = 
	`bªd
(
	`rshiá
(
İ
, 21), 3)

945 
®Šame
 
	`ªd
 (
hw
 =ğ0 
Ü
 
x
 ~ğ0è
th’


946 
Çme
 = 
®Šame


947 
’d


948 
–£if
 
p
 =ğ"L" 
th’


949 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

950 
loÿl
 
imm9
 = 
	`¬shiá
(
	`lshiá
(
İ
, 11), 23)

951 
	`bªd
(
İ
, 0x800è~ğ0 
th’


952 
x
 = "["..
º
..", #"..
imm9
.."]!"

954 
x
 = "["..
º
.."], #"..
imm9


955 
’d


956 
–£if
 
p
 =ğ"U" 
th’


957 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

958 
loÿl
 
sz
 = 
	`bªd
(
	`rshiá
(
İ
, 30), 3)

959 
loÿl
 
imm12
 = 
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 10), 20), 
sz
)

960 
imm12
 ~ğ0 
th’


961 
x
 = "["..
º
..", #"..
imm12
.."]"

963 
x
 = "["..
º
.."]"

964 
’d


965 
–£if
 
p
 =ğ"K" 
th’


966 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

967 
loÿl
 
imm9
 = 
	`¬shiá
(
	`lshiá
(
İ
, 11), 23)

968 
imm9
 ~ğ0 
th’


969 
x
 = "["..
º
..", #"..
imm9
.."]"

971 
x
 = "["..
º
.."]"

972 
’d


973 
–£if
 
p
 =ğ"O" 
th’


974 
loÿl
 
º
, 
rm
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

975 
loÿl
 
m
 = 
	`bªd
(
	`rshiá
(
İ
, 13), 1)

976 
m
 =ğ0 
th’


977 
rm
 = 
m­_»gs
.
w
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

979 
rm
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

980 
’d


981 
x
 = "["..
º
..", "..
rm


982 
loÿl
 
İt
 = 
	`bªd
(
	`rshiá
(
İ
, 13), 7)

983 
loÿl
 
s
 = 
	`bªd
(
	`rshiá
(
İ
, 12), 1)

984 
loÿl
 
sz
 = 
	`bªd
(
	`rshiá
(
İ
, 30), 3)

985 -- 
ex‹nsiÚ
 
to
 
be
 
­¶›d


986 
İt
 =ğ3 
th’


987 
s
 =ğ0 
th’
 
x
 = x.."]"

988 
x
 = x..",†¦ #"..
sz
.."]" 
’d


989 
–£if
 
İt
 =ğ2 
Ü
 o± =ğ6 o¸İˆ=ğ7 
th’


990 
s
 =ğ0 
th’
 
x
 = x..", "..
m­_ex‹nd
[
İt
].."]"

991 
x
 = x..", "..
m­_ex‹nd
[
İt
].." #"..
sz
.."]" 
’d


993 
x
 = x.."]"

994 
’d


995 
–£if
 
p
 =ğ"P" 
th’


996 
loÿl
 
İcv
, 
sh
 = 
	`rshiá
(
İ
, 26), 2

997 
İcv
 >ğ0x2¨
th’
 
sh
 = 4 
–£if
 opcv >ğ0x1bh’ sh = 3 
’d


998 
loÿl
 
imm7
 = 
	`lshiá
(
	`¬shiá
Öshiá(
İ
, 10), 25), 
sh
)

999 
loÿl
 
º
 = 
m­_»gs
.
x
[
	`bªd
(
	`rshiá
(
İ
, 5), 31)]

1000 
loÿl
 
šd
 = 
	`bªd
(
	`rshiá
(
İ
, 23), 3)

1001 
šd
 =ğ1 
th’


1002 
x
 = "["..
º
.."], #"..
imm7


1003 
–£if
 
šd
 =ğ2 
th’


1004 
imm7
 =ğ0 
th’


1005 
x
 = "["..
º
.."]"

1007 
x
 = "["..
º
..", #"..
imm7
.."]"

1008 
’d


1009 
–£if
 
šd
 =ğ3 
th’


1010 
x
 = "["..
º
..", #"..
imm7
.."]!"

1011 
’d


1012 
–£if
 
p
 =ğ"I" 
th’


1013 
loÿl
 
shf
 = 
	`bªd
(
	`rshiá
(
İ
, 22), 3)

1014 
loÿl
 
imm12
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 0x0fff)

1015 
loÿl
 
º
, 
rd
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31), 
	$bªd
(
İ
, 31)

1016 
®Šame
 =ğ"mov" 
ªd
 
shf
 =ğ0‡nd 
imm12
 =ğ0 
	$ªd
 (
º
 =ğ31 
Ü
 
rd
 =ğ31è
th’


1017 
Çme
 = 
®Šame


1018 
x
 = 
n


1019 
–£if
 
shf
 =ğ0 
th’


1020 
x
 = 
imm12


1021 
–£if
 
shf
 =ğ1 
th’


1022 
x
 = 
imm12
..",†sl #12"

1023 
’d


1024 
–£if
 
p
 =ğ"i" 
th’


1025 
x
 = "#0x"..
	$decode_imm13
(
İ
)

1026 
–£if
 
p
 =ğ"1" 
th’


1027 
immr
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 63)

1028 
x
 = 
immr


1029 
–£if
 
p
 =ğ"2" 
th’


1030 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1031 
®Šame
 
th’


1032 
loÿl
 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
 =

1033 
	`m©ch
(
®Šame
, "([^|]*)|([^|]*)|([^|]*)|([^|]*)|([^|]*)|(.*)")

1034 
loÿl
 
sf
 = 
	`bªd
(
	`rshiá
(
İ
, 26), 32)

1035 
loÿl
 
uns
 = 
	`bªd
(
	`rshiá
(
İ
, 30), 1)

1036 
	$´eãr_bfx
(
sf
, 
uns
, 
x
, 
immr
è
th’


1037 
Çme
 = 
a2


1038 
x
 = x - 
immr
 + 1

1039 
–£if
 
immr
 =ğ0 
ªd
 
x
 =ğ7 
th’


1040 
loÿl
 
n
 = #operands

1041 
İ”ªds
[
n
] = 
n


1042 
sf
 ~ğ0 
th’


1043 
İ”ªds
[
n
-1] = 
	`gsub
(operands[n-1], "x", "w")

1044 
’d


1045 
Ï¡
 = 
İ”ªds
[
n
-1]

1046 
Çme
 = 
a6


1047 
x
 = 
n


1048 
–£if
 
immr
 =ğ0 
ªd
 
x
 =ğ15 
th’


1049 
loÿl
 
n
 = #operands

1050 
İ”ªds
[
n
] = 
n


1051 
sf
 ~ğ0 
th’


1052 
İ”ªds
[
n
-1] = 
	`gsub
(operands[n-1], "x", "w")

1053 
’d


1054 
Ï¡
 = 
İ”ªds
[
n
-1]

1055 
Çme
 = 
a5


1056 
x
 = 
n


1057 
–£if
 
x
 =ğ31 
Ü
 x =ğ63 
th’


1058 
x
 =ğ31 
ªd
 
immr
 =ğ0‡nd 
Çme
 =ğ"sbfm" 
th’


1059 
Çme
 = 
a4


1060 
loÿl
 
n
 = #operands

1061 
İ”ªds
[
n
] = 
n


1062 
sf
 ~ğ0 
th’


1063 
İ”ªds
[
n
-1] = 
	`gsub
(operands[n-1], "x", "w")

1064 
’d


1065 
Ï¡
 = 
İ”ªds
[
n
-1]

1067 
Çme
 = 
a3


1068 
’d


1069 
x
 = 
n


1070 
–£if
 
	`bªd
(
x
, 31è~ğ31 
ªd
 
immr
 =ğx+1‡nd 
Çme
 =ğ"ubfm" 
th’


1071 
Çme
 = 
a4


1072 
Ï¡
 = "#"..(
sf
+32 - 
immr
)

1073 
İ”ªds
[#İ”ªds] = 
Ï¡


1074 
x
 = 
n


1075 
–£if
 
x
 < 
immr
 
th’


1076 
Çme
 = 
a1


1077 
Ï¡
 = "#"..(
sf
+32 - 
immr
)

1078 
İ”ªds
[#İ”ªds] = 
Ï¡


1079 
x
 = x + 1

1080 
’d


1081 
’d


1082 
–£if
 
p
 =ğ"3" 
th’


1083 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1084 
®Šame
 
th’


1085 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

1086 
x
 < 
immr
 
th’


1087 
Çme
 = 
a1


1088 
loÿl
 
sf
 = 
	`bªd
(
	`rshiá
(
İ
, 26), 32)

1089 
Ï¡
 = "#"..(
sf
+32 - 
immr
)

1090 
İ”ªds
[#İ”ªds] = 
Ï¡


1091 
x
 = x + 1

1092 
–£if
 
x
 >ğ
immr
 
th’


1093 
Çme
 = 
a2


1094 
x
 = x - 
immr
 + 1

1095 
’d


1096 
’d


1097 
–£if
 
p
 =ğ"4" 
th’


1098 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1099 
loÿl
 
º
 = 
	`bªd
(
	`rshiá
(
İ
, 5), 31)

1100 
loÿl
 
rm
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

1101 
®Šame
 
ªd
 
º
 =ğ
rm
 
th’


1102 
loÿl
 
n
 = #operands

1103 
İ”ªds
[
n
] = 
n


1104 
Ï¡
 = 
İ”ªds
[
n
-1]

1105 
Çme
 = 
®Šame


1106 
’d


1107 
–£if
 
p
 =ğ"5" 
th’


1108 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

1109 
–£if
 
p
 =ğ"S" 
th’


1110 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 63)

1111 
x
 =ğ0 
th’
 x = 
n


1112 
x
 = 
m­_shiá
[
	`bªd
(
	`rshiá
(
İ
, 22), 3)].." #"..x 
’d


1113 
–£if
 
p
 =ğ"X" 
th’


1114 
loÿl
 
İt
 = 
	`bªd
(
	`rshiá
(
İ
, 13), 7)

1115 -- 
Width
 
¥ecif›r
 <
R
>.

1116 
İt
 ~ğ3 
ªd
 o± ~ğ7 
th’


1117 
Ï¡
 = 
m­_»gs
.
w
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

1118 
İ”ªds
[#İ”ªds] = 
Ï¡


1119 
’d


1120 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 10), 7)

1121 -- 
Ex‹nsiÚ
.

1122 
İt
 =ğ2 + 
	`bªd
(
	`rshiá
(
İ
, 31), 1è
ªd


1123 
	`bªd
(
	`rshiá
(
İ
, 
£cÚd0
 
ªd
 5 
Ü
 0), 31è=ğ31 
th’


1124 
x
 =ğ0 
th’
 x = 
n


1125 
x
 = "l¦ #"..x 
’d


1127 
x
 =ğ0 
th’
 x = 
m­_ex‹nd
[
	`bªd
(
	`rshiá
(
İ
, 13), 7)]

1128 
x
 = 
m­_ex‹nd
[
	`bªd
(
	`rshiá
(
İ
, 13), 7)].." #"..x 
’d


1129 
’d


1130 
–£if
 
p
 =ğ"R" 
th’


1131 
x
 = 
	`bªd
(
	`rshiá
(
İ
,21), 3)

1132 
x
 =ğ0 
th’
 x = 
n


1133 
x
 = "l¦ #"..x*16 
’d


1134 
–£if
 
p
 =ğ"z" 
th’


1135 
loÿl
 
n
 = #operands

1136 
İ”ªds
[
n
] =ğ"¥" 
th’
 operands[n] = "xzr"

1137 
–£if
 
İ”ªds
[
n
] =ğ"w¥" 
th’
 operands[n] = "wzr"

1138 
’d


1139 
–£if
 
p
 =ğ"Z" 
th’


1140 
x
 = 0

1141 
–£if
 
p
 =ğ"F" 
th’


1142 
x
 = 
	$·r£_åimm8
(
İ
)

1143 
–£if
 
p
 =ğ"g" 
Ü
… == "f" or… == "x" or… == "w" or

1144 
p
 =ğ"d" 
Ü
… =ğ"s" 
th’


1145 -- 
The£
 
¬e
 
hªdËd
 
š
 
D
/
N
/
M
/
A
.

1146 
–£if
 
p
 =ğ"0" 
th’


1147 
Ï¡
 =ğ"¥" 
Ü
†a¡ =ğ"w¥" 
th’


1148 
loÿl
 
n
 = #operands

1149 
İ”ªds
[
n
] = 
n


1150 
Ï¡
 = 
İ”ªds
[
n
-1]

1151 
®Šame
 
th’


1152 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

1153 
nÙ
 
a1
 
th’


1154 
Çme
 = 
®Šame


1155 
–£if
 
£cÚd0
 
th’


1156 
Çme
, 
®Šame
 = 
a2
, 
a1


1158 
Çme
, 
®Šame
 = 
a1
, 
a2


1159 
’d


1160 
’d


1161 
’d


1162 
£cÚd0
 = 
Œue


1164 
	$as£¹
(
çl£
)

1165 
’d


1166 
x
 
th’


1167 
Ï¡
 = 
x


1168 
	`ty³
(
x
è=ğ"numb”" 
th’
 x = "#"..x 
’d


1169 
İ”ªds
[#İ”ªds+1] = 
x


1170 
’d


1171 
’d


1173  
	$putİ
(
ùx
, 
Çme
..
suffix
, 
İ”ªds
)

1174 
’d


1178 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

1179 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

1180 
nÙ
 
ofs
 
th’
 of ğ0 
’d


1181 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


1182 
ùx
.
pos
 = 
ofs


1183 
ùx
.
»l
 = 
n


1184 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


1185 
’d


1187 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

1188 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

1189 
loÿl
 
ùx
 = {
	}
}

1190 
ùx
.
code
 = code

1191 
ùx
.
addr
 =‡dd¸
Ü
 0

1192 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


1193 
ùx
.
symb
 = {}

1194 
ùx
.
di§ss
 = 
di§ss_block


1195 
ùx
.
hexdump
 = 8

1196  
ùx


1197 
’d


1199 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

1200 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

1201 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

1202 
’d


1204 -- 
R‘uº
 
Çme
 
RID
.

1205 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

1206 
r
 < 32 
th’
  
m­_»gs
.
x
[r] 
’d


1207  
m­_»gs
.
d
[
r
-32]

1208 
’d


1210 -- 
Public
 
moduË
 
funùiÚs
.

1212 
ü—‹
 = create,

1213 
di§ss
 = disass,

1214 
»gÇme
 =„egname

1215 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_arm64be.lua

2 -- 
LuaJIT
 
ARM64BE
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
ARM64
 
š¡ruùiÚs
 
¬e
 
®ways
 
	gl™e
-
	g’dŸn
. 
So
 
ju¡
 
fÜw¬d
 
to
 
	gthe


8 -- 
commÚ
 
ARM64
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11  
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_arm64")

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mips.lua

2 -- 
LuaJIT
 
MIPS
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
	gMIT
/
X
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
It
 
di§s£mbËs
 
®l
 
¡ªd¬d
 
	gMIPS32R1
/
R2
 
	gš¡ruùiÚs
.

10 -- 
DeçuÉ
 
mode
 
is
 
	gbig
-
	g’dŸn
, 
but
 
	g£e
: 
dis_m£l
.
lua


13 
loÿl
 
ty³
 =ype

14 
loÿl
 
by‹
, 
	gfÜm©
 = 
¡ršg
.by‹, 
	g¡ršg
.
fÜm©


15 
loÿl
 
	gm©ch
, 
	ggm©ch
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.
gm©ch


16 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


17 
loÿl
 
b™
 = 
»quœe
("bit")

18 
loÿl
 
bªd
, 
	gbÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.
tohex


19 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshift, bit.arshift

22 -- 
Prim¬y
 
ªd
 
ex‹nded
 
İcode
 
	gm­s


25 
loÿl
 
	gm­_movci
 = { 
shiá
 = 16, 
	gmask
 = 1, [0] = "movfDSC", "movtDSC", }

26 
loÿl
 
	gm­_¤l
 = { 
shiá
 = 21, 
	gmask
 = 1, [0] = "srlDTA", "rotrDTA", }

27 
loÿl
 
	gm­_¤lv
 = { 
shiá
 = 6, 
	gmask
 = 1, [0] = "srlvDTS", "rotrvDTS", }

29 
loÿl
 
	gm­_¥ecŸl
 = {

30 
shiá
 = 0, 
	gmask
 = 63,

31 [0] = { 
shiá
 = 0, 
	gmask
 = -1, [0] = "nİ", 
	g_
 = "sllDTA" },

32 
	gm­_movci
, 
	gm­_¤l
, "sraDTA",

33 "¦lvDTS", 
	gçl£
, 
	gm­_¤lv
, "sravDTS",

35 "sysÿÎY", "b»akY", 
	gçl£
, "sync",

37 "d¦lvDST", 
	gçl£
, "dsrlvDST", "dsravDST",

42 
	gçl£
, false, "sltDST", "sltuDST",

45 "‹qSTZ", 
	gçl£
, "tneSTZ", false,

46 "d¦lDTA", 
	gçl£
, "dsrlDTA", "dsraDTA",

47 "d¦l32DTA", 
	gçl£
, "dsrl32DTA", "dsra32DTA",

50 
loÿl
 
	gm­_¥ecŸl2
 = {

51 
shiá
 = 0, 
	gmask
 = 63,

52 [0] = "maddST", "madduST", "mulDST", 
	gçl£
,

58 
loÿl
 
	gm­_bshæ
 = {

59 
shiá
 = 6, 
	gmask
 = 31,

65 
loÿl
 
	gm­_dbshæ
 = {

66 
shiá
 = 6, 
	gmask
 = 31,

71 
loÿl
 
	gm­_¥ecŸl3
 = {

72 
shiá
 = 0, 
	gmask
 = 63,

75 [32] = 
m­_bshæ
, [36] = 
m­_dbshæ
, [59] = "rdhwrTD",

78 
loÿl
 
	gm­_»gimm
 = {

79 
shiá
 = 16, 
	gmask
 = 31,

81 
	gçl£
, false, false, false,

83 "‹qiSI", 
	gçl£
, "tneiSI", false,

85 
	gçl£
, false, false, false,

86 
	gçl£
, false, false, false,

87 
	gçl£
, false, false, "synciSO",

90 
loÿl
 
	gm­_cİ0
 = {

91 
shiá
 = 25, 
	gmask
 = 1,

93 
shiá
 = 21, 
	gmask
 = 15,

96 [11] = { 
shiá
 = 5, 
	gmask
 = 1, [0] = "diT0", "eiT0", },

99 
	gshiá
 = 0, 
	gmask
 = 63,

106 
loÿl
 
	gm­_cİ1s
 = {

107 
shiá
 = 0, 
	gmask
 = 63,

112 
	gçl£
,

113 { 
	gshiá
 = 16, 
	gmask
 = 1, [0] = "movf.sFGC", "movt.sFGC" },

115 
	gçl£
, "recip.sFG", "rsqrt.sFG", false,

116 
	gçl£
, false, false, false,

117 
	gçl£
, false, false, false,

118 
	gçl£
, "cvt.d.sFG", false, false,

119 "cvt.w.sFG", "cvt.l.sFG", "cvt.ps.sFGH", 
	gçl£
,

120 
	gçl£
, false, false, false,

121 
	gçl£
, false, false, false,

128 
loÿl
 
	gm­_cİ1d
 = {

129 
shiá
 = 0, 
	gmask
 = 63,

134 
	gçl£
,

135 { 
	gshiá
 = 16, 
	gmask
 = 1, [0] = "movf.dFGC", "movt.dFGC" },

137 
	gçl£
, "recip.dFG", "rsqrt.dFG", false,

138 
	gçl£
, false, false, false,

139 
	gçl£
, false, false, false,

140 "cvt.s.dFG", 
	gçl£
, false, false,

141 "cvt.w.dFG", "cvt.l.dFG", 
	gçl£
, false,

142 
	gçl£
, false, false, false,

143 
	gçl£
, false, false, false,

150 
loÿl
 
	gm­_cİ1ps
 = {

151 
shiá
 = 0, 
	gmask
 = 63,

152 [0] = "add.psFGH", "sub.psFGH", "mul.psFGH", 
	gçl£
,

153 
	gçl£
, "abs.psFG", "mov.psFG", "neg.psFG",

154 
	gçl£
, false, false, false,

155 
	gçl£
, false, false, false,

156 
	gçl£
,

157 { 
	gshiá
 = 16, 
	gmask
 = 1, [0] = "movf.psFGC", "movt.psFGC" },

159 
	gçl£
, false, false, false,

160 
	gçl£
, false, false, false,

161 
	gçl£
, false, false, false,

162 "cvt.s.puFG", 
	gçl£
, false, false,

163 
	gçl£
, false, false, false,

164 "cvt.s.¶FG", 
	gçl£
, false, false,

172 
loÿl
 
	gm­_cİ1w
 = {

173 
shiá
 = 0, 
	gmask
 = 63,

177 
loÿl
 
	gm­_cİ1l
 = {

178 
shiá
 = 0, 
	gmask
 = 63,

182 
loÿl
 
	gm­_cİ1bc
 = {

183 
shiá
 = 16, 
	gmask
 = 3,

187 
loÿl
 
	gm­_cİ1
 = {

188 
shiá
 = 21, 
	gmask
 = 31,

191 
	gm­_cİ1bc
, 
	gçl£
, false, false,

192 
	gçl£
, false, false, false,

193 
	gm­_cİ1s
, 
	gm­_cİ1d
, 
	gçl£
, false,

194 
	gm­_cİ1w
, 
	gm­_cİ1l
, 
	gm­_cİ1ps
,

197 
loÿl
 
	gm­_cİ1x
 = {

198 
shiá
 = 0, 
	gmask
 = 63,

199 [0] = "lwxc1FSX", "ldxc1FSX", 
	gçl£
, false,

200 
	gçl£
, "luxc1FSX", false, false,

201 "swxc1FSX", "sdxc1FSX", 
	gçl£
, false,

202 
	gçl£
, "suxc1FSX", false, "prefxMSX",

203 
	gçl£
, false, false, false,

204 
	gçl£
, false, false, false,

205 
	gçl£
, false, false, false,

206 
	gçl£
, false, "alnv.psFGHS", false,

207 "madd.sFRGH", "madd.dFRGH", 
	gçl£
, false,

208 
	gçl£
, false, "madd.psFRGH", false,

209 "msub.sFRGH", "msub.dFRGH", 
	gçl£
, false,

210 
	gçl£
, false, "msub.psFRGH", false,

211 "nmadd.sFRGH", "nmadd.dFRGH", 
	gçl£
, false,

212 
	gçl£
, false, "nmadd.psFRGH", false,

213 "nmsub.sFRGH", "nmsub.dFRGH", 
	gçl£
, false,

214 
	gçl£
, false, "nmsub.psFRGH", false,

217 
loÿl
 
	gm­_´i
 = {

218 [0] = 
m­_¥ecŸl
, 
	gm­_»gimm
, "jJ", "jalJ",

222 
	gm­_cİ0
, 
	gm­_cİ1
, 
	gçl£
, 
	gm­_cİ1x
,

224 "daddiTSI", "daddiuTSI", 
	gçl£
, false,

225 
	gm­_¥ecŸl2
, "j®xJ", 
	gçl£
, 
	gm­_¥ecŸl3
,

227 "lbuTSO", "lhuTSO", "lwrTSO", 
	gçl£
,

229 
	gçl£
, false, "swrTSO", "cacheNSO",

231 
	gçl£
, "ldc1HSO", "ldc2TSO", "ldTSO",

232 "scTSO", "swc1HSO", "swc2TSO", 
	gçl£
,

233 
	gçl£
, "sdc1HSO", "sdc2TSO", "sdTSO",

238 
loÿl
 
	gm­_g´
 = {

247 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

248 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

249 
loÿl
 
pos
 = 
ùx
.pos

250 
loÿl
 
exŒa
 = ""

251 
ùx
.
»l
 
th’


252 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

253 
sym
 
th’
 
exŒa
 = "\t->"..sym 
’d


254 
’d


255 
ùx
.
hexdump
 > 0 
th’


256 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-7s %s%s\n",

257 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

259 
ùx
.
	`out
(
	`fÜm©
("%08x %-7s %s%s\n",

260 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

261 
’d


262 
ùx
.
pos
 =…os + 4

263 
’d


265 -- 
F®lback
 
unknown
 
İcodes
.

266 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

267  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

268 
’d


270 
loÿl
 
funùiÚ
 
	$g‘_be
(
ùx
)

271 
loÿl
 
pos
 = 
ùx
.pos

272 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

273  
	`bÜ
(
	`lshiá
(
b0
, 24),†shiá(
b1
, 16),†shiá(
b2
, 8), 
b3
)

274 
’d


276 
loÿl
 
funùiÚ
 
	$g‘_Ë
(
ùx
)

277 
loÿl
 
pos
 = 
ùx
.pos

278 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

279  
	`bÜ
(
	`lshiá
(
b3
, 24),†shiá(
b2
, 16),†shiá(
b1
, 8), 
b0
)

280 
’d


282 -- 
Di§s£mbË
 
a
 
sšgË
 
š¡ruùiÚ
.

283 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

284 
loÿl
 
İ
 = 
ùx
:
	$g‘
()

285 
loÿl
 
İ”ªds
 = {
	}
}

286 
loÿl
 
Ï¡
 = 
n


287 
ùx
.
İ
 = op

288 
ùx
.
»l
 = 
n


290 
loÿl
 
İ©
 = 
m­_´i
[
rshiá
(
İ
, 26)]

291 
ty³
(
İ©
) ~= "string" do

292 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


293 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)] 
Ü
 o·t.
_


294 
’d


295 
loÿl
 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9_.]*)(.*)")

296 
loÿl
 
®Šame
, 
·t2
 = 
	`m©ch
(
·t
, "|([a-z0-9_.|]*)(.*)")

297 
®Šame
 
th’
 
·t
 = 
·t2
 
’d


299 
p
 
š
 
	`gm©ch
(
·t
, ".") do

300 
loÿl
 
x
 = 
n


301 
p
 =ğ"S" 
th’


302 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 21), 31)]

303 
–£if
 
p
 =ğ"T" 
th’


304 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

305 
–£if
 
p
 =ğ"D" 
th’


306 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 11), 31)]

307 
–£if
 
p
 =ğ"F" 
th’


308 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 6), 31)

309 
–£if
 
p
 =ğ"G" 
th’


310 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 11), 31)

311 
–£if
 
p
 =ğ"H" 
th’


312 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 16), 31)

313 
–£if
 
p
 =ğ"R" 
th’


314 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 21), 31)

315 
–£if
 
p
 =ğ"A" 
th’


316 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 31)

317 
–£if
 
p
 =ğ"E" 
th’


318 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 31) + 32

319 
–£if
 
p
 =ğ"M" 
th’


320 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31)

321 
–£if
 
p
 =ğ"N" 
th’


322 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

323 
–£if
 
p
 =ğ"C" 
th’


324 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 18), 7)

325 
x
 =ğ0 
th’
 x = 
n
 
’d


326 
–£if
 
p
 =ğ"K" 
th’


327 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31) + 1

328 
–£if
 
p
 =ğ"P" 
th’


329 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31) + 33

330 
–£if
 
p
 =ğ"L" 
th’


331 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31è- 
Ï¡
 + 1

332 
–£if
 
p
 =ğ"Q" 
th’


333 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 11), 31è- 
Ï¡
 + 33

334 
–£if
 
p
 =ğ"I" 
th’


335 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

336 
–£if
 
p
 =ğ"U" 
th’


337 
x
 = 
	$bªd
(
İ
, 0xffff)

338 
–£if
 
p
 =ğ"O" 
th’


339 
loÿl
 
di¥
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

340 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%d(%s)", 
di¥
, 
Ï¡
)

341 
–£if
 
p
 =ğ"X" 
th’


342 
loÿl
 
šdex
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 16), 31)]

343 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%s(%s)", 
šdex
, 
Ï¡
)

344 
–£if
 
p
 =ğ"B" 
th’


345 
x
 = 
ùx
.
addr
 + ctx.
pos
 + 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)*4 + 4

346 
ùx
.
»l
 = 
x


347 
x
 = 
	`fÜm©
("0x%08x", x)

348 
–£if
 
p
 =ğ"J" 
th’


349 
loÿl
 
a
 = 
ùx
.
addr
 + ctx.
pos


350 
x
 = 
a
 - 
	`bªd
×, 0x0fffffffè+ bªd(
İ
, 0x03ffffff)*4

351 
ùx
.
»l
 = 
x


352 
x
 = 
	`fÜm©
("0x%08x", x)

353 
–£if
 
p
 =ğ"V" 
th’


354 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 8), 7)

355 
x
 =ğ0 
th’
 x = 
n
 
’d


356 
–£if
 
p
 =ğ"W" 
th’


357 
x
 = 
	$bªd
(
İ
, 7)

358 
x
 =ğ0 
th’
 x = 
n
 
’d


359 
–£if
 
p
 =ğ"Y" 
th’


360 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 0x000fffff)

361 
x
 =ğ0 
th’
 x = 
n
 
’d


362 
–£if
 
p
 =ğ"Z" 
th’


363 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 6), 1023)

364 
x
 =ğ0 
th’
 x = 
n
 
’d


365 
–£if
 
p
 =ğ"0" 
th’


366 
Ï¡
 =ğ"r0" 
Ü
†a¡ =ğ0 
th’


367 
loÿl
 
n
 = #operands

368 
İ”ªds
[
n
] = 
n


369 
Ï¡
 = 
İ”ªds
[
n
-1]

370 
®Šame
 
th’


371 
loÿl
 
a1
, 
a2
 = 
	`m©ch
(
®Šame
, "([^|]*)|(.*)")

372 
a1
 
th’
 
Çme
, 
®Šame
 =‡1, 
a2


373 
Çme
 = 
®Šame
 
’d


374 
’d


375 
’d


376 
–£if
 
p
 =ğ"1" 
th’


377 
Ï¡
 =ğ"¿" 
th’


378 
İ”ªds
[#İ”ªds] = 
n


379 
’d


381 
	$as£¹
(
çl£
)

382 
’d


383 
x
 
th’
 
İ”ªds
[#İ”ªds+1] = x; 
Ï¡
 = x 
’d


384 
’d


386  
	$putİ
(
ùx
, 
Çme
, 
İ”ªds
)

387 
’d


391 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

392 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

393 
nÙ
 
ofs
 
th’
 of ğ0 
’d


394 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


395 
¡İ
 = stop - stop % 4

396 
ùx
.
pos
 = 
ofs
 - ofs % 4

397 
ùx
.
»l
 = 
n


398 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


399 
’d


401 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

402 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

403 
loÿl
 
ùx
 = {
	}
}

404 
ùx
.
code
 = code

405 
ùx
.
addr
 =‡dd¸
Ü
 0

406 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


407 
ùx
.
symb
 = {}

408 
ùx
.
di§ss
 = 
di§ss_block


409 
ùx
.
hexdump
 = 8

410 
ùx
.
g‘
 = 
g‘_be


411  
ùx


412 
’d


414 
loÿl
 
funùiÚ
 
	$ü—‹_–
(
code
, 
addr
, 
out
)

415 
loÿl
 
ùx
 = 
	$ü—‹
(
code
, 
addr
, 
out
)

416 
ùx
.
g‘
 = 
g‘_Ë


417  
ùx


418 
’d


420 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

421 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

422 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

423 
’d


425 
loÿl
 
funùiÚ
 
	$di§ss_–
(
code
, 
addr
, 
out
)

426 
	$ü—‹_–
(
code
, 
addr
, 
out
):
	$di§ss
()

427 
’d


429 -- 
R‘uº
 
Çme
 
RID
.

430 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

431 
r
 < 32 
th’
  
m­_g´
[r] 
’d


432  "f"..(
r
-32)

433 
’d


435 -- 
Public
 
moduË
 
funùiÚs
.

437 
ü—‹
 = create,

438 
ü—‹_–
 = create_el,

439 
di§ss
 = disass,

440 
di§ss_–
 = disass_el,

441 
»gÇme
 =„egname

442 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mips64.lua

2 -- 
LuaJIT
 
MIPS64
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
the
 
	gbig
-
’dŸn
 
funùiÚs
 
äom
 
	gthe


8 -- 
MIPS
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_ms
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_mips")

13 
	gü—‹
 = 
dis_ms
.
ü—‹
,

14 
	gdi§ss
 = 
dis_ms
.
di§ss
,

15 
	g»gÇme
 = 
dis_ms
.
»gÇme


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mips64el.lua

2 -- 
LuaJIT
 
MIPS64EL
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
the
 
	gl™e
-
’dŸn
 
funùiÚs
 
äom
 
	gthe


8 -- 
MIPS
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_ms
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_mips")

13 
	gü—‹
 = 
dis_ms
.
ü—‹_–
,

14 
	gdi§ss
 = 
dis_ms
.
di§ss_–
,

15 
	g»gÇme
 = 
dis_ms
.
»gÇme


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mipsel.lua

2 -- 
LuaJIT
 
MIPSEL
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
the
 
	gl™e
-
’dŸn
 
funùiÚs
 
äom
 
	gthe


8 -- 
MIPS
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_ms
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_mips")

13 
	gü—‹
 = 
dis_ms
.
ü—‹_–
,

14 
	gdi§ss
 = 
dis_ms
.
di§ss_–
,

15 
	g»gÇme
 = 
dis_ms
.
»gÇme


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_ppc.lua

2 -- 
LuaJIT
 
PPC
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
	gMIT
/
X
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
It
 
di§s£mbËs
 
®l
 
	gcommÚ
, 
	gnÚ
-
	g´iveged
 32/64 
b™
 
Pow”PC
 
	gš¡ruùiÚs


10 -- 
¶us
 
the
 
e500
 
SPE
 
š¡ruùiÚs
 
ªd
 
some
 
	gC–l
/
X’Ú
 
	gex‹nsiÚs
.

12 -- 
	gNYI
: 
VMX
, 
	gVMX128


15 
loÿl
 
	gty³
 = 
ty³


16 
loÿl
 
by‹
, 
	gfÜm©
 = 
¡ršg
.by‹, 
	g¡ršg
.
fÜm©


17 
loÿl
 
	gm©ch
, 
	ggm©ch
, 
	ggsub
 = 
¡ršg
.
m©ch
, 
	g¡ršg
.gm©ch, sŒšg.
gsub


18 
loÿl
 
	gcÚÿt
 = 
bË
.
cÚÿt


19 
loÿl
 
b™
 = 
»quœe
("bit")

20 
loÿl
 
bªd
, 
	gbÜ
, 
	gtohex
 = 
b™
.bªd, 
	gb™
.bÜ, b™.
tohex


21 
loÿl
 
	glshiá
, 
	grshiá
, 
	g¬shiá
 = 
b™
.
lshiá
, 
	gb™
.rshift, bit.arshift

24 -- 
Prim¬y
 
ªd
 
ex‹nded
 
İcode
 
	gm­s


27 
loÿl
 
	gm­_üİs
 = {

28 
shiá
 = 1, 
	gmask
 = 1023,

38 
loÿl
 
	gm­_¾wšm
 = 
£tm‘©abË
({

39 
shiá
 = 0, 
mask
 = -1,

41 { 
__šdex
 = 
funùiÚ
(
t
, 
x
)

42 
loÿl
 
rÙ
 = 
bªd
(
rshiá
(
x
, 11), 31)

43 
loÿl
 
mb
 = 
bªd
(
rshiá
(
x
, 6), 31)

44 
loÿl
 
me
 = 
bªd
(
rshiá
(
x
, 1), 31)

45 
mb
 =ğ0 
ªd
 
me
 =ğ31-
rÙ
 
th’


47 
–£if
 
me
 =ğ31 
ªd
 
mb
 =ğ32-
rÙ
 
th’


51 
’d


52 
’d


55 
loÿl
 
	gm­_¾d
 = {

56 
shiá
 = 2, 
	gmask
 = 7,

59 
	gshiá
 = 1, 
	gmask
 = 1,

64 
loÿl
 
	gm­_ext
 = 
£tm‘©abË
({

65 
shiá
 = 1, 
mask
 = 1023,

94 [144] = { 
shiá
 = 20, 
mask
 = 1, [0] = "mtcrfRZ~", "mtocrfRZ~", },

95 [19] = { 
shiá
 = 20, 
mask
 = 1, [0] = "mfcrR", "mfocrfRZ", },

96 [371] = { 
shiá
 = 11, 
mask
 = 1023, [392] = "mftbR", [424] = "mftbuR", },

98 
shiá
 = 11, 
mask
 = 1023,

102 
shiá
 = 11, 
mask
 = 1023,

127 
shiá
 = 21, 
mask
 = 3,

169 { 
__šdex
 = 
funùiÚ
(
t
, 
x
)

170 
bªd
(
x
, 31è=ğ15 
th’
  "i£lRRRC" 
’d


171 
’d


174 
loÿl
 
	gm­_ld
 = {

175 
shiá
 = 0, 
	gmask
 = 3,

179 
loÿl
 
	gm­_¡d
 = {

180 
shiá
 = 0, 
	gmask
 = 3,

184 
loÿl
 
	gm­_ås
 = {

185 
shiá
 = 5, 
	gmask
 = 1,

187 
	gshiá
 = 1, 
	gmask
 = 15,

188 [0] = 
çl£
, 
	gçl£
, "fdivsFFF.", false,

189 "fsubsFFF.", "çddsFFF.", "fsq¹sF-F.", 
	gçl£
,

190 "äesF-F.", "fmulsFF-F.", "äsq¹esF-F.", 
	gçl£
,

195 
loÿl
 
	gm­_åd
 = {

196 
shiá
 = 5, 
	gmask
 = 1,

198 
shiá
 = 1, 
	gmask
 = 1023,

211 
	gshiá
 = 1, 
	gmask
 = 15,

212 [0] = 
çl£
, 
	gçl£
, "fdivFFF.", false,

214 "äeF-F.", "fmulFF-F.", "äsq¹eF-F.", 
	gçl£
,

219 
loÿl
 
	gm­_¥e
 = {

220 
shiá
 = 0, 
	gmask
 = 2047,

356 
loÿl
 
	gm­_´i
 = {

357 [0] = 
çl£
, 
	gçl£
, "tdiARI", "twiARI",

358 
	gm­_¥e
, 
	gçl£
, false, "mulliRRI",

359 "subficRRI", 
	gçl£
, "cmpl_iYLRU", "cmp_iYLRI",

361 "b_KBJ", "sc", "bKJ", 
	gm­_üİs
,

362 "¾wimiRR~AAA.", 
	gm­_¾wšm
, 
	gçl£
, "rlwnmRR~RAA.",

364 "ªdi.RR~U", "ªdis.RR~U", 
	gm­_¾d
, 
	gm­_ext
,

371 
	gçl£
, f®£, 
	gm­_ld
, 
	gm­_ås
,

372 
	gçl£
, f®£, 
	gm­_¡d
, 
	gm­_åd
,

377 
loÿl
 
	gm­_g´
 = {

384 
loÿl
 
	gm­_cÚd
 = { [0] = "lt", "gt", "eq", "so", "ge", "le", "ne", "ns", }

386 -- 
FÜm©
 
a
 
cÚd™iÚ
 
	gb™
.

387 
loÿl
 
funùiÚ
 
	$cÚdfmt
(
cÚd
)

388 
cÚd
 <ğ3 
th’


389  
m­_cÚd
[
	`bªd
(
cÚd
, 3)]

391  
	`fÜm©
("4*ü%d+%s", 
	`rshiá
(
cÚd
, 2), 
m­_cÚd
[
	`bªd
(cond, 3)])

392 
’d


393 
’d


397 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
İ”ªds
.

398 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

399 
loÿl
 
pos
 = 
ùx
.pos

400 
loÿl
 
exŒa
 = ""

401 
ùx
.
»l
 
th’


402 
loÿl
 
sym
 = 
ùx
.
symb
[ùx.
»l
]

403 
sym
 
th’
 
exŒa
 = "\t->"..sym 
’d


404 
’d


405 
ùx
.
hexdump
 > 0 
th’


406 
ùx
.
	`out
(
	`fÜm©
("%08x %s %-7s %s%s\n",

407 
ùx
.
addr
+
pos
, 
	`tohex
(ùx.
İ
), 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

409 
ùx
.
	`out
(
	`fÜm©
("%08x %-7s %s%s\n",

410 
ùx
.
addr
+
pos
, 
‹xt
, 
	`cÚÿt
(
İ”ªds
, ", "), 
exŒa
))

411 
’d


412 
ùx
.
pos
 =…os + 4

413 
’d


415 -- 
F®lback
 
unknown
 
İcodes
.

416 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

417  
	`putİ
(
ùx
, ".lÚg", { "0x"..
	`tohex
(ùx.
İ
è
	}
})

418 
	g’d


420 -- 
Di§s£mbË
 
a
 
sšgË
 
	gš¡ruùiÚ
.

421 
loÿl
 
funùiÚ
 
	$di§ss_šs
(
ùx
)

422 
loÿl
 
pos
 = 
ùx
.pos

423 
loÿl
 
b0
, 
b1
, 
b2
, 
b3
 = 
	`by‹
(
ùx
.
code
, 
pos
+1,…os+4)

424 
loÿl
 
İ
 = 
	`bÜ
(
	`lshiá
(
b0
, 24),†shiá(
b1
, 16),†shiá(
b2
, 8), 
b3
)

425 
loÿl
 
İ”ªds
 = {
	}
}

426 
loÿl
 
Ï¡
 = 
n


427 
loÿl
 
rs
 = 21

428 
ùx
.
İ
 = op

429 
ùx
.
»l
 = 
n


431 
loÿl
 
İ©
 = 
m­_´i
[
rshiá
(
b0
, 2)]

432 
ty³
(
İ©
) ~= "string" do

433 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


434 
İ©
 = o·t[
	`bªd
(
	`rshiá
(
İ
, o·t.
shiá
), o·t.
mask
)]

435 
’d


436 
loÿl
 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9_.]*)(.*)")

437 
loÿl
 
®Šame
, 
·t2
 = 
	`m©ch
(
·t
, "|([a-z0-9_.]*)(.*)")

438 
®Šame
 
th’
 
·t
 = 
·t2
 
’d


440 
p
 
š
 
	`gm©ch
(
·t
, ".") do

441 
loÿl
 
x
 = 
n


442 
p
 =ğ"R" 
th’


443 
x
 = 
m­_g´
[
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31)]

444 
rs
 =„s - 5

445 
–£if
 
p
 =ğ"F" 
th’


446 
x
 = "f"..
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31)

447 
rs
 =„s - 5

448 
–£if
 
p
 =ğ"A" 
th’


449 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31)

450 
rs
 =„s - 5

451 
–£if
 
p
 =ğ"S" 
th’


452 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 27-
rs
), 27)

453 
rs
 =„s - 5

454 
–£if
 
p
 =ğ"I" 
th’


455 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

456 
–£if
 
p
 =ğ"U" 
th’


457 
x
 = 
	$bªd
(
İ
, 0xffff)

458 
–£if
 
p
 =ğ"D" 
Ü
… =ğ"E" 
th’


459 
loÿl
 
di¥
 = 
	`¬shiá
(
	`lshiá
(
İ
, 16), 16)

460 
p
 =ğ"E" 
th’
 
di¥
 = 
	`bªd
(di¥, -4è
’d


461 
Ï¡
 =ğ"r0" 
th’
†a¡ = "0" 
’d


462 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%d(%s)", 
di¥
, 
Ï¡
)

463 
–£if
 
p
 >ğ"2" 
ªd
… <ğ"8" 
th’


464 
loÿl
 
di¥
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31è* 
p


465 
Ï¡
 =ğ"r0" 
th’
†a¡ = "0" 
’d


466 
İ”ªds
[#İ”ªds] = 
	`fÜm©
("%d(%s)", 
di¥
, 
Ï¡
)

467 
–£if
 
p
 =ğ"H" 
th’


468 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31è+ 
	`lshiá
(band(op, 2), 4)

469 
rs
 =„s - 5

470 
–£if
 
p
 =ğ"M" 
th’


471 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31è+ 
	$bªd
(
İ
, 0x20)

472 
–£if
 
p
 =ğ"C" 
th’


473 
x
 = 
	`cÚdfmt
(
	`bªd
(
	`rshiá
(
İ
, 
rs
), 31))

474 
rs
 =„s - 5

475 
–£if
 
p
 =ğ"B" 
th’


476 
loÿl
 
bo
 = 
	$rshiá
(
İ
, 21)

477 
loÿl
 
cÚd
 = 
	`bªd
(
	`rshiá
(
İ
, 16), 31)

478 
loÿl
 
ú
 = ""

479 
rs
 =„s - 10

480 
	`bªd
(
bo
, 4è=ğ0 
th’


481 
ú
 = 
	`bªd
(
bo
, 2è=ğ0 
ªd
 "dnz" 
Ü
 "dz"

482 
	`bªd
(
bo
, 0x10è=ğ0 
th’


483 
ú
 = cn..(
	`bªd
(
bo
, 8è=ğ0 
ªd
 "f" 
Ü
 "t")

484 
’d


485 
	`bªd
(
bo
, 0x10è=ğ0 
th’
 
x
 = 
	$cÚdfmt
(
cÚd
è
’d


486 
Çme
 =‚ame..(
	`bªd
(
bo
, 1è=ğbªd(
	`rshiá
(
İ
, 15), 1è
ªd
 "-" 
Ü
 "+")

487 
–£if
 
	`bªd
(
bo
, 0x10è=ğ0 
th’


488 
ú
 = 
m­_cÚd
[
	`bªd
(
cÚd
, 3è+ (bªd(
bo
, 8è=ğ0 
ªd
 4 
Ü
 0)]

489 
cÚd
 > 3 
th’
 
x
 = "ü"..
	$rshiá
(
cÚd
, 2è
’d


490 
Çme
 =‚ame..(
	`bªd
(
bo
, 1è=ğbªd(
	`rshiá
(
İ
, 15), 1è
ªd
 "-" 
Ü
 "+")

491 
’d


492 
Çme
 = 
	`gsub
Òame, "_", 
ú
)

493 
–£if
 
p
 =ğ"J" 
th’


494 
x
 = 
	`¬shiá
(
	`lshiá
(
İ
, 27-
rs
), 29-rs)*4

495 
	`bªd
(
İ
, 2è=ğ0 
th’
 
x
 = 
ùx
.
addr
 + 
pos
 + x 
’d


496 
ùx
.
»l
 = 
x


497 
x
 = "0x"..
	$tohex
(
x
)

498 
–£if
 
p
 =ğ"K" 
th’


499 
	`bªd
(
İ
, 1è~ğ0 
th’
 
Çme
 =‚ame.."l" 
’d


500 
	`bªd
(
İ
, 2è~ğ0 
th’
 
Çme
 =‚ame.."a" 
’d


501 
–£if
 
p
 =ğ"X" 
Ü
… =ğ"Y" 
th’


502 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
+2), 7)

503 
x
 =ğ0 
ªd
 
p
 =ğ"Y" 
th’
 x = 
n
 x = "ü"..x 
’d


504 
rs
 =„s - 5

505 
–£if
 
p
 =ğ"W" 
th’


506 
x
 = "ü"..
	$bªd
(
İ
, 7)

507 
–£if
 
p
 =ğ"Z" 
th’


508 
x
 = 
	`bªd
(
	`rshiá
(
İ
, 
rs
-4), 255)

509 
rs
 =„s - 10

510 
–£if
 
p
 =ğ">" 
th’


511 
İ”ªds
[#İ”ªds] = 
	`rshiá
(operands[#operands], 1)

512 
–£if
 
p
 =ğ"0" 
th’


513 
Ï¡
 =ğ"r0" 
th’


514 
İ”ªds
[#İ”ªds] = 
n


515 
®Šame
 
th’
 
Çme
 =‡ÉÇm
’d


516 
’d


517 
–£if
 
p
 =ğ"L" 
th’


518 
Çme
 = 
	`gsub
Òame, "_", 
	`bªd
(
İ
, 0x00200000è~ğ0 
ªd
 "d" 
Ü
 "w")

519 
–£if
 
p
 =ğ"." 
th’


520 
	`bªd
(
İ
, 1è=ğ1 
th’
 
Çme
 =‚ame.."." 
’d


521 
–£if
 
p
 =ğ"N" 
th’


522 
İ
 =ğ0x60000000 
th’
 
Çme
 = "nİ";  
’d


523 
–£if
 
p
 =ğ"~" 
th’


524 
loÿl
 
n
 = #operands

525 
İ”ªds
[
n
-1], operands[n] = operands[n], operands[n-1]

526 
–£if
 
p
 =ğ"=" 
th’


527 
loÿl
 
n
 = #operands

528 
Ï¡
 =ğ
İ”ªds
[
n
-1] 
th’


529 
İ”ªds
[
n
] = 
n


530 
Çme
 = 
®Šame


531 
’d


532 
–£if
 
p
 =ğ"%" 
th’


533 
loÿl
 
n
 = #operands

534 
Ï¡
 =ğ
İ”ªds
[
n
-1] 
ªd
†a¡ =ğİ”ªds[n-2] 
th’


535 
İ”ªds
[
n
] = 
n


536 
İ”ªds
[
n
-1] = 
n


537 
Çme
 = 
®Šame


538 
’d


539 
–£if
 
p
 =ğ"-" 
th’


540 
rs
 =„s - 5

542 
	$as£¹
(
çl£
)

543 
’d


544 
x
 
th’
 
İ”ªds
[#İ”ªds+1] = x; 
Ï¡
 = x 
’d


545 
’d


547  
	$putİ
(
ùx
, 
Çme
, 
İ”ªds
)

548 
’d


552 -- 
Di§s£mbË
 
a
 
block
 
of
 
code
.

553 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

554 
nÙ
 
ofs
 
th’
 of ğ0 
’d


555 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


556 
¡İ
 = stop - stop % 4

557 
ùx
.
pos
 = 
ofs
 - ofs % 4

558 
ùx
.
»l
 = 
n


559 
ùx
.
pos
 < 
¡İ
 dØ
	$di§ss_šs
(
ùx
è
’d


560 
’d


562 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

563 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

564 
loÿl
 
ùx
 = {
	}
}

565 
ùx
.
code
 = code

566 
ùx
.
addr
 =‡dd¸
Ü
 0

567 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


568 
ùx
.
symb
 = {}

569 
ùx
.
di§ss
 = 
di§ss_block


570 
ùx
.
hexdump
 = 8

571  
ùx


572 
’d


574 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

575 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

576 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

577 
’d


579 -- 
R‘uº
 
Çme
 
RID
.

580 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

581 
r
 < 32 
th’
  
m­_g´
[r] 
’d


582  "f"..(
r
-32)

583 
’d


585 -- 
Public
 
moduË
 
funùiÚs
.

587 
ü—‹
 = create,

588 
di§ss
 = disass,

589 
»gÇme
 =„egname

590 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_x64.lua

2 -- 
LuaJIT
 
x64
 
di§s£mbËr
 
w¿µ”
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
moduË
 
ju¡
 
expÜts
 
	gthe
 64 
b™
 
funùiÚs
 
äom
 
the
 
	gcombšed


8 -- 
	gx86
/
x64
 
di§s£mbËr
 
	gmoduË
. 
AÎ
 
the
 
š‹»¡šg
 
¡uff
 
is
 
	gth”e
.

11 
loÿl
 
	gdis_x86
 = 
»quœe
((
¡ršg
.
m©ch
(..., ".*%."è
Ü
 "").."dis_x86")

13 
	gü—‹
 = 
dis_x86
.
ü—‹64
,

14 
	gdi§ss
 = 
dis_x86
.
di§ss64
,

15 
	g»gÇme
 = 
dis_x86
.
»gÇme64


	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_x86.lua

2 -- 
LuaJIT
 
	gx86
/
x64
 
di§s£mbËr
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


7 -- 
This
 
is
 
a
 
h–³r
 
moduË
 
u£d
 
by
 
the
 
LuaJIT
 
machše
 
code
 
dum³r
 
	gmoduË
.

9 -- 
S’dšg
 
sm®l
 
code
 
¢³ts
 
to
 
ª
 
ex‹º®
 
di§s£mbËr
 
ªd
 
mixšg
 
	gthe


10 -- 
ouut
 
w™h
 
our
 
own
 
¡uff
 
was
 
too
 
	gäage
. 
So
 
I
 
had
 
to
 
b™e
 
the
 
	gbuÎ‘


11 -- 
ªd
 
wr™e
 
y‘
 
ªÙh”
 
x86
 
	gdi§s£mbËr
. 
Oh
 
	gw–l
 ...

13 -- 
The
 
ouut
 
fÜm©
 
is
 
v”y
 
sim¬
 
to
 
wh©
 
ndi§sm
 
	gg’”©es
. 
But
 
™
 
	ghas


14 -- 
b“n
 
dev–İed
 
šd•’d’y
 
by
 
lookšg
 
©
 
the
 
İcode
 
bËs
 
äom
 
	gthe


15 -- 
IÁ–
 
ªd
 
AMD
 
	gmªu®s
. 
The
 
suµÜ‹d
 
š¡ruùiÚ
 
£t
 
is
 
qu™e
 
	gex‹nsive


16 -- 
ªd
 
»æeùs
 
wh©
 
a
 
cu¼’t
 
g’”©iÚ
 
IÁ–
 
Ü
 
AMD
 
CPU
 
im¶em’ts
 
	gš


17 -- 32 
b™
 
	gªd
 64 b™ 
	gmode
. 
	gYes
, 
this
 
šşudes
 
	gMMX
, 
	gSSE
, 
	gSSE2
, 
	gSSE3
, 
	gSSSE3
,

18 -- 
	gSSE4
.1, SSE4.2, 
	gSSE4a
, 
	gAVX
, 
AVX2
 
ªd
 
ev’
 
´iveged
‡nd 
	ghy³rvisÜ


19 -- (
	gVMX
/
	gSVM
è
	gš¡ruùiÚs
.

21 -- 
	gNÙes
:

22 -- * 
	$The
 (
u£Ëss
è
a16
 
´efix
, 3D
Now
 
ªd
 
´e
-586 
İcodes
 
¬e
 
unsuµÜ‹d
.

23 -- * 
No
 
©‹m±
 
©
 
İtimiz©iÚ
 
has
 
b“n
 
made
 -- 
™
's fastƒnough for my‚eeds.

26 
loÿl
 
ty³
 =ype

27 
loÿl
 
sub
, 
by‹
, 
fÜm©
 = 
¡ršg
.sub, string.byte, string.format

28 
loÿl
 
m©ch
, 
gm©ch
, 
gsub
 = 
¡ršg
.match, string.gmatch, string.gsub

29 
loÿl
 
low”
, 
»p
 = 
¡ršg
.lower, string.rep

30 
loÿl
 
b™
 = 
	`»quœe
("bit")

31 
loÿl
 
tohex
 = 
b™
.tohex

33 -- 
M­
 1
¡
 
İcode
 
by‹
 
š
 32 
b™
 
mode
. 
Ugly
? 
W–l
 ... 
»ad
 
Ú
.

34 
loÿl
 
m­_İc1_32
 = {

71 --
Ax


76 --
Bx


79 --
Cx


82 --
Dx


85 --
Ex


89 --
Fx


92 
	}
}

93 
as£¹
(#map_opc1_32 == 255)

95 -- 
M­
 1
¡
 
İcode
 
by‹
 
š
 64 
b™
 
mode
 (
ov”rides
 
Úly
).

96 
loÿl
 
m­_İc1_64
 = 
£tm‘©abË
({

97 [0x06]=
çl£
, [0x07]=false, [0x0e]=false,

98 [0x16]=
çl£
, [0x17]=false, [0x1e]=false, [0x1f]=false,

99 [0x27]=
çl£
, [0x2f]=false, [0x37]=false, [0x3f]=false,

100 [0x60]=
çl£
, [0x61]=false, [0x62]=false, [0x63]="movsxdVrDmt", [0x67]="a32:",

105 [0x82]=
çl£
, [0x9a]=false, [0xc4]="vex*3", [0xc5]="vex*2", [0xce]=false,

106 [0xd4]=
çl£
, [0xd5]=false, [0xd6]=false, [0xea]=false,

107 }, { 
__šdex
 = 
m­_İc1_32
 })

109 -- 
M­
 2
nd
 
İcode
 
by‹
 (0F 
xx
). 
True
 
CISC
 
	gh–l
. 
	gHey
, 
I
 
tŞd
 
	gyou
.

110 -- 
P»fix
 
d•’d’t
 
	gMMX
/
SSE
 
	gİcodes
: (
nÚe
)|
»p
|
o16
|
»²e
, -|
	gF3
|66|
F2


111 
loÿl
 
	gm­_İc2
 = {

113 [0]="¦dt!Dmp","sgdt!Ump","ÏrVrm","l¦Vrm",
	gn
,"syscall","clts","sysret",

114 "švd","wbšvd",
	gn
,"ud1",nil,"$prefetch!Bm","femms","3dnowMrmu",

127 "movUmx$","movUmy$","movUxm$","movUym$","movUmz$",
	gn
,"movUzm$",nil,

137 "wrm¤","rdtsc","rdm¤","rdpmc","sy£Á”","sy£x™",
	gn
,"getsec",

138 "İc3*38",
	gn
,"opc3*3a",nil,nil,nil,nil,nil,

165 
	gn
,nil,

174 --
	gAx


175 "push fs","pİ fs","ıuid","btVmr","shldVmru","shldVmrc",
	gn
,nil,

177 --
	gBx


182 --
	gCx


188 --
	gDx


194 --
	gEx


200 --
	gFx


206 
as£¹
(
m­_İc2
[255] == "ud")

208 -- 
M­
 
th»e
-
by‹
 
İcodes
. 
Cª
't wait forheir‚ext invention.

209 
loÿl
 
m­_İc3
 = {

210 ["38"] = { -- [66] 0à38 
xx


215 "||³rmpsXrvm","||³rmpdXrvm",
	gn
,nil,

217 "||pbËndvbXrma",
	gn
,nil,nil,

219 "||brßdÿ¡ssXrm","||brßdÿ¡sdXrm","||brßdÿ¡f128X¾Xm",
	gn
,

220 "·bsbPrm","·bswPrm","·bsdPrm",
	gn
,

223 "||pmovsxwqXrm","||pmovsxdqXrm",
	gn
,nil,

232 "||pmulddXrvm","||phmšposuwXrm",
	gn
,nil,

233 
	gn
,"||psrlvVSXrvm","||psravdXrvm","||psllvVSXrvm",

242 --
	gDx


245 --
	gFx


250 ["3a"] = { -- [66] 0à3¨
xx


252 [0x00]="||³rmqXrmu","||³rmpdXrmu","||pbËnddXrvmu",
	gn
,

253 "||³rmpsXrmu","||³rmpdXrmu","||³rm2f128Xrvmu",
	gn
,

257 
	gn
,nil,nil,nil,

259 "||š£¹f128XrvlXmu","||exŒaùf128XlXmYru",
	gn
,nil,

260 
	gn
,nil,nil,nil,

262 "||pš¤bXrvVmu","||š£¹psXrvmu","||pš¤XrvVmuS",
	gn
,

277 --
	gFx


282 -- 
M­
 
	gVMX
/
SVM
 
	gİcodes
 0F 01 
	gC0
-
FF
 (
sgdt
 
group
 
w™h
 
İ”ªds
).

283 
loÿl
 
	gm­_İcvm
 = {

291 -- 
M­
 
FP
 
	gİcodes
. 
And
 
you
 
thought
 
¡ack
 
machšes
 
¬e
 
	gsim¶e
?

292 
loÿl
 
	gm­_İcå
 = {

293 -- 
D8
-
DF
 00-
BF
: 
İcodes
 
w™h
 
a
 
memÜy
 
İ”ªd
.

294 -- 
D8


296 "ædFm",
	gn
,"fstFm","fstpFm","fldenvVm","fldcwWm","fnstenvVm","fnstcwWm",

297 -- 
	gDA


300 -- 
	gDB


301 "fdDm","fi¡Dm","fi¡Dm","fi¡pDm",
	gn
,"fldwordFmp",nil,"fstpwordFmp",

302 -- 
	gDC


304 -- 
	gDD


305 "ædGm","fi¡Qm","f¡Gm","f¡pGm","ä¡ÜDmp",
	gn
,"fnsaveDmp","fnstswWm",

306 -- 
	gDE


309 -- 
	gDF


312 -- 
xx
 
	gC0
-
	gFF
: 
İcodes
 
w™h
 
a
 
p£udo
-
İ”ªd
.

313 -- 
D8


315 -- 
	gD9


316 "ædFf","fxchFf",{"âİ"},
	gn
,

317 {"fchs","çbs",
	gn
,nil,"ftst","fxam"},

321 -- 
	gDA


322 "fcmovbFf","fcmoveFf","fcmovbeFf","fcmovuFf",
	gn
,{nil,"fucompp"},nil,nil,

323 -- 
	gDB


325 {
	gn
,nil,"fnclex","fninit"},"fucomiFf","fcomiFf",nil,

326 -- 
	gDC


327 "çddoFf","fmuÈtoFf",
	gn
,nil,

329 -- 
	gDD


330 "fä“Ff",
	gn
,"fstFf","fstpFf","fucomFf","fucompFf",nil,nil,

331 -- 
	gDE


332 "çddpFf","fmuÍFf",
	gn
,{nil,"fcompp"},

334 -- 
DF


335 
	gn
,nil,nil,nil,{"fnstsw‡x"},"fucomipFf","fcomipFf",nil,

337 
as£¹
(
m­_İcå
[126] == "fcomipFf")

339 -- 
M­
 
İcode
 
groups
. 
The
 
subkey
 
is
 
¥
 
äom
 
the
 
ModRM
 
by‹
.

340 
loÿl
 
m­_İcgroup
 = {

341 
¬™h
 = { "add", "or", "adc", "sbb", "and", "sub", "xor", "cmp" },

342 
	gshiá
 = { "rol", "ror", "rcl", "rcr", "shl", "shr", "sal", "sar" },

343 
	g‹¡b
 = { "testBmi", "testBmi", "not", "neg", "mul", "imul", "div", "idiv" },

344 
	g‹¡v
 = { "testVmi", "testVmi", "not", "neg", "mul", "imul", "div", "idiv" },

345 
	gšcb
 = { "inc", "dec" },

346 
	gšcd
 = { "inc", "dec", "callUmp", "$call farDmp",

348 
	g¦dt
 = { "sldt", "str", "lldt", "ltr", "verr", "verw" },

349 
	gsgdt
 = { "vm*$sgdt", "vm*$sidt", "$lgdt", "vm*$lidt",

350 "smsw", 
n
, "lmsw", "vm*$invlpg" },

351 
	gbt
 = { 
n
,‚il,‚il,‚il, "bt", "bts", "btr", "btc" },

352 
	gcmpxchg
 = { 
n
, "sz*,cmpxchg8bQmp,cmpxchg16bXmp",‚il,‚il,

353 
n
,‚il, "vmptrld|vmxon|vmclear", "vmptrst" },

354 
	gpshiáw
 = { 
n
,‚il, "psrlw",‚il, "psraw",‚il, "psllw" },

355 
	gpshiád
 = { 
n
,‚il, "psrld",‚il, "psrad",‚il, "pslld" },

356 
	gpshiáq
 = { 
n
,‚il, "psrlq",‚il,‚il,‚il, "psllq" },

357 
	gpshiádq
 = { 
n
,‚il, "psrlq", "psrldq",‚il,‚il, "psllq", "pslldq" },

358 
	gfx§ve
 = { "$fxsave", "$fxrstor", "$ldmxcsr", "$stmxcsr",

359 
n
, "lfenceDp$", "mfenceDp$", "sfenceDp$clflush" },

360 
	g´eãtch
 = { "prefetch", "prefetchw" },

361 
	g´eãtcht
 = { "prefetchnta", "prefetcht0", "prefetcht1", "prefetcht2" },

366 -- 
M­s
 
	gÇmes
.

367 
loÿl
 
	gm­_»gs
 = {

368 
B
 = { "al", "cl", "dl", "bl", "ah", "ch", "dh", "bh",

370 
	gB64
 = { "al", "cl", "dl", "bl", "spl", "bpl", "sil", "dil",

372 
	gW
 = { "ax", "cx", "dx", "bx", "sp", "bp", "si", "di",

374 
	gD
 = { "eax", "ecx", "edx", "ebx", "esp", "ebp", "esi", "edi",

376 
	gQ
 = { "rax", "rcx", "rdx", "rbx", "rsp", "rbp", "rsi", "rdi",

378 
	gM
 = { "mm0", "mm1", "mm2", "mm3", "mm4", "mm5", "mm6", "mm7",

379 "mm0", "mm1", "mm2", "mm3", "mm4", "mm5", "mm6", "mm7" }, -- 
No
 
x64
 
	gext
!

380 
	gX
 = { "xmm0", "xmm1", "xmm2", "xmm3", "xmm4", "xmm5", "xmm6", "xmm7",

382 
	gY
 = { "ymm0", "ymm1", "ymm2", "ymm3", "ymm4", "ymm5", "ymm6", "ymm7",

385 
loÿl
 
	gm­_£g»gs
 = { "es", "cs", "ss", "ds", "fs", "gs", "segr6", "segr7" }

387 -- 
M­s
 
size
 
Çmes
.

388 
loÿl
 
m­_sz2n
 = {

389 
B
 = 1, 
	gW
 = 2, 
	gD
 = 4, 
	gQ
 = 8, 
	gM
 = 8, 
	gX
 = 16, 
	gY
 = 32,

391 
loÿl
 
	gm­_sz2´efix
 = {

392 
B
 = "by‹", 
	gW
 = "wÜd", 
	gD
 = "dword",

393 
	gQ
 = "qword",

394 
	gM
 = "qwÜd", 
	gX
 = "xwÜd", 
	gY
 = "yword",

395 
	gF
 = "dwÜd", 
	gG
 = "qwÜd", -- 
No
 
Ãed
 
	gsizes
/
Çmes
 
the£
 
	gtwo
.

400 -- 
Ouut
 
a
 
niûly
 
fÜm©‹d
 
lše
 
w™h
 
ª
 
İcode
 
ªd
 
	gİ”ªds
.

401 
loÿl
 
funùiÚ
 
	$putİ
(
ùx
, 
‹xt
, 
İ”ªds
)

402 
loÿl
 
code
, 
pos
, 
hex
 = 
ùx
.code, ctx.pos, ""

403 
loÿl
 
hmax
 = 
ùx
.
hexdump


404 
hmax
 > 0 
th’


405 
i
=
ùx
.
¡¬t
,
pos
-1 do

406 
hex
 = hex..
	`fÜm©
("%02X", 
	$by‹
(
code
, 
i
, i))

407 
’d


408 #hex > 
hmax
 
th’
 
hex
 = 
	`sub
(hex, 1, hmax)..". "

409 
hex
 = hex..
	`»p
(" ", 
hmax
-#hex+2è
’d


410 
’d


411 
İ”ªds
 
th’
 
‹xt
 =ext.." "..İ”ªd 
’d


412 
ùx
.
o16
 
th’
 
‹xt
 = "o16 "..‹xt; ctx.o16 = 
çl£
 
’d


413 
ùx
.
a32
 
th’
 
‹xt
 = "a32 "..‹xt; ctx.a32 = 
çl£
 
’d


414 
ùx
.
»p
 
th’
 
‹xt
 = ctx.»p.." "..‹xt; ctx.»°ğ
çl£
 
’d


415 
ùx
.
»x
 
th’


416 
loÿl
 
t
 = (
ùx
.
»xw
 
ªd
 "w" 
Ü
 "")..(ùx.
»xr
‡nd "r" or "")..

417 (
ùx
.
»xx
 
ªd
 "x" 
Ü
 "")..(ùx.
»xb
‡nd "b" or "")..

418 (
ùx
.
vexl
 
ªd
 "l" 
Ü
 "")

419 
ùx
.
vexv
 
ªd
 ctx.vexv ~ğ0 
th’
 
t
 =.."v"..ùx.vexv 
’d


420 
t
 ~ğ"" 
th’
 
‹xt
 = 
ùx
.
»x
.."."..t.." "..
	`gsub
(text, "^ ", "")

421 
–£if
 
ùx
.
»x
 =ğ"vex" 
th’
 
‹xt
 = 
	`gsub
("v"..‹xt, "^v ", ""è
’d


422 
ùx
.
»xw
 = 
çl£
; ctx.
»xr
 = f®£; ctx.
»xx
 = f®£; ctx.
»xb
 = false

423 
ùx
.
»x
 = 
çl£
; ctx.
vexl
 = f®£; ctx.
vexv
 = false

424 
’d


425 
ùx
.
£g
 
th’


426 
loÿl
 
‹xt2
, 
n
 = 
	`gsub
(
‹xt
, "%[", "["..
ùx
.
£g
..":")

427 
n
 =ğ0 
th’
 
‹xt
 = 
ùx
.
£g
.." "..‹xˆ‹xˆğ
‹xt2
 
’d


428 
ùx
.
£g
 = 
çl£


429 
’d


430 
ùx
.
lock
 
th’
 
‹xt
 = "lock "..‹xt; ctx.lock = 
çl£
 
’d


431 
loÿl
 
imm
 = 
ùx
.imm

432 
imm
 
th’


433 
loÿl
 
sym
 = 
ùx
.
symb
[
imm
]

434 
sym
 
th’
 
‹xt
 =ext.."\t->"..sym 
’d


435 
’d


436 
ùx
.
	`out
(
	`fÜm©
("%08x %s%s\n", ctx.
addr
+ùx.
¡¬t
, 
hex
, 
‹xt
))

437 
ùx
.
mrm
 = 
çl£


438 
ùx
.
vexv
 = 
çl£


439 
ùx
.
¡¬t
 = 
pos


440 
ùx
.
imm
 = 
n


441 
’d


443 -- 
CË¬
 
®l
 
´efix
 
æags
.

444 
loÿl
 
funùiÚ
 
	$ş—½»fixes
(
ùx
)

445 
ùx
.
o16
 = 
çl£
; ctx.
£g
 = f®£; ctx.
lock
 = f®£; ctx.
»p
 = false

446 
ùx
.
»xw
 = 
çl£
; ctx.
»xr
 = f®£; ctx.
»xx
 = f®£; ctx.
»xb
 = false

447 
ùx
.
»x
 = 
çl£
; ctx.
a32
 = f®£; ctx.
vexl
 = false

448 
’d


450 -- 
F®lback
 
šcom¶‘e
 
İcodes
 
©
 
the
 
’d
.

451 
loÿl
 
funùiÚ
 
	$šcom¶‘e
(
ùx
)

452 
ùx
.
pos
 = ctx.
¡İ
+1

453 
	$ş—½»fixes
(
ùx
)

454  
	`putİ
(
ùx
, "(incomplete)")

455 
’d


457 -- 
F®lback
 
unknown
 
İcodes
.

458 
loÿl
 
funùiÚ
 
	$unknown
(
ùx
)

459 
	$ş—½»fixes
(
ùx
)

460  
	`putİ
(
ùx
, "(unknown)")

461 
’d


463 -- 
R‘uº
 
ª
 
immedŸ‹
 
of
 
the
 
¥ecif›d
 
size
.

464 
loÿl
 
funùiÚ
 
	$g‘imm
(
ùx
, 
pos
, 
n
)

465 
pos
+
n
-1 > 
ùx
.
¡İ
 
th’
  
	$šcom¶‘e
(
ùx
è
’d


466 
loÿl
 
code
 = 
ùx
.code

467 
n
 =ğ1 
th’


468 
loÿl
 
b1
 = 
	$by‹
(
code
, 
pos
,…os)

469  
b1


470 
–£if
 
n
 =ğ2 
th’


471 
loÿl
 
b1
, 
b2
 = 
	`by‹
(
code
, 
pos
,…os+1)

472  
b1
+
b2
*256

474 
loÿl
 
b1
, 
b2
, 
b3
, 
b4
 = 
	`by‹
(
code
, 
pos
,…os+3)

475 
loÿl
 
imm
 = 
b1
+
b2
*256+
b3
*65536+
b4
*16777216

476 
ùx
.
imm
 = imm

477  
imm


478 
’d


479 
’d


481 -- 
Proûss
 
·‰”n
 
¡ršg
 
ªd
 
g’”©e
 
the
 
İ”ªds
.

482 
loÿl
 
funùiÚ
 
	$pu©
(
ùx
, 
Çme
, 
·t
)

483 
loÿl
 
İ”ªds
, 
»gs
, 
sz
, 
mode
, 
¥
, 
rm
, 
sc
, 
rx
, 
sdi¥


484 
loÿl
 
code
, 
pos
, 
¡İ
, 
vexl
 = 
ùx
.code, ctx.pos, ctx.stop, ctx.vexl

486 -- 
Ch¬s
 
u£d
: 1DF
GIMPQRSTUVWXYabcdfgijlmİr¡uvwxyz


487 
p
 
š
 
	`gm©ch
(
·t
, ".") do

488 
loÿl
 
x
 = 
n


489 
p
 =ğ"V" 
Ü
… =ğ"U" 
th’


490 
ùx
.
»xw
 
th’
 
sz
 = "Q"; ctx.»xw = 
çl£


491 
–£if
 
ùx
.
o16
 
th’
 
sz
 = "W"; ctx.o16 = 
çl£


492 
–£if
 
p
 =ğ"U" 
ªd
 
ùx
.
x64
 
th’
 
sz
 = "Q"

493 
sz
 = "D" 
’d


494 
»gs
 = 
m­_»gs
[
sz
]

495 
–£if
 
p
 =ğ"T" 
th’


496 
ùx
.
»xw
 
th’
 
sz
 = "Q"; ctx.»xw = 
çl£
 sz = "D" 
’d


497 
»gs
 = 
m­_»gs
[
sz
]

498 
–£if
 
p
 =ğ"B" 
th’


499 
sz
 = "B"

500 
»gs
 = 
ùx
.
»x
 
ªd
 
m­_»gs
.
B64
 
Ü
 m­_»gs.
B


501 
–£if
 
	`m©ch
(
p
, "[WDQMXYFG]"è
th’


502 
sz
 = 
p


503 
sz
 =ğ"X" 
ªd
 
vexl
 
th’
 sz = "Y"; 
ùx
.vexÈğ
çl£
 
’d


504 
»gs
 = 
m­_»gs
[
sz
]

505 
–£if
 
p
 =ğ"P" 
th’


506 
sz
 = 
ùx
.
o16
 
ªd
 "X" 
Ü
 "M"; ctx.o16 = 
çl£


507 
sz
 =ğ"X" 
ªd
 
vexl
 
th’
 sz = "Y"; 
ùx
.vexÈğ
çl£
 
’d


508 
»gs
 = 
m­_»gs
[
sz
]

509 
–£if
 
p
 =ğ"S" 
th’


510 
Çme
 =‚ame..
	$low”
(
sz
)

511 
–£if
 
p
 =ğ"s" 
th’


512 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 1); 
nÙ
 imm 
th’
  
’d


513 
x
 = 
imm
 <ğ127 
ªd
 
	`fÜm©
("+0x%02x", imm)

514 
Ü
 
	`fÜm©
("-0x%02x", 256-
imm
)

515 
pos
 =…os+1

516 
–£if
 
p
 =ğ"u" 
th’


517 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 1); 
nÙ
 imm 
th’
  
’d


518 
x
 = 
	`fÜm©
("0x%02x", 
imm
)

519 
pos
 =…os+1

520 
–£if
 
p
 =ğ"b" 
th’


521 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 1); 
nÙ
 imm 
th’
  
’d


522 
x
 = 
»gs
[
imm
/16+1]

523 
pos
 =…os+1

524 
–£if
 
p
 =ğ"w" 
th’


525 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 2); 
nÙ
 imm 
th’
  
’d


526 
x
 = 
	`fÜm©
("0x%x", 
imm
)

527 
pos
 =…os+2

528 
–£if
 
p
 =ğ"o" 
th’
 -- [
off£t
]

529 
ùx
.
x64
 
th’


530 
loÿl
 
imm1
 = 
	`g‘imm
(
ùx
, 
pos
, 4); 
nÙ
 imm1 
th’
  
’d


531 
loÿl
 
imm2
 = 
	`g‘imm
(
ùx
, 
pos
+4, 4); 
nÙ
 imm2 
th’
  
’d


532 
x
 = 
	`fÜm©
("[0x%08x%08x]", 
imm2
, 
imm1
)

533 
pos
 =…os+8

535 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 4); 
nÙ
 imm 
th’
  
’d


536 
x
 = 
	`fÜm©
("[0x%08x]", 
imm
)

537 
pos
 =…os+4

538 
’d


539 
–£if
 
p
 =ğ"i" 
Ü
… =ğ"I" 
th’


540 
loÿl
 
n
 = 
m­_sz2n
[
sz
]

541 
n
 =ğ8 
ªd
 
ùx
.
x64
‡nd 
p
 =ğ"I" 
th’


542 
loÿl
 
imm1
 = 
	`g‘imm
(
ùx
, 
pos
, 4); 
nÙ
 imm1 
th’
  
’d


543 
loÿl
 
imm2
 = 
	`g‘imm
(
ùx
, 
pos
+4, 4); 
nÙ
 imm2 
th’
  
’d


544 
x
 = 
	`fÜm©
("0x%08x%08x", 
imm2
, 
imm1
)

546 
n
 =ğ8 
th’
‚ = 4 
’d


547 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 
n
); 
nÙ
 imm 
th’
  
’d


548 
sz
 =ğ"Q" 
	`ªd
 (
imm
 < 0 
Ü
 imm > 0x7fffffffè
th’


549 
imm
 = (0xffffffff+1)-imm

550 
x
 = 
	`fÜm©
(
imm
 > 65535 
ªd
 "-0x%08x" 
Ü
 "-0x%x", imm)

552 
x
 = 
	`fÜm©
(
imm
 > 65535 
ªd
 "0x%08x" 
Ü
 "0x%x", imm)

553 
’d


554 
’d


555 
pos
 =…os+
n


556 
–£if
 
p
 =ğ"j" 
th’


557 
loÿl
 
n
 = 
m­_sz2n
[
sz
]

558 
n
 =ğ8 
th’
‚ = 4 
’d


559 
loÿl
 
imm
 = 
	`g‘imm
(
ùx
, 
pos
, 
n
); 
nÙ
 imm 
th’
  
’d


560 
sz
 =ğ"B" 
ªd
 
imm
 > 127 
th’
 imm = imm-256

561 
–£if
 
imm
 > 2147483647 
th’
 imm = imm-4294967296 
’d


562 
pos
 =…os+
n


563 
imm
 = imm + 
pos
 + 
ùx
.
addr


564 
imm
 > 4294967295 
ªd
 
nÙ
 
ùx
.
x64
 
th’
 imm = imm-4294967296 
’d


565 
ùx
.
imm
 = imm

566 
sz
 =ğ"W" 
th’


567 
x
 = 
	`fÜm©
("wÜd 0x%04x", 
imm
%65536)

568 
–£if
 
ùx
.
x64
 
th’


569 
loÿl
 
lo
 = 
imm
 % 0x1000000

570 
x
 = 
	`fÜm©
("0x%02x%06x", (
imm
-
lo
) / 0x1000000,†o)

572 
x
 = "0x"..
	$tohex
(
imm
)

573 
’d


574 
–£if
 
p
 =ğ"R" 
th’


575 
loÿl
 
r
 = 
	`by‹
(
code
, 
pos
-1,…os-1)%8

576 
ùx
.
»xb
 
th’
 
r
 =„ + 8; ctx.»xb = 
çl£
 
’d


577 
x
 = 
»gs
[
r
+1]

578 
–£if
 
p
 =ğ"a" 
th’
 
x
 = 
»gs
[1]

579 
–£if
 
p
 =ğ"c" 
th’
 
x
 = "cl"

580 
–£if
 
p
 =ğ"d" 
th’
 
x
 = "dx"

581 
–£if
 
p
 =ğ"1" 
th’
 
x
 = "1"

583 
nÙ
 
mode
 
th’


584 
mode
 = 
ùx
.
mrm


585 
nÙ
 
mode
 
th’


586 
pos
 > 
¡İ
 
th’
  
	$šcom¶‘e
(
ùx
è
’d


587 
mode
 = 
	$by‹
(
code
, 
pos
,…os)

588 
pos
 =…os+1

589 
’d


590 
rm
 = 
mode
%8; mode = (mode-rm)/8

591 
¥
 = 
mode
%8; mode = (mode-sp)/8

592 
sdi¥
 = ""

593 
mode
 < 3 
th’


594 
rm
 =ğ4 
th’


595 
pos
 > 
¡İ
 
th’
  
	$šcom¶‘e
(
ùx
è
’d


596 
sc
 = 
	$by‹
(
code
, 
pos
,…os)

597 
pos
 =…os+1

598 
rm
 = 
sc
%8; sc = (sc-rm)/8

599 
rx
 = 
sc
%8; sc = (sc-rx)/8

600 
ùx
.
»xx
 
th’
 
rx
 =„x + 8; ctx.»xx = 
çl£
 
’d


601 
rx
 =ğ4 
th’
„x = 
n
 
’d


602 
’d


603 
mode
 > 0 
Ü
 
rm
 =ğ5 
th’


604 
loÿl
 
dsz
 = 
mode


605 
dsz
 ~ğ1 
th’
 dsz = 4 
’d


606 
loÿl
 
di¥
 = 
	`g‘imm
(
ùx
, 
pos
, 
dsz
); 
nÙ
 di¥ 
th’
  
’d


607 
mode
 =ğ0 
th’
 
rm
 = 
n
 
’d


608 
rm
 
Ü
 
rx
 
	$Ü
 (
nÙ
 
sc
 
ªd
 
ùx
.
x64
‡nd‚Ù ctx.
a32
è
th’


609 
dsz
 =ğ1 
ªd
 
di¥
 > 127 
th’


610 
sdi¥
 = 
	`fÜm©
("-0x%x", 256-
di¥
)

611 
–£if
 
di¥
 >ğ0 
ªd
 di¥ <ğ0x7ffffffà
th’


612 
sdi¥
 = 
	`fÜm©
("+0x%x", 
di¥
)

614 
sdi¥
 = 
	`fÜm©
("-0x%x", (0xffffffff+1)-
di¥
)

615 
’d


617 
sdi¥
 = 
	`fÜm©
(
ùx
.
x64
 
ªd
 
nÙ
 ctx.
a32
‡nd

618 
	`nÙ
 (
di¥
 >ğ0 
ªd
 disp <= 0x7fffffff)

619 
ªd
 "0xffffffff%08x" 
Ü
 "0x%08x", 
di¥
)

620 
’d


621 
pos
 =…os+
dsz


622 
’d


623 
’d


624 
rm
 
ªd
 
ùx
.
»xb
 
th’
„m =„m + 8; ctx.»xb = 
çl£
 
’d


625 
ùx
.
»xr
 
th’
 
¥
 = s°+ 8; ctx.»x¸ğ
çl£
 
’d


626 
’d


627 
p
 =ğ"m" 
th’


628 
mode
 =ğ3 
th’
 
x
 = 
»gs
[
rm
+1]

630 
loÿl
 
¬egs
 = 
ùx
.
a32
 
ªd
 
m­_»gs
.
D
 
Ü
 ctx.aregs

631 
loÿl
 
¤m
, 
¤x
 = "", ""

632 
rm
 
th’
 
¤m
 = 
¬egs
[rm+1]

633 
–£if
 
nÙ
 
sc
 
ªd
 
ùx
.
x64
‡nd‚Ù ctx.
a32
 
th’
 
¤m
 = "r" 
’d


634 
ùx
.
a32
 = 
çl£


635 
rx
 
th’


636 
rm
 
th’
 
¤m
 = srm.."+" 
’d


637 
¤x
 = 
¬egs
[
rx
+1]

638 
sc
 > 0 
th’
 
¤x
 = srx.."*"..(2^scè
’d


639 
’d


640 
x
 = 
	`fÜm©
("[%s%s%s]", 
¤m
, 
¤x
, 
sdi¥
)

641 
’d


642 
mode
 < 3 
ªd


643 (
nÙ
 
	`m©ch
(
·t
, "[aRrgp]"è
Ü
 m©chÕ©, "t")è
th’
 -- 
Yuck
.

644 
x
 = 
m­_sz2´efix
[
sz
].." "..x

645 
’d


646 
–£if
 
p
 =ğ"r" 
th’
 
x
 = 
»gs
[
¥
+1]

647 
–£if
 
p
 =ğ"g" 
th’
 
x
 = 
m­_£g»gs
[
¥
+1]

648 
–£if
 
p
 =ğ"p" 
th’
 -- 
Suµ»ss
 
´efix
.

649 
–£if
 
p
 =ğ"f" 
th’
 
x
 = "¡"..
rm


650 
–£if
 
p
 =ğ"x" 
th’


651 
¥
 =ğ0 
ªd
 
ùx
.
lock
‡nd 
nÙ
 ctx.
x64
 
th’


652 
x
 = "CR8"; 
ùx
.
lock
 = 
çl£


654 
x
 = "CR"..
¥


655 
’d


656 
–£if
 
p
 =ğ"v" 
th’


657 
ùx
.
vexv
 
th’


658 
x
 = 
»gs
[
ùx
.
vexv
+1]; ctx.vexv = 
çl£


659 
’d


660 
–£if
 
p
 =ğ"y" 
th’
 
x
 = "DR"..
¥


661 
–£if
 
p
 =ğ"z" 
th’
 
x
 = "TR"..
¥


662 
–£if
 
p
 =ğ"l" 
th’
 
vexl
 = 
çl£


663 
–£if
 
p
 =ğ"t" 
th’


665 
	`”rÜ
("bad…©‹º `"..
·t
.."'")

666 
’d


667 
’d


668 
x
 
th’
 
İ”ªds
 = o³¿nd 
ªd
 o³¿nds..", "..x 
Ü
 x 
’d


669 
’d


670 
ùx
.
pos
 =…os

671  
	$putİ
(
ùx
, 
Çme
, 
İ”ªds
)

672 
’d


674 -- 
FÜw¬d
 
deş¬©iÚ
.

675 
loÿl
 
m­_aù


677 -- 
F‘ch
 
ªd
 
ÿche
 
MRM
 
by‹
.

678 
loÿl
 
funùiÚ
 
	$g‘mrm
(
ùx
)

679 
loÿl
 
mrm
 = 
ùx
.mrm

680 
nÙ
 
mrm
 
th’


681 
loÿl
 
pos
 = 
ùx
.pos

682 
pos
 > 
ùx
.
¡İ
 
th’
  
n
 
’d


683 
mrm
 = 
	$by‹
(
ùx
.
code
, 
pos
,…os)

684 
ùx
.
pos
 =…os+1

685 
ùx
.
mrm
 = mrm

686 
’d


687  
mrm


688 
’d


690 -- 
Di¥©ch
 
to
 
hªdËr
 
d•’dšg
 
Ú
 
·‰”n
.

691 
loÿl
 
funùiÚ
 
	$di¥©ch
(
ùx
, 
İ©
, 
·tg½
)

692 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


693 
	`m©ch
(
İ©
, "%|"è
th’
 -- 
MMX
/
SSE
 
v¬ŸÁs
 
d•’dšg
 
Ú
 
´efix
.

694 
loÿl
 
p


695 
ùx
.
»p
 
th’


696 
p
 = 
ùx
.
»p
=="»p" 
ªd
 "%|([^%|]*)" 
Ü
 "%|[^%|]*%|[^%|]*%|([^%|]*)"

697 
ùx
.
»p
 = 
çl£


698 
–£if
 
ùx
.
o16
 
th’
 
p
 = "%|[^%|]*%|([^%|]*)"; ctx.o16 = 
çl£


699 
p
 = "^[^%|]*" 
’d


700 
İ©
 = 
	$m©ch
(
İ©
, 
p
)

701 
nÙ
 
İ©
 
th’
  
	$unknown
(
ùx
è
’d


702 -- 
ùx
.
»p
 = 
çl£
; ctx.
o16
 = false

703 --
XXX
 
çs
 66 
f2
 0à38 
f1
 06 
üc32
 
—x
,
WORD
 
PTR
 [
esi
]

704 --
XXX
 
»move
 
š
 
b¿nches
?

705 
’d


706 
	`m©ch
(
İ©
, "%$"è
th’
 -- 
»g$mem
 
v¬ŸÁs
.

707 
loÿl
 
mrm
 = 
	`g‘mrm
(
ùx
); 
nÙ
 mrm 
th’
  
	$šcom¶‘e
(
ùx
è
’d


708 
İ©
 = 
	`m©ch
(İ©, 
mrm
 >ğ192 
ªd
 "^[^%$]*" 
Ü
 "%$(.*)")

709 
İ©
 =ğ"" 
th’
  
	$unknown
(
ùx
è
’d


710 
’d


711 
İ©
 =ğ"" 
th’
  
	$unknown
(
ùx
è
’d


712 
loÿl
 
Çme
, 
·t
 = 
	`m©ch
(
İ©
, "^([a-z0-9 ]*)(.*)")

713 
·t
 =ğ"" 
ªd
 
·tg½
 
th’
…© =…©g½ 
’d


714  
m­_aù
[
	`sub
(
·t
, 1, 1)](
ùx
, 
Çme
,…at)

715 
’d


717 -- 
G‘
 
a
 
·‰”n
 
äom
 
ª
 
İcode
 
m­
 
ªd
 
di¥©ch
 
to
 
hªdËr
.

718 
loÿl
 
funùiÚ
 
	$di¥©chm­
(
ùx
, 
İcm­
)

719 
loÿl
 
pos
 = 
ùx
.pos

720 
loÿl
 
İ©
 = 
İcm­
[
	`by‹
(
ùx
.
code
, 
pos
,…os)]

721 
pos
 =…os + 1

722 
ùx
.
pos
 =…os

723  
	$di¥©ch
(
ùx
, 
İ©
)

724 
’d


726 -- 
M­
 
aùiÚ
 
codes
. 
The
 
key
 
is
 
the
 
fœ¡
 
aá”
h
Çme
.

727 
m­_aù
 = {

728 -- 
Sim¶e
 
İcodes
 
w™hout
 
İ”ªds
.

729 [""] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

730  
	`putİ
(
ùx
, 
Çme
)

731 
’d
,

733 -- 
O³¿nd
 
size
 
ch¬s
 
çÎ
 
right
 
through
.

734 
B
 = 
pu©
, 
W
 =…u©, 
D
 =…u©, 
Q
 =…utpat,

735 
V
 = 
pu©
, 
U
 =…u©, 
T
 =…utpat,

736 
M
 = 
pu©
, 
X
 =…u©, 
P
 =…utpat,

737 
F
 = 
pu©
, 
G
 =…u©, 
Y
 =…utpat,

739 -- 
CŞËù
 
´efixes
.

740 [":"] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

741 
ùx
[
·t
 =ğ":" 
ªd
 
Çme
 
Ü
 
	`sub
(pat, 2)] =‚ame

742 
ùx
.
pos
 - ctx.
¡¬t
 > 5 
th’
  
	`unknown
(ùxè
’d
 -- 
Lim™
 #prefixes.

743 
’d
,

745 -- 
Chaš
 
to
 
¥ecŸl
 
hªdËr
 
¥ecif›d
 
by
 
Çme
.

746 ["*"] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

747  
m­_aù
[
Çme
](
ùx
,‚ame, 
	`sub
(
·t
, 2))

748 
’d
,

750 -- 
U£
 
Çmed
 
subbË
 
İcode
 
group
.

751 ["!"] = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

752 
loÿl
 
mrm
 = 
	`g‘mrm
(
ùx
); 
nÙ
 mrm 
th’
  
	`šcom¶‘e
(ùxè
’d


753  
	`di¥©ch
(
ùx
, 
m­_İcgroup
[
Çme
][((
mrm
-(mrm%8))/8)%8+1], 
	`sub
(
·t
, 2))

754 
’d
,

756 -- 
o16
,
o32
[,
o64
] 
v¬ŸÁs
.

757 
sz
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

758 
ùx
.
o16
 
th’
 ctx.o16 = 
çl£


760 
·t
 = 
	`m©ch
(pat, ",(.*)")

761 
ùx
.
»xw
 
th’


762 
loÿl
 
p
 = 
	`m©ch
(
·t
, ",(.*)")

763 
p
 
th’
 
·t
 =…; 
ùx
.
»xw
 = 
çl£
 
’d


764 
’d


765 
’d


766 
·t
 = 
	`m©ch
(pat, "^[^,]*")

767  
	`di¥©ch
(
ùx
, 
·t
)

768 
’d
,

770 -- 
Two
-
by‹
 
İcode
 
di¥©ch
.

771 
İc2
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

772  
	`di¥©chm­
(
ùx
, 
m­_İc2
)

773 
’d
,

775 -- 
Th»e
-
by‹
 
İcode
 
di¥©ch
.

776 
İc3
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

777  
	`di¥©chm­
(
ùx
, 
m­_İc3
[
·t
])

778 
’d
,

780 -- 
VMX
/
SVM
 
di¥©ch
.

781 
vm
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

782  
	`di¥©ch
(
ùx
, 
m­_İcvm
[ùx.
mrm
])

783 
’d
,

785 -- 
Flßtšg
 
pošt
 
İcode
 
di¥©ch
.

786 
å
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

787 
loÿl
 
mrm
 = 
	`g‘mrm
(
ùx
); 
nÙ
 mrm 
th’
  
	`šcom¶‘e
(ùxè
’d


788 
loÿl
 
rm
 = 
mrm
%8

789 
loÿl
 
idx
 = 
·t
*8 + ((
mrm
-
rm
)/8)%8

790 
mrm
 >ğ192 
th’
 
idx
 = idx + 64 
’d


791 
loÿl
 
İ©
 = 
m­_İcå
[
idx
]

792 
	`ty³
(
İ©
è=ğ"bË" 
th’
 o·ˆğİ©[
rm
+1] 
’d


793  
	`di¥©ch
(
ùx
, 
İ©
)

794 
’d
,

796 -- 
REX
 
´efix
.

797 
»x
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

798 
ùx
.
»x
 
th’
  
	`unknown
(ùxè
’d
 -- 
OÆy
 1 
REX
 
Ü
 
VEX
 
´efix
 
®lowed
.

799 
p
 
š
 
	`gm©ch
(
·t
, "."èdØ
ùx
["»x"..p] = 
Œue
 
’d


800 
ùx
.
»x
 = "rex"

801 
’d
,

803 -- 
VEX
 
´efix
.

804 
vex
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

805 
ùx
.
»x
 
th’
  
	`unknown
(ùxè
’d
 -- 
OÆy
 1 
REX
 
Ü
 
VEX
 
´efix
 
®lowed
.

806 
ùx
.
»x
 = "vex"

807 
loÿl
 
pos
 = 
ùx
.pos

808 
ùx
.
mrm
 
th’


809 
ùx
.
mrm
 = 
n


810 
pos
 =…os-1

811 
’d


812 
loÿl
 
b
 = 
	`by‹
(
ùx
.
code
, 
pos
,…os)

813 
nÙ
 
b
 
th’
  
	`šcom¶‘e
(
ùx
è
’d


814 
pos
 =…os+1

815 
b
 < 128 
th’
 
ùx
.
»xr
 = 
Œue
 
’d


816 
loÿl
 
m
 = 1

817 
·t
 =ğ"3" 
th’


818 
m
 = 
b
%32; b = (b-m)/32

819 
loÿl
 
nb
 = 
b
%2; b = (b-nb)/2

820 
nb
 =ğ0 
th’
 
ùx
.
»xb
 = 
Œue
 
’d


821 
loÿl
 
nx
 = 
b
%2

822 
nx
 =ğ0 
th’
 
ùx
.
»xx
 = 
Œue
 
’d


823 
b
 = 
	`by‹
(
ùx
.
code
, 
pos
,…os)

824 
nÙ
 
b
 
th’
  
	`šcom¶‘e
(
ùx
è
’d


825 
pos
 =…os+1

826 
b
 >ğ128 
th’
 
ùx
.
»xw
 = 
Œue
 
’d


827 
’d


828 
ùx
.
pos
 =…os

829 
loÿl
 
m­


830 
m
 =ğ1 
th’
 
m­
 = 
m­_İc2


831 
–£if
 
m
 =ğ2 
th’
 
m­
 = 
m­_İc3
["38"]

832 
–£if
 
m
 =ğ3 
th’
 
m­
 = 
m­_İc3
["3a"]

833  
	`unknown
(
ùx
è
’d


834 
loÿl
 
p
 = 
b
%4; b = (b-p)/4

835 
p
 =ğ1 
th’
 
ùx
.
o16
 = "o16"

836 
–£if
 
p
 =ğ2 
th’
 
ùx
.
»p
 = "rep"

837 
–£if
 
p
 =ğ3 
th’
 
ùx
.
»p
 = "»²e" 
’d


838 
loÿl
 
l
 = 
b
%2; b = (b-l)/2

839 
l
 ~ğ0 
th’
 
ùx
.
vexl
 = 
Œue
 
’d


840 
ùx
.
vexv
 = (-1-
b
)%16

841  
	`di¥©chm­
(
ùx
, 
m­
)

842 
’d
,

844 -- 
S³cŸl
 
nİ
 
w™h
 
REX
 
´efix
.

845 
nİ
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

846  
	`di¥©ch
(
ùx
, ctx.
»x
 
ªd
 
·t
 
Ü
 "nop")

847 
’d
,

849 -- 
S³cŸl
 0F 77.

850 
emms
 = 
	`funùiÚ
(
ùx
, 
Çme
, 
·t
)

851 
ùx
.
»x
 ~ğ"vex" 
th’


852  
	`putİ
(
ùx
, "emms")

853 
–£if
 
ùx
.
vexl
 
th’


854 
ùx
.
vexl
 = 
çl£


855  
	`putİ
(
ùx
, "zeroall")

857  
	`putİ
(
ùx
, "zeroupper")

858 
’d


859 
’d
,

860 
	}
}

864 -- 
Di§s£mbË
 
a
 
block
 
of
 
	gcode
.

865 
loÿl
 
funùiÚ
 
	$di§ss_block
(
ùx
, 
ofs
, 
Ën
)

866 
nÙ
 
ofs
 
th’
 of ğ0 
’d


867 
loÿl
 
¡İ
 = 
Ën
 
ªd
 
ofs
+ËÀ
Ü
 #ùx.
code


868 
ofs
 = ofs + 1

869 
ùx
.
¡¬t
 = 
ofs


870 
ùx
.
pos
 = 
ofs


871 
ùx
.
¡İ
 = stop

872 
ùx
.
imm
 = 
n


873 
ùx
.
mrm
 = 
çl£


874 
	$ş—½»fixes
(
ùx
)

875 
ùx
.
pos
 <ğ
¡İ
 dØ
	$di¥©chm­
(
ùx
, ctx.
m­1
è
’d


876 
ùx
.
pos
 ~ğùx.
¡¬t
 
th’
 
	$šcom¶‘e
(
ùx
è
’d


877 
’d


879 -- 
Ex‹nded
 
API
: 
ü—‹
 
a
 
di§s£mbËr
 
cÚ‹xt
. 
Th’
 
ÿÎ
 
ùx
:
	`di§ss
(
ofs
, 
Ën
).

880 
loÿl
 
funùiÚ
 
	$ü—‹
(
code
, 
addr
, 
out
)

881 
loÿl
 
ùx
 = {
	}
}

882 
ùx
.
code
 = code

883 
ùx
.
addr
 = (add¸
Ü
 0) - 1

884 
ùx
.
out
 = ouˆ
Ü
 
io
.
wr™e


885 
ùx
.
symb
 = {}

886 
ùx
.
di§ss
 = 
di§ss_block


887 
ùx
.
hexdump
 = 16

888 
ùx
.
x64
 = 
çl£


889 
ùx
.
m­1
 = 
m­_İc1_32


890 
ùx
.
¬egs
 = 
m­_»gs
.
D


891  
ùx


892 
’d


894 
loÿl
 
funùiÚ
 
	$ü—‹64
(
code
, 
addr
, 
out
)

895 
loÿl
 
ùx
 = 
	$ü—‹
(
code
, 
addr
, 
out
)

896 
ùx
.
x64
 = 
Œue


897 
ùx
.
m­1
 = 
m­_İc1_64


898 
ùx
.
¬egs
 = 
m­_»gs
.
Q


899  
ùx


900 
’d


902 -- 
Sim¶e
 
API
: 
di§s£mbË
 
	$code
 (
a
 
¡ršg
è
©
 
add»ss
 
ªd
 
ouut
 
vŸ
 
out
.

903 
loÿl
 
funùiÚ
 
	$di§ss
(
code
, 
addr
, 
out
)

904 
	$ü—‹
(
code
, 
addr
, 
out
):
	$di§ss
()

905 
’d


907 
loÿl
 
funùiÚ
 
	$di§ss64
(
code
, 
addr
, 
out
)

908 
	$ü—‹64
(
code
, 
addr
, 
out
):
	$di§ss
()

909 
’d


911 -- 
R‘uº
 
Çme
 
RID
.

912 
loÿl
 
funùiÚ
 
	$»gÇme
(
r
)

913 
r
 < 8 
th’
  
m­_»gs
.
D
[r+1] 
’d


914  
m­_»gs
.
X
[
r
-7]

915 
’d


917 
loÿl
 
funùiÚ
 
	$»gÇme64
(
r
)

918 
r
 < 16 
th’
  
m­_»gs
.
Q
[r+1] 
’d


919  
m­_»gs
.
X
[
r
-15]

920 
’d


922 -- 
Public
 
moduË
 
funùiÚs
.

924 
ü—‹
 = create,

925 
ü—‹64
 = create64,

926 
di§ss
 = disass,

927 
di§ss64
 = disass64,

928 
»gÇme
 =„egname,

929 
»gÇme64
 =„egname64

930 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dump.lua

2 -- 
LuaJIT
 
comp”
 
dump
 
	gmoduË
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
ÿn
 
be
 
u£d
 
to
 
debug
 
the
 
JIT
 
comp”
 
	g™£lf
. 
It
 
dumps
 
	gthe


9 -- 
code
 
»´e£Á©iÚs
 
ªd
 
¡ruùu»s
 
u£d
 
š
 
v¬ious
 
comp”
 
	g¡ages
.

11 -- 
Exam¶e
 
	gu§ge
:

13 -- 
luaj™
 -
jdump
 -
e
 "local x=0; for i=1,1e6 do x=x+iƒnd;…rint(x)"

14 -- 
luaj™
 -
jdump
=
im
 -
e
 "fÜ i=1,1000 dØfÜ j=1,1000 dØ’dƒnd" | 
Ëss
 -
R


15 -- 
luaj™
 -
jdump
=
is
 
my­p
.
lua
 | 
Ëss
 -
R


16 -- 
luaj™
 -
jdump
=-
b
 
my­p
.
lua


17 -- 
luaj™
 -
jdump
=+
aH
,
	gmy­p
.
html
 my­p.
	glua


18 -- 
	gluaj™
 -
	gjdump
=
ixT
,
	gmy­p
.
dump
 my­p.
	glua


20 -- 
The
 
fœ¡
 
¬gum’t
 
¥ecif›s
 
the
 
dump
 
	gmode
. Th
£cÚd
‡rgum’ˆ
	ggives


21 -- 
the
 
ouut
 
fe
 
	gÇme
. 
DeçuÉ
 ouuˆ
is
 
to
 
	g¡dout
, 
uÆess
h
	g’vœÚm’t


22 -- 
v¬ŸbË
 
LUAJIT_DUMPFILE
 
is
 
	g£t
. 
The
 
fe
 i 
ov”wr™‹n
 
ev”y
 
time
 
	gthe


23 -- 
moduË
 
is
 
	g¡¬‹d
.

25 -- 
Difã»Á
 
ã©u»s
 
ÿn
 
be
 
tuºed
 
Ú
 
Ü
 
off
 
w™h
 
the
 
dump
 
	gmode
. 
If
 
	gthe


26 -- 
mode
 
¡¬ts
 
w™h
 
	ga
 '+', 
the
 
fŞlowšg
 
ã©u»s
 
¬e
 
added
 
to
he 

27 -- 
£t
 
of
 
	gã©u»s
; 
	ga
 '-' 
»moves
 
	gthem
. 
Oth”wi£
 
the
 
ã©u»s
 
¬e
 
	g»¶aûd
.

29 -- 
The
 
fŞlowšg
 
dump
 
ã©u»s
 
¬e
 
	$avaabË
 (* 
m¬ks
 
the
 ):

31 -- * 
t
 
Pršt
 
a
 
lše
 
—ch
 
¡¬‹d
, 
’ded
 
Ü
 
abÜ‹d
 
	`Œaû
 (
£e
 
®so
 -
jv
).

32 -- * 
b
 
Dump
 
the
 
Œaûd
 
by‹code
.

33 -- * 
i
 
Dump
 
the
 
	`IR
 (
š‹rmedŸ‹
 
»´e£Á©iÚ
).

34 -- 
r
 
Augm’t
 
the
 
IR
 
w™h
 /
¡ack
 
¦Ùs
.

35 -- 
s
 
Dump
 
the
 
¢­shÙ
 
m­
.

36 -- * 
m
 
Dump
 
the
 
g’”©ed
 
machše
 
code
.

37 -- 
x
 
Pršt
 
—ch
 
k’
 
Œaû
 
ex™
.

38 -- 
X
 
Pršt
 
—ch
 
k’
 
Œaû
 
ex™
 
ªd
 
the
 
cÚ‹Ás
 
of
 
®l
 
»gi¡”s
.

39 -- 
a
 
Pršt
 
the
 
IR
 
of
 
abÜ‹d
 
Œaûs
, 
too
.

41 -- 
The
 
ouut
 
fÜm©
 
ÿn
 
be
 
£t
 
w™h
 
the
 
fŞlowšg
 
ch¬aù”s
:

43 -- 
T
 
PÏš
 
‹xt
 
ouut
.

44 -- 
A
 
ANSI
-
cŞÜed
 
‹xt
 
ouut


45 -- 
H
 
CŞÜized
 
HTML
 + 
CSS
 
ouut
.

47 -- 
The
  
ouut
 
fÜm©
 
is
 
¶aš
 
‹xt
. 
It
's seto ANSI-coloredext

48 -- 
the
 
COLORTERM
 
v¬ŸbË
 
is
 
£t
. 
NÙe
: 
this
 i 
šd•’d’t
 
of
 
ªy
 
ouut


49 -- 
»dœeùiÚ
, 
which
 
is
 
aùu®ly
 
cÚsid”ed
 
a
 
ã©u»
.

51 -- 
You
 
´obably
 
wªt
 
to
 
u£
 
Ëss
 -
R
Ø
’joy
 
v›wšg
 
ANSI
-
cŞÜed
 
‹xt
 
äom


52 -- 
a
 
pe
 
Ü
‡ 
fe
. 
Add
 
this
 
to
 
your
 ~/.
bashrc
: 
expÜt
 
LESS
="-R"

56 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
objeùs
.

57 
loÿl
 
j™
 = 
	`»quœe
("jit")

58 
	`as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

59 
loÿl
 
jut
 = 
	`»quœe
("jit.util")

60 
loÿl
 
vmdef
 = 
	`»quœe
("jit.vmdef")

61 
loÿl
 
funcšfo
, 
funcbc
 = 
jut
.funcinfo, jutil.funcbc

62 
loÿl
 
Œaûšfo
, 
Œaûœ
, 
Œaûk
 = 
jut
.traceinfo, jutil.traceir, jutil.tracek

63 
loÿl
 
Œaûmc
, 
Œaû¢­
 = 
jut
.tracemc, jutil.tracesnap

64 
loÿl
 
Œaûex™¡ub
, 
œÿÎaddr
 = 
jut
.traceexitstub, jutil.ircalladdr

65 
loÿl
 
b™
 = 
	`»quœe
("bit")

66 
loÿl
 
bªd
, 
shr
, 
tohex
 = 
b™
.bªd, b™.
rshiá
, bit.tohex

67 
loÿl
 
sub
, 
gsub
, 
fÜm©
 = 
¡ršg
.sub, string.gsub, string.format

68 
loÿl
 
by‹
, 
»p
 = 
¡ršg
.byte, string.rep

69 
loÿl
 
ty³
, 
to¡ršg
 =ype,ostring

70 
loÿl
 
¡dout
, 
¡d”r
 = 
io
.stdout, io.stderr

72 -- 
Lßd
 
Ùh”
 
moduËs
 
Ú
-
demªd
.

73 
loÿl
 
bşše
, 
di§ss


75 -- 
Aùive
 
æag
, 
ouut
 
fe
 
hªdË
 
ªd
 
dump
 
mode
.

76 
loÿl
 
aùive
, 
out
, 
dumpmode


80 
loÿl
 
symbmt
 = { 
__šdex
 = 
çl£
 
	}
}

81 
loÿl
 
	gsymb
 = {}

82 
loÿl
 
Ãx™sym
 = 0

84 -- 
Fl
 
Ã¡ed
 
symbŞ
 
bË
 
w™h
 
³r
-
Œaû
 
ex™
 
¡ub
 
add»s£s
.

85 
loÿl
 
funùiÚ
 
	$flsymb_Œ
(
Œ
, 
Ãx™
)

86 
loÿl
 
t
 = {
	}
}

87 
symbmt
.
__šdex
 = 
t


88 
j™
.
¬ch
:
sub
(1, 4è=ğ"ms" 
th’


89 
t
[
Œaûex™¡ub
(
Œ
, 0)] = "exit"

91 
’d


92 
i
=0,
	gÃx™
-1 do

93 
loÿl
 
	gaddr
 = 
	$Œaûex™¡ub
(
Œ
, 
i
)

94 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


95 
t
[
addr
] = 
	$to¡ršg
(
i
)

96 
’d


97 
loÿl
 
addr
 = 
	$Œaûex™¡ub
(
Œ
, 
Ãx™
)

98 
addr
 
th’
 
t
[addr] = "¡ack_check" 
’d


99 
’d


101 -- 
Fl
 
symbŞ
 
bË
 
w™h
 
Œaû
 
ex™
 
¡ub
 
add»s£s
.

102 
loÿl
 
funùiÚ
 
	$flsymb
(
Œ
, 
Ãx™
)

103 
loÿl
 
t
 = 
symb


104 
Ãx™sym
 =ğ0 
th’


105 
loÿl
 
œÿÎ
 = 
vmdef
.ircall

106 
i
=0,#ircall do

107 
loÿl
 
addr
 = 
	$œÿÎaddr
(
i
)

108 
addr
 ~ğ0 
th’


109 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


110 
t
[
addr
] = 
œÿÎ
[
i
]

111 
’d


112 
’d


113 
’d


114 
Ãx™sym
 =ğ1000000 
th’
 -- 
P”
-
Œaû
 
ex™
 
¡ubs
.

115 
	$flsymb_Œ
(
Œ
, 
Ãx™
)

116 
–£if
 
Ãx™
 > 
Ãx™sym
 
th’
 -- 
Sh¬ed
 
ex™
 
¡ubs
.

117 
i
=
Ãx™sym
,
Ãx™
-1 do

118 
loÿl
 
addr
 = 
	$Œaûex™¡ub
(
i
)

119 
addr
 =ğ
n
 
th’
 -- 
F®l
 
back
 
to
 
³r
-
Œaû
 
ex™
 
¡ubs
.

120 
	$flsymb_Œ
(
Œ
, 
Ãx™
)

121 
	$£tm‘©abË
(
symb
, 
symbmt
)

122 
Ãx™
 = 1000000

124 
’d


125 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


126 
t
[
addr
] = 
	$to¡ršg
(
i
)

127 
’d


128 
Ãx™sym
 = 
Ãx™


129 
’d


130  
t


131 
’d


133 
loÿl
 
funùiÚ
 
	$dumpwr™e
(
s
)

134 
out
:
	$wr™e
(
s
)

135 
’d


137 -- 
Di§s£mbË
 
machše
 
code
.

138 
loÿl
 
funùiÚ
 
	$dump_mcode
(
Œ
)

139 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

140 
nÙ
 
šfo
 
th’
  
’d


141 
loÿl
 
mcode
, 
addr
, 
loİ
 = 
	$Œaûmc
(
Œ
)

142 
nÙ
 
mcode
 
th’
  
’d


143 
nÙ
 
di§ss
 
th’
 di§s ğ
	`»quœe
("j™.dis_"..
j™
.
¬ch
è
’d


144 
addr
 < 0 
th’
‡dd¸ğadd¸+ 2^32 
’d


145 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " mcode ", #mcode, "\n")

146 
loÿl
 
ùx
 = 
di§ss
.
	$ü—‹
(
mcode
, 
addr
, 
dumpwr™e
)

147 
ùx
.
hexdump
 = 0

148 
ùx
.
symb
 = 
	$flsymb
(
Œ
, 
šfo
.
Ãx™
)

149 
loİ
 ~ğ0 
th’


150 
symb
[
addr
+
loİ
] = "LOOP"

151 
ùx
:
	$di§ss
(0, 
loİ
)

152 
out
:
	`wr™e
("->LOOP:\n")

153 
ùx
:
	`di§ss
(
loİ
, #mcode-loop)

154 
symb
[
addr
+
loİ
] = 
n


156 
ùx
:
	`di§ss
(0, #mcode)

157 
’d


158 
’d


162 
loÿl
 
œty³_‹xt
 = {

187 
	}
}

189 
loÿl
 
	gcŞÜty³_ªsi
 = {

216 
loÿl
 
funùiÚ
 
	$cŞÜize_‹xt
(
s
)

217  
s


218 
’d


220 
loÿl
 
funùiÚ
 
	$cŞÜize_ªsi
(
s
, 
t
)

221  
	$fÜm©
(
cŞÜty³_ªsi
[
t
], 
s
)

222 
’d


224 
loÿl
 
œty³_ªsi
 = 
	`£tm‘©abË
({
	}
},

225 { 
	g__šdex
 = 
funùiÚ
(
b
, 
t
)

226 
loÿl
 
	gs
 = 
cŞÜize_ªsi
(
œty³_‹xt
[
t
],); 
	gb
[t] = 
s
;  s; 
	g’d
 })

228 
loÿl
 
	ghtml_esÿ³
 = { ["<"] = "&lt;", [">"] = "&gt;", ["&"] = "&amp;", }

230 
loÿl
 
funùiÚ
 
	$cŞÜize_html
(
s
, 
t
)

231 
s
 = 
	`gsub
(s, "[<>&]", 
html_esÿ³
)

232  
	`fÜm©
('<¥ª cÏss="œt_%s">%s</¥ª>', 
œty³_‹xt
[
t
], 
s
)

233 
’d


235 
loÿl
 
œty³_html
 = 
	`£tm‘©abË
({
	}
},

236 { 
	g__šdex
 = 
funùiÚ
(
b
, 
t
)

237 
loÿl
 
	gs
 = 
cŞÜize_html
(
œty³_‹xt
[
t
],); 
	gb
[t] = 
s
;  s; 
	g’d
 })

239 
loÿl
 
	gh—d”_html
 = [[

240 <
¡yË
 
ty³
="text/css">

241 
background
 { background: #ffffff; 
cŞÜ
: #000000; }

242 
´e
.
ljdump
 {

243 
fÚt
-
size
: 10
±
;

244 
background
: #f0f4ff;

245 
cŞÜ
: #000000;

246 
bÜd”
: 1
px
 
sŞid
 #bfcfff;

247 
·ddšg
: 0.5e
m
;

248 
m¬gš
-
Ëá
: 2e
m
;

249 
m¬gš
-
right
: 2e
m
;

251 
¥ª
.
œt_¡r
 { 
cŞÜ
: #00a000; }

252 
¥ª
.
œt_thr
, s·n.
œt_fun
 { 
cŞÜ
: #404040; 
fÚt
-
weight
: 
bŞd
; }

253 
¥ª
.
œt_b
 { 
cŞÜ
: #c00000; }

254 
¥ª
.
œt_udt
, s·n.
œt_lud
 { 
cŞÜ
: #00c0c0; }

255 
¥ª
.
œt_num
 { 
cŞÜ
: #4040c0; }

256 
¥ª
.
œt_št
, s·n.
œt_i8
, s·n.
œt_u8
, s·n.
œt_i16
, s·n.
œt_u16
 { 
cŞÜ
: #b040b0; }

257 </
¡yË
>

260 
loÿl
 
	gcŞÜize
, 
	gœty³


262 -- 
Lookup
 
bËs
 
to
 
cÚv”t
 
some
 
l™”®s
 
što
 
	gÇmes
.

263 
loÿl
 
	gl™Çme
 = {

264 ["SLOAD "] = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
mode
)

265 
loÿl
 
s
 = ""

266 
bªd
(
mode
, 1è~ğ0 
th’
 
s
 = s.."P" 
’d


267 
bªd
(
mode
, 2è~ğ0 
th’
 
s
 = s.."F" 
’d


268 
bªd
(
mode
, 4è~ğ0 
th’
 
s
 = s.."T" 
’d


269 
bªd
(
mode
, 8è~ğ0 
th’
 
s
 = s.."C" 
’d


270 
bªd
(
mode
, 16è~ğ0 
th’
 
s
 = s.."R" 
’d


271 
bªd
(
mode
, 32è~ğ0 
th’
 
s
 = s.."I" 
’d


272 
t
[
mode
] = 
s


273  
s


274 
’d
}),

276 ["CONV "] = 
£tm‘©abË
({}, { 
__šdex
 = 
funùiÚ
(
t
, 
mode
)

277 
loÿl
 
s
 = 
œty³
[
bªd
(
mode
, 31)]

278 
s
 = 
œty³
[
bªd
(
shr
(
mode
, 5), 31)].."."..s

279 
bªd
(
mode
, 0x800è~ğ0 
th’
 
s
 = s.." sext" 
’d


280 
loÿl
 
c
 = 
shr
(
mode
, 14)

281 
c
 =ğ2 
th’
 
s
 = s.." index" 
–£if
 c =ğ3h’ s = s.." check" 
’d


282 
t
[
mode
] = 
s


283  
s


284 
’d
}),

285 ["FLOAD "] = 
vmdef
.
œf›ld
,

286 ["FREF "] = 
vmdef
.
œf›ld
,

287 ["FPMATH"] = 
vmdef
.
œåm
,

292 
loÿl
 
funùiÚ
 
	$ùlsub
(
c
)

293 
c
 =ğ"\n" 
th’
  "\\n"

294 
–£if
 
c
 =ğ"\r" 
th’
  "\\r"

295 
–£if
 
c
 =ğ"\t" 
th’
  "\\t"

296  
	`fÜm©
("\\%03d", 
	$by‹
(
c
))

297 
’d


298 
’d


300 
loÿl
 
funùiÚ
 
	$fmtfunc
(
func
, 
pc
)

301 
loÿl
 
fi
 = 
	$funcšfo
(
func
, 
pc
)

302 
fi
.
loc
 
th’


303  
fi
.
loc


304 
–£if
 
fi
.
ffid
 
th’


305  
vmdef
.
fâames
[
fi
.
ffid
]

306 
–£if
 
fi
.
addr
 
th’


307  
	`fÜm©
("C:%x", 
fi
.
addr
)

310 
’d


311 
’d


313 
loÿl
 
funùiÚ
 
	$fÜm©k
(
Œ
, 
idx
, 
¢
)

314 
loÿl
 
k
, 
t
, 
¦Ù
 = 
	$Œaûk
(
Œ
, 
idx
)

315 
loÿl
 
Š
 = 
	$ty³
(
k
)

316 
loÿl
 
s


317 
Š
 =ğ"numb”" 
th’


318 
	`bªd
(
¢
 
Ü
 0, 0x30000è~ğ0 
th’


319 
s
 = 
	`bªd
(
¢
, 0x20000è~ğ0 
ªd
 "cÚc" 
Ü
 "ftsz"

320 
–£if
 
k
 =ğ2^52+2^51 
th’


321 
s
 = "bias"

323 
s
 = 
	`fÜm©
(0 < 
k
 
ªd
 k < 0x1
p
-1026‡nd "%+a" 
Ü
 "%+.14g", k)

324 
’d


325 
–£if
 
Š
 =ğ"¡ršg" 
th’


326 
s
 = 
	`fÜm©
(#k > 20 
ªd
 '"%.20s"~' 
Ü
 '"%s"', 
	`gsub
(
k
, "%c", 
ùlsub
))

327 
–£if
 
Š
 =ğ"funùiÚ" 
th’


328 
s
 = 
	$fmtfunc
(
k
)

329 
–£if
 
Š
 =ğ"bË" 
th’


330 
s
 = 
	`fÜm©
("{%p}", 
k
)

331 
–£if
 
Š
 =ğ"u£rd©a" 
th’


332 
t
 =ğ12 
th’


333 
s
 = 
	`fÜm©
("u£rd©a:%p", 
k
)

335 
s
 = 
	`fÜm©
("[%p]", 
k
)

336 
s
 =ğ"[NULL]" 
th’
 s = "NULL" 
’d


337 
’d


338 
–£if
 
t
 =ğ21 
th’
 -- 
št64_t


339 
s
 = 
	`sub
(
	`to¡ršg
(
k
), 1, -3)

340 
	`sub
(
s
, 1, 1è~ğ"-" 
th’
 s = "+".. 
’d


341 
–£if
 
¢
 =ğ0x1057ffà
th’
 -- 
	`SNAP
(1, 
SNAP_FRAME
 | 
SNAP_NORESTORE
, 
REF_NIL
)

342  "----" -- 
S³cŸl
 
LJ_FR2
 
¦Ù
 1.

344 
s
 = 
	`to¡ršg
(
k
è-- 
FÜ
 
´im™ives
.

345 
’d


346 
s
 = 
	`cŞÜize
(
	`fÜm©
("%-4s", s), 
t
)

347 
¦Ù
 
th’


348 
s
 = 
	`fÜm©
("% @%d", s, 
¦Ù
)

349 
’d


350  
s


351 
’d


353 
loÿl
 
funùiÚ
 
	$´št¢­
(
Œ
, 
¢­
)

354 
loÿl
 
n
 = 2

355 
s
=0,
¢­
[1]-1 do

356 
loÿl
 
¢
 = 
¢­
[
n
]

357 
	`shr
(
¢
, 24è=ğ
s
 
th’


358 
n
 =‚ + 1

359 
loÿl
 
»f
 = 
	`bªd
(
¢
, 0xffffè- 0x8000 -- 
REF_BIAS


360 
»f
 < 0 
th’


361 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
»f
, 
¢
))

362 
–£if
 
	`bªd
(
¢
, 0x80000è~ğ0 
th’
 -- 
SNAP_SOFTFPNUM


363 
out
:
	`wr™e
(
	`cŞÜize
(
	`fÜm©
("%04d/%04d", 
»f
,„ef+1), 14))

365 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
 = 
	$Œaûœ
(
Œ
, 
»f
)

366 
out
:
	`wr™e
(
	`cŞÜize
(
	`fÜm©
("%04d", 
»f
), 
	$bªd
(
Ù
, 31)))

367 
’d


368 
out
:
	`wr™e
(
	`bªd
(
¢
, 0x10000è=ğ0 
ªd
 " " 
Ü
 "|"è-- 
SNAP_FRAME


370 
out
:
	`wr™e
("---- ")

371 
’d


372 
’d


373 
out
:
	`wr™e
("]\n")

374 
’d


376 -- 
Dump
 
	`¢­shÙs
 (
nÙ
 
š‹¾—ved
 
w™h
 
IR
).

377 
loÿl
 
funùiÚ
 
	$dump_¢­
(
Œ
)

378 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " snapshots\n")

379 
i
=0,1000000000 do

380 
loÿl
 
¢­
 = 
	$Œaû¢­
(
Œ
, 
i
)

381 
nÙ
 
¢­
 
th’
  
’d


382 
out
:
	`wr™e
(
	`fÜm©
("#%-3d %04d [ ", 
i
, 
¢­
[0]))

383 
	$´št¢­
(
Œ
, 
¢­
)

384 
’d


385 
’d


387 -- 
R‘uº
 
a
 
Çme
 
Ü
 
¡ack
 
¦Ù
 ¨
rid
/
¥
 
loÿtiÚ
.

388 
loÿl
 
funùiÚ
 
	$rid¥_Çme
(
rid¥
, 
šs
)

389 
nÙ
 
di§ss
 
th’
 di§s ğ
	`»quœe
("j™.dis_"..
j™
.
¬ch
è
’d


390 
loÿl
 
rid
, 
¦Ù
 = 
	`bªd
(
rid¥
, 0xff), 
	$shr
(
rid¥
, 8)

391 
rid
 =ğ253 
Ü
„id =ğ254 
th’


392  (
¦Ù
 =ğ0 
Ü
 slÙ =ğ255è
ªd
 " {sšk" o¸
	`fÜm©
(" {%04d", 
šs
-slot)

393 
’d


394 
rid¥
 > 255 
th’
  
	`fÜm©
("[%x]", 
¦Ù
*4è
’d


395 
rid
 < 128 
th’
  
di§ss
.
	$»gÇme
(
rid
è
’d


397 
’d


399 -- 
Dump
 
CALL
* 
funùiÚ
 
»f
 
ªd
  
İtiÚ®
 
ùy³
.

400 
loÿl
 
funùiÚ
 
	$dumpÿÎfunc
(
Œ
, 
šs
)

401 
loÿl
 
ùy³


402 
šs
 > 0 
th’


403 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
 = 
	$Œaûœ
(
Œ
, 
šs
)

404 
	`bªd
(
Ù
, 31è=ğ0 
th’
 -- 
n
 
ty³
 
m—ns
 
	`CARG
(
func
, 
ùy³
).

405 
šs
 = 
İ1


406 
ùy³
 = 
	$fÜm©k
(
Œ
, 
İ2
)

407 
’d


408 
’d


409 
šs
 < 0 
th’


410 
out
:
	`wr™e
(
	`fÜm©
("[0x%x](", 
	`tÚumb”
((
	$Œaûk
(
Œ
, 
šs
)))))

412 
out
:
	`wr™e
(
	`fÜm©
("%04d (", 
šs
))

413 
’d


414  
ùy³


415 
’d


417 -- 
Recursiv–y
 
g©h”
 
CALL
* 
¬gs
 
ªd
 
dump
 
them
.

418 
loÿl
 
funùiÚ
 
	$dumpÿÎ¬gs
(
Œ
, 
šs
)

419 
šs
 < 0 
th’


420 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
šs
))

422 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
 = 
	$Œaûœ
(
Œ
, 
šs
)

423 
loÿl
 
oidx
 = 6*
	$shr
(
Ù
, 8)

424 
loÿl
 
İ
 = 
	`sub
(
vmdef
.
œÇmes
, 
oidx
+1, oidx+6)

425 
İ
 =ğ"CARG " 
th’


426 
	$dumpÿÎ¬gs
(
Œ
, 
İ1
)

427 
İ2
 < 0 
th’


428 
out
:
	`wr™e
(" ", 
	$fÜm©k
(
Œ
, 
İ2
))

430 
out
:
	`wr™e
(" ", 
	`fÜm©
("%04d", 
İ2
))

431 
’d


433 
out
:
	`wr™e
(
	`fÜm©
("%04d", 
šs
))

434 
’d


435 
’d


436 
’d


438 -- 
Dump
 
IR
 
ªd
 
š‹¾—ved
 
¢­shÙs
.

439 
loÿl
 
funùiÚ
 
	$dump_œ
(
Œ
, 
dump¢­
, 
dum´eg
)

440 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

441 
nÙ
 
šfo
 
th’
  
’d


442 
loÿl
 
nšs
 = 
šfo
.nins

443 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " IR\n")

444 
loÿl
 
œÇmes
 = 
vmdef
.irnames

445 
loÿl
 
¢­»f
 = 65536

446 
loÿl
 
¢­
, 
¢­no


447 
dump¢­
 
th’


448 
¢­
 = 
	$Œaû¢­
(
Œ
, 0)

449 
¢­»f
 = 
¢­
[0]

450 
¢­no
 = 0

451 
’d


452 
šs
=1,
nšs
 do

453 
šs
 >ğ
¢­»f
 
th’


454 
dum´eg
 
th’


455 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

457 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

458 
’d


459 
	$´št¢­
(
Œ
, 
¢­
)

460 
¢­no
 = snapno + 1

461 
¢­
 = 
	$Œaû¢­
(
Œ
, 
¢­no
)

462 
¢­»f
 = 
¢­
 
ªd
 sÇp[0] 
Ü
 65536

463 
’d


464 
loÿl
 
m
, 
Ù
, 
İ1
, 
İ2
, 
rid¥
 = 
	$Œaûœ
(
Œ
, 
šs
)

465 
loÿl
 
oidx
, 
t
 = 6*
	`shr
(
Ù
, 8), 
	$bªd
(
Ù
, 31)

466 
loÿl
 
İ
 = 
	`sub
(
œÇmes
, 
oidx
+1, oidx+6)

467 
İ
 =ğ"LOOP " 
th’


468 
dum´eg
 
th’


469 
out
:
	`wr™e
(
	`fÜm©
("%04d ------------ LOOP ------------\n", 
šs
))

471 
out
:
	`wr™e
(
	`fÜm©
("%04d ------ LOOP ------------\n", 
šs
))

472 
’d


473 
–£if
 
İ
 ~ğ"NOP " 
ªd
 op ~= "CARG "‡nd

474 (
dum´eg
 
Ü
 
İ
 ~ğ"RENAME"è
th’


475 
loÿl
 
rid
 = 
	$bªd
(
rid¥
, 255)

476 
dum´eg
 
th’


477 
out
:
	`wr™e
(
	`fÜm©
("%04d %-6s", 
šs
, 
	$rid¥_Çme
(
rid¥
, 
šs
)))

479 
out
:
	`wr™e
(
	`fÜm©
("%04d ", 
šs
))

480 
’d


481 
out
:
	`wr™e
(
	`fÜm©
("%s%s %s %s ",

482 (
rid
 =ğ254 
Ü
„id =ğ253è
ªd
 "}" or

483 (
	`bªd
(
Ù
, 128è=ğ0 
ªd
 " " 
Ü
 ">"),

484 
	`bªd
(
Ù
, 64è=ğ0 
ªd
 " " 
Ü
 "+",

485 
œty³
[
t
], 
İ
))

486 
loÿl
 
m1
, 
m2
 = 
	`bªd
(
m
, 3), 
	$bªd
(
m
, 3*4)

487 
	`sub
(
İ
, 1, 4è=ğ"CALL" 
th’


488 
loÿl
 
ùy³


489 
m2
 =ğ1*4 
th’
 -- 
İ2
 =ğ
IRMl™


490 
out
:
	`wr™e
(
	`fÜm©
("%-10  (", 
vmdef
.
œÿÎ
[
İ2
]))

492 
ùy³
 = 
	$dumpÿÎfunc
(
Œ
, 
İ2
)

493 
’d


494 
İ1
 ~ğ-1 
th’
 
	$dumpÿÎ¬gs
(
Œ
, 
İ1
è
’d


495 
out
:
	`wr™e
(")")

496 
ùy³
 
th’
 
out
:
	`wr™e
(" cty³ ", cty³è
’d


497 
–£if
 
İ
 =ğ"CNEW " 
ªd
 
İ2
 =ğ-1 
th’


498 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
İ1
))

499 
–£if
 
m1
 ~ğ3 
th’
 -- 
İ1
 !ğ
IRMnÚe


500 
İ1
 < 0 
th’


501 
out
:
	`wr™e
(
	$fÜm©k
(
Œ
, 
İ1
))

503 
out
:
	`wr™e
(
	`fÜm©
(
m1
 =ğ0 
ªd
 "%04d" 
Ü
 "#%-3d", 
İ1
))

504 
’d


505 
m2
 ~ğ3*4 
th’
 -- 
İ2
 !ğ
IRMnÚe


506 
m2
 =ğ1*4 
th’
 -- 
İ2
 =ğ
IRMl™


507 
loÿl
 
l™n
 = 
l™Çme
[
İ
]

508 
l™n
 
ªd
†™n[
İ2
] 
th’


509 
out
:
	`wr™e
(" ", 
l™n
[
İ2
])

510 
–£if
 
İ
 =ğ"UREFO " 
Ü
 o°=ğ"UREFC " 
th’


511 
out
:
	`wr™e
(
	`fÜm©
(" #%-3d", 
	$shr
(
İ2
, 8)))

513 
out
:
	`wr™e
(
	`fÜm©
(" #%-3d", 
İ2
))

514 
’d


515 
–£if
 
İ2
 < 0 
th’


516 
out
:
	`wr™e
(" ", 
	$fÜm©k
(
Œ
, 
İ2
))

518 
out
:
	`wr™e
(
	`fÜm©
(" %04d", 
İ2
))

519 
’d


520 
’d


521 
’d


522 
out
:
	`wr™e
("\n")

523 
’d


524 
’d


525 
¢­
 
th’


526 
dum´eg
 
th’


527 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

529 
out
:
	`wr™e
(
	`fÜm©
(".... SNAP #%-3d [ ", 
¢­no
))

530 
’d


531 
	$´št¢­
(
Œ
, 
¢­
)

532 
’d


533 
’d


537 
loÿl
 
»ı»fix
 = ""

538 
loÿl
 
»cd•th
 = 0

540 -- 
FÜm©
 
Œaû
 
”rÜ
 
mes§ge
.

541 
loÿl
 
funùiÚ
 
	$fm‹¼
(
”r
, 
šfo
)

542 
	`ty³
(
”r
è=ğ"numb”" 
th’


543 
	`ty³
(
šfo
è=ğ"funùiÚ" 
th’
 infØğ
	$fmtfunc
(
šfo
è
’d


544 
”r
 = 
	$fÜm©
(
vmdef
.
Œaû”r
[
”r
], 
šfo
)

545 
’d


546  
”r


547 
’d


549 -- 
Dump
 
Œaû
 
¡©es
.

550 
loÿl
 
funùiÚ
 
	$dump_Œaû
(
wh©
, 
Œ
, 
func
, 
pc
, 
Ùr
, 
Ûx
)

551 
wh©
 =ğ"¡İ" 
	`Ü
 (wh© =ğ"abÜt" 
ªd
 
dumpmode
.
a
è
th’


552 
dumpmode
.
i
 
th’
 
	`dump_œ
(
Œ
, dumpmode.
s
, dumpmode.
r
 
ªd
 
wh©
 == "stop")

553 
–£if
 
dumpmode
.
s
 
th’
 
	$dump_¢­
(
Œ
è
’d


554 
dumpmode
.
m
 
th’
 
	$dump_mcode
(
Œ
è
’d


555 
’d


556 
wh©
 =ğ"¡¬t" 
th’


557 
dumpmode
.
H
 
th’
 
out
:
	`wr™e
('<´şass="ljdump">\n'è
’d


558 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " ", 
wh©
)

559 
Ùr
 
th’
 
out
:
	`wr™e
(" ", oŒ, "/", 
Ûx
 =ğ-1 
ªd
 "¡™ch" 
Ü
 oexè
’d


560 
out
:
	`wr™e
(" ", 
	`fmtfunc
(
func
, 
pc
), "\n")

561 
–£if
 
wh©
 =ğ"¡İ" 
Ü
 wh© =ğ"abÜt" 
th’


562 
out
:
	`wr™e
("---- TRACE ", 
Œ
, " ", 
wh©
)

563 
wh©
 =ğ"abÜt" 
th’


564 
out
:
	`wr™e
(" ", 
	`fmtfunc
(
func
, 
pc
), " -- ", 
	`fm‹¼
(
Ùr
, 
Ûx
), "\n")

566 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

567 
loÿl
 
lšk
, 
Éy³
 = 
šfo
.lšk, info.
lškty³


568 
lšk
 =ğ
Œ
 
Ü
†šk =ğ0 
th’


569 
out
:
	`wr™e
(" -> ", 
Éy³
, "\n")

570 
–£if
 
Éy³
 =ğ"roÙ" 
th’


571 
out
:
	`wr™e
(" -> ", 
lšk
, "\n")

573 
out
:
	`wr™e
(" -> ", 
lšk
, " ", 
Éy³
, "\n")

574 
’d


575 
’d


576 
dumpmode
.
H
 
th’
 
out
:
	`wr™e
("</´e>\n\n"èout:wr™e("\n"è
’d


578 
wh©
 =ğ"æush" 
th’
 
symb
, 
Ãx™sym
 = {
	}
}, 0 
’d


579 
	gout
:
wr™e
("---- TRACE ", 
wh©
, "\n\n")

580 
’d


581 
	gout
:
	$æush
()

582 
’d


584 -- 
Dump
 
»cÜded
 
by‹code
.

585 
loÿl
 
funùiÚ
 
	$dump_»cÜd
(
Œ
, 
func
, 
pc
, 
d•th
, 
ÿÎ“
)

586 
d•th
 ~ğ
»cd•th
 
th’


587 
»cd•th
 = 
d•th


588 
»ı»fix
 = 
	`»p
(" .", 
d•th
)

589 
’d


590 
loÿl
 
lše


591 
pc
 >ğ0 
th’


592 
lše
 = 
	$bşše
(
func
, 
pc
, 
»ı»fix
)

593 
dumpmode
.
H
 
th’
 
lše
 = 
	`gsub
Öše, "[<>&]", 
html_esÿ³
è
’d


595 
lše
 = "0000 "..
»ı»fix
.." FUNCC \n"

596 
ÿÎ“
 = 
func


597 
’d


598 
pc
 <ğ0 
th’


599 
out
:
	`wr™e
(
	`sub
(
lše
, 1, -2), " ; ", 
	`fmtfunc
(
func
), "\n")

601 
out
:
	$wr™e
(
lše
)

602 
’d


603 
pc
 >ğ0 
ªd
 
	`bªd
(
	`funcbc
(
func
,…c), 0xffè< 16 
th’
 -- 
ORDER
 
BC


604 
out
:
	`wr™e
(
	`bşše
(
func
, 
pc
+1, 
»ı»fix
)è-- 
Wr™e
 
JMP
 
cÚd
.

605 
’d


606 
’d


610 -- 
Dump
 
k’
 
Œaû
 
ex™s
.

611 
loÿl
 
funùiÚ
 
	$dump_‹x™
(
Œ
, 
ex
, 
ng´
, 
når
, ...)

612 
out
:
	`wr™e
("---- TRACE ", 
Œ
, "ƒx™ ", 
ex
, "\n")

613 
dumpmode
.
X
 
th’


614 
loÿl
 
»gs
 = {...
	}
}

615 
j™
.
¬ch
 =ğ"x64" 
th’


616 
i
=1,
ng´
 do

617 
	gout
:
wr™e
(
fÜm©
(" %016x", 
»gs
[
i
]))

618 
	gi
 % 4 =ğ0 
th’
 
out
:
wr™e
("\n"è
’d


619 
’d


621 
i
=1,
ng´
 do

622 
	gout
:
wr™e
(" ", 
	$tohex
(
»gs
[
i
]))

623 
i
 % 8 =ğ0 
th’
 
out
:
	`wr™e
("\n"è
’d


624 
’d


625 
’d


626 
j™
.
¬ch
 =ğ"ms" 
Ü
 j™.¬ch =ğ"m£l" 
th’


627 
i
=1,
når
,2 do

628 
out
:
	`wr™e
(
	`fÜm©
(" %+17.14g", 
»gs
[
ng´
+
i
]))

629 
i
 % 8 =ğ7 
th’
 
out
:
	`wr™e
("\n"è
’d


630 
’d


632 
i
=1,
når
 do

633 
out
:
	`wr™e
(
	`fÜm©
(" %+17.14g", 
»gs
[
ng´
+
i
]))

634 
i
 % 4 =ğ0 
th’
 
out
:
	`wr™e
("\n"è
’d


635 
’d


636 
’d


637 
’d


638 
’d


642 -- 
D‘ach
 
dump
 
hªdËrs
.

643 
loÿl
 
funùiÚ
 
	$dumpoff
()

644 
aùive
 
th’


645 
aùive
 = 
çl£


646 
j™
.
	$©ch
(
dump_‹x™
)

647 
j™
.
	$©ch
(
dump_»cÜd
)

648 
j™
.
	$©ch
(
dump_Œaû
)

649 
out
 
ªd
 ouˆ~ğ
¡dout
‡nd ouˆ~ğ
¡d”r
 
th’
 out:
	$şo£
(è
’d


650 
out
 = 
n


651 
’d


652 
’d


654 -- 
O³n
 
the
 
ouut
 
fe
 
ªd
 
©ch
 
dump
 
hªdËrs
.

655 
loÿl
 
funùiÚ
 
	$dumpÚ
(
İt
, 
outfe
)

656 
aùive
 
th’
 
	$dumpoff
(è
’d


658 
loÿl
 
‹rm
 = 
os
.
	`g‘’v
("TERM")

659 
loÿl
 
cŞÜmode
 = (
‹rm
 
ªd
”m:
	`m©ch
("cŞÜ"è
Ü
 
os
.
	`g‘’v
("COLORTERM"))‡nd "A" or "T"

660 
İt
 
th’


661 
İt
 = 
	`gsub
(İt, "[TAH]", 
	$funùiÚ
(
mode
è
cŞÜmode
 = mode;  ""; 
’d
)

662 
’d


664 
loÿl
 
m
 = { 
t
=
Œue
, 
b
ñrue, 
i
ñrue, mñrue, 
	}
}

665 
İt
 
ªd
 
	gİt
 ~ğ"" 
th’


666 
loÿl
 
o
 = 
	$sub
(
İt
, 1, 1)

667 
o
 ~ğ"+" 
ªd
 o ~ğ"-" 
th’
 
m
 = {
	}
} 
’d


668 
i
=1,#İˆdØ
	gm
[
sub
(
İt
, i, i)] = (
o
 ~ğ"-"è
’d


669 
’d


670 
dumpmode
 = 
m


672 
m
.
t
 
Ü
 m.
b
 o¸m.
i
 o¸m.
s
 o¸m.m 
th’


673 
j™
.
©ch
(
dump_Œaû
, "trace")

674 
’d


675 
	gm
.
b
 
th’


676 
	gj™
.
©ch
(
dump_»cÜd
, "record")

677 
nÙ
 
bşše
 
th’
 
	gbşše
 = 
»quœe
("j™.bc").
lše
 
’d


678 
’d


679 
m
.
x
 
Ü
 m.
X
 
th’


680 
j™
.
©ch
(
dump_‹x™
, "texit")

681 
’d


683 
nÙ
 
outfe
 
th’
 
	goutfe
 = 
os
.
g‘’v
("LUAJIT_DUMPFILE"è
’d


684 
outfe
 
th’


685 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
as£¹
(
io
.
İ’
(outfile, "w"))

687 
	gout
 = 
¡dout


688 
’d


690 
m
[
cŞÜmode
] = 
Œue


691 
cŞÜmode
 =ğ"A" 
th’


692 
cŞÜize
 = 
cŞÜize_ªsi


693 
œty³
 = 
œty³_ªsi


694 
–£if
 
cŞÜmode
 =ğ"H" 
th’


695 
cŞÜize
 = 
cŞÜize_html


696 
œty³
 = 
œty³_html


697 
out
:
	$wr™e
(
h—d”_html
)

699 
cŞÜize
 = 
cŞÜize_‹xt


700 
œty³
 = 
œty³_‹xt


701 
’d


703 
aùive
 = 
Œue


704 
’d


706 -- 
Public
 
moduË
 
funùiÚs
.

708 
Ú
 = 
dumpÚ
,

709 
off
 = 
dumpoff
,

710 
¡¬t
 = 
dumpÚ
 -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

711 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/p.lua

2 -- 
LuaJIT
 
	g´of”
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
is
 
a
 
sim¶e
 
commªd
 
lše
 
š‹rçû
 
to
 
the
 
	gbut
-
	gš


9 -- 
	glow
-
ov”h—d
 
´of”
 
of
 
	gLuaJIT
.

11 -- 
The
 
	glow”
-
Ëv–
 
API
 
of
 
the
 
´of”
 
is
 
acûssibË
 
vŸ
 
	gthe
 "jit.profile"

12 -- 
moduË
 
Ü
 
the
 
luaJIT_´ofe_
* 
C
 
	gAPI
.

14 -- 
Exam¶e
 
	gu§ge
:

16 -- 
luaj™
 -
jp
 
my­p
.
lua


17 -- 
luaj™
 -
jp
=
s
 
my­p
.
lua


18 -- 
luaj™
 -
jp
=-
s
 
my­p
.
lua


19 -- 
luaj™
 -
jp
=
vl
 
my­p
.
lua


20 -- 
luaj™
 -
jp
=
G
,
	g´ofe
.
txt
 
	gmy­p
.
	glua


22 -- 
The
 
fŞlowšg
 
dump
 
ã©u»s
 
¬e
 
	gavaabË
:

24 -- 
f
 
Sck
 
dump
: 
funùiÚ
 
Çme
, 
Ùh”wi£
 
	gmoduË
:
lše
. 
DeçuÉ
 
mode
.

25 -- 
F
 
Sck
 
dump
: 
d™to
, 
but
 
®ways
 
´•’d
 
	gmoduË
.

26 -- 
l
 
Sck
 
	gdump
: 
moduË
:
lše
.

27 -- <
numb”
> 
¡ack
 
dump
 
d•th
 (
ÿÎ“
 < 
ÿÎ”
). 
DeçuÉ
: 1.

28 -- -<
numb”
> 
Inv”£
 
¡ack
 
dump
 
d•th
 (
ÿÎ”
 > 
ÿÎ“
).

29 -- 
s
 
S¶™
 
¡ack
 
dump
 
aá”
 
fœ¡
 sck 
Ëv–
. 
Im¶›s
 
abs
(
d•th
) >= 2.

30 -- 
p
 
Show
 
fuÎ
 
·th
 
moduË
 
Çmes
.

31 -- 
v
 
Show
 
VM
 
¡©es
. 
Cª
 
be
 
combšed
 
w™h
 
¡ack
 
dumps
, 
	ge
.
	gg
. 
vf
 
Ü
 
	gfv
.

32 -- 
z
 
Show
 
	gzÚes
. 
Cª
 
be
 
combšed
 
w™h
 
¡ack
 
	gdumps
, 
	ge
.
	gg
. 
zf
 
Ü
 
	gfz
.

33 -- 
r
 
Show
 
¿w
 
§m¶e
 
	gcouÁs
. 
	gDeçuÉ
: 
show
 
³rûÁages
.

34 -- 
a
 
AÂÙ©e
 
exû½ts
 
äom
 
sourû
 
code
 
fes
.

35 -- 
A
 
AÂÙ©e
 
com¶‘e
 
sourû
 
code
 
fes
.

36 -- 
G
 
Produû
 
¿w
 
ouut
 
su™abË
 
g¿phiÿl
 
toŞs
 (
e
.
g
. 
æame
 
g¿phs
).

37 -- 
m
<
numb”
> 
Mšimum
 
§m¶e
 
³rûÁage
 
to
 
be
 
shown
. 
DeçuÉ
: 3.

38 -- 
i
<
numb”
> 
Sam¶šg
 
š‹rv®
 
š
 
mli£cÚds
. 
DeçuÉ
: 10.

42 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
objeùs
.

43 
loÿl
 
j™
 = 
»quœe
("jit")

44 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

45 
loÿl
 
	g´ofe
 = 
»quœe
("jit.profile")

46 
loÿl
 
vmdef
 = 
»quœe
("jit.vmdef")

47 
loÿl
 
m©h
 = math

48 
loÿl
 
·œs
, 
	gaœs
, 
	gtÚumb”
, 
	gæoÜ
 =…aœs, i·œs,Úumb”, 
	gm©h
.
æoÜ


49 
loÿl
 
	gsÜt
, 
	gfÜm©
 = 
bË
.
sÜt
, 
	g¡ršg
.
fÜm©


50 
loÿl
 
	g¡dout
 = 
io
.
¡dout


51 
loÿl
 
zÚe
 -- 
Lßd
 
j™
.zÚ
moduË
 
Ú
 
demªd
.

53 -- 
Ouut
 
fe
 
hªdË
.

54 
loÿl
 
out


58 
loÿl
 
´of_ud


59 
loÿl
 
´of_¡©es
, 
	g´of_¥l™
, 
	g´of_mš
, 
	g´of_¿w
, 
	g´of_fmt
, 
´of_d•th


60 
loÿl
 
	g´of_ªn
, 
	g´of_couÁ1
, 
	g´of_couÁ2
, 
´of_§m¶es


62 
loÿl
 
	gm­_vmmode
 = {

63 
N
 = "Compiled",

64 
	gI
 = "Interpreted",

65 
	gC
 = "C code",

66 
	gG
 = "Garbage Collector",

67 
	gJ
 = "JIT Compiler",

70 -- 
Prof”
 
	gÿÎback
.

71 
loÿl
 
funùiÚ
 
	$´of_cb
(
th
, 
§m¶es
, 
vmmode
)

72 
´of_§m¶es
 =…rof_§m¶e + 
§m¶es


73 
loÿl
 
key_¡ack
, 
key_¡ack2
, 
key_¡©e


74 -- 
CŞËù
 
keys
 
§m¶e
.

75 
´of_¡©es
 
th’


76 
´of_¡©es
 =ğ"v" 
th’


77 
key_¡©e
 = 
m­_vmmode
[
vmmode
] 
Ü
 vmmode

79 
key_¡©e
 = 
zÚe
:
	$g‘
(è
Ü
 "(none)"

80 
’d


81 
’d


82 
´of_fmt
 
th’


83 
key_¡ack
 = 
´ofe
.
	$dump¡ack
(
th
, 
´of_fmt
, 
´of_d•th
)

84 
key_¡ack
 = key_¡ack:
	`gsub
("%[butš#(%d+)%]", 
	$funùiÚ
(
x
)

85  
vmdef
.
fâames
[
	`tÚumb”
(
x
)]

86 
’d
)

87 
´of_¥l™
 =ğ2 
th’


88 
loÿl
 
k1
, 
k2
 = 
key_¡ack
:
	`m©ch
("(.-) [<>] (.*)")

89 
k2
 
th’
 
key_¡ack
, 
key_¡ack2
 = 
k1
, k2 
’d


90 
–£if
 
´of_¥l™
 =ğ3 
th’


91 
key_¡ack2
 = 
´ofe
.
	`dump¡ack
(
th
, "l", 1)

92 
’d


93 
’d


94 -- 
Ord”
 
keys
.

95 
loÿl
 
k1
, 
k2


96 
´of_¥l™
 =ğ1 
th’


97 
key_¡©e
 
th’


98 
k1
 = 
key_¡©e


99 
key_¡ack
 
th’
 
k2
 = key_¡ack 
’d


100 
’d


101 
–£if
 
key_¡ack
 
th’


102 
k1
 = 
key_¡ack


103 
key_¡ack2
 
th’
 
k2
 = key_¡ack2 
–£if
 
key_¡©e
h’ k2 = key_¡©
’d


104 
’d


105 -- 
CßËsû
 
§m¶es
 
š
 
Úe
 
Ü
 
two
 
Ëv–s
.

106 
k1
 
th’


107 
loÿl
 
t1
 = 
´of_couÁ1


108 
t1
[
k1
] = (t1[k1] 
Ü
 0è+ 
§m¶es


109 
k2
 
th’


110 
loÿl
 
t2
 = 
´of_couÁ2


111 
loÿl
 
t3
 = 
t2
[
k1
]

112 
nÙ
 
t3
 
th’
3 = {
	}
}; 
	gt2
[
k1
] =3 
’d


113 
t3
[
k2
] = (t3[k2] 
Ü
 0è+ 
§m¶es


114 
’d


115 
’d


116 
’d


120 -- 
Show
 
tİ
 
N
 
li¡
.

121 
loÿl
 
funùiÚ
 
	$´of_tİ
(
couÁ1
, 
couÁ2
, 
§m¶es
, 
šd’t
)

122 
loÿl
 
t
, 
n
 = {
	}
}, 0

123 
k
 
š
 
	$·œs
(
couÁ1
) do

124 
n
 =‚ + 1

125 
t
[
n
] = 
k


126 
’d


127 
	`sÜt
(
t
, 
	$funùiÚ
(
a
, 
b
è 
couÁ1
[a] > couÁ1[b] 
’d
)

128 
i
=1,
n
 do

129 
loÿl
 
k
 = 
t
[
i
]

130 
loÿl
 
v
 = 
couÁ1
[
k
]

131 
loÿl
 
pù
 = 
	`æoÜ
(
v
*100/
§m¶es
 + 0.5)

132 
pù
 < 
´of_mš
 
th’
  
’d


133 
nÙ
 
´of_¿w
 
th’


134 
out
:
	`wr™e
(
	`fÜm©
("%s%2d%% %s\n", 
šd’t
, 
pù
, 
k
))

135 
–£if
 
´of_¿w
 =ğ"r" 
th’


136 
out
:
	`wr™e
(
	`fÜm©
("%s%5d %s\n", 
šd’t
, 
v
, 
k
))

138 
out
:
	`wr™e
(
	`fÜm©
("% %d\n", 
k
, 
v
))

139 
’d


140 
couÁ2
 
th’


141 
loÿl
 
r
 = 
couÁ2
[
k
]

142 
r
 
th’


143 
	`´of_tİ
(
r
, 
n
, 
v
, (
´of_¥l™
 =ğ3 
Ü
…rof_¥l™ =ğ1è
ªd
 " -- " or

144 (
´of_d•th
 < 0 
ªd
 " -> " 
Ü
 " <- "))

145 
’d


146 
’d


147 
’d


148 
’d


150 -- 
AÂÙ©e
 
sourû
 
code


151 
loÿl
 
funùiÚ
 
	$´of_ªnÙ©e
(
couÁ1
, 
§m¶es
)

152 
loÿl
 
fes
 = {
	}
}

153 
loÿl
 
ms
 = 0

154 
k
, 
v
 
š
 
	$·œs
(
couÁ1
) do

155 
loÿl
 
pù
 = 
	`æoÜ
(
v
*100/
§m¶es
 + 0.5)

156 
ms
 = 
m©h
.
	$max
(
ms
, 
v
)

157 
pù
 >ğ
´of_mš
 
th’


158 
loÿl
 
fe
, 
lše
 = 
k
:
	`m©ch
("^(.*):(%d+)$")

159 
nÙ
 
fe
 
th’
 fğ
k
; 
lše
 = 0 
’d


160 
loÿl
 
æ
 = 
fes
[
fe
]

161 
nÙ
 
æ
 
th’
 fÈğ{
	}
}; 
	gfes
[
fe
] = fl; fes[#fes+1] = f
’d


162 
lše
 = 
	$tÚumb”
(
lše
)

163 
æ
[
lše
] = 
´of_¿w
 
ªd
 
v
 
Ü
 
pù


164 
’d


165 
’d


166 
	$sÜt
(
fes
)

167 
loÿl
 
fmtv
, 
fmŠ
 = " %3d%% | %s\n", " | %s\n"

168 
´of_¿w
 
th’


169 
loÿl
 
n
 = 
m©h
.
	`max
(5, m©h.
	`û
(m©h.
	$log10
(
ms
)))

170 
fmtv
 = "%"..
n
.."d | %s\n"

171 
fmŠ
 = (" "):
	`»p
(
n
).." | %s\n"

172 
’d


173 
loÿl
 
ªn
 = 
´of_ªn


174 
_
, 
fe
 
š
 
	$aœs
(
fes
) do

175 
loÿl
 
f0
 = 
fe
:
	$by‹
()

176 
f0
 =ğ40 
Ü
 f0 =ğ91 
th’


177 
out
:
	`wr™e
(
	`fÜm©
("\n=====ğ% ======\n[CªnÙ‡ÂÙ©nÚ-fe]\n", 
fe
))

179 
’d


180 
loÿl
 
å
, 
”r
 = 
io
.
	$İ’
(
fe
)

181 
nÙ
 
å
 
th’


182 
out
:
	`wr™e
(
	`fÜm©
("=====ğERROR: %s: %s\n", 
fe
, 
”r
))

184 
’d


185 
out
:
	`wr™e
(
	`fÜm©
("\n=====ğ% ======\n", 
fe
))

186 
loÿl
 
æ
 = 
fes
[
fe
]

187 
loÿl
 
n
, 
show
 = 1, 
çl£


188 
ªn
 ~ğ0 
th’


189 
i
=1,
ªn
 do

190 
æ
[
i
] 
th’
 
show
 = 
Œue
; 
out
:
	`wr™e
("@@ 1 @@\n");  
’d


191 
’d


192 
’d


193 
lše
 
š
 
å
:
	$lšes
() do

194 
lše
:
	`by‹
(è=ğ27 
th’


195 
out
:
	`wr™e
("[Cannot‡nnotate bytecode file]\n")

197 
’d


198 
loÿl
 
v
 = 
æ
[
n
]

199 
ªn
 ~ğ0 
th’


200 
loÿl
 
v2
 = 
æ
[
n
+
ªn
]

201 
show
 
th’


202 
v2
 
th’
 
show
 = 
n
+
ªn
 
–£if
 
v
hen show =‚

203 
–£if
 
show
+
ªn
 < 
n
 
th’
 show = 
çl£
 
’d


204 
–£if
 
v2
 
th’


205 
show
 = 
n
+
ªn


206 
out
:
	`wr™e
(
	`fÜm©
("@@ %d @@\n", 
n
))

207 
’d


208 
nÙ
 
show
 
th’
 
Ãxt
 
’d


209 
’d


210 
v
 
th’


211 
out
:
	`wr™e
(
	$fÜm©
(
fmtv
, 
v
, 
lše
))

213 
out
:
	`wr™e
(
	$fÜm©
(
fmŠ
, 
lše
))

214 
’d


215 ::
Ãxt
::

216 
n
 =‚ + 1

217 
’d


218 
å
:
	$şo£
()

219 
’d


220 
’d


224 -- 
Fšish
 
´ofšg
 
ªd
 
dump
 
»suÉ
.

225 
loÿl
 
funùiÚ
 
	$´of_fšish
()

226 
´of_ud
 
th’


227 
´ofe
.
	$¡İ
()

228 
loÿl
 
§m¶es
 = 
´of_§m¶es


229 
§m¶es
 =ğ0 
th’


230 
´of_¿w
 ~ğ
Œue
 
th’
 
out
:
	`wr™e
("[NØ§m¶e cŞËùed]\n"è
’d


232 
’d


233 
´of_ªn
 
th’


234 
	$´of_ªnÙ©e
(
´of_couÁ1
, 
§m¶es
)

236 
	`´of_tİ
(
´of_couÁ1
, 
´of_couÁ2
, 
§m¶es
, "")

237 
’d


238 
´of_couÁ1
 = 
n


239 
´of_couÁ2
 = 
n


240 
´of_ud
 = 
n


241 
’d


242 
’d


244 -- 
S¹
 
´ofšg
.

245 
loÿl
 
funùiÚ
 
	$´of_¡¬t
(
mode
)

246 
loÿl
 
š‹rv®
 = ""

247 
mode
 = mode:
	`gsub
("i%d*", 
	$funùiÚ
(
s
è
š‹rv®
 = s;  "" 
’d
)

248 
´of_mš
 = 3

249 
mode
 = mode:
	`gsub
("m(%d+)", 
	$funùiÚ
(
s
è
´of_mš
 = 
	`tÚumb”
(s);  "" 
’d
)

250 
´of_d•th
 = 1

251 
mode
 = mode:
	`gsub
("%-?%d+", 
	$funùiÚ
(
s
è
´of_d•th
 = 
	`tÚumb”
(s);  "" 
’d
)

252 
loÿl
 
m
 = {
	}
}

253 
c
 
š
 
mode
:
gm©ch
("."èdØ
m
[c] = c 
’d


254 
´of_¡©es
 = 
m
.
z
 
Ü
 m.
v


255 
´of_¡©es
 =ğ"z" 
th’
 
zÚe
 = 
»quœe
("j™.zÚe"è
’d


256 
loÿl
 
scİe
 = 
m
.
l
 
Ü
 m.
f
 o¸m.
F
 o¸(
´of_¡©es
 
ªd
 "" or "f")

257 
loÿl
 
æags
 = (
m
.
p
 
Ü
 "")

258 
´of_¿w
 = 
m
.
r


259 
m
.
s
 
th’


260 
´of_¥l™
 = 2

261 
´of_d•th
 =ğ-1 
Ü
 
m
["-"] 
th’
…rof_depth = -2

262 
–£if
 
´of_d•th
 =ğ1 
th’
…rof_d•th = 2 
’d


263 
–£if
 
mode
:
fšd
("[fF].*l"è
th’


264 
scİe
 = "l"

265 
´of_¥l™
 = 3

267 
´of_¥l™
 = (
scİe
 =ğ"" 
Ü
 
mode
:
fšd
("[zv].*[lfF]")è
ªd
 1 or 0

268 
’d


269 
´of_ªn
 = 
m
.
A
 
ªd
 0 
	$Ü
 (
m
.
a
 
ªd
 3)

270 
´of_ªn
 
th’


271 
scİe
 = "l"

272 
´of_fmt
 = "pl"

273 
´of_¥l™
 = 0

274 
´of_d•th
 = 1

275 
–£if
 
m
.
G
 
ªd
 
scİe
 ~ğ"" 
th’


276 
´of_fmt
 = 
æags
..
scİe
.."Z;"

277 
´of_d•th
 = -100

278 
´of_¿w
 = 
Œue


279 
´of_mš
 = 0

280 
–£if
 
scİe
 =ğ"" 
th’


281 
´of_fmt
 = 
çl£


283 
loÿl
 
sc
 = 
´of_¥l™
 =ğ3 
ªd
 
m
.
f
 
Ü
 m.
F
 o¸
scİe


284 
´of_fmt
 = 
æags
..
sc
..(
´of_d•th
 >ğ0 
ªd
 "Z < " 
Ü
 "Z > ")

285 
’d


286 
´of_couÁ1
 = {
	}
}

287 
´of_couÁ2
 = {}

288 
´of_§m¶es
 = 0

289 
´ofe
.
¡¬t
(
scİe
:
low”
()..
š‹rv®
, 
´of_cb
)

290 
	g´of_ud
 = 
	$Ãw´oxy
(
Œue
)

291 
	`g‘m‘©abË
(
´of_ud
).
__gc
 = 
´of_fšish


292 
’d


296 
loÿl
 
funùiÚ
 
	$¡¬t
(
mode
, 
outfe
)

297 
nÙ
 
outfe
 
th’
 outfğ
os
.
	`g‘’v
("LUAJIT_PROFILEFILE"è
’d


298 
outfe
 
th’


299 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
	`as£¹
(
io
.
	`İ’
(outfile, "w"))

301 
out
 = 
¡dout


302 
’d


303 
	`´of_¡¬t
(
mode
 
Ü
 "f")

304 
’d


306 -- 
Public
 
moduË
 
funùiÚs
.

308 
¡¬t
 = s¹, -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

309 
¡İ
 = 
´of_fšish


310 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/v.lua

2 -- 
V”bo£
 
mode
 
of
 
the
 
LuaJIT
 
	gcomp”
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
shows
 
v”bo£
 
šfÜm©iÚ
 
about
 
the
 
´og»ss
 
of
 
	gthe


9 -- 
JIT
 
	gcomp”
. 
It
 
´šts
 
Úe
 
lše
 
—ch
 
g’”©ed
 
	gŒaû
. 
This
 
	gmoduË


10 -- 
is
 
u£ful
 
to
 
£e
 
which
 
code
 
has
 
b“n
 
comped
 
Ü
 
wh”e
 
the
 
	gcomp”


11 -- 
puÁs
 
ªd
 
çÎs
 
back
 
to
 
the
 
	gš‹½»‹r
.

13 -- 
Exam¶e
 
	gu§ge
:

15 -- 
luaj™
 -
jv
 -
e
 "for i=1,1000 do for j=1,1000 doƒndƒnd"

16 -- 
luaj™
 -
jv
=
my­p
.
out
 my­p.
lua


18 -- 
DeçuÉ
 
ouut
 
is
 
to
 
¡d”r
. 
To
 
»dœeù
 
the
 ouuˆtØ
a
 
fe
, 
·ss
 
	ga


19 -- 
f’ame
 
as
 
ª
 
¬gum’t
 (
u£
 '-' 
¡dout
è
Ü
 
£t
 
the
 
	g’vœÚm’t


20 -- 
v¬ŸbË
 
	gLUAJIT_VERBOSEFILE
. 
The
 
fe
 
is
 
ov”wr™‹n
 
ev”y
 
time
 
	gthe


21 -- 
moduË
 
is
 
	g¡¬‹d
.

23 -- 
The
 
ouut
 
äom
 
the
 
fœ¡
 
exam¶e
 
should
 
look
 
like
 
	gthis
:

25 -- [
TRACE
 1 (
commªd
 
lše
):1 
loİ
]

26 -- [
TRACE
 2 (1/3è(
commªd
 
lše
):1 -> 1]

28 -- 
The
 
fœ¡
 
numb”
 
š
 
—ch
 
lše
 
is
 
the
 
š‹º®
 
Œaû
‚umb”. 
Next
 
¬e


29 -- 
the
 
fe
 
Çme
 ('(commªd†še)'è
ªd
h
lše
 
numb”
 (':1'è
wh”e
he

30 -- 
Œaû
 
has
 
¡¬‹d
. 
Side
 
Œaûs
 
®so
 
show
 
the
 
·»Á
¿û 
numb”
 
ªd


31 -- 
the
 
ex™
 
numb”
 
wh”e
 
they
 
¬e
 
©ched
 
to
 
š
 
·»Áhe£s
 ('(1/3)').

32 -- 
An
 
¬row
 
©
 
the
 
’d
 
shows
 
wh”e
h
Œaû
 
lšks
 
to
 ('-> 1'), 
	guÆess


33 -- 
™
 
loİs
 
to
 
	g™£lf
.

35 -- 
In
 
this
 
the
 
šÃr
 
loİ
 
g‘s
 
hÙ
 
ªd
 
is
 
Œaûd
 
	gfœ¡
, 
	gg’”©šg


36 -- 
a
 
roÙ
 
	gŒaû
. 
Th’
 
the
 
Ï¡
 
ex™
 
äom
 
	gthe
 1
¡
 
Œaû
 
g‘s
 
	ghÙ
, 
	gtoo
,

37 -- 
ªd
 
Œigg”s
 
g’”©iÚ
 
of
 
	gthe
 2
nd
 
	gŒaû
. 
The
 
side
 
Œaû
 
fŞlows
he

38 -- 
·th
 
®Úg
 
the
 
ou‹r
 
loİ
 
ªd
 *
¬ound
*h
šÃr
 
	gloİ
, 
back
 
to
 
	g™s


39 -- 
	g¡¬t
, 
ªd
 
th’
 
lšks
 
to
 
	gthe
 1
¡
 
	gŒaû
. 
	gYes
, 
this
 
may
 
£em
 
	gunusu®
,

40 -- 
you
 
know
 
how
 
Œad™iÚ®
 
comp”s
 
	gwÜk
. 
T¿û
 comp” 
¬e
 
	gfuÎ


41 -- 
of
 
su½ri£s
 
like
 
	gthis
 -- 
have
 
	gfun
! :-)

43 -- 
AbÜ‹d
 
Œaûs
 
¬e
 
shown
 
like
 
this
:

45 -- [
TRACE
 --- 
foo
.
lua
:44 -- 
Ëavšg
 
loİ
 
š
 
roÙ
 
Œaû
 
©
 foo:lua:50]

47 -- 
DÚ
't worry --race‡borts‡re quite common,ƒven in…rograms which

48 -- 
ÿn
 
be
 
fuÎy
 
comped
. 
The
 
comp”
 
may
 
»Œy
 
£v”®
 
times
 
uÁ
 
™


49 -- 
fšds
 
a
 
su™abË
 
Œaû
.

51 -- 
Of
 
cour£
 
this
 
dÛ¢
't work with featureshat‡re‚ot-yet-implemented

52 -- (
NYI
 
”rÜ
 
mes§ges
). 
The
 
VM
 
sim¶y
 
çÎs
 
back
 
to
 
the
 
š‹½»‹r
. 
This


53 -- 
may
 
nÙ
 
m©‹r
 
©
 
®l
 
the
 
·¹icuÏr
 
Œaû
 
is
‚Ù 
v”y
 
high
 
up
 
š


54 -- 
the
 
CPU
 
u§ge
 
´ofe
. 
Oh
, 
ªd
h
š‹½»‹r
 
is
 
qu™e
 
	gç¡
, 
	gtoo
.

56 -- 
Also
 
check
 
out
 
	gthe
 -
jdump
 
	gmoduË
, 
which
 
´šts
 
®l
 
the
 
gÜy
 
	gd‘as
.

60 -- 
Cache
 
some
 
lib¿ry
 
funùiÚs
 
ªd
 
	gobjeùs
.

61 
loÿl
 
	gj™
 = 
»quœe
("jit")

62 
as£¹
(
j™
.
v”siÚ_num
 == 20100, "LuaJIT core/library version mismatch")

63 
loÿl
 
	gjut
 = 
»quœe
("jit.util")

64 
loÿl
 
vmdef
 = 
»quœe
("jit.vmdef")

65 
loÿl
 
funcšfo
, 
	gŒaûšfo
 = 
jut
.funcšfo, 
	gjut
.
Œaûšfo


66 
loÿl
 
	gty³
, 
	gfÜm©
 = 
ty³
, 
	g¡ršg
.
fÜm©


67 
loÿl
 
	g¡dout
, 
	g¡d”r
 = 
io
.
¡dout
, 
	gio
.stderr

69 -- 
Aùive
 
æag
 
ªd
 
ouut
 
fe
 
	ghªdË
.

70 
loÿl
 
	gaùive
, 
	gout


74 
loÿl
 
	g¡¬oc
, 
¡¬‹x


76 
loÿl
 
funùiÚ
 
	$fmtfunc
(
func
, 
pc
)

77 
loÿl
 
fi
 = 
	$funcšfo
(
func
, 
pc
)

78 
fi
.
loc
 
th’


79  
fi
.
loc


80 
–£if
 
fi
.
ffid
 
th’


81  
vmdef
.
fâames
[
fi
.
ffid
]

82 
–£if
 
fi
.
addr
 
th’


83  
	`fÜm©
("C:%x", 
fi
.
addr
)

86 
’d


87 
’d


89 -- 
FÜm©
 
Œaû
 
”rÜ
 
mes§ge
.

90 
loÿl
 
funùiÚ
 
	$fm‹¼
(
”r
, 
šfo
)

91 
	`ty³
(
”r
è=ğ"numb”" 
th’


92 
	`ty³
(
šfo
è=ğ"funùiÚ" 
th’
 infØğ
	$fmtfunc
(
šfo
è
’d


93 
”r
 = 
	$fÜm©
(
vmdef
.
Œaû”r
[
”r
], 
šfo
)

94 
’d


95  
”r


96 
’d


98 -- 
Dump
 
Œaû
 
¡©es
.

99 
loÿl
 
funùiÚ
 
	$dump_Œaû
(
wh©
, 
Œ
, 
func
, 
pc
, 
Ùr
, 
Ûx
)

100 
wh©
 =ğ"¡¬t" 
th’


101 
¡¬oc
 = 
	$fmtfunc
(
func
, 
pc
)

102 
¡¬‹x
 = 
Ùr
 
ªd
 "("..Ùr.."/"..(
Ûx
 =ğ-1‡nd "¡™ch" 
Ü
 oex)..") " or ""

104 
wh©
 =ğ"abÜt" 
th’


105 
loÿl
 
loc
 = 
	$fmtfunc
(
func
, 
pc
)

106 
loc
 ~ğ
¡¬oc
 
th’


107 
out
:
	`wr™e
(
	`fÜm©
("[TRACE --- %s%s -- %s‡t %s]\n",

108 
¡¬‹x
, 
¡¬oc
, 
	`fm‹¼
(
Ùr
, 
Ûx
), 
loc
))

110 
out
:
	`wr™e
(
	`fÜm©
("[TRACE --- %s%s -- %s]\n",

111 
¡¬‹x
, 
¡¬oc
, 
	$fm‹¼
(
Ùr
, 
Ûx
)))

112 
’d


113 
–£if
 
wh©
 =ğ"¡İ" 
th’


114 
loÿl
 
šfo
 = 
	$Œaûšfo
(
Œ
)

115 
loÿl
 
lšk
, 
Éy³
 = 
šfo
.lšk, info.
lškty³


116 
Éy³
 =ğ"š‹½»‹r" 
th’


117 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s -- fallbacko interpreter]\n",

118 
Œ
, 
¡¬‹x
, 
¡¬oc
))

119 
–£if
 
Éy³
 =ğ"¡™ch" 
th’


120 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s %s %s]\n",

121 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
Éy³
, 
	$fmtfunc
(
func
, 
pc
)))

122 
–£if
 
lšk
 =ğ
Œ
 
Ü
†šk =ğ0 
th’


123 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s %s]\n",

124 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
Éy³
))

125 
–£if
 
Éy³
 =ğ"roÙ" 
th’


126 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s -> %d]\n",

127 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
lšk
))

129 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %3s %s%s -> %d %s]\n",

130 
Œ
, 
¡¬‹x
, 
¡¬oc
, 
lšk
, 
Éy³
))

131 
’d


133 
out
:
	`wr™e
(
	`fÜm©
("[TRACE %s]\n", 
wh©
))

134 
’d


135 
out
:
	$æush
()

136 
’d


137 
’d


141 -- 
D‘ach
 
dump
 
hªdËrs
.

142 
loÿl
 
funùiÚ
 
	$dumpoff
()

143 
aùive
 
th’


144 
aùive
 = 
çl£


145 
j™
.
	$©ch
(
dump_Œaû
)

146 
out
 
ªd
 ouˆ~ğ
¡dout
‡nd ouˆ~ğ
¡d”r
 
th’
 out:
	$şo£
(è
’d


147 
out
 = 
n


148 
’d


149 
’d


151 -- 
O³n
 
the
 
ouut
 
fe
 
ªd
 
©ch
 
dump
 
hªdËrs
.

152 
loÿl
 
funùiÚ
 
	$dumpÚ
(
outfe
)

153 
aùive
 
th’
 
	$dumpoff
(è
’d


154 
nÙ
 
outfe
 
th’
 outfğ
os
.
	`g‘’v
("LUAJIT_VERBOSEFILE"è
’d


155 
outfe
 
th’


156 
out
 = 
outfe
 =ğ"-" 
ªd
 
¡dout
 
Ü
 
	`as£¹
(
io
.
	`İ’
(outfile, "w"))

158 
out
 = 
¡d”r


159 
’d


160 
j™
.
	`©ch
(
dump_Œaû
, "trace")

161 
aùive
 = 
Œue


162 
’d


164 -- 
Public
 
moduË
 
funùiÚs
.

166 
Ú
 = 
dumpÚ
,

167 
off
 = 
dumpoff
,

168 
¡¬t
 = 
dumpÚ
 -- 
FÜ
 -
j
 
commªd
 
lše
 
İtiÚ
.

169 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/vmdef.lua

1 -- 
This
 
is
 
a
 
g’”©ed
 
	gfe
. 
DO
 
NOT
 
	gEDIT
!

5 
	gbúames
 = "ISLT ISGE ISLE ISGT ISEQV ISNEV ISEQS ISNES ISEQN ISNEN ISEQP ISNEP ISTC ISFC IST ISF ISTYPEISNUM MOV NOT UNM LEN ADDVN SUBVN MULVN DIVVN MODVN ADDNV SUBNV MULNV DIVNV MODNV ADDVV SUBVV MULVV DIVVV MODVV POW CAT KSTR KCDATAKSHORTKNUM KPRI KNIL UGET USETV USETS USETN USETP UCLO FNEW TNEW TDUP GGET GSET TGETV TGETS TGETB TGETR TSETV TSETS TSETB TSETM TSETR CALLM CALL CALLMTCALLT ITERC ITERN VARG ISNEXTRETM RET RET0 RET1 FORI JFORI FORL IFORL JFORL ITERL IITERLJITERLLOOP ILOOP JLOOP JMP FUNCF IFUNCFJFUNCFFUNCV IFUNCVJFUNCVFUNCC FUNCCW",

7 
	gœÇmes
 = "LT GE LE GT ULT UGE ULE UGT EQ NE ABC RETF NOP BASE PVAL GCSTEPHIOP LOOP USE PHI RENAMEPROF KPRI KINT KGC KPTR KKPTR KNULL KNUM KINT64KSLOT BNOT BSWAP BAND BOR BXOR BSHL BSHR BSAR BROL BROR ADD SUB MUL DIV MOD POW NEG ABS ATAN2 LDEXP MIN MAX FPMATHADDOV SUBOV MULOV AREF HREFK HREF NEWREFUREFO UREFC FREF STRREFLREF ALOAD HLOAD ULOAD FLOAD XLOAD SLOAD VLOAD ASTOREHSTOREUSTOREFSTOREXSTORESNEW XSNEW TNEW TDUP CNEW CNEWI BUFHDRBUFPUTBUFSTRTBAR OBAR XBAR CONV TOBIT TOSTR STRTO CALLN CALLA CALLL CALLS CALLXSCARG ",

9 
	gœåm
 = { [0]="floor", "ceil", "trunc", "sqrt", "exp", "exp2", "log", "log2", "log10", "sin", "cos", "tan", "other", },

11 
	gœf›ld
 = { [0]="str.len", "func.env", "func.pc", "func.ffid", "thread.env", "tab.meta", "tab.array", "tab.node", "tab.asize", "tab.hmask", "tab.nomm", "udata.meta", "udata.udtype", "udata.file", "cdata.ctypeid", "cdata.ptr", "cdata.int", "cdata.int64", "cdata.int64_4", },

13 
	gœÿÎ
 = {

118 
	gŒaû”r
 = {

156 
	gfâames
 = {

	@/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/zone.lua

2 -- 
LuaJIT
 
´of”
 
	gzÚes
.

4 -- 
Cİyright
 (
C
è2005-2017 
Mike
 
	gP®l
. 
AÎ
 
rights
 
	g»£rved
.

5 -- 
R–—£d
 
und”
 
the
 
MIT
 
	gliûn£
. 
S“
 
Cİyright
 
NÙiû
 
š
 
	gluaj™
.
	gh


8 -- 
This
 
moduË
 
im¶em’ts
 
a
 
sim¶e
 
h›¿rchiÿl
 
zÚe
 
	gmod–
.

10 -- 
Exam¶e
 
	gu§ge
:

12 -- 
loÿl
 
zÚe
 = 
»quœe
("jit.zone")

13 -- 
zÚe
("AI")

15 -- 
zÚe
("A*")

17 -- 
´št
(
zÚe
:
g‘
()) --> "A*"

19 -- 
zÚe
()

21 -- 
´št
(
zÚe
:
g‘
()) --> "AI"

23 -- 
zÚe
()

27 
loÿl
 
»move
 = 
bË
.remove

29  
£tm‘©abË
({

30 
æush
 = 
funùiÚ
(
t
)

31 
i
=#t,1,-1 dØ
t
[i] = 
n
 
’d


32 
’d
,

33 
g‘
 = 
funùiÚ
(
t
)

34  
t
[#t]

35 
’d


37 
__ÿÎ
 = 
funùiÚ
(
t
, 
zÚe
)

38 
zÚe
 
th’


39 
t
[#t+1] = 
zÚe


41  (
as£¹
(
»move
(
t
), "empty zone stack"))

42 
’d


43 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/dpdk-conf.lua

1 -- 
CÚfigu¿tiÚ
 
®l
 
DPDK
 
commªd
 
lše
 
	g·¿m‘”s
.

2 -- 
S“
 
DPDK
 
docum’tiÚ
 
©
 
	gh‰p
:

3 -- 
libmoÚ
 
Œ›s
 
to
 
choo£
 
»asÚabË
 
deçuÉs
, 
so
 
this
 
cÚfig
 
fe
 
ÿn
 
®mo¡
 
®ways
 
be
 
	gem±y
.

4 -- 
Be
 
ÿ»ful
 
wh’
 
ruÂšg
 
libmoÚ
 
š
 
a
 
VM
 
th©
 
®so
 
u£s
 
ªÙh”
 
vœtio
 
	gNIC
, 
	ge
.
	gg
., 
š‹º‘
 
	gacûss
.

5 -- 
In
 
this
 
™
 
may
 
be
 
Ãûs§ry
 
to
 
u£
 
the
 
bÏckli¡
 
Ü
 
wh™–i¡
 
ã©u»s
 
š
 
some
 
	gcÚfigu¿tiÚs
.

6 
	gDPDKCÚfig
 {

7 -- 
cÚfigu»
 
the
 
CPU
 
cÜes
 
to
 
	gu£
, : 
®l
 cores

8 --
cÜes
 = {0, 10, 11, 12, 13, 14, 15},

10 -- 
max
 
numb”
 
of
 
sh¬ed
 
sks
 
ruÂšg
 
Ú
 
	gcÜe
 0

11 --
	gsh¬edCÜes
 = 8,

13 -- 
bÏck
 
Ü
 
wh™–i¡
 
deviûs
 
to
 
lim™
 
which
 
PCI
 
devs
 
¬e
 
u£d
 
by
 
	gDPDK


14 -- 
Úly
 
Úe
 
of
 
the
 
fŞlowšg
 
exam¶es
 
ÿn
 
be
 
	gu£d


15 --
	gpciBÏckli¡
 = {"0000:81:00.3","0000:81:00.1"},

16 --
	gpciWh™–i¡
 = {"0000:81:00.3","0000:81:00.1"},

18 -- 
¬b™¿ry
 
DPDK
 
commªd
 
lše
 
	gİtiÚs


19 -- 
the
 
fŞlowšg
 
cÚfigu¿tiÚ
 
®lows
 
muÉË
 
DPDK
 
š¡ªûs
 (
u£
 
tog‘h”
 
w™h
 
pciWh™–i¡
)

20 -- 
	gcf
. 
	gh‰p
:

21 --
şi
 = {

	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/c-integration/c-integration.lua

1 --- 
BasiÿÎy
 
the
 
§me
 
as
 
	g»æeùÜ
.
	glua


2 --- 
Ju¡
 
to
 
show
 
how
Ø
š‹g¿‹
 
C
 
	gcode
.

3 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

4 
loÿl
 
memÜy
 = 
»quœe
 "memory"

5 
loÿl
 
deviû
 = 
»quœe
 "device"

6 
loÿl
 
¡©s
 = 
»quœe
 "stats"

7 
loÿl
 
ffi
 = 
»quœe
 "ffi"

9 -- 
£¬ch
 
libsw­
-
macs
.
so
 
š
 
the
 
usu®
 
sy¡em
 
·ths
 
ªd
 iÀ
Lua
's…ackage.path

10 -- 
this
 
šşudes
 
the
 
dœeùÜy
 
š
 
which
h
execu‹d
 
lm
 
süt
 
is
 
loÿ‹d


11 -- 
you
 
ÿn
 
®so
 
¥ecify
 
subdœeùÜ›s
 
to
 
£¬ch
, 
	ge
.
	gg
., 
	gffi
.
lßd
("bud/foo"è
wl
 
	glook


12 -- 
	gbud
/
	glibfoo
.
so
 
š
 
®l
 
»Ëvªt
 
dœeùÜ›s


13 
loÿl
 
	gşib
 = 
ffi
.
lßd
("swap-macs")

15 -- 
deş¬e
 
funùiÚ
 
´ÙÙy³s
 
h”e
 
to
 
make
 
them
 
ÿÎabË


16 -- 
C
++: 
deş¬e
 
the
 
funùiÚ
 
as
 "C" 
š
hC++ 
fe
 
ªd
 
ÿÎ
 
like
 
a
 C function

17 
ffi
.
cdef
[[

18 
sw­_macs
(
¹e_mbuf
* 
mbufs
[], 
ušt32_t
 
num_bufs
);

21 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

22 
·r£r
:
	`¬gum’t
("dev", "Deviû tØu£."):
	`¬gs
("+"):
	$cÚv”t
(
tÚumb”
)

23 
·r£r
:
	`İtiÚ
("-ˆ--th»ads", "Numb” oàth»ad ³¸deviû."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1)

24 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

25 
’d


27 
funùiÚ
 
	$ma¡”
(
¬gs
)

28 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

29 
¬gs
.
dev
[
i
] = 
deviû
.
cÚfig
{

30 
pÜt
 = 
dev
,

31 
rxQueues
 = 
¬gs
.
th»ads
,

32 
txQueues
 = 
¬gs
.
th»ads
,

33 
rssQueues
 = 
¬gs
.
th»ads


34 
	}
}

35 
’d


36 
	gdeviû
.
wa™FÜLšks
()

38 -- 
´št
 
¡©i¡ics


39 
	g¡©s
.
	g¡¬tStsTask
{
	gdeviûs
 = 
¬gs
.
dev
, 
	gfe
 =‡rgs.
ouut
}

41 
	gi
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

42 
i
 = 0, 
¬gs
.
th»ads
 - 1 do

43 
lm
.
	`¡¬tTask
("»æeùÜ", 
dev
:
	`g‘RxQueue
(
i
), dev:
	$g‘TxQueue
(
i
))

44 
’d


45 
’d


46 
lm
.
	$wa™FÜTasks
()

47 
’d


49 
funùiÚ
 
	$»æeùÜ
(
rxQ
, 
txQ
)

50 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

51 
lm
.
	$ruÂšg
() do

52 
loÿl
 
rx
 = 
rxQ
:
	`ŒyRecv
(
bufs
, 1000)

53 -- 
you
 
ÿn
 
ju¡
 
ÿÎ
 
C
 
funùiÚs
 
deş¬ed
 
above


54 -- 
bufs
.
¬¿y
 
is
 
the
 
¹e_mbuf
*‡¼ay 
u£d
 
š‹º®ly
 
by
 
a
 
lm
 
bufA¼ay


55 
şib
.
	$sw­_macs
(
bufs
.
¬¿y
, 
rx
)

56 
txQ
:
	$£ndN
(
bufs
, 
rx
)

57 
’d


58 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/dump-pkts.lua

1 --- 
C­tu»s
 
	g·ck‘s
, 
ÿn
 
dump
 
to
 
a
 
pÿp
 
fe
 
Ü
 
decode
 
Ú
 
¡ªd¬d
 
	gout
.

2 --- 
This
 
is
 
es£ÁŸÎy
 
ª
 
exŒem–y
 
ç¡
 
v”siÚ
 
of
 
	gtıdump
, 
	gsšgË
-
th»aded
 
¡©s
 
	g¬e
:

3 --- * > 20 
Mµs
 
f‹ršg
 (
d•’dšg
 
Ú
 
f‹r
, 
‹¡ed
 
w™h
 
pÜt
 
¿nge
 
ªd
 
IP
 
m©chšg
)

4 --- * > 11 
Mµs
 
pÿp
 
wr™šg
 (60 
by‹
 
·ck‘s
)

6 --- 
This
 
sÿËs
 
v”y
 
w–l
 
to
 
muÉË
 
	gcÜe
, 
we
 
ach›ved
 
the
 
fŞlowšg
 
	gw™h
 4 2.2 
GHz
 
	gcÜes
:

7 --- * 20 
Mµs
 
pÿp
 
ÿ±uršg
 (
lim™ed
 
by
 
sm®l
 
·ck‘
 
³rfÜmªû
 
of
 
i40e
 
NIC
)

8 --- * 40 
Gb™
/
s
 
pÿp
 
ÿ±uršg
 
of
 128 
by‹
 
·ck‘s
 
to
 
fe
 
sy¡em
 
ÿche
 (
mm­
)

9 --- * 1900 
MB
/
s
 (~15 
Gb™
/sè
su¡ašed
 
wr™e
 
¥“d
 
to
 
a
 
¿id
 
of
 
two
 
NVMe
 
SSDs


11 --- 
NÙe
 
th©
 
the
 
¡©s
 
shown
 
©
h
’d
 
wl
 
´obably
 
nÙ
 
add
 
up
 
wh’
 
¶uggšg
 
this
 
što
 
live
 
Œaffic
:

12 --- 
Some
 
·ck‘s
 
¬e
 
sim¶y
 
lo¡
 
duršg
 
NIC
 
»£t
 
ªd
 
¡¬tup
 (
the
 NIC 
couÁ”
 
is
 
a
 
h¬dw¬e
 counter).

14 
loÿl
 
lm
 = 
»quœe
 "libmoon"

15 
loÿl
 
deviû
 = 
»quœe
 "device"

16 
loÿl
 
memÜy
 = 
»quœe
 "memory"

17 
loÿl
 
¡©s
 = 
»quœe
 "stats"

18 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

19 
loÿl
 
‘h
 = 
»quœe
 "proto.ethernet"

20 
loÿl
 
log
 = 
»quœe
 "log"

21 
loÿl
 
pÿp
 = 
»quœe
 "pcap"

22 
loÿl
 
pf
 = 
»quœe
 "pf"

24 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

25 
·r£r
:
	`¬gum’t
("dev", "DeviûØu£."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

26 
·r£r
:
	`İtiÚ
("-¨--¬p", "Re¥ÚdØARP qu”› Úhgiv’ IP."):
	`¬gÇme
("ip")

27 
·r£r
:
	`İtiÚ
("-f --file", "Write„esulto‡…cap file.")

28 
·r£r
:
	`İtiÚ
("- --¢­-Ën", "Trunÿ‹…ack‘ tØthi size."):
	$cÚv”t
(
tÚumb”
):
	`rg‘
("snapLen")

29 
·r£r
:
	`İtiÚ
("-ˆ--th»ads", "Numb” oàth»ads."):
	$cÚv”t
(
tÚumb”
):(1)

30 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

31 
·r£r
:
	`¬gum’t
("f‹r", "A BPF f‹¸ex´essiÚ."):
	`¬gs
("*"):
	$combše
()

32 
loÿl
 
¬gs
 = 
·r£r
:
	$·r£
()

33 
¬gs
.
f‹r
 
th’


34 
loÿl
 
ok
, 
”r
 = 
	$pÿÎ
(
pf
.
compe_f‹r
, 
¬gs
.
f‹r
)

35 
nÙ
 
ok
 
th’


36 
·r£r
:
	$”rÜ
(
”r
)

37 
’d


38 
’d


39  
¬gs


40 
’d


42 
funùiÚ
 
	$ma¡”
(
¬gs
)

43 
loÿl
 
dev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.dev, 
txQueues
 =‡rgs.
¬p
 
ªd
 2 
Ü
 1, 
rxQueues
 =‡rgs.
th»ads
, 
rssQueues
 =‡rgs.
	}
threads}

44 
	gdeviû
.
	$wa™FÜLšks
()

45 
¬gs
.
¬p
 
th’


46 
¬p
.
¡¬tA½Task
{
txQueue
 = 
dev
:
	`g‘TxQueue
(1), 
s
 = 
¬gs
.
	}
arp}

47 
	g¬p
.
wa™FÜS¹up
(è-- 
¿û
 
cÚd™iÚ
 
w™h
‡½.
	$hªdËPack‘
(è
Ùh”wi£


48 
’d


49 
¡©s
.
¡¬tStsTask
{
rxDeviûs
 = {
dev
}, 
fe
 = 
¬gs
.
ouut
}

50 
	gi
 = 1, 
	g¬gs
.
th»ads
 do

51 
	glm
.
¡¬tTask
("dum³r", 
dev
:
g‘RxQueue
(
i
 - 1), 
¬gs
, i)

52 
’d


53 
	glm
.
	$wa™FÜTasks
()

54 
’d


56 
funùiÚ
 
	$dum³r
(
queue
, 
¬gs
, 
th»adId
)

57 
loÿl
 
hªdËA½
 = 
¬gs
.
¬p


58 -- : 
show
 
ev”ythšg


59 
loÿl
 
f‹r
 = 
¬gs
.f‹¸
ªd
 
pf
.
	$compe_f‹r
(
¬gs
.
f‹r
è
Ü
 
	$funùiÚ
(è 
Œue
 
’d


60 
loÿl
 
¢­L’
 = 
¬gs
.snapLen

61 
loÿl
 
wr™”


62 
loÿl
 
ÿ±u»CŒ
, 
f‹rCŒ


63 
¬gs
.
fe
 
th’


64 
¬gs
.
th»ads
 > 1 
th’


65 
¬gs
.
fe
:
	`m©ch
("%.pÿp$"è
th’


66 
¬gs
.
fe
 =‡rgs.fe:
	`gsub
("%.pcap$", "")

67 
’d


68 
¬gs
.
fe
 =‡rgs.f.. "-th»ad-" .. 
th»adId
 .. ".pcap"

70 
nÙ
 
¬gs
.
fe
:
	`m©ch
("%.pÿp$"è
th’


71 
¬gs
.
fe
 =‡rgs.file .. ".pcap"

72 
’d


73 
’d


74 
wr™”
 = 
pÿp
:
	$ÃwWr™”
(
¬gs
.
fe
)

75 
ÿ±u»CŒ
 = 
¡©s
:
	`ÃwPktRxCouÁ”
("C­tu»,h»ad #" .. 
th»adId
)

76 
f‹rCŒ
 = 
¡©s
:
	`ÃwPktRxCouÁ”
("F‹¸»jeù,h»ad #" .. 
th»adId
)

77 
’d


78 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

79 
lm
.
	$ruÂšg
() do

80 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 100)

81 
loÿl
 
b©chTime
 = 
lm
.
	$g‘Time
()

82 
i
 = 1, 
rx
 do

83 
loÿl
 
buf
 = 
bufs
[
i
]

84 
	`f‹r
(
buf
:
	`g‘By‹s
(), buf:
	$g‘Size
()è
th’


85 
wr™”
 
th’


86 
wr™”
:
	$wr™eBuf
(
b©chTime
, 
buf
, 
¢­L’
)

87 
ÿ±u»CŒ
:
	$couÁPack‘
(
buf
)

89 
buf
:
	$dump
()

90 
’d


91 
–£if
 
f‹rCŒ
 
th’


92 
f‹rCŒ
:
	$couÁPack‘
(
buf
)

93 
’d


94 
hªdËA½
 
ªd
 
buf
:
	`g‘Eth”ÃtPack‘
().
‘h
:
	`g‘Ty³
(è=ğ‘h.
TYPE_ARP
 
th’


95 -- 
šjeù
 
¬p
 
·ck‘s
 
to
 
the
 
ARP
 
sk


96 -- 
this
 
is
 
dÚe
hi 
way
 
š¡—d
 
of
 
usšg
 
f‹rs
 
to
 
®so
 
dump
 
ARP
 
·ck‘s
 
h”e


97 
¬p
.
	$hªdËPack‘
(
buf
)

99 -- dØ
nÙ
 
ä“
 
·ck‘s
 
hªdËt
 
by
 
the
 
ARP
 
sk
, 
this
 
is
 
dÚe
 byh
¬p
ask

100 
buf
:
	$ä“
()

101 
’d


102 
’d


103 
wr™”
 
th’


104 
ÿ±u»CŒ
:
	$upd©e
()

105 
f‹rCŒ
:
	$upd©e
()

106 
’d


107 
’d


108 
wr™”
 
th’


109 
ÿ±u»CŒ
:
	$fš®ize
()

110 
f‹rCŒ
:
	$fš®ize
()

111 
log
:
	`šfo
("Flushing buffers,his canake‡ while...")

112 
wr™”
:
	$şo£
()

113 
’d


114 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/filter.lua

1 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

2 
loÿl
 
deviû
 = 
»quœe
 "device"

3 
loÿl
 
¡©s
 = 
»quœe
 "stats"

4 
loÿl
 
memÜy
 = 
»quœe
 "memory"

5 
loÿl
 
log
 = 
»quœe
 "log"

6 
loÿl
 
pf
 = 
»quœe
 "pf"

7 
loÿl
 
‘h
 = 
»quœe
 "proto.ethernet"

8 
loÿl
 
4
 = 
»quœe
 "proto.ip4"

10 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

11 
·r£r
:
	`desütiÚ
("Demonstrates filtering capabilities.")

12 
·r£r
:
	`¬gum’t
("rxDev", "DeviûØ»ûiväom."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

13 
·r£r
:
	`¬gum’t
("txDev", "DeviûØ£ndo."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

14 
·r£r
:
	`İtiÚ
("--th»ad -t", "Numb” oàth»ads"):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1)

15 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

16 
·r£r
:
	`mu‹x
(

17 
·r£r
:
	`İtiÚ
("--udp-pÜˆ-u", "A UDP…ÜˆtØf‹r."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):
	`rg‘
("udpPort"),

18 
·r£r
:
	`İtiÚ
("--pÿ°-p", "A…ÿ°f‹¸ex´essiÚ."):
	`¬gs
("*"):
	$combše
()

20  
·r£r
:
	$·r£
()

21 
’d


23 
funùiÚ
 
	$ma¡”
(
¬gs
)

24 
loÿl
 
rxDev
 = 
deviû
.
cÚfig
{ 
pÜt
 = 
¬gs
.rxDev, 
rxQueues
 =‡rgs.
th»ads
 
	}
}

25 
loÿl
 
	gtxDev
 = 
deviû
.
cÚfig
{ 
pÜt
 = 
¬gs
.
txDev
, 
	gtxQueues
 =‡rgs.
th»ads
 }

26 
	gdeviû
.
	$wa™FÜLšks
()

27 
i
 = 1, 
¬gs
.
th»ads
 do

28 
lm
.
	`¡¬tTask
("f‹r", 
rxDev
:
	`g‘RxQueue
(
i
 - 1), 
txDev
:
	`g‘TxQueue
(˜- 1), 
¬gs
)

29 
’d


30 
¡©s
.
¡¬tStsTask
{
rxDeviûs
 = {
rxDev
}, 
txDeviûs
 = {
txDev
}, 
fe
 = 
¬gs
.
ouut
}

31 
	glm
.
	$wa™FÜTasks
()

32 
’d


35 
funùiÚ
 
	$f‹r
(
rxQueue
, 
txQueue
, 
¬gs
)

36 
log
:
	`šfo
("F‹ršg…ack‘ comšg from % ªd s’dšgØ%s.", 
rxQueue
, 
txQueue
)

37 
loÿl
 
f‹r


38 
¬gs
.
pÿp
 
th’


39 
loÿl
 
comped
 = 
pf
.
	$compe_f‹r
(
¬gs
.
pÿp
)

40 
f‹r
 = 
	$funùiÚ
(
buf
)

41  
	`comped
(
buf
:
	`g‘By‹s
(), buf:
	$g‘Size
())

42 
’d


43 
–£if
 
¬gs
.
udpPÜt
 
th’


44 
loÿl
 
pÜt
 = 
¬gs
.
udpPÜt


45 
f‹r
 = 
	$funùiÚ
(
buf
)

46 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

47 
pkt
.
‘h
.
ty³
 =ğ
	$bsw­16
(
‘h
.
TYPE_IP
è
ªd
 
pkt
.
4
.
´ÙocŞ
 =ğ4.
PROTO_UDP
 
th’


48  
pkt
.
udp
:
	`g‘D¡PÜt
(è=ğ
pÜt


49 
’d


50 
’d


52 
	`”rÜ
("filter…arameter missing, see --help")

53 
’d


54 
loÿl
 
rxBufs
 = 
memÜy
.
	$bufA¼ay
()

55 
loÿl
 
txBufs
 = 
memÜy
.
	$bufA¼ay
()

56 
lm
.
	$ruÂšg
() do

57 
loÿl
 
rx
 = 
rxQueue
:
	$»cv
(
rxBufs
)

58 
loÿl
 
j
 = 0

59 
i
 = 1, 
rx
 do

60 
loÿl
 
buf
 = 
rxBufs
[
i
]

61 
	$f‹r
(
rxBufs
[
i
]è
th’


62 
rxBufs
[
i
]:
	$ä“
()

64 
j
 = j + 1

65 
txBufs
[
j
] = 
rxBufs
[
i
]

66 
’d


67 
’d


68 
txQueue
:
	$£ndN
(
txBufs
, 
j
)

69 
’d


70 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hardware-timestamping.lua

1 --- 
DemÚ¡¿‹s
 
ªd
 
‹¡s
 
h¬dw¬e
 
time¡ampšg
 
ÿ·b™›s


3 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
ts
 = 
»quœe
 "timestamping"

7 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

8 
loÿl
 
tim”
 = 
»quœe
 "timer"

9 
loÿl
 
log
 = 
»quœe
 "log"

10 
loÿl
 
¡©s
 = 
»quœe
 "stats"

12 
loÿl
 
RUN_TIME
 = 5

14 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

15 
·r£r
:
	`desütiÚ
("Demonstrate‡ndest hardwareimestamping capabilities.\nThe idealest setup forhis is‡ cable directly connectinghewoest…orts.")

16 
·r£r
:
	`¬gum’t
("dev", "Deviû tØu£."):
	$¬gs
(2):
	$cÚv”t
(
tÚumb”
)

17 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

18  
·r£r
:
	$·r£
()

19 
’d


21 
funùiÚ
 
	$ma¡”
(
¬gs
)

22 
¬gs
.
dev
[1] = 
deviû
.
cÚfig
{
pÜt
 =‡rgs.dev[1], 
txQueues
 = 2
	}
}

23 
	g¬gs
.
	gdev
[2] = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
dev
[2], 
	grxQueues
 = 2}

24 
	gdeviû
.
	$wa™FÜLšks
()

25 
loÿl
 
txQueue0
 = 
¬gs
.
dev
[1]:
	$g‘TxQueue
(0)

26 
loÿl
 
txQueue1
 = 
¬gs
.
dev
[1]:
	$g‘TxQueue
(1)

27 
loÿl
 
rxQueue0
 = 
¬gs
.
dev
[2]:
	$g‘RxQueue
(0)

28 
loÿl
 
rxQueue1
 = 
¬gs
.
dev
[2]:
	$g‘RxQueue
(1)

29 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue0
):
	$wa™
()

30 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue1
):
	$wa™
()

31 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue0
, 
n
,‚, 
Œue
):
	$wa™
()

32 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue0
, 319):
	$wa™
()

33 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue0
, 1234):
	$wa™
()

34 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue0
, 319, 
n
, 
Œue
):
	$wa™
()

35 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue1
, 319):
	$wa™
()

36 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue1
, 319, 
Œue
):
	$wa™
()

37 
loÿl
 
time¡am³r
 = 
lm
.
	`¡¬tTask
("time¡am³r", 
txQueue0
, 
rxQueue1
, 319)

38 
loÿl
 
æood”
 = 
lm
.
	`¡¬tTask
("æood”", 
txQueue1
, 319)

39 
time¡am³r
:
	$wa™
()

40 
æood”
:
	$wa™
()

41 
¡©s
.
¡¬tStsTask
{
txDeviûs
 = {
¬gs
.
dev
[1]}, 
rxDeviûs
 = {¬gs.dev[2]}, 
fe
 =‡rgs.
ouut
}

42 
loÿl
 
	g»ûiv”
 = 
lm
.
¡¬tTask
("time¡ampAÎPack‘sReûiv”", 
rxQueue0
)

43 
loÿl
 
	g£nd”
 = 
lm
.
¡¬tTask
("time¡ampAÎPack‘sS’d”", 
txQueue0
)

44 
	g»ûiv”
:
	$wa™
()

45 
£nd”
:
	$wa™
()

46 
’d


49 
funùiÚ
 
	$time¡am³r
(
txQueue
, 
rxQueue
, 
udp
, 
¿ndomSrc
, 
vÏn
)

50 
loÿl
 
f‹r
 = 
rxQueue
.
qid
 ~= 0

51 
log
:
	`šfo
("Testingimestamping %s %s„x filtering for %d seconds.",

52 
udp
 
ªd
 "UDP…ack‘ tØpÜˆ" .. ud°
Ü
 "L2 PTP…ackets",

53 
f‹r
 
ªd
 "w™h" 
Ü
 "without",

54 
RUN_TIME


56 
¿ndomSrc
 
th’


57 
log
:
	`šfo
("Using multiple flows,his can be slower on some NICs.")

58 
’d


59 
vÏn
 
th’


60 
log
:
	`šfo
("Adding VLANag,his is‚ot supported on some NICs.")

61 
’d


62 
loÿl
 
ruÁime
 = 
tim”
:
	$Ãw
(
RUN_TIME
)

63 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

64 
loÿl
 
time¡am³r


65 
udp
 
th’


66 
time¡am³r
 = 
ts
:
	$ÃwUdpTime¡am³r
(
txQueue
, 
rxQueue
)

68 
time¡am³r
 = 
ts
:
	$ÃwTime¡am³r
(
txQueue
, 
rxQueue
)

69 
’d


70 
lm
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

71 
loÿl
 
Ït
 = 
time¡am³r
:
	`m—su»L©’cy
(
	$funùiÚ
(
buf
)

72 
udp
 
th’


73 
¿ndomSrc
 
th’


74 
buf
:
	`g‘UdpPack‘
().
udp
:
	`£tSrcPÜt
(
m©h
.
	$¿ndom
(1, 1000))

75 
’d


76 
buf
:
	`g‘UdpPack‘
().
udp
:
	$£tD¡PÜt
(
udp
)

77 
’d


78 
vÏn
 
th’


79 
buf
:
	$£tVÏn
(1234)

80 
’d


81 
’d
)

82 
hi¡
:
	$upd©e
(
Ït
)

83 
’d


84 
hi¡
:
	$´št
()

85 
hi¡
.
numSam¶es
 =ğ0 
th’


86 
log
:
	`”rÜ
("Received‚o…ackets.")

87 
’d


88 
	$´št
()

89 
’d


91 
funùiÚ
 
	$time¡ampAÎPack‘sS’d”
(
queue
)

92 
log
:
	`šfo
("Tryingoƒnable„ximestamping of‡ll…ackets,his isn't supported by most‚ics")

93 
loÿl
 
ruÁime
 = 
tim”
:
	$Ãw
(
RUN_TIME
)

94 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

95 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

96 
buf
:
	$g‘UdpPack‘
():
fl
{
	}
}

97 
’d
)

98 
loÿl
 
bufs
 = 
mempoŞ
:
	$bufA¼ay
()

99 
lm
.
	$ruÂšg
(è
th’


100 
lm
.
	$¦“pMlis
(500)

101 
’d


102 
log
:
	`šfo
("Tryingo generate ~1000 mbit/s")

103 
queue
:
	$£tR©e
(1000)

104 
loÿl
 
ruÁime
 = 
tim”
:
	$Ãw
(
RUN_TIME
)

105 
lm
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

106 
bufs
:
	$®loc
(60)

107 
queue
:
	$£nd
(
bufs
)

108 
’d


109 
’d


111 
funùiÚ
 
	$time¡ampAÎPack‘sReûiv”
(
queue
)

112 
queue
.
dev
:
	$’abËRxTime¡ampsAÎPack‘s
(
queue
)

113 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

114 
loÿl
 
d¿šQueue
 = 
tim”
:
	$Ãw
(0.5)

115 
lm
.
ruÂšg
 
ªd
 
d¿šQueue
:
	$ruÂšg
() do

116 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 1000)

117 
bufs
:
	$ä“
(
rx
)

118 
’d


119 
loÿl
 
ruÁime
 = 
tim”
:
	`Ãw
(
RUN_TIME
 + 0.5)

120 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

121 
loÿl
 
Ï¡Time¡amp


122 
loÿl
 
couÁ
 = 0

123 
lm
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

124 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 1000)

125 
i
 = 1, 
rx
 do

126 
couÁ
 = count + 1

127 
loÿl
 
time¡amp
 = 
bufs
[
i
]:
	$g‘Time¡amp
(
queue
.
dev
)

128 
time¡amp
 
th’


129 -- 
time¡amp
 
som‘imes
 
jumps
 
by
 ~3 
£cÚds
 
Ú
 
	`ixgbe
 (
š
 
Ëss
 
thª
 
a
 
ãw
 
mli£cÚds
 
w®l
-
şock
 
time
)

130 
Ï¡Time¡amp
 
ªd
 
time¡amp
 -†a¡Time¡am°< 10^9 
th’


131 
hi¡
:
	`upd©e
(
time¡amp
 - 
Ï¡Time¡amp
)

132 
’d


133 
Ï¡Time¡amp
 = 
time¡amp


134 
’d


135 
’d


136 
bufs
:
	$ä“
(
rx
)

137 
’d


138 
log
:
	`šfo
("Inter-arrivalime distribution,his will„eport 0 on unsupported NICs")

139 
hi¡
:
	$´št
()

140 
hi¡
.
numSam¶es
 =ğ0 
th’


141 
log
:
	`”rÜ
("Received‚oimestamped…ackets.")

142 
’d


143 
	$´št
()

144 
’d


146 
funùiÚ
 
	$æood”
(
queue
, 
pÜt
)

147 
log
:
	`šfo
("Flooding†ink with UDP…ackets withhe same flow 5-tuple.")

148 
log
:
	`šfo
("Thisests whetherhe filter matches on…ayload.")

149 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

150 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPPack‘
()

151 
pkt
:
fl
{

152 
‘hSrc
 = 
queue
,

153 
	}
}

154 -- 
the
 
f‹r
 
should
 
nÙ
 
m©ch
 
this


155 
	gpkt
.
	g±p
:
	$£tV”siÚ
(0xFF)

156 
pkt
.
udp
:
	$£tD¡PÜt
(
pÜt
)

157 
’d
)

158 
loÿl
 
bufs
 = 
mempoŞ
:
	$bufA¼ay
()

159 
loÿl
 
ruÁime
 = 
tim”
:
	`Ãw
(
RUN_TIME
 + 0.1)

160 
lm
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

161 
bufs
:
	$®loc
(60)

162 
queue
:
	$£nd
(
bufs
)

163 
’d


164 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hello-world.lua

1 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

3 
funùiÚ
 
	$ma¡”
(...)

4 
	`´št
("Hello, world!")

5 
	`´št
("Command†ine‡rguments: ", ...)

6 
lm
.
	`¡¬tTask
("slave", "Hello, world from first slave!")

7 
lm
.
	`¡¬tTask
("slave", "Hello, world from second slave!")

8 
lm
.
	$wa™FÜTasks
()

9 
	`´št
("All slaves finished,ƒxiting...")

10 
’d


12 
funùiÚ
 
	$¦ave
(
¬g
)

13 
	`´štf
("SÏvsk,„eûived‡rgum’t: \"%s\"", 
¬g
)

14 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hyperscan/filter_hyperscan.lua

1 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

2 
loÿl
 
hs
 = 
»quœe
 "hs"

3 
loÿl
 
ffi
 = 
»quœe
 "ffi"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
¡©s
 = 
»quœe
 "stats"

7 
loÿl
 
pÿp
 = 
»quœe
 "pcap"

8 
loÿl
 
log
 = 
»quœe
 "log"

10 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

11 
·r£r
:
	`desütiÚ
("Demonstrates…acket filtering using Hyperscan.")

12 
·r£r
:
	`¬gum’t
("ruËs", "FcÚššg…©‹º fÜ f‹ršg"):
	$¬gs
(1)

13 
·r£r
:
	`¬gum’t
("devIn", "Deviû which„eûive th·ck‘s"):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

14 
·r£r
:
	`¬gum’t
("devOut", "Deviû which fÜw¬d th·ck‘ nÙ m©chšg f‹rs"):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
)

15 
·r£r
:
	`İtiÚ
("-°--pÿpDev", "Deviû which„•Ïy ¨pÿ°fÜe¡šg, cÚÃùØdevIn"):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(-1)

16 
·r£r
:
	`İtiÚ
("-à--pÿpFe", "pÿ°ffÜ --pÿpDev"):
	$¬gs
(1):("dump.pcap")

17 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

18  
·r£r
:
	$·r£
()

19 
’d


21 
funùiÚ
 
	$ma¡”
(
¬gs
)

22 
loÿl
 
f‹r
 = 
hs
:
	$Ãw
(
¬gs
.
ruËs
, 
hs
.
HS_MODE_BLOCK
)

23 
loÿl
 
devRecv
 = 
deviû
.
cÚfig
{
pÜt
=
¬gs
.
devIn
}:g‘RxQueue(0)

24 
loÿl
 
devFÜw¬d
 = 
deviû
.
cÚfig
{
pÜt
=
¬gs
.
devOut
}:g‘TxQueue(0)

25 
¬gs
.
pÿpDev
 ~ğ-1 
th’


26 
¬gs
.
pÿpDev
 = 
deviû
.
cÚfig
{
pÜt
÷rgs.
	}
pÿpDev}:
	$g‘TxQueue
(0)

27 
’d


28 
deviû
.
	$wa™FÜLšks
()

30 
¬gs
.
pÿpDev
 ~ğ-1 
th’


31 
lm
.
	`¡¬tTask
("¶ayPÿp", 
¬gs
.
pÿpFe
,‡rgs.
pÿpDev
)

32 
’d


33 
lm
.
	`¡¬tTask
("f‹r", 
devRecv
, 
devFÜw¬d
, 
f‹r
)

34 
¡©s
.
¡¬tStsTask
{
rxDeviûs
 = {
devRecv
.
dev
}, 
txDeviûs
 = {
devFÜw¬d
.dev}, 
fe
 = 
¬gs
.
ouut
}

35 
	glm
.
	$wa™FÜTasks
()

36 
’d


38 -- 
¶ays
 
a
 
pÿp
 
fe


39 
funùiÚ
 
	$¶ayPÿp
(
f’ame
, 
queue
)

40 
log
:
	`šfo
("R•Ïyšg % äom %s.", 
f’ame
, 
queue
)

41 
loÿl
 
mempoŞ
 = 
memÜy
:
	$ü—‹MemPoŞ
()

42 
loÿl
 
bufs
 = 
mempoŞ
:
	$bufA¼ay
()

43 
loÿl
 
pÿpFe
 = 
pÿp
:
	$ÃwR—d”
(
f’ame
)

44 
lm
.
	$ruÂšg
() do

45 
loÿl
 
n
 = 
pÿpFe
:
	$»ad
(
bufs
)

46 
n
 =ğ0 
th’


47 
pÿpFe
:
	$»£t
()

48 
’d


49 
queue
:
	$£ndN
(
bufs
, 
n
)

50 
’d


51 
’d


53 -- 
f‹rs
 
šcomšg
 
·ck‘s
 
Ú
 
queueIn
. 
If
 
f‹r
 
»tuºs
 
Œue
, 
the
 
·ck‘
 
wl
 
be
 
drİ³d
, 
Ùh”wi£
 
fÜw¬ded
 oÀ
queueOut
.

54 
funùiÚ
 
	$f‹r
(
queueIn
, 
queueOut
, 
f‹r
)

55 
log
:
	`šfo
("F‹ršg…ack‘ comšg from % ªd s’dšgØ%s.", 
queueIn
, 
queueOut
)

56 
loÿl
 
rxBufs
 = 
memÜy
.
	$bufA¼ay
()

57 
loÿl
 
txBufs
 = 
memÜy
.
	$bufA¼ay
()

58 
loÿl
 
pos
 = 0 -- 
couÁs
 
drİ³d
 
·ck‘s


59 
loÿl
 
Ãg
 = 0 -- 
couÁs
 
fÜw¬ded
 
·ck‘s


60 
loÿl
 
ÿ±u»CŒ
 = 
¡©s
:
	`ÃwPktRxCouÁ”
("Capture„ate")

61 
lm
.
	$ruÂšg
() do

62 
loÿl
 
rx
 = 
queueIn
:
	$»cv
(
rxBufs
)

63 
loÿl
 
j
 = 0

64 
i
 = 1, 
rx
 do

65 
loÿl
 
buf
 = 
rxBufs
[
i
]

66 
ÿ±u»CŒ
:
	$couÁPack‘
(
rxBufs
[
i
])

67 
f‹r
:
	$f‹r
(
rxBufs
[
i
]è
th’


68 --
drİ


69 
pos
 =…os + 1

70 
rxBufs
[
i
]:
	$ä“
()

72 --
wr™e
 
to
 
buf
 
fÜw¬dšg


73 
Ãg
 =‚eg + 1

74 
j
 = j + 1

75 
txBufs
[
j
] = 
rxBufs
[
i
]

76 
’d


77 
’d


78 --
fÜw¬d


79 
queueOut
:
	$£ndN
(
txBufs
, 
j
)

80 
ÿ±u»CŒ
:
	$upd©e
()

81 
’d


82 
	`´št
("Pack‘ drİ³d: ", 
pos
)

83 
	`´št
("Pack‘ fÜw¬ded: ", 
Ãg
)

84 
	`´št
("Drİ„©e: ", 
pos
/Õos+
Ãg
))

85 
ÿ±u»CŒ
:
	$fš®ize
()

86 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hyperscan/test.lua

1 
	ghs
 = 
»quœe
 "hs"

3 --
U§ge
 
of
 
w¿µed
 
Hy³rsÿn
 
API


6 
loÿl
 
funùiÚ
 
	$ab¡¿ù
()

7 
	`´št
("Test‡bstract methods")

8 
db
, 
sü
 = 
hs
.
	`š™
(hs.
HS_MODE_BLOCK
, {"Te¡1", "Te¡2", "Te¡3", "Te¡4"
	}
}, {0,0, 
	gHS_FLAG_DOTALL
,0}, {2,3,4, 100})

9 
	ghs
.
dosÿn_block
("Te¡1Te¡2Te¡3Te¡1Te¡4",26, 
db
, 
sü
, 
hs
.
m©chHªdËrDummy_±r
)

11 
	ghs
.
	$ä“_d©aba£
(
db
)

12 
hs
.
	$ä“_sü©ch
(
sü
)

13 
’d


15 
loÿl
 
funùiÚ
 
	$w¿µ”s
()

16 
	`´št
("Test wrappers")

17 
loÿl
 
db
 = 
hs
.
	$d©aba£_±r_±r
()

18 
loÿl
 
sü©ch
 = 
hs
.
	$sü©ch_±r_±r
()

19 
loÿl
 
”r
 = 
hs
.
	$”r_±r_±r
()

20 
loÿl
 
¡»am
 = 
hs
.
	$¡»am_±r_±r
()

23 
hs
.
	`compe
("Te¡",0, hs.
HS_MODE_BLOCK
, 
db
, 
”r
)

24 
hs
.
	$®loc_sü©ch
(
db
[0], 
sü©ch
)

26 
hs
.
	`sÿn
(
db
[0], "Te¡T—¡Te¡Te¡Te¡", 21, 0, 
sü©ch
[0], hs.
m©chHªdËrDummy_±r
)

28 
hs
.
	$ä“_d©aba£
(
db
[0])

29 
hs
.
	$ä“_sü©ch
(
sü©ch
[0])

30 
’d


32 
loÿl
 
funùiÚ
 
	$exam¶e_block
()

33 
	`´št
 ("Test block")

34 
loÿl
 
db
, 
sü
 = 
hs
.
	`š™
(hs.
HS_MODE_BLOCK
, hs.
	`·r£_äom_fe
("patterns.txt"))

35 
hs
.
	`dosÿn_block
("Te¡1Te¡2Te¡3Te¡1Te¡4", 26, 
db
, 
sü
)

36 
hs
.
	$ä“_d©aba£
(
db
)

37 
hs
.
	$ä“_sü©ch
(
sü
)

38 
’d


40 
loÿl
 
funùiÚ
 
	$exam¶e_¡»am
()

41 
	`´št
 ("Test stream")

42 
loÿl
 
db
, 
sü
 = 
hs
.
	`š™
(hs.
HS_MODE_STREAM
, hs.
	`·r£_äom_fe
("patterns.txt"))

43 
loÿl
 
¡»am
 = 
hs
.
	$Ãw_¡»am
(
db
)

44 
hs
.
	`dosÿn_¡»am
("Te¡1Te¡", 9, 
¡»am
, 
sü
)

45 
hs
.
	`dosÿn_¡»am
("2Te¡3",5, 
¡»am
, 
sü
)

47 
hs
.
	$ä“_d©aba£
(
db
)

48 
hs
.
	$ä“_sü©ch
(
sü
)

49 
hs
.
	$şo£_¡»am
(
¡»am
)

50 
’d


52 
	$w¿µ”s
()

53 
	$ab¡¿ù
()

54 
	$exam¶e_block
()

55 
	`exam¶e_¡»am
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/inter-task-communication.lua

1 --- 
Difã»Á
 
m‘hods
 
to
 
communiÿ‹
 
b‘w“n
 
	gsks
.

2 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

3 
loÿl
 
ffi
 = 
»quœe
 "ffi"

4 
loÿl
 
memÜy
 = 
»quœe
 "memory"

5 
loÿl
 
Çme¥aûs
 = 
»quœe
 "namespaces"

6 
loÿl
 
pe
 = 
»quœe
 "pipe"

7 
loÿl
 
lock
 = 
»quœe
 "lock"

8 
loÿl
 
b¬r›r
 = 
»quœe
 "barrier"

9 
loÿl
 
log
 = 
»quœe
 "log"

11 
SOME_GLOBAL_VARIABLE
 = "foo"

13 -- 
hook
 
´št
 
to
 
show
 
the
 
cu¼’t
 
sk
's‚ame

14 
loÿl
 
´št
 = 
	$funùiÚ
(
¡r
, ...)

15 
nÙ
 
¡r
 
th’
  
	$´št
(è
’d


16 
	`´št
(("[Task: %s] " .. 
¡r
):
	$fÜm©
(
LIBMOON_TASK_NAME
, ...))

17 
’d


19 
loÿl
 
funùiÚ
 
	$glob®V¬Demo
()

20 
	`´št
("Glob® v¬ŸbË SOME_GLOBAL_VARIABLE = %s", 
SOME_GLOBAL_VARIABLE
)

21 
	`´št
("Changing valueo \"bar\"")

22 
SOME_GLOBAL_VARIABLE
 = "bar"

23 
lm
.
	`¡¬tTask
("globalVarSlave")

24 
lm
.
	$wa™FÜTasks
()

25 
	`´št
("Back in masterask")

26 
	`´št
("Glob® v¬ŸbË SOME_GLOBAL_VARIABLE = %s", 
SOME_GLOBAL_VARIABLE
)

27 
’d


29 
funùiÚ
 
	$glob®V¬SÏve
()

30 
	`´št
("This is‡ slaveask")

31 
	`´št
("Glob® v¬ŸbË SOME_GLOBAL_VARIABLE = %s", 
SOME_GLOBAL_VARIABLE
)

32 
’d


35 
loÿl
 
funùiÚ
 
	$¬gum’tsDemo
()

36 
	`´št
("Passing‡rgumentso slaveasks ishe simplest wayo communicate withhem")

37 
	`´št
("All‡rguments‡re serializedo be…assedohe other LuaJIT VM")

38 
	`´št
("This means‡ll‡rguments‡re copied‡nd modifications don't…ropagate")

39 
	`´št
("Calling‡rgumentSlave with‡ fewƒxamples values")

40 
loÿl
 
sk
 = 
lm
.
	`¡¬tTask
("¬gum’tSÏve", "¡ršg", 3.14, {
key
 = { key = "v®ue"}
	}
})

41 
loÿl
 
	gtbl
, 
	g¡r
 = 
sk
:
	$wa™
()

42 
	`´št
("Reûived‡ % »tuº v®ue:bl.foØğ\"%s\"", 
	`ty³
(
tbl
),bl.
foo
)

43 
	`´št
("Reûived‡ % »tuº v®ue: \"%s\"", 
	`ty³
(
¡r
), str)

44 
	`´št
("You can‡lso…ass objects such‡s devices or queues betweenasks inhis way")

45 -- 
™
's‡ctually…ossibleo…ass bytecode

46 -- 
howev”
, 
this
 
is
 
di§bËd
 
by
  
beÿu£
 
™
 
ÿu£s
 
mÜe
 
´obËms
 
thª
 iˆ
sŞves


47 -- 
you
 
ÿn
 
u£
 
the
 
S”³Á
 
lib¿ry
 
w™h
 
nocode
 = 
çl£
 
to
 
£rŸlize
 
funùiÚs
 
as
 
by‹code


48 
	`´št
("However, you cannot…ass function values")

49 
’d


51 
funùiÚ
 
	$¬gum’tSÏve
(
¡r
, 
num
, 
tbl
)

52 
	`´št
("Reûived‡ %s: % ", 
	`ty³
(
¡r
), str)

53 
	`´št
("Reûived‡ %s: % ", 
	`ty³
(
num
), 
	$to¡ršg
(
num
))

54 
	`´št
("Reûived‡abË: %s", 
	`ty³
(
tbl
),bl)

55 
	`´št
("tbl.key.key = %s", 
tbl
.
key
.key)

56 
	`´št
("You can„eturn values fromasks‡s well")

57  { 
foo
 = "b¬" 
	}
}, "second„eturn value"

58 
’d


61 
loÿl
 
	gns
 = 
Çme¥aûs
:
	$g‘
()

62 
loÿl
 
funùiÚ
 
	$Çme¥aûDemo
()

63 
	`´št
("Namespaces‡reables with shared values between differentasks.")

64 
	`´št
("Saving same valuesohe‚amespace...")

65 
ns
.
foo
 = 5

66 
ns
.
key
 = "value"

67 
lm
.
	`¡¬tTask
("namespaceSlave")

68 
lm
.
	$wa™FÜTasks
()

69 
	`´št
("Namespaces usehe same serialization mechanism‡s‡rgument…assing")

70 
	`´št
("That means„etrieving‡ value„esults in‡ copy")

71 
	`´št
("A more completeƒxample for‚amespaces ishe ARP implementation in†ua/proto/arp.lua")

72 
’d


74 
funùiÚ
 
	$Çme¥aûSÏve
()

75 
	`´št
("ns.foØğ" .. 
ns
.
foo
)

76 
	`´št
("ns.key = " .. 
ns
.
key
)

77 
’d


80 
loÿl
 
funùiÚ
 
	$peDemo
()

81 
	`´št
("There‡rewoypes of…ipes in†m: slowPipes‡nd fastPipes")

82 
	`´št
("The former„ely on serialization,he†atter can only handle LuaJIT FFI cdata…ointers")

83 
	`´št
("Aypical usecase for slow…ipes would beransferring statistics betweenasks")

84 
	`´št
("Fast…ipes‡re suitableo…ass…ackets betweenasks")

85 
loÿl
 
¦owPe
 = 
pe
:
	$ÃwSlowPe
()

86 
loÿl
 
ç¡Pe
 = 
pe
:
	$ÃwFa¡Pe
()

87 
lm
.
	`¡¬tTask
("¦owPeSÏve", 
¦owPe
)

88 
	`´št
("Sending datao slow…ipe")

89 
¦owPe
:
	`£nd
({
key
 = "v®ue"
	}
})

90 
lm
.
	$wa™FÜTasks
()

91 
	`´št
("Starting multiple fastPipeasks")

92 
lm
.
	`¡¬tTask
("ç¡PeS’dSÏve", 
ç¡Pe
)

93 
lm
.
	`¡¬tTask
("ç¡PeRecvSÏve", 
ç¡Pe
)

94 
lm
.
	$wa™FÜTasks
()

95 
	`´št
("Note: Slow…ipes‡re multi-producer multi-consumer. Fast…ipes defaulto single-producer single-consumer.")

96 
’d


98 
funùiÚ
 
	$¦owPeSÏve
(
pe
)

99 
	`´št
("Retrieving data using blocking„ecv(), useryRecv() for‚on-blocking")

100 
	`´št
("D©a: key = " .. 
pe
:
	`»cv
().
key
)

101 
’d


103 
ffi
.
cdef
[[

104 
	ssome_¡ruù
 { 
ušt32_t
 
v®
; }

106 
funùiÚ
 
	$ç¡PeS’dSÏve
(
pe
)

107 
	`´št
("Allocating cdata object")

108 
	`´št
("The…ipe sends‡…ointero‡nother LuaJIT VM, so we cannot usehe GC here")

109 
loÿl
 
d©a
 = 
memÜy
.
	`®loc
("¡ruù some_¡ruù*", 
ffi
.("struct some_struct"))

110 
d©a
.
v®
 = 5

111 
	`´št
("S’dšg sŒuù %s, v® = %d", 
d©a
, d©a.
v®
)

112 
pe
:
	$£nd
(
d©a
)

113 
’d


115 
funùiÚ
 
	$ç¡PeRecvSÏve
(
pe
)

116 
	`´št
("Receivinghe object‡s void*, you should only…ass data of one ctypehrough‡ given fast…ipe")

117 
	`´št
("However,…ipes‡re cheap‡nd you can‡llocate‡†ot ofhem")

118 
loÿl
 
d©a
 = 
ffi
.
	`ÿ¡
("¡ruù some_¡ruù*", 
pe
:
	$»cv
())

119 
	`´št
("Reûived sŒuù %s, v® = %d", 
d©a
, d©a.
v®
)

120 
	`´št
("Note:his isheƒxact same memory‡ddress,ake care when‡ccessing it concurrently")

121 
memÜy
.
	$ä“
(
d©a
)

122 
’d


125 
loÿl
 
funùiÚ
 
	$syncDemo
()

126 
	`´št
("lm…rovides†ocks‡nd barriers")

127 
	`´št
("Locks workƒxactly‡s youƒxpecthemo work")

128 
loÿl
 
l
 = 
lock
:
	$Ãw
()

129 
	`´št
("Acquiring†ock")

130 
l
:
	$lock
()

131 
lm
.
	`¡¬tTask
("lockSÏve", 
l
)

132 
	`´št
("Waiting 500ms before„eleasing†ock")

133 
lm
.
	$¦“pMlisIdË
(500)

134 
l
:
	$uÆock
()

135 
lm
.
	$wa™FÜTasks
()

136 
	`´št
("Barriers‡re usedoƒnsure‡ set ofasks„eachedhe same…oint before continuing")

137 
loÿl
 
b
 = 
b¬r›r
:
	$Ãw
(3)

138 
lm
.
	`¡¬tTask
("b¬r›rSÏve", 
b
, 1, 0)

139 
lm
.
	`¡¬tTask
("b¬r›rSÏve", 
b
, 2, 100)

140 
lm
.
	`¡¬tTask
("b¬r›rSÏve", 
b
, 3, 1000)

141 
lm
.
	$wa™FÜTasks
()

142 
’d


144 
funùiÚ
 
	$lockSÏve
(
l
)

145 
	`´št
("Tryingo‡cquire†ock")

146 
l
:
	$lock
()

147 
	`´št
("Got†ock!")

148 
l
:
	$uÆock
()

149 
’d


151 
funùiÚ
 
	$b¬r›rSÏve
(
b
, 
skId
, 
¦“p
)

152 
	`´št
("SÏvsk %d, sË•šg fÜ %d mli£cÚds", 
skId
, 
¦“p
)

153 
lm
.
	$¦“pMlisIdË
(
¦“p
)

154 
	`´št
("Wa™šg oÀb¬r›¸©ime¡am°%f", 
	$time
())

155 
b
:
	$wa™
()

156 
	`´št
("GÙhrough b¬r›¸©ime¡am°%f", 
	$time
())

157 
’d


159 
funùiÚ
 
	$ma¡”
(...)

160 
log
:
	`šfo
("Demonstrating global variables:hey‡re‚ot shared betweenasks.")

161 
	$glob®V¬Demo
()

162 
	$´št
()

164 
log
:
	`šfo
("Demonstrating serialization for‡rgument‡nd„eturn value…assing.")

165 
	$¬gum’tsDemo
()

166 
	$´št
()

168 
log
:
	`šfo
("Demonstrating‚amespaceso share state.")

169 
	$Çme¥aûDemo
()

170 
	$´št
()

172 
log
:
	`šfo
("Demonstrating…ipes.")

173 
	$peDemo
()

174 
	$´št
()

176 
log
:
	`šfo
("Demonstrating synchronization…rimitives.")

177 
	$syncDemo
()

178 
	$´št
()

180 
log
:
	`šfo
("You can‡lso implement‡nd call‚ormal C functions (see c-integrationƒxample) ifhese methods‡re‚ot sufficient.")

181 
log
:
	`šfo
("Allasks„un withinhe same…rocess, sohe usual concurrency features‡re‡vailablehere.")

182 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/l2-forward.lua

1 --- 
FÜw¬d
 
·ck‘s
 
b‘w“n
 
two
 
pÜts


2 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
¡©s
 = 
»quœe
 "stats"

5 
loÿl
 
log
 = 
»quœe
 "log"

6 
loÿl
 
memÜy
 = 
»quœe
 "memory"

8 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

9 
·r£r
:
	`¬gum’t
("dev", "Deviû tØu£, s³cifyh§mdeviûwiûØechØ·ck‘s."):
	$¬gs
(2):
	$cÚv”t
(
tÚumb”
)

10 
·r£r
:
	`İtiÚ
("-ˆ--th»ads", "Numb” oàth»ad ³¸fÜw¬dšg dœeùiÚ usšg RSS."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1)

11 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

12  
·r£r
:
	$·r£
()

13 
’d


15 
funùiÚ
 
	`ma¡”
(
¬gs
)

16 -- 
cÚfigu»
 
deviûs


17 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

18 
¬gs
.
dev
[
i
] = 
deviû
.
cÚfig
{

19 
pÜt
 = 
dev
,

20 
txQueues
 = 
¬gs
.
th»ads
,

21 
rxQueues
 = 
¬gs
.
th»ads
,

22 
rssQueues
 = 
¬gs
.
th»ads


23 
	}
}

24 
’d


25 
	gdeviû
.
wa™FÜLšks
()

27 -- 
´št
 
¡©s


28 
	g¡©s
.
	g¡¬tStsTask
{
	gdeviûs
 = 
¬gs
.
dev
, 
	gfe
 =‡rgs.
ouut
}

30 -- 
¡¬t
 
fÜw¬dšg
 
sks


31 
	gi
 = 1, 
	g¬gs
.
th»ads
 do

32 
	glm
.
¡¬tTask
("fÜw¬d", 
¬gs
.
dev
[1]:
g‘RxQueue
(
i
 - 1),‡rgs.dev[2]:
g‘TxQueue
(i - 1))

33 -- 
bidœeùiÚ®
 
fow¬dšg
 
Úly
 
two
 
difã»Á
 
deviûs
 
wh”e
 
·s£d


34 
¬gs
.
dev
[1] ~ğ¬gs.dev[2] 
th’


35 
lm
.
¡¬tTask
("fÜw¬d", 
¬gs
.
dev
[2]:
g‘RxQueue
(
i
 - 1),‡rgs.dev[1]:
g‘TxQueue
(i - 1))

36 
’d


37 
’d


38 
lm
.
	$wa™FÜTasks
()

39 
’d


41 
funùiÚ
 
	`fÜw¬d
(
rxQueue
, 
txQueue
)

42 -- 
a
 
bufA¼ay
 
is
 
ju¡
‡ 
li¡
 
of
 
bufãrs
 
th©
 
we
 
wl
 
u£
 
b©ched
 
fÜw¬dšg


43 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

44 
lm
.
	$ruÂšg
(èdØ-- 
check
 
CŒl
+
c
 
was
 
´es£d


45 -- 
»ûive
 
Úe
 
Ü
 
mÜe
 
·ck‘s
 
äom
 
the
 
queue


46 
loÿl
 
couÁ
 = 
rxQueue
:
	`»cv
(
bufs
)

47 -- 
£nd
 
out
 
®l
 
»ûived
 
bufs
 
Ú
 
the
 
Ùh”
 
queue


48 -- 
the
 
bufs
 
¬e
 
ä“
'd implicitly byhis function

49 
txQueue
:
	$£ndN
(
bufs
, 
couÁ
)

50 
’d


51 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/pktgen.lua

1 --- 
A
 
sim¶e
 
UDP
 
·ck‘
 
g’”©Ü


2 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
¡©s
 = 
»quœe
 "stats"

5 
loÿl
 
log
 = 
»quœe
 "log"

6 
loÿl
 
memÜy
 = 
»quœe
 "memory"

7 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

8 
loÿl
 
£rv”
 = 
»quœe
 "webserver"

10 -- 
£t
 
add»s£s
 
h”e


11 
loÿl
 
DST_MAC
 = 
n
 -- 
»sŞved
 
vŸ
 
ARP
 
Ú
 
GW_IP
 
Ü
 
DST_IP
, 
ÿn
 
be
 
ov”rid’
 
w™h
 
a
 
¡ršg
 
h”e


12 
loÿl
 
	gPKT_LEN
 = 60

13 
loÿl
 
SRC_IP
 = "10.0.0.10"

14 
loÿl
 
DST_IP
 = "10.1.0.10"

15 
loÿl
 
SRC_PORT_BASE
 = 1234 -- 
aùu®
 
pÜt
 
wl
 
be
 SRC_PORT_BASE * 
	$¿ndom
(
NUM_FLOWS
)

16 
loÿl
 
DST_PORT
 = 1234

17 
loÿl
 
NUM_FLOWS
 = 1000

18 -- 
u£d
 
as
 
sourû
 
IP
 
to
 
»sŞve
 
GW_IP
Ø
DST_MAC


19 -- 
®so
 
»¥Úd
 
to
 
ARP
 
qu”›s
 
Ú
 
this
 
IP


20 
loÿl
 
ARP_IP
 = 
SRC_IP


21 -- 
u£d
 
to
 
»sŞve
 
DST_MAC


22 
loÿl
 
GW_IP
 = 
DST_IP


25 -- 
the
 
cÚfigu»
 
funùiÚ
 
is
 
ÿÎed
 
Ú
 
¡¬tup
 
w™h
 
a
 
´e
-
š™Ÿlized
 
commªd
 
lše
 
·r£r


26 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

27 
·r£r
:
	`desütiÚ
("Edithe sourceo modify constants†ike IPs‡nd…orts.")

28 
·r£r
:
	`¬gum’t
("dev", "Deviû tØu£."):
	`¬gs
("+"):
	$cÚv”t
(
tÚumb”
)

29 
·r£r
:
	`İtiÚ
("-ˆ--th»ads", "Numb” oàth»ad ³¸deviû."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1)

30 
·r£r
:
	`İtiÚ
("-¸--¿‹", "T¿nsm™„©š Mb™/ ³¸deviû."):
	$¬gs
(1)

31 
·r£r
:
	`İtiÚ
("-w --web£rv”", "S¹‡ REST API oÀthgiv’…Üt."):
	$cÚv”t
(
tÚumb”
)

32 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

33 
·r£r
:
	`İtiÚ
("-s --seconds", "Stop‡fter‚ seconds")

34 
·r£r
:
	`æag
("-a --arp", "Use ARP.")

35 
·r£r
:
	`æag
("--csv", "Output in CSV format")

36  
·r£r
:
	$·r£
()

37 
’d


39 
funùiÚ
 
	$ma¡”
(
¬gs
,...)

40 
log
:
	`šfo
("Check out MoonGen (built on†m) if you‡re†ooking for‡ fully featured…acket generator")

41 
log
:
	`šfo
("https://github.com/emmericp/MoonGen")

43 -- 
cÚfigu»
 
deviûs
 
ªd
 
queues


44 
loÿl
 
¬pQueues
 = {
	}
}

45 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

46 -- 
¬p
 
Ãeds
 
exŒa
 
queues


47 
loÿl
 
dev
 = 
deviû
.
cÚfig
{

48 
pÜt
 = 
dev
,

49 
txQueues
 = 
¬gs
.
th»ads
 + (¬gs.
¬p
 
ªd
 1 
Ü
 0),

50 
rxQueues
 = 
¬gs
.
¬p
 
ªd
 2 
Ü
 1

51 
	}
}

52 
	g¬gs
.
	gdev
[
i
] = 
dev


53 
¬gs
.
¬p
 
th’


54 
bË
.
š£¹
(
¬pQueues
, { 
rxQueue
 = 
dev
:
g‘RxQueue
(1), 
txQueue
 = dev:
g‘TxQueue
(
¬gs
.
th»ads
), 
s
 = 
ARP_IP
 })

55 
’d


56 
’d


57 
	gdeviû
.
wa™FÜLšks
()

59 -- 
¡¬t
 
ARP
 
sk
 
ªd
 dØARP 
	$lookup
 (
nÙ
 
h¬dcoded
 
above
)

60 
¬gs
.
¬p
 
th’


61 
¬p
.
	$¡¬tA½Task
(
¬pQueues
)

62 
nÙ
 
DST_MAC
 
th’


63 
log
:
	`šfo
("P”fÜmšg ARP†ooku°Ú %s,imeouˆ3 secÚds.", 
GW_IP
)

64 
DST_MAC
 = 
¬p
.
	$blockšgLookup
(
GW_IP
, 3)

65 
nÙ
 
DST_MAC
 
th’


66 
log
:
	`šfo
("ARP†ookup failed, using default destination mac‡ddress")

67 
DST_MAC
 = "01:23:45:67:89:ab"

68 
’d


69 
’d


70 
log
:
	`šfo
("De¡š©iÚ mac: %s", 
DST_MAC
)

71 
’d


73 
¬gs
.
web£rv”
 
th’


74 
£rv”
.
¡¬tWeb£rv”Task
{

75 
pÜt
 = 
¬gs
.
web£rv”


76 
	}
}

77 
	g’d


79 -- 
´št
 
¡©i¡ics


80 
	g¡©s
.
	g¡¬tStsTask
{
	gdeviûs
 = 
¬gs
.
dev
, 
	gfe
 =‡rgs.
ouut
, 
	gfÜm©
 =‡rgs.
csv
 
ªd
 "csv" 
Ü
 "plain"}

82 -- 
cÚfigu»
 
tx
 
¿‹s
 
ªd
 
¡¬t
 
Œªsm™
 
¦aves


83 
	gi
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

84 
i
 = 1, 
¬gs
.
th»ads
 do

85 
loÿl
 
queue
 = 
dev
:
	`g‘TxQueue
(
i
 - 1)

86 
¬gs
.
¿‹
 
th’


87 
queue
:
	`£tR©e
(
¬gs
.
¿‹
 /‡rgs.
th»ads
)

88 
’d


89 
lm
.
	`¡¬tTask
("txSÏve", 
queue
, 
DST_MAC
)

90 
’d


91 
’d


93 
¬gs
.
£cÚds
 
th’


94 
lm
.
	`£tRuÁime
(
	$tÚumb”
(
¬gs
.
£cÚds
))

95 
’d


97 
lm
.
	$wa™FÜTasks
()

98 
’d


100 
funùiÚ
 
	`txSÏve
(
queue
, 
d¡Mac
)

101 -- 
memÜy
 
poŞ
 
w™h
  
v®ues
 
®l
 
·ck‘s
, 
this
 
is
 
our
 
¬ch‘y³


102 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

103 
buf
:
	$g‘UdpPack‘
():
fl
{

104 -- 
f›lds
 
nÙ
 
ex¶ic™ly
 
£t
 
h”e
 
¬e
 
š™Ÿlized
 
to
 
»asÚabË
 
deçuÉs


105 
‘hSrc
 = 
queue
, -- 
MAC
 
of
 
the
 
tx
 
deviû


106 
‘hD¡
 = 
d¡Mac
,

107 
4Src
 = 
SRC_IP
,

108 
4D¡
 = 
DST_IP
,

109 
udpSrc
 = 
SRC_PORT
,

110 
udpD¡
 = 
DST_PORT
,

111 
pktL’gth
 = 
PKT_LEN


112 
	}
}

113 
	g’d
)

114 -- 
a
 
bufA¼ay
 
is
 
ju¡
‡ 
li¡
 
of
 
bufãrs
 
äom
‡ 
mempoŞ
 
th©
 i 
´oûs£d
 
as
‡ 
sšgË
 
b©ch


115 
loÿl
 
	gbufs
 = 
mempoŞ
:
	$bufA¼ay
()

116 
lm
.
	$ruÂšg
(èdØ-- 
check
 
CŒl
+
c
 
was
 
´es£d


117 -- 
this
 
aùu®ly
 
®loÿ‹s
 
some
 
bufãrs
 
äom
 
the
 
mempoŞ
h
¬¿y
 
is
 
assocŸ‹d
 
w™h


118 -- 
this
 
has
 
to
 
be
 
»³©ed
 
—ch
 
£nd
 
beÿu£
 
£ndšg
 
is
 
asynchrÚous
, 
we
 
ÿÂÙ
 
»u£
 
the
 
Şd
 
bufãrs
 
h”e


119 
bufs
:
	$®loc
(
PKT_LEN
)

120 
i
, 
buf
 
š
 
	$aœs
(
bufs
) do

121 -- 
·ck‘
 
äamewÜk
 
®lows
 
sim¶e
 
acûss
 
to
 
f›lds
 
š
 
com¶ex
 
´ÙocŞ
 
¡acks


122 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

123 
pkt
.
udp
:
	`£tSrcPÜt
(
SRC_PORT_BASE
 + 
m©h
.
	`¿ndom
(0, 
NUM_FLOWS
 - 1))

124 
’d


125 -- 
UDP
 
checksums
 
¬e
 
İtiÚ®
, 
so
 
usšg
 
ju¡
 
IPv4
 checksum 
would
 
be
 
suffic›Á
 
h”e


126 -- 
UDP
 
checksum
 
ofæßdšg
 
is
 
com·¿tiv–y
 
¦ow
: 
NICs
 
typiÿÎy
 dØ
nÙ
 
suµÜt
 
ÿlcuÏtšg
 
the
 
p£udo
-
h—d”
 checksum 
so
 
this
 i 
dÚe
 
š
 
SW


127 
bufs
:
	`ofæßdUdpChecksums
()

128 -- 
£nd
 
out
 
®l
 
·ck‘s
 
ªd
 
ä“s
 
Şd
 
bufs
 
th©
 
have
 
b“n
 
£Á


129 
queue
:
	$£nd
(
bufs
)

130 
’d


131 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/reflector.lua

1 --- 
	gLay”
 2 
	g»æeùÜ
, 
sw­s
 
¤c
 
ªd
 
d¡
 
MACs
‡nd 
echÛs
 
the
 
·ck‘


2 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

3 
loÿl
 
memÜy
 = 
»quœe
 "memory"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

5 
loÿl
 
¡©s
 = 
»quœe
 "stats"

6 
loÿl
 
Ïı
 = 
»quœe
 "proto.lacp"

8 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

9 
·r£r
:
	`¬gum’t
("dev", "Deviû tØu£."):
	`¬gs
("+"):
	$cÚv”t
(
tÚumb”
)

10 
·r£r
:
	`İtiÚ
("-ˆ--th»ads", "Numb” oàth»ad ³¸deviû."):
	$¬gs
(1):
	$cÚv”t
(
tÚumb”
):(1)

11 
·r£r
:
	`æag
("-l --lacp", "Tryo setup‡n LACP channel.")

12 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

13  
·r£r
:
	$·r£
()

14 
’d


16 
funùiÚ
 
	$ma¡”
(
¬gs
)

17 
loÿl
 
ÏıQueues
 = {
	}
}

18 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

19 
loÿl
 
dev
 = 
deviû
.
cÚfig
{

20 
pÜt
 = 
dev
,

21 
rxQueues
 = 
¬gs
.
th»ads
 + (¬gs.
Ïı
 
ªd
 1 
Ü
 0),

22 
txQueues
 = 
¬gs
.
th»ads
 + (¬gs.
Ïı
 
ªd
 1 
Ü
 0),

23 
rssQueues
 = 
¬gs
.
th»ads


24 
	}
}

25 -- 
Ï¡
 
queue
 
Ïı


26 
	g¬gs
.
Ïı
 
th’


27 
	gbË
.
š£¹
(
ÏıQueues
, {
rxQueue
 = 
dev
:
g‘RxQueue
(
¬gs
.
th»ads
), 
txQueue
 = dev:
g‘TxQueue
(args.threads)})

28 
’d


29 
¬gs
.
dev
[
i
] = dev

30 
’d


31 
deviû
.
wa™FÜLšks
()

33 -- 
£tup
 
Ïı
 
»que¡ed


34 
¬gs
.
Ïı
 
th’


35 
Ïı
.
¡¬tLaıTask
("bÚd0", 
ÏıQueues
)

36 
	gÏı
.
wa™FÜLšk
("bond0")

37 
	g’d


39 -- 
´št
 
¡©i¡ics


40 
	g¡©s
.
	g¡¬tStsTask
{
	gdeviûs
 = 
¬gs
.
dev
, 
	gfe
 =‡rgs.
ouut
}

42 
	gi
, 
dev
 
š
 
	$aœs
(
¬gs
.
dev
) do

43 
i
 = 1, 
¬gs
.
th»ads
 do

44 
lm
.
	`¡¬tTask
("»æeùÜ", 
dev
:
	`g‘RxQueue
(
i
 - 1), dev:
	`g‘TxQueue
(i - 1))

45 
’d


46 
’d


47 
lm
.
	$wa™FÜTasks
()

48 
’d


50 
funùiÚ
 
	$»æeùÜ
(
rxQ
, 
txQ
)

51 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

52 
lm
.
	$ruÂšg
() do

53 
loÿl
 
rx
 = 
rxQ
:
	$ŒyRecv
(
bufs
, 1000)

54 
i
 = 1, 
rx
 do

55 -- 
sw­
 
MAC
 
add»s£s


56 
loÿl
 
pkt
 = 
bufs
[
i
]:
	$g‘Eth”ÃtPack‘
()

57 
loÿl
 
tmp
 = 
pkt
.
‘h
:
	$g‘D¡
()

58 
pkt
.
‘h
:
	`£tD¡
Õkt.‘h:
	$g‘Src
())

59 
pkt
.
‘h
:
	$£tSrc
(
tmp
)

60 
loÿl
 
vÏn
 = 
bufs
[
i
]:
	$g‘VÏn
()

61 
vÏn
 
th’


62 
bufs
[
i
]:
	$£tVÏn
(
vÏn
)

63 
’d


64 
’d


65 
txQ
:
	$£ndN
(
bufs
, 
rx
)

66 
’d


67 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/examples/webserver.lua

1 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

2 
loÿl
 
deviû
 = 
»quœe
 "device"

3 
loÿl
 
¡©s
 = 
»quœe
 "stats"

4 
loÿl
 
log
 = 
»quœe
 "log"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
£rv”
 = 
»quœe
 "webserver"

8 
funùiÚ
 
	$cÚfigu»
(
·r£r
)

9 
·r£r
:
desütiÚ
[[

10 
REST
 
API
 
demo
, 
check
 
out
 
the£
 
’dpošts
:

11 * 
cu¾
 
loÿlho¡
/
deviûs
/<
id
>

12 * 
cu¾
 
loÿlho¡
/
couÁ”s
/2

13 * 
cu¾
 
loÿlho¡
/
h–lo


14 * 
cu¾
 
loÿlho¡
/
h–lo
/
libmoÚ


15 * 
cu¾
 -
X
 
POST
 
loÿlho¡
/
h–lo
 --
d©a
-
ascii
 '{"foo": 42, "hello": "world"}'

17 
·r£r
:
	`¬gum’t
("dev", "DeviûØu£, g’”©e somdummy¿ffiøtØshowÿ£h¡©i¡ic API."):
	$cÚv”t
(
tÚumb”
)

18 
·r£r
:
	`İtiÚ
("-°--pÜt", "S¹hREST API oÀthgiv’…Üt."):
	$¬gs
(1):(8080):
	$cÚv”t
(
tÚumb”
)

19 
·r£r
:
	`İtiÚ
("-b --bind", "Bindo‡ specific IP.")

20 
·r£r
:
	`İtiÚ
("-o --output", "Fileo output statisticso")

21  
·r£r
:
	$·r£
()

22 
’d


24 -- 
this
 
funùiÚ
 
is
 
execu‹d
 
š
 
the
 
cÚ‹xt
 
of
h
web£rv”
 
th»ad


25 -- 
you
 
have
 
to
 
defše
 
the
 
hªdËrs
 
th©
 you 
¬e
 
usšg
 *
š
 
this
 
th»ad
*, 
Ùh”wi£
 
they
 
wÚ
't work

26 
funùiÚ
 
	$š™Web£rv”
(
turbo
, 
deçuÉRe¥Ú£
)

27 
log
:
	`šfo
("RuÂšg web£rv” in™Ÿliz”,„eûived‡rgum’t: %s", 
deçuÉRe¥Ú£
)

29 -- 
S“
 
turbo
 
docum’tiÚ
 
mÜe
: 
h‰ps
:

30 
loÿl
 
h–loWÜld
 = 
	`şass
("h–loWÜld", 
turbo
.
web
.
Reque¡HªdËr
)

32 
funùiÚ
 
h–loWÜld
:
	$g‘
(
·thArg
)

33 
·thArg
 =ğ"" 
th’


34 
·thArg
 = 
deçuÉRe¥Ú£


35 
’d


36 
£lf
:
	`wr™e
({
h–lo
 = 
·thArg
})

37 
’d


39 
funùiÚ
 
h–loWÜld
:
	$po¡
(...)

40 
loÿl
 
jsÚ
 = 
£lf
:
	$g‘_jsÚ
(
Œue
)

41 
nÙ
 
jsÚ
 
th’


42 
	`”rÜ
(
turbo
.
web
.
	`HTTPE¼Ü
(400, {
mes§ge
 = "Ex³ùed JSON d©¨š POST body."
	}
}))

43 
’d


44 
	g£lf
:
	$wr™e
(
jsÚ
)

45 
’d


47 --  
ª
 
turbo
 
hªdËr
 
li¡


49 {"^/h–lo/?([^/]*)$", 
h–loWÜld
},

50 
	}
}

51 
’d


53 
funùiÚ
 
	$ma¡”
(
¬gs
,...)

54 
£rv”
.
	`¡¬tWeb£rv”Task
({

55 
pÜt
 = 
¬gs
.port,

56 
bšd
 = 
¬gs
.bind,

57 -- 
a
 
funùiÚ
 
th©
 
defšes
 
add™iÚ®
 
hªdËrs
, 
™
's„un‡s it would with†m.startTask()

58 -- 
this
 
m—ns
 
™
 
Ãeds
 
to
 
be
 
·s£d
 
by
 
Çme


59 -- 
ªy
 
exŒa
 
¬gum’ts
 
·s£d
 
to
 
¡¬tWeb£rv”Tasks
 
wl
 
be
…as£d 
Ú
Ø
this
 
funùiÚ
 
w™h
 
the
 
usu®
 
£rŸliz©iÚ


60 
š™
 = "initWebserver"

61 
	}
}, "Hello, world")

62 
	g¬gs
.
dev
 
th’


63 
loÿl
 
	gdev
 = 
deviû
.
cÚfig
{
pÜt
 = 
¬gs
.
dev
}

64 
	gdeviû
.
	$wa™FÜLšks
()

65 
¡©s
.
¡¬tStsTask
{
deviûs
 = {
dev
}, 
fe
 = 
¬gs
.
ouut
}

66 
	glm
.
¡¬tTask
("txTask", 
dev
:
	$g‘TxQueue
(0))

67 
’d


68 
lm
.
	$wa™FÜTasks
()

69 
’d


71 
funùiÚ
 
	$txTask
(
queue
)

72 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	`funùiÚ
(
buf
)

73 -- 
ju¡
 
some
 
¿ndom
 
·ck‘s


74 
buf
:
	$g‘UdpPack‘
():
fl
{

75 
pktL’gth
 = 60

76 
	}
}

77 
’d
)

78 
loÿl
 
bufs
 = 
mempoŞ
:
	$bufA¼ay
()

79 
lm
.
	$ruÂšg
() do

80 
bufs
:
	$®loc
(60)

81 
bufs
:
	$ofæßdUdpChecksums
()

82 
queue
:
	$£nd
(
bufs
)

83 
’d


84 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/barrier.lua

1 --- 
B¬r›rs
 
to
 
synchrÚize
 
executiÚ
 
of
 
difã»Á
 
sks


2 
loÿl
 
	gmod
 = {}

4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

7 
ffi
.
cdef
 [[

8 
	sb¬r›r
 { };

9 
b¬r›r
* 
make_b¬r›r
(
size_t
 
n
);

10 
b¬r›r_wa™
(
b¬r›r
* barrier);

11 
b¬r›r_»š™
(
b¬r›r
* b¬r›r, 
size_t
 
n
);

14 
loÿl
 
	gC
 = 
ffi
.
C


16 
loÿl
 
b¬r›r
 = {}

17 
b¬r›r
.
__šdex
 = barrier

19 --- @
·¿m
 
n
 
numb”
 
of
 
sks


20 
funùiÚ
 
mod
:
	$Ãw
(
n
)

21  
C
.
	$make_b¬r›r
(
n
)

22 
’d


24 
funùiÚ
 
b¬r›r
:
	$wa™
()

25 
C
.
	$b¬r›r_wa™
(
£lf
)

26 
’d


28 --- 
Cª
 
Úly
 
be
 
ÿÎed
 
no
 
sks
 
¬e
 
wa™šg
, 
i
.
e
., 
aá”
 
	$wa™
(è
»tuºed


29 --- @
·¿m
 
n
 
numb”
 
of
 
sks


30 
funùiÚ
 
b¬r›r
:
	$»š™
(
n
)

31 
C
.
	$b¬r›r_»š™
(
£lf
, 
n
)

32 
’d


34 
ffi
.
	`m‘©y³
("¡ruù b¬r›r", 
b¬r›r
)

36  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/bitmask.lua

2 --- @
fe
 
	gb™mask
.
	glua


3 --- @
br›f
 
	gB™mask
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 
loÿl
 
	glog
 = 
»quœe
 "log"

8 
loÿl
 
ffi
 = 
»quœe
 "ffi"

9 
ffi
.
cdef
 [[

10 
	smg_b™mask
{

11 
ušt16_t
 
size
;

12 
ušt16_t
 
n_blocks
;

13 
ušt64_t
 
mask
[0];

15 
mg_b™mask
 * 
mg_b™mask_ü—‹
(
ušt16_t
 
size
);

16 
mg_b™mask_ä“
(
mg_b™mask
 * 
mask
);

17 
mg_b™mask_£t_n_Úe
(
mg_b™mask
 * 
mask
, 
ušt16_t
 
n
);

18 
mg_b™mask_£t_®l_Úe
(
mg_b™mask
 * 
mask
);

19 
mg_b™mask_ş—r_®l
(
mg_b™mask
 * 
mask
);

20 
ušt8_t
 
mg_b™mask_g‘_b™
(
mg_b™mask
 * 
mask
, 
ušt16_t
 
n
);

21 
mg_b™mask_£t_b™
(
mg_b™mask
 * 
mask
, 
ušt16_t
 
n
);

22 
mg_b™mask_ş—r_b™
(
mg_b™mask
 * 
mask
, 
ušt16_t
 
n
);

23 
mg_b™mask_ªd
(
mg_b™mask
 * 
mask1
, mg_b™mask * 
mask2
, mg_b™mask * 
»suÉ
);

24 
mg_b™mask_xÜ
(
mg_b™mask
 * 
mask1
, mg_b™mask * 
mask2
, mg_b™mask * 
»suÉ
);

25 
mg_b™mask_Ü
(
mg_b™mask
 * 
mask1
, mg_b™mask * 
mask2
, mg_b™mask * 
»suÉ
);

26 
mg_b™mask_nÙ
(
mg_b™mask
 * 
mask1
, mg_b™mask * 
»suÉ
);

30 
	gmod
 = {}

32 
loÿl
 
mg_b™Mask
 = {}

33 --
mg_b™Mask
.
__šdex
 = mg_bitMask

35 --- 
C»©e
 
a
 
B™mask


36 --- 
The
 
mask
 
is
 
š‹º®ly
 
but
 
äom
 
blocks
 
of
 64b
™
 
š‹g”s
. 
H’û
 
a
 
B™mask


37 --- 
of
 
a
 
size
 <<64 
y›lds
 
signifiÿÁ
 
ov”h—d


38 --- @
·¿m
 
size
 
Size
 
of
 
the
 
b™mask
 
š
 
numb”
 oà
b™s


39 --- @ 
W¿µ”
 
bË
 
¬ound
 
the
 
b™mask


40 
funùiÚ
 
mod
.
	$ü—‹B™Mask
(
size
)

41  
	`£tm‘©abË
({

42 
b™mask
 = 
ffi
.
	`gc
(ffi.
C
.
	`mg_b™mask_ü—‹
(
size
), 
	`funùiÚ
 (
£lf
)

43 
log
:
	`debug
("I HAVE BEEN DESTRUCTED")

44 
ffi
.
C
.
	`mg_b™mask_ä“
(
£lf
)

45 
’d
 )

46 
	}
}, 
	gmg_b™Mask
)

47 
	g’d


50 --- @
·¿m
 
	gb™masks


51 --- @
todo
 
	gTODO
: 
thšk
 
of
 
a
 
b‘‹r
 
sŞutiÚ
 - 
meh


52 
funùiÚ
 
mod
.
	$lškToA¼ay
(
b™masks
)

53 
¬¿y
 = 
ffi
.
	`Ãw
("struct mg_bitmask*[?]", #bitmasks)

54 
loÿl
 
i
 = 0

55 
_
,
m
 
š
 
	$·œs
(
b™masks
) do

56 
¬¿y
[
i
] = 
m
.
b™mask


57 
i
 = i + 1

58 
’d


59  
¬¿y


60 
’d


62 --- 
£ts
 
the
 
fœ¡
 
n
 
b™s
 
š
 
a
 
b™mask
 
to
 1

63 --- 
Ùh”
 
b™s
 
»maš
 
unchªged


64 --- @
·¿m
 
n


65 
funùiÚ
 
mg_b™Mask
:
	$£tN
(
n
)

66 
ffi
.
C
.
	$mg_b™mask_£t_n_Úe
(
£lf
.
b™mask
, 
n
)

67  
£lf


68 
’d


70 --- 
£ts
 
®l
 
b™s
 
š
 
a
 
b™mask
 
to
 0

71 
funùiÚ
 
mg_b™Mask
:
	$ş—rAÎ
()

72 
ffi
.
C
.
	$mg_b™mask_ş—r_®l
(
£lf
.
b™mask
)

73  
£lf


74 
’d


76 --- 
£ts
 
®l
 
b™s
 
š
 
a
 
b™mask
 
to
 1

77 
funùiÚ
 
mg_b™Mask
:
	$£tAÎ
()

78 
ffi
.
C
.
	$mg_b™mask_£t_®l_Úe
(
£lf
.
b™mask
)

79  
£lf


80 
’d


82 --- 
Index
 
m‘am‘hod
 
mg_b™Mask


83 --- @
·¿m
 
x
 
B™
 
šdex
. 
Index
 
¡¬ts
 
©
 1 
accÜdšg
 
to
 
the
 
LUA
 
	`¡ªd¬d
 (1 
šdexes
h
fœ¡
 
b™
 
š
h
b™mask
)

84 --- @ 
FÜ
 
num”ic
 
šdiûs
: 
Œue
, 
wh’
 
cÜ»¥Údšg
 
b™
 
is
 1, 
çl£
 
Ùh”wi£
.

85 
funùiÚ
 
mg_b™Mask
:
	`__šdex
(
x
)

86 -- 
acûss


87 --
	`´št
(" bit‡ccess")

88 --
	`´št
("y³ " .. 
	`ty³
(
x
))

89 --
	`´št
(" x = " .. 
	$to¡ršg
(
x
))

90 if(
	`ty³
(
x
è=ğ"numb”"è
th’


91  (
ffi
.
C
.
	`mg_b™mask_g‘_b™
(
£lf
.
b™mask
, 
x
 - 1) ~= 0)

93  
mg_b™Mask
[
x
]

94 
’d


95 
’d


97 --- 
Newšdex
 
m‘am‘hod
 
mg_b™Mask


98 --- @
·¿m
 
x
 
B™
 
šdex
. 
Index
 
¡¬ts
 
©
 1 
accÜdšg
 
to
 
the
 
LUA
 
	`¡ªd¬d
 (1 
šdexes
h
fœ¡
 
b™
 
š
h
b™mask
)

99 --- @
·¿m
 
y
 
AssigÃd
 
v®ue
 
to
 
the
 
	$šdex
 (
b™
 
is
 
ş—»d
 
y
==0 
ªd
 
£t
 
Ùh”wi£
)

100 
funùiÚ
 
mg_b™Mask
:
	`__Ãwšdex
(
x
, 
y
)

101 --
	`´št
 ("new index")

102 if(
y
 =ğ0è
th’


103 -- 
ş—r
 
b™


104 --
	`´št
("clear")

105  
ffi
.
C
.
	`mg_b™mask_ş—r_b™
(
£lf
.
b™mask
, 
x
 - 1)

107 -- 
£t
 
b™


108 --
	`´št
("set")

109  
ffi
.
C
.
	`mg_b™mask_£t_b™
(
£lf
.
b™mask
, 
x
 - 1)

110 
’d


111 
’d


114 
loÿl
 
funùiÚ
 
	$™
(
£lf
, 
i
)

115 
i
 >ğ
£lf
.
b™mask
.
size
 
th’


116  
n


117 
’d


118  
i
 + 1, 
£lf
[i+1]

119 
’d


121 
funùiÚ
 
mg_b™Mask
.
	$__aœs
(
£lf
)

122  
™
, 
£lf
, 0

123 
’d


124 
’d


126 --- 
B™wi£
 
ªd


127 --- @
·¿m
 
mask1


128 --- @
·¿m
 
mask2


129 --- @
·¿m
 
»suÉ


130 --- 
»suÉ
 = 
mask1
 
bªd
 
mask2


131 
funùiÚ
 
mod
.
	$bªd
(
mask1
, 
mask2
, 
»suÉ
)

132 
ffi
.
C
.
	$mg_b™mask_ªd
(
mask1
.
b™mask
, 
mask2
.b™mask, 
»suÉ
.bitmask)

133 
’d


135 --- 
B™wi£
 
Ü


136 --- @
·¿m
 
mask1


137 --- @
·¿m
 
mask2


138 --- @
·¿m
 
»suÉ


139 --- 
»suÉ
 = 
mask1
 
bÜ
 
mask2


140 
funùiÚ
 
mod
.
	$bÜ
(
mask1
, 
mask2
, 
»suÉ
)

141 
ffi
.
C
.
	$mg_b™mask_Ü
(
mask1
.
b™mask
, 
mask2
.b™mask, 
»suÉ
.bitmask)

142 
’d


144 --- 
B™wi£
 
xÜ


145 --- @
·¿m
 
mask1


146 --- @
·¿m
 
mask2


147 --- @
·¿m
 
»suÉ


148 --- 
»suÉ
 = 
bask1
 
bxÜ
 
mask2


149 
funùiÚ
 
mod
.
	$bxÜ
(
mask1
, 
mask2
, 
»suÉ
)

150 
ffi
.
C
.
	$mg_b™mask_xÜ
(
mask1
.
b™mask
, 
mask2
.b™mask, 
»suÉ
.bitmask)

151 
’d


153 --- 
B™wi£
 
nÙ


154 --- @
·¿m
 
mask


155 --- @
·¿m
 
»suÉ


156 --- 
»suÉ
 = 
nÙ
 
mask


157 
funùiÚ
 
mod
.
	$bnÙ
(
mask
, 
»suÉ
)

158 
ffi
.
C
.
	$mg_b™mask_nÙ
(
mask
.
b™mask
, 
»suÉ
.bitmask)

159 
’d


161  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/colors.lua

2 --- @
fe
 
	gcŞÜs
.
	glua


3 --- @
br›f
 
CŞÜ
 
Codes
 
cŞÜized
 
	g¡ršgs
.

4 --- 
	gInşudes
:

5 --- - 
CŞÜ
 
Codes


6 --- - 
G‘‹r
 
to
 
cŞÜize
 
a
 
¡ršg
 (
suµÜts
 
fÜm©tšg
)

10 ---- 
CŞÜ
 
Codes


13 
loÿl
 
mod
 = {}

15 --- 
TabË
 
w™h
 
cŞÜ
 
codes


16 
loÿl
 
cŞÜCode
 = {

17 
bÏck
 = "0;30",

18 
	gdg»y
 = "1;30",

19 
	g»d
 = "0;31",

20 
	gb»d
 = "1;31",

21 
	gg»’
 = "0;32",

22 
	gbg»’
 = "1;32",

23 
	gbrown
 = "0;33",

24 
	gy–low
 = "1;33",

25 
	gblue
 = "0;34",

26 
	gbblue
 = "1;34",

27 
	gdblue
 = "2;34",

28 
	gdpu½Ë
 = "0;35",

29 
	gbpu½Ë
 = "1;35",

30 
	gdcyª
 = "0;36",

31 
	gcyª
 = "1;36",

32 
	gbg»y
 = "0;37",

33 
	gwh™e
 = "1;37",

34 
	gnÚe
 = "0"

37 
	gmod
.
	gcŞÜP®Ët
 = { 'blue', 'bgreen', 'dpurple', 'bred', 'brown', 'cyan', 'green', 'yellow', 'red' }

39 --- 
G‘
 
ª
 
esÿ³
 
£qu’û
 
Úe
 
·¹icuÏr
 
cŞÜ
.

40 --- @
·¿m
 
cŞÜ
 
CŞÜ
 
as
 
¡ršg
. 
S“
 
cŞÜCode
 
possibË
 
cŞÜs
. 
DeçuÉ
 
is
 
no
 cŞÜ (
nÚe
).

41 --- 
CŞÜ
 
as
 
numb”
. 
U£d
‡ 
šdex
 
the
 
cŞÜ
 
·Î‘
.

42 --- @ 
Esÿ³
 
£qu’û
 
as
 
¡ršg


43 
funùiÚ
 
	$g‘CŞÜCode
(
cŞÜ
)

44 
	`ty³
(
cŞÜ
è=ğ"numb”" 
th’


45 
cŞÜ
 = 
cŞÜCode
[
mod
.
cŞÜP®Ët
[((color - 1) % #mod.colorPallet) + 1]]

47 
cŞÜ
 = 
cŞÜCode
[cŞÜ] 
Ü
 colorCode["none"]

48 
’d


49  "\027[" .. 
cŞÜ
 .. "m"

50 
’d


53 ---- 
CŞÜized
 
SŒšg


56 --- 
CŞÜizes
 
a
 
¡ršg
. 
No
 
fÜm©tšg
 
suµÜ‹d
.

57 --- @
·¿m
 
¡r
 
The
 
¡ršg
 
to
 
be
 
cŞÜized
.

58 --- @
·¿m
 
cŞÜ
 
The
 cŞÜ 
to
 
be
 
u£d
.

59 --- @ 
The
 
cŞÜized
 
¡ršg
.

60 
funùiÚ
 
	$g‘CŞÜizedSŒšg
(
¡r
, 
cŞÜ
)

61  
	`g‘CŞÜCode
(
cŞÜ
è.. 
¡r
 .. 
	$g‘CŞÜCode
()

62 
’d


64 --- 
CŞÜize
 
a
 
¡ršg
 
»d
.

65 --- @
·¿m
 
¡r
 
The
 
¡ršg
 
to
 
be
 
cŞÜized
.

66 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
¬gum’ts


67 --- @ 
The
 
cŞÜized
 
¡ršg
.

68 
funùiÚ
 
	$»d
(
¡r
, ...)

69  
	`g‘CŞÜizedSŒšg
(
¡r
:
	`fÜm©
(...), "red")

70 
’d


72 --- 
CŞÜize
 
a
 
¡ršg
 
bright
 
»d
.

73 --- @
·¿m
 
¡r
 
The
 
¡ršg
 
to
 
be
 
cŞÜized
.

74 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
¬gum’ts


75 --- @ 
The
 
cŞÜized
 
¡ršg
.

76 
funùiÚ
 
	$b»d
(
¡r
, ...)

77  
	`g‘CŞÜizedSŒšg
(
¡r
:
	`fÜm©
(...), "bred")

78 
’d


80 --- 
CŞÜize
 
a
 
¡ršg
 
y–low
.

81 --- @
·¿m
 
¡r
 
The
 
¡ršg
 
to
 
be
 
cŞÜized
.

82 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
¬gum’ts


83 --- @ 
The
 
cŞÜized
 
¡ršg
.

84 
funùiÚ
 
	$y–low
(
¡r
, ...)

85  
	`g‘CŞÜizedSŒšg
(
¡r
:
	`fÜm©
(...), "yellow")

86 
’d


88 --- 
CŞÜize
 
a
 
¡ršg
 
g»’
.

89 --- @
·¿m
 
¡r
 
The
 
¡ršg
 
to
 
be
 
cŞÜized
.

90 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
¬gum’ts


91 --- @ 
The
 
cŞÜized
 
¡ršg
.

92 
funùiÚ
 
	$g»’
(
¡r
, ...)

93  
	`g‘CŞÜizedSŒšg
(
¡r
:
	`fÜm©
(...), "green")

94 
’d


96 --- 
CŞÜize
 
a
 
¡ršg
 
wh™e
.

97 --- @
·¿m
 
¡r
 
The
 
¡ršg
 
to
 
be
 
cŞÜized
.

98 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
¬gum’ts


99 --- @ 
The
 
cŞÜized
 
¡ršg
.

100 
funùiÚ
 
	$wh™e
(
¡r
, ...)

101  
	`g‘CŞÜizedSŒšg
(
¡r
:
	`fÜm©
(...), "white")

102 
’d


104  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/device.lua

1 --- 
Deviû
 
ªd
 
queue
 
cÚfigu¿tiÚ


3 
loÿl
 
	gmod
 = {}

5 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

6 
loÿl
 
ffi
 = 
»quœe
 "ffi"

7 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

8 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

9 
loÿl
 
memÜy
 = 
»quœe
 "memory"

10 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

11 
loÿl
 
log
 = 
»quœe
 "log"

12 
loÿl
 
tim”
 = 
»quœe
 "timer"

13 
loÿl
 
Çme¥aûs
 = 
»quœe
 "namespaces"

14 
loÿl
 
pciIds
 = 
»quœe
 "pci-ids"

15 
loÿl
 
driv”s
 = 
»quœe
 "drivers"

16 
loÿl
 
‘h
 = 
»quœe
 "proto.ethernet"

17 
loÿl
 
E
 = 
»quœe
 "sysÿÎ".
c
.E

19 
funùiÚ
 
mod
.
	$numDeviûs
()

20  
dpdkc
.
	`¹e_‘h_dev_couÁ
();

21 
’d


23 
loÿl
 
dev
 = {
	}
}

24 
dev
.
__šdex
 = dev

25 
dev
.
__ty³
 = "device"

27 
funùiÚ
 
dev
:
	$__to¡ršg
()

28  ("[Deviû: id=%d]"):
	$fÜm©
(
£lf
.
id
)

29 
’d


31 
funùiÚ
 
dev
:
	$__eq
(
Ùh”
)

32  
£lf
.
id
 =ğ
Ùh”
.id

33 
’d


35 
funùiÚ
 
dev
:
	$__£rŸlize
()

36  "»quœ'deviû'†oÿÈdev = " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('deviû').__deviûPrÙÙy³"è.. "„equœe('driv”s').š™Driv”(devèdev:checkSock‘(è»tuº dev", 
Œue


37 
’d


39 
loÿl
 
txQueue
 = {
	}
}

40 
txQueue
.
__šdex
 =xQueue

41 
txQueue
.
__ty³
 = "txQueue"

43 
funùiÚ
 
txQueue
:
	$__to¡ršg
()

44  ("[TxQueue: id=%d, qid=%d]"):
	$fÜm©
(
£lf
.
id
, s–f.
qid
)

45 
’d


47 
funùiÚ
 
txQueue
:
	$__eq
(
Ùh”
)

48  
£lf
.
id
 =ğ
Ùh”
.id 
ªd
 s–f.
qid
 == other.qid

49 
’d


51 
funùiÚ
 
txQueue
:
	$__£rŸlize
()

52  ('loÿÈdev =„equœ"deviû"„‘uº dev.g‘(%d):g‘TxQueue(%d)'):
	`fÜm©
(
£lf
.
id
, s–f.
qid
), 
Œue


53 
’d


55 
loÿl
 
rxQueue
 = {
	}
}

56 
rxQueue
.
__šdex
 =„xQueue

57 
rxQueue
.
__ty³
 = "rxQueue"

59 
funùiÚ
 
rxQueue
:
	$__to¡ršg
()

60  ("[RxQueue: id=%d, qid=%d]"):
	$fÜm©
(
£lf
.
id
, s–f.
qid
)

61 
’d


63 
funùiÚ
 
rxQueue
:
	$__eq
(
Ùh”
)

64  
£lf
.
id
 =ğ
Ùh”
.id 
ªd
 s–f.
qid
 == other.qid

65 
’d


67 
funùiÚ
 
rxQueue
:
	$__£rŸlize
()

68  ('loÿÈdev =„equœ"deviû"„‘uº dev.g‘(%d):g‘RxQueue(%d)'):
	`fÜm©
(
£lf
.
id
, s–f.
qid
), 
Œue


69 
’d


72 
loÿl
 
deviûs
 = 
Çme¥aûs
:
	`g‘
()

74 --- 
CÚfigu»
 
a
 
deviû


75 --- @
·¿m
 
¬gs
 
A
 
bË
 
cÚššg
 
the
 
fŞlowšg
 
Çmed
 
¬gum’ts


76 --- 
pÜt
 
PÜt
 
to
 
cÚfigu»


77 --- 
mempoŞs
 
	$İtiÚ®
 ( = 
ü—‹
 
Ãw
 
mempoŞs
è
RX
 mempoŞ 
to
 
assocŸ‹
 
w™h
 
the
 
queues


78 --- 
rxQueues
 
	$İtiÚ®
 ( = 1è
Numb”
 
of
 
RX
 
queues
 
to
 
cÚfigu»


79 --- 
txQueues
 
	$İtiÚ®
 ( = 1è
Numb”
 
of
 
TX
 
queues
 
to
 
cÚfigu»


80 --- 
rxDescs
 
	`İtiÚ®
 ( = 512)

81 --- 
txDescs
 
	`İtiÚ®
 ( = 1024)

82 --- 
numBufs
 
	`İtiÚ®
 ( 
	`max
(2047, 
rxDescs
 * 2 -1))

83 --- 
bufSize
 
	`İtiÚ®
 ( = 2048)

84 --- 
¥“d
 
	`İtiÚ®
 ( = 0/
max
è
S³ed
 
š
 
Mb™
 
to
 
	`ÃgÙŸ‹
 (
cu¼’y
 
di§bËd
 
due
Ø
DPDK
 
chªges
)

85 --- 
drİEÇbË
 
	$İtiÚ®
 ( = 
Œue
è
Drİ
 
rx
 
·ck‘s
 
dœeùly
 
no
„x 
desütÜs
 
¬e
 
avaabË


86 --- 
rssQueues
 
	$İtiÚ®
 ( = 0è
Numb”
 
of
 
queues
 
to
 
u£
 
RSS


87 --- 
rssBa£Queue
 
	$İtiÚ®
 ( = 0è
The
 
fœ¡
 
queue
 
to
 
u£
 
RSS
, 
·ck‘s
 
wl
 
go
Ø
queues
 
rssBa£Queue
 
up
ØrssBa£Queu+ 
rssQueues
 - 1

88 --- 
rssFunùiÚs
 
	$İtiÚ®
 ( = 
®l
 
suµÜ‹d
 
funùiÚs
è
TabË
 
w™h
 
hash
 funùiÚ 
¥ecif›d
 
š
 
dpdk
.
ETH_RSS_
*

89 --- 
di§bËOfæßds
 
	$İtiÚ®
 ( = 
çl£
è
Di§bË
 
®l
 
ofæßdšg
 
ã©u»s
, 
this
 
signifiÿÁly
 
¥“ds
 
up
 
some
 
	`driv”s
 (
e
.
g
., 
ixgbe
).

90 --- 
£t
 
by
  
driv”s
 
th©
 dØ
nÙ
 
suµÜt
 
	`ofæßdšg
 (
e
.
g
., 
vœtio
)

91 --- 
	$¡rVÏn
 ( = 
Œue
è
SŒ
 
the
 
VLAN
 
g
 
Ú
h
NIC
.

92 
funùiÚ
 
mod
.
	$cÚfig
(
¬gs
)

93 
nÙ
 
¬gs
 
Ü
‚Ù‡rgs.
pÜt
 
th’


94 
log
:
	`çl
("usage: device.config({…ort = x, ... })")

95 
’d


96 
¬gs
.
pÜt
 >ğ
dpdkc
.
	$dpdk_g‘_max_pÜts
(è
th’


97 
log
:
	`çl
("maximum‚umb” oàsuµÜ‹d…Üt i %d,hi ÿÀbchªged w™hhDPDK compe-timcÚfigu¿tiÚ v¬ŸbË RTE_MAX_ETHPORTS\n", 
dpdkc
.
	$dpdk_g‘_max_pÜts
())

98 
’d


99 
¬gs
.
pÜt
 >ğ
dpdkc
.
	$¹e_‘h_dev_couÁ
(è
th’


100 
log
:
	`çl
("th”¬Úly %d…Üts,r›dØcÚfigu»…Üˆid %d", 
dpdkc
.
	`¹e_‘h_dev_couÁ
(), 
¬gs
.
pÜt
)

101 
’d


102 
mod
.
	$g‘
(
¬gs
.
pÜt
è
ªd
 
mod
.
	`g‘
×rgs.pÜt).
š™Ÿlized
 
th’


103 
log
:
	`w¬n
("Deviû %d‡Ì—dy cÚfigu»d, skpšg in™iz©iÚ", 
¬gs
.
pÜt
)

104  
mod
.
	$g‘
(
¬gs
.
pÜt
)

105 
’d


106 
loÿl
 
šfo
 = 
dev
.
g‘Info
{
id
 = 
¬gs
.
pÜt
}

107 
loÿl
 
	gdriv”Info
 = 
driv”s
.
g‘Driv”Info
(
ffi
.
	$¡ršg
(
šfo
.
driv”_Çme
))

108 
¬gs
.
rxQueues
 =‡rgs.rxQueue 
Ü
 1

109 
¬gs
.
txQueues
 =‡rgs.txQueue 
Ü
 1

110 
¬gs
.
rxDescs
 =‡rgs.rxDesc 
Ü
 512

111 
¬gs
.
txDescs
 =‡rgs.txDesc 
Ü
 1024

112 
¬gs
.
numBufs
 =‡rgs.numBuf 
Ü
 
m©h
.
	`max
(2047,‡rgs.
rxDescs
 * 2 - 1)

113 
¬gs
.
bufSize
 =‡rgs.bufSiz
Ü
 2048

114 
¬gs
.
rxQueues
 > 
šfo
.
max_rx_queues
 
th’


115 
log
:
	`çl
("deviû suµÜt Úly %d„x queues,„eque¡ed %d", 
šfo
.
max_rx_queues
, 
¬gs
.
rxQueues
)

116 
’d


117 
¬gs
.
txQueues
 > 
šfo
.
max_tx_queues
 
th’


118 
log
:
	`çl
("deviû suµÜt Úly %dx queues,„eque¡ed %d", 
šfo
.
max_tx_queues
, 
¬gs
.
txQueues
)

119 
’d


120 
¬gs
.
rxDescs
 > 
šfo
.
rx_desc_lim
.
nb_max


121 
Ü
 
¬gs
.
rxDescs
 < 
šfo
.
rx_desc_lim
.
nb_mš


122 
Ü
 
¬gs
.
rxDescs
 % 
šfo
.
rx_desc_lim
.
nb_®ign
 ~ğ0 
th’


123 
log
:
	`çl
("device supports between %d‡nd %d„x descriptors in steps of %d,„equested %d",

124 
šfo
.
rx_desc_lim
.
nb_mš
, info.rx_desc_lim.
nb_max
, info.rx_desc_lim.
nb_®ign
, 
¬gs
.
rxDescs
)

125 
’d


126 
¬gs
.
txDescs
 > 
šfo
.
tx_desc_lim
.
nb_max


127 
Ü
 
¬gs
.
txDescs
 < 
šfo
.
tx_desc_lim
.
nb_mš


128 
Ü
 
¬gs
.
txDescs
 % 
šfo
.
tx_desc_lim
.
nb_®ign
 ~ğ0 
th’


129 
log
:
	`çl
("device supports between %d‡nd %dx descriptors in steps of %d,„equested %d",

130 
šfo
.
tx_desc_lim
.
nb_mš
, info.tx_desc_lim.
nb_max
, info.tx_desc_lim.
nb_®ign
, 
¬gs
.
txDescs
)

131 
’d


132 
¬gs
.
rssQueues
 =‡rgs.rssQueue 
Ü
 0

133 
¬gs
.
di§bËOfæßds
 =ğ
n
 
th’


134 
¬gs
.
di§bËOfæßds
 = 
driv”Info
.disableOffloads

135 
’d


136 
¬gs
.
rssFunùiÚs
 =‡rgs.rssFunùiÚ 
Ü
 {

137 
dpdk
.
ETH_RSS_IPV4
,

138 
dpdk
.
ETH_RSS_FRAG_IPV4
,

139 
dpdk
.
ETH_RSS_NONFRAG_IPV4_TCP
,

140 
dpdk
.
ETH_RSS_NONFRAG_IPV4_UDP
,

141 
dpdk
.
ETH_RSS_NONFRAG_IPV4_SCTP
,

142 
dpdk
.
ETH_RSS_NONFRAG_IPV4_OTHER
,

143 
dpdk
.
ETH_RSS_IPV6
,

144 
dpdk
.
ETH_RSS_FRAG_IPV6
,

145 
dpdk
.
ETH_RSS_NONFRAG_IPV6_TCP
,

146 
dpdk
.
ETH_RSS_NONFRAG_IPV6_UDP
,

147 
dpdk
.
ETH_RSS_NONFRAG_IPV6_SCTP
,

148 
dpdk
.
ETH_RSS_NONFRAG_IPV6_OTHER
,

149 
dpdk
.
ETH_RSS_L2_PAYLOAD
,

150 
dpdk
.
ETH_RSS_IPV6_EX
,

151 
dpdk
.
ETH_RSS_IPV6_TCP_EX
,

152 
dpdk
.
ETH_RSS_IPV6_UDP_EX


153 
	}
}

154 
loÿl
 
rssMask
 = 0

155 
i
, 
v
 
š
 
	$aœs
(
¬gs
.
rssFunùiÚs
) do

156 
rssMask
 = 
b™
.
	$bÜ
(
rssMask
, 
v
)

157 
’d


158 
¬gs
.
¡rVÏn
 =ğ
n
 
th’


159 
¬gs
.
¡rVÏn
 = 
Œue


160 
’d


161 
¬gs
.
drİEÇbË
 =ğ
n
 
th’


162 
¬gs
.
drİEÇbË
 = 
Œue


163 
’d


164 -- 
ü—‹
 
mempoŞs
 
rx
 
queues


165 
nÙ
 
¬gs
.
mempoŞs
 
th’


166 
¬gs
.
mempoŞs
 = {
	}
}

167 
i
 = 1, 
	g¬gs
.
rxQueues
 do

168 
	gbË
.
š£¹
(
¬gs
.
mempoŞs
, 
memÜy
.
ü—‹MemPoŞ
{
n
 =‡rgs.
numBufs
, 
sock‘
 = 
dpdkc
.
dpdk_g‘_sock‘
×rgs.
pÜt
), 
bufSize
 =‡rgs.bufSize})

169 
’d


170 
	g–£if
 #¬gs.
	gmempoŞs
 ~ğ
¬gs
.
rxQueues
 
th’


171 
log
:
çl
("number of mempools mustƒqual‚umber of„x queues")

172 
’d


173 
¬gs
.
¥“d
 =‡rgs.¥“d 
Ü
 0

174 
¬gs
.
rxQueues
 =ğ0 
Ü
‡rgs.
txQueues
 =ğ0 
th’


175 -- 
dpdk
 
dÛs
 
nÙ
 
like
 
deviûs
 
w™hout
 
rx
/
tx
 
queues
 :(

176 
log
:
çl
("CªnÙ in™Ÿlizdeviû w™houˆ% queues", 
¬gs
.
rxQueues
 =ğ0 
ªd
‡rgs.
txQueues
 =ğ0‡nd "rx‡ndx" 
Ü
‡rgs.rxQueues == 0‡nd "rx" or "tx")

177 
’d


178 
loÿl
 
mempoŞs
 = 
ffi
.
Ãw
("¡ruù mempoŞ*[?]", 
¬gs
.
rxQueues
)

179 
	gi
, 
v
 
š
 
	$aœs
(
¬gs
.
mempoŞs
) do

180 
mempoŞs
[
i
 - 1] = 
v


181 
’d


182 
loÿl
 
rc
 = 
dpdkc
.
	`dpdk_cÚfigu»_deviû
(
ffi
.
	`Ãw
("struct†ibmoon_device_config", {

183 
pÜt
 = 
¬gs
.port,

184 
mempoŞs
 = mempools,

185 
rx_queues
 = 
¬gs
.
rxQueues
,

186 
tx_queues
 = 
¬gs
.
txQueues
,

187 
rx_descs
 = 
¬gs
.
rxDescs
,

188 
tx_descs
 = 
¬gs
.
txDescs
,

189 
drİ_’abË
 = 
¬gs
.
drİEÇbË
,

190 
’abË_rss
 = 
¬gs
.
rssQueues
 > 1,

191 
rss_mask
 = 
rssMask
,

192 
di§bË_ofæßds
 = 
¬gs
.
di§bËOfæßds
,

193 
¡r_vÏn
 = 
¬gs
.
¡rVÏn


194 
	}
}))

195 
	grc
 ~ğ0 
th’


196 
log
:
çl
("Could‚Ù cÚfigu» deviû %d:ƒ¼Ü %s", 
¬gs
.
pÜt
, 
	$¡rE¼Ü
(
rc
))

197 
’d


198 
loÿl
 
dev
 = 
mod
.
	$g‘
(
¬gs
.
pÜt
)

199 
dev
.
š™Ÿlized
 = 
Œue


200 
¬gs
.
rssQueues
 > 1 
th’


201 
dev
:
	$£tRssQueues
(
¬gs
.
rssQueues
,‡rgs.
rssBa£Queue
)

202 
’d


203 
dev
.
š™
 
th’


204 
dev
:
	$š™
()

205 
’d


206 
dev
:
	$¡Üe
()

207 
dev
:
	$£tPromisc
(
Œue
)

208 
dev
:
	$g‘Driv”Name
():
	`m©ch
("i40e"è
th’


209 
loÿl
 
fw
 = 
dev
:
	$g‘Fœmw¬e
()

210 
fw
:
	`m©ch
("^%s*5.05"è
th’


211 
log
:
	`w¬n
(

214 
dev


216 
’d


217 
’d


218  
dev


219 
’d


221 
ffi
.
cdef
[[

222 
	s¹e_‘h_rss_»_’Œy64
 {

223 
ušt64_t
 
mask
;

224 
ušt16_t
 
»
[64];

227 
	`¹e_‘h_dev_rss_»_upd©e
(
ušt8_t
 
pÜt
, 
¹e_‘h_rss_»_’Œy64
* 
»_cÚf
, 
ušt16_t
 
»_size
);

230 --- 
S‘up
 
RSS
 
RETA
 
bË
.

231 
funùiÚ
 
dev
:
	$£tRssQueues
(
n
, 
ba£Queue
)

232 
ba£Queue
 = ba£Queu
Ü
 0

233 
	`as£¹
(
n
 > 0)

234 
b™
.
	`bªd
(
n
,‚ - 1è~ğ0 
th’


235 
log
:
	`w¬n
("RSS di¡ributiÚØqueue wÈnÙ bb®ªûd‡ thnumb” oàqueue (%dèi nÙ‡…ow” oàtwo.", 
n
)

236 
’d


237 
loÿl
 
»Size
 = 
£lf
:
	`g‘Info
().
»_size


238 
»Size
 % 64 ~ğ0 
th’


239 
log
:
	`çl
("NYI:‚umb” oàRETAƒÁr› i nÙ‡ muÉË oà64", 
»Size
)

240 
’d


241 
loÿl
 
’Œ›s
 = 
ffi
.
	`Ãw
("¡ruù„‹_‘h_rss_»_’Œy64[?]", 
»Size
 / 64)

242 
loÿl
 
queue
 = 
ba£Queue


243 
i
 = 0, 
»Size
 / 64 - 1 do

244 
’Œ›s
[
i
].
mask
 = 0xFFFFFFFFFFFFFFFFULL

245 
j
 = 0, 63 do

246 
’Œ›s
[
i
].
»
[
j
] = 
queue


247 
queue
 = queue + 1

248 
queue
 =ğ
ba£Queue
 + 
n
 
th’


249 
queue
 = 
ba£Queue


250 
’d


251 
’d


252 
’d


253 
loÿl
 
»t
 = 
ffi
.
C
.
	$¹e_‘h_dev_rss_»_upd©e
(
£lf
.
id
, 
’Œ›s
, 
»Size
)

254 
»t
 ~ğ0 
th’


255 
log
:
	`çl
("E¼Ü s‘tšg u°RETAabË: " .. 
	$¡rE¼Ü
(
»t
))

256 
’d


257 
’d


259 
funùiÚ
 
mod
.
	$g‘
(
id
)

260 
	`ty³
(
id
è~ğ"numb”" 
th’


261 
log
:
	`çl
("bad‡rgum’ˆ#1,ƒx³ùed‚umb”, gÙ " .. 
	$ty³
(
id
))

262 
’d


263 
loÿl
 
obj


264 
loÿl
 
idSŒ
 = 
	$to¡ršg
(
id
)

265 
deviûs
[
idSŒ
] 
th’


266 
obj
 = 
deviûs
[
idSŒ
]

268 
obj
 = 
	`£tm‘©abË
({
id
 = id, 
rxQueues
 = {}, 
txQueues
 = {}
	}
}, 
	gdev
)

269 
	gdeviûs
[
idSŒ
] = 
obj


270 
’d


271 
driv”s
.
	$š™Driv”
(
obj
)

272  
obj


273 
’d


275 
funùiÚ
 
dev
:
	$¡Üe
()

276 
loÿl
 
idSŒ
 = 
	$to¡ršg
(
£lf
.
id
)

277 
deviûs
[
idSŒ
] = 
£lf


278 
’d


280 
funùiÚ
 
dev
:
	$g‘TxQueue
(
id
)

281 
loÿl
 
tbl
 = 
£lf
.
txQueues


282 
tbl
[
id
] 
th’


283  
tbl
[
id
]

284 
’d


285 
loÿl
 
šfo
 = 
£lf
:
	$g‘Info
()

286 
id
 >ğ
šfo
.
nb_tx_queues
 
th’


287 
log
:
	`çl
("deviû i cÚfigu»d w™hx queue 0Ø%d,r›dØg‘ queunumb” %d", 
šfo
.
nb_tx_queues
 - 1, 
id
)

288 
’d


289 
tbl
[
id
] = 
	`£tm‘©abË
({id = 
£lf
.id, 
qid
 = id, 
dev
 = 
	}
£lf}, 
	gtxQueue
)

290  
	gtbl
[
id
]

291 
’d


293 
funùiÚ
 
	gdev
:
	$g‘RxQueue
(
id
)

294 
loÿl
 
tbl
 = 
£lf
.
rxQueues


295 
tbl
[
id
] 
th’


296  
tbl
[
id
]

297 
’d


298 
loÿl
 
šfo
 = 
£lf
:
	$g‘Info
()

299 
id
 >ğ
šfo
.
nb_rx_queues
 
th’


300 
log
:
	`çl
("deviû i cÚfigu»d w™h„x queue 0Ø%d,r›dØg‘„x queunumb” %d", 
šfo
.
nb_rx_queues
 - 1, 
id
)

301 
’d


302 
tbl
[
id
] = 
	`£tm‘©abË
({id = 
£lf
.id, 
qid
 = id, 
dev
 = 
	}
£lf}, 
	grxQueue
)

303  
	gtbl
[
id
]

304 
’d


306 
loÿl
 
	gw¬nšgShown
 = {} -- 
³r
-
cÜe


307 
funùiÚ
 
dev
:
	$checkSock‘
()

308 
LIBMOON_TASK_NAME
 ~ğ"ma¡”" 
ªd
 
nÙ
 
LIBMOON_IGNORE_BAD_NUMA_MAPPING
 
th’


309 -- 
check
 
the
 
NUMA
 
assocŸtiÚ
 
we
 
¬e
 
ruÂšg
 
š
 
a
 
wÜk”
 
th»ad


310 -- (
™
's okayo dohe initial config fromhe wrong socket, but sending…ackets from it is‡ bad idea)

311 
loÿl
 
devSock‘
 = 
£lf
:
	$g‘Sock‘
()

312 
loÿl
 
cÜe
, 
th»adSock‘
 = 
libmoÚ
.
	$g‘CÜe
()

313 
devSock‘
 ~ğ
th»adSock‘
 
th’


314 
nÙ
 
w¬nšgShown
[
£lf
.
id
] 
th’


315 
w¬nšgShown
[
£lf
.
id
] = 
Œue


316 
log
:
	`w¬n
("You‡reryingo use %s (attachedo CPU socket %d) from‡hread on core %d on socket %d!",

317 
£lf
, 
devSock‘
, 
cÜe
, 
th»adSock‘
)

318 
log
:
	`w¬n
("This can significantly impacthe…erformance orƒven‚ot work‡t‡ll")

319 
log
:
	`w¬n
("You can changehe used CPU cores in dpdk-conf.lua or by using dpdk.startTaskOnCore(core, ...)")

320 
’d


321  
çl£


322 
’d


323 
’d


324  
Œue


325 
’d


328 --- 
Wa™s
 
uÁ
 
®l
 
giv’
 
deviûs
 
¬e
 
š™Ÿlized
 
by
 
ÿÎšg
 
	$wa™
(è
Ú
 
them
.

329 
funùiÚ
 
mod
.
	$wa™FÜLšks
(...)

330 
log
:
	`šfo
("Waiting for deviceso come up...")

331 
loÿl
 
pÜts


332 
	`£Ëù
("#", ...è=ğ0 
th’


333 
pÜts
 = {
	}
}

334 
deviûs
:
fÜEach
(
	$funùiÚ
(
key
, 
dev
)

335 
dev
.
š™Ÿlized
 
th’


336 
pÜts
[#pÜt + 1] = 
dev


337 
’d


338 
’d
)

340 
pÜts
 = { ... 
	}
}

341 
’d


342 
loÿl
 
pÜtsUniq
 = {}

343 
i
, 
pÜt
 
š
 
	$aœs
(
pÜts
) do

344 
pÜtsUniq
[
pÜt
.
id
] =…ort

345 
’d


346 
pÜts
 = {
	}
}

347 
loÿl
 
maxWa™
 = 9

348 
i
, 
v
 
š
 
	$·œs
(
pÜtsUniq
) do

349 
pÜts
[#pÜt + 1] = 
v


350 
maxWa™
 = 
m©h
.
	$max
(
maxWa™
, 
v
.
lškWa™Time
 
Ü
 0)

351 
’d


352 
loÿl
 
wa™Tim”
 = 
tim”
:
	$Ãw
(
maxWa™
)

353 
loÿl
 
pÜtsUp
 = 0

354 #pÜt > 0 
ªd
 
wa™Tim”
:
	$ruÂšg
() do

355 
i
 = #ports, 1, -1 do

356 
loÿl
 
pÜt
 = 
pÜts
[
i
]

357 
pÜt
:
	`g‘LškStus
().
¡©us
 
th’


358 
pÜtsUp
 =…ortsUp + 1

359 
bË
.
	$»move
(
pÜts
, 
i
)

360 
pÜt
:
	`wa™
(0è-- 
´šts
 
mes§ge
 
immedŸ‹ly


361 
’d


362 
’d


363 
libmoÚ
.
	$¦“pMlisIdË
(100)

364 
’d


365 
i
, 
pÜt
 
š
 
	$aœs
(
pÜts
èdØ--…Üt 
th©
 
did
 
nÙ
 
come
 
up


366 
pÜt
:
	$wa™
(0)

367 
’d


368 
log
:
	`šfo
(
	`g»’
(
pÜtsUp
 =ğ1 
ªd
 "%d deviû i up." 
Ü
 "%d devices‡re up.",…ortsUp))

369  
pÜtsUp


370 
’d


373 --- 
Wa™
 
uÁ
 
the
 
deviû
 
is
 
fuÎy
 
š™Ÿlized
 
ªd
 
up
 
to
 
maxWa™
 
£cÚds
Ø
e¡ablish
 
a
 
lšk
.

374 --- 
Logs
 
the
 
cu¼’t
 
lšk
 
¡©e
.

375 -- @
·¿m
 
maxWa™
 
maximum
 
numb”
 
of
 
£cÚds
 
to
 
wa™
 
the
 
lšk
,  = 9

376 
funùiÚ
 
dev
:
	$wa™
(
maxWa™
)

377 
maxWa™
 = maxWa™ 
Ü
 9

378 
loÿl
 
lšk


379 
»³©


380 
lšk
 = 
£lf
:
	$g‘LškStus
()

381 
maxWa™
 > 0 
th’


382 
libmoÚ
.
	$¦“pMlisIdË
(100)

383 
maxWa™
 = maxWait - 0.1

386 
’d


387 
uÁ
 
lšk
.
¡©us


388 
£lf
.
¥“d
 = 
lšk
.speed

389 
loÿl
 
out
 = 
¡ršg
.
	`fÜm©
("Deviû %d (%sèi %s: %s% MB™/s", 
£lf
.
id
, s–f:
	`g‘MacSŒšg
(), 
lšk
.
¡©us
 
ªd
 "up" 
Ü
 "DOWN",†šk.
du¶exAutÚeg
‡nd "" o¸lšk.
du¶ex
‡nd "fuÎ-du¶ex " o¸"h®f-du¶ex ",†šk.
¥“d
)

390 
lšk
.
¡©us
 
th’


391 
log
:
	$šfo
(
out
)

393 
log
:
	$”rÜ
(
out
)

394 
’d


395  
lšk
.
¡©us


396 
’d


399 
funùiÚ
 
dev
:
	$g‘LškStus
()

400 
loÿl
 
lšk
 = 
ffi
.
	`Ãw
("struct„te_eth_link")

401 
dpdkc
.
	$¹e_‘h_lšk_g‘_nowa™
(
£lf
.
id
, 
lšk
)

402  {
¡©us
 = 
lšk
.
lšk_¡©us
 =ğ1, 
du¶exAutÚeg
 =†šk.
lšk_du¶ex
 =ğ0, 
du¶ex
 =†šk.lšk_du¶ex =ğ2, 
¥“d
 =†šk.
lšk_¥“d
}

403 
’d


405 
funùiÚ
 
	gdev
:
	$g‘MacSŒšg
()

406 
loÿl
 
buf
 = 
ffi
.
	`Ãw
("char[20]")

407 
dpdkc
.
	$dpdk_g‘_mac_addr
(
£lf
.
id
, 
buf
)

408  
ffi
.
	$¡ršg
(
buf
)

409 
’d


411 
funùiÚ
 
dev
:
	$g‘Mac
(
numb”
)

412  
	`·r£MacAdd»ss
(
£lf
:
	`g‘MacSŒšg
(), 
numb”
)

413 
’d


415 
funùiÚ
 
dev
:
	$g‘Fœmw¬e
()

416 
loÿl
 
buf
 = 
ffi
.
	`Ãw
("char[1024]")

417 
loÿl
 
rc
 = 
dpdkc
.
	`¹e_‘h_dev_fw_v”siÚ_g‘
(
£lf
.
id
, 
buf
, 1024);

418 
rc
 ~ğ0 
th’


419 
log
:
	`w¬n
("FaedØg‘ fœmw¬v”siÚ: %d", 
rc
)

420  
n


422  
ffi
.
	$¡ršg
(
buf
)

423 
’d


424 
’d


426 
funùiÚ
 
dev
:
	$£tPromisc
(
’abË
)

427 
’abË
 
th’


428 
dpdkc
.
	$¹e_‘h_´omiscuous_’abË
(
£lf
.
id
)

430 
dpdkc
.
	$¹e_‘h_´omiscuous_di§bË
(
£lf
.
id
)

431 
’d


432 
’d


434 
funùiÚ
 
dev
:
	$addMac
(
mac
)

435 
loÿl
 
rc
 = 
dpdkc
.
	`¹e_‘h_dev_mac_addr_add
(
£lf
.
id
, 
	`·r£MacAdd»ss
(
mac
), 0)

436 
rc
 ~ğ0 
th’


437 
log
:
	`çl
("could‚Ù‡dd mac: %d", 
rc
)

438 
’d


439 
’d


441 
funùiÚ
 
dev
:
	$»moveMac
(
mac
)

442 
loÿl
 
rc
 = 
dpdkc
.
	`¹e_‘h_dev_mac_addr_»move
(
£lf
.
id
, 
	$·r£MacAdd»ss
(
mac
))

443 
rc
 ~ğ0 
th’


444 
log
:
	`çl
("could‚Ù„emovmac: %d", 
rc
)

445 
’d


446 
’d


448 
funùiÚ
 
dev
:
	$g‘Info
()

449 
loÿl
 
šfo
 = 
ffi
.
	`Ãw
("struct„te_eth_dev_info")

450 
dpdkc
.
	$¹e_‘h_dev_šfo_g‘
(
£lf
.
id
, 
šfo
)

451  
šfo


452 
’d


454 
funùiÚ
 
dev
:
	$g‘PciId
()

455  
dpdkc
.
	$dpdk_g‘_pci_id
(
£lf
.
id
)

456 
’d


458 
funùiÚ
 
dev
:
	$g‘Sock‘
()

459  
dpdkc
.
	$dpdk_g‘_sock‘
(
£lf
.
id
)

460 
’d


462 
funùiÚ
 
dev
:
	$g‘Name
()

463  
pciIds
.
	`g‘Name
(
£lf
:
	$g‘PciId
())

464 
’d


466 
funùiÚ
 
dev
:
	$g‘Driv”Name
()

467  
ffi
.
	`¡ršg
(
£lf
:
	`g‘Info
().
driv”_Çme
)

468 
’d


471 -- 
some
 
İ”©iÚs
 
¬e
 
unsuµÜ‹d
 
uÆess
 
we
 
have
 
deviû
-
¥ecific
 
magic


473 
funùiÚ
 
dev
:
	$unsuµÜ‹d
(
İ”©iÚ
, 
Ëv–
)

474 
nÙ
 
£lf
.
unsuµÜ‹dW¬nšgsShown
 
Ü
‚Ù s–f.unsuµÜ‹dW¬nšgsShown[
İ”©iÚ
] 
th’


475 
£lf
.
unsuµÜ‹dW¬nšgsShown
 = s–f.unsuµÜ‹dW¬nšgsShowÀ
Ü
 {
	}
}

476 
£lf
.
unsuµÜ‹dW¬nšgsShown
[
İ”©iÚ
] = 
Œue


477 
log
[
Ëv–
 
Ü
 "w¬n"]Öog, "% i nÙ suµÜ‹d byhh¬dw¬Ü driv”", 
	$to¡ršg
(
İ”©iÚ
))

478 
’d


479 
’d


481 --- 
S‘
 
a
 
deviû
-
wide
 
h¬dw¬e
 
¿‹
 
lim™”
.

482 
funùiÚ
 
dev
:
	$£tR©e
()

483 
£lf
:
	`unsuµÜ‹d
("global„ate†imiting")

484 
’d


486 --- 
EÇbË
 
time¡ampšg
 
of
 
»ûived
 
PTP
 
·ck‘s
.

487 --- @
·¿m
 
queue
 
rx
 queu
to
 
	`u£
 (
deviû
-
wide
 
mo¡
 
NICs
)

488 --- @
·¿m
 
udpPÜt
 
udp
 
pÜt
 
to
 
u£
 
PTP
,  = 319. 
Some
 
NICs
 dØ
nÙ
 
suµÜt
 
Ùh”
 
pÜts
.

489 
funùiÚ
 
dev
:
	$’abËRxTime¡amps
(
queue
, 
udpPÜt
)

490 
£lf
:
	`unsuµÜ‹d
("rximestamping", "fatal")

491 
’d


493 --- 
EÇbË
 
time¡ampšg
 
®l
 
»ûived
 
pÜts
, 
time¡amp
 
is
 
¡Üed
 
š
 
a
 
deviû
-
¥ecific
 
way
 iÀ
the
 
rx
 
bufãr
.

494 --- @
·¿m
 
queue
 
rx
 queu
to
 
u£
 .

495 
funùiÚ
 
dev
:
	$’abËRxTime¡ampsAÎPack‘s
(
queue
)

496 
£lf
:
	`unsuµÜ‹d
("timestamping‡ll„x…ackets", "fatal")

497 
’d


499 --- 
EÇbË
 
time¡amps
 
of
 
Œªsm™‹d
 
·ck‘s
, 
oá’
 
lim™ed
 
to
 
PTP
.

500 --- @
·¿m
 
queue
 
tx
 queu
to
 
u£


501 
funùiÚ
 
dev
:
	$’abËTxTime¡amps
(
queue
)

502 
£lf
:
	`unsuµÜ‹d
("tximestamping", "fatal")

503 
’d


505 
funùiÚ
 
dev
:
	$ş—rTime¡amps
()

506 
£lf
:
	$hasRxTime¡amp
(è
th’


507 
£lf
:
	$g‘RxTime¡amp
(
n
, 10)

508 
’d


509 
’d


511 
funùiÚ
 
dev
:
	$g‘TxTime¡amp
(
queue
, 
wa™
)

512 
loÿl
 
ts
 = 
ffi
.
	`Ãw
("structimespec")

513  
	`wa™FÜFunc
(
wa™
, 
	$funùiÚ
()

514 
loÿl
 
»s
 = 
dpdkc
.
	$¹e_‘h_timesync_»ad_tx_time¡amp
(
£lf
.
id
, 
ts
)

515 
»s
 =ğ0 
th’


516  
	`tÚumb”
(
ts
.
tv_£c
è* 10^9 + 
	$tÚumb”
(
ts
.
tv_n£c
)

517 
’d


518 
’d
)

519 
’d


521 
funùiÚ
 
dev
:
	$g‘RxTime¡amp
(
queue
, 
wa™
, 
timesync
)

522 
wa™
 = wa™ 
Ü
 500

523 
loÿl
 
ts
 = 
ffi
.
	`Ãw
("structimespec")

524  
	`wa™FÜFunc
(
wa™
, 
	$funùiÚ
()

525 
loÿl
 
»s
 = 
dpdkc
.
	$¹e_‘h_timesync_»ad_rx_time¡amp
(
£lf
.
id
, 
ts
, 
timesync
 
Ü
 0)

526 
»s
 =ğ0 
th’


527  
	`tÚumb”
(
ts
.
tv_£c
è* 10^9 + 
	$tÚumb”
(
ts
.
tv_n£c
)

528 
’d


529 
’d
)

530 
’d


532 --- 
Checks
 
wh‘h”
 
a
 
RX
 
time¡amp
 
is
 
avaabË
 
Ú
 
the
 
deviû
.

533 
funùiÚ
 
dev
:
	$hasRxTime¡amp
()

534 
£lf
:
	`unsuµÜ‹d
("rximestamping")

535 
’d


537 --- 
R—ds
 
the
 
şock
 
of
h
deviû


538 
funùiÚ
 
dev
:
	$»adTime
()

539 
loÿl
 
ts
 = 
ffi
.
	`Ãw
("structimespec")

540 
loÿl
 
»s
 = 
dpdkc
.
	$¹e_‘h_timesync_»ad_time
(
£lf
.
id
, 
ts
)

541 
	`checkDpdkE¼Ü
(
»s
, "reading deviceime")

542  
	`tÚumb”
(
ts
.
tv_£c
è* 10^9 + 
	$tÚumb”
(
ts
.
tv_n£c
)

543 
’d


545 
funùiÚ
 
dev
:
	$f‹rL2Time¡amps
(
queue
)

546 
loÿl
 
qid
 = 
	`ty³
(
queue
è=ğ"numb”" 
ªd
 queu
Ü
 queue.qid

547 
qid
 =ğ0 
th’


549 
’d


550 
£lf
:
	$l2F‹r
(
‘h
.
TYPE_PTP
, 
queue
)

551 
’d


553 --- @
d•»ÿ‹d


554 
funùiÚ
 
dev
:
	$f‹rTime¡amps
(
queue
)

555 
log
:
	`w¬n
("device:filterTimestamps(q) is deprecated‡nd will be„emoved. Use queue:filterUdpTimestamps() instead. Or useheimestamper class which handleshis for you.")

556 
queue
:
	$f‹rUdpTime¡amps
()

557 
’d


559 --- 
Re£ts
 
DPDKs
 
š‹º®
 
Œackšg
 
of
 
deviû
 
cyşe
 
couÁ”s
.

560 
funùiÚ
 
dev
:
	$»£tTimeCouÁ”s
()

561 
£lf
:
	`unsuµÜ‹d
("Time counterracking")

562 
’d


564 
funùiÚ
 
dev
:
	$ş—rRxSts
()

566 
’d


568 
funùiÚ
 
dev
:
	$¡İ
()

569 
£lf
.
š™Ÿlized
 = 
çl£


570 
£lf
:
	$¡Üe
()

571 
dpdkc
.
	$¹e_‘h_dev_¡İ
(
£lf
.
id
)

572 
’d


574 --- 
EÇbË
 
tx
 
time¡amps
.

575 --- @
£e
 
dev
.
	$’abËTxTime¡amps
()

576 
funùiÚ
 
txQueue
:
	$’abËTime¡amps
()

577 
£lf
.
dev
:
	$’abËTxTime¡amps
(
£lf
)

578 
’d


580 --- 
EÇbË
 
rx
 
time¡amps
.

581 --- @
£e
 
dev
.
	$’abËRxTime¡amps
()

582 
funùiÚ
 
rxQueue
:
	$’abËTime¡amps
(
udpPÜt
)

583 
£lf
.
dev
:
	$’abËRxTime¡amps
(
£lf
, 
udpPÜt
)

584 
’d


586 --- 
EÇbË
 
®l
 
rx
 
time¡amps
.

587 --- @
£e
 
dev
.
	$’abËRxTime¡ampsAÎPack‘s
()

588 
funùiÚ
 
rxQueue
:
	$’abËTime¡ampsAÎPack‘s
()

589 
£lf
.
dev
:
	$’abËRxTime¡ampsAÎPack‘s
(
£lf
)

590 
’d


592 --- 
R—d
 
a
 
TX
 
time¡amp
 
äom
 
the
 
deviû
.

593 --- 
Time¡amps
 
¬e
 
usu®ly
 
deviû
-
wide
.

594 --- @
·¿m
 
wa™
 
timeout
 
š
 
miüo£cÚds


595 
funùiÚ
 
txQueue
:
	$g‘Time¡amp
(
wa™
)

596  
£lf
.
dev
:
	$g‘TxTime¡amp
(
£lf
, 
wa™
)

597 
’d


599 --- 
R—d
 
a
 
RX
 
time¡amp
 
äom
 
the
 
deviû
.

600 --- 
Time¡amps
 
¬e
 
usu®ly
 
deviû
-
wide
.

601 --- @
·¿m
 
wa™
 
timeout
 
š
 
miüo£cÚds


602 --- @
·¿m
 
timesync
imesynø
ID
 
NICs
 
usšg
 
	`IDs
 (
i40e
).

603 
funùiÚ
 
rxQueue
:
	$g‘Time¡amp
(
wa™
, 
timesync
)

604  
£lf
.
dev
:
	$g‘RxTime¡amp
(
£lf
, 
wa™
, 
timesync
)

605 
’d


607 --- 
CÚfigu»
 
a
 
æex
 
by‹
 
f‹r
 
to
 
£nd
 
UDP
 
time¡amp
 
·ck‘s
Ø
this
 
pÜt
.

608 --- 
This
 
f‹r
 
m©ches
 
Ú
 
the
 
PTP
 
id’tif›r
 
ªd
 
v”siÚ
 
by‹s
 
š
h
·ylßd
.

609 --- 
OÆy
 
wÜks
 
the
 
æex
 
by‹
 
£‰šgs
 
fdœ
 
¬e
 
	`cÜ»ù
 ( settings).

610 --- 
You
 
ÿn
 
®so
 
u£
 
a
 
»guÏr
 5 
tu¶e
 
f‹r
 
Ú
 
the
 
UDP
 
pÜt
 
this
 
is
 
suffic›Á
 
your
 
u£ÿ£
.

611 --- 
CautiÚ
: 
brok’
 
Ú
 
i40e
, 
£e
 i40e-
driv”
 
docs
 
ªd
 
time¡am³r
 
a
 
wÜk
-
¬ound
.

612 
funùiÚ
 
rxQueue
:
	$f‹rUdpTime¡amps
()

613  
£lf
.
dev
:
	$f‹rUdpTime¡amps
(
£lf
)

614 
’d


616 --- 
CÚfigu»
 
ª
 
EthTy³
 
f‹r
 
to
 
m©ch
 
PTP
 
·ck‘s
.

617 
funùiÚ
 
rxQueue
:
	$f‹rL2Time¡amps
()

618  
£lf
.
dev
:
	$f‹rL2Time¡amps
(
£lf
)

619 
’d


621 
funùiÚ
 
mod
.
	$g‘Deviûs
()

622 
loÿl
 
»suÉ
 = {
	}
}

623 
i
 = 0, 
	gdpdkc
.
¹e_‘h_dev_couÁ
() - 1 do

624 
loÿl
 
	gdev
 = 
mod
.
	$g‘
(
i
)

625 
»suÉ
[#»suÉ + 1] = { 
id
 = 
i
, 
mac
 = 
dev
:
	`g‘MacSŒšg
(i), 
Çme
 = dev:
	`g‘Name
(iè
	}
}

626 
’d


627  
»suÉ


628 
’d


633 
ffi
.
cdef
[[

635 
	s¹e_‘h_x¡©
 {

636 
ušt64_t
 
id
;

637 
ušt64_t
 
v®ue
;

641 
	s¹e_‘h_x¡©_Çme
 {

642 
Çme
[64];

645 
¹e_‘h_x¡©s_g‘_Çmes
(
ušt8_t
 
pÜt_id
, 
¹e_‘h_x¡©_Çme
* 
Çmes
, 
ušt32_t
 
size
);

646 
¹e_‘h_x¡©s_g‘
(
ušt8_t
 
pÜt_id
, 
¹e_‘h_x¡©
 * 
x¡©s
, 
n
);

647 
¹e_‘h_x¡©s_g‘_id_by_Çme
(
ušt8_t
 
pÜt_id
, cÚ¡ * 
x¡©_Çme
, 
ušt64_t
 * 
id
);

648 
¹e_‘h_x¡©s_g‘_by_id
(
ušt8_t
 
pÜt_id
, cÚ¡ 
ušt64_t
 * 
ids
, ušt64_ˆ* 
v®ues
, 
n
);

652 
loÿl
 
‘hStsTy³


654 
loÿl
 
funùiÚ
 
	$budEthStsSŒuù
(
n
)

655  
ffi
.
	`ty³of
(([[

657 
ušt64_t
 
ack‘s
;

658 
ušt64_t
 
İack‘s
;

659 
ušt64_t
 
iby‹s
;

660 
ušt64_t
 
oby‹s
;

661 
ušt64_t
 
imis£d
;

662 
ušt64_t
 
›¼Üs
;

663 
ušt64_t
 
Û¼Üs
;

664 
ušt64_t
 
rx_nombuf
;

665 
ušt64_t
 
q_ack‘s
[%
d
];

666 
ušt64_t
 
q_İack‘s
[%
d
];

667 
ušt64_t
 
q_iby‹s
[%
d
];

668 
ušt64_t
 
q_oby‹s
[%
d
];

669 
ušt64_t
 
q_”rÜs
[%
d
];

671 ]]):
	$fÜm©
(
n
,‚,‚,‚,‚))

672 
’d


674 --- 
G‘
 
‘h”Ãt
 
¡©i¡ics
.

675 --- 
W¬nšg
: 
the
 
exaù
 
m—nšg
 
of
h
»suÉs
 
may
 
v¬y
 
b‘w“n
 
NICs
, 
e¥ecŸÎy
 
wh’
 
·ck‘s
 
¬e
 
drİ³d
 
due
 
to
 
fuÎ
 
rx
 
queues
.

676 --- 
Also
, 
they
 
may
 
som‘imes
 
be
 
ş—r
-
Ú
-
»ad
 
ªd
 som‘ime 
ruÂšg
 
tÙ®s
; 
¡©s
 
¬e
 
ju¡
 
wdly
 
šcÚsi¡’t
 
š
 
DPDK
.

677 --- 
In
 
of
 
ş—r
-
Ú
-
»ad
 
couÁ”s
, 
th”e
 
wl
 
be
 
š‹¿ùiÚs
 
b‘w“n
 
this
 
funùiÚ
 
ªd
 
g‘
[
Rx
|
Tx
]
Sts


678 --- 
CouÁšg
 
·ck‘s
 
©
 
the
 
­¶iÿtiÚ
-
Ëv–
 
might
 
be
 
a
 
good
 
id—
 
you
 
wªt
 
to
 
suµÜt
 
difã»Á
 
NICs
.

679 
funùiÚ
 
dev
:
	$g‘Sts
()

680 
nÙ
 
‘hStsTy³
 
th’


681 
‘hStsTy³
 = 
	`budEthStsSŒuù
(
dpdkc
.
	$dpdk_g‘_¹e_queue_¡©_úŒs_num
())

682 
’d


683 
loÿl
 
¡©s
 = 
	$‘hStsTy³
()

684 
dpdkc
.
	$¹e_‘h_¡©s_g‘
(
£lf
.
id
, 
¡©s
)

685  
¡©s


686 
’d


689 
loÿl
 
¡©s


690 --- 
G‘
 
the
 
tÙ®
 
numb”
 
of
 
·ck‘s
 
ªd
 
by‹s
 
Œªsm™‹d
 
sucûssfuÎy
.

691 --- 
This
 
dÛs
 
nÙ
 
šşude
 
·ck‘s
 
th©
 
w”e
 
queued
 
but
‚Ù 
y‘
 
£Á
 
by
 
the
 
NIC
.

692 --- 
This
 
couÁ”
 
should
 
šşude
 
the
 
CRC
 
checksum
, 
but
 
driv”s
 
¬e
 
šcÚsi¡’t
 
h”e
.

693 --- 
libmoÚ
 
Œ›s
 
to
 
cÜ»ù
 
this
 
šcÚsi¡’cy
, 
cu¼’y
 
‹¡ed
 
w™h
 
ixgbe
, 
i40e
 
ªd
 
igb
 
NICs
.

694 --- @ 
·ck‘s
, 
by‹s


695 
funùiÚ
 
dev
:
	$g‘TxSts
()

696 
nÙ
 
‘hStsTy³
 
th’


697 
‘hStsTy³
 = 
	`budEthStsSŒuù
(
dpdkc
.
	$dpdk_g‘_¹e_queue_¡©_úŒs_num
())

698 
’d


699 
nÙ
 
¡©s
 
th’


700 
¡©s
 = 
	$‘hStsTy³
()

701 
’d


702 
dpdkc
.
	`¹e_‘h_¡©s_g‘
(
£lf
.
id
, 
¡©s
)

703 -- 
š
 
you
 
¬e
 
wÚd”šg
: 
the
 
´ecisiÚ
 
of
 
a
 
¡¬ts
h
become
‡ 
mšÜ
 
´obËm
 
aá”
 4.17 
days
 
©
 100 
gb™
/
s


704 -- 
but
 
we
 
ignÜe
 
th©
 
h”e
 
as
 
·ck‘s
 
¬e
 >ğ64 
by‹s


705 
loÿl
 
pkts
 = 
	$tÚumb”
(
¡©s
.
İack‘s
)

706 
loÿl
 
by‹s
 = 
	$tÚumb”
(
¡©s
.
oby‹s
)

707  
pkts
, 
by‹s
 + (
£lf
.
txStsIgnÜeCrc
 
ªd
…kt * 4 
Ü
 0)

708 
’d


710 --- 
G‘
 
the
 
numb”
 
·ck‘s
 
ªd
 
by‹s
 
»ûived
 
©
h
physiÿl
 
Ïy”
 
»g¬dËss
 
wh‘h”
 
they
 
w”e
„eûived 
by
h
driv”
.

711 --- 
The
 
driv”s
 
may
 
be
 
šcÚsi¡’t
 
»g¬dšg
 
couÁšg
 
of
 
·ck‘s
 
drİ³d
 
due
 
to
 
šsuffic›Á
 
bufãr
 
¥aû
...

712 --- 
libmoÚ
 
has
 
cu¡om
 
im¶em’tiÚs
 
this
 
funùiÚ
 
ixgbe
 
ªd
 
i40e
 
th©
 
wÜk
 
cÜ»ùly
.

713 --- 
U£
 
dev
:
	$g‘Sts
(è
to
 
g‘
 
the
 
fuÎ
 
¡©i¡ics
 
expo£d
 
by
 
DPDK
.

714 --- @ 
·ck‘s
, 
by‹s


715 
funùiÚ
 
dev
:
	$g‘RxSts
()

716 
nÙ
 
‘hStsTy³
 
th’


717 
‘hStsTy³
 = 
	`budEthStsSŒuù
(
dpdkc
.
	$dpdk_g‘_¹e_queue_¡©_úŒs_num
())

718 
’d


719 
nÙ
 
¡©s
 
th’


720 
¡©s
 = 
	$‘hStsTy³
()

721 
’d


722 
dpdkc
.
	`¹e_‘h_¡©s_g‘
(
£lf
.
id
, 
¡©s
)

723 -- 
the
 
m—nšg
 
of
h
·ck‘
 
¡©s
 
is
 
com¶‘–y
 
šcÚsi¡’t
 
b‘w“n
 
driv”s


724 -- 
exam¶e
, 
i40e
 
»pÜts
 
some
 
¿ndom
 
v®ue
 
th©
 
cÜ»¥Úds
 
to
 
about
 25% 
of
 
the
 
numb”
 oà
·ck‘s
 
»ûived
...

725 -- 
the
 
by‹s
 
¬e
 
mo¡ly
 
fše
, 
though


726 -- 
th”e
 
¬e
 
cu¡om
 
im¶em’tiÚs
 
i40e
 
ªd
 
ixgbe


727 
loÿl
 
pkts
 = 
	`tÚumb”
(
¡©s
.
ack‘s
 + sts.
imis£d
 + sts.
rx_nombuf
)

728 
loÿl
 
by‹s
 = 
	$tÚumb”
(
¡©s
.
iby‹s
)

729  
pkts
, 
by‹s
 + (
£lf
.
rxStsIgnÜeCrc
 
ªd
…kt * 4 
Ü
 0)

730 
’d


731 
’d


734 --- 
S‘
 
the
 
tx
 
¿‹
 
of
 
a
 
queue
 
š
 
Mb™
/
s
.

735 --- 
This
 
£ts
 
the
 
·ylßd
 
¿‹
, 
nÙ
 
to
h
aùu®
 
wœe
„©e, 
i
.
e
. 
´—mbË
, 
SFD
, 
ªd
 
IFG
 
¬e
 
ignÜed
.

736 
funùiÚ
 
txQueue
:
	$£tR©e
(
¿‹
)

737 
loÿl
 
rc
 = 
dpdkc
.
	$¹e_‘h_£t_queue_¿‹_lim™
(
£lf
.
id
, s–f.
qid
, 
¿‹
)

738 
rc
 =ğ-
E
.
NOTSUP
 
th’


739 -- 
çs
 
došg
 
this
 
äom
 
muÉË
 
th»ads


740 -- 
but
 
th©
's okay sincehis is just‡ crude work-around‡ndhe‡pp should be updated forhe NIC

741 
loÿl
 
dev
 = 
£lf
.dev

742 
dev
.
tÙ®R©e
 = dev.tÙ®R©
Ü
 0

743 
dev
.
tÙ®R©e
 = dev.tÙ®R©+ 
¿‹


744 
log
:
	`w¬n
("P”-queu¿‹†im™ i nÙ suµÜ‹d oÀthi deviû, s‘tšg…”-deviû„©lim™Ø%d Mb™/ š¡—d (nÙe:hi may fa‡ w–ÈiàthNIC dÛ¢'ˆsuµÜˆªy„©lim™šg).", 
dev
.
tÙ®R©e
)

745 
dev
:
	$£tR©e
(
dev
.
tÙ®R©e
)

746 
–£if
 
rc
 ~ğ0 
th’


747 
log
:
	`w¬n
("FaedØ£ˆ¿‹†im™” oÀqueu%s: %s", 
£lf
, 
	$¡rE¼Ü
(
rc
))

748 
’d


749 
’d


751 
funùiÚ
 
txQueue
:
	$£tR©eMµs
(
¿‹
, 
pktSize
)

752 
pktSize
 =…ktSiz
Ü
 60

753 
£lf
:
	`£tR©e
(
¿‹
 * (
pktSize
 + 4) * 8)

754 
’d


757 
funùiÚ
 
txQueue
:
	$£nd
(
bufs
)

758 
£lf
.
u£d
 = 
Œue


759 
dpdkc
.
	$dpdk_£nd_®l_·ck‘s
(
£lf
.
id
, s–f.
qid
, 
bufs
.
¬¿y
, bufs.
size
)

760  
bufs
.
size


761 
’d


763 
funùiÚ
 
txQueue
:
	$£ndSšgË
(
buf
)

764 
£lf
.
u£d
 = 
Œue


765 
dpdkc
.
	$dpdk_£nd_sšgË_·ck‘
(
£lf
.
id
, s–f.
qid
, 
buf
)

767 
’d


769 -- 
Try
 
to
 
Œªsm™
 
a
 
sšgË
 
·ck‘
.

770 -- 
R‘uºs
 1 
£Á
, 0 
nÙ


771 
funùiÚ
 
txQueue
:
	$ŒyS’dSšgË
(
buf
)

772 
£lf
.
u£d
 = 
Œue


773  
dpdkc
.
	$dpdk_Œy_£nd_sšgË_·ck‘
(
£lf
.
id
, s–f.
qid
, 
buf
)

774 
’d


776 
funùiÚ
 
txQueue
:
	$£ndN
(
bufs
, 
n
)

777 
£lf
.
u£d
 = 
Œue


778 
dpdkc
.
	$dpdk_£nd_®l_·ck‘s
(
£lf
.
id
, s–f.
qid
, 
bufs
.
¬¿y
, 
n
)

779  
n


780 
’d


782 --- 
Try
 
to
 
Œªsm™
 
bufãrs
 
Ú
 
a
 
queue
.

783 --- 
R‘uºs
 
the
 
numb”
 
of
 
·ck‘s
 
aùu®ly
 
£Á
 
out
.

784 --- @
·¿m
 
¡¬tIndex
 0-
ba£d
 
off£t
 
š
 
the
 
bufãr
,  = 0 (
u£
 
Ï¡
  
v®ue
 
h”e
)

785 --- @
·¿m
 
numPkts
 
max
 
numb”
 
of
 
·ck‘s
, 
deçuÉs
 
to
 
bufs
.
size
 - 
¡¬tIndex


786 
funùiÚ
 
txQueue
:
	$ŒyS’d
(
bufs
, 
¡¬tIndex
, 
numPkts
)

787 
¡¬tIndex
 = s¹Index 
Ü
 0

788 
numPkts
 =‚umPkt 
Ü
 
bufs
.
size
 - 
¡¬tIndex


789  
dpdkc
.
	`¹e_‘h_tx_bur¡_expÜt
(
£lf
.
id
, s–f.
qid
, 
bufs
.
¬¿y
 + 
¡¬tIndex
, 
numPkts
)

790 
’d


792 
funùiÚ
 
txQueue
:
	$¡¬t
()

793 
	`as£¹
(
dpdkc
.
	`¹e_‘h_dev_tx_queue_¡¬t
(
£lf
.
id
, s–f.
qid
) == 0)

794 
’d


796 
funùiÚ
 
txQueue
:
	$¡İ
()

797 
	`as£¹
(
dpdkc
.
	`¹e_‘h_dev_tx_queue_¡İ
(
£lf
.
id
, s–f.
qid
) == 0)

798 
’d


800 --- 
Re¡¬ts
 
®l
 
tx
 
queues
 
th©
 
w”e
 
aùiv–y
 
u£d
 
by
 
this
 
sk
.

801 --- 'Aùiv–y u£d' 
m—ns
 
th©
 :
	$£nd
(è
was
 
ÿÎed
 
äom
 
the
 
cu¼’t
 
sk
.

802 
funùiÚ
 
mod
.
	$»şaimTxBufãrs
()

803 
loÿl
 
Şd
 = 
LIBMOON_IGNORE_BAD_NUMA_MAPPING


804 
LIBMOON_IGNORE_BAD_NUMA_MAPPING
 = 
Œue


805 
deviûs
:
	`fÜEach
(
	$funùiÚ
(
_
, 
dev
)

806 
_
, 
queue
 
š
 
	$·œs
(
dev
.
txQueues
) do

807 
queue
.
u£d
 
th’


808 
queue
:
	$¡İ
()

809 
queue
:
	$¡¬t
()

810 
’d


811 
’d


812 
’d
)

813 
LIBMOON_IGNORE_BAD_NUMA_MAPPING
 = 
Şd


814 
’d


816 -- 
ş—nup
 
deviûs
 
Ãûs§ry


817 
funùiÚ
 
mod
.
	$ş—nupDeviûs
()

818 
loÿl
 
Şd
 = 
LIBMOON_IGNORE_BAD_NUMA_MAPPING


819 
LIBMOON_IGNORE_BAD_NUMA_MAPPING
 = 
Œue


820 
deviûs
:
	`fÜEach
(
	`funùiÚ
(
_
, 
dev
)

821 -- 
Úly
 
ÿÎ
 
¡İ
 
the
 
driv”
 
»quœes
 
™


822 -- 
Ùh”wi£
 
™
 
wl
 
¦ow
 
down
 
the
 
´og¿m
 
‹rmš©iÚ


823 -- 
as
 
a
 
ãw
 
driv”s
/
NICs
 
»quœe
 
some
 
time
 
to
 
¡İ
 
the
 
	`devs
 (
e
.
g
. 
ixgbe
/
x540
 
kes
 
about
‡ 
£cÚd
)

824 
dev
.
š™Ÿlized
 
ªd
 dev.
driv”Info
.
¡İOnShutdown
 
th’


825 
dev
:
	$¡İ
()

826 
’d


827 
’d
)

828 
LIBMOON_IGNORE_BAD_NUMA_MAPPING
 = 
Şd


829 
’d


831 --- 
Reûive
 
·ck‘s
 
äom
 
a
 
rx
 
queue
.

832 --- 
R‘uºs
 
as
 
soÚ
‡ 
©
 
Ëa¡
 
Úe
 
·ck‘
 
is
 
avaabË
.

833 
funùiÚ
 
rxQueue
:
	$»cv
(
bufA¼ay
, 
numpkts
)

834 
numpkts
 =‚umpkt 
Ü
 
bufA¼ay
.
size


835 
libmoÚ
.
	$ruÂšg
() do

836 
loÿl
 
rx
 = 
dpdkc
.
	`¹e_‘h_rx_bur¡_expÜt
(
£lf
.
id
, s–f.
qid
, 
bufA¼ay
.
¬¿y
, 
m©h
.
	$mš
(
bufA¼ay
.
size
, 
numpkts
))

837 
rx
 > 0 
th’


838  
rx


839 
’d


840 
’d


842 
’d


844 --- 
Reûive
 
·ck‘s
 
äom
 
a
 
rx
 
queue
 
ªd
 
§ve
 
time¡amps
 
š
 
the
 
ud©a64
 
f›ld
.

845 --- 
R‘uºs
 
as
 
soÚ
‡ 
©
 
Ëa¡
 
Úe
 
·ck‘
 
is
 
avaabË
.

846 
funùiÚ
 
rxQueue
:
	$»cvW™hTime¡amps
(
bufA¼ay
, 
numpkts
)

847 
numpkts
 =‚umpkt 
Ü
 
bufA¼ay
.
size


848  
dpdkc
.
	`dpdk_»ûive_w™h_time¡amps_soáw¬e
(
£lf
.
id
, s–f.
qid
, 
bufA¼ay
.
¬¿y
, 
m©h
.
	$mš
(
bufA¼ay
.
size
, 
numpkts
))

849 
’d


851 
funùiÚ
 
rxQueue
:
	$g‘MacAddr
(
numb”
)

852  
£lf
.
dev
:
	$g‘Mac
(
numb”
)

853 
’d


855 
funùiÚ
 
txQueue
:
	$g‘MacAddr
(
numb”
)

856  
£lf
.
dev
:
	$g‘Mac
(
numb”
)

857 
’d


859 --- 
Reûive
 
·ck‘s
 
äom
 
a
 
rx
 
queue
 
w™h
‡ 
timeout
.

860 
funùiÚ
 
rxQueue
:
	$ŒyRecv
(
bufA¼ay
, 
maxWa™
)

861 
maxWa™
 = maxWa™ 
Ü
 
m©h
.
huge


862 
maxWa™
 >= 0 do

863 
loÿl
 
rx
 = 
dpdkc
.
	$¹e_‘h_rx_bur¡_expÜt
(
£lf
.
id
, s–f.
qid
, 
bufA¼ay
.
¬¿y
, bufA¼ay.
size
)

864 
rx
 > 0 
th’


865  
rx


866 
’d


867 
maxWa™
 = maxWait - 1

868 -- 
dÚ
't sleep…ointlessly

869 
maxWa™
 < 0 
th’


871 
’d


872 
libmoÚ
.
	$¦“pMiüos
(1)

873 
’d


875 
’d


877 --- 
Reûive
 
·ck‘s
 
äom
 
a
 
rx
 
queue
 
w™h
‡ 
timeout
.

878 --- 
DÛs
 
nÙ
 
³rfÜm
 
a
 
busy
 
wa™
, 
this
 
is
‚Ù 
su™abË
 
high
-
throughput
 
­¶iÿtiÚs
.

879 
funùiÚ
 
rxQueue
:
	$ŒyRecvIdË
(
bufA¼ay
, 
maxWa™
)

880 
maxWa™
 = maxWa™ 
Ü
 
m©h
.
huge


881 
maxWa™
 >= 0 do

882 
loÿl
 
rx
 = 
dpdkc
.
	$¹e_‘h_rx_bur¡_expÜt
(
£lf
.
id
, s–f.
qid
, 
bufA¼ay
.
¬¿y
, bufA¼ay.
size
)

883 
rx
 > 0 
th’


884  
rx


885 
’d


886 
maxWa™
 = maxWait - 10

887 -- 
dÚ
't sleep…ointlessly

888 
maxWa™
 < 0 
th’


890 
’d


891 
libmoÚ
.
	$¦“pMiüosIdË
(10)

892 
’d


894 
’d


896 -- 
expÜt
 
´ÙÙy³s
 
to
 
ex‹nd
 
them
 
š
 
Ùh”
 
moduËs


897 
mod
.
__deviûPrÙÙy³
 = 
dev


898 
mod
.
__txQueuePrÙÙy³
 = 
txQueue


899 
mod
.
__rxQueuePrÙÙy³
 = 
rxQueue


901  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/distribute.lua

2 --- @
fe
 
	gdi¡ribu‹
.
	glua


3 --- @
br›f
 
	gDi¡ribu‹
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

8 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

9 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

10 
loÿl
 
log
 = 
»quœe
 "log"

12 
ffi
.
cdef
 [[

13 
	smg_di¡ribu‹_queue
{

14 
ušt16_t
 
Ãxt_idx
;

15 
ušt16_t
 
size
;

16 
¹e_mbuf
 *
pkts
[0];

19 
	smg_di¡ribu‹_ouut
{

20 
ušt8_t
 
	mv®id
;

21 
ušt8_t
 
	mpÜt_id
;

22 
ušt16_t
 
	mqueue_id
;

23 
ušt64_t
 
	mtimeout
;

24 
ušt64_t
 
	mtime_fœ¡_added
;

25 
mg_di¡ribu‹_queue
 *
	mqueue
;

28 
	smg_di¡ribu‹_cÚfig
{

29 
ušt16_t
 
	m’Œy_off£t
;

30 
ušt16_t
 
	mÄ_ouuts
;

31 
ušt8_t
 
	m®ways_æush
;

32 
mg_di¡ribu‹_ouut
 
	mouuts
[0];

36 
šlše
 
št8_t
 
	$mg_di¡ribu‹_’queue
(

37 
mg_di¡ribu‹_queue
 * 
queue
,

38 
¹e_mbuf
 *
pkt


40 
queue
->
pkts
[queue->
Ãxt_idx
] = 
pkt
;

41 
queue
->
Ãxt_idx
++;

45 if(
	`uÆik–y
(
queue
->
Ãxt_idx
 =ğqueue->
size
)){

48 if(
	`uÆik–y
(
queue
->
Ãxt_idx
 == 1)){

52 
	}
}

54 
mg_di¡ribu‹_cÚfig
 * 
mg_di¡ribu‹_ü—‹
(

55 
ušt16_t
 
’Œy_off£t
,

56 
ušt16_t
 
Ä_ouuts
,

57 
ušt8_t
 
®ways_æush


60 
mg_di¡ribu‹_ouut_æush
(

61 
mg_di¡ribu‹_cÚfig
 *
cfg
,

62 
ušt16_t
 
numb”


65 
mg_di¡ribu‹_»gi¡”_ouut
(

66 
mg_di¡ribu‹_cÚfig
 *
cfg
,

67 
ušt16_t
 
numb”
,

68 
ušt8_t
 
pÜt_id
,

69 
ušt16_t
 
queue_id
,

70 
ušt16_t
 
bur¡_size
,

71 
ušt64_t
 
timeout


74 
mg_di¡ribu‹_£nd
(

75 
mg_di¡ribu‹_cÚfig
 *
cfg
,

76 
¹e_mbuf
 **
pkts
,

77 
mg_b™mask
* 
pkts_mask
,

78 **
’Œ›s


81 
mg_di¡ribu‹_hªdË_timeouts
(

82 
mg_di¡ribu‹_cÚfig
 *
cfg


87 
loÿl
 
	gmod
 = {}

89 
loÿl
 
mg_di¡ribu‹
 = {}

90 
mod
.
mg_di¡ribu‹
 = mg_distribute

91 
mg_di¡ribu‹
.
__šdex
 = mg_distribute

94 
funùiÚ
 
mod
.
	$ü—‹Di¡ributÜ
(
sock‘
, 
’ŒyOff£t
, 
ÄOuuts
, 
®waysFlush
)

95 
sock‘
 = sock‘ 
Ü
 
	`£Ëù
(2, 
dpdk
.
	$g‘CÜe
())

96 
’ŒyOff£t
 =ƒÁryOff£ˆ
Ü
 0

97 
®waysFlush
 
th’


98 
®waysFlush
 = 1

100 
®waysFlush
 = 0

101 
’d


103  
	`£tm‘©abË
({

104 
cfg
 = 
ffi
.
	`gc
(ffi.
C
.
	`mg_di¡ribu‹_ü—‹
(
’ŒyOff£t
, 
ÄOuuts
, 
®waysFlush
), 
	`funùiÚ
(
£lf
)

105 
log
:
	`debug
("lpm garbage")

106 
ffi
.
C
.
	`mg_NOT_YET_IMPLEMENTED
(
£lf
è-- 
FIXME


107 
’d
),

108 
sock‘
 = socket

109 
	}
}, 
	gmg_di¡ribu‹
)

110 
’d


113 
funùiÚ
 
	gmg_di¡ribu‹
:
	$__£rŸlize
()

114  "»quœ'di¡ribu‹';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('di¡ribu‹').mg_di¡ribu‹"), 
Œue


115 
’d


117 
funùiÚ
 
mg_di¡ribu‹
:
	$£nd
(
·ck‘s
, 
b™Mask
, 
routšgEÁr›s
)

118  
ffi
.
C
.
	`mg_di¡ribu‹_£nd
(
£lf
.
cfg
, 
·ck‘s
.
¬¿y
, 
b™Mask
.
b™mask
, ffi.
	`ÿ¡
("void **", 
routšgEÁr›s
.array))

119 
’d


121 
funùiÚ
 
mg_di¡ribu‹
:
	`»gi¡”Ouut
(
ouutNumb”
, 
txQueue
, 
bufãrSize
, 
timeout
)

122 -- 
FIXME
: 
is
 
this
 
a
 
good
 
id—
, 
to
 
u£
 
ušt64_t
 
b™
 
š‹g”s
 
š
 
lua
??

123 
loÿl
 
f_ıu
 = 
dpdk
.
	$g‘CyşesF»qu’cy
()

124 
loÿl
 
cyşes_timeout
 = 
	$tÚumb”
(
f_ıu
 * 
timeout
)

126 
loÿl
 
pÜtID
 = 
txQueue
.
id


127 
loÿl
 
queueID
 = 
txQueue
.
qid


129 
log
:
	`šfo
("»gi¡” ouuˆNR " .. 
	`to¡ršg
(
ouutNumb”
è.. " ->…Üˆğ" ..o¡ršg(
pÜtID
è.. " queuğ" ..o¡ršg(
queueID
è.. "imeouˆğ" .. 
	$to¡ršg
(
cyşes_timeout
))

130 
ffi
.
C
.
	$mg_di¡ribu‹_»gi¡”_ouut
(
£lf
.
cfg
, 
ouutNumb”
, 
pÜtID
, 
queueID
, 
bufãrSize
, 
cyşes_timeout
)

131 
’d


133 
funùiÚ
 
mg_di¡ribu‹
:
	$hªdËTimeouts
()

134 
ffi
.
C
.
	$mg_di¡ribu‹_hªdË_timeouts
(
£lf
.
cfg
)

136 
’d


138  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/dpdk.lua

2 --- @
fe
 
	gdpdk
.
	glua


3 --- @
br›f
 
	gDPDK
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 --- 
	ghigh
-
Ëv–
 
dpdk
 
w¿µ”


8 
loÿl
 
	gmod
 = {}

9 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

10 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
loÿl
 
log
 = 
»quœe
 "log"

14 -- 
DPDK
 
mbuf
 
æags
 (
lib
/
lib¹e_mbuf
/
¹e_mbuf
.
h
)

15 
mod
.
PKT_RX_VLAN_PKT
 = 
b™
.
	$lshiá
(1ULL, 0)

16 
mod
.
PKT_RX_RSS_HASH
 = 
b™
.
	$lshiá
(1ULL, 1)

17 
mod
.
PKT_RX_FDIR
 = 
b™
.
	$lshiá
(1ULL, 2)

18 
mod
.
PKT_RX_L4_CKSUM_BAD
 = 
b™
.
	$lshiá
(1ULL, 3)

19 
mod
.
PKT_RX_IP_CKSUM_BAD
 = 
b™
.
	$lshiá
(1ULL, 4)

20 
mod
.
PKT_RX_EIP_CKSUM_BAD
 = 
b™
.
	$lshiá
(0ULL, 0)

21 
mod
.
PKT_RX_OVERSIZE
 = 
b™
.
	$lshiá
(0ULL, 0)

22 
mod
.
PKT_RX_HBUF_OVERFLOW
 = 
b™
.
	$lshiá
(0ULL, 0)

23 
mod
.
PKT_RX_RECIP_ERR
 = 
b™
.
	$lshiá
(0ULL, 0)

24 
mod
.
PKT_RX_MAC_ERR
 = 
b™
.
	$lshiá
(0ULL, 0)

25 
mod
.
PKT_RX_IPV4_HDR
 = 
b™
.
	$lshiá
(1ULL, 5)

26 
mod
.
PKT_RX_IPV4_HDR_EXT
 = 
b™
.
	$lshiá
(1ULL, 6)

27 
mod
.
PKT_RX_IPV6_HDR
 = 
b™
.
	$lshiá
(1ULL, 7)

28 
mod
.
PKT_RX_IPV6_HDR_EXT
 = 
b™
.
	$lshiá
(1ULL, 8)

29 
mod
.
PKT_RX_IEEE1588_PTP
 = 
b™
.
	$lshiá
(1ULL, 9)

30 
mod
.
PKT_RX_IEEE1588_TMST
 = 
b™
.
	$lshiá
(1ULL, 10)

31 
mod
.
PKT_RX_TUNNEL_IPV4_HDR
 = 
b™
.
	$lshiá
(1ULL, 11)

32 
mod
.
PKT_RX_TUNNEL_IPV6_HDR
 = 
b™
.
	$lshiá
(1ULL, 12)

33 
mod
.
PKT_RX_FDIR_ID
 = 
b™
.
	$lshiá
(1ULL, 13)

34 
mod
.
PKT_RX_FDIR_FLX
 = 
b™
.
	$lshiá
(1ULL, 14)

36 
mod
.
PKT_TX_NO_CRC_CSUM
 = 
b™
.
	$lshiá
(1ULL, 48)

37 
mod
.
PKT_TX_QINQ_PKT
 = 
b™
.
	$lshiá
(1ULL, 49)

38 
mod
.
PKT_TX_TCP_SEG
 = 
b™
.
	$lshiá
(1ULL, 50)

39 
mod
.
PKT_TX_IEEE1588_TMST
 = 
b™
.
	$lshiá
(1ULL, 51)

40 
mod
.
PKT_TX_L4_NO_CKSUM
 = 
b™
.
	$lshiá
(0ULL, 52)

41 
mod
.
PKT_TX_TCP_CKSUM
 = 
b™
.
	$lshiá
(1ULL, 52)

42 
mod
.
PKT_TX_SCTP_CKSUM
 = 
b™
.
	$lshiá
(2ULL, 52)

43 
mod
.
PKT_TX_UDP_CKSUM
 = 
b™
.
	$lshiá
(3ULL, 52)

44 
mod
.
PKT_TX_L4_MASK
 = 
b™
.
	$lshiá
(3ULL, 52)

45 
mod
.
PKT_TX_IP_CKSUM
 = 
b™
.
	$lshiá
(1ULL, 54)

46 
mod
.
PKT_TX_IPV4
 = 
b™
.
	$lshiá
(1ULL, 55)

47 
mod
.
PKT_TX_IPV6
 = 
b™
.
	$lshiá
(1ULL, 56)

48 
mod
.
PKT_TX_VLAN_PKT
 = 
b™
.
	$lshiá
(1ULL, 57)

49 
mod
.
PKT_TX_OUTER_IP_CKSUM
 = 
b™
.
	$lshiá
(1ULL, 58)

50 
mod
.
PKT_TX_OUTER_IPV4
 = 
b™
.
	$lshiá
(1ULL, 59)

51 
mod
.
PKT_TX_OUTER_IPV6
 = 
b™
.
	`lshiá
(1ULL, 60)

53 -- 
æow
 
ty³s


54 
mod
.
RTE_ETH_FLOW_UNKNOWN
 = 0

55 
mod
.
RTE_ETH_FLOW_RAW
 = 1

56 
mod
.
RTE_ETH_FLOW_IPV4
 = 2

57 
mod
.
RTE_ETH_FLOW_FRAG_IPV4
 = 3

58 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_TCP
 = 4

59 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_UDP
 = 5

60 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_SCTP
 = 6

61 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_OTHER
 = 7

62 
mod
.
RTE_ETH_FLOW_IPV6
 = 8

63 
mod
.
RTE_ETH_FLOW_FRAG_IPV6
 = 9

64 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_TCP
 = 10

65 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_UDP
 = 11

66 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_SCTP
 = 12

67 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_OTHER
 = 13

68 
mod
.
RTE_ETH_FLOW_L2_PAYLOAD
 = 14

69 
mod
.
RTE_ETH_FLOW_IPV6_EX
 = 15

70 
mod
.
RTE_ETH_FLOW_IPV6_TCP_EX
 = 16

71 
mod
.
RTE_ETH_FLOW_IPV6_UDP_EX
 = 17

72 
mod
.
RTE_ETH_FLOW_MAX
 = 18

74 -- 
RSS
 
æags


75 
mod
.
ETH_RSS_IPV4
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_IPV4
)

76 
mod
.
ETH_RSS_FRAG_IPV4
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_FRAG_IPV4
)

77 
mod
.
ETH_RSS_NONFRAG_IPV4_TCP
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_TCP
)

78 
mod
.
ETH_RSS_NONFRAG_IPV4_UDP
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_UDP
)

79 
mod
.
ETH_RSS_NONFRAG_IPV4_SCTP
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_SCTP
)

80 
mod
.
ETH_RSS_NONFRAG_IPV4_OTHER
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV4_OTHER
)

81 
mod
.
ETH_RSS_IPV6
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_IPV6
)

82 
mod
.
ETH_RSS_FRAG_IPV6
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_FRAG_IPV6
)

83 
mod
.
ETH_RSS_NONFRAG_IPV6_TCP
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_TCP
)

84 
mod
.
ETH_RSS_NONFRAG_IPV6_UDP
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_UDP
)

85 
mod
.
ETH_RSS_NONFRAG_IPV6_SCTP
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_SCTP
)

86 
mod
.
ETH_RSS_NONFRAG_IPV6_OTHER
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_NONFRAG_IPV6_OTHER
)

87 
mod
.
ETH_RSS_L2_PAYLOAD
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_L2_PAYLOAD
)

88 
mod
.
ETH_RSS_IPV6_EX
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_IPV6_EX
)

89 
mod
.
ETH_RSS_IPV6_TCP_EX
 = 
b™
.
	$lshiá
(1ULL, 
mod
.
RTE_ETH_FLOW_IPV6_TCP_EX
)

90 
mod
.
ETH_RSS_IPV6_UDP_EX
 = 
b™
.
	`lshiá
(1ULL, mod.
RTE_ETH_FLOW_IPV6_UDP_EX
)

92 --- 
Do
 
nÙ
 
ÿÎ
 
dpdk
.
	$š™
(è
autom©iÿÎy
 
Ú
 
¡¬tup
.

93 --- 
You
 
mu¡
 
nÙ
 
ÿÎ
 
ªy
 
DPDK
 
funùiÚs
 
´iÜ
 
to
 
švokšg
 
libmoÚ
.
	`š™
().

94 
funùiÚ
 
mod
.
	$skIn™
()

95 
libmoÚ
.
cÚfig
.
skIn™
 = 
Œue


96 
’d


98 --- 
In™Ÿlizes
 
DPDK
. 
C®Ëd
 
autom©iÿÎy
 
Ú
 
¡¬tup
 
uÆess


99 --- 
libmoÚ
.
	$skIn™
(è
is
 
ÿÎed
 
befÜe
 
	`ma¡”
().

100 
funùiÚ
 
mod
.
	$š™
()

101 
loÿl
 
cfgFe
 = 
libmoÚ
.
cÚfig
.
dpdkCÚfig


102 
log
:
	`šfo
("Initializing DPDK. This willake‡ few seconds...")

103 -- 
fšd
 
cÚfig
 
fe


104 
loÿl
 
cfgFeLoÿtiÚs


105 
cfgFe
 
th’


106 
cfgFeLoÿtiÚs
 = { 
cfgFe
 
	}
}

108 
cfgFeLoÿtiÚs
 = {

110 
libmoÚ
.
cÚfig
.
ba£P©h
 .. "/dpdk-conf.lua",

113 
’d


114 
loÿl
 
cfg


115 
_
, 
f
 
š
 
	$aœs
(
cfgFeLoÿtiÚs
) do

116 
	$feExi¡s
(
f
è
th’


117 
loÿl
 
cfgSüt
 = 
	$lßdfe
(
f
)

118 
	`£tãnv
(
cfgSüt
, 
	`£tm‘©abË
({ 
DPDKCÚfig
 = 
	`funùiÚ
(
¬g
è
cfg
 =‡rg 
’d
 
	}
}, { 
	g__šdex
 = 
_G
 }))

119 
loÿl
 
	gok
, 
	g”r
 = 
	$pÿÎ
(
cfgSüt
)

120 
nÙ
 
ok
 
th’


121 
log
:
	`”rÜ
("Could‚Ù†ßd DPDK cÚfig: " .. 
”r
)

122  
çl£


123 
’d


124 
nÙ
 
cfg
 
th’


125 
log
:
	`”rÜ
("Config file does‚ot contain DPDKConfig statement")

126  
çl£


127 
’d


128 
cfg
.
Çme
 = 
f


130 
’d


131 
’d


132 
nÙ
 
cfg
 
th’


133 
log
:
	`w¬n
("No DPDK config found, using defaults")

134 
cfg
 = {
	}
}

135 
’d


136 -- 
lßd
 
cÚfig


137 
loÿl
 
cÜeMask


138 
nÙ
 
cfg
.
cÜes
 
th’


139 -- : 
u£
 
®l
 
the
 
cÜes


140 
loÿl
 
ıus
 = 
io
.
İ’
("/proc/cpuinfo", "r")

141 
	gcfg
.
	gcÜes
 = {}

142 
ıu
 
š
 
ıus
:
»ad
("*a"):
gm©ch
("processor : (%d+)") do

143 
cfg
.
cÜes
[#cfg.cÜe + 1] = 
	$tÚumb”
(
ıu
)

144 
’d


145 
ıus
:
	$şo£
()

146 
’d


147 
bË
.
	$sÜt
(
cfg
.
cÜes
)

148 
libmoÚ
.
cÚfig
.
cÜes
 = 
cfg
.cores

149 
libmoÚ
.
cÚfig
.
numSh¬edCÜes
 = 
cfg
.
sh¬edCÜes
 
Ü
 8

150 
loÿl
 
cÜeMask
 = 0ULL

151 
i
, 
v
 
š
 
	$aœs
(
cfg
.
cÜes
) do

152 
cÜeMask
 = 
b™
.
	`bÜ
(cÜeMask, b™.
	$lshiá
(1ULL, 
v
))

153 
’d


154 
loÿl
 
¬gv
 = { "libmoÚ" 
	}
}

155 
loÿl
 
cÜeMaskUµ”
 = 
tÚumb”
(
b™
.
	$rshiá
(
cÜeMask
, 32ULL))

156 
loÿl
 
cÜeMaskLow”
 = 
	`tÚumb”
(
b™
.
	$bªd
(
cÜeMask
, 0xFFFFFFFFULL))

157 
¬gv
[#¬gv + 1] = ("-c0x%08X%08X"):
	`fÜm©
(
cÜeMaskUµ”
, 
cÜeMaskLow”
)

158 -- 
cÜe
 
m­pšg
, 
sh¬ed
 
cÜes
 
u£
 
the
 
highe¡
 
IDs


159 #cfg.
cÜes
 + 
libmoÚ
.
cÚfig
.
numSh¬edCÜes
 >ğ128 
th’


160 -- --
lcÜes
 
is
 
»¡riùed
 
to
 0-127 
š
 
DPDK
; 
this
 i 
a
 
´obËm
 
Ú
 
Ïrge
 
CPUs


161 
i
 = #cfg.
cÜes
, 
m©h
.
	`max
(1, #cfg.cÜe - 
libmoÚ
.
cÚfig
.
numSh¬edCÜes
 + 1), -1 do

162 
cfg
.
cÜes
[
i
] = 
n


163 
’d


164 
libmoÚ
.
cÚfig
.
cÜes
 = 
cfg
.cores

165 
’d


166 
loÿl
 
maxCÜe
 = 
cfg
.
cÜes
[#cfg.cores]

167 
loÿl
 
cÜeM­pšg
 = ("%d-%d,(%d-%d)@%d"):
	`fÜm©
(
cfg
.
cÜes
[1], 
maxCÜe
, maxCÜ+ 1, maxCÜ+ 
libmoÚ
.
cÚfig
.
numSh¬edCÜes
, cfg.cores[1])

168 
¬gv
[#¬gv + 1] = ("--lcÜes=%s"):
	$fÜm©
(
cÜeM­pšg
)

170 
cfg
.
pciBÏckli¡
 
th’


171 
	`ty³
(
cfg
.
pciBÏckli¡
è=ğ"bË" 
th’


172 
i
, 
v
 
š
 
	$aœs
(
cfg
.
pciBÏckli¡
) do

173 
¬gv
[#¬gv + 1] = "-b" .. 
v


174 
’d


176 
log
:
	`w¬n
("Need‡†ist forhe PCI black†ist")

177 
’d


178 
’d


180 
cfg
.
pciWh™–i¡
 
th’


181 
	`ty³
(
cfg
.
pciWh™–i¡
è=ğ"bË" 
th’


182 
i
, 
v
 
š
 
	$aœs
(
cfg
.
pciWh™–i¡
) do

183 
¬gv
[#¬gv + 1] = "-w" .. 
v


184 
’d


186 
log
:
	`w¬n
("Need‡†ist forhe PCI white†ist")

187 
’d


188 
’d


189 
cfg
.
şi
 
th’


190 
i
, 
v
 
š
 
	$aœs
(
cfg
.
şi
) do

191 
¬gv
[#¬gv + 1] = 
v


192 
’d


193 
’d


194 
loÿl
 
¬gc
 = #argv

195 
dpdkc
.
	`¹e_—l_š™
(
¬gc
, 
ffi
.
	`Ãw
("cÚ¡ ch¬*[?]",‡rgc, 
¬gv
))

196 
loÿl
 
deviû
 = 
»quœe
 "device"

197 
loÿl
 
deviûs
 = 
deviû
.
	$g‘Deviûs
()

198 
log
:
	`šfo
("Found %d usable devices:", #devices)

199 
_
, 
deviû
 
š
 
	$aœs
(
deviûs
) do

200 
	`´štf
(" Deviû %d: % (%s)", 
deviû
.
id
, deviû.
mac
, 
	$g»’
(
deviû
.
Çme
))

201 
’d


202  
Œue


203 
’d


206  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/dpdkc.lua

2 --- @
fe
 
	gdpdkc
.
	glua


3 --- @
br›f
 
	gDPDKc
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 --- 
	glow
-
Ëv–
 
dpdk
 
w¿µ”


8 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

10 -- 
¡ruùs


11 
ffi
.
cdef
[[

13 
	e¹e_lcÜe_¡©e_t
 {

14 
WAIT
, 
RUNNING
, 
FINISHED


21 
	smempoŞ
 {

24 *
MARKER
[0];

25 *
	tMARKER_CACHE_ALIGNED
[0] 
	t__©Œibu‹__
((
	t®igÃd
(64)));

26 
ušt8_t
 
	tMARKER8
[0];

27 
ušt64_t
 
	tMARKER64
[0];

29 
	g¹e_mbuf
;

30 
	u¹e_£c
 {

31 
ušt32_t
 
	md©a
;

41 
	s¹e_mbuf
 {

42 
MARKER
 
	mÿch–še0
;

44 *
	mbuf_addr
;

45 *
	mbuf_phy§ddr
;

48 
MARKER8
 
	m»¬m_d©a
;

49 
ušt16_t
 
	md©a_off
;

50 
ušt16_t
 
	m»fút
;

51 
ušt16_t
 
	mnb_£gs
;

52 
ušt16_t
 
	mpÜt
;

54 
ušt64_t
 
	mŞ_æags
;

56 
MARKER
 
	mrx_desütÜ_f›lds1
;

62 
ušt32_t
 
	m·ck‘_ty³
;

64 
ušt32_t
 
	mpkt_Ën
;

65 
ušt16_t
 
	md©a_Ën
;

66 
ušt16_t
 
	mvÏn_tci
;

69 
ušt32_t
 
	mrss
;

73 
ušt16_t
 
	mhash
;

74 
ušt16_t
 
	mid
;

76 
ušt32_t
 
	mlo
;

79 
ušt32_t
 
	mhi
;

82 } 
	mfdœ
;

84 
ušt32_t
 
	mlo
;

85 
ušt32_t
 
	mhi
;

86 } 
	msched
;

87 
ušt32_t
 
	mu¤
;

88 } 
	mhash
;

89 
ušt16_t
 
	mvÏn_tci_ou‹r
;

90 
ušt16_t
 
	mbuf_Ën
;

91 
ušt64_t
 
	mtime¡amp
;

94 
MARKER_CACHE_ALIGNED
 
	mÿch–še1
;

96 
ušt64_t
 
	mud©a64
;

98 
¹e_mempoŞ
 *
	mpoŞ
;

99 
¹e_mbuf
 *
	mÃxt
;

102 
ušt64_t
 
	mtx_ofæßd
;

106 
ušt16_t
 
	m´iv_size
;

109 
ušt16_t
 
	mtimesync
;

110 
ušt32_t
 
	m£qn
;

114 
	s¹e_‘h_lšk
 {

115 
ušt16_t
 
	mlšk_¥“d
;

116 
ušt16_t
 
	mlšk_du¶ex
;

117 
ušt8_t
 
	mlšk_¡©us
: 1;

118 } 
__©Œibu‹__
((
®igÃd
(8)));

120 
	s¹e_fdœ_f‹r
 {

121 
ušt16_t
 
	mæex_by‹s
;

122 
ušt16_t
 
	mvÏn_id
;

123 
ušt16_t
 
	mpÜt_¤c
;

124 
ušt16_t
 
	mpÜt_d¡
;

126 
ušt32_t
 
	mv4_addr
;

127 
ušt32_t
 
	mv6_addr
[4];

128 } 
	m_¤c
;

130 
ušt32_t
 
	mv4_addr
;

131 
ušt32_t
 
	mv6_addr
[4];

132 } 
	m_d¡
;

133 
	ml4ty³
;

134 
	mty³
;

136 
	e¹e_l4ty³
 {

137 
	mRTE_FDIR_L4TYPE_NONE
 = 0,

138 
	mRTE_FDIR_L4TYPE_UDP
,

139 
	mRTE_FDIR_L4TYPE_TCP
,

140 
	mRTE_FDIR_L4TYPE_SCTP
,

144 
	s¹e_fdœ_masks
 {

145 
ušt8_t
 
	mÚly__æow
;

146 
ušt8_t
 
	mvÏn_id
;

147 
ušt8_t
 
	mvÏn_´io
;

148 
ušt8_t
 
	mæexby‹s
;

149 
ušt8_t
 
	m£t_v6_mask
;

150 
ušt8_t
 
	mcomp_v6_d¡
;

151 
ušt32_t
 
	md¡_v4_mask
;

152 
ušt32_t
 
	m¤c_v4_mask
;

153 
ušt16_t
 
	md¡_v6_mask
;

154 
ušt16_t
 
	m¤c_v6_mask
;

155 
ušt16_t
 
	m¤c_pÜt_mask
;

156 
ušt16_t
 
	md¡_pÜt_mask
;

159 
	s¹e_‘h_desc_lim
 {

160 
ušt16_t
 
	mnb_max
;

161 
ušt16_t
 
	mnb_mš
;

162 
ušt16_t
 
	mnb_®ign
;

163 
ušt16_t
 
	mnb_£g_max
;

164 
ušt16_t
 
	mnb_mtu_£g_max
;

166 
	s¹e_‘h_th»sh
 {

167 
ušt8_t
 
	m±h»sh
;

168 
ušt8_t
 
	mhth»sh
;

169 
ušt8_t
 
	mwth»sh
;

171 
	s¹e_‘h_rxcÚf
 {

172 
¹e_‘h_th»sh
 
	mrx_th»sh
;

173 
ušt16_t
 
	mrx_ä“_th»sh
;

174 
ušt8_t
 
	mrx_drİ_’
;

175 
ušt8_t
 
	mrx_deã¼ed_¡¬t
;

177 
	s¹e_‘h_txcÚf
 {

178 
¹e_‘h_th»sh
 
	mtx_th»sh
;

179 
ušt16_t
 
	mtx_rs_th»sh
;

180 
ušt16_t
 
	mtx_ä“_th»sh
;

181 
ušt32_t
 
	mtxq_æags
;

182 
ušt8_t
 
	mtx_deã¼ed_¡¬t
;

184 
	s¹e_‘h_dev_šfo
 {

185 * 
	mpci_dev
;

186 cÚ¡ * 
	mdriv”_Çme
;

187 
	mif_šdex
;

188 
ušt32_t
 
	mmš_rx_bufsize
;

189 
ušt32_t
 
	mmax_rx_pk’
;

190 
ušt16_t
 
	mmax_rx_queues
;

191 
ušt16_t
 
	mmax_tx_queues
;

192 
ušt32_t
 
	mmax_mac_addrs
;

193 
ušt32_t
 
	mmax_hash_mac_addrs
;

194 
ušt16_t
 
	mmax_vfs
;

195 
ušt16_t
 
	mmax_vmdq_poŞs
;

196 
ušt32_t
 
	mrx_ofæßd_ÿ·
;

197 
ušt32_t
 
	mtx_ofæßd_ÿ·
;

198 
ušt16_t
 
	m»_size
;

199 
ušt8_t
 
	mhash_key_size
;

200 
ušt64_t
 
	mæow_ty³_rss_ofæßds
;

201 
¹e_‘h_rxcÚf
 
	mdeçuÉ_rxcÚf
;

202 
¹e_‘h_txcÚf
 
	mdeçuÉ_txcÚf
;

203 
ušt16_t
 
	mvmdq_queue_ba£
;

204 
ušt16_t
 
	mvmdq_queue_num
;

205 
ušt16_t
 
	mvmdq_poŞ_ba£
;

206 
¹e_‘h_desc_lim
 
	mrx_desc_lim
;

207 
¹e_‘h_desc_lim
 
	mtx_desc_lim
;

208 
ušt32_t
 
	m¥“d_ÿ·
;

209 
ušt16_t
 
	mnb_rx_queues
;

210 
ušt16_t
 
	mnb_tx_queues
;

213 
	slibmoÚ_deviû_cÚfig
 {

214 
ušt32_t
 
	mpÜt
;

215 
mempoŞ
** 
	mmempoŞs
;

216 
ušt16_t
 
	mrx_queues
;

217 
ušt16_t
 
	mtx_queues
;

218 
ušt16_t
 
	mrx_descs
;

219 
ušt16_t
 
	mtx_descs
;

220 
ušt8_t
 
	mdrİ_’abË
;

221 
ušt8_t
 
	m’abË_rss
;

222 
ušt8_t
 
	mdi§bË_ofæßds
;

223 
ušt8_t
 
	m¡r_vÏn
;

224 
ušt32_t
 
	mrss_mask
;

228 -- 
dpdk
 
funùiÚs
 
ªd
 
w¿µ”s


229 
	gffi
.
	gcdef
[[

231 
¹e_—l_š™
(
¬gc
, cÚ¡ * 
¬gv
[]);

234 
¹e_—l_g‘_lcÜe_¡©e
(
cÜe
);

235 
¹e_lcÜe_¡©e_t
 
¹e_—l_g‘_lcÜe_¡©e
(
¦ave_id
);

236 
¹e_—l_wa™_lcÜe
(
cÜe
);

237 
ušt32_t
 
¹e_lcÜe_to_sock‘_id_expÜt
(ušt32_ˆ
lcÜe_id
);

238 
ušt32_t
 
g‘_cu¼’t_cÜe
();

239 
ušt32_t
 
g‘_cu¼’t_sock‘
();

242 
mempoŞ
* 
š™_mem
(
ušt32_t
 
nb_mbuf
, ušt32_ˆ
sock
, ušt32_ˆ
mbuf_size
);

243 
¹e_mbuf
* 
®loc_mbuf
(
mempoŞ
* 
mp
);

244 
®loc_mbufs
(
mempoŞ
* 
mp
, 
¹e_mbuf
* 
bufs
[], 
ušt32_t
 
Ën
, 
ušt16_t
 
pkt_Ën
);

245 
¹e_pktmbuf_ä“_expÜt
(
¹e_mbuf
* 
m
);

246 
ušt16_t
 
¹e_mbuf_»fút_»ad_expÜt
(
¹e_mbuf
* 
m
);

247 
ušt16_t
 
¹e_mbuf_»fút_upd©e_expÜt
(
¹e_mbuf
* 
m
, 
št16_t
 
v®ue
);

250 
¹e_pci_´obe
();

251 
¹e_‘h_dev_couÁ
();

252 
ušt64_t
 
dpdk_g‘_mac_addr
(
pÜt
, * 
buf
);

253 
¹e_‘h_lšk_g‘
(
ušt8_t
 
pÜt
, 
¹e_‘h_lšk
* 
lšk
);

254 
¹e_‘h_lšk_g‘_nowa™
(
ušt8_t
 
pÜt
, 
¹e_‘h_lšk
* 
lšk
);

255 
dpdk_cÚfigu»_deviû
(
libmoÚ_deviû_cÚfig
*);

256 
g‘_mac_addr
(
pÜt
, * 
buf
);

257 
ušt32_t
 
dpdk_g‘_pci_id
(
ušt8_t
 
pÜt
);

258 
ušt32_t
 
»ad_»g32
(
ušt8_t
 
pÜt
, ušt32_ˆ
»g
);

259 
ušt64_t
 
»ad_»g64
(
ušt8_t
 
pÜt
, 
ušt32_t
 
»g
);

260 
wr™e_»g32
(
ušt8_t
 
pÜt
, 
ušt32_t
 
»g
, ušt32_ˆ
v®
);

261 
wr™e_»g64
(
ušt8_t
 
pÜt
, 
ušt32_t
 
»g
, 
ušt64_t
 
v®
);

262 
¹e_‘h_´omiscuous_’abË
(
ušt8_t
 
pÜt
);

263 
¹e_‘h_´omiscuous_di§bË
(
ušt8_t
 
pÜt
);

264 
ušt8_t
 
dpdk_g‘_sock‘
(ušt8_ˆ
pÜt
);

265 * 
dpdk_g‘_‘h_dev
(
pÜt
);

266 * 
dpdk_g‘_i40e_dev
(
pÜt
);

267 
dpdk_g‘_i40e_vsi_£id
(
pÜt
);

268 
ušt8_t
 
dpdk_g‘_pci_funùiÚ
(ušt8_ˆ
pÜt
);

269 
dpdk_g‘_max_pÜts
();

270 
¹e_‘h_dev_mac_addr_add
(
ušt8_t
 
pÜt
, * 
mac
, 
ušt32_t
 
poŞ
);

271 
¹e_‘h_dev_mac_addr_»move
(
ušt8_t
 
pÜt
, * 
mac
);

272 
¹e_‘h_maÿddr_g‘
(
ušt8_t
 
pÜt_id
, 
‘h”_addr
* 
mac_addr
);

273 
¹e_‘h_£t_queue_¿‹_lim™
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
queue_idx
, ušt16_ˆ
tx_¿‹
);

274 
¹e_‘h_dev_šfo_g‘
(
ušt8_t
 
pÜt_id
, 
¹e_‘h_dev_šfo
* 
šfo
);

275 
¹e_‘h_dev_¡İ
(
ušt8_t
 
pÜt_id
);

276 
¹e_‘h_dev_fw_v”siÚ_g‘
(
ušt8_t
 
pÜt_id
, * 
fw_v”siÚ
, 
size_t
 
fw_size
);

279 
ušt16_t
 
¹e_‘h_rx_bur¡_expÜt
(
ušt8_t
 
pÜt_id
, ušt16_ˆ
queue_id
, 
¹e_mbuf
** 
rx_pkts
, ušt16_ˆ
nb_pkts
);

280 
ušt16_t
 
¹e_‘h_tx_bur¡_expÜt
(
ušt8_t
 
pÜt_id
, ušt16_ˆ
queue_id
, 
¹e_mbuf
** 
tx_pkts
, ušt16_ˆ
nb_pkts
);

281 
¹e_‘h_dev_tx_queue_¡¬t
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
rx_queue_id
);

282 
¹e_‘h_dev_tx_queue_¡İ
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
rx_queue_id
);

283 
dpdk_£nd_®l_·ck‘s
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
queue_id
, 
¹e_mbuf
** 
pkts
, ušt16_ˆ
num_pkts
);

284 
dpdk_£nd_sšgË_·ck‘
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
queue_id
, 
¹e_mbuf
* 
pkt
);

285 
ušt16_t
 
dpdk_Œy_£nd_sšgË_·ck‘
(
ušt8_t
 
pÜt_id
, ušt16_ˆ
queue_id
, 
¹e_mbuf
* 
pkt
);

288 
ušt32_t
 
dpdk_g‘_¹e_queue_¡©_úŒs_num
();

289 
¹e_‘h_¡©s_g‘
(
ušt8_t
 
pÜt_id
, * 
¡©s
);

292 
ÿlc_v4_p£udo_h—d”_checksum
(* 
d©a
, 
off£t
);

293 
ÿlc_v4_p£udo_h—d”_checksums
(
¹e_mbuf
** 
pkts
, 
ušt16_t
 
num_pkts
, 
off£t
);

294 
ÿlc_v6_p£udo_h—d”_checksum
(* 
d©a
, 
off£t
);

295 
ÿlc_v6_p£udo_h—d”_checksums
(
¹e_mbuf
** 
pkts
, 
ušt16_t
 
num_pkts
, 
off£t
);

298 
¹e_d–ay_ms_expÜt
(
ušt32_t
 
ms
);

299 
¹e_d–ay_us_expÜt
(
ušt32_t
 
us
);

300 
ušt64_t
 
¹e_rdtsc
();

301 
ušt64_t
 
¹e_g‘_tsc_hz
();

304 
ušt8_t
 
is_ruÂšg
(
ušt32_t
 
exŒa_time
);

305 
£t_ruÁime
(
ušt32_t
 
ms
);

308 
ušt16_t
 
dpdk_»ûive_w™h_time¡amps_soáw¬e
(
ušt8_t
 
pÜt_id
, ušt16_ˆ
queue_id
, 
¹e_mbuf
** 
rx_pkts
, ušt16_ˆ
nb_pkts
);

309 
¹e_‘h_timesync_’abË
(
ušt8_t
 
pÜt_id
);

310 
¹e_‘h_timesync_»ad_tx_time¡amp
(
ušt8_t
 
pÜt_id
, 
time¥ec
* 
time¡amp
);

311 
¹e_‘h_timesync_»ad_rx_time¡amp
(
ušt8_t
 
pÜt_id
, 
time¥ec
* 
time¡amp
, 
ušt32_t
 
timesync
);

312 
¹e_‘h_timesync_»ad_time
(
ušt8_t
 
pÜt_id
, 
time¥ec
* 
time
);

313 
libmoÚ_sync_şocks
(
ušt8_t
 
pÜt1
, ušt8_ˆ
pÜt2
, 
ušt32_t
 
timl
, ušt32_ˆ
timh
, ušt32_ˆ
adjl
, ušt32_ˆ
adjh
);

317 
¹e_‘h_¡©s_g‘
(
ušt8_t
 
pÜt
, 
¹e_‘h_¡©s
* 
¡©s
);

320  
	gffi
.
	gC


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/ena.lua

1 
loÿl
 
	gdev
 = {}

3  
dev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/i40e.lua

1 --- 
	gi40e
-
¥ecific
 
code


2 
loÿl
 
	gdev
 = {}

4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

5 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

8 
ffi
.
cdef
[[

9 
i40e_aq_cÚfig_vsi_bw_lim™
(*
hw
, 
ušt16_t
 
£id
, ušt16_ˆ
üed™
, 
ušt8_t
 
max_bw
, 
i40e_asq_cmd_d‘as
 *
cmd_d‘as
);

12 -- 
¡©i¡ics


13 
loÿl
 
	gGLPRT_UPRCL
 = {}

14 
loÿl
 
GLPRT_MPRCL
 = {}

15 
loÿl
 
GLPRT_BPRCL
 = {}

16 
loÿl
 
GLPRT_GORCL
 = {}

17 
loÿl
 
GLPRT_UPTCL
 = {}

18 
loÿl
 
GLPRT_MPTCL
 = {}

19 
loÿl
 
GLPRT_BPTCL
 = {}

20 
loÿl
 
GLPRT_GOTCL
 = {}

21 
i
 = 0, 3 do

22 
	gGLPRT_UPRCL
[
i
] = 0x003005A0 + 0x8 * i

23 
GLPRT_MPRCL
[
i
] = 0x003005C0 + 0x8 * i

24 
GLPRT_BPRCL
[
i
] = 0x003005E0 + 0x8 * i

25 
GLPRT_GORCL
[
i
] = 0x00300000 + 0x8 * i

26 
GLPRT_UPTCL
[
i
] = 0x003009C0 + 0x8 * i

27 
GLPRT_MPTCL
[
i
] = 0x003009E0 + 0x8 * i

28 
GLPRT_BPTCL
[
i
] = 0x00300A00 + 0x8 * i

29 
GLPRT_GOTCL
[
i
] = 0x00300680 + 0x8 * i

30 
’d


32 -- 
time¡ampšg


33 
loÿl
 
PRTTSYN_CTL1
 = 0x00085020

34 
loÿl
 
PRTTSYN_STAT_1
 = 0x00085140

35 
loÿl
 
PRTTSYN_TIME_L
 = 0x001E4100

36 
loÿl
 
PRTTSYN_TIME_H
 = 0x001E4120

37 
loÿl
 
PRTTSYN_ADJ
 = 0x001E4280

38 
loÿl
 
PRTTSYN_ADJ_DUMMY
 = 0x00083100 -- 
aùu®ly
 
	$GL_FWRESETCNT
 (
RO
)

39 
loÿl
 
PRTTSYN_TXTIME_L
 = 0x001E41C0

40 
loÿl
 
PRTTSYN_TXTIME_H
 = 0x001E41E0

42 
loÿl
 
PRTTSYN_CTL1_TSYNENA
 = 
b™
.
	$lshiá
(1, 31)

43 
loÿl
 
PRTTSYN_CTL1_TSYNTYPE_OFFS
 = 24

44 
loÿl
 
PRTTSYN_CTL1_TSYNTYPE_MASK
 = 
b™
.
	$lshiá
(3, 
PRTTSYN_CTL1_TSYNTYPE_OFFS
)

45 
loÿl
 
PRTTSYN_CTL1_UDP_ENA_OFFS
 = 26

46 
loÿl
 
PRTTSYN_CTL1_UDP_ENA_MASK
 = 
b™
.
	$lshiá
(3, 
PRTTSYN_CTL1_UDP_ENA_OFFS
)

47 
loÿl
 
PRTTSYN_STAT_1_RXT_ALL
 = 0xf

49 
dev
.
suµÜtsFdœ
 = 
Œue


50 
dev
.
u£TimsyncIds
 = 
Œue


51 
dev
.
timeRegi¡”s
 = {
PRTTSYN_TIME_L
, 
PRTTSYN_TIME_H
, 
PRTTSYN_ADJ
, 
PRTTSYN_ADJ_DUMMY
}

52 
dev
.
ücP©ch
 = 
Œue


54 --- 
S‘
 
the
 
maximum
 
¿‹
 
by
 
®l
 
queues
 
š
 
Mb™
/
s
.

55 --- 
OÆy
 
suµÜ‹d
 
Ú
 
XL710
 
NICs
.

56 --- 
NÙe
: 
the£
 
NICs
 
u£
 
·ck‘
 
size
 
exşudšg
 
CRC
 
checksum
 
uÆike
 
the
 
ixgbe
-
¡yË
 NICs.

57 --- 
This
 
m—ns
 
you
 
wl
 
g‘
 
ª
 
uÃx³ùedly
 
high
 
¿‹
.

58 
funùiÚ
 
dev
:
£tR©e
(
¿‹
)

59 -- 
we
 
ÿÂÙ
 
ÿlcuÏ‹
 
the
 "´İ”" 
¿‹
 
h”e
 
as
 wdØ
nÙ
 
know
h
·ck‘
 
size


60 
¿‹
 = 
m©h
.
æoÜ
Ô©/ 50 + 0.5è-- 50
mb™
 
g¿nuÏr™y


61 
loÿl
 
i40eDev
 = 
dpdkc
.
	$dpdk_g‘_i40e_dev
(
£lf
.
id
)

62 
loÿl
 
vsiSeid
 = 
dpdkc
.
	$dpdk_g‘_i40e_vsi_£id
(
£lf
.
id
)

63 
	`as£¹
(
ffi
.
C
.
	`i40e_aq_cÚfig_vsi_bw_lim™
(
i40eDev
, 
vsiSeid
, 
¿‹
, 0, 
n
) == 0)

64 
’d


66 
loÿl
 
funùiÚ
 
	$»adCŒ32
(
id
, 
addr
, 
Ï¡
)

67 
loÿl
 
v®
 = 
dpdkc
.
	$»ad_»g32
(
id
, 
addr
)

68 
loÿl
 
diff
 = 
v®
 - 
Ï¡


69 
diff
 < 0 
th’


70 
diff
 = 2^32 + diff

71 
’d


72  
Ï¡
 + 
diff


73 
’d


75 
loÿl
 
funùiÚ
 
	$»adCŒ48
(
id
, 
addr
, 
Ï¡
)

76 
loÿl
 
add¾
 = 
addr


77 
loÿl
 
addrh
 = 
addr
 + 4

78 -- 
the
 
š‹l
 
driv”
 
dÛ¢
't use‡ memory fence betweenhewo‡ddrh„eads, sohis should be fine

79 
loÿl
 
h
 = 
dpdkc
.
	$»ad_»g32
(
id
, 
addrh
)

80 
loÿl
 
l
 = 
dpdkc
.
	$»ad_»g32
(
id
, 
add¾
)

81 
loÿl
 
h2
 = 
dpdkc
.
	`»ad_»g32
(
id
, 
addrh
è-- 
check
 
ov”æow
 
duršg
 
»ad


82 
h2
 ~ğ
h
 
th’


83 -- 
ov”æow
 
duršg
 
the
 
»ad


84 -- 
we
 
ÿn
 
ju¡
 
»ad
 
the
 
low”
 
v®ue
 
	$agaš
 (1 
ov”æow
 
ev”y
 850
ms
 
max
)

85 
l
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
add¾
)

86 
h
 = 
h2
 -- 
u£
 
the
 
Ãw
 
high
 
v®ue


87 
’d


88 
loÿl
 
v®
 = 
l
 + 
h
 * 2^32 -- 48 
b™s
, 
is
 
fše


89 
loÿl
 
diff
 = 
v®
 - 
Ï¡


90 
diff
 < 0 
th’


91 
diff
 = 2^48 + diff

92 
’d


93  
Ï¡
 + 
diff


94 
’d


96 
funùiÚ
 
dev
:
	$g‘RxSts
()

97 
loÿl
 
pÜt
 = 
dpdkc
.
	`dpdk_g‘_pci_funùiÚ
(
£lf
.
id
)

98 -- 
uniÿ¡
, 
muÉiÿ¡
, 
ªd
 
brßdÿ¡
 
·ck‘s


99 
£lf
.
u´c
 = 
	$»adCŒ32
(
£lf
.
id
, 
GLPRT_UPRCL
[
pÜt
], s–f.
u´c
)

100 
£lf
.
m´c
 = 
	$»adCŒ32
(
£lf
.
id
, 
GLPRT_MPRCL
[
pÜt
], s–f.
m´c
)

101 
£lf
.
b´c
 = 
	`»adCŒ32
(£lf.
id
, 
GLPRT_BPRCL
[
pÜt
], self.bprc)

102 -- 
où‘s


103 
£lf
.
gÜc
 = 
	$»adCŒ48
(
£lf
.
id
, 
GLPRT_GORCL
[
pÜt
], s–f.
gÜc
)

104  
£lf
.
u´c
 + s–f.
m´c
 + s–f.
b´c
 - s–f.
š™Pkts
, s–f.
gÜc
 - s–f.
š™By‹s


105 
’d


107 
dev
.
txStsIgnÜeCrc
 = 
Œue


109 
funùiÚ
 
dev
:
	$š™
()

110 
£lf
.
u´c
 = 0

111 
£lf
.
m´c
 = 0

112 
£lf
.
b´c
 = 0

113 
£lf
.
gÜc
 = 0

114 -- 
the£
 
¡©s
 
¬e
 
unfÜuÇ‹ly
 
nÙ
 
»£t
 
to
 0 
wh’
 
the
 
deviû
 
is
 
š™Ÿlized


115 -- 
the
 
d©ash“t
 
şaims
 
th©
h
ÿn
 
be
 
ş—»d
 
by
 
wr™šg
 1
s
 
što
 
them


116 -- 
but
 
th©
 
dÛ¢
't work on‡ny of my XL710-based NICs...

117 -- 
¹e_‘h_¡©s_»£t
 
®so
 
dÛ¢
't do‡nything

118 
loÿl
 
pÜt
 = 
dpdkc
.
	$dpdk_g‘_pci_funùiÚ
(
£lf
.
id
)

119 
£lf
.
š™Pkts
 = 
	`»adCŒ32
(£lf.
id
, 
GLPRT_UPRCL
[
pÜt
], 0)

120 + 
	`»adCŒ32
(
£lf
.
id
, 
GLPRT_MPRCL
[
pÜt
], 0)

121 + 
	$»adCŒ32
(
£lf
.
id
, 
GLPRT_BPRCL
[
pÜt
], 0)

122 
£lf
.
š™By‹s
 = 
	$»adCŒ48
(
£lf
.
id
, 
GLPRT_GORCL
[
pÜt
], 0)

123 
£lf
:
	$¡Üe
()

124 
’d


127 
ffi
.
cdef
[[

128 
	`libmoÚ_i40e_»£t_timecouÁ”s
(
ušt32_t
 
pÜt_id
);

131 
funùiÚ
 
dev
:
	$»£tTimeCouÁ”s
()

132 
ffi
.
C
.
	$libmoÚ_i40e_»£t_timecouÁ”s
(
£lf
.
id
)

133 
’d


135 
funùiÚ
 
dev
:
	$’abËRxTime¡amps
(
queue
, 
udpPÜt
)

136 
udpPÜt
 = udpPÜˆ
Ü
 319

137 
udpPÜt
 ~ğ319 
th’


138 
£lf
:
	`unsuµÜ‹d
("Timestamping on UDP…orts otherhan 319")

139 
’d


140 -- 
’abË
 
rx
 
time¡ampšg


141 
nÙ
 
£lf
.
timesyncEÇbËd
 
th’


142 -- 
this
 
funùiÚ
 
kes
 100
ms
 
some
 
»asÚ
, dØ
nÙ
 
run
hi 
uÂeûs§ry


143 -- (
the
 
’abË
 
funùiÚ
 
is
 
®so
 
ÿÎed
 
to
 
chªge
h
UDP
 
pÜt
)

144 
dpdkc
.
	$¹e_‘h_timesync_’abË
(
£lf
.
id
)

145 
£lf
.
timesyncEÇbËd
 = 
Œue


146 
’d


147 -- 
’abË
 
UDP
 
as
 
w–l


148 
loÿl
 
v®1
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
PRTTSYN_CTL1
)

149 
v®1
 = 
b™
.
	$bÜ
(
v®1
, 
PRTTSYN_CTL1_TSYNENA
)

150 
v®1
 = 
b™
.
	`bªd
(v®1, b™.
	$bnÙ
(
PRTTSYN_CTL1_TSYNTYPE_MASK
))

151 
v®1
 = 
b™
.
	`bÜ
(v®1, b™.
	$lshiá
(2, 
PRTTSYN_CTL1_TSYNTYPE_OFFS
))

152 
v®1
 = 
b™
.
	`bªd
(v®1, b™.
	$bnÙ
(
PRTTSYN_CTL1_UDP_ENA_MASK
))

153 
v®1
 = 
b™
.
	`bÜ
(v®1, b™.
	$lshiá
(3, 
PRTTSYN_CTL1_UDP_ENA_OFFS
))

154 
dpdkc
.
	$wr™e_»g32
(
£lf
.
id
, 
PRTTSYN_CTL1
, 
v®1
)

155 
’d


157 
funùiÚ
 
dev
:
	$ş—rTime¡amps
()

158 
loÿl
 
¡©s
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
PRTTSYN_STAT_1
)

159 
b™
.
	`bªd
(
¡©s
, 
PRTTSYN_STAT_1_RXT_ALL
è~ğ0 
th’


160 
i
 = 0, 3 do

161 
£lf
:
	$g‘RxTime¡amp
(
n
, 10, 
i
)

162 
’d


163 
’d


164 
’d


166 -- 
could
 
sk
 
a
 
ãw
 
»gi¡”s
 
h”e
, 
but
 
dÛ¢
't matter

167 
dev
.
’abËTxTime¡amps
 = dev.
’abËRxTime¡amps


169 
funùiÚ
 
dev
:
	$hasRxTime¡amp
()

170 
loÿl
 
¡©s
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
PRTTSYN_STAT_1
)

171  
b™
.
	`bªd
(
¡©s
, 
PRTTSYN_STAT_1_RXT_ALL
è~ğ0 
ªd
 -1 
Ü
 
n


172 
’d


174 
loÿl
 
funùiÚ
 
	$g‘FdœF‹r
(
queue
, 
±pTy³
, 
v”
, 
udpF‹r
)

175 
	`ty³
(
queue
è=ğ"bË" 
th’


176 
queue
 = queue.
qid


177 
’d


178 
±pTy³
 =…Ty³ 
Ü
 0

179 
v”
 = v” 
Ü
 2

180 
udpF‹r
 = udpF‹¸
Ü
 {
	}
}

181  
ffi
.
Ãw
("struct„te_eth_fdir_filter", {

182 
soá_id
 = 1,

183 
šput
 = {

184 
æow_ty³
 = 
dpdkc
.
RTE_ETH_FLOW_NONFRAG_IPV4_UDP
,

185 
æow
 = {

186 
udp4_æow
 = {

187 

 = {

188 
¤c_
 = 
udpF‹r
.
¤cIp
 
Ü
 0,

189 
d¡_
 = 
udpF‹r
.
d¡Ip
 
Ü
 0

191 
¤c_pÜt
 = 
udpF‹r
.
¤cPÜt
 
Ü
 0,

192 
d¡_pÜt
 = 
udpF‹r
.
d¡PÜt
 
Ü
 0--]]

195 
æow_ext
 = {

196 
vÏn_tci
 = 0,

197 
æexby‹s
 = {
±pTy³
, 
v”
},

198 
is_vf
 = 0,

199 
d¡_id
 = 0,

202 
aùiÚ
 = {

203 
rx_queue
 = 
queue


206 
	g’d


208 -- 
we
 
aùu®ly
 
cÚfigu»
 
the
 
f‹r
 
š
 
»cÚfigu»UdpTime¡ampF‹r
 
b–ow


209 
funùiÚ
 
	gdev
:
	$f‹rUdpTime¡amps
(
queue
, 
±pTy³
, 
v”
, 
udpF‹r
)

210 
’d


212 --- 
Upd©es
 
the
 
æow
 
dœeùÜ
 
f‹r
. 
The
 
i40e
 
im¶em’tiÚ
 
dÛ¢
't seem

213 --- 
to
 
®low
 
m©chšg
 
UDP
 
·ylßd
 
w™hout
 m©chšg 
IPs
 
ªd
 
pÜts
...

214 --- 
This
 
is
 
somewh©
 
ªnoyšg
.

215 --- 
This
 
funùiÚ
 
is
 
ÿÎed
 
by
 
the
 
time¡am³r
 
w™h
h
·ck‘
 
to
 
£nd
.

217 --- 
If
 
you
 
have
 
a
 
£tup
 
wh”e
 
the
 
time¡am³d
 
·ck‘
 
is
 
modif›d
, 
e
.
g
.,

218 --- 
m—suršg
 
the
 
Ï‹ncy
 
of
 
a
 
NAT
 
deviû
:

219 --- 
U£
 
the
 
·ck‘
 
modifiÿtiÚ
 
ÿÎback
 
ªd
 
ÿÎ
 
this
 
funùiÚ
 
ex¶ic™ly


220 --- 
äom
 
the
 
ÿÎback
. 
Th’
  
Œue
 fromhÿÎback 
to
 
´ev’t
he

221 --- 
time¡am³r
 
äom
 
ÿÎšg
 
this
.

222 
funùiÚ
 
dev
:
	$»cÚfigu»UdpTime¡ampF‹r
(
queue
, 
pkt
)

223 
»quœe
 "filter"

224 
loÿl
 
±pTy³
 = 0

225 
loÿl
 
v”
 = 2

226 
loÿl
 
æowTu¶e
 = {
¤cIp
 = 
pkt
.
4
.
¤c
.
ušt32
, 
d¡Ip
 =…kt.4.
d¡
.ušt32, 
¤cPÜt
 =…kt.
udp
.¤c, 
d¡PÜt
 =…kt.udp.
	}
dst}

227 -- 
	gno
, 
i40e
 
	gdÛ¢
't implement RTE_ETH_FILTER_UPDATE

228 -- 
d–‘šg
 
ªd
 
	g»
-
addšg
 
the
 
f‹r
 
is
 
qu™e
 
¦ow
 (
about
 25
ms
)

229 -- 
this
 
lim™s
 
the
 
numb”
 
of
 
time¡am³d
 
·ck‘s
 
³r
 
£cÚd
 
to
 
	gabout
 40/
	gs


230 -- 
	ghowev”
, 
this
 
is
 
Úly
 
Ãûs§ry
 
wh’
 
usšg
 
muÉË
 
æows
 
of
 
time¡am³d
 
	g·ck‘s


231 -- 
so
 
avoid
 
muÉË
 
æows
 
beÿu£
 
i40e
 
is
 
	gbrok’
...?

232 
nÙ
 
	g£lf
.
cu¼’tTime¡ampF‹rFlow


233 
Ü
 
	g£lf
.
	gcu¼’tTime¡ampF‹rFlow
.
	g¤cIp
 ~ğ
æowTu¶e
.
¤cIp


234 
Ü
 
£lf
.
cu¼’tTime¡ampF‹rFlow
.
d¡Ip
 ~ğ
æowTu¶e
.dstIp

235 
Ü
 
£lf
.
cu¼’tTime¡ampF‹rFlow
.
¤cPÜt
 ~ğ
æowTu¶e
.srcPort

236 
Ü
 
£lf
.
cu¼’tTime¡ampF‹rFlow
.
d¡PÜt
 ~ğ
æowTu¶e
.d¡PÜˆ
th’


237 -- 
æow
 
chªged
 
sšû
 
Ï¡
 
time


238 
loÿl
 
»moveSucûss
 = 
Œue


239 
£lf
.
cu¼’tTime¡ampF‹r
 
th’


240 
loÿl
 
”r
 = 
dpdkc
.
	$¹e_‘h_dev_f‹r_ù¾
(
£lf
.
id
, 
dpdkc
.
RTE_ETH_FILTER_FDIR
, dpdkc.
RTE_ETH_FILTER_DELETE
, s–f.
cu¼’tTime¡ampF‹r
)

241 
»moveSucûss
 = 
	`checkDpdkE¼Ü
(
”r
, "deleting fdir filter")

242 
’d


243 
»moveSucûss
 
th’


244 
loÿl
 
f‹r
 = 
	$g‘FdœF‹r
(
queue
, 
±pTy³
, 
v”
, 
æowTu¶e
)

245 
loÿl
 
”r
 = 
dpdkc
.
	$¹e_‘h_dev_f‹r_ù¾
(
£lf
.
id
, 
dpdkc
.
RTE_ETH_FILTER_FDIR
, dpdkc.
RTE_ETH_FILTER_ADD
, 
f‹r
)

246 
	`checkDpdkE¼Ü
(
”r
, "setting fdir filter")

247 
£lf
.
cu¼’tTime¡ampF‹r
 = 
f‹r


248 
£lf
.
cu¼’tTime¡ampF‹rFlow
 = 
æowTu¶e


249 
’d


250 
’d


251 
’d


253  
dev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/igb.lua

1 --- 
	gigb
-
¥ecific
 
code


2 
loÿl
 
	gdev
 = {}

4 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

5 
loÿl
 
ffi
 = 
»quœe
 "ffi"

6 
loÿl
 
log
 = 
»quœe
 "log"

8 -- 
the
 
igb
 
driv”
 
aùu®ly
 
»pÜts
 
¡©s
 
®mo¡
 
as
 
ex³ùed


9 
dev
.
txStsIgnÜeCrc
 = 
Œue


10 
dev
.
rxStsIgnÜeCrc
 = 
Œue


12 -- 
time¡ampšg


13 
loÿl
 
TSAUXC
 = 0x0000B640

14 
loÿl
 
TIMINCA
 = 0x0000B608

15 
loÿl
 
TSYNCRXCTL
 = 0x0000B620

16 
loÿl
 
TSYNCTXCTL
 = 0x0000B614

17 
loÿl
 
TXSTMPL
 = 0x0000B618

18 
loÿl
 
TXSTMPH
 = 0x0000B61C

19 
loÿl
 
RXSTMPL
 = 0x0000B624

20 
loÿl
 
RXSTMPH
 = 0x0000B628

21 
loÿl
 
RXSATRH
 = 0x0000B630

22 
loÿl
 
ETQF_3
 = 0x00005CB0 + 4 * 3

23 
loÿl
 
SYSTIMEL
 = 0x0000B600

24 
loÿl
 
SYSTIMEH
 = 0x0000B604

25 
loÿl
 
TIMEADJL
 = 0x0000B60C

26 
loÿl
 
TIMEADJH
 = 0x0000B610

28 
loÿl
 
SRRCTL_82580
 = {}

29 
i
 = 0, 7 do

30 
	gSRRCTL_82580
[
i
] = 0x0000C00C + 0x40 * i

31 
’d


33 
loÿl
 
TSYNCRXCTL_TYPE_OFFS
 = 1

34 
loÿl
 
TSYNCRXCTL_TYPE_MASK
 = 
b™
.
	$lshiá
(7, 
TSYNCRXCTL_TYPE_OFFS
)

35 
loÿl
 
TSYNCRXCTL_RXTT
 = 1

36 
loÿl
 
ETQF_QUEUE_ENABLE
 = 
b™
.
	$lshiá
(1, 31)

37 
loÿl
 
SRRCTL_TIMESTAMP
 = 
b™
.
	`lshiá
(1, 30)

39 -- 
deviû
 
š™Ÿlizšg
 
kes
 
uÄ—sÚably
 
som‘imes


40 
dev
.
lškWa™Time
 = 18

42 
dev
.
timeRegi¡”s
 = {
SYSTIMEL
, 
SYSTIMEH
, 
TIMEADJL
, 
TIMEADJH
}

43 
dev
.
ücP©ch
 = 
Œue


45 
ffi
.
cdef
[[

46 
libmoÚ_igb_»£t_timecouÁ”s
(
ušt32_t
 
pÜt_id
);

49 
funùiÚ
 
	gdev
:
	$»£tTimeCouÁ”s
()

50 
ffi
.
C
.
	$libmoÚ_igb_»£t_timecouÁ”s
(
£lf
.
id
)

51 
’d


53 -- 
ju¡
 
¹e_‘h_timesync_’abË
 
dÛ¢
't doherick :(

54 
funùiÚ
 
dev
:
	$’abËRxTime¡amps
(
queue
, 
udpPÜt
)

55 
udpPÜt
 = udpPÜˆ
Ü
 319

56 
udpPÜt
 ~ğ319 
th’


57 
£lf
:
	`unsuµÜ‹d
("Timestamping on UDP…orts otherhan 319")

58 
’d


59 
dpdkc
.
	`¹e_‘h_timesync_’abË
(
£lf
.
id
)

60 -- 
’abË
 
time¡ampšg
 
UDP
 
·ck‘s
 
as
 
w–l


61 
loÿl
 
v®
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
TSYNCRXCTL
)

62 
v®
 = 
b™
.
	`bªd
(v®, b™.
	$bnÙ
(
TSYNCRXCTL_TYPE_MASK
))

63 
v®
 = 
b™
.
	`bÜ
(v®, b™.
	$lshiá
(2, 
TSYNCRXCTL_TYPE_OFFS
))

64 
dpdkc
.
	$wr™e_»g32
(
£lf
.
id
, 
TSYNCRXCTL
, 
v®
)

65 
’d


67 
dev
.
’abËTxTime¡amps
 = dev.
’abËRxTime¡amps


69 
funùiÚ
 
dev
:
	$hasRxTime¡amp
()

70 
b™
.
	`bªd
(
dpdkc
.
	`»ad_»g32
(
£lf
.
id
, 
TSYNCRXCTL
), 
TSYNCRXCTL_RXTT
è=ğ0 
th’


71  
n


72 
’d


73  
	`bsw­16
(
b™
.
	`rshiá
(
dpdkc
.
	`»ad_»g32
(
£lf
.
id
, 
RXSATRH
), 16))

74 
’d


76 
funùiÚ
 
dev
:
	`f‹rL2Time¡amps
(
queue
)

77 -- 
DPDK
's init function configures ETQF3oƒnable PTP L2imestamping, so usehis one

78 
loÿl
 
v®
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
ETQF_3
)

79 
v®
 = 
b™
.
	`bÜ
(v®, 
ETQF_QUEUE_ENABLE
, b™.
	$lshiá
(
queue
.
qid
, 16))

80 
dpdkc
.
	$wr™e_»g32
(
£lf
.
id
, 
ETQF_3
, 
v®
)

81 
’d


83 
funùiÚ
 
dev
:
	`f‹rUdpTime¡amps
()

84 -- 
have
 
a
 
look
 
©
 
the
 
	$FHFT
 (0x9000è
»gi¡”s
 
you
 
wªt
 
to
 
im¶em’t
 
this


85 
log
:
	`w¬n
("Filtering UDPimestamps on IGB is supported byhe HW but NYI")

86 
’d


88 
funùiÚ
 
dev
:
	$’abËRxTime¡ampsAÎPack‘s
(
queue
)

89 
dpdkc
.
	$¹e_‘h_timesync_’abË
(
£lf
.
id
)

90 
loÿl
 
v®
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
TSYNCRXCTL
)

91 
v®
 = 
b™
.
	`bªd
(v®, b™.
	$bnÙ
(
TSYNCRXCTL_TYPE_MASK
))

92 
v®
 = 
b™
.
	`bÜ
(v®, b™.
	`lshiá
(b™.lshiá(1, 2), 
TSYNCRXCTL_TYPE_OFFS
))

93 
dpdkc
.
	$wr™e_»g32
(
£lf
.
id
, 
TSYNCRXCTL
, 
v®
)

94 
dpdkc
.
	`wr™e_»g32
(
£lf
.
id
, 
SRRCTL_82580
[
queue
.
qid
], 
b™
.
	`bÜ
(dpdkc.
	`»ad_»g32
(£lf.id, SRRCTL_82580[queue.qid]), 
SRRCTL_TIMESTAMP
))

95 
’d


97  
dev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/ixgbe.lua

1 --- 
	gixgbe
-
¥ecific
 
code


2 
loÿl
 
	gdev
 = {}

4 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

5 
loÿl
 
ffi
 = 
»quœe
 "ffi"

6 
loÿl
 
log
 = 
»quœe
 "log"

8 -- 
rx
 
¡©s


9 
loÿl
 
GPRC
 = 0x00004074

10 
loÿl
 
GORCL
 = 0x00004088

11 
loÿl
 
GORCH
 = 0x0000408C

13 -- 
tx
 
¡©s


14 
loÿl
 
GPTC
 = 0x00004080

15 
loÿl
 
GOTCL
 = 0x00004090

16 
loÿl
 
GOTCH
 = 0x00004094

18 -- 
time¡ampšg


19 
loÿl
 
RXMTRL
 = 0x00005120

20 
loÿl
 
TSYNCRXCTL
 = 0x00005188

21 
loÿl
 
RXSATRH
 = 0x000051A8

22 
loÿl
 
SYSTIMEL
 = 0x00008C0C

23 
loÿl
 
SYSTIMEH
 = 0x00008C10

24 
loÿl
 
TIMEADJL
 = 0x00008C18

25 
loÿl
 
TIMEADJH
 = 0x00008C1C

26 
loÿl
 
ETQS_3
 = 0x0000EC00 + 4 * 3

28 
loÿl
 
TSYNCRXCTL_RXTT
 = 1

29 
loÿl
 
TSYNCRXCTL_TYPE_OFFS
 = 1

30 
loÿl
 
TSYNCRXCTL_TYPE_MASK
 = 
b™
.
	$lshiá
(7, 
TSYNCRXCTL_TYPE_OFFS
)

31 
loÿl
 
TSYNCRXCTL_TSIP_UT_EN_OFFS
 = 23

32 
loÿl
 
TSYNCRXCTL_TSIP_UP_EN_OFFS
 = 24

34 
loÿl
 
ETQS_RX_QUEUE_OFFS
 = 16

35 
loÿl
 
ETQS_QUEUE_ENABLE
 = 
b™
.
	$lshiá
(1, 31)

38 
dev
.
suµÜtsFdœ
 = 
Œue


39 
dev
.
timeRegi¡”s
 = {
SYSTIMEL
, 
SYSTIMEH
, 
TIMEADJL
, 
TIMEADJH
}

40 
dev
.
ücP©ch
 = 
Œue


42 -- 
magic
 
v®ues
 
the
 
CRC
 
ba£d
 
¿‹
 
cÚŒŞ
 
š
 
moÚg’


43 
dev
.
mšPack‘Size
 = 14 -- 
yes
, 
this
 
NIC
 
ÿn
 
£nd
 
out
 
·ck‘s
 
th©
 
¬e
h© 
sm®l
 
w™hout
 
	g·ddšg
 :)

44 
dev
.
maxPack‘R©e
 = 16.4 -- 
maximum
 
¿‹
 
w™h
 
Ëg®ly
 
sm®l
 
·ck‘s


46 -- 
ixgbe
 
dÛs
 
nÙ
 
couÁ
 
by‹s
 
drİ³d
 
due
 
to
 
bufãr
 
¥aû
 
ªd
 
the
 
·ck‘
 
drİ
 
couÁ”s
 
£em
Ø
be
 
em±y


47 -- 
howev”
, 
we
 
wªt
 
to
 
couÁ
 
®l
 
·ck‘s
 *
©
 
the
 
NIC
 
Ëv–
* 
»g¬dËss
 
wh‘h”
 
they
 
w”e
 
ãtched
 
by
h
driv”
 
Ü
 
	gnÙ


48 -- 
this
 
behaviÜ
 
is
 
cÚsi¡’t
 
w™h
 
Ùh”
 
driv”s
 
ªd
 
mÜe
 
u£ful


49 
funùiÚ
 
	gdev
:
g‘RxSts
()

50 -- 
the£
 
couÁ”s
 
¬e
 
ş—r
-
Ú
-
»ad


51 
£lf
.
rxPkts
 = (£lf.rxPkt 
Ü
 0ULLè+ 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
GPRC
)

52 
£lf
.
rxBy‹s
 = (£lf.rxBy‹ 
Ü
 0ULLè+ 
dpdkc
.
	`»ad_»g32
(£lf.
id
, 
GORCL
è+ dpdkc.»ad_»g32(£lf.id, 
GORCH
) * 2^32

53  
	`tÚumb”
(
£lf
.
rxPkts
), 
	$tÚumb”
(
£lf
.
rxBy‹s
)

54 
’d


56 -- 
ş—r
 
RX
 
couÁ”s
. 
We
 
wªt
 
to
 cË¬ 
the
 
s
/
w
 
¡©i¡ics
 
ªd
 
®so
 
»g
 
»ad
Øş—¸th
h
/w 
Ëv–


57 
funùiÚ
 
dev
:
	$ş—rRxSts
()

58 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
GPRC
)

59 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
GORCL
)

60 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
GORCH
)

61 
£lf
.
rxPkts
 = 0ULL

62 
£lf
.
rxBy‹s
 = 0ULL

64 
’d


66 -- 
Ãûs§ry
 
beÿu£
 
of
 
ş—r
-
Ú
-
»ad
 
»gi¡”s
 
ªd
 
the
 
š‹¿ùiÚ
 
w™h
h
nÜm®
 
	$¹e_‘h_¡©s_g‘
(è
ÿÎ


67 
funùiÚ
 
dev
:
	$g‘TxSts
()

68 
£lf
.
txPkts
 = (£lf.txPkt 
Ü
 0ULLè+ 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
GPTC
)

69 
£lf
.
txBy‹s
 = (£lf.txBy‹ 
Ü
 0ULLè+ 
dpdkc
.
	`»ad_»g32
(£lf.
id
, 
GOTCL
è+ dpdkc.»ad_»g32(£lf.id, 
GOTCH
) * 2^32

70  
	`tÚumb”
(
£lf
.
txPkts
), 
	$tÚumb”
(
£lf
.
txBy‹s
)

71 
’d


73 
ffi
.
cdef
[[

74 
	`libmoÚ_ixgbe_»£t_timecouÁ”s
(
ušt32_t
 
pÜt_id
);

77 
funùiÚ
 
dev
:
	$»£tTimeCouÁ”s
()

78 
ffi
.
C
.
	$libmoÚ_ixgbe_»£t_timecouÁ”s
(
£lf
.
id
)

79 
’d


81 -- 
ju¡
 
¹e_‘h_timesync_’abË
 
dÛ¢
't doherick :(

82 
funùiÚ
 
dev
:
	$’abËRxTime¡amps
(
queue
, 
udpPÜt
)

83 
udpPÜt
 = udpPÜˆ
Ü
 319

84 
dpdkc
.
	`¹e_‘h_timesync_’abË
(
£lf
.
id
)

85 -- 
’abË
 
time¡ampšg
 
UDP
 
·ck‘s
 
as
 
w–l


86 
loÿl
 
v®
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
TSYNCRXCTL
)

87 
v®
 = 
b™
.
	`bªd
(v®, b™.
	$bnÙ
(
TSYNCRXCTL_TYPE_MASK
))

88 
v®
 = 
b™
.
	`bÜ
(v®, b™.
	$lshiá
(2, 
TSYNCRXCTL_TYPE_OFFS
))

89 
dpdkc
.
	`wr™e_»g32
(
£lf
.
id
, 
TSYNCRXCTL
, 
v®
)

90 -- 
cÚfigu»
 
UDP
 
pÜt


91 -- 
fun
 
çù
: 
the
 
is
 
š™Ÿlized
 
to
 0x319 
š¡—d
 
of
 319

92 
dpdkc
.
	`wr™e_»g32
(
£lf
.
id
, 
RXMTRL
, 
b™
.
	$lshiá
(
udpPÜt
, 16))

93 
’d


95 -- 
could
 
sk
 
a
 
ãw
 
»gi¡”s
 
h”e
, 
but
 
dÛ¢
't matter

96 
dev
.
’abËTxTime¡amps
 = dev.
’abËRxTime¡amps


98 
funùiÚ
 
dev
:
	$hasRxTime¡amp
()

99 
b™
.
	`bªd
(
dpdkc
.
	`»ad_»g32
(
£lf
.
id
, 
TSYNCRXCTL
), 
TSYNCRXCTL_RXTT
è=ğ0 
th’


100  
n


101 
’d


102 -- 
this
 
is
 
undocum’‹d
 
Ú
 
X550
 
but
 
™
 
£ems
 
to
 
wÜk
 
ju¡
 
fše


103 
loÿl
 
»s
 = 
	`bsw­16
(
b™
.
	`rshiá
(
dpdkc
.
	`»ad_»g32
(
£lf
.
id
, 
RXSATRH
), 16))

104  
»s


105 
’d


107 
funùiÚ
 
dev
:
	`f‹rL2Time¡amps
(
queue
)

108 -- 
DPDK
's init function configures ETQF3oƒnable PTP L2imestamping, so usehis one

109 
dpdkc
.
	`wr™e_»g32
(
£lf
.
id
, 
ETQS_3
, 
b™
.
	`bÜ
(
ETQS_QUEUE_ENABLE
, b™.
	$lshiá
(
queue
.
qid
, 
ETQS_RX_QUEUE_OFFS
)))

110 
’d


112 
funùiÚ
 
dev
:
	$’abËRxTime¡ampsAÎPack‘s
(
queue
)

113 
dpdkc
.
	$¹e_‘h_timesync_’abË
(
£lf
.
id
)

114 
loÿl
 
v®
 = 
dpdkc
.
	$»ad_»g32
(
£lf
.
id
, 
TSYNCRXCTL
)

115 
v®
 = 
b™
.
	`bªd
(v®, b™.
	$bnÙ
(
TSYNCRXCTL_TYPE_MASK
))

116 
v®
 = 
b™
.
	`bÜ
(v®, b™.
	$lshiá
(4, 
TSYNCRXCTL_TYPE_OFFS
))

117 
v®
 = 
b™
.
	`bÜ
(v®, b™.
	`lshiá
(1, 
TSYNCRXCTL_TSIP_UT_EN_OFFS
))

118 -- 
nÙ
 
Ãûs§ry
 
uÆess
 
you
 
cÚfigu»
 
some
 
weœd
 
¡uff


119 
v®
 = 
b™
.
	`bÜ
(v®, b™.
	$lshiá
(0xFF, 
TSYNCRXCTL_TSIP_UP_EN_OFFS
))

120 
dpdkc
.
	$wr™e_»g32
(
£lf
.
id
, 
TSYNCRXCTL
, 
v®
)

121 
’d


123 
dev
.
embeddedTime¡ampAtEndOfBufãr
 = 
Œue


125  
dev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/ixgbevf.lua

1 
loÿl
 
	gdev
 = {}

3 -- 
¡©s
 
of
 
a
 
VF
 
¬e
 
v”y
 
lim™ed
, 
	gÿn
't do betterhan DPDK here

4 
	gdev
.
	gtxStsIgnÜeCrc
 = 
Œue


5 
dev
.
rxStsIgnÜeCrc
 = 
Œue


7  
dev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/mlx5.lua

1 -- 
	gmlx5
-
¥ecific
 
code


2 
loÿl
 
	gdev
 = {}

4 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

5 
loÿl
 
ffi
 = 
»quœe
 "ffi"

6 
loÿl
 
log
 = 
»quœe
 "log"

8 
loÿl
 
C
 = 
ffi
.C

10 -- 
the
 
mlx5
 
driv”
 
dÛs
 
nÙ
 
suµÜt
h
æowf‹rs
 
we
 
nÜm®ly
 
u£


11 
dev
.
USE_GENERIC_FILTER
 = 
Œue


13 --- 
FunùiÚ
 
which
 
£ts
 
®l
 
mlx5
 
¥ecific
 
v®ues
, 
is
 
autom©iÿÎy
 
ÿÎed
 
©
 
´og¿m
 
¡¬tup


14 
funùiÚ
 
	gdev
:
š™
()

16 -- 
to
 
’abË
 
¡©i¡ics
 
which
 
couÁ
 
®l
 
·ck‘s
 
ãtched
 
by
 
the
 
driv”
 
Ü
 
nÙ
 
we
 
have
Ø
u£
h
x¡©s


17 -- 
of
 
the
 
deviû


18 -- 
fœ¡
 
»Œ›ve
 
the
 
IDs
 
of
h
»quœed
 
x¡©
 
f›lds


19 -- 
š
 
ªy
 
of
 
tho£
 
¡©s
 
is
 
missšg
, 
´İ”
 
	g·ck‘
/
by‹
 
couÁšg
 i 
nÙ
 
	gpossibË


20 -- 
Ï¡
 
»sÜt
 
š
 
this
 
is
 
to
 
comm’t
 
out
 
	gdev
:
	$g‘RxSts
(è
to
 Ø
the
 
nÜm®
 
couÁšg
 
behaviÜ


21 
loÿl
 
id
 = 
ffi
.
	`Ãw
("uint64_t[1]", 1337)

23 
loÿl
 
ok
 = 
C
.
	`¹e_‘h_x¡©s_g‘_id_by_Çme
(
£lf
.
id
, "rx_port_unicast_bytes", id)

24 
£lf
.
uc_by‹_id
 = 
	$tÚumb”
(
id
[0])

25 
ok
 ~ğ0 
th’
 
log
:
	`çl
("FaedØexŒaù x¡©s. UnifÜm…ack‘ couÁšg‚Ù…ossibË."è
’d


27 
ok
 = 
C
.
	`¹e_‘h_x¡©s_g‘_id_by_Çme
(
£lf
.
id
, "rx_port_multicast_bytes", id)

28 
£lf
.
mc_by‹_id
 = 
	$tÚumb”
(
id
[0])

29 
ok
 ~ğ0 
th’
 
log
:
	`çl
("FaedØexŒaù x¡©s. UnifÜm…ack‘ couÁšg‚Ù…ossibË."è
’d


31 
ok
 = 
C
.
	`¹e_‘h_x¡©s_g‘_id_by_Çme
(
£lf
.
id
, "rx_port_broadcast_bytes", id)

32 
£lf
.
bc_by‹_id
 = 
	$tÚumb”
(
id
[0])

33 
ok
 ~ğ0 
th’
 
log
:
	`çl
("FaedØexŒaù x¡©s. UnifÜm…ack‘ couÁšg‚Ù…ossibË."è
’d


35 
ok
 = 
C
.
	`¹e_‘h_x¡©s_g‘_id_by_Çme
(
£lf
.
id
, "rx_port_unicast_packets", id)

36 
£lf
.
uc_pkt_id
 = 
	$tÚumb”
(
id
[0])

37 
ok
 ~ğ0 
th’
 
log
:
	`çl
("FaedØexŒaù x¡©s. UnifÜm…ack‘ couÁšg‚Ù…ossibË."è
’d


39 
ok
 = 
C
.
	`¹e_‘h_x¡©s_g‘_id_by_Çme
(
£lf
.
id
, "rx_port_multicast_packets", id)

40 
£lf
.
mc_pkt_id
 = 
	$tÚumb”
(
id
[0])

41 
ok
 ~ğ0 
th’
 
log
:
	`çl
("FaedØexŒaù x¡©s. UnifÜm…ack‘ couÁšg‚Ù…ossibË."è
’d


43 
ok
 = 
C
.
	`¹e_‘h_x¡©s_g‘_id_by_Çme
(
£lf
.
id
, "rx_port_broadcast_packets", id)

44 
£lf
.
bc_pkt_id
 = 
	$tÚumb”
(
id
[0])

45 
ok
 ~ğ0 
th’
 
log
:
	`çl
("FaedØexŒaù x¡©s. UnifÜm…ack‘ couÁšg‚Ù…ossibË."è
’d


47 -- 
»Œ›ve
 
the
 
numb”
 
of
 
avaabË
 
x¡©s


48 
£lf
.
numx¡©s
 = 0

49 
loÿl
 
x¡©s
 = 
ffi
.
	`Ãw
("¡ruù„‹_‘h_x¡©[?]", 
£lf
.
numx¡©s
)

51 -- 
beÿu£
 
th”e
 
is
 
no
 
—sy
 
funùiÚ
 
which
 
»tuºs
 
the
 
numb”
 
of
 
x¡©s
 
we
 
Œy
 
to
 
»Œ›ve


52 -- 
the
 
x¡©s
 
w™h
 
a
 
z”o
 
sized
 
¬¿y


53 -- 
»suÉ
 > 
	`numx¡©s
 (0 
š
 
this
 ), 
th’
„esuÉ 
equ®s
 
the
 
»®
 
numb”
 
of
 
x¡©s


54 
loÿl
 
»suÉ
 = 
C
.
	`¹e_‘h_x¡©s_g‘
(
£lf
.
id
, 
x¡©s
, s–f.
numx¡©s
)

56 -- 
»suÉ
 
wl
 
be
 
©
 
Ëa¡
 6, 
Ùh”wi£
 
the
 
above
 
¡©em’ts
 
would
 
have
 
çed


57 
£lf
.
numx¡©s
 = 
	$tÚumb”
(
»suÉ
)

59 
’d


61 --- 
R‘r›ve
 
RxSts
 
which
 
¬e
 
com·¿bË
 
b‘w“n
 
mo¡
 
deviûs


62 --- 
AÎ
 
·ck‘s
 
¬e
 
cÚsid”ed
, 
»g¬dËss
 
of
 
memÜy
 
”rÜs
, 
wrÚg
 
CRCs
 
‘c
.

63 
funùiÚ
 
dev
:
	`g‘RxSts
()

64 -- 
the
 
funùiÚ
 "¹e_‘h_x¡©s_g‘_by_id" 
dÛs
 
nÙ
 
£em
 
to
 
wÜk
 
´İ”ly
. 
It
 
®ways
 
»tuºs
h
fœ¡
 
x¡©
 
’Œy
, 
ignÜšg
h
IDs


65 -- 
so
 
we
 
g‘
 
®l
 
x¡©s
 
ªd
 
u£
 
the
 
IDs
 
as
 
šdex


67 -- 
this
 
funùiÚ
 
is
 
ÿÎed
 
Úû
 
ev”y
 
£cÚd
 
Ü
 
so
. 
P”fÜmªû
 
³ÇÉy
 
should
 
be
 
ÃgligibË


69 -- 
Úly
 
®loÿ‹
 
x¡©s
 
Úû


70 
nÙ
 
£lf
.
x¡©s
 
th’


71 
£lf
.
x¡©s
 = 
ffi
.
	`Ãw
("¡ruù„‹_‘h_x¡©[?]", s–f.
numx¡©s
)

72 
’d


73 
C
.
	`¹e_‘h_x¡©s_g‘
(
£lf
.
id
, s–f.
x¡©s
, s–f.
numx¡©s
)

75 -- 
sum
 
of
 
®l
 
»c›ved
 
uniÿ¡
, 
muÉiÿ¡
 
ªd
 
brßdÿ¡
 
by‹s
/
·ck‘s


76 
£lf
.
rxPkts
 = (£lf.
x¡©s
[£lf.
uc_pkt_id
].
v®ue
 
Ü
 0ULLè+ (£lf.x¡©s[£lf.
mc_pkt_id
].v®uÜ 0ULLè+ (£lf.x¡©s[£lf.
bc_pkt_id
].value or 0ULL)

77 
£lf
.
rxBy‹s
 = (£lf.
x¡©s
[£lf.
uc_by‹_id
].
v®ue
 
Ü
 0ULLè+ (£lf.x¡©s[£lf.
mc_by‹_id
].v®uÜ 0ULLè+ (£lf.x¡©s[£lf.
bc_by‹_id
].value or 0ULL)

78  
	`tÚumb”
(
£lf
.
rxPkts
), 
	$tÚumb”
Ğ
£lf
.
rxBy‹s
)

79 
’d


81  
dev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/virtio.lua

1 
loÿl
 
	gdev
 = {}

3 
dev
.
driv”Info
 = {

4 
di§bËOfæßds
 = 
Œue
,

5 
	g¡İOnShutdown
 = 
Œue


8  
	gdev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/vmxnet3.lua

1 
loÿl
 
	gdev
 = {}

3 
dev
.
driv”Info
 = {

4 
di§bËOfæßds
 = 
Œue


7  
	gdev


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/drivers.lua

1 
loÿl
 
	gmod
 = {}

3 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

6 
mod
.
Ãt_i40e
 = 
»quœe
 "driver.i40e"

7 
mod
.
Ãt_ixgbe
 = 
»quœe
 "driver.ixgbe"

8 
mod
.
Ãt_ixgbevf
 = 
»quœe
 "driver.ixgbevf"

9 
mod
.
Ãt_e1000_igb
 = 
»quœe
 "driver.igb"

10 
mod
.
Ãt_e1000_em
 = 
»quœe
 "driver.igb"

11 
mod
.
Ãt_vœtio
 = 
»quœe
 "driver.virtio"

12 
mod
.
Ãt_vmxÃt3
 = 
»quœe
 "driver.vmxnet3"

13 
mod
.
Ãt_mlx5
 = 
»quœe
 "driver.mlx5"

14 
mod
.
Ãt_’a
 = 
»quœe
 "driver.ena"

16 
funùiÚ
 
mod
.
	$š™Driv”
(
dev
)

17 
loÿl
 
deviû
 = 
»quœe
 "device"

18 
loÿl
 
driv”
 = 
mod
[
dev
:
	`g‘Driv”Name
()]

19 
driv”
 
th’


20 
nÙ
 
	$g‘m‘©abË
(
driv”
è
th’


21 
driv”
.
__šdex
 = driver

22 
driv”
.
__eq
 = 
deviû
.
__deviûPrÙÙy³
.__eq

23 
driv”
.
__to¡ršg
 = 
deviû
.
__deviûPrÙÙy³
.__tostring

24 
	$£tm‘©abË
(
driv”
, 
deviû
.
__deviûPrÙÙy³
)

25 
’d


26 
	$£tm‘©abË
(
dev
, 
driv”
)

27 
’d


28 
dev
.
driv”Info
 = dev.driv”InfØ
Ü
 {
	}
}

29 
’d


31 -- 
»Œ›ve
 
driv”
-
¥ecific
 
šfÜm©iÚ


32 -- 
»quœed
 
driv”
-
¥ecific
 
cÚfigu¿tiÚ
 
v¬ŸbËs


33 
funùiÚ
 
mod
.
	$g‘Driv”Info
(
driv”Name
)

34  (
mod
[
driv”Name
] 
Ü
 {
	}
}).
driv”Info
 or {}

35 
’d


37  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/etherc.lua

2 --- @
fe
 
	g‘h”c
.
	glua


3 --- @
br›f
 
SŒuùs
 
ªd
 
funùiÚs
 
äom
 
	g¹e_‘h”
.
	gh


6 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

8 
ffi
.
cdef
[[

23 
	s‘h”_addr
 {

24 
ušt8_t
 
addr_by‹s
[6];

25 } 
__©Œibu‹__
((
__·cked__
));

32 
	s‘h”_hdr
 {

33 
‘h”_addr
 
	md_addr
;

34 
‘h”_addr
 
	ms_addr
;

35 
ušt16_t
 
	m‘h”_ty³
;

36 } 
__©Œibu‹__
((
__·cked__
));

44 
	svÏn_hdr
 {

45 
ušt16_t
 
	mvÏn_tci
;

46 
ušt16_t
 
	m‘h_´Ùo
;

47 } 
__©Œibu‹__
((
__·cked__
));

55 
	svxÏn_hdr
 {

56 
ušt32_t
 
	mvx_æags
;

57 
ušt32_t
 
	mvx_vni
;

58 } 
__©Œibu‹__
((
__·cked__
));

77 
šlše
 
is_§me_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—1
,

78 cÚ¡ 
‘h”_addr
 *
—2
);

91 
šlše
 
is_z”o_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—
);

104 
šlše
 
is_uniÿ¡_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—
);

117 
šlše
 
is_muÉiÿ¡_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—
);

130 
šlše
 
is_brßdÿ¡_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—
);

143 
šlše
 
is_univ”§l_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—
);

156 
šlše
 
is_loÿl_admš_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—
);

170 
šlše
 
is_v®id_assigÃd_‘h”_addr
(cÚ¡ 
‘h”_addr
 *
—
);

179 
šlše
 
‘h_¿ndom_addr
(
ušt8_t
 *
addr
);

190 
šlše
 
‘h”_addr_cİy
(cÚ¡ 
‘h”_addr
 *
—_äom
,

191 
‘h”_addr
 *
—_to
);

204 
šlše
 

205 
‘h”_fÜm©_addr
(*
buf
, 
ušt16_t
 
size
,

206 cÚ¡ 
‘h”_addr
 *
‘h_addr
);

220 
šlše
 
¹e_vÏn_¡r
(
¹e_mbuf
 *
m
);

235 
šlše
 
¹e_vÏn_š£¹
(
¹e_mbuf
 **
m
);

240  
	gffi
.
	gC


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/filter.lua

2 --- @
fe
 
	gf‹r
.
	glua


3 --- @
br›f
 
	gF‹r
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 
loÿl
 
	gmod
 = {}

9 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

10 
loÿl
 
deviû
 = 
»quœe
 "device"

11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

13 
loÿl
 
mb™mask
 = 
»quœe
 "bitmask"

14 
loÿl
 
log
 = 
»quœe
 "log"

15 
loÿl
 
g’”ic
 = 
»quœe
 "filter_GenericFlowAPI"

17 
mod
.
DROP
 = -1

20 
loÿl
 
dev
 = 
deviû
.
__deviûPrÙÙy³


22 
ffi
.
cdef
[[

25 
	e¹e_æow_ty³
 {

26 
RTE_ETH_FLOW_UNKNOWN
 = 0,

27 
RTE_ETH_FLOW_RAW
,

28 
RTE_ETH_FLOW_IPV4
,

29 
RTE_ETH_FLOW_FRAG_IPV4
,

30 
RTE_ETH_FLOW_NONFRAG_IPV4_TCP
,

31 
RTE_ETH_FLOW_NONFRAG_IPV4_UDP
,

32 
RTE_ETH_FLOW_NONFRAG_IPV4_SCTP
,

33 
RTE_ETH_FLOW_NONFRAG_IPV4_OTHER
,

34 
RTE_ETH_FLOW_IPV6
,

35 
RTE_ETH_FLOW_FRAG_IPV6
,

36 
RTE_ETH_FLOW_NONFRAG_IPV6_TCP
,

37 
RTE_ETH_FLOW_NONFRAG_IPV6_UDP
,

38 
RTE_ETH_FLOW_NONFRAG_IPV6_SCTP
,

39 
RTE_ETH_FLOW_NONFRAG_IPV6_OTHER
,

40 
RTE_ETH_FLOW_L2_PAYLOAD
,

41 
RTE_ETH_FLOW_IPV6_EX
,

42 
RTE_ETH_FLOW_IPV6_TCP_EX
,

43 
RTE_ETH_FLOW_IPV6_UDP_EX
,

44 
RTE_ETH_FLOW_MAX


47 
	e¹e_‘h_·ylßd_ty³
 {

48 
RTE_ETH_PAYLOAD_UNKNOWN
 = 0,

49 
RTE_ETH_RAW_PAYLOAD
,

50 
RTE_ETH_L2_PAYLOAD
,

51 
RTE_ETH_L3_PAYLOAD
,

52 
RTE_ETH_L4_PAYLOAD
,

53 
RTE_ETH_PAYLOAD_MAX
 = 8,

56 
	e¹e_f‹r_ty³
 {

57 
RTE_ETH_FILTER_NONE
 = 0,

58 
RTE_ETH_FILTER_MACVLAN
,

59 
RTE_ETH_FILTER_ETHERTYPE
,

60 
RTE_ETH_FILTER_FLEXIBLE
,

61 
RTE_ETH_FILTER_SYN
,

62 
RTE_ETH_FILTER_NTUPLE
,

63 
RTE_ETH_FILTER_TUNNEL
,

64 
RTE_ETH_FILTER_FDIR
,

65 
RTE_ETH_FILTER_HASH
,

66 
RTE_ETH_FILTER_MAX


69 
	e¹e_f‹r_İ
 {

70 
RTE_ETH_FILTER_NOP
 = 0,

71 
RTE_ETH_FILTER_ADD
,

72 
RTE_ETH_FILTER_UPDATE
,

73 
RTE_ETH_FILTER_DELETE
,

74 
RTE_ETH_FILTER_FLUSH
,

75 
RTE_ETH_FILTER_GET
,

76 
RTE_ETH_FILTER_SET
,

77 
RTE_ETH_FILTER_INFO
,

78 
RTE_ETH_FILTER_STATS
,

79 
RTE_ETH_FILTER_OP_MAX


82 
	e¹e_mac_f‹r_ty³
 {

83 
RTE_MAC_PERFECT_MATCH
 = 1,

84 
RTE_MACVLAN_PERFECT_MATCH
,

85 
RTE_MAC_HASH_MATCH
,

86 
RTE_MACVLAN_HASH_MATCH
,

89 
	s¹e_‘h_‘h”ty³_f‹r
 {

90 
ušt8_t
 
mac_addr
[6];

91 
ušt16_t
 
	m‘h”_ty³
;

92 
ušt16_t
 
	mæags
;

93 
ušt16_t
 
	mqueue
;

100 
	s¹e_‘h_l2_æow
 {

101 
ušt16_t
 
	m‘h”_ty³
;

104 
	s¹e_‘h_Áu¶e_f‹r
 {

105 
ušt16_t
 
	mæags
;

106 
ušt32_t
 
	md¡_
;

107 
ušt32_t
 
	md¡__mask
;

108 
ušt32_t
 
	m¤c_
;

109 
ušt32_t
 
	m¤c__mask
;

110 
ušt16_t
 
	md¡_pÜt
;

111 
ušt16_t
 
	md¡_pÜt_mask
;

112 
ušt16_t
 
	m¤c_pÜt
;

113 
ušt16_t
 
	m¤c_pÜt_mask
;

114 
ušt8_t
 
	m´Ùo
;

115 
ušt8_t
 
	m´Ùo_mask
;

116 
ušt8_t
 
	mtı_æags
;

117 
ušt16_t
 
	m´iÜ™y
;

118 
ušt16_t
 
	mqueue
;

124 
	s¹e_‘h_v4_æow
 {

125 
ušt32_t
 
	m¤c_
;

126 
ušt32_t
 
	md¡_
;

127 
ušt8_t
 
	mtos
;

128 
ušt8_t
 
	m‰l
;

129 
ušt8_t
 
	m´Ùo
;

135 
	s¹e_‘h_udpv4_æow
 {

136 
¹e_‘h_v4_æow
 
	m
;

137 
ušt16_t
 
	m¤c_pÜt
;

138 
ušt16_t
 
	md¡_pÜt
;

144 
	s¹e_‘h_tıv4_æow
 {

145 
¹e_‘h_v4_æow
 
	m
;

146 
ušt16_t
 
	m¤c_pÜt
;

147 
ušt16_t
 
	md¡_pÜt
;

153 
	s¹e_‘h_sùpv4_æow
 {

154 
¹e_‘h_v4_æow
 
	m
;

155 
ušt16_t
 
	m¤c_pÜt
;

156 
ušt16_t
 
	md¡_pÜt
;

157 
ušt32_t
 
	mv”ify_g
;

163 
	s¹e_‘h_v6_æow
 {

164 
ušt32_t
 
	m¤c_
[4];

165 
ušt32_t
 
	md¡_
[4];

166 
ušt8_t
 
	mtc
;

167 
ušt8_t
 
	m´Ùo
;

168 
ušt8_t
 
	mhİ_lim™s
;

174 
	s¹e_‘h_udpv6_æow
 {

175 
¹e_‘h_v6_æow
 
	m
;

176 
ušt16_t
 
	m¤c_pÜt
;

177 
ušt16_t
 
	md¡_pÜt
;

183 
	s¹e_‘h_tıv6_æow
 {

184 
¹e_‘h_v6_æow
 
	m
;

185 
ušt16_t
 
	m¤c_pÜt
;

186 
ušt16_t
 
	md¡_pÜt
;

192 
	s¹e_‘h_sùpv6_æow
 {

193 
¹e_‘h_v6_æow
 
	m
;

194 
ušt16_t
 
	m¤c_pÜt
;

195 
ušt16_t
 
	md¡_pÜt
;

196 
ušt32_t
 
	mv”ify_g
;

202 
	s¹e_‘h_mac_vÏn_æow
 {

203 
ušt8_t
 
	mmac_addr
[6];

209 
	e¹e_‘h_fdœ_tuÂ–_ty³
 {

210 
	mRTE_FDIR_TUNNEL_TYPE_UNKNOWN
 = 0,

211 
	mRTE_FDIR_TUNNEL_TYPE_NVGRE
,

212 
	mRTE_FDIR_TUNNEL_TYPE_VXLAN
,

219 
	s¹e_‘h_tuÂ–_æow
 {

220 
¹e_‘h_fdœ_tuÂ–_ty³
 
	mtuÂ–_ty³
;

222 
ušt32_t
 
	mtuÂ–_id
;

223 
ušt8_t
 
	mmac_addr
[6];

230 
	u¹e_‘h_fdœ_æow
 {

231 
¹e_‘h_l2_æow
 
	ml2_æow
;

232 
¹e_‘h_udpv4_æow
 
	mudp4_æow
;

233 
¹e_‘h_tıv4_æow
 
	mtı4_æow
;

234 
¹e_‘h_sùpv4_æow
 
	msùp4_æow
;

235 
¹e_‘h_v4_æow
 
	m4_æow
;

236 
¹e_‘h_udpv6_æow
 
	mudp6_æow
;

237 
¹e_‘h_tıv6_æow
 
	mtı6_æow
;

238 
¹e_‘h_sùpv6_æow
 
	msùp6_æow
;

239 
¹e_‘h_v6_æow
 
	mv6_æow
;

240 
¹e_‘h_mac_vÏn_æow
 
	mmac_vÏn_æow
;

241 
¹e_‘h_tuÂ–_æow
 
	mtuÂ–_æow
;

247 
	s¹e_‘h_fdœ_æow_ext
 {

248 
ušt16_t
 
	mvÏn_tci
;

249 
ušt8_t
 
	mæexby‹s
[16];

251 
ušt8_t
 
	mis_vf
;

252 
ušt16_t
 
	md¡_id
;

256 
	s¹e_‘h_fdœ_šput
 {

257 
ušt16_t
 
	mæow_ty³
;

258 
¹e_‘h_fdœ_æow
 
	mæow
;

260 
¹e_‘h_fdœ_æow_ext
 
	mæow_ext
;

267 
	e¹e_‘h_fdœ_behaviÜ
 {

268 
	mRTE_ETH_FDIR_ACCEPT
 = 0,

269 
	mRTE_ETH_FDIR_REJECT
,

270 
	mRTE_ETH_FDIR_PASSTHRU
,

277 
	e¹e_‘h_fdœ_¡©us
 {

278 
	mRTE_ETH_FDIR_NO_REPORT_STATUS
 = 0,

279 
	mRTE_ETH_FDIR_REPORT_ID
,

280 
	mRTE_ETH_FDIR_REPORT_ID_FLEX_4
,

281 
	mRTE_ETH_FDIR_REPORT_FLEX_8
,

285 
	s¹e_‘h_fdœ_aùiÚ
 {

286 
ušt16_t
 
	mrx_queue
;

287 
¹e_‘h_fdœ_behaviÜ
 
	mbehaviÜ
;

288 
¹e_‘h_fdœ_¡©us
 
	m»pÜt_¡©us
;

289 
ušt8_t
 
	mæex_off
;

295 
	s¹e_‘h_fdœ_f‹r
 {

296 
ušt32_t
 
	msoá_id
;

298 
¹e_‘h_fdœ_šput
 
	mšput
;

299 
¹e_‘h_fdœ_aùiÚ
 
	maùiÚ
;

306 
	s¹e_‘h_fdœ_¡©s
 {

307 
ušt32_t
 
	mcŞlisiÚ
;

308 
ušt32_t
 
	mä“
;

309 
ušt32_t
 
	mmaxhash
;

312 
ušt32_t
 
	mmaxËn
;

313 
ušt64_t
 
	madd
;

314 
ušt64_t
 
	m»move
;

315 
ušt64_t
 
	mf_add
;

316 
ušt64_t
 
	mf_»move
;

317 
ušt32_t
 
	mgu¬ªt_út
;

318 
ušt32_t
 
	mbe¡_út
;

321 
	e¹e_fdœ_mode
 {

322 
	mRTE_FDIR_MODE_NONE
 = 0,

323 
	mRTE_FDIR_MODE_SIGNATURE
,

324 
	mRTE_FDIR_MODE_PERFECT
,

325 
	mRTE_FDIR_MODE_PERFECT_MAC_VLAN
,

326 
	mRTE_FDIR_MODE_PERFECT_TUNNEL
,

333 
	s¹e_‘h_fdœ_masks
 {

334 
ušt16_t
 
	mvÏn_tci_mask
;

336 
¹e_‘h_v4_æow
 
	mv4_mask
;

338 
¹e_‘h_v6_æow
 
	mv6_mask
;

340 
ušt16_t
 
	m¤c_pÜt_mask
;

342 
ušt16_t
 
	md¡_pÜt_mask
;

345 
ušt8_t
 
	mmac_addr_by‹_mask
;

347 
ušt32_t
 
	mtuÂ–_id_mask
;

348 
ušt8_t
 
	mtuÂ–_ty³_mask
;

356 
	s¹e_‘h_æex_·ylßd_cfg
 {

357 
¹e_‘h_·ylßd_ty³
 
	mty³
;

358 
ušt16_t
 
	m¤c_off£t
[16];

365 
	s¹e_‘h_fdœ_æex_mask
 {

366 
ušt16_t
 
	mæow_ty³
;

367 
ušt8_t
 
	mmask
[16];

371 
	s¹e_‘h_fdœ_æex_cÚf
 {

372 
ušt16_t
 
	mnb_·ylßds
;

373 
ušt16_t
 
	mnb_æexmasks
;

374 
¹e_‘h_æex_·ylßd_cfg
 
	mæex_£t
[
RTE_ETH_PAYLOAD_MAX
];

376 
¹e_‘h_fdœ_æex_mask
 
	mæex_mask
[
RTE_ETH_FLOW_MAX
];

387 
	s¹e_‘h_fdœ_šfo
 {

388 
¹e_fdœ_mode
 
	mmode
;

389 
¹e_‘h_fdœ_masks
 
	mmask
;

391 
¹e_‘h_fdœ_æex_cÚf
 
	mæex_cÚf
;

392 
ušt32_t
 
	mgu¬ªt_¥c
;

393 
ušt32_t
 
	mbe¡_¥c
;

395 
ušt32_t
 
	mæow_ty³s_mask
[1];

396 
ušt32_t
 
	mmax_æex·ylßd
;

399 
ušt32_t
 
	mæex_·ylßd_un™
;

402 
ušt32_t
 
	mmax_æex_·ylßd_£gm’t_num
;

406 
ušt16_t
 
	mæex_·ylßd_lim™
;

409 
ušt32_t
 
	mæex_b™mask_un™
;

411 
ušt32_t
 
	mmax_æex_b™mask_num
;

415 
¹e_‘h_dev_f‹r_ù¾
(
ušt8_t
 
pÜt_id
, 
¹e_f‹r_ty³
 
f‹r_ty³
, 
¹e_f‹r_İ
 
f‹r_İ
, * 
¬g
);

416 
fdœ_g‘_šfos
(
ušt32_t
 
pÜt_id
);

420 
loÿl
 
	gRTE_ETHTYPE_FLAGS_MAC
 = 1

421 
loÿl
 
RTE_ETHTYPE_FLAGS_DROP
 = 2

423 
loÿl
 
C
 = 
ffi
.C

426 
funùiÚ
 
dev
:
l2F‹r
(
‘y³
, 
queue
)

427 -- 
mlx5
 
ba£d
 
deviû
 dØ
nÙ
 
suµÜt
 
the
 
‘h”ty³
 
f‹r


428 
	g£lf
.
USE_GENERIC_FILTER
 
th’


429 
	g£lf
:
	$l2G’”icF‹r
(
‘y³
, 
queue
)

431 
	`ty³
(
queue
è=ğ"bË" 
th’


432 
queue
.
dev
.
id
 ~ğ
£lf
.id 
th’


433 
log
:
	`çl
("Queue must belongohe device being configured")

434 
’d


435 
queue
 = queue.
qid


436 
’d


437 
loÿl
 
æags
 = 0

438 
queue
 =ğ
£lf
.
DROP
 
th’


439 
æags
 = 
RTE_ETHTYPE_FLAGS_DROP


440 
log
:
	`”r
("DROP")

441 
’d


442 
loÿl
 
f‹r
 = 
ffi
.
	`Ãw
("¡ruù„‹_‘h_‘h”ty³_f‹r", { 
‘h”_ty³
 = 
‘y³
, 
æags
 = 0, 
queue
 = queu
	}
})

443 
loÿl
 
	gok
 = 
C
.
	$¹e_‘h_dev_f‹r_ù¾
(
£lf
.
id
, 
C
.
RTE_ETH_FILTER_ETHERTYPE
, C.
RTE_ETH_FILTER_ADD
, 
f‹r
)

444 
ok
 ~ğ0 
ªd
 ok ~ğ-38 
th’
 -- -38 
m—ns
 
du¶iÿ‹
 
f‹r
 
some
 
»asÚ


445 
log
:
	`w¬n
("l2 f‹¸”rÜ: " .. 
	$¡rE¼Ü
(
ok
))

446 
’d


447 
’d


448 
’d


451 --- 
F‹r
 
PTP
 
UDP
 
time¡amp
 
·ck‘s
 
by
 
š¥eùšg
 
the
 PTP 
v”siÚ
 
ªd
 
ty³
 
f›ld
.

452 --- 
Pack‘s
 
w™h
 
PTP
 
v”siÚ
 2 
¬e
 
m©ched
 w™h 
this
 
f‹r
.

453 --- 
You
 
ÿn
 
®so
 
u£
 
the
 
UDP
 
pÜt
 
to
 
f‹r
 
time¡am³d
 
·ck‘s
 
you
 dØ
nÙ
 
£nd
 
Ùh”


454 --- 
·ck‘s
 
to
 
this
 
pÜt
.

455 --- 
CautiÚ
: 
brok’
 
Ú
 
i40e
, 
£e
 i40e-
driv”
 
docs
 
ªd
 
time¡am³r
 
a
 
wÜk
-
¬ound


456 --- @
·¿m
 
queue
 
the
 queu
to
 
£nd
 
·ck‘s
o

457 --- @
·¿m
 
ty³
 
the
 
PTP
y³ 
to
 
look
 ,  = 0

458 --- @
·¿m
 
v”
 
the
 
PTP
 
v”siÚ
 
to
 
look
 ,  = 2

459 
funùiÚ
 
dev
:
	$f‹rUdpTime¡amps
(
queue
, 
±pTy³
, 
v”
)

460 
	`ty³
(
queue
è=ğ"bË" 
th’


461 
queue
 = queue.
qid


462 
’d


463 
queue
 =ğ0 
th’


465 
’d


466 
±pTy³
 =…Ty³ 
Ü
 0

467 
v”
 = v” 
Ü
 2

468 
loÿl
 
f‹r
 = 
ffi
.
	`Ãw
("struct„te_eth_fdir_filter", {

469 
soá_id
 = 1,

470 
šput
 = {

471 -- 
ex¶ic™ly
 
Úly
 
m©chšg
 
UDP
 
æows
 
h”e
 
would
 
be
 
b‘‹r


472 -- 
howev”
, 
this
 
is
 
no
 
lÚg”
 
possibË
 
w™h
 
the
 
dpdk
 2.x 
f‹r
 
­i
 :(

473 -- 
™
 
ÿn
 
no
 
lÚg”
 
m©ch
 
Úly
 
the
 
´ÙocŞ
 
ty³
 
ignÜšg
 
pÜt
 
numb”s
...

474 -- (
ªd
 
»cÚfiguršg
 
the
 
f‹r
 
pÜts
 
®l
h
time
 
is
 
ªnoyšg
)

475 
æow_ty³
 = 
dpdkc
.
RTE_ETH_FLOW_IPV4
,

476 
æow
 = {

478 
æow_ext
 = {

479 
vÏn_tci
 = 0,

480 
æexby‹s
 = {
±pTy³
, 
v”
},

481 
is_vf
 = 0,

482 
d¡_id
 = 0,

485 
aùiÚ
 = {

486 
rx_queue
 = 
queue


488 
	}
})

489 
loÿl
 
	g”r
 = 
C
.
	$¹e_‘h_dev_f‹r_ù¾
(
£lf
.
id
, 
C
.
RTE_ETH_FILTER_FDIR
, C.
RTE_ETH_FILTER_ADD
, 
f‹r
)

490 
	`checkDpdkE¼Ü
(
”r
, "setting fdir filter")

491 
’d


493 --- 
Pršts
 
®l
 
fdœ
 
f‹r
 
šfÜm©iÚs
 
debuggšg
 
pu½o£s
.

494 
funùiÚ
 
dev
:
	$dumpF‹rs
()

495 
C
.
	$fdœ_g‘_šfos
(
£lf
.
id
)

496 
’d


498 --- 
In¡®l
 
a
 5-
tu¶e
 
f‹r
 
Ú
 
the
 
NIC
.

499 --- @
·¿m
 
f‹r
, 
a
 
bË
 
cÚššg
 
the
 
fŞlowšg
 
f›lds


500 --- 
®l
 
h—d”
 
f›lds
  
to
 0 
nÙ
 
´ovided


501 --- 
®l
 
masks
 
to
‡Î 
b™s
 
£t
 
a
 
v®ue
 
is
 
´ovided
,Ø0 
Ùh”wi£


502 --- 
¤cIp
, 
d¡Ip
: 
IP
 
add»s£s
 
as
 
¡ršgs


503 --- 
¤cIpMask
, 
d¡IpMask
: 
IP
 
add»ss
 
masks
 
as
 
¡ršgs


504 --- 
¤cPÜt
, 
d¡PÜt
: 
L4
 
pÜts
 
as
 
numb”s


505 --- 
¤cPÜtMask
, 
d¡PÜtMask
: 
pÜt
 
masks


506 --- 
´Ùo
: 
the
 
L4
 
´ÙocŞ
 
id


507 --- 
´ÙoMask
: 
´ÙocŞ
 
mask


508 --- 
´iÜ™y
: 
the
 
f‹r
 
	`´iÜ™y
 (
£e
 
NIC
 
¥ecs
 
d‘as
),  = 1

509 --- @
·¿m
 
queue
 
the
 
rg‘
 
	$queue
 (
id
 
Ü
 
queue
 
objeù
)

510 
funùiÚ
 
dev
:
	$fiveTu¶eF‹r
(
f‹r
, 
queue
)

511 
loÿl
 
f‹r
 = 
ffi
.
	`Ãw
("struct„te_eth_ntuple_filter", {

512 
æags
 = 31, -- 
five
-
tu¶e


513 
d¡_
 = 
f‹r
.
d¡Ip
 
ªd
 
	`·r£IPAdd»ss
(f‹r.d¡Ipè
Ü
 0,

514 
d¡__mask
 = 
f‹r
.
d¡IpMask
 
ªd
 
	`·r£IPAdd»ss
(f‹r.d¡IpMaskè
Ü
 f‹r.
d¡Ip
‡nd 0xFFFFFFFF or 0,

515 
¤c_
 = 
f‹r
.
¤cIp
 
ªd
 
	`·r£IPAdd»ss
(f‹r.¤cIpè
Ü
 0,

516 
¤c__mask
 = 
f‹r
.
¤cIpMask
 
ªd
 
	`·r£IPAdd»ss
(f‹r.¤cIpMaskè
Ü
 f‹r.
¤cIp
‡nd 0xFFFFFFFF or 0,

517 
d¡_pÜt
 = 
f‹r
.
d¡PÜt
 
Ü
 0,

518 
d¡_pÜt_mask
 = 
f‹r
.
d¡PÜtMask
 
Ü
 f‹r.
d¡PÜt
 
ªd
 0xFFFF or 0,

519 
¤c_pÜt
 = 
f‹r
.
¤cPÜt
 
Ü
 0,

520 
¤c_pÜt_mask
 = 
f‹r
.
¤cPÜtMask
 
Ü
 f‹r.
¤cPÜt
 
ªd
 0xFFFF or 0,

521 
´Ùo
 = 
f‹r
.´ÙØ
Ü
 0,

522 
´Ùo_mask
 = 
f‹r
.
´ÙoMask
 
Ü
 f‹r.
´Ùo
 
ªd
 0xFF or 0,

523 
´iÜ™y
 = 
f‹r
.´iÜ™y 
Ü
 1,

524 
queue
 = 
	`ty³
(queueè=ğ"numb”" 
ªd
 queu
Ü
 queue.
qid


525 
	}
})

526 
loÿl
 
	g”r
 = 
C
.
	$¹e_‘h_dev_f‹r_ù¾
(
£lf
.
id
, 
C
.
RTE_ETH_FILTER_NTUPLE
, C.
RTE_ETH_FILTER_ADD
, 
f‹r
)

527  
	`checkDpdkE¼Ü
(
”r
, "setting 5tuple filter")

528 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/filter_GenericFlowAPI.lua

1 
loÿl
 
	gmod
 = {}

4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

5 
loÿl
 
log
 = 
»quœe
 "log"

6 
loÿl
 
deviû
 = 
»quœe
 "device"

7 
loÿl
 
‘h”c
 = 
»quœe
 "etherc"

8 
loÿl
 
h—d”c
 = 
»quœe
 "headerc"

10 
loÿl
 
dev
 = 
deviû
.
__deviûPrÙÙy³


12 
ffi
.
cdef
[[

14 
ušt16_t
 
¹e_be16_t
;

15 
ušt32_t
 
¹e_be32_t
;

16 
ušt64_t
 
¹e_be64_t
;

17 
ušt16_t
 
¹e_Ë16_t
;

18 
ušt32_t
 
¹e_Ë32_t
;

19 
ušt64_t
 
¹e_Ë64_t
;

61 
	s¹e_æow_©Œ
 {

62 
ušt32_t
 
group
;

63 
ušt32_t
 
´iÜ™y
;

64 
ušt32_t
 
šg»ss
:1;

65 
ušt32_t
 
eg»ss
:1;

66 
ušt32_t
 
»£rved
:30;

87 
	e¹e_æow_™em_ty³
 {

96 
RTE_FLOW_ITEM_TYPE_END
,

106 
RTE_FLOW_ITEM_TYPE_VOID
,

116 
RTE_FLOW_ITEM_TYPE_INVERT
,

124 
RTE_FLOW_ITEM_TYPE_ANY
,

139 
RTE_FLOW_ITEM_TYPE_PF
,

154 
RTE_FLOW_ITEM_TYPE_VF
,

169 
RTE_FLOW_ITEM_TYPE_PORT
,

176 
RTE_FLOW_ITEM_TYPE_RAW
,

183 
RTE_FLOW_ITEM_TYPE_ETH
,

190 
RTE_FLOW_ITEM_TYPE_VLAN
,

197 
RTE_FLOW_ITEM_TYPE_IPV4
,

204 
RTE_FLOW_ITEM_TYPE_IPV6
,

211 
RTE_FLOW_ITEM_TYPE_ICMP
,

218 
RTE_FLOW_ITEM_TYPE_UDP
,

225 
RTE_FLOW_ITEM_TYPE_TCP
,

232 
RTE_FLOW_ITEM_TYPE_SCTP
,

239 
RTE_FLOW_ITEM_TYPE_VXLAN
,

246 
RTE_FLOW_ITEM_TYPE_E_TAG
,

253 
RTE_FLOW_ITEM_TYPE_NVGRE
,

260 
RTE_FLOW_ITEM_TYPE_MPLS
,

267 
RTE_FLOW_ITEM_TYPE_GRE
,

279 
RTE_FLOW_ITEM_TYPE_FUZZY
,

293 
	s¹e_æow_™em_ªy
 {

294 
ušt32_t
 
num
;

315 
	s¹e_æow_™em_vf
 {

316 
ušt32_t
 
id
;

340 
	s¹e_æow_™em_pÜt
 {

341 
ušt32_t
 
šdex
;

363 
	s¹e_æow_™em_¿w
 {

364 
ušt32_t
 
»Ïtive
:1;

365 
ušt32_t
 
£¬ch
:1;

366 
ušt32_t
 
»£rved
:30;

367 
št32_t
 
off£t
;

368 
ušt16_t
 
lim™
;

369 
ušt16_t
 
Ëngth
;

370 
ušt8_t
 
·‰”n
[];

379 
	s¹e_æow_™em_‘h
 {

380 
‘h”_addr
 
	md¡
;

381 
‘h”_addr
 
	m¤c
;

382 
¹e_be16_t
 
	mty³
;

395 
	s¹e_æow_™em_vÏn
 {

396 
¹e_be16_t
 
	mid
;

397 
¹e_be16_t
 
	mtci
;

408 
	s¹e_æow_™em_v4
 {

409 
v4_hdr
 
	mhdr
;

420 
	s¹e_æow_™em_v6
 {

421 
v6_hdr
 
	mhdr
;

430 
	s¹e_æow_™em_icmp
 {

431 
icmp_hdr
 
	mhdr
;

440 
	s¹e_æow_™em_udp
 {

441 
udp_hdr
 
	mhdr
;

450 
	s¹e_æow_™em_tı
 {

451 
tı_hdr
 
	mhdr
;

460 
	s¹e_æow_™em_sùp
 {

461 
sùp_hdr
 
	mhdr
;

470 
	s¹e_æow_™em_vxÏn
 {

471 
ušt8_t
 
	mæags
;

472 
ušt8_t
 
	mrsvd0
[3];

473 
ušt8_t
 
	mvni
[3];

474 
ušt8_t
 
	mrsvd1
;

483 
	s¹e_æow_™em_e_g
 {

484 
¹e_be16_t
 
	mid
;

489 
¹e_be16_t
 
	m•ı_edei_š_ecid_b
;

491 
¹e_be16_t
 
	mrsvd_g½_ecid_b
;

492 
ušt8_t
 
	mš_ecid_e
;

493 
ušt8_t
 
	mecid_e
;

502 
	s¹e_æow_™em_nvg»
 {

509 
¹e_be16_t
 
	mc_k_s_rsvd0_v”
;

510 
¹e_be16_t
 
	m´ÙocŞ
;

511 
ušt8_t
 
	mŠi
[3];

512 
ušt8_t
 
	mæow_id
;

521 
	s¹e_æow_™em_m¶s
 {

525 
ušt8_t
 
	mÏb–_tc_s
[3];

526 
ušt8_t
 
	m‰l
;

535 
	s¹e_æow_™em_g»
 {

540 
¹e_be16_t
 
	mc_rsvd0_v”
;

541 
¹e_be16_t
 
	m´ÙocŞ
;

562 
	s¹e_æow_™em_fuzzy
 {

563 
ušt32_t
 
	mth»sh
;

600 
	s¹e_æow_™em
 {

601 
¹e_æow_™em_ty³
 
	mty³
;

602 cÚ¡ *
	m¥ec
;

603 cÚ¡ *
	mÏ¡
;

604 cÚ¡ *
	mmask
;

635 
	e¹e_æow_aùiÚ_ty³
 {

644 
	mRTE_FLOW_ACTION_TYPE_END
,

654 
	mRTE_FLOW_ACTION_TYPE_VOID
,

664 
	mRTE_FLOW_ACTION_TYPE_PASSTHRU
,

674 
	mRTE_FLOW_ACTION_TYPE_MARK
,

684 
	mRTE_FLOW_ACTION_TYPE_FLAG
,

691 
	mRTE_FLOW_ACTION_TYPE_QUEUE
,

700 
	mRTE_FLOW_ACTION_TYPE_DROP
,

712 
	mRTE_FLOW_ACTION_TYPE_COUNT
,

722 
	mRTE_FLOW_ACTION_TYPE_DUP
,

731 
	mRTE_FLOW_ACTION_TYPE_RSS
,

739 
	mRTE_FLOW_ACTION_TYPE_PF
,

747 
	mRTE_FLOW_ACTION_TYPE_VF
,

760 
	s¹e_æow_aùiÚ_m¬k
 {

761 
ušt32_t
 
	mid
;

771 
	s¹e_æow_aùiÚ_queue
 {

772 
ušt16_t
 
	mšdex
;

780 
	s¹e_æow_qu”y_couÁ
 {

781 
ušt32_t
 
	m»£t
:1;

782 
ušt32_t
 
	mh™s_£t
:1;

783 
ušt32_t
 
	mby‹s_£t
:1;

784 
ušt32_t
 
	m»£rved
:29;

785 
ušt64_t
 
	mh™s
;

786 
ušt64_t
 
	mby‹s
;

799 
	s¹e_æow_aùiÚ_dup
 {

800 
ušt16_t
 
	mšdex
;

815 
	s¹e_æow_aùiÚ_rss
 {

816 cÚ¡ 
¹e_‘h_rss_cÚf
 *
	mrss_cÚf
;

817 
ušt16_t
 
	mnum
;

818 
ušt16_t
 
	mqueue
[];

834 
	s¹e_æow_aùiÚ_vf
 {

835 
ušt32_t
 
	mÜigš®
:1;

836 
ušt32_t
 
	m»£rved
:31;

837 
ušt32_t
 
	mid
;

847 
	s¹e_æow_aùiÚ
 {

848 
¹e_æow_aùiÚ_ty³
 
	mty³
;

849 cÚ¡ *
	mcÚf
;

858 
	g¹e_æow
;

866 
	e¹e_æow_”rÜ_ty³
 {

867 
	mRTE_FLOW_ERROR_TYPE_NONE
,

868 
	mRTE_FLOW_ERROR_TYPE_UNSPECIFIED
,

869 
	mRTE_FLOW_ERROR_TYPE_HANDLE
,

870 
	mRTE_FLOW_ERROR_TYPE_ATTR_GROUP
,

871 
	mRTE_FLOW_ERROR_TYPE_ATTR_PRIORITY
,

872 
	mRTE_FLOW_ERROR_TYPE_ATTR_INGRESS
,

873 
	mRTE_FLOW_ERROR_TYPE_ATTR_EGRESS
,

874 
	mRTE_FLOW_ERROR_TYPE_ATTR
,

875 
	mRTE_FLOW_ERROR_TYPE_ITEM_NUM
,

876 
	mRTE_FLOW_ERROR_TYPE_ITEM
,

877 
	mRTE_FLOW_ERROR_TYPE_ACTION_NUM
,

878 
	mRTE_FLOW_ERROR_TYPE_ACTION
,

892 
	s¹e_æow_”rÜ
 {

893 
¹e_æow_”rÜ_ty³
 
	mty³
;

894 cÚ¡ *
	mÿu£
;

895 cÚ¡ *
	mmes§ge
;

949 
¹e_æow_v®id©e
(
ušt8_t
 
pÜt_id
,

950 cÚ¡ 
¹e_æow_©Œ
 *
©Œ
,

951 cÚ¡ 
¹e_æow_™em
 
·‰”n
[],

952 cÚ¡ 
¹e_æow_aùiÚ
 
aùiÚs
[],

953 
¹e_æow_”rÜ
 *
”rÜ
);

975 
¹e_æow
 *

976 
¹e_æow_ü—‹
(
ušt8_t
 
pÜt_id
,

977 cÚ¡ 
¹e_æow_©Œ
 *
©Œ
,

978 cÚ¡ 
¹e_æow_™em
 
·‰”n
[],

979 cÚ¡ 
¹e_æow_aùiÚ
 
aùiÚs
[],

980 
¹e_æow_”rÜ
 *
”rÜ
);

1003 
¹e_æow_de¡roy
(
ušt8_t
 
pÜt_id
,

1004 
¹e_æow
 *
æow
,

1005 
¹e_æow_”rÜ
 *
”rÜ
);

1024 
¹e_æow_æush
(
ušt8_t
 
pÜt_id
,

1025 
¹e_æow_”rÜ
 *
”rÜ
);

1052 
¹e_æow_qu”y
(
ušt8_t
 
pÜt_id
,

1053 
¹e_æow
 *
æow
,

1054 
¹e_æow_aùiÚ_ty³
 
aùiÚ
,

1055 *
d©a
,

1056 
¹e_æow_”rÜ
 *
”rÜ
);

1100 
¹e_æow_isŞ©e
(
ušt8_t
 
pÜt_id
, 
£t
, 
¹e_æow_”rÜ
 *
”rÜ
);

1108 
	s¹e_æow_desc
 {

1109 
size_t
 
	msize
;

1110 
¹e_æow_©Œ
 
	m©Œ
;

1111 
¹e_æow_™em
 *
	m™ems
;

1112 
¹e_æow_aùiÚ
 *
	maùiÚs
;

1113 
ušt8_t
 
	md©a
[];

1136 
size_t


1137 
¹e_æow_cİy
(
¹e_æow_desc
 *
fd
, 
size_t
 
Ën
,

1138 cÚ¡ 
¹e_æow_©Œ
 *
©Œ
,

1139 cÚ¡ 
¹e_æow_™em
 *
™ems
,

1140 cÚ¡ 
¹e_æow_aùiÚ
 *
aùiÚs
);

1146 
loÿl
 
	gC
 = 
ffi
.
C


1148 
loÿl
 
æowE¼Ü
 = {

1149 [
C
.
RTE_FLOW_ERROR_TYPE_NONE
] = "Noƒrror",

1150 [
C
.
RTE_FLOW_ERROR_TYPE_UNSPECIFIED
] = "Cause unspecified",

1151 [
C
.
RTE_FLOW_ERROR_TYPE_HANDLE
] = "Flow„ule (handle)",

1152 [
C
.
RTE_FLOW_ERROR_TYPE_ATTR_GROUP
] = "Group field",

1153 [
C
.
RTE_FLOW_ERROR_TYPE_ATTR_PRIORITY
] = "Priority field",

1154 [
C
.
RTE_FLOW_ERROR_TYPE_ATTR_INGRESS
] = "Ingress field",

1155 [
C
.
RTE_FLOW_ERROR_TYPE_ATTR_EGRESS
] = "Egress field",

1156 [
C
.
RTE_FLOW_ERROR_TYPE_ATTR
] = "Attributes structure",

1157 [
C
.
RTE_FLOW_ERROR_TYPE_ITEM_NUM
] = "Pattern†ength",

1158 [
C
.
RTE_FLOW_ERROR_TYPE_ITEM
] = "Specific…attern item",

1159 [
C
.
RTE_FLOW_ERROR_TYPE_ACTION_NUM
] = "Number of‡ctions",

1160 [
C
.
RTE_FLOW_ERROR_TYPE_ACTION
] = "Specific‡ction"

1164 --- 
G’”ic
 
f‹r
 
which
 
ÿn
 f‹¸
·ck‘s
 
by
 
theœ
 
	g‘h”ty³


1165 --- 
This
 
f‹r
 
ÿn
 
be
 
—sy
 
chªged
 
to
 
®so
 
m©ch
 
ba£d
 
Ú
 
IP
 
	gadd»s£s


1166 --- 
	gCautiÚ
: 
This
 
u£s
 
the
 
»Ïtivly
 
Ãw
 
f‹r
 
API
, 
™
 
might
 
be
 
unsuµÜ‹d
 
Ú
 
some
 
	gdeviûs


1167 --- @
·¿m
 
‘y³
 
the
 
‘h”ty³
 
to
 
be
 
m©ched
 (
ho¡
 
by‹
 
Üd”
 
com·b™y
)

1168 --- @
·¿m
 
queue
 
the
 
»c›ve
 queu
to
 
which
h
·ck‘
 
should
 
be
 
	gdœeùed


1169 --- @
·¿m
 
‘y³mask
 
®l
 
unmasked
 
b™s
 
ÿn
 
have
 
ªy
 
	gv®ues
,  = 0xfffà(
³rãù
 
m©chšg
è(
ho¡
 
by‹
 
Üd”
)

1170 --- @
·¿m
 
´iÜ™y
 
the
…riÜ™y 
w™hš
 
a
 
group
, 0 
is
 
highe¡
 
	g´iÜ™y
,  0

1171 --- @
·¿m
 
group
 
®l
 
groups
 
¬e
 
checked
 
squ’tŸÎy
 
¡¬tšg
 
w™h
 
	ggroup
 0,  0

1172 
funùiÚ
 
	gdev
:
	$l2G’”icF‹r
(
‘y³
, 
queue
, 
‘y³mask
, 
´iÜ™y
, 
group
)

1173 
log
:
	`šfo
("Using generic filter")

1174 
	`ty³
(
queue
è=ğ"bË" 
th’


1175 
queue
.
dev
.
id
 ~ğ
£lf
.id 
th’


1176 
log
:
	`çl
("Queue must belongohe device being configured")

1177 
’d


1178 
queue
 = queue.
qid


1179 
’d


1181 
´iÜ™y
 =…riÜ™y 
Ü
 0

1182 
group
 = grou°
Ü
 0

1183 
‘y³mask
 =ƒty³mask 
Ü
 0xffff

1185 
queue
 =ğ
£lf
.
DROP
 
th’


1186 
æags
 = 
RTE_ETHTYPE_FLAGS_DROP


1187 
log
:
	`”r
("DROP")

1188 
’d


1190 -- 
£t
 
©Œibu‹s


1191 -- 
mÜe
 
thª
 
Úe
 
group
 
ªd
 
´iÜ™y
 
might
 
be
 
unsuµÜ‹d


1192 
loÿl
 
æow_©Œ
 = 
ffi
.
	`Ãw
("¡ruù„‹_æow_©Œ", { 
group
 = group, 
´iÜ™y
 =…riÜ™y, 
šg»ss
 = 1, 
eg»ss
 = 0, 
»£rved
 = 0 
	}
})

1194 -- 
£t
 
­´İrŸ‹
 
aùiÚs


1195 
loÿl
 
	gaùiÚ_¬¿y
 = 
ffi
.
Ãw
("struct„te_flow_action[2]", {

1196 
ffi
.
Ãw
("struct„te_flow_action",

1198 
ty³
 = 
C
.
RTE_FLOW_ACTION_TYPE_QUEUE
,

1199 
cÚf
 = 
ffi
.
Ãw
("¡ruù„‹_æow_aùiÚ_queue", { 
šdex
 = 
queue
 })

1201 
ffi
.
Ãw
("¡ruù„‹_æow_aùiÚ", { 
ty³
 = 
C
.
RTE_FLOW_ACTION_TYPE_END
 })

1204 -- 
£t
 
the
 
æow
 
™ems
 (
f‹rs
)

1205 -- 
we
 dØ
nÙ
 
wªt
 
to
 
m©ch
 
ba£d
 
Ú
 
IP
 
	gadd»s£s
,  
of
 
the
 
æow
 
API
 
would
 
be
 
³rãù
 
m©chšg


1206 
loÿl
 
	g‘h”_addr
 = 
ffi
.
Ãw
("¡ruùƒth”_addr", { 
addr_by‹s
 = "\x00\x00\x00\x00\x00\x00" })

1208 
loÿl
 
	g™em_¬¿y
 = 
ffi
.
Ãw
("struct„te_flow_item[2]", {

1209 
ffi
.
Ãw
("struct„te_flow_item", {

1210 
ty³
 = 
C
.
RTE_FLOW_ITEM_TYPE_ETH
,

1211 -- 
š‹»¡šg
 
»asÚs
 
we
 
mu¡
 
cÚv”t
 
‘y³
 
to
 
ÃtwÜk
 
by‹
 
Üd”
 
ªd
 mu¡ 
nÙ
 dØ
the
 
§me
 
‘y³mask


1212 
¥ec
 = 
ffi
.
Ãw
("¡ruù„‹_æow_™em_‘h", { 
d¡
 = 
‘h”_addr
, 
¤c
 =ƒth”_addr, 
ty³
 = 
htÚ16
(
‘y³
) }),

1213 
mask
 = 
ffi
.
Ãw
("¡ruù„‹_æow_™em_‘h", { 
d¡
 = 
‘h”_addr
, 
¤c
 =ƒth”_addr, 
ty³
 = 
‘y³mask
 })

1215 
ffi
.
Ãw
("¡ruù„‹_æow_™em", { 
ty³
 = 
C
.
RTE_FLOW_ITEM_TYPE_END
 })

1218 -- 
”rÜ
 

1219 
loÿl
 
	gæow_”rÜ
 = 
ffi
.
Ãw
("struct„te_flow_error")

1221 
loÿl
 
ok
 = 
C
.
	$¹e_æow_v®id©e
(
£lf
.
id
, 
æow_©Œ
, 
™em_¬¿y
, 
aùiÚ_¬¿y
, 
æow_”rÜ
)

1222 
ok
 ~ğ0 
th’


1223 
log
:
	`w¬n
("F‹¸v®id©iÚ faed. Ex™ code: " .. 
ok
 .. ". RoÙ cau£: " .. 
æowE¼Ü
[
	`tÚumb”
(
æow_”rÜ
.
ty³
)])

1224 
æow_”rÜ
.
mes§ge
 ~ğ
n
 
th’


1225 
log
:
	`w¬n
("Error message:")

1226 
log
:
	`w¬n
("\t" .. 
ffi
.
	$¡ršg
(
æow_”rÜ
.
mes§ge
))

1227 
’d


1228 
’d


1229 
ok
 =ğ0 
th’


1230 
log
:
	`šfo
("Setting up filter")

1231 
loÿl
 
hªdË
 = 
C
.
	$¹e_æow_ü—‹
(
£lf
.
id
, 
æow_©Œ
, 
™em_¬¿y
, 
aùiÚ_¬¿y
, 
æow_”rÜ
)

1232 
log
:
	`šfo
Ğ
hªdË
 ~ğ
n
 
ªd
 
	`g»’
("SUCCESS"è
Ü
 
	`»d
("FAILED") )

1233 
’d


1234 
’d


1237 --- 
G’”ic
 
f‹r
 
which
 
ÿn
 f‹¸
UDP
 
ov”
 
IPv4
 
·ck‘s


1238 --- 
S“
 
the
 
£ùiÚs
 
which
 
w”e
 
comm’‹d
 
out
 
mÜe
 
exaù
 
m©chšg


1239 --- 
CautiÚ
: 
This
 
u£s
 
the
 
»Ïtivly
 
Ãw
 
f‹r
 
API
, 
™
 
might
 
be
 
unsuµÜ‹d
 
Ú
 
some
 
deviûs


1240 --- @
·¿m
 
queue
 
the
 
»c›ve
 queu
to
 
which
h
·ck‘
 
should
 
be
 
dœeùed


1241 --- @
·¿m
 
´iÜ™y
 
the
…riÜ™y 
w™hš
 
a
 
group
, 0 
is
 
highe¡
…riority,  0

1242 --- @
·¿m
 
group
 
®l
 
groups
 
¬e
 
checked
 
squ’tŸÎy
 
¡¬tšg
 
w™h
 group 0,  0

1243 
funùiÚ
 
dev
:
	$UdpG’”icF‹r
(
queue
, 
´iÜ™y
, 
group
)

1244 
log
:
	`šfo
("Using generic filter")

1245 
	`ty³
(
queue
è=ğ"bË" 
th’


1246 
queue
.
dev
.
id
 ~ğ
£lf
.id 
th’


1247 
log
:
	`çl
("Queue must belongohe device being configured")

1248 
’d


1249 
queue
 = queue.
qid


1250 
’d


1252 
´iÜ™y
 =…riÜ™y 
Ü
 0

1253 
group
 = grou°
Ü
 0

1255 
queue
 =ğ
£lf
.
DROP
 
th’


1256 
æags
 = 
RTE_ETHTYPE_FLAGS_DROP


1257 
log
:
	`”r
("DROP")

1258 
’d


1260 -- 
£t
 
©Œibu‹s


1262 
loÿl
 
æow_©Œ
 = 
ffi
.
	`Ãw
("¡ruù„‹_æow_©Œ", { 
group
 = 0, 
´iÜ™y
 =…riÜ™y, 
šg»ss
 = 1, 
eg»ss
 = 0, 
»£rved
 = 0 
	}
})

1264 -- 
£t
 
­´İrŸ‹
 
aùiÚs


1265 
loÿl
 
	gaùiÚ_¬¿y
 = 
ffi
.
Ãw
("struct„te_flow_action[2]", {

1266 
ffi
.
Ãw
("struct„te_flow_action",

1268 
ty³
 = 
C
.
RTE_FLOW_ACTION_TYPE_QUEUE
,

1269 
cÚf
 = 
ffi
.
Ãw
("¡ruù„‹_æow_aùiÚ_queue", { 
šdex
 = 
queue
 })

1271 
ffi
.
Ãw
("¡ruù„‹_æow_aùiÚ", { 
ty³
 = 
C
.
RTE_FLOW_ACTION_TYPE_END
 })

1274 -- 
some
 
NICs
 
may
 
suµÜt
 
om™tšg
 
und”lyšg
 
	gÏy”s
, 
	ge
.
	gg
. 
ju¡
 
u£
 
	gUDP
, 
END
 
š¡—d
 
of
 
	gETH
, 
	gIPV4
, UDP, 
	gEND


1275 -- 
©
 
Ëa¡
 
the
 
	gCÚÃùX4
-
Lx
 
this
 
is
 
nÙ
 
suµÜ‹d
 
ªd
 
»suÉs
 
š
 
ª
 
unsuµÜ‹d
 
™em
 
”rÜ
 
which
 i 
mi¦—dšg


1276 
loÿl
 
	g™em_¬¿y
 = 
ffi
.
Ãw
("struct„te_flow_item[4]", {

1277 
ffi
.
Ãw
("¡ruù„‹_æow_™em", {
ty³
 = 
C
.
RTE_FLOW_ITEM_TYPE_ETH
}),

1278 
ffi
.
Ãw
("¡ruù„‹_æow_™em", {
ty³
 = 
C
.
RTE_FLOW_ITEM_TYPE_IPV4
}),

1279 
ffi
.
Ãw
("struct„te_flow_item", {

1280 
ty³
 = 
C
.
RTE_FLOW_ITEM_TYPE_UDP
,

1282 -- 
uncomm’t
 
this
 
£ùiÚ
 
mÜe
 
¥ecific
 
f‹ršg


1283 -- 
¥ec
 = 
ffi
.
Ãw
("struct„te_flow_item_ipv4", {

1284 -- 
hdr
 = {

1285 -- 
¤c_pÜt
 = 0x0000,

1286 -- 
d¡_pÜt
 = 0x0000,

1287 -- 
dg¿m_Ën
 = 0x0000,

1288 -- 
dg¿m_cksum
 = 0x0000

1291 -- 
mask
 = 
ffi
.
Ãw
("struct„te_flow_item_udp", {

1292 -- 
hdr
 = {

1293 -- 
¤c_pÜt
 = 0x0000,

1294 -- 
d¡_pÜt
 = 0x0000,

1295 -- 
dg¿m_Ën
 = 0x0000,

1296 -- 
dg¿m_cksum
 = 0x0000

1300 
ffi
.
Ãw
("¡ruù„‹_æow_™em", { 
ty³
 = 
C
.
RTE_FLOW_ITEM_TYPE_END
 })

1303 -- 
”rÜ
 

1304 
loÿl
 
	gæow_”rÜ
 = 
ffi
.
Ãw
("struct„te_flow_error")

1306 
loÿl
 
ok
 = 
C
.
	$¹e_æow_v®id©e
(
£lf
.
id
, 
æow_©Œ
, 
™em_¬¿y
, 
aùiÚ_¬¿y
, 
æow_”rÜ
)

1307 
ok
 ~ğ0 
th’


1308 
log
:
	`w¬n
("F‹¸v®id©iÚ faed. Ex™ code: " .. 
ok
 .. ". RoÙ cau£: " .. 
æowE¼Ü
[
	`tÚumb”
(
æow_”rÜ
.
ty³
)])

1309 
æow_”rÜ
.
mes§ge
 ~ğ
n
 
th’


1310 
log
:
	`w¬n
("Error message:")

1311 
log
:
	`w¬n
("\t" .. 
ffi
.
	$¡ršg
(
æow_”rÜ
.
mes§ge
))

1312 
’d


1313 
’d


1314 
ok
 =ğ0 
th’


1315 
log
:
	`šfo
("Setting up filter")

1316 
loÿl
 
hªdË
 = 
C
.
	$¹e_æow_ü—‹
(
£lf
.
id
, 
æow_©Œ
, 
™em_¬¿y
, 
aùiÚ_¬¿y
, 
æow_”rÜ
)

1317 
log
:
	`šfo
Ğ
hªdË
 ~ğ
n
 
ªd
 
	`g»’
("SUCCESS"è
Ü
 
	`»d
("FAILED") )

1318 
’d


1319 
’d


1322  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/filter_ixgbe.lua

2 --- @
fe
 
	gf‹r_ixgbe
.
	glua


3 --- @
br›f
 
F‹r
 
	gIXGBE
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 
loÿl
 
	gmod
 = {}

9 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

10 
loÿl
 
deviû
 = 
»quœe
 "device"

11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

13 
loÿl
 
mb™mask
 = 
»quœe
 "bitmask"

14 
loÿl
 
”r
 = 
»quœe
 "error"

15 
loÿl
 
log
 = 
»quœe
 "log"

17 
loÿl
 
ETQF_BASE
 = 0x00005128

18 
loÿl
 
ETQS_BASE
 = 0x0000EC00

20 
loÿl
 
ETQF_FILTER_ENABLE
 = 
b™
.
	$lshiá
(1, 31)

21 
loÿl
 
ETQF_IEEE_1588_TIME_STAMP
 = 
b™
.
	$lshiá
(1, 30)

23 
loÿl
 
ETQS_RX_QUEUE_OFFS
 = 16

24 
loÿl
 
ETQS_QUEUE_ENABLE
 = 
b™
.
	$lshiá
(1, 31)

26 
loÿl
 
ETQF
 = {
	}
}

27 
i
 = 0, 7 do

28 
	gETQF
[
i
] = 
ETQF_BASE
 + 4 * i

29 
’d


30 
loÿl
 
ETQS
 = {}

31 
i
 = 0, 7 do

32 
	gETQS
[
i
] = 
ETQS_BASE
 + 4 * i

33 
’d


35 
ffi
.
cdef
[[

36 
	s¹e_5tu¶e_f‹r
 {

37 
ušt32_t
 
d¡_
;

38 
ušt32_t
 
¤c_
;

39 
ušt16_t
 
d¡_pÜt
;

40 
ušt16_t
 
¤c_pÜt
;

41 
ušt8_t
 
´ÙocŞ
;

42 
ušt8_t
 
tı_æags
;

43 
ušt16_t
 
´iÜ™y
;

45 
ušt8_t
 
d¡__mask
:1,

46 
¤c__mask
:1,

47 
d¡_pÜt_mask
:1,

48 
¤c_pÜt_mask
:1,

49 
´ÙocŞ_mask
:1;

52 
¹e_‘h_dev_add_5tu¶e_f‹r
 ( 
ušt8_t
 
pÜt_id
,

53 
ušt16_t
 
šdex
,

54 
¹e_5tu¶e_f‹r
 * 
f‹r
,

55 
ušt16_t
 
rx_queue


58 
mg_5tu¶e_add_HWf‹r_ixgbe
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
šdex
,

59 
¹e_5tu¶e_f‹r
 *
f‹r
, 
ušt16_t
 
rx_queue
);

62 
funùiÚ
 
	gmod
.
	$l2F‹r
(
dev
, 
‘y³
, 
queue
)

63 
queue
 =ğ-1 
th’


64 
queue
 = 127

65 
’d


66 
dpdkc
.
	`wr™e_»g32
(
dev
.
id
, 
ETQF
[1], 
b™
.
	$bÜ
(
ETQF_FILTER_ENABLE
, 
‘y³
))

67 
dpdkc
.
	`wr™e_»g32
(
dev
.
id
, 
ETQS
[1], 
b™
.
	`bÜ
(
ETQS_QUEUE_ENABLE
, b™.
	$lshiá
(
queue
, 
ETQS_RX_QUEUE_OFFS
)))

68 
’d


70 --- 
In¡®ls
 
a
 5
tu¶e
 
f‹r
 
Ú
 
the
 
deviû
.

71 --- 
M©chšg
 
·ck‘s
 
wl
 
be
 
»dœeùed
 
što
 
the
 
¥ecif›d
 
rx
 
queue


72 --- 
NOTE
: 
this
 
is
 
cu¼’y
 
Úly
 
‹¡ed
 
X540
 
NICs
, 
ªd
 
wl
 
´obably
 
®so


73 --- 
wÜk
 82599 
ªd
 
Ùh”
 
ixgbe
 
NICs
. 
U£
 
Ú
 oth” NIC 
might
 
»suÉ
 
š


74 --- 
undefšed
 
behaviÜ
.

75 --- @
·¿m
 
f‹r
 
A
 
bË
 
desüibšg
 
the
 f‹r. 
PossibË
 
f›lds
 
¬e


76 --- 
¤c_
 : 
Sourche
 
IPv4
 
Add»ss


77 --- 
d¡_
 : 
De¡š©iÚ
 
IPv4
 
Add»ss


78 --- 
¤c_pÜt
 : 
Sourû
 
L4
 
pÜt


79 --- 
d¡_pÜt
 : 
De¡š©iÚ
 
L4
 
pÜt


80 --- 
l4´ÙocŞ
: 
L4
 
PrÙocŞ
 
ty³


81 --- 
suµÜ‹d
 
´ÙocŞs
: 

.
PROTO_ICMP
, ip.
PROTO_TCP
, ip.
PROTO_UDP


82 --- 
If
 
a
 
nÚ
 
suµÜ‹d
 
ty³
 
is
 
giv’
, 
the
 
f‹r
 
wl
 
Úly
 
m©ch
 
Ú


83 --- 
´ÙocŞs
, 
which
 
¬e
 
nÙ
 
suµÜ‹d
.

84 --- 
AÎ
 
f›lds
 
¬e
 
İtiÚ®
.

85 --- 
If
 
a
 
f›ld
 
is
 
nÙ
 
´e£Á
, 
Ü
 
n
, 
the
 
f‹r
 
wl
 
ignÜe
 
this
 f›ld 
wh’


86 --- 
checkšg
 
a
 
m©ch
.

87 --- @
·¿m
 
queue
 
RX
 
Queue
, 
wh”e
 
·ck‘s
, 
m©chšg
 
this
 
f‹r
 
wl
 
be
 
»dœeùed


88 --- @
·¿m
 
´iÜ™y
 
	$İtiÚ®
 ( = 1è
The
 
´iÜ™y
 
of
 
this
 
f‹r
 
ruË
.

89 --- 7 
is
 
the
 
highe¡
 
´iÜ™y
 
ªd
 1h
lowe¡
…riority.

90 
funùiÚ
 
mod
.
	$addHW5tu¶eF‹r
(
dev
, 
f‹r
, 
queue
, 
´iÜ™y
)

91 
loÿl
 
sf‹r
 = 
ffi
.
	`Ãw
("struct„te_5tuple_filter")

92 
sf‹r
.
¤c__mask
 = (
f‹r
.
¤c_
 =ğ
n
è
ªd
 1 
Ü
 0

93 
sf‹r
.
d¡__mask
 = (
f‹r
.
d¡_
 =ğ
n
è
ªd
 1 
Ü
 0

94 
sf‹r
.
¤c_pÜt_mask
 = (
f‹r
.
¤c_pÜt
 =ğ
n
è
ªd
 1 
Ü
 0

95 
sf‹r
.
d¡_pÜt_mask
 = (
f‹r
.
d¡_pÜt
 =ğ
n
è
ªd
 1 
Ü
 0

96 
sf‹r
.
´ÙocŞ_mask
 = (
f‹r
.
l4´ÙocŞ
 =ğ
n
è
ªd
 1 
Ü
 0

98 
sf‹r
.
´iÜ™y
 =…riÜ™y 
Ü
 1

99 if(
sf‹r
.
´iÜ™y
 > 7 
Ü
 sf‹r.´iÜ™y < 1è
th’


100 
log
:
	`çl
("Filter…riority haso be‡‚umber from 1o 7")

102 
’d


104 
sf‹r
.
¤c_
 = 
f‹r
.¤c_ 
Ü
 0

105 
sf‹r
.
d¡_
 = 
f‹r
.d¡_ 
Ü
 0

106 
sf‹r
.
¤c_pÜt
 = 
f‹r
.¤c_pÜˆ
Ü
 0

107 
sf‹r
.
d¡_pÜt
 = 
f‹r
.d¡_pÜˆ
Ü
 0

108 
sf‹r
.
´ÙocŞ
 = 
f‹r
.
l4´ÙocŞ
 
Ü
 0

109 --ià(
f‹r
.
l4´ÙocŞ
è
th’


110 -- 
´št
 "[WARNING] Protocol filter‚ot yet fully implemented‡ndested"

111 --
’d


113 
dev
.
f‹rs5Tu¶e
 =ğ
n
 
th’


114 
dev
.
f‹rs5Tu¶e
 = {
	}
}

115 
dev
.
f‹rs5Tu¶e
.
n
 = 0

116 
’d


117 
dev
.
f‹rs5Tu¶e
[dev.f‹rs5Tu¶e.
n
] = 
sf‹r


118 
loÿl
 
idx
 = 
dev
.
f‹rs5Tu¶e
.
n


119 
dev
.
f‹rs5Tu¶e
.
n
 = dev.filters5Tuple.n + 1

121 
loÿl
 
¡©e


122 ià(
dev
:
g‘PciId
(è=ğ
deviû
.
PCI_ID_X540
è
th’


123 -- 
TODO
: 
wr™e
 
a
 
´İ”
 
·tch
 
dpdk


124 
¡©e
 = 
ffi
.
C
.
	$mg_5tu¶e_add_HWf‹r_ixgbe
(
dev
.
id
, 
idx
, 
sf‹r
, 
queue
.
qid
)

126 
¡©e
 = 
ffi
.
C
.
	$¹e_‘h_dev_add_5tu¶e_f‹r
(
dev
.
id
, 
idx
, 
sf‹r
, 
queue
.
qid
)

127 
’d


129 ià(
¡©e
 ~ğ0è
th’


130 
log
:
	`çl
("F‹¸nÙ sucûssfuÎy‡dded: %s", 
”r
.
	`g‘¡r
(-
¡©e
))

131 
’d


133  
idx


134 
’d


136  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/graphite.lua

1 --- 
Ouut
 
d©a
 
to
 
g¿ph™e


2 
loÿl
 
	gmod
 = {}

4 
loÿl
 
log
 = 
»quœe
 "log"

5 
loÿl
 
S
 = 
»quœe
 "syscall"

6 
loÿl
 
ffi
 = 
»quœe
 "ffi"

7 
loÿl
 
C
 = 
ffi
.C

9 
ffi
.
cdef
[[

10 
	sho¡’t
 {

11 *
h_Çme
;

12 **
h_®Ÿ£s
;

13 
h_add¹y³
;

14 
h_Ëngth
;

15 
ušt8_t
 **
h_addr_li¡
;

17 
ho¡’t
 *
g‘ho¡byÇme
(cÚ¡ *
Çme
);

20 
loÿl
 
	gwr™”
 = {}

21 
wr™”
.
__šdex
 = writer

23 --- 
C»©e
 
a
 
Ãw
 
TCP
 
wr™”
 
th©
 
ãeds
 
G¿ph™e
 
vŸ
 
the
 
¶aš‹xt
 
´ÙocŞ
.

24 -- @
·¿m
 
rg‘
, 
de¡š©iÚ
 
ho¡
 
ªd
 
	gpÜt


25 -- @
·¿m
 
	g´efix
, 
´efix
 
th©
 
wl
 
be
 
´•’ded
 
to
 
—ch
 
m‘ric
 
Çme


26 
funùiÚ
 
	gmod
.
	$ÃwWr™”
(
rg‘
, 
´efix
)

27 
loÿl
 
obj
 = 
	`£tm‘©abË
({

28 
´efix
 =…refix

29 
	}
}, 
	gwr™”
)

30 
	gobj
:
	$cÚÃù
(
rg‘
)

31  
obj


32 
’d


34 
funùiÚ
 
wr™”
:
	$cÚÃù
(
rg‘
)

35 
loÿl
 
ho¡
, 
pÜt
, 



36 
rg‘
:
	`m©ch
(":"è
th’


37 
ho¡
, 
pÜt
 = 
rg‘
:
	`m©ch
("^([^:]+):([^:]+)$")

38 
nÙ
 
ho¡
 
Ü
‚Ù 
pÜt
 
th’


39 
log
:
	`çl
("could‚ot…arsearget, format is host[:port]")

40 
’d


42 
ho¡
 = 
rg‘


43 
’d


44 -- 
TODO
: 
v6


45 
	$·r£IP4Add»ss
(
ho¡
è
th’


46 

 = 
ho¡


48 
loÿl
 
ho¡EÁ
 = 
C
.
	$g‘ho¡byÇme
(
ho¡
)

49 
nÙ
 
ho¡EÁ
 
Ü
 ho¡EÁ.
h_Ëngth
 < 1 
th’


50 
log
:
	`çl
("could‚Ù„esŞv%s", 
ho¡
)

51 
’d


52 

 = ("%d.%d.%d.%d"):
	$fÜm©
(
ho¡EÁ
.
h_addr_li¡
[0][0], hostEnt.h_addr_list[0][1], hostEnt.h_addr_list[0][2], hostEnt.h_addr_list[0][3])

53 
’d


54 
pÜt
 = 
	`tÚumb”
ÕÜˆ
Ü
 "") or 2003

55 
£lf
.
sock‘
 = 
S
.
	`sock‘
("inet", "stream")

56 
loÿl
 
§
 = 
S
.
t
.
	$sockaddr_š
(
pÜt
, 

)

57 
loÿl
 
ok
, 
”r
 = 
S
.
	$cÚÃù
(
£lf
.
sock‘
, 
§
)

58 
nÙ
 
ok
 
th’


59 
log
:
	`”rÜ
("could‚Ù cÚÃùØ%s: %s", 
rg‘
, 
”r
)

60 
’d


61 
’d


63 --- 
Wr™e
 
a
 
d©a
 
pošt
 
to
 
g¿ph™e
.

64 --- @
·¿m
 
m‘ric
 
the
 m‘riø
Çme
 
to
 
wr™e


65 --- @
·¿m
 
the
 
v®ue
 
to
 
wr™e


66 -- 
TODO
: 
check
 
sock‘
 
d›d
 
ªd
 
Œy
 
to
 
»cÚÃù


67 
funùiÚ
 
wr™”
:
	$wr™e
(
m‘ric
, 
v®ue
)

68 
loÿl
 
¡r
 = 
£lf
.
´efix
 
ªd
 s–f.´efix .. "." 
Ü
 ""

69 
¡r
 = sŒ .. ("% %.18à%d\n"):
	`fÜm©
(
m‘ric
, 
	$tÚumb”
(
v®ue
è
Ü
 0, 
	$time
())

70 
£lf
.
sock‘
:
	$wr™e
(
¡r
)

71 
’d


74  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/headerc.lua

2 --- @
fe
 
	gh—d”c
.
	glua


3 --- @
br›f
 
SŒuùu»s
 
ªd
 
	$funùiÚs
 (
checksum
 
computiÚ
è
»Ï‹d
 
to
 
h—d”s


6 
loÿl
 
ffi
 = 
»quœe
 "ffi"

8 
ffi
.
cdef
[[

22 
	sv4_hdr
 {

23 
ušt8_t
 
v”siÚ_ihl
;

24 
ušt8_t
 
ty³_of_£rviû
;

25 
ušt16_t
 
tÙ®_Ëngth
;

26 
ušt16_t
 
·ck‘_id
;

27 
ušt16_t
 
äagm’t_off£t
;

28 
ušt8_t
 
time_to_live
;

29 
ušt8_t
 
Ãxt_´Ùo_id
;

30 
ušt16_t
 
hdr_checksum
;

31 
ušt32_t
 
¤c_addr
;

32 
ušt32_t
 
d¡_addr
;

33 } 
	`__©Œibu‹__
((
__·cked__
));

39 
	sv6_hdr
 {

40 
ušt32_t
 
vtc_æow
;

41 
ušt16_t
 
·ylßd_Ën
;

42 
ušt8_t
 
´Ùo
;

43 
ušt8_t
 
hİ_lim™s
;

44 
ušt8_t
 
¤c_addr
[16];

45 
ušt8_t
 
d¡_addr
[16];

46 } 
	`__©Œibu‹__
((
__·cked__
));

52 
	sicmp_hdr
 {

53 
ušt8_t
 
icmp_ty³
;

54 
ušt8_t
 
icmp_code
;

55 
ušt16_t
 
icmp_cksum
;

56 
ušt16_t
 
icmp_id’t
;

57 
ušt16_t
 
icmp_£q_nb
;

58 } 
	`__©Œibu‹__
((
__·cked__
));

64 
	sudp_hdr
 {

65 
ušt16_t
 
¤c_pÜt
;

66 
ušt16_t
 
d¡_pÜt
;

67 
ušt16_t
 
dg¿m_Ën
;

68 
ušt16_t
 
dg¿m_cksum
;

69 } 
	`__©Œibu‹__
((
__·cked__
));

75 
	stı_hdr
 {

76 
ušt16_t
 
¤c_pÜt
;

77 
ušt16_t
 
d¡_pÜt
;

78 
ušt32_t
 
£Á_£q
;

79 
ušt32_t
 
»cv_ack
;

80 
ušt8_t
 
d©a_off
;

81 
ušt8_t
 
tı_æags
;

82 
ušt16_t
 
rx_wš
;

83 
ušt16_t
 
cksum
;

84 
ušt16_t
 
tı_u½
;

85 } 
	`__©Œibu‹__
((
__·cked__
));

91 
	ssùp_hdr
 {

92 
ušt16_t
 
¤c_pÜt
;

93 
ušt16_t
 
d¡_pÜt
;

94 
ušt32_t
 
g
;

95 
ušt32_t
 
cksum
;

96 } 
	`__©Œibu‹__
((
__·cked__
));

113 
šlše
 
ušt16_t


114 
	`¹e_¿w_cksum
(cÚ¡ *
buf
, 
size_t
 
Ën
);

131 
šlše
 

132 
	`¹e_¿w_cksum_mbuf
(cÚ¡ 
¹e_mbuf
 *
m
, 
ušt32_t
 
off
, ušt32_ˆ
Ën
,

133 
ušt16_t
 *
cksum
);

146 
šlše
 
ušt16_t


147 
	`¹e_v4_cksum
(cÚ¡ 
v4_hdr
 *ipv4_hdr);

168 
šlše
 
ušt16_t


169 
	`¹e_v4_phdr_cksum
(cÚ¡ 
v4_hdr
 *v4_hdr, 
ušt64_t
 
Ş_æags
);

185 
šlše
 
ušt16_t


186 
	`¹e_v4_ud±ı_cksum
(cÚ¡ 
v4_hdr
 *v4_hdr, cÚ¡ *
l4_hdr
);

205 
šlše
 
ušt16_t


206 
	`¹e_v6_phdr_cksum
(cÚ¡ 
v6_hdr
 *v6_hdr, 
ušt64_t
 
Ş_æags
);

222 
šlše
 
ušt16_t


223 
	`¹e_v6_ud±ı_cksum
(cÚ¡ 
v6_hdr
 *v6_hdr, cÚ¡ *
l4_hdr
);

228  
ffi
.
C


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/histogram.lua

1 --- 
	gHi¡og¿m
, 
typiÿÎy
 
u£d
 
Ï‹nc›s


3 
loÿl
 
	ghi¡og¿m
 = {}

4 
hi¡og¿m
.
__šdex
 = histogram

6 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

7 
loÿl
 
log
 = 
»quœe
 "log"

9 
funùiÚ
 
hi¡og¿m
:
	$ü—‹
()

10 
loÿl
 
hi¡o
 = 
	`£tm‘©abË
({
	}
}, 
	ghi¡og¿m
)

11 
	ghi¡o
.histo = {}

12 
hi¡o
.
dœty
 = 
Œue


13  
hi¡o


14 
’d


16 
hi¡og¿m
.
Ãw
 = hi¡og¿m.
ü—‹


18 
£tm‘©abË
(
hi¡og¿m
, { 
__ÿÎ
 = hi¡og¿m.
ü—‹
 })

20 
funùiÚ
 
	ghi¡og¿m
:
	$upd©e
(
k
)

21 
nÙ
 
k
 
th’
  
’d


22 
£lf
.
hi¡o
[
k
] = (£lf.hi¡o[k] 
Ü
 0) +1

23 
£lf
.
dœty
 = 
Œue


24 
’d


26 
funùiÚ
 
hi¡og¿m
:
	$ÿlc
()

27 
£lf
.
sÜ‹dHi¡o
 = {
	}
}

28 
£lf
.
sum
 = 0

29 
£lf
.
numSam¶es
 = 0

31 
k
, 
v
 
š
 
	$·œs
(
£lf
.
hi¡o
) do

32 
bË
.
	`š£¹
(
£lf
.
sÜ‹dHi¡o
, { 
k
 = k, 
v
 = v 
	}
})

33 
	g£lf
.
	gnumSam¶es
 = 
£lf
.
numSam¶es
 + 
v


34 
£lf
.
sum
 = s–f.sum + 
k
 * 
v


35 
’d


36 
£lf
.
avg
 = s–f.
sum
 / s–f.
numSam¶es


37 
loÿl
 
¡dDevSum
 = 0

38 
k
, 
v
 
š
 
	$·œs
(
£lf
.
hi¡o
) do

39 
¡dDevSum
 = stdDevSum + 
v
 * (
k
 - 
£lf
.
avg
)^2

40 
’d


41 
£lf
.
¡dDev
 = (
¡dDevSum
 / (£lf.
numSam¶es
 - 1)) ^ 0.5

43 
bË
.
	`sÜt
(
£lf
.
sÜ‹dHi¡o
, 
	$funùiÚ
(
e1
, 
e2
èƒ1.
k
 <ƒ2.k 
’d
)

44 #£lf.
sÜ‹dHi¡o
 > 0 
th’


45 
loÿl
 
maxC–l
 = 
£lf
.
sÜ‹dHi¡o
[#self.sortedHisto]

46 
£lf
.
maximum
 = 
maxC–l
.
k


47 
loÿl
 
mšC–l
 = 
£lf
.
sÜ‹dHi¡o
[1]

48 
£lf
.
mšimum
 = 
mšC–l
.
k


50 -- 
TODO
: 
this
 
is
 
obviou¦y
 
nÙ
 
’tœ–y
 
cÜ»ù
 
numb”s
‚Ù 
divisibË
 
by
 4

51 -- 
howev”
, 
™
 
dÛ¢
't„eally matter forhe‚umber of samples we usually use

52 
loÿl
 
qu¬tSam¶es
 = 
£lf
.
numSam¶es
 / 4

54 
£lf
.
qu¬ts
 = {
	}
}

56 
loÿl
 
idx
 = 0

57 
_
, 
p
 
š
 
	$aœs
(
£lf
.
sÜ‹dHi¡o
) do

58 -- 
TODO
: 
šeffic›Á


59 
_
 = 1, 
p
.
v
 do

60 
nÙ
 
£lf
.
qu¬ts
[1] 
ªd
 
idx
 >ğ
qu¬tSam¶es
 
th’


61 
£lf
.
qu¬ts
[1] = 
p
.
k


62 
–£if
 
nÙ
 
£lf
.
qu¬ts
[2] 
ªd
 
idx
 >ğ
qu¬tSam¶es
 * 2 
th’


63 
£lf
.
qu¬ts
[2] = 
p
.
k


64 
–£if
 
nÙ
 
£lf
.
qu¬ts
[3] 
ªd
 
idx
 >ğ
qu¬tSam¶es
 * 3 
th’


65 
£lf
.
qu¬ts
[3] = 
p
.
k


67 
’d


68 
idx
 = idx + 1

69 
’d


70 
’d


72 
i
 = 1, 3 do

73 
nÙ
 
£lf
.
qu¬ts
[
i
] 
th’


74 
£lf
.
qu¬ts
[
i
] = 0/0

75 
’d


76 
’d


78 
£lf
.
qu¬ts
 = {0/0, 0/0, 0/0
	}
} -- 
NaN


79 
’d


81 
£lf
.
dœty
 = 
çl£


82 
’d


84 --- 
C®cuÏ‹
 
the
 
Áh
 
³rûÁe


85 --- @
·¿m
 
	$³rûÁe
 (
¿nge
 0 
to
 100)

86 
funùiÚ
 
hi¡og¿m
:
	$³rûÁe
(
³rûÁe
)

87 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


89 
³rûÁe
 > 100 
Ü
…”ûÁ< 0 
th’


90 
	`”rÜ
("invalid‡rgument")

91 
’d


93 
loÿl
 
rg‘Sam¶es
 = 
£lf
.
numSam¶es
 * 
³rûÁe
 / 100

94 
loÿl
 
idx
 = 0

95 
_
, 
p
 
š
 
	$aœs
(
£lf
.
sÜ‹dHi¡o
) do

96 -- 
TODO
: 
šeffic›Á


97 
_
 = 1, 
p
.
v
 do

98 
idx
 >ğ
£lf
.
numSam¶es
 * 
³rûÁe
 / 100 
th’


99  
p
.
k


100 
’d


101 
idx
 = idx + 1

102 
’d


103 
’d


104 
’d


106 
funùiÚ
 
hi¡og¿m
:
	$tÙ®s
()

107 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


109  
£lf
.
numSam¶es
, s–f.
sum
, s–f.
avg


110 
’d


112 
funùiÚ
 
hi¡og¿m
:
	$av”age
()

113 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


115  
£lf
.
avg


116 
’d


118 
funùiÚ
 
hi¡og¿m
:
	$mš
()

119 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


121  
£lf
.
mšimum


122 
’d


124 
funùiÚ
 
hi¡og¿m
:
	$max
()

125 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


127  
£lf
.
maximum


128 
’d


130 
funùiÚ
 
hi¡og¿m
:
	$¡ªd¬dDevŸtiÚ
()

131 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


133  
£lf
.
¡dDev


134 
’d


136 
funùiÚ
 
hi¡og¿m
:
	$qu¬tes
()

137 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


139  
	$uÅack
(
£lf
.
qu¬ts
)

140 
’d


142 
funùiÚ
 
hi¡og¿m
:
	$medŸn
()

143 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


145  
£lf
.
qu¬ts
[2]

146 
’d


148 
funùiÚ
 
hi¡og¿m
:
	$§m¶es
()

149 
loÿl
 
i
 = 0

150 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


151 
loÿl
 
n
 = #£lf.
sÜ‹dHi¡o


152  
	$funùiÚ
()

153 
nÙ
 
£lf
.
dœty
 
th’


154 
i
 = i + 1

155 
i
 <ğ
n
 
th’
  
£lf
.
sÜ‹dHi¡o
[i] 
’d


156 
’d


157 
’d


158 
’d


160 -- 
FIXME
: 
add
 
suµÜt
 
difã»Á
 
fÜm©s


161 
funùiÚ
 
hi¡og¿m
:
	$´št
(
´efix
)

162 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


164 
	`´štf
("%sSam¶es: %d, Av”age: %.1àns, StdDev: %.1àns, Qu¬tes: %.1f/%.1f/%.1àns", 
´efix
 
	`ªd
 ("[" ..…»fix .. "] "è
Ü
 "", 
£lf
.
numSam¶es
, s–f.
avg
, s–f.
¡dDev
, 
	$uÅack
(
£lf
.
qu¬ts
))

165 
’d


167 
funùiÚ
 
hi¡og¿m
:
	$§ve
(
fe
)

168 
£lf
.
dœty
 
th’
 s–f:
	$ÿlc
(è
’d


169 
loÿl
 
şo£
 = 
çl£


170 
	`ty³
(
fe
è~ğ"u£rd©a" 
th’


171 
log
:
	`šfo
("Savšg hi¡og¿mØ'%s'", 
fe
)

172 
fe
 = 
io
.
	`İ’
(file, "w+")

173 
şo£
 = 
Œue


174 
’d


175 
i
, 
v
 
š
 
	$aœs
(
£lf
.
sÜ‹dHi¡o
) do

176 
fe
:
	`wr™e
(("%s,%s\n"):
	$fÜm©
(
v
.
k
, v.v))

177 
’d


178 
şo£
 
th’


179 
fe
:
	$şo£
()

180 
’d


181 
’d


184 
funùiÚ
 
hi¡og¿m
:
	$__£rŸlize
()

185  "»quœ'hi¡og¿m';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('hi¡og¿m')"), 
Œue


186 
’d


188  
hi¡og¿m


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/hs.lua

1 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

2 
loÿl
 
h¦ib
 = 
ffi
.
lßd
("/u¤/loÿl/lib/libhs.so"è--
»quœes
 
Hy³rsÿn
 
to
 
be
 
š¡®Ëd
.

4 
ffi
.
cdef
[[

5 
hs_”rÜ_t
;

6 
hs_¶©fÜm_šfo_t
 hs_platform_info_t;

7 
hs_ex´_ext_t
 hs_expr_ext_t;

8 
hs_sü©ch_t
 hs_scratch_t;

9 
hs_¡»am
 
hs_¡»am_t
;

10 
hs_d©aba£
 
hs_d©aba£_t
;

11 ¡ruù {* 
mes§ge
; 
ex´essiÚ
;} 
hs_compe_”rÜ_t
;

13 (* 
m©ch_ev’t_hªdËr
)(
id
, 
äom
, 
to
, 
æags
, *
cÚ‹xt
);

15 
hs_”rÜ_t
 
	`hs_ä“_d©aba£
(
hs_d©aba£_t
 *
db
);

16 
hs_”rÜ_t
 
	`hs_£rŸlize_d©aba£
(cÚ¡ 
hs_d©aba£_t
 * 
db
, ** 
by‹s
, 
size_t
 * 
Ëngth
);

17 
hs_”rÜ_t
 
	`hs_de£rŸlize_d©aba£
(cÚ¡ * 
by‹s
, cÚ¡ 
size_t
 
Ëngth
, 
hs_d©aba£_t
 ** 
db
);

18 
hs_”rÜ_t
 
	`hs_¡»am_size
(cÚ¡ 
hs_d©aba£_t
 * 
d©aba£
, 
size_t
 * 
¡»am_size
);

19 
hs_”rÜ_t
 
	`hs_d©aba£_size
(cÚ¡ 
hs_d©aba£_t
 * 
d©aba£
, 
size_t
 * 
d©aba£_size
);

20 
hs_”rÜ_t
 
	`hs_£rŸlized_d©aba£_size
(cÚ¡ * 
by‹s
, cÚ¡ 
size_t
 
Ëngth
, size_ˆ* 
de£rŸlized_size
);

21 
hs_”rÜ_t
 
	`hs_v®id_¶©fÜm
();

22 
hs_”rÜ_t
 
	`hs_compe
(cÚ¡ * 
ex´essiÚ
, 
æags
, 
mode
, cÚ¡ 
hs_¶©fÜm_šfo_t
 * 
¶©fÜm
, 
hs_d©aba£_t
 ** 
db
, 
hs_compe_”rÜ_t
 ** 
”rÜ
);

23 
hs_”rÜ_t
 
	`hs_compe_muÉi
(cÚ¡ *cÚ¡ * 
ex´essiÚs
, cÚ¡ * 
æags
, cÚ¡ * 
ids
, 
–em’ts
, 
mode
, cÚ¡ 
hs_¶©fÜm_šfo_t
 * 
¶©fÜm
, 
hs_d©aba£_t
 ** 
db
, 
hs_compe_”rÜ_t
 ** 
”rÜ
);

24 
hs_”rÜ_t
 
	`hs_compe_ext_muÉi
(cÚ¡ *cÚ¡ * 
ex´essiÚs
, cÚ¡ * 
æags
, cÚ¡ * 
ids
, cÚ¡ 
hs_ex´_ext_t
 *cÚ¡ * 
ext
, 
–em’ts
, 
mode
, cÚ¡ 
hs_¶©fÜm_šfo_t
 * 
¶©fÜm
, 
hs_d©aba£_t
 ** 
db
, 
hs_compe_”rÜ_t
 ** 
”rÜ
);

25 
hs_”rÜ_t
 
	`hs_ä“_compe_”rÜ
(
hs_compe_”rÜ_t
 * 
”rÜ
);

27 
hs_”rÜ_t
 
	`hs_İ’_¡»am
(cÚ¡ 
hs_d©aba£_t
 * 
db
, 
æags
, 
hs_¡»am_t
 ** 
¡»am
);

28 
hs_”rÜ_t
 
	`hs_şo£_¡»am
(
hs_¡»am_t
 * 
id
, 
hs_sü©ch_t
 * 
sü©ch
, 
m©ch_ev’t_hªdËr
 
ÚEv’t
, * 
ùxt
);

29 
hs_”rÜ_t
 
	`hs_sÿn_¡»am
(
hs_¡»am_t
 * 
id
, cÚ¡ * 
d©a
, 
Ëngth
, 
æags
, 
hs_sü©ch_t
 * 
sü©ch
, 
m©ch_ev’t_hªdËr
 
ÚEv’t
, * 
ùxt
);

30 
hs_”rÜ_t
 
	`hs_»£t_¡»am
(
hs_¡»am_t
 * 
id
, 
æags
, 
hs_sü©ch_t
 * 
sü©ch
, 
m©ch_ev’t_hªdËr
 
ÚEv’t
, * 
cÚ‹xt
);

31 
hs_”rÜ_t
 
	`hs_cİy_¡»am
(
hs_¡»am_t
 ** 
to_id
, cÚ¡ hs_¡»am_ˆ* 
äom_id
);

32 
hs_”rÜ_t
 
	`hs_»£t_ªd_cİy_¡»am
(
hs_¡»am_t
 * 
to_id
, cÚ¡ hs_¡»am_ˆ* 
äom_id
, 
hs_sü©ch_t
 * 
sü©ch
, 
m©ch_ev’t_hªdËr
 
ÚEv’t
, * 
cÚ‹xt
);

34 
hs_”rÜ_t
 
	`hs_sÿn
(cÚ¡ 
hs_d©aba£_t
 * 
db
, cÚ¡ * 
d©a
, 
Ëngth
, 
æags
, 
hs_sü©ch_t
 * 
sü©ch
, 
m©ch_ev’t_hªdËr
 
ÚEv’t
, * 
cÚ‹xt
);

35 
hs_”rÜ_t
 
	`hs_sÿn_veùÜ
(cÚ¡ 
hs_d©aba£_t
 * 
db
, cÚ¡ *cÚ¡ * 
d©a
, cÚ¡ * 
Ëngth
, 
couÁ
, 
æags
, 
hs_sü©ch_t
 * 
sü©ch
, 
m©ch_ev’t_hªdËr
 
ÚEv’t
, * 
cÚ‹xt
);

36 
hs_”rÜ_t
 
	`hs_®loc_sü©ch
(cÚ¡ 
hs_d©aba£_t
 * 
db
, 
hs_sü©ch_t
 ** 
sü©ch
);

37 
hs_”rÜ_t
 
	`hs_ä“_sü©ch
(
hs_sü©ch_t
 * 
sü©ch
);

38 
hs_”rÜ_t
 
	`hs_şÚe_sü©ch
(cÚ¡ 
hs_sü©ch_t
 * 
¤c
, hs_sü©ch_ˆ** 
de¡
);

42 
loÿl
 
hs
 = {
	}
}

44 
hs
.
__šdex
 = hs

45 
hs
.
__ty³
 = "hs"

48 --
cÚ¡ªts


49 
hs
.
HS_SUCCESS
 = 0

50 
hs
.
HS_INVALID
 = -1

51 
hs
.
HS_NOMEM
 = -2

52 
hs
.
HS_SCAN_TERMINATED
 = -3

53 
hs
.
HS_COMPILER_EROOR
 = -4

54 
hs
.
HS_DB_VERSION_ERROR
 = -5

55 
hs
.
HS_DB_PLATFORM_ERROR
 = -6

56 
hs
.
HS_DB_MODE_ERROR
 = -7

57 
hs
.
HS_BAD_ALIGN
 = -8

58 
hs
.
HS_BAD_ALLOC
 = -9

59 
hs
.
HS_SCRATCH_IN_USE
 = -10

60 
hs
.
HS_ARCH_ERROR
 = -11

62 
hs
.
HS_FLAG_CASELESS
 = 1

63 
hs
.
HS_FLAG_DOTALL
 = 2

64 
hs
.
HS_FLAG_MULTILINE
 = 4

65 
hs
.
HS_FLAG_SINGLEMATCH
 = 8

66 
hs
.
HS_FLAG_ALLOWEMPTY
 = 16

67 
hs
.
HS_FLAG_UTF8
 = 32

68 
hs
.
HS_FLAG_UCP
 = 64

69 
hs
.
HS_FLAG_PREFILTER
 = 128

70 
hs
.
HS_FLAG_SOM_LEFTMOST
 = 256

72 
hs
.
HS_MODE_BLOCK
 = 1

73 
hs
.
HS_MODE_NOSTREAM
 = 1

74 
hs
.
HS_MODE_STREAM
 = 2

75 
hs
.
HS_MODE_VECTORED
 = 4

77 
loÿl
 
C
 = 
ffi
.C

79 
hs
.
sü©ch_±r_±r
 = 
ffi
.
ty³of
("hs_scratch_t*[1]")

80 
hs
.
d©aba£_±r_±r
 = 
ffi
.
ty³of
("hs_database_t*[1]")

81 
hs
.
”r_±r_±r
 = 
ffi
.
ty³of
("hs_compile_error_t*[1]")

82 
hs
.
¡»am_±r_±r
 = 
ffi
.
ty³of
("hs_stream_t*[1]")

83 
loÿl
 
void_±r
 = 
ffi
.
ty³of
("void*")

84 
loÿl
 
boŞ_±r
 = 
ffi
.
ty³of
("bool[1]")

87 --
sim¶e
 
w¿µ”s


88 --
u§ge
, 
look
 
š
 
the
 
	gdocum’tiÚ
: 
h‰p
:

90 
funùiÚ
 
hs
.
	$ä“_d©aba£
(
d©aba£_±r
)

91  
h¦ib
.
	$hs_ä“_d©aba£
(
d©aba£_±r
)

92 
’d


94 
funùiÚ
 
hs
.
	$ä“_sü©ch
(
sü©ch_±r
)

95  
h¦ib
.
	$hs_ä“_sü©ch
(
sü©ch_±r
)

96 
’d


98 
funùiÚ
 
hs
.
	$®loc_sü©ch
(
d©aba£_±r
, 
sü©ch_±r_±r
)

99  
h¦ib
.
	$hs_®loc_sü©ch
(
d©aba£_±r
, 
sü©ch_±r_±r
)

100 
’d


102 
funùiÚ
 
hs
.
	$şÚe_sü©ch
(
sourû_±r
, 
de¡š©iÚ_±r_±r
)

103  
h¦ib
.
	$hs_şÚe_sü©ch
(
sourû_±r
, 
de¡š©iÚ_±r_±r
)

104 
’d


106 
funùiÚ
 
hs
.
	$£rŸlize_d©aba£
(
d©aba£_±r
, 
by‹s_±r_±r
, 
Ëngth_±r
)

107  
h¦ib
.
	$hs_£rŸlize_d©aba£
(
d©aba£_±r
, 
by‹s_±r_±r
, 
Ëngth_±r
)

108 
’d


110 
funùiÚ
 
hs
.
	$de£rŸlize_d©aba£
(
by‹s_±r
, 
Ëngth
, 
d©aba£_±r_±r
)

111  
h¦ib
.
	$hs_de£rŸlize_d©aba£
(
by‹s_±r
, 
Ëngth
, 
d©aba£_±r_±r
)

112 
’d


114 
funùiÚ
 
hs
.
	$compe
(
ex´essiÚ
, 
æags
, 
mode
, 
db_±r_±r
, 
”r_±r_±r
, 
¶©fÜm_±r
)

115  
h¦ib
.
	$hs_compe
(
ex´essiÚ
, 
æags
, 
mode
, 
¶©fÜm_±r
, 
db_±r_±r
, 
”r_±r_±r
)

116 
’d


118 
funùiÚ
 
hs
.
	$compe_muÉi
(
ex´essiÚs
, 
æags_¬¿y
, 
ids_¬¿y
, 
–em’ts
, 
mode
, 
db_±r_±r
, 
”r_±r_±r
, 
¶©fÜm_±r
)

119  
h¦ib
.
	$hs_compe_muÉi
(
ex´essiÚs
, 
æags_¬¿y
, 
ids_¬¿y
, 
–em’ts
, 
mode
, 
¶©fÜm_±r
, 
db_±r_±r
, 
”r_±r_±r
)

120 
’d


122 
funùiÚ
 
hs
.
	$sÿn
(
d©aba£_±r
, 
d©a
, 
Ëngth
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

123  
h¦ib
.
	$hs_sÿn
(
d©aba£_±r
, 
d©a
, 
Ëngth
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

124 
’d


126 
funùiÚ
 
hs
.
	$sÿn_veùÜ
(
d©aba£_±r
, 
d©a
, 
Ëngth_¬¿y
, 
couÁ
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt
)

127  
h¦ib
.
	$hs_sÿn_veùÜ
(
d©aba£_±r
, 
d©a
, 
Ëngth_¬¿y
, 
couÁ
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt
)

128 
’d


130 
funùiÚ
 
hs
.
	$İ’_¡»am
(
d©aba£_±r
, 
æags
, 
¡»am_±r_±r
)

131  
h¦ib
.
	$hs_İ’_¡»am
(
d©aba£_±r
, 
æags
, 
¡»am_±r_±r
)

132 
’d


134 
funùiÚ
 
hs
.
	$sÿn_¡»am
(
id_±r
, 
d©a
, 
Ëngth
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

135  
h¦ib
.
	$hs_sÿn_¡»am
(
id_±r
, 
d©a
, 
Ëngth
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

136 
’d


138 
funùiÚ
 
hs
.
	$şo£_¡»am
(
id_±r
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

139  
h¦ib
.
	$hs_şo£_¡»am
(
id_±r
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt
)

140 
’d


142 
funùiÚ
 
hs
.
	$»£t_¡»am
(
id_±r
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

143  
h¦ib
.
	$hs_»£t_¡»am
(
id_±r
, 
æags
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt
)

144 
’d


146 
funùiÚ
 
hs
.
	$cİy_¡»am
(
to_id_±r_±r
, 
äom_id_±r
)

147  
h¦ib
.
	$hs_cİy_¡»am
(
to_id_±r_±r
, 
äom_id_±r
)

148 
’d


150 
funùiÚ
 
hs
.
	$»£t_ªd_cİy_¡»am
(
to_id_±r
, 
äom_id_±r
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

151  
h¦ib
.
	$hs_»£t_ªd_cİy_¡»am
(
to_id_±r
, 
äom_id_±r
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

152 
’d


155 --
m©ch
 
hªdËr
 
ÿÎback
 
funùiÚ
 
dummy


156 
loÿl
 
funùiÚ
 
	`m©chHªdËrDummy
(
id
, 
äom
, 
to
, 
æags
, 
cÚ‹xt
)

157 --
	$´št
(
id
, 
äom
, 
to
, 
æags
, 
cÚ‹xt
)

158 
	`´št
("Found m©ch! P©‹º w™h ID: ", 
	`tÚumb”
(
id
), "m©chƒnds: ", 
	$tÚumb”
(
to
))

160 
’d


162 --
abÜt
 
sÿn
 
m©ch
 
is
 
found


163 
loÿl
 
funùiÚ
 
	$m©chHªdËrDummyAbÜt
(
id
, 
äom
, 
to
, 
æags
, 
cÚ‹xt
)

164 
	`´št
("Found m©ch! P©‹º w™h ID: ", 
	`tÚumb”
(
id
), "m©chƒnd ", 
	$tÚumb”
(
to
))

166 
’d


168 
hs
.
m©chHªdËrDummy_±r
 = 
ffi
.
	`ÿ¡
("m©ch_ev’t_hªdËr", 
m©chHªdËrDummy
)

169 
hs
.
m©chHªdËrDummyAbÜt_±r
 = 
ffi
.
	`ÿ¡
("m©ch_ev’t_hªdËr", 
m©chHªdËrDummyAbÜt
)

173 -- 
mÜe
 
ab¡¿ù
 
m‘hods


175 --
In™s
 
a
 
Ãw
 
d©aba£
 
ªd
 
sü©ch
 
sÿÂšg


176 --@
·¿m
 
mode
: 
HS_MODE_BLOCK
 
Ü
 
HS_MODE_STREAM


177 --@
·¿m
 
·‰”n_bË
: 
TabË
 
of
 
the
 
·‰”ns


178 --@
·¿m
 
æags_bË
: 
TabË
 
of
 
the
 
æags
 
š
 
§me
 
Üd”
 
as
 
·‰”ns


179 --@
·¿m
 
ids_bË
: 
IDs
 
of
 
·‰”ns
 
š
 
§me
 
Üd”
 
as
…atterns

181 --@ 
sšgË
 
poš‹rs
 
to
 
the
 
comped
 
d©aba£
 
ªd
Øth
®loÿ‹d
 
sü©ch
 
¥aû
.

182 
funùiÚ
 
hs
.
	$š™
(
mode
, 
·‰”n_bË
, 
æags_bË
, 
ids_bË
)

183 
loÿl
 
db
 = 
hs
.
	$d©aba£_±r_±r
()

184 
loÿl
 
”r
 = 
hs
.
	$”r_±r_±r
()

185 
loÿl
 
sü
 = 
hs
.
	$sü©ch_±r_±r
()

188 ià(#·‰”n_bË ~ğ#æags_bË 
Ü
 #æags_bË ~ğ#ids_bËè
th’


189 
	`´št
("Sizes haveo behe same!")

190  
n


191 
’d


192 --? 
İ”©Ü
 
nÙ
 
wÜkšg
?

193 
hs
.
	`compe_muÉi
(
ffi
.
	`Ãw
(("cÚ¡ ch¬*[".. #·‰”n_bË .. "]"è,
·‰”n_bË
),ffi.Ãw("št[".. #æags_bË .. "]" , 
æags_bË
è, ffi.Ãw(("šˆ[" .. #ids_bË .. "]"), 
ids_bË
è, #·‰”n_bË, 
mode
, 
db
, 
”r
è~ğhs.
HS_SUCCESS
 
th’


194 
	`´št
(
ffi
.
	$¡ršg
(
”r
[0][0].
mes§ge
))

195 
	`´št
("Ex´. ID: ", 
”r
[0][0].
ex´essiÚ
)

196 
hs
.
	$ä“_d©aba£
(
db
[0])

198  
n


199 
’d


201 
hs
.
	$®loc_sü©ch
(
db
[0], 
sü
)

203  
db
[0], 
sü
[0]

204 
’d


206 -- 
Sÿns
 
š
 
¡»amšg
 
mode


207 
funùiÚ
 
hs
.
	$dosÿn_¡»am
(
šput
, 
šput_Ëngth
, 
¡»am_±r
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

208 
loÿl
 
»s
 = 
hs
.
	$sÿn_¡»am
(
¡»am_±r
, 
šput
, 
šput_Ëngth
, 0, 
sü©ch_±r
, 
ÿÎback
 
Ü
 
hs
.
m©chHªdËrDummy_±r
, 
cÚ‹xt_±r
)

210 
»s
 ~ğ
hs
.
HS_SUCCESS
 
th’


211 
	`´št
("E¼Ü whsÿÂšg:", 
»s
)

213 
’d


215 
’d


216 
j™
.
	`off
(
hs
.
dosÿn_¡»am
)

218 -- 
Sÿns
 
š
 
block
 
mode


219 
funùiÚ
 
hs
.
	$dosÿn_block
(
šput
, 
šput_Ëngth
, 
d©aba£_±r
, 
sü©ch_±r
, 
ÿÎback
, 
cÚ‹xt_±r
)

220 
loÿl
 
»s
 = 
hs
.
	$sÿn
(
d©aba£_±r
, 
šput
, 
šput_Ëngth
, 0, 
sü©ch_±r
, 
ÿÎback
 
Ü
 
hs
.
m©chHªdËrDummy_±r
, 
cÚ‹xt_±r
)

221 
»s
 ~ğ
hs
.
HS_SUCCESS
 
th’


222 
	`´št
("E¼Ü whsÿÂšg:", 
»s
)

224 
’d


226 
’d


227 
j™
.
	`off
(
hs
.
dosÿn_block
)

229 -- 
R‘uºs
 
a
 
sšgË
 
poš‹r
 
to
‡ 
Ãw
 
¡»am


230 
funùiÚ
 
hs
.
	$Ãw_¡»am
(
d©aba£_±r
)

231 
loÿl
 
¡r_±r_±r
 = 
hs
.
	$¡»am_±r_±r
()

232 
loÿl
 
»s
 = 
hs
.
	$İ’_¡»am
(
d©aba£_±r
, 0, 
¡r_±r_±r
)

233 
»s
 ~ğ
hs
.
HS_SUCCESS
 
th’


234 
	`´št
("E¼Ü o³nšg sŒ—m:", 
»s
)

235  
n


236 
’d


238  
¡r_±r_±r
[0]

239 
’d


242 -- 
h–³r
 
funùiÚs


244 
loÿl
 
funùiÚ
 
	$·r£æags
(
æag_¡ršg
)

245 
nÙ
 
æag_¡ršg
 
th’


247 
’d


249 
æag
 = 0

250 
c
 
š
 
¡ršg
.
	`gm©ch
(
æag_¡ršg
, ".") do

251 
c
 =ğ'i' 
th’


252 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_CASELESS
)

253 
–£if
 
c
 =ğ'm' 
th’


254 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_MULTILINE
)

255 
–£if
 
c
 =ğ's' 
th’


256 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_DOTALL
)

257 
–£if
 
c
 =ğ'H' 
th’


258 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_SINGLEMATCH
)

259 
–£if
 
c
 =ğ'V' 
th’


260 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_ALLOWEMPTY
)

261 
–£if
 
c
 =ğ'8' 
th’


262 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_UTF8
)

263 
–£if
 
c
 =ğ'W' 
th’


264 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_UCP
)

265 
–£if
 
c
 =ğ'p' 
th’


266 
æag
 = 
b™
.
	$bÜ
(
æag
, 
hs
.
HS_FLAG_PREFILTER
)

268 
	`´št
("UnsuµÜ‹d fÏg \'".. 
c
 .. "\' ignored")

269 
’d


270 
’d


272  
æag


273 
’d


275 --
R‘uºs
 
the
 
bËs
 
»quœed
 
by
 
	`š™
()

276 --@
·¿m
 
šput
: 
ruËs
 
as
 
¡ršg
 
š
 
fÜm©
: <
ID
>:/<
·‰”n
>/<
æags
>

277 
funùiÚ
 
hs
.
	$·r£
(
šput
)

278 
loÿl
 
ids
 = {
	}
}

279 
loÿl
 
·‰”ns
 = {}

280 
loÿl
 
æags
 = {}

281 
lše
 
š
 
¡ršg
.
gm©ch
(
šput
, "[^\r\n]+") do

282 
	g¡ršg
.
sub
(
lše
, 1, 1è~ğ"#" 
th’


283 
fœ¡_doubËcŞÚ
 = 
¡ršg
.
fšd
(
lše
, ":")

284 
	gid
 = 
tÚumb”
(
¡ršg
.
sub
(
lše
, 1, 
fœ¡_doubËcŞÚ
-1))

286 
	gÙh”·¹
 = 
¡ršg
.
sub
(
lše
, 
fœ¡_doubËcŞÚ
+1)

288 
	gÏ¡_¦ash_»v”£d
 = 
¡ršg
.
fšd
(¡ršg.
»v”£
(
Ùh”·¹
), "/")

290 
	g·‰”n
 = 
¡ršg
.
sub
(
Ùh”·¹
, 2, -
Ï¡_¦ash_»v”£d
-1)

291 
	gæag
 = 
¡ršg
.
sub
(
Ùh”·¹
, #Ùh”·¹-(
Ï¡_¦ash_»v”£d
-2))

293 
	gbË
.
š£¹
(
ids
, 
	$tÚumb”
(
id
))

294 
bË
.
	$š£¹
(
·‰”ns
, 
·‰”n
)

295 
bË
.
	`š£¹
(
æags
, 
	$·r£æags
(
æag
))

296 
’d


297 
’d


298  
·‰”ns
, 
æags
, 
ids


300 
’d


302 --
R‘uºs
 
the
 
bËs
 
»quœed
 
by
 
	`š™
()

303 --@
·¿m
 
f’ame
: 
·th
 
to
 
fe
 
wh”e
 
ruËs
 
¬e
 
§ved
 
š
 
fÜm©
: <
ID
>:/<
·‰”n
>/<
æags
>

304 
funùiÚ
 
hs
.
	$·r£_äom_fe
(
f’ame
)

305 
loÿl
 
fe
 = 
io
.
	`İ’
(
f’ame
, "r")

306 
loÿl
 
šput
 = 
fe
:
	`»ad
("*all")

307 
fe
:
	$şo£
()

309  
hs
.
	$·r£
(
šput
)

310 
’d


314 --
F‹r
 
şass


316 
loÿl
 
funùiÚ
 
	$ÿÎbackF‹r
(
id
, 
äom
, 
to
, 
æags
, 
cÚ‹xt
)

317  1 --
’d
 
wh’
 
m©ch
 
was
 
found


318 
’d


320 
loÿl
 
ÿÎbackF‹r_±r
 = 
ffi
.
	`ÿ¡
("m©ch_ev’t_hªdËr", 
ÿÎbackF‹r
)

323 --- 
C»©es
 
Ãw
 
f‹r


324 --- @
·¿m
 
·‰”n_fe
: 
·th
 
to
 
fe


325 --- @
·¿m
 
mode
: 
HS_MODE_BLOCK
 
Ü
 
HS_MODE_STREAM


326 
funùiÚ
 
hs
:
	$ü—‹
(
·‰”n_fe
, 
mode
)

327 
loÿl
 
fto
 = 
	`£tm‘©abË
({
	}
}, 
	ghs
)

328 
loÿl
 
	gd
, 
	gs
 = 
hs
.
š™
(
mode
 
Ü
 hs.
HS_MODE_BLOCK
, hs.
	$·r£_äom_fe
(
·‰”n_fe
))

329 
fto
.ftØğ{
	}
}

330 
fto
.
d©aba£_±r
 = 
d


331 
fto
.
sü©ch_±r
 = 
s


332 
fto
.
mode
 = mod
Ü
 
hs
.
HS_MODE_BLOCK


334  
fto


335 
’d


338 
hs
.
Ãw
 = hs.
ü—‹


339 
£tm‘©abË
(
hs
, {
__ÿÎ
 = hs.
ü—‹
})

342 
funùiÚ
 
	ghs
:
	$__to¡ršg
()

343  ("[hs: mode=%d]"):
	$fÜm©
(
£lf
.
mode
)

344 
’d


347 
funùiÚ
 
hs
:
	$__£rŸlize
()

348 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

349  "»quœ'hs';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœ'hs'"), 
Œue


350 
’d


352 --- 
F‹rs
 
a
 
·ck‘


353 --- @
·¿m
 
·ck‘_±r
: 
poš‹r
 
to
 
·ck‘


354 --- @
·¿m
 
¡»am_±r
: 
poš‹r
 
to
 
¡»am
 
of
 
·ck‘
; 
İtiÚ®
, 
Úly
 
Ãeded
 
š
 
¡»amšg
-
mode


355 
funùiÚ
 
hs
:
	$f‹r
(
·ck‘_±r
, 
¡»am_±r
)

356 
loÿl
 
»s
 = 
n


358 
£lf
.
mode
 =ğ
hs
.
HS_MODE_BLOCK
 
th’


359 
»s
 = 
hs
.
	`sÿn
(
£lf
.
d©aba£_±r
, 
·ck‘_±r
:
	`g‘D©a
(),…ack‘_±r:
	`g‘Size
(), 0, s–f.
sü©ch_±r
, 
ÿÎbackF‹r_±r
)

360 
–£if
 
£lf
.
mode
 =ğ
hs
.
HS_MODE_STREAM
 
th’


361 
»s
 = 
hs
.
	`sÿn_¡»am
(
¡»am_±r
, 
·ck‘_±r
:
	`g‘D©a
(),…ack‘_±r:
	`g‘Size
(), 0, 
£lf
.
sü©ch_±r
, 
ÿÎbackF‹r_±r
)

363 
	`´št
("bad mode", 
£lf
.
mode
)

364  
n


365 
’d


367  
»s
 ~ğ
hs
.
HS_SUCCESS
 -- 
m©ch
 -> 
ÿÎback
 -> 
cb
 
‹rmš©es
 -> 
HS_SCAN_TERMINATED


368 
’d


369 
j™
.
	`off
(
hs
.
f‹r
è-- 
£e
 
luaj™
 
docum’tiÚ


371 -- 
R‘uºs
 
a
 
Ãwly
 
İ’ed
 
¡»am


372 
funùiÚ
 
hs
:
	$ÃwSŒ—m
()

373 
hs
.
	`İ’_¡»am
(
£lf
.
d©aba£_±r
, 
	$®loc_sü©ch
())

374 
’d


376 -- 
F»es
 
the
 
f‹r


377 
funùiÚ
 
hs
:
	$ä“
()

378 
hs
.
	$ä“_d©aba£
(
£lf
.
d©aba£_±r
)

379 
hs
.
	$ä“_sü©ch
(
£lf
.
sü©ch
)

380 
’d


383 
funùiÚ
 
hs
:
	$g‘D©aba£
()

384  
£lf
.
d©aba£_±r


385 
’d


387 
funùiÚ
 
hs
:
	$g‘Sü©ch
()

388  
£lf
.
sü©ch_±r


389 
’d


391 
funùiÚ
 
hs
:
	$g‘Mode
()

392  
£lf
.
mode


393 
’d


396  
hs


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/ipsec.lua

2 --- @
fe
 
	g£c
.
	glua


3 --- @
br›f
 
IP£c
 (
ESP
/
AH
è
	gofæßdšg
.

4 --- @
todo
 
	gDocum’tiÚ


7 
loÿl
 
	gmod
 = {}

9 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

10 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
loÿl
 
log
 = 
»quœe
 "log"

14 -- 
IÁ–
 
X540
 
»gi¡”s


15 
loÿl
 
SECTXCTRL
 = 0x00008800

16 
loÿl
 
SECRXCTRL
 = 0x00008D00

17 
loÿl
 
SECTXSTAT
 = 0x00008804

18 
loÿl
 
SECRXSTAT
 = 0x00008D04

19 
loÿl
 
SECTXMINIFG
 = 0x00008810

20 
loÿl
 
SECTXBUFFAF
 = 0x00008808

22 
loÿl
 
IPSTXIDX
 = 0x00008900

23 
loÿl
 
IPSTXKEY_3
 = 0x00008914 --
MSB
 
of
 
key


24 
loÿl
 
IPSTXKEY_2
 = 0x00008910

25 
loÿl
 
IPSTXKEY_1
 = 0x0000890C

26 
loÿl
 
IPSTXKEY_0
 = 0x00008908 --
LSB
 
of
 
key


27 
loÿl
 
IPSTXSALT
 = 0x00008904

29 
loÿl
 
IPSRXIDX
 = 0x00008E00

30 
loÿl
 
IPSRXKEY_3
 = 0x00008E28 --
MSB
 
of
 
key


31 
loÿl
 
IPSRXKEY_2
 = 0x00008E24

32 
loÿl
 
IPSRXKEY_1
 = 0x00008E20

33 
loÿl
 
IPSRXKEY_0
 = 0x00008E1C --
LSB
 
ofkey


34 
loÿl
 
IPSRXSALT
 = 0x00008E2C

35 
loÿl
 
IPSRXMOD
 = 0x00008E30

37 --
NÙe
: 
F›ld
 
is
 
defšed
 
š
 
Big
 
EndŸn
 (
LS
 
by‹
 i 
fœ¡
 
Ú
 
the
 
wœe
).

38 
loÿl
 
IPSRXIPADDR_3
 = 0x00008E10 --
LSB
 
of
 
IPv6
 
Ü
 
IPv4


39 
loÿl
 
IPSRXIPADDR_2
 = 0x00008E0C

40 
loÿl
 
IPSRXIPADDR_1
 = 0x00008E08

41 
loÿl
 
IPSRXIPADDR_0
 = 0x00008E04 --
MSB
 
of
 
IPv6
 
Ü
 0

43 --
NÙe
: 
F›ld
 
is
 
defšed
 
š
 
Big
 
EndŸn
 (
LS
 
by‹
 i 
fœ¡
 
Ú
 
the
 
wœe
).

44 
loÿl
 
IPSRXSPI
 = 0x00008E14

45 
loÿl
 
IPSRXIPIDX
 = 0x00008E18

47 -- 
H–³r
 
funùiÚ
 
to
  
·dded
, 32b
™
 
hex
 
	g¡ršg
.

48 
funùiÚ
 
	$uhex32
(
x
)

49  
b™
.
	$tohex
(
x
, 8)

50 
’d


52 -- 
H–³r
 
funùiÚ
 
to
 
ş—r
 
a
 
sšgË
 
b™


53 
funùiÚ
 
	$ş—r_b™32
(
»g32
, 
idx
)

54 
idx
 < 0 
Ü
 idx > 31 
th’


55 
log
:
	`çl
("Idx must be in„ange 0-31")

56 
’d


57 
loÿl
 
mask
 = 
b™
.
	`bnÙ
(b™.
	$lshiá
(0x1, 
idx
))

58  
b™
.
	$bªd
(
»g32
, 
mask
)

59 
’d


61 -- 
H–³r
 
funùiÚ
 
to
 
£t
 
a
 
sšgË
 
b™


62 
funùiÚ
 
	$£t_b™32
(
»g32
, 
idx
)

63 
idx
 < 0 
Ü
 idx > 31 
th’


64 
log
:
	`çl
("Idx must be in„ange 0-31")

65 
’d


66  
b™
.
	`bÜ
(
»g32
, b™.
	$lshiá
(0x1, 
idx
))

67 
’d


69 -- 
H–³r
 
funùiÚ
 
to
 
ş—r
 
the
 
	$b™s
 (
MSB
è
äom
..
	$to
 (
LSB
)

70 
funùiÚ
 
	$ş—r_b™s32
(
»g32
, 
äom
, 
to
)

71 
loÿl
 
tmp
 = 
»g32


72 
i
=
äom
,
to
,-1 do

73 
tmp
 = 
	$ş—r_b™32
(
tmp
, 
i
)

74 
’d


75  
tmp


76 
’d


78 -- 
H–³r
 
funùiÚ
 
to
 
£t
 
the
 
	$b™s
 (
MSB
è
äom
..
	$to
 (
LSB
)

79 
funùiÚ
 
	$£t_b™s32
(
»g32
, 
äom
, 
to
, 
v®ue
)

80 
loÿl
 
uµ”_lim™
 = 
m©h
.
	`pow
(2, ((
äom
-
to
)+1))-1 --
i
.
e
. (2^
num_b™s
)-1

81 
v®ue
 < 0 
Ü
 v®u> 
uµ”_lim™
 
th’


82 
log
:
	`çl
("V®umu¡ bš„ªg0-"..
uµ”_lim™
)

83 
’d


84 
loÿl
 
tmp
 = 
	$ş—r_b™s32
(
»g32
, 
äom
, 
to
)

85  
b™
.
	`bÜ
(
tmp
, b™.
	$lshiá
(
v®ue
, 
to
))

86 
’d


88 
funùiÚ
 
	`dump_»gs
(
pÜt
)

89 --
	`´št
("===== DUMP REGS =====")

90 --
loÿl
 
»g
 = 
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXCTRL
)

91 --
	`´št
("SECTXCTRL: 0x"..
	`uhex32
(
»g
))

92 --
loÿl
 
»g
 = 
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXCTRL
)

93 --
	`´št
("SECRXCTRL: 0x"..
	`uhex32
(
»g
))

94 --
loÿl
 
»g
 = 
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXSTAT
)

95 --
	`´št
("SECTXSTAT: 0x"..
	`uhex32
(
»g
))

96 --
loÿl
 
»g
 = 
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXSTAT
)

97 --
	`´št
("SECRXSTAT: 0x"..
	`uhex32
(
»g
))

98 --
loÿl
 
»g
 = 
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXMINIFG
)

99 --
	`´št
("SECTXMINIFG: 0x"..
	`uhex32
(
»g
))

100 --
loÿl
 
»g
 = 
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXBUFFAF
)

101 --
	`´št
("SECTXBUFFAF: 0x"..
	$uhex32
(
»g
))

102 
’d


104 --- 
EÇbË
 
the
 
H¬dw¬e
 
Cry±o
 
Engše
.

105 --- 
This
 
funùiÚ
 
mu¡
 
be
 
ÿÎed
 
befÜe
 
usšg
 
ªy
 
Ùh”
 
IPSec
 
funùiÚs


106 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


107 
funùiÚ
 
mod
.
	`’abË
(
pÜt
)

108 --
	`´št
("IP£ø’abË,…Üt: "..
pÜt
)

109 --
	`dump_»gs
(
pÜt
)

111 -- 
Stİ
 
TX
 
d©a
 
	$·th
 (
£t
 
TX_DIS
 
b™
)

112 
loÿl
 
SECTXCTRL__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXCTRL
), 1è--
£t
 
TX_DIS


113 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXCTRL
, 
SECTXCTRL__VALUE
)

115 -- 
Stİ
 
RX
 
d©a
 
	$·th
 (
£t
 
RX_DIS
 
b™
)

116 
loÿl
 
SECRXCTRL__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXCTRL
), 1è--
£t
 
RX_DIS


117 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECRXCTRL
, 
SECRXCTRL__VALUE
)

119 -- 
Wa™
 
the
 
d©a
 
·ths
 
to
 
be
 
em±›d
 
by
 
	`h¬dw¬e
 (
check
 
SECTX
/
RX_RDY
 
b™s
).

120 
»³©


121 --
	`´št
("Waiting for„egisterso be‡sserted by hardware...")

122 
dpdk
.
	`¦“pMlis
(100è-- 
wa™
 100
ms
 
befÜe
 
pŞl


123 
loÿl
 
SECTXSTAT__SECTX_RDY
 = 
b™
.
	`bªd
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXSTAT
), 0x1)

124 
loÿl
 
SECRXSTAT__SECRX_RDY
 = 
b™
.
	`bªd
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXSTAT
), 0x1)

125 --
	`´št
("SECTX_RDY: "..
SECTXSTAT__SECTX_RDY
..", SECRX_RDY: "..
SECRXSTAT__SECRX_RDY
)

126 
uÁ
 
SECTXSTAT__SECTX_RDY
 =ğ0x1 
ªd
 
SECRXSTAT__SECRX_RDY
 == 0x1

128 -- 
S‘
 
MINSECIFG
 
to
 0x3

129 
loÿl
 
SECTXMINIFG__VALUE
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXMINIFG
), 3, 0, 0x3è--
£t
 
MINSECIFG


130 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXMINIFG
, 
SECTXMINIFG__VALUE
)

132 -- 
S‘
 
FULLTHRESH
 
to
 0x15

133 
loÿl
 
SECTXBUFFAF__VALUE
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXBUFFAF
), 9, 0, 0x15è--
£t
 
FULLTHRESH


134 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXBUFFAF
, 
SECTXBUFFAF__VALUE
)

136 -- 
EÇbË
 
TX
 
üy±o
 
’gše


137 
loÿl
 
SECTXCTRL__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXCTRL
), 0è--
ş—r
 
SECTX_DIS


138 
SECTXCTRL__VALUE
 = 
	`£t_b™32
(SECTXCTRL__VALUE, 2è--
£t
 
STORE_FORWARD


139 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXCTRL
, 
SECTXCTRL__VALUE
)

141 -- 
EÇbË
 
RX
 
üy±o
 
’gše


142 
loÿl
 
SECRXCTRL__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXCTRL
), 0è--
ş—r
 
SECRX_DIS


143 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECRXCTRL
, 
SECRXCTRL__VALUE
)

145 -- 
EÇbË
 
IP£c
 
TX
 
SA
 
lookup


146 
loÿl
 
IPSTXIDX__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSTXIDX
), 0è--
£t
 
IPS_TX_EN


147 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSTXIDX
, 
IPSTXIDX__VALUE
)

149 -- 
EÇbË
 
IP£c
 
RX
 
SA
 
lookup


150 
loÿl
 
IPSRXIDX__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 0è--
£t
 
IPS_RX_EN


151 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
IPSRXIDX__VALUE
)

153 -- 
Re¡¬t
 
TX
 
d©a
 
	$·th
 (
ş—r
 
TX_DIS
 
b™
)

154 
loÿl
 
SECTXCTRL__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXCTRL
), 1è--
ş—r
 
TX_DIS


155 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXCTRL
, 
SECTXCTRL__VALUE
)

157 -- 
Re¡¬t
 
RX
 
d©a
 
	$·th
 (
ş—r
 
RX_DIS
 
b™
)

158 
loÿl
 
SECRXCTRL__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXCTRL
), 1è--
ş—r
 
RX_DIS


159 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECRXCTRL
, 
SECRXCTRL__VALUE
)

161 --
	$dump_»gs
(
pÜt
)

162 
’d


164 --- 
Di§bË
 
the
 
H¬dw¬e
 
Cry±o
 
Engše
.

165 --- 
This
 
funùiÚ
 
should
 
be
 
ÿÎed
 
aá”
 
usšg
 
the
 
Ùh”
 
IPSec
 
funùiÚs


166 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


167 
funùiÚ
 
mod
.
	`di§bË
(
pÜt
)

168 --
	`´št
("IP£ødi§bË,…Üt: "..
pÜt
)

169 
	`dump_»gs
(
pÜt
)

171 -- 
Stİ
 
TX
 
d©a
 
	$·th
 (
£t
 
TX_DIS
 
b™
)

172 
loÿl
 
SECTXCTRL__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXCTRL
), 1è--
£t
 
TX_DIS


173 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXCTRL
, 
SECTXCTRL__VALUE
)

175 -- 
Stİ
 
RX
 
d©a
 
	$·th
 (
£t
 
RX_DIS
 
b™
)

176 
loÿl
 
SECRXCTRL__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXCTRL
), 1è--
£t
 
RX_DIS


177 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECRXCTRL
, 
SECRXCTRL__VALUE
)

179 -- 
Wa™
 
the
 
d©a
 
·ths
 
to
 
be
 
em±›d
 
by
 
	`h¬dw¬e
 (
check
 
SECTX
/
RX_RDY
 
b™s
).

180 
»³©


181 --
	`´št
("Waiting for„egisterso be‡sserted by hardware...")

182 
dpdk
.
	`¦“pMlis
(100è-- 
wa™
 100
ms
 
befÜe
 
pŞl


183 
loÿl
 
SECTXSTAT__SECTX_RDY
 = 
b™
.
	`bªd
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXSTAT
), 0x1)

184 
loÿl
 
SECRXSTAT__SECRX_RDY
 = 
b™
.
	`bªd
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXSTAT
), 0x1)

185 --
	`´št
("SECTX_RDY: "..
SECTXSTAT__SECTX_RDY
..", SECRX_RDY: "..
SECRXSTAT__SECRX_RDY
)

186 
uÁ
 
SECTXSTAT__SECTX_RDY
 =ğ0x1 
ªd
 
SECRXSTAT__SECRX_RDY
 == 0x1

188 -- 
Di§bË
 
IP£c
 
TX
 
SA
 
lookup


189 
loÿl
 
IPSTXIDX__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSTXIDX
), 0è--
ş—r
 
IPS_TX_EN


190 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSTXIDX
, 
IPSTXIDX__VALUE
)

192 -- 
Di§bË
 
IP£c
 
RX
 
SA
 
lookup


193 
loÿl
 
IPSRXIDX__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 0è--
ş—r
 
IPS_RX_EN


194 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
IPSRXIDX__VALUE
)

196 --
TODO
: 
wh©
 
about
 
MINSECIFG
?

198 -- 
S‘
 
FULLTHRESH
 
to
 0x250

199 
loÿl
 
SECTXBUFFAF__VALUE
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXBUFFAF
), 9, 0, 0x250è--
£t
 
FULLTHRESH


200 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXBUFFAF
, 
SECTXBUFFAF__VALUE
)

202 -- 
Di§bË
 
TX
 
üy±o
 
’gše


203 
loÿl
 
SECTXCTRL__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXCTRL
), 0è--
£t
 
SECTX_DIS


204 
SECTXCTRL__VALUE
 = 
	`ş—r_b™32
(SECTXCTRL__VALUE, 2è--
ş—r
 
STORE_FORWARD


205 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXCTRL
, 
SECTXCTRL__VALUE
)

207 -- 
Di§bË
 
RX
 
üy±o
 
’gše


208 
loÿl
 
SECRXCTRL__VALUE
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXCTRL
), 0è--
£t
 
SECRX_DIS


209 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECRXCTRL
, 
SECRXCTRL__VALUE
)

211 -- 
Re¡¬t
 
TX
 
d©a
 
	$·th
 (
ş—r
 
TX_DIS
 
b™
)

212 
loÿl
 
SECTXCTRL__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECTXCTRL
), 1è--
ş—r
 
TX_DIS


213 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
SECTXCTRL
, 
SECTXCTRL__VALUE
)

215 -- 
Re¡¬t
 
RX
 
d©a
 
	$·th
 (
ş—r
 
RX_DIS
 
b™
)

216 
loÿl
 
SECRXCTRL__VALUE
 = 
	`ş—r_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
SECRXCTRL
), 1è--
ş—r
 
RX_DIS


217 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
SECRXCTRL
, 
SECRXCTRL__VALUE
)

219 
	$dump_»gs
(
pÜt
)

220 
’d


222 --- 
Wr™e
 
AES
 128 
b™
 
Key
 
ªd
 
S®t
 
što
 
the
 
H¬dw¬e
 
TX
 
SA
 
bË


223 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


224 --- @
·rma
 
idx
 
Index
 
što
 
TX
 
SA
 
	`bË
 (0-1023)

225 --- @
·¿m
 
key
 128 
b™
 
AES
 
	`key
 (
as
 
hex
 
¡ršg
)

226 --- @
·¿m
 
§É
 32 
b™
 
AES
 
	$§É
 (
as
 
hex
 
¡ršg
)

227 
funùiÚ
 
mod
.
	$tx_£t_key
(
pÜt
, 
idx
, 
key
, 
§É
)

228 
idx
 > 1023 
Ü
 idx < 0 
th’


229 
log
:
	`çl
("Idx must be in„ange 0-1023")

230 
’d


231 
¡ršg
.
	`Ën
(
key
è~ğ32 
th’


232 
log
:
	`çl
("Key must be 128 bit (hex string).")

233 
’d


234 
¡ršg
.
	`Ën
(
§É
è~ğ8 
th’


235 
log
:
	`çl
("Salt must be 32 bit (hex string).")

236 
’d


238 
loÿl
 
key_3
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 1, 8), 16è--
MSB


239 
loÿl
 
key_2
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 9, 16), 16)

240 
loÿl
 
key_1
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 17, 24), 16)

241 
loÿl
 
key_0
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 25, 32), 16è--
LSB


242 
loÿl
 
_§É
 = 
	`tÚumb”
(
§É
, 16)

244 -- 
P»·»
 
commªd
 
to
 
wr™e
 
key
Ø
SA_IDX


245 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSTXIDX
), 12, 3, 
idx
è--
£t
 
SA_IDX


246 
v®ue
 = 
	`ş—r_b™32
(v®ue, 30è--
ş—r
 
READ


247 
v®ue
 = 
	`£t_b™32
(v®ue, 31è--
£t
 
WRITE


248 --
	`´št
("IPSTXIDX: 0x"..
	`uhex32
(
v®ue
))

250 --
´•¬e
 
»gi¡”s


251 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSTXKEY_3
, 
key_3
)

252 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSTXKEY_2
, 
key_2
)

253 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSTXKEY_1
, 
key_1
)

254 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSTXKEY_0
, 
key_0
)

255 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSTXSALT
, 
_§É
)

256 --
push
 
to
 
hw


257 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSTXIDX
, 
v®ue
)

258 --
·ss
 
SA_IDX
 
vŸ
 'TX cÚ‹xˆdesütÜ' 
to
 
u£
 
this
 
SA
!

259 
’d


261 --- 
R—d
 
AES
 128 
b™
 
Key
 
ªd
 
S®t
 
äom
 
the
 
H¬dw¬e
 
TX
 
SA
 
bË


262 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


263 --- @
·¿m
 
idx
 
Index
 
što
 
the
 
TX
 
SA
 
	`bË
 (0-1023)

264 --- @ 
Key
 
ªd
 
	$S®t
 (
as
 
hex
 
¡ršg
)

265 
funùiÚ
 
mod
.
	$tx_g‘_key
(
pÜt
, 
idx
)

266 
idx
 > 1023 
Ü
 idx < 0 
th’


267 
log
:
	`çl
("Idx must be in„ange 0-1023")

268 
’d


270 -- 
P»·»
 
commªd
 
to
 
»ad
 
key
 
äom
 
SA_IDX


271 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSTXIDX
), 12, 3, 
idx
è--
£t
 
SA_IDX


272 
v®ue
 = 
	`£t_b™32
(v®ue, 30è--
£t
 
READ


273 
v®ue
 = 
	`ş—r_b™32
(v®ue, 31è--
ş—r
 
WRITE


274 --
	`´št
("IPSTXIDX: 0x"..
	`uhex32
(
v®ue
))

276 --
puÎ
 
äom
 
hw


277 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSTXIDX
, 
v®ue
)

279 --
ãtch
 
»suÉ


280 
loÿl
 
key_3
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSTXKEY_3
)

281 
loÿl
 
key_2
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSTXKEY_2
)

282 
loÿl
 
key_1
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSTXKEY_1
)

283 
loÿl
 
key_0
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSTXKEY_0
)

284 
loÿl
 
_§É
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSTXSALT
)

286 
loÿl
 
key
 = 
	`uhex32
(
key_3
)..uhex32(
key_2
)..uhex32(
key_1
)..
	$uhex32
(
key_0
)

288  
key
, 
	$uhex32
(
_§É
)

289 
’d


291 --- 
Wr™e
 
AES
 128 
b™
 
Key
 
ªd
 
S®t
 
što
 
the
 
H¬dw¬e
 
RX
 
SA
 
bË


292 --- @
·¿m
 
pÜt
 
the
…Üt/
š‹rçû
 
to
 
u£


293 --- @
·¿m
 
idx
 
Index
 
što
 
SA
 
RX
 
	`bË
 (0-1023)

294 --- @
·¿m
 
key
 128 
b™
 
AES
 
	`key
 (
as
 
hex
 
¡ršg
)

295 --- @
·¿m
 
§É
 32 
b™
 
AES
 
	`§É
 (
as
 
hex
 
¡ršg
)

296 --- @
·¿m
 
_v”
 
IP
 
V”siÚ
 
which
 
this
 
SA
 
is
 
	`v®id
 (4 
Ü
 6)

297 --- @
·¿m
 
´Ùo
 
IPSec
 
´ÙocŞ
 
ty³
 
to
 
	`u£
 ("e¥" 
Ü
 "ah")

298 --- @
·¿m
 
deüy±
 
ESP
 
	$mode
 (1=
ESP
 
deüy±
 
ªd
 
auth’tiÿ‹
, 0=ESP‡uth’tiÿ‹ 
Úly
)

299 
funùiÚ
 
mod
.
	$rx_£t_key
(
pÜt
, 
idx
, 
key
, 
§É
, 
_v”
, 
´Ùo
, 
deüy±
)

300 
idx
 > 1023 
Ü
 idx < 0 
th’


301 
log
:
	`çl
("Idx must be in„ange 0-1023")

302 
’d


303 
¡ršg
.
	`Ën
(
key
è~ğ32 
th’


304 
log
:
	`çl
("Key must be 128 bit (hex string).")

305 
’d


306 
¡ršg
.
	`Ën
(
§É
è~ğ8 
th’


307 
log
:
	`çl
("Salt must be 32 bit (hex string).")

308 
’d


310 
loÿl
 
v6
 = 
n


311 
_v”
 =ğ4 
th’


312 
v6
 = 0

313 
–£if
 
_v”
 =ğ6 
th’


314 
v6
 = 1

316 
log
:
	`çl
("IP version must beƒither 4 or 6")

317 
’d


319 
loÿl
 
e¥
 = 
n


320 
´Ùo
 =ğ"e¥" 
th’


321 
e¥
 = 1

322 
–£if
 
´Ùo
 =ğ"ah" 
th’


323 
e¥
 = 0

325 
log
:
	`çl
("Protocol must beƒither 'esp' or 'ah'")

326 
’d


328 
loÿl
 
e¥_mode
 = 
deüy±
 
Ü
 0

329 
e¥_mode
 ~ğ1 
ªd
ƒ¥_mod~ğ0 
th’


330 
log
:
	`çl
("ESP Decrypt must beƒither 0 or 1")

331 
’d


333 
loÿl
 
key_3
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 1, 8), 16è--
MSB


334 
loÿl
 
key_2
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 9, 16), 16)

335 
loÿl
 
key_1
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 17, 24), 16)

336 
loÿl
 
key_0
 = 
	`tÚumb”
(
¡ršg
.
	`sub
(
key
, 25, 32), 16è--
LSB


337 
loÿl
 
_§É
 = 
	`tÚumb”
(
§É
, 16)

339 -- 
P»·»
 
commªd
 
to
 
wr™e
 
KEY_TABLE
 
©
 
TB_IDX


340 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 2, 1, 0x3è--
£t
 
TABLE
 
to
 
	$KEY
(0x3)

341 
v®ue
 = 
	`£t_b™s32
(v®ue, 12, 3, 
idx
è--
£t
 
TB_IDX


342 
v®ue
 = 
	`ş—r_b™32
(v®ue, 30è--
ş—r
 
READ


343 
v®ue
 = 
	`£t_b™32
(v®ue, 31è--
£t
 
WRITE


344 --
	`´št
("IPSRXIDX: 0x"..
	`uhex32
(
v®ue
))

346 -- 
P»·»
 
£cur™y
 
mode
 

347 
loÿl
 
mode
 = 
	`£t_b™32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXMOD
), 0è--
£t
 
VALID
, 1=
v®id
, 0=
šv®id
 
SA


348 
mode
 = 
	`£t_b™s32
(mode, 2, 2, 
e¥
è--
£t
 
PROTO
, 1=
ESP
, 0=
AH


349 
mode
 = 
	`£t_b™s32
(mode, 3, 3, 
e¥_mode
è--
£t
 
DECRYPT
, 1=
	`deüy±
(
ESP
), 0=
	$auth’tiÿ‹
(
ESP
)

350 
mode
 = 
	`£t_b™s32
(mode, 4, 4, 
v6
è--
£t
 
IPV6
, 1=
IPv6
, 0=
IPv4


352 --
´•¬e
 
»gi¡”s


353 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXKEY_3
, 
key_3
)

354 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXKEY_2
, 
key_2
)

355 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXKEY_1
, 
key_1
)

356 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXKEY_0
, 
key_0
)

357 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXSALT
, 
_§É
)

358 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXMOD
, 
mode
)

359 --
push
 
to
 
hw


360 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
v®ue
)

361 
’d


363 --- 
R—d
 
AES
 128 
b™
 
Key
 
ªd
 
S®t
 
äom
 
the
 
H¬dw¬e
 
RX
 
SA
 
bË


364 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


365 --- @
·¿m
 
idx
 
Index
 
što
 
the
 
RX
 
SA
 
	`bË
 (0-1023)

366 --- @ 
Key
 
ªd
 
	`S®t
 (
as
 
hex
 
¡ršg
),

367 --- 
V®id
 
	`FÏg
 (1=
SA
 
is
 
v®id
, 0=SA i 
šv®id
),

368 --- 
PrÙo
 
	`FÏg
 (1=
ESP
, 0=
AH
),

369 --- 
Deüy±
 
	`FÏg
 (1=
ESP
 
deüy±
 
ªd
 
auth’tiÿ‹
, 0=ESP‡uth’tiÿ‹ 
Úly
),

370 --- 
IPv6
 
	$FÏg
 (1=
SA
 
is
 
v®id
 
IPv6
, 0=SA i v®id 
IPv4
)

371 
funùiÚ
 
mod
.
	$rx_g‘_key
(
pÜt
, 
idx
)

372 
idx
 > 1023 
Ü
 idx < 0 
th’


373 
log
:
	`çl
("Idx must be in„ange 0-1023")

374 
’d


376 -- 
P»·»
 
commªd
 
to
 
»ad
 
äom
 
KEY_TABLE
 
©
 
TB_IDX


377 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 2, 1, 0x3è--
£t
 
TABLE
 
to
 
	$KEY
(0x3)

378 
v®ue
 = 
	`£t_b™s32
(v®ue, 12, 3, 
idx
è--
£t
 
TB_IDX


379 
v®ue
 = 
	`£t_b™32
(v®ue, 30è--
£t
 
READ


380 
v®ue
 = 
	`ş—r_b™32
(v®ue, 31), --
ş—r
 
WRITE


381 --
	`´št
("IPSRXIDX: 0x"..
	`uhex32
(
v®ue
))

383 --
puÎ
 
äom
 
hw


384 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
v®ue
)

386 --
ãtch
 
»suÉ


387 
loÿl
 
key_3
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXKEY_3
)

388 
loÿl
 
key_2
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXKEY_2
)

389 
loÿl
 
key_1
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXKEY_1
)

390 
loÿl
 
key_0
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXKEY_0
)

391 
loÿl
 
_§É
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXSALT
)

392 
loÿl
 
_mode
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXMOD
)

394 
loÿl
 
v®id
 = 
b™
.
	`rshiá
(b™.
	`bªd
(
_mode
, 0x01), 0)

395 
loÿl
 
´Ùo
 = 
b™
.
	`rshiá
(b™.
	`bªd
(
_mode
, 0x04), 2)

396 
loÿl
 
deüy±
 = 
b™
.
	`rshiá
(b™.
	`bªd
(
_mode
, 0x08), 3)

397 
loÿl
 
v6
 = 
b™
.
	`rshiá
(b™.
	`bªd
(
_mode
, 0x10), 4)

398 
loÿl
 
key
 = 
	`uhex32
(
key_3
)..uhex32(
key_2
)..uhex32(
key_1
)..
	$uhex32
(
key_0
)

400  
key
, 
	`uhex32
(
_§É
), 
v®id
, 
´Ùo
, 
deüy±
, 
v6


401 
’d


403 --- 
Wr™e
 
IP
-
Add»ss
 
što
 
the
 
H¬dw¬e
 
RX
 IP 
bË


404 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


405 --- @
·¿m
 
idx
 
Index
 
što
 
the
 
RX
 
IP
 
	`bË
 (0-127).

406 --- @
·¿m
 
_addr
 
	`IP
(
v4
/
v6
)-
Add»ss
 
to
 
	$£t
 (
as
 
¡ršg
)

407 
funùiÚ
 
mod
.
	$rx_£t_
(
pÜt
, 
idx
, 
_addr
)

408 
idx
 > 127 
Ü
 idx < 0 
th’


409 
log
:
	`çl
("Idx must be in„ange 0-127")

410 
’d


412 
loÿl
 

, 
is_v4
 = 
	$·r£IPAdd»ss
(
_addr
)

414 
loÿl
 
_3
 = 0x0

415 
loÿl
 
_2
 = 0x0

416 
loÿl
 
_1
 = 0x0

417 
loÿl
 
_0
 = 0x0

419 
is_v4
 =ğ
Œue
 
th’


420 
_3
 = 
	$bsw­
(

)

422 
_3
 = 
	$bsw­
(

.
ušt32
[0])

423 
_2
 = 
	$bsw­
(

.
ušt32
[1])

424 
_1
 = 
	$bsw­
(

.
ušt32
[2])

425 
_0
 = 
	$bsw­
(

.
ušt32
[3])

426 
’d


428 -- 
P»·»
 
commªd
 
to
 
wr™e
Ø
IP_TABLE
 
©
 
TB_IDX


429 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 2, 1, 0x1è--
£t
 
TABLE
 
to
 
	$IP
(0x1)

430 
v®ue
 = 
	`£t_b™s32
(v®ue, 12, 3, 
idx
è--
£t
 
TB_IDX


431 
v®ue
 = 
	`ş—r_b™32
(v®ue, 30è--
ş—r
 
READ


432 
v®ue
 = 
	`£t_b™32
(v®ue, 31è--
£t
 
WRITE


433 --
	`´št
("IPSRXIDX: 0x"..
	`uhex32
(
v®ue
))

435 --
´•¬e
 
»gi¡”s


436 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXIPADDR_3
, 
_3
)

437 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXIPADDR_2
, 
_2
)

438 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXIPADDR_1
, 
_1
)

439 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXIPADDR_0
, 
_0
)

440 --
push
 
to
 
hw


441 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
v®ue
)

442 
’d


444 --- 
R—d
 
IP
-
Add»ss
 
äom
 
the
 
H¬dw¬e
 
RX
 IP 
bË


445 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


446 --- @
·¿m
 
idx
 
Index
 
što
 
the
 
RX
 
IP
 
	`bË
 (0-127)

447 --- @
·¿m
 
is_v4
 
IP
 
V”siÚ
 
	`ex³ùed
 (
Œue
/
çl£
)

448 --- @ 
The
 
	`IP
(
v4
/
v6
)-
	$Add»ss
 (
as
 
¡ršg
è
ªd
 
a
 
IP
 
V”siÚ
 
	$FÏg
 (
Œue
=
IPv4
, 
çl£
=
IPv6
)

449 
funùiÚ
 
mod
.
	$rx_g‘_
(
pÜt
, 
idx
, 
is_v4
)

450 
idx
 > 127 
Ü
 idx < 0 
th’


451 
log
:
	`çl
("Idx must be in„ange 0-127")

452 
’d


453 
is_v4
 =ğ
n
 
th’


454 
is_v4
 = 
Œue


455 
’d


457 -- 
P»·»
 
commªd
 
to
 
»ad
 
äom
 
IP_TABLE
 
©
 
TB_IDX


458 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 2, 1, 0x1è--
£t
 
TABLE
 
to
 
	$IP
(0x1)

459 
v®ue
 = 
	`£t_b™s32
(v®ue, 12, 3, 
idx
è--
£t
 
TB_IDX


460 
v®ue
 = 
	`£t_b™32
(v®ue, 30è--
£t
 
READ


461 
v®ue
 = 
	`ş—r_b™32
(v®ue, 31è--
ş—r
 
WRITE


462 --
	`´št
("IPSRXIDX: 0x"..
	`uhex32
(
v®ue
))

464 --
puÎ
 
äom
 
hw


465 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
v®ue
)

466 --
ãtch
 
»suÉ


467 
loÿl
 
_3
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXIPADDR_3
)

468 
loÿl
 
_2
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXIPADDR_2
)

469 
loÿl
 
_1
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXIPADDR_1
)

470 
loÿl
 
_0
 = 
dpdkc
.
	$»ad_»g32
(
pÜt
, 
IPSRXIPADDR_0
)

472 
loÿl
 

 = 
n


473 
is_v4
 =ğ
Œue
 
th’


474 
loÿl
 
4
 = 
ffi
.
	`Ãw
("union ip4_address")

475 
4
.
ušt32
 = 
_3


476 

 = 
4
:
	$g‘SŒšg
()

478 
loÿl
 
6
 = 
ffi
.
	`Ãw
("union ip6_address")

479 
6
.
ušt32
[3] = 
_3


480 
6
.
ušt32
[2] = 
_2


481 
6
.
ušt32
[1] = 
_1


482 
6
.
ušt32
[0] = 
_0


483 

 = 
6
:
	$g‘SŒšg
()

484 
’d


486  

, 
is_v4


487 
’d


489 --- 
Wr™e
 
SPI
 
što
 
the
 
H¬dw¬e
 
RX
 SPI 
bË


490 --- 
This
 
bË
 
funùiÚs
 
as
 'glue' 
b‘w“n
 
the
 
»ûived
 
	`·ck‘
 (
SPI
), 
IP
 
ªd
 
KEY
able.

491 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


492 --- @
·¿m
 
idx
 
Index
 
što
 
the
 
RX
 
SPI
 
	`bË
 (0-1023). 
This
 
mu¡
 
m©ch
hidx 
of
h
cÜ»¥Údšg
 
KEY
 
bË
 
’Œy
.

493 --- @
·¿m
 
¥i
 
SPI
 
to
 
	`wr™e
 (0-0xFFFFFFFF)

494 --- @
·¿m
 
_idx
 
Reã»nû
 
to
 
the
 
IP
 
bË
. 
This
 
mu¡
 
m©ch
h
idx
 
of
h
cÜ»¥Údšg
 IPabË 
’Œy
.

495 
funùiÚ
 
mod
.
	$rx_£t_¥i
(
pÜt
, 
idx
, 
¥i
, 
_idx
)

496 
idx
 > 1023 
Ü
 idx < 0 
th’


497 
log
:
	`çl
("Idx must be in„ange 0-1023")

498 
’d


499 
¥i
 > 0xFFFFFFFF 
Ü
 sp˜< 0 
th’


500 
log
:
	`çl
("Spi must be in„ange 0x0-0xFFFFFFFF")

501 
’d


502 
_idx
 > 127 
Ü
 ip_idx < 0 
th’


503 
log
:
	`çl
("IP_Idx must be in„ange 0-127")

504 
’d


506 -- 
P»·»
 
commªd
 
to
 
wr™e
 
SPI_TABLE
 
©
 
TB_IDX


507 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 2, 1, 0x2è--
£t
 
TABLE
 
to
 
	$SPI
(0x2)

508 
v®ue
 = 
	`£t_b™s32
(v®ue, 12, 3, 
idx
è--
£t
 
TB_IDX


509 
v®ue
 = 
	`ş—r_b™32
(v®ue, 30è--
ş—r
 
READ


510 
v®ue
 = 
	`£t_b™32
(v®ue, 31è--
£t
 
WRITE


511 --
	`´št
("IPSRXIDX: 0x"..
	`uhex32
(
v®ue
))

513 -- 
P»·»
 
_idx
 
f›ld


514 
_idx
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIPIDX
), 6, 0, ip_idxè--
£t
 
IP_IDX


516 --
´•¬e
 
»gi¡”s


517 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXSPI
, 
	`bsw­
(
¥i
)è--
ÃtwÜk
 
by‹
 
Üd”
!

518 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXIPIDX
, 
_idx
)

519 --
push
 
to
 
hw


520 
dpdkc
.
	$wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
v®ue
)

521 
’d


523 --- 
R—d
 
SPI
 
äom
 
the
 
H¬dw¬e
 
RX
 SPI 
bË


524 --- @
·¿m
 
pÜt
 
The
…Üt/
š‹rçû
 
to
 
u£


525 --- @
·¿m
 
idx
 
Index
 
što
 
the
 
RX
 
SPI
 
	`bË
 (0-1023)

526 --- @ 
The
 
SPI
 
ªd
 
the
 
cÜ»¥Údšg
 
Index
 
što
h
IP
 
bË


527 
funùiÚ
 
mod
.
	$rx_g‘_¥i
(
pÜt
, 
idx
)

528 
idx
 > 1023 
Ü
 idx < 0 
th’


529 
log
:
	`çl
("Idx must be in„ange 0-1023")

530 
’d


532 -- 
P»·»
 
commªd
 
to
 
»ad
 
äom
 
SPI_TABLE
 
©
 
TB_IDX


533 
loÿl
 
v®ue
 = 
	`£t_b™s32
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIDX
), 2, 1, 0x2è--
£t
 
TABLE
 
to
 
	$SPI
(0x2)

534 
v®ue
 = 
	`£t_b™s32
(v®ue, 12, 3, 
idx
è--
£t
 
TB_IDX


535 
v®ue
 = 
	`£t_b™32
(v®ue, 30è--
£t
 
READ


536 
v®ue
 = 
	`ş—r_b™32
(v®ue, 31è--
ş—r
 
WRITE


537 --
	`´št
("IPSRXIDX: 0x"..
	`uhex32
(
v®ue
))

539 --
puÎ
 
äom
 
hw


540 
dpdkc
.
	`wr™e_»g32
(
pÜt
, 
IPSRXIDX
, 
v®ue
)

541 --
ãtch
 
»suÉ


542 
loÿl
 
¥i
 = 
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXSPI
è--
ÃtwÜk
 
by‹
 
Üd”
!

543 
loÿl
 
_idx
 = 
b™
.
	`bªd
(
dpdkc
.
	`»ad_»g32
(
pÜt
, 
IPSRXIPIDX
), 0x7fè--
IP_IDX
 
š
 
b™s
 6:0

545  
	`bsw­
(
¥i
), 
_idx


546 
’d


548 --- 
C®cuÏ‹
 
the
 
Ëngth
 
of
 
exŒa
 
·ddšg
 
Ãeded
, 
š
 
Üd”
 
to
 
achive
 
a
 4 
by‹
 
®ignm’t
.

549 --- @
·¿m
 
·ylßd_Ën
 
The
 
Ënght
 
of
 
the
 
Üigš®
 
IP
 
·ck‘


550 --- @ 
The
 
numb”
 
of
 
exŒa
 
·ddšg
 
by‹s
 
Ãeded


551 
funùiÚ
 
mod
.
	$ÿlc_exŒa_·d
(
·ylßd_Ën
)

552 
loÿl
 
idx
 = 
m©h
.
	`û
(
·ylßd_Ën
/4)

553 
loÿl
 
idx8
 = 
idx
 * 4

554 
loÿl
 
exŒa_·d
 = 
idx8
 - 
·ylßd_Ën


555  
exŒa_·d


556 
’d


558 --- 
C®cuÏ‹
 
the
 
Ëngth
 
of
 
exŒa
 
·ddšg
 
šşuded
 
š
 
this
 
·ck‘
 4 
by‹
 
®ignm’t
.

559 --- @
·¿m
 
buf
 
The
 
¹e_mbuf
 
cÚššg
 
the
 
hw
-
deüy±ed
 
ESP
 
·ck‘


560 --- @ 
The
 
numb”
 
of
 
exŒa
 
·ddšg
 
by‹s
 
šşuded
 
š
 
this
 
·ck‘


561 
funùiÚ
 
mod
.
	$g‘_exŒa_·d
(
buf
)

562 
loÿl
 
pkt
 = 
buf
:
	$g‘IPPack‘
()

563 
loÿl
 
·ylßd_Ën
 = 
pkt
.
4
:
	`g‘L’gth
()-20 --
IP4
 
L’gth
 
Ëss
 20 
by‹s
 IP4 
H—d”


564 --
	`ESP_ICV
(16), 
	`ESP_Ãxt_hdr
(1), 
	$¬¿y_off£t
(1)

565 
loÿl
 
e¥_·ddšg_Ën
 = 
pkt
.
·ylßd
.
ušt8
[
·ylßd_Ën
-16-1-1]

566  
e¥_·ddšg_Ën
-2 --
subŒaù
  
·ddšg
 
of
 2 
by‹s
, 
which
 
is
 
®ways
 
th”e


567 
’d


569 --- 
C®cuÏ‹
 
a
 
ESP
 
T¿”
 
ªd
 
the
 
cÜ»¥Údšg
 
Paddšg
‡nd 
­³nd
 
to
h
·ck‘
 
·ylßd
.

570 --- 
OÆy
 
»Ëvªt
 
ESP
/
Eüy±iÚ
 
mode


571 --- @
·¿m
 
buf
 
¹e_mbuf
 
to
 
add
 
e¥
 
Œa”
o

572 --- @
·¿m
 
·ylßd_Ën
 
»®
 
·ylßd
 
Ëngth
 
š
 
by‹s


573 --- @
·¿m
 
Ãxt_hdr
 
ty³
 
of
 
’ÿpsuÏ‹d
 
·ck‘


574 
funùiÚ
 
mod
.
	$add_e¥_Œa”
(
buf
, 
·ylßd_Ën
, 
Ãxt_hdr
)

575 
loÿl
 
pkt
 = 
buf
:
	$g‘E¥Pack‘
()

576 
loÿl
 
idx
 = 
m©h
.
	`û
(
·ylßd_Ën
/4)

577 
loÿl
 
idx8
 = 
idx
 * 4

578 
loÿl
 
exŒa_·d
 = 
idx8
 - 
·ylßd_Ën


579 
loÿl
 
·d_Ën
 = 2 + 
exŒa_·d


580 
loÿl
 
e¥_Œa”_Ën
 = 20 + 
exŒa_·d


582 
pkt
.
·ylßd
.
ušt8
[
idx8
+0] = 0x00

583 
pkt
.
·ylßd
.
ušt8
[
idx8
+1] = 0x00

584 
pkt
.
·ylßd
.
ušt8
[
idx8
+2] = 
·d_Ën


585 
pkt
.
·ylßd
.
ušt8
[
idx8
+3] = 
Ãxt_hdr


587 
pkt
.
·ylßd
.
ušt32
[
idx
+1] = 0x00 -- 
ICV
 
n
-3

588 
pkt
.
·ylßd
.
ušt32
[
idx
+2] = 0x00 -- 
ICV
 
n
-2

589 
pkt
.
·ylßd
.
ušt32
[
idx
+3] = 0x00 -- 
ICV
 
n
-1

590 
pkt
.
·ylßd
.
ušt32
[
idx
+4] = 0x00 -- 
ICV
 
n
-0

592 
buf
:
	$£tESPT¿”L’gth
(
e¥_Œa”_Ën
)

593 
’d


595 --- 
DeÿpsuÏ‹
 
a
 
hw
-
deüy±ed
 
ESP
 
·ck‘


596 --- @
·¿m
 
buf
 
The
 
¹e_mbuf
 
cÚššg
 
the
 
hw
-
deüy±ed
 
ESP
 
·ck‘


597 --- @
·¿m
 
Ën
 
L’gth
 
of
 
the
 
hw
-
deüy±ed
 
IP
/
ESP
 
·ck‘


598 --- @
·¿m
 
‘h_mem
 
memÜyPoŞ
 
to
 
®loÿ‹
 
Ãw
 
‘h”Ãt
 
·ck‘s
 
äom


599 --- @ 
A
 
Ãw
 
¹e_mbuf
 
cÚššg
 
the
 
	$Üigš®
 (
šÃr
è
IP
 
·ck‘


600 
funùiÚ
 
mod
.
	$e¥_v²_deÿpsuÏ‹
(
buf
, 
Ën
, 
‘h_mem
)

601 
loÿl
 
exŒa_·d
 = 
mod
.
	`g‘_exŒa_·d
(
buf
)

602 -- 
	`‘h
(14), 
	`pkt
(
Ën
), 
	`·d
(
exŒa_·d
), 
	`ou‹r_
(20), 
	`e¥_h—d”
(16), 
	$e¥_Œa”
(20)

603 
loÿl
 
Ãw_Ën
 = 14+
Ën
-
exŒa_·d
-20-16-20

605 
loÿl
 
mybuf
 = 
‘h_mem
:
	$®loc
(
Ãw_Ën
)

606 
loÿl
 
Ãw_pkt
 = 
mybuf
:
	$g‘EthPack‘
()

608 
loÿl
 
e¥_pkt
 = 
buf
:
	$g‘E¥Pack‘
()

609 
ffi
.
	`cİy
(
Ãw_pkt
.
·ylßd
, 
e¥_pkt
.·ylßd, 
Ãw_Ën
-14)

611  
mybuf


612 
’d


614 --- 
EnÿpsuÏ‹
 
ª
 
IP
 
·ck‘
 
što
 
a
 
Ãw
 IP 
h—d”
 
ªd
 
ESP
 h—d”‡nd 
Œa”


615 --- @
·¿m
 
buf
 
The
 
¹e_mbuf
 
cÚššg
 
the
 
Üigš®
 
IP
 
·ck‘


616 --- @
·¿m
 
Ën
 
L’gth
 
of
 
the
 
Üigš®
 
IP
 
·ck‘


617 --- @
·¿m
 
e¥_mem
 
memÜyPoŞ
 
to
 
®loÿ‹
 
Ãw
 
e¥
 
·ck‘s
 
äom


618 --- @ 
A
 
Ãw
 
¹e_mbuf
 
cÚššg
 
the
 
’ÿpsuÏ‹d
 
IP
/
ESP
 
·ck‘


619 
funùiÚ
 
mod
.
	$e¥_v²_’ÿpsuÏ‹
(
buf
, 
Ën
, 
e¥_mem
)

620 
loÿl
 
exŒa_·d
 = 
mod
.
	`ÿlc_exŒa_·d
(
Ën
è--4 
by‹
 
®ignm’t


621 -- 
	`‘h
(14), 
	`4
(20), 
	`e¥
(16), 
	`pkt
(
Ën
), 
	`·d
(
exŒa_·d
), 
	$e¥_Œa”
(20)

622 
loÿl
 
Ãw_Ën
 = 14+20+16+
Ën
+
exŒa_·d
+20

624 
loÿl
 
mybuf
 = 
e¥_mem
:
	$®loc
(
Ãw_Ën
)

625 
loÿl
 
Ãw_pkt
 = 
mybuf
:
	$g‘E¥Pack‘
()

627 
loÿl
 
‘h_pkt
 = 
buf
:
	$g‘EthPack‘
()

628 
Ãw_pkt
.
4
:
	`£tL’gth
(
Ãw_Ën
-14)

629 --
i
 = 0, 
Ën
-1 do

630 -- 
Ãw_pkt
.
·ylßd
.
ušt8
[
i
] = 
‘h_pkt
.payload.uint8[i]

631 --
’d


632 
ffi
.
	$cİy
(
Ãw_pkt
.
·ylßd
, 
‘h_pkt
.·ylßd, 
Ën
)

634 
mod
.
	`add_e¥_Œa”
(
mybuf
, 
Ën
, 0x4è-- 
TuÂ–
 
mode
: 
Ãxt_h—d”
 = 0x4 (
IPv4
)

636  
mybuf


637 
’d


639  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/kni.lua

1 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

2 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

3 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

4 
»quœe
 "utils"

6 
loÿl
 
mod
 = {}

8 
loÿl
 
mg_kni
 = {}

9 
mod
.
mg_kni
 = mg_kni

10 
mg_kni
.
__šdex
 = mg_kni

12 
ffi
.
cdef
[[

13 
¹e_kni
;

14 
¹e_kni
 * 
mg_ü—‹_kni
(
ušt8_t
 
pÜt_id
, ušt8_ˆ
cÜe_id
, * 
mempoŞ_±r
, cÚ¡ 
Çme
[]);

15 
mg_kni_tx_bur¡
 ( 
¹e_kni
 * 
kni
,

16 
¹e_mbuf
 ** 
mbufs
,

17 
num


19 
¹e_kni_rx_bur¡
 ( 
¹e_kni
 * 
kni
,

20 
¹e_mbuf
 ** 
mbufs
,

21 
num


23 
¹e_kni_hªdË_»que¡
 ( 
¹e_kni
 * 
kni
 );

24 
mg_kni_tx_sšgË
(
¹e_kni
 * 
kni
, 
¹e_mbuf
 * 
mbuf
);

25 
¹e_kni_şo£
 ( );

26 
¹e_kni_»Ëa£
 ( 
¹e_kni
 * 
kni
 );

27 
¹e_kni_š™
(
max_kni_içûs
);

30 -- 
Úly
 
wÜks
 
	gw™h
 "insmod deps/dpdk/x86_64-native-linuxapp-gcc/kmod/rte_kni.ko"

31 
funùiÚ
 
	gmod
.
	$ü—‹Kni
(
cÜe
, 
deviû
, 
mempoŞ
, 
Çme
)

32 
cÜe
 = cÜ
Ü
 0

33 
loÿl
 
kni
 = 
ffi
.
C
.
	$mg_ü—‹_kni
(
deviû
.
id
, 
cÜe
, 
mempoŞ
, 
Çme
)

34  
	`£tm‘©abË
({

35 
kni
 = kni,

36 
cÜe
 = core,

37 
deviû
 = device,

38 
Çme
 =‚ame

39 
	}
}, 
	gmg_kni
)

40 
	g’d


42 -- 
nÙ
 
blockšg
 
»cv


43 
funùiÚ
 
	gmg_kni
:
	$»cv
(
bufs
, 
nmax
)

44  
ffi
.
C
.
	$¹e_kni_rx_bur¡
(
£lf
.
kni
, 
bufs
.
¬¿y
, 
nmax
)

45 
’d


47 
funùiÚ
 
mg_kni
:
	$£ndN
(
bufs
, 
nmax
)

48  
ffi
.
C
.
	$mg_kni_tx_bur¡
(
£lf
.
kni
, 
bufs
.
¬¿y
, 
nmax
)

49 
’d


51 
funùiÚ
 
mg_kni
:
	$£nd
(
bufs
)

52  
ffi
.
C
.
	$mg_kni_tx_bur¡
(
£lf
.
kni
, 
bufs
.
¬¿y
, bufs.
size
)

53 
’d


55 
funùiÚ
 
mg_kni
:
	$£ndSšgË
(
mbuf
)

56 
ffi
.
C
.
	$mg_kni_tx_sšgË
(
£lf
.
kni
, 
mbuf
)

57 
’d


59 
funùiÚ
 
mg_kni
:
	$hªdËReque¡
()

60 
ffi
.
C
.
	$¹e_kni_hªdË_»que¡
(
£lf
.
kni
)

61 
’d


63 
funùiÚ
 
mg_kni
:
	$£tIP
(

, 
Ãt
)

64 

 = i°
Ü
 "192.168.1.1"

65 
Ãt
 =‚‘ 
Ü
 24

67 -- 
TODO
 
make
 
this
 
niûr


68 
io
.
	`pİ’
("/sbš/ifcÚfig " .. 
£lf
.
Çme
 .. " " .. 

 .. "/" .. 
Ãt
)

69 
£lf
:
	$hªdËReque¡
()

70 
dpdk
.
	$¦“pMlisIdË
(1)

71 
’d


73 
funùiÚ
 
mg_kni
:
	$»Ëa£
()

74  
ffi
.
C
.
	$¹e_kni_»Ëa£
(
£lf
.
kni
)

75 
’d


77 
funùiÚ
 
mod
.
	$š™
(
num
)

78  
ffi
.
C
.
	$¹e_kni_š™
(
num
)

79 
’d


81 
funùiÚ
 
mod
.
	$şo£
()

82 
ffi
.
C
.
	$¹e_kni_şo£
()

83 
’d


85  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/Serpent/init.lua

1 
loÿl
 
	gn
, 
	gv
 = "£½’t", 0.28 -- (
	gC
è2012-15 
Paul
 
	gKulch’ko
; 
MIT
 
Liûn£


2 
loÿl
 
	gc
, 
	gd
 = "Paul Kulchenko", "Lua serializer‡nd…retty…rinter"

3 
loÿl
 
	g¢um
 = {[
to¡ršg
(1/0)]='1/0 --[[math.huge]]',[tostring(-1/0)]='-1/0 --[[-math.huge]]',[tostring(0/0)]='0/0'}

4 
loÿl
 
	gbadty³
 = {
th»ad
 = 
Œue
, 
	gu£rd©a
 =rue}

5 
loÿl
 
	gkeywÜd
, 
	gglob®s
, 
	gG
 = {}, {}, (
_G
 
Ü
 
	g_ENV
)

6 
	g_
,
k
 
š
 
aœs
({'and', 'break', 'do', 'else', 'elseif', 'end', 'false',

8 '»tuº', 'th’', 'Œue', 'uÁ', 'whe'}èdØ
	gkeywÜd
[
k
] = 
Œue
 
’d


9 
k
,
v
 
š
 
	$·œs
(
G
èdØ
glob®s
[
v
] = 
k
 
’d
 -- 
bud
 
func
 
to
 
Çme
 
m­pšg


10 
_
,
g
 
š
 
	`aœs
({'cÜoutše', 'debug', 'io', 'm©h', '¡ršg', 'bË', 'os'
	}
}) do

11 
	gk
,
v
 
š
 
·œs
(
G
[
g
] 
Ü
 {}èdØ
	gglob®s
[v] = g..'.'..
k
 
’d
ƒnd

13 
loÿl
 
funùiÚ
 
	$s
(
t
, 
İts
, 
ignÜeMt
)

14 
loÿl
 
Çme
, 
šd’t
, 
çl
, 
maxnum
 = 
İts
.name, opts.indent, opts.fatal, opts.maxnum

15 
loÿl
 
¥¬£
, 
cu¡om
, 
huge
 = 
İts
.¥¬£, o±s.cu¡om, 
nÙ
 o±s.
nohuge


16 
loÿl
 
¥aû
, 
maxl
 = (
İts
.
com·ù
 
ªd
 '' 
Ü
 ' '), (İts.
maxËv–
 o¸
m©h
.
huge
)

17 
loÿl
 
šame
, 
comm
 = '_'..(
Çme
 
Ü
 ''), 
İts
.
comm’t
 
	`ªd
 (
	$tÚumb”
(
İts
.
comm’t
è
Ü
 
m©h
.
huge
)

18 
loÿl
 
£’
, 
¤ef
, 
syms
, 
symn
 = {
	}
}, {'loÿÈ'..
	gšame
..'={}'}, {}, 0

19 
loÿl
 
funùiÚ
 
	$g’sym
(
v®
è '_'..(
	`to¡ršg
(
	$to¡ršg
(
v®
)):
	`gsub
("[^%w]",""):gsub("(%d%w+)",

20 -- 
	$to¡ršg
(
v®
è
is
 
Ãeded
 
beÿu£
 
__to¡ršg
 
may
  
a
 
nÚ
-
¡ršg
 
v®ue


21 
	$funùiÚ
(
s
è
nÙ
 
syms
[s] 
th’
 
symn
 = symn+1; syms[s] = symÀ
’d
  
	$to¡ršg
(
syms
[
s
]è
’d
))ƒnd

22 
loÿl
 
funùiÚ
 
	$§ã¡r
(
s
è 
	`ty³
(sè=ğ"numb”" 
ªd
 
	`to¡ršg
(
huge
‡nd 
¢um
[to¡ršg(s)] 
	`Ü
 ("%a"):
	$fÜm©
(
s
))

23 
Ü
 
	`ty³
(
s
è~ğ"¡ršg" 
ªd
 
	`to¡ršg
(sè-- 
esÿ³
 
NEWLINE
/010‡nd 
EOF
/026

24 
	`Ü
 ("%q"):
	$fÜm©
(
s
):
	`gsub
("\010","n"):gsub("\026","\\026"è
’d


25 
loÿl
 
funùiÚ
 
	$comm’t
(
s
,
l
è 
comm
 
	`ªd
 (È
Ü
 0è< comm 
ªd
 ' --[['..
	`to¡ršg
(s)..']]' o¸'' 
’d


26 
loÿl
 
funùiÚ
 
	$glob”r
(
s
,
l
è 
glob®s
[s] 
ªd
 glob®s[s]..
	$comm’t
(
s
,
l
è
Ü
 
nÙ
 
çl


27 
ªd
 
	`§ã¡r
(
	`£Ëù
(2, 
	$pÿÎ
(
to¡ršg
, 
s
))è
Ü
 
	`”rÜ
("Cª'ˆ£rŸliz"..
	$to¡ršg
(
s
)è
’d


28 
loÿl
 
funùiÚ
 
	`§ãÇme
(
·th
, 
Çme
è-- 
g’”©es
 
foo
.
b¬
, foo[3], 
Ü
 foo['b‡„']

29 
loÿl
 
n
 = 
Çme
 =ğ
n
 
ªd
 '' 
Ü
‚ame

30 
loÿl
 
¶aš
 = 
	`ty³
(
n
è=ğ"¡ršg" 
ªd
‚:
	`m©ch
("^[%l%u_][%w_]*$"èªd 
nÙ
 
keywÜd
[n]

31 
loÿl
 
§ã
 = 
¶aš
 
ªd
 
n
 
Ü
 '['..
	`§ã¡r
(n)..']'

32  (
·th
 
Ü
 '')..(
¶aš
 
ªd
…©h‡nd '.' o¸'')..
§ã
, saã 
’d


33 
loÿl
 
®phªumsÜt
 = 
	`ty³
(
İts
.
sÜtkeys
è=ğ'funùiÚ' 
ªd
 o±s.sÜtkey 
Ü
 
	`funùiÚ
(
k
, 
o
, 
n
è-- k=
keys
, o=
Üigš®bË
,‚=
·ddšg


34 
loÿl
 
maxn
, 
to
 = 
	$tÚumb”
(
n
è
Ü
 12, {
numb”
 = 'a', 
¡ršg
 = 'b'
	}
}

35 
loÿl
 
funùiÚ
 
	$·dnum
(
d
è ("%0"..
	`to¡ršg
(
maxn
).."d"):
	`fÜm©
(
	$tÚumb”
(
d
)è
’d


36 
bË
.
	`sÜt
(
k
, 
	`funùiÚ
(
a
,
b
)

37 -- 
sÜt
 
num”ic
 
keys
 
fœ¡
: 
k
[
key
] 
is
 
nÙ
 
n
 
num”iÿl
 keys

38  (
k
[
a
] ~ğ
n
 
ªd
 0 
Ü
 
to
[
	`ty³
×)] o¸'z')..(
	$to¡ršg
(
a
):
	`gsub
("%d+",
·dnum
))

39 < (
k
[
b
] ~ğ
n
 
ªd
 0 
Ü
 
to
[
	`ty³
(b)] o¸'z')..(
	$to¡ršg
(
b
):
	`gsub
("%d+",
·dnum
)è
’d
)ƒnd

40 
loÿl
 
funùiÚ
 
	$v®2¡r
(
t
, 
Çme
, 
šd’t
, 
š¤ef
, 
·th
, 
¶aššdex
, 
Ëv–
)

41 
loÿl
 
‰y³
, 
Ëv–
, 
mt
 = 
	`ty³
(
t
), (Ëv– 
Ü
 0), 
	$g‘m‘©abË
(
t
)

42 
loÿl
 
¥©h
, 
¢ame
 = 
	$§ãÇme
(
·th
, 
Çme
)

43 
loÿl
 
g
 = 
¶aššdex
 
ªd


44 ((
	`ty³
(
Çme
è=ğ"numb”"è
ªd
 '' 
Ü
‚ame..
¥aû
..'='..space) or

45 (
Çme
 ~ğ
n
 
ªd
 
¢ame
..
¥aû
..'='..¥aû 
Ü
 '')

46 
£’
[
t
] 
th’
 -- 
®»ady
 s“À
this
 
–em’t


47 
¤ef
[#¤ef+1] = 
¥©h
..
¥aû
..'='..¥aû..
£’
[
t
]

48  
g
..'n'..
	`comm’t
('»f', 
Ëv–
è
’d


49 
	`ty³
(
mt
è=ğ'bË' 
ªd
 
nÙ
 
ignÜeMt
 
	$ªd
 (
mt
.
__£rŸlize
 
Ü
 mt.
__to¡ršg
è
th’
 -- 
knows
 
how
 
to
 
£rŸlize
 
™£lf


50 
£’
[
t
] = 
š¤ef
 
Ü
 
¥©h


51 
loÿl
 
func


52 
mt
.
__£rŸlize
 
th’
 
t
, 
func
 = mt.
	$__£rŸlize
(
t
èˆğ
	$to¡ršg
(
t
è
’d


53 
func
 
th’


54  
g
 .. "(funùiÚ(è" .. 
t
 .. "ƒnd)()"

55 
’d


56 
‰y³
 = 
	$ty³
(
t
è
’d
 -- 
Ãw
 
v®ue
 
çÎs
 
through
 
to
 
be
 
£rŸlized


57 
‰y³
 =ğ"bË" 
th’


58 
Ëv–
 >ğ
maxl
 
th’
  
g
..'{}'..
	`comm’t
('max',†ev–è
’d


59 
£’
[
t
] = 
š¤ef
 
Ü
 
¥©h


60 
	`Ãxt
(
t
è=ğ
n
 
th’
  
g
..'{}'..
	$comm’t
(
t
, 
Ëv–
è
’d
 -- 
bË
 
em±y


61 
loÿl
 
maxn
, 
o
, 
out
 = 
m©h
.
	`mš
(#t, 
maxnum
 
Ü
 #t), {
	}
}, {}

62 
	gkey
 = 1, 
maxn
 dØ
	go
[
key
] = key 
’d


63 
nÙ
 
maxnum
 
Ü
 #Ø< maxnum 
th’


64 
loÿl
 
n
 = #Ø--‚ =‚ + 1; 
	go
[n] 
is
 
much
 
ç¡”
 
thª
 o[#o+1] 
Ú
 
Ïrge
 
bËs


65 
key
 
š
 
	$·œs
(
t
èdØ
o
[
key
] ~ğkey 
th’
 
n
 =‚ + 1; o[n] = key 
’d
ƒndƒnd

66 
maxnum
 
ªd
 #Ø> maxnum 
th’
 
o
[maxnum+1] = 
n
 
’d


67 
İts
.
sÜtkeys
 
ªd
 #Ø> 
maxn
 
th’
 
	$®phªumsÜt
(
o
, 
t
, 
İts
.
sÜtkeys
è
’d


68 
loÿl
 
¥¬£
 = s·r£ 
ªd
 #Ø> 
maxn
 -- 
di§bË
 
¥¬¢ess
 
Úly
 
num”ic
 
	$keys
 (
shÜ‹r
 
ouut
)

69 
n
, 
key
 
š
 
	$aœs
(
o
) do

70 
loÿl
 
v®ue
, 
kty³
, 
¶aššdex
 = 
t
[
key
], 
	`ty³
(key), 
n
 <ğ
maxn
 
ªd
 
nÙ
 
¥¬£


71 
İts
.
v®ignÜe
 
ªd
 o±s.v®ignÜe[
v®ue
] -- 
sk
 
ignÜed
 
v®ues
; dØ
nÙhšg


72 
Ü
 
İts
.
key®low
 
ªd
 
nÙ
 o±s.key®low[
key
]

73 
Ü
 
İts
.
v®ty³ignÜe
 
ªd
 o±s.v®ty³ignÜe[
	`ty³
(
v®ue
)] -- 
skpšg
 
ignÜed
 v®u
ty³s


74 
Ü
 
¥¬£
 
ªd
 
v®ue
 =ğ
n
 
th’
 -- 
skpšg
 
ns
; dØ
nÙhšg


75 
–£if
 
kty³
 =ğ'bË' 
Ü
 kty³ =ğ'funùiÚ' o¸
badty³
[kty³] 
th’


76 
nÙ
 
£’
[
key
] 
ªd
‚Ù 
glob®s
[key] 
th’


77 
¤ef
[#sref+1] = 'placeholder'

78 
loÿl
 
¢ame
 = 
	`§ãÇme
(
šame
, 
	`g’sym
(
key
)è-- iÇm
is
 
bË
 loÿÈ
v¬ŸbËs


79 
¤ef
[#¤ef] = 
	$v®2¡r
(
key
,
¢ame
,
šd’t
,¢ame,
šame
,
Œue
è
’d


80 
¤ef
[#sref+1] = 'placeholder'

81 
loÿl
 
·th
 = 
£’
[
t
]..'['..
	`to¡ršg
(£’[
key
] 
Ü
 
glob®s
[key] o¸
	`g’sym
(key))..']'

82 
¤ef
[#¤ef] = 
·th
..
¥aû
..'='..¥aû..
	`to¡ršg
(
£’
[
v®ue
] 
Ü
 
	$v®2¡r
(
v®ue
,
n
,
šd’t
,
·th
))

84 
out
[#out+1] = 
	`v®2¡r
(
v®ue
,
key
,
šd’t
,
š¤ef
,
£’
[
t
],
¶aššdex
,
Ëv–
+1)

85 
’d


86 
’d


87 
loÿl
 
´efix
 = 
¡ršg
.
	`»p
(
šd’t
 
Ü
 '', 
Ëv–
)

88 
loÿl
 
h—d
 = 
šd’t
 
ªd
 '{\n'..
´efix
..šd’ˆ
Ü
 '{'

89 
loÿl
 
body
 = 
bË
.
	`cÚÿt
(
out
, ','..(
šd’t
 
ªd
 '\n'..
´efix
..šd’ˆ
Ü
 
¥aû
))

90 
loÿl
 

 = 
šd’t
 
ªd
 "\n"..
´efix
..'}' 
Ü
 '}'

91  (
cu¡om
 
ªd
 
	$cu¡om
(
g
,
h—d
,
body
,

è
Ü
ag..h—d..body..)..
	$comm’t
(
t
, 
Ëv–
)

92 
–£if
 
‰y³
 =ğ"cd©a" 
th’


93 
loÿl
 
cTy³
, 
addr
 = 
	$to¡ršg
(
t
):
	`m©ch
("cdata<(.-)>: (.+)")

94 
cTy³
:
	`m©ch
("¡ruù %d+ ?%*?$"è
th’


95 
	`”rÜ
("cannot serialize‡nonymous structs")

96 
’d


97 
loÿl
 
isPŒ
 = 
cTy³
:
	`fšd
("*%s*$")

98  
g
 .. ("(funùiÚ(èloÿÈff˜ğ»quœ'ffi'„‘uº ffi.ÿ¡('%s', ffi.ÿ¡('void*', %d)è’d)()"):
	`fÜm©
(

99 
cTy³
 .. (
nÙ
 
isPŒ
 
ªd
 "*" 
Ü
 ""),

100 
addr


102 
–£if
 
badty³
[
‰y³
] 
th’


103 
£’
[
t
] = 
š¤ef
 
Ü
 
¥©h


104  
g
..
	$glob”r
(
t
, 
Ëv–
)

105 
–£if
 
‰y³
 =ğ'funùiÚ' 
th’


106 
£’
[
t
] = 
š¤ef
 
Ü
 
¥©h


107 
loÿl
 
ok
, 
»s


108 
İts
.
nocode
 
th’


109 
ok
 = 
Œue


111 
ok
, 
»s
 = 
	$pÿÎ
(
¡ršg
.
dump
, 
t
)

112 
’d


113 
loÿl
 
func
 = 
ok
 
	`ªd
 ((
İts
.
nocode
 
ªd
 "n" 
Ü


114 "(Ößd¡ršg o¸lßd)("..
	`§ã¡r
(
»s
)..",'@£rŸlized'))")..
	$comm’t
(
t
, 
Ëv–
))

115  
g
..(
func
 
Ü
 
	$glob”r
(
t
, 
Ëv–
))

116  
g
..
	$§ã¡r
(
t
è
’d
 -- 
hªdË
 
®l
 
Ùh”
 
ty³s


117 
’d


118 
loÿl
 
£´
 = 
šd’t
 
ªd
 "\n" 
Ü
 ";"..
¥aû


119 
loÿl
 
body
 = 
	`v®2¡r
(
t
, 
Çme
, 
šd’t
è-- 
this
 
ÿÎ
 
®so
 
pİuÏ‹s
 
¤ef


120 
loÿl
 

 = #¤ef>1 
ªd
 
bË
.
	`cÚÿt
(
¤ef
, 
£´
)..£´ 
Ü
 ''

121 
loÿl
 
w¬n
 = 
İts
.
comm’t
 
ªd
 #¤ef>1‡nd 
¥aû
.."--[[šcom¶‘ouuˆw™h sh¬ed/£lf-»ã»nû sk³d]]" 
Ü
 ''

122  
nÙ
 
Çme
 
ªd
 
body
..
w¬n
 
Ü
 "dØloÿÈ"..body..
£´
..

.."return "..name..sepr.."end"

123 
’d


125 
loÿl
 
funùiÚ
 
	$de£rŸlize
(
d©a
, 
İts
)

126 
loÿl
 
’v
 = (
İts
 
ªd
 o±s.
§ã
 =ğ
çl£
èªd 
G


127 
Ü
 
	`£tm‘©abË
({
	}
}, {

128 
	g__šdex
 = 
funùiÚ
(
t
,
k
è 
	g’d
,

129 
	g__ÿÎ
 = 
funùiÚ
(
t
,...è
”rÜ
("ÿÂÙ c®ÈfunùiÚs"è
	g’d


131 
loÿl
 
	gf
, 
	g»s
 = (
lßd¡ršg
 
Ü
 
lßd
)('»tuº '..
d©a
, 
	gn
,‚, 
	g’v
)

132 
nÙ
 
f
 
th’
 
	gf
, 
	g»s
 = (
lßd¡ršg
 
Ü
 
lßd
)(
d©a
, 
	gn
,‚, 
	g’v
è
’d


133 
nÙ
 
f
 
th’
  
	gf
, 
»s
 
’d


134 
£tãnv
 
th’
 
	$£tãnv
(
f
, 
’v
è
’d


135  
	$pÿÎ
(
f
)

136 
’d


138 
loÿl
 
funùiÚ
 
	$m”ge
(
a
, 
b
èb 
th’
 
k
,
v
 
š
 
	$·œs
(
b
èdØ
a
[
k
] = 
v
 
’d
ƒnd; ‡;ƒnd

139  { 
_NAME
 = 
n
, 
_COPYRIGHT
 = 
c
, 
_DESCRIPTION
 = 
d
, 
_VERSION
 = 
v
, 
£rŸlize
 = 
s
,

140 
lßd
 = 
de£rŸlize
,

141 
dump
 = 
	`funùiÚ
(
a
, 
İts
è 
	`s
×, 
	`m”ge
({
Çme
 = '_', 
com·ù
 = 
Œue
, 
¥¬£
 =rue, 
nocode
 =rue}, o±s)è
’d
,

142 
dumpRaw
 = 
	`funùiÚ
(
a
, 
İts
è 
	`s
×, 
	`m”ge
({
Çme
 = '_', 
com·ù
 = 
Œue
, 
¥¬£
 =rue, 
nocode
 =rue}, o±s),rueè
’d
,

143 
lše
 = 
	`funùiÚ
(
a
, 
İts
è 
	`s
×, 
	`m”ge
({
sÜtkeys
 = 
Œue
, 
comm’t
 =rue, 
nocode
 =rue}, o±s)è
’d
,

144 
block
 = 
	`funùiÚ
(
a
, 
İts
è 
	`s
×, 
	`m”ge
({
šd’t
 = ' ', 
sÜtkeys
 = 
Œue
, 
comm’t
 =rue, 
nocode
 =rue}, o±s)è
’d
,

145 
addMt
 = 
	`funùiÚ
(
buf
, 
mt
è '£tm‘©abË((funùiÚ(è' .. buà.. 'ƒnd)(), ' .. mˆ.. ')' 
’d
,

146 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/StackTracePlus/init.lua

1 -- 
bËs


2 
loÿl
 
	g_G
 = 
_G


3 
loÿl
 
¡ršg
, 
	gio
, 
	gdebug
, 
	gcÜoutše
 = string, io, debug, coroutine

5 -- 
funùiÚs


6 
loÿl
 
	gto¡ršg
, 
	g´št
, 
	g»quœe
 = 
to¡ršg
,…ršt, 
»quœe


7 
loÿl
 
	gÃxt
, 
	gas£¹
 = 
Ãxt
, 
as£¹


8 
loÿl
 
	gpÿÎ
, 
	gty³
, 
	g·œs
, 
	gaœs
 = 
pÿÎ
,y³,…aœs, 
aœs


9 
loÿl
 
	g”rÜ
 = 
”rÜ


11 
as£¹
(
debug
, "debugable must be‡vailable‡this…oint")

13 
loÿl
 
	gio_İ’
 = 
io
.
İ’


14 
loÿl
 
¡ršg_gm©ch
 = 
¡ršg
.
gm©ch


15 
loÿl
 
¡ršg_sub
 = 
¡ršg
.
sub


16 
loÿl
 
bË_cÚÿt
 = 
bË
.
cÚÿt


18 
loÿl
 
_M
 = {

19 
max_tb_ouut_Ën
 = 70 -- 
cÚŒŞs
 
the
 
maximum
 
Ëngth
 
of
h'¡ršgif›d' 
bË
 
befÜe
 
cu‰šg
 
w™h
 ' (more...)'

22 -- 
this
 
bËs
 
should
 
be
 
w—k
 
so
 
the
 
–em’ts
 
š
 
them
 
	gwÚ
't become uncollectable

23 
loÿl
 
	gm_known_bËs
 = { [
_G
] = "_G (globalable)" }

24 
loÿl
 
funùiÚ
 
	$add_known_moduË
(
Çme
, 
desc
)

25 
loÿl
 
ok
, 
mod
 = 
	$pÿÎ
(
»quœe
, 
Çme
)

26 
ok
 
th’


27 
m_known_bËs
[
mod
] = 
desc


28 
’d


29 
’d


31 
	`add_known_moduË
("string", "string module")

32 
	`add_known_moduË
("io", "io module")

33 
	`add_known_moduË
("os", "os module")

34 
	`add_known_moduË
("table", "table module")

35 
	`add_known_moduË
("math", "math module")

36 
	`add_known_moduË
("package", "package module")

37 
	`add_known_moduË
("debug", "debug module")

38 
	`add_known_moduË
("coroutine", "coroutine module")

40 -- 
lua5
.2

41 
	`add_known_moduË
("bit32", "bit32 module")

42 -- 
luaj™


43 
	`add_known_moduË
("bit", "bit module")

44 
	`add_known_moduË
("jit", "jit module")

47 
loÿl
 
m_u£r_known_bËs
 = {
	}
}

49 
loÿl
 
m_known_funùiÚs
 = {}

50 
_
, 
Çme
 
š
 
	gaœs
{

51 -- 
	gLua
 5.2, 5.1

76 -- 
	gLua
 5.1

84 -- 
	gTODO
: 
add
 
bË
.* 
‘c
 
funùiÚs


86 
_G
[
Çme
] 
th’


87 
m_known_funùiÚs
[
_G
[
Çme
]] =‚ame

88 
’d


89 
’d


93 
loÿl
 
m_u£r_known_funùiÚs
 = {}

95 
loÿl
 
funùiÚ
 
	$§ã_to¡ršg
 (
v®ue
)

96 
loÿl
 
ok
, 
”r
 = 
	$pÿÎ
(
to¡ršg
, 
v®ue
)

97 
ok
 
th’
  
”r
  ("<çedØg‘…ršbË v®ue>: '%s'"):
	$fÜm©
(
”r
è
’d


98 
’d


100 -- 
Priv©e
:

101 -- 
P¬£s
 
a
 
lše
, 
lookšg
 
possibË
 
funùiÚ
 
	`defš™iÚs
 (
š
‡ 
v”y
 
Ç
ï
ve
 
way
)

102 -- 
R‘uºs
 '×nÚymous)' 
no
 
funùiÚ
 
Çme
 
was
 
found
 
š
 
the
 
lše


103 
loÿl
 
funùiÚ
 
	$P¬£Lše
(
lše
)

104 
	`as£¹
(
	`ty³
(
lše
) == "string")

105 --
	$´št
(
lše
)

106 
loÿl
 
m©ch
 = 
lše
:
	`m©ch
("^%s*function%s+(%w+)")

107 
m©ch
 
th’


108 --
	`´št
("+++++++++++++funùiÚ", 
m©ch
)

109  
m©ch


110 
’d


111 
m©ch
 = 
lše
:
	`m©ch
("^%s*local%s+function%s+(%w+)")

112 
m©ch
 
th’


113 --
	`´št
("++++++++++++loÿl", 
m©ch
)

114  
m©ch


115 
’d


116 
m©ch
 = 
lše
:
	`m©ch
("^%s*local%s+(%w+)%s+=%s+function")

117 
m©ch
 
th’


118 --
	`´št
("++++++++++++loÿÈfunc", 
m©ch
)

119  
m©ch


120 
’d


121 
m©ch
 = 
lše
:
	`m©ch
("%s*funùiÚ%s*%("è-- 
this
 
is
 
ª
 
ªÚymous
 
funùiÚ


122 
m©ch
 
th’


123 --
	`´št
("+++++++++++++funùiÚ2", 
m©ch
)

125 
’d


127 
’d


129 -- 
Priv©e
:

130 -- 
Tr›s
 
to
 
guess
 
a
 
funùiÚ
's‚ame whenhe debug info structure does‚ot have it.

131 -- 
It
 
·r£s
 
e™h”
 
the
 
fe
 
Ü
h
¡ršg
 
wh”e
h
funùiÚ
 
is
 
defšed
.

132 -- 
R‘uºs
 '?' 
the
 
lše
 
wh”e
h
funùiÚ
 
is
 
defšed
 i 
nÙ
 
found


133 
loÿl
 
funùiÚ
 
	`GuessFunùiÚName
(
šfo
)

134 --
	`´št
("guessing function‚ame")

135 
	`ty³
(
šfo
.
sourû
è=ğ"¡ršg" 
ªd
 info.sourû:
	`sub
(1,1è=ğ"@" 
th’


136 
loÿl
 
fe
, 
”r
 = 
	`io_İ’
(
šfo
.
sourû
:
	`sub
(2), "r")

137 
nÙ
 
fe
 
th’


138 
	`´št
("fnÙ found: "..
	`to¡ršg
(
”r
)è-- 
whoİs
!

140 
’d


141 
loÿl
 
lše


142 
i
 = 1, 
šfo
.
lšedefšed
 do

143 
lše
 = 
fe
:
	`»ad
("*l")

144 
’d


145 
nÙ
 
lše
 
th’


146 
	`´št
("lšnÙ found"è-- 
whoİs
!

148 
’d


149  
	$P¬£Lše
(
lše
)

151 
loÿl
 
lše


152 
loÿl
 
lšeNumb”
 = 0

153 
l
 
š
 
	`¡ršg_gm©ch
(
šfo
.
sourû
, "([^\n]+)\n-") do

154 
lšeNumb”
 =†ineNumber + 1

155 
lšeNumb”
 =ğ
šfo
.
lšedefšed
 
th’


156 
lše
 = 
l


158 
’d


159 
’d


160 
nÙ
 
lše
 
th’


161 
	`´št
("lšnÙ found"è-- 
whoİs
!

163 
’d


164  
	$P¬£Lše
(
lše
)

165 
’d


166 
’d


169 -- 
Dum³r
 
š¡ªûs
 
¬e
 
u£d
 
to
 
ª®yze
 
¡acks
 
ªd
 
cŞËù
 
™s
 
šfÜm©iÚ
.

171 
loÿl
 
Dum³r
 = {
	}
}

173 
Dum³r
.
Ãw
 = 
	$funùiÚ
(
th»ad
)

174 
loÿl
 
t
 = { 
lšes
 = {} 
	}
}

175 
	gk
,
v
 
š
 
	$·œs
(
Dum³r
èdØ
t
[
k
] = 
v
 
’d


177 
t
.
dumpšg_§me_th»ad
 = (
th»ad
 =ğ
cÜoutše
.
	`ruÂšg
())

179 -- 
a
 
th»ad
 
was
 
suµl›d
, 
bšd
 
™
 
to
 
debug
.
šfo
 
ªd
 debug.
g‘


180 -- 
we
 
®so
 
Ãed
 
to
 
sk
 
this
 
add™iÚ®
 
Ëv–
 w
¬e
 
šŒoducšg
 
š
 
the
 
	`ÿÎ¡ack
 (
Úly
 w¬
ruÂšg


181 -- 
š
 
the
 
§me
 
th»ad
 
we
're inspecting)

182 
	`ty³
(
th»ad
è=ğ"th»ad" 
th’


183 
t
.
g‘šfo
 = 
	$funùiÚ
(
Ëv–
, 
wh©
)

184 
t
.
dumpšg_§me_th»ad
 
ªd
 
	`ty³
(
Ëv–
è=ğ"numb”" 
th’


185 
Ëv–
 =†evel + 1

186 
’d


187  
debug
.
	$g‘šfo
(
th»ad
, 
Ëv–
, 
wh©
)

188 
’d


189 
t
.
g‘loÿl
 = 
	$funùiÚ
(
Ëv–
, 
loc
)

190 
t
.
dumpšg_§me_th»ad
 
th’


191 
Ëv–
 =†evel + 1

192 
’d


193  
debug
.
	$g‘loÿl
(
th»ad
, 
Ëv–
, 
loc
)

194 
’d


196 
t
.
g‘šfo
 = 
debug
.getinfo

197 
t
.
g‘loÿl
 = 
debug
.getlocal

198 
’d


200  
t


201 
’d


203 -- 
h–³rs
 
cŞËùšg
 
¡ršgs
 
to
 
be
 
u£d
 
wh’
 
as£mblšg
 
the
 
fš®
 
Œaû


204 
funùiÚ
 
Dum³r
:
	$add
 (
‹xt
)

205 
£lf
.
lšes
[#£lf.lše + 1] = 
‹xt


206 
’d


207 
funùiÚ
 
Dum³r
:
	$add_f
 (
fmt
, ...)

208 
£lf
:
	`add
(
fmt
:
	$fÜm©
(...))

209 
’d


210 
funùiÚ
 
Dum³r
:
	$cÚÿt_lšes
 ()

211  
	$bË_cÚÿt
(
£lf
.
lšes
)

212 
’d


215 -- 
Priv©e
:

216 -- 
I‹¿‹s
 
ov”
 
the
 
loÿl
 
v¬ŸbËs
 
of
 
a
 
giv’
 
funùiÚ
.

218 -- @
·¿m
 
Ëv–
 
The
 
¡ack
†ev– 
wh”e
 
the
 
funùiÚ
 
is
.

220 
funùiÚ
 
Dum³r
:
	$DumpLoÿls
 (
Ëv–
)

221 
loÿl
 
´efix
 = "\t "

222 
loÿl
 
i
 = 1

224 
£lf
.
dumpšg_§me_th»ad
 
th’


225 
Ëv–
 =†evel + 1

226 
’d


228 
loÿl
 
Çme
, 
v®ue
 = 
£lf
.
	$g‘loÿl
(
Ëv–
, 
i
)

229 
nÙ
 
Çme
 
th’


231 
’d


232 
£lf
:
	`add
("\tLocal variables:\r\n")

233 
Çme
 do

234 
	`ty³
(
v®ue
è=ğ"numb”" 
th’


235 
£lf
:
	`add_f
("%s% ğnumb”: %g\r\n", 
´efix
, 
Çme
, 
v®ue
)

236 
–£if
 
	`ty³
(
v®ue
è=ğ"boŞ—n" 
th’


237 
£lf
:
	`add_f
("%s% ğboŞ—n: %s\r\n", 
´efix
, 
Çme
, 
	$to¡ršg
(
v®ue
))

238 
–£if
 
	`ty³
(
v®ue
è=ğ"¡ršg" 
th’


239 
£lf
:
	`add_f
("%s% ğ¡ršg: %q\r\n", 
´efix
, 
Çme
, 
v®ue
)

240 
–£if
 
	`ty³
(
v®ue
è=ğ"u£rd©a" 
th’


241 
£lf
:
	`add_f
("%s% ğ%s\r\n", 
´efix
, 
Çme
, 
	$§ã_to¡ršg
(
v®ue
))

242 
–£if
 
	`ty³
(
v®ue
è=ğ"n" 
th’


243 
£lf
:
	`add_f
("%s% ğn\r\n", 
´efix
, 
Çme
)

244 
–£if
 
	`ty³
(
v®ue
è=ğ"bË" 
th’


245 
m_known_bËs
[
v®ue
] 
th’


246 
£lf
:
	`add_f
("%s% ğ%s\r\n", 
´efix
, 
Çme
, 
m_known_bËs
[
v®ue
])

247 
–£if
 
m_u£r_known_bËs
[
v®ue
] 
th’


248 
£lf
:
	`add_f
("%s% ğ%s\r\n", 
´efix
, 
Çme
, 
m_u£r_known_bËs
[
v®ue
])

250 
loÿl
 
txt
 = "{"

251 
k
,
v
 
š
 
	$·œs
(
v®ue
) do

252 
txt
 =xt..
	`§ã_to¡ršg
(
k
)..":"..
	$§ã_to¡ršg
(
v
)

253 #txˆ> 
_M
.
max_tb_ouut_Ën
 
th’


254 
txt
 =xt.." (more...)"

256 
’d


257 
	$Ãxt
(
v®ue
, 
k
è
th’
 
txt
 =xt..", " 
’d


258 
’d


259 
£lf
:
	`add_f
("%s% ğ%  %s\r\n", 
´efix
, 
Çme
, 
	`§ã_to¡ršg
(
v®ue
), 
txt
.."}")

260 
’d


261 
–£if
 
	`ty³
(
v®ue
è=ğ"funùiÚ" 
th’


262 
loÿl
 
šfo
 = 
£lf
.
	`g‘šfo
(
v®ue
, "nS")

263 
loÿl
 
fun_Çme
 = 
šfo
.
Çme
 
Ü
 
m_known_funùiÚs
[
v®ue
] o¸
m_u£r_known_funùiÚs
[value]

264 
šfo
.
wh©
 =ğ"C" 
th’


265 
£lf
:
	`add_f
("%s% ğC %s\r\n", 
´efix
, 
Çme
, (
fun_Çme
 
	`ªd
 ("funùiÚ: " .. fun_Çmeè
Ü
 
	$to¡ršg
(
v®ue
)))

267 
loÿl
 
sourû
 = 
šfo
.
shÜt_¤c


268 
sourû
:
	`sub
(2,7è=ğ"¡ršg" 
th’


269 
sourû
 = sourû:
	`sub
(9è-- 
uno
 
m
á
s
, 
pÜ
 
–
 
e¥acio
 
que
 
	`v›Ã
 (
¡ršg
 "B¬ag’t.Maš",…Ü 
ejem¶o
)

270 
’d


271 --
k
,
v
 
š
 
	$·œs
(
šfo
èdØ
	$´št
(
k
,
v
è
’d


272 
fun_Çme
 = fun_Çm
Ü
 
	$GuessFunùiÚName
(
šfo
)

273 
£lf
:
	`add_f
("%s% ğLu¨funùiÚ '%s' (defšed‡ˆlš%d oàchunk %s)\r\n", 
´efix
, 
Çme
, 
fun_Çme
, 
šfo
.
lšedefšed
, 
sourû
)

274 
’d


275 
–£if
 
	`ty³
(
v®ue
è=ğ"th»ad" 
th’


276 
£lf
:
	`add_f
("%¡h»ad %q = %s\r\n", 
´efix
, 
Çme
, 
	$to¡ršg
(
v®ue
))

277 
’d


278 
i
 = i + 1

279 
Çme
, 
v®ue
 = 
£lf
.
	$g‘loÿl
(
Ëv–
, 
i
)

280 
’d


281 
’d


285 -- 
Public
:

286 -- 
CŞËùs
 
a
 
d‘aed
 
¡ack
 
Œaû
, 
dumpšg
 
loÿls
, 
»sŞvšg
 
funùiÚ
 
Çmes
 
wh’
 
they
're‚ot‡vailable,ƒtc.

287 -- 
This
 
funùiÚ
 
is
 
su™abË
 
to
 
be
 
u£d
 
as
 
ª
 
”rÜ
 
hªdËr
 
w™h
 
pÿÎ
 
Ü
 
xpÿÎ


289 -- @
·¿m
 
th»ad
 
An
 
İtiÚ®
h»ad 
who£
 
¡ack
 
is
 
to
 
be
 
	`š¥eùed
 (
deçul
 i 
the
 
cu¼’t
hread)

290 -- @
·¿m
 
mes§ge
 
An
 
İtiÚ®
 
”rÜ
 
¡ršg
 
Ü
 
objeù
.

291 -- @
·¿m
 
Ëv–
 
An
 
İtiÚ®
 
numb”
 
‹Îšg
 
©
 
which
†ev– 
to
 
¡¬t
 
the
 
	`Œaûback
 ( 
is
 1)

293 -- 
R‘uºs
 
a
 
¡ršg
 
w™h
 
the
 
¡ack
 
Œaû
 
ªd
‡ sŒšg w™hh
Üigš®
 
”rÜ
.

295 
funùiÚ
 
_M
.
	$¡ackŒaû
(
th»ad
, 
mes§ge
, 
Ëv–
)

296 
	`ty³
(
th»ad
è~ğ"th»ad" 
th’


297 -- 
shiá
 
·¿m‘”s
 
Ëá


298 
th»ad
, 
mes§ge
, 
Ëv–
 = 
n
,hread, message

299 
’d


301 
th»ad
 =h»ad 
Ü
 
cÜoutše
.
	$ruÂšg
()

303 
Ëv–
 =†ev– 
Ü
 1

305 
loÿl
 
dum³r
 = 
Dum³r
.
	$Ãw
(
th»ad
)

307 
loÿl
 
Üigš®_”rÜ


309 
	`ty³
(
mes§ge
è=ğ"bË" 
th’


310 
dum³r
:
	`add
("anƒrror object {\r\n")

311 
loÿl
 
fœ¡
 = 
Œue


312 
k
,
v
 
š
 
	$·œs
(
mes§ge
) do

313 
fœ¡
 
th’


314 
dum³r
:
	`add
(" ")

315 
fœ¡
 = 
çl£


317 
dum³r
:
	`add
(",\r\n ")

318 
’d


319 
dum³r
:
	`add
(
	$§ã_to¡ršg
(
k
))

320 
dum³r
:
	`add
(": ")

321 
dum³r
:
	`add
(
	$§ã_to¡ršg
(
v
))

322 
’d


323 
dum³r
:
	`add
("\r\n}")

324 
Üigš®_”rÜ
 = 
dum³r
:
	$cÚÿt_lšes
()

325 
–£if
 
	`ty³
(
mes§ge
è=ğ"¡ršg" 
th’


326 
dum³r
:
	$add
(
mes§ge
)

327 
Üigš®_”rÜ
 = 
mes§ge


328 
’d


330 
dum³r
:
	`add
("\r\n")

331 
dum³r
:
add
[[

332 
Sck
 
T¿ûback


335 --
	$´št
(
”rÜ_mes§ge
)

337 
loÿl
 
Ëv–_to_show
 = 
Ëv–


338 
dum³r
.
dumpšg_§me_th»ad
 
th’
 
Ëv–
 =†ev– + 1 
’d


340 
loÿl
 
šfo
 = 
dum³r
.
	`g‘šfo
(
Ëv–
, "nSlf")

341 
šfo
 do

342 
šfo
.
wh©
 =ğ"maš" 
th’


343 
	`¡ršg_sub
(
šfo
.
sourû
, 1, 1è=ğ"@" 
th’


344 
dum³r
:
	`add_f
("(%dèmaš chunk oàf'%s'‡ˆlš%d\r\n", 
Ëv–_to_show
, 
	`¡ršg_sub
(
šfo
.
sourû
, 2), info.
cu¼’še
)

346 
dum³r
:
	`add_f
("(%dèmaš chunk oà% ©†š%d\r\n", 
Ëv–_to_show
, 
šfo
.
shÜt_¤c
, info.
cu¼’še
)

347 
’d


348 
–£if
 
šfo
.
wh©
 =ğ"C" 
th’


349 --
	`´št
(
šfo
.
Çmewh©
, info.
Çme
)

350 --
k
,
v
 
š
 
	$·œs
(
šfo
èdØ
	`´št
(
k
,
v
, 
	$ty³
(
v
)è
’d


351 
loÿl
 
funùiÚ_Çme
 = 
m_u£r_known_funùiÚs
[
šfo
.
func
] 
Ü
 
m_known_funùiÚs
[šfo.func] o¸šfo.
Çme
 o¸
	$to¡ršg
(
šfo
.
func
)

352 
dum³r
:
	`add_f
("(%dè% C funùiÚ '%s'\r\n", 
Ëv–_to_show
, 
šfo
.
Çmewh©
, 
funùiÚ_Çme
)

353 --
dum³r
:
	`add_f
("%s% ğC %s\r\n", 
´efix
, 
Çme
, (
m_known_funùiÚs
[
v®ue
] 
	`ªd
 ("funùiÚ: " .. m_known_funùiÚs[v®ue]è
Ü
 
	$to¡ršg
(
v®ue
)))

354 
–£if
 
šfo
.
wh©
 =ğ"" 
th’


355 --
	`´št
("tail")

356 --
k
,
v
 
š
 
	$·œs
(
šfo
èdØ
	`´št
(
k
,
v
, 
	$ty³
(
v
)è
’d
--
	$´št
(
šfo
.
Çmewh©
, info.
Çme
)

357 
dum³r
:
	`add_f
("(%dè c®l\r\n", 
Ëv–_to_show
)

358 
dum³r
:
	$DumpLoÿls
(
Ëv–
)

359 
–£if
 
šfo
.
wh©
 =ğ"Lua" 
th’


360 
loÿl
 
sourû
 = 
šfo
.
shÜt_¤c


361 
loÿl
 
funùiÚ_Çme
 = 
m_u£r_known_funùiÚs
[
šfo
.
func
] 
Ü
 
m_known_funùiÚs
[šfo.func] o¸šfo.
Çme


362 
sourû
:
	`sub
(2, 7è=ğ"¡ršg" 
th’


363 
sourû
 = sourû:
	$sub
(9)

364 
’d


365 
loÿl
 
was_gues£d
 = 
çl£


366 
nÙ
 
funùiÚ_Çme
 
Ü
 funùiÚ_Çm=ğ"?" 
th’


367 --
k
,
v
 
š
 
	$·œs
(
šfo
èdØ
	`´št
(
k
,
v
, 
	$ty³
(
v
)è
’d


368 
funùiÚ_Çme
 = 
	$GuessFunùiÚName
(
šfo
)

369 
was_gues£d
 = 
Œue


370 
’d


371 -- 
‹¡
 
we
 
have
 
a
 
fe
 
Çme


372 
loÿl
 
funùiÚ_ty³
 = (
šfo
.
Çmewh©
 =ğ""è
ªd
 "funùiÚ" 
Ü
 info.namewhat

373 
šfo
.
sourû
 
ªd
 info.sourû:
	`sub
(1, 1è=ğ"@" 
th’


374 
dum³r
:
	`add_f
("(%dèLu¨% '%s'‡ˆf'%s:%d'%s\r\n", 
Ëv–_to_show
, 
funùiÚ_ty³
, 
funùiÚ_Çme
, 
šfo
.
sourû
:
	`sub
(2), info.
cu¼’še
, 
was_gues£d
 
ªd
 " (be¡ guess)" 
Ü
 "")

375 
–£if
 
šfo
.
sourû
 
ªd
 info.sourû:
	`sub
(1,1è=ğ'#' 
th’


376 
dum³r
:
	`add_f
("(%dèLu¨% '%s'‡ˆ‹m¶©'%s:%d'%s\r\n", 
Ëv–_to_show
, 
funùiÚ_ty³
, 
funùiÚ_Çme
, 
šfo
.
sourû
:
	`sub
(2), info.
cu¼’še
, 
was_gues£d
 
ªd
 " (be¡ guess)" 
Ü
 "")

378 
dum³r
:
	`add_f
("(%dèLu¨% '%s'‡ˆlš%d oàchunk '%s'\r\n", 
Ëv–_to_show
, 
funùiÚ_ty³
, 
funùiÚ_Çme
, 
šfo
.
cu¼’še
, 
sourû
)

379 
’d


380 
dum³r
:
	$DumpLoÿls
(
Ëv–
)

382 
dum³r
:
	`add_f
("(%dèunknowÀäam%s\r\n", 
Ëv–_to_show
, 
šfo
.
wh©
)

383 
’d


385 
Ëv–
 =†evel + 1

386 
Ëv–_to_show
 =†evel_to_show + 1

387 
šfo
 = 
dum³r
.
	`g‘šfo
(
Ëv–
, "nSlf")

388 
’d


390  
dum³r
:
	`cÚÿt_lšes
(), 
Üigš®_”rÜ


391 
’d


394 -- 
Adds
 
a
 
bË
 
to
 
the
 
li¡
 
of
 
known
 
bËs


395 
funùiÚ
 
_M
.
	$add_known_bË
(
b
, 
desütiÚ
)

396 
m_known_bËs
[
b
] 
th’


397 
	`”rÜ
("Cannot override‡n‡lready knownable")

398 
’d


399 
m_u£r_known_bËs
[
b
] = 
desütiÚ


400 
’d


403 -- 
Adds
 
a
 
funùiÚ
 
to
 
the
 
li¡
 
of
 
known
 
funùiÚs


404 
funùiÚ
 
_M
.
	$add_known_funùiÚ
(
fun
, 
desütiÚ
)

405 
m_known_funùiÚs
[
fun
] 
th’


406 
	`”rÜ
("Cannot override‡n‡lready known function")

407 
’d


408 
m_u£r_known_funùiÚs
[
fun
] = 
desütiÚ


409 
’d


411  
_M


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/argparse.lua

1 -- 
The
 
MIT
 
Liûn£
 (MIT)

3 -- 
Cİyright
 (
c
è2013 - 2015 
P‘”
 
	gM–nich’ko


5 -- 
P”missiÚ
 
is
 
h”eby
 
	gg¿Áed
, 
ä“
 
of
 
	gch¬ge
, 
to
 
ªy
 
³rsÚ
 
obššg
 
a
 
cİy
 
	gof


6 -- 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
	gš


7 -- 
the
 
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
	gto


8 -- 
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
cİ›s
 
	gof


9 -- 
the
 
	gSoáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
h
Soáw¬e
 
is
 
fuºished
ØdØ
	gso
,

10 -- 
subjeù
 
to
 
the
 
fŞlowšg
 
	gcÚd™iÚs
:

12 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


13 -- 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

15 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
	gOR


16 -- 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
	gMERCHANTABILITY
, 
	gFITNESS


17 -- 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
AUTHORS
 
	gOR


18 -- 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gCLAIM
, 
DAMAGES
 
OR
 
OTHER
 
	gLIABILITY
, 
	gWHETHER


19 -- 
IN
 
AN
 
ACTION
 
OF
 
	gCONTRACT
, 
TORT
 
OR
 
	gOTHERWISE
, 
ARISING
 
	gFROM
, 
OUT
 OF OR 
	gIN


20 -- 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 
OR
 THE 
USE
 OR 
OTHER
 
DEALINGS
 
IN
 THE 
	gSOFTWARE
.

22 
loÿl
 
funùiÚ
 
	$d“p_upd©e
(
t1
, 
t2
)

23 
k
, 
v
 
š
 
	$·œs
(
t2
) do

24 
	`ty³
(
v
è=ğ"bË" 
th’


25 
v
 = 
	`d“p_upd©e
({
	}
}, 
	gv
)

26 
’d


28 
	gt1
[
k
] = 
v


29 
’d


31  
t1


32 
’d


34 -- 
A
 
´İ”ty
 
is
 
a
 
tu¶e
 {
Çme
, 
ÿÎback
}.

35 -- 
´İ”t›s
.
¬gs
 
is
 
numb”
 
of
…rİ”t› 
th©
 
ÿn
 
be
 
£t
 
as
 
¬gum’ts


36 -- 
wh’
 
ÿÎšg
 
ª
 
objeù
.

37 
loÿl
 
funùiÚ
 
şass
(
´ÙÙy³
, 
´İ”t›s
, 
·»Á
)

38 -- 
CÏss
 
is
 
the
 
m‘©abË
 
of
 
™s
 
	gš¡ªûs
.

39 
loÿl
 
	gş
 = {}

40 
ş
.
__šdex
 = cl

42 
·»Á
 
th’


43 
ş
.
__´ÙÙy³
 = 
d“p_upd©e
(d“p_upd©e({}, 
·»Á
.__´ÙÙy³), 
´ÙÙy³
)

45 
	gş
.
	g__´ÙÙy³
 = 
´ÙÙy³


46 
’d


48 
´İ”t›s
 
th’


49 
loÿl
 
Çmes
 = {}

51 -- 
C»©e
 
£‰”
 
m‘hods
 
ªd
 
fl
 
£t
 
of
 
´İ”ty
 
Çmes
.

52 
_
, 
´İ”ty
 
š
 
	$aœs
(
´İ”t›s
) do

53 
loÿl
 
Çme
, 
ÿÎback
 = 
´İ”ty
[1],…roperty[2]

55 
ş
[
Çme
] = 
	$funùiÚ
(
£lf
, 
v®ue
)

56 
nÙ
 
	$ÿÎback
(
£lf
, 
v®ue
è
th’


57 
£lf
["_" .. 
Çme
] = 
v®ue


58 
’d


60  
£lf


61 
’d


63 
Çmes
[
Çme
] = 
Œue


64 
’d


66 
funùiÚ
 
ş
.
	`__ÿÎ
(
£lf
, ...)

67 -- 
Wh’
 
ÿÎšg
 
ª
 
objeù
, 
the
 
fœ¡
 
¬gum’t
 
is
 
a
 
bË
,

68 -- 
š‹½»t
 
keys
 
as
 
´İ”ty
 
Çmes
, 
d–eg©e
 
¬gum’ts


69 -- 
to
 
cÜ»¥Údšg
 
£‰”s
 
š
 
Üd”
.

70 
	`ty³
((...)è=ğ"bË" 
th’


71 
Çme
, 
v®ue
 
š
 
	`·œs
((...)) do

72 
Çmes
[
Çme
] 
th’


73 
£lf
[
Çme
](£lf, 
v®ue
)

74 
’d


75 
’d


77 
loÿl
 
Çrgs
 = 
	`£Ëù
("#", ...)

79 
i
, 
´İ”ty
 
š
 
	$aœs
(
´İ”t›s
) do

80 
i
 > 
Çrgs
 
Ü
 i > 
´İ”t›s
.
¬gs
 
th’


82 
’d


84 
loÿl
 
¬g
 = 
	$£Ëù
(
i
, ...)

86 
¬g
 ~ğ
n
 
th’


87 
£lf
[
´İ”ty
[1]](£lf, 
¬g
)

88 
’d


89 
’d


90 
’d


92  
£lf


93 
’d


94 
’d


96 -- 
If
 
šdexšg
 
şass
 
çs
, 
çÎback
 
to
 
™s
 
·»Á
.

97 
loÿl
 
şass_m‘©abË
 = {
	}
}

98 
şass_m‘©abË
.
__šdex
 = 
·»Á


100 
funùiÚ
 
şass_m‘©abË
.
__ÿÎ
(
£lf
, ...)

101 -- 
C®lšg
 
a
 
şass
 
»tuºs
 
™s
 
	gš¡ªû
.

102 -- 
Argum’ts
 
¬e
 
d–eg©ed
 
to
 
the
 
	gš¡ªû
.

103 
loÿl
 
	gobjeù
 = 
d“p_upd©e
({}, 
£lf
.
__´ÙÙy³
)

104 
	$£tm‘©abË
(
objeù
, 
£lf
)

105  
	$objeù
(...)

106 
’d


108  
	$£tm‘©abË
(
ş
, 
şass_m‘©abË
)

109 
’d


111 
loÿl
 
funùiÚ
 
	$ty³check
(
Çme
, 
ty³s
, 
v®ue
)

112 
_
, 
ty³_
 
š
 
	$aœs
(
ty³s
) do

113 
	`ty³
(
v®ue
è=ğ
ty³_
 
th’


114  
Œue


115 
’d


116 
’d


118 
	`”rÜ
(("bad…rİ”ty '%s' (% ex³ùed, gÙ %s)"):
	`fÜm©
(
Çme
, 
bË
.
	`cÚÿt
(
ty³s
, " o¸"), 
	$ty³
(
v®ue
)))

119 
’d


121 
loÿl
 
funùiÚ
 
	$ty³checked
(
Çme
, ...)

122 
loÿl
 
ty³s
 = {...
	}
}

123  {
Çme
, 
funùiÚ
(
_
, 
v®ue
è
ty³check
Òame, 
ty³s
, v®ueè
’d
}

124 
’d


126 
loÿl
 
muÉšame
 = {"Çme", 
funùiÚ
(
£lf
, 
v®ue
)

127 
ty³check
("Çme", {"¡ršg"}, 
v®ue
)

129 
®Ÿs
 
š
 
v®ue
:
gm©ch
("%S+") do

130 
£lf
.
_Çme
 = s–f._Çm
Ü
 
®Ÿs


131 
bË
.
š£¹
(
£lf
.
_®Ÿ£s
, 
®Ÿs
)

132 
	g’d


134 -- 
Do
 
nÙ
 
£t
 
_Çme
 
as
 
w™h
 
Ùh”
 
	g´İ”t›s
.

135  
Œue


136 
	g’d
}

138 
loÿl
 
funùiÚ
 
	$·r£_bound¬›s
(
¡r
)

139 
	$tÚumb”
(
¡r
è
th’


140  
	`tÚumb”
(
¡r
), 
	$tÚumb”
(
¡r
)

141 
’d


143 
¡r
 =ğ"*" 
th’


144  0, 
m©h
.
huge


145 
’d


147 
¡r
 =ğ"+" 
th’


148  1, 
m©h
.
huge


149 
’d


151 
¡r
 =ğ"?" 
th’


153 
’d


155 
¡r
:
m©ch
 "^%d+%-%d+$" 
th’


156 
loÿl
 
mš
, 
max
 = 
¡r
:
m©ch
 "^(%d+)%-(%d+)$"

157  
	`tÚumb”
(
mš
), 
	$tÚumb”
(
max
)

158 
’d


160 
¡r
:
m©ch
 "^%d+%+$" 
th’


161 
loÿl
 
mš
 = 
¡r
:
m©ch
 "^(%d+)%+$"

162  
	`tÚumb”
(
mš
), 
m©h
.
huge


163 
’d


164 
’d


166 
loÿl
 
funùiÚ
 
	$bound¬›s
(
Çme
)

167  {
Çme
, 
	`funùiÚ
(
£lf
, 
v®ue
)

168 
	`ty³check
(
Çme
, {"numb”", "¡ršg"}, 
v®ue
)

170 
loÿl
 
mš
, 
max
 = 
	`·r£_bound¬›s
(
v®ue
)

172 
nÙ
 
mš
 
th’


173 
	`”rÜ
(("bad…rİ”ty '%s'"):
	`fÜm©
(
Çme
))

174 
’d


176 
£lf
["_mš" .. 
Çme
], s–f["_max" ..‚ame] = 
mš
, 
max


177 
’d
}

178 
’d


180 
loÿl
 
	gaùiÚs
 = {}

182 
loÿl
 
İtiÚ_aùiÚ
 = {"aùiÚ", 
funùiÚ
(
_
, 
v®ue
)

183 
ty³check
("aùiÚ", {"funùiÚ", "¡ršg"}, 
v®ue
)

185 
ty³
(
v®ue
è=ğ"¡ršg" 
ªd
 
nÙ
 
aùiÚs
[v®ue] 
th’


186 
”rÜ
(("unknowÀaùiÚ '%s'"):
fÜm©
(
v®ue
))

187 
’d


188 
’d
}

190 
loÿl
 
İtiÚ_š™
 = {"š™", 
funùiÚ
(
£lf
)

191 
£lf
.
_has_š™
 = 
Œue


192 
’d
}

194 
loÿl
 
	gİtiÚ_deçuÉ
 = {"deçuÉ", 
funùiÚ
(
£lf
, 
v®ue
)

195 
ty³
(
v®ue
è~ğ"¡ršg" 
th’


196 
£lf
.
_š™
 = 
v®ue


197 
£lf
.
_has_š™
 = 
Œue


198  
Œue


199 
’d


200 
’d
}

202 
loÿl
 
	gadd_h–p
 = {"add_h–p", 
funùiÚ
(
£lf
, 
v®ue
)

203 
ty³check
("add_h–p", {"boŞ—n", "¡ršg", "bË"}, 
v®ue
)

205 
£lf
.
_has_h–p
 
th’


206 
bË
.
»move
(
£lf
.
_İtiÚs
)

207 
£lf
.
_has_h–p
 = 
çl£


208 
’d


210 
v®ue
 
th’


211 
loÿl
 
h–p
 = 
£lf
:
æag
()

212 :
desütiÚ
 "Showhis help message‡ndƒxit."

213 :
aùiÚ
(
funùiÚ
()

214 
´št
(
£lf
:
g‘_h–p
())

215 
os
.
ex™
(0)

216 
’d
)

218 
v®ue
 ~ğ
Œue
 
th’


219 
h–p
 = h–p(
v®ue
)

220 
’d


222 
nÙ
 
h–p
.
_Çme
 
th’


223 
h–p
 "-h" "--help"

224 
’d


226 
£lf
.
_has_h–p
 = 
Œue


227 
’d


228 
’d
}

230 
loÿl
 
P¬£r
 = 
şass
({

231 
_¬gum’ts
 = {},

232 
_İtiÚs
 = {},

233 
_commªds
 = {},

234 
_mu‹xes
 = {},

235 
_»quœe_commªd
 = 
Œue
,

236 
_hªdË_İtiÚs
 = 
Œue


238 
¬gs
 = 3,

239 
ty³checked
("name", "string"),

240 
ty³checked
("description", "string"),

241 
ty³checked
("epilog", "string"),

242 
ty³checked
("usage", "string"),

243 
ty³checked
("help", "string"),

244 
ty³checked
("require_command", "boolean"),

245 
ty³checked
("handle_options", "boolean"),

246 
ty³checked
("action", "function"),

247 
ty³checked
("command_target", "string"),

248 
add_h–p


251 
loÿl
 
	gCommªd
 = 
şass
({

252 
_®Ÿ£s
 = {}

254 
¬gs
 = 3,

255 
muÉšame
,

256 
ty³checked
("description", "string"),

257 
ty³checked
("epilog", "string"),

258 
ty³checked
("target", "string"),

259 
ty³checked
("usage", "string"),

260 
ty³checked
("help", "string"),

261 
ty³checked
("require_command", "boolean"),

262 
ty³checked
("handle_options", "boolean"),

263 
ty³checked
("action", "function"),

264 
ty³checked
("command_target", "string"),

265 
add_h–p


266 }, 
P¬£r
)

268 
loÿl
 
	gArgum’t
 = 
şass
({

269 
_mš¬gs
 = 1,

270 
_max¬gs
 = 1,

271 
_mšcouÁ
 = 1,

272 
_maxcouÁ
 = 1,

273 
_defmode
 = "unused",

274 
_show_deçuÉ
 = 
Œue


276 
¬gs
 = 5,

277 
ty³checked
("name", "string"),

278 
ty³checked
("description", "string"),

279 
İtiÚ_deçuÉ
,

280 
ty³checked
("convert", "function", "table"),

281 
bound¬›s
("args"),

282 
ty³checked
("target", "string"),

283 
ty³checked
("defmode", "string"),

284 
ty³checked
("show_default", "boolean"),

285 
ty³checked
("argname", "string", "table"),

286 {"combše", 
funùiÚ
(
£lf
, 
v®
è
ty³check
("combše", {"boŞ—n", "n"}, v®è£lf.
_combše
 = v® =ğ
n
 
Ü
 v®  
Œue
 
’d
},

287 
İtiÚ_aùiÚ
,

288 
İtiÚ_š™


291 
loÿl
 
	gO±iÚ
 = 
şass
({

292 
_®Ÿ£s
 = {},

293 
_mšcouÁ
 = 0,

294 
_ov”wr™e
 = 
Œue


296 
¬gs
 = 6,

297 
muÉšame
,

298 
ty³checked
("description", "string"),

299 
İtiÚ_deçuÉ
,

300 
ty³checked
("convert", "function", "table"),

301 
bound¬›s
("args"),

302 
bound¬›s
("count"),

303 
ty³checked
("target", "string"),

304 
ty³checked
("defmode", "string"),

305 
ty³checked
("show_default", "boolean"),

306 
ty³checked
("overwrite", "boolean"),

307 
ty³checked
("argname", "string", "table"),

308 
İtiÚ_aùiÚ
,

309 
İtiÚ_š™


310 }, 
Argum’t
)

312 
funùiÚ
 
	gArgum’t
:
	$_g‘_¬gum’t_li¡
()

313 
loÿl
 
buf
 = {
	}
}

314 
loÿl
 
i
 = 1

316 
i
 <ğ
m©h
.
	$mš
(
£lf
.
_mš¬gs
, 3) do

317 
loÿl
 
¬gÇme
 = 
£lf
:
	$_g‘_¬gÇme
(
i
)

319 
£lf
.
_deçuÉ
 
ªd
 s–f.
_defmode
:
fšd
 "a" 
th’


320 
¬gÇme
 = "[" ..‡rgname .. "]"

321 
’d


323 
bË
.
	$š£¹
(
buf
, 
¬gÇme
)

324 
i
 = i+1

325 
’d


327 
i
 <ğ
m©h
.
	$mš
(
£lf
.
_max¬gs
, 3) do

328 
bË
.
	`š£¹
(
buf
, "[" .. 
£lf
:
	`_g‘_¬gÇme
(
i
) .. "]")

329 
i
 = i+1

331 
£lf
.
_max¬gs
 =ğ
m©h
.
huge
 
th’


333 
’d


334 
’d


336 
i
 < 
£lf
.
_max¬gs
 
ªd
 
nÙ
 s–f.
_combše
 
th’


337 
bË
.
	`š£¹
(
buf
, "...")

338 
’d


340  
buf


341 
’d


343 
funùiÚ
 
Argum’t
:
	$_g‘_u§ge
()

344 
loÿl
 
u§ge
 = 
bË
.
	`cÚÿt
(
£lf
:
	`_g‘_¬gum’t_li¡
(), " ")

346 
£lf
.
_deçuÉ
 
ªd
 s–f.
_defmode
:
fšd
 "u" 
th’


347 
£lf
.
_max¬gs
 > 1 
	`Ü
 (£lf.
_mš¬gs
 =ğ1 
ªd
 
nÙ
 s–f.
_defmode
:
fšd
 "a"è
th’


348 
u§ge
 = "[" .. usage .. "]"

349 
’d


350 
’d


352  
u§ge


353 
’d


355 
funùiÚ
 
aùiÚs
.
	$¡Üe_Œue
(
»suÉ
, 
rg‘
)

356 
»suÉ
[
rg‘
] = 
Œue


357 
’d


359 
funùiÚ
 
aùiÚs
.
	$¡Üe_çl£
(
»suÉ
, 
rg‘
)

360 
»suÉ
[
rg‘
] = 
çl£


361 
’d


363 
funùiÚ
 
aùiÚs
.
	$¡Üe
(
»suÉ
, 
rg‘
, 
¬gum’t
)

364 
»suÉ
[
rg‘
] = 
¬gum’t


365 
’d


367 
funùiÚ
 
aùiÚs
.
	$couÁ
(
»suÉ
, 
rg‘
, 
_
, 
ov”wr™e
)

368 
nÙ
 
ov”wr™e
 
th’


369 
»suÉ
[
rg‘
] =„esult[target] + 1

370 
’d


371 
’d


373 
funùiÚ
 
aùiÚs
.
	$­³nd
(
»suÉ
, 
rg‘
, 
¬gum’t
, 
ov”wr™e
)

374 
»suÉ
[
rg‘
] =„esuÉ[rg‘] 
Ü
 {
	}
}

375 
bË
.
	$š£¹
(
»suÉ
[
rg‘
], 
¬gum’t
)

377 
ov”wr™e
 
th’


378 
bË
.
	$»move
(
»suÉ
[
rg‘
], 1)

379 
’d


380 
’d


382 
funùiÚ
 
aùiÚs
.
	$cÚÿt
(
»suÉ
, 
rg‘
, 
¬gum’ts
, 
ov”wr™e
)

383 
ov”wr™e
 
th’


384 
	`”rÜ
("'concat'‡ction can't handleoo many invocations")

385 
’d


387 
»suÉ
[
rg‘
] =„esuÉ[rg‘] 
Ü
 {
	}
}

389 
_
, 
¬gum’t
 
š
 
	$aœs
(
¬gum’ts
) do

390 
bË
.
	$š£¹
(
»suÉ
[
rg‘
], 
¬gum’t
)

391 
’d


392 
’d


394 
funùiÚ
 
Argum’t
:
	$_g‘_aùiÚ
()

395 
loÿl
 
aùiÚ
, 
š™


397 
£lf
.
_maxcouÁ
 =ğ1 
th’


398 
£lf
.
_max¬gs
 =ğ0 
th’


399 
aùiÚ
, 
š™
 = "¡Üe_Œue", 
n


401 
aùiÚ
, 
š™
 = "¡Üe", 
n


402 
’d


404 
£lf
.
_max¬gs
 =ğ0 
th’


405 
aùiÚ
, 
š™
 = "count", 0

407 
aùiÚ
, 
š™
 = "­³nd", {
	}
}

408 
’d


409 
’d


411 
	g£lf
.
_aùiÚ
 
th’


412 
	gaùiÚ
 = 
£lf
.
_aùiÚ


413 
’d


415 
£lf
.
_has_š™
 
th’


416 
š™
 = 
£lf
.
_š™


417 
’d


419 
ty³
(
aùiÚ
è=ğ"¡ršg" 
th’


420 
aùiÚ
 = 
aùiÚs
[action]

421 
’d


423  
aùiÚ
, 
š™


424 
	g’d


426 -- 
R‘uºs
 
¶aûhŞd”
 `
	gÇrg
`-
th
 
	g¬gum’t
.

427 
funùiÚ
 
	gArgum’t
:
	$_g‘_¬gÇme
(
Çrg
)

428 
loÿl
 
¬gÇme
 = 
£lf
.
_¬gÇme
 
Ü
 s–f:
	$_g‘_deçuÉ_¬gÇme
()

430 
	`ty³
(
¬gÇme
è=ğ"bË" 
th’


431  
¬gÇme
[
Çrg
]

433  
¬gÇme


434 
’d


435 
’d


437 
funùiÚ
 
Argum’t
:
	$_g‘_deçuÉ_¬gÇme
()

438  "<" .. 
£lf
.
_Çme
 .. ">"

439 
’d


441 
funùiÚ
 
O±iÚ
:
	$_g‘_deçuÉ_¬gÇme
()

442  "<" .. 
£lf
:
	`_g‘_deçuÉ_rg‘
() .. ">"

443 
’d


445 -- 
R‘uºs
 
Ïb–
 
to
 
be
 
shown
 
š
 
the
 
h–p
 
mes§ge
.

446 
funùiÚ
 
Argum’t
:
	$_g‘_Ïb–
()

447  
£lf
.
_Çme


448 
’d


450 
funùiÚ
 
O±iÚ
:
	$_g‘_Ïb–
()

451 
loÿl
 
v¬ŸÁs
 = {
	}
}

452 
loÿl
 
¬gum’t_li¡
 = 
£lf
:
	$_g‘_¬gum’t_li¡
()

453 
bË
.
	$š£¹
(
¬gum’t_li¡
, 1, 
n
)

455 
_
, 
®Ÿs
 
š
 
	$aœs
(
£lf
.
_®Ÿ£s
) do

456 
¬gum’t_li¡
[1] = 
®Ÿs


457 
bË
.
	`š£¹
(
v¬ŸÁs
,abË.
	`cÚÿt
(
¬gum’t_li¡
, " "))

458 
’d


460  
bË
.
	`cÚÿt
(
v¬ŸÁs
, ", ")

461 
’d


463 
funùiÚ
 
Commªd
:
	$_g‘_Ïb–
()

464  
bË
.
	`cÚÿt
(
£lf
.
_®Ÿ£s
, ", ")

465 
’d


467 
funùiÚ
 
Argum’t
:
	$_g‘_desütiÚ
()

468 
£lf
.
_deçuÉ
 
ªd
 s–f.
_show_deçuÉ
 
th’


469 
£lf
.
_desütiÚ
 
th’


470  ("% (deçuÉ: %s)"):
	$fÜm©
(
£lf
.
_desütiÚ
, s–f.
_deçuÉ
)

472  ("deçuÉ: %s"):
	$fÜm©
(
£lf
.
_deçuÉ
)

473 
’d


475  
£lf
.
_desütiÚ
 
Ü
 ""

476 
’d


477 
’d


479 
funùiÚ
 
Commªd
:
	$_g‘_desütiÚ
()

480  
£lf
.
_desütiÚ
 
Ü
 ""

481 
’d


483 
funùiÚ
 
O±iÚ
:
	$_g‘_u§ge
()

484 
loÿl
 
u§ge
 = 
£lf
:
	$_g‘_¬gum’t_li¡
()

485 
bË
.
	$š£¹
(
u§ge
, 1, 
£lf
.
_Çme
)

486 
u§ge
 = 
bË
.
	`cÚÿt
(usage, " ")

488 
£lf
.
_mšcouÁ
 =ğ0 
Ü
 s–f.
_deçuÉ
 
th’


489 
u§ge
 = "[" .. usage .. "]"

490 
’d


492  
u§ge


493 
’d


495 
funùiÚ
 
Argum’t
:
	$_g‘_deçuÉ_rg‘
()

496  
£lf
.
_Çme


497 
’d


499 
funùiÚ
 
O±iÚ
:
	$_g‘_deçuÉ_rg‘
()

500 
loÿl
 
»s


502 
_
, 
®Ÿs
 
š
 
	$aœs
(
£lf
.
_®Ÿ£s
) do

503 
®Ÿs
:
	`sub
(1, 1è=ğ®Ÿs:
	$sub
(2, 2è
th’


504 
»s
 = 
®Ÿs
:
	$sub
(3)

506 
’d


507 
’d


509 
»s
 =„e 
Ü
 
£lf
.
_Çme
:
	$sub
(2)

510  (
»s
:
	`gsub
("-", "_"))

511 
’d


513 
funùiÚ
 
O±iÚ
:
	$_is_v¬¬g
()

514  
£lf
.
_max¬gs
 ~ğ£lf.
_mš¬gs


515 
’d


517 
funùiÚ
 
P¬£r
:
	$_g‘_fuÎÇme
()

518 
loÿl
 
·»Á
 = 
£lf
.
_·»Á


519 
loÿl
 
buf
 = {
£lf
.
_Çme
}

521 
·»Á
 do

522 
bË
.
	$š£¹
(
buf
, 1, 
·»Á
.
_Çme
)

523 
·»Á
 =…¬’t.
_·»Á


524 
’d


526  
bË
.
	`cÚÿt
(
buf
, " ")

527 
’d


529 
funùiÚ
 
P¬£r
:
	$_upd©e_ch¬£t
(
ch¬£t
)

530 
ch¬£t
 = ch¬£ˆ
Ü
 {
	}
}

532 
_
, 
commªd
 
š
 
	$aœs
(
£lf
.
_commªds
) do

533 
commªd
:
	$_upd©e_ch¬£t
(
ch¬£t
)

534 
’d


536 
_
, 
İtiÚ
 
š
 
	$aœs
(
£lf
.
_İtiÚs
) do

537 
_
, 
®Ÿs
 
š
 
	$aœs
(
İtiÚ
.
_®Ÿ£s
) do

538 
ch¬£t
[
®Ÿs
:
	`sub
(1, 1)] = 
Œue


539 
’d


540 
’d


542  
ch¬£t


543 
’d


545 
funùiÚ
 
P¬£r
:
	$¬gum’t
(...)

546 
loÿl
 
¬gum’t
 = 
	$Argum’t
(...)

547 
bË
.
	$š£¹
(
£lf
.
_¬gum’ts
, 
¬gum’t
)

548  
¬gum’t


549 
’d


551 
funùiÚ
 
P¬£r
:
	$İtiÚ
(...)

552 
loÿl
 
İtiÚ
 = 
	$O±iÚ
(...)

554 
£lf
.
_has_h–p
 
th’


555 
bË
.
	`š£¹
(
£lf
.
_İtiÚs
, #£lf._İtiÚs, 
İtiÚ
)

557 
bË
.
	$š£¹
(
£lf
.
_İtiÚs
, 
İtiÚ
)

558 
’d


560  
İtiÚ


561 
’d


563 
funùiÚ
 
P¬£r
:
	$æag
(...)

564  
£lf
:
	$İtiÚ
():
	`¬gs
(0)(...)

565 
’d


567 
funùiÚ
 
P¬£r
:
	$commªd
(...)

568 
loÿl
 
commªd
 = 
	$Commªd
():
	`add_h–p
(
Œue
)(...)

569 
commªd
.
_·»Á
 = 
£lf


570 
bË
.
	$š£¹
(
£lf
.
_commªds
, 
commªd
)

571  
commªd


572 
’d


574 
funùiÚ
 
P¬£r
:
	$mu‹x
(...)

575 
loÿl
 
İtiÚs
 = {...
	}
}

577 
i
, 
İtiÚ
 
š
 
	$aœs
(
İtiÚs
) do

578 
	`as£¹
(
	`g‘m‘©abË
(
İtiÚ
è=ğ
O±iÚ
, ("bad‡rgum’ˆ#%dØ'mu‹x' (O±iÚƒx³ùed)"):
	$fÜm©
(
i
))

579 
’d


581 
bË
.
	$š£¹
(
£lf
.
_mu‹xes
, 
İtiÚs
)

582  
£lf


583 
’d


585 
loÿl
 
max_u§ge_width
 = 120

586 
loÿl
 
u§ge_w–come
 = "Usage: "

588 
funùiÚ
 
P¬£r
:
	$g‘_u§ge
()

589 
£lf
.
_u§ge
 
th’


590  
£lf
.
_u§ge


591 
’d


593 
loÿl
 
lšes
 = {
u§ge_w–come
 .. 
£lf
:
	`_g‘_fuÎÇme
()
	}
}

595 
loÿl
 
funùiÚ
 
	$add
(
s
)

596 #lšes[#lšes]+1+# <ğ
max_u§ge_width
 
th’


597 
lšes
[#lšes] =†šes[#lšes] .. " " .. 
s


599 
lšes
[#lšes+1] = (" "):
	`»p
(#u§ge_w–comeè.. 
s


600 
’d


601 
’d


603 -- 
This
 
ÿn
 
defš™–y
 
be
 
»çùÜed
 
što
 
som‘hšg
 
ş—Ãr


604 
loÿl
 
mu‹x_İtiÚs
 = {
	}
}

605 
loÿl
 
v¬¬g_mu‹xes
 = {}

607 -- 
Fœ¡
, 
put
 
mu‹xes
 
which
 dØ
nÙ
 
cÚš
 
v¬¬g
 
İtiÚs
 
ªd
 
»memb”
 
tho£
 which do

608 
	g_
, 
mu‹x
 
š
 
	$aœs
(
£lf
.
_mu‹xes
) do

609 
loÿl
 
buf
 = {
	}
}

610 
loÿl
 
is_v¬¬g
 = 
çl£


612 
_
, 
İtiÚ
 
š
 
	$aœs
(
mu‹x
) do

613 
İtiÚ
:
	$_is_v¬¬g
(è
th’


614 
is_v¬¬g
 = 
Œue


615 
’d


617 
bË
.
	`š£¹
(
buf
, 
İtiÚ
:
	$_g‘_u§ge
())

618 
mu‹x_İtiÚs
[
İtiÚ
] = 
Œue


619 
’d


621 
loÿl
 
»´
 = "(" .. 
bË
.
	`cÚÿt
(
buf
, " | ") .. ")"

623 
is_v¬¬g
 
th’


624 
bË
.
	$š£¹
(
v¬¬g_mu‹xes
, 
»´
)

626 
	$add
(
»´
)

627 
’d


628 
’d


630 -- 
SecÚd
, 
put
 
»guÏr
 
İtiÚs


631 
_
, 
İtiÚ
 
š
 
	$aœs
(
£lf
.
_İtiÚs
) do

632 
nÙ
 
mu‹x_İtiÚs
[
İtiÚ
] 
ªd
‚Ù o±iÚ:
	$_is_v¬¬g
(è
th’


633 
	`add
(
İtiÚ
:
	$_g‘_u§ge
())

634 
’d


635 
’d


637 -- 
Put
 
pos™iÚ®
 
¬gum’ts


638 
_
, 
¬gum’t
 
š
 
	$aœs
(
£lf
.
_¬gum’ts
) do

639 
	`add
(
¬gum’t
:
	$_g‘_u§ge
())

640 
’d


642 -- 
Put
 
mu‹xes
 
cÚššg
 
v¬¬g
 
İtiÚs


643 
_
, 
mu‹x_»´
 
š
 
	$aœs
(
v¬¬g_mu‹xes
) do

644 
	$add
(
mu‹x_»´
)

645 
’d


647 
_
, 
İtiÚ
 
š
 
	$aœs
(
£lf
.
_İtiÚs
) do

648 
nÙ
 
mu‹x_İtiÚs
[
İtiÚ
] 
ªd
 o±iÚ:
	$_is_v¬¬g
(è
th’


649 
	`add
(
İtiÚ
:
	$_g‘_u§ge
())

650 
’d


651 
’d


653 #£lf.
_commªds
 > 0 
th’


654 
£lf
.
_»quœe_commªd
 
th’


655 
	`add
("<command>")

657 
	`add
("[<command>]")

658 
’d


660 
	`add
("...")

661 
’d


663  
bË
.
	`cÚÿt
(
lšes
, "\n")

664 
’d


666 
loÿl
 
m¬gš_Ën
 = 3

667 
loÿl
 
m¬gš_Ën2
 = 40

668 
loÿl
 
m¬gš
 = (" "):
	$»p
(
m¬gš_Ën
)

669 
loÿl
 
m¬gš2
 = (" "):
	$»p
(
m¬gš_Ën2
)

671 
loÿl
 
funùiÚ
 
	$make_two_cŞumns
(
s1
, 
s2
)

672 
s2
 =ğ"" 
th’


673  
m¬gš
 .. 
s1


674 
’d


676 
s2
 = s2:
	`gsub
("\n", "\n" .. 
m¬gš2
)

678 #s1 < (
m¬gš_Ën2
-
m¬gš_Ën
è
th’


679  
m¬gš
 .. 
s1
 .. (" "):
	`»p
(
m¬gš_Ën2
-
m¬gš_Ën
-#s1è.. 
s2


681  
m¬gš
 .. 
s1
 .. "\n" .. 
m¬gš2
 .. 
s2


682 
’d


683 
’d


685 
funùiÚ
 
P¬£r
:
	$g‘_h–p
()

686 
£lf
.
_h–p
 
th’


687  
£lf
.
_h–p


688 
’d


690 
loÿl
 
blocks
 = {
£lf
:
	`g‘_u§ge
()
	}
}

692 
£lf
.
_desütiÚ
 
th’


693 
bË
.
	$š£¹
(
blocks
, 
£lf
.
_desütiÚ
)

694 
’d


696 
loÿl
 
Ïb–s
 = {"Argum’ts:", "O±iÚs:", "Commªds:"
	}
}

698 
i
, 
–em’ts
 
š
 
	gaœs
{
	g£lf
.
	g_¬gum’ts
, s–f.
	g_İtiÚs
, s–f.
	g_commªds
} do

699 #–em’t > 0 
th’


700 
loÿl
 
	gbuf
 = {
Ïb–s
[
i
]}

702 
_
, 
–em’t
 
š
 
	$aœs
(
–em’ts
) do

703 
bË
.
	`š£¹
(
buf
, 
	`make_two_cŞumns
(
–em’t
:
	`_g‘_Ïb–
(),ƒËm’t:
	$_g‘_desütiÚ
()))

704 
’d


706 
bË
.
	`š£¹
(
blocks
,abË.
	`cÚÿt
(
buf
, "\n"))

707 
’d


708 
’d


710 
£lf
.
_•og
 
th’


711 
bË
.
	$š£¹
(
blocks
, 
£lf
.
_•og
)

712 
’d


714  
bË
.
	`cÚÿt
(
blocks
, "\n\n")

715 
’d


717 
loÿl
 
funùiÚ
 
	$g‘_t
(
cÚ‹xt
, 
wrÚg_Çme
)

718 
loÿl
 
cÚ‹xt_poŞ
 = {
	}
}

719 
loÿl
 
possibË_Çme


720 
loÿl
 
possibË_Çmes
 = {}

722 
Çme
 
š
 
	$·œs
(
cÚ‹xt
) do

723 
	`ty³
(
Çme
è=ğ"¡ršg" 
th’


724 
i
 = 1, #name do

725 
possibË_Çme
 = 
Çme
:
	`sub
(1, 
i
 - 1) ..‚ame:sub(i + 1)

727 
nÙ
 
cÚ‹xt_poŞ
[
possibË_Çme
] 
th’


728 
cÚ‹xt_poŞ
[
possibË_Çme
] = {
	}
}

729 
’d


731 
bË
.
	$š£¹
(
cÚ‹xt_poŞ
[
possibË_Çme
], 
Çme
)

732 
’d


733 
’d


734 
’d


736 
i
 = 1, #wrong_name + 1 do

737 
possibË_Çme
 = 
wrÚg_Çme
:
	`sub
(1, 
i
 - 1) .. wrong_name:sub(i + 1)

739 
cÚ‹xt
[
possibË_Çme
] 
th’


740 
possibË_Çmes
[
possibË_Çme
] = 
Œue


741 
–£if
 
cÚ‹xt_poŞ
[
possibË_Çme
] 
th’


742 
_
, 
Çme
 
š
 
	$aœs
(
cÚ‹xt_poŞ
[
possibË_Çme
]) do

743 
possibË_Çmes
[
Çme
] = 
Œue


744 
’d


745 
’d


746 
’d


748 
loÿl
 
fœ¡
 = 
	$Ãxt
(
possibË_Çmes
)

750 
fœ¡
 
th’


751 
	$Ãxt
(
possibË_Çmes
, 
fœ¡
è
th’


752 
loÿl
 
possibË_Çmes_¬r
 = {
	}
}

754 
Çme
 
š
 
	$·œs
(
possibË_Çmes
) do

755 
bË
.
	`š£¹
(
possibË_Çmes_¬r
, "'" .. 
Çme
 .. "'")

756 
’d


758 
bË
.
	$sÜt
(
possibË_Çmes_¬r
)

759  "\nDid you m—ÀÚoàthe£: " .. 
bË
.
	`cÚÿt
(
possibË_Çmes_¬r
, " ") .. "?"

761  "\nDid you m—À'" .. 
fœ¡
 .. "'?"

762 
’d


765 
’d


766 
’d


768 
loÿl
 
EËm’tS‹
 = 
	`şass
({

769 
švoÿtiÚs
 = 0

770 
	}
})

772 
funùiÚ
 
	gEËm’tS‹
:
	$__ÿÎ
(
¡©e
, 
–em’t
)

773 
£lf
.
¡©e
 = state

774 
£lf
.
»suÉ
 = 
¡©e
.result

775 
£lf
.
–em’t
 =ƒlement

776 
£lf
.
rg‘
 = 
–em’t
.
_rg‘
 
Ü
ƒËm’t:
	$_g‘_deçuÉ_rg‘
()

777 
£lf
.
aùiÚ
, s–f.
»suÉ
[£lf.
rg‘
] = 
–em’t
:
	$_g‘_aùiÚ
()

778  
£lf


779 
’d


781 
funùiÚ
 
EËm’tS‹
:
	$”rÜ
(
fmt
, ...)

782 
£lf
.
¡©e
:
	$”rÜ
(
fmt
, ...)

783 
’d


785 
funùiÚ
 
EËm’tS‹
:
	$cÚv”t
(
¬gum’t
)

786 
loÿl
 
cÚv”‹r
 = 
£lf
.
–em’t
.
_cÚv”t


788 
cÚv”‹r
 
th’


789 
loÿl
 
ok
, 
”r


791 
	`ty³
(
cÚv”‹r
è=ğ"funùiÚ" 
th’


792 
ok
, 
”r
 = 
	$cÚv”‹r
(
¬gum’t
)

794 
ok
 = 
cÚv”‹r
[
¬gum’t
]

795 
’d


797 
ok
 =ğ
n
 
th’


798 
£lf
:
	`”rÜ
(
”r
 
ªd
 "%s" 
Ü
 "m®fÜmed‡rgum’ˆ'%s'",ƒ¼ o¸
¬gum’t
)

799 
’d


801 
¬gum’t
 = 
ok


802 
’d


804  
¬gum’t


805 
’d


807 
funùiÚ
 
EËm’tS‹
:(
mode
)

808  
£lf
.
–em’t
.
_defmode
:
	$fšd
(
mode
è
ªd
 
£lf
.
–em’t
.
_deçuÉ


809 
’d


811 
loÿl
 
funùiÚ
 
	$bound
(
noun
, 
mš
, 
max
, 
is_max
)

812 
loÿl
 
»s
 = ""

814 
mš
 ~ğ
max
 
th’


815 
»s
 = "© " .. (
is_max
 
ªd
 "mo¡" 
Ü
 "least") .. " "

816 
’d


818 
loÿl
 
numb”
 = 
is_max
 
ªd
 
max
 
Ü
 
mš


819  
»s
 .. 
	`to¡ršg
(
numb”
è.. " " .. 
noun
 .. (numb” =ğ1 
ªd
 "" 
Ü
 "s")

820 
’d


822 
funùiÚ
 
EËm’tS‹
:
	$švoke
(
®Ÿs
)

823 
£lf
.
İ’
 = 
Œue


824 
£lf
.
Çme
 = ("% '%s'"):
	`fÜm©
(
®Ÿs
 
ªd
 "İtiÚ" 
Ü
 "¬gum’t",‡lŸ Ü s–f.
–em’t
.
_Çme
)

825 
£lf
.
ov”wr™e
 = 
çl£


827 
£lf
.
švoÿtiÚs
 >ğ£lf.
–em’t
.
_maxcouÁ
 
th’


828 
£lf
.
–em’t
.
_ov”wr™e
 
th’


829 
£lf
.
ov”wr™e
 = 
Œue


831 
£lf
:
	`”rÜ
("% mu¡ bu£d %s", s–f.
Çme
, 
	`bound
("time", s–f.
–em’t
.
_mšcouÁ
, s–f.–em’t.
_maxcouÁ
, 
Œue
))

832 
’d


834 
£lf
.
švoÿtiÚs
 = self.invocations + 1

835 
’d


837 
£lf
.
¬gs
 = {
	}
}

839 
£lf
.
–em’t
.
_max¬gs
 <ğ0 
th’


840 
£lf
:
	$şo£
()

841 
’d


843  
£lf
.
İ’


844 
’d


846 
funùiÚ
 
EËm’tS‹
:
	$·ss
(
¬gum’t
)

847 
¬gum’t
 = 
£lf
:
	$cÚv”t
(
¬gum’t
)

848 
bË
.
	$š£¹
(
£lf
.
¬gs
, 
¬gum’t
)

850 #£lf.
¬gs
 >ğ
£lf
.
–em’t
.
_max¬gs
 
th’


851 
£lf
:
	$şo£
()

852 
’d


854  
£lf
.
İ’


855 
’d


857 
funùiÚ
 
EËm’tS‹
:
	$com¶‘e_švoÿtiÚ
()

858 #£lf.
¬gs
 < 
£lf
.
–em’t
.
_mš¬gs
 do

859 
£lf
:
	$·ss
(
£lf
.
–em’t
.
_deçuÉ
)

860 
’d


861 
’d


863 
funùiÚ
 
EËm’tS‹
:
	$şo£
()

864 
£lf
.
İ’
 
th’


865 
£lf
.
İ’
 = 
çl£


867 #£lf.
¬gs
 < 
£lf
.
–em’t
.
_mš¬gs
 
th’


868 
£lf
:("a"è
th’


869 
£lf
:
	$com¶‘e_švoÿtiÚ
()

871 #£lf.
¬gs
 =ğ0 
th’


872 
	`g‘m‘©abË
(
£lf
.
–em’t
è=ğ
Argum’t
 
th’


873 
£lf
:
	`”rÜ
("missšg %s", s–f.
Çme
)

874 
–£if
 
£lf
.
–em’t
.
_max¬gs
 =ğ1 
th’


875 
£lf
:
	`”rÜ
("% »quœe ª‡rgum’t", s–f.
Çme
)

876 
’d


877 
’d


879 
£lf
:
	`”rÜ
("% »quœe %s", s–f.
Çme
, 
	`bound
("¬gum’t", s–f.
–em’t
.
_mš¬gs
, s–f.–em’t.
_max¬gs
))

880 
’d


881 
’d


883 
loÿl
 
¬gs
 = 
£lf
.args

885 
£lf
.
–em’t
.
_max¬gs
 <ğ1 
th’


886 
¬gs
 =‡rgs[1]

887 
’d


889 
£lf
.
–em’t
.
_max¬gs
 =ğ1 
ªd
 s–f.–em’t.
_mš¬gs
 =ğ0‡nd s–f.–em’t.
_mšcouÁ
 ~ğ£lf.–em’t.
_maxcouÁ
 
th’


890 
¬gs
 = 
£lf
.args

891 
’d


892 
£lf
.
–em’t
.
_combše
 
th’


893 
¬gs
 = 
bË
.
	`cÚÿt
(args, " ")

894 
’d


896 
£lf
.
	$aùiÚ
(
£lf
.
»suÉ
, s–f.
rg‘
, 
¬gs
, s–f.
ov”wr™e
)

897 
’d


898 
’d


900 
loÿl
 
P¬£S‹
 = 
	`şass
({

901 
»suÉ
 = {},

902 
İtiÚs
 = {},

903 
¬gum’ts
 = {},

904 
¬gum’t_i
 = 1,

905 
–em’t_to_mu‹xes
 = {},

906 
mu‹x_to_u£d_İtiÚ
 = {},

907 
commªd_aùiÚs
 = {}

908 
	}
})

910 
funùiÚ
 
	gP¬£S‹
:
	$__ÿÎ
(
·r£r
, 
”rÜ_hªdËr
)

911 
£lf
.
·r£r
 =…arser

912 
£lf
.
”rÜ_hªdËr
 =ƒrror_handler

913 
£lf
.
ch¬£t
 = 
·r£r
:
	$_upd©e_ch¬£t
()

914 
£lf
:
·r£r
)

915  
£lf


916 
’d


918 
funùiÚ
 
P¬£S‹
:
	$”rÜ
(
fmt
, ...)

919 
£lf
.
	`”rÜ_hªdËr
(£lf.
·r£r
, 
fmt
:
	$fÜm©
(...))

920 
’d


922 
funùiÚ
 
P¬£S‹
:
·r£r
)

923 
£lf
.
·r£r
 =…arser

925 
·r£r
.
_aùiÚ
 
th’


926 
bË
.
	`š£¹
(
£lf
.
commªd_aùiÚs
, {
aùiÚ
 = 
·r£r
.
_aùiÚ
, 
Çme
 =…¬£r.
_Çme
})

927 
’d


929 
	g_
, 
İtiÚ
 
š
 
	$aœs
(
·r£r
.
_İtiÚs
) do

930 
İtiÚ
 = 
	$EËm’tS‹
(
£lf
, 
İtiÚ
)

931 
bË
.
	$š£¹
(
£lf
.
İtiÚs
, 
İtiÚ
)

933 
_
, 
®Ÿs
 
š
 
	$aœs
(
İtiÚ
.
–em’t
.
_®Ÿ£s
) do

934 
£lf
.
İtiÚs
[
®Ÿs
] = 
İtiÚ


935 
’d


936 
’d


938 
_
, 
mu‹x
 
š
 
	$aœs
(
·r£r
.
_mu‹xes
) do

939 
_
, 
İtiÚ
 
š
 
	$aœs
(
mu‹x
) do

940 
nÙ
 
£lf
.
–em’t_to_mu‹xes
[
İtiÚ
] 
th’


941 
£lf
.
–em’t_to_mu‹xes
[
İtiÚ
] = {
	}
}

942 
’d


944 
bË
.
	$š£¹
(
£lf
.
–em’t_to_mu‹xes
[
İtiÚ
], 
mu‹x
)

945 
’d


946 
’d


948 
_
, 
¬gum’t
 
š
 
	$aœs
(
·r£r
.
_¬gum’ts
) do

949 
¬gum’t
 = 
	$EËm’tS‹
(
£lf
, 
¬gum’t
)

950 
bË
.
	$š£¹
(
£lf
.
¬gum’ts
, 
¬gum’t
)

951 
¬gum’t
:
	$švoke
()

952 
’d


954 
£lf
.
hªdË_İtiÚs
 = 
·r£r
.
_hªdË_İtiÚs


955 
£lf
.
¬gum’t
 = s–f.
¬gum’ts
[£lf.
¬gum’t_i
]

956 
£lf
.
commªds
 = 
·r£r
.
_commªds


958 
_
, 
commªd
 
š
 
	$aœs
(
£lf
.
commªds
) do

959 
_
, 
®Ÿs
 
š
 
	$aœs
(
commªd
.
_®Ÿ£s
) do

960 
£lf
.
commªds
[
®Ÿs
] = 
commªd


961 
’d


962 
’d


963 
’d


965 
funùiÚ
 
P¬£S‹
:
	$g‘_İtiÚ
(
Çme
)

966 
loÿl
 
İtiÚ
 = 
£lf
.
İtiÚs
[
Çme
]

968 
nÙ
 
İtiÚ
 
th’


969 
£lf
:
	`”rÜ
("unknowÀİtiÚ '%s'%s", 
Çme
, 
	$g‘_t
(
£lf
.
İtiÚs
, 
Çme
))

971  
İtiÚ


972 
’d


973 
’d


975 
funùiÚ
 
P¬£S‹
:
	$g‘_commªd
(
Çme
)

976 
loÿl
 
commªd
 = 
£lf
.
commªds
[
Çme
]

978 
nÙ
 
commªd
 
th’


979 #£lf.
commªds
 > 0 
th’


980 
£lf
:
	`”rÜ
("unknowÀcommªd '%s'%s", 
Çme
, 
	$g‘_t
(
£lf
.
commªds
, 
Çme
))

982 
£lf
:
	`”rÜ
("too many‡rguments")

983 
’d


985  
commªd


986 
’d


987 
’d


989 
funùiÚ
 
P¬£S‹
:
	$švoke
(
İtiÚ
, 
Çme
)

990 
£lf
:
	$şo£
()

992 
£lf
.
–em’t_to_mu‹xes
[
İtiÚ
.
–em’t
] 
th’


993 
_
, 
mu‹x
 
š
 
	$aœs
(
£lf
.
–em’t_to_mu‹xes
[
İtiÚ
.
–em’t
]) do

994 
loÿl
 
u£d_İtiÚ
 = 
£lf
.
mu‹x_to_u£d_İtiÚ
[
mu‹x
]

996 
u£d_İtiÚ
 
ªd
 u£d_İtiÚ ~ğ
İtiÚ
 
th’


997 
£lf
:
	`”rÜ
("İtiÚ '%s' cª‚Ù bu£dog‘h” w™h %s", 
Çme
, 
u£d_İtiÚ
.name)

999 
£lf
.
mu‹x_to_u£d_İtiÚ
[
mu‹x
] = 
İtiÚ


1000 
’d


1001 
’d


1002 
’d


1004 
İtiÚ
:
	$švoke
(
Çme
è
th’


1005 
£lf
.
İtiÚ
 = option

1006 
’d


1007 
’d


1009 
funùiÚ
 
P¬£S‹
:
	$·ss
(
¬g
)

1010 
£lf
.
İtiÚ
 
th’


1011 
nÙ
 
£lf
.
İtiÚ
:
	$·ss
(
¬g
è
th’


1012 
£lf
.
İtiÚ
 = 
n


1013 
’d


1014 
–£if
 
£lf
.
¬gum’t
 
th’


1015 
nÙ
 
£lf
.
¬gum’t
:
	$·ss
(
¬g
è
th’


1016 
£lf
.
¬gum’t_i
 = self.argument_i + 1

1017 
£lf
.
¬gum’t
 = s–f.
¬gum’ts
[£lf.
¬gum’t_i
]

1018 
’d


1020 
loÿl
 
commªd
 = 
£lf
:
	$g‘_commªd
(
¬g
)

1021 
£lf
.
»suÉ
[
commªd
.
_rg‘
 
Ü
 commªd.
_Çme
] = 
Œue


1023 
£lf
.
·r£r
.
_commªd_rg‘
 
th’


1024 
£lf
.
»suÉ
[£lf.
·r£r
.
_commªd_rg‘
] = 
commªd
.
_Çme


1025 
’d


1027 
£lf
:
commªd
)

1028 
’d


1029 
’d


1031 
funùiÚ
 
P¬£S‹
:
	$şo£
()

1032 
£lf
.
İtiÚ
 
th’


1033 
£lf
.
İtiÚ
:
	$şo£
()

1034 
£lf
.
İtiÚ
 = 
n


1035 
’d


1036 
’d


1038 
funùiÚ
 
P¬£S‹
:
	$fš®ize
()

1039 
£lf
:
	$şo£
()

1041 
i
 = 
£lf
.
¬gum’t_i
, #£lf.
¬gum’ts
 do

1042 
loÿl
 
¬gum’t
 = 
£lf
.
¬gum’ts
[
i
]

1043 #¬gum’t.
¬gs
 =ğ0 
ªd
 
¬gum’t
:("u"è
th’


1044 
¬gum’t
:
	$com¶‘e_švoÿtiÚ
()

1046 
¬gum’t
:
	$şo£
()

1047 
’d


1048 
’d


1050 
£lf
.
·r£r
.
_»quœe_commªd
 
ªd
 #£lf.
commªds
 > 0 
th’


1051 
£lf
:
	`”rÜ
("a command is„equired")

1052 
’d


1054 
_
, 
İtiÚ
 
š
 
	$aœs
(
£lf
.
İtiÚs
) do

1055 
loÿl
 
Çme
 = 
İtiÚ
.Çm
	`Ü
 ("İtiÚ '%s'"):
	$fÜm©
(
İtiÚ
.
–em’t
.
_Çme
)

1057 
İtiÚ
.
švoÿtiÚs
 =ğ0 
th’


1058 
İtiÚ
:("u"è
th’


1059 
İtiÚ
:
	$švoke
(
Çme
)

1060 
İtiÚ
:
	$com¶‘e_švoÿtiÚ
()

1061 
İtiÚ
:
	$şo£
()

1062 
’d


1063 
’d


1065 
loÿl
 
mšcouÁ
 = 
İtiÚ
.
–em’t
.
_mšcouÁ


1067 
İtiÚ
.
švoÿtiÚs
 < 
mšcouÁ
 
th’


1068 
İtiÚ
:("a"è
th’


1069 
İtiÚ
.
švoÿtiÚs
 < 
mšcouÁ
 do

1070 
İtiÚ
:
	$švoke
(
Çme
)

1071 
İtiÚ
:
	$şo£
()

1072 
’d


1073 
–£if
 
İtiÚ
.
švoÿtiÚs
 =ğ0 
th’


1074 
£lf
:
	`”rÜ
("missšg %s", 
Çme
)

1076 
£lf
:
	`”rÜ
("% mu¡ bu£d %s", 
Çme
, 
	`bound
("time", 
mšcouÁ
, 
İtiÚ
.
–em’t
.
_maxcouÁ
))

1077 
’d


1078 
’d


1079 
’d


1081 
i
 = #£lf.
commªd_aùiÚs
, 1, -1 do

1082 
£lf
.
commªd_aùiÚs
[
i
].
	$aùiÚ
(
£lf
.
»suÉ
, s–f.
commªd_aùiÚs
[
i
].
Çme
)

1083 
’d


1084 
’d


1086 
funùiÚ
 
P¬£S‹
:
	$·r£
(
¬gs
)

1087 
_
, 
¬g
 
š
 
	$aœs
(
¬gs
) do

1088 
loÿl
 
¶aš
 = 
Œue


1090 
£lf
.
hªdË_İtiÚs
 
th’


1091 
loÿl
 
fœ¡
 = 
¬g
:
	$sub
(1, 1)

1093 
£lf
.
ch¬£t
[
fœ¡
] 
th’


1094 #¬g > 1 
th’


1095 
¶aš
 = 
çl£


1097 
¬g
:
	`sub
(2, 2è=ğ
fœ¡
 
th’


1098 #¬g =ğ2 
th’


1099 
£lf
:
	$şo£
()

1100 
£lf
.
hªdË_İtiÚs
 = 
çl£


1102 
loÿl
 
equ®s
 = 
¬g
:
fšd
 "="

1103 
equ®s
 
th’


1104 
loÿl
 
Çme
 = 
¬g
:
	`sub
(1, 
equ®s
 - 1)

1105 
loÿl
 
İtiÚ
 = 
£lf
:
	$g‘_İtiÚ
(
Çme
)

1107 
İtiÚ
.
–em’t
.
_max¬gs
 <ğ0 
th’


1108 
£lf
:
	`”rÜ
("İtiÚ '%s' dÛ nÙak¬gum’ts", 
Çme
)

1109 
’d


1111 
£lf
:
	$švoke
(
İtiÚ
, 
Çme
)

1112 
£lf
:
	`·ss
(
¬g
:
	`sub
(
equ®s
 + 1))

1114 
loÿl
 
İtiÚ
 = 
£lf
:
	$g‘_İtiÚ
(
¬g
)

1115 
£lf
:
	$švoke
(
İtiÚ
, 
¬g
)

1116 
’d


1117 
’d


1119 
i
 = 2, #arg do

1120 
loÿl
 
Çme
 = 
fœ¡
 .. 
¬g
:
	$sub
(
i
, i)

1121 
loÿl
 
İtiÚ
 = 
£lf
:
	$g‘_İtiÚ
(
Çme
)

1122 
£lf
:
	$švoke
(
İtiÚ
, 
Çme
)

1124 
i
 ~ğ#¬g 
ªd
 
İtiÚ
.
–em’t
.
_max¬gs
 > 0 
th’


1125 
£lf
:
	`·ss
(
¬g
:
	`sub
(
i
 + 1))

1127 
’d


1128 
’d


1129 
’d


1130 
’d


1131 
’d


1132 
’d


1134 
¶aš
 
th’


1135 
£lf
:
	$·ss
(
¬g
)

1136 
’d


1137 
’d


1139 
£lf
:
	$fš®ize
()

1140  
£lf
.
»suÉ


1141 
’d


1143 
funùiÚ
 
P¬£r
:
	$”rÜ
(
msg
)

1144 
io
.
¡d”r
:
	`wr™e
(("%s\n\nE¼Ü: %s\n"):
	`fÜm©
(
£lf
:
	`g‘_u§ge
(), 
msg
))

1145 
os
.
	$ex™
(1)

1146 
’d


1148 -- 
Com·tib™y
 
w™h
 
¡riù
.
lua
 
ªd
 
Ùh”
 
check”s
:

1149 
loÿl
 
deçuÉ_cmdlše
 = 
	`¿wg‘
(
_G
, "¬g"è
Ü
 {
	}
}

1151 
funùiÚ
 
	gP¬£r
:
	$_·r£
(
¬gs
, 
”rÜ_hªdËr
)

1152  
	$P¬£S‹
(
£lf
, 
”rÜ_hªdËr
):
	$·r£
(
¬gs
 
Ü
 
£lf
.
deçuÉ_¬gs
 o¸
deçuÉ_cmdlše
)

1153 
’d


1155 
loÿl
 
funùiÚ
 
	$nÜm®izeArgs
(...)

1156 
loÿl
 
¬gs
 = ...

1157 
¬gs
 
ªd
 
	`ty³
×rgsè~ğ"bË" 
th’


1158 
¬gs
 = {...
	}
}

1159 -- 
undo
 
libmoÚ
 
´e
-
·rsšg
 
of
 
numb”s


1160 
i
, 
v
 
š
 
	$aœs
(
¬gs
) do

1161 
¬gs
[
i
] = 
	$to¡ršg
(
v
)

1162 
’d


1163 
’d


1164  
¬gs


1165 
’d


1167 
funùiÚ
 
P¬£r
:
	$¬gs
(...)

1168 
£lf
.
deçuÉ_¬gs
 = 
	$nÜm®izeArgs
(...)

1169 
’d


1171 
funùiÚ
 
P¬£r
:
	$·r£
(...)

1172  
£lf
:
	`_·r£
(
	`nÜm®izeArgs
(...), s–f.
”rÜ
)

1173 
’d


1175 
loÿl
 
funùiÚ
 
	$xpÿÎ_”rÜ_hªdËr
(
”r
)

1176  
	`to¡ršg
(
”r
è.. "\nÜigš® " .. 
debug
.
	`Œaûback
("", 2):
	$sub
(2)

1177 
’d


1179 
funùiÚ
 
P¬£r
:
	$µ¬£
(...)

1180 
loÿl
 
·r£_”rÜ


1181 
loÿl
 
¬gs
 = 
	$nÜm®izeArgs
(...)

1182 
loÿl
 
ok
, 
»suÉ
 = 
	`xpÿÎ
(
	$funùiÚ
()

1183  
£lf
:
	`_·r£
(
¬gs
, 
	$funùiÚ
(
_
, 
”r
)

1184 
·r£_”rÜ
 = 
”r


1185 
	$”rÜ
(
”r
, 0)

1186 
’d
)

1187 
’d
, 
xpÿÎ_”rÜ_hªdËr
)

1189 
ok
 
th’


1190  
Œue
, 
»suÉ


1191 
–£if
 
nÙ
 
·r£_”rÜ
 
th’


1192 
	$”rÜ
(
»suÉ
, 0)

1194  
çl£
, 
·r£_”rÜ


1195 
’d


1196 
’d


1198  
	$funùiÚ
(...)

1199  
	$P¬£r
(
deçuÉ_cmdlše
[0]):
	`add_h–p
(
Œue
)(...)

1200 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/luaunit.lua

2 
luaun™
.
lua


4 
DesütiÚ
: 
A
 
un™
 
‹¡šg
 
äamewÜk


5 
Hom•age
: 
h‰ps
:

6 
Dev–İm’t
 
by
 
Ph³
 
F»my
 <
ph
@
ä“hack”s
.
Üg
>

7 
Ba£d
 
Ú
 
š™Ÿl
 
wÜk
 
of
 
Ryu
, 
Gwªg
 (
h‰p
:

8 
Liûn£
: 
BSD
 Liûn£, 
£e
 
LICENSE
.
txt


9 
V”siÚ
: 3.0

12 
loÿl
 
M
={}

14 -- 
´iv©e
 
expÜ‹d
 
	$funùiÚs
 (
‹¡šg
)

15 
M
.
´iv©e
 = {
	}
}

17 
M
.
VERSION
='3.1'

19 --[[ 
Some
 
³İË
 
like
 
	$as£¹Equ®s
Ğ
aùu®
, 
ex³ùed
 ) 
ªd
 
some
 
³İË
 
´eãr


20 
	`as£¹Equ®s
Ğ
ex³ùed
, 
aùu®
 ).

22 
M
.
ORDER_ACTUAL_EXPECTED
 = 
Œue


23 
M
.
PRINT_TABLE_REF_IN_ERROR_MSG
 = 
çl£


24 
M
.
LINE_LENGTH
=80

26 -- 
£t
 
this
 
to
 
çl£
Ø
debug
 
luaun™


27 
loÿl
 
STRIP_LUAUNIT_FROM_STACKTRACE
=
Œue


29 
M
.
VERBOSITY_DEFAULT
 = 10

30 
M
.
VERBOSITY_LOW
 = 1

31 
M
.
VERBOSITY_QUIET
 = 0

32 
M
.
VERBOSITY_VERBOSE
 = 20

34 -- 
£t
 
EXPORT_ASSERT_TO_GLOBALS
 
to
 
have
 
®l
 
as£¹s
 
visibË
 
as
 
glob®
 
v®ues


35 -- 
EXPORT_ASSERT_TO_GLOBALS
 = 
Œue


37 -- 
we
 
Ãed
 
to
 
k“p
 
a
 
cİy
 
of
 
the
 
süt
 
¬gs
 
befÜe
 
™
 
is
 
ov”rid’


38 
loÿl
 
cmdlše_¬gv
 = 
	`¿wg‘
(
_G
, "arg")

40 
M
.
USAGE
=[[
U§ge
: 
lua
 <
your_‹¡_su™e
.lua> [
İtiÚs
] [
‹¡Çme1
 [
‹¡Çme2
] ... ]

41 
O±iÚs
:

42 -
h
, --
h–p
: 
Pršt
 
this
 help

43 --
v”siÚ
: 
Pršt
 v”siÚ 
šfÜm©iÚ


44 -
v
, --
v”bo£
: 
Inü—£
 
v”bos™y


45 -
q
, --
qu›t
: 
S‘
 
v”bos™y
 
to
 
mšimum


46 -
o
, --
ouut
 
OUTPUT
: 
S‘
 ouuˆ
ty³
 
to
 OUTPUT

47 
PossibË
 
v®ues
: 
‹xt
, 
p
, 
jun™
, 
n


48 -
n
, --
Çme
 
NAME
: 
FÜ
 
jun™
 
Úly
, 
mªd©Üy
‚am
of
 
xml
 
fe


49 -
p
, --
·‰”n
 
PATTERN
: 
Execu‹
 
®l
 
‹¡
 
Çmes
 
m©chšg
 
the
 
lua
 PATTERN

50 
May
 
be
 
»³©ed
 
to
 
šşude
 
£v”®s
 
·‰”ns


51 
Make
 
su»
 
you
 
e§³
 
magic
 
ch¬s
 
like
 +? 
w™h
 %

52 
‹¡Çme1
, 
‹¡Çme2
, ... : 
‹¡s
 
to
 
run
 
š
 
the
 
fÜm
 
of
 
‹¡FunùiÚ
,

53 
Te¡CÏss
 
Ü
 Te¡CÏss.
‹¡M‘hod


58 -- 
g’”®
 
ut™y
 
funùiÚs


62 
loÿl
 
funùiÚ
 
	$__g’SÜ‹dIndex
Ğ
t
 )

63 
loÿl
 
sÜ‹dIndexSŒ
 = {
	}
}

64 
loÿl
 
sÜ‹dIndexIÁ
 = {}

65 
loÿl
 
sÜ‹dIndex
 = {}

66 
key
,
_
 
š
 
	$·œs
(
t
) do

67 
	`ty³
(
key
è=ğ'¡ršg' 
th’


68 
bË
.
	$š£¹
Ğ
sÜ‹dIndexSŒ
, 
key
 )

70 
bË
.
	$š£¹
Ğ
sÜ‹dIndexIÁ
, 
key
 )

71 
’d


72 
’d


73 
bË
.
	$sÜt
Ğ
sÜ‹dIndexIÁ
 )

74 
bË
.
	$sÜt
Ğ
sÜ‹dIndexSŒ
 )

75 
_
,
v®ue
 
š
 
	$aœs
(
sÜ‹dIndexIÁ
) do

76 
bË
.
	$š£¹
Ğ
sÜ‹dIndex
, 
v®ue
 )

77 
’d


78 
_
,
v®ue
 
š
 
	$aœs
(
sÜ‹dIndexSŒ
) do

79 
bË
.
	$š£¹
Ğ
sÜ‹dIndex
, 
v®ue
 )

80 
’d


81  
sÜ‹dIndex


82 
’d


83 
M
.
´iv©e
.
__g’SÜ‹dIndex
 = __genSortedIndex

85 -- 
CÚšs
 
the
 
keys
 
of
h
bË
 
bešg
 
™”©ed
, 
®»ady
 
sÜ‹d


86 -- 
ªd
 
the
 
Ï¡
 
šdex
 
th©
 
has
 
b“n
 
™”©ed


87 -- 
Exam¶e
:

88 -- 
t
 
a
 
bË
 
Ú
 
which
 
we
 
™”©e


89 -- 
sÜ‹dNextCache
[ 
t
 ].
idx
 
is
 
the
 
sÜ‹d
 
šdex
 
of
h
bË


90 -- 
sÜ‹dNextCache
[ 
t
 ].
Ï¡Idx
 
is
 
the
 
Ï¡
 
šdex
 
u£d
 
š
h
sÜ‹d
 index

91 
loÿl
 
sÜ‹dNextCache
 = {
	}
}

93 
loÿl
 
funùiÚ
 
sÜ‹dNext
(
t
, 
¡©e
)

94 -- 
Equiv®’t
 
of
 
the
 
	$Ãxt
(è
funùiÚ
 
of
 
bË
 
™”©iÚ
, 
but
 
»tuºs
 
the


95 -- 
keys
 
š
 
the
 
®phab‘ic
 
Üd”
. 
We
 
u£
 
a
 
‹mpÜ¬y
 
sÜ‹d
 
key
 
bË
 
th©


96 -- 
is
 
¡Üed
 
š
 
a
 
glob®
 
v¬ŸbË
. 
We
 
®so
 
¡Üe
 
the
 
Ï¡
 
šdex


97 -- 
u£d
 
š
 
the
 
™”©iÚ
 
to
 
fšd
h
Ãxt
 
Úe
 
quickly


99 --
	`´št
("sÜ‹dNext: s‹ = "..
	$to¡ršg
(
¡©e
) )

100 
loÿl
 
key


101 
¡©e
 =ğ
n
 
th’


102 -- 
the
 
fœ¡
 
time
, 
g’”©e
h
šdex


103 -- 
ş—nup
 
the
 
´evious
 
šdex
, 
ju¡
 
š
 ...

104 
sÜ‹dNextCache
[ 
t
 ] = 
n


105 
sÜ‹dNextCache
[ 
t
 ] = { 
idx
=
	`__g’SÜ‹dIndex
Ğˆ), 
Ï¡Idx
=1 
	}
}

106 
key
 = 
sÜ‹dNextCache
[
t
].
idx
[1]

107  
key
, 
t
[key]

108 
’d


110 -- 
nÜm®ly
, 
the
 
´evious
 
šdex
 
š
h
Üd”edTabË
 
is
 
th”e
:

111 
loÿl
 
Ï¡Index
 = 
sÜ‹dNextCache
[ 
t
 ].
Ï¡Idx


112 
sÜ‹dNextCache
[
t
].
idx
[
Ï¡Index
] =ğ
¡©e
 
th’


113 
key
 = 
sÜ‹dNextCache
[
t
].
idx
[
Ï¡Index
+1]

114 
sÜ‹dNextCache
[ 
t
 ].
Ï¡Idx
 = 
Ï¡Index
+1

116 -- 
¡¿nge
, 
we
 
have
 
to
 
fšd
 
the
 
Ãxt
 
v®ue
 
by
 
our£lves


117 
key
 = 
n


118 
i
 = 1,#sÜ‹dNextCache[
t
] do

119 
sÜ‹dNextCache
[
t
].
idx
[
i
] =ğ
¡©e
 
th’


120 
key
 = 
sÜ‹dNextCache
[
t
].
idx
[
i
+1]

121 
sÜ‹dNextCache
[ 
t
 ].
Ï¡Idx
 = 
i
+1

123 
’d


124 
’d


125 
’d


127 
key
 
th’


128  
key
, 
t
[key]

129 
’d


131 -- 
no
 
mÜe
 
v®ue
 
to
 , 
ş—nup


132 
sÜ‹dNextCache
[
t
] = 
n


134 
’d


135 
M
.
´iv©e
.
sÜ‹dNext
 = sortedNext

137 
loÿl
 
funùiÚ
 
sÜ‹dPaœs
(
t
)

138 -- 
Equiv®’t
 
of
 
the
 
	$·œs
(è
funùiÚ
 
Ú
 
bËs
. 
AÎows
 
to
 
™”©e


139 -- 
š
 
sÜ‹d
 
Üd”
. 
This
 
wÜks
 
Úly
 
the
 
key
 
ty³s
 
¬e
 
®l
h
§me


140 -- 
ªd
 
suµÜt
 
com·risÚ


141  
sÜ‹dNext
, 
t
, 
n


142 
’d


144 
loÿl
 
funùiÚ
 
	`¡r¥l™
(
d–im™”
, 
‹xt
)

145 -- 
S¶™
 
‹xt
 
što
 
a
 
li¡
 
cÚsi¡šg
 
of
 
the
 
¡ršgs
 
š
ext,

146 -- 
£·¿‹d
 
by
 
¡ršgs
 
m©chšg
 
	`d–im™”
 (
which
 
may
 
be
 
a
 
·‰”n
).

147 -- 
exam¶e
: 
	`¡r¥l™
(",%s*", "Anna, Bob, Charlie,Dolores")

148 
loÿl
 
li¡
 = {
	}
}

149 
loÿl
 
pos
 = 1

150 
¡ršg
.
fšd
("", 
d–im™”
, 1, 
Œue
è
th’
 -- 
this
 
would
 
»suÉ
 
š
 
’dËss
 
loİs


151 
”rÜ
("delimiter matchesƒmpty string!")

152 
’d


154 
loÿl
 
fœ¡
, 
Ï¡
 = 
¡ršg
.
	$fšd
(
‹xt
, 
d–im™”
, 
pos
, 
Œue
)

155 
fœ¡
 
th’
 -- 
found
?

156 
bË
.
	`š£¹
(
li¡
, 
¡ršg
.
	`sub
(
‹xt
, 
pos
, 
fœ¡
-1))

157 
pos
 = 
Ï¡
+1

159 
bË
.
	`š£¹
(
li¡
, 
¡ršg
.
	$sub
(
‹xt
, 
pos
))

161 
’d


162 
’d


163  
li¡


164 
’d


165 
M
.
´iv©e
.
¡r¥l™
 = strsplit

167 
loÿl
 
funùiÚ
 
	`hasNewLše
Ğ
s
 )

168 --  
Œue
 
s
 
has
 
a
 
Ãwlše


169  (
¡ršg
.
	`fšd
(
s
, '\n', 1, 
Œue
è~ğ
n
)

170 
’d


171 
M
.
´iv©e
.
hasNewLše
 = hasNewLine

173 
loÿl
 
funùiÚ
 
	`´efixSŒšg
Ğ
´efix
, 
s
 )

174 -- 
P»fix
 
®l
 
the
 
lšes
 
of
 
s
 
w™h
 
´efix


175 
loÿl
 
t
 = 
	`¡r¥l™
('\n', 
s
)

176  
´efix
..
bË
.
	`cÚÿt
(
t
, '\n'..prefix)

177 
’d


178 
M
.
´iv©e
.
´efixSŒšg
 =…refixString

180 
loÿl
 
funùiÚ
 
	`¡rM©ch
(
s
, 
·‰”n
, 
¡¬t
, 
fš®
 )

181 --  
Œue
 
s
 
m©ches
 
com¶‘–y
 
the
 
·‰”n
 
äom
 
šdex
 
¡¬t
 
to
 index 
’d


182 --  
çl£
 
š
 
ev”y
 
Ùh”
 
ÿ£s


183 -- 
¡¬t
 
is
 
n
, 
m©ches
 
äom
 
the
 
begšnšg
 
of
h
¡ršg


184 -- 
’d
 
is
 
n
, 
m©ches
 
to
 
the
ƒnd 
of
h
¡ršg


185 
¡¬t
 = s¹ 
Ü
 1

186 
fš®
 = fš® 
Ü
 
¡ršg
.
	$Ën
(
s
)

188 
loÿl
 
foundS¹
, 
foundEnd
 = 
¡ršg
.
	$fšd
(
s
, 
·‰”n
, 
¡¬t
, 
çl£
)

189 
foundS¹
 
ªd
 foundS¹ =ğ
¡¬t
‡nd 
foundEnd
 =ğ
fš®
 
th’


190  
Œue


191 
’d


192  
çl£
 -- 
no
 
m©ch


193 
’d


194 
M
.
´iv©e
.
¡rM©ch
 = strMatch

196 
loÿl
 
funùiÚ
 
	`xmlEsÿ³
Ğ
s
 )

197 -- 
R‘uº
 
s
 
esÿ³d
 
XML
 
©Œibu‹s


198 -- 
esÿ³s
 
bË
:

201 -- < &
É
;

202 -- > &
gt
;

203 -- & &
amp
;

205  
¡ršg
.
	`gsub
Ğ
s
, '.', {

211 
	}
} )

212 
’d


213 
M
.
´iv©e
.
xmlEsÿ³
 = xmlEscape

215 
loÿl
 
funùiÚ
 
xmlCD©aEsÿ³
Ğ
s
 )

216 -- 
R‘uº
 
s
 
esÿ³d
 
CD©a
 
£ùiÚ


217 -- 
esÿ³s
: "]]>"

218  
¡ršg
.
gsub
Ğ
s
, ']]>', ']]&gt;' )

219 
’d


220 
M
.
´iv©e
.
xmlCD©aEsÿ³
 = xmlCDataEscape

222 
loÿl
 
·‰”nLuaun™T¿û
='(.*[/\\]luaunit%.lua:%d+: .*)'

223 
loÿl
 
funùiÚ
 
isLuaun™IÁ”ÇlLše
Ğ
s
 )

224 --  
Œue
 
lše
 
of
 
¡ack
 
Œaû
 
comes
 
äom
 
šside
 
luaun™


225 -- 
´št
Ğ'M©chšg fÜ†uaun™: '..
s
 )

226 
loÿl
 
m©chS¹
, 
m©chEnd
, 
ÿ±u»
 = 
¡ršg
.
	$fšd
Ğ
s
, 
·‰”nLuaun™T¿û
 )

227 
m©chS¹
 
th’


228 -- 
	`´št
('Match†uaunit†ine')

229  
Œue


230 
’d


231  
çl£


232 
’d


234 
loÿl
 
funùiÚ
 
	`¡rLuaun™T¿û
Ğ
¡ackT¿û
 )

236 -- 
Exam¶e
 
of
 
a
 
Œaûback
:

237 <<
¡ack
 
Œaûback
:

238 
exam¶e_w™h_luaun™
.
lua
:130: 
š
 
funùiÚ
 'test2_withFailure'

239 ./
luaun™
.
lua
:1449: 
š
 
funùiÚ
 <./luaunit.lua:1449>

240 [
C
]: 
š
 
funùiÚ
 'xpcall'

241 ./
luaun™
.
lua
:1449: 
š
 
funùiÚ
 'protectedCall'

242 ./
luaun™
.
lua
:1508: 
š
 
funùiÚ
 'execOneFunction'

243 ./
luaun™
.
lua
:1596: 
š
 
funùiÚ
 'runSuiteByInstances'

244 ./
luaun™
.
lua
:1660: 
š
 
funùiÚ
 'runSuiteByNames'

245 ./
luaun™
.
lua
:1736: 
š
 
funùiÚ
 'runSuite'

246 
exam¶e_w™h_luaun™
.
lua
:140: 
š
 
maš
 
chunk


247 [
C
]: 
š
 ?>>

249 
Oth”
 
exam¶e
:

250 <<
¡ack
 
Œaûback
:

251 ./
luaun™
.
lua
:545: 
š
 
funùiÚ
 'assertEquals'

252 
exam¶e_w™h_luaun™
.
lua
:58: 
š
 
funùiÚ
 'TestToto.test7'

253 ./
luaun™
.
lua
:1517: 
š
 
funùiÚ
 <./luaunit.lua:1517>

254 [
C
]: 
š
 
funùiÚ
 'xpcall'

255 ./
luaun™
.
lua
:1517: 
š
 
funùiÚ
 'protectedCall'

256 ./
luaun™
.
lua
:1578: 
š
 
funùiÚ
 'execOneFunction'

257 ./
luaun™
.
lua
:1677: 
š
 
funùiÚ
 'runSuiteByInstances'

258 ./
luaun™
.
lua
:1730: 
š
 
funùiÚ
 'runSuiteByNames'

259 ./
luaun™
.
lua
:1806: 
š
 
funùiÚ
 'runSuite'

260 
exam¶e_w™h_luaun™
.
lua
:140: 
š
 
maš
 
chunk


261 [
C
]: 
š
 ?>>

263 <<
¡ack
 
Œaûback
:

264 
luaun™2
/
exam¶e_w™h_luaun™
.
lua
:124: 
š
 
funùiÚ
 'test1_withFailure'

265 
luaun™2
/
luaun™
.
lua
:1532: 
š
 
funùiÚ
 <luaunit2/luaunit.lua:1532>

266 [
C
]: 
š
 
funùiÚ
 'xpcall'

267 
luaun™2
/
luaun™
.
lua
:1532: 
š
 
funùiÚ
 'protectedCall'

268 
luaun™2
/
luaun™
.
lua
:1591: 
š
 
funùiÚ
 'execOneFunction'

269 
luaun™2
/
luaun™
.
lua
:1679: 
š
 
funùiÚ
 'runSuiteByInstances'

270 
luaun™2
/
luaun™
.
lua
:1743: 
š
 
funùiÚ
 'runSuiteByNames'

271 
luaun™2
/
luaun™
.
lua
:1819: 
š
 
funùiÚ
 'runSuite'

272 
luaun™2
/
exam¶e_w™h_luaun™
.
lua
:140: 
š
 
maš
 
chunk


273 [
C
]: 
š
 ?>>

276 -- 
fœ¡
 
lše
 
is
 "¡ack¿ûback": 
KEEP


277 -- 
Ãxt
 
lše
 
may
 
be
 
luaun™
†še: 
REMOVE


278 -- 
Ãxt
 
lšes
 
¬e
 
ÿÎ
 
š
 
the
 
´og¿m
 
und”
 
‹¡Ok
: 
REMOVE


279 -- 
Ãxt
 
lšes
 
¬e
 
ÿÎs
 
äom
 
luaun™
 
to
 
ÿÎ
 
the
 
´og¿m
 
und”
 
‹¡
: 
KEEP


281 -- 
SŒ©egy
:

282 -- 
k“p
 
fœ¡
 
lše


283 -- 
»move
 
lšes
 
th©
 
¬e
 
·¹
 
of
 
luaun™


284 -- 
k•p
 
lšes
 
uÁ
 
we
 
h™
 
a
 
luaun™
 
lše


287 -- 
	`´št
Ğ'<<'..
¡ackT¿û
..'>>' )

289 
loÿl
 
t
 = 
	`¡r¥l™
Ğ'\n', 
¡ackT¿û
 )

290 -- 
	`´št
Ğ
	$´‘ty¡r
(
t
) )

292 
loÿl
 
idx
=2

294 -- 
»move
 
lšes
 
th©
 
¬e
 
¡l
 
·¹
 
of
 
luaun™


295 
idx
 <= #t do

296 
	$isLuaun™IÁ”ÇlLše
Ğ
t
[
idx
] ) 
th’


297 -- 
	`´št
('Removšg : '..
t
[
idx
] )

298 
bË
.
	$»move
(
t
, 
idx
)

301 
’d


302 
’d


304 -- 
k“p
 
lšes
 
uÁ
 
we
 
h™
 
luaun™
 
agaš


305 
idx
 <ğ#tè
	`ªd
 (
nÙ
 
	$isLuaun™IÁ”ÇlLše
(
t
[
idx
])) do

306 -- 
	`´št
('K“pšg : '..
t
[
idx
] )

307 
idx
 = idx+1

308 
’d


310 -- 
»move
 
»maššg
 
luaun™
 
lšes


311 
idx
 <= #t do

312 -- 
	`´št
('Removšg : '..
t
[
idx
] )

313 
bË
.
	$»move
(
t
, 
idx
)

314 
’d


316 -- 
	`´št
Ğ
	$´‘ty¡r
(
t
) )

317  
bË
.
	`cÚÿt
Ğ
t
, '\n')

319 
’d


320 
M
.
´iv©e
.
¡rLuaun™T¿û
 = stripLuaunitTrace

323 
funùiÚ
 
bË
.
	`keyto¡ršg
(
k
)

324 -- 
like
 
´‘ty¡r
 
but
 dØ
nÙ
 
’şo£
 
w™h
 "" 
the
 
¡ršg
 
is
 
ju¡
 
®phªum”iÿl


325 -- 
this
 
is
 
b‘‹r
 
di¥Ïyšg
 
bË
 
keys
 
who
 
¬e
 
oá’
 
sim¶e
 
¡ršgs


326 "¡ršg" =ğ
	$ty³
Ğ
k
 ) 
ªd
 
¡ršg
.
	`m©ch
Ğk, "^[_%a][_%a%d]*$" ) 
th’


327  
k


329  
M
.
	$´‘ty¡r
(
k
)

330 
’d


331 
’d


333 
funùiÚ
 
bË
.
	$to¡ršg
Ğ
tbl
, 
šd’tLev–
, 
´štTabËRefs
, 
»cursiÚTabË
 )

334 
´štTabËRefs
 =…rštTabËRef 
Ü
 
M
.
PRINT_TABLE_REF_IN_ERROR_MSG


335 
»cursiÚTabË
 =„ecursiÚTabË 
Ü
 {
	}
}

336 
»cursiÚTabË
[
tbl
] = 
Œue


338 
loÿl
 
»suÉ
, 
dÚe
 = {}, {}

339 
loÿl
 
di¥OnMuÉLšes
 = 
çl£


341 
k
, 
v
 
š
 
	$aœs
Ğ
tbl
 ) do

342 
»cursiÚTabË
[
v
] 
th’


343 -- 
»cursiÚ
 
d‘eùed
!

344 
»cursiÚTabË
['»cursiÚD‘eùed'] = 
Œue


345 
bË
.
	`š£¹
Ğ
»suÉ
, "<"..
	`to¡ršg
(
v
)..">" )

347 
bË
.
	`š£¹
Ğ
»suÉ
, 
M
.
´iv©e
.
	`´‘ty¡r_sub
Ğ
v
, 
šd’tLev–
+1, 
çl£
, 
´štTabËRefs
, 
»cursiÚTabË
 ) )

348 
’d


350 
dÚe
[ 
k
 ] = 
Œue


351 
’d


353 
k
, 
v
 
š
 
	$sÜ‹dPaœs
Ğ
tbl
 ) do

354 
nÙ
 
dÚe
[ 
k
 ] 
th’


355 
»cursiÚTabË
[
v
] 
th’


356 -- 
»cursiÚ
 
d‘eùed
!

357 
»cursiÚTabË
['»cursiÚD‘eùed'] = 
Œue


358 
bË
.
	`š£¹
Ğ
»suÉ
,abË.
	`keyto¡ršg
Ğ
k
 ) .. "=" .. "<"..
	`to¡ršg
(
v
)..">" )

360 
bË
.
	`š£¹
Ğ
»suÉ
,

361 
bË
.
	`keyto¡ršg
Ğ
k
 ) .. "=" .. 
M
.
´iv©e
.
	`´‘ty¡r_sub
Ğ
v
, 
šd’tLev–
+1, 
Œue
, 
´štTabËRefs
, 
»cursiÚTabË
 ) )

362 
’d


363 
’d


364 
’d


365 
´štTabËRefs
 
th’


366 
bË_»f
 = "<"..
	`to¡ršg
(
tbl
).."> "

368 
bË_»f
 = ''

369 
’d


371 
loÿl
 
SEP_LENGTH
=2 -- ", "

372 
loÿl
 
tÙ®L’gth
 = 0

373 
k
, 
v
 
š
 
	$aœs
Ğ
»suÉ
 ) do

374 
l
 = 
¡ršg
.
	$Ën
Ğ
v
 )

375 
tÙ®L’gth
 =Ù®L’gth + 
l


376 
l
 > 
M
.
LINE_LENGTH
-1 
th’


377 
di¥OnMuÉLšes
 = 
Œue


378 
’d


379 
’d


380 -- 
adju¡
 
w™h
 
Ëngth
 
of
 
£·¿tÜ


381 
tÙ®L’gth
 =Ù®L’gth + 
SEP_LENGTH
 * 
m©h
.
	`max
Ğ0, #»suÉ-1è+ 2 -- 
two
 
™ems
 
Ãed
 1 
£p
, 
th“
 i‹m twØ
£ps
 + 
Ën
 
of
 '{}'

382 
tÙ®L’gth
 > 
M
.
LINE_LENGTH
-1 
th’


383 
di¥OnMuÉLšes
 = 
Œue


384 
’d


386 
di¥OnMuÉLšes
 
th’


387 
šd’tSŒšg
 = 
¡ršg
.
	`»p
(" ", 
šd’tLev–
)

388 
şosšgInd’tSŒšg
 = 
¡ršg
.
	`»p
(" ", 
m©h
.
	`max
(0, 
šd’tLev–
-1) )

389 
»suÉ_¡r
 = 
bË_»f
.."{\n"..
šd’tSŒšg
 .. 
bË
.
	`cÚÿt
Ğ
»suÉ
, ",\n"..šd’tSŒšg ) .. "\n"..
şosšgInd’tSŒšg
.."}"

391 
»suÉ_¡r
 = 
bË_»f
.."{".. 
bË
.
	`cÚÿt
Ğ
»suÉ
, ", " ) .. "}"

392 
’d


393  
»suÉ_¡r


394 
’d


396 
loÿl
 
funùiÚ
 
	`´‘ty¡r
Ğ
v
, 
k“pÚ–še
 )

397 --[[ 
B‘‹r
 
¡ršg
 
cÚv”siÚ
, 
to
 
di¥Ïy
 
niû
 
v¬ŸbË
 
cÚ‹Á
:

398 
FÜ
 
¡ršgs
, 
k“pÚ–še
 
is
 
£t
 
to
 
Œue
, 
¡ršg
 i 
di¥Ïyed
 
Ú
 
Úe
 
lše
, 
w™h
 
visibË
 \
n


399 * 
¡ršg
 
¬e
 
’şo£d
 
w™h
 " by default, or with ' if string contains‡ "

400 * 
bË
 
is
 
a
 
şass
, 
di¥Ïy
 cÏs 
Çme


401 * 
bËs
 
¬e
 
ex·nded


403 
loÿl
 
»cursiÚTabË
 = {
	}
}

404 
loÿl
 
s
 = 
M
.
´iv©e
.
	$´‘ty¡r_sub
(
v
, 1, 
k“pÚ–še
, 
M
.
PRINT_TABLE_REF_IN_ERROR_MSG
, 
»cursiÚTabË
)

405 
»cursiÚTabË
['»cursiÚD‘eùed'] =ğ
Œue
 
ªd
 
M
.
PRINT_TABLE_REF_IN_ERROR_MSG
 =ğ
çl£
 
th’


406 -- 
some
 
bË
 
cÚš
 
»cursive
 
»ã»nûs
,

407 -- 
so
 
we
 
mu¡
 
»compu‹
 
the
 
v®ue
 
by
 
šşudšg
 
®l
 
bË
 
»ã»nûs


408 -- 
the
 
»suÉ
 
looks
 
like
 
ü­


409 
»cursiÚTabË
 = {
	}
}

410 
s
 = 
M
.
´iv©e
.
	$´‘ty¡r_sub
(
v
, 1, 
k“pÚ–še
, 
Œue
, 
»cursiÚTabË
)

411 
’d


412  
s


413 
’d


414 
M
.
´‘ty¡r
 =…rettystr

416 
loÿl
 
funùiÚ
 
	$´‘ty¡r_sub
(
v
, 
šd’tLev–
, 
k“pÚ–še
, 
´štTabËRefs
, 
»cursiÚTabË
 )

417 "¡ršg" =ğ
	$ty³
Ğ
v
 ) 
th’


418 
k“pÚ–še
 
th’


419 
v
 = 
¡ršg
.
	`gsub
( v, "\n", "\\n" )

420 
’d


422 -- 
u£
 
şev”
 
d–im™”s
 
accÜdšg
 
to
 
cÚ‹Á
:

423 -- 
¡ršg
 
cÚšs
 ",ƒnclose with '

424 -- 
¡ršg
 
cÚšs
 ',ƒnclose with "

425 
¡ršg
.
	`m©ch
Ğ¡ršg.
	`gsub
(
v
,"[^'\"]",""), '^"+$' ) 
th’


426  "'" .. 
v
 .. "'"

427 
’d


428  '"' .. 
¡ršg
.
	`gsub
(
v
,'"', '\\"' ) .. '"'

429 
’d


430 
	`ty³
(
v
è=ğ'bË' 
th’


431 --
v
.
__şass__
 
th’


432 --  
¡ršg
.
	`gsub
Ğ
	`to¡ršg
(
v
), 'bË', v.
__şass__
 )

433 --
’d


434  
bË
.
	$to¡ršg
(
v
, 
šd’tLev–
, 
´štTabËRefs
, 
»cursiÚTabË
)

435 
’d


436  
	$to¡ršg
(
v
)

437 
’d


438 
M
.
´iv©e
.
´‘ty¡r_sub
 =…rettystr_sub

440 
loÿl
 
funùiÚ
 
	$_bË_cÚšs
(
t
, 
–em’t
)

441 
t
 
th’


442 
_
, 
v®ue
 
š
 
	$·œs
(
t
) do

443 
	`ty³
(
v®ue
è=ğ
	$ty³
(
–em’t
è
th’


444 
	`ty³
(
–em’t
è=ğ'bË' 
th’


445 -- 
we
 
wª‹d
 
»cursive
 
™ems
 
cÚ‹Á
 
com·risÚ
, w
could
 
u£


446 -- 
	$_is_bË_™ems_equ®s
(
v
, 
ex³ùed
è
but
 
Úe
 
Ëv–
 
of
 
ju¡
 
com·ršg


447 -- 
™ems
 
is
 
suffic›Á


448 
M
.
´iv©e
.
	$_is_bË_equ®s
Ğ
v®ue
, 
–em’t
 ) 
th’


449  
Œue


450 
’d


452 
v®ue
 =ğ
–em’t
 
th’


453  
Œue


454 
’d


455 
’d


456 
’d


457 
’d


458 
’d


459  
çl£


460 
’d


462 
loÿl
 
funùiÚ
 
	$_is_bË_™ems_equ®s
(
aùu®
, 
ex³ùed
 )

463 ià(
	`ty³
(
aùu®
è=ğ'bË'è
	`ªd
 (ty³(
ex³ùed
è=ğ'bË'è
th’


464 
k
,
v
 
š
 
	$·œs
(
aùu®
) do

465 
nÙ
 
	$_bË_cÚšs
(
ex³ùed
, 
v
è
th’


466  
çl£


467 
’d


468 
’d


469 
k
,
v
 
š
 
	$·œs
(
ex³ùed
) do

470 
nÙ
 
	$_bË_cÚšs
(
aùu®
, 
v
è
th’


471  
çl£


472 
’d


473 
’d


474  
Œue


475 
–£if
 
	`ty³
(
aùu®
è~ğ
	$ty³
(
ex³ùed
è
th’


476  
çl£


477 
–£if
 
aùu®
 =ğ
ex³ùed
 
th’


478  
Œue


479 
’d


480  
çl£


481 
’d


483 
loÿl
 
funùiÚ
 
	$_is_bË_equ®s
(
aùu®
, 
ex³ùed
)

484 ià(
	`ty³
(
aùu®
è=ğ'bË'è
	`ªd
 (ty³(
ex³ùed
è=ğ'bË'è
th’


485 ià(#aùu® ~ğ#ex³ùedè
th’


486  
çl£


487 
’d


488 
loÿl
 
k
,
v


489 
k
,
v
 
š
 
	$·œs
(
aùu®
) do

490 
nÙ
 
	$_is_bË_equ®s
(
v
, 
ex³ùed
[
k
]è
th’


491  
çl£


492 
’d


493 
’d


494 
k
,
v
 
š
 
	$·œs
(
ex³ùed
) do

495 
nÙ
 
	$_is_bË_equ®s
(
v
, 
aùu®
[
k
]è
th’


496  
çl£


497 
’d


498 
’d


499  
Œue


500 
–£if
 
	`ty³
(
aùu®
è~ğ
	$ty³
(
ex³ùed
è
th’


501  
çl£


502 
–£if
 
aùu®
 =ğ
ex³ùed
 
th’


503  
Œue


504 
’d


505  
çl£


506 
’d


507 
M
.
´iv©e
.
_is_bË_equ®s
 = _is_table_equals

511 -- 
as£¹iÚs


515 
loÿl
 
funùiÚ
 
	$”rÜMsgEqu®™y
(
aùu®
, 
ex³ùed
)

516 
loÿl
 
”rÜMsg


517 
nÙ
 
M
.
ORDER_ACTUAL_EXPECTED
 
th’


518 
ex³ùed
, 
aùu®
 =‡ctual,ƒxpected

519 
’d


520 
loÿl
 
ex³ùedSŒ
 = 
	$´‘ty¡r
(
ex³ùed
)

521 
loÿl
 
aùu®SŒ
 = 
	$´‘ty¡r
(
aùu®
)

522 
	`ty³
(
ex³ùed
è=ğ'¡ršg' 
Ü
y³Óx³ùedè=ğ'bË' 
th’


523 
	$hasNewLše
Ğ
ex³ùedSŒ
..
aùu®SŒ
 ) 
th’


524 
ex³ùedSŒ
 = '\n'..expectedStr

525 
aùu®SŒ
 = '\n'..actualStr

526 
’d


527 
”rÜMsg
 = "ex³ùed: "..
ex³ùedSŒ
.."\n"..

528 "aùu®: "..
aùu®SŒ


530 
”rÜMsg
 = "ex³ùed: "..
ex³ùedSŒ
..",‡ùu®: "..
aùu®SŒ


531 
’d


532  
”rÜMsg


533 
’d


535 
funùiÚ
 
M
.
	`as£¹E¼Ü
(
f
, ...)

536 -- 
as£¹
 
th©
 
ÿÎšg
 
f
 
w™h
 
the
 
¬gum’ts
 
wl
 
¿i£
 
ª
 
”rÜ


537 -- 
exam¶e
: 
	`as£¹E¼Ü
Ğ
f
, 1, 2 ) => 
	$f
(1,2è
should
 
g’”©e
 
ª
 
”rÜ


538 
loÿl
 
no_”rÜ
, 
”rÜ_msg
 = 
	$pÿÎ
Ğ
f
, ... )

539 
nÙ
 
no_”rÜ
 
th’
  
’d


540 
	`”rÜ
( "Expected‡nƒrror when calling function but‚oƒrror generated", 2 )

541 
’d


543 
funùiÚ
 
M
.
	$as£¹True
(
v®ue
)

544 
nÙ
 
v®ue
 
th’


545 
	`”rÜ
("ex³ùed:rue,‡ùu®: " ..
	`´‘ty¡r
(
v®ue
), 2)

546 
’d


547 
’d


549 
funùiÚ
 
M
.
	$as£¹F®£
(
v®ue
)

550 
v®ue
 
th’


551 
	`”rÜ
("ex³ùed: f®£,‡ùu®: " ..
	`´‘ty¡r
(
v®ue
), 2)

552 
’d


553 
’d


555 
funùiÚ
 
M
.
	$as£¹N
(
v®ue
)

556 
v®ue
 ~ğ
n
 
th’


557 
	`”rÜ
("ex³ùed:‚,‡ùu®: " ..
	`´‘ty¡r
(
v®ue
), 2)

558 
’d


559 
’d


561 
funùiÚ
 
M
.
	$as£¹NÙN
(
v®ue
)

562 
v®ue
 =ğ
n
 
th’


563 
	`”rÜ
("expected‚on‚il value,„eceived‚il", 2)

564 
’d


565 
’d


567 
funùiÚ
 
M
.
	$as£¹Equ®s
(
aùu®
, 
ex³ùed
)

568 
	`ty³
(
aùu®
è=ğ'bË' 
ªd
y³(
ex³ùed
è=ğ'bË' 
th’


569 
nÙ
 
	$_is_bË_equ®s
(
aùu®
, 
ex³ùed
è
th’


570 
	`”rÜ
Ğ
	`”rÜMsgEqu®™y
(
aùu®
, 
ex³ùed
), 2 )

571 
’d


572 
–£if
 
	`ty³
(
aùu®
è~ğ
	$ty³
(
ex³ùed
è
th’


573 
	`”rÜ
Ğ
	`”rÜMsgEqu®™y
(
aùu®
, 
ex³ùed
), 2 )

574 
–£if
 
aùu®
 ~ğ
ex³ùed
 
th’


575 
	`”rÜ
Ğ
	`”rÜMsgEqu®™y
(
aùu®
, 
ex³ùed
), 2 )

576 
’d


577 
’d


579 
funùiÚ
 
M
.
	`as£¹Almo¡Equ®s
Ğ
aùu®
, 
ex³ùed
, 
m¬gš
 )

580 -- 
check
 
th©
 
two
 
æßts
 
¬e
 
şo£
 
by
 
m¬gš


581 
	`ty³
(
aùu®
è~ğ'numb”' 
Ü
y³(
ex³ùed
è~ğ'numb”' o¸ty³(
m¬gš
è~ğ'numb”' 
th’


582 
	`”rÜ
('as£¹Almo¡Equ®s: mu¡ suµly oÆy‚umb”‡rgum’ts.\nArgum’t suµl›d: '..
aùu®
..', '..
ex³ùed
..', '..
m¬gš
, 2)

583 
’d


584 
m¬gš
 < 0 
th’


585 
	`”rÜ
Ğ'as£¹Almo¡Equ®s: m¬gš mu¡ bpos™ive, cu¼’ˆv®ui '..
m¬gš
, 2)

586 
’d


588 
nÙ
 
M
.
ORDER_ACTUAL_EXPECTED
 
th’


589 
ex³ùed
, 
aùu®
 =‡ctual,ƒxpected

590 
’d


592 -- 
h–p
 
lua
 
š
 
lim™
 
ÿ£s
 
like
 
	`as£¹Almo¡Equ®s
( 1.1, 1.0, 0.1)

593 -- 
which
 
by
  
dÛs
 
nÙ
 
wÜk
. 
We
 
Ãed
 
to
 
give
 
m¬gš
 
a
 
sm®l
 
boo¡


594 
loÿl
 
»®m¬gš
 = 
m¬gš
 + 0.00000000001

595 
m©h
.
	`abs
(
ex³ùed
 - 
aùu®
è> 
»®m¬gš
 
th’


596 
	`”rÜ
Ğ'V®ue ¬nÙ‡lmo¡ƒqu®\nEx³ùed: '..
ex³ùed
..' w™h m¬gš oà'..
m¬gš
..',„eûived: '..
aùu®
, 2)

597 
’d


598 
’d


600 
funùiÚ
 
M
.
	$as£¹NÙEqu®s
(
aùu®
, 
ex³ùed
)

601 
	`ty³
(
aùu®
è~ğ
	$ty³
(
ex³ùed
è
th’


603 
’d


605 
loÿl
 
g’E¼Ü
 = 
çl£


606 
	`ty³
(
aùu®
è=ğ'bË' 
ªd
y³(
ex³ùed
è=ğ'bË' 
th’


607 
nÙ
 
	$_is_bË_equ®s
(
aùu®
, 
ex³ùed
è
th’


609 
’d


610 
g’E¼Ü
 = 
Œue


611 
–£if
 
aùu®
 =ğ
ex³ùed
 
th’


612 
g’E¼Ü
 = 
Œue


613 
’d


614 
g’E¼Ü
 
th’


615 
	`”rÜ
Ğ'ReûivedhnÙƒx³ùed v®ue: ' .. 
	`´‘ty¡r
(
aùu®
), 2 )

616 
’d


617 
’d


619 
funùiÚ
 
M
.
	`as£¹NÙAlmo¡Equ®s
Ğ
aùu®
, 
ex³ùed
, 
m¬gš
 )

620 -- 
check
 
th©
 
two
 
æßts
 
¬e
 
nÙ
 
şo£
 
by
 
m¬gš


621 
	`ty³
(
aùu®
è~ğ'numb”' 
Ü
y³(
ex³ùed
è~ğ'numb”' o¸ty³(
m¬gš
è~ğ'numb”' 
th’


622 
	`”rÜ
('as£¹NÙAlmo¡Equ®s: mu¡ suµly oÆy‚umb”‡rgum’ts.\nArgum’t suµl›d: '..
aùu®
..', '..
ex³ùed
..', '..
m¬gš
, 2)

623 
’d


624 
m¬gš
 <ğ0 
th’


625 
	`”rÜ
Ğ'as£¹NÙAlmo¡Equ®s: m¬gš mu¡ bpos™ive, cu¼’ˆv®ui '..
m¬gš
, 2)

626 
’d


628 
nÙ
 
M
.
ORDER_ACTUAL_EXPECTED
 
th’


629 
ex³ùed
, 
aùu®
 =‡ctual,ƒxpected

630 
’d


632 -- 
h–p
 
lua
 
š
 
lim™
 
ÿ£s
 
like
 
	`as£¹Almo¡Equ®s
( 1.1, 1.0, 0.1)

633 -- 
which
 
by
  
dÛs
 
nÙ
 
wÜk
. 
We
 
Ãed
 
to
 
give
 
m¬gš
 
a
 
sm®l
 
boo¡


634 
loÿl
 
»®m¬gš
 = 
m¬gš
 + 0.00000000001

635 
m©h
.
	`abs
(
ex³ùed
 - 
aùu®
è<ğ
»®m¬gš
 
th’


636 
	`”rÜ
Ğ'V®ue ¬®mo¡ƒqu®\nEx³ùed: '..
ex³ùed
..' w™h‡ difã»nû‡bovm¬gš oà'..
m¬gš
..',„eûived: '..
aùu®
, 2)

637 
’d


638 
’d


640 
funùiÚ
 
M
.
	`as£¹SŒCÚšs
Ğ
¡r
, 
sub
, 
u£Re
 )

641 -- 
this
 
»l›s
 
Ú
 
lua
 
¡ršg
.
fšd
 
funùiÚ


642 -- 
a
 
¡ršg
 
®ways
 
cÚšs
 
the
 
em±y
 string

643 
loÿl
 
subTy³


644 
loÿl
 
noU£Re
 = 
nÙ
 
u£Re


645 
¡ršg
.
	`fšd
(
¡r
, 
sub
, 1, 
noU£Re
è=ğ
n
 
th’


646 
noU£Re
 
th’


647 
subTy³
 = 'substring'

649 
subTy³
 = 'regexp'

650 
’d


651 
loÿl
 
subP»‰y
 = 
	$´‘ty¡r
(
sub
)

652 
loÿl
 
¡rP»‰y
 = 
	$´‘ty¡r
(
¡r
)

653 
	$hasNewLše
Ğ
subP»‰y
..
¡rP»‰y
 ) 
th’


654 
subP»‰y
 = '\n'..subPretty..'\n'

655 
¡rP»‰y
 = '\n'..strPretty

656 
’d


657 
	`”rÜ
Ğ'E¼Ü, '..
subTy³
..' '..
subP»‰y
..' wa nÙ found iÀ¡ršg '..
¡rP»‰y
, 2)

658 
’d


659 
’d


661 
funùiÚ
 
M
.
	`as£¹SŒICÚšs
Ğ
¡r
, 
sub
 )

662 -- 
this
 
»l›s
 
Ú
 
lua
 
¡ršg
.
fšd
 
funùiÚ


663 -- 
a
 
¡ršg
 
®ways
 
cÚšs
 
the
 
em±y
 string

664 
loÿl
 
l¡r
, 
lsub
, 
subP»‰y
, 
¡rP»‰y


665 
l¡r
 = 
¡ršg
.
	$low”
(
¡r
)

666 
lsub
 = 
¡ršg
.
	$low”
(
sub
)

667 
¡ršg
.
	`fšd
(
l¡r
, 
lsub
, 1, 
Œue
è=ğ
n
 
th’


668 
subP»‰y
 = 
	$´‘ty¡r
(
sub
)

669 
¡rP»‰y
 = 
	$´‘ty¡r
(
¡r
)

670 
	$hasNewLše
Ğ
subP»‰y
..
¡rP»‰y
 ) 
th’


671 
subP»‰y
 = '\n'..subPretty..'\n'

672 
¡rP»‰y
 = '\n'..strPretty

673 
’d


674 
	`”rÜ
Ğ'E¼Ü, sub¡ršg '..
subP»‰y
..' wa nÙ found (ÿ£ in£ns™iv–yèš sŒšg '..
¡rP»‰y
,2)

675 
’d


676 
’d


678 
funùiÚ
 
M
.
	`as£¹NÙSŒCÚšs
Ğ
¡r
, 
sub
, 
u£Re
 )

679 -- 
this
 
»l›s
 
Ú
 
lua
 
¡ršg
.
fšd
 
funùiÚ


680 -- 
a
 
¡ršg
 
®ways
 
cÚšs
 
the
 
em±y
 string

681 
loÿl
 
sub¡rTy³


682 
loÿl
 
noU£Re
 = 
nÙ
 
u£Re


683 
¡ršg
.
	`fšd
(
¡r
, 
sub
, 1, 
noU£Re
è~ğ
n
 
th’


684 
loÿl
 
sub¡rTy³


685 
noU£Re
 
th’


686 
sub¡rTy³
 = 'substring'

688 
sub¡rTy³
 = 'regexp'

689 
’d


690 
loÿl
 
subP»‰y
 = 
	$´‘ty¡r
(
sub
)

691 
loÿl
 
¡rP»‰y
 = 
	$´‘ty¡r
(
¡r
)

692 
	$hasNewLše
Ğ
subP»‰y
..
¡rP»‰y
 ) 
th’


693 
subP»‰y
 = '\n'..subPretty..'\n'

694 
¡rP»‰y
 = '\n'..strPretty

695 
’d


696 
	`”rÜ
Ğ'E¼Ü, '..
sub¡rTy³
..' '..
subP»‰y
..' wa found iÀ¡ršg '..
¡rP»‰y
,2)

697 
’d


698 
’d


700 
funùiÚ
 
M
.
	`as£¹NÙSŒICÚšs
Ğ
¡r
, 
sub
 )

701 -- 
this
 
»l›s
 
Ú
 
lua
 
¡ršg
.
fšd
 
funùiÚ


702 -- 
a
 
¡ršg
 
®ways
 
cÚšs
 
the
 
em±y
 string

703 
loÿl
 
l¡r
, 
lsub


704 
l¡r
 = 
¡ršg
.
	$low”
(
¡r
)

705 
lsub
 = 
¡ršg
.
	$low”
(
sub
)

706 
¡ršg
.
	`fšd
(
l¡r
, 
lsub
, 1, 
Œue
è~ğ
n
 
th’


707 
loÿl
 
subP»‰y
 = 
	$´‘ty¡r
(
sub
)

708 
loÿl
 
¡rP»‰y
 = 
	$´‘ty¡r
(
¡r
)

709 
	$hasNewLše
Ğ
subP»‰y
..
¡rP»‰y
è
th’


710 
subP»‰y
 = '\n'..subPretty..'\n'

711 
¡rP»‰y
 = '\n'..strPretty

712 
’d


713 
	`”rÜ
Ğ'E¼Ü, sub¡ršg '..
subP»‰y
..' wa found (ÿ£ in£ns™iv–yèš sŒšg '..
¡rP»‰y
,2)

714 
’d


715 
’d


717 
funùiÚ
 
M
.
	`as£¹SŒM©ches
Ğ
¡r
, 
·‰”n
, 
¡¬t
, 
fš®
 )

718 -- 
V”ify
 
a
 
fuÎ
 
m©ch
 
the
 
¡ršg


719 -- 
a
 
·¹Ÿl
 
m©ch
, 
sim¶y
 
u£
 
as£¹SŒCÚšs
 
w™h
 
u£Re
 
£t
 
to
 
Œue


720 
nÙ
 
	$¡rM©ch
Ğ
¡r
, 
·‰”n
, 
¡¬t
, 
fš®
 ) 
th’


721 
loÿl
 
·‰”nP»‰y
 = 
	$´‘ty¡r
(
·‰”n
)

722 
loÿl
 
¡rP»‰y
 = 
	$´‘ty¡r
(
¡r
)

723 
	$hasNewLše
Ğ
·‰”nP»‰y
..
¡rP»‰y
è
th’


724 
·‰”nP»‰y
 = '\n'..patternPretty..'\n'

725 
¡rP»‰y
 = '\n'..strPretty

726 
’d


727 
	`”rÜ
Ğ'E¼Ü,…©‹º '..
·‰”nP»‰y
..' wa nÙ m©ched by sŒšg '..
¡rP»‰y
,2)

728 
’d


729 
’d


731 
funùiÚ
 
M
.
	`as£¹E¼ÜMsgEqu®s
Ğ
ex³ùedMsg
, 
func
, ... )

732 -- 
as£¹
 
th©
 
ÿÎšg
 
f
 
w™h
 
the
 
¬gum’ts
 
wl
 
¿i£
 
ª
 
”rÜ


733 -- 
exam¶e
: 
	`as£¹E¼Ü
Ğ
f
, 1, 2 ) => 
	$f
(1,2è
should
 
g’”©e
 
ª
 
”rÜ


734 
loÿl
 
no_”rÜ
, 
”rÜ_msg
 = 
	$pÿÎ
Ğ
func
, ... )

735 
no_”rÜ
 
th’


736 
	`”rÜ
Ğ'NØ”rÜ g’”©ed wh’ c®lšg funùiÚ buˆex³ùedƒ¼Ü: "'..
ex³ùedMsg
..'"', 2 )

737 
’d


738 
	$nÙ
 (
”rÜ_msg
 =ğ
ex³ùedMsg
è
th’


739 
	$hasNewLše
Ğ
”rÜ_msg
..
ex³ùedMsg
 ) 
th’


740 
ex³ùedMsg
 = '\n'..expectedMsg

741 
”rÜ_msg
 = '\n'..error_msg

742 
’d


743 
	`”rÜ
Ğ'Exaùƒ¼Ü mes§gex³ùed: "'..
ex³ùedMsg
..'"\nE¼Ü mes§g»ûived: "'..
”rÜ_msg
..'"\n',2)

744 
’d


745 
’d


747 
funùiÚ
 
M
.
	`as£¹E¼ÜMsgCÚšs
Ğ
·¹ŸlMsg
, 
func
, ... )

748 -- 
as£¹
 
th©
 
ÿÎšg
 
f
 
w™h
 
the
 
¬gum’ts
 
wl
 
¿i£
 
ª
 
”rÜ


749 -- 
exam¶e
: 
	`as£¹E¼Ü
Ğ
f
, 1, 2 ) => 
	$f
(1,2è
should
 
g’”©e
 
ª
 
”rÜ


750 
loÿl
 
no_”rÜ
, 
”rÜ_msg
 = 
	$pÿÎ
Ğ
func
, ... )

751 
no_”rÜ
 
th’


752 
	`”rÜ
Ğ'NØ”rÜ g’”©ed wh’ c®lšg funùiÚ buˆex³ùedƒ¼Ü cÚššg: '..
	`´‘ty¡r
(
·¹ŸlMsg
), 2 )

753 
’d


754 
nÙ
 
¡ršg
.
	$fšd
Ğ
”rÜ_msg
, 
·¹ŸlMsg
, 
n
, 
Œue
 ) 
th’


755 
loÿl
 
·¹ŸlMsgSŒ
 = 
	$´‘ty¡r
(
·¹ŸlMsg
)

756 
loÿl
 
”rÜMsgSŒ
 = 
	$´‘ty¡r
(
”rÜ_msg
)

757 
	$hasNewLše
(
”rÜ_msg
..
·¹ŸlMsg
è
th’


758 
·¹ŸlMsgSŒ
 = '\n'..partialMsgStr

759 
”rÜMsgSŒ
 = '\n'..errorMsgStr

760 
’d


761 
	`”rÜ
Ğ'E¼Ü mes§gdÛ nÙ cÚš: '..
·¹ŸlMsgSŒ
..'\nE¼Ü mes§g»ûived: '..
”rÜMsgSŒ
..'\n',2)

762 
’d


763 
’d


765 
funùiÚ
 
M
.
	`as£¹E¼ÜMsgM©ches
Ğ
ex³ùedMsg
, 
func
, ... )

766 -- 
as£¹
 
th©
 
ÿÎšg
 
f
 
w™h
 
the
 
¬gum’ts
 
wl
 
¿i£
 
ª
 
”rÜ


767 -- 
exam¶e
: 
	`as£¹E¼Ü
Ğ
f
, 1, 2 ) => 
	$f
(1,2è
should
 
g’”©e
 
ª
 
”rÜ


768 
loÿl
 
no_”rÜ
, 
”rÜ_msg
 = 
	$pÿÎ
Ğ
func
, ... )

769 
no_”rÜ
 
th’


770 
	`”rÜ
Ğ'NØ”rÜ g’”©ed wh’ c®lšg funùiÚ buˆex³ùedƒ¼Ü m©chšg: "'..
ex³ùedMsg
..'"', 2 )

771 
’d


772 
nÙ
 
	$¡rM©ch
Ğ
”rÜ_msg
, 
ex³ùedMsg
 ) 
th’


773 
	$hasNewLše
(
”rÜ_msg
..
ex³ùedMsg
è
th’


774 
ex³ùedMsg
 = '\n'..expectedMsg

775 
”rÜ_msg
 = '\n'..error_msg

776 
’d


777 
	`”rÜ
Ğ'E¼Ü mes§gdÛ nÙ m©ch: "'..
ex³ùedMsg
..'"\nE¼Ü mes§g»ûived: "'..
”rÜ_msg
..'"\n',2)

778 
’d


779 
’d


781 
loÿl
 
funùiÚ
 
	$”rÜMsgTy³Mism©ch
Ğ
ex³ùedTy³
, 
aùu®
 )

782 
loÿl
 
aùu®SŒ
 = 
	$´‘ty¡r
(
aùu®
)

783 
	$hasNewLše
(
aùu®SŒ
è
th’


784 
aùu®SŒ
 = '\n'..actualStr

785 
’d


786  "Ex³ùed:‡ "..
ex³ùedTy³
..' v®ue,‡ùu®:y³ '..
	`ty³
(
aùu®
)..', v®u'..
aùu®SŒ


787 
’d


789 
funùiÚ
 
M
.
	$as£¹IsNumb”
(
v®ue
)

790 
	`ty³
(
v®ue
è~ğ'numb”' 
th’


791 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'numb”', 
v®ue
 ), 2 )

792 
’d


793 
’d


795 
funùiÚ
 
M
.
	$as£¹IsSŒšg
(
v®ue
)

796 
	`ty³
(
v®ue
è~ğ"¡ršg" 
th’


797 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'¡ršg', 
v®ue
 ), 2 )

798 
’d


799 
’d


801 
funùiÚ
 
M
.
	$as£¹IsTabË
(
v®ue
)

802 
	`ty³
(
v®ue
è~ğ'bË' 
th’


803 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'bË', 
v®ue
 ), 2 )

804 
’d


805 
’d


807 
funùiÚ
 
M
.
	$as£¹IsBoŞ—n
(
v®ue
)

808 
	`ty³
(
v®ue
è~ğ'boŞ—n' 
th’


809 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'boŞ—n', 
v®ue
 ), 2 )

810 
’d


811 
’d


813 
funùiÚ
 
M
.
	$as£¹IsN
(
v®ue
)

814 
	`ty³
(
v®ue
è~ğ"n" 
th’


815 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'n', 
v®ue
 ), 2 )

816 
’d


817 
’d


819 
funùiÚ
 
M
.
	$as£¹IsFunùiÚ
(
v®ue
)

820 
	`ty³
(
v®ue
è~ğ'funùiÚ' 
th’


821 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'funùiÚ', 
v®ue
 ), 2 )

822 
’d


823 
’d


825 
funùiÚ
 
M
.
	$as£¹IsU£rd©a
(
v®ue
)

826 
	`ty³
(
v®ue
è~ğ'u£rd©a' 
th’


827 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'u£rd©a', 
v®ue
 ), 2 )

828 
’d


829 
’d


831 
funùiÚ
 
M
.
	$as£¹IsCÜoutše
(
v®ue
)

832 
	`ty³
(
v®ue
è~ğ'th»ad' 
th’


833 
	`”rÜ
Ğ
	`”rÜMsgTy³Mism©ch
Ğ'th»ad', 
v®ue
 ), 2 )

834 
’d


835 
’d


837 
M
.
as£¹IsTh»ad
 = M.
as£¹IsCÜoutše


839 
funùiÚ
 
M
.
	$as£¹Is
(
aùu®
, 
ex³ùed
)

840 
nÙ
 
M
.
ORDER_ACTUAL_EXPECTED
 
th’


841 
aùu®
, 
ex³ùed
 =ƒxpected,‡ctual

842 
’d


843 
aùu®
 ~ğ
ex³ùed
 
th’


844 
loÿl
 
ex³ùedSŒ
 = 
	$´‘ty¡r
(
ex³ùed
)

845 
loÿl
 
aùu®SŒ
 = 
	$´‘ty¡r
(
aùu®
)

846 
	$hasNewLše
(
ex³ùedSŒ
..
aùu®SŒ
è
th’


847 
ex³ùedSŒ
 = '\n'..expectedStr..'\n'

848 
aùu®SŒ
 = '\n'..actualStr

850 
ex³ùedSŒ
 =ƒxpectedStr..', '

851 
’d


852 
	`”rÜ
Ğ'Ex³ùed objeù‡nd‡ùu® objeù‡»‚Ùh§me\nEx³ùed: '..
ex³ùedSŒ
..'aùu®: '..
aùu®SŒ
, 2)

853 
’d


854 
’d


856 
funùiÚ
 
M
.
	$as£¹NÙIs
(
aùu®
, 
ex³ùed
)

857 
nÙ
 
M
.
ORDER_ACTUAL_EXPECTED
 
th’


858 
aùu®
, 
ex³ùed
 =ƒxpected,‡ctual

859 
’d


860 
aùu®
 =ğ
ex³ùed
 
th’


861 
loÿl
 
ex³ùedSŒ
 = 
	$´‘ty¡r
(
ex³ùed
)

862 
	$hasNewLše
(
ex³ùedSŒ
è
th’


863 
ex³ùedSŒ
 = '\n'..expectedStr

864 
’d


865 
	`”rÜ
Ğ'Ex³ùed objeù‡nd‡ùu® objeù‡»h§mobjeù: '..
ex³ùedSŒ
, 2 )

866 
’d


867 
’d


869 
funùiÚ
 
M
.
	`as£¹I‹msEqu®s
(
aùu®
, 
ex³ùed
)

870 -- 
checks
 
th©
 
the
 
™ems
 
of
 
bË
 
ex³ùed


871 -- 
¬e
 
cÚšed
 
š
 
bË
 
aùu®
. 
W¬nšg
, 
this
 
funùiÚ


872 -- 
is
 
©
 
Ëa¡
 
	`O
(
n
^2)

873 
nÙ
 
	$_is_bË_™ems_equ®s
(
aùu®
, 
ex³ùed
 ) 
th’


874 
loÿl
 
ex³ùedSŒ
 = 
	$´‘ty¡r
(
ex³ùed
)

875 
loÿl
 
aùu®SŒ
 = 
	$´‘ty¡r
(
aùu®
)

876 
	$hasNewLše
(
ex³ùedSŒ
..
aùu®SŒ
è
th’


877 
ex³ùedSŒ
 = '\n'..expectedStr

878 
aùu®SŒ
 = '\n'..actualStr

879 
’d


880 
	`”rÜ
Ğ'CÚ‹Á oàthbË ¬nÙ id’tiÿl:\nEx³ùed: '..
ex³ùedSŒ
..'\nAùu®: '..
aùu®SŒ
, 2 )

881 
’d


882 
’d


884 
M
.
as£¹_equ®s
 = M.
as£¹Equ®s


885 
M
.
as£¹_nÙ_equ®s
 = M.
as£¹NÙEqu®s


886 
M
.
as£¹_”rÜ
 = M.
as£¹E¼Ü


887 
M
.
as£¹_Œue
 = M.
as£¹True


888 
M
.
as£¹_çl£
 = M.
as£¹F®£


889 
M
.
as£¹_is_numb”
 = M.
as£¹IsNumb”


890 
M
.
as£¹_is_¡ršg
 = M.
as£¹IsSŒšg


891 
M
.
as£¹_is_bË
 = M.
as£¹IsTabË


892 
M
.
as£¹_is_boŞ—n
 = M.
as£¹IsBoŞ—n


893 
M
.
as£¹_is_n
 = M.
as£¹IsN


894 
M
.
as£¹_is_funùiÚ
 = M.
as£¹IsFunùiÚ


895 
M
.
as£¹_is
 = M.
as£¹Is


896 
M
.
as£¹_nÙ_is
 = M.
as£¹NÙIs


899 
EXPORT_ASSERT_TO_GLOBALS
 
th’


900 
as£¹E¼Ü
 = 
M
.assertError

901 
as£¹True
 = 
M
.assertTrue

902 
as£¹F®£
 = 
M
.assertFalse

903 
as£¹N
 = 
M
.assertNil

904 
as£¹NÙN
 = 
M
.assertNotNil

905 
as£¹Equ®s
 = 
M
.assertEquals

906 
as£¹Almo¡Equ®s
 = 
M
.assertAlmostEquals

907 
as£¹NÙEqu®s
 = 
M
.assertNotEquals

908 
as£¹NÙAlmo¡Equ®s
 = 
M
.assertNotAlmostEquals

909 
as£¹SŒCÚšs
 = 
M
.assertStrContains

910 
as£¹SŒICÚšs
 = 
M
.assertStrIContains

911 
as£¹NÙSŒCÚšs
 = 
M
.assertNotStrContains

912 
as£¹NÙSŒICÚšs
 = 
M
.assertNotStrIContains

913 
as£¹SŒM©ches
 = 
M
.assertStrMatches

914 
as£¹E¼ÜMsgEqu®s
 = 
M
.assertErrorMsgEquals

915 
as£¹E¼ÜMsgCÚšs
 = 
M
.assertErrorMsgContains

916 
as£¹E¼ÜMsgM©ches
 = 
M
.assertErrorMsgMatches

917 
as£¹IsNumb”
 = 
M
.assertIsNumber

918 
as£¹IsSŒšg
 = 
M
.assertIsString

919 
as£¹IsTabË
 = 
M
.assertIsTable

920 
as£¹IsBoŞ—n
 = 
M
.assertIsBoolean

921 
as£¹IsN
 = 
M
.assertIsNil

922 
as£¹IsFunùiÚ
 = 
M
.assertIsFunction

923 
as£¹IsU£rd©a
 = 
M
.assertIsUserdata

924 
as£¹IsCÜoutše
 = 
M
.assertIsCoroutine

925 
as£¹Is
 = 
M
.assertIs

926 
as£¹NÙIs
 = 
M
.assertNotIs

927 
as£¹I‹msEqu®s
 = 
M
.assertItemsEquals

928 -- 
®Ÿ£s


929 
as£¹_equ®s
 = 
M
.
as£¹Equ®s


930 
as£¹_nÙ_equ®s
 = 
M
.
as£¹NÙEqu®s


931 
as£¹_”rÜ
 = 
M
.
as£¹E¼Ü


932 
as£¹_Œue
 = 
M
.
as£¹True


933 
as£¹_çl£
 = 
M
.
as£¹F®£


934 
as£¹_is_numb”
 = 
M
.
as£¹IsNumb”


935 
as£¹_is_¡ršg
 = 
M
.
as£¹IsSŒšg


936 
as£¹_is_bË
 = 
M
.
as£¹IsTabË


937 
as£¹_is_boŞ—n
 = 
M
.
as£¹IsBoŞ—n


938 
as£¹_is_n
 = 
M
.
as£¹IsN


939 
as£¹_is_funùiÚ
 = 
M
.
as£¹IsFunùiÚ


940 
as£¹_is
 = 
M
.
as£¹Is


941 
as£¹_nÙ_is
 = 
M
.
as£¹NÙIs


942 
’d


946 -- 
Ouu‰”s


951 -- 
şass
 
T­Ouut


954 
loÿl
 
T­Ouut
 = { -- 
şass


955 
__şass__
 = 'TapOutput',

956 
ruÂ”
 = 
n
,

957 
»suÉ
 = 
n
,

958 
	}
}

959 
loÿl
 
T­Ouut_MT
 = { 
__šdex
 = 
T­Ouut
 }

961 -- 
FÜ
 
a
 
good
 
»ã»nû
 
TAP
 
fÜm©
, 
check
: 
h‰p
:

963 
funùiÚ
 
T­Ouut
:
	$Ãw
()

964 
loÿl
 
t
 = {
	}
}

965 
t
.
v”bos™y
 = 
M
.
VERBOSITY_LOW


966 
	$£tm‘©abË
Ğ
t
, 
T­Ouut_MT
 )

967  
t


968 
’d


969 
funùiÚ
 
T­Ouut
:
	$¡¬tSu™e
()

970 
	`´št
("1.."..
£lf
.
»suÉ
.
‹¡CouÁ
)

971 
	`´št
('# S¹ed oÀ'..
£lf
.
»suÉ
.
¡¬tD©e
)

972 
’d


973 
funùiÚ
 
T­Ouut
:
	$¡¬tCÏss
(
şassName
)

974 
şassName
 ~ğ'[Te¡FunùiÚs]' 
th’


975 
	`´št
('# S¹šg cÏss: '..
şassName
)

976 
’d


977 
’d


978 
funùiÚ
 
T­Ouut
:
	$¡¬tTe¡
(
‹¡Name
è
’d


980 
funùiÚ
 
T­Ouut
:
	$addFau»
Ğ
”rÜMsg
, 
¡ackT¿û
 )

981 
	`´št
(
¡ršg
.
	`fÜm©
("nÙ ok %d\t%s", 
£lf
.
»suÉ
.
cu¼’tTe¡Numb”
, s–f.»suÉ.
cu¼’tNode
.
‹¡Name
 ))

982 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_LOW
 
th’


983 
	`´št
Ğ
	`´efixSŒšg
Ğ' ', 
”rÜMsg
 ) )

984 
’d


985 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_DEFAULT
 
th’


986 
	`´št
Ğ
	`´efixSŒšg
Ğ' ', 
¡ackT¿û
 ) )

987 
’d


988 
’d


990 
funùiÚ
 
T­Ouut
:
	$’dTe¡
(
‹¡HasFau»
)

991 
nÙ
 
£lf
.
»suÉ
.
cu¼’tNode
:
	$hasFau»
(è
th’


992 
	`´št
(
¡ršg
.
	`fÜm©
("ok %d\t%s", 
£lf
.
»suÉ
.
cu¼’tTe¡Numb”
, s–f.»suÉ.
cu¼’tNode
.
‹¡Name
 ))

993 
’d


994 
’d


996 
funùiÚ
 
T­Ouut
:
	$’dCÏss
(è
’d


998 
funùiÚ
 
T­Ouut
:
	$’dSu™e
()

999 
loÿl
 
t
 = {
	}
}

1000 
bË
.
š£¹
(
t
, 
¡ršg
.
fÜm©
('# Ran %dests in %0.3f seconds, %d successes, %d failures',

1001 
£lf
.
»suÉ
.
‹¡CouÁ
, s–f.»suÉ.
du¿tiÚ
, s–f.»suÉ.‹¡CouÁ-£lf.»suÉ.
çu»CouÁ
, self.result.failureCount ) )

1002 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 > 0 
th’


1003 
bË
.
š£¹
(
t
, 
¡ršg
.
fÜm©
(", %d‚Ú s–eùede¡s", 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 ) )

1004 
’d


1005 
´št
Ğ
bË
.
	$cÚÿt
(
t
) )

1006  
£lf
.
»suÉ
.
çu»CouÁ


1007 
’d


1010 -- 
şass
 
T­Ouut
 
’d


1013 -- 
şass
 
JUn™Ouut


1016 -- 
S“
 
dœeùÜy
 
jun™xml
 
mÜe
 
šfÜm©iÚ
 
about
 
the
 
jun™
 
fÜm©


1017 
loÿl
 
JUn™Ouut
 = { -- 
şass


1018 
__şass__
 = 'JUnitOutput',

1019 
ruÂ”
 = 
n
,

1020 
»suÉ
 = 
n
,

1021 
	}
}

1022 
loÿl
 
JUn™Ouut_MT
 = { 
__šdex
 = 
JUn™Ouut
 }

1024 
funùiÚ
 
JUn™Ouut
:
	$Ãw
()

1025 
loÿl
 
t
 = {
	}
}

1026 
t
.
‹¡Li¡
 = {}

1027 
t
.
v”bos™y
 = 
M
.
VERBOSITY_LOW


1028 
t
.
fd
 = 
n


1029 
t
.
âame
 = 
n


1030 
	$£tm‘©abË
Ğ
t
, 
JUn™Ouut_MT
 )

1031  
t


1032 
’d


1033 
funùiÚ
 
JUn™Ouut
:
	`¡¬tSu™e
()

1035 -- 
İ’
 
xml
 
fe
 
—¾y
 
to
 
d—l
 
w™h
 
”rÜs


1036 
£lf
.
âame
 =ğ
n
 
th’


1037 
	`”rÜ
('With Junit,‡n output filename must be supplied with --name!')

1038 
’d


1039 
¡ršg
.
	`sub
(
£lf
.
âame
,-4è~ğ'.xml' 
th’


1040 
£lf
.
âame
 = self.fname..'.xml'

1041 
’d


1042 
£lf
.
fd
 = 
io
.
	`İ’
(£lf.
âame
, "w")

1043 
£lf
.
fd
 =ğ
n
 
th’


1044 
	`”rÜ
("Could‚Ù o³ÀffÜ wr™šg: "..
£lf
.
âame
)

1045 
’d


1047 
	`´št
('# XML ouuˆtØ'..
£lf
.
âame
)

1048 
	`´št
('# S¹ed oÀ'..
£lf
.
»suÉ
.
¡¬tD©e
)

1049 
’d


1050 
funùiÚ
 
JUn™Ouut
:
	$¡¬tCÏss
(
şassName
)

1051 
şassName
 ~ğ'[Te¡FunùiÚs]' 
th’


1052 
	`´št
('# S¹šg cÏss: '..
şassName
)

1053 
’d


1054 
’d


1055 
funùiÚ
 
JUn™Ouut
:
	$¡¬tTe¡
(
‹¡Name
)

1056 
	`´št
('# S¹šge¡: '..
‹¡Name
)

1057 
’d


1059 
funùiÚ
 
JUn™Ouut
:
	$addFau»
Ğ
”rÜMsg
, 
¡ackT¿û
 )

1060 
	`´št
('# Fau»: '..
”rÜMsg
)

1061 -- 
	`´št
('# '..
¡ackT¿û
)

1062 
’d


1064 
funùiÚ
 
JUn™Ouut
:
	$’dTe¡
(
‹¡HasFau»
)

1065 
’d


1067 
funùiÚ
 
JUn™Ouut
:
	$’dCÏss
()

1068 
’d


1070 
funùiÚ
 
JUn™Ouut
:
	$’dSu™e
()

1071 
loÿl
 
t
 = {
	}
}

1072 
bË
.
š£¹
(
t
, 
¡ršg
.
fÜm©
('# Ran %dests in %0.3f seconds, %d successes, %d failures',

1073 
£lf
.
»suÉ
.
‹¡CouÁ
, s–f.»suÉ.
du¿tiÚ
, s–f.»suÉ.‹¡CouÁ-£lf.»suÉ.
çu»CouÁ
, self.result.failureCount ) )

1074 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 > 0 
th’


1075 
bË
.
š£¹
(
t
, 
¡ršg
.
fÜm©
(", %d‚Ú s–eùede¡s", 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 ) )

1076 
’d


1077 
´št
Ğ
bË
.
cÚÿt
(
t
) )

1079 -- 
XML
 
fe
 
wr™šg


1080 
£lf
.
fd
:
wr™e
('<?xml version="1.0"ƒncoding="UTF-8" ?>\n')

1081 
£lf
.
fd
:
wr™e
('<testsuites>\n')

1082 
£lf
.
fd
:
wr™e
(
¡ršg
.
fÜm©
(

1084 
£lf
.
»suÉ
.
‹¡CouÁ
, s–f.»suÉ.
¡¬tIsod©e
, s–f.»suÉ.
du¿tiÚ
, s–f.»suÉ.
çu»CouÁ
 ))

1085 
£lf
.
fd
:
wr™e
(" <properties>\n")

1086 
£lf
.
fd
:
wr™e
(
¡ršg
.
fÜm©
(' <´İ”ty‚ame="Lu¨V”siÚ" v®ue="%s"/>\n', 
_VERSION
 ) )

1087 
£lf
.
fd
:
wr™e
(
¡ršg
.
fÜm©
(' <´İ”ty‚ame="LuaUn™ V”siÚ" v®ue="%s"/>\n', 
M
.
VERSION
) )

1088 -- 
XXX
 
¶—£
 
šşude
 
sy¡em
 
Çme
 
ªd
 
v”siÚ
 
possibË


1089 
£lf
.
fd
:
wr™e
(" </properties>\n")

1091 
i
,
node
 
š
 
	$aœs
(
£lf
.
»suÉ
.
‹¡s
) do

1092 
£lf
.
fd
:
	`wr™e
(
¡ršg
.
	`fÜm©
(' <testcase classname="%s"‚ame="%s"ime="%0.3f">\n',

1093 
node
.
şassName
,‚ode.
‹¡Name
,‚ode.
du¿tiÚ
 ) )

1094 
node
.
¡©us
 ~ğ
M
.
NodeStus
.
PASS
 
th’


1095 
£lf
.
fd
:
	`wr™e
(' <çu»y³="' ..
	`xmlEsÿ³
(
node
.
msg
) .. '">\n')

1096 
£lf
.
fd
:
	`wr™e
(' <![CDATA[' ..
	`xmlCD©aEsÿ³
(
node
.
¡ackT¿û
) .. ']]></failure>\n')

1097 
’d


1098 
£lf
.
fd
:
	`wr™e
(' </testcase>\n')

1100 
’d


1102 -- 
Next
 
to
 
lšes
 
¬e
 
N“ded
Ø
v®id©e
 
jun™
 
ANT
 
xsd
 
but
 
»®ly
 
nÙ
 
u£ful
 
š
 
g’”®
:

1103 
£lf
.
fd
:
	`wr™e
(' <system-out/>\n')

1104 
£lf
.
fd
:
	`wr™e
(' <system-err/>\n')

1106 
£lf
.
fd
:
	`wr™e
(' </testsuite>\n')

1107 
£lf
.
fd
:
	`wr™e
('</testsuites>\n')

1108 
£lf
.
fd
:
	$şo£
()

1109  
£lf
.
»suÉ
.
çu»CouÁ


1110 
’d


1113 -- 
şass
 
T­Ouut
 
’d


1116 -- 
şass
 
TextOuut


1121 -- 
PythÚ
 
NÚ
 
v”bo£
:

1123 
FÜ
 
—ch
 
‹¡
: . 
Ü
 
F
 o¸
E


1125 
If
 
some
 
çed
 
‹¡s
:

1127 
ERROR
 / 
FAILURE
: 
	`Te¡Name
 (
‹¡fe
.
‹¡şass
)

1129 
Sck
 
Œaû


1132 
th’
 --------------

1133 
th’
 "Ran xests in 0.000s"

1134 
th’
 
OK
 
Ü
 
	`FAILED
 (
çu»s
=1, 
”rÜ
=1)

1136 -- 
PythÚ
 
V”bo£
:

1137 
	`‹¡Çme
 (
f’ame
.
şas¢ame
è... 
ok


1138 
	`‹¡Çme
 (
f’ame
.
şas¢ame
è... 
FAIL


1139 
	`‹¡Çme
 (
f’ame
.
şas¢ame
è... 
ERROR


1141 
th’
 --------------

1142 
th’
 "Ran xests in 0.000s"

1143 
th’
 
OK
 
Ü
 
	`FAILED
 (
çu»s
=1, 
”rÜ
=1)

1145 -- 
Ruby
:

1146 
S¹ed


1148 
Fšished
 
š
 0.002695 
£cÚds
.

1150 1 
‹¡s
, 2 
as£¹iÚs
, 0 
çu»s
, 0 
”rÜs


1152 -- 
Ruby
:

1153 >> 
ruby
 
tc_sim¶e_numb”2
.
rb


1154 
Lßded
 
su™e
 
tc_sim¶e_numb”2


1155 
S¹ed


1156 
F
..

1157 
Fšished
 
š
 0.038617 
£cÚds
.

1159 1è
Fau»
:

1160 
	`‹¡_çu»
(
Te¡Sim¶eNumb”
è[
tc_sim¶e_numb”2
.
rb
:16]:

1161 
Addšg
 
dÛ¢
't work.

1162 <3> 
ex³ùed
 
but
 
was


1165 3 
‹¡s
, 4 
as£¹iÚs
, 1 
çu»s
, 0 
”rÜs


1167 -- 
Java
 
Jun™


1168 .......
F
.

1169 
Time
: 0,003

1170 
Th”e
 
was
 1 
çu»
:

1171 1è
	$‹¡C­ac™y
(
jun™
.
§m¶es
.
VeùÜTe¡
)jun™.
äamewÜk
.
As£¹iÚFaedE¼Ü


1172 
©
 
jun™
.
§m¶es
.
VeùÜTe¡
.
	$‹¡C­ac™y
(
VeùÜTe¡
.
java
:87)

1173 
©
 
sun
.
»æeù
.
N©iveM‘hodAcûssÜIm¶
.
	$švoke0
(
N©ive
 
M‘hod
)

1174 
©
 
sun
.
»æeù
.
N©iveM‘hodAcûssÜIm¶
.
	$švoke
(
N©iveM‘hodAcûssÜIm¶
.
java
:62)

1175 
©
 
sun
.
»æeù
.
D–eg©šgM‘hodAcûssÜIm¶
.
	$švoke
(
D–eg©šgM‘hodAcûssÜIm¶
.
java
:43)

1177 
FAILURES
!!!

1178 
Te¡s
 
run
: 8, 
Fau»s
: 1, 
E¼Üs
: 0

1181 -- 
Mav’


1183 #mvÀ
‹¡


1185 
T
 
E
 
S
 T S

1187 
RuÂšg
 
m©h
.
Add™iÚTe¡


1188 
Te¡s
 
run
: 2, 
Fau»s
: 1, 
E¼Üs
: 0, 
Sk³d
: 0, 
Time
 
–­£d
:

1189 0.03 
£c
 <<< 
FAILURE
!

1191 
ResuÉs
 :

1193 
Faed
 
‹¡s
:

1194 
	$‹¡LœeSymbŞe
(
m©h
.
Add™iÚTe¡
)

1196 
Te¡s
 
run
: 2, 
Fau»s
: 1, 
E¼Üs
: 0, 
Sk³d
: 0

1199 -- 
LuaUn™


1200 ---- 
nÚ
 
v”bo£


1201 * 
di¥Ïy
 . 
Ü
 
F
 o¸
E
 
wh’
 
ruÂšg
 
‹¡s


1202 ---- 
v”bo£


1203 * 
di¥Ïy
 
‹¡
 
Çme
 + 
ok
/
ç


1205 * 
bÏnk
 
lše


1206 * 
numb”
è
ERROR
 
Ü
 
FAILURE
: 
Te¡Name


1207 
Sck
 
Œaû


1208 * 
bÏnk
 
lše


1209 * 
numb”
è
ERROR
 
Ü
 
FAILURE
: 
Te¡Name


1210 
Sck
 
Œaû


1212 
th’
 --------------

1213 
th’
 "Ran xests in 0.000s (%d‚ot selected, %d skipped)"

1214 
th’
 
OK
 
Ü
 
	`FAILED
 (
çu»s
=1, 
”rÜ
=1)

1219 
loÿl
 
TextOuut
 = { 
__şass__
 = 'TextOuut' 
	}
}

1220 
loÿl
 
	gTextOuut_MT
 = { -- 
şass


1221 
__šdex
 = 
TextOuut


1224 
funùiÚ
 
	gTextOuut
:
	$Ãw
()

1225 
loÿl
 
t
 = {
	}
}

1226 
t
.
ruÂ”
 = 
n


1227 
t
.
»suÉ
 = 
n


1228 
t
.
”rÜLi¡
 ={}

1229 
t
.
v”bos™y
 = 
M
.
VERBOSITY_DEFAULT


1230 
	$£tm‘©abË
Ğ
t
, 
TextOuut_MT
 )

1231  
t


1232 
’d


1234 
funùiÚ
 
TextOuut
:
	$¡¬tSu™e
()

1235 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_DEFAULT
 
th’


1236 
	`´št
Ğ'S¹ed oÀ'.. 
£lf
.
»suÉ
.
¡¬tD©e
 )

1237 
’d


1238 
’d


1240 
funùiÚ
 
TextOuut
:
	`¡¬tCÏss
(
şassName
)

1241 -- 
di¥Ïy
 
nÙhšg
 
wh’
 
¡¬tšg
 
a
 
Ãw
 
şass


1242 
’d


1244 
funùiÚ
 
TextOuut
:
	$¡¬tTe¡
(
‹¡Name
)

1245 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_DEFAULT
 
th’


1246 
io
.
¡dout
:
	`wr™e
Ğ" ".. 
£lf
.
»suÉ
.
cu¼’tNode
.
‹¡Name
.." ... " )

1247 
’d


1248 
’d


1250 
funùiÚ
 
TextOuut
:
	`addFau»
Ğ
”rÜMsg
, 
¡ackT¿û
 )

1251 -- 
nÙhšg


1252 
’d


1254 
funùiÚ
 
TextOuut
:
	$’dTe¡
(
‹¡HasFau»
)

1255 
nÙ
 
‹¡HasFau»
 
th’


1256 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_DEFAULT
 
th’


1257 
io
.
¡dout
:
	`wr™e
("Ok\n")

1259 
io
.
¡dout
:
	`wr™e
(".")

1260 
’d


1262 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_DEFAULT
 
th’


1263 
io
.
¡dout
:
	`wr™e
( 'FAIL\n' )

1264 
	`´št
Ğ
£lf
.
»suÉ
.
cu¼’tNode
.
msg
 )

1266 -- 
fšd
 
out
 
wh’
 
to
 dØ
this
:

1267 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_DEFAULT
 
th’


1268 
	$´št
Ğ
£lf
.
»suÉ
.
cu¼’tNode
.
¡ackT¿û
 )

1269 
’d


1272 
io
.
¡dout
:
	`wr™e
("F")

1273 
’d


1274 
’d


1275 
’d


1277 
funùiÚ
 
TextOuut
:
	`’dCÏss
()

1278 -- 
nÙhšg


1279 
’d


1281 
funùiÚ
 
TextOuut
:
	$di¥ÏyOÃFaedTe¡
Ğ
šdex
, 
çu»
 )

1282 
	`´št
(
šdex
.."è"..
çu»
.
‹¡Name
 )

1283 
	$´št
Ğ
çu»
.
msg
 )

1284 
	$´št
Ğ
çu»
.
¡ackT¿û
 )

1285 
	$´št
()

1286 
’d


1288 
funùiÚ
 
TextOuut
:
	$di¥ÏyFaedTe¡s
()

1289 
£lf
.
»suÉ
.
çu»CouÁ
 =ğ0 
th’
  
’d


1290 
	`´št
("Failedests:")

1291 
	`´št
("-------------")

1292 
i
,
v
 
š
 
	$aœs
(
£lf
.
»suÉ
.
çu»s
) do

1293 
£lf
:
	$di¥ÏyOÃFaedTe¡
Ğ
i
, 
v
 )

1294 
’d


1295 
’d


1297 
funùiÚ
 
TextOuut
:
	$’dSu™e
()

1298 
£lf
.
v”bos™y
 > 
M
.
VERBOSITY_DEFAULT
 
th’


1299 
	`´št
("=========================================================")

1301 
	$´št
()

1302 
’d


1303 
£lf
:
	$di¥ÏyFaedTe¡s
()

1304 
loÿl
 
ignÜedSŒšg
 = ""

1305 
	`´št
Ğ
¡ršg
.
	`fÜm©
("Rª %de¡ š %0.3à£cÚds", 
£lf
.
»suÉ
.
‹¡CouÁ
, s–f.»suÉ.
du¿tiÚ
 ) )

1306 
£lf
.
»suÉ
.
çu»CouÁ
 =ğ0 
th’


1307 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 > 0 
th’


1308 
ignÜedSŒšg
 = 
¡ršg
.
	`fÜm©
('(ignÜed=%d)', 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 )

1309 
’d


1310 
	`´št
('OK '.. 
ignÜedSŒšg
)

1312 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 > 0 
th’


1313 
ignÜedSŒšg
 = ', '..ignoredString

1314 
’d


1315 
	`´št
(
¡ršg
.
	`fÜm©
('FAILED (çu»s=%d%s)', 
£lf
.
»suÉ
.
çu»CouÁ
, 
ignÜedSŒšg
 ) )

1316 
’d


1317 
’d


1320 -- 
şass
 
TextOuut
 
’d


1324 -- 
şass
 
NOuut


1327 
loÿl
 
funùiÚ
 
	`nİC®ÏbË
()

1328 --
	$´št
(42)

1329  
nİC®ÏbË


1330 
’d


1332 
loÿl
 
NOuut
 = {

1333 
__şass__
 = 'NilOuptut',

1334 
	}
}

1335 
loÿl
 
	gNOuut_MT
 = {

1336 
__šdex
 = 
nİC®ÏbË
,

1338 
funùiÚ
 
	gNOuut
:
	$Ãw
()

1339 
loÿl
 
t
 = {
	}
}

1340 
t
.
__şass__
 = 'NilOutput'

1341 
	$£tm‘©abË
Ğ
t
, 
NOuut_MT
 )

1342  
t


1343 
’d


1347 -- 
şass
 
LuaUn™


1351 
M
.
LuaUn™
 = {

1352 
ouutTy³
 = 
TextOuut
,

1353 
v”bos™y
 = 
M
.
VERBOSITY_DEFAULT
,

1354 
__şass__
 = 'LuaUnit'

1355 
	}
}

1357 
EXPORT_ASSERT_TO_GLOBALS
 
th’


1358 
	gLuaUn™
 = 
M
.
LuaUn™


1359 
’d


1360 
loÿl
 
LuaUn™_MT
 = { 
__šdex
 = 
M
.
LuaUn™
 }

1362 
funùiÚ
 
	gM
.
	gLuaUn™
:
	$Ãw
()

1363 
loÿl
 
t
 = {
	}
}

1364 
	$£tm‘©abË
Ğ
t
, 
LuaUn™_MT
 )

1365  
t


1366 
’d


1368 -----------------[[ 
Ut™y
 
m‘hods
 ]]---------------------

1370 
funùiÚ
 
M
.
LuaUn™
.
	`isFunùiÚ
(
aObjeù
)

1371 --  
Œue
 
aObjeù
 
is
 
a
 
funùiÚ


1372  'funùiÚ' =ğ
	$ty³
(
aObjeù
)

1373 
’d


1375 
funùiÚ
 
M
.
LuaUn™
.
	`isCÏssM‘hod
(
aName
)

1376 --  
Œue
 
aName
 
cÚšs
 
a
 
şass
 +‡ 
m‘hod
 
Çme
 
š
 
the
 
fÜm
 class:method

1377  
nÙ
‚Ù 
¡ršg
.
	`fšd
(
aName
, '.', 
n
, 
Œue
 )

1378 
’d


1380 
funùiÚ
 
M
.
LuaUn™
.
	`¥l™CÏssM‘hod
(
someName
)

1381 --  
a
 
·œ
 
şassName
, 
m‘hodName
 ¨
Çme
 
š
 
the
 
fÜm
 
şass
:
m‘hod


1382 --  
n
 
nÙ
 
a
 
şass
 + 
m‘hod
 
Çme


1383 -- 
Çme
 
is
 
şass
 + 
m‘hod


1384 
loÿl
 
hasM‘hod
, 
m‘hodName
, 
şassName


1385 
hasM‘hod
 = 
¡ršg
.
	`fšd
(
someName
, '.', 
n
, 
Œue
 )

1386 
nÙ
 
hasM‘hod
 
th’
  
n
 
’d


1387 
m‘hodName
 = 
¡ršg
.
	`sub
(
someName
, 
hasM‘hod
+1)

1388 
şassName
 = 
¡ršg
.
	`sub
(
someName
,1,
hasM‘hod
-1)

1389  
şassName
, 
m‘hodName


1390 
’d


1392 
funùiÚ
 
M
.
LuaUn™
.
	`isM‘hodTe¡Name
Ğ
s
 )

1393 --  
Œue
 
is
 
the
 
Çme
 
m©ches
hÇm
of
 
a
 
‹¡
 
m‘hod


1394 --  
ruË
 
is
 
th©
 i 
¡¬ts
 
w™h
 'Te¡' 
Ü
 with 'test'

1395 
¡ršg
.
	$sub
(
s
,1,4):
	`low”
(è=ğ'‹¡' 
th’


1396  
Œue


1397 
’d


1398  
çl£


1399 
’d


1401 
funùiÚ
 
M
.
LuaUn™
.
	`isTe¡Name
Ğ
s
 )

1402 --  
Œue
 
is
 
the
 
Çme
 
m©ches
hÇm
of
 
a
 
‹¡


1403 --  
ruË
 
is
 
th©
 i 
¡¬ts
 
w™h
 'Te¡' 
Ü
 with 'test'

1404 
¡ršg
.
	$sub
(
s
,1,4):
	`low”
(è=ğ'‹¡' 
th’


1405  
Œue


1406 
’d


1407  
çl£


1408 
’d


1410 
funùiÚ
 
M
.
LuaUn™
.
	`cŞËùTe¡s
()

1411 --  
a
 
li¡
 
of
 
®l
 
‹¡
 
Çmes
 
š
 
the
 
glob®
 
Çme¥aû


1412 -- 
th©
 
m©ch
 
LuaUn™
.
isTe¡Name


1414 
loÿl
 
‹¡Names
 = {
	}
}

1415 
k
, 
v
 
š
 
	$·œs
(
_G
) do

1416 
M
.
LuaUn™
.
	$isTe¡Name
Ğ
k
 ) 
th’


1417 
bË
.
	$š£¹
Ğ
‹¡Names
 , 
k
 )

1418 
’d


1419 
’d


1420 
bË
.
	$sÜt
Ğ
‹¡Names
 )

1421  
‹¡Names


1422 
’d


1424 
funùiÚ
 
M
.
LuaUn™
.
	`·r£CmdLše
Ğ
cmdLše
 )

1425 -- 
·r£
 
the
 
commªd
 
lše


1426 -- 
SuµÜ‹d
 
commªd
 
lše
 
·¿m‘”s
:

1427 -- --
v”bo£
, -
v
: 
šü—£
 
v”bos™y


1428 -- --
qu›t
, -
q
: 
s’û
 
ouut


1429 -- --
ouut
, -
o
, + 
Çme
: 
£Ëù
 ouuˆ
ty³


1430 -- --
·‰”n
, -
p
, +…©‹º: 
run
 
‹¡
 
m©chšg
…©‹º, 
may
 
be
 
»³©ed


1431 -- --
Çme
, -
n
, + 
âame
:‚am
of
 
ouut
 
fe
 
jun™
,  
to
 
¡dout


1432 -- [
‹¡Çmes
, ...]: 
run
 
£Ëùed
 
‹¡
 
Çmes


1434 -- 
R‘uºs
 
a
 
bË
 
w™h
 
the
 
fŞlowšg
 
f›lds
:

1435 -- 
v”bos™y
: 
n
, 
M
.
VERBOSITY_DEFAULT
, M.
VERBOSITY_QUIET
, M.
VERBOSITY_VERBOSE


1436 -- 
ouut
: 
n
, 'tap', 'junit', 'text', 'nil'

1437 -- 
‹¡Names
: 
n
 
Ü
 
a
 
li¡
 
of
 
‹¡
 
Çmes
 
to
 
run


1438 -- 
·‰”n
: 
n
 
Ü
 
a
 
li¡
 
of
 
·‰”ns


1440 
loÿl
 
»suÉ
 = {
	}
}

1441 
loÿl
 
¡©e
 = 
n


1442 
loÿl
 
SET_OUTPUT
 = 1

1443 
loÿl
 
SET_PATTERN
 = 2

1444 
loÿl
 
SET_FNAME
 = 3

1446 
cmdLše
 =ğ
n
 
th’


1447  
»suÉ


1448 
’d


1450 
loÿl
 
funùiÚ
 
	$·r£O±iÚ
Ğ
İtiÚ
 )

1451 
İtiÚ
 =ğ'--h–p' 
Ü
 o±iÚ =ğ'-h' 
th’


1452 
»suÉ
['h–p'] = 
Œue


1454 
’d


1455 
İtiÚ
 =ğ'--v”siÚ' 
th’


1456 
»suÉ
['v”siÚ'] = 
Œue


1458 
’d


1459 
İtiÚ
 =ğ'--v”bo£' 
Ü
 o±iÚ =ğ'-v' 
th’


1460 
»suÉ
['v”bos™y'] = 
M
.
VERBOSITY_VERBOSE


1462 
’d


1463 
İtiÚ
 =ğ'--qu›t' 
Ü
 o±iÚ =ğ'-q' 
th’


1464 
»suÉ
['v”bos™y'] = 
M
.
VERBOSITY_QUIET


1466 
’d


1467 
İtiÚ
 =ğ'--ouut' 
Ü
 o±iÚ =ğ'-o' 
th’


1468 
¡©e
 = 
SET_OUTPUT


1469  
¡©e


1470 
’d


1471 
İtiÚ
 =ğ'--Çme' 
Ü
 o±iÚ =ğ'-n' 
th’


1472 
¡©e
 = 
SET_FNAME


1473  
¡©e


1474 
’d


1475 
İtiÚ
 =ğ'--·‰”n' 
Ü
 o±iÚ =ğ'-p' 
th’


1476 
¡©e
 = 
SET_PATTERN


1477  
¡©e


1478 
’d


1479 
	`”rÜ
('UnknowÀİtiÚ: '..
İtiÚ
,3)

1480 
’d


1482 
loÿl
 
funùiÚ
 
	$£tArg
Ğ
cmdArg
, 
¡©e
 )

1483 
¡©e
 =ğ
SET_OUTPUT
 
th’


1484 
»suÉ
['ouut'] = 
cmdArg


1486 
’d


1487 
¡©e
 =ğ
SET_FNAME
 
th’


1488 
»suÉ
['âame'] = 
cmdArg


1490 
’d


1491 
¡©e
 =ğ
SET_PATTERN
 
th’


1492 
»suÉ
['·‰”n'] 
th’


1493 
bË
.
	`š£¹
Ğ
»suÉ
['·‰”n'], 
cmdArg
 )

1495 
»suÉ
['·‰”n'] = { 
cmdArg
 
	}
}

1496 
’d


1498 
’d


1499 
”rÜ
('UnknowÀ·r£ s‹: '.. 
¡©e
)

1500 
’d


1503 
i
, 
cmdArg
 
š
 
	$aœs
(
cmdLše
) do

1504 
¡©e
 ~ğ
n
 
th’


1505 
	$£tArg
Ğ
cmdArg
, 
¡©e
, 
»suÉ
 )

1506 
¡©e
 = 
n


1508 
cmdArg
:
	`sub
(1,1è=ğ'-' 
th’


1509 
¡©e
 = 
	$·r£O±iÚ
Ğ
cmdArg
 )

1511 
»suÉ
['‹¡Names'] 
th’


1512 
bË
.
	`š£¹
Ğ
»suÉ
['‹¡Names'], 
cmdArg
 )

1514 
»suÉ
['‹¡Names'] = { 
cmdArg
 
	}
}

1515 
’d


1516 
’d


1517 
’d


1518 
’d


1520 
»suÉ
['h–p'] 
th’


1521 
M
.
LuaUn™
.
	$h–p
()

1522 
’d


1524 
»suÉ
['v”siÚ'] 
th’


1525 
M
.
LuaUn™
.
	$v”siÚ
()

1526 
’d


1528 
¡©e
 ~ğ
n
 
th’


1529 
	`”rÜ
('Missšg‡rgum’ˆaá” '..
cmdLše
[ #cmdLine ],2 )

1530 
’d


1532  
»suÉ


1533 
’d


1535 
funùiÚ
 
M
.
LuaUn™
.
	$h–p
()

1536 
	$´št
(
M
.
USAGE
)

1537 
os
.
	$ex™
(0)

1538 
’d


1540 
funùiÚ
 
M
.
LuaUn™
.
	$v”siÚ
()

1541 
	`´št
('LuaUn™ v'..
M
.
VERSION
..' by Philippe Fremy <phil@freehackers.org>')

1542 
os
.
	$ex™
(0)

1543 
’d


1545 
funùiÚ
 
M
.
LuaUn™
.
	`·‰”nInşude
Ğ
·‰”nF‹r
, 
ex´
 )

1546 -- 
check
 
ªy
 
of
 
·‰”nF‹r
 
is
 
cÚšed
 
š
 
ex´
. 
If
 
so
,  
Œue
.

1547 --  
çl£
 
NÚe
 
of
 
the
 
·‰”ns
 
¬e
 
cÚšed
 
š
 
ex´


1548 -- 
·‰”nF‹r
 
is
 
n
,  
	$Œue
 (
no
 
f‹ršg
)

1549 
·‰”nF‹r
 =ğ
n
 
th’


1550  
Œue


1551 
’d


1553 
i
,
·‰”n
 
š
 
	$aœs
(
·‰”nF‹r
) do

1554 
¡ršg
.
	$fšd
(
ex´
, 
·‰”n
è
th’


1555  
Œue


1556 
’d


1557 
’d


1559  
çl£


1560 
’d


1562 --------------[[ 
Ouut
 
m‘hods
 ]]-------------------------

1565 
loÿl
 
NodeStus
 = { -- 
şass


1566 
__şass__
 = 'NodeStatus',

1567 
	}
}

1568 
	gM
.
	gNodeStus
 = 
NodeStus


1569 
loÿl
 
NodeStus_MT
 = { 
__šdex
 = 
NodeStus
 }

1571 -- 
v®ues
 
of
 
¡©us


1572 
	gNodeStus
.
	gPASS
='PASS'

1573 
NodeStus
.
FAIL
='FAIL'

1575 
funùiÚ
 
NodeStus
:
	$Ãw
Ğ
numb”
, 
‹¡Name
, 
şassName
 )

1576 
loÿl
 
t
 = {
	}
}

1577 
t
.
numb”
 =‚umber

1578 
t
.
‹¡Name
 =estName

1579 
t
.
şassName
 = className

1580 
£lf
:
	$·ss
()

1581 
	$£tm‘©abË
Ğ
t
, 
NodeStus_MT
 )

1582  
t


1583 
’d


1585 
funùiÚ
 
NodeStus
:
	$·ss
()

1586 
£lf
.
¡©us
 = s–f.
PASS


1587 -- 
u£Ëss
 
but
 
we
 
know
 
™
'she field we wanto use

1588 
£lf
.
msg
 = 
n


1589 
£lf
.
¡ackT¿û
 = 
n


1590 
’d


1592 
funùiÚ
 
NodeStus
:
	$ç
(
msg
, 
¡ackT¿û
)

1593 
£lf
.
¡©us
 = s–f.
FAIL


1594 
£lf
.
msg
 = msg

1595 
£lf
.
¡ackT¿û
 = stackTrace

1596 
’d


1598 
funùiÚ
 
NodeStus
:
	`hasFau»
()

1599 -- 
	`´št
('hasFau»: '..
	$´‘ty¡r
(
£lf
))

1600  (
£lf
.
¡©us
 ~ğ
NodeStus
.
PASS
)

1601 
’d


1603 
funùiÚ
 
M
.
LuaUn™
:
	$¡¬tSu™e
(
‹¡CouÁ
, 
nÚS–eùedCouÁ
)

1604 
£lf
.
»suÉ
 = {
	}
}

1605 
£lf
.
»suÉ
.
çu»CouÁ
 = 0

1606 
£lf
.
»suÉ
.
‹¡CouÁ
 =estCount

1607 
£lf
.
»suÉ
.
nÚS–eùedCouÁ
 =‚onSelectedCount

1608 
£lf
.
»suÉ
.
cu¼’tTe¡Numb”
 = 0

1609 
£lf
.
»suÉ
.
cu¼’tCÏssName
 = ""

1610 
£lf
.
»suÉ
.
cu¼’tNode
 = 
n


1611 
£lf
.
»suÉ
.
su™eS¹ed
 = 
Œue


1612 
£lf
.
»suÉ
.
¡¬tTime
 = 
os
.
	$şock
()

1613 
£lf
.
»suÉ
.
¡¬tD©e
 = 
os
.
	$d©e
()

1614 
£lf
.
»suÉ
.
¡¬tIsod©e
 = 
os
.
	`d©e
('%Y-%m-%dT%H:%M:%S')

1615 
£lf
.
»suÉ
.
·‰”nF‹r
 = self.patternFilter

1616 
£lf
.
»suÉ
.
‹¡s
 = {
	}
}

1617 
£lf
.
»suÉ
.
çu»s
 = {}

1619 
£lf
.
ouutTy³
 = s–f.ouutTy³ 
Ü
 
TextOuut


1620 
£lf
.
ouut
 = s–f.
ouutTy³
:
	$Ãw
()

1621 
£lf
.
ouut
.
ruÂ”
 = self

1622 
£lf
.
ouut
.
»suÉ
 = self.result

1623 
£lf
.
ouut
.
v”bos™y
 = self.verbosity

1624 
£lf
.
ouut
.
âame
 = self.fname

1625 
£lf
.
ouut
:
	$¡¬tSu™e
()

1626 
’d


1628 
funùiÚ
 
M
.
LuaUn™
:
	$¡¬tCÏss
Ğ
şassName
 )

1629 
£lf
.
»suÉ
.
cu¼’tCÏssName
 = 
şassName


1630 
£lf
.
ouut
:
	$¡¬tCÏss
Ğ
şassName
 )

1631 
’d


1633 
funùiÚ
 
M
.
LuaUn™
:
	$¡¬tTe¡
Ğ
‹¡Name
 )

1634 
£lf
.
»suÉ
.
cu¼’tTe¡Numb”
 = self.result.currentTestNumber + 1

1635 
£lf
.
»suÉ
.
cu¼’tNode
 = 
NodeStus
:
	$Ãw
(

1636 
£lf
.
»suÉ
.
cu¼’tTe¡Numb”
,

1637 
‹¡Name
,

1638 
£lf
.
»suÉ
.
cu¼’tCÏssName


1640 
£lf
.
»suÉ
.
cu¼’tNode
.
¡¬tTime
 = 
os
.
	$şock
()

1641 
bË
.
	$š£¹
Ğ
£lf
.
»suÉ
.
‹¡s
, s–f.»suÉ.
cu¼’tNode
 )

1642 
£lf
.
ouut
:
	$¡¬tTe¡
Ğ
‹¡Name
 )

1643 
’d


1645 
funùiÚ
 
M
.
LuaUn™
:
	$addFau»
Ğ
”rÜMsg
, 
¡ackT¿û
 )

1646 
£lf
.
»suÉ
.
cu¼’tNode
.
¡©us
 =ğ
NodeStus
.
PASS
 
th’


1647 
£lf
.
»suÉ
.
çu»CouÁ
 = self.result.failureCount + 1

1648 
£lf
.
»suÉ
.
cu¼’tNode
:
	$ç
Ğ
”rÜMsg
, 
¡ackT¿û
 )

1649 
bË
.
	$š£¹
Ğ
£lf
.
»suÉ
.
çu»s
, s–f.»suÉ.
cu¼’tNode
 )

1650 
’d


1651 
£lf
.
ouut
:
	$addFau»
Ğ
”rÜMsg
, 
¡ackT¿û
 )

1652 
’d


1654 
funùiÚ
 
M
.
LuaUn™
:
	`’dTe¡
()

1655 -- 
	`´št
Ğ'’dTE¡(è'..
	`´‘ty¡r
(
£lf
.
»suÉ
.
cu¼’tNode
))

1656 -- 
	`´št
Ğ'’dTE¡(è'..
	`´‘ty¡r
(
£lf
.
»suÉ
.
cu¼’tNode
:
	$hasFau»
()))

1657 
£lf
.
»suÉ
.
cu¼’tNode
.
du¿tiÚ
 = 
os
.
	`şock
(è- s–f.»suÉ.cu¼’tNode.
¡¬tTime


1658 
£lf
.
»suÉ
.
cu¼’tNode
.
¡¬tTime
 = 
n


1659 
£lf
.
ouut
:
	`’dTe¡
Ğ£lf.
»suÉ
.
cu¼’tNode
:
	$hasFau»
() )

1660 
£lf
.
»suÉ
.
cu¼’tNode
 = 
n


1661 
’d


1663 
funùiÚ
 
M
.
LuaUn™
:
	$’dCÏss
()

1664 
£lf
.
ouut
:
	$’dCÏss
()

1665 
’d


1667 
funùiÚ
 
M
.
LuaUn™
:
	$’dSu™e
()

1668 
£lf
.
»suÉ
.
su™eS¹ed
 =ğ
çl£
 
th’


1669 
	`”rÜ
('LuaUnit:endSuite() -- suite was‡lreadyƒnded' )

1670 
’d


1671 
£lf
.
»suÉ
.
du¿tiÚ
 = 
os
.
	`şock
()-£lf.»suÉ.
¡¬tTime


1672 
£lf
.
»suÉ
.
su™eS¹ed
 = 
çl£


1673 
£lf
.
ouut
:
	$’dSu™e
()

1674 
’d


1676 
funùiÚ
 
M
.
LuaUn™
:
	`£tOuutTy³
(
ouutTy³
)

1677 --  
to
 
‹xt


1678 -- 
p
 
´oduûs
 
»suÉs
 
accÜdšg
 
to
 
TAP
 
fÜm©


1679 
ouutTy³
:
	`uµ”
(è=ğ"NIL" 
th’


1680 
£lf
.
ouutTy³
 = 
NOuut


1682 
’d


1683 
ouutTy³
:
	`uµ”
(è=ğ"TAP" 
th’


1684 
£lf
.
ouutTy³
 = 
T­Ouut


1686 
’d


1687 
ouutTy³
:
	`uµ”
(è=ğ"JUNIT" 
th’


1688 
£lf
.
ouutTy³
 = 
JUn™Ouut


1690 
’d


1691 
ouutTy³
:
	`uµ”
(è=ğ"TEXT" 
th’


1692 
£lf
.
ouutTy³
 = 
TextOuut


1694 
’d


1695 
	`”rÜ
Ğ'NØsuch fÜm©: '..
ouutTy³
,2)

1696 
’d


1698 
funùiÚ
 
M
.
LuaUn™
:
	$£tV”bos™y
Ğ
v”bos™y
 )

1699 
£lf
.
v”bos™y
 = verbosity

1700 
’d


1702 
funùiÚ
 
M
.
LuaUn™
:
	$£tFÇme
Ğ
âame
 )

1703 
£lf
.
âame
 = fname

1704 
’d


1706 --------------[[ 
RuÂ”
 ]]-----------------

1708 
loÿl
 
SPLITTER
 = '\n>----------<\n'

1710 
funùiÚ
 
M
.
LuaUn™
:
	`´ÙeùedC®l
Ğ
şassIn¡ªû
 , 
m‘hodIn¡ªû
, 
´‘tyFuncName
)

1711 -- 
şassIn¡ªû
 
is
 
n
, 
this
 i 
ju¡
 
a
 
funùiÚ
 
ÿÎ


1712 -- , 
™
's method of‡ class being called.

1714 
loÿl
 
funùiÚ
 
	$”r_hªdËr
(
e
)

1715  
debug
.
	$Œaûback
(
e
..
SPLITTER
, 3)

1716 
’d


1718 
loÿl
 
ok
, 
fuÎE¼Msg
, 
¡ackT¿û
, 
”rMsg
, 
t


1719 
şassIn¡ªû
 
th’


1720 -- 
¡upid
 
Lua
 < 5.2 
dÛs
 
nÙ
 
®low
 
xpÿÎ
 
w™h
 
¬gum’ts
 
so
 
Ët
's use‡ workaround

1721 
ok
, 
fuÎE¼Msg
 = 
	`xpÿÎ
Ğ
	$funùiÚ
 (è
	$m‘hodIn¡ªû
(
şassIn¡ªû
è
’d
, 
”r_hªdËr
 )

1723 
ok
, 
fuÎE¼Msg
 = 
	`xpÿÎ
Ğ
	$funùiÚ
 (è
	$m‘hodIn¡ªû
(è
’d
, 
”r_hªdËr
 )

1724 
’d


1725 
ok
 
th’


1726  
ok


1727 
’d


1729 
t
 = 
	$¡r¥l™
Ğ
SPLITTER
, 
fuÎE¼Msg
 )

1730 
”rMsg
 = 
t
[1]

1731 
¡ackT¿û
 = 
¡ršg
.
	$sub
(
t
[2],2)

1732 
´‘tyFuncName
 
th’


1733 -- 
we
 dØ
have
 
the
 
»®
 
m‘hod
 
Çme
, 
im´ove
h
¡ack
 
Œaû


1734 
¡ackT¿û
 = 
¡ršg
.
	`gsub
Ğ¡ackT¿û, "š funùiÚ 'm‘hodIn¡ªû'", "š funùiÚ '"..
´‘tyFuncName
.."'")

1735 -- 
N“ded
 
Lua
 5.3

1736 
¡ackT¿û
 = 
¡ršg
.
	`gsub
Ğ¡ackT¿û, "š m‘hod 'm‘hodIn¡ªû'", "š m‘hod '"..
´‘tyFuncName
.."'")

1737 
¡ackT¿û
 = 
¡ršg
.
	`gsub
Ğ¡ackT¿û, "š upv®u'm‘hodIn¡ªû'", "š m‘hod '"..
´‘tyFuncName
.."'")

1738 
’d


1740 
STRIP_LUAUNIT_FROM_STACKTRACE
 
th’


1741 
¡ackT¿û
 = 
	$¡rLuaun™T¿û
Ğ
¡ackT¿û
 )

1742 
’d


1744  
ok
, 
”rMsg
, 
¡ackT¿û


1745 
’d


1748 
funùiÚ
 
M
.
LuaUn™
:
	`execOÃFunùiÚ
(
şassName
, 
m‘hodName
, 
şassIn¡ªû
, 
m‘hodIn¡ªû
)

1749 -- 
Wh’
 
executšg
 
a
 
‹¡
 
funùiÚ
, 
şassName
 
ªd
 
şassIn¡ªû
 
mu¡
 
be
 
n


1750 -- 
Wh’
 
executšg
 
a
 
şass
 
m‘hod
, 
®l
 
·¿m‘”s
 
mu¡
 
be
 
£t


1752 
loÿl
 
ok
, 
”rMsg
, 
¡ackT¿û
, 
´‘tyFuncName


1754 
	`ty³
(
m‘hodIn¡ªû
è~ğ'funùiÚ' 
th’


1755 
	`”rÜ
Ğ
	`to¡ršg
(
m‘hodName
)..' mu¡ b¨funùiÚ,‚Ù '..
	$ty³
(
m‘hodIn¡ªû
))

1756 
’d


1758 
şassName
 =ğ
n
 
th’


1759 
şassName
 = '[TestFunctions]'

1760 
´‘tyFuncName
 = 
m‘hodName


1762 
´‘tyFuncName
 = 
şassName
..'.'..
m‘hodName


1763 
’d


1765 
£lf
.
Ï¡CÏssName
 ~ğ
şassName
 
th’


1766 
£lf
.
Ï¡CÏssName
 ~ğ
n
 
th’


1767 
£lf
:
	$’dCÏss
()

1768 
’d


1769 
£lf
:
	$¡¬tCÏss
Ğ
şassName
 )

1770 
£lf
.
Ï¡CÏssName
 = 
şassName


1771 
’d


1773 
£lf
:
	`¡¬tTe¡
(
´‘tyFuncName
)

1775 -- 
run
 
£tUp
 
	$fœ¡
(
ªy
)

1776 
şassIn¡ªû
 
ªd
 
£lf
.
	$isFunùiÚ
Ğ
şassIn¡ªû
.
£tUp
 ) 
th’


1777 
ok
, 
”rMsg
, 
¡ackT¿û
 = 
£lf
:
	`´ÙeùedC®l
Ğ
şassIn¡ªû
, cÏssIn¡ªû.
£tUp
, 
şassName
..'.setUp')

1778 
nÙ
 
ok
 
th’


1779 
£lf
:
	$addFau»
Ğ
”rMsg
, 
¡ackT¿û
 )

1780 
’d


1781 
’d


1783 -- 
run
 
	$‹¡M‘hod
()

1784 
nÙ
 
£lf
.
»suÉ
.
cu¼’tNode
:
	$hasFau»
(è
th’


1785 
ok
, 
”rMsg
, 
¡ackT¿û
 = 
£lf
:
	$´ÙeùedC®l
Ğ
şassIn¡ªû
, 
m‘hodIn¡ªû
, 
´‘tyFuncName
)

1786 
nÙ
 
ok
 
th’


1787 
£lf
:
	$addFau»
Ğ
”rMsg
, 
¡ackT¿û
 )

1788 
’d


1789 
’d


1791 -- 
Ï¡ly
, 
run
 
	$‹¬Down
(
ªy
)

1792 
şassIn¡ªû
 
ªd
 
£lf
.
	$isFunùiÚ
(
şassIn¡ªû
.
‹¬Down
è
th’


1793 
ok
, 
”rMsg
, 
¡ackT¿û
 = 
£lf
:
	`´ÙeùedC®l
Ğ
şassIn¡ªû
, cÏssIn¡ªû.
‹¬Down
, 
şassName
..'.tearDown')

1794 
nÙ
 
ok
 
th’


1795 
£lf
:
	$addFau»
Ğ
”rMsg
, 
¡ackT¿û
 )

1796 
’d


1797 
’d


1799 
£lf
:
	$’dTe¡
()

1800 
’d


1802 
funùiÚ
 
M
.
LuaUn™
.
	`ex·ndOÃCÏss
Ğ
»suÉ
, 
şassName
, 
şassIn¡ªû
 )

1803 -- 
add
 
®l
 
‹¡
 
m‘hods
 
of
 
şassIn¡ªû
 
to
 
»suÉ


1804 
m‘hodName
, 
m‘hodIn¡ªû
 
š
 
	$sÜ‹dPaœs
(
şassIn¡ªû
) do

1805 
M
.
LuaUn™
.
	$isFunùiÚ
(
m‘hodIn¡ªû
è
ªd
 
M
.
LuaUn™
.
	$isM‘hodTe¡Name
Ğ
m‘hodName
 ) 
th’


1806 
bË
.
	`š£¹
Ğ
»suÉ
, { 
şassName
..'.'..
m‘hodName
, 
şassIn¡ªû
 
	}
} )

1807 
’d


1808 
’d


1809 
’d


1811 
funùiÚ
 
	gM
.
	gLuaUn™
.
ex·ndCÏs£s
Ğ
li¡OfNameAndIn¡
 )

1812 -- 
ex·nd
 
®l
 
şas£s
 (
´oveded
 
as
 {
şassName
, 
şassIn¡ªû
}è
to
 
a
 
li¡
 
	gof
 {
	gşassName
.
	gm‘hodName
, 
	gşassIn¡ªû
}

1813 -- 
funùiÚs
 
ªd
 
m‘hods
 
»maš
 
uÁouched


1814 
loÿl
 
	g»suÉ
 = {}

1816 
i
,
v
 
š
 
	$aœs
Ğ
li¡OfNameAndIn¡
 ) do

1817 
loÿl
 
Çme
, 
š¡ªû
 = 
v
[1], v[2]

1818 
M
.
LuaUn™
.
	$isFunùiÚ
(
š¡ªû
è
th’


1819 
bË
.
	`š£¹
Ğ
»suÉ
, { 
Çme
, 
š¡ªû
 
	}
} )

1821 
ty³
(
š¡ªû
è~ğ'bË' 
th’


1822 
”rÜ
Ğ'In¡ªû mu¡ b¨bË o¸¨funùiÚ,‚Ù‡ '..
ty³
(
š¡ªû
)..', v®u'..
	$´‘ty¡r
(
š¡ªû
))

1823 
’d


1824 
M
.
LuaUn™
.
	$isCÏssM‘hod
Ğ
Çme
 ) 
th’


1825 
şassName
, 
m‘hodName
 = 
M
.
LuaUn™
.
	$¥l™CÏssM‘hod
Ğ
Çme
 )

1826 
m‘hodIn¡ªû
 = 
š¡ªû
[
m‘hodName
]

1827 
m‘hodIn¡ªû
 =ğ
n
 
th’


1828 
	`”rÜ
Ğ"Could‚Ù fšd m‘hod iÀşas "..
	`to¡ršg
(
şassName
).." fÜ m‘hod "..
	$to¡ršg
(
m‘hodName
) )

1829 
’d


1830 
bË
.
	`š£¹
Ğ
»suÉ
, { 
Çme
, 
š¡ªû
 
	}
} )

1832 
	gM
.
	gLuaUn™
.
	$ex·ndOÃCÏss
Ğ
»suÉ
, 
Çme
, 
š¡ªû
 )

1833 
’d


1834 
’d


1835 
’d


1837  
»suÉ


1838 
’d


1840 
funùiÚ
 
M
.
LuaUn™
.
	$­¶yP©‹ºF‹r
Ğ
·‰”nF‹r
, 
li¡OfNameAndIn¡
 )

1841 
loÿl
 
šşuded
 = {
	}
}

1842 
loÿl
 
exşuded
 = {}

1844 
i
,
v
 
š
 
	$aœs
Ğ
li¡OfNameAndIn¡
 ) do

1845 
loÿl
 
Çme
, 
š¡ªû
 = 
v
[1], v[2]

1847 
·‰”nF‹r
 
ªd
 
nÙ
 
M
.
LuaUn™
.
	$·‰”nInşude
Ğ
·‰”nF‹r
, 
Çme
 ) 
th’


1848 
bË
.
	$š£¹
Ğ
exşuded
, 
v
 )

1850 
bË
.
	$š£¹
Ğ
šşuded
, 
v
 )

1851 
’d


1852 
’d


1853  
šşuded
, 
exşuded


1855 
’d


1857 
funùiÚ
 
M
.
LuaUn™
:
	`runSu™eByIn¡ªûs
Ğ
li¡OfNameAndIn¡
 )

1858 -- 
Run
 
ª
 
ex¶ic™
 
li¡
 
of
 
‹¡s
. 
AÎ
 
‹¡
 
š¡ªûs
 
ªd
 
Çmes
 
mu¡
 
be
 
suµl›d
.

1859 -- 
—ch
 
‹¡
 
mu¡
 
be
 
Úe
 
of
:

1860 -- * { 
funùiÚ
 
Çme
, funùiÚ 
š¡ªû
 
	}
}

1861 -- * { 
şass
 
	gÇme
, cÏs 
	gš¡ªû
 }

1862 -- * { 
	gşass
.
m‘hod
 
	gÇme
, 
şass
 
	gš¡ªû
 }

1864 
loÿl
 
	gex·ndedLi¡
, 
	gf‹»dLi¡
, 
	gf‹»dOutLi¡
, 
	gşassName
, 
	gm‘hodName
, 
m‘hodIn¡ªû


1865 
	gex·ndedLi¡
 = 
£lf
.
	$ex·ndCÏs£s
Ğ
li¡OfNameAndIn¡
 )

1867 
f‹»dLi¡
, 
f‹»dOutLi¡
 = 
£lf
.
	$­¶yP©‹ºF‹r
Ğ
£lf
.
·‰”nF‹r
, 
ex·ndedLi¡
 )

1869 
£lf
:
	`¡¬tSu™e
( #filteredList, #filteredOutList )

1871 
i
,
v
 
š
 
	$aœs
Ğ
f‹»dLi¡
 ) do

1872 
loÿl
 
Çme
, 
š¡ªû
 = 
v
[1], v[2]

1873 
M
.
LuaUn™
.
	$isFunùiÚ
(
š¡ªû
è
th’


1874 
£lf
:
	$execOÃFunùiÚ
Ğ
n
, 
Çme
,‚, 
š¡ªû
 )

1876 
	`ty³
(
š¡ªû
è~ğ'bË' 
th’


1877 
	`”rÜ
Ğ'In¡ªû mu¡ b¨bË o¸¨funùiÚ,‚Ù‡ '..
	`ty³
(
š¡ªû
)..', v®u'..
	$´‘ty¡r
(
š¡ªû
))

1879 
	`as£¹
Ğ
M
.
LuaUn™
.
	$isCÏssM‘hod
Ğ
Çme
 ) )

1880 
şassName
, 
m‘hodName
 = 
M
.
LuaUn™
.
	$¥l™CÏssM‘hod
Ğ
Çme
 )

1881 
m‘hodIn¡ªû
 = 
š¡ªû
[
m‘hodName
]

1882 
m‘hodIn¡ªû
 =ğ
n
 
th’


1883 
	`”rÜ
Ğ"Could‚Ù fšd m‘hod iÀşas "..
	`to¡ršg
(
şassName
).." fÜ m‘hod "..
	$to¡ršg
(
m‘hodName
) )

1884 
’d


1885 
£lf
:
	$execOÃFunùiÚ
Ğ
şassName
, 
m‘hodName
, 
š¡ªû
, 
m‘hodIn¡ªû
 )

1886 
’d


1887 
’d


1888 
’d


1890 
£lf
.
Ï¡CÏssName
 ~ğ
n
 
th’


1891 
£lf
:
	$’dCÏss
()

1892 
’d


1894 
£lf
:
	$’dSu™e
()

1895 
’d


1897 
funùiÚ
 
M
.
LuaUn™
:
	`runSu™eByNames
Ğ
li¡OfName
 )

1898 -- 
Run
 
ª
 
ex¶ic™
 
li¡
 
of
 
‹¡
 
Çmes


1900 
loÿl
 
şassName
, 
m‘hodName
, 
š¡ªûName
, 
š¡ªû
, 
m‘hodIn¡ªû


1901 
loÿl
 
li¡OfNameAndIn¡
 = {
	}
}

1903 
i
,
Çme
 
š
 
	$aœs
Ğ
li¡OfName
 ) do

1904 
M
.
LuaUn™
.
	$isCÏssM‘hod
Ğ
Çme
 ) 
th’


1905 
şassName
, 
m‘hodName
 = 
M
.
LuaUn™
.
	$¥l™CÏssM‘hod
Ğ
Çme
 )

1906 
š¡ªûName
 = 
şassName


1907 
š¡ªû
 = 
_G
[
š¡ªûName
]

1909 
š¡ªû
 =ğ
n
 
th’


1910 
	`”rÜ
Ğ"NØsuch‚amš glob® s·û: "..
š¡ªûName
 )

1911 
’d


1913 
	`ty³
(
š¡ªû
è~ğ'bË' 
th’


1914 
	`”rÜ
Ğ'In¡ªû oà'..
š¡ªûName
..' mu¡ b¨bË,‚Ù '..
	$ty³
(
š¡ªû
))

1915 
’d


1917 
m‘hodIn¡ªû
 = 
š¡ªû
[
m‘hodName
]

1918 
m‘hodIn¡ªû
 =ğ
n
 
th’


1919 
	`”rÜ
Ğ"Could‚Ù fšd m‘hod iÀşas "..
	`to¡ršg
(
şassName
).." fÜ m‘hod "..
	$to¡ršg
(
m‘hodName
) )

1920 
’d


1923 -- 
funùiÚs
 
ªd
 
şas£s


1924 
š¡ªûName
 = 
Çme


1925 
š¡ªû
 = 
_G
[
š¡ªûName
]

1926 
’d


1928 
š¡ªû
 =ğ
n
 
th’


1929 
	`”rÜ
Ğ"NØsuch‚amš glob® s·û: "..
š¡ªûName
 )

1930 
’d


1932 ià(
	`ty³
(
š¡ªû
è~ğ'bË' 
ªd
y³(š¡ªûè~ğ'funùiÚ'è
th’


1933 
	`”rÜ
Ğ'Nammu¡ m©ch‡ funùiÚ o¸¨bË: '..
š¡ªûName
 )

1934 
’d


1936 
bË
.
	`š£¹
Ğ
li¡OfNameAndIn¡
, { 
Çme
, 
š¡ªû
 
	}
} )

1937 
’d


1939 
	g£lf
:
	$runSu™eByIn¡ªûs
Ğ
li¡OfNameAndIn¡
 )

1940 
’d


1942 
funùiÚ
 
M
.
LuaUn™
.
	`run
(...)

1943 -- 
Run
 
some
 
¥ecific
 
‹¡
 
şas£s
.

1944 -- 
If
 
no
 
¬gum’ts
 
¬e
 
·s£d
, 
run
 
the
 
şass
 
Çmes
 
¥ecif›d
 
Ú
he

1945 -- 
commªd
 
lše
. 
If
 
no
 
şass
 
Çme
 
is
 
¥ecif›d
 
Ú
 
the
 command†ine

1946 -- 
run
 
®l
 
şas£s
 
who£
 
Çme
 
¡¬ts
 
w™h
 'Test'

1948 -- 
If
 
¬gum’ts
 
¬e
 
·s£d
, 
they
 
mu¡
 
be
 
¡ršgs
 
of
 
the
 
şass
 
Çmes


1949 -- 
th©
 
you
 
wªt
 
to
 
run
 
Ü
 
g’”ic
 
commªd
 
lše
 
	`¬gum’ts
 (-
o
, -
p
, -
v
, ...)

1951 
loÿl
 
ruÂ”
 = 
M
.
LuaUn™
.
	$Ãw
()

1952  
ruÂ”
:
	$runSu™e
(...)

1953 
’d


1955 
funùiÚ
 
M
.
LuaUn™
:
	$runSu™e
( ... )

1957 
loÿl
 
¬gs
={...
	}
};

1958 
	g¬gs
[1] ~ğ
n
 
ªd
 
ty³
(
¬gs
[1]è=ğ'bË'‡nd‡rgs[1].
__şass__
 =ğ'LuaUn™' 
th’


1959 -- 
run
 
was
 
ÿÎed
 
w™h
 
the
 
syÁax
 
M
.
LuaUn™
:
runSu™e
()

1960 -- 
we
 
suµÜt
 
bÙh
 
M
.
LuaUn™
.
	$run
(è
ªd
 
M
.
LuaUn™
:
	`run
()

1961 -- 
¡r
 
out
 
the
 
fœ¡
 
¬gum’t


1962 
bË
.
	$»move
(
¬gs
,1)

1963 
’d


1965 #¬g =ğ0 
th’


1966 
¬gs
 = 
cmdlše_¬gv


1967 
’d


1969 
loÿl
 
no_”rÜ
, 
”rÜ_msg
, 
İtiÚs
, 
v®


1970 
no_”rÜ
, 
v®
 = 
	$pÿÎ
Ğ
M
.
LuaUn™
.
·r£CmdLše
, 
¬gs
 )

1971 
nÙ
 
no_”rÜ
 
th’


1972 
”rÜ_msg
 = 
v®


1973 
	$´št
(
”rÜ_msg
)

1974 
	$´št
()

1975 
	$´št
(
M
.
USAGE
)

1976 
os
.
	`ex™
(-1)

1977 
’d


1979 
İtiÚs
 = 
v®


1981 
İtiÚs
.
v”bos™y
 
th’


1982 
£lf
:
	$£tV”bos™y
Ğ
İtiÚs
.
v”bos™y
 )

1983 
’d


1985 
İtiÚs
.
ouut
 
ªd
 o±iÚs.ouut:
	`low”
(è=ğ'jun™'‡nd o±iÚs.
âame
 =ğ
n
 
th’


1986 
	`´št
('With junit output,‡ filename must be supplied with -n or --name')

1987 
os
.
	`ex™
(-1)

1988 
’d


1990 
İtiÚs
.
ouut
 
th’


1991 
no_”rÜ
, 
v®
 = 
	$pÿÎ
(
£lf
.
£tOuutTy³
,£lf,
İtiÚs
.
ouut
)

1992 
nÙ
 
no_”rÜ
 
th’


1993 
”rÜ_msg
 = 
v®


1994 
	$´št
(
”rÜ_msg
)

1995 
	$´št
()

1996 
	$´št
(
M
.
USAGE
)

1997 
os
.
	`ex™
(-1)

1998 
’d


1999 
’d


2001 
İtiÚs
.
âame
 
th’


2002 
£lf
:
	$£tFÇme
Ğ
İtiÚs
.
âame
 )

2003 
’d


2005 
İtiÚs
.
·‰”n
 
th’


2006 
£lf
.
·‰”nF‹r
 = 
İtiÚs
.
·‰”n


2007 
’d


2009 
loÿl
 
‹¡Names
 = 
İtiÚs
['testNames']

2011 
‹¡Names
 =ğ
n
 
th’


2012 
‹¡Names
 = 
M
.
LuaUn™
.
	$cŞËùTe¡s
()

2013 
’d


2015 
£lf
:
	$runSu™eByNames
Ğ
‹¡Names
 )

2017  
£lf
.
»suÉ
.
çu»CouÁ


2018 
’d


2020 -- 
şass
 
LuaUn™


2022  
M


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf.lua

1 
moduË
("pf",
·ckage
.
£—Î
)

3 
loÿl
 
	g§vefe
 = 
»quœe
("pf.savefile")

4 
loÿl
 
ty³s
 = 
»quœe
("pf.types")

5 
loÿl
 
libpÿp
 = 
»quœe
("pf.libpcap")

6 
loÿl
 
bpf
 = 
»quœe
("pf.bpf")

7 
loÿl
 
·r£
 = 
»quœe
('pf.parse')

8 
loÿl
 
ex·nd
 = 
»quœe
('pf.expand')

9 
loÿl
 
İtimize
 = 
»quœe
('pf.optimize')

10 
loÿl
 
ªf
 = 
»quœe
('pf.anf')

11 
loÿl
 
s§
 = 
»quœe
('pf.ssa')

12 
loÿl
 
back’d
 = 
»quœe
('pf.backend')

13 
loÿl
 
uts
 = 
»quœe
('pf.utils')

15 -- 
TODO
: 
»Çme
 
the
 'libpÿp' 
İtiÚ
 
to
 
»duû
 
‹rmšŞogy
 
ov”lßd


16 
loÿl
 
compe_deçuÉs
 = {

17 
İtimize
=
Œue
, 
	glibpÿp
=
çl£
, 
	gbpf
=çl£, 
	gsourû
=false

19 
funùiÚ
 
	$compe_f‹r
(
f‹r_¡r
, 
İts
)

20 
loÿl
 
İts
 = 
uts
.
	`·r£_İts
(İt 
Ü
 {
	}
}, 
	gcompe_deçuÉs
)

21 
loÿl
 
	gdÉ
 = 
İts
.
dÉ
 
Ü
 "EN10MB"

22 
İts
.
libpÿp
 
th’


23 
loÿl
 
by‹code
 = 
libpÿp
.
	$compe
(
f‹r_¡r
, 
dÉ
, 
İts
.
İtimize
)

24 
İts
.
sourû
 
th’
  
bpf
.
	$di§s£mbË
(
by‹code
è
’d


25 
loÿl
 
h—d”
 = 
ty³s
.
	$pÿp_pkthdr
(0, 0, 0, 0)

26  
	$funùiÚ
(
P
, 
Ën
)

27 
h—d”
.
šş_Ën
 = 
Ën


28 
h—d”
.
Üig_Ën
 = 
Ën


29  
libpÿp
.
	`ofæše_f‹r
(
by‹code
, 
h—d”
, 
P
) ~= 0

30 
’d


31 
–£if
 
İts
.
bpf
 
th’


32 
loÿl
 
by‹code
 = 
libpÿp
.
	$compe
(
f‹r_¡r
, 
dÉ
, 
İts
.
İtimize
)

33 
İts
.
sourû
 
th’
  
bpf
.
	$compe_lua
(
by‹code
è
’d


34  
bpf
.
	$compe
(
by‹code
)

35 -- 
pæua


36 
loÿl
 
ex´
 = 
·r£
.
	$·r£
(
f‹r_¡r
)

37 
ex´
 = 
ex·nd
.
	$ex·nd
(
ex´
, 
dÉ
)

38 
İts
.
İtimize
 
th’
 
ex´
 = o±imize.
	$İtimize
(
ex´
è
’d


39 
ex´
 = 
ªf
.
	$cÚv”t_ªf
(
ex´
)

40 
ex´
 = 
s§
.
	$cÚv”t_s§
(
ex´
)

41 
İts
.
sourû
 
th’
  
back’d
.
	$em™_lua
(
ex´
è
’d


42  
back’d
.
	$em™_ªd_lßd
(
ex´
, 
f‹r_¡r
)

43 
’d


44 
’d


46 
funùiÚ
 
	$£láe¡
 ()

47 
	`´št
("selftest:…f")

49 
loÿl
 
funùiÚ
 
	$‹¡_nuÎ
(
¡r
)

50 
loÿl
 
f1
 = 
	`compe_f‹r
(
¡r
, { 
libpÿp
 = 
Œue
 
	}
})

51 
loÿl
 
	gf2
 = 
compe_f‹r
(
¡r
, { 
bpf
 = 
Œue
 })

52 
loÿl
 
	gf3
 = 
compe_f‹r
(
¡r
, {})

53 
as£¹
(
f1
(
¡r
, 0è=ğ
çl£
, "null…acket should be„ejected (libpcap)")

54 
as£¹
(
f2
(
¡r
, 0è=ğ
çl£
, "null…acket should be„ejected (bpf)")

55 
as£¹
(
f3
(
¡r
, 0è=ğ
çl£
, "null…acket should be„ejected (pflua)")

56 
’d


57 
‹¡_nuÎ
("icmp")

58 
‹¡_nuÎ
("tcp…ort 80‡nd (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)")

60 
loÿl
 
funùiÚ
 
	$as£¹_couÁ
(
f‹r
, 
·ck‘s
, 
ex³ùed
)

61 
funùiÚ
 
	$couÁ_m©ched
(
´ed
)

62 
loÿl
 
m©ched
 = 0

63 
i
=1,#packets do

64 
	$´ed
(
·ck‘s
[
i
].
·ck‘
,…ack‘s[i].
Ën
è
th’


65 
m©ched
 = matched + 1

66 
’d


67 
’d


68  
m©ched


69 
’d


71 
loÿl
 
f1
 = 
	`compe_f‹r
(
f‹r
, { 
libpÿp
 = 
Œue
 
	}
})

72 
loÿl
 
	gf2
 = 
compe_f‹r
(
f‹r
, { 
bpf
 = 
Œue
 })

73 
loÿl
 
	gf3
 = 
compe_f‹r
(
f‹r
, {})

74 
loÿl
 
aùu®


75 
	gaùu®
 = 
	$couÁ_m©ched
(
f1
)

76 
	`as£¹
(
aùu®
 =ğ
ex³ùed
,

77 'libpÿp: gÙ ' .. 
aùu®
 .. ',ƒx³ùed ' .. 
ex³ùed
)

78 
aùu®
 = 
	$couÁ_m©ched
(
f2
)

79 
	`as£¹
(
aùu®
 =ğ
ex³ùed
,

80 'bpf: gÙ ' .. 
aùu®
 .. ',ƒx³ùed ' .. 
ex³ùed
)

81 
aùu®
 = 
	$couÁ_m©ched
(
f3
)

82 
	`as£¹
(
aùu®
 =ğ
ex³ùed
,

83 'pæua: gÙ ' .. 
aùu®
 .. ',ƒx³ùed ' .. 
ex³ùed
)

84 
’d


85 
loÿl
 
v4
 = 
§vefe
.
	`lßd_·ck‘s
("../tests/data/v4.pcap")

86 
	`as£¹_couÁ
('', 
v4
, 43)

87 
	`as£¹_couÁ
('', 
v4
, 43)

88 
	`as£¹_couÁ
('tı', 
v4
, 41)

89 
	`as£¹_couÁ
('tı…Üˆ80', 
v4
, 41)

91 
	`´št
("OK")

92 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/anf.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

5 
loÿl
 
£t
, 
µ
, 
dup
 = 
uts
.set, utils.pp, utils.dup

7 
loÿl
 
»lİs
 = 
	`£t
('<', '<=', '=', '!=', '>=', '>')

9 
loÿl
 
bšİs
 = 
	`£t
(

12 
loÿl
 
unİs
 = 
	`£t
('ntohs', 'ntohl', 'uint32', 'int32')

14 
loÿl
 
sim¶e
 = 
	`£t
('true', 'false', 'match', 'fail')

16 
loÿl
 
couÁ
 = 0

18 
loÿl
 
funùiÚ
 
	$äesh
()

19 
couÁ
 = count + 1

20  'v¬'..
couÁ


21 
’d


23 
loÿl
 
funùiÚ
 
	$low”_¬™h
(
ex´
, 
k
)

24 
	`ty³
(
ex´
è~ğ'bË' 
th’
  
	$k
(
ex´
è
’d


25 
loÿl
 
İ
 = 
ex´
[1]

26 
unİs
[
İ
] 
th’


27 
loÿl
 
İ”ªd
 = 
ex´
[2]

28 
loÿl
 
funùiÚ
 
	$have_İ”ªd
(
İ”ªd
)

29 
loÿl
 
»suÉ
 = 
	$äesh
()

30  { 'Ët', 
»suÉ
, { 
İ
, 
İ”ªd
 }, 
	`k
ÔesuÉè
	}
}

31 
’d


32  
	$low”_¬™h
(
İ”ªd
, 
have_İ”ªd
)

33 
–£if
 
bšİs
[
İ
] 
th’


34 
loÿl
 
lhs
, 
rhs
 = 
ex´
[2],ƒxpr[3]

35 
loÿl
 
funùiÚ
 
	$have_lhs
(
lhs
)

36 
loÿl
 
funùiÚ
 
	$have_rhs
(
rhs
)

37 
loÿl
 
»suÉ
 = 
	$äesh
()

38  { 'Ët', 
»suÉ
, { 
İ
, 
lhs
, 
rhs
}, 
	`k
ÔesuÉè
	}
}

39 
’d


40  
	$low”_¬™h
(
rhs
, 
have_rhs
)

41 
’d


42  
	$low”_¬™h
(
lhs
, 
have_lhs
)

44 
	`as£¹
(
İ
 == '[]')

45 
loÿl
 
İ”ªd
, 
size
 = 
ex´
[2],ƒxpr[3]

46 
loÿl
 
funùiÚ
 
	$have_İ”ªd
(
İ”ªd
)

47 
loÿl
 
»suÉ
 = 
	$äesh
()

48  { 'Ët', 
»suÉ
, { 
İ
, 
İ”ªd
, 
size
 }, 
	`k
ÔesuÉè
	}
}

49 
’d


50  
	$low”_¬™h
(
İ”ªd
, 
have_İ”ªd
)

51 
’d


52 
’d


54 
loÿl
 
funùiÚ
 
	$low”_com·risÚ
(
ex´
, 
k
)

55 
loÿl
 
İ
, 
lhs
, 
rhs
 = 
ex´
[1],ƒxpr[2],ƒxpr[3]

56 
	$as£¹
(
»lİs
[
İ
])

57 
loÿl
 
funùiÚ
 
	$have_lhs
(
lhs
)

58 
loÿl
 
funùiÚ
 
	$have_rhs
(
rhs
)

59  
	`k
({ 
İ
, 
lhs
, 
rhs
 
	}
})

60 
’d


61  
	$low”_¬™h
(
rhs
, 
have_rhs
)

62 
’d


63  
	$low”_¬™h
(
lhs
, 
have_lhs
)

64 
’d


66 
loÿl
 
funùiÚ
 
	$low”_boŞ
(
ex´
, 
k
)

67 
loÿl
 
funùiÚ
 
	$low”
(
ex´
)

68 
loÿl
 
funùiÚ
 
	$have_boŞ
(
ex´
)

69  
ex´


70 
’d


71  
	$low”_boŞ
(
ex´
, 
have_boŞ
)

72 
’d


73 
loÿl
 
İ
 = 
ex´
[1]

74 
İ
 =ğ'if' 
th’


75 
loÿl
 
‹¡
, 
t
, 
f
 = 
ex´
[2],ƒxpr[3],ƒxpr[4]

76 
loÿl
 
funùiÚ
 
	$have_‹¡
(
‹¡
)

77  
	`k
({ 'if', 
‹¡
, 
	`low”
(
t
),†ow”(
f
è
	}
})

78 
’d


79  
	$low”_boŞ
(
‹¡
, 
have_‹¡
)

80 
–£if
 
sim¶e
[
İ
] 
th’


81  
	$k
(
ex´
)

82 
–£if
 
İ
 =ğ'ÿÎ' 
th’


83 
loÿl
 
out
 = { 'ÿÎ', 
ex´
[2] 
	}
}

84 
loÿl
 
funùiÚ
 
	$low”_¬g
(
i
)

85 
i
 > #ex´ 
th’
  
	$k
(
out
è
’d


86 
loÿl
 
funùiÚ
 
	$have_¬g
(
¬g
)

87 
out
[
i
] = 
¬g


88  
	`low”_¬g
(
i
 + 1)

89 
’d


90  
	$low”_¬™h
(
ex´
[
i
], 
have_¬g
)

91 
’d


92  
	$low”_¬g
(3)

94  
	$low”_com·risÚ
(
ex´
, 
k
)

95 
’d


96 
’d


98 
loÿl
 
funùiÚ
 
	$low”
(
ex´
)

99 
couÁ
 = 0

100 
loÿl
 
funùiÚ
 
	$have_boŞ
(
ex´
)

101  
ex´


102 
’d


103  
	$low”_boŞ
(
ex´
, 
have_boŞ
)

104 
’d


106 
loÿl
 
funùiÚ
 
	$c£
(
ex´
)

107 
loÿl
 
»¶aûm’ts
 = {
	}
}

108 
loÿl
 
funùiÚ
 
	$lookup
(
ex´
)

109  
»¶aûm’ts
[
ex´
] 
Ü
ƒxpr

110 
’d


111 
loÿl
 
funùiÚ
 
	$vis™
(
ex´
, 
’v
)

112 
	`ty³
(
ex´
è=ğ'numb”' 
th’
 ƒx´ 
’d


113 
	`ty³
(
ex´
è=ğ'¡ršg' 
th’
  
	$lookup
(
ex´
è
’d


114 
loÿl
 
İ
 = 
ex´
[1]

115 
İ
 =ğ'Ët' 
th’


116 
loÿl
 
v¬
, 
v®
, 
body
 = 
ex´
[2],ƒxpr[3],ƒxpr[4]

117 
	`as£¹
(
	`ty³
(
v®
) == 'table')

118 
loÿl
 
¬™h_İ
 = 
v®
[1]

119 
loÿl
 
key
, 
»¶aûm’t_v®


120 
unİs
[
¬™h_İ
] 
th’


121 
loÿl
 
lhs
 = 
	$vis™
(
v®
[2], 
’v
)

122 
key
 = 
¬™h_İ
..','..
lhs


123 
»¶aûm’t_v®
 = { 
¬™h_İ
, 
lhs
 
	}
}

124 
–£if
 
bšİs
[
¬™h_İ
] 
th’


125 
loÿl
 
lhs
, 
	grhs
 = 
vis™
(
v®
[2], 
’v
), 
	$vis™
(
v®
[3], 
’v
)

126 
key
 = 
¬™h_İ
..','..
lhs
..','..
rhs


127 
»¶aûm’t_v®
 = { 
¬™h_İ
, 
lhs
, 
rhs
 
	}
}

129 
as£¹
(
¬™h_İ
 == '[]')

130 
loÿl
 
lhs
, 
	gsize
 = 
vis™
(
v®
[2], 
’v
), 
	gv®
[3]

131 
	gkey
 = 
¬™h_İ
..','..
lhs
..','..
size


132 
»¶aûm’t_v®
 = { 
¬™h_İ
, 
lhs
, 
size
 }

133 
’d


134 
loÿl
 
c£_v¬
 = 
’v
[
key
]

135 
c£_v¬
 
th’


136 
»¶aûm’ts
[
v¬
] = 
c£_v¬


137  
	$vis™
(
body
, 
’v
)

139 
’v
 = 
	$dup
(
’v
)

140 
’v
[
key
] = 
v¬


141  { 'Ët', 
v¬
, 
»¶aûm’t_v®
, 
	`vis™
(
body
, 
’v
è
	}
}

142 
’d


143 
–£if
 
İ
 =ğ'if' 
th’


144  { 'if', 
vis™
(
ex´
[2], 
’v
), visit(expr[3],ƒnv), visit(expr[4],ƒnv) }

145 
–£if
 
sim¶e
[
İ
] 
th’


146  
ex´


147 
–£if
 
İ
 =ğ'ÿÎ' 
th’


148 
loÿl
 
out
 = { 'ÿÎ', 
ex´
[2] }

149 
i
=3,#ex´ dØ
	gbË
.
š£¹
(
out
, 
	$vis™
(
ex´
[
i
], 
’v
)è
’d


150  
out


152 
	$as£¹
(
»lİs
[
İ
])

153  { 
İ
, 
	`vis™
(
ex´
[2], 
’v
), vis™Óx´[3],ƒnvè
	}
}

154 
’d


155 
’d


156  
vis™
(
ex´
, {})

157 
’d


159 
loÿl
 
funùiÚ
 
	$šlše_sšgË_u£_v¬ŸbËs
(
ex´
)

160 
loÿl
 
couÁs
, 
sub¡s
 = {
	}
}, {}

161 
loÿl
 
funùiÚ
 
	$couÁ
(
ex´
)

162 
ex´
 =ğ'Ën' 
th’
 

163 
–£if
 
	`ty³
(
ex´
è=ğ'numb”' 
th’
 

164 
–£if
 
	`ty³
(
ex´
è=ğ'¡ršg' 
th’
 
couÁs
[expr] = counts[expr] + 1

166 
	`as£¹
(
	`ty³
(
ex´
) == 'table')

167 
loÿl
 
İ
 = 
ex´
[1]

168 
İ
 =ğ'if' 
th’


169 
	$couÁ
(
ex´
[2])

170 
	$couÁ
(
ex´
[3])

171 
	$couÁ
(
ex´
[4])

172 
–£if
 
İ
 =ğ'Ët' 
th’


173 
couÁs
[
ex´
[2]] = 0

174 
	$couÁ
(
ex´
[3])

175 
	$couÁ
(
ex´
[4])

176 
–£if
 
»lİs
[
İ
] 
th’


177 
	$couÁ
(
ex´
[2])

178 
	$couÁ
(
ex´
[3])

179 
–£if
 
unİs
[
İ
] 
th’


180 
	$couÁ
(
ex´
[2])

181 
–£if
 
bšİs
[
İ
] 
th’


182 
	$couÁ
(
ex´
[2])

183 
	$couÁ
(
ex´
[3])

184 
–£if
 
sim¶e
[
İ
] 
th’


186 
–£if
 
İ
 =ğ'ÿÎ' 
th’


187 
i
=3,#ex´ dØ
	$couÁ
(
ex´
[
i
]è
’d


189 
	`as£¹
(
İ
 == '[]')

190 
	$couÁ
(
ex´
[2])

191 
’d


192 
’d


193 
’d


194 
loÿl
 
funùiÚ
 
	$lookup
(
ex´
)

195  
sub¡s
[
ex´
] 
Ü
ƒxpr

196 
’d


197 
loÿl
 
funùiÚ
 
	$sub¡
(
ex´
)

198 
	`ty³
(
ex´
è=ğ'numb”' 
th’
 ƒx´ 
’d


199 
	`ty³
(
ex´
è=ğ'¡ršg' 
th’
  
	$lookup
(
ex´
è
’d


200 
loÿl
 
İ
 = 
ex´
[1]

201 
İ
 =ğ'Ët' 
th’


202 
loÿl
 
v¬
, 
v®
, 
body
 = 
ex´
[2],ƒxpr[3],ƒxpr[4]

203 
	`as£¹
(
	`ty³
(
v®
) == 'table')

204 
loÿl
 
¬™h_İ
 = 
v®
[1]

205 
loÿl
 
»¶aûm’t_v®


206 
unİs
[
¬™h_İ
] 
th’


207 
loÿl
 
lhs
 = 
	$sub¡
(
v®
[2])

208 
»¶aûm’t_v®
 = { 
¬™h_İ
, 
lhs
 
	}
}

209 
–£if
 
bšİs
[
¬™h_İ
] 
th’


210 
loÿl
 
lhs
, 
	grhs
 = 
sub¡
(
v®
[2]), 
	$sub¡
(
v®
[3])

211 
»¶aûm’t_v®
 = { 
¬™h_İ
, 
lhs
, 
rhs
 
	}
}

213 
as£¹
(
¬™h_İ
 == '[]')

214 
loÿl
 
lhs
, 
	gsize
 = 
sub¡
(
v®
[2]), 
	gv®
[3]

215 
	g»¶aûm’t_v®
 = { 
¬™h_İ
, 
lhs
, 
size
 }

216 
’d


217 
couÁs
[
v¬
] =ğ1 
th’


218 
sub¡s
[
v¬
] = 
»¶aûm’t_v®


219  
	$sub¡
(
body
)

221  { 'Ët', 
v¬
, 
»¶aûm’t_v®
, 
	`sub¡
(
body
è
	}
}

222 
’d


223 
–£if
 
İ
 =ğ'if' 
th’


224  { 'if', 
sub¡
(
ex´
[2]), subst(expr[3]), subst(expr[4]) }

225 
–£if
 
sim¶e
[
İ
] 
th’


226  
ex´


227 
–£if
 
İ
 =ğ'ÿÎ' 
th’


228 
loÿl
 
out
 = { 'ÿÎ', 
ex´
[2] }

229 
i
=3,#ex´ dØ
	gbË
.
š£¹
(
out
, 
	$sub¡
(
ex´
[
i
])è
’d


230  
out


232 
	$as£¹
(
»lİs
[
İ
])

233  { 
İ
, 
	`sub¡
(
ex´
[2]), sub¡Óx´[3]è
	}
}

234 
’d


235 
’d


236 
	$couÁ
(
ex´
)

237  
	$sub¡
(
ex´
)

238 
’d


240 
loÿl
 
funùiÚ
 
	$»numb”
(
ex´
)

241 
loÿl
 
couÁ
, 
sub¡s
 = 0, {
	}
}

242 
loÿl
 
funùiÚ
 
	$š‹º
(
v¬
)

243 
couÁ
 = count + 1

244 
loÿl
 
äesh
 = 'v'..
couÁ


245 
sub¡s
[
v¬
] = 
äesh


246  
äesh


247 
’d


248 
loÿl
 
funùiÚ
 
	$lookup
(
v¬
)

249 
v¬
 =ğ'Ën' 
th’
  v¬ 
’d


250  
	`as£¹
(
sub¡s
[
v¬
], "unbound variable: "..var)

251 
’d


252 
loÿl
 
funùiÚ
 
	$vis™
(
ex´
)

253 
	`ty³
(
ex´
è=ğ'numb”' 
th’
 ƒx´ 
’d


254 
	`ty³
(
ex´
è=ğ'¡ršg' 
th’
  
	$lookup
(
ex´
è
’d


255 
loÿl
 
İ
 = 
ex´
[1]

256 
İ
 =ğ'Ët' 
th’


257 
loÿl
 
v¬
, 
v®
, 
body
 = 
ex´
[2],ƒxpr[3],ƒxpr[4]

258 
loÿl
 
äesh
 = 
	$š‹º
(
v¬
)

259  { 'Ët', 
äesh
, 
	`vis™
(
v®
), vis™(
body
è
	}
}

260 
–£if
 
İ
 =ğ'if' 
th’


261  { 'if', 
vis™
(
ex´
[2]), visit(expr[3]), visit(expr[4]) }

262 
–£if
 
sim¶e
[
İ
] 
th’


263  
ex´


264 
–£if
 
İ
 =ğ'ÿÎ' 
th’


265 
loÿl
 
out
 = { 'ÿÎ', 
ex´
[2] }

266 
i
=3,#ex´ dØ
	gbË
.
š£¹
(
out
, 
	$vis™
(
ex´
[
i
])è
’d


267  
out


268 
–£if
 
»lİs
[
İ
] 
th’


269  { 
İ
, 
	`vis™
(
ex´
[2]), vis™Óx´[3]è
	}
}

270 
–£if
 
	gunİs
[
İ
] 
th’


271  { 
	gİ
, 
vis™
(
ex´
[2]) }

272 
–£if
 
	gbšİs
[
İ
] 
th’


273  { 
	gİ
, 
vis™
(
ex´
[2]), visit(expr[3]) }

275 
as£¹
(
İ
 == '[]')

276  { 
İ
, 
vis™
(
ex´
[2]),ƒxpr[3] }

277 
’d


278 
’d


279  
	$vis™
(
ex´
)

280 
’d


282 
funùiÚ
 
	$cÚv”t_ªf
(
ex´
)

283  
	`»numb”
(
	`šlše_sšgË_u£_v¬ŸbËs
(
	`c£
(
	$low”
(
ex´
))))

284 
’d


286 
funùiÚ
 
	$£láe¡
()

287 
loÿl
 
·r£
 = 
	`»quœe
('pf.parse').parse

288 
loÿl
 
ex·nd
 = 
	`»quœe
('pf.expand').expand

289 
loÿl
 
İtimize
 = 
	`»quœe
('pf.optimize').optimize

290 
loÿl
 
funùiÚ
 
	$‹¡
(
ex´
)

291  
	`cÚv”t_ªf
(
	`İtimize
(
	`ex·nd
(
	`·r£
(
ex´
), "EN10MB")))

292 
’d


293 
	`´št
("selftest:…f.anf")

294 
	`‹¡
("tcp…ort 80")

295 
	`´št
("OK")

296 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/backend.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

5 
loÿl
 
v”bo£
 = 
os
.
	`g‘’v
("PF_VERBOSE");

7 
loÿl
 
£t
, 
µ
 = 
uts
.set, utils.pp

9 
loÿl
 
»lİ_m­
 = {

11 
	}
}

13 
loÿl
 
	g»lİ_šv”siÚs
 = {

17 
loÿl
 
	gsim¶e_»suÉs
 = 
£t
('true', 'false', 'call')

19 
loÿl
 
funùiÚ
 
	$šv”t_boŞ
(
ex´
)

20 
ex´
[1] =ğ'Œue' 
th’
  { 'çl£' 
	}
} 
’d


21 
ex´
[1] =ğ'çl£' 
th’
  { 'Œue' } 
’d


22 
	$as£¹
(
»lİ_šv”siÚs
[
ex´
[1]])

23  { 
»lİ_šv”siÚs
[
ex´
[1]],ƒx´[2],ƒx´[3] 
	}
}

24 
’d


26 
loÿl
 
funùiÚ
 
is_sim¶e_ex´
(
ex´
)

27 -- 
Sim¶e
 :ğ 
Œue
 |  
çl£
 |  
ÿÎ
 | 
Lab–


28 
ex´
[1] =ğ'»tuº' 
th’
  
sim¶e_»suÉs
[ex´[2][1]] 
’d


29  
ex´
[1] == 'goto'

30 
’d


32 -- 
Lua
 :ğ
Do
 | 
R‘uº
 | 
GÙo
 | 
If
 | 
Bšd
 | 
Lab–


33 -- 
Do
 :ğ'do' 
Lua
+

34 -- 
R‘uº
 :ğ'»tuº' 
BoŞ
|
C®l


35 -- 
GÙo
 :ğ'gÙo' 
Lab–


36 -- 
If
 :ğ'if' 
BoŞ
 
Lua
 Lua?

37 -- 
Bšd
 :ğ'bšd' 
Name
 
Ex´


38 -- 
Lab–
 :ğ'Ïb–' 
Lua


39 
loÿl
 
funùiÚ
 
»sidu®ize_lua
(
´og¿m
)

40 -- 
wr™e
 
blocks
, 
scİe
 
is
 
domš©Ü
 
Œ“


41 
loÿl
 
funùiÚ
 
	$Ã¡
(
block
, 
»suÉ
, 
kÃxt
)

42 
_
, 
bšdšg
 
š
 
	$aœs
(
block
.
bšdšgs
) do

43 
bË
.
	`š£¹
(
»suÉ
, { 'bšd', 
bšdšg
.
Çme
, bšdšg.
v®ue
 
	}
})

44 
’d


45 
loÿl
 
	gcÚŒŞ
 = 
block
.
cÚŒŞ


46 
cÚŒŞ
[1] =ğ'gÙo' 
th’


47 
loÿl
 
succ
 = 
´og¿m
.
blocks
[
cÚŒŞ
[2]]

48 
succ
.
idom
 =ğ
block
.
Ïb–
 
th’


49 
	$Ã¡
(
succ
, 
»suÉ
)

51 
bË
.
	$š£¹
(
»suÉ
, 
cÚŒŞ
)

52 
’d


53 
–£if
 
cÚŒŞ
[1] =ğ'»tuº' 
th’


54 
bË
.
	$š£¹
(
»suÉ
, 
cÚŒŞ
)

56 
	`as£¹
(
cÚŒŞ
[1] == 'if')

57 
loÿl
 
‹¡
, 
t_Ïb–
, 
f_Ïb–
 = 
cÚŒŞ
[2], control[3], control[4]

58 
loÿl
 
t_block
, 
f_block
 = 
´og¿m
.
blocks
[
t_Ïb–
],…rog¿m.blocks[
f_Ïb–
]

59 
loÿl
 
ex´
 = { 'if', 
‹¡
, { 'do' }, { 'do' } 
	}
}

60 -- 
Fœ¡
, 
add
 
the
 
	g‹¡
.

61 
	gbË
.
š£¹
(
»suÉ
, 
ex´
)

62 -- 
Th’
 
fl
 
š
 
the
 
Ã¡ed
 
th’
 
ªd
 
	g¬ms
, 
they
 
have
 
	gno


63 -- 
Ùh”
 
	g´edeûssÜs
.

64 #t_block.
	g´eds
 =ğ1 
th’


65 
	$as£¹
(
t_block
.
idom
 =ğ
block
.
Ïb–
)

66 
	$Ã¡
(
t_block
, 
ex´
[3])

68 
bË
.
	`š£¹
(
ex´
[3], { 'gÙo', 
t_Ïb–
 
	}
})

69 
’d


70 #f_block.
	g´eds
 =ğ1 
th’


71 
	$as£¹
(
f_block
.
idom
 =ğ
block
.
Ïb–
)

72 
	$Ã¡
(
f_block
, 
ex´
[4])

74 
bË
.
	`š£¹
(
ex´
[4], { 'gÙo', 
f_Ïb–
 
	}
})

75 
	g’d


76 -- 
Fš®ly
 
add
 
immedŸ‹ly
 
domš©ed
 
	gblocks
, 
w™h
 
	gÏb–s
. 
	gWe


77 -- 
Úly
 
have
 
to
 dØ
this
 
	gš
 "if" 
blocks
 
	gbeÿu£
 "»tuº" 
	gblocks


78 -- 
have
 
no
 
	gsucûssÜs
, 
	gªd
 "gÙo" 
blocks
 dØ
nÙ
 
	gimmedŸ‹ly


79 -- 
domš©e
 
blocks
 
th©
 
¬e
 
nÙ
 
theœ
 
	gsucûssÜs
.

80 
	g_
,
Ïb–
 
š
 
	$aœs
(
block
.
doms
) do

81 
loÿl
 
dom_block
 = 
´og¿m
.
blocks
[
Ïb–
]

82 #dom_block.
´eds
 ~ğ1 
th’


83 
loÿl
 
w¿p
 = { 'Ïb–', 
Ïb–
, { 'do' } 
	}
}

84 
bË
.
	$š£¹
(
»suÉ
, 
w¿p
)

85 
	$Ã¡
(
dom_block
, 
w¿p
[3])

86 
’d


87 
’d


88 
’d


89 
’d


90 
loÿl
 
»suÉ
 = { 'do' 
	}
}

91 
	$Ã¡
(
´og¿m
.
blocks
[´og¿m.
¡¬t
], 
»suÉ
, 
n
)

92  
»suÉ


93 
’d


95 -- 
Lua
 :ğ
Do
 | 
R‘uº
 | 
GÙo
 | 
If
 | 
Bšd
 | 
Lab–


96 -- 
Do
 :ğ'do' 
Lua
+

97 -- 
R‘uº
 :ğ'»tuº' 
BoŞ
|
C®l


98 -- 
GÙo
 :ğ'gÙo' 
Lab–


99 -- 
If
 :ğ'if' 
BoŞ
 
Lua
 Lua?

100 -- 
Bšd
 :ğ'bšd' 
Name
 
Ex´


101 -- 
Lab–
 :ğ'Ïb–' 
Lua


102 
loÿl
 
funùiÚ
 
	$ş—nup
(
ex´
, 
is_Ï¡
)

103 
loÿl
 
funùiÚ
 
	$¥liû_
(
»suÉ
, 
ex´
)

104 
ex´
[1] =ğ'do' 
th’


105 -- 
S¶iû
 
a
 

 "do" 
što
 
the
 
·»Á
 do.

106 
j
=2,#expr do

107 
j
==#ex´ 
th’


108 
	$¥liû_
(
»suÉ
, 
ex´
[
j
])

110 
bË
.
	$š£¹
(
»suÉ
, 
ex´
[
j
])

111 
’d


112 
’d


114 
–£if
 
ex´
[1] =ğ'if' 
th’


115 
ex´
[3][1] =ğ'»tuº' 
Ü
ƒx´[3][1] =ğ'gÙo' 
th’


116 -- 
S¶iû
 
the
 
cÚ£qu’t
 
of
 
a
 

 "if" 
što
h
·»Á
 do.

117 
bË
.
	`š£¹
(
»suÉ
, { 'if', 
ex´
[2],ƒx´[3] 
	}
})

118 
	gex´
[4] 
th’
 
	$¥liû_
(
»suÉ
, 
ex´
[4]è
’d


120 
’d


121 
–£if
 
ex´
[1] =ğ'Ïb–' 
th’


122 -- 
Likewi£
, 
Œy
 
to
 
¥liû
 
the
 
body
 
of
 
a
 

 
Ïb–Ëd


123 -- 
¡©em’t
.

124 
loÿl
 

 = { 'do' 
	}
}

125 
	$¥liû_
(

, 
ex´
[3])

126 # > 2 
th’


127 
bË
.
	`š£¹
(
»suÉ
, { 'Ïb–', 
ex´
[2], 

[2] 
	}
})

128 
	gi
=3,# dØ
	gbË
.
	$š£¹
(
»suÉ
, 

[
i
]è
’d


130 
’d


131 
’d


132 
bË
.
	$š£¹
(
»suÉ
, 
ex´
)

133 
’d


134 
loÿl
 
İ
 = 
ex´
[1]

135 
İ
 =ğ'do' 
th’


136 #ex´ =ğ2 
th’
  
	$ş—nup
(
ex´
[2], 
is_Ï¡
è
’d


137 
loÿl
 
»suÉ
 = { 'do' 
	}
}

138 
i
=2,#expr do

139 
loÿl
 
	gsubex´
 = 
ş—nup
(
ex´
[
i
], i==#expr)

140 
i
==#ex´ 
th’


141 
	$¥liû_
(
»suÉ
, 
subex´
)

143 
bË
.
	$š£¹
(
»suÉ
, 
subex´
)

144 
’d


145 
’d


146  
»suÉ


147 
–£if
 
İ
 =ğ'»tuº' 
th’


148  
ex´


149 
–£if
 
İ
 =ğ'gÙo' 
th’


150  
ex´


151 
–£if
 
İ
 =ğ'if' 
th’


152 
loÿl
 
‹¡
, 
t
, 
f
 = 
ex´
[2], 
	`ş—nup
Óx´[3], 
Œue
), 
	$ş—nup
(
ex´
[4], 
Œue
)

153 
nÙ
 
	$is_sim¶e_ex´
(
t
è
ªd
 
	$is_sim¶e_ex´
(
f
è
th’


154 
‹¡
, 
t
, 
f
 = 
	`šv”t_boŞ
(test), f,

155 
’d


156 
	$is_sim¶e_ex´
(
t
è
ªd
 
is_Ï¡
 
th’


157 
loÿl
 
»suÉ
 = { 'do', { 'if', 
‹¡
, 
t
 } 
	}
}

158 
	$¥liû_
(
»suÉ
, 
f
)

159  
»suÉ


161  { 'if', 
‹¡
, 
t
, 
f
 
	}
}

162 
’d


163 
–£if
 
	gİ
 =ğ'bšd' 
th’


164  
ex´


166 
as£¹
 (
İ
 == 'label')

167  { 'Ïb–', 
ex´
[2], 
ş—nup
Óx´[3], 
is_Ï¡
) }

168 
’d


169 
’d


171 
loÿl
 
funùiÚ
 
f‹r_bud”
(...)

172 -- 
Re£rve
 
fœ¡
 
·¹
 
lib¿r›s
.

173 
loÿl
 
·¹s
 = {'', 'return function('}

174 
loÿl
 
Å¬ts
 = 2

175 
loÿl
 
šd’t
 = ''

176 
loÿl
 
lib¿r›s
 = {}

177 
loÿl
 
bud”
 = {}

178 
funùiÚ
 
bud”
.
	$wr™e
(
¡r
)

179 
Å¬ts
 =‚parts + 1

180 
·¹s
[
Å¬ts
] = 
¡r


181 
’d


182 
funùiÚ
 
bud”
.
	$wr™–n
(
¡r
)

183 
bud”
.
	`wr™e
(
šd’t
 .. 
¡r
 .. '\n')

184 
’d


185 
funùiÚ
 
bud”
.
	$bšd
(
v¬
, 
v®
)

186 
bud”
.
	`wr™–n
('loÿÈ'..
v¬
..' = '..
v®
)

187 
’d


188 
funùiÚ
 
bud”
.
	$push
()

189 
šd’t
 = indent .. ' '

190 
’d


191 
funùiÚ
 
bud”
.
	$–£_
()

192 
bud”
.
	`wr™e
(
šd’t
:
	`sub
(4) .. 'else\n')

193 
’d


194 
funùiÚ
 
bud”
.
	$pİ
()

195 
šd’t
 = ind’t:
	$sub
(4)

196 
bud”
.
	`wr™–n
('end')

197 
’d


198 
funùiÚ
 
bud”
.
	$jump
(
Ïb–
)

199 
bud”
.
	`wr™–n
('gÙØ'..
Ïb–
)

200 
’d


201 
funùiÚ
 
bud”
.
	$wr™–ab–
(
Ïb–
)

202 
bud”
.
	`wr™e
('::'..
Ïb–
..'::\n')

203 
’d


204 
funùiÚ
 
bud”
.
	$c
(
¡r
)

205 
loÿl
 
lib
, 
func
 = 
¡r
:
	`m©ch
('([a-z]+).([a-z]+)')

206 
lib¿r›s
[
¡r
] 
th’
  
func
 
’d


207 
lib¿r›s
[
¡r
] = 'loÿÈ'..
func
..' =„equœe("'..
lib
..'").'..func

208  
func


209 
’d


210 
funùiÚ
 
bud”
.
	$h—d”
()

211 
_
,
lib¿ry
 
š
 
	$·œs
(
lib¿r›s
) do

212 
·¹s
[1] = 
lib¿ry
.."\n"..parts[1]

213 
’d


214 
’d


215 
funùiÚ
 
bud”
.
	$fšish
()

216 
bud”
.
	$pİ
()

217 
bud”
.
	$h—d”
()

218 
loÿl
 
wr™‹n
 = 
bË
.
	$cÚÿt
(
·¹s
)

219 
v”bo£
 
th’
 
	$´št
(
wr™‹n
è
’d


220  
wr™‹n


221 
’d


222 
loÿl
 
Ãeds_comma
 = 
çl£


223 
_
, 
v
 
š
 
	`aœs
({...
	}
}) do

224 
Ãeds_comma
 
th’
 
	gbud”
.
wr™e
(','è
’d


225 
	gbud”
.
	$wr™e
(
v
)

226 
Ãeds_comma
 = 
Œue


227 
’d


228 
bud”
.
	`wr™e
(')\n')

229 
bud”
.
	$push
()

230  
bud”


231 
’d


233 
loÿl
 
funùiÚ
 
	$»ad_bufãr_wÜd_by_ty³
(
bud”
, 
bufãr
, 
off£t
, 
size
)

234 
size
 =ğ1 
th’


235  
bufãr
..'['..
off£t
..']'

236 
–£if
 
size
 =ğ2 
th’


237  
bud”
.
	`c
('ffi.ÿ¡')..'("ušt16_t*", '..
bufãr
..'+'..
off£t
..')[0]'

238 
–£if
 
size
 =ğ4 
th’


239  (
bud”
.
	`c
('ffi.ÿ¡')..'("ušt32_t*", '..
bufãr
..'+'..
off£t
..')[0]')

241 
	`”rÜ
("bad [] size: "..
size
)

242 
’d


243 
’d


245 
loÿl
 
funùiÚ
 
	$£rŸlize
(
bud”
, 
¡mt
)

246 
loÿl
 
funùiÚ
 
	$£rŸlize_v®ue
(
ex´
)

247 
ex´
 =ğ'Ën' 
th’
  'Ëngth' 
’d


248 
	`ty³
(
ex´
è=ğ'numb”' 
th’
 ƒx´ 
’d


249 
	`ty³
(
ex´
è=ğ'¡ršg' 
th’
 ƒx´ 
’d


250 
	`as£¹
(
	`ty³
(
ex´
è=ğ'bË', 'uÃx³ùedy³ '..
	$ty³
(
ex´
))

251 
loÿl
 
İ
, 
lhs
 = 
ex´
[1], 
	$£rŸlize_v®ue
(
ex´
[2])

252 
İ
 =ğ'Áohs' 
th’
  
bud”
.
	`c
('b™.rshiá')..'('..bud”.c('b™.bsw­')..'('..
lhs
..'), 16)'

253 
–£if
 
İ
 =ğ'Áohl' 
th’
  
bud”
.
	`c
('b™.bsw­')..'('..
lhs
..')'

254 
–£if
 
İ
 =ğ'št32' 
th’
  
bud”
.
	`c
('b™.tob™')..'('..
lhs
..')'

255 
–£if
 
İ
 =ğ'ušt32' 
th’
  '('..
lhs
..' % '.. 2^32 ..')'

256 
’d


257 
loÿl
 
rhs
 = 
	$£rŸlize_v®ue
(
ex´
[3])

258 
İ
 =ğ'[]' 
th’


259  
	`»ad_bufãr_wÜd_by_ty³
(
bud”
, 'P', 
lhs
, 
rhs
)

260 
–£if
 
İ
 =ğ'+' 
th’
  '('..
lhs
..' + '..
rhs
..')'

261 
–£if
 
İ
 =ğ'-' 
th’
  '('..
lhs
..' - '..
rhs
..')'

262 
–£if
 
İ
 =ğ'*' 
th’
  '('..
lhs
..' * '..
rhs
..')'

263 
–£if
 
İ
 =ğ'*64' 
th’


264  'tÚumb”(('..
lhs
..' * 1LL * '..
rhs
..') % '.. 2^32 ..')'

265 
–£if
 
İ
 =ğ'/' 
th’
  
bud”
.
	`c
('m©h.æoÜ')..'('..
lhs
..' / '..
rhs
..')'

266 
–£if
 
İ
 =ğ'&' 
th’
  
bud”
.
	`c
('b™.bªd')..'('..
lhs
..','..
rhs
..')'

267 
–£if
 
İ
 =ğ'^' 
th’
  
bud”
.
	`c
('b™.bxÜ')..'('..
lhs
..','..
rhs
..')'

268 
–£if
 
İ
 =ğ'|' 
th’
  
bud”
.
	`c
('b™.bÜ')..'('..
lhs
..','..
rhs
..')'

269 
–£if
 
İ
 =ğ'<<' 
th’
  
bud”
.
	`c
('b™.lshiá')..'('..
lhs
..','..
rhs
..')'

270 
–£if
 
İ
 =ğ'>>' 
th’
  
bud”
.
	`c
('b™.rshiá')..'('..
lhs
..','..
rhs
..')'

271 
	`”rÜ
('uÃx³ùed op', 
İ
è
’d


272 
’d


274 
loÿl
 
funùiÚ
 
	$£rŸlize_boŞ
(
ex´
)

275 
loÿl
 
İ
 = 
ex´
[1]

276 
İ
 =ğ'Œue' 
th’


278 
–£if
 
İ
 =ğ'çl£' 
th’


280 
–£if
 
»lİ_m­
[
İ
] 
th’


281 -- 
An
 
¬™hm‘ic
 
»lİ
.

282 
loÿl
 
İ
 = 
»lİ_m­
[op]

283 
loÿl
 
lhs
, 
rhs
 = 
	`£rŸlize_v®ue
(
ex´
[2]), 
	$£rŸlize_v®ue
(
ex´
[3])

284  
lhs
..' '..
İ
..' '..
rhs


286 
	`”rÜ
('unhªdËd…rim™ive'..
İ
)

287 
’d


288 
’d


290 
loÿl
 
funùiÚ
 
	$£rŸlize_ÿÎ
(
ex´
)

291 
loÿl
 
¬gs
 = { 'P', 'Ën' 
	}
}

292 
i
=3,#ex´ dØ
	gbË
.
š£¹
(
¬gs
, 
	$£rŸlize_v®ue
(
ex´
[
i
])è
’d


293  '£lf.'..
ex´
[2]..'('..
bË
.
	`cÚÿt
(
¬gs
, ', ')..')'

294 
’d


296 
loÿl
 
£rŸlize_¡©em’t


298 
loÿl
 
funùiÚ
 
	$£rŸlize_£qu’û
(
¡mts
)

299 
¡mts
[1] =ğ'do' 
th’


300 
i
=2,#¡mt dØ
	`£rŸlize_¡©em’t
(
¡mts
[i], i==#¡mtsè
’d


302 
	$£rŸlize_¡©em’t
(
¡mts
, 
Œue
)

303 
’d


304 
’d


306 
funùiÚ
 
	$£rŸlize_¡©em’t
(
¡mt
, 
is_Ï¡
)

307 
loÿl
 
İ
 = 
¡mt
[1]

308 
İ
 =ğ'do' 
th’


309 
bud”
.
	`wr™–n
('do')

310 
bud”
.
	$push
()

311 
	$£rŸlize_£qu’û
(
¡mt
)

312 
bud”
.
	$pİ
()

313 
–£if
 
İ
 =ğ'»tuº' 
th’


314 
nÙ
 
is_Ï¡
 
th’


315  
	`£rŸlize_¡©em’t
({ 'do', 
¡mt
 
	}
}, 
	gçl£
)

316 
’d


317 
	g¡mt
[2][1] =ğ'ÿÎ' 
th’


318 
bud”
.
wr™–n
('»tuº '..
	$£rŸlize_ÿÎ
(
¡mt
[2]))

320 
bud”
.
	`wr™–n
('»tuº '..
	$£rŸlize_boŞ
(
¡mt
[2]))

321 
’d


322 
–£if
 
İ
 =ğ'gÙo' 
th’


323 
bud”
.
	$jump
(
¡mt
[2])

324 
–£if
 
İ
 =ğ'if' 
th’


325 
loÿl
 
‹¡
, 
t
, 
f
 = 
¡mt
[2], stmt[3], stmt[4]

326 
loÿl
 
‹¡_¡r
 = 'ià'..
	`£rŸlize_boŞ
(
‹¡
)..'hen'

327 
	$is_sim¶e_ex´
(
t
è
th’


328 
t
[1] =ğ'»tuº' 
th’


329 
loÿl
 
»suÉ


330 
t
[2][1] =ğ'ÿÎ' 
th’
 
»suÉ
 = 
	$£rŸlize_ÿÎ
(
t
[2])

331 
»suÉ
 = 
	$£rŸlize_boŞ
(
t
[2]è
’d


332 
bud”
.
	`wr™–n
(
‹¡_¡r
..'„‘uº '..
»suÉ
..'ƒnd')

334 
	`as£¹
(
t
[1] == 'goto')

335 
bud”
.
	`wr™–n
(
‹¡_¡r
..' gÙØ'..
t
[2]..'ƒnd')

336 
’d


337 
f
 
th’
 
	$£rŸlize_¡©em’t
(
f
, 
is_Ï¡
è
’d


339 
bud”
.
	$wr™–n
(
‹¡_¡r
)

340 
bud”
.
	$push
()

341 
	$£rŸlize_£qu’û
(
t
)

342 
f
 
th’


343 
bud”
.
	$–£_
()

344 
	$£rŸlize_£qu’û
(
f
)

345 
’d


346 
bud”
.
	$pİ
()

347 
’d


348 
–£if
 
İ
 =ğ'bšd' 
th’


349 
bud”
.
	`bšd
(
¡mt
[2], 
	$£rŸlize_v®ue
(
¡mt
[3]))

351 
	`as£¹
(
İ
 == 'label')

352 
bud”
.
	$wr™–ab–
(
¡mt
[2])

353 
	$£rŸlize_¡©em’t
(
¡mt
[3], 
is_Ï¡
)

354 
’d


355 
’d


356 
	$£rŸlize_£qu’û
(
¡mt
)

357 
’d


359 
funùiÚ
 
	$em™_lua
(
s§
)

360 
loÿl
 
bud”
 = 
	`f‹r_bud”
('P', 'length')

361 
	`£rŸlize
(
bud”
, 
	`ş—nup
(
	`»sidu®ize_lua
(
s§
), 
Œue
))

362 
loÿl
 
¡r
 = 
bud”
.
	$fšish
()

363 
v”bo£
 
th’
 
	$µ
(
¡r
è
’d


364  
¡r


365 
’d


367 
funùiÚ
 
	$em™_m©ch_lua
(
s§
)

368 
loÿl
 
bud”
 = 
	`f‹r_bud”
('self', 'P', 'length')

369 
	`£rŸlize
(
bud”
, 
	`ş—nup
(
	`»sidu®ize_lua
(
s§
), 
Œue
))

370 
loÿl
 
¡r
 = 
bud”
.
	$fšish
()

371 
v”bo£
 
th’
 
	$µ
(
¡r
è
’d


372  
¡r


373 
’d


375 
funùiÚ
 
	$em™_ªd_lßd
(
s§
, 
Çme
)

376  
	`as£¹
(
	`lßd¡ršg
(
	`em™_lua
(
s§
), 
Çme
))()

377 
’d


379 
funùiÚ
 
	$em™_ªd_lßd_m©ch
(
s§
, 
Çme
)

380  
	`as£¹
(
	`lßd¡ršg
(
	`em™_m©ch_lua
(
s§
), 
Çme
))()

381 
’d


383 
funùiÚ
 
	$£láe¡
()

384 
	`´št
("selftest:…f.backend")

385 
loÿl
 
·r£
 = 
	`»quœe
('pf.parse').parse

386 
loÿl
 
ex·nd
 = 
	`»quœe
('pf.expand').expand

387 
loÿl
 
İtimize
 = 
	`»quœe
('pf.optimize').optimize

388 
loÿl
 
cÚv”t_ªf
 = 
	`»quœe
('pf.anf').convert_anf

389 
loÿl
 
cÚv”t_s§
 = 
	`»quœe
('pf.ssa').convert_ssa

391 
loÿl
 
funùiÚ
 
	$‹¡
(
ex´
)

392 
loÿl
 
a¡
 = 
	`İtimize
(
	`ex·nd
(
	`·r£
(
ex´
), "EN10MB"))

393  
	`em™_ªd_lßd
(
	`cÚv”t_s§
(
	$cÚv”t_ªf
(
a¡
)))

394 
’d


396 
	`‹¡
("tcp…ort 80 or udp…ort 34")

397 
	`´št
("OK")

398 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/bpf.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
ffi
 = 
	`»quœe
("ffi")

4 
loÿl
 
b™
 = 
	`»quœe
("bit")

5 
loÿl
 
bªd
 = 
b™
.band

7 
loÿl
 
v”bo£
 = 
os
.
	`g‘’v
("PF_VERBOSE");

9 
loÿl
 
funùiÚ
 
	$BPF_CLASS
(
code
è 
	$bªd
(
code
, 0x07è
’d


10 
loÿl
 
BPF_LD
 = 0x00

11 
loÿl
 
BPF_LDX
 = 0x01

12 
loÿl
 
BPF_ST
 = 0x02

13 
loÿl
 
BPF_STX
 = 0x03

14 
loÿl
 
BPF_ALU
 = 0x04

15 
loÿl
 
BPF_JMP
 = 0x05

16 
loÿl
 
BPF_RET
 = 0x06

17 
loÿl
 
BPF_MISC
 = 0x07

19 
loÿl
 
funùiÚ
 
	$BPF_SIZE
(
code
è 
	$bªd
(
code
, 0x18è
’d


20 
loÿl
 
BPF_W
 = 0x00

21 
loÿl
 
BPF_H
 = 0x08

22 
loÿl
 
BPF_B
 = 0x10

24 
loÿl
 
funùiÚ
 
	$BPF_MODE
(
code
è 
	$bªd
(
code
, 0xe0è
’d


25 
loÿl
 
BPF_IMM
 = 0x00

26 
loÿl
 
BPF_ABS
 = 0x20

27 
loÿl
 
BPF_IND
 = 0x40

28 
loÿl
 
BPF_MEM
 = 0x60

29 
loÿl
 
BPF_LEN
 = 0x80

30 
loÿl
 
BPF_MSH
 = 0xa0

32 
loÿl
 
funùiÚ
 
	$BPF_OP
(
code
è 
	$bªd
(
code
, 0xf0è
’d


33 
loÿl
 
BPF_ADD
 = 0x00

34 
loÿl
 
BPF_SUB
 = 0x10

35 
loÿl
 
BPF_MUL
 = 0x20

36 
loÿl
 
BPF_DIV
 = 0x30

37 
loÿl
 
BPF_OR
 = 0x40

38 
loÿl
 
BPF_AND
 = 0x50

39 
loÿl
 
BPF_LSH
 = 0x60

40 
loÿl
 
BPF_RSH
 = 0x70

41 
loÿl
 
BPF_NEG
 = 0x80

42 
loÿl
 
BPF_JA
 = 0x00

43 
loÿl
 
BPF_JEQ
 = 0x10

44 
loÿl
 
BPF_JGT
 = 0x20

45 
loÿl
 
BPF_JGE
 = 0x30

46 
loÿl
 
BPF_JSET
 = 0x40

48 
loÿl
 
funùiÚ
 
	$BPF_SRC
(
code
è 
	$bªd
(
code
, 0x08è
’d


49 
loÿl
 
BPF_K
 = 0x00

50 
loÿl
 
BPF_X
 = 0x08

52 
loÿl
 
funùiÚ
 
	$BPF_RVAL
(
code
è 
	$bªd
(
code
, 0x18è
’d


53 
loÿl
 
BPF_A
 = 0x10

55 
loÿl
 
funùiÚ
 
	$BPF_MISCOP
(
code
è 
	$bªd
(
code
, 0xf8è
’d


56 
loÿl
 
BPF_TAX
 = 0x00

57 
loÿl
 
BPF_TXA
 = 0x80

59 
loÿl
 
BPF_MEMWORDS
 = 16

61 
loÿl
 
MAX_UINT32
 = 0xffffffff

62 
loÿl
 
MAX_UINT32_PLUS_1
 = 
MAX_UINT32
 + 1

64 
loÿl
 
funùiÚ
 
	$ruÁime_u32
(
s32
)

65 ià(
s32
 < 0è
th’
  s32 + 
MAX_UINT32_PLUS_1
 
’d


66  
s32


67 
’d


69 
loÿl
 
funùiÚ
 
	$ruÁime_add
(
a
, 
b
)

70  
b™
.
	`tob™
((
	`ruÁime_u32
(
a
è+„uÁime_u32(
b
)è% 
MAX_UINT32_PLUS_1
)

71 
’d


73 
loÿl
 
funùiÚ
 
	$ruÁime_sub
(
a
, 
b
)

74  
b™
.
	`tob™
((
	`ruÁime_u32
(
a
è-„uÁime_u32(
b
)è% 
MAX_UINT32_PLUS_1
)

75 
’d


77 
loÿl
 
funùiÚ
 
	`ruÁime_mul
(
a
, 
b
)

78 -- 
FIXME
: 
This
 
ÿn
 
ov”æow
. 
We
 
Ãed
 
a
 
m©h
.
imul
.

79  
b™
.
	`tob™
(
	`ruÁime_u32
(
a
è* 
	$ruÁime_u32
(
b
))

80 
’d


82 
loÿl
 
funùiÚ
 
	`ruÁime_div
(
a
, 
b
)

83 -- 
The
 
code
 
g’”©Ü
 
®»ady
 
as£¹ed
 
b
 
is
 
a
 
nÚ
-
z”o
 
cÚ¡ªt
.

84  
b™
.
	`tob™
(
m©h
.
	`æoÜ
(
	`ruÁime_u32
(
a
è/ 
	$ruÁime_u32
(
b
)))

85 
’d


87 
loÿl
 
’v
 = {

88 
b™
 = 
	`»quœe
('bit'),

89 
ruÁime_u32
 =„untime_u32,

90 
ruÁime_add
 =„untime_add,

91 
ruÁime_sub
 =„untime_sub,

92 
ruÁime_mul
 =„untime_mul,

93 
ruÁime_div
 =„untime_div,

94 
	}
}

96 
loÿl
 
funùiÚ
 
	$is_pow”_of_2
(
k
)

97 
k
 =ğ0 
th’
  
çl£
 
’d


98 
b™
.
	`bªd
(
k
, 
	`ruÁime_u32
(kè- 1è~ğ0 
th’
  
çl£
 
’d


99 
shiá
 = 0, 31 do

100 
b™
.
	`lshiá
(1, 
shiá
è=ğ
k
 
th’
  shiá 
’d


101 
’d


102 
’d


104 
funùiÚ
 
	$compe_lua
(
bpf
)

105 
loÿl
 
h—d
 = '';

106 
loÿl
 
body
 = '';

107 
loÿl
 
funùiÚ
 
	$wr™e_h—d
(
code
è
h—d
 = h—d .. ' ' .. cod.. '\n' 
’d


108 
loÿl
 
funùiÚ
 
	$wr™e_body
(
code
è
body
 = body .. ' ' .. cod.. '\n' 
’d


109 
loÿl
 
wr™e
 = 
wr™e_body


111 
loÿl
 
jump_rg‘s
 = {
	}
}

113 
loÿl
 
funùiÚ
 
	$bš
(
İ
, 
a
, 
b
è '(' ..‡ .. o°.. b .. ')' 
’d


114 
loÿl
 
funùiÚ
 
	$ÿÎ
(
´oc
, 
¬gs
è…roø.. '(' ..‡rg .. ')' 
’d


115 
loÿl
 
funùiÚ
 
	$comma
(
a1
, 
a2
è‡1 .. ', ' ..‡2 
’d


116 
loÿl
 
funùiÚ
 
	$s32
(
a
è 
	`ÿÎ
('b™.tob™',‡è
’d


117 
loÿl
 
funùiÚ
 
	$u32
(
a
)

118 ià(
	$tÚumb”
(
a
)è
th’
  
	$ruÁime_u32
(
a
è
’d


119  
	`ÿÎ
('ruÁime_u32', 
a
)

120 
’d


121 
loÿl
 
funùiÚ
 
	$add
(
a
, 
b
)

122 
	`ty³
(
b
è=ğ'numb”' 
th’


123 
b
 =ğ0 
th’
  
a
 
’d


124 
b
 > 0 
th’
  
	`s32
(
	`bš
('+', 
a
, b)è
’d


125 
’d


126  
	`ÿÎ
('ruÁime_add', 
	$comma
(
a
, 
b
))

127 
’d


128 
loÿl
 
funùiÚ
 
	$sub
(
a
, 
b
è 
	`ÿÎ
('ruÁime_sub', 
	$comma
(
a
, 
b
)è
’d


129 
loÿl
 
funùiÚ
 
	$mul
(
a
, 
b
è 
	`ÿÎ
('ruÁime_mul', 
	$comma
(
a
, 
b
)è
’d


130 
loÿl
 
funùiÚ
 
	$div
(
a
, 
b
è 
	`ÿÎ
('ruÁime_div', 
	$comma
(
a
, 
b
)è
’d


131 
loÿl
 
funùiÚ
 
	$b™
(
İ
, 
a
, 
b
è 
	`ÿÎ
('b™.' .. op, 
	$comma
(
a
, 
b
)è
’d


132 
loÿl
 
funùiÚ
 
	$bÜ
(
a
, 
b
è 
	`b™
('bÜ',‡, bè
’d


133 
loÿl
 
funùiÚ
 
	$bªd
(
a
, 
b
è 
	`b™
('bªd',‡, bè
’d


134 
loÿl
 
funùiÚ
 
	$lsh
(
a
, 
b
è 
	`b™
('lshiá',‡, bè
’d


135 
loÿl
 
funùiÚ
 
	$rsh
(
a
, 
b
è 
	`b™
('rshiá',‡, bè
’d


136 
loÿl
 
funùiÚ
 
	$rŞ
(
a
, 
b
è 
	`b™
('rŞ',‡, bè
’d


137 
loÿl
 
funùiÚ
 
	$Ãg
(
a
è 
	`s32
('-' ..‡è
’d
 -- 
FIXME
: 
Is
 
this
 
right
?

138 
loÿl
 
funùiÚ
 
	$“
(
a
, 
b
è 
	`bš
('==',‡, bè
’d


139 
loÿl
 
funùiÚ
 
	$ge
(
a
, 
b
è 
	`bš
('>=',‡, bè
’d


140 
loÿl
 
funùiÚ
 
	$gt
(
a
, 
b
è 
	`bš
('>',‡, bè
’d


141 
loÿl
 
funùiÚ
 
	$assign
(
lhs
, 
rhs
è†h .. ' = ' ..„h 
’d


142 
loÿl
 
funùiÚ
 
	$Ïb–
(
i
è '::L' .. i .. '::' 
’d


143 
loÿl
 
funùiÚ
 
	$jump
(
i
è
jump_rg‘s
[i] = 
Œue
;  'gÙØL' .. i 
’d


144 
loÿl
 
funùiÚ
 
	$cÚd
(
‹¡
, 
kt
, 
kf
, 
çÎthrough
)

145 
çÎthrough
 =ğ
kf
 
th’


146  'ià' .. 
‹¡
 .. 'h’ ' .. 
	`jump
(
kt
) .. 'ƒnd'

147 
–£if
 
çÎthrough
 =ğ
kt
 
th’


148  
	`cÚd
('nÙ '..
‹¡
, 
kf
, 
kt
, 
çÎthrough
)

150  
	`cÚd
(
‹¡
, 
kt
, 
kf
, kfè.. '\À ' .. 
	$jump
(
kf
)

151 
’d


152 
’d


154 
loÿl
 
¡©e
 = {
	}
}

155 
loÿl
 
funùiÚ
 
	$deş¬e
(
Çme
, 
š™
)

156 
nÙ
 
¡©e
[
Çme
] 
th’


157 
	`wr™e_h—d
(
	`assign
('loÿÈ' .. 
Çme
, 
š™
 
Ü
 '0'))

158 
¡©e
[
Çme
] = 
Œue


159 
’d


160  
Çme


161 
’d


163 
loÿl
 
funùiÚ
 
	$A
(è 
	`deş¬e
('A'è
’d
 -- 
accumuÏtÜ


164 
loÿl
 
funùiÚ
 
	$X
(è 
	`deş¬e
('X'è
’d
 -- 
šdex


165 
loÿl
 
funùiÚ
 
	`M
(
k
è-- 
sü©ch


166 ià(
k
 >ğ
BPF_MEMWORDS
 
Ü
 k < 0è
th’
 
	`”rÜ
("bad k" .. kè
’d


167  
	`deş¬e
('M'..
k
)

168 
’d


170 
loÿl
 
funùiÚ
 
	$size_to_acûssÜ
(
size
)

171 
size
 =ğ
BPF_W
 
th’
  's32'

172 
–£if
 
size
 =ğ
BPF_H
 
th’
  'u16'

173 
–£if
 
size
 =ğ
BPF_B
 
th’
  'u8'

174 
	`”rÜ
('bad siz' .. 
size
)

175 
’d


176 
’d


178 
loÿl
 
funùiÚ
 
	$»ad_bufãr_wÜd_by_ty³
(
acûssÜ
, 
bufãr
, 
off£t
)

179 ià(
acûssÜ
 =ğ'u8'è
th’


180  
bufãr
..'['..
off£t
..']'

181 
	`–£if
 (
acûssÜ
 =ğ'u16'è
th’


182  'b™.bÜ(b™.lshiá('..
bufãr
..'['..
off£t
..'], 8), '..

183 
bufãr
..'['..
off£t
..'+1])'

184 
	`–£if
 (
acûssÜ
 =ğ's32'è
th’


185  'b™.bÜ(b™.lshiá('..
bufãr
..'['..
off£t
..'], 24),'..

186 'b™.lshiá('..
bufãr
..'['..
off£t
..'+1], 16), bit.lshift('..

187 
bufãr
..'['..
off£t
..'+2], 8), '..buffer..'['..offset..'+3])'

188 
’d


189 
’d


191 
loÿl
 
funùiÚ
 
	$P_»f
(
size
, 
k
)

192  
	`»ad_bufãr_wÜd_by_ty³
(
	`size_to_acûssÜ
(
size
), 'P', 
k
)

193 
’d


195 
loÿl
 
funùiÚ
 
	$ld
(
size
, 
mode
, 
k
)

196 
loÿl
 
rhs
, 
by‹s
 = 0

197 
size
 =ğ
BPF_W
 
th’
 
by‹s
 = 4

198 
–£if
 
size
 =ğ
BPF_H
 
th’
 
by‹s
 = 2

199 
–£if
 
size
 =ğ
BPF_B
 
th’
 
by‹s
 = 1

200 
	`”rÜ
('bad siz' .. 
size
)

201 
’d


202 
mode
 =ğ
BPF_ABS
 
th’


203 
	`as£¹
(
k
 >= 0, "packet size >= 2G???")

204 
	`wr™e
('ià' .. 
k
 + 
by‹s
 .. ' >†engthhen„eturn falseƒnd')

205 
rhs
 = 
	$P_»f
(
size
, 
k
)

206 
–£if
 
mode
 =ğ
BPF_IND
 
th’


207 
	`wr™e
(
	`assign
(
	`deş¬e
('T'), 
	`add
(
	`X
(), 
k
)))

208 -- 
Assumšg
 
·ck‘
 
ÿn
't be 2GB in†ength

209 
	`wr™e
('iàT < 0 o¸T + ' .. 
by‹s
 .. ' >†engthhen„eturn falseƒnd')

210 
rhs
 = 
	`P_»f
(
size
, 'T')

211 
–£if
 
mode
 =ğ
BPF_LEN
 
th’
 
rhs
 = 'bit.tobit(length)'

212 
–£if
 
mode
 =ğ
BPF_IMM
 
th’
 
rhs
 = 
k


213 
–£if
 
mode
 =ğ
BPF_MEM
 
th’
 
rhs
 = 
	$M
(
k
)

214 
	`”rÜ
('bad mod' .. 
mode
)

215 
’d


216 
	`wr™e
(
	`assign
(
	`A
(), 
rhs
))

217 
’d


219 
loÿl
 
funùiÚ
 
	$ldx
(
size
, 
mode
, 
k
)

220 
loÿl
 
rhs


221 
mode
 =ğ
BPF_LEN
 
th’
 
rhs
 = 'bit.tobit(length)'

222 
–£if
 
mode
 =ğ
BPF_IMM
 
th’
 
rhs
 = 
k


223 
–£if
 
mode
 =ğ
BPF_MEM
 
th’
 
rhs
 = 
	$M
(
k
)

224 
–£if
 
mode
 =ğ
BPF_MSH
 
th’


225 
	`as£¹
(
k
 >= 0, "packet size >= 2G???")

226 
	`wr™e
('ià' .. 
k
 .. ' >=†engthhen„eturn falseƒnd')

227 
rhs
 = 
	`lsh
(
	`bªd
(
	`P_»f
(
BPF_B
, 
k
), 0xf), 2)

229 
	`”rÜ
('bad mod' .. 
mode
)

230 
’d


231 
	`wr™e
(
	`assign
(
	`X
(), 
rhs
))

232 
’d


234 
loÿl
 
funùiÚ
 
	$¡
(
k
)

235 
	`wr™e
(
	`assign
(
	`M
(
k
), 
	$A
()))

236 
’d


238 
loÿl
 
funùiÚ
 
	$¡x
(
k
)

239 
	`wr™e
(
	`assign
(
	`M
(
k
), 
	$X
()))

240 
’d


242 
loÿl
 
funùiÚ
 
	$®u
(
İ
, 
¤c
, 
k
)

243 
loÿl
 
b


244 
¤c
 =ğ
BPF_K
 
th’
 
b
 = 
k


245 
–£if
 
¤c
 =ğ
BPF_X
 
th’
 
b
 = 
	$X
()

246 
	`”rÜ
('bad srø' .. 
¤c
)

247 
’d


249 
loÿl
 
rhs


250 
İ
 =ğ
BPF_ADD
 
th’
 
rhs
 = 
	`add
(
	`A
(), 
b
)

251 
–£if
 
İ
 =ğ
BPF_SUB
 
th’
 
rhs
 = 
	`sub
(
	`A
(), 
b
)

252 
–£if
 
İ
 =ğ
BPF_MUL
 
th’


253 
loÿl
 
b™s
 = 
	$is_pow”_of_2
(
b
)

254 
b™s
 
th’
 
rhs
 = 
	`rŞ
(
	`A
(), b™sèrh ğ
	`mul
(A(), 
b
è
’d


255 
–£if
 
İ
 =ğ
BPF_DIV
 
th’


256 
	`as£¹
(
¤c
 =ğ
BPF_K
, "division by‚on-constant value is unsupported")

257 
	`as£¹
(
k
 ~= 0, "program contains division by constant zero")

258 
loÿl
 
b™s
 = 
	$is_pow”_of_2
(
k
)

259 
b™s
 
th’
 
rhs
 = 
	`rsh
(
	`A
(), b™sèrh ğ
	`div
(A(), 
k
è
’d


260 
–£if
 
İ
 =ğ
BPF_OR
 
th’
 
rhs
 = 
	`bÜ
(
	`A
(), 
b
)

261 
–£if
 
İ
 =ğ
BPF_AND
 
th’
 
rhs
 = 
	`bªd
(
	`A
(), 
b
)

262 
–£if
 
İ
 =ğ
BPF_LSH
 
th’
 
rhs
 = 
	`lsh
(
	`A
(), 
b
)

263 
–£if
 
İ
 =ğ
BPF_RSH
 
th’
 
rhs
 = 
	`rsh
(
	`A
(), 
b
)

264 
–£if
 
İ
 =ğ
BPF_NEG
 
th’
 
rhs
 = 
	`Ãg
(
	$A
())

265 
	`”rÜ
('bad o°' .. 
İ
)

266 
’d


267 
	`wr™e
(
	`assign
(
	`A
(), 
rhs
))

268 
’d


270 
loÿl
 
funùiÚ
 
	$jmp
(
i
, 
İ
, 
¤c
, 
k
, 
jt
, 
jf
)

271 
İ
 =ğ
BPF_JA
 
th’


272 
	`wr™e
(
	`jump
(
i
 + 
	$ruÁime_u32
(
k
)))

274 
’d


276 
loÿl
 
rhs


277 
¤c
 =ğ
BPF_K
 
th’
 
rhs
 = 
k


278 
–£if
 
¤c
 =ğ
BPF_X
 
th’
 
rhs
 = 
	$X
()

279 
	`”rÜ
('bad srø' .. 
¤c
)

280 
’d


282 
jt
 = jˆ+ 
i


283 
jf
 = jà+ 
i


285 
İ
 =ğ
BPF_JEQ
 
th’


286 
	`wr™e
(
	`cÚd
(
	`“
(
	`A
(), 
rhs
), 
jt
, 
jf
, 
i
)è-- 
No
 
Ãed
 
	`u32
().

287 
–£if
 
İ
 =ğ
BPF_JGT
 
th’


288 
	`wr™e
(
	`cÚd
(
	`gt
(
	`u32
(
	`A
()), u32(
rhs
)), 
jt
, 
jf
, 
i
))

289 
–£if
 
İ
 =ğ
BPF_JGE
 
th’


290 
	`wr™e
(
	`cÚd
(
	`ge
(
	`u32
(
	`A
()), u32(
rhs
)), 
jt
, 
jf
, 
i
))

291 
–£if
 
İ
 =ğ
BPF_JSET
 
th’


292 
	`wr™e
(
	`cÚd
(
	`“
(
	`bªd
(
	`A
(), 
rhs
), 0), 
jf
, 
jt
, 
i
))

294 
	`”rÜ
('bad o°' .. 
İ
)

295 
’d


296 
’d


298 
loÿl
 
funùiÚ
 
	$»t
(
¤c
, 
k
)

299 
loÿl
 
rhs


300 
¤c
 =ğ
BPF_K
 
th’
 
rhs
 = 
k


301 
–£if
 
¤c
 =ğ
BPF_A
 
th’
 
rhs
 = 
	$A
()

302 
	`”rÜ
('bad srø' .. 
¤c
)

303 
’d


304 
loÿl
 
»suÉ
 = 
	`u32
(
rhs
è~ğ0 
ªd
 "Œue" 
Ü
 "false"

305 
	`wr™e
('dØ»tuº '..
»suÉ
..'ƒnd')

306 
’d


308 
loÿl
 
funùiÚ
 
	$misc
(
İ
)

309 
İ
 =ğ
BPF_TAX
 
th’


310 
	`wr™e
(
	`assign
(
	`X
(), 
	$A
()))

311 
–£if
 
İ
 =ğ
BPF_TXA
 
th’


312 
	`wr™e
(
	`assign
(
	`A
(), 
	$X
()))

313 
	`”rÜ
('bad o°' .. 
İ
)

314 
’d


315 
’d


317 
v”bo£
 
th’
 
	`´št
(
	$di§s£mbË
(
bpf
)è
’d


318 
i
=0, #bpf-1 do

319 -- 
debuggšg
: 
	`wr™e
('´št('..
i
..')')

320 
loÿl
 
š¡
 = 
bpf
[
i
]

321 
loÿl
 
code
 = 
š¡
.code

322 
loÿl
 
şass
 = 
	$BPF_CLASS
(
code
)

323 
şass
 =ğ
BPF_LD
 
th’
 
	`ld
(
	`BPF_SIZE
(
code
), 
	`BPF_MODE
(code), 
š¡
.
k
)

324 
–£if
 
şass
 =ğ
BPF_LDX
 
th’
 
	`ldx
(
	`BPF_SIZE
(
code
), 
	`BPF_MODE
(code), 
š¡
.
k
)

325 
–£if
 
şass
 =ğ
BPF_ST
 
th’
 
	$¡
(
š¡
.
k
)

326 
–£if
 
şass
 =ğ
BPF_STX
 
th’
 
	$¡x
(
š¡
.
k
)

327 
–£if
 
şass
 =ğ
BPF_ALU
 
th’
 
	`®u
(
	`BPF_OP
(
code
), 
	`BPF_SRC
(code), 
š¡
.
k
)

328 
–£if
 
şass
 =ğ
BPF_JMP
 
th’
 
	`jmp
(
i
, 
	`BPF_OP
(
code
), 
	`BPF_SRC
(code), 
š¡
.
k
,

329 
š¡
.
jt
, in¡.
jf
)

330 
–£if
 
şass
 =ğ
BPF_RET
 
th’
 
	`»t
(
	`BPF_SRC
(
code
), 
š¡
.
k
)

331 
–£if
 
şass
 =ğ
BPF_MISC
 
th’
 
	`misc
(
	$BPF_MISCOP
(
code
))

332 
	`”rÜ
('bad cÏs ' .. 
şass
)

333 
’d


334 
jump_rg‘s
[
i
] 
th’
 
	`wr™e
(
	$Ïb–
(
i
)è
’d


335 
’d


336 
loÿl
 
»t
 = ('return function (P,†ength)\n' ..

337 
h—d
 .. 
body
 ..

340 
v”bo£
 
th’
 
	$´št
(
»t
è
’d


341  
»t


342 
’d


344 
funùiÚ
 
	$di§s£mbË
(
bpf
)

345 
loÿl
 
asm
 = '';

346 
loÿl
 
funùiÚ
 
	$wr™e
(
code
, ...è
asm
 =‡sm .. code:
	$fÜm©
(...è
’d


347 
loÿl
 
funùiÚ
 
	$wr™–n
(
code
, ...è
	`wr™e
(code..'\n', ...è
’d


349 
loÿl
 
funùiÚ
 
	$ld
(
size
, 
mode
, 
k
)

350 
loÿl
 
by‹s
 = 
	`as£¹
(({ [
BPF_W
]=4, [
BPF_H
]=2, [
BPF_B
]=1 
	}
})[
size
])

351 
	gmode
 =ğ
BPF_ABS
 
th’
 
wr™–n
('A = P[%u:%u]', 
k
, 
by‹s
)

352 
–£if
 
	gmode
 =ğ
BPF_IND
 
th’
 
wr™–n
('A = P[X+%u:%u]', 
k
, 
by‹s
)

353 
–£if
 
	gmode
 =ğ
BPF_IMM
 
th’
 
wr™–n
('A = %u', 
k
)

354 
–£if
 
	gmode
 =ğ
BPF_LEN
 
th’
 
wr™–n
('A =†ength')

355 
–£if
 
mode
 =ğ
BPF_MEM
 
th’
 
wr™–n
('A = M[%u]', 
k
)

356 
”rÜ
('bad mod' .. 
mode
è
’d


357 
’d


359 
loÿl
 
funùiÚ
 
	$ldx
(
size
, 
mode
, 
k
)

360 
mode
 =ğ
BPF_IMM
 
th’
 
	`wr™–n
('X = %u', 
k
)

361 
–£if
 
mode
 =ğ
BPF_LEN
 
th’
 
	`wr™–n
('X =†ength')

362 
–£if
 
mode
 =ğ
BPF_MEM
 
th’
 
	`wr™–n
('X = M[%u]', 
k
)

363 
–£if
 
mode
 =ğ
BPF_MSH
 
th’
 
	`wr™–n
('X = (P[%u:1] & 0xFè<< 2', 
k
)

364 
	`”rÜ
('bad mod' .. 
mode
è
’d


365 
’d


367 
loÿl
 
funùiÚ
 
	$¡
(
k
è
	`wr™–n
('M(%uèğA', kè
’d


369 
loÿl
 
funùiÚ
 
	$¡x
(
k
è
	`wr™–n
('M(%uèğX', kè
’d


371 
loÿl
 
funùiÚ
 
	$®u
(
İ
, 
¤c
, 
k
)

372 
loÿl
 
b


373 
¤c
 =ğ
BPF_K
 
th’
 
b
 = 
k


374 
–£if
 
¤c
 =ğ
BPF_X
 
th’
 
b
 = 'X'

375 
	`”rÜ
('bad srø' .. 
¤c
è
’d


377 
İ
 =ğ
BPF_ADD
 
th’
 
	`wr™–n
('A +ğ%s', 
b
)

378 
–£if
 
İ
 =ğ
BPF_SUB
 
th’
 
	`wr™–n
('A -ğ%s', 
b
)

379 
–£if
 
İ
 =ğ
BPF_MUL
 
th’
 
	`wr™–n
('A *ğ%s', 
b
)

380 
–£if
 
İ
 =ğ
BPF_DIV
 
th’
 
	`wr™–n
('A /ğ%s', 
b
)

381 
–£if
 
İ
 =ğ
BPF_OR
 
th’
 
	`wr™–n
('A |ğ%s', 
b
)

382 
–£if
 
İ
 =ğ
BPF_AND
 
th’
 
	`wr™–n
('A &ğ%s', 
b
)

383 
–£if
 
İ
 =ğ
BPF_LSH
 
th’
 
	`wr™–n
('A <<ğ%s', 
b
)

384 
–£if
 
İ
 =ğ
BPF_RSH
 
th’
 
	`wr™–n
('A >>ğ%s', 
b
)

385 
–£if
 
İ
 =ğ
BPF_NEG
 
th’
 
	`wr™–n
('A = -A')

386 
	`”rÜ
('bad o°' .. 
İ
è
’d


387 
’d


389 
loÿl
 
funùiÚ
 
	$jmp
(
i
, 
İ
, 
¤c
, 
k
, 
jt
, 
jf
)

390 
İ
 =ğ
BPF_JA
 
th’
 
	`wr™–n
('gÙØ%u', 
k
);  
’d


392 
loÿl
 
rhs


393 
¤c
 =ğ
BPF_K
 
th’
 
rhs
 = 
k


394 
–£if
 
¤c
 =ğ
BPF_X
 
th’
 
rhs
 = 'X'

395 
	`”rÜ
('bad srø' .. 
¤c
è
’d


397 
jt
 = jˆ+ 
i
 + 1

398 
jf
 = jà+ 
i
 + 1

400 
loÿl
 
funùiÚ
 
	$cÚd
(
İ
, 
lhs
, 
rhs
)

401 
	`wr™–n
('ià(% % %sègÙØ%uƒl£ gÙØ%u', 
lhs
, 
İ
, 
rhs
, 
jt
, 
jf
)

402 
’d


404 
İ
 =ğ
BPF_JEQ
 
th’
 
	`cÚd
('==', 'A', 
rhs
)

405 
–£if
 
İ
 =ğ
BPF_JGT
 
th’
 
	`cÚd
('>', 'A', 
rhs
)

406 
–£if
 
İ
 =ğ
BPF_JGE
 
th’
 
	`cÚd
('>=', 'A', 
rhs
)

407 
–£if
 
İ
 =ğ
BPF_JSET
 
th’
 
	`cÚd
('!=', 'A & '..
rhs
, 0)

408 
	`”rÜ
('bad o°' .. 
İ
è
’d


409 
’d


411 
loÿl
 
funùiÚ
 
	$»t
(
¤c
, 
k
)

412 
¤c
 =ğ
BPF_K
 
th’
 
	`wr™–n
('»tuº %u', 
k
)

413 
–£if
 
¤c
 =ğ
BPF_A
 
th’
 
	`wr™–n
('return A')

414 
	`”rÜ
('bad srø' .. 
¤c
è
’d


415 
’d


417 
loÿl
 
funùiÚ
 
	$misc
(
İ
)

418 
İ
 =ğ
BPF_TAX
 
th’
 
	`wr™–n
('X = A')

419 
–£if
 
İ
 =ğ
BPF_TXA
 
th’
 
	`wr™–n
('A = X')

420 
	`”rÜ
('bad o°' .. 
İ
è
’d


421 
’d


423 
i
=0, #bpf-1 do

424 
loÿl
 
š¡
 = 
bpf
[
i
]

425 
loÿl
 
code
 = 
š¡
.code

426 
loÿl
 
şass
 = 
	$BPF_CLASS
(
code
)

427 
loÿl
 
k
 = 
	$ruÁime_u32
(
š¡
.
k
)

428 
	`wr™e
(
¡ršg
.
	`fÜm©
('%03d: ', 
i
))

429 
şass
 =ğ
BPF_LD
 
th’
 
	`ld
(
	`BPF_SIZE
(
code
), 
	`BPF_MODE
(code), 
k
)

430 
–£if
 
şass
 =ğ
BPF_LDX
 
th’
 
	`ldx
(
	`BPF_SIZE
(
code
), 
	`BPF_MODE
(code), 
k
)

431 
–£if
 
şass
 =ğ
BPF_ST
 
th’
 
	$¡
(
k
)

432 
–£if
 
şass
 =ğ
BPF_STX
 
th’
 
	$¡x
(
k
)

433 
–£if
 
şass
 =ğ
BPF_ALU
 
th’
 
	`®u
(
	`BPF_OP
(
code
), 
	`BPF_SRC
(code), 
k
)

434 
–£if
 
şass
 =ğ
BPF_JMP
 
th’
 
	`jmp
(
i
, 
	`BPF_OP
(
code
), 
	`BPF_SRC
(code), 
k
,

435 
š¡
.
jt
, in¡.
jf
)

436 
–£if
 
şass
 =ğ
BPF_RET
 
th’
 
	`»t
(
	`BPF_SRC
(
code
), 
k
)

437 
–£if
 
şass
 =ğ
BPF_MISC
 
th’
 
	`misc
(
	$BPF_MISCOP
(
code
))

438 
	`”rÜ
('bad cÏs ' .. 
şass
è
’d


439 
’d


440  
asm


441 
’d


443 
funùiÚ
 
	$compe
(
bpf
)

444 
loÿl
 
func
 = 
	`as£¹
(
	`lßd¡ršg
(
	$compe_lua
(
bpf
)))

445 
	$£tãnv
(
func
, 
’v
)

446  
	$func
()

447 
’d


449 
funùiÚ
 
	$dump
(
bpf
)

450 
io
.
	`wr™e
(#bpf .. ':\n')

451 
i
 = 0, #bpf-1 do

452 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
(' {0x%x, %u, %u, %d}\n',

453 
bpf
[
i
].
code
, bpf[i].
jt
, bpf[i].
jf
, bpf[i].
k
))

454 
’d


455 
io
.
	`wr™e
("\n")

456 
’d


458 
funùiÚ
 
	$£láe¡
()

459 
	`´št
("selftest:…f.bpf")

460 -- 
FIXME
: 
NÙ
 
su»
 
how
 
to
 
‹¡
 
w™hout
 
pÿp
 
comp©iÚ
.

461 
	`´št
("OK")

462 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/constants.lua

1 -- 
N‘wÜk
 
	g£rviûs
, 
IÁ”Ãt
 
	g¡yË


2 -- 
	gS“
 /
	g‘c
/
£rviûs


4 
	$moduË
(...,
·ckage
.
£—Î
)

6 
£rviûs
 = {

260 -- 
The
 
»maššg
 
pÜts
 
¬e
 
nÙ
 
as
 
®loÿ‹d
 
by
 
IANA


351 
	}
}

353 
	g´ÙocŞ_h—d”_f›ld_off£ts
 = {

354 
icm±y³
 = 0,

355 
	gicmpcode
 = 1,

356 
	gtıæags
 = 13,

359 -- 
	gh‰p
:

360 
icmp_ty³_f›lds
 = {

378 -- 
	gh‰p
:

379 
tı_æag_f›lds
 = {

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/expand.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

5 
loÿl
 
v”bo£
 = 
os
.
	`g‘’v
("PF_VERBOSE");

7 
loÿl
 
ex·nd_¬™h
, 
ex·nd_»lİ
, 
ex·nd_boŞ


9 
loÿl
 
£t
, 
cÚÿt
, 
µ
 = 
uts
.set, utils.concat, utils.pp

10 
loÿl
 
ušt16
, 
ušt32
 = 
uts
.uint16, utils.uint32

11 
loÿl
 
v4_to_št
, 
v6_as_4x32
 = 
uts
.ipv4_to_int, utils.ipv6_as_4x32

13 
loÿl
 
Îc_ty³s
 = 
	`£t
(

18 
loÿl
 
pf_»asÚs
 = 
	`£t
(

22 
loÿl
 
pf_aùiÚs
 = 
	`£t
(

26 
loÿl
 
wÏn_äame_ty³s
 = 
	`£t
('mgt', 'ctl', 'data')

27 
loÿl
 
wÏn_äame_mgt_subty³s
 = 
	`£t
(

31 
loÿl
 
wÏn_äame_ùl_subty³s
 = 
	`£t
(

34 
loÿl
 
wÏn_äame_d©a_subty³s
 = 
	`£t
(

41 
loÿl
 
wÏn_dœeùiÚs
 = 
	`£t
('nods', 'tods', 'fromds', 'dstods')

43 
loÿl
 
funùiÚ
 
	$unim¶em’‹d
(
ex´
, 
dÉ
)

44 
	`”rÜ
("nÙ im¶em’‹d: "..
ex´
[1])

45 
’d


47 -- 
Eth”Ãt
 
´ÙocŞs


48 
loÿl
 
PROTO_AARP
 = 33011 -- 0x80f3

49 
loÿl
 
PROTO_ARP
 = 2054 -- 0x806

50 
loÿl
 
PROTO_ATALK
 = 32923 -- 0x809b

51 
loÿl
 
PROTO_DECNET
 = 24579 -- 0x6003

52 
loÿl
 
PROTO_IPV4
 = 2048 -- 0x800

53 
loÿl
 
PROTO_IPV6
 = 34525 -- 0x86dd

54 
loÿl
 
PROTO_IPX
 = 33079 -- 0X8137

55 
loÿl
 
PROTO_ISO
 = 65278 -- 0xfefe

56 
loÿl
 
PROTO_LAT
 = 24580 -- 0x6004

57 
loÿl
 
PROTO_MOPDL
 = 24577 -- 0x6001

58 
loÿl
 
PROTO_MOPRC
 = 24578 -- 0x6002

59 
loÿl
 
PROTO_NETBEUI
 = 61680 -- 0xf0f0

60 
loÿl
 
PROTO_RARP
 = 32821 -- 0x8035

61 
loÿl
 
PROTO_SCA
 = 24583 -- 0x6007

62 
loÿl
 
PROTO_STP
 = 66 -- 0x42

64 
loÿl
 
‘h”_mš_·ylßds
 = {

65 [
PROTO_IPV4
] = 20,

66 [
PROTO_ARP
] = 28,

67 [
PROTO_RARP
] = 28,

68 [
PROTO_IPV6
] = 40

69 
	}
}

71 -- 
IP
 
´ÙocŞs


72 
loÿl
 
	gPROTO_AH
 = 51 -- 0x33

73 
loÿl
 
PROTO_ESP
 = 50 -- 0x32

74 
loÿl
 
PROTO_ICMP
 = 1 -- 0x1

75 
loÿl
 
PROTO_ICMP6
 = 58 -- 0x3a

76 
loÿl
 
PROTO_IGMP
 = 2 -- 0x2

77 
loÿl
 
PROTO_IGRP
 = 9 -- 0x9

78 
loÿl
 
PROTO_PIM
 = 103 -- 0x67

79 
loÿl
 
PROTO_SCTP
 = 132 -- 0x84

80 
loÿl
 
PROTO_TCP
 = 6 -- 0x6

81 
loÿl
 
PROTO_UDP
 = 17 -- 0x11

82 
loÿl
 
PROTO_VRRP
 = 112 -- 0x70

84 
loÿl
 
_mš_·ylßds
 = {

85 [
PROTO_ICMP
] = 8,

86 [
PROTO_UDP
] = 8,

87 [
PROTO_TCP
] = 20,

88 [
PROTO_IGMP
] = 8,

89 [
PROTO_IGRP
] = 8,

90 [
PROTO_PIM
] = 4,

91 [
PROTO_SCTP
] = 12,

92 [
PROTO_VRRP
] = 8

95 -- 
ISO
 
´ÙocŞs


97 
loÿl
 
	gPROTO_CLNP
 = 129 -- 0x81

98 
loÿl
 
PROTO_ESIS
 = 130 -- 0x82

99 
loÿl
 
PROTO_ISIS
 = 131 -- 0x83

101 
loÿl
 
ETHER_TYPE
 = 12

102 
loÿl
 
ETHER_PAYLOAD
 = 14

103 
loÿl
 
IP_FLAGS
 = 6

104 
loÿl
 
IP_PROTOCOL
 = 9

106 -- 
Mšimum
 
·ylßd
 
checks
 
š£¹
 
a
 
by‹
 
acûss
 
to
 
the
 
Ï¡
 by‹ 
of
he

107 -- 
mšimum
 
·ylßd
 
size
. 
Sšû
 
the
 
com·risÚ
 
should
 
fŞd
 (
beÿu£
 
™


108 -- 
wl
 
®ways
 
be
 >ğ0), 
we
 wÈb
Ëá
 
w™h
 
ju¡
 
ª
 
—g”
 
as£¹iÚ
 
	gÚ


109 -- 
the
 
mšimum
 
·ck‘
 
	gsize
, 
which
 
should
 
h–p
 
–ide
 
futu»
…acket size

110 -- 
	gas£¹iÚs
.

111 
loÿl
 
funùiÚ
 
	$has_´Ùo_mš_·ylßd
(
mš_·ylßds
, 
´Ùo
, 
acûssÜ
)

112 
loÿl
 
mš_·ylßd
 = 
	$as£¹
(
mš_·ylßds
[
´Ùo
])

113  { '<=', 0, { 
acûssÜ
, 
mš_·ylßd
 - 1, 1 } 
	}
}

114 
’d


116 -- 
Wh’
 
´Ùo
 
is
 
g»©”
 
thª
 1500 (0x5DCè, 
the
 
äame
 i 
Œ—‹d
 
as
 
	gª


117 -- 
Eth”Ãt
 
äame
 
ªd
 
the
 
	gTy³
/
L’gth
 
is
 
š‹½»‹d
 
as
 Ty³, 
¡Üšg
 
	gthe


118 -- 
Eth”Ty³
 
	gv®ue
.

119 -- 
	gOth”wi£
, 
the
 
äame
 
is
 
š‹½»‹d
 
as
 
	gª
 802.3 f¿m
ªd
 
	gthe


120 -- 
	gTy³
/
L’gth
 
f›ld
 
is
 
š‹½»‹d
 
as
 
	gL’gth
. 
The
 L’gth 
ÿÂÙ
 
be
 
	gg»©”


121 -- 
	gthª
 1500. 
The
 
fœ¡
 
by‹
 
aá”
 
the
 
	gTy³
/
L’gth
 
f›ld
 
¡Ües
h
	gS”viû


122 -- 
Acûss
 
Pošt
 
of
 
	gthe
 802.3 
	gäame
. 
It
 
wÜks
 
as
 
ª
 
Eth”Ty³
 
©
 
LLC
 
	gËv–
.

124 -- 
	gS“
: 
h‰ps
:

126 
loÿl
 
ETHER_MAX_LEN
 = 1500

128 
loÿl
 
funùiÚ
 
	$has_‘h”_´ÙocŞ
(
´Ùo
)

129 
´Ùo
 > 
ETHER_MAX_LEN
 
th’


130  { '=', { '[‘h”]', 
ETHER_TYPE
, 2 }, 
´Ùo
 
	}
}

131 
’d


133 { '<=', {'[‘h”]', 
ETHER_TYPE
, 2}, 
ETHER_MAX_LEN
 },

134 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 1}, 
´Ùo
 } }

135 
’d


136 
loÿl
 
funùiÚ
 
	$has_‘h”_´ÙocŞ_mš_·ylßd
(
´Ùo
)

137  
	`has_´Ùo_mš_·ylßd
(
‘h”_mš_·ylßds
, 
´Ùo
, '[ether*]')

138 
’d


139 
loÿl
 
funùiÚ
 
	$has_v4_´ÙocŞ
(
´Ùo
)

140  { '=', { '[]', 
IP_PROTOCOL
, 1 }, 
´Ùo
 
	}
}

141 
’d


142 
loÿl
 
funùiÚ
 
has_v4_´ÙocŞ_mš_·ylßd
(
´Ùo
)

143 -- 
Sšû
 
	gthe
 [

*] 
acûssÜ
 
as£¹s
 
th©
 
is_fœ¡_v4_äagm’t
(),

144 -- 
ªd
 
we
 
	gdÚ
't wanthat, we use [ip]‡nd‡ssumehe minimum IP

145 -- 
h—d”
 
	gsize
.

146 
loÿl
 
	gmš_·ylßd
 = 
	$as£¹
(
_mš_·ylßds
[
´Ùo
])

147 
mš_·ylßd
 = mš_·ylßd + 
	$as£¹
(
‘h”_mš_·ylßds
[
PROTO_IPV4
])

148  { '<=', 0, { '[]', 
mš_·ylßd
 - 1, 1 } 
	}
}

149 
’d


151 
loÿl
 
funùiÚ
 
	$is_fœ¡_v4_äagm’t
()

152  { '=', { '&', { '[]', 
IP_FLAGS
, 2 }, 0x1ffà}, 0 
	}
}

153 
’d


154 
loÿl
 
funùiÚ
 
	$has_v6_´ÙocŞ
(
´Ùo
)

155 
loÿl
 
IPV6_NEXT_HEADER_1
 = 6

156 
loÿl
 
IPV6_NEXT_HEADER_2
 = 40

157 
loÿl
 
IPV6_FRAGMENTATION_EXTENSION_HEADER
 = 44

160 { '=', { '[6]', 
IPV6_NEXT_HEADER_1
, 1 }, 
´Ùo
 },

162 { '=', { '[6]', 
IPV6_NEXT_HEADER_1
, 1 },

163 
IPV6_FRAGMENTATION_EXTENSION_HEADER
 },

164 { '=', { '[6]', 
IPV6_NEXT_HEADER_2
, 1 }, 
´Ùo
 } } } 
	}
}

165 
’d


166 
loÿl
 
funùiÚ
 
has_v6_´ÙocŞ_mš_·ylßd
(
´Ùo
)

167 -- 
Assume
 
the
 
mšimum
 
v6
 
h—d”
 
size
.

168 
loÿl
 
mš_·ylßd
 = 
	$as£¹
(
_mš_·ylßds
[
´Ùo
])

169 
mš_·ylßd
 = mš_·ylßd + 
	$as£¹
(
‘h”_mš_·ylßds
[
PROTO_IPV6
])

170  { '<=', 0, { '[6]', 
mš_·ylßd
 - 1, 1 } 
	}
}

171 
’d


172 
loÿl
 
funùiÚ
 
	$has__´ÙocŞ
(
´Ùo
)

173  { 'if', { '' }, 
	`has_v4_´ÙocŞ
(
´Ùo
), 
	`has_v6_´ÙocŞ
ÕrÙoè
	}
}

174 
’d


176 -- 
PÜt
 
İ”©iÚs


179 
loÿl
 
SRC_PORT
 = 0

180 
loÿl
 
DST_PORT
 = 2

182 
loÿl
 
funùiÚ
 
	$has_v4_¤c_pÜt
(
pÜt
)

183  { '=', { '[*]', 
SRC_PORT
, 2 }, 
pÜt
 
	}
}

184 
’d


185 
loÿl
 
funùiÚ
 
	$has_v4_d¡_pÜt
(
pÜt
)

186  { '=', { '[*]', 
DST_PORT
, 2 }, 
pÜt
 
	}
}

187 
’d


188 
loÿl
 
funùiÚ
 
	$has_v4_pÜt
(
pÜt
)

189  { 'Ü', 
	`has_v4_¤c_pÜt
(
pÜt
), 
	`has_v4_d¡_pÜt
ÕÜtè
	}
}

190 
’d


191 
loÿl
 
funùiÚ
 
	$has_v6_¤c_pÜt
(
pÜt
)

192  { '=', { '[6*]', 
SRC_PORT
, 2 }, 
pÜt
 
	}
}

193 
’d


194 
loÿl
 
funùiÚ
 
	$has_v6_d¡_pÜt
(
pÜt
)

195  { '=', { '[6*]', 
DST_PORT
, 2 }, 
pÜt
 
	}
}

196 
’d


197 
loÿl
 
funùiÚ
 
	$has_v6_pÜt
(
pÜt
)

198  { 'Ü', 
	`has_v6_¤c_pÜt
(
pÜt
), 
	`has_v6_d¡_pÜt
ÕÜtè
	}
}

199 
’d


200 
loÿl
 
funùiÚ
 
	$ex·nd_dœ_pÜt
(
ex´
, 
has_v4_pÜt
, 
has_v6_pÜt
)

201 
loÿl
 
pÜt
 = 
ex´
[2]

204 { 'Ü', 
	`has_v4_´ÙocŞ
(
PROTO_TCP
),

205 { 'Ü', 
	`has_v4_´ÙocŞ
(
PROTO_UDP
),

206 
	`has_v4_´ÙocŞ
(
PROTO_SCTP
) } },

207 
	`has_v4_pÜt
(
pÜt
) },

209 { 'Ü', 
	`has_v6_´ÙocŞ
(
PROTO_TCP
),

210 { 'Ü', 
	`has_v6_´ÙocŞ
(
PROTO_UDP
),

211 
	`has_v6_´ÙocŞ
(
PROTO_SCTP
) } },

212 
	`has_v6_pÜt
(
pÜt
è} 
	}
}

213 
’d


214 
loÿl
 
funùiÚ
 
	$ex·nd_pÜt
(
ex´
)

215  
	$ex·nd_dœ_pÜt
(
ex´
, 
has_v4_pÜt
, 
has_v6_pÜt
)

216 
’d


217 
loÿl
 
funùiÚ
 
	$ex·nd_¤c_pÜt
(
ex´
)

218  
	$ex·nd_dœ_pÜt
(
ex´
, 
has_v4_¤c_pÜt
, 
has_v6_¤c_pÜt
)

219 
’d


220 
loÿl
 
funùiÚ
 
	$ex·nd_d¡_pÜt
(
ex´
)

221  
	$ex·nd_dœ_pÜt
(
ex´
, 
has_v4_d¡_pÜt
, 
has_v6_d¡_pÜt
)

222 
’d


224 
loÿl
 
funùiÚ
 
	$ex·nd_´Ùo_pÜt
(
ex´
, 
´Ùo
)

225 
loÿl
 
pÜt
 = 
ex´
[2]

228 
	`has_v4_´ÙocŞ
(
´Ùo
),

229 
	`has_v4_pÜt
(
pÜt
) },

231 
	`has_v6_´ÙocŞ
(
´Ùo
),

232 
	`has_v6_pÜt
(
pÜt
è} 
	}
}

233 
’d


234 
loÿl
 
funùiÚ
 
	$ex·nd_tı_pÜt
(
ex´
)

235  
	$ex·nd_´Ùo_pÜt
(
ex´
, 
PROTO_TCP
)

236 
’d


237 
loÿl
 
funùiÚ
 
	$ex·nd_udp_pÜt
(
ex´
)

238  
	$ex·nd_´Ùo_pÜt
(
ex´
, 
PROTO_UDP
)

239 
’d


241 
loÿl
 
funùiÚ
 
	$ex·nd_´Ùo_¤c_pÜt
(
ex´
, 
´Ùo
)

242 
loÿl
 
pÜt
 = 
ex´
[2]

245 
	`has_v4_´ÙocŞ
(
´Ùo
),

246 
	`has_v4_¤c_pÜt
(
pÜt
) },

248 
	`has_v6_´ÙocŞ
(
´Ùo
),

249 
	`has_v6_¤c_pÜt
(
pÜt
è} 
	}
}

250 
’d


251 
loÿl
 
funùiÚ
 
	$ex·nd_tı_¤c_pÜt
(
ex´
)

252  
	$ex·nd_´Ùo_¤c_pÜt
(
ex´
, 
PROTO_TCP
)

253 
’d


254 
loÿl
 
funùiÚ
 
	$ex·nd_udp_¤c_pÜt
(
ex´
)

255  
	$ex·nd_´Ùo_¤c_pÜt
(
ex´
, 
PROTO_UDP
)

256 
’d


258 
loÿl
 
funùiÚ
 
	$ex·nd_´Ùo_d¡_pÜt
(
ex´
, 
´Ùo
)

259 
loÿl
 
pÜt
 = 
ex´
[2]

262 
	`has_v4_´ÙocŞ
(
´Ùo
),

263 
	`has_v4_d¡_pÜt
(
pÜt
) },

265 
	`has_v6_´ÙocŞ
(
´Ùo
),

266 
	`has_v6_d¡_pÜt
(
pÜt
è} 
	}
}

267 
’d


268 
loÿl
 
funùiÚ
 
	$ex·nd_tı_d¡_pÜt
(
ex´
)

269  
	$ex·nd_´Ùo_d¡_pÜt
(
ex´
, 
PROTO_TCP
)

270 
’d


271 
loÿl
 
funùiÚ
 
	$ex·nd_udp_d¡_pÜt
(
ex´
)

272  
	$ex·nd_´Ùo_d¡_pÜt
(
ex´
, 
PROTO_UDP
)

273 
’d


275 -- 
PÜŒªge
 
İ”©iÚs


277 
loÿl
 
funùiÚ
 
	$has_v4_¤c_pÜŒªge
(
lo
, 
hi
)

279 { '<=', 
lo
, { '[*]', 
SRC_PORT
, 2 } },

280 { '<=', { '[*]', 
SRC_PORT
, 2 }, 
hi
 } 
	}
}

281 
’d


282 
loÿl
 
funùiÚ
 
	$has_v4_d¡_pÜŒªge
(
lo
, 
hi
)

284 { '<=', 
lo
, { '[*]', 
DST_PORT
, 2 } },

285 { '<=', { '[*]', 
DST_PORT
, 2 }, 
hi
 } 
	}
}

286 
’d


287 
loÿl
 
funùiÚ
 
	$has_v4_pÜŒªge
(
lo
, 
hi
)

288  { 'Ü', 
	`has_v4_¤c_pÜŒªge
(
lo
, 
hi
), 
	`has_v4_d¡_pÜŒªge
Öo, hiè
	}
}

289 
’d


290 
loÿl
 
funùiÚ
 
	$has_v6_¤c_pÜŒªge
(
lo
, 
hi
)

292 { '<=', 
lo
, { '[6*]', 
SRC_PORT
, 2 } },

293 { '<=', { '[6*]', 
SRC_PORT
, 2 }, 
hi
 } 
	}
}

294 
’d


295 
loÿl
 
funùiÚ
 
	$has_v6_d¡_pÜŒªge
(
lo
, 
hi
)

297 { '<=', 
lo
, { '[6*]', 
DST_PORT
, 2 } },

298 { '<=', { '[6*]', 
DST_PORT
, 2 }, 
hi
 } 
	}
}

299 
’d


300 
loÿl
 
funùiÚ
 
	$has_v6_pÜŒªge
(
lo
, 
hi
)

301  { 'Ü', 
	`has_v6_¤c_pÜŒªge
(
lo
, 
hi
), 
	`has_v6_d¡_pÜŒªge
Öo, hiè
	}
}

302 
’d


303 
loÿl
 
funùiÚ
 
	$ex·nd_dœ_pÜŒªge
(
ex´
, 
has_v4_pÜŒªge
, 
has_v6_pÜŒªge
)

304 
loÿl
 
lo
, 
hi
 = 
ex´
[2][1],ƒxpr[2][2]

307 { 'Ü', 
	`has_v4_´ÙocŞ
(
PROTO_TCP
),

308 { 'Ü', 
	`has_v4_´ÙocŞ
(
PROTO_UDP
),

309 
	`has_v4_´ÙocŞ
(
PROTO_SCTP
) } },

310 
	`has_v4_pÜŒªge
(
lo
, 
hi
) },

312 { 'Ü', 
	`has_v6_´ÙocŞ
(
PROTO_TCP
),

313 { 'Ü', 
	`has_v6_´ÙocŞ
(
PROTO_UDP
),

314 
	`has_v6_´ÙocŞ
(
PROTO_SCTP
) } },

315 
	`has_v6_pÜŒªge
(
lo
, 
hi
è} 
	}
}

316 
’d


317 
loÿl
 
funùiÚ
 
	$ex·nd_pÜŒªge
(
ex´
)

318  
	$ex·nd_dœ_pÜŒªge
(
ex´
, 
has_v4_pÜŒªge
, 
has_v6_pÜŒªge
)

319 
’d


320 
loÿl
 
funùiÚ
 
	$ex·nd_¤c_pÜŒªge
(
ex´
)

321  
	$ex·nd_dœ_pÜŒªge
(
ex´
, 
has_v4_¤c_pÜŒªge
, 
has_v6_¤c_pÜŒªge
)

322 
’d


323 
loÿl
 
funùiÚ
 
	$ex·nd_d¡_pÜŒªge
(
ex´
)

324  
	$ex·nd_dœ_pÜŒªge
(
ex´
, 
has_v4_d¡_pÜŒªge
, 
has_v6_d¡_pÜŒªge
)

325 
’d


327 
loÿl
 
funùiÚ
 
	$ex·nd_´Ùo_pÜŒªge
(
ex´
, 
´Ùo
)

328 
loÿl
 
lo
, 
hi
 = 
ex´
[2][1],ƒxpr[2][2]

331 
	`has_v4_´ÙocŞ
(
´Ùo
),

332 
	`has_v4_pÜŒªge
(
lo
, 
hi
) },

334 
	`has_v6_´ÙocŞ
(
´Ùo
),

335 
	`has_v6_pÜŒªge
(
lo
, 
hi
è} 
	}
}

336 
’d


337 
loÿl
 
funùiÚ
 
	$ex·nd_tı_pÜŒªge
(
ex´
)

338  
	$ex·nd_´Ùo_pÜŒªge
(
ex´
, 
PROTO_TCP
)

339 
’d


340 
loÿl
 
funùiÚ
 
	$ex·nd_udp_pÜŒªge
(
ex´
)

341  
	$ex·nd_´Ùo_pÜŒªge
(
ex´
, 
PROTO_UDP
)

342 
’d


344 
loÿl
 
funùiÚ
 
	$ex·nd_´Ùo_¤c_pÜŒªge
(
ex´
, 
´Ùo
)

345 
loÿl
 
lo
, 
hi
 = 
ex´
[2][1],ƒxpr[2][2]

348 
	`has_v4_´ÙocŞ
(
´Ùo
),

349 
	`has_v4_¤c_pÜŒªge
(
lo
, 
hi
) },

351 
	`has_v6_´ÙocŞ
(
´Ùo
),

352 
	`has_v6_¤c_pÜŒªge
(
lo
, 
hi
è} 
	}
}

353 
’d


354 
loÿl
 
funùiÚ
 
	$ex·nd_tı_¤c_pÜŒªge
(
ex´
)

355  
	$ex·nd_´Ùo_¤c_pÜŒªge
(
ex´
, 
PROTO_TCP
)

356 
’d


357 
loÿl
 
funùiÚ
 
	$ex·nd_udp_¤c_pÜŒªge
(
ex´
)

358  
	$ex·nd_´Ùo_¤c_pÜŒªge
(
ex´
, 
PROTO_UDP
)

359 
’d


361 
loÿl
 
funùiÚ
 
	$ex·nd_´Ùo_d¡_pÜŒªge
(
ex´
, 
´Ùo
)

362 
loÿl
 
lo
, 
hi
 = 
ex´
[2][1],ƒxpr[2][2]

365 
	`has_v4_´ÙocŞ
(
´Ùo
),

366 
	`has_v4_d¡_pÜŒªge
(
lo
, 
hi
) },

368 
	`has_v6_´ÙocŞ
(
´Ùo
),

369 
	`has_v6_d¡_pÜŒªge
(
lo
, 
hi
è} 
	}
}

370 
’d


371 
loÿl
 
funùiÚ
 
	$ex·nd_tı_d¡_pÜŒªge
(
ex´
)

372  
	$ex·nd_´Ùo_d¡_pÜŒªge
(
ex´
, 
PROTO_TCP
)

373 
’d


374 
loÿl
 
funùiÚ
 
	$ex·nd_udp_d¡_pÜŒªge
(
ex´
)

375  
	$ex·nd_´Ùo_d¡_pÜŒªge
(
ex´
, 
PROTO_UDP
)

376 
’d


378 -- 
IP
 
´ÙocŞ


380 
loÿl
 
´Ùo_šfo
 = {

381 

 = { 
id
 = 
PROTO_IPV4
, 
acûss
 = "[]", 
¤c
 = 12, 
d¡
 = 16 },

382 
¬p
 = { 
id
 = 
PROTO_ARP
, 
acûss
 = "[¬p]", 
¤c
 = 14, 
d¡
 = 24 },

383 
¿½
 = { 
id
 = 
PROTO_RARP
, 
acûss
 = "[¿½]", 
¤c
 = 14, 
d¡
 = 24 },

384 
6
 = { 
id
 = 
PROTO_IPV6
, 
acûss
 = "[6]", 
¤c
 = 8, 
d¡
 = 24 },

385 
	}
}

387 
loÿl
 
funùiÚ
 
	$has_´Ùo_dœ_ho¡
(
´Ùo
, 
dœ
, 
addr
, 
mask
)

388 
loÿl
 
ho¡
 = 
	$v4_to_št
(
addr
)

389 
loÿl
 
v®
 = { 
´Ùo_šfo
[
´Ùo
].
acûss
,…rÙo_šfo[´Ùo][
dœ
], 4 
	}
}

390 
mask
 
th’


391 
mask
 = 
	$tÚumb”
(
mask
è
ªd
 2^32 - 2^(32 - maskè
Ü
 
	$v4_to_št
(
mask
)

392 
v®
 = { '&', v®, 
	`tÚumb”
(
mask
è
	}
}

393 
’d


394  { 'ªd', 
has_‘h”_´ÙocŞ
(
´Ùo_šfo
[
´Ùo
].
id
), { '=', 
v®
, 
ho¡
 } }

395 
’d


397 
loÿl
 
funùiÚ
 
	$ex·nd__¤c_ho¡
(
ex´
)

398  
	`has_´Ùo_dœ_ho¡
("", "¤c", 
ex´
[2],ƒxpr[3])

399 
’d


400 
loÿl
 
funùiÚ
 
	$ex·nd__d¡_ho¡
(
ex´
)

401  
	`has_´Ùo_dœ_ho¡
("", "d¡", 
ex´
[2],ƒxpr[3])

402 
’d


403 
loÿl
 
funùiÚ
 
	$ex·nd__ho¡
(
ex´
)

404  { 'Ü', 
	`ex·nd__¤c_ho¡
(
ex´
), 
	`ex·nd__d¡_ho¡
Óx´è
	}
}

405 
’d


407 
loÿl
 
funùiÚ
 
	$ex·nd__brßdÿ¡
(
ex´
)

408 
	`”rÜ
("netmask‚ot known, so 'ip broadcast'‚ot supported")

409 
’d


410 
loÿl
 
funùiÚ
 
	$ex·nd_6_brßdÿ¡
(
ex´
)

411 
	`”rÜ
("only†ink-layer/IP broadcast filters supported")

412 
’d


413 
loÿl
 
funùiÚ
 
	$ex·nd__muÉiÿ¡
(
ex´
)

414 
loÿl
 
IPV4_MULTICAST
 = 224 -- 0xe0

415 
loÿl
 
IPV4_DEST_ADDRESS
 = 16

416  { '=', { '[]', 
IPV4_DEST_ADDRESS
, 1 }, 
IPV4_MULTICAST
 
	}
}

417 
’d


418 
loÿl
 
funùiÚ
 
	$ex·nd_6_muÉiÿ¡
(
ex´
)

419 
loÿl
 
IPV6_MULTICAST
 = 255 -- 0xff

420 
loÿl
 
IPV6_DEST_ADDRESS_OFFSET
 = 24 -- 14 + 24 = 38 (
Ï¡
 
two
 
by‹s
 
of
 
de¡
 
add»ss
)

421  { '=', { '[6]', 
IPV6_DEST_ADDRESS_OFFSET
, 1 }, 
IPV6_MULTICAST
 
	}
}

422 
’d


423 
loÿl
 
funùiÚ
 
ex·nd_4_´Ùochaš
(
ex´
)

424 -- 
FIXME
: 
NÙ
 
im¶em’‹d
 
y‘
. 
BPF
 
code
 
of
 

 
´Ùochaš
 
is
 
¿th”
 
com¶ex
.

425  
	$unim¶em’‹d
(
ex´
)

426 
’d


427 
loÿl
 
funùiÚ
 
	`ex·nd_6_´Ùochaš
(
ex´
)

428 -- 
FIXME
: 
NÙ
 
im¶em’‹d
 
y‘
. 
BPF
 
code
 
of
 
6
 
´Ùochaš
 
is
 
¿th”
 
com¶ex
.

429  
	$unim¶em’‹d
(
ex´
)

430 
’d


431 
loÿl
 
funùiÚ
 
	$ex·nd__´Ùochaš
(
ex´
)

432  { 'if', '', 
	`ex·nd_4_´Ùochaš
(
ex´
), 
	`ex·nd_6_´Ùochaš
Óx´è
	}
}

433 
’d


435 
loÿl
 
_´Ùos
 = {

436 
icmp
 = 
PROTO_ICMP
,

437 
	gicmp6
 = 
PROTO_ICMP6
,

438 
	gigmp
 = 
PROTO_IGMP
,

439 
	gig½
 = 
PROTO_IGRP
,

440 
	gpim
 = 
PROTO_PIM
,

441 
	gah
 = 
PROTO_AH
,

442 
	ge¥
 = 
PROTO_ESP
,

443 
	gv¼p
 = 
PROTO_VRRP
,

444 
	gudp
 = 
PROTO_UDP
,

445 
	gtı
 = 
PROTO_TCP
,

446 
	gsùp
 = 
PROTO_SCTP
,

449 
loÿl
 
funùiÚ
 
	$ex·nd_4_´Ùo
(
ex´
)

450 
loÿl
 
´Ùo
 = 
ex´
[2]

451 
	`ty³
(
´Ùo
è=ğ'¡ršg' 
th’
…rÙØğ
_´Ùos
[´Ùo] 
’d


452  
	`has_v4_´ÙocŞ
(
	`as£¹
(
´Ùo
, "Invalid IP…rotocol"))

453 
’d


455 
loÿl
 
funùiÚ
 
	$ex·nd_6_´Ùo
(
ex´
)

456 
loÿl
 
´Ùo
 = 
ex´
[2]

457 
	`ty³
(
´Ùo
è=ğ'¡ršg' 
th’
…rÙØğ
_´Ùos
[´Ùo] 
’d


458  
	`has_v6_´ÙocŞ
(
	`as£¹
(
´Ùo
, "Invalid IP…rotocol"))

459 
’d


461 
loÿl
 
funùiÚ
 
	$ex·nd__´Ùo
(
ex´
)

462  { 'Ü', 
	`has_v4_´ÙocŞ
(
ex´
[2]), 
	`has_v6_´ÙocŞ
Óx´[2]è
	}
}

463 
	g’d


465 -- 
ISO


467 
loÿl
 
	giso_´Ùos
 = {

468 
şÅ
 = 
PROTO_CLNP
,

469 
	gesis
 = 
PROTO_ESIS
,

470 
	gisis
 = 
PROTO_ISIS
,

473 
loÿl
 
funùiÚ
 
	$has_iso_´ÙocŞ
(
´Ùo
)

475 { '<=', { '[‘h”]', 
ETHER_TYPE
, 2 }, 
ETHER_MAX_LEN
 },

477 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 2 }, 
PROTO_ISO
 },

478 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 3, 1 }, 
´Ùo
 } } 
	}
}

479 
’d


481 
loÿl
 
funùiÚ
 
	$ex·nd_iso_´Ùo
(
ex´
)

482 
loÿl
 
´Ùo
 = 
ex´
[2]

483 
	`ty³
(
´Ùo
è=ğ'¡ršg' 
th’
…rÙØğ
iso_´Ùos
[´Ùo] 
’d


484  
	`has_iso_´ÙocŞ
(
	`as£¹
(
´Ùo
, "Invalid ISO…rotocol"))

485 
’d


487 -- 
ARP
 
´ÙocŞ


489 
loÿl
 
funùiÚ
 
	$ex·nd_¬p_¤c_ho¡
(
ex´
)

490  
	`has_´Ùo_dœ_ho¡
("¬p", "¤c", 
ex´
[2],ƒxpr[3])

491 
’d


492 
loÿl
 
funùiÚ
 
	$ex·nd_¬p_d¡_ho¡
(
ex´
)

493  
	`has_´Ùo_dœ_ho¡
("¬p", "d¡", 
ex´
[2],ƒxpr[3])

494 
’d


495 
loÿl
 
funùiÚ
 
	$ex·nd_¬p_ho¡
(
ex´
)

496  { 'Ü', 
	`ex·nd_¬p_¤c_ho¡
(
ex´
), 
	`ex·nd_¬p_d¡_ho¡
Óx´è
	}
}

497 
	g’d


499 -- 
RARP
 
´ÙocŞ


501 
loÿl
 
funùiÚ
 
	$ex·nd_¿½_¤c_ho¡
(
ex´
)

502  
	`has_´Ùo_dœ_ho¡
("¿½", "¤c", 
ex´
[2],ƒxpr[3])

503 
’d


504 
loÿl
 
funùiÚ
 
	$ex·nd_¿½_d¡_ho¡
(
ex´
)

505  
	`has_´Ùo_dœ_ho¡
("¿½", "d¡", 
ex´
[2],ƒxpr[3])

506 
’d


507 
loÿl
 
funùiÚ
 
	$ex·nd_¿½_ho¡
(
ex´
)

508  { 'Ü', 
	`ex·nd_¿½_¤c_ho¡
(
ex´
), 
	`ex·nd_¿½_d¡_ho¡
Óx´è
	}
}

509 
	g’d


511 -- 
IPv6


513 
loÿl
 
funùiÚ
 
	$v6_dœ_ho¡
(
´Ùo
, 
dœ
, 
addr
, 
mask_Ën
)

514 
mask_Ën
 = mask_ËÀ
Ü
 128

515 
loÿl
 
off£t
 = 
´Ùo_šfo
.
6
[
dœ
]

516 
loÿl
 
v6
 = 
	$v6_as_4x32
(
addr
)

518 
loÿl
 
funùiÚ
 
	$m©ch_v6_äagm’t
(
i
)

519 
loÿl
 
äagm’t
 = 
v6
[
i
]

521 -- 
C®cuÏ‹
 
mask
 
äagm’t


522 
loÿl
 
mask
 = 
mask_Ën
 >ğ32 
ªd
 0 
Ü
 mask_len

523 
mask_Ën
 = mask_ËÀ>ğ32 
ªd
 mask_ËÀ- 32 
Ü
 0

525 -- 
R‘r›ve
 
add»ss
 
cu¼’t
 
off£t


526 
loÿl
 
v®
 = { 
´Ùo_šfo
.
6
.
acûss
, 
off£t
, 4 
	}
}

527 
off£t
 = offset + 4

529 
mask
 ~ğ0 
th’
 
v®
 = { '&', v®, 2^32 - 2^(32 - maskè} 
’d


530  { '=', 
v®
, 
äagm’t
 }

531 
’d


533 -- 
Low”šg
 
of
 
ª
 
IPv6
 
add»ss
 
dÛs
 
nÙ
 
»quœe
 
to
 
go
 
™”©e
 
through
 
®l


534 -- 
IPv6
 
äagm’ts
 (4x32). 
Onû
 
mask_Ën
 
becomes
 0 
is
 
possibË
 
to
 
ex™
.

535 
loÿl
 
funùiÚ
 
	$m©ch_v6
(
i
)

536 
loÿl
 
i
 = i 
Ü
 1

537 
loÿl
 
ex´
 = 
	$m©ch_v6_äagm’t
(
i
)

538 
mask_Ën
 =ğ0 
Ü
 
i
 > 4 
th’
  
ex´
 
’d


539  { 'ªd', 
ex´
, 
	`m©ch_v6
(
i
 + 1è
	}
}

540 
’d


542  { 'ªd', 
has_‘h”_´ÙocŞ
(
PROTO_IPV6
), 
m©ch_v6
() }

543 
’d


545 
loÿl
 
funùiÚ
 
	$ex·nd_¤c_v6_ho¡
(
ex´
)

546  
	`v6_dœ_ho¡
('6', '¤c', 
ex´
[2],ƒxpr[3])

547 
’d


548 
loÿl
 
funùiÚ
 
	$ex·nd_d¡_v6_ho¡
(
ex´
)

549  
	`v6_dœ_ho¡
('6', 'd¡', 
ex´
[2],ƒxpr[3])

550 
’d


551 
loÿl
 
funùiÚ
 
	$ex·nd_v6_ho¡
(
ex´
)

553 
	`v6_dœ_ho¡
('6', '¤c', 
ex´
[2],ƒxpr[3]),

554 
	`v6_dœ_ho¡
('6', 'd¡', 
ex´
[2],ƒx´[3]è
	}
}

555 
	g’d


557 -- 
	gHo¡


561 * 
FÜm©
 
IPv4
 
ex´
:

564 * 
FÜm©
 
IPv6
 
ex´
:

568 
loÿl
 
funùiÚ
 
	$is_v6_addr
(
ex´
)

569  
ex´
[2][1] == 'ipv6'

570 
’d


572 
loÿl
 
funùiÚ
 
	$ex·nd_¤c_ho¡
(
ex´
)

573 
	$is_v6_addr
(
ex´
è
th’
  
	$ex·nd_¤c_v6_ho¡
(
ex´
è
’d


574  { 'if', { '' }, 
	`ex·nd__¤c_ho¡
(
ex´
),

575 { 'if', { '¬p' }, 
	`ex·nd_¬p_¤c_ho¡
(
ex´
),

576 
	`ex·nd_¿½_¤c_ho¡
(
ex´
è} 
	}
}

577 
’d


578 
loÿl
 
funùiÚ
 
	$ex·nd_d¡_ho¡
(
ex´
)

579 
	$is_v6_addr
(
ex´
è
th’
  
	$ex·nd_d¡_v6_ho¡
(
ex´
è
’d


580  { 'if', { '' }, 
	`ex·nd__d¡_ho¡
(
ex´
),

581 { 'if', { '¬p' }, 
	`ex·nd_¬p_d¡_ho¡
(
ex´
),

582 
	`ex·nd_¿½_d¡_ho¡
(
ex´
è} 
	}
}

583 
’d


584 -- 
FÜm©
 
IPv4
: { 'ipv4/len', { 'ipv4', 127, 0, 0, 1 }, 8 }

585 -- 
FÜm©
 
IPv4
: { 'ipv4/mask', { 'ipv4', 127, 0, 0, 1 }, { 'ipv4', 255, 0, 0, 0 } }

586 -- 
FÜm©
 
IPv6
: { 'ipv6/len', { 'ipv6', 0, 0, 0, 0, 0, 0, 0, 1 }, 128 }

587 
loÿl
 
funùiÚ
 
	$ex·nd_ho¡
(
ex´
)

588 
	$is_v6_addr
(
ex´
è
th’
  
	$ex·nd_v6_ho¡
(
ex´
è
’d


589  { 'if', { '' }, 
	`ex·nd__ho¡
(
ex´
),

590 { 'if', { '¬p' }, 
	`ex·nd_¬p_ho¡
(
ex´
),

591 
	`ex·nd_¿½_ho¡
(
ex´
è} 
	}
}

592 
’d


594 -- 
Eth”


596 
loÿl
 
MAC_DST
 = 0

597 
loÿl
 
MAC_SRC
 = 6

599 
loÿl
 
funùiÚ
 
	$eho¡_to_št
(
addr
)

600 
	`as£¹
(
addr
[1] == 'ehost', "Not‡ validƒhost‡ddress")

601  
	`ušt16
(
addr
[2],‡ddr[3]), 
	$ušt32
(
addr
[4],‡ddr[5],‡ddr[6],‡ddr[7])

602 
’d


603 
loÿl
 
funùiÚ
 
	$ex·nd_‘h”_¤c_ho¡
(
ex´
)

604 
loÿl
 
hi
, 
lo
 = 
	$eho¡_to_št
(
ex´
[2])

606 { '=', { '[‘h”]', 
MAC_SRC
, 2 }, 
hi
 },

607 { '=', { '[‘h”]', 
MAC_SRC
 + 2, 4 }, 
lo
 } 
	}
}

608 
’d


609 
loÿl
 
funùiÚ
 
	$ex·nd_‘h”_d¡_ho¡
(
ex´
)

610 
loÿl
 
hi
, 
lo
 = 
	$eho¡_to_št
(
ex´
[2])

612 { '=', { '[‘h”]', 
MAC_DST
, 2 }, 
hi
 },

613 { '=', { '[‘h”]', 
MAC_DST
 + 2, 4 }, 
lo
 } 
	}
}

614 
’d


615 
loÿl
 
funùiÚ
 
	$ex·nd_‘h”_ho¡
(
ex´
)

616  { 'Ü', 
	`ex·nd_‘h”_¤c_ho¡
(
ex´
), 
	`ex·nd_‘h”_d¡_ho¡
Óx´è
	}
}

617 
’d


618 
loÿl
 
funùiÚ
 
	$ex·nd_‘h”_brßdÿ¡
(
ex´
)

619 
loÿl
 
brßdÿ¡
 = { 'eho¡', 255, 255, 255, 255, 255, 255 
	}
}

620 
loÿl
 
hi
, 
	glo
 = 
	$eho¡_to_št
(
brßdÿ¡
)

622 { '=', { '[‘h”]', 
MAC_DST
, 2 }, 
hi
 },

623 { '=', { '[‘h”]', 
MAC_DST
 + 2, 4 }, 
lo
 } 
	}
}

624 
’d


625 
loÿl
 
funùiÚ
 
	$ex·nd_‘h”_muÉiÿ¡
(
ex´
)

626  { '!=', { '&', { '[‘h”]', 0, 1 }, 1 }, 0 
	}
}

627 
’d


629 -- 
Eth”
 
´Ùos


631 
loÿl
 
funùiÚ
 
	$ex·nd_
(
ex´
)

632  
	$has_‘h”_´ÙocŞ
(
PROTO_IPV4
)

633 
’d


634 
loÿl
 
funùiÚ
 
	$ex·nd_6
(
ex´
)

635  
	$has_‘h”_´ÙocŞ
(
PROTO_IPV6
)

636 
’d


637 
loÿl
 
funùiÚ
 
	$ex·nd_¬p
(
ex´
)

638  
	$has_‘h”_´ÙocŞ
(
PROTO_ARP
)

639 
’d


640 
loÿl
 
funùiÚ
 
	$ex·nd_¿½
(
ex´
)

641  
	$has_‘h”_´ÙocŞ
(
PROTO_RARP
)

642 
’d


644 
loÿl
 
funùiÚ
 
	$ex·nd_©®k
(
ex´
)

645 
loÿl
 
ATALK_ID_1
 = 491675 -- 0x7809B

646 
loÿl
 
ATALK_ID_2
 = 2863268616 -- 0xaaaa0308

648 
	`has_‘h”_´ÙocŞ
(
PROTO_ATALK
),

649 { 'if', { '>', { '[‘h”]', 
ETHER_TYPE
, 2}, 
ETHER_MAX_LEN
 },

652 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 4, 2 }, 
ATALK_ID_1
 },

653 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 4 }, 
ATALK_ID_2
 } } } 
	}
}

654 
’d


655 
loÿl
 
funùiÚ
 
	$ex·nd_¯½
(
ex´
)

656 
loÿl
 
AARP_ID
 = 2863268608 -- 0xaaaa0300

658 
	`has_‘h”_´ÙocŞ
(
PROTO_AARP
),

659 { 'if', { '>', { '[‘h”]', 
ETHER_TYPE
, 2}, 
ETHER_MAX_LEN
 },

662 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 4, 2 }, 
PROTO_AARP
 },

663 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 4 }, 
AARP_ID
 } } } 
	}
}

664 
’d


665 
loÿl
 
funùiÚ
 
	$ex·nd_deú‘
(
ex´
)

666  
	$has_‘h”_´ÙocŞ
(
PROTO_DECNET
)

667 
’d


668 
loÿl
 
funùiÚ
 
	$ex·nd_sÿ
(
ex´
)

669  
	$has_‘h”_´ÙocŞ
(
PROTO_SCA
)

670 
’d


671 
loÿl
 
funùiÚ
 
	$ex·nd_Ït
(
ex´
)

672  
	$has_‘h”_´ÙocŞ
(
PROTO_LAT
)

673 
’d


674 
loÿl
 
funùiÚ
 
	$ex·nd_mİdl
(
ex´
)

675  
	$has_‘h”_´ÙocŞ
(
PROTO_MOPDL
)

676 
’d


677 
loÿl
 
funùiÚ
 
	$ex·nd_mİrc
(
ex´
)

678  
	$has_‘h”_´ÙocŞ
(
PROTO_MOPRC
)

679 
’d


680 
loÿl
 
funùiÚ
 
	$ex·nd_iso
(
ex´
)

682 { '<=', { '[‘h”]', 
ETHER_TYPE
, 2 }, 
ETHER_MAX_LEN
 },

683 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 2 }, 
PROTO_ISO
 } 
	}
}

684 
’d


685 
loÿl
 
funùiÚ
 
	$ex·nd_¡p
(
ex´
)

687 { '<=', { '[‘h”]', 
ETHER_TYPE
, 2 }, 
ETHER_MAX_LEN
 },

688 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 1 }, 
PROTO_STP
 } 
	}
}

689 
’d


691 
loÿl
 
funùiÚ
 
	$ex·nd_x
(
ex´
)

692 
loÿl
 
IPX_SAP
 = 224 -- 0xe0

693 
loÿl
 
IPX_CHECKSUM
 = 65535 -- 0xffff

694 
loÿl
 
AARP_ID
 = 2863268608 -- 0xaaaa0300

696 
	`has_‘h”_´ÙocŞ
(
PROTO_IPX
),

697 { 'if', { '>', { '[‘h”]', 
ETHER_TYPE
, 2}, 
ETHER_MAX_LEN
 },

701 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 4, 2 }, 
PROTO_IPX
 },

702 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 4 }, 
AARP_ID
 } },

704 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 1 }, 
IPX_SAP
 },

705 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 2 }, 
IPX_CHECKSUM
 } } } } 
	}
}

706 
’d


707 
loÿl
 
funùiÚ
 
	$ex·nd_Ãtbeui
(
ex´
)

709 { '<=', { '[‘h”]', 
ETHER_TYPE
, 2 }, 
ETHER_MAX_LEN
 },

710 { '=', { '[‘h”]', 
ETHER_PAYLOAD
, 2 }, 
PROTO_NETBEUI
 } 
	}
}

711 
’d


713 
loÿl
 
‘h”_´Ùos
 = {

714 

 = 
ex·nd_
,

715 
	g6
 = 
ex·nd_6
,

716 
	g¬p
 = 
ex·nd_¬p
,

717 
	g¿½
 = 
ex·nd_¿½
,

718 
	g©®k
 = 
ex·nd_©®k
,

719 
	g¯½
 = 
ex·nd_¯½
,

720 
	gdeú‘
 = 
ex·nd_deú‘
,

721 
	gsÿ
 = 
ex·nd_sÿ
,

722 
	gÏt
 = 
ex·nd_Ït
,

723 
	gmİdl
 = 
ex·nd_mİdl
,

724 
	gmİrc
 = 
ex·nd_mİrc
,

725 
	giso
 = 
ex·nd_iso
,

726 
	g¡p
 = 
ex·nd_¡p
,

727 
	gx
 = 
ex·nd_x
,

728 
	gÃtbeui
 = 
ex·nd_Ãtbeui
,

731 
loÿl
 
funùiÚ
 
	$ex·nd_‘h”_´Ùo
(
ex´
)

732 
loÿl
 
´Ùo
 = 
ex´
[2]

733 
	`ty³
(
´Ùo
è=ğ'¡ršg' 
th’
  
‘h”_´Ùos
[´Ùo](
ex´
è
’d


734  
	$has_‘h”_´ÙocŞ
(
´Ùo
)

735 
’d


737 -- 
N‘


739 
loÿl
 
funùiÚ
 
	$ex·nd_¤c_Ãt
(
ex´
)

740 
loÿl
 
addr
 = 
ex´


741 
loÿl
 
´Ùo
 = 
ex´
[2][1]

742 
´Ùo
:
	`m©ch
("/Ën$"è
Ü
…rÙo:m©ch("/mask$"è
th’
 
addr
 = 
ex´
[2] 
’d


743 
	$is_v6_addr
(
addr
è
th’
  
	$ex·nd_¤c_v6_ho¡
(
addr
è
’d


744  
	$ex·nd_¤c_ho¡
(
addr
)

745 
’d


746 
loÿl
 
funùiÚ
 
	$ex·nd_d¡_Ãt
(
ex´
)

747 
loÿl
 
addr
 = 
ex´


748 
loÿl
 
´Ùo
 = 
ex´
[2][1]

749 
´Ùo
:
	`m©ch
("/Ën$"è
Ü
…rÙo:m©ch("/mask$"è
th’
 
addr
 = 
ex´
[2] 
’d


750 
	$is_v6_addr
(
addr
è
th’
  
	$ex·nd_d¡_v6_ho¡
(
addr
è
’d


751  
	$ex·nd_d¡_ho¡
(
addr
)

752 
’d


754 -- 
FÜm©
 
IPv4
 
ex´
: { 'Ãt', { 'v4/Ën', { 'v4', 127, 0, 0, 0 }, 8 } 
	}
}

755 -- 
FÜm©
 
IPV6
 
ex´
: { 'net', { 'ipv6/len', { 'ipv6', 0, 0, 0, 0, 0, 0, 0, 1 }, 128 } }

756 
loÿl
 
funùiÚ
 
	$ex·nd_Ãt
(
ex´
)

757 
loÿl
 
addr
 = 
ex´


758 
loÿl
 
´Ùo
 = 
ex´
[2][1]

759 
´Ùo
:
	`m©ch
("/Ën$"è
Ü
…rÙo:m©ch("/mask$"è
th’
 
addr
 = 
ex´
[2] 
’d


760 
	$is_v6_addr
(
addr
è
th’
  
	$ex·nd_v6_ho¡
(
addr
è
’d


761  
	$ex·nd_ho¡
(
addr
)

762 
’d


764 -- 
Pack‘
 
Ëngth


766 
loÿl
 
funùiÚ
 
	$ex·nd_Ëss
(
ex´
)

767  { '<=', 'Ën', 
ex´
[2] 
	}
}

768 
’d


769 
loÿl
 
funùiÚ
 
	$ex·nd_g»©”
(
ex´
)

770  { '>=', 'Ën', 
ex´
[2] 
	}
}

771 
’d


773 -- 
DECNET


775 
loÿl
 
funùiÚ
 
	$ex·nd_deú‘_¤c
(
ex´
)

776 
loÿl
 
addr
 = 
ex´
[2]

777 
loÿl
 
addr_št
 = 
	$ušt16
(
addr
[2],‡ddr[3])

778  { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 1}, 7 }, 2 },

779 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 5, 2}, 
addr_št
 },

780 { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 2}, 65287 }, 33026 },

781 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 6, 2}, 
addr_št
 },

782 { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 1}, 7 }, 6 },

783 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 17, 2}, 
addr_št
 },

784 { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 2}, 65287 }, 33030 },

785 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 18, 2}, 
addr_št
 },

786 { 'çl£' } } } } 
	}
}

787 
’d


788 
loÿl
 
funùiÚ
 
	$ex·nd_deú‘_d¡
(
ex´
)

789 
loÿl
 
addr
 = 
ex´
[2]

790 
loÿl
 
addr_št
 = 
	$ušt16
(
addr
[2],‡ddr[3])

791  { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 1}, 7 }, 2 },

792 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 3, 2}, 
addr_št
 },

793 { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 2}, 65287 }, 33026 },

794 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 4, 2}, 
addr_št
 },

795 { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 1}, 7 }, 6 },

796 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 9, 2}, 
addr_št
 },

797 { 'if', { '=', { '&', { '[‘h”]', 
ETHER_PAYLOAD
 + 2, 2}, 65287 }, 33030 },

798 { '=', { '[‘h”]', 
ETHER_PAYLOAD
 + 10, 2}, 
addr_št
 },

799 { 'çl£' } } } } 
	}
}

800 
’d


801 
loÿl
 
funùiÚ
 
	$ex·nd_deú‘_ho¡
(
ex´
)

802  { 'Ü', 
	`ex·nd_deú‘_¤c
(
ex´
), 
	`ex·nd_deú‘_d¡
Óx´è
	}
}

803 
	g’d


805 -- 
	gIS
-
IS


807 
loÿl
 
	gL1_IIH
 = 15 -- 0x0F

808 
loÿl
 
L2_IIH
 = 16 -- 0x10

809 
loÿl
 
PTP_IIH
 = 17 -- 0x11

810 
loÿl
 
L1_LSP
 = 18 -- 0x12

811 
loÿl
 
L2_LSP
 = 20 -- 0x14

812 
loÿl
 
L1_CSNP
 = 24 -- 0x18

813 
loÿl
 
L2_CSNP
 = 25 -- 0x19

814 
loÿl
 
L1_PSNP
 = 26 -- 0x1A

815 
loÿl
 
L2_PSNP
 = 27 -- 0x1B

817 
loÿl
 
funùiÚ
 
	$ex·nd_isis_´ÙocŞ
(...)

818 
loÿl
 
funùiÚ
 
	$cÚÿt
(
lİ
, 
»g
, 
v®ues
, 
i
)

819 
i
 = i 
Ü
 1

820 
i
 =ğ#v®ue 
th’
  { '=', 
»g
, 
v®ues
[i] 
	}
} 
’d


821  { 
lİ
, { '=', 
»g
, 
v®ues
[
i
] }, 
cÚÿt
(lop,„eg, values, i+1) }

822 
’d


823  { 'if', 
has_iso_´ÙocŞ
(
PROTO_ISIS
),

824 
cÚÿt
('Ü', { '[‘h”]', 
ETHER_PAYLOAD
 + 7, 1 }, {...} ),

826 
’d


827 
loÿl
 
funùiÚ
 
	$ex·nd_l1
(
ex´
)

828  
	$ex·nd_isis_´ÙocŞ
(
L1_IIH
, 
L1_LSP
, 
L1_CSNP
, 
L1_PSNP
, 
PTP_IIH
)

829 
’d


830 
loÿl
 
funùiÚ
 
	$ex·nd_l2
(
ex´
)

831  
	$ex·nd_isis_´ÙocŞ
(
L2_IIH
, 
L2_LSP
, 
L2_CSNP
, 
L2_PSNP
, 
PTP_IIH
)

832 
’d


833 
loÿl
 
funùiÚ
 
	$ex·nd_iih
(
ex´
)

834  
	$ex·nd_isis_´ÙocŞ
(
L1_IIH
, 
L2_IIH
, 
PTP_IIH
)

835 
’d


836 
loÿl
 
funùiÚ
 
	$ex·nd_l¥
(
ex´
)

837  
	$ex·nd_isis_´ÙocŞ
(
L1_LSP
, 
L2_LSP
)

838 
’d


839 
loÿl
 
funùiÚ
 
	$ex·nd_¢p
(
ex´
)

840  
	$ex·nd_isis_´ÙocŞ
(
L1_CSNP
, 
L2_CSNP
, 
L1_PSNP
, 
L2_PSNP
)

841 
’d


842 
loÿl
 
funùiÚ
 
	$ex·nd_c¢p
(
ex´
)

843  
	$ex·nd_isis_´ÙocŞ
(
L1_CSNP
, 
L2_CSNP
)

844 
’d


845 
loÿl
 
funùiÚ
 
	$ex·nd_p¢p
(
ex´
)

846  
	$ex·nd_isis_´ÙocŞ
(
L1_PSNP
, 
L2_PSNP
)

847 
’d


849 
loÿl
 
´im™ive_ex·nd”s
 = {

850 
d¡
 = 
ex·nd_d¡_ho¡
,

851 
d¡_ho¡
 = 
ex·nd_d¡_ho¡
,

852 
d¡_Ãt
 = 
ex·nd_d¡_Ãt
,

853 
d¡_pÜt
 = 
ex·nd_d¡_pÜt
,

854 
d¡_pÜŒªge
 = 
ex·nd_d¡_pÜŒªge
,

855 
¤c
 = 
ex·nd_¤c_ho¡
,

856 
¤c_ho¡
 = 
ex·nd_¤c_ho¡
,

857 
¤c_Ãt
 = 
ex·nd_¤c_Ãt
,

858 
¤c_pÜt
 = 
ex·nd_¤c_pÜt
,

859 
¤c_pÜŒªge
 = 
ex·nd_¤c_pÜŒªge
,

860 
ho¡
 = 
ex·nd_ho¡
,

861 
‘h”_¤c
 = 
ex·nd_‘h”_¤c_ho¡
,

862 
‘h”_¤c_ho¡
 = 
ex·nd_‘h”_¤c_ho¡
,

863 
‘h”_d¡
 = 
ex·nd_‘h”_d¡_ho¡
,

864 
‘h”_d¡_ho¡
 = 
ex·nd_‘h”_d¡_ho¡
,

865 
‘h”_ho¡
 = 
ex·nd_‘h”_ho¡
,

866 
‘h”_brßdÿ¡
 = 
ex·nd_‘h”_brßdÿ¡
,

867 
fddi_¤c
 = 
ex·nd_‘h”_¤c_ho¡
,

868 
fddi_¤c_ho¡
 = 
ex·nd_‘h”_¤c_ho¡
,

869 
fddi_d¡
 = 
ex·nd_‘h”_d¡_ho¡
,

870 
fddi_d¡_ho¡
 = 
ex·nd_‘h”_d¡_ho¡
,

871 
fddi_ho¡
 = 
ex·nd_‘h”_ho¡
,

872 
fddi_brßdÿ¡
 = 
ex·nd_‘h”_brßdÿ¡
,

873 
Œ_¤c
 = 
ex·nd_‘h”_¤c_ho¡
,

874 
Œ_¤c_ho¡
 = 
ex·nd_‘h”_¤c_ho¡
,

875 
Œ_d¡
 = 
ex·nd_‘h”_d¡_ho¡
,

876 
Œ_d¡_ho¡
 = 
ex·nd_‘h”_d¡_ho¡
,

877 
Œ_ho¡
 = 
ex·nd_‘h”_ho¡
,

878 
Œ_brßdÿ¡
 = 
ex·nd_‘h”_brßdÿ¡
,

879 
wÏn_¤c
 = 
ex·nd_‘h”_¤c_ho¡
,

880 
wÏn_¤c_ho¡
 = 
ex·nd_‘h”_¤c_ho¡
,

881 
wÏn_d¡
 = 
ex·nd_‘h”_d¡_ho¡
,

882 
wÏn_d¡_ho¡
 = 
ex·nd_‘h”_d¡_ho¡
,

883 
wÏn_ho¡
 = 
ex·nd_‘h”_ho¡
,

884 
wÏn_brßdÿ¡
 = 
ex·nd_‘h”_brßdÿ¡
,

885 
brßdÿ¡
 = 
ex·nd_‘h”_brßdÿ¡
,

886 
‘h”_muÉiÿ¡
 = 
ex·nd_‘h”_muÉiÿ¡
,

887 
muÉiÿ¡
 = 
ex·nd_‘h”_muÉiÿ¡
,

888 
‘h”_´Ùo
 = 
ex·nd_‘h”_´Ùo
,

889 
g©eway
 = 
unim¶em’‹d
,

890 
Ãt
 = 
ex·nd_Ãt
,

891 
pÜt
 = 
ex·nd_pÜt
,

892 
pÜŒªge
 = 
ex·nd_pÜŒªge
,

893 
Ëss
 = 
ex·nd_Ëss
,

894 
g»©”
 = 
ex·nd_g»©”
,

895 

 = 
ex·nd_
,

896 
_´Ùo
 = 
ex·nd_4_´Ùo
,

897 
_´Ùochaš
 = 
ex·nd_4_´Ùochaš
,

898 
_ho¡
 = 
ex·nd__ho¡
,

899 
_¤c
 = 
ex·nd__¤c_ho¡
,

900 
_¤c_ho¡
 = 
ex·nd__¤c_ho¡
,

901 
_d¡
 = 
ex·nd__d¡_ho¡
,

902 
_d¡_ho¡
 = 
ex·nd__d¡_ho¡
,

903 
_brßdÿ¡
 = 
ex·nd__brßdÿ¡
,

904 
_muÉiÿ¡
 = 
ex·nd__muÉiÿ¡
,

905 
6
 = 
ex·nd_6
,

906 
6_´Ùo
 = 
ex·nd_6_´Ùo
,

907 
6_´Ùochaš
 = 
ex·nd_6_´Ùochaš
,

908 
6_brßdÿ¡
 = 
ex·nd_6_brßdÿ¡
,

909 
6_muÉiÿ¡
 = 
ex·nd_6_muÉiÿ¡
,

910 
´Ùo
 = 
ex·nd__´Ùo
,

911 
tı
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_TCP
è
’d
,

912 
tı_pÜt
 = 
ex·nd_tı_pÜt
,

913 
tı_¤c_pÜt
 = 
ex·nd_tı_¤c_pÜt
,

914 
tı_d¡_pÜt
 = 
ex·nd_tı_d¡_pÜt
,

915 
tı_pÜŒªge
 = 
ex·nd_tı_pÜŒªge
,

916 
tı_¤c_pÜŒªge
 = 
ex·nd_tı_¤c_pÜŒªge
,

917 
tı_d¡_pÜŒªge
 = 
ex·nd_tı_d¡_pÜŒªge
,

918 
udp
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_UDP
è
’d
,

919 
udp_pÜt
 = 
ex·nd_udp_pÜt
,

920 
udp_¤c_pÜt
 = 
ex·nd_udp_¤c_pÜt
,

921 
udp_d¡_pÜt
 = 
ex·nd_udp_d¡_pÜt
,

922 
udp_pÜŒªge
 = 
ex·nd_udp_pÜŒªge
,

923 
udp_¤c_pÜŒªge
 = 
ex·nd_udp_¤c_pÜŒªge
,

924 
udp_d¡_pÜŒªge
 = 
ex·nd_udp_d¡_pÜŒªge
,

925 
icmp
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_ICMP
è
’d
,

926 
icmp6
 = 
	`funùiÚ
(
ex´
è 
	`has_v6_´ÙocŞ
(
PROTO_ICMP6
è
’d
,

927 
igmp
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_IGMP
è
’d
,

928 
ig½
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_IGRP
è
’d
,

929 
pim
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_PIM
è
’d
,

930 
ah
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_AH
è
’d
,

931 
e¥
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_ESP
è
’d
,

932 
v¼p
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_VRRP
è
’d
,

933 
sùp
 = 
	`funùiÚ
(
ex´
è 
	`has__´ÙocŞ
(
PROTO_SCTP
è
’d
,

934 
´Ùochaš
 = 
ex·nd__´Ùochaš
,

935 
¬p
 = 
ex·nd_¬p
,

936 
¬p_ho¡
 = 
ex·nd_¬p_ho¡
,

937 
¬p_¤c
 = 
ex·nd_¬p_¤c_ho¡
,

938 
¬p_¤c_ho¡
 = 
ex·nd_¬p_¤c_ho¡
,

939 
¬p_d¡
 = 
ex·nd_¬p_d¡_ho¡
,

940 
¬p_d¡_ho¡
 = 
ex·nd_¬p_d¡_ho¡
,

941 
¿½
 = 
ex·nd_¿½
,

942 
¿½_ho¡
 = 
ex·nd_¿½_ho¡
,

943 
¿½_¤c
 = 
ex·nd_¿½_¤c_ho¡
,

944 
¿½_¤c_ho¡
 = 
ex·nd_¿½_¤c_ho¡
,

945 
¿½_d¡
 = 
ex·nd_¿½_d¡_ho¡
,

946 
¿½_d¡_ho¡
 = 
ex·nd_¿½_d¡_ho¡
,

947 
©®k
 = 
ex·nd_©®k
,

948 
¯½
 = 
ex·nd_¯½
,

949 
deú‘
 = 
ex·nd_deú‘
,

950 
deú‘_¤c
 = 
ex·nd_deú‘_¤c
,

951 
deú‘_¤c_ho¡
 = 
ex·nd_deú‘_¤c
,

952 
deú‘_d¡
 = 
ex·nd_deú‘_d¡
,

953 
deú‘_d¡_ho¡
 = 
ex·nd_deú‘_d¡
,

954 
deú‘_ho¡
 = 
ex·nd_deú‘_ho¡
,

955 
iso
 = 
ex·nd_iso
,

956 
¡p
 = 
ex·nd_¡p
,

957 
x
 = 
ex·nd_x
,

958 
Ãtbeui
 = 
ex·nd_Ãtbeui
,

959 
sÿ
 = 
ex·nd_sÿ
,

960 
Ït
 = 
ex·nd_Ït
,

961 
mİrc
 = 
ex·nd_mİrc
,

962 
mİdl
 = 
ex·nd_mİdl
,

963 
Îc
 = 
unim¶em’‹d
,

964 
iâame
 = 
unim¶em’‹d
,

965 
Ú
 = 
unim¶em’‹d
,

966 
ºr
 = 
unim¶em’‹d
,

967 
ruËnum
 = 
unim¶em’‹d
,

968 
»asÚ
 = 
unim¶em’‹d
,

969 
r£t
 = 
unim¶em’‹d
,

970 
ruË£t
 = 
unim¶em’‹d
,

971 
¤Ä
 = 
unim¶em’‹d
,

972 
subruËnum
 = 
unim¶em’‹d
,

973 
aùiÚ
 = 
unim¶em’‹d
,

974 
wÏn_¿
 = 
unim¶em’‹d
,

975 
wÏn_
 = 
unim¶em’‹d
,

976 
wÏn_addr1
 = 
unim¶em’‹d
,

977 
wÏn_addr2
 = 
unim¶em’‹d
,

978 
wÏn_addr3
 = 
unim¶em’‹d
,

979 
wÏn_addr4
 = 
unim¶em’‹d
,

980 
ty³
 = 
unim¶em’‹d
,

981 
ty³_subty³
 = 
unim¶em’‹d
,

982 
subty³
 = 
unim¶em’‹d
,

983 
dœ
 = 
unim¶em’‹d
,

984 
vÏn
 = 
unim¶em’‹d
,

985 
m¶s
 = 
unim¶em’‹d
,

986 
µpÛd
 = 
unim¶em’‹d
,

987 
µpÛs
 = 
unim¶em’‹d
,

988 
iso_´Ùo
 = 
ex·nd_iso_´Ùo
,

989 
şÅ
 = 
	`funùiÚ
(
ex´
è 
	`has_iso_´ÙocŞ
(
PROTO_CLNP
è
’d
,

990 
esis
 = 
	`funùiÚ
(
ex´
è 
	`has_iso_´ÙocŞ
(
PROTO_ESIS
è
’d
,

991 
isis
 = 
	`funùiÚ
(
ex´
è 
	`has_iso_´ÙocŞ
(
PROTO_ISIS
è
’d
,

992 
l1
 = 
ex·nd_l1
,

993 
l2
 = 
ex·nd_l2
,

994 
iih
 = 
ex·nd_iih
,

995 
l¥
 = 
ex·nd_l¥
,

996 
¢p
 = 
ex·nd_¢p
,

997 
c¢p
 = 
ex·nd_c¢p
,

998 
p¢p
 = 
ex·nd_p¢p
,

999 
vpi
 = 
unim¶em’‹d
,

1000 
vci
 = 
unim¶em’‹d
,

1001 
ÏÃ
 = 
unim¶em’‹d
,

1002 
ßmf4s
 = 
unim¶em’‹d
,

1003 
ßmf4e
 = 
unim¶em’‹d
,

1004 
ßmf4
 = 
unim¶em’‹d
,

1005 
ßm
 = 
unim¶em’‹d
,

1006 
m‘ac
 = 
unim¶em’‹d
,

1007 
bcc
 = 
unim¶em’‹d
,

1008 
sc
 = 
unim¶em’‹d
,

1009 
mic
 = 
unim¶em’‹d
,

1010 
cÚÃùmsg
 = 
unim¶em’‹d
,

1011 
m‘acÚÃù
 = 
unim¶em’‹d


1012 
	}
}

1014 
loÿl
 
	g»lİs
 = 
£t
('<', '<=', '=', '!=', '>=', '>')

1016 
loÿl
 
	gadd»s§bËs
 = 
£t
(

1021 
loÿl
 
	gbšİs
 = 
£t
(

1024 
loÿl
 
	gassocŸtive_bšİs
 = 
£t
(

1027 
loÿl
 
	gb™İs
 = 
£t
('&', '|', '^')

1028 
loÿl
 
	gunİs
 = 
£t
('ntohs', 'ntohl', 'uint32')

1029 
loÿl
 
	gËaf_´im™ives
 = 
£t
(

1033 
loÿl
 
funùiÚ
 
	$ex·nd_off£t
(
Ëv–
, 
dÉ
)

1034 
	`as£¹
(
dÉ
 == "EN10MB", "Encapsulation otherhan EN10MB unimplemented")

1035 
loÿl
 
funùiÚ
 
	$gu¬d_ex´
(
ex´
)

1036 
loÿl
 
‹¡
, 
gu¬ds
 = 
	$ex·nd_»lİ
(
ex´
, 
dÉ
)

1037  
	`cÚÿt
(
gu¬ds
, { { 
‹¡
, { 'çl£' } } 
	}
})

1038 
’d


1039 
loÿl
 
funùiÚ
 
	$gu¬d_‘h”_´ÙocŞ
(
´Ùo
)

1040  
	`cÚÿt
(
	`gu¬d_ex´
(
	`has_‘h”_´ÙocŞ
(
´Ùo
)),

1041 
	`gu¬d_ex´
(
	$has_‘h”_´ÙocŞ_mš_·ylßd
(
´Ùo
)))

1042 
’d


1043 
funùiÚ
 
	$gu¬d_v4_´ÙocŞ
(
´Ùo
)

1044  
	`cÚÿt
(
	`gu¬d_ex´
(
	`has_v4_´ÙocŞ
(
´Ùo
)),

1045 
	`gu¬d_ex´
(
	$has_v4_´ÙocŞ_mš_·ylßd
(
´Ùo
)))

1046 
’d


1047 
funùiÚ
 
	$gu¬d_v6_´ÙocŞ
(
´Ùo
)

1048  
	`cÚÿt
(
	`gu¬d_ex´
(
	`has_v6_´ÙocŞ
(
´Ùo
)),

1049 
	`gu¬d_ex´
(
	$has_v6_´ÙocŞ_mš_·ylßd
(
´Ùo
)))

1050 
’d


1051 
funùiÚ
 
	$gu¬d_fœ¡_v4_äagm’t
()

1052  
	`gu¬d_ex´
(
	$is_fœ¡_v4_äagm’t
())

1053 
’d


1054 
funùiÚ
 
	$v4_·ylßd_off£t
(
´Ùo
)

1055 
loÿl
 
_off£t
, 
gu¬ds
 = 
	`ex·nd_off£t
('', 
dÉ
)

1056 
´Ùo
 
th’


1057 
gu¬ds
 = 
	`cÚÿt
(gu¬ds, 
	$gu¬d_v4_´ÙocŞ
(
´Ùo
))

1058 
’d


1059 
gu¬ds
 = 
	`cÚÿt
(gu¬ds, 
	$gu¬d_fœ¡_v4_äagm’t
())

1060 
loÿl
 
»s
 = { '+',

1061 { '<<', { '&', { '[]', 
_off£t
, 1 }, 0xf }, 2 },

1062 
_off£t
 
	}
}

1063  
»s
, 
gu¬ds


1064 
’d


1065 
funùiÚ
 
	$v6_·ylßd_off£t
(
´Ùo
)

1066 
loÿl
 
_off£t
, 
gu¬ds
 = 
	`ex·nd_off£t
('6', 
dÉ
)

1067 
´Ùo
 
th’


1068 
gu¬ds
 = 
	`cÚÿt
(gu¬ds, 
	$gu¬d_v6_´ÙocŞ
(
´Ùo
))

1069 
’d


1070  { '+', 
_off£t
, 40 
	}
}, 
gu¬ds


1071 
	g’d


1073 -- 
NÙe
 
th©
 
uÆike
 
theœ
 
cÜ»¥Údšg
 
´ediÿ‹s
 
which
 
	gd‘eù


1074 -- 
e™h”
 
IPv4
 
Ü
 
IPv6
 
	gŒaffic
, [
icmp
], [
udp
], 
	gªd
 [
tı
] 
Úly
 
	gwÜk


1075 -- 
	gIPv4
.

1076 
	gËv–
 =ğ'‘h”' 
th’


1078 
–£if
 
	gËv–
 =ğ'‘h”*' 
th’


1079  
ETHER_PAYLOAD
, {}

1080 
–£if
 
	gËv–
 =ğ'¬p' 
th’


1081  
ETHER_PAYLOAD
, 
	$gu¬d_‘h”_´ÙocŞ
(
PROTO_ARP
)

1082 
–£if
 
Ëv–
 =ğ'¿½' 
th’


1083  
ETHER_PAYLOAD
, 
	$gu¬d_‘h”_´ÙocŞ
(
PROTO_RARP
)

1084 
–£if
 
Ëv–
 =ğ'' 
th’


1085  
ETHER_PAYLOAD
, 
	$gu¬d_‘h”_´ÙocŞ
(
PROTO_IPV4
)

1086 
–£if
 
Ëv–
 =ğ'6' 
th’


1087  
ETHER_PAYLOAD
, 
	$gu¬d_‘h”_´ÙocŞ
(
PROTO_IPV6
)

1088 
–£if
 
Ëv–
 =ğ'*' 
th’


1089  
	$v4_·ylßd_off£t
()

1090 
–£if
 
Ëv–
 =ğ'6*' 
th’


1091  
	$v6_·ylßd_off£t
()

1092 
–£if
 
Ëv–
 =ğ'icmp' 
th’


1093  
	$v4_·ylßd_off£t
(
PROTO_ICMP
)

1094 
–£if
 
Ëv–
 =ğ'udp' 
th’


1095  
	$v4_·ylßd_off£t
(
PROTO_UDP
)

1096 
–£if
 
Ëv–
 =ğ'tı' 
th’


1097  
	$v4_·ylßd_off£t
(
PROTO_TCP
)

1098 
–£if
 
Ëv–
 =ğ'igmp' 
th’


1099  
	$v4_·ylßd_off£t
(
PROTO_IGMP
)

1100 
–£if
 
Ëv–
 =ğ'ig½' 
th’


1101  
	$v4_·ylßd_off£t
(
PROTO_IGRP
)

1102 
–£if
 
Ëv–
 =ğ'pim' 
th’


1103  
	$v4_·ylßd_off£t
(
PROTO_PIM
)

1104 
–£if
 
Ëv–
 =ğ'sùp' 
th’


1105  
	$v4_·ylßd_off£t
(
PROTO_SCTP
)

1106 
–£if
 
Ëv–
 =ğ'v¼p' 
th’


1107  
	$v4_·ylßd_off£t
(
PROTO_VRRP
)

1108 
’d


1109 
	`”rÜ
('šv®id†ev– '..
Ëv–
)

1110 
’d


1112 -- 
R‘uºs
 
two
 
v®ues
: 
the
 
ex·nded
 
¬™hm‘ic
 
ex´essiÚ
 
ªd
 
ª
 
Üd”ed


1113 -- 
li¡
 
of
 
gu¬ds
. 
A
 
gu¬d
 
is
 
a
 
two
-
–em’t
 
¬¿y
 
who£
 
fœ¡
ƒlement

1114 -- 
is
 
a
 
‹¡
 
ex´essiÚ
. 
If
 
®l
e¡ 
ex´essiÚs
 
of
 
the
 
gu¬ds
 
¬e


1115 -- 
Œue
, 
th’
 
™
 
is
 
v®id
 
to
 
ev®u©e
 
the
 
¬™hm‘ic
 
ex´essiÚ
. 
The


1116 -- 
£cÚd
 
–em’t
 
of
 
the
 
gu¬d
 
¬¿y
 
is
h
ex´essiÚ
 
to
 
which
he

1117 -- 
»lİ
 
wl
 
ev®u©e
 
the
 
gu¬d
 
ex´essiÚ
 
çs
: 
e™h”
 { 'çl£' 
	}
}

1118 -- 
Ü
 { 'fail' }.

1119 
funùiÚ
 
	$ex·nd_¬™h
(
ex´
, 
dÉ
)

1120 
	$as£¹
(
ex´
)

1121 
	`ty³
(
ex´
è=ğ'numb”' 
Ü
ƒx´ =ğ'Ën' 
th’
 ƒx´, {
	}
} 
’d


1123 
loÿl
 
	gİ
 = 
ex´
[1]

1124 
bšİs
[
İ
] 
th’


1125 -- 
U£
 64-
b™
 
muÉliÿtiÚ
 
by
 . 
The
 
İtimiz”
 
wl


1126 -- 
»duû
 
this
 
back
 
to
 
Lua
's‚ormal float multiplication if it

1127 -- 
ÿn
.

1128 
İ
 =ğ'*' 
th’
 o°ğ'*64' 
’d


1129 
loÿl
 
lhs
, 
	glhs_gu¬ds
 = 
	$ex·nd_¬™h
(
ex´
[2], 
dÉ
)

1130 
loÿl
 
rhs
, 
rhs_gu¬ds
 = 
	`ex·nd_¬™h
(
ex´
[3], 
dÉ
)

1131 -- 
Mod
 2^32 
to
 
´e£rve
 
ušt32
 
¿nge
.

1132 
loÿl
 
»t
 = { 'ušt32', { 
İ
, 
lhs
, 
rhs
 } 
	}
}

1133 
loÿl
 
gu¬ds
 = 
cÚÿt
(
lhs_gu¬ds
, 
rhs_gu¬ds
)

1134 -- 
RHS
 
of
 
divisiÚ
 
	gÿn
't be 0.

1135 
	gİ
 =ğ'/' 
th’


1136 
loÿl
 
div_gu¬d
 = { { '!=', 
rhs
, 0 }, { 'fail' } }

1137 
gu¬ds
 = 
cÚÿt
(gu¬ds, { 
div_gu¬d
 })

1138 
’d


1139  
	g»t
, 
gu¬ds


1140 
’d


1142 
loÿl
 
	gis_addr
 = 
çl£


1143 
İ
 =ğ'addr' 
th’


1144 
is_addr
 = 
Œue


1145 
ex´
 =ƒxpr[2]

1146 
İ
 = 
ex´
[1]

1147 
’d


1148 
as£¹
(
İ
 ~= '[]', "expr has‡lready beenƒxpanded?")

1149 
loÿl
 
	gadd»s§bË
 = 
as£¹
(
İ
:
m©ch
("^%[(.+)%]$"), "bad‡ddressable")

1150 
loÿl
 
	goff£t
, 
	goff£t_gu¬ds
 = 
	$ex·nd_off£t
(
add»s§bË
, 
dÉ
)

1151 
loÿl
 
lhs
, 
lhs_gu¬ds
 = 
	$ex·nd_¬™h
(
ex´
[2], 
dÉ
)

1152 
loÿl
 
size
 = 
ex´
[3]

1153 
loÿl
 
Ën_‹¡
 = { '<=', { '+', { '+', 
off£t
, 
lhs
 }, 
size
 }, 'Ën' 
	}
}

1154 -- 

[100000] 
wl
 
abÜt
 
the
 
whŞe
 
m©ch”
. &[100000] wÈ
ju¡


1155 -- 
ÿu£
 
the
 
şau£
 
to
 
ç
Ø
m©ch
.

1156 
loÿl
 
Ën_gu¬d
 = { 
Ën_‹¡
, 
is_addr
 
ªd
 { 'çl£' } 
Ü
 { 'fail' } }

1157 
loÿl
 
gu¬ds
 = 
cÚÿt
(cÚÿt(
off£t_gu¬ds
, 
lhs_gu¬ds
), { 
Ën_gu¬d
 })

1158 
loÿl
 
	gaddr
 = { '+', 
off£t
, 
lhs
 }

1159 
is_addr
 
th’
  
addr
, 
gu¬ds
 
’d


1160 
loÿl
 
	g»t
 = { '[]', 
addr
, 
size
 }

1161 
size
 =ğ1 
th’
  
»t
, 
gu¬ds
 
’d


1162 
	gsize
 =ğ2 
th’
  { 'Áohs', 
»t
 }, 
gu¬ds
 
’d


1163 
	gsize
 =ğ4 
th’
  { 'ušt32', { 'Áohl', 
»t
 } }, 
gu¬ds
 
’d


1164 
”rÜ
('unreachable')

1165 
’d


1167 
funùiÚ
 
	$ex·nd_»lİ
(
ex´
, 
dÉ
)

1168 
loÿl
 
lhs
, 
lhs_gu¬ds
 = 
	$ex·nd_¬™h
(
ex´
[2], 
dÉ
)

1169 
loÿl
 
rhs
, 
rhs_gu¬ds
 = 
	$ex·nd_¬™h
(
ex´
[3], 
dÉ
)

1170  { 
ex´
[1], 
lhs
, 
rhs
 
	}
}, 
	$cÚÿt
(
lhs_gu¬ds
, 
rhs_gu¬ds
)

1171 
’d


1173 
funùiÚ
 
	$ex·nd_boŞ
(
ex´
, 
dÉ
)

1174 
	`as£¹
(
	`ty³
(
ex´
) == 'table', 'logicalƒxpression must be‡able')

1175 
ex´
[1] =ğ'nÙ' 
Ü
ƒx´[1] =ğ'!' 
th’


1176  { 'if', 
	`ex·nd_boŞ
(
ex´
[2], 
dÉ
), { 'çl£' }, { 'Œue' } 
	}
}

1177 
–£if
 
ex´
[1] =ğ'ªd' 
Ü
ƒx´[1] =ğ'&&' 
th’


1178  { 'if', 
ex·nd_boŞ
(
ex´
[2], 
dÉ
),

1179 
ex·nd_boŞ
(
ex´
[3], 
dÉ
),

1181 
–£if
 
ex´
[1] =ğ'Ü' 
Ü
ƒx´[1] =ğ'||' 
th’


1182  { 'if', 
ex·nd_boŞ
(
ex´
[2], 
dÉ
),

1184 
ex·nd_boŞ
(
ex´
[3], 
dÉ
) }

1185 
–£if
 
»lİs
[
ex´
[1]] 
th’


1186 -- 
An
 
¬™hm‘ic
 
»lİ
.

1187 
loÿl
 
»s
, 
	ggu¬ds
 = 
ex·nd_»lİ
(
ex´
, 
dÉ
)

1188 -- 
We
 
»move
 
gu¬ds
 
š
 
LIFO
 
	gÜd”
, 
»suÉšg
 iÀ
ª
 
	gex´essiÚ


1189 -- 
who£
 
fœ¡
 
gu¬d
 
ex´essiÚ
 
is
 
the
 fœ¡ 
Úe
 
th©
 
was
 
	gadded
.

1191 
loÿl
 
gu¬d
 = 
bË
.
	$»move
(
gu¬ds
)

1192 
	$as£¹
(
gu¬d
[2])

1193 
»s
 = { 'if', 
gu¬d
[1],„es, gu¬d[2] 
	}
}

1194 
’d


1195  
»s


1196 
–£if
 
ex´
[1] =ğ'if' 
th’


1198 
ex·nd_boŞ
(
ex´
[2], 
dÉ
),

1199 
ex·nd_boŞ
(
ex´
[3], 
dÉ
),

1200 
ex·nd_boŞ
(
ex´
[4], 
dÉ
) }

1201 
–£if
 
Ëaf_´im™ives
[
ex´
[1]] 
th’


1202  
ex´


1204 -- 
A
 
logiÿl
 
´im™ive
.

1205 
loÿl
 
ex·nd”
 = 
´im™ive_ex·nd”s
[
ex´
[1]]

1206 
as£¹
(
ex·nd”
, "unim¶em’‹d…rim™ive: "..
ex´
[1])

1207 
loÿl
 
	gex·nded
 = 
	$ex·nd”
(
ex´
, 
dÉ
)

1208  
	`ex·nd_boŞ
(
	`ex·nd”
(
ex´
, 
dÉ
), dlt)

1209 
’d


1210 
’d


1212 
funùiÚ
 
	$ex·nd
(
ex´
, 
dÉ
)

1213 
dÉ
 = dÉ 
Ü
 'RAW'

1214 
ex´
 = 
	$ex·nd_boŞ
(
ex´
, 
dÉ
)

1215 
v”bo£
 
th’
 
	$µ
(
ex´
è
’d


1216  
ex´


1217 
’d


1219 
funùiÚ
 
	$£láe¡
 ()

1220 
	`´št
("selftest:…f.expand")

1221 
loÿl
 
·r£
 = 
	`»quœe
('pf.parse').parse

1222 
loÿl
 
equ®s
, 
as£¹_equ®s
 = 
uts
.equals, utils.assert_equals

1223 
	`as£¹_equ®s
({ '=', 1, 2 
	}
},

1224 
ex·nd
(
·r£
("1 = 2"), 'EN10MB'))

1225 
as£¹_equ®s
({ '=', 1, "len" },

1226 
ex·nd
(
·r£
("1 =†en"), 'EN10MB'))

1227 
as£¹_equ®s
({ 'if',

1231 
ex·nd
(
·r£
("1 = 2/2"), 'EN10MB'))

1232 
as£¹_equ®s
({ 'if',

1236 
ex·nd
(
·r£
("ether[0] = 2"), 'EN10MB'))

1237 
as£¹_equ®s
(
ex·nd
(
·r£
("src 1::ff11"), 'EN10MB'),

1238 
ex·nd
(
·r£
("src host 1::ff11"), 'EN10MB'))

1239 -- 
Could
 
check
 
	gthis
, 
but
 
	g™
's very†arge

1240 
ex·nd
(
·r£
("tcp…ort 80‡nd (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)"),

1242 
´št
("OK")

1243 
	g’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/libpcap.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
ffi
 = 
	`»quœe
("ffi")

4 
loÿl
 
ty³s
 = 
	`»quœe
("pf.ty³s"è-- 
Lßd
 
FFI
 
deş¬©iÚs
.

5 
loÿl
 
pÿp
 -- 
The
…ÿ°
lib¿ry
, 
Ïzy
 
lßded
.

7 
loÿl
 
v”bo£
 = 
os
.
	`g‘’v
("PF_VERBOSE");

9 
loÿl
 
MAX_UINT32
 = 0xffffffff

11 
ffi
.
cdef
[[

12 
pÿp
 
pÿp_t
;

13 cÚ¡ *
	`pÿp_lib_v”siÚ
();

14 
	`pÿp_d©®šk_Çme_to_v®
(cÚ¡ *
Çme
);

15 
pÿp_t
 *
	`pÿp_İ’_d—d
(
lškty³
, 
¢­Ën
);

16 *
	`pÿp_g‘”r
(
pÿp_t
 *
p
);

17 
	`pÿp_³¼Ü
(
pÿp_t
 *
p
, cÚ¡ *
´efix
);

18 
	`pÿp_compe
(
pÿp_t
 *
p
, 
bpf_´og¿m
 *
å
, cÚ¡ *
¡r
,

19 
İtimize
, 
ušt32_t
 
Ãtmask
);

20 
	`pÿp_ofæše_f‹r
(cÚ¡ 
bpf_´og¿m
 *
å
,

21 cÚ¡ 
pÿp_pkthdr
 *
h
, cÚ¡ 
ušt8_t
 *
pkt
);

24 
funùiÚ
 
	$ofæše_f‹r
(
bpf
, 
hdr
, 
pkt
)

25 
nÙ
 
pÿp
 
th’
…ÿ°ğ
ffi
.
	`lßd
("pÿp"è
’d


26  
pÿp
.
	$pÿp_ofæše_f‹r
(
bpf
, 
hdr
, 
pkt
)

27 
’d


29 -- 
The
 
dÉ_Çme
 
is
 
a
 "d©®šky³‚ame" 
ªd
 
¥ecif›s
 
the
 
lšk
-
Ëv–


30 -- 
w¿µšg
 
to
 
ex³ù
. 
E
.
g
., 
¿w
 
‘h”Ãt
 
äames
, 
you
 
would
 
¥ecify


31 -- "EN10MB" (
ev’
 
though
 
you
 
have
 
a
 10
G
 
ÿrd
), 
which
 
cÜ»¥Úds
 
to
 
the


32 -- 
num”ic
 
DLT_EN10MB
 
v®ue
 
äom
 
pÿp
/
bpf
.
h
. 
S“


33 -- 
h‰p
:

34 -- 
Çmes
.

36 -- 
You
 
´obably
 
wªt
 "RAW" 
¿w
 
	$IP
 (
v4
 
Ü
 
v6
è
äames
. 
If
 
you
 
dÚ
't

37 -- 
suµly
 
a
 
dÉ_Çme
, "RAW" 
is
 
the
 .

38 
funùiÚ
 
	$compe
(
f‹r_¡r
, 
dÉ_Çme
, 
İtimize
)

39 
v”bo£
 
th’
 
	$´št
(
f‹r_¡r
è
’d


40 
nÙ
 
pÿp
 
th’
…ÿ°ğ
ffi
.
	`lßd
("pÿp"è
’d


42 
dÉ_Çme
 = dÉ_Çm
Ü
 "RAW"

43 
loÿl
 
dÉ
 = 
pÿp
.
	$pÿp_d©®šk_Çme_to_v®
(
dÉ_Çme
)

44 
	`as£¹
(
dÉ
 >ğ0, "bad d©®šky³‚am" .. 
dÉ_Çme
)

45 
loÿl
 
¢­Ën
 = 65535 -- 
Maximum
 
·ck‘
 
size
.

46 
loÿl
 
p
 = 
pÿp
.
	$pÿp_İ’_d—d
(
dÉ
, 
¢­Ën
)

48 
	`as£¹
(
p
, "pcap_open_dead failed")

50 -- 
pÿp_compe


51 
loÿl
 
bpf
 = 
ty³s
.
	$bpf_´og¿m
()

52 
loÿl
 
Ãtmask
 = 
MAX_UINT32


53 
İtimize
 =ğ
n
 
th’
 o±imizğ
Œue
 
’d
 -- 
backw¬ds
 
com·tib™y


54 
loÿl
 
”r
 = 
pÿp
.
	$pÿp_compe
(
p
, 
bpf
, 
f‹r_¡r
, 
İtimize
, 
Ãtmask
)

56 
”r
 ~ğ0 
th’


57 
loÿl
 
»asÚ
 = 
ffi
.
	`¡ršg
(
pÿp
.
	`pÿp_g‘”r
(
p
))

58 -- 
In¡—d
 
of
 
çšg
 
ç¡
,  
a
 
f‹r
 
which
 
»jeùs
 
®l
 
·ck‘s


59 
»asÚ
 =ğ"ex´essiÚ„ejeù ®È·ck‘s" 
th’


60 -- 
cÚ¡ruù
 
the
 
®ways
-
»jeùs
 
f‹r
, 
which
 
is
 
like
h®ways-
Œue


61 -- 
f‹r
, 
exû±
 
™s
  
code


62 
pÿp
.
	`pÿp_compe
(
p
, 
bpf
, "1=1", 
Œue
, 
Ãtmask
)

63 
bpf
.
bf_š¢s
[0].
k
 = 0 -- 0 = 
çl£
, 2^16-1 = 
Œue


65 
pÿp
.
	`pÿp_³¼Ü
(
p
, "pcap_compile failed!")

66 
	`”rÜ
("pcap_compile failed")

67 
’d


68 
’d


70  
bpf


71 
’d


73 
funùiÚ
 
	$pÿp_v”siÚ
()

74 
nÙ
 
pÿp
 
th’
…ÿ°ğ
ffi
.
	`lßd
("pÿp"è
’d


75  
ffi
.
	`¡ršg
(
pÿp
.
	$pÿp_lib_v”siÚ
())

76 
’d


78 
funùiÚ
 
	$£láe¡
 ()

79 
	`´št
("selftest:…f.libpcap")

81 
	`compe
("", "EN10MB")

82 
	`compe
("ip", "EN10MB")

83 
	`compe
("tcp", "EN10MB")

84 
	`compe
("tcp…ort 80", "EN10MB")

86 
	`´št
("OK")

87 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/match.lua

1 
moduË
(...,
·ckage
.
£—Î
)

4 --- 
	gProg¿m
 :ğ'm©ch' 
CÚd


5 --- 
CÚd
 :ğ'{' 
CÏu£
... '}'

6 --- 
CÏu£
 :ğ
Te¡
 '=>' 
Di¥©ch
 [
CÏu£T”mš©Ü
]

7 -- 
Te¡
 :ğ'Ùh”wi£' | 
LogiÿlEx´essiÚ


8 --- 
CÏu£T”mš©Ü
 := ',' | ';'

9 --- 
Di¥©ch
 :ğ
C®l
 | 
CÚd


10 --- 
C®l
 :ğ
Id’tif›r
 
Args
?

11 --- 
Args
 :ğ'(' [ 
Ar™hm‘icEx´essiÚ
 [ ',' ArithmeticExpression ] ] ')'

13 --- 
LogiÿlEx´essiÚ
 
ªd
 
Ar™hm‘icEx´essiÚ
 
¬e
 
embedded
 
´oduùiÚs


14 --- 
of
 
pæªg
. 'Ùh”wi£' 
is
 
a
 
Te¡
 
th©
 
®ways
 
m©ches
.

16 --- 
Comm’ts
 
¬e
 
´efixed
 
by
 '--' 
ªd
  
to
 
the
 
’d
 
of
h
lše
.

18 --- 
Compšg
 
a
 
Prog¿m
 
´oduûs
‡ 
M©ch”
. 
A
 M©ch” 
is
‡ 
funùiÚ
 
of


19 --- 
th»e
 
¬gum’ts
: 
a
 
hªdËrs
 
bË
, 
the
 
·ck‘
 
d©a
 
as
‡ 
	gušt8_t
*,

20 --- 
ªd
 
the
 
·ck‘
 
Ëngth
 
š
 
	gby‹s
.

22 --- 
C®lšg
 
a
 
M©ch”
 
wl
 
e™h”
 
»suÉ
 
š
‡ 

 
ÿÎ
 
to
‡ 
	gmemb”


23 --- 
funùiÚ
 
of
 
the
 
hªdËrs
 
	gbË
, 
Ü
  
n
 
no
 
	gdi¥©ch


24 --- 
	gm©ches
.

26 --- 
A
 
C®l
 
m©ches
 
®l
 
of
 
the
 
cÚd™iÚs
 
Ãûs§ry
 
to
 
ev®u©e
 
	gthe


27 --- 
¬™hm‘ic
 
ex´essiÚs
 
š
 
™s
 
¬gum’ts
 
¬e
 
	gŒue
. (
FÜ
 
	gexam¶e
, 
	gthe


28 --- 
¬gum’t
 
	$hªdË
(

[42]è
is
 
Úly
 
v®id
 
the
 
·ck‘
 i 
ª
 
IPv4


29 --- 
·ck‘
 
of
 
a
 
suffic›Á
 
Ëngth
.)

31 --- 
A
 
CÚd
 
®ways
 
m©ches
; 
Úû
 
you
 
’‹r
 
a
 CÚd, 
no
 
şau£
 
outside
 
the


32 --- 
CÚd
 
wl
 
m©ch
. 
If
 
no
 
şau£
 
š
 
the
 CÚd 
m©ches
,h
»suÉ
 
is


33 --- 
n
.

35 --- 
A
 
CÏu£
 
m©ches
 
the
 
Te¡
 
Ú
h
Ëá
-
hªd
-
side
 
of
h
¬row
 
is


36 --- 
Œue
. 
If
 
the
 
right
-
hªd
-
side
 
is
 
a
 
ÿÎ
,h
cÚd™iÚs
 
äom
he

37 --- 
ÿÎ
 
	$¬gum’ts
 (
ªy
è
¬e
 
im¶ic™ly
 
added
 
to
 
the
 
Te¡
 
Ú
he

38 --- 
Ëá
. 
In
 
this
 
way
 
™
's…ossible forhe Testo berue but some

39 --- 
cÚd™iÚ
 
äom
 
the
 
C®l
 
to
 
be
 
çl£
, 
which
 
ÿu£s
h
m©ch
o

40 --- 
´oûed
 
w™h
 
the
 
Ãxt
 
CÏu£
.

42 --- 
UÆike
 
pæªg
, 
©‹m±šg
 
to
 
acûss
 
out
-
of
-
bounds
 
·ck‘
 
d©a
 
m”–y


43 --- 
ÿu£s
 
a
 
şau£
 
nÙ
 
to
 
m©ch
, 
š¡—d
 
of
 
immedŸ‹ly
 
abÜtšg
 
the


44 --- 
m©ch
.

47 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

48 
loÿl
 
·r£_pæªg
 = 
	`»quœe
('pf.·r£').
·r£


49 
loÿl
 
ex·nd_pæªg
 = 
	`»quœe
('pf.ex·nd').
ex·nd


50 
loÿl
 
İtimize
 = 
	`»quœe
('pf.optimize')

51 
loÿl
 
ªf
 = 
	`»quœe
('pf.anf')

52 
loÿl
 
s§
 = 
	`»quœe
('pf.ssa')

53 
loÿl
 
back’d
 = 
	`»quœe
('pf.backend')

55 
loÿl
 
funùiÚ
 
	$¥l™
(
¡r
, 
·t
)

56 
·t
 = '()'..pat..'()'

57 
loÿl
 
»t
, 
¡¬t_pos
 = {
	}
}, 1

58 
loÿl
 
	gtok_pos
, 
	g’d_pos
 = 
¡r
:
	$m©ch
(
·t
)

59 
tok_pos
 do

60 
bË
.
	`š£¹
(
»t
, 
¡r
:
	`sub
(
¡¬t_pos
, 
tok_pos
 - 1))

61 
¡¬t_pos
 = 
’d_pos


62 
tok_pos
, 
’d_pos
 = 
¡r
:
	$m©ch
(
·t
, 
¡¬t_pos
)

63 
’d


64 
bË
.
	`š£¹
(
»t
, 
¡r
:
	$sub
(
¡¬t_pos
))

65  
»t


66 
’d


68 
loÿl
 
funùiÚ
 
	$»move_comm’ts
(
¡r
)

69 
loÿl
 
lšes
 = 
	`¥l™
(
¡r
, '\n')

70 
i
=1,#lines do

71 
loÿl
 
lše
 = 
lšes
[
i
]

72 
loÿl
 
comm’t
 = 
lše
:
	`m©ch
('()%-%-')

73 
comm’t
 
th’
 
lšes
[
i
] = 
lše
:
	`sub
(1, comm’ˆ- 1è
’d


74 
’d


75  
bË
.
	`cÚÿt
(
lšes
, '\n')

76 
’d


78 -- 
R‘uº
 
lše
,†š
numb”
, 
cŞumn
‚umber.

79 
loÿl
 
funùiÚ
 
	$”rÜ_loÿtiÚ
(
¡r
, 
pos
)

80 
loÿl
 
¡¬t
, 
couÁ
 = 1, 1

81 
loÿl
 
¡İ
 = 
¡r
:
	`m©ch
('()\n', 
¡¬t
)

82 
¡İ
 
ªd
 stİ < 
pos
 do

83 
¡¬t
, 
¡İ
 = stİ + 1, 
¡r
:
	`m©ch
('()\n', stop + 1)

84 
couÁ
 = count + 1

85 
’d


86 
¡İ
 
th’
 stİ = stİ - 1 
’d


87  
¡r
:
	`sub
(
¡¬t
, 
¡İ
), 
couÁ
, 
pos
 - start + 1

88 
’d


90 
loÿl
 
funùiÚ
 
	$sÿÂ”
(
¡r
)

91 
¡r
 = 
	$»move_comm’ts
(
¡r
)

92 
loÿl
 
pos
 = 1

93 
loÿl
 
funùiÚ
 
	$”rÜ_¡r
(
mes§ge
, ...)

94 
loÿl
 
lše
, 
lše_numb”
, 
cŞumn_numb”
 = 
	$”rÜ_loÿtiÚ
(
¡r
, 
pos
)

95 
loÿl
 
mes§ge
 = "\npfmatch: syntaxƒrror:%d:%d: "..message..'\n'

96 
loÿl
 
»suÉ
 = 
mes§ge
:
	$fÜm©
(
lše_numb”
, 
cŞumn_numb”
, ...)

97 
»suÉ
 =„esuÉ..
lše
.."\n"

98 
»suÉ
 =„esuÉ..
¡ršg
.
	`»p
(" ", 
cŞumn_numb”
-1).."^".."\n"

99  
»suÉ


100 
’d


101 
loÿl
 
´im™ive_”rÜ
 = 
”rÜ


102 
loÿl
 
funùiÚ
 
	$”rÜ
(
mes§ge
, ...)

103 
	`´im™ive_”rÜ
(
	$”rÜ_¡r
(
mes§ge
, ...))

104 
’d


106 
loÿl
 
funùiÚ
 
	$sk_wh™e¥aû
()

107 
pos
 = 
¡r
:
	`m©ch
('^%s*()',…os)

108 
’d


109 
loÿl
 
funùiÚ
 
	$³ek
(
·t
)

110 
	$sk_wh™e¥aû
()

111  
¡r
:
	`m©ch
('^'..
·t
, 
pos
)

112 
’d


113 
loÿl
 
funùiÚ
 
	$check
(
·t
)

114 
	$sk_wh™e¥aû
()

115 
loÿl
 
¡¬t_pos
, 
’d_pos
 = 
pos
, 
	`³ek
(
·t
.."()")

116 
nÙ
 
’d_pos
 
th’
  
n
 
’d


117 
pos
 = 
’d_pos


118  
¡r
:
	`sub
(
¡¬t_pos
, 
’d_pos
 - 1)

119 
’d


120 
loÿl
 
funùiÚ
 
	$Ãxt_id’tif›r
()

121 
loÿl
 
id
 = 
	`check
('[%a_][%w_]*')

122 
nÙ
 
id
 
th’
 
	`”rÜ
('ex³ùed‡Àid’tif›r'è
’d


123  
id


124 
’d


125 
loÿl
 
funùiÚ
 
	$Ãxt_b®ªûd
(
·œ
)

126 
loÿl
 
tok
 = 
	`check
('%b'..
·œ
)

127 
nÙ
 
tok
 
th’
 
	`”rÜ
("ex³ùed b®ªûd '%s'", 
·œ
è
’d


128  
tok
:
	`sub
(2, #tok - 1)

129 
’d


130 
loÿl
 
funùiÚ
 
	$cÚsume
(
·t
)

131 
nÙ
 
	$check
(
·t
è
th’
 
	`”rÜ
("ex³ùed…©‹º '%s'",…©è
’d


132 
’d


133 
loÿl
 
funùiÚ
 
	$cÚsume_uÁ
(
·t
)

134 
	$sk_wh™e¥aû
()

135 
loÿl
 
¡¬t_pos
, 
’d_pos
, 
Ãxt_pos
 = 
pos
, 
¡r
:
	`m©ch
("()"..
·t
.."()",…os)

136 
nÙ
 
Ãxt_pos
 
th’
 
	`”rÜ
("ex³ùed…©‹º '%s'"è
’d


137 
pos
 = 
Ãxt_pos


138  
¡r
:
	`sub
(
¡¬t_pos
, 
’d_pos
 - 1)

139 
’d


140 
loÿl
 
funùiÚ
 
	$dÚe
()

141 
	$sk_wh™e¥aû
()

142  
pos
 == #str + 1

143 
’d


145 
”rÜ
 =ƒrror,

146 
³ek
 =…eek,

147 
check
 = check,

148 
Ãxt_id’tif›r
 =‚ext_identifier,

149 
Ãxt_b®ªûd
 =‚ext_balanced,

150 
cÚsume
 = consume,

151 
cÚsume_uÁ
 = consume_until,

152 
dÚe
 = done

153 
	}
}

154 
’d


156 
loÿl
 
·r£_di¥©ch


158 
loÿl
 
funùiÚ
 
	$·r£_ÿÎ
(
sÿÂ”
)

159 
loÿl
 
´oc
 = 
sÿÂ”
.
	$Ãxt_id’tif›r
()

160 
nÙ
 
´oc
 
th’
 
sÿÂ”
.
	`”rÜ
('ex³ùed‡…roûdu» c®l'è
’d


161 
loÿl
 
»suÉ
 = { 'ÿÎ', 
´oc
 
	}
}

162 
sÿÂ”
.
³ek
('%('è
th’


163 
loÿl
 
¬gs_¡r
 = 
sÿÂ”
.
Ãxt_b®ªûd
('()')

164 
nÙ
 
¬gs_¡r
:
m©ch
('^%s*$'è
th’


165 
loÿl
 
¬gs
 = 
¥l™
(
¬gs_¡r
, ',')

166 
	gi
=1,#args do

167 
	gbË
.
š£¹
(
»suÉ
, 
·r£_pæªg
(
¬gs
[
i
], {
¬™hm‘ic
=
Œue
}))

168 
’d


169 
’d


170 
’d


171  
»suÉ


172 
’d


174 
loÿl
 
funùiÚ
 
	$·r£_cÚd
(
sÿÂ”
)

175 
loÿl
 
»s
 = { 'cÚd' 
	}
}

176 
nÙ
 
sÿÂ”
.
check
('}') do

177 
loÿl
 
‹¡


178 
sÿÂ”
.
check
('Ùh”wi£'è
th’


179 
‹¡
 = { 'true' }

180 
sÿÂ”
.
cÚsume
('=>')

182 
‹¡
 = 
·r£_pæªg
(
sÿÂ”
.
cÚsume_uÁ
('=>'))

183 
’d


184 
loÿl
 
cÚ£qu’t
 = 
	$·r£_di¥©ch
(
sÿÂ”
)

185 
sÿÂ”
.
	`check
('[,;]')

186 
bË
.
	`š£¹
(
»s
, { 
‹¡
, 
cÚ£qu’t
 
	}
})

187 
’d


188  
»s


189 
’d


191 
funùiÚ
 
	$·r£_di¥©ch
(
sÿÂ”
)

192 
sÿÂ”
.
	`check
('{'è
th’
  
	$·r£_cÚd
(
sÿÂ”
è
’d


193  
	$·r£_ÿÎ
(
sÿÂ”
)

194 
’d


196 
loÿl
 
funùiÚ
 
	$sub¡
(
¡r
, 
v®ues
)

197 
loÿl
 
out
, 
pos
 = '', 1

198 
Œue
 do

199 
loÿl
 
befÜe
, 
aá”
 = 
¡r
:
	`m©ch
('()%$[%w_]+()', 
pos
)

200 
nÙ
 
befÜe
 
th’
  
out
..
¡r
:
	$sub
(
pos
è
’d


201 
out
 = out..
¡r
:
	`sub
(
pos
, 
befÜe
 - 1)

202 
loÿl
 
v¬
 = 
¡r
:
	`sub
(
befÜe
 + 1, 
aá”
 - 1)

203 
loÿl
 
v®
 = 
v®ues
[
v¬
]

204 
nÙ
 
v®
 
th’
 
	`”rÜ
('v¬‚Ù found: '..
v¬
è
’d


205 
out
 = out..
v®


206 
pos
 = 
aá”


207 
’d


208  
out


209 
’d


211 
loÿl
 
funùiÚ
 
	$·r£
(
¡r
)

212 
loÿl
 
sÿÂ”
 = 
	$sÿÂ”
(
¡r
)

213 
sÿÂ”
.
	`cÚsume
('match')

214 
sÿÂ”
.
	`cÚsume
('{')

215 
loÿl
 
cÚd
 = 
	$·r£_cÚd
(
sÿÂ”
)

216 
nÙ
 
sÿÂ”
.
	$dÚe
(è
th’
 
sÿÂ”
.
	`”rÜ
("uÃx³ùedok’"è
’d


217  
cÚd


218 
’d


220 
loÿl
 
funùiÚ
 
	`ex·nd_¬g
(
¬g
, 
dÉ
)

221 -- 
The
 
¬gum’t
 
is
 
ª
 
¬™hm‘ic
 
ex´essiÚ
, 
but
 
the
 
pæªg
 
ex·nd”


222 -- 
ex³ùs
 
a
 
logiÿl
 
ex´essiÚ
. 
W¿p
 
š
‡ 
dummy
 
com·risÚ
, 
th’


223 -- 
‹a£
 
­¬t
 
the
 
cÚd™iÚs
 
ªd
h
¬™hm‘ic
 
ex´essiÚ
.

224 
loÿl
 
ex´
 = 
	`ex·nd_pæªg
({ '=', 
¬g
, 0 
	}
}, 
	gdÉ
)

225 
loÿl
 
	gcÚd™iÚs
 = {}

226 
ex´
[1] == 'if' do

227 
bË
.
	$š£¹
(
cÚd™iÚs
, 
ex´
[2])

228 
	`as£¹
(
	`ty³
(
ex´
[4]) == 'table')

229 
	`as£¹
(
ex´
[4][1] =ğ'ç' 
Ü
ƒxpr[4][1] == 'false')

230 
ex´
 =ƒxpr[3]

231 
’d


232 
	`as£¹
(
ex´
[1] =ğ'=' 
ªd
ƒxpr[3] == 0)

233  
cÚd™iÚs
, 
ex´
[2]

234 
’d


236 
loÿl
 
funùiÚ
 
	$ex·nd_ÿÎ
(
ex´
, 
dÉ
)

237 
loÿl
 
cÚd™iÚs
 = {
	}
}

238 
loÿl
 
»s
 = { 
ex´
[1],ƒxpr[2] }

239 
i
=3,#expr do

240 
loÿl
 
	g¬g_cÚd™iÚs
, 
	g¬g
 = 
	$ex·nd_¬g
(
ex´
[
i
], 
dÉ
)

241 
cÚd™iÚs
 = 
uts
.
	$cÚÿt
(
cÚd™iÚs
, 
¬g_cÚd™iÚs
)

242 
bË
.
	$š£¹
(
»s
, 
¬g
)

243 
’d


244 
loÿl
 
‹¡
 = { 'Œue' 
	}
}

245 -- 
P»£rve
 
Ëá
-
to
-
right
 
Üd”
 
of
 
cÚd™iÚs
.

247 
‹¡
 = { 'if', 
bË
.
»move
(
cÚd™iÚs
),est, { 'false' } }

248 
’d


249  
‹¡
, 
»s


250 
’d


252 
loÿl
 
	gex·nd_cÚd


254 -- 
UÆike
 
	gpæªg
, 
	gout
-
	gof
-
bounds
 
ªd
 
such
 
ju¡
 
ÿu£
 
the
 
şau£
 
to
 
	gç
,

255 -- 
nÙ
 
the
 
whŞe
 
	g´og¿m
.

256 
loÿl
 
funùiÚ
 
	$»¶aû_ç
(
ex´
)

257 
	`ty³
(
ex´
è~ğ'bË' 
th’
 ƒxpr

258 
–£if
 
ex´
[1] =ğ'ç' 
th’
  { 'çl£' 
	}
}

259 
–£if
 
ex´
[1] =ğ'if' 
th’


260 
loÿl
 
‹¡
 = 
	$»¶aû_ç
(
ex´
[2])

261 
loÿl
 
cÚ£qu’t
 = 
	$»¶aû_ç
(
ex´
[3])

262 
loÿl
 
®‹º©e
 = 
	$»¶aû_ç
(
ex´
[4])

263  { 'if', 
‹¡
, 
cÚ£qu’t
, 
®‹º©e
 
	}
}

265  
ex´


266 
’d


267 
’d


269 
loÿl
 
funùiÚ
 
	$ex·nd_şau£
(
‹¡
, 
cÚ£qu’t
, 
dÉ
)

270 
‹¡
 = 
	`»¶aû_ç
(
	$ex·nd_pæªg
(
‹¡
, 
dÉ
))

271 
cÚ£qu’t
[1] =ğ'ÿÎ' 
th’


272 
loÿl
 
cÚd™iÚs
, 
ÿÎ
 = 
	$ex·nd_ÿÎ
(
cÚ£qu’t
, 
dÉ
)

273  { 'if', 
‹¡
, 
cÚd™iÚs
, { 'çl£' } 
	}
}, 
ÿÎ


275 
as£¹
(
cÚ£qu’t
[1] == 'cond')

276  
‹¡
, 
	$ex·nd_cÚd
(
cÚ£qu’t
, 
dÉ
)

277 
’d


278 
’d


280 
funùiÚ
 
	$ex·nd_cÚd
(
ex´
, 
dÉ
)

281 
loÿl
 
»s
 = { 'çl£' 
	}
}

282 
i
=#expr,2,-1 do

283 
loÿl
 
	gşau£
 = 
ex´
[
i
]

284 
loÿl
 
‹¡
, 
	gcÚ£qu’t
 = 
	$ex·nd_şau£
(
şau£
[1], cÏu£[2], 
dÉ
)

285 
»s
 = { 'if', 
‹¡
, 
cÚ£qu’t
,„e 
	}
}

286 
’d


287  
»s


288 
’d


290 
loÿl
 
funùiÚ
 
	$ex·nd
(
ex´
, 
dÉ
)

291  
	$ex·nd_cÚd
(
ex´
, 
dÉ
)

292 
’d


294 
loÿl
 
compe_deçuÉs
 = {

295 
dÉ
='EN10MB', 
İtimize
=
Œue
, 
sourû
=
çl£
, 
sub¡
=false

296 
	}
}

298 
funùiÚ
 
	$compe
(
¡r
, 
İts
)

299 
İts
 = 
uts
.
	`·r£_İts
(İt 
Ü
 {
	}
}, 
	gcompe_deçuÉs
)

300 
	gİts
.
sub¡
 
th’
 
	g¡r
 = 
	$sub¡
(
¡r
, 
İts
.
sub¡
è
’d


301 
loÿl
 
ex´
 = 
	`ex·nd
(
	`·r£
(
¡r
), 
İts
.
dÉ
)

302 
İts
.
İtimize
 
th’
 
ex´
 = o±imize.
	$İtimize
(
ex´
è
’d


303 
ex´
 = 
ªf
.
	$cÚv”t_ªf
(
ex´
)

304 
ex´
 = 
s§
.
	$cÚv”t_s§
(
ex´
)

305 
İts
.
sourû
 
th’
  
back’d
.
	$em™_m©ch_lua
(
ex´
è
’d


306  
back’d
.
	$em™_ªd_lßd_m©ch
(
ex´
, 
f‹r_¡r
)

307 
’d


309 
funùiÚ
 
	$£láe¡
()

310 
	`´št
("selftest:…f.match")

311 
loÿl
 
funùiÚ
 
	$‹¡
(
¡r
, 
ex´
)

312 
uts
.
	`as£¹_equ®s
(
ex´
, 
	$·r£
(
¡r
))

313 
’d


314 
	`‹¡
("m©ch {}", { 'cÚd' 
	}
})

315 
‹¡
("match--comment\n{}", { 'cond' })

316 
‹¡
(" match \n { } ", { 'cond' })

317 
‹¡
("match{}", { 'cond' })

318 
‹¡
("match { otherwise => x() }",

320 
‹¡
("match { otherwise => x(1) }",

322 
‹¡
("match { otherwise => x(1&1) }",

324 
‹¡
("match { otherwise => x(ip[42]) }",

326 
‹¡
("match { otherwise => x(ip[42], 10) }",

328 
‹¡
(
sub¡
("m©ch { oth”wi£ => x([$loc], 10è}", {
loc
=42}),

331 
loÿl
 
funùiÚ
 
	$‹¡
(
¡r
, 
ex´
)

332 
uts
.
	`as£¹_equ®s
(
ex´
, 
	`ex·nd
(
	`·r£
(
¡r
), 'EN10MB'))

333 
’d


334 
	`‹¡
("match { otherwise => x() }",

337 { 'çl£' } 
	}
})

338 
‹¡
("match { otherwise => x(1) }",

342 
‹¡
("match { otherwise => x(1/0) }",

349 
loÿl
 
funùiÚ
 
	$‹¡
(
¡r
, 
ex´
)

350 
uts
.
	`as£¹_equ®s
(
ex´
, 
İtimize
.
	`İtimize
(
	`ex·nd
(
	`·r£
(
¡r
), 'EN10MB')))

351 
’d


352 
	`‹¡
("match { otherwise => x() }",

353 { 'ÿÎ', 'x' 
	}
})

354 
‹¡
("match { otherwise => x(1) }",

356 
‹¡
("match { otherwise => x(1/0) }",

359 
loÿl
 
funùiÚ
 
‹¡
(
¡r
, 
ex´
)

360 -- 
Ju¡
 
a
 
‹¡
 
to
 
£e
 
™
 
wÜks
 
w™hout
 
	g”rÜs
.

361 
	$compe
(
¡r
)

362 
’d


363 
	`‹¡
("match {cp…ort 80 =>…ass }")

365 
	`´št
("OK")

366 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/optimize.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
b™
 = 
	`»quœe
('bit')

4 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

6 
loÿl
 
v”bo£
 = 
os
.
	`g‘’v
("PF_VERBOSE");

8 
loÿl
 
ex·nd_¬™h
, 
ex·nd_»lİ
, 
ex·nd_boŞ


10 
loÿl
 
£t
, 
cÚÿt
, 
dup
, 
µ
 = 
uts
.set, utils.concat, utils.dup, utils.pp

12 -- 
Pæªg
's‚umbers‡re unsigned 32-bit integers, but sometimes we use

13 -- 
Ãg©ive
 
numb”s
 
beÿu£
 
the
 
b™İs
 
moduË
 
´eãrs
 
them
.

14 
loÿl
 
UINT32_MAX
 = 2^32-1

15 
loÿl
 
INT32_MAX
 = 2^31-1

16 
loÿl
 
INT32_MIN
 = -2^31

17 
loÿl
 
UINT16_MAX
 = 2^16-1

19 -- 
We
 
u£
 u£ 
Lua
 
¬™hm‘ic
 
to
 
im¶em’t
 
pæªg
 
İ”©iÚs
, 
so


20 -- 
š‹rmedŸ‹
 
»suÉs
 
ÿn
 
exûed
 
the
 
št32
|
ušt32
 
¿nge
. 
Tho£


21 -- 
š‹rmedŸ‹
 
»suÉs
 
¬e
 
th’
 
şam³d
 
back
 
to
 
the
 
¿nge
 
w™h
he

22 -- 'št32' 
Ü
 'ušt32' 
İ”©iÚs
. 
MuÉliÿtiÚ
 
is
 
şam³d
 
š‹º®ly


23 -- 
by
 
the
 '*64' 
İ”©iÚ
. 
We
'll‚ever see‡ value outsidehis„ange.

24 
loÿl
 
INT_MAX
 = 
UINT32_MAX
 + UINT32_MAX

25 
loÿl
 
INT_MIN
 = 
INT32_MIN
 + INT32_MIN

27 
loÿl
 
»lİs
 = 
	`£t
('<', '<=', '=', '!=', '>=', '>')

29 
loÿl
 
bšİs
 = 
	`£t
(

32 
loÿl
 
assocŸtive_bšİs
 = 
	`£t
(

35 
loÿl
 
b™İs
 = 
	`£t
('&', '|', '^')

36 
loÿl
 
unİs
 = 
	`£t
('ntohs', 'ntohl', 'uint32', 'int32')

37 -- 
İs
 
th©
 
´oduû
 
»suÉs
 
of
 
known
 
ty³s


38 
loÿl
 
št32İs
 = 
	`£t
('&', '|', '^', 'ntohs', 'ntohl', '<<', '>>', 'int32')

39 
loÿl
 
ušt32İs
 = 
	`£t
('uint32', '[]')

40 -- 
İs
 
th©
 
cÛrû
 
theœ
 
¬gum’ts
 
to
 
be
 
w™hš
 
¿nge


41 
loÿl
 
cÛrû_İs
 = 
	`£t
('&', '|', '^', 'ntohs', 'ntohl', '<<', '>>', 'int32',

44 
loÿl
 
fŞd”s
 = {

45 ['+'] = 
	`funùiÚ
(
a
, 
b
è‡ + b 
’d
,

46 ['-'] = 
	`funùiÚ
(
a
, 
b
è‡ - b 
’d
,

47 ['*'] = 
	`funùiÚ
(
a
, 
b
è‡ * b 
’d
,

48 ['*64'] = 
	`funùiÚ
(
a
, 
b
è 
	`tÚumb”
(× * 1LL * bè% 2^32è
’d
,

49 ['/'] = 
	`funùiÚ
(
a
, 
b
)

50 -- 
If
 
the
 
d’omš©Ü
 
is
 
z”o
,h
code
 i 
uÄ—chabË
, 
so
 
™


51 -- 
dÛ¢
't matter what we„eturn.

52 
b
 =ğ0 
th’
  0 
’d


53  
m©h
.
	`æoÜ
(
a
 / 
b
)

54 
’d
,

55 ['&'] = 
	`funùiÚ
(
a
, 
b
è 
b™
.
	`bªd
×, bè
’d
,

56 ['^'] = 
	`funùiÚ
(
a
, 
b
è 
b™
.
	`bxÜ
×, bè
’d
,

57 ['|'] = 
	`funùiÚ
(
a
, 
b
è 
b™
.
	`bÜ
×, bè
’d
,

58 ['<<'] = 
	`funùiÚ
(
a
, 
b
è 
b™
.
	`lshiá
×, bè
’d
,

59 ['>>'] = 
	`funùiÚ
(
a
, 
b
è 
b™
.
	`rshiá
×, bè
’d
,

60 ['Áohs'] = 
	`funùiÚ
(
a
è 
b™
.
	`rshiá
(b™.
	`bsw­
×), 16è
’d
,

61 ['Áohl'] = 
	`funùiÚ
(
a
è 
b™
.
	`bsw­
×è
’d
,

62 ['ušt32'] = 
	`funùiÚ
(
a
è‡ % 2^32 
’d
,

63 ['št32'] = 
	`funùiÚ
(
a
è 
b™
.
	`tob™
×è
’d
,

64 ['='] = 
	`funùiÚ
(
a
, 
b
è‡ =ğb 
’d
,

65 ['!='] = 
	`funùiÚ
(
a
, 
b
è‡ ~ğb 
’d
,

66 ['<'] = 
	`funùiÚ
(
a
, 
b
è‡ < b 
’d
,

67 ['<='] = 
	`funùiÚ
(
a
, 
b
è‡ <ğb 
’d
,

68 ['>='] = 
	`funùiÚ
(
a
, 
b
è‡ >ğb 
’d
,

69 ['>'] = 
	`funùiÚ
(
a
, 
b
è‡ > b 
’d


70 
	}
}

72 
loÿl
 
	gcfkey_ÿche
, 
	gcfkey
 = {}, 
n


74 
loÿl
 
funùiÚ
 
	$memoize
(
f
)

75  
	$funùiÚ
 (
¬g
)

76 
loÿl
 
»suÉ
 = 
cfkey_ÿche
[
¬g
]

77 
»suÉ
 =ğ
n
 
th’


78 
»suÉ
 = 
	$f
(
¬g
)

79 
cfkey_ÿche
[
¬g
] = 
»suÉ


80 
’d


81  
»suÉ


82 
’d


83 
’d


85 
loÿl
 
funùiÚ
 
	$ş—r_ÿche
()

86 
cfkey_ÿche
 = {
	}
}

87 
’d


89 
cfkey
 = 
memoize
(
	$funùiÚ
 (
ex´
)

90 
	`ty³
(
ex´
è=ğ'bË' 
th’


91 
loÿl
 
·¹s
 = {'('
	}
}

92 
i
=1,#expr do

93 
·¹s
[
i
+1] = 
	$cfkey
(
ex´
[
i
])

94 
’d


95 
·¹s
[#parts+1] = ')'

96  
bË
.
	`cÚÿt
(
·¹s
, " ")

98  
ex´


99 
’d


100 
’d
)

102 -- 
A
 
sim¶e
 
ex´essiÚ
 
ÿn
 
be
 
du¶iÿ‹d
. 
FIXME
: 
Some
 
ÿÎs
 
¬e
 simple,

103 -- 
some
 
¬e
 
nÙ
. 
FÜ
 
now
 
our
 
İtimiz©iÚs
 
dÚ
't work very well if we

104 -- 
dÚ
't‡llow duplicationhough.

105 
loÿl
 
sim¶e
 = 
	`£t
('true', 'false', 'match', 'fail', 'call')

106 
loÿl
 
İs
 = 
	`£t
('fail', 'match', 'call')

107 
loÿl
 
Œueİs
 = 
	`£t
('match', 'call', 'true')

109 
loÿl
 
commu‹
 = {

111 
	}
}

113 
loÿl
 
funùiÚ
 
	$Œy_šv”t
(
»lİ
, 
ex´
, 
C
)

114 
	`as£¹
(
	`ty³
(
C
è=ğ'numb”' 
ªd
y³(
ex´
) ~= 'number')

115 
loÿl
 
İ
 = 
ex´
[1]

116 
loÿl
 
is_eq
 = 
»lİ
 =ğ'=' 
Ü
„elop == '!='

117 
İ
 =ğ'Áohl' 
ªd
 
is_eq
 
th’


118 
loÿl
 
rhs
 = 
ex´
[2]

119 
št32İs
[
rhs
[1]] 
th’


120 
	`as£¹
(
INT32_MIN
 <ğ
C
 
ªd
 C <ğ
INT32_MAX
)

121 -- 
	`Áohl
(
INT32
èğ
C
 => INT32 = 
	$Áohl
(
C
)

122  
»lİ
, 
rhs
, 
	$as£¹
(
fŞd”s
[
İ
])(
C
)

123 
–£if
 
ušt32İs
[
rhs
[1]] 
th’


124 -- 
	`Áohl
(
UINT32
èğ
C
 => UINT32 = 
	`ušt32
(
	$Áohl
(
C
))

125  
»lİ
, 
rhs
, 
	$as£¹
(
fŞd”s
[
İ
])(
C
) % 2^32

126 
’d


127 
–£if
 
İ
 =ğ'Áohs' 
ªd
 
is_eq
 
th’


128 
loÿl
 
rhs
 = 
ex´
[2]

129 ià((
rhs
[1] =ğ'Áohs' 
	`Ü
 (rhs[1] =ğ'[]' 
ªd
„hs[3] <= 2))

130 
ªd
 0 <ğ
C
‡nd C <ğ
UINT16_MAX
è
th’


131 -- 
	`Áohs
(
UINT16
èğ
C
 => UINT16 = 
	$Áohs
(
C
)

132  
»lİ
, 
rhs
, 
	$as£¹
(
fŞd”s
[
İ
])(
C
)

133 
’d


134 
–£if
 
İ
 =ğ'ušt32' 
ªd
 
is_eq
 
th’


135 
loÿl
 
rhs
 = 
ex´
[2]

136 
št32İs
[
rhs
[1]] 
th’


137 -- 
	`ušt32
(
INT32
èğ
C
 => INT32 = 
	$št32
(
C
)

138  
»lİ
, 
rhs
, 
b™
.
	$tob™
(
C
)

139 
’d


140 
–£if
 
İ
 =ğ'št32' 
ªd
 
is_eq
 
th’


141 
loÿl
 
rhs
 = 
ex´
[2]

142 
ušt32İs
[
rhs
[1]] 
th’


143 -- 
	`št32
(
UINT32
èğ
C
 => UINT32 = 
	$ušt32
(
C
)

144  
»lİ
, 
rhs
, 
C
 ^ 2^32

145 
’d


146 
–£if
 
b™İs
[
İ
] 
ªd
 
is_eq
 
th’


147 
loÿl
 
lhs
, 
rhs
 = 
ex´
[2],ƒxpr[3]

148 
	`ty³
(
lhs
è=ğ'numb”' 
ªd
 
rhs
[1] =ğ'Áohl' 
th’


149 -- 
	`b™İ
(
C
, 
	`Áohl
(
X
)èğC => b™İÒtohl(C), Xèğ
	$Áohl
(
C
)

150 
loÿl
 
sw­
 = 
	$as£¹
(
fŞd”s
[
rhs
[1]])

151  
»lİ
, { 
İ
, 
	`sw­
(
lhs
), 
rhs
[2] 
	}
}, 
	$sw­
(
C
)

152 
–£if
 
	`ty³
(
rhs
è=ğ'numb”' 
ªd
 
lhs
[1] =ğ'Áohl' 
th’


153 -- 
	`b™İ
(
	`Áohl
(
X
), 
C
èğC => b™İ(X,‚tohl(C)èğ
	$Áohl
(
C
)

154 
loÿl
 
sw­
 = 
	$as£¹
(
fŞd”s
[
lhs
[1]])

155  
»lİ
, { 
İ
, 
lhs
[2], 
	`sw­
(
rhs
è
	}
}, 
	$sw­
(
C
)

156 
–£if
 
İ
 =ğ'&' 
th’


157 
	`ty³
(
lhs
è=ğ'numb”' 
th’
†hs, 
rhs
 =„hs,†h 
’d


158 ià(
	`ty³
(
lhs
è=ğ'bË' 
ªd
†hs[1] == 'ntohs'

159 
ªd
 
	`ty³
(
rhs
è=ğ'numb”'‡nd 0 <ğ
C
‡nd C <ğ
UINT16_MAX
è
th’


160 -- 
	`Áohs
(
X
è& 
C
 = C => X &‚tohs(Cèğ
	$Áohs
(
C
)

161 
loÿl
 
sw­
 = 
	$as£¹
(
fŞd”s
[
lhs
[1]])

162  
»lİ
, { 
İ
, 
lhs
[2], 
	`sw­
(
rhs
è
	}
}, 
	$sw­
(
C
)

163 
’d


164 
’d


165 
’d


166  
»lİ
, 
ex´
, 
C


167 
’d


169 
loÿl
 
sim¶ify_if


171 
loÿl
 
funùiÚ
 
	$sim¶ify
(
ex´
, 
is_
)

172 
	`ty³
(
ex´
è~ğ'bË' 
th’
 ƒx´ 
’d


173 
loÿl
 
İ
 = 
ex´
[1]

174 
loÿl
 
funùiÚ
 
	$decÛrû
(
ex´
)

175 ià(
	`ty³
(
ex´
) == 'table'

176 
	`ªd
 (
ex´
[1] =ğ'ušt32' 
Ü
ƒx´[1] =ğ'št32')è
th’


177  
ex´
[2]

178 
’d


179  
ex´


180 
’d


181 
bšİs
[
İ
] 
th’


182 
loÿl
 
lhs
 = 
	$sim¶ify
(
ex´
[2])

183 
loÿl
 
rhs
 = 
	$sim¶ify
(
ex´
[3])

184 
	`ty³
(
lhs
è=ğ'numb”' 
ªd
y³(
rhs
è=ğ'numb”' 
th’


185  
	$as£¹
(
fŞd”s
[
İ
])(
lhs
, 
rhs
)

186 
–£if
 
assocŸtive_bšİs
[
İ
] 
th’


187 -- 
Try
 
to
 
make
 
the
 
right
 
İ”ªd
 
a
 
numb”
.

188 
	`ty³
(
lhs
è=ğ'numb”' 
th’


189 
lhs
, 
rhs
 =„hs,†hs

190 
’d


191 
	`ty³
(
lhs
è=ğ'bË' 
ªd
†hs[1] =ğ
İ
‡ndy³Öhs[3]è=ğ'numb”' 
th’


192 
	`ty³
(
rhs
è=ğ'numb”' 
th’


193 -- (
A
 
İ
 
N1
èİ 
N2
 -> A 
	$İ
 (
N1
 
İ
 
N2
)

194  { 
İ
, 
lhs
[2], 
	`as£¹
(
fŞd”s
[İ])Öhs[3], 
rhs
è
	}
}

195 
–£if
 
ty³
(
rhs
è=ğ'bË' 
ªd
„hs[1] =ğ
İ
‡ndy³Ôhs[3]è=ğ'numb”' 
th’


196 -- (
A
 
İ
 
N1
èİ (
B
 o°
N2
è-> (A o°Bè
	$İ
 (
N1
 
İ
 
N2
)

197  { 
İ
, { op, 
lhs
[2], 
rhs
[2] }, 
	`as£¹
(
fŞd”s
[İ])Öhs[3],„hs[3]è
	}
}

199 -- (
A
 
İ
 
N
èİ 
X
 -> (A op X) op N

200  { 
İ
, { op, 
lhs
[2], 
rhs
 },†hs[3] }

201 
’d


202 
–£if
 
ty³
(
rhs
è=ğ'bË' 
ªd
„hs[1] =ğ
İ
‡ndy³Ôhs[3]è=ğ'numb”' 
th’


203 -- 
X
 
İ
 (
A
 o°
N
) -> (X op A) op N

204  { 
İ
, { op, 
lhs
, 
rhs
[2]},„hs[3] }

205 
’d


206 
cÛrû_İs
[
İ
] 
th’
 
lhs
, 
	grhs
 = 
decÛrû
Öhs), 
	$decÛrû
(
rhs
è
’d


207 
’d


208  { 
İ
, 
lhs
, 
rhs
 
	}
}

209 
–£if
 
	gunİs
[
İ
] 
th’


210 
loÿl
 
	grhs
 = 
	$sim¶ify
(
ex´
[2])

211 
	`ty³
(
rhs
è=ğ'numb”' 
th’
  
	$as£¹
(
fŞd”s
[
İ
])(
rhs
è
’d


212 
İ
 =ğ'št32' 
ªd
 
št32İs
[
rhs
[1]] 
th’
 „h 
’d


213 
İ
 =ğ'ušt32' 
ªd
 
ušt32İs
[
rhs
[1]] 
th’
 „h 
’d


214 
cÛrû_İs
[
İ
] 
th’
 
rhs
 = 
	$decÛrû
(
rhs
è
’d


215  { 
İ
, 
rhs
 
	}
}

216 
–£if
 
»lİs
[
İ
] 
th’


217 
loÿl
 
lhs
 = 
	$sim¶ify
(
ex´
[2])

218 
loÿl
 
rhs
 = 
	$sim¶ify
(
ex´
[3])

219 
	`ty³
(
lhs
è=ğ'numb”' 
th’


220 
	`ty³
(
rhs
è=ğ'numb”' 
th’


221  { 
	`as£¹
(
fŞd”s
[
İ
])(
lhs
, 
rhs
è
ªd
 'Œue' 
Ü
 'çl£' 
	}
}

222 
’d


223 
İ
, 
	glhs
, 
	grhs
 = 
Œy_šv”t
(
as£¹
(
commu‹
[İ]), 
rhs
, 
lhs
)

224 
–£if
 
ty³
(
rhs
è=ğ'numb”' 
th’


225 
İ
, 
	glhs
, 
	grhs
 = 
	$Œy_šv”t
(
İ
, 
lhs
, 
rhs
)

226 
’d


227  { 
İ
, 
lhs
, 
rhs
 
	}
}

228 
–£if
 
	gİ
 =ğ'if' 
th’


229 
loÿl
 
‹¡
 = 
	$sim¶ify
(
ex´
[2])

230 
loÿl
 
t
, 
f
 = 
	`sim¶ify
(
ex´
[3], 
is_
), 
	$sim¶ify
(
ex´
[4], 
is_
)

231  
	$sim¶ify_if
(
‹¡
, 
t
, 
f
)

232 
–£if
 
İ
 =ğ'ÿÎ' 
th’


233 
loÿl
 
»t
 = { 'ÿÎ', 
ex´
[2] 
	}
}

234 
i
=3,#expr do

235 
	gbË
.
š£¹
(
»t
, 
	$sim¶ify
(
ex´
[
i
]))

236 
’d


237  
»t


239 
İ
 =ğ'm©ch' 
Ü
 o°=ğ'ç' 
th’
  
ex´
 
’d


240 
İ
 =ğ'Œue' 
th’


241 
is_
 
th’
  { 'm©ch' 
	}
} 
’d


242  
ex´


243 
’d


244 
İ
 =ğ'çl£' 
th’


245 
is_
 
th’
  { 'ç' } 
’d


246  
ex´


247 
’d


248 
as£¹
(
İ
 =ğ'[]' 
ªd
 #expr == 3)

249  { 
İ
, 
sim¶ify
(
ex´
[2]),ƒxpr[3] }

250 
’d


251 
’d


253 
funùiÚ
 
	$sim¶ify_if
(
‹¡
, 
t
, 
f
)

254 
loÿl
 
İ
 = 
‹¡
[1]

255 
İ
 =ğ'Œue' 
th’
  
t


256 
–£if
 
İ
 =ğ'çl£' 
th’
  
f


257 
–£if
 
İs
[
İ
] 
th’
  
‹¡


258 
–£if
 
t
[1] =ğ'Œue' 
ªd
 
f
[1] =ğ'çl£' 
th’
  
‹¡


259 
–£if
 
t
[1] =ğ'm©ch' 
ªd
 
f
[1] =ğ'ç' 
th’
  
‹¡


260 
–£if
 
t
[1] =ğ'ç' 
ªd
 
f
[1] =ğ'ç' 
th’
  { 'ç' 
	}
}

261 
–£if
 
İ
 =ğ'if' 
th’


262 
İs
[
‹¡
[3][1]] 
th’


263 -- ià(
A
 

 
B
è
C
 
D
 -> A 
	$
 (
B
 
C
 
D
)

264  
	`sim¶ify_if
(
‹¡
[2],e¡[3], 
	$sim¶ify_if
(
‹¡
[4], 
t
, 
f
))

265 
–£if
 
İs
[
‹¡
[4][1]] 
th’


266 -- ià(
A
 
B
 

è
C
 
D
 -> 
	$A
 (
B
 
C
 
D
è



267  
	`sim¶ify_if
(
‹¡
[2], sim¶ify_ifÑe¡[3], 
t
, 
f
),est[4])

268 
–£if
 
‹¡
[3][1] =ğ'çl£' 
ªd
e¡[4][1] =ğ'Œue' 
th’


269 -- ià(
A
 
çl£
 
Œue
è
C
 
D
 -> A D C

270  
	$sim¶ify_if
(
‹¡
[2], 
f
, 
t
)

271 
’d


272 
t
[1] =ğ'if' 
ªd
 
	`cfkey
(
‹¡
[2]è=ğ
	$cfkey
(
t
[2]è
th’


273 
f
[1] =ğ'if' 
ªd
 
	`cfkey
(
‹¡
[2]è=ğ
	$cfkey
(
f
[2]è
th’


274 -- ià(
A
 
B
 
C
è(A 
D
 
E
è(A 
F
 
G
)

275 -- -> 
	$A
 (
B
 
D
 
F
è(
C
 
E
 
G
)

276  
	`sim¶ify_if
(
‹¡
[2],

277 
	`sim¶ify_if
(
‹¡
[3], 
t
[3], 
f
[3]),

278 
	$sim¶ify_if
(
‹¡
[4], 
t
[4], 
f
[4]))

279 
–£if
 
sim¶e
[
f
[1]] 
th’


280 -- ià(
A
 
B
 
C
è(A 
D
 
E
è
F


281 -- -> 
	$A
 (
B
 
D
 
F
è(
C
 
E
 F)

282  
	`sim¶ify_if
(
‹¡
[2],

283 
	`sim¶ify_if
(
‹¡
[3], 
t
[3], 
f
),

284 
	$sim¶ify_if
(
‹¡
[4], 
t
[4], 
f
))

285 
’d


286 
’d


287 
f
[1] =ğ'if' 
th’


288 
	`cfkey
(
‹¡
[2]è=ğ
	$cfkey
(
f
[2]è
ªd
 
sim¶e
[
t
[1]] 
th’


289 -- ià(
A
 
B
 
C
è
	`D
 (A 
E
 
F
)

290 -- -> 
	$A
 (
B
 
D
 
E
è(
C
 D 
F
)

291  
	`sim¶ify_if
(
‹¡
[2],

292 
	`sim¶ify_if
(
‹¡
[3], 
t
, 
f
[3]),

293 
	$sim¶ify_if
(
‹¡
[4], 
t
, 
f
[4]))

294 
	`–£if
 (
‹¡
[4][1] == 'false'

295 
ªd
 
f
[2][1] == 'if'‡nd f[2][4][1] == 'false'

296 
ªd
 
sim¶e
[
f
[4][1]]

297 
ªd
 
	`cfkey
(
‹¡
[2]è=ğ
	$cfkey
(
f
[2][2])è
th’


298 -- ià(
T
 
A
 
çl£
è
	`B
 (ià(T 
C
 f®£è
D
 
E
)

299 -- -> 
	`T
 (
A
 
	$B
 (
C
 
D
 
E
)) E

300 
loÿl
 
T
, 
A
, 
B
, 
C
, 
D
, 
E
 = 
‹¡
[2],e¡[3], 
t
, 
f
[2][3], f[3], f[4]

301  
	`sim¶ify_if
(
T
, sim¶ify_if(
A
, 
B
, sim¶ify_if(
C
, 
D
, 
E
)), E)

302 
’d


303 
’d


304 
’d


305 
f
[1] =ğ'if' 
ªd
 
	`cfkey
(
t
è=ğ
	$cfkey
(
f
[3]è
ªd
 
nÙ
 
sim¶e
[
t
[1]] 
th’


306 -- 
A
 
	`B
 (
C
 
B
 
D
è-> ià(A 
Œue
 C) B D

307  
	`sim¶ify_if
(sim¶ify_if(
‹¡
, { 'Œue' 
	}
}, 
	gf
[2]), 
	gt
, f[4])

308 
’d


309 
	gt
[1] =ğ'if' 
ªd
 
cfkey
(
f
è=ğ
	$cfkey
(
t
[4]è
ªd
 
nÙ
 
sim¶e
[
f
[1]] 
th’


310 -- 
	$A
 (
B
 
C
 
D
èD -> ià(
A
 B 
çl£
) C D

311  
	`sim¶ify_if
(sim¶ify_if(
‹¡
, 
t
[2], { 'çl£' 
	}
}), 
	gt
[3], 
	gf
)

312 
’d


313  { 'if', 
	g‹¡
, 
	gt
, 
	gf
 }

314 
	g’d


316 -- 
CÚd™iÚ®
 
	gfŞdšg
.

317 
loÿl
 
funùiÚ
 
	$cfŞd
(
ex´
, 
db
)

318 
	`ty³
(
ex´
è~ğ'bË' 
th’
 ƒx´ 
’d


319 
loÿl
 
İ
 = 
ex´
[1]

320 
bšİs
[
İ
] 
th’
  
ex´


321 
–£if
 
unİs
[
İ
] 
th’
  
ex´


322 
–£if
 
»lİs
[
İ
] 
th’


323 
loÿl
 
key
 = 
	$cfkey
(
ex´
)

324 
db
[
key
] ~ğ
n
 
th’


325  { 
db
[
key
] 
ªd
 'Œue' 
Ü
 'çl£' 
	}
}

327  
ex´


328 
’d


329 
–£if
 
İ
 =ğ'if' 
th’


330 
loÿl
 
‹¡
 = 
	$cfŞd
(
ex´
[2], 
db
)

331 
loÿl
 
key
 = 
	$cfkey
(
‹¡
)

332 
db
[
key
] ~ğ
n
 
th’


333 
db
[
key
] 
th’
  
	$cfŞd
(
ex´
[3], 
db
è
’d


334  
	$cfŞd
(
ex´
[4], 
db
)

336 
loÿl
 
db_kt
 = 
İs
[
ex´
[4][1]] 
ªd
 
db
 
Ü
 
	$dup
(
db
)

337 
loÿl
 
db_kf
 = 
İs
[
ex´
[3][1]] 
ªd
 
db
 
Ü
 
	$dup
(
db
)

338 
db_kt
[
key
] = 
Œue


339 
db_kf
[
key
] = 
çl£


340  { 
İ
, 
‹¡
, 
	`cfŞd
(
ex´
[3], 
db_kt
), cfŞdÓx´[4], 
db_kf
è
	}
}

341 
’d


343  
ex´


344 
’d


345 
’d


347 -- 
Rªge
 
šã»nû
.

348 
loÿl
 
funùiÚ
 
	$Rªge
(
mš
, 
max
)

349 
	`as£¹
(
mš
 == min, 'min is NaN')

350 
	`as£¹
(
max
 == max, 'max is NaN')

351 -- 
mš
 
is
 
Ëss
 
thª
 
max
, 
we
 
have
 
uÄ—chabË
 
code
. 
¡l
, 
Ët
's

352 -- 
nÙ
 
viŞ©e
 
	$assum±iÚs
 (
e
.
g
. 
about
 
wacky
 
b™shiá
 
£mªtics
)

353 
mš
 > 
max
 
th’
 mš, max = mš, mš 
’d


354 
loÿl
 
»t
 = { 
mš_
 = 
mš
, 
max_
 = 
max
 
	}
}

355 
funùiÚ
 
	g»t
:
	$mš
(è 
£lf
.
mš_
 
’d


356 
funùiÚ
 
»t
:
	$max
(è 
£lf
.
max_
 
’d


357 
funùiÚ
 
»t
:
	$¿nge
(è 
£lf
:
	`mš
(), s–f:
	$max
(è
’d


358 
funùiÚ
 
»t
:
	$fŞd
()

359 
£lf
:
	`mš
(è=ğ£lf:
	$max
(è
th’


360  
£lf
:
	$mš
()

361 
’d


362 
’d


363 
funùiÚ
 
»t
:
	$É
(
Ùh”
è 
£lf
:
	`max
(è< oth”:
	$mš
(è
’d


364 
funùiÚ
 
»t
:
	$gt
(
Ùh”
è 
£lf
:
	`mš
(è> oth”:
	$max
(è
’d


365 
funùiÚ
 
»t
:(
Ùh”
)

366  
	`Rªge
(
m©h
.
	`mš
(
£lf
:mš(), 
Ùh”
:min()),

367 
m©h
.
	`max
(
£lf
:max(), 
Ùh”
:
	$max
()))

368 
’d


369 
funùiÚ
 
»t
:
	$»¡riù
(
Ùh”
)

370  
	`Rªge
(
m©h
.
	`max
(
£lf
:
	`mš
(), 
Ùh”
:min()),

371 
m©h
.
	`mš
(
£lf
:
	`max
(), 
Ùh”
:
	$max
()))

372 
’d


373 
funùiÚ
 
»t
:
	$tob™
()

374 ià(
£lf
:
	`max
(è- s–f:
	`mš
() < 2^32

375 
ªd
 
b™
.
	`tob™
(
£lf
:
	`mš
()è<ğb™.tob™(£lf:
	$max
())è
th’


376  
	`Rªge
(
b™
.
	`tob™
(
£lf
:
	`mš
()), b™.tob™(£lf:
	$max
()))

377 
’d


378  
	$Rªge
(
INT32_MIN
, 
INT32_MAX
)

379 
’d


380 
funùiÚ
 
»t
.
	`bš¬y
(
lhs
, 
rhs
, 
İ
è-- 
mÚÙÚic
 
funùiÚs


381 
loÿl
 
fŞd
 = 
	$as£¹
(
fŞd”s
[
İ
])

382 
loÿl
 
a
 = 
	`fŞd
(
lhs
:
	`mš
(), 
rhs
:
	$mš
())

383 
loÿl
 
b
 = 
	`fŞd
(
lhs
:
	`mš
(), 
rhs
:
	$max
())

384 
loÿl
 
c
 = 
	`fŞd
(
lhs
:
	`max
(), 
rhs
:
	$max
())

385 
loÿl
 
d
 = 
	`fŞd
(
lhs
:
	`max
(), 
rhs
:
	$mš
())

386  
	`Rªge
(
m©h
.
	`mš
(
a
, 
b
, 
c
, 
d
), m©h.
	$max
(
a
, 
b
, 
c
, 
d
))

387 
’d


388 
funùiÚ
 
»t
.
	$add
(
lhs
, 
rhs
è†hs:
	`bš¬y
Ôhs, '+'è
’d


389 
funùiÚ
 
»t
.
	$sub
(
lhs
, 
rhs
è†hs:
	`bš¬y
Ôhs, '-'è
’d


390 
funùiÚ
 
»t
.
	$mul
(
lhs
, 
rhs
è†hs:
	`bš¬y
Ôhs, '*'è
’d


391 
funùiÚ
 
»t
.
	$mul64
(
lhs
, 
rhs
è 
	$Rªge
(0, 
UINT32_MAX
è
’d


392 
funùiÚ
 
»t
.
	$div
(
lhs
, 
rhs
)

393 
loÿl
 
rhs_mš
, 
rhs_max
 = 
rhs
:
	`mš
(),„hs:
	`max
()

394 -- 0 
is
 
´ohib™ed
 
by
 
as£¹iÚs
, 
so
 
we
 
wÚ
't hit it‡t„untime,

395 -- 
but
 
we
 
could
 
¡l
 
£e
 { '/', 0, 0 
	}
} 
š
 
the
 
IR
 
wh’
 
™
 
	gis


396 -- 
domš©ed
 
by
 
ª
 
as£¹iÚ
 
	gth©
 { '!=', 0, 0 }. 
The
 
	g»suÉšg


397 -- 
¿nge
 
	gwÚ
't includehe„hs-is-zero case.

398 
	grhs_mš
 =ğ0 
th’


399 -- 
If
 
the
 
RHS
 
	$is
 (
Ü
 
fŞds
 
to
è
l™”®
 0, 
we
 
û¹ašly
 
wÚ
't

400 -- 
»ach
 
h”e
 
so
 
we
 
ÿn
 
make
 
up
 
wh©ev”
 
v®ue
 w
wªt
.

401 
rhs_max
 =ğ0 
th’
  
	$Rªge
(0, 0è
’d


402 
rhs_mš
 = 1

403 
–£if
 
rhs_max
 =ğ0 
th’


404 
rhs_max
 = -1

405 
’d


406 -- 
Now
 
th©
 
we
 
have
 
»moved
 0 
äom
 
the
 
lim™s
,

407 -- 
the
 
RHS
 
ÿn
't change sign, we can use binary() on its„ange.

408 
rhs_mš
 > 0 
Ü
 
rhs_max
 < 0 
th’


409  
lhs
:
	`bš¬y
(
	`Rªge
(
rhs_mš
, 
rhs_max
), '/')

410 
’d


411 -- 
Oth”wi£
 
we
 
ÿn
 
u£
 
	$bš¬y
(è
Ú
 
the
 
two
 
£mi
-
¿nges
.

412 
loÿl
 
low
, 
high
 = 
	`Rªge
(
rhs_mš
, -1), 
	$Rªge
(1, 
rhs_max
)

413  
lhs
:
	`bš¬y
(
low
, '/'):Öhs:bš¬y(
high
, '/'))

414 
’d


415 
funùiÚ
 
»t
.
	$bªd
(
lhs
, 
rhs
)

416 
lhs
, 
rhs
 =†hs:
	`tob™
(),„hs:
	$tob™
()

417 
lhs
:
	`mš
(è< 0 
ªd
 
rhs
:mš(è< 0 
th’


418  
	$Rªge
(
INT32_MIN
, 
INT32_MAX
)

419 
’d


420  
	`Rªge
(0, 
m©h
.
	`max
(m©h.
	`mš
(
lhs
:max(), 
rhs
:max()), 0))

421 
’d


422 
funùiÚ
 
»t
.
	$bÜ
(
lhs
, 
rhs
)

423 
lhs
, 
rhs
 =†hs:
	`tob™
(),„hs:
	$tob™
()

424 
loÿl
 
funùiÚ
 
	$§tu¿‹
(
x
)

425 
loÿl
 
y
 = 1

426 
y
 < 
x
 dØy = y * 2 
’d


427  
y
 - 1

428 
’d


429 
lhs
:
	`mš
(è< 0 
Ü
 
rhs
:mš(è< 0 
th’
  
	`Rªge
(
INT32_MIN
, -1è
’d


430  
	`Rªge
(
b™
.
	`bÜ
(
lhs
:
	`mš
(), 
rhs
:min()),

431 
	`§tu¿‹
(
b™
.
	`bÜ
(
lhs
:
	`max
(), 
rhs
:
	$max
())))

432 
’d


433 
funùiÚ
 
»t
.
	$bxÜ
(
lhs
, 
rhs
è†hs:
	$bÜ
(
rhs
è
’d


434 
funùiÚ
 
»t
.
	$lshiá
(
lhs
, 
rhs
)

435 
lhs
, 
rhs
 =†hs:
	`tob™
(),„hs:
	$tob™
()

436 
loÿl
 
funùiÚ
 
	`ÅÙ
(
x
è-- 
Ãxt
 
pow”
 
of
 
two


437 
x
 >ğ2^31 
th’
  32 
’d


438 
loÿl
 
n
, 
i
 = 1, 1

439 
n
 < 
x
 dØn, 
i
 =‚ * 2, i + 1 
’d


440  
i


441 
’d


442 
lhs
:
	`mš
(è>ğ0 
th’


443 
loÿl
 
mš_lhs
, 
max_lhs
 = 
lhs
:
	`mš
(),†hs:
	`max
()

444 -- 
It
's‚uts, but†shift does‡n implicit modulo onhe RHS.

445 
loÿl
 
mš_shiá
, 
max_shiá
 = 0, 31

446 
rhs
:
	`mš
(è>ğ0 
ªd
„hs:
	`max
(è< 32 
th’


447 
mš_shiá
, 
max_shiá
 = 
rhs
:
	`mš
(),„hs:
	$max
()

448 
’d


449 
	`ÅÙ
(
max_lhs
è+ 
max_shiá
 < 32 
th’


450 
	`as£¹
(
b™
.
	`lshiá
(
max_lhs
, 
max_shiá
) > 0)

451  
	`Rªge
(
b™
.
	`lshiá
(
mš_lhs
, 
mš_shiá
),

452 
b™
.
	$lshiá
(
max_lhs
, 
max_shiá
))

453 
’d


454 
’d


455  
	$Rªge
(
INT32_MIN
, 
INT32_MAX
)

456 
’d


457 
funùiÚ
 
»t
.
	$rshiá
(
lhs
, 
rhs
)

458 
lhs
, 
rhs
 =†hs:
	`tob™
(),„hs:
	$tob™
()

459 
loÿl
 
mš_lhs
, 
max_lhs
 = 
lhs
:
	`mš
(),†hs:
	`max
()

460 -- 
Same
 
comm’ts
 
w¹
 
modulo
 
of
 
shiá
.

461 
loÿl
 
mš_shiá
, 
max_shiá
 = 0, 31

462 
rhs
:
	`mš
(è>ğ0 
ªd
„hs:
	`max
(è< 32 
th’


463 
mš_shiá
, 
max_shiá
 = 
rhs
:
	`mš
(),„hs:
	$max
()

464 
’d


465 
mš_shiá
 > 0 
th’


466 -- 
If
 
we
 
rshiá
 
by
 1 
Ü
 
mÜe
, 
»suÉ
 
wl
 
nÙ
 
be
 
Ãg©ive
.

467 
mš_lhs
 >ğ0 
ªd
 
max_lhs
 < 2^32 
th’


468  
	`Rªge
(
b™
.
	`rshiá
(
mš_lhs
, 
max_shiá
),

469 
b™
.
	$rshiá
(
max_lhs
, 
mš_shiá
))

471 -- -1 
is
 "all bits set".

472  
	`Rªge
(
b™
.
	`rshiá
(-1, 
max_shiá
),

473 
b™
.
	`rshiá
(-1, 
mš_shiá
))

474 
’d


475 
–£if
 
mš_lhs
 >ğ0 
ªd
 
max_lhs
 < 2^31 
th’


476 -- 
Leá
-
hªd
-
side
 
š
 [0, 2^31): 
»suÉ
 
nÙ
 
Ãg©ive
.

477  
	`Rªge
(
b™
.
	`rshiá
(
mš_lhs
, 
max_shiá
),

478 
b™
.
	$rshiá
(
max_lhs
, 
mš_shiá
))

480 -- 
Oth”wi£
 
puÁ
.

481  
	$Rªge
(
INT32_MIN
, 
INT32_MAX
)

482 
’d


483 
’d


484  
»t


485 
’d


487 
loÿl
 
funùiÚ
 
	$šãr_¿nges
(
ex´
)

488 
loÿl
 
funùiÚ
 
	$cÚs
(
ÿr
, 
cdr
è { c¬, cd¸
	}
} 
’d


489 
loÿl
 
funùiÚ
 
	$ÿr
(
·œ
è…aœ[1] 
’d


490 
loÿl
 
funùiÚ
 
	$cdr
(
·œ
è…aœ[2] 
’d


491 
loÿl
 
funùiÚ
 
	$ÿdr
(
·œ
è 
	`ÿr
(
	$cdr
(
·œ
)è
’d


492 
loÿl
 
funùiÚ
 
	$push
(
db
è 
	`cÚs
({
	}
}, 
	gdb
è
’d


493 
loÿl
 
funùiÚ
 
	$lookup
(
db
, 
ex´
)

494 
	`ty³
(
ex´
è=ğ'numb”' 
th’
  
	$Rªge
(
ex´
,ƒx´è
’d


495 
loÿl
 
key
 = 
	$cfkey
(
ex´
)

496 
db
 do

497 
loÿl
 
¿nge
 = 
	`ÿr
(
db
)[
key
]

498 
¿nge
 
th’
 „ªg
’d


499 
db
 = 
	$cdr
(
db
)

500 
’d


501 
ex´
 =ğ'Ën' 
th’
  
	$Rªge
(0, 
UINT16_MAX
è
’d


502  
	$Rªge
(
INT_MIN
, 
INT_MAX
)

503 
’d


504 
loÿl
 
funùiÚ
 
	$defše
(
db
, 
ex´
, 
¿nge
)

505 
	`ty³
(
ex´
è=ğ'numb”' 
th’
 ƒx´ 
’d


506 
	`ÿr
(
db
)[
	`cfkey
(
ex´
)] = 
¿nge


507 
¿nge
:
	$fŞd
(è
th’
  
¿nge
:
	$mš
(è
’d


508  
ex´


509 
’d


510 
loÿl
 
funùiÚ
 
	$»¡riù
(
db
, 
ex´
, 
¿nge
)

511  
	`defše
(
db
, 
ex´
, 
	$lookup
(
db
, 
ex´
):
	$»¡riù
(
¿nge
))

512 
’d


513 
loÿl
 
funùiÚ
 
	$m”ge
(
db
, 
h—d
)

514 
key
, 
¿nge
 
š
 
	$·œs
(
h—d
èdØ
	`ÿr
(
db
)[
key
] = 
¿nge
 
’d


515 
’d


516 
loÿl
 
funùiÚ
 (
db
, 
h1
, 
h2
)

517 
key
, 
¿nge1
 
š
 
	$·œs
(
h1
) do

518 
loÿl
 
¿nge2
 = 
h2
[
key
]

519 
¿nge2
 
th’
 
	`ÿr
(
db
)[
key
] = 
¿nge1
:Ôªge2è
’d


520 
’d


521 
’d


523 -- 
R‘uºs
 
lhs
 
Œue
 
¿nge
,†h 
çl£
„ªge, 
rhs
rue„ange,„hs false„ange

524 
loÿl
 
funùiÚ
 
	$b¿nch_¿nges
(
İ
, 
lhs
, 
rhs
)

525 
loÿl
 
funùiÚ
 
	$É
(
a
, 
b
)

526  
	`Rªge
(
a
:
	`mš
(), 
m©h
.mš×:
	`max
(), 
b
:max() - 1))

527 
’d


528 
loÿl
 
funùiÚ
 
	$Ë
(
a
, 
b
)

529  
	`Rªge
(
a
:
	`mš
(), 
m©h
.mš×:
	`max
(), 
b
:
	$max
()))

530 
’d


531 
loÿl
 
funùiÚ
 
	$eq
(
a
, 
b
)

532  
	`Rªge
(
m©h
.
	`max
(
a
:
	`mš
(), 
b
:mš()), m©h.mš×:max(), b:
	$max
()))

533 
’d


534 
loÿl
 
funùiÚ
 
	$ge
(
a
, 
b
)

535  
	`Rªge
(
m©h
.
	`max
(
a
:
	`mš
(), 
b
:mš()),‡:
	$max
())

536 
’d


537 
loÿl
 
funùiÚ
 
	$gt
(
a
, 
b
)

538  
	`Rªge
(
m©h
.
	`max
(
a
:
	`mš
(), 
b
:mš()+1),‡:
	$max
())

539 
’d


540 
İ
 =ğ'<' 
th’


541  
	`É
(
lhs
, 
rhs
), 
	`ge
Öhs,„hs), 
	`gt
Ôhs,†hs), 
	$Ë
(
rhs
, 
lhs
)

542 
–£if
 
İ
 =ğ'<=' 
th’


543  
	`Ë
(
lhs
, 
rhs
), 
	`gt
Öhs,„hs), 
	`ge
Ôhs,†hs), 
	$É
(
rhs
, 
lhs
)

544 
–£if
 
İ
 =ğ'=' 
th’


545 -- 
Could
 
»¡riù
 
çl£
 
cÚtšu©iÚs
 
mÜe
.

546  
	`eq
(
lhs
, 
rhs
),†hs,ƒq(rhs,†hs),„hs

547 
–£if
 
İ
 =ğ'!=' 
th’


548  
lhs
, 
	`eq
Öhs, 
rhs
),„hs, 
	$eq
(
rhs
, 
lhs
)

549 
–£if
 
İ
 =ğ'>=' 
th’


550  
	`ge
(
lhs
, 
rhs
), 
	`É
Öhs,„hs), 
	`Ë
Ôhs,†hs), 
	$gt
(
rhs
, 
lhs
)

551 
–£if
 
İ
 =ğ'>' 
th’


552  
	`gt
(
lhs
, 
rhs
), 
	`Ë
Öhs,„hs), 
	`É
Ôhs,†hs), 
	$ge
(
rhs
, 
lhs
)

554 
	`”rÜ
('unim¶em’‹d '..
İ
)

555 
’d


556 
’d


557 
loÿl
 
funùiÚ
 
	$unİ_¿nge
(
İ
, 
rhs
)

558 
İ
 =ğ'Áohs' 
th’
  
	$Rªge
(0, 0xffffè
’d


559 
İ
 =ğ'Áohl' 
th’
  
	$Rªge
(
INT32_MIN
, 
INT32_MAX
è
’d


560 
İ
 =ğ'ušt32' 
th’
  
	`Rªge
(0, 2^32è
’d


561 
İ
 =ğ'št32' 
th’
  
rhs
:
	$tob™
(è
’d


562 
	`”rÜ
('uÃx³ùed o°'..
İ
)

563 
’d


564 
loÿl
 
funùiÚ
 
	$bšİ_¿nge
(
İ
, 
lhs
, 
rhs
)

565 
İ
 =ğ'+' 
th’
  
lhs
:
	$add
(
rhs
è
’d


566 
İ
 =ğ'-' 
th’
  
lhs
:
	$sub
(
rhs
è
’d


567 
İ
 =ğ'*' 
th’
  
lhs
:
	$mul
(
rhs
è
’d


568 
İ
 =ğ'*64' 
th’
  
lhs
:
	$mul64
(
rhs
è
’d


569 
İ
 =ğ'/' 
th’
  
lhs
:
	$div
(
rhs
è
’d


570 
İ
 =ğ'&' 
th’
  
lhs
:
	$bªd
(
rhs
è
’d


571 
İ
 =ğ'|' 
th’
  
lhs
:
	$bÜ
(
rhs
è
’d


572 
İ
 =ğ'^' 
th’
  
lhs
:
	$bxÜ
(
rhs
è
’d


573 
İ
 =ğ'<<' 
th’
  
lhs
:
	$lshiá
(
rhs
è
’d


574 
İ
 =ğ'>>' 
th’
  
lhs
:
	$rshiá
(
rhs
è
’d


575 
	`”rÜ
('uÃx³ùed o°'..
İ
)

576 
’d


578 
loÿl
 
funùiÚ
 
	$vis™
(
ex´
, 
db_t
, 
db_f
)

579 
	`ty³
(
ex´
è~ğ'bË' 
th’
 ƒx´ 
’d


580 
loÿl
 
İ
 = 
ex´
[1]

582 -- 
Logiÿl
 
İs
 
add
 
to
 
theœ
 
db_t
 
ªd
 
db_f
 
¡Ües
.

583 
»lİs
[
İ
] 
th’


584 
loÿl
 
db
 = 
	$push
(
db_t
)

585 
loÿl
 
lhs
, 
rhs
 = 
	`vis™
(
ex´
[2], 
db
), 
	$vis™
(
ex´
[3], 
db
)

586 
	`m”ge
(
db_t
, 
	$ÿr
(
db
))

587 
	`m”ge
(
db_f
, 
	$ÿr
(
db
))

588 
loÿl
 
funùiÚ
 
	$fŞd
(
l
, 
r
)

589  { 
	`as£¹
(
fŞd”s
[
İ
])(
l
, 
r
è
ªd
 'Œue' 
Ü
 'çl£' 
	}
}

590 
’d


591 
loÿl
 
	glhs_¿nge
, 
	grhs_¿nge
 = 
lookup
(
db_t
, 
lhs
),†ookup(db_t, 
rhs
)

592 -- 
If
 
we
 
fŞded
 
bÙh
 
	gsides
, 
Ü
 
the
 
¿nges
 
¬e
 
	g¡riùly


593 -- 
	gÜd”ed
, 
the
 
cÚd™iÚ
 
wl
 
	gfŞd
.

594 ià((
	glhs_¿nge
:
	$fŞd
(è
ªd
 
rhs_¿nge
:
	$fŞd
())

595 
Ü
 
lhs_¿nge
:
	$É
(
rhs_¿nge
è
Ü
 
lhs_¿nge
:
	$gt
(
rhs_¿nge
)è
th’


596  
	`fŞd
(
lhs_¿nge
:
	`mš
(), 
rhs_¿nge
:
	$mš
())

597 
	`–£if
 (
lhs_¿nge
:
	`max
(è=ğ
rhs_¿nge
:
	$mš
(è
ªd
 
İ
 == '<='

598 
Ü
 
lhs_¿nge
:
	`mš
(è=ğ
rhs_¿nge
:
	$max
(è
ªd
 
İ
 =ğ'>='è
th’


599 -- 
The
 
¿nges
 
¬e
 
Üd”ed
, 
but
 
nÙ
 
¡riùly
, 
ªd
 
š
 
the
 
§me


600 -- 
£n£
 
as
 
the
 
‹¡
:h
cÚd™iÚ
 
is
 
Œue
.

601  { 'Œue' 
	}
}

602 
’d


603 -- 
Oth”wi£
, 
the
 
»lİ
 
may
 
»¡riù
h
¿nges
 
	gbÙh


604 -- 
¬gum’ts
 
®Úg
 
bÙh
 
	gcÚtšu©iÚs
.

605 
loÿl
 
	glhs_¿nge_t
, 
	glhs_¿nge_f
, 
	grhs_¿nge_t
, 
	grhs_¿nge_f
 =

606 
	$b¿nch_¿nges
(
İ
, 
lhs_¿nge
, 
rhs_¿nge
)

607 
	$»¡riù
(
db_t
, 
lhs
, 
lhs_¿nge_t
)

608 
	$»¡riù
(
db_f
, 
lhs
, 
lhs_¿nge_f
)

609 
	$»¡riù
(
db_t
, 
rhs
, 
rhs_¿nge_t
)

610 
	$»¡riù
(
db_f
, 
rhs
, 
rhs_¿nge_f
)

611  { 
İ
, 
lhs
, 
rhs
 
	}
}

612 
–£if
 
	gsim¶e
[
İ
] 
th’


613  
ex´


614 
–£if
 
	gİ
 =ğ'if' 
th’


615 
loÿl
 
‹¡
, 
	gt
, 
	gf
 = 
ex´
[2], 
	gex´
[3],ƒxpr[4]

617 
loÿl
 
	g‹¡_db_t
, 
	g‹¡_db_f
 = 
push
(
db_t
), 
	$push
(
db_t
)

618 
‹¡
 = 
	$vis™
(
‹¡
, 
‹¡_db_t
, 
‹¡_db_f
)

620 
loÿl
 
kt_db_t
, 
kt_db_f
 = 
	`push
(
‹¡_db_t
), 
	$push
(
‹¡_db_t
)

621 
loÿl
 
kf_db_t
, 
kf_db_f
 = 
	`push
(
‹¡_db_f
), 
	$push
(
‹¡_db_f
)

622 
t
 = 
	$vis™
(
t
, 
kt_db_t
, 
kt_db_f
)

623 
f
 = 
	$vis™
(
f
, 
kf_db_t
, 
kf_db_f
)

625 
İs
[
t
[1]] 
th’


626 
loÿl
 
h—d_t
, 
h—d_f
 = 
	`ÿr
(
kf_db_t
), 
	$ÿr
(
kf_db_f
)

627 
loÿl
 
as£¹iÚs
 = 
	$ÿdr
(
kf_db_t
)

628 
	$m”ge
(
db_t
, 
as£¹iÚs
)

629 
	$m”ge
(
db_t
, 
h—d_t
)

630 
	$m”ge
(
db_f
, 
as£¹iÚs
)

631 
	$m”ge
(
db_f
, 
h—d_f
)

632 
–£if
 
İs
[
f
[1]] 
th’


633 
loÿl
 
h—d_t
, 
h—d_f
 = 
	`ÿr
(
kt_db_t
), 
	$ÿr
(
kt_db_f
)

634 
loÿl
 
as£¹iÚs
 = 
	$ÿdr
(
kt_db_t
)

635 
	$m”ge
(
db_t
, 
as£¹iÚs
)

636 
	$m”ge
(
db_t
, 
h—d_t
)

637 
	$m”ge
(
db_f
, 
as£¹iÚs
)

638 
	$m”ge
(
db_f
, 
h—d_f
)

640 
loÿl
 
h—d_t_t
, 
h—d_t_f
 = 
	`ÿr
(
kt_db_t
), 
	$ÿr
(
kt_db_f
)

641 
loÿl
 
h—d_f_t
, 
h—d_f_f
 = 
	`ÿr
(
kf_db_t
), c¬(
kf_db_f
)

642 -- 
the
 
as£¹iÚs
?

643 (
db_t
, 
h—d_t_t
, 
h—d_f_t
)

644 (
db_f
, 
h—d_t_f
, 
h—d_f_f
)

645 
’d


646  { 
İ
, 
‹¡
, 
t
, 
f
 
	}
}

647 
–£if
 
	gİ
 =ğ'ÿÎ' 
th’


648  
ex´


650 -- 
An
 
¬™hm‘ic
 
İ
, 
which
 
š‹ºs
 
što
 
the
 
äesh
 
bË
 
	gpushed


651 -- 
by
 
the
 
cÚššg
 
	g»lİ
.

652 
loÿl
 
	gdb
 = 
db_t


653 
İ
 =ğ'[]' 
th’


654 
loÿl
 
pos
, 
	gsize
 = 
vis™
(
ex´
[2], 
db
), 
	gex´
[3]

655 
loÿl
 
	g»t
 = { 
İ
, 
pos
, 
size
 }

656 
loÿl
 
size_max


657 
size
 =ğ1 
th’
 
size_max
 = 0xff

658 
–£if
 
size
 =ğ2 
th’
 
size_max
 = 0xffff

659 
size_max
 = 0xfffffffà
’d


660 
loÿl
 
¿nge
 = 
	$lookup
(
db
, 
»t
):
	`»¡riù
(
	$Rªge
(0, 
size_max
))

661  
	$defše
(
db
, 
»t
, 
¿nge
)

662 
–£if
 
unİs
[
İ
] 
th’


663 
loÿl
 
rhs
 = 
	$vis™
(
ex´
[2], 
db
)

664 
loÿl
 
rhs_¿nge
 = 
	$lookup
(
db
, 
rhs
)

665 
rhs_¿nge
:
	$fŞd
(è
th’


666  
	$as£¹
(
fŞd”s
[
İ
])(
rhs_¿nge
:
	$fŞd
())

667 
’d


668 ià(
İ
 =ğ'ušt32' 
ªd
 0 <ğ
rhs_¿nge
:
	$mš
()

669 
ªd
 
rhs_¿nge
:
	`max
(è<ğ
UINT32_MAX
è
th’


670  
rhs


671 
	`–£if
 (
İ
 =ğ'št32' 
ªd
 
INT32_MIN
 <ğ
rhs_¿nge
:
	$mš
()

672 
ªd
 
rhs_¿nge
:
	`max
(è<ğ
INT32_MAX
è
th’


673  
rhs


674 
’d


675 
loÿl
 
¿nge
 = 
	$unİ_¿nge
(
İ
, 
rhs_¿nge
)

676  
	`»¡riù
(
db
, { 
İ
, 
rhs
 
	}
}, 
	g¿nge
)

677 
–£if
 
	gbšİs
[
İ
] 
th’


678 
loÿl
 
	glhs
, 
	grhs
 = 
vis™
(
ex´
[2], 
db
), 
	$vis™
(
ex´
[3], 
db
)

679 
	`ty³
(
lhs
è=ğ'numb”' 
ªd
y³(
rhs
è=ğ'numb”' 
th’


680  
	$as£¹
(
fŞd”s
[
İ
])(
lhs
, 
rhs
)

681 
’d


682 
loÿl
 
lhs_¿nge
, 
rhs_¿nge
 = 
	`lookup
(
db
, 
lhs
), 
	$lookup
(
db
, 
rhs
)

683 
loÿl
 
¿nge
 = 
	$bšİ_¿nge
(
İ
, 
lhs_¿nge
, 
rhs_¿nge
)

684  
	`»¡riù
(
db
, { 
İ
, 
lhs
, 
rhs
 
	}
}, 
	g¿nge
)

686 
”rÜ
('wh© i thi '..
İ
)

687 
’d


688 
’d


689 
’d


690  
vis™
(
ex´
, 
push
(), 
	$push
())

691 
’d


693 -- 
L’gth
 
as£¹iÚ
 
hoi¡šg
.

694 
loÿl
 
funùiÚ
 
	`lhoi¡
(
ex´
, 
db
)

695 -- 
Recursiv–y
 
ªnÙ©e
 
the
 
logiÿl
 
ex´essiÚs
 
š
 
EXPR
, 
»tuºšg


696 -- 
bËs
 
of
 
the
 
fÜm
 { 
MIN_T
, 
MIN_F
, 
MIN_PASS
, 
MAX_FAIL
, 
EXPR
 
	}
}.

697 -- 
MIN_T
 
šdiÿ‹s
 
th©
 
this
 
ex´essiÚ
 
to
 
be
 
	gŒue
, 
the
 
	g·ck‘


698 -- 
mu¡
 
be
 
©
 
Ëa¡
 
as
 a 
	gMIN_T
. 
Sim¬ly
 
	gMIN_F
. 
	gMIN_PASS


699 -- 
m—ns
 
th©
 
the
 
·ck‘
 
is
 
sm®Ër
 
thª
 
MIN_PASS
 
th’
h
	gf‹r


700 -- 
wl
 
defš™–y
 
	gç
. 
MAX_FAIL
 
m—ns
 
th©
 
the
 
·ck‘
 
	gis


701 -- 
sm®Ër
 
thª
 
	gMAX_FAIL
, 
th”e
 
is
 
	ga
 'ç' 
ÿÎ
 
Ú
 
some
 
	g·th
.

702 
loÿl
 
funùiÚ
 
	$ªnÙ©e
(
ex´
, 
is_
)

703 
loÿl
 
funùiÚ
 
	$«x´
(
mš_t
, 
mš_f
, 
mš_·ss
, 
max_ç
, 
ex´
)

704 
is_
 
th’


705 
mš_·ss
 = 
m©h
.
	$max
(
mš_·ss
, 
mš_t
)

706 
mš_t
 = 
mš_·ss


707 
’d


708  { 
mš_t
, 
mš_f
, 
mš_·ss
, 
max_ç
, 
ex´
 
	}
}

709 
’d


710 
loÿl
 
İ
 = 
ex´
[1]

711 ià(
İ
 =ğ'>=' 
ªd
 
ex´
[2] =ğ'Ën'‡nd 
ty³
Óx´[3]è=ğ'numb”'è
th’


712  
«x´
(
ex´
[3], 0, 0, -1,ƒxpr)

713 
–£if
 
	gİ
 =ğ'if' 
th’


714 
loÿl
 
‹¡
, 
	gt
, 
	gf
 = 
ex´
[2], 
	gex´
[3],ƒxpr[4]

715 
loÿl
 
	g‹¡_a
 = 
	$ªnÙ©e
(
‹¡
, 
çl£
)

716 
loÿl
 
t_a
, 
f_a
 = 
	`ªnÙ©e
(
t
, 
is_
), 
	$ªnÙ©e
(
f
, 
is_
)

717 
loÿl
 
‹¡_mš_t
, 
‹¡_mš_f
 = 
‹¡_a
[1],est_a[2]

718 
loÿl
 
‹¡_mš_·ss
, 
‹¡_max_ç
 = 
‹¡_a
[3],est_a[4]

719 
loÿl
 
funùiÚ
 
	$if_boŞ_mšs
()

720 
loÿl
 
t
, 
f
 =[1], f[1]

721 
loÿl
 
funùiÚ
 
	$b¿nch_boŞ_mšs
(
ab¿nch
, 
mš
)

722 
loÿl
 
b¿nch_mš_t
, 
b¿nch_mš_f
 = 
ab¿nch
[1],‡branch[2]

723  
m©h
.
	`max
(
b¿nch_mš_t
, 
mš
), m©h.
	$max
(
b¿nch_mš_f
, 
mš
)

724 
’d


725 
loÿl
 
t_mš_t
, 
t_mš_f
 = 
	$b¿nch_boŞ_mšs
(
t_a
, 
‹¡_mš_t
)

726 
loÿl
 
f_mš_t
, 
f_mš_f
 = 
	$b¿nch_boŞ_mšs
(
f_a
, 
‹¡_mš_f
)

727 
Œueİs
[
t
] 
th’
 
t_mš_f
 = 
f_mš_f
 
’d


728 
Œueİs
[
f
] 
th’
 
f_mš_f
 = 
t_mš_f
 
’d


729 
t
 =ğ'ç' 
th’
  
f_mš_t
, 
f_mš_f
 
’d


730 
f
 =ğ'ç' 
th’
  
t_mš_t
, 
t_mš_f
 
’d


731 
t
 =ğ'çl£' 
th’
 
t_mš_t
 = 
f_mš_t
 
’d


732 
f
 =ğ'çl£' 
th’
 
f_mš_t
 = 
t_mš_t
 
’d


733  
m©h
.
	`mš
(
t_mš_t
, 
f_mš_t
), m©h.
	$mš
(
t_mš_f
, 
f_mš_f
)

734 
’d


735 
loÿl
 
funùiÚ
 
	$if_ç_mšs
()

736 
loÿl
 
t
, 
f
 =[1], f[1]

737 
loÿl
 
mš_·ss
, 
max_ç


738 
loÿl
 
t_mš_·ss
, 
t_max_ç
 = 
t_a
[3],_a[4]

739 
loÿl
 
f_mš_·ss
, 
f_max_ç
 = 
f_a
[3], f_a[4]

740 -- 
Four
 
ÿ£s
: 
bÙh
 
T
 
ªd
 
F
 
b¿nches
 
¬e
 
ç
; 
Úe
 
of
 
them


741 -- 
is
 
a
 
ç
; 
Ã™h”
 
¬e
 
çs
.

742 
t
 =ğ'ç' 
th’


743 
f
 =ğ'ç' 
th’


744 
mš_·ss
 = 
‹¡_mš_·ss


745 
max_ç
 = 
UINT16_MAX


747 
mš_·ss
 = 
m©h
.
	$max
(
‹¡_mš_f
, 
f_mš_·ss
, 
‹¡_mš_·ss
)

748 
max_ç
 = 
m©h
.
	$max
(
‹¡_mš_t
, 
f_max_ç
, 
‹¡_max_ç
)

749 
’d


750 
–£if
 
f
 =ğ'ç' 
th’


751 
mš_·ss
 = 
m©h
.
	$max
(
‹¡_mš_t
, 
t_mš_·ss
, 
‹¡_mš_·ss
)

752 
max_ç
 = 
m©h
.
	$max
(
‹¡_mš_f
, 
f_max_ç
, 
‹¡_max_ç
)

754 
mš_·ss
 = 
m©h
.
	`max
(
‹¡_mš_·ss
, m©h.
	$mš
(
t_mš_·ss
, 
f_mš_·ss
))

755 
max_ç
 = 
m©h
.
	$max
(
t_max_ç
, 
f_max_ç
, 
‹¡_max_ç
)

756 
’d


757  
mš_·ss
, 
max_ç


758 
’d


759 
loÿl
 
mš_t
, 
mš_f
 = 
	$if_boŞ_mšs
()

760 
loÿl
 
mš_·ss
, 
max_ç
 = 
	$if_ç_mšs
()

761  
	`«x´
(
mš_t
, 
mš_f
, 
mš_·ss
, 
max_ç
, { 
İ
, 
‹¡_a
, 
t_a
, 
f_a
 
	}
})

763  
«x´
(0, 0, 0, -1, 
ex´
)

764 
’d


765 
	g’d


767 -- 
SŒ
 
the
 
ªnÙ©ed
 
ex´essiÚ
 
	gAEXPR
. 
Wh’ev”
h
·ck‘
 
	gÃeds


768 -- 
be
 
lÚg”
 
thª
 
the
 
MIN
 
	g¬gum’t
, 
š£¹
 
a
 
Ëngth
 
check
 
ªd
 
	g»vis™


769 -- 
w™h
 
the
 
Ãw
 
	gMIN
. 
Elide
 
Ùh”
 
Ëngth
 
	gchecks
.

770 
loÿl
 
funùiÚ
 
	$»duû
(
«x´
, 
mš
, 
is_
)

771 
loÿl
 
mš_t
, 
mš_f
, 
mš_·ss
, 
max_ç
, 
ex´
 =

772 
«x´
[1],‡expr[2],‡expr[3],‡expr[4],‡expr[5]

774 -- 
Rejeù
 
ªy
 
·ck‘s
 
th©
 
¬e
 
too
 
to
 
·ss
.

775 
is_
 
th’
 
mš_·ss
 = 
m©h
.
	$max
(
mš_·ss
, 
mš_t
è
’d


776 
mš
 < 
mš_·ss
 
th’


777 
loÿl
 
ex´
 = 
	$»duû
(
«x´
, 
mš_·ss
, 
is_
)

778  { 'if', { '>=', 'Ën', 
mš_·ss
 }, 
ex´
, { 'ç' } 
	}
}

779 
	g’d


781 -- 
Hoi¡
 
Ëngth
 
checks
 
we
 
know
 
a
 
·ck‘
 
mu¡
 
be
 
of
‡ 
	gû¹aš


782 -- 
Ëngth
 
the
 
ex´essiÚ
 
to
 
be
 
	gŒue
, 
ªd
 
we
 
¬e
 
û¹aš
 
	gth©


783 -- 
we
 
	g¬’
't goingo hit‡ "fail".

784 
	gmš
 < 
mš_t
 
ªd
 
	gmax_ç
 < 
mš
 
th’


785 
loÿl
 
	gex´
 = 
	$»duû
(
«x´
, 
mš_t
, 
is_
)

786  { 'if', { '>=', 'Ën', 
mš_t
 }, 
ex´
, { 'çl£' } 
	}
}

787 
’d


789 
loÿl
 
	gİ
 = 
ex´
[1]

790 
İ
 =ğ'if' 
th’


791 
loÿl
 
t
 = 
	$»duû
(
ex´
[2], 
mš
, 
çl£
)

792 
loÿl
 
kt
 = 
	$»duû
(
ex´
[3], 
mš
, 
is_
)

793 
loÿl
 
kf
 = 
	$»duû
(
ex´
[4], 
mš
, 
is_
)

794  { 
İ
, 
t
, 
kt
, 
kf
 
	}
}

795 
–£if
 
	gİ
 =ğ'>=' 
ªd
 
ex´
[2] =ğ'Ën'‡nd 
ty³
Óx´[3]è=ğ'numb”' 
th’


796 -- 
mš
 
may
 
be
 
£t
 
cÚ£rv©iv–y
 
low
; 
™
 
is
 *
Úly
* 
a
 
low”
 
	gbound
.

797 -- 
If
 
	gex´
[3] 
	gis
 <ğ
mš
, { 'Œue' } 
is
 
a
 
v®id
 
	gİtimiz©iÚ
.

798 -- 
	gOth”wi£
, 
	gth”e
's‚otƒnough information;†eaveƒxpr‡lone.

799 
	gex´
[3] <ğ
mš
 
th’
  { 'Œue' }  
ex´
 
’d


801  
ex´


802 
’d


803 
’d


805  
»duû
(
ªnÙ©e
(
ex´
, 
Œue
), 0,rue)

806 
’d


808 
funùiÚ
 
	$İtimize_šÃr
(
ex´
)

809 
ex´
 = 
	$sim¶ify
(
ex´
, 
Œue
)

810 
ex´
 = 
	`sim¶ify
(
	`cfŞd
Óx´, {
	}
}), 
	gŒue
)

811 
	gex´
 = 
sim¶ify
(
šãr_¿nges
(
ex´
), 
Œue
)

812 
	gex´
 = 
sim¶ify
(
lhoi¡
(
ex´
), 
Œue
)

813 
	$ş—r_ÿche
()

814  
ex´


815 
’d


817 
funùiÚ
 
	$İtimize
(
ex´
)

818 
ex´
 = 
uts
.
	$fixpošt
(
İtimize_šÃr
, 
ex´
)

819 
v”bo£
 
th’
 
	$µ
(
ex´
è
’d


820  
ex´


821 
’d


823 
funùiÚ
 
	$£láe¡
 ()

824 
	`´št
("selftest:…f.optimize")

825 
loÿl
 
·r£
 = 
	`»quœe
('pf.parse').parse

826 
loÿl
 
ex·nd
 = 
	`»quœe
('pf.expand').expand

827 
loÿl
 
funùiÚ
 
	$İt
(
¡r
è 
	`İtimize
(
	`ex·nd
(
	`·r£
(¡r), "EN10MB")è
’d


828 
loÿl
 
equ®s
, 
as£¹_equ®s
 = 
uts
.equals, utils.assert_equals

829 
	`as£¹_equ®s
({ 'ç' 
	}
},

830 
İt
("1 = 2"))

831 
as£¹_equ®s
({ '=', "len", 1 },

832 
İt
("1 =†en"))

833 
as£¹_equ®s
({ 'match' },

834 
İt
("1 = 2/2"))

835 
as£¹_equ®s
({ 'if', { '>=', 'len', 1},

838 
İt
("ether[0] = 2"))

839 
as£¹_equ®s
({ 'if', { '>=', 'len', 7},

844 
İt
("(ether[5] + 1) + (ether[6] + 2) < 10"))

845 
as£¹_equ®s
({ 'if', { '>=', 'len', 7},

850 
İt
("ether[5] + 1 +ƒther[6] + 2 < 10"))

851 
as£¹_equ®s
({ '>=', 'len', 2},

852 
İt
("greater 1‡nd greater 2"))

853 -- 
Could
 
check
 
	gthis
, 
but
 
	g™
's very†arge

854 
İt
("tcp…ort 80‡nd (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)")

855 
İt
("tcp…ort 5555")

856 
´št
("OK")

857 
	g’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/parse.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
®low_add»ss_of
 = 
Œue


5 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

6 
loÿl
 
cÚ¡ªts
 = 
	`»quœe
('pf.constants')

8 
loÿl
 
v4_to_št
, 
v6_as_4x32
 = 
uts
.ipv4_to_int, utils.ipv6_as_4x32

9 
loÿl
 
ušt32
 = 
uts
.uint32

11 
loÿl
 
funùiÚ
 
	$sk_wh™e¥aû
(
¡r
, 
pos
)

12 
pos
 <ğ#¡¸
ªd
 
¡r
:
	`m©ch
('^%s',…os) do

13 
pos
 =…os + 1

14 
’d


15  
pos


16 
’d


18 
loÿl
 
funùiÚ
 
	$£t
(...)

19 
loÿl
 
»t
 = {
	}
}

20 
k
, 
v
 
š
 
·œs
({...}èdØ
	g»t
[v] = 
Œue
 
’d


21  
»t


22 
’d


24 
loÿl
 
punùu©iÚ
 = 
£t
(

29 
loÿl
 
	gnumb”_‹rmš©Üs
 = " \t\r\n)]:!<>=+-*/%&|^"

31 
loÿl
 
funùiÚ
 
	$Ëx_numb”
(
¡r
, 
pos
, 
ba£
)

32 
loÿl
 
»s
 = 0

33 
loÿl
 
i
 = 
pos


34 
i
 <= #str do

35 
loÿl
 
chr
 = 
¡r
:
	$sub
(
i
,i)

36 
loÿl
 
n
 = 
	$tÚumb”
(
chr
, 
ba£
)

37 
n
 
th’


38 
»s
 =„e * 
ba£
 + 
n


39 
i
 = i + 1

40 
–£if
 
nÙ
 
numb”_‹rmš©Üs
:
	$fšd
(
chr
, 1, 
Œue
è
th’


41  
n


44 
’d


45 
’d


47 
i
 =ğ
pos
 
th’


48 -- 
No
 
dig™s
 
·r£d
, 
ÿn
 
h­³n
 
wh’
 
Ëxšg
 "0x" 
Ü
 "09".

49  
n


50 
’d


51  
»s
, 
i
 -- 
EOS
 
Ü
 
’d
 
of
 
numb”
.

52 
’d


54 
loÿl
 
funùiÚ
 
	$maybe_Ëx_numb”
(
¡r
, 
pos
)

55 
¡r
:
	`m©ch
("^0x", 
pos
è
th’


56  "hexadecim®", 
	`Ëx_numb”
(
¡r
, 
pos
+2, 16)

57 
–£if
 
¡r
:
	`m©ch
("^0%d", 
pos
è
th’


58  "où®", 
	`Ëx_numb”
(
¡r
, 
pos
+1, 8)

59 
–£if
 
¡r
:
	`m©ch
("^%d", 
pos
è
th’


60  "decim®", 
	$Ëx_numb”
(
¡r
, 
pos
, 10)

61 
’d


62 
’d


64 
loÿl
 
funùiÚ
 
	$Ëx_ho¡_Ü_keywÜd
(
¡r
, 
pos
)

65 
loÿl
 
Çme
, 
Ãxt_pos
 = 
¡r
:
	`m©ch
("^([%w.-]+)()", 
pos
)

66 
	`as£¹
(
Çme
, "çedØ·r£ ho¡ÇmÜ keywÜd‡ˆ"..
pos
)

67 
	`as£¹
(
Çme
:
	`m©ch
("^%w", 1, 1), "bad hostname or keyword "..name)

68 
	`as£¹
(
Çme
:
	`m©ch
("^%w", #name, #name), "bad hostname or keyword "..name)

70 
loÿl
 
kšd
, 
numb”
, 
numb”_Ãxt_pos
 = 
	`maybe_Ëx_numb”
(
¡r
, 
pos
)

71 -- 
OÆy
 
š‹½»t
 
Çme
 
as
 
a
 
numb”
‡ ¨
whŞe
.

72 
numb”
 
ªd
 
numb”_Ãxt_pos
 =ğ
Ãxt_pos
 
th’


73 
	`as£¹
(
numb”
 <ğ0xffffffff, 'š‹g”oØÏrge: '..
Çme
)

74  
numb”
, 
Ãxt_pos


76  
Çme
, 
Ãxt_pos


77 
’d


78 
’d


80 
loÿl
 
funùiÚ
 
	$Ëx_v4
(
¡r
, 
pos
)

81 
loÿl
 
funùiÚ
 
	$Ëx_by‹
(
¡r
)

82 
loÿl
 
by‹
 = 
	$tÚumb”
(
¡r
, 10)

83 
by‹
 >ğ256 
th’
  
n
 
’d


84  
by‹


85 
’d


86 
loÿl
 
dig™s
, 
dÙ
 = 
¡r
:
	`m©ch
("^(%d%d?%d?)()", 
pos
)

87 
nÙ
 
dig™s
 
th’
  
n
 
’d


88 
loÿl
 
addr
 = { 'v4' 
	}
}

89 
loÿl
 
by‹
 = 
	$Ëx_by‹
(
dig™s
)

90 
nÙ
 
by‹
 
th’
  
n
 
’d


91 
bË
.
	$š£¹
(
addr
, 
by‹
)

92 
pos
 = 
dÙ


93 
i
=1,3 do

94 
loÿl
 
dig™s
, 
dÙ
 = 
¡r
:
	`m©ch
("^%.(%d%d?%d?)()", 
pos
)

95 
nÙ
 
dig™s
 
th’
  
’d


96 
loÿl
 
by‹
 = 
	$Ëx_by‹
(
dig™s
)

97 
nÙ
 
by‹
 
th’
  
n
 
’d


98 
bË
.
	$š£¹
(
addr
, 
by‹
)

99 
pos
 = 
dÙ


100 
’d


102 
loÿl
 
Ï¡_ch¬
 = 
¡r
:
	`sub
(
pos
,…os)

103 -- 
IPv4
 
add»ss
 
is
 
aùu®ly
 
a
 
ho¡Çme


104 
Ï¡_ch¬
:
	`m©ch
("[%w.-]"è
th’
  
n
 
’d


106 
loÿl
 
‹rmš©Üs
 = " \t\r\n)/"

107 
	`as£¹
(
pos
 > #¡¸
Ü
 
‹rmš©Üs
:
	`fšd
(
Ï¡_ch¬
, 1, 
Œue
),

109  
addr
, 
pos


110 
’d


112 
loÿl
 
funùiÚ
 
	$Ëx_v6
(
¡r
, 
pos
)

113 
loÿl
 
addr
 = { 'v6' 
	}
}

114 
loÿl
 
hŞe_šdex


116 
¡r
:
sub
(
pos
,…o + 1è=ğ"::" 
th’


117 
hŞe_šdex
 = 2

118 
pos
 =…os + 2

119 
’d


121 
loÿl
 
aá”_£p
 = 
çl£


122 
loÿl
 
dig™s_·‰”n
 = "^(%x%x?%x?%x?)()"

123 
loÿl
 
ex³ùed_£p
 = ":"

124 
loÿl
 
v4_f›lds
 = 0

126 
Œue
 do

127 
loÿl
 
dig™s
, 
	gÃxt_pos
 = 
¡r
:
	$m©ch
(
dig™s_·‰”n
, 
pos
)

128 
nÙ
 
dig™s
 
th’


129 
aá”_£p
 
th’


130 
	`”rÜ
("wrong IPv6‡ddress")

133 
’d


134 
’d


136 
loÿl
 
£p
 = 
¡r
:
	$sub
(
Ãxt_pos
,‚ext_pos)

137 
£p
 =ğ"." 
ªd
 
ex³ùed_£p
 =ğ":" 
th’


138 
ex³ùed_£p
 = "."

139 
dig™s_·‰”n
 = "^(%d%d?%d?)()"

140 -- 
CÚtšue
 
loİ
 
w™hout
 
advªcšg
 
pos
.

141 -- 
Wl
 
·r£
 
f›ld
 
as
 
decim®
 
š
 
the
 
Ãxt
 
™”©iÚ
.

143 
pos
 = 
Ãxt_pos


145 
ex³ùed_£p
 =ğ":" 
th’


146 
bË
.
	`š£¹
(
addr
, 
	$tÚumb”
(
dig™s
, 16))

148 
loÿl
 
v4_f›ld
 = 
	$tÚumb”
(
dig™s
, 10)

149 
	`as£¹
(
v4_f›ld
 < 255, "wrong IPv6‡ddress")

150 
v4_f›lds
 = ipv4_fields + 1

151 
v4_f›lds
 % 2 =ğ0 
th’


152 
addr
[#addr] =‡ddr[#addr] * 256 + 
v4_f›ld


154 
bË
.
	$š£¹
(
addr
, 
v4_f›ld
)

155 
’d


156 
’d


158 
£p
 ~ğ
ex³ùed_£p
 
th’
  
’d


159 
pos
 =…os + 1

160 
£p
 =ğ":" 
ªd
 
nÙ
 
hŞe_šdex
‡nd 
¡r
:
	`sub
(
pos
,…osè=ğ":" 
th’


161 
pos
 =…os + 1

162 
hŞe_šdex
 = #addr + 1

163 
aá”_£p
 = 
çl£


165 
aá”_£p
 = 
Œue


166 
’d


167 
’d


168 
’d


170 
	`as£¹
(
v4_f›lds
 =ğ0 
Ü
 ipv4_fields == 4, "wrong IPv6‡ddress")

172 
hŞe_šdex
 
th’


173 
loÿl
 
z”os
 = 9 - #addr

174 
	`as£¹
(
z”os
 >= 1, "wrong IPv6‡ddress")

175 
i
=1,
z”os
 do

176 
bË
.
	$š£¹
(
addr
, 
hŞe_šdex
, 0)

177 
’d


178 
’d


180 
	`as£¹
(#addr == 9, "wrong IPv6‡ddress")

182 
loÿl
 
‹rmš©Üs
 = " \t\r\n)/"

183 
	`as£¹
(
pos
 > #¡¸
Ü
 
‹rmš©Üs
:
	`fšd
(
¡r
:
	`sub
Õos,…os), 1, 
Œue
),

186  
addr
, 
pos


187 
’d


189 
loÿl
 
funùiÚ
 
	$Ëx_eho¡
(
¡r
, 
pos
)

190 
loÿl
 
¡¬t
 = 
pos


191 
loÿl
 
addr
 = { 'eho¡' 
	}
}

192 
loÿl
 
dig™s
, 
	gdÙ
 = 
¡r
:
m©ch
("^(%x%x?)()%:", 
pos
)

193 
as£¹
(
dig™s
, "çedØ·r£ƒth”Ãˆho¡‡dd»s © "..
pos
)

194 
	gbË
.
š£¹
(
addr
, 
	$tÚumb”
(
dig™s
, 16))

195 
pos
 = 
dÙ


196 
i
=1,5 do

197 
loÿl
 
dig™s
, 
dÙ
 = 
¡r
:
	`m©ch
("^%:(%x%x?)()", 
pos
)

198 
	`as£¹
(
dig™s
, "çedØ·r£ƒth”Ãˆho¡‡dd»s © "..
pos
)

199 
bË
.
	`š£¹
(
addr
, 
	$tÚumb”
(
dig™s
, 16))

200 
pos
 = 
dÙ


201 
’d


202 
loÿl
 
‹rmš©Üs
 = " \t\r\n)/"

203 
loÿl
 
Ï¡_ch¬
 = 
¡r
:
	`sub
(
pos
,…os)

204 -- 
MAC
 
add»ss
 
is
 
aùu®ly
 
ª
 
IPv6
‡ddress

205 
Ï¡_ch¬
 =ğ':' 
Ü
†a¡_ch¬ =ğ'.' 
th’
  
n
, 
¡¬t
 
’d


206 
	`as£¹
(
pos
 > #¡¸
Ü
 
‹rmš©Üs
:
	`fšd
(
Ï¡_ch¬
, 1, 
Œue
),

208  
addr
, 
pos


209 
’d


211 
loÿl
 
funùiÚ
 
	$Ëx_addr_Ü_ho¡
(
¡r
, 
pos
)

212 
¡r
:
	`m©ch
('^%x%x?:%x%x?:%x%x?:%x%x?:%x%x?:%x%x?', 
pos
è
th’


213 
loÿl
 
»suÉ
, 
pos
 = 
	$Ëx_eho¡
(
¡r
, 
pos
)

214 
»suÉ
 
th’
 „esuÉ, 
pos
 
’d


215  
	$Ëx_v6
(
¡r
, 
pos
)

216 
–£if
 
¡r
:
	`m©ch
("^%x?%x?%x?%x?%:", 
pos
è
th’


217  
	$Ëx_v6
(
¡r
, 
pos
)

218 
–£if
 
¡r
:
	`m©ch
("^%d%d?%d?", 
pos
è
th’


219 
loÿl
 
»suÉ
, 
pos
 = 
	$Ëx_v4
(
¡r
, 
pos
)

220 
»suÉ
 
th’
 „esuÉ, 
pos
 
’d
 -- 
F®l
 
through
.

221 
’d


223  
	$Ëx_ho¡_Ü_keywÜd
(
¡r
, 
pos
)

224 
’d


226 
loÿl
 
funùiÚ
 
	`Ëx
(
¡r
, 
pos
, 
İts
)

227 -- 
EOF
.

228 
pos
 > #¡¸
th’
  
n
,…o 
’d


230 
İts
.
add»ss
 
th’


231 -- 
N‘
 
add»s£s
.

232  
	$Ëx_addr_Ü_ho¡
(
¡r
, 
pos
)

233 
’d


235 -- 
NÚ
-
®phªum”ic
 
tok’s
.

236 
loÿl
 
two
 = 
¡r
:
	`sub
(
pos
,pos+1)

237 
punùu©iÚ
[
two
] 
th’
 wo, 
pos
+2 
’d


238 
loÿl
 
Úe
 = 
¡r
:
	$sub
(
pos
,pos)

239 
punùu©iÚ
[
Úe
] 
th’
  oÃ, 
pos
+1 
’d


241 -- 
Num”ic
 
l™”®s
.

242 
İts
.
maybe_¬™hm‘ic
 
th’


243 
loÿl
 
kšd
, 
numb”
, 
Ãxt_pos
 = 
	$maybe_Ëx_numb”
(
¡r
, 
pos
)

244 
kšd
 
th’


245 
	`as£¹
(
numb”
, "uÃx³ùedƒnd oà"..
kšd
.."†™”®‡ˆ"..
pos
)

246 
	`as£¹
(
numb”
 <ğ0xffffffff, 'š‹g”oØÏrge: '..
¡r
:
	`sub
(
pos
, 
Ãxt_pos
-1))

247  
numb”
, 
Ãxt_pos


248 
’d


249 
’d


251 -- "Ën" 
is
 
the
 
Úly
 
b¬e
 
Çme
 
th©
 
ÿn
 
­³¬
 
š
 
ª
 
¬™hm‘ic


252 -- 
ex´essiÚ
. "Ën-1" 
Ëxes
 
as
 { 'Ën', '-', 1 
	}
} 
š
 
	g¬™hm‘ic


253 -- 
	gcÚ‹xts
, 
	gbut
 { "Ën-1" } 
	gÙh”wi£
.

254 
	gİts
.
maybe_¬™hm‘ic
 
ªd
 
	g¡r
:
m©ch
("^Ën", 
pos
è
th’


255 
	gpos
 + 3 > #¡¸
Ü
 
nÙ
 
	g¡r
:
m©ch
("^[%w.]", 
pos
+3è
th’


256  'Ën', 
	gpos
+3

257 
’d


258 
’d


260  
	$Ëx_ho¡_Ü_keywÜd
(
¡r
, 
pos
)

261 
’d


263 
loÿl
 
funùiÚ
 
	$tok’s
(
¡r
)

264 
loÿl
 
pos
, 
Ãxt_pos
 = 1, 
n


265 
loÿl
 
³eked
 = 
n


266 
loÿl
 
³eked_add»ss
 = 
n


267 
loÿl
 
³eked_maybe_¬™hm‘ic
 = 
n


268 
loÿl
 
Ï¡_pos
 = 0

269 
loÿl
 
´im™ive_”rÜ
 = 
”rÜ


270 
loÿl
 
funùiÚ
 
	$³ek
(
İts
)

271 
İts
 = o± 
Ü
 {
	}
}

272 
nÙ
 
Ãxt_pos
 
Ü
 
İts
.
add»ss
 ~ğ
³eked_add»ss
 or

273 
İts
.
maybe_¬™hm‘ic
 ~ğ
³eked_maybe_¬™hm‘ic
 
th’


274 
pos
 = 
	$sk_wh™e¥aû
(
¡r
, 
pos
)

275 
³eked
, 
Ãxt_pos
 = 
	`Ëx
(
¡r
, 
pos
, 
İts
 
Ü
 {
	}
})

276 
	g³eked_add»ss
 = 
İts
.
add»ss


277 
³eked_maybe_¬™hm‘ic
 = 
İts
.
maybe_¬™hm‘ic


278 
as£¹
(
Ãxt_pos
, "next…os is‚il")

279 
’d


280  
³eked


281 
’d


282 
loÿl
 
funùiÚ
 
	$Ãxt
(
İts
)

283 
loÿl
 
tok
 = 
	`as£¹
(
	`³ek
(
İts
), "unexpectedƒnd of filter string")

284 
pos
, 
Ãxt_pos
 =‚ext_pos, 
n


285 
Ï¡_pos
 = 
pos


286  
tok


287 
’d


288 
loÿl
 
funùiÚ
 
	$cÚsume
(
ex³ùed
, 
İts
)

289 
loÿl
 
tok
 = 
	$Ãxt
(
İts
)

290 
	`as£¹
(
tok
 =ğ
ex³ùed
, "expected "..expected..", got: "..tok)

291 
’d


292 
loÿl
 
funùiÚ
 
	$check
(
ex³ùed
, 
İts
)

293 
	`³ek
(
İts
è~ğ
ex³ùed
 
th’
  
çl£
 
’d


294 
	$Ãxt
()

295  
Œue


296 
’d


297 
loÿl
 
funùiÚ
 
	$”rÜ_¡r
(
mes§ge
, ...)

298 
loÿl
 
loÿtiÚ_”rÜ_mes§ge
 = "Pflua…arseƒrror: Inƒxpression \"%s\""

299 
loÿl
 
¡¬t
 = #location_error_message - 4

300 
loÿl
 
cursÜ_pos
 = 
¡¬t
 + 
Ï¡_pos


302 
loÿl
 
»suÉ
 = "\n"

303 
»suÉ
 =„esuÉ..
loÿtiÚ_”rÜ_mes§ge
:
	`fÜm©
(
¡r
).."\n"

304 
»suÉ
 =„esuÉ..
¡ršg
.
	`»p
(" ", 
cursÜ_pos
).."^".."\n"

305 
»suÉ
 =„esuÉ..
mes§ge
:
	`fÜm©
(...).."\n"

306  
»suÉ


307 
’d


308 
loÿl
 
funùiÚ
 
	$”rÜ
(
mes§ge
, ...)

309 
	`´im™ive_”rÜ
(
	$”rÜ_¡r
(
mes§ge
, ...))

310 
’d


311  { 
³ek
 =…“k, 
Ãxt
 =‚ext, 
cÚsume
 = cÚsume, 
check
 = check, 
”rÜ
 =ƒ¼Ü 
	}
}

312 
’d


314 
loÿl
 
	gadd»s§bËs
 = 
£t
(

320 
loÿl
 
funùiÚ
 
	$nuÎ¬y
()

321  
	$funùiÚ
(
Ëx”
, 
tok
)

322  { 
tok
 
	}
}

323 
’d


324 
’d


326 
loÿl
 
funùiÚ
 
	$uÇry
(
·r£_¬g
)

327  
	$funùiÚ
(
Ëx”
, 
tok
)

328  { 
tok
, 
	`·r£_¬g
(
Ëx”
è
	}
}

329 
’d


330 
’d


332 
funùiÚ
 
	$·r£_ho¡_¬g
(
Ëx”
)

333 
loÿl
 
¬g
 = 
Ëx”
.
	`Ãxt
({
add»ss
=
Œue
})

334 
ty³
(
¬g
è=ğ'¡ršg' 
Ü
‡rg[1] =ğ'v4' o¸¬g[1] =ğ'v6' 
th’


335  
¬g


336 
’d


337 
Ëx”
.
”rÜ
('ethernet‡ddress used in‚on-etherƒxpression')

338 
’d


340 
funùiÚ
 
	$·r£_št_¬g
(
Ëx”
, 
max_Ën
)

341 
loÿl
 
»t
 = 
Ëx”
.
	`Ãxt
({
maybe_¬™hm‘ic
=
Œue
})

342 
as£¹
(
ty³
(
»t
) == 'number', 'expected‡‚umber',„et)

343 
max_Ën
 
th’
 
as£¹
(
»t
 <ğmax_Ën, 'ouˆoà¿ng'..»tè
’d


344  
»t


345 
’d


347 
funùiÚ
 
	$·r£_ušt16_¬g
(
Ëx”
è 
	$·r£_št_¬g
(
Ëx”
, 0xffffè
’d


349 
funùiÚ
 
	$·r£_Ãt_¬g
(
Ëx”
)

351 
loÿl
 
funùiÚ
 
	$check_nÚ_ÃtwÜk_b™s_š_v4
(
addr
, 
mask_b™s
, 
mask_¡r
)

352 
loÿl
 
v4
 = 
	$ušt32
(
addr
[2],‡ddr[3],‡ddr[4],‡ddr[5])

353 ià(
b™
.
	`bªd
(
v4
, 
mask_b™s
è~ğb™.
	$tob™
(
v4
)è
th’


354 
Ëx”
.
	`”rÜ
("Non-network bits set in %s/%s",

355 
bË
.
	`cÚÿt
(
addr
, ".", 2), 
mask_¡r
)

356 
’d


357 
’d


359 
loÿl
 
funùiÚ
 
	$check_nÚ_ÃtwÜk_b™s_š_v6
(
addr
, 
mask_Ën
)

360 
loÿl
 
funùiÚ
 
	$fÜm©_v6
(
addr
, 
mask_Ën
)

361  
¡ršg
.
	`fÜm©
("%x:%x:%x:%x:%x:%x:%x:%x/%d, ",

362 
addr
[2],‡ddr[3],‡ddr[4],‡ddr[5],‡ddr[5],‡ddr[6],‡ddr[7],

363 
addr
[8], 
mask_Ën
)

364 
’d


365 
loÿl
 
v6
 = 
	$v6_as_4x32
(
addr
)

366 
i
, 
äagm’t
 
š
 
	$aœs
(
v6
) do

367 
loÿl
 
mask_Ën_äagm’t
 = 
mask_Ën
 > 32 
ªd
 32 
Ü
 mask_len

368 
loÿl
 
mask_b™s
 = 2^32 - 2^(32 - 
mask_Ën_äagm’t
)

369 ià(
b™
.
	`bªd
(
äagm’t
, 
mask_b™s
è~ğb™.
	$tob™
(
äagm’t
)è
th’


370 
Ëx”
.
	`”rÜ
("NÚ-ÃtwÜk b™ £ˆš %s", 
	$fÜm©_v6
(
addr
, 
mask_Ën
))

371 
’d


372 
mask_Ën
 = mask_ËÀ- 
mask_Ën_äagm’t


373 
’d


374 
’d


376 
loÿl
 
¬g
 = 
Ëx”
.
	`Ãxt
({
add»ss
=
Œue
})

377 
ty³
(
¬g
è~ğ'bË' 
th’


378 
Ëx”
.
”rÜ
('named‚ets currently unsupported')

379 
–£if
 
¬g
[1] =ğ'eho¡' 
th’


380 
Ëx”
.
”rÜ
('ethernet‡ddress used in‚on-etherƒxpression')

381 
’d


383 -- 
IPv4
 
dÙ‹d
 
ŒË
, dÙ‹d 
·œ
 
Ü
 
b¬e
 
Ãt
 
add»s£s


384 
	g¬g
[1] =ğ'v4' 
ªd
 #¬g < 5 
th’


385 
loÿl
 
mask_Ën
 = 32

386 
i
=#arg+1,5 do

387 
	g¬g
[
i
] = 0

388 
mask_Ën
 = mask_len - 8

389 
’d


390  { 'v4/Ën', 
¬g
, 
mask_Ën
 }

391 
’d


392 
¬g
[1] =ğ'v4' 
Ü
‡rg[1] =ğ'v6' 
th’


393 
Ëx”
.
check
('/'è
th’


394 
loÿl
 
mask_Ën
 = 
·r£_št_¬g
(
Ëx”
, 
¬g
[1] =ğ'v4' 
ªd
 32 
Ü
 128)

395 ià(
¬g
[1] =ğ'v4'è
th’


396 
loÿl
 
mask_b™s
 = 2^32 - 2^(32 - 
mask_Ën
)

397 
check_nÚ_ÃtwÜk_b™s_š_v4
(
¬g
, 
mask_b™s
, 
	$to¡ršg
(
mask_Ën
))

398 
’d


399 ià(
¬g
[1] =ğ'v6'è
th’


400 
	$check_nÚ_ÃtwÜk_b™s_š_v6
(
¬g
, 
mask_Ën
)

401 
’d


402  { 
¬g
[1]..'/Ën',‡rg, 
mask_Ën
 
	}
}

403 
–£if
 
	gËx”
.
check
('mask'è
th’


404 ià(
	g¬g
[1] =ğ'v6'è
th’


405 
Ëx”
.
”rÜ
("Not valid syntax for IPv6")

406 
’d


407 
loÿl
 
mask
 = 
Ëx”
.
Ãxt
({
add»ss
=
Œue
})

408 
ty³
(
mask
è~ğ'bË' 
Ü
 mask[1] ~ğ'v4' 
th’


409 
Ëx”
.
”rÜ
("Invalid IPv4 mask")

410 
’d


411 
check_nÚ_ÃtwÜk_b™s_š_v4
(
¬g
, 
v4_to_št
(
mask
),

412 
bË
.
cÚÿt
(
mask
, '.', 2))

413  { 
	g¬g
[1]..'/mask',‡rg, 
	gmask
 }

415  
¬g


416 
’d


417 
’d


418 
’d


420 
loÿl
 
funùiÚ
 
	$to_pÜt_numb”
(
tok
)

421 
loÿl
 
pÜt
 = 
tok


422 
	`ty³
(
tok
è=ğ'¡ršg' 
th’


423 
loÿl
 
Ãxt_pos


424 
pÜt
, 
Ãxt_pos
 = 
	$Ëx_numb”
(
tok
, 1, 10)

425 
nÙ
 
pÜt
 
Ü
 
Ãxt_pos
 ~ğ#tok+1 
th’


426 -- 
Tok’
 
is
 
nÙ
 
a
 
v®id
 
decim®
 
l™”®
, 
çÎback
 
to
 
£rviûs
.

427  
cÚ¡ªts
.
£rviûs
[
tok
]

428 
’d


429 
’d


431 
	`as£¹
(
pÜt
 <= 65535, 'port '..port..' out of„ange')

432  
pÜt


433 
’d


435 
loÿl
 
funùiÚ
 
	$·r£_pÜt_¬g
(
Ëx”
)

436 
loÿl
 
tok
 = 
Ëx”
.
	$Ãxt
()

437 
loÿl
 
»suÉ
 = 
	$to_pÜt_numb”
(
tok
)

438 
nÙ
 
»suÉ
 
th’


439 
Ëx”
.
	`”rÜ
('unsuµÜ‹d…Üˆ%s', 
tok
)

440 
’d


441  
»suÉ


442 
’d


444 
loÿl
 
funùiÚ
 
	$·r£_pÜŒªge_¬g
(
Ëx”
)

445 
loÿl
 
tok
 = 
Ëx”
.
	`Ãxt
()

447 -- 
Try
 
to
 
¥l™
 
pÜŒªge
 
äom
 
¡¬t
Ø
fœ¡
 
hyph’
, 
Ü
 from starto

448 -- 
£cÚd
 
hyph’
, 
ªd
 
so
 
Ú
.

449 
loÿl
 
pos
 = 1

450 
Œue
 do

451 
pos
 = 
tok
:
	`m©ch
("^%w+%-()",…os)

452 
nÙ
 
pos
 
th’


453 
Ëx”
.
	`”rÜ
('”rÜ…¬sšg…ÜŒªg%s', 
tok
)

454 
’d


455 
loÿl
 
äom
, 
to
 = 
	`to_pÜt_numb”
(
tok
:
	`sub
(1, 
pos
 - 2)),o_pÜt_numb”Ñok:
	$sub
(
pos
))

456 
äom
 
ªd
 
to
 
th’


457 -- 
FÜ
 
libpÿp
 
com·tib™y
, 
to
 < 
äom
, 
sw­
 
them


458 
äom
 > 
to
 
th’
 from,Øğto, from 
’d


459  { 
äom
, 
to
 
	}
}

460 
’d


461 
’d


462 
’d


464 
loÿl
 
funùiÚ
 
	$·r£_eho¡_¬g
(
Ëx”
)

465 
loÿl
 
¬g
 = 
Ëx”
.
	`Ãxt
({
add»ss
=
Œue
})

466 
ty³
(
¬g
è=ğ'¡ršg' 
Ü
‡rg[1] =ğ'eho¡' 
th’


467  
¬g


468 
’d


469 
Ëx”
.
”rÜ
('šv®idƒth”Ãˆho¡ %s', 
¬g
)

470 
’d


472 
loÿl
 
funùiÚ
 
	$bË_·r£r
(
bË
, )

473  
	$funùiÚ
 (
Ëx”
, 
tok
)

474 
loÿl
 
subtok
 = 
Ëx”
.
	$³ek
()

475 
bË
[
subtok
] 
th’


476 
Ëx”
.
	$cÚsume
(
subtok
)

477  
bË
[
subtok
](
Ëx”
, 
tok
..'_'..subtok)

478 
’d


479  
th’
  (
Ëx”
, 
tok
è
’d


480 
Ëx”
.
	`”rÜ
('unknowÀ% ty³ % ', 
tok
, 
subtok
)

481 
’d


482 
’d


484 
loÿl
 
_´Ùos
 = 
	`£t
(

488 
loÿl
 
funùiÚ
 
	$·r£_´Ùo_¬g
(
Ëx”
, 
´Ùo_ty³
, 
´Ùos
)

489 
Ëx”
.
	`check
('\\')

490 
loÿl
 
¬g
 = 
Ëx”
.
	$Ãxt
()

491 
nÙ
 
´Ùo_ty³
 
th’
…rÙo_ty³ = '' 
’d


492 
nÙ
 
´Ùos
 
th’
…rÙo ğ
_´Ùos
 
’d


493 
	`ty³
(
¬g
è=ğ'numb”' 
th’
 ‡rg 
’d


494 
	`ty³
(
¬g
è=ğ'¡ršg' 
th’


495 
loÿl
 
´Ùo
 = 
¬g
:
	`m©ch
("^(%w+)")

496 
´Ùos
[
´Ùo
] 
th’
 …rÙØ
’d


497 
’d


498 
Ëx”
.
	`”rÜ
('šv®id % ´ÙØ%s', 
´Ùo_ty³
, 
¬g
)

499 
’d


501 
loÿl
 
‘h”_´Ùos
 = 
	`£t
(

506 
loÿl
 
funùiÚ
 
	$·r£_‘h”_´Ùo_¬g
(
Ëx”
)

507  
	`·r£_´Ùo_¬g
(
Ëx”
, '‘h”Ãt', 
‘h”_´Ùos
)

508 
’d


510 
loÿl
 
funùiÚ
 
	$·r£__´Ùo_¬g
(
Ëx”
)

511  
	`·r£_´Ùo_¬g
(
Ëx”
, '', 
_´Ùos
)

512 
’d


514 
loÿl
 
iso_´Ùos
 = 
	`£t
('clnp', 'esis', 'isis')

516 
loÿl
 
funùiÚ
 
	$·r£_iso_´Ùo_¬g
(
Ëx”
)

517  
	`·r£_´Ùo_¬g
(
Ëx”
, 'iso', 
iso_´Ùos
)

518 
’d


520 
loÿl
 
funùiÚ
 
	$sim¶e_ty³d_¬g_·r£r
(
ex³ùed
)

521  
	$funùiÚ
(
Ëx”
)

522 
loÿl
 
¬g
 = 
Ëx”
.
	$Ãxt
()

523 
	`ty³
(
¬g
è=ğ
ex³ùed
 
th’
 ‡rg 
’d


524 
Ëx”
.
	`”rÜ
('ex³ùed‡ % ¡ršg, gÙ %s', 
ex³ùed
, 
	$ty³
(
¬g
))

525 
’d


526 
’d


528 
loÿl
 
·r£_¡ršg_¬g
 = 
	`sim¶e_ty³d_¬g_·r£r
('string')

530 
loÿl
 
funùiÚ
 
	$·r£_deú‘_ho¡_¬g
(
Ëx”
)

531 
loÿl
 
¬g
 = 
Ëx”
.
	`Ãxt
({
add»ss
=
Œue
})

532 
ty³
(
¬g
è=ğ'¡ršg' 
th’
 ‡rg 
’d


533 
¬g
[1] =ğ'v4' 
th’


534 
¬g
[1] = 'decnet'

535 
as£¹
(#¬g =ğ3, "bad deú‘‡dd»ss", 
¬g
)

536  
¬g


537 
’d


538 
	gËx”
.
”rÜ
('šv®id deú‘ ho¡ %s', 
¬g
)

539 
’d


541 
loÿl
 
	gÎc_ty³s
 = 
£t
(

546 
loÿl
 
funùiÚ
 
	$·r£_Îc
(
Ëx”
, 
tok
)

547 
Îc_ty³s
[
Ëx”
.
	`³ek
()] 
th’
  { 
tok
,†ex”.
	`Ãxt
(è
	}
} 
’d


548  { 
	gtok
 }

549 
’d


551 
loÿl
 
	gpf_»asÚs
 = 
£t
(

555 
loÿl
 
	gpf_aùiÚs
 = 
£t
(

559 
loÿl
 
	gwÏn_äame_ty³s
 = 
£t
('mgt', 'ctl', 'data')

560 
loÿl
 
	gwÏn_äame_mgt_subty³s
 = 
£t
(

564 
loÿl
 
	gwÏn_äame_ùl_subty³s
 = 
£t
(

567 
loÿl
 
	gwÏn_äame_d©a_subty³s
 = 
£t
(

574 
loÿl
 
	gwÏn_dœeùiÚs
 = 
£t
('nods', 'tods', 'fromds', 'dstods')

576 
loÿl
 
funùiÚ
 
	$·r£_’um_¬g
(
Ëx”
, 
£t
)

577 
loÿl
 
¬g
 = 
Ëx”
.
	$Ãxt
()

578 
	`as£¹
(
£t
[
¬g
], 'invalid‡rgument: '..arg)

579  
¬g


580 
’d


582 
loÿl
 
funùiÚ
 
	$’um_¬g_·r£r
(
£t
)

583  
	$funùiÚ
(
Ëx”
è 
	$·r£_’um_¬g
(
Ëx”
, 
£t
è
’d


584 
’d


586 
loÿl
 
funùiÚ
 
	$·r£_wÏn_ty³
(
Ëx”
, 
tok
)

587 
loÿl
 
ty³
 = 
	$’um_¬g_·r£r
(
wÏn_äame_ty³s
)(
Ëx”
)

588 
Ëx”
.
	`check
('subty³'è
th’


589 
loÿl
 
£t


590 
ty³
 =ğ'mgt' 
th’
 
£t
 = 
wÏn_äame_mgt_subty³s


591 
–£if
 
ty³
 =ğ'mgt' 
th’
 
£t
 = 
wÏn_äame_ùl_subty³s


592 
£t
 = 
wÏn_äame_d©a_subty³s
 
’d


593  { 'ty³', 
ty³
, 
	`’um_¬g_·r£r
(
£t
)(
Ëx”
è
	}
}

594 
’d


595  { 
tok
, 
ty³
 }

596 
’d


598 
loÿl
 
funùiÚ
 
	$·r£_wÏn_subty³
(
Ëx”
, 
tok
)

599 
loÿl
 
subty³
 = 
Ëx”
.
	$Ãxt
()

600 
	`as£¹
(
wÏn_äame_mgt_subty³s
[
subty³
]

601 
Ü
 
wÏn_äame_ùl_subty³s
[
subty³
]

602 
Ü
 
wÏn_äame_d©a_subty³s
[
subty³
],

603 'bad wÏÀsubty³ '..
subty³
)

604  { 
tok
, 
subty³
 
	}
}

605 
’d


607 
loÿl
 
funùiÚ
 
	$·r£_wÏn_dœ
(
Ëx”
, 
tok
)

608 ià(
	`ty³
(
Ëx”
.
	`³ek
()è=ğ'numb”'è
th’


609  { 
tok
, 
Ëx”
.
	`Ãxt
(è
	}
}

610 
’d


611  { 
tok
, 
·r£_’um_¬g
(
Ëx”
, 
wÏn_dœeùiÚs
) }

612 
’d


614 
loÿl
 
funùiÚ
 
	$·r£_İtiÚ®_št
(
Ëx”
, 
tok
)

615 ià(
	`ty³
(
Ëx”
.
	`³ek
()è=ğ'numb”'è
th’


616  { 
tok
, 
Ëx”
.
	`Ãxt
(è
	}
}

617 
’d


618  { 
tok
 }

619 
’d


621 
loÿl
 
¤c_Ü_d¡_ty³s
 = {

622 
ho¡
 = 
uÇry
(
·r£_ho¡_¬g
),

623 
	gÃt
 = 
uÇry
(
·r£_Ãt_¬g
),

624 
	gpÜt
 = 
uÇry
(
·r£_pÜt_¬g
),

625 
	gpÜŒªge
 = 
uÇry
(
·r£_pÜŒªge_¬g
)

628 
loÿl
 
	g‘h”_ho¡_ty³
 = {

629 
ho¡
 = 
uÇry
(
·r£_eho¡_¬g
)

632 
loÿl
 
	g‘h”_ty³s
 = {

633 
d¡
 = 
bË_·r£r
(
‘h”_ho¡_ty³
, 
uÇry
(
·r£_eho¡_¬g
)),

634 
	g¤c
 = 
bË_·r£r
(
‘h”_ho¡_ty³
, 
uÇry
(
·r£_eho¡_¬g
)),

635 
	gho¡
 = 
uÇry
(
·r£_eho¡_¬g
),

636 
	gbrßdÿ¡
 = 
nuÎ¬y
(),

637 
	gmuÉiÿ¡
 = 
nuÎ¬y
(),

638 
	g´Ùo
 = 
uÇry
(
·r£_‘h”_´Ùo_¬g
),

641 
loÿl
 
	g_ty³s
 = {

642 
d¡
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

643 
	g¤c
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

644 
	gho¡
 = 
uÇry
(
·r£_ho¡_¬g
),

645 
	g´Ùo
 = 
uÇry
(
·r£__´Ùo_¬g
),

646 
	g´Ùochaš
 = 
uÇry
(
·r£__´Ùo_¬g
),

647 
	gbrßdÿ¡
 = 
nuÎ¬y
(),

648 
	gmuÉiÿ¡
 = 
nuÎ¬y
(),

651 
loÿl
 
	g6_ty³s
 = {

652 
´Ùo
 = 
uÇry
(
·r£__´Ùo_¬g
),

653 
	g´Ùochaš
 = 
uÇry
(
·r£__´Ùo_¬g
),

654 
	gbrßdÿ¡
 = 
nuÎ¬y
(),

655 
	gmuÉiÿ¡
 = 
nuÎ¬y
(),

658 
loÿl
 
	gdeú‘_ho¡_ty³
 = {

659 
ho¡
 = 
uÇry
(
·r£_deú‘_ho¡_¬g
),

662 
loÿl
 
	gdeú‘_ty³s
 = {

663 
¤c
 = 
bË_·r£r
(
deú‘_ho¡_ty³
, 
uÇry
(
·r£_deú‘_ho¡_¬g
)),

664 
	gd¡
 = 
bË_·r£r
(
deú‘_ho¡_ty³
, 
uÇry
(
·r£_deú‘_ho¡_¬g
)),

665 
	gho¡
 = 
uÇry
(
·r£_deú‘_ho¡_¬g
),

668 
loÿl
 
	gwÏn_ty³s
 = {

669 
¿
 = 
uÇry
(
·r£_eho¡_¬g
),

670 
	g
 = 
uÇry
(
·r£_eho¡_¬g
),

671 
	gaddr1
 = 
uÇry
(
·r£_eho¡_¬g
),

672 
	gaddr2
 = 
uÇry
(
·r£_eho¡_¬g
),

673 
	gaddr3
 = 
uÇry
(
·r£_eho¡_¬g
),

674 
	gaddr4
 = 
uÇry
(
·r£_eho¡_¬g
),

676 -- 
As
 
ª
 
®Ÿs
 
	gof
 'ether'

677 
	gd¡
 = 
bË_·r£r
(
‘h”_ho¡_ty³
, 
uÇry
(
·r£_eho¡_¬g
)),

678 
	g¤c
 = 
bË_·r£r
(
‘h”_ho¡_ty³
, 
uÇry
(
·r£_eho¡_¬g
)),

679 
	gho¡
 = 
uÇry
(
·r£_eho¡_¬g
),

680 
	gbrßdÿ¡
 = 
nuÎ¬y
(),

681 
	gmuÉiÿ¡
 = 
nuÎ¬y
(),

682 
	g´Ùo
 = 
uÇry
(
·r£_‘h”_´Ùo_¬g
),

685 
loÿl
 
	giso_ty³s
 = {

686 
´Ùo
 = 
uÇry
(
·r£_iso_´Ùo_¬g
),

687 
	g
 = 
uÇry
(
·r£_eho¡_¬g
),

688 
	gaddr1
 = 
uÇry
(
·r£_eho¡_¬g
),

689 
	gaddr2
 = 
uÇry
(
·r£_eho¡_¬g
),

690 
	gaddr3
 = 
uÇry
(
·r£_eho¡_¬g
),

691 
	gaddr4
 = 
uÇry
(
·r£_eho¡_¬g
),

694 
loÿl
 
	gtı_Ü_udp_ty³s
 = {

695 
pÜt
 = 
uÇry
(
·r£_pÜt_¬g
),

696 
	gpÜŒªge
 = 
uÇry
(
·r£_pÜŒªge_¬g
),

697 
	gd¡
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
),

698 
	g¤c
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
),

701 
loÿl
 
	g¬p_ty³s
 = {

702 
d¡
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

703 
	g¤c
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

704 
	gho¡
 = 
uÇry
(
·r£_ho¡_¬g
),

707 
loÿl
 
	g¿½_ty³s
 = {

708 
d¡
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

709 
	g¤c
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

710 
	gho¡
 = 
uÇry
(
·r£_ho¡_¬g
),

713 
loÿl
 
·r£_¬™hm‘ic


715 
loÿl
 
funùiÚ
 
	$·r£_add»s§bË
(
Ëx”
, 
tok
)

716 
nÙ
 
tok
 
th’


717 
tok
 = 
Ëx”
.
	`Ãxt
({
maybe_¬™hm‘ic
=
Œue
})

718 
nÙ
 
	gadd»s§bËs
[
tok
] 
th’


719 
	gËx”
.
”rÜ
('badok’ wh·rsšg‡dd»s§bË: %s', 
tok
)

720 
’d


721 
’d


722 
	gËx”
.
cÚsume
('[')

723 
loÿl
 
	gpos
 = 
	$·r£_¬™hm‘ic
(
Ëx”
)

724 
loÿl
 
size
 = 1

725 
Ëx”
.
	`check
(':'è
th’


726 
Ëx”
.
	$check
(1è
th’
 
size
 = 1

727 
–£if
 
Ëx”
.
	$check
(2è
th’
 
size
 = 2

728 
Ëx”
.
	`cÚsume
(4); 
size
 = 4 
’d


729 
’d


730 
Ëx”
.
	`cÚsume
(']')

731  { '['..
tok
..']', 
pos
, 
size
}

732 
’d


734 
loÿl
 
funùiÚ
 
	$·r£_´im¬y_¬™hm‘ic
(
Ëx”
, 
tok
)

735 
tok
 =ok 
Ü
 
Ëx”
.
	`Ãxt
({
maybe_¬™hm‘ic
=
Œue
})

736 
	gtok
 =ğ'(' 
th’


737 
loÿl
 
ex´
 = 
	$·r£_¬™hm‘ic
(
Ëx”
)

738 
Ëx”
.
	`cÚsume
(')')

739  
ex´


740 
–£if
 
tok
 =ğ'Ën' 
Ü
 
	`ty³
Ñokè=ğ'numb”' 
th’


741  
tok


742 
–£if
 
®low_add»ss_of
 
ªd
 
tok
 =ğ'&' 
th’


743  { 'addr', 
	`·r£_add»s§bË
(
Ëx”
è
	}
}

744 
–£if
 
add»s§bËs
[
tok
] 
th’


745  
	$·r£_add»s§bË
(
Ëx”
, 
tok
)

747 -- 'tok' 
may
 
be
 
a
 
cÚ¡ªt


748 
loÿl
 
v®
 = 
cÚ¡ªts
.
´ÙocŞ_h—d”_f›ld_off£ts
[
tok
] 
Ü


749 
cÚ¡ªts
.
icmp_ty³_f›lds
[
tok
] 
Ü


750 
cÚ¡ªts
.
tı_æag_f›lds
[
tok
]

751 
v®
 ~ğ
n
 
th’
  v® 
’d


752 
Ëx”
.
	`”rÜ
('badok’ wh·rsšg‡r™hm‘iøex´essiÚ %s', 
tok
)

753 
’d


754 
’d


756 
loÿl
 
¬™hm‘ic_´eûd’û
 = {

763 
	}
}

765 
funùiÚ
 
	$·r£_¬™hm‘ic
(
Ëx”
, 
tok
, 
max_´eûd’û
, 
·r£d_exp
)

766 
loÿl
 
exp
 = 
·r£d_exp
 
Ü
 
	$·r£_´im¬y_¬™hm‘ic
(
Ëx”
, 
tok
)

767 
max_´eûd’û
 = max_´eûd’û 
Ü
 
m©h
.
huge


768 
Œue
 do

769 
loÿl
 
İ
 = 
Ëx”
.
	$³ek
()

770 
loÿl
 
´ec
 = 
¬™hm‘ic_´eûd’û
[
İ
]

771 
nÙ
 
´ec
 
Ü
…»ø> 
max_´eûd’û
 
th’
  
exp
 
’d


772 
Ëx”
.
	$cÚsume
(
İ
)

773 
loÿl
 
rhs
 = 
	`·r£_¬™hm‘ic
(
Ëx”
, 
n
, 
´ec
 - 1)

774 
exp
 = { 
İ
,ƒxp, 
rhs
 
	}
}

775 
’d


776 
’d


778 
loÿl
 
´im™ives
 = {

779 
d¡
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

780 
	g¤c
 = 
bË_·r£r
(
¤c_Ü_d¡_ty³s
, 
uÇry
(
·r£_ho¡_¬g
)),

781 
	gho¡
 = 
uÇry
(
·r£_ho¡_¬g
),

782 
	g‘h”
 = 
bË_·r£r
(
‘h”_ty³s
),

783 
	gfddi
 = 
bË_·r£r
(
‘h”_ty³s
),

784 
	gŒ
 = 
bË_·r£r
(
‘h”_ty³s
),

785 
	gwÏn
 = 
bË_·r£r
(
wÏn_ty³s
),

786 
	gbrßdÿ¡
 = 
nuÎ¬y
(),

787 
	gmuÉiÿ¡
 = 
nuÎ¬y
(),

788 
	gg©eway
 = 
uÇry
(
·r£_¡ršg_¬g
),

789 
	gÃt
 = 
uÇry
(
·r£_Ãt_¬g
),

790 
	gpÜt
 = 
uÇry
(
·r£_pÜt_¬g
),

791 
	gpÜŒªge
 = 
uÇry
(
·r£_pÜŒªge_¬g
),

792 
	gËss
 = 
uÇry
(
·r£_¬™hm‘ic
),

793 
	gg»©”
 = 
uÇry
(
·r£_¬™hm‘ic
),

794 
	g
 = 
bË_·r£r
(
_ty³s
, 
nuÎ¬y
()),

795 
	g6
 = 
bË_·r£r
(
6_ty³s
, 
nuÎ¬y
()),

796 
	g´Ùo
 = 
uÇry
(
·r£_´Ùo_¬g
),

797 
	gtı
 = 
bË_·r£r
(
tı_Ü_udp_ty³s
, 
nuÎ¬y
()),

798 
	gudp
 = 
bË_·r£r
(
tı_Ü_udp_ty³s
, 
nuÎ¬y
()),

799 
	gicmp
 = 
nuÎ¬y
(),

800 
	gicmp6
 = 
nuÎ¬y
(),

801 
	gigmp
 = 
nuÎ¬y
(),

802 
	gig½
 = 
nuÎ¬y
(),

803 
	gpim
 = 
nuÎ¬y
(),

804 
	gah
 = 
nuÎ¬y
(),

805 
	ge¥
 = 
nuÎ¬y
(),

806 
	gv¼p
 = 
nuÎ¬y
(),

807 
	gsùp
 = 
nuÎ¬y
(),

808 
	g´Ùochaš
 = 
uÇry
(
·r£_´Ùo_¬g
),

809 
	g¬p
 = 
bË_·r£r
(
¬p_ty³s
, 
nuÎ¬y
()),

810 
	g¿½
 = 
bË_·r£r
(
¿½_ty³s
, 
nuÎ¬y
()),

811 
	g©®k
 = 
nuÎ¬y
(),

812 
	g¯½
 = 
nuÎ¬y
(),

813 
	gdeú‘
 = 
bË_·r£r
(
deú‘_ty³s
, 
nuÎ¬y
()),

814 
	giso
 = 
nuÎ¬y
(),

815 
	g¡p
 = 
nuÎ¬y
(),

816 
	gx
 = 
nuÎ¬y
(),

817 
	gÃtbeui
 = 
nuÎ¬y
(),

818 
	gsÿ
 = 
nuÎ¬y
(),

819 
	gÏt
 = 
nuÎ¬y
(),

820 
	gmİrc
 = 
nuÎ¬y
(),

821 
	gmİdl
 = 
nuÎ¬y
(),

822 
	gÎc
 = 
·r£_Îc
,

823 
	giâame
 = 
uÇry
(
·r£_¡ršg_¬g
),

824 
	gÚ
 = 
uÇry
(
·r£_¡ršg_¬g
),

825 
	gºr
 = 
uÇry
(
·r£_št_¬g
),

826 
	gruËnum
 = 
uÇry
(
·r£_št_¬g
),

827 
	g»asÚ
 = 
uÇry
(
’um_¬g_·r£r
(
pf_»asÚs
)),

828 
	gr£t
 = 
uÇry
(
·r£_¡ršg_¬g
),

829 
	gruË£t
 = 
uÇry
(
·r£_¡ršg_¬g
),

830 
	g¤Ä
 = 
uÇry
(
·r£_št_¬g
),

831 
	gsubruËnum
 = 
uÇry
(
·r£_št_¬g
),

832 
	gaùiÚ
 = 
uÇry
(
’um_¬g_·r£r
(
pf_aùiÚs
)),

833 
	gty³
 = 
·r£_wÏn_ty³
,

834 
	gsubty³
 = 
·r£_wÏn_subty³
,

835 
	gdœ
 = 
uÇry
(
’um_¬g_·r£r
(
wÏn_dœeùiÚs
)),

836 
	gvÏn
 = 
·r£_İtiÚ®_št
,

837 
	gm¶s
 = 
·r£_İtiÚ®_št
,

838 
	gµpÛd
 = 
nuÎ¬y
(),

839 
	gµpÛs
 = 
·r£_İtiÚ®_št
,

840 
	giso
 = 
bË_·r£r
(
iso_ty³s
, 
nuÎ¬y
()),

841 
	gşÅ
 = 
nuÎ¬y
(),

842 
	gesis
 = 
nuÎ¬y
(),

843 
	gisis
 = 
nuÎ¬y
(),

844 
	gl1
 = 
nuÎ¬y
(),

845 
	gl2
 = 
nuÎ¬y
(),

846 
	giih
 = 
nuÎ¬y
(),

847 
	gl¥
 = 
nuÎ¬y
(),

848 
	g¢p
 = 
nuÎ¬y
(),

849 
	gc¢p
 = 
nuÎ¬y
(),

850 
	gp¢p
 = 
nuÎ¬y
(),

851 
	gvpi
 = 
uÇry
(
·r£_št_¬g
),

852 
	gvci
 = 
uÇry
(
·r£_št_¬g
),

853 
	gÏÃ
 = 
nuÎ¬y
(),

854 
	gßmf4s
 = 
nuÎ¬y
(),

855 
	gßmf4e
 = 
nuÎ¬y
(),

856 
	gßmf4
 = 
nuÎ¬y
(),

857 
	gßm
 = 
nuÎ¬y
(),

858 
	gm‘ac
 = 
nuÎ¬y
(),

859 
	gbcc
 = 
nuÎ¬y
(),

860 
	gsc
 = 
nuÎ¬y
(),

861 
	gmic
 = 
nuÎ¬y
(),

862 
	gcÚÃùmsg
 = 
nuÎ¬y
(),

863 
	gm‘acÚÃù
 = 
nuÎ¬y
()

866 
loÿl
 
funùiÚ
 
	$·r£_´im™ive_Ü_¬™hm‘ic
(
Ëx”
)

867 
loÿl
 
tok
 = 
Ëx”
.
	`Ãxt
({
maybe_¬™hm‘ic
=
Œue
})

868 ià(
ty³
(
tok
è=ğ'numb”' 
Ü
ok == 'len' or

869 
add»s§bËs
[
tok
] 
ªd
 
Ëx”
.
³ek
(è=ğ'['è
th’


870  
	$·r£_¬™hm‘ic
(
Ëx”
, 
tok
)

871 
’d


873 
loÿl
 
·r£r
 = 
´im™ives
[
tok
]

874 
·r£r
 
th’
  
	$·r£r
(
Ëx”
, 
tok
è
’d


876 -- 
At
 
this
 
pošt
 
the
 
officŸl
 
pÿp
 
g¿mm¬
 
is
 
squœ»ly
. 
It
 
§ys
:

878 -- 
keywÜd
 
is
 
assumed
. 
FÜ
 
exam¶e
, `
nÙ
 
ho¡
 
vs
 
ªd
 
aû
' is

879 -- `
nÙ
 
ho¡
 
vs
 
ªd
 ho¡ 
aû
`‡nd 
which
 
should
‚Ù 
be


880 -- 
cÚfu£d
 
w™h
 `
	`nÙ
 (
ho¡
 
vs
 
Ü
 
aû
)`." For‚ow we…unt onhis

881 -- 
·¹
 
of
 
the
 
g¿mm¬
.

882 
loÿl
 
msg
 =

883 [[%
s
 
is
 
nÙ
 
a
 
»cognized
 
keywÜd
. 
Lik–y
 
ÿu£s
:

884 
a
è%
s
 
is
‡ 
typo
, 
šv®id
 
keywÜd
, 
Ü
 
sim¬
 
”rÜ
.

885 
b
è
You
'»ryšgØim¶ic™ly„•—ˆth´eviou şau£'
s
 
keywÜd
.

886 
In¡—d
 
of
 
libpÿp
-
¡yË
 
–isiÚ
, 
ex¶ic™ly
 
u£
 
keywÜds
 
š
 
—ch
 
şau£
:

887 
›
, "ho¡‡‡nd ho¡ b", 
nÙ
 "host‡‡nd b".]]

889 
loÿl
 
”r
 = 
¡ršg
.
	$fÜm©
(
msg
, 
tok
,ok)

890 
Ëx”
.
	$”rÜ
(
”r
)

891 
’d


893 
loÿl
 
logiÿl_İs
 = 
	`£t
('&&', 'and', '||', 'or')

895 
loÿl
 
funùiÚ
 
	$is_¬™hm‘ic
(
exp
)

896  (
exp
 =ğ'Ën' 
Ü
 
	`ty³
(exp) == 'number' or

897 
exp
[1]:
	`m©ch
("^%["è
Ü
 
¬™hm‘ic_´eûd’û
[exp[1]])

898 
’d


900 
loÿl
 
·r£_logiÿl


902 
loÿl
 
funùiÚ
 
	$·r£_logiÿl_Ü_¬™hm‘ic
(
Ëx”
, 
pick_fœ¡
)

903 
loÿl
 
exp


904 
Ëx”
.
	`³ek
(è=ğ'nÙ' 
Ü
†ex”.³ek(è=ğ'!' 
th’


905 
exp
 = { 
Ëx”
.
	`Ãxt
(), 
	`·r£_logiÿl
Öex”, 
Œue
è
	}
}

906 
–£if
 
Ëx”
.
check
('('è
th’


907 
exp
 = 
	$·r£_logiÿl_Ü_¬™hm‘ic
(
Ëx”
)

908 
Ëx”
.
	`cÚsume
(')')

910 
exp
 = 
	$·r£_´im™ive_Ü_¬™hm‘ic
(
Ëx”
)

911 
’d


912 
	$is_¬™hm‘ic
(
exp
è
th’


913 
¬™hm‘ic_´eûd’û
[
Ëx”
.
	`³ek
()] 
th’


914 
exp
 = 
	$·r£_¬™hm‘ic
(
Ëx”
, 
n
,‚, 
exp
)

915 
’d


916 
Ëx”
.
	`³ek
(è=ğ')' 
th’
  
exp
 
’d


917 
loÿl
 
İ
 = 
Ëx”
.
	$Ãxt
()

918 
	`as£¹
(
	`£t
('>', '<', '>=', '<=', '=', '!=', '==')[
İ
],

919 "ex³ùed‡ com·risÚ o³¿tÜ, gÙ "..
İ
)

920 -- 
NÜm®ize
 =ğ
to
 =, 
beÿu£
 
libpÿp
 
Œ—ts
 
them
 
id’tiÿÎy


921 
İ
 =ğ'==' 
th’
 o°ğ'=' 
’d


922 
exp
 = { 
İ
,ƒxp, 
	`·r£_¬™hm‘ic
(
Ëx”
è
	}
}

923 
’d


924 
pick_fœ¡
 
th’
  
exp
 
’d


925 
Œue
 do

926 
loÿl
 
İ
 = 
Ëx”
.
	$³ek
()

927 
nÙ
 
İ
 
Ü
 o°=ğ')' 
th’
  
exp
 
’d


928 
loÿl
 
is_logiÿl
 = 
logiÿl_İs
[
İ
]

929 
is_logiÿl
 
th’


930 
Ëx”
.
	$cÚsume
(
İ
)

932 -- 
The
 
g¿mm¬
 
is
 
such
 
th©
 "tı…Üˆ80" 
should
 
aùu®ly


933 -- 
·r£
 
as
 "tcp‡nd…ort 80".

934 
İ
 = 'and'

935 
’d


936 
loÿl
 
rhs
 = 
	$·r£_logiÿl
(
Ëx”
, 
Œue
)

937 
exp
 = { 
İ
,ƒxp, 
rhs
 
	}
}

938 
’d


939 
’d


941 
funùiÚ
 
	$·r£_logiÿl
(
Ëx”
, 
pick_fœ¡
)

942 
loÿl
 
ex´
 = 
	$·r£_logiÿl_Ü_¬™hm‘ic
(
Ëx”
, 
pick_fœ¡
)

943 
	`as£¹
(
nÙ
 
	`is_¬™hm‘ic
(
ex´
), "expected‡†ogicalƒxpression")

944  
ex´


945 
’d


947 
funùiÚ
 
	$·r£
(
¡r
, 
İts
)

948 
İts
 = o± 
Ü
 {
	}
}

949 
loÿl
 
Ëx”
 = 
	$tok’s
(
¡r
)

950 
loÿl
 
ex´


951 
İts
.
¬™hm‘ic
 
th’


952 
ex´
 = 
	$·r£_¬™hm‘ic
(
Ëx”
)

954 
nÙ
 
Ëx”
.
	`³ek
({
maybe_¬™hm‘ic
=
Œue
}èth’  { 'Œue' }ƒnd

955 
	gex´
 = 
	$·r£_logiÿl
(
Ëx”
)

956 
’d


957 
Ëx”
.
	$³ek
(è
th’
 
	`”rÜ
("uÃx³ùedok’ "..
Ëx”
.
	$³ek
()è
’d


958  
ex´


959 
’d


961 
funùiÚ
 
	$£láe¡
 ()

962 
	`´št
("selftest:…f.parse")

963 
loÿl
 
funùiÚ
 
	$check
(
ex³ùed
, 
aùu®
)

964 
	`as£¹
(
	`ty³
(
ex³ùed
è=ğty³(
aùu®
),

965 "ex³ùedy³ "..
	`ty³
(
ex³ùed
).." buˆgÙ "..
	$ty³
(
aùu®
))

966 
	`ty³
(
ex³ùed
è=ğ'bË' 
th’


967 
k
, 
v
 
š
 
	$·œs
(
ex³ùed
èdØ
	$check
(
v
, 
aùu®
[
k
]è
’d


969 
	`as£¹
(
ex³ùed
 =ğ
aùu®
, "expected "..expected.." but got "..actual)

970 
’d


971 
’d


973 
loÿl
 
funùiÚ
 
	$Ëx_‹¡
(
¡r
, 
–ts
, 
İts
)

974 
loÿl
 
Ëx”
 = 
	$tok’s
(
¡r
)

975 
i
, 
v®
 
š
 
	$aœs
(
–ts
) do

976 
	`check
(
v®
, 
Ëx”
.
	$Ãxt
(
İts
))

977 
’d


978 
	`as£¹
(
nÙ
 
Ëx”
.
	`³ek
(
İts
), "moreokens, yo")

979 
’d


980 
	`Ëx_‹¡
("", {""
	}
}, {
	gmaybe_¬™hm‘ic
=
Œue
})

981 
Ëx_‹¡
("Ën", {"Ën"}, {
maybe_¬™hm‘ic
=
Œue
})

982 
Ëx_‹¡
("len", {"len"}, {})

983 
Ëx_‹¡
("len-1", {"len-1"}, {})

984 
Ëx_‹¡
("Ën-1", {"Ën", "-", 1}, {
maybe_¬™hm‘ic
=
Œue
})

985 
Ëx_‹¡
("1-Ën", {1, "-", "Ën"}, {
maybe_¬™hm‘ic
=
Œue
})

986 
Ëx_‹¡
("1-len", {"1-len"}, {})

987 
Ëx_‹¡
("tcp…ort 80", {"tcp", "port", 80}, {})

988 
Ëx_‹¡
("tcp…ort 80‡nd (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)",

998 }, {
maybe_¬™hm‘ic
=
Œue
})

999 
Ëx_‹¡
("127.0.0.1", { { 'v4', 127, 0, 0, 1 } }, {
add»ss
=
Œue
})

1000 
Ëx_‹¡
("::", { { 'v6', 0, 0, 0, 0, 0, 0, 0, 0 } }, {
add»ss
=
Œue
})

1001 
Ëx_‹¡
("eee:eee:eee:eee:eee:eee:10.20.30.40",

1002 { { 'v6', 3822, 3822, 3822, 3822, 3822, 3822, 2580, 7720 } }, {
add»ss
=
Œue
})

1003 
Ëx_‹¡
("::10.20.30.40",

1004 { { 'v6', 0, 0, 0, 0, 0, 0, 2580, 7720 } }, {
add»ss
=
Œue
})

1006 
loÿl
 
funùiÚ
 
	$addr_”rÜ_‹¡
(
¡r
, 
ex³ùed_”r
)

1007 
loÿl
 
Ëx”
 = 
	$tok’s
(
¡r
)

1008 
loÿl
 
ok
, 
aùu®_”r
 = 
	`pÿÎ
(
Ëx”
.
³ek
, {
add»ss
=
Œue
})

1009 
nÙ
 
ok
 
th’


1010 
ex³ùed_”r
 
th’


1011 
as£¹
(
aùu®_”r
:
fšd
(
ex³ùed_”r
, 1, 
Œue
),

1012 "ex³ùedƒ¼Ü "..
ex³ùed_”r
.." buˆgÙ "..
aùu®_”r
)

1013 
’d


1015 
”rÜ
("expectedƒrror, got‚oƒrror")

1016 
’d


1017 
’d


1018 
addr_”rÜ_‹¡
("1:1:1::1:1:1:1:1", "wrong IPv6‡ddress")

1019 
addr_”rÜ_‹¡
("1:11111111", "wrong IPv6‡ddress")

1020 
addr_”rÜ_‹¡
("1::1:", "wrong IPv6‡ddress")

1021 
addr_”rÜ_‹¡
("1:2:3:4:5:6:7:1.2.3.4", "wrong IPv6‡ddress")

1022 
addr_”rÜ_‹¡
("1:2:3:4:5:1.2.3.4", "wrong IPv6‡ddress")

1023 
addr_”rÜ_‹¡
("1:2:3:4:5:1.2.3.4.5", "wrong IPv6‡ddress")

1024 
addr_”rÜ_‹¡
("1:2:3:4:5:6:1.2.3..", "wrong IPv6‡ddress")

1025 
addr_”rÜ_‹¡
("1:2:3:4:5:6:1.2.3.4.", "wrong IPv6‡ddress")

1026 
addr_”rÜ_‹¡
("1:2:3:4:5:6:1.2.3.300", "wrong IPv6‡ddress")

1028 
loÿl
 
funùiÚ
 
	$·r£_‹¡
(
¡r
, 
–ts
è
	`check
ÓÉs, 
	$·r£
(
¡r
)è
’d


1029 
	`·r£_‹¡
("",

1030 { 'Œue' 
	}
})

1031 
·r£_‹¡
("host 127.0.0.1",

1033 
·r£_‹¡
("host 1www.foo.com",

1035 
·r£_‹¡
("host 999.foo.com",

1037 
·r£_‹¡
("host 200.foo.com",

1039 
·r£_‹¡
("host 1.2.3.4foo.com",

1041 
·r£_‹¡
("host 1.2.3.4.5.com",

1043 
·r£_‹¡
("host 0xffffffffffoo.com",

1045 
·r£_‹¡
("host 0xffffffffff-oo.com",

1047 
·r£_‹¡
("src host 127.0.0.1",

1049 
·r£_‹¡
("src 127.0.0.1",

1051 
·r£_‹¡
("dst 1::ff11",

1053 
·r£_‹¡
("src‚et 10.0.0.0/24",

1056 
·r£_‹¡
("ether…roto„arp",

1058 
·r£_‹¡
("ether…roto \\rarp",

1060 
·r£_‹¡
("ether…roto \\100",

1062 
·r£_‹¡
("ip…rotocp",

1064 
·r£_‹¡
("ip…roto \\tcp",

1066 
·r£_‹¡
("ip…roto \\0",

1068 
·r£_‹¡
("decnet host 10.23",

1070 
·r£_‹¡
("ip…roto icmp",

1072 
·r£_‹¡
("ip6…rotochain icmp",

1074 
·r£_‹¡
("ip6…rotochain 100",

1076 
·r£_‹¡
("ip",

1078 
·r£_‹¡
("type mgt",

1080 
·r£_‹¡
("type mgt subtype deauth",

1082 
·r£_‹¡
("1+1=2",

1084 
·r£_‹¡
("len=4", { '=', 'len', 4 })

1085 
·r£_‹¡
("(len-4>10)", { '>', { '-', 'len', 4 }, 10 })

1086 
·r£_‹¡
("len == 4", { '=', 'len', 4 })

1087 
·r£_‹¡
("sctp", { 'sctp' })

1088 
·r£_‹¡
("1+2*3+4=5",

1090 
·r£_‹¡
("1+1=2‡ndcp",

1092 
·r£_‹¡
("tcp…ort 80‡nd 1+1=2",

1094 
·r£_‹¡
("1+1=2‡ndcp orcp",

1096 
·r£_‹¡
("1+1=2 orcp‡ndcp",

1098 
·r£_‹¡
("not 1=1 orcp",

1100 
·r£_‹¡
("not (1=1 orcp)",

1102 
·r£_‹¡
("1+1=2‡nd (tcp)",

1104 
·r£_‹¡
("tcp && ip || !1=1",

1106 
·r£_‹¡
("tcp src…ortrange 80-90",

1108 
·r£_‹¡
("tcp src…ortrange ftp-data-90",

1110 
·r£_‹¡
("tcp src…ortrange 80-ftp-data",

1111 { 'tı_¤c_pÜŒªge', { 20, 80 } }è-- 
	gsw­³d
!

1112 
·r£_‹¡
("tcp src…ortrange ftp-data-iso-tsap",

1114 
·r£_‹¡
("tcp src…ortrangeƒcho-ftp-data",

1116 
·r£_‹¡
("tcp…ort 80",

1118 
·r£_‹¡
("tcp…ort 0x50",

1120 
·r£_‹¡
("tcp…ort 0120",

1122 
·r£_‹¡
("tcp…ort 80‡nd (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)",

1129 
·r£_‹¡
("ether host ff:ff:ff:33:33:33",

1131 
·r£_‹¡
("fddi host ff:ff:ff:33:33:33",

1133 
·r£_‹¡
("tr host ff:ff:ff:33:33:33",

1135 
·r£_‹¡
("wlan host ff:ff:ff:33:33:33",

1137 
·r£_‹¡
("ether host f:f:f:3:3:3",

1139 
·r£_‹¡
("src‚et 192.168.1.0/24",

1141 
·r£_‹¡
("src‚et 192.168.1.0 mask 255.255.255.0",

1143 
·r£_‹¡
("host 0:0:0:0:0:0:0:1",

1145 
·r£_‹¡
("host ::1",

1147 
·r£_‹¡
("host 1::1",

1149 
·r£_‹¡
("host 1::",

1151 
·r£_‹¡
("src‚etƒee:eee::0/96",

1153 
·r£_‹¡
("src‚et 3ffe:500::/28",

1155 
·r£_‹¡
("src‚et 192.168.1.0/24",

1157 
·r£_‹¡
("src‚et 192.168.1.0 mask 255.255.255.0",

1159 
·r£_‹¡
("less 100", {"less", 100})

1160 
·r£_‹¡
("greater 50 + 50", {"greater", {"+", 50, 50}})

1161 
·r£_‹¡
("sctp[8] < 8", {'<', { '[sctp]', 8, 1 }, 8})

1162 
·r£_‹¡
("igmp[8] < 8", {'<', { '[igmp]', 8, 1 }, 8})

1163 
·r£_‹¡
("igrp[8] < 8", {'<', { '[igrp]', 8, 1 }, 8})

1164 
·r£_‹¡
("pim[8] < 8", {'<', { '[pim]', 8, 1 }, 8})

1165 
·r£_‹¡
("vrrp[8] < 8", {'<', { '[vrrp]', 8, 1 }, 8})

1166 
·r£_‹¡
("not icmp6", {'not', { 'icmp6' } })

1167 
·r£_‹¡
("icmp[icmptype] != icmp-echo‡nd icmp[icmptype] != icmp-echoreply",

1171 
·r£_‹¡
("net 192.0.0.0", {'net', { 'ipv4', 192, 0, 0, 0 } })

1172 
·r£_‹¡
("net 192.168.1.0/24",

1174 
·r£_‹¡
("net 192.168.1",

1176 
·r£_‹¡
("net 192.168",

1178 
·r£_‹¡
("net 192",

1180 
·r£_‹¡
("net 192",

1183 
loÿl
 
funùiÚ
 
	$·r£_”rÜ_‹¡
(
¡r
, 
ex³ùed_”r
)

1184 
loÿl
 
ok
, 
aùu®_”r
 = 
	$pÿÎ
(
·r£
, 
¡r
)

1185 
	`as£¹
(
nÙ
 
ok
, "expectedƒrror, got‚oƒrror")

1186 
ex³ùed_”r
 
th’


1187 
	`as£¹
(
aùu®_”r
:
	`fšd
(
ex³ùed_”r
, 1, 
Œue
),

1188 "ex³ùedƒ¼Ü "..
ex³ùed_”r
.." buˆgÙ "..
aùu®_”r
)

1189 
’d


1190 
’d


1191 
	`·r£_”rÜ_‹¡
("tcp src…ortrange 80-fffftp-data", "error…arsing…ortrange 80-fffftp-data")

1192 
	`·r£_”rÜ_‹¡
("tcp src…ortrange 80000-90000", "port 80000 out of„ange")

1193 
	`·r£_”rÜ_‹¡
("tcp src…ortrange 0x1-0x2", "error…arsing…ortrange 0x1-0x2")

1194 
	`·r£_”rÜ_‹¡
("tcp src…ortrange ::1", "error…arsing…ortrange :")

1195 
	`·r£_”rÜ_‹¡
("tcp src…ort ::1", "unsupported…ort :")

1196 
	`·r£_”rÜ_‹¡
("123$", "unexpectedƒnd of decimal†iteral‡t 1")

1197 
	`·r£_”rÜ_‹¡
("0x123$", "unexpectedƒnd of hexadecimal†iteral‡t 1")

1198 
	`·r£_”rÜ_‹¡
("0123$", "unexpectedƒnd of octal†iteral‡t 1")

1199 
	`·r£_”rÜ_‹¡
("0 = 0x", "unexpectedƒnd of hexadecimal†iteral‡t 5")

1200 
	`·r£_”rÜ_‹¡
("0 = 08", "unexpectedƒnd of octal†iteral‡t 5")

1201 
	`·r£_”rÜ_‹¡
("0 = 09", "unexpectedƒnd of octal†iteral‡t 5")

1202 
	`·r£_”rÜ_‹¡
("host 0xffffffffff‡ndcp", "integeroo†arge: 0xffffffffff")

1203 
	`·r£_”rÜ_‹¡
("host ff:ff:ff:ff:ff:ff", "ethernet‡ddress used in‚on-etherƒxpression")

1204 
	`·r£_”rÜ_‹¡
("net ff:ff:ff:ff:ff:ff", "ethernet‡ddress used in‚on-etherƒxpression")

1205 
	`·r£_”rÜ_‹¡
("net 192.168.1.0 mask foobar", "Invalid IPv4 mask")

1206 
	`·r£_”rÜ_‹¡
("net 192.168.1.0 mask ::", "Invalid IPv4 mask")

1207 
	`·r£_”rÜ_‹¡
("net 192.168.1.0 mask ff:ff:ff:ff:ff:ff", "Invalid IPv4 mask")

1208 
	`´št
("OK")

1209 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/pf.lua

1 
moduË
("pf",
·ckage
.
£—Î
)

3 
loÿl
 
	g§vefe
 = 
»quœe
("pf.savefile")

4 
loÿl
 
ty³s
 = 
»quœe
("pf.types")

5 
loÿl
 
libpÿp
 = 
»quœe
("pf.libpcap")

6 
loÿl
 
bpf
 = 
»quœe
("pf.bpf")

7 
loÿl
 
·r£
 = 
»quœe
('pf.parse')

8 
loÿl
 
ex·nd
 = 
»quœe
('pf.expand')

9 
loÿl
 
İtimize
 = 
»quœe
('pf.optimize')

10 
loÿl
 
ªf
 = 
»quœe
('pf.anf')

11 
loÿl
 
s§
 = 
»quœe
('pf.ssa')

12 
loÿl
 
back’d
 = 
»quœe
('pf.backend')

13 
loÿl
 
uts
 = 
»quœe
('pf.utils')

15 -- 
TODO
: 
»Çme
 
the
 'libpÿp' 
İtiÚ
 
to
 
»duû
 
‹rmšŞogy
 
ov”lßd


16 
loÿl
 
compe_deçuÉs
 = {

17 
İtimize
=
Œue
, 
	glibpÿp
=
çl£
, 
	gbpf
=çl£, 
	gsourû
=false

19 
funùiÚ
 
	$compe_f‹r
(
f‹r_¡r
, 
İts
)

20 
loÿl
 
İts
 = 
uts
.
	`·r£_İts
(İt 
Ü
 {
	}
}, 
	gcompe_deçuÉs
)

21 
loÿl
 
	gdÉ
 = 
İts
.
dÉ
 
Ü
 "EN10MB"

22 
İts
.
libpÿp
 
th’


23 
loÿl
 
by‹code
 = 
libpÿp
.
	$compe
(
f‹r_¡r
, 
dÉ
, 
İts
.
İtimize
)

24 
İts
.
sourû
 
th’
  
bpf
.
	$di§s£mbË
(
by‹code
è
’d


25 
loÿl
 
h—d”
 = 
ty³s
.
	$pÿp_pkthdr
(0, 0, 0, 0)

26  
	$funùiÚ
(
P
, 
Ën
)

27 
h—d”
.
šş_Ën
 = 
Ën


28 
h—d”
.
Üig_Ën
 = 
Ën


29  
libpÿp
.
	`ofæše_f‹r
(
by‹code
, 
h—d”
, 
P
) ~= 0

30 
’d


31 
–£if
 
İts
.
bpf
 
th’


32 
loÿl
 
by‹code
 = 
libpÿp
.
	$compe
(
f‹r_¡r
, 
dÉ
, 
İts
.
İtimize
)

33 
İts
.
sourû
 
th’
  
bpf
.
	$compe_lua
(
by‹code
è
’d


34  
bpf
.
	$compe
(
by‹code
)

35 -- 
pæua


36 
loÿl
 
ex´
 = 
·r£
.
	$·r£
(
f‹r_¡r
)

37 
ex´
 = 
ex·nd
.
	$ex·nd
(
ex´
, 
dÉ
)

38 
İts
.
İtimize
 
th’
 
ex´
 = o±imize.
	$İtimize
(
ex´
è
’d


39 
ex´
 = 
ªf
.
	$cÚv”t_ªf
(
ex´
)

40 
ex´
 = 
s§
.
	$cÚv”t_s§
(
ex´
)

41 
İts
.
sourû
 
th’
  
back’d
.
	$em™_lua
(
ex´
è
’d


42  
back’d
.
	$em™_ªd_lßd
(
ex´
, 
f‹r_¡r
)

43 
’d


44 
’d


46 
funùiÚ
 
	$£láe¡
 ()

47 
	`´št
("selftest:…f")

49 
loÿl
 
funùiÚ
 
	$‹¡_nuÎ
(
¡r
)

50 
loÿl
 
f1
 = 
	`compe_f‹r
(
¡r
, { 
libpÿp
 = 
Œue
 
	}
})

51 
loÿl
 
	gf2
 = 
compe_f‹r
(
¡r
, { 
bpf
 = 
Œue
 })

52 
loÿl
 
	gf3
 = 
compe_f‹r
(
¡r
, {})

53 
as£¹
(
f1
(
¡r
, 0è=ğ
çl£
, "null…acket should be„ejected (libpcap)")

54 
as£¹
(
f2
(
¡r
, 0è=ğ
çl£
, "null…acket should be„ejected (bpf)")

55 
as£¹
(
f3
(
¡r
, 0è=ğ
çl£
, "null…acket should be„ejected (pflua)")

56 
’d


57 
‹¡_nuÎ
("icmp")

58 
‹¡_nuÎ
("tcp…ort 80‡nd (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)")

60 
loÿl
 
funùiÚ
 
	$as£¹_couÁ
(
f‹r
, 
·ck‘s
, 
ex³ùed
)

61 
funùiÚ
 
	$couÁ_m©ched
(
´ed
)

62 
loÿl
 
m©ched
 = 0

63 
i
=1,#packets do

64 
	$´ed
(
·ck‘s
[
i
].
·ck‘
,…ack‘s[i].
Ën
è
th’


65 
m©ched
 = matched + 1

66 
’d


67 
’d


68  
m©ched


69 
’d


71 
loÿl
 
f1
 = 
	`compe_f‹r
(
f‹r
, { 
libpÿp
 = 
Œue
 
	}
})

72 
loÿl
 
	gf2
 = 
compe_f‹r
(
f‹r
, { 
bpf
 = 
Œue
 })

73 
loÿl
 
	gf3
 = 
compe_f‹r
(
f‹r
, {})

74 
loÿl
 
aùu®


75 
	gaùu®
 = 
	$couÁ_m©ched
(
f1
)

76 
	`as£¹
(
aùu®
 =ğ
ex³ùed
,

77 'libpÿp: gÙ ' .. 
aùu®
 .. ',ƒx³ùed ' .. 
ex³ùed
)

78 
aùu®
 = 
	$couÁ_m©ched
(
f2
)

79 
	`as£¹
(
aùu®
 =ğ
ex³ùed
,

80 'bpf: gÙ ' .. 
aùu®
 .. ',ƒx³ùed ' .. 
ex³ùed
)

81 
aùu®
 = 
	$couÁ_m©ched
(
f3
)

82 
	`as£¹
(
aùu®
 =ğ
ex³ùed
,

83 'pæua: gÙ ' .. 
aùu®
 .. ',ƒx³ùed ' .. 
ex³ùed
)

84 
’d


85 
loÿl
 
v4
 = 
§vefe
.
	`lßd_·ck‘s
("../tests/data/v4.pcap")

86 
	`as£¹_couÁ
('', 
v4
, 43)

87 
	`as£¹_couÁ
('', 
v4
, 43)

88 
	`as£¹_couÁ
('tı', 
v4
, 41)

89 
	`as£¹_couÁ
('tı…Üˆ80', 
v4
, 41)

91 
	`´št
("OK")

92 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/quickcheck.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

5 
loÿl
 
´og¿m_Çme
 = 'pflua-quickcheck'

7 
loÿl
 
£ed
, 
™”©iÚs
, 
´İ_Çme
, 
´İ_¬gs
, 
´İ
, 
´İ_šfo


9 -- 
Due
 
to
 
lim™©iÚs
 
of
 
Lua
 5.1, 
fšdšg
 
a
 
commªd
 
çed
 
is
 
cÚvŞu‹d
.

10 
loÿl
 
funùiÚ
 
	$fšd_g™»v
()

11 
loÿl
 
fd
 = 
io
.
	`pİ’
('git„ev-parse HEAD 2>/dev/null ;ƒcho -n "$?"')

12 
loÿl
 
cmdout
 = 
fd
:
	`»ad
("*all")

13 
fd
:
	`şo£
(è-- 
Always
 
Œue
 
š
 5.1, 
w™h
 
Lua
 
Ü
 
LuaJIT


14 
loÿl
 
_
, _, 
g™_»t
 = 
cmdout
:
	`fšd
("(%d+)$")

15 
g™_»t
 = 
	$tÚumb”
(
g™_»t
)

16 
g™_»t
 ~ğ0 
th’
 -- 
Probably
 
nÙ
 
š
 
a
 
g™
 
»po


17  
n


19 
loÿl
 
_
, _, 
sha1
 = 
cmdout
:
	`fšd
("(%x+)")

20  
sha1


21 
’d


22 
’d


24 
loÿl
 
funùiÚ
 
	$´št_g™»v_if_avaabË
()

25 
loÿl
 
»v
 = 
	$fšd_g™»v
()

26 
»v
 
th’
 
	`´št
(("G™„evisiÚ %s"):
	$fÜm©
(
»v
)è
’d


27 
’d


29 
loÿl
 
funùiÚ
 
	$»run_u§ge
(
i
)

30 
	`´št
(("Rerun‡s: %s --seed=%s --iterations=%s %s %s"):

31 
	`fÜm©
(
´og¿m_Çme
, 
£ed
, 
i
 + 1,

32 
´İ_Çme
, 
bË
.
	`cÚÿt
(
´İ_¬gs
, " ")))

33 
’d


35 
funùiÚ
 
	$š™Ÿlize
(
İtiÚs
)

36 
£ed
, 
™”©iÚs
, 
´İ_Çme
, 
´İ_¬gs
 =

37 
İtiÚs
.
£ed
, o±iÚs.
™”©iÚs
, o±iÚs.
´İ_Çme
, o±iÚs.
´İ_¬gs


39 
nÙ
 
£ed
 
th’


40 
£ed
 = 
m©h
.
	`æoÜ
(
uts
.
	`gmtime
() * 1e6) % 10^9

41 
	`´št
("Usšgima £ed: "..
£ed
)

42 
’d


43 
m©h
.
	`¿ndom£ed
(
	`as£¹
(
	$tÚumb”
(
£ed
)))

45 
nÙ
 
™”©iÚs
 
th’
 i‹¿tiÚ ğ1000 
’d


47 
nÙ
 
´İ_Çme
 
th’


48 
	`”rÜ
("No…roperty‚ame specified")

49 
’d


51 
´İ
 = 
	$»quœe
(
´İ_Çme
)

52 
´İ
.
hªdË_´İ_¬gs
 
th’


53 
´İ_šfo
 = 
´İ
.
	$hªdË_´İ_¬gs
(
´İ_¬gs
)

55 
	`as£¹
(#prop_args == 0,

56 "Prİ”ty dÛ nÙakİtiÚ "..
´İ_Çme
)

57 
´İ_šfo
 = 
n


58 
’d


59 
’d


61 
funùiÚ
 
	$š™Ÿlize_äom_commªd_lše
(
¬gs
)

62 
loÿl
 
İtiÚs
 = {
	}
}

63 #¬g >ğ1 
ªd
 
¬gs
[1]:
m©ch
("^%-%-") do

64 
loÿl
 
¬g
, 
	g_
, 
	gv®
 = 
bË
.
	$»move
(
¬gs
, 1):
	`m©ch
("^%-%-([^=]*)(=(.*))$")

65 
	$as£¹
(
¬g
)

66 
¬g
 =ğ'£ed' 
th’
 
İtiÚs
.
£ed
 = 
	`as£¹
(
	$tÚumb”
(
v®
))

67 
–£if
 
¬g
 =ğ'™”©iÚs' 
th’
 
İtiÚs
.
™”©iÚs
 = 
	`as£¹
(
	$tÚumb”
(
v®
))

68 
	`”rÜ
("UnknowÀ¬gum’t: " .. 
¬g
è
’d


69 
’d


70 #¬g < 1 
th’


71 
	`´št
("Usage: " ..

72 
´og¿m_Çme
 ..

76 
os
.
	$ex™
(1)

77 
’d


78 
İtiÚs
.
´İ_Çme
 = 
bË
.
	$»move
(
¬gs
, 1)

79 
İtiÚs
.
´İ_¬gs
 = 
¬gs


80 
	$š™Ÿlize
(
İtiÚs
)

81 
’d


83 
funùiÚ
 
	$run
()

84 
nÙ
 
´İ
 
th’


85 
	`”rÜ
("Call initialize() or initialize_from_command_line() first")

86 
’d


88 
i
 = 1,
™”©iÚs
 do

89 -- 
W¿p
 
´İ”ty
 
ªd
 
™s
 
¬gum’ts
 
š
 
a
 0-
¬™y
 
funùiÚ
 
xpÿÎ


90 
loÿl
 
w¿p_´İ
 = 
	$funùiÚ
(è 
´İ
.
	$´İ”ty
(
´İ_šfo
è
’d


91 
loÿl
 
´İg’_ok
, 
ex³ùed
, 
gÙ
 = 
	$xpÿÎ
(
w¿p_´İ
, 
debug
.
Œaûback
)

92 
nÙ
 
´İg’_ok
 
th’


93 
	`´št
(("C¿shed g’”©šg…rİ”t› Ú„uÀ%s."):
	$fÜm©
(
i
))

94 
´İ
.
´št_exŒa_šfÜm©iÚ
 
th’


95 
	`´št
("Attemptingo…rintƒxtra information; it may be wrong.")

96 
nÙ
 
	$pÿÎ
(
´İ
.
´št_exŒa_šfÜm©iÚ
)

97 
th’
 
	`´št
("Something went wrong…rintingƒxtra info.")

98 
’d


99 
’d


100 
	`´št
("Traceback (this is„eliable):")

101 
	`´št
(
ex³ùed
è-- 
This
 
is
 
ª
 
”rÜ
 
code
 
ªd
 
Œaûback
 
š
 
this
 

102 
	$»run_u§ge
(
i
)

103 
os
.
	$ex™
(1)

104 
’d


105 
nÙ
 
uts
.
	$equ®s
(
ex³ùed
, 
gÙ
è
th’


106 
	$´št_g™»v_if_avaabË
()

107 
	`´št
("The…roperty was falsified.")

108 -- 
If
 
the
 
´İ”ty
 
fe
 
has
 
exŒa
 
šfo
 
avaabË
, 
show
 
™


109 
´İ
.
´št_exŒa_šfÜm©iÚ
 
th’


110 
´İ
.
	$´št_exŒa_šfÜm©iÚ
()

112 
	`´št
('Expected:')

113 
uts
.
	$µ
(
ex³ùed
)

114 
	`´št
('Got:')

115 
uts
.
	$µ
(
gÙ
)

116 
’d


117 
	$»run_u§ge
(
i
)

118 
os
.
	$ex™
(1)

119 
’d


120 
’d


121 
	`´št
(
™”©iÚs
.." iterations succeeded.")

122 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/savefile.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
ffi
 = 
	`»quœe
("ffi")

4 
loÿl
 
C
 = 
ffi
.C

5 
loÿl
 
ty³s
 = 
	`»quœe
("pf.types")

7 
ffi
.
cdef
[[

8 
	`İ’
(cÚ¡ *
·thÇme
, 
æags
);

9 
	`şo£
(
fd
);

10 
off_t
;

11 
off_t
 
	`l£ek
(
fd
, off_ˆ
off£t
, 
wh’û
);

12 *
	`mm­
(*
addr
, 
size_t
 
Ëngth
, 
´Ù
, 
æags
, 
fd
, 
off_t
 
off£t
);

13 
	`munm­
(*
addr
, 
size_t
 
Ëngth
);

16 
funùiÚ
 
	$İ’
(
f’ame
)

17  
C
.
	$İ’
(
f’ame
, 0)

18 
’d


20 
funùiÚ
 
	$mm­
(
fd
, 
size
)

21 
loÿl
 
PROT_READ
 = 1

22 
loÿl
 
MAP_PRIVATE
 = 2

23 
loÿl
 
±r
 = 
C
.
	`mm­
(
ffi
.
	`ÿ¡
("void *", 0), 
size
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0)

24 
±r
 =ğ
ffi
.
	`ÿ¡
("void *", -1è
th’


25 
	`”rÜ
("Error mmapping")

26 
’d


27  
±r


28 
’d


30 
funùiÚ
 
	$size
(
fd
)

31 
loÿl
 
SEEK_SET
 = 0

32 
loÿl
 
SEEK_END
 = 2

33 
loÿl
 
size
 = 
C
.
	$l£ek
(
fd
, 0, 
SEEK_END
)

34 
C
.
	$l£ek
(
fd
, 0, 
SEEK_SET
)

35  
size


36 
’d


38 
funùiÚ
 
	$İ’_ªd_mm­
(
f’ame
)

39 
loÿl
 
fd
 = 
	$İ’
(
f’ame
, 
O_RDONLY
)

40 
fd
 =ğ-1 
th’


41 
	`”rÜ
("E¼Ü o³nšg " .. 
f’ame
)

42 
’d


44 
loÿl
 
sz
 = 
	$size
(
fd
)

45 
loÿl
 
±r
 = 
	$mm­
(
fd
, 
sz
)

46 
C
.
	$şo£
(
fd
)

48 
±r
 =ğ
ffi
.
	`ÿ¡
("void *", -1è
th’


49 
	`”rÜ
("E¼Ü mm­pšg " .. 
f’ame
)

50 
’d


52 
±r
 = 
ffi
.
	`ÿ¡
("unsigned char *",…tr)

53 
loÿl
 
±r_’d
 = 
±r
 + 
sz


54 
loÿl
 
h—d”
 = 
ffi
.
	`ÿ¡
("¡ruù…ÿp_f*", 
±r
)

55 
h—d”
.
magic_numb”
 =ğ0xD4C3B2A1 
th’


56 
	`”rÜ
("EndŸÀmism©ch iÀ" .. 
f’ame
)

57 
–£if
 
h—d”
.
magic_numb”
 ~ğ0xA1B2C3D4 
th’


58 
	`”rÜ
("Bad PCAP magiønumb” iÀ" .. 
f’ame
)

59 
’d


61  
h—d”
, 
±r
 + 
ffi
.("¡ruù…ÿp_fe"), 
±r_’d


62 
’d


64 
funùiÚ
 
	$lßd_·ck‘s
(
f’ame
)

65 
loÿl
 
_
, 
±r
, 
±r_’d
 = 
	$İ’_ªd_mm­
(
f’ame
)

66 
loÿl
 
»t
 = {
	}
}

67 
loÿl
 
i
 = 1

68 
±r
 < 
±r_’d
 do

69 
loÿl
 
»cÜd
 = 
ffi
.
ÿ¡
("¡ruù…ÿp_»cÜd *", 
±r
)

70 
loÿl
 
	g·ck‘
 = 
ffi
.
ÿ¡
("unsigÃd ch¬ *", 
»cÜd
 + 1)

71 
	g»t
[
i
] = { 
·ck‘
õack‘, 
	gËn
=
»cÜd
.
šş_Ën
 }

72 
	gi
 = 
i
 + 1

73 
±r
 = 
·ck‘
 + 
»cÜd
.
šş_Ën


74 
’d


75  
»t


76 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/ssa.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
uts
 = 
	`»quœe
('pf.utils')

5 
loÿl
 
v”bo£
 = 
os
.
	`g‘’v
("PF_VERBOSE");

7 
loÿl
 
£t
, 
µ
, 
dup
, 
cÚÿt
 = 
uts
.set, utils.pp, utils.dup, utils.concat

9 
loÿl
 
»lİs
 = 
	`£t
('<', '<=', '=', '!=', '>=', '>')

11 --- 
SSA
 :ğ{ 
¡¬t
=
Lab–
, 
blocks
={Lab–=>
Block
, ...} 
	}
}

12 --- 
	gLab–
 :ğ
¡ršg


13 --- 
Block
 :ğ{ 
Ïb–
=
Lab–
, 
	gbšdšgs
=[{
Çme
=
V¬
, 
v®ue
=
Ex´
},...], 
	gcÚŒŞ
=
CÚŒŞ
 }

14 --- 
	gEx´
 :ğ
UÇryOp
 | 
Bš¬yOp
 | 
Pack‘Acûss


15 --- 
CÚŒŞ
 :ğ['»tuº', 
BoŞ
|
C®l
] | ['if', BoŞ, 
Lab–
, Label] | ['goto',Label]

16 --- 
	gBoŞ
 :ğ
Œue
 | 
çl£
 | 
Com·risÚ


18 
loÿl
 
funùiÚ
 
	$´št_s§
(
s§
)

19 
loÿl
 
funùiÚ
 
	$block_»´
(
block
)

20 
loÿl
 
bšdšgs
 = { 'bšdšgs' 
	}
}

21 
_
,
bšdšg
 
š
 
	$aœs
(
block
.
bšdšgs
) do

22 
bË
.
	`š£¹
(
bšdšgs
, { 
bšdšg
.
Çme
, bšdšg.
v®ue
 
	}
})

23 
’d


25 { 'Ïb–', 
	gblock
.
	gÏb–
 },

26 
	gbšdšgs
,

27 { 'cÚŒŞ', 
	gblock
.
	gcÚŒŞ
 } }

28 
’d


29 
loÿl
 
	gblocks
 = { 'blocks' }

30 
s§
.
Üd”
 
th’


31 
Üd”
,
Ïb–
 
š
 
	$aœs
(
s§
.
Üd”
) do

32 
bË
.
	`š£¹
(
blocks
, 
	$block_»´
(
s§
.
blocks
[
Ïb–
]))

33 
’d


35 
Ïb–
,
block
 
š
 
	$·œs
(
s§
.
blocks
) do

36 
bË
.
	`š£¹
(
blocks
, 
	$block_»´
(
block
))

37 
’d


38 
’d


39 
	`µ
({ 's§', { '¡¬t', 
s§
.
¡¬t
 }, 
blocks
 
	}
})

40  
s§


41 
’d


43 
loÿl
 
funùiÚ
 
	$low”
(
ex´
)

44 
loÿl
 
Ïb–_couÁ”
 = 0

45 
loÿl
 
s§
 = { 
blocks
 = {} 
	}
}

46 
loÿl
 
funùiÚ
 
	$add_block
()

47 
Ïb–_couÁ”
 =†abel_counter + 1

48 
loÿl
 
Ïb–
 = 'L'..
Ïb–_couÁ”


49 
loÿl
 
block
 = { 
bšdšgs
={}, 
Ïb–
öab– 
	}
}

50 
	gs§
.
	gblocks
[
Ïb–
] = 
block


51  
block


52 
’d


53 
loÿl
 
funùiÚ
 
	$fšish_»tuº
(
block
, 
boŞ
)

54 
block
.
cÚŒŞ
 = { '»tuº', 
boŞ
 
	}
}

55 
’d


56 
loÿl
 
funùiÚ
 
	$fšish_if
(
block
, 
boŞ
, 
kt
, 
kf
)

57 
block
.
cÚŒŞ
 = { 'if', 
boŞ
, 
kt
.
Ïb–
, 
kf
.Ïb– 
	}
}

58 
’d


59 
loÿl
 
funùiÚ
 
	$fšish_gÙo
(
block
, 
k
)

60 
block
.
cÚŒŞ
 = { 'gÙo', 
k
.
Ïb–
 
	}
}

61 
’d


62 
loÿl
 
funùiÚ
 
	$compe_boŞ
(
ex´
, 
block
, 
kt
, 
kf
)

63 
	`as£¹
(
	`ty³
(
ex´
) == 'table')

64 
loÿl
 
İ
 = 
ex´
[1]

65 
İ
 =ğ'if' 
th’


66 
loÿl
 
kth’
, 
k–£
 = 
	`add_block
(), 
	$add_block
()

67 
	$compe_boŞ
(
ex´
[2], 
block
, 
kth’
, 
k–£
)

68 
	$compe_boŞ
(
ex´
[3], 
kth’
, 
kt
, 
kf
)

69 
	$compe_boŞ
(
ex´
[4], 
k–£
, 
kt
, 
kf
)

70 
–£if
 
İ
 =ğ'Ët' 
th’


71 
loÿl
 
Çme
, 
v®ue
, 
body
 = 
ex´
[2],ƒxpr[3],ƒxpr[4]

72 
bË
.
	`š£¹
(
block
.
bšdšgs
, { 
Çme
òame, 
v®ue
=v®u
	}
})

73 
	$compe_boŞ
(
body
, 
block
, 
kt
, 
kf
)

74 
–£if
 
İ
 =ğ'Œue' 
th’


75 
	$fšish_gÙo
(
block
, 
kt
)

76 
–£if
 
İ
 =ğ'çl£' 
th’


77 
	$fšish_gÙo
(
block
, 
kf
)

78 
–£if
 
İ
 =ğ'm©ch' 
th’


79 
	`fšish_»tuº
(
block
, { 'Œue' 
	}
})

80 
–£if
 
	gİ
 =ğ'ç' 
th’


81 
fšish_»tuº
(
block
, { 'false' })

82 
–£if
 
	gİ
 =ğ'ÿÎ' 
th’


83 
	$fšish_»tuº
(
block
, 
ex´
)

85 
	$as£¹
(
»lİs
[
İ
])

86 
	$fšish_if
(
block
, 
ex´
, 
kt
, 
kf
)

87 
’d


88 
’d


89 
loÿl
 
¡¬t
, 
acû±
, 
»jeù
 = 
	`add_block
(),‡dd_block(), 
	$add_block
()

90 
	$compe_boŞ
(
ex´
, 
¡¬t
, 
acû±
, 
»jeù
)

91 
	`fšish_»tuº
(
acû±
, { 'Œue' 
	}
})

92 
fšish_»tuº
(
»jeù
, { 'false' })

93 
	gs§
.
	g¡¬t
 = 
¡¬t
.
Ïb–


94  
s§


95 
’d


97 
loÿl
 
funùiÚ
 
	$compu‹_u£_couÁs
(
s§
)

98 
loÿl
 
»suÉ
 = {
	}
}

99 
loÿl
 
vis™ed
 = {}

100 
loÿl
 
funùiÚ
 
	$vis™
(
Ïb–
)

101 
»suÉ
[
Ïb–
] =„esult[label] + 1

102 
nÙ
 
vis™ed
[
Ïb–
] 
th’


103 
vis™ed
[
Ïb–
] = 
Œue


104 
loÿl
 
block
 = 
s§
.
blocks
[
Ïb–
]

105 
block
.
cÚŒŞ
[1] =ğ'if' 
th’


106 
	$vis™
(
block
.
cÚŒŞ
[3])

107 
	$vis™
(
block
.
cÚŒŞ
[4])

108 
–£if
 
block
.
cÚŒŞ
[1] =ğ'gÙo' 
th’


109 
	$vis™
(
block
.
cÚŒŞ
[2])

111 
	`as£¹
(
block
.
cÚŒŞ
[1] == 'return')

112 -- 
NÙhšg
 
to
 do.

113 
’d


114 
’d


115 
’d


116 
Ïb–
,
_
 
š
 
	$·œs
(
s§
.
blocks
èdØ
»suÉ
[
Ïb–
] = 0 
’d


117 
	$vis™
(
s§
.
¡¬t
)

118  
»suÉ


119 
’d


121 
loÿl
 
»lİ_šv”siÚs
 = {

123 
	}
}

125 
loÿl
 
funùiÚ
 
	$šv”t_boŞ
(
ex´
)

126 
ex´
[1] =ğ'Œue' 
th’
  { 'çl£' 
	}
} 
’d


127 
ex´
[1] =ğ'çl£' 
th’
  { 'Œue' } 
’d


128 
	$as£¹
(
»lİ_šv”siÚs
[
ex´
[1]])

129  { 
»lİ_šv”siÚs
[
ex´
[1]],ƒx´[2],ƒx´[3] 
	}
}

130 
’d


132 
loÿl
 
funùiÚ
 
is_sim¶e_ex´
(
ex´
)

133 -- 
Sim¶e
 :ğ 
Œue
 |  
çl£
 | 
Lab–


134 
ex´
[1] =ğ'»tuº' 
th’


135  
ex´
[2][1] =ğ'Œue' 
Ü
ƒxpr[2][1] == 'false'

136 
’d


137  
ex´
[1] == 'goto'

138 
’d


140 
loÿl
 
funùiÚ
 
is_sim¶e_block
(
block
)

141 -- 
Sim¶e
 :ğ 
Œue
 |  
çl£
 | 
Lab–


142 #block.
bšdšgs
 ~ğ0 
th’
  
n
 
’d


143  
	$is_sim¶e_ex´
(
block
.
cÚŒŞ
)

144 
’d


146 
loÿl
 
funùiÚ
 
	$sim¶ify
(
s§
)

147 
loÿl
 
»suÉ
 = { 
¡¬t
=
s§
.¡¬t, 
blocks
={} 
	}
}

148 
loÿl
 
	gu£_couÁs
 = 
	$compu‹_u£_couÁs
(
s§
)

149 
loÿl
 
funùiÚ
 
	$vis™
(
Ïb–
)

150 
»suÉ
.
blocks
[
Ïb–
] 
th’
 „esuÉ.blocks[Ïb–] 
’d


151 
loÿl
 
block
 = 
	$dup
(
s§
.
blocks
[
Ïb–
])

152 
block
.
cÚŒŞ
[1] =ğ'if' 
th’


153 
loÿl
 
t
, 
f
 = 
	`vis™
(
block
.
cÚŒŞ
[3]), 
	$vis™
(
block
.
cÚŒŞ
[4])

154 ià(
	$is_sim¶e_block
(
t
è
ªd
 
	$is_sim¶e_block
(
f
è
ªd


155 
t
.
cÚŒŞ
[1] =ğ'»tuº' 
ªd
 
f
.cÚŒŞ[1] =ğ'»tuº'è
th’


156 
loÿl
 
t_v®
, 
f_v®
 = 
t
.
cÚŒŞ
[2][1], 
f
.control[2][1]

157 
t_v®
 =ğ
f_v®
 
th’


158 -- 
EXP
 
th’
  
Œue
 ru
’d
 -> rue

160 -- 
This
 
is
 
v®id
 
beÿu£
 
EXP
 
ÿn
 
have
 
no
 
side
 
efãùs
 
ªd


161 -- 
has
 
no
 
cÚŒŞ
 
efãù
.

162 
block
.
cÚŒŞ
 = 
t
.control

163 
–£if
 
t_v®
 =ğ'Œue' 
ªd
 
f_v®
 =ğ'çl£' 
th’


164 -- 
EXP
 
th’
  
Œue
  
çl£
 ->  EXP

165 
block
.
cÚŒŞ
 = { '»tuº', block.cÚŒŞ[2] 
	}
}

167 
as£¹
(
t_v®
 =ğ'çl£' 
ªd
 
f_v®
 == 'true')

168 -- 
EXP
 
th’
  
çl£
  
Œue
 ->  
nÙ
 EXP

169 
block
.
cÚŒŞ
 = { '»tuº', 
šv”t_boŞ
(block.control[2]) }

170 
’d


172 
loÿl
 
cÚŒŞ
 = { 'if', 
block
.cÚŒŞ[2], 
t
.
Ïb–
, 
f
.label }

173 
t
.
cÚŒŞ
[1] =ğ'gÙo' 
ªd
 #t.
bšdšgs
 =ğ0 
th’


174 
cÚŒŞ
[3] = 
t
.control[2]

175 
’d


176 
f
.
cÚŒŞ
[1] =ğ'gÙo' 
ªd
 #f.
bšdšgs
 =ğ0 
th’


177 
cÚŒŞ
[4] = 
f
.control[2]

178 
’d


179 
block
.
cÚŒŞ
 = control

180 
’d


181 
–£if
 
block
.
cÚŒŞ
[1] =ğ'gÙo' 
th’


182 
loÿl
 
k
 = 
vis™
(
block
.
cÚŒŞ
[2])

183 -- 
IÆše
 
blocks
 
š
 
ÿ£s
 
wh”e
 
the
 
šlššg
 
wl
 
nÙ
 
šü—£


184 -- 
code
 
size
, 
which
 
is
 
wh’
 
the
 
sucûssÜ
 i 
sim¶e
 (
ªd
 
thus


185 -- 
ÿn
 
be
 
cİ›d
è
Ü
 
the
 
sucûssÜ
 
Úly
 
has
 
Úe
 
	g´edeûssÜ
.

186 
	$is_sim¶e_block
(
k
è
Ü
 
u£_couÁs
[
block
.
cÚŒŞ
[2]] =ğ1 
th’


187 
block
.
bšdšgs
 = 
	$cÚÿt
(
block
.
bšdšgs
, 
k
.bindings)

188 
block
.
cÚŒŞ
 = 
k
.control

189 -- 
A
 
sub£qu’t
 
™”©iÚ
 
wl
 
»move
 
the
 
unu£d
 "k" 
block
.

190 
’d


192 
	`as£¹
(
block
.
cÚŒŞ
[1] == 'return')

193 -- 
NÙhšg
 
to
 do.

194 
’d


195 
»suÉ
.
blocks
[
Ïb–
] = 
block


196  
block


197 
’d


198 
	$vis™
(
s§
.
¡¬t
)

199  
»suÉ


200 
’d


202 
loÿl
 
funùiÚ
 
	$İtimize_s§
(
s§
)

203 
s§
 = 
uts
.
	$fixpošt
(
sim¶ify
, 
s§
)

204 
v”bo£
 
th’
 
	$µ
(
s§
è
’d


205  
s§


206 
’d


208 -- 
Compu‹
 
a
 
»v”£
-
po¡
-
Üd”
 
sÜt
 
of
 
the
 
blocks
, 
which
 
is
‡

209 -- 
tİŞogiÿl
 
sÜt
. 
The
 
»suÉ
 
is
 
ª
 
¬¿y
 
of
 
Ïb–s
, 
äom
 
fœ¡
 
to


210 -- 
Ï¡
, 
which
 
is
 
£t
 
as
 
the
 "Üd”" 
´İ”ty
 
Ú
h
s§
. 
Each


211 -- 
block
 
wl
 
®so
 
be
 
giv’
 
ª
 "Üd”" 
´İ”ty
.

212 
loÿl
 
funùiÚ
 
	$Üd”_blocks
(
s§
)

213 
loÿl
 

 = 
n


214 
loÿl
 
chaš
 = {
	}
} -- 
Ïb–
 ->†ab– | 
n


215 
loÿl
 
vis™ed
 = {} -- 
Ïb–
 -> 
boŞ


216 
loÿl
 
funùiÚ
 
	$vis™
(
Ïb–
)

217 
nÙ
 
vis™ed
[
Ïb–
] 
th’
 vis™ed[Ïb–] = 
Œue
  
’d


218 
loÿl
 
block
 = 
s§
.
blocks
[
Ïb–
]

219 
block
.
cÚŒŞ
[1] =ğ'if' 
th’


220 
	$vis™
(
block
.
cÚŒŞ
[4])

221 
	$vis™
(
block
.
cÚŒŞ
[3])

222 
–£if
 
block
.
cÚŒŞ
[1] =ğ'gÙo' 
th’


223 
	$vis™
(
block
.
cÚŒŞ
[2])

225 
	`as£¹
(
block
.
cÚŒŞ
[1] == 'return')

226 
’d


227 
chaš
[
Ïb–
] = 



228 

 = 
Ïb–


229 
’d


230 
	$vis™
(
s§
.
¡¬t
)

231 
loÿl
 
Üd”
 = 1

232 
s§
.
Üd”
 = {
	}
}

233 

 do

234 
s§
.
blocks
[

].
Üd”
 = order

235 
s§
.
Üd”
[Üd”] = 



236 

 = 
chaš
[tail]

237 
Üd”
 = order + 1

238 
’d


239 
’d


241 -- 
Add
 
a
 "´eds" 
´İ”ty
 
to
 
®l
 
blocks
, 
which
 
is
‡ 
li¡
 
of
 
Ïb–s
 
	gof


242 -- 
	g´edeûssÜs
.

243 
loÿl
 
funùiÚ
 
	$add_´edeûssÜs
(
s§
)

244 
loÿl
 
funùiÚ
 
	$vis™
(
Ïb–
, 
block
)

245 
loÿl
 
funùiÚ
 
	$add_´edeûssÜ
(
succ
)

246 
bË
.
	$š£¹
(
s§
.
blocks
[
succ
].
´eds
, 
Ïb–
)

247 
’d


248 
block
.
cÚŒŞ
[1] =ğ'if' 
th’


249 
	$add_´edeûssÜ
(
block
.
cÚŒŞ
[3])

250 
	$add_´edeûssÜ
(
block
.
cÚŒŞ
[4])

251 
–£if
 
block
.
cÚŒŞ
[1] =ğ'gÙo' 
th’


252 
	$add_´edeûssÜ
(
block
.
cÚŒŞ
[2])

254 
	`as£¹
(
block
.
cÚŒŞ
[1] == 'return')

255 
’d


256 
’d


257 
Ïb–
,
block
 
š
 
	$·œs
(
s§
.
blocks
èdØ
block
.
´eds
 = {
	}
} 
’d


258 
Ïb–
,
block
 
š
 
	$·œs
(
s§
.
blocks
èdØ
	$vis™
(
Ïb–
, 
block
è
’d


259 
’d


261 -- 
Add
 
ª
 "idom" 
´İ”ty
 
to
 
®l
 
blocks
, 
which
 
is
 
the
 
Ïb–
 
of
he

262 -- 
immedŸ‹
 
domš©Ü
. 
It
'srivial‡s we have‚o†oops.

263 
loÿl
 
funùiÚ
 
	$compu‹_idoms
(
s§
)

264 
loÿl
 
funùiÚ
 
	$dom
(
d1
, 
d2
)

265 
d1
 =ğ
d2
 
th’
  d1 
’d


266 -- 
We
 
ex¶o™
 
the
 
çù
 
th©
 
a
 
»v”£
 
po¡
-
Üd”
 
is
‡ 
tİŞogiÿl


267 -- 
sÜt
, 
ªd
 
so
 
the
 sÜˆ
Üd”
 
of
h
idom
 oà
a
 
node
 
is
 
®ways


268 -- 
num”iÿÎy
 
Ëss
 
thª
 
the
 
node
 
™£lf
.

269 
s§
.
blocks
[
d1
].
Üd”
 < s§.blocks[
d2
].Üd” 
th’


270  
	$dom
(
d1
, 
s§
.
blocks
[
d2
].
idom
)

272  
	$dom
(
s§
.
blocks
[
d1
].
idom
, 
d2
)

273 
’d


274 
’d


275 
Üd”
,
Ïb–
 
š
 
	$aœs
(
s§
.
Üd”
) do

276 
loÿl
 
´eds
 = 
s§
.
blocks
[
Ïb–
].preds

277 #´ed =ğ0 
th’


278 
	`as£¹
(
Ïb–
 =ğ
s§
.
¡¬t
)

279 -- 
No
 
idom
 
the
 
fœ¡
 
block
.

281 
loÿl
 
idom
 = 
´eds
[1]

282 -- 
If
 
th”e
 
is
 
ju¡
 
Úe
 
´edeûssÜ
, 
the
 
idom
 i 
th©


283 -- 
´edeûssÜ
. 
Oth”wi£
 
™
'she common dominator ofhe

284 -- 
fœ¡
 
´edeûssÜ
 
ªd
 
the
 
Ùh”
 
´edeûssÜs
.

285 
j
=2,#preds do

286 
idom
 = 
	$dom
(
idom
, 
´eds
[
j
])

287 
’d


288 
s§
.
blocks
[
Ïb–
].
idom
 = idom

289 
’d


290 
’d


291 
’d


293 
loÿl
 
funùiÚ
 
	$compu‹_doms
(
s§
)

294 
Üd”
,
Ïb–
 
š
 
	$aœs
(
s§
.
Üd”
) do

295 
loÿl
 
block
 = 
s§
.
blocks
[
Ïb–
]

296 
block
.
doms
 = {
	}
}

297 
block
.
idom
 
th’


298 
bË
.
	$š£¹
(
s§
.
blocks
[
block
.
idom
].
doms
, 
Ïb–
)

299 
’d


300 
’d


301 
’d


303 
funùiÚ
 
	$cÚv”t_s§
(
ªf
)

304 
loÿl
 
s§
 = 
	`İtimize_s§
(
	$low”
(
ªf
))

305 
	$Üd”_blocks
(
s§
)

306 
	$add_´edeûssÜs
(
s§
)

307 
	$compu‹_idoms
(
s§
)

308 
	$compu‹_doms
(
s§
)

309 
v”bo£
 
th’
 
	$´št_s§
(
s§
è
’d


310  
s§


311 
’d


313 
funùiÚ
 
	$£láe¡
()

314 
	`´št
("selftest:…f.ssa")

315 
loÿl
 
·r£
 = 
	`»quœe
('pf.parse').parse

316 
loÿl
 
ex·nd
 = 
	`»quœe
('pf.expand').expand

317 
loÿl
 
İtimize
 = 
	`»quœe
('pf.optimize').optimize

318 
loÿl
 
cÚv”t_ªf
 = 
	`»quœe
('pf.anf').convert_anf

320 
loÿl
 
funùiÚ
 
	$‹¡
(
ex´
)

321  
	`cÚv”t_s§
(
	`cÚv”t_ªf
(
	`İtimize
(
	`ex·nd
(
	`·r£
(
ex´
), "EN10MB"))))

322 
’d


324 
	`‹¡
("tcp…ort 80 or udp…ort 34")

326 
	`´št
("OK")

327 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/types.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
ffi
 = 
	`»quœe
("ffi")

5 -- 
PCAP
 
fe
 
fÜm©
: 
h‰p
:

6 
ffi
.
cdef
[[

7 
	spÿp_fe
 {

9 
ušt32_t
 
magic_numb”
;

10 
ušt16_t
 
v”siÚ_majÜ
;

11 
ušt16_t
 
v”siÚ_mšÜ
;

12 
št32_t
 
thiszÚe
;

13 
ušt32_t
 
sigfigs
;

14 
ušt32_t
 
¢­Ën
;

15 
ušt32_t
 
ÃtwÜk
;

19 
	spÿp_»cÜd
 {

21 
ušt32_t
 
ts_£c
;

22 
ušt32_t
 
ts_u£c
;

23 
ušt32_t
 
šş_Ën
;

24 
ušt32_t
 
Üig_Ën
;

28 
	spÿp_pkthdr
 {

30 
ts_£c
;

31 
ts_u£c
;

32 
ušt32_t
 
šş_Ën
;

33 
ušt32_t
 
Üig_Ën
;

37 -- 
BPF
 
´og¿m
 
fÜm©
. 
NÙe
: 
the
 
b™
 
moduË
 
»´e£Ás
 
ušt32_t
 
v®ues


38 -- 
w™h
 
the
 
high
-
b™
 
£t
 
as
 
Ãg©ive
 
št32_t
 
v®ues
, 
so
 
we
 dØth
§me


39 -- 
®l
 
of
 
our
 32-
b™
 
v®ues
 
šşudšg
 
the
 "k" 
f›ld
 
š
 
BPF


40 -- 
š¡ruùiÚs
.

41 
ffi
.
cdef
[[

42 
	sbpf_š¢
 { 
ušt16_t
 
code
; 
ušt8_t
 
jt
, 
jf
; 
št32_t
 
k
; };

43 
	sbpf_´og¿m
 { 
ušt32_t
 
bf_Ën
; 
bpf_š¢
 *
bf_š¢s
; };

45 
loÿl
 
bpf_´og¿m_mt
 = {

46 
__Ën
 = 
	`funùiÚ
 (
´og¿m
è…rog¿m.
bf_Ën
 
’d
,

47 
__šdex
 = 
	`funùiÚ
 (
´og¿m
, 
idx
)

48 
	`as£¹
(
idx
 >ğ0 
ªd
 idx < #program)

49  
´og¿m
.
bf_š¢s
[
idx
]

50 
’d


51 
	}
}

53 
	gbpf_š¢
 = 
ffi
.
ty³of
("struct bpf_insn")

54 
bpf_´og¿m
 = 
ffi
.
m‘©y³
("¡ruù bpf_´og¿m", 
bpf_´og¿m_mt
)

55 
	gpÿp_»cÜd
 = 
ffi
.
ty³of
("struct…cap_record")

56 
pÿp_pkthdr
 = 
ffi
.
ty³of
("struct…cap_pkthdr")

58 
funùiÚ
 
	$£láe¡
 ()

59 
	`´št
("selftest: ffi_types")

60 
	`´št
("OK")

61 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/utils.lua

1 
	$moduË
(...,
·ckage
.
£—Î
)

3 
loÿl
 
ffi
 = 
	`»quœe
("ffi")

4 
loÿl
 
C
 = 
ffi
.C

6 
ffi
.
cdef
[[

7 
	spæua_timev®
 {

8 
tv_£c
;

9 
tv_u£c
;

11 
	`g‘timeofday
(
pæua_timev®
 *
tv
, 
timezÚe
 *
tz
);

14 -- 
	$now
(è
»tuºs
 
the
 
cu¼’t
 
time
. 
The
 
fœ¡
im
™
 
is
 
ÿÎed
,he

15 --  
v®ue
 
wl
 
be
 
z”o
. 
This
 
is
 
to
 
´e£rve
 
´ecisiÚ
, 
»g¬dËss


16 -- 
of
 
wh©
 
the
 
cu¼’t
 
•och
 
is
.

17 
loÿl
 
z”o_£c
, 
z”o_u£c


18 
funùiÚ
 
	$now
()

19 
loÿl
 
tv
 = 
ffi
.
	`Ãw
("struct…flua_timeval")

20 
	`as£¹
(
C
.
	`g‘timeofday
(
tv
, 
n
) == 0)

21 
nÙ
 
z”o_£c
 
th’


22 
z”o_£c
 = 
tv
.
tv_£c


23 
z”o_u£c
 = 
tv
.
tv_u£c


24 
’d


25 
loÿl
 
£cs
 = 
	`tÚumb”
(
tv
.
tv_£c
 - 
z”o_£c
)

26 
£cs
 = sec + 
	`tÚumb”
(
tv
.
tv_u£c
 - 
z”o_u£c
) * 1e-6

27  
£cs


28 
’d


30 
funùiÚ
 
	$gmtime
()

31 
loÿl
 
tv
 = 
ffi
.
	`Ãw
("struct…flua_timeval")

32 
	`as£¹
(
C
.
	`g‘timeofday
(
tv
, 
n
) == 0)

33 
loÿl
 
£cs
 = 
	$tÚumb”
(
tv
.
tv_£c
)

34 
£cs
 = sec + 
	`tÚumb”
(
tv
.
tv_u£c
) * 1e-6

35  
£cs


36 
’d


38 
funùiÚ
 
	$£t
(...)

39 
loÿl
 
»t
 = {
	}
}

40 
k
, 
v
 
š
 
·œs
({...}èdØ
	g»t
[v] = 
Œue
 
’d


41  
»t


42 
’d


44 
funùiÚ
 
	$cÚÿt
(
a
, 
b
)

45 
loÿl
 
»t
 = {
	}
}

46 
_
, 
v
 
š
 
	$aœs
(
a
èdØ
bË
.
	$š£¹
(
»t
, 
v
è
’d


47 
_
, 
v
 
š
 
	$aœs
(
b
èdØ
bË
.
	$š£¹
(
»t
, 
v
è
’d


48  
»t


49 
’d


51 
funùiÚ
 
	$dup
(
bË
)

52 
loÿl
 
»t
 = {
	}
}

53 
k
, 
v
 
š
 
	$·œs
(
bË
èdØ
»t
[
k
] = 
v
 
’d


54  
»t


55 
’d


57 
funùiÚ
 
	$equ®s
(
ex³ùed
, 
aùu®
)

58 
	`ty³
(
ex³ùed
è~ğ
	$ty³
(
aùu®
è
th’
  
çl£
 
’d


59 
	`ty³
(
ex³ùed
è=ğ'bË' 
th’


60 
k
, 
v
 
š
 
	$·œs
(
ex³ùed
) do

61 
nÙ
 
	$equ®s
(
v
, 
aùu®
[
k
]è
th’
  
çl£
 
’d


62 
’d


63 
k
, 
_
 
š
 
	$·œs
(
aùu®
) do

64 
ex³ùed
[
k
] =ğ
n
 
th’
  
çl£
 
’d


65 
’d


66  
Œue


68  
ex³ùed
 =ğ
aùu®


69 
’d


70 
’d


72 
funùiÚ
 
	$is_¬¿y
(
x
)

73 
	`ty³
(
x
è~ğ'bË' 
th’
  
çl£
 
’d


74 #x =ğ0 
th’
  
çl£
 
’d


75 
k
,
v
 
š
 
	$·œs
(
x
) do

76 
	`ty³
(
k
è~ğ'numb”' 
th’
  
çl£
 
’d


77 -- 
Re¡riù
 
to
 32-
b™
 
š‹g”
 
keys
.

78 
k
 < 0 
Ü
 k >ğ2^32 
th’
  
çl£
 
’d


79 -- 
A¼ay
 
šdiûs
 
¬e
 
š‹g”s
.

80 
k
 - 
m©h
.
	`æoÜ
(kè~ğ0 
th’
  
çl£
 
’d


81 -- 
Neg©ive
 
z”o
 
is
 
nÙ
 
a
 
v®id
 
¬¿y
 
šdex
.

82 1 / 
k
 < 0 
th’
  
çl£
 
’d


83 
’d


84  
Œue


85 
’d


87 
funùiÚ
 
	$µ
(
ex´
, 
šd’t
, 
suffix
)

88 
šd’t
 = ind’ˆ
Ü
 ''

89 
suffix
 = suffix 
Ü
 ''

90 
	`ty³
(
ex´
è=ğ'numb”' 
th’


91 
	$´št
(
šd’t
..
ex´
..
suffix
)

92 
–£if
 
	`ty³
(
ex´
è=ğ'¡ršg' 
th’


93 
	`´št
(
šd’t
..'"'..
ex´
..'"'..
suffix
)

94 
–£if
 
	`ty³
(
ex´
è=ğ'boŞ—n' 
th’


95 
	`´št
(
šd’t
..(
ex´
 
ªd
 'Œue' 
Ü
 'çl£')..
suffix
)

96 
–£if
 
	$is_¬¿y
(
ex´
è
th’


97 
	`as£¹
(#expr > 0)

98 #ex´ =ğ1 
th’


99 
	`ty³
(
ex´
[1]è=ğ'bË' 
th’


100 
	`´št
(
šd’t
..'{')

101 
	`µ
(
ex´
[1], 
šd’t
..' ', ' }'..
suffix
)

103 
	`´št
(
šd’t
..'{ "'..
ex´
[1]..'" }'..
suffix
)

104 
’d


106 
	`ty³
(
ex´
[1]è=ğ'bË' 
th’


107 
	`´št
(
šd’t
..'{')

108 
	`µ
(
ex´
[1], 
šd’t
..' ', ',')

110 
	`´št
(
šd’t
..'{ "'..
ex´
[1]..'",')

111 
’d


112 
šd’t
 = indent..' '

113 
i
=2,#ex´-1 dØ
	`µ
(
ex´
[i], 
šd’t
, ','è
’d


114 
	`µ
(
ex´
[#ex´], 
šd’t
, ' }'..
suffix
)

115 
’d


116 
–£if
 
	`ty³
(
ex´
è=ğ'bË' 
th’


117 #ex´ =ğ0 
th’


118 
	`´št
(
šd’t
 .. '{}')

120 
	`”rÜ
('unimplemented')

121 
’d


123 
	`”rÜ
("unsuµÜ‹dy³ "..
	$ty³
(
ex´
))

124 
’d


125  
ex´


126 
’d


128 
funùiÚ
 
	$as£¹_equ®s
(
ex³ùed
, 
aùu®
)

129 
nÙ
 
	$equ®s
(
ex³ùed
, 
aùu®
è
th’


130 
	$µ
(
ex³ùed
)

131 
	$µ
(
aùu®
)

132 
	`”rÜ
('notƒqual')

133 
’d


134 
’d


136 -- 
CÚ¡ruù
 
ušt32
 
äom
 
où‘s
 
a
, 
b
, 
c
, 
d
;‡ 
is
 
mo¡
 
signifiÿÁ
.

137 
funùiÚ
 
	$ušt32
(
a
, 
b
, 
c
, 
d
)

138  
a
 * 2^24 + 
b
 * 2^16 + 
c
 * 2^8 + 
d


139 
’d


141 -- 
CÚ¡ruù
 
ušt16
 
äom
 
où‘s
 
a
, 
b
;‡ 
is
 
mo¡
 
signifiÿÁ
.

142 
funùiÚ
 
	$ušt16
(
a
, 
b
)

143  
a
 * 2^8 + 
b


144 
’d


146 
funùiÚ
 
	$v4_to_št
(
addr
)

147 
	`as£¹
(
addr
[1] == 'ipv4', "Not‡n IPV4‡ddress")

148  
	$ušt32
(
addr
[2],‡ddr[3],‡ddr[4],‡ddr[5])

149 
’d


151 
funùiÚ
 
	$v6_as_4x32
(
addr
)

152 
loÿl
 
funùiÚ
 
	$c
(
i
, 
j
è 
addr
[i] * 2^16 +‡ddr[j] 
’d


153  { 
	`c
(2,3), c(4,5), c(6,7), c(8,9è
	}
}

154 
’d


156 
funùiÚ
 
	$fixpošt
(
f
, 
ex´
)

157 
loÿl
 
´ev


158 
»³©
 
ex´
, 
´ev
 = 
	`f
Óx´),ƒx´ 
uÁ
 
	$equ®s
(
ex´
, 
´ev
)

159  
ex´


160 
’d


162 
funùiÚ
 
	$choo£
(
choiûs
)

163 
loÿl
 
idx
 = 
m©h
.
	`¿ndom
(#choices)

164  
choiûs
[
idx
]

165 
’d


167 
funùiÚ
 
	$choo£_w™h_šdex
(
choiûs
)

168 
loÿl
 
idx
 = 
m©h
.
	`¿ndom
(#choices)

169  
choiûs
[
idx
], idx

170 
’d


172 
funùiÚ
 
	$·r£_İts
(
İts
, 
deçuÉs
)

173 
loÿl
 
»t
 = {
	}
}

174 
k
, 
v
 
š
 
	$·œs
(
İts
) do

175 
deçuÉs
[
k
] =ğ
n
 
th’
 
	`”rÜ
('uÄecognized o±iÚ ' .. kè
’d


176 
»t
[
k
] = 
v


177 
’d


178 
k
, 
v
 
š
 
	$·œs
(
deçuÉs
) do

179 
»t
[
k
] =ğ
n
 
th’
„‘[k] = 
v
 
’d


180 
’d


181  
»t


182 
’d


184 
funùiÚ
 
	$bË_v®ues_®l_equ®
(
t
)

185 
loÿl
 
v®


186 
_
, 
v
 
š
 
	$·œs
(
t
) do

187 
v®
 =ğ
n
 
th’
 v® = 
v
 
’d


188 
v
 ~ğ
v®
 
th’
  
çl£
 
’d


189 
’d


190  
Œue
, 
v®


191 
’d


193 
funùiÚ
 
	$£láe¡
 ()

194 
	`´št
("selftest:…f.utils")

195 
loÿl
 
b
 = { 1, 2, 3 
	}
}

196 
as£¹
(
b
 ~ğ
	$dup
(
b
))

197 
	`as£¹_equ®s
(
b
, 
	$dup
(
b
))

198 
	`as£¹_equ®s
({ 1, 2, 3, 1, 2, 3 
	}
}, 
	$cÚÿt
(
b
,ab))

199 
	`as£¹_equ®s
(
	`£t
(3, 2, 1), 
	$£t
(1, 2, 3))

200 
nÙ
 
z”o_£c
 
th’
 
	`as£¹_equ®s
(
	`now
(), 0è
’d


201 
	`as£¹
(
	`now
() > 0)

202 
	`as£¹_equ®s
(
	`v4_to_št
({'v4', 255, 0, 0, 0
	}
}), 0xff000000)

203 
loÿl
 
	ggu1
 = 
	$gmtime
()

204 
loÿl
 
gu2
 = 
	$gmtime
()

205 
	$as£¹
(
gu1
, 
gu2
)

206 
	`´št
("OK")

207 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall.lua

1 -- 
this
 
puts
 
ev”ythšg
 
što
 
Úe
 
bË
 
»ady
 
to
 
u£


3 
loÿl
 
	g»quœe
, 
	g´št
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
	gm©h
 =

6 
»quœe
, 
	g´št
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
m©h


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
abi
.
rump
 
ªd
‡bi.
ty³s
 
th’
‡bi.
os
 =‡bi.ty³ 
’d
 -- 
´‘’d
 
to
 
be
 
N‘BSD
 
nÜm®
„ump, 
Lšux
 
rum¶šux


14 
	gabi
.
	gos
 =ğ"Ãtbsd" 
th’


15 -- 
TODO
 
m”ge


16 
»quœe
("syscall.netbsd.ffitypes")

17 
nÙ
 
abi
.
rump
 
th’


18 
»quœe
("syscall.netbsd.ffifunctions")

19 
’d


21 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".ffi")

22 
’d


24 
loÿl
 
c
 = 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".constants")

26 
loÿl
 
o¡y³s
 = 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".types")

27 
loÿl
 
bsdty³s


28 ià(
abi
.
rump
 
ªd
‡bi.
ty³s
 =ğ"Ãtbsd"è
	$Ü
 (
nÙ
 
abi
.
rump
 
ªd
‡bi.
bsd
è
th’


29 
bsdty³s
 = 
	`»quœe
("syscall.bsd.types")

30 
’d


31 
loÿl
 
ty³s
 = 
»quœe
 "sysÿÎ.ty³s".
	$š™
(
c
, 
o¡y³s
, 
bsdty³s
)

33 
loÿl
 
C


34 
abi
.
rump
 
th’
 -- 
TODO
 
m”ge
 
the£
 
w™h
 
cÚd™iÚ®s


35 
C
 = 
	`»quœe
("syscall.rump.c")

37 
C
 = 
	`»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".c")

38 
’d


40 -- 
ÿÂÙ
 
put
 
š
 
S
, 
Ãeded
 
‹¡s
, cªnÙ 
be
…uˆš 
c
 
—¾›r
 
due
 
to
 
d•s
 
TODO
 
»move
 
£e
 #94

41 
c
.
IOCTL
 = 
	`»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".ioùl").
	$š™
(
ty³s
)

43 
loÿl
 
S
 = 
»quœe
 "sysÿÎ.sysÿÎs".
	$š™
(
C
, 
c
, 
ty³s
)

45 
S
.
abi
, S.
ty³s
, S.
t
, S.
c
 =‡bi,y³s,y³s.t, c -- 
add
 
to
 
maš
 
bË
 
»tuºed


47 -- 
add
 
com·tib™y
 
code


48 
S
 = 
»quœe
 "sysÿÎ.com·t".
	`š™
(S)

50 -- 
add
 
funùiÚs
 
äom
 
libc


51 
S
 = 
»quœe
 "sysÿÎ.libc".
	`š™
(S)

53 -- 
add
 
m‘hods


54 
S
 = 
»quœe
 "sysÿÎ.m‘hods".
	`š™
(S)

56 -- 
add
 
uts


57 
S
.
ut
 = 
»quœe
 "sysÿÎ.ut".
	$š™
(
S
)

59 
abi
.
os
 =ğ"lšux" 
th’


60 
S
.
cgroup
 = 
»quœe
 "sysÿÎ.lšux.cgroup".
	$š™
(
S
)

61 
S
.
Æ
 = 
»quœe
 "sysÿÎ.lšux.Æ".
	`š™
(S)

62 -- 
TODO
 
add
 
the
 
Ùh”
 
Lšux
 
¥ecific
 
moduËs
 
h”e


63 
’d


65 
S
.
_VERSION
 = "v0.11pre"

66 
S
.
_DESCRIPTION
 = "ljsyscall: A Unix system call API for LuaJIT"

67 
S
.
_COPYRIGHT
 = "Copyright (C) 2011-2014 Justin Cormack. MIT†icensed."

69  
S


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/abi.lua

1 -- 
This
 
sim¶y
 
»tuºs
 
ABI
 
	gšfÜm©iÚ


2 -- 
Makes
 
™
 
—s›r
 
to
 
sub¡™u‹
 
	gnÚ
-
ffi
 
	gsŞutiÚ
, 
eg
Ø
run
 
‹¡s


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

13 
loÿl
 
funùiÚ
 
	$šlibc_â
(
k
è 
ffi
.
C
[k] 
’d


15 
loÿl
 
abi
 = {

16 
¬ch
 = 
ffi
.¬ch, -- 
µc
, 
x86
, 
¬m
, 
x64
, 
ms


17 
abi32
 = 
ffi
.
	`abi
("32b™"), -- 
boŞ—n


18 
abi64
 = 
ffi
.
	`abi
("64b™"), -- 
boŞ—n


19 
Ë
 = 
ffi
.
	`abi
("Ë"), -- 
boŞ—n


20 
be
 = 
ffi
.
	`abi
("be"), -- 
boŞ—n


21 
os
 = 
ffi
.os:
	`low”
(), -- 
bsd
, 
osx
, 
lšux


22 
	}
}

24 -- 
Makes
 
no
 
difã»nû
 
to
 
us
 
I
 
b–›ve


25 
	gabi
.
	g¬ch
 =ğ"µc¥e" 
th’
 
abi
.
¬ch
 = "µc" 
’d


27 
abi
.
¬ch
 =ğ"¬m" 
ªd
 
nÙ
 
ffi
.abi("—bi"è
th’
 
”rÜ
("Úly suµÜˆ—b˜fÜ‡rm"è
’d


29 ià(
abi
.
¬ch
 =ğ"ms" 
Ü
‡bi.¬ch =ğ"m£l"è
th’
‡bi.
m§bi
 = "o32" 
’d
 -- 
Úly
 
Úe
 
suµÜ‹d
 
now


31 
abi
.
os
 =ğ"bsd" 
Ü
‡bi.o =ğ"osx" 
th’
‡bi.
bsd
 = 
Œue
 
’d
 -- 
some
 
sh¬ed
 
BSD
 
funùiÚ®™y


33 -- 
X’
 
g’”®ly
 
behaves
 
like
 
N‘BSD
, 
but
 
our
 
‹¡s
 
Ãed
 
to
 dØ
	grump
-lik
	g£tup
; 
b™
 
of
 
a
 
hack


34 
	gffi
.
	gcdef
[[

35 
__ljsysÿÎ_und”_x’
;

37 
pÿÎ
(
šlibc_â
, "__ljsysÿÎ_und”_x’"è
th’
 
	gabi
.
	gx’
 = 
Œue
 
’d


39 -- 
BSD
 
d‘eùiÚ


40 -- 
O³nBSD
 
dÛ¢
't have sysctlbyname

41 -- 
The
 
good
 
Ãws
 
is
 
ev”y
 
BSD
 
has
 
ut¢ame


42 -- 
The
 
bad
 
Ãws
 
is
 
th©
 
Ú
 
F»eBSD
 
™
 i 
a
 
Ëgacy
 
v”siÚ
h© 
has
 32 
by‹
 
uÆess
 
you
 
u£
 
__xuÇme


43 -- 
fÜtuÇ‹ly
 
sy¢ame
 
is
 
fœ¡
 
so
 
we
 
ÿn
 
u£
 
this
 
v®ue


44 
nÙ
 
abi
.
x’
 
ªd
‚Ù‡bi.
rump
‡nd‡bi.
os
 =ğ"bsd" 
th’


45 
ffi
.
cdef
 [[

46 
	s_ut¢ame
 {

47 
sy¢ame
[256];

48 
	mnod’ame
[256];

49 
	m»Ëa£
[256];

50 
	mv”siÚ
[256];

51 
	mmachše
[256];

53 
uÇme
(
_ut¢ame
 *);

55 
loÿl
 
	guÇme
 = 
ffi
.
Ãw
("struct _utsname")

56 
ffi
.
C
.
	$uÇme
(
uÇme
)

57 
abi
.
os
 = 
ffi
.
	$¡ršg
(
uÇme
.
sy¢ame
):
	$low”
()

58 
abi
.
uÇme
 = uname

59 
’d


61 -- 
rump
 
·¿ms


62 
abi
.
ho¡
 =‡bi.
os
 -- 
»®
 
OS
, 
u£d
 
rump
 
©
 
´e£Á
 
may
 
chªge
 
this


63 
abi
.
ty³s
 = "Ãtbsd" -- 
you
 
ÿn
 
£t
 
to
 
lšux
, 
Ü
 
	$mÚkey·tch
 (
£e
 
‹¡s
è
to
 
u£
 
Lšux
 
ty³s


65  
abi


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bit.lua

1 -- 
ab¡¿ù
 
difã»Á
 
b™
 
lib¿r›s
 
š
 difã»Á 
lua
 
v”siÚs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg


10 -- 
TODO
 
	gadd
 64 
b™
 
İ”©iÚs
 
h”e


12 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

14 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

16 
loÿl
 
ok
, 
b™


18 
	gok
, 
	gb™
 = 
pÿÎ
(
»quœe
, "bit")

20 
nÙ
 
ok
 
th’


21 
	gok
, 
	gb™
 = 
pÿÎ
(
»quœe
, "bit32")

23 
loÿl
 
	gšt32
 = 
ffi
.
ty³of
("int32_t")

25 
nÙ
 
ok
 
th’
 
”rÜ
("nØsu™abË b™†ib¿ry found"è
’d


27 -- 
fixups
 
to
 
make
 
com·tibË
 
w™h
 
luaj™


28 
b™
.
tob™
 = 
	$funùiÚ
(
x
è 
	`tÚumb”
(
	$št32
(
x
)è
’d


29 
b™
.
bsw­
 = 
	$funùiÚ
(
x
)

30  
b™
.
	`bÜ
(b™.
	`lshiá
(b™.
	`exŒaù
(
x
, 0, 8), 24),

31 
b™
.
	`lshiá
(b™.
	`exŒaù
(
x
, 8, 8), 16),

32 
b™
.
	`lshiá
(b™.
	`exŒaù
(
x
, 16, 8), 8),

33 
b™
.
	$exŒaù
(
x
, 24, 8))

34 
’d


35 
’d


37 -- 64 
to
 32 
b™
 
cÚv”siÚs
 
vŸ
 
uniÚs
 
TODO
 
u£
 
m‘h
 
nÙ
 
objeù
? 
tidy
 
up


38 
loÿl
 
mt


39 
abi
.
Ë
 
th’


40 
mt
 = {

41 
__šdex
 = {

42 
to32
 = 
	`funùiÚ
(
u
è u.
i32
[1], u.i32[0] 
’d
,

43 
äom32
 = 
	`funùiÚ
(
u
, 
a
, 
b
èu.
i32
[1], u.i32[0] =‡, b 
’d
,

45 
	}
}

47 
	gmt
 = {

48 
__šdex
 = {

49 
to32
 = 
funùiÚ
(
u
è u.
i32
[0], 
	gu
.
	gi32
[1] 
	g’d
,

50 
	gäom32
 = 
funùiÚ
(
u
, 
a
, 
b
è
	gu
.
	gi32
[0], u.i32[1] =‡, b 
	g’d
,

53 
’d


55 
	gmt
.
	g__Ãw
 = 
	$funùiÚ
(

, 
x
)

56 
loÿl
 
n
 = 
ffi
.
	$Ãw
(

)

57 
n
.
i64
 = 
x
 
Ü
 0

58  
n


59 
’d


61 
loÿl
 
i6432
 = 
ffi
.
	`m‘©y³
("uniÚ {št64_ˆi64; iÁ32_ˆi32[2];}", 
mt
)

62 
loÿl
 
u6432
 = 
ffi
.
	`m‘©y³
("uniÚ {ušt64_ˆi64; ušt32_ˆi32[2];}", 
mt
)

64 
b™
.
i6432
 = 
	$funùiÚ
(
x
è 
	$i6432
(
x
):
	$to32
(è
’d


65 
b™
.
u6432
 = 
	$funùiÚ
(
x
è 
	$u6432
(
x
):
	$to32
(è
’d


67 -- 
š™Ÿl
 64 
b™
 
İs
. 
TODO
 
luaj™
 2.1 
the£
 
¬e
 
nÙ
 
Ãeded
, 
as
 
acû±s
 64 b™ 
cd©a


68 
funùiÚ
 
b™
.
	$bÜ64
(
a
, 
b
, ...)

69 
loÿl
 
¯
, 
bb
, 
cc
 = 
	`i6432
(
a
), i6432(
b
), 
	$i6432
()

70 
cc
.
i32
[0], cc.i32[1] = 
b™
.
	`bÜ
(
¯
.i32[0], 
bb
.i32[0]), b™.
	$bÜ
(
¯
.
i32
[1], 
bb
.i32[1])

71 
	`£Ëù
('#', ...è> 0 
th’
  
b™
.
	$bÜ64
(
cc
.
i64
, ...è
’d


72  
cc
.
i64


73 
’d


75 
funùiÚ
 
b™
.
	$bªd64
(
a
, 
b
, ...)

76 
loÿl
 
¯
, 
bb
, 
cc
 = 
	`i6432
(
a
), i6432(
b
), 
	$i6432
()

77 
cc
.
i32
[0], cc.i32[1] = 
b™
.
	`bªd
(
¯
.i32[0], 
bb
.i32[0]), b™.
	$bªd
(
¯
.
i32
[1], 
bb
.i32[1])

78 
	`£Ëù
('#', ...è> 0 
th’
  
b™
.
	$bªd64
(
cc
.
i64
, ...è
’d


79  
cc
.
i64


80 
’d


82 
funùiÚ
 
b™
.
	$lshiá64
(
a
, 
n
)

83 
n
 =ğ0 
th’
  
a
 
’d


84 
loÿl
 
¯
, 
bb
 = 
	`i6432
(
a
), 
	$i6432
(0)

85 
loÿl
 
ah
, 
®
 = 
¯
:
	$to32
()

86 
loÿl
 
bl
, 
bh
 = 0, 0

87 
n
 < 32 
th’


88 
bh
, 
bl
 = 
b™
.
	`lshiá
(
ah
, 
n
), b™.
	$lshiá
(
®
, 
n
)

89 
bh
 = 
b™
.
	`bÜ
(bh, b™.
	`rshiá
(
®
, 32 - 
n
))

91 
bh
, 
bl
 = 
b™
.
	`lshiá
(
®
, 
n
 - 32), 0

92 
’d


93 
bb
:
	$äom32
(
bh
, 
bl
)

94  
bb
.
i64


95 
’d


97 
funùiÚ
 
b™
.
	$rshiá64
(
a
, 
n
)

98 
n
 =ğ0 
th’
  
a
 
’d


99 
loÿl
 
¯
, 
bb
 = 
	`i6432
(
a
), 
	$i6432
(0)

100 
loÿl
 
ah
, 
®
 = 
¯
:
	$to32
()

101 
loÿl
 
bl
, 
bh
 = 0, 0

102 
n
 < 32 
th’


103 
bh
, 
bl
 = 
b™
.
	`rshiá
(
ah
, 
n
), b™.
	$rshiá
(
®
, 
n
)

104 
bl
 = 
b™
.
	`bÜ
(bl, b™.
	`lshiá
(
ah
, 32 - 
n
))

106 
bh
, 
bl
 = 0, 
b™
.
	`rshiá
(
ah
, 
n
 - 32)

107 
’d


108 
bb
:
	$äom32
(
bh
, 
bl
)

109  
bb
.
i64


110 
’d


112  
b™


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bsd/ffi.lua

1 -- 
defše
 
g’”®
 
BSD
 
sy¡em
 
ÿÎs
 
	gffi


3 -- 
nÙe
 
th©
 
some
 
funùiÚs
 
may
 
nÙ
 
be
 
avaabË
 
š
 
	g®l
, 
but
 
so
 
as
 
´ÙÙy³
 
is
 
¡ªd¬d
 
they
 
ÿn
 
go
 
h”e


5 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

6 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

7 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

8 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

9 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

10 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


12 
loÿl
 
	gcdef
 = 
»quœe
 "ffi".
cdef


14 -- 
¡ªd¬d
 
Posix


15 
cdef
[[

16 
İ’
(cÚ¡ *
·thÇme
, 
æags
, 
mode_t
 
mode
);

17 
şo£
(
fd
);

18 
chdœ
(cÚ¡ *
·th
);

19 
fchdœ
(
fd
);

20 
mkdœ
(cÚ¡ *
·thÇme
, 
mode_t
 
mode
);

21 
rmdœ
(cÚ¡ *
·thÇme
);

22 
uÆšk
(cÚ¡ *
·thÇme
);

23 
»Çme
(cÚ¡ *
Şd·th
, cÚ¡ *
Ãw·th
);

24 
chmod
(cÚ¡ *
·th
, 
mode_t
 
mode
);

25 
fchmod
(
fd
, 
mode_t
 
mode
);

26 
chown
(cÚ¡ *
·th
, 
uid_t
 
owÃr
, 
gid_t
 
group
);

27 
fchown
(
fd
, 
uid_t
 
owÃr
, 
gid_t
 
group
);

28 
lchown
(cÚ¡ *
·th
, 
uid_t
 
owÃr
, 
gid_t
 
group
);

29 
lšk
(cÚ¡ *
Şd·th
, cÚ¡ *
Ãw·th
);

30 
lšk©
(
Şddœfd
, cÚ¡ *
Şd·th
, 
Ãwdœfd
, cÚ¡ *
Ãw·th
, 
æags
);

31 
symlšk
(cÚ¡ *
Şd·th
, cÚ¡ *
Ãw·th
);

32 
chroÙ
(cÚ¡ *
·th
);

33 
mode_t
 
umask
(mode_ˆ
mask
);

34 
sync
();

35 
mknod
(cÚ¡ *
·thÇme
, 
mode_t
 
mode
, 
dev_t
 
dev
);

36 
mkfifo
(cÚ¡ *
·th
, 
mode_t
 
mode
);

37 
ssize_t
 
»ad
(
fd
, *
buf
, 
size_t
 
couÁ
);

38 
ssize_t
 
»adv
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
);

39 
ssize_t
 
wr™e
(
fd
, cÚ¡ *
buf
, 
size_t
 
couÁ
);

40 
ssize_t
 
wr™ev
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
);

41 
ssize_t
 
´—d
(
fd
, *
buf
, 
size_t
 
couÁ
, 
off_t
 
off£t
);

42 
ssize_t
 
pwr™e
(
fd
, cÚ¡ *
buf
, 
size_t
 
couÁ
, 
off_t
 
off£t
);

43 
ssize_t
 
´—dv
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
, 
off_t
 
off£t
);

44 
ssize_t
 
pwr™ev
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
, 
off_t
 
off£t
);

45 
acûss
(cÚ¡ *
·thÇme
, 
mode
);

46 
off_t
 
l£ek
(
fd
, off_ˆ
off£t
, 
wh’û
);

47 
ssize_t
 
»adlšk
(cÚ¡ *
·th
, *
buf
, 
size_t
 
bufsiz
);

48 
fsync
(
fd
);

49 
fd©async
(
fd
);

50 
fú
(
fd
, 
cmd
, *
¬g
);

51 
¡©
(cÚ¡ *
·th
, ¡© *
sb
);

52 
l¡©
(cÚ¡ *
·th
, 
¡©
 *
sb
);

53 
f¡©
(
fd
, 
¡©
 *
sb
);

54 
Œunÿ‹
(cÚ¡ *
·th
, 
off_t
 
Ëngth
);

55 
árunÿ‹
(
fd
, 
off_t
 
Ëngth
);

56 
shm_İ’
(cÚ¡ *
·thÇme
, 
æags
, 
mode_t
 
mode
);

57 
shm_uÆšk
(cÚ¡ *
Çme
);

58 
æock
(
fd
, 
İ”©iÚ
);

60 
sock‘
(
domaš
, 
ty³
, 
´ÙocŞ
);

61 
sock‘·œ
(
domaš
, 
ty³
, 
´ÙocŞ
, 
sv
[2]);

62 
pe2
(
pefd
[2], 
æags
);

63 
dup
(
Şdfd
);

64 
dup2
(
Şdfd
, 
Ãwfd
);

65 
dup3
(
Şdfd
, 
Ãwfd
, 
æags
);

67 
ssize_t
 
»cv
(
sockfd
, *
buf
, 
size_t
 
Ën
, 
æags
);

68 
ssize_t
 
£nd
(
sockfd
, cÚ¡ *
buf
, 
size_t
 
Ën
, 
æags
);

69 
ssize_t
 
£ndto
(
sockfd
, cÚ¡ *
buf
, 
size_t
 
Ën
, 
æags
, cÚ¡ 
sockaddr
 *
de¡_addr
, 
sockËn_t
 
add¾’
);

70 
ssize_t
 
»cväom
(
sockfd
, *
buf
, 
size_t
 
Ën
, 
æags
, 
sockaddr
 *
¤c_addr
, 
sockËn_t
 *
add¾’
);

71 
ssize_t
 
£ndmsg
(
sockfd
, cÚ¡ 
msghdr
 *
msg
, 
æags
);

72 
ssize_t
 
»cvmsg
(
sockfd
, 
msghdr
 *
msg
, 
æags
);

73 
g‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, *
İtv®
, 
sockËn_t
 *
İ’
);

74 
£tsockİt
(
sockfd
, 
Ëv–
, 
İŠame
, cÚ¡ *
İtv®
, 
sockËn_t
 
İ’
);

75 
bšd
(
sockfd
, cÚ¡ 
sockaddr
 *
addr
, 
sockËn_t
 
add¾’
);

76 
li¡’
(
sockfd
, 
backlog
);

77 
cÚÃù
(
sockfd
, cÚ¡ 
sockaddr
 *
addr
, 
sockËn_t
 
add¾’
);

78 
acû±
(
sockfd
, 
sockaddr
 *
addr
, 
sockËn_t
 *
add¾’
);

79 
acû±4
(
sockfd
, *
addr
, 
sockËn_t
 *
add¾’
, 
æags
);

80 
g‘sockÇme
(
sockfd
, 
sockaddr
 *
addr
, 
sockËn_t
 *
add¾’
);

81 
g‘³”Çme
(
sockfd
, 
sockaddr
 *
addr
, 
sockËn_t
 *
add¾’
);

82 
shutdown
(
sockfd
, 
how
);

83 
pe
(
pefd
[2]);

84 
£Ëù
(
nfds
, 
fd_£t
 *
»adfds
, fd_£ˆ*
wr™efds
, fd_£ˆ*
exû±fds
, 
timev®
 *
timeout
);

85 
pŞl
(
pŞlfd
 *
fds
, 
nfds_t
 
nfds
, 
timeout
);

86 
p£Ëù
(
nfds
, 
fd_£t
 *
»adfds
, fd_£ˆ*
wr™efds
, fd_£ˆ*
exû±fds
, cÚ¡ 
time¥ec
 *
timeout
, cÚ¡ 
sig£t_t
 *
sigmask
);

87 
Çno¦“p
(cÚ¡ 
time¥ec
 *
»q
, time¥eø*
»m
);

88 
g‘ru§ge
(
who
, 
ru§ge
 *
u§ge
);

89 
g‘´iÜ™y
(
which
, 
who
);

90 
£riÜ™y
(
which
, 
who
, 
´io
);

91 
£ndmmsg
(
sockfd
, 
mmsghdr
 *
msgvec
, 
vËn
, 
æags
);

92 
»cvmmsg
(
sockfd
, 
mmsghdr
 *
msgvec
, 
vËn
, 
æags
, 
time¥ec
 *
timeout
);

94 
uid_t
 
g‘uid
();

95 
uid_t
 
g‘euid
();

96 
pid_t
 
g‘pid
();

97 
pid_t
 
g‘µid
();

98 
gid_t
 
g‘gid
();

99 
gid_t
 
g‘egid
();

100 
£tuid
(
uid_t
 
uid
);

101 
£tgid
(
gid_t
 
gid
);

102 
£‹uid
(
uid_t
 
euid
);

103 
£‹gid
(
gid_t
 
egid
);

104 
pid_t
 
g‘sid
Õid_ˆ
pid
);

105 
pid_t
 
£tsid
();

106 
£gid
(
pid_t
 
pid
,…id_ˆ
pgid
);

107 
pid_t
 
g‘pgid
Õid_ˆ
pid
);

108 
pid_t
 
g‘pg½
();

110 
pid_t
 
fÜk
();

111 
execve
(cÚ¡ *
f’ame
, cÚ¡ *
¬gv
[], cÚ¡ *
’vp
[]);

112 
ex™
(
¡©us
);

113 
_ex™
(
¡©us
);

114 
sigaùiÚ
(
signum
, cÚ¡ sigaùiÚ *
aù
, sigaùiÚ *
Şdaù
);

115 
sig´ocmask
(
how
, cÚ¡ 
sig£t_t
 *
£t
, sig£t_ˆ*
Şd£t
);

116 
sig³ndšg
(
sig£t_t
 *
£t
);

117 
sigsu¥’d
(cÚ¡ 
sig£t_t
 *
mask
);

118 
kl
(
pid_t
 
pid
, 
sig
);

120 
g‘groups
(
size
, 
gid_t
 
li¡
[]);

121 
£tgroups
(
size_t
 
size
, cÚ¡ 
gid_t
 *
li¡
);

123 
g‘timeofday
(
timev®
 *
tv
, *
tz
);

124 
£‰imeofday
(cÚ¡ 
timev®
 *
tv
, cÚ¡ *
tz
);

125 
g‘™im”
(
which
, 
™im”v®
 *
cu¼_v®ue
);

126 
£t™im”
(
which
, cÚ¡ 
™im”v®
 *
Ãw_v®ue
, ™im”v® *
Şd_v®ue
);

128 
acù
(cÚ¡ *
f’ame
);

130 *
mm­
(*
addr
, 
size_t
 
Ëngth
, 
´Ù
, 
æags
, 
fd
, 
off_t
 
off£t
);

131 
munm­
(*
addr
, 
size_t
 
Ëngth
);

132 
msync
(*
addr
, 
size_t
 
Ëngth
, 
æags
);

133 
madvi£
(*
addr
, 
size_t
 
Ëngth
, 
adviû
);

134 
mlock
(cÚ¡ *
addr
, 
size_t
 
Ën
);

135 
muÆock
(cÚ¡ *
addr
, 
size_t
 
Ën
);

136 
mlock®l
(
æags
);

137 
muÆock®l
();

139 
İ’©
(
dœfd
, cÚ¡ *
·thÇme
, 
æags
, 
mode_t
 
mode
);

140 
mkdœ©
(
dœfd
, cÚ¡ *
·thÇme
, 
mode_t
 
mode
);

141 
uÆšk©
(
dœfd
, cÚ¡ *
·thÇme
, 
æags
);

142 
»Çm—t
(
Şddœfd
, cÚ¡ *
Şd·th
, 
Ãwdœfd
, cÚ¡ *
Ãw·th
);

143 
fchowÇt
(
dœfd
, cÚ¡ *
·thÇme
, 
uid_t
 
owÃr
, 
gid_t
 
group
, 
æags
);

144 
symlšk©
(cÚ¡ *
Şd·th
, 
Ãwdœfd
, cÚ¡ *
Ãw·th
);

145 
mknod©
(
dœfd
, cÚ¡ *
·thÇme
, 
mode_t
 
mode
, 
dev_t
 
dev
);

146 
mkfifßt
(
dœfd
, cÚ¡ *
·thÇme
, 
mode_t
 
mode
);

147 
fchmod©
(
dœfd
, cÚ¡ *
·thÇme
, 
mode_t
 
mode
, 
æags
);

148 
»adlšk©
(
dœfd
, cÚ¡ *
·thÇme
, *
buf
, 
size_t
 
bufsiz
);

149 
çcûs§t
(
dœfd
, cÚ¡ *
·thÇme
, 
mode
, 
æags
);

151 
futim’s
(
fd
, cÚ¡ 
time¥ec
 
times
[2]);

152 
utim’§t
(
dœfd
, cÚ¡ *
·thÇme
, cÚ¡ 
time¥ec
 
times
[2], 
æags
);

154 
lchmod
(cÚ¡ *
·th
, 
mode_t
 
mode
);

155 
fchroÙ
(
fd
);

156 
utimes
(cÚ¡ *
f’ame
, cÚ¡ 
timev®
 
times
[2]);

157 
futimes
(, cÚ¡ 
timev®
 
times
[2]);

158 
lutimes
(cÚ¡ *
f’ame
, cÚ¡ 
timev®
 
times
[2]);

159 
pid_t
 
wa™4
Õid_ˆ
wpid
, *
¡©us
, 
İtiÚs
, 
ru§ge
 *rusage);

160 
posix_İ’±
(
oæag
);

162 
şock_g‘»s
(
şockid_t
 
şk_id
, 
time¥ec
 *
»s
);

163 
şock_g‘time
(
şockid_t
 
şk_id
, 
time¥ec
 *

);

164 
şock_£‰ime
(
şockid_t
 
şk_id
, cÚ¡ 
time¥ec
 *

);

165 
şock_Çno¦“p
(
şockid_t
 
şock_id
, 
æags
, cÚ¡ 
time¥ec
 *
»que¡
, time¥eø*
»maš
);

167 
g‘·gesize
();

169 
tim”_ü—‹
(
şockid_t
 
şockid
, 
sigev’t
 *
£vp
, 
tim”_t
 *
tim”id
);

170 
tim”_£‰ime
(
tim”_t
 
tim”id
, 
æags
, cÚ¡ 
™im”¥ec
 *
Ãw_v®ue
, ™im”¥eø* 
Şd_v®ue
);

171 
tim”_g‘time
(
tim”_t
 
tim”id
, 
™im”¥ec
 *
cu¼_v®ue
);

172 
tim”_d–‘e
(
tim”_t
 
tim”id
);

173 
tim”_g‘ov”run
(
tim”_t
 
tim”id
);

175 
adjtime
(cÚ¡ 
timev®
 *
d–
, timev® *
Şdd–
);

177 
aio_ÿnûl
(, 
aiocb
 *);

178 
aio_”rÜ
(cÚ¡ 
aiocb
 *);

179 
aio_fsync
(, 
aiocb
 *);

180 
aio_»ad
(
aiocb
 *);

181 
aio_»tuº
(
aiocb
 *);

182 
aio_wr™e
(
aiocb
 *);

183 
lio_li¡io
(, 
aiocb
 *cÚ¡ *, , 
sigev’t
 *);

184 
aio_su¥’d
(cÚ¡ 
aiocb
 *cÚ¡ *, , cÚ¡ 
time¥ec
 *);

185 
aio_wa™com¶‘e
(
aiocb
 **, 
time¥ec
 *);

188 -- 
BSD
 
¥ecific


189 
	gcdef
[[

190 
g‘dœ’Œ›s
(
fd
, *
buf
, 
nby‹s
, *
ba£p
);

191 
unmouÁ
(cÚ¡ *
dœ
, 
æags
);

192 
»voke
(cÚ¡ *
·th
);

193 
chæags
(cÚ¡ *
·th
, 
æags
);

194 
lchæags
(cÚ¡ *
·th
, 
æags
);

195 
fchæags
(
fd
, 
æags
);

196 
chæag§t
(
fd
, cÚ¡ *
·th
, 
æags
, 
©æag
);

197 
·thcÚf
(cÚ¡ *
·th
, 
Çme
);

198 
Í©hcÚf
(cÚ¡ *
·th
, 
Çme
);

199 
å©hcÚf
(
fd
, 
Çme
);

200 
kqueue
();

201 
kqueue1
(
æags
);

202 
kev’t
(
kq
, cÚ¡ kev’ˆ*
chªg–i¡
, 
size_t
 
nchªges
, kev’ˆ*
ev’i¡
, size_ˆ
Ãv’ts
, cÚ¡ 
time¥ec
 *
timeout
);

203 
is£tugid
();

204 
kŒaû
(cÚ¡ *
Œaûfe
, 
İs
, 
Œpošts
, 
pid_t
 
pid
);

206 
ex‰rùl
(cÚ¡ *
·th
, 
cmd
, cÚ¡ *
f’ame
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
);

207 
ex‰r_d–‘e_fd
(
fd
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
);

208 
ex‰r_d–‘e_fe
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
);

209 
ex‰r_d–‘e_lšk
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
);

210 
ssize_t
 
ex‰r_g‘_fd
(
fd
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
, *
d©a
, 
size_t
 
nby‹s
);

211 
ssize_t
 
ex‰r_g‘_fe
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
, *
d©a
, 
size_t
 
nby‹s
);

212 
ssize_t
 
ex‰r_g‘_lšk
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
, *
d©a
, 
size_t
 
nby‹s
);

213 
ssize_t
 
ex‰r_li¡_fd
(
fd
, 
©ŒÇme¥aû
, *
d©a
, 
size_t
 
nby‹s
);

214 
ssize_t
 
ex‰r_li¡_fe
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, *
d©a
, 
size_t
 
nby‹s
);

215 
ssize_t
 
ex‰r_li¡_lšk
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, *
d©a
, 
size_t
 
nby‹s
);

216 
ssize_t
 
ex‰r_£t_fd
(
fd
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
, cÚ¡ *
d©a
, 
size_t
 
nby‹s
);

217 
ssize_t
 
ex‰r_£t_fe
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
, cÚ¡ *
d©a
, 
size_t
 
nby‹s
);

218 
ssize_t
 
ex‰r_£t_lšk
(cÚ¡ *
·th
, 
©ŒÇme¥aû
, cÚ¡ *
©ŒÇme
, cÚ¡ *
d©a
, 
size_t
 
nby‹s
);

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bsd/syscalls.lua

1 -- 
sysÿÎs
 
sh¬ed
 
by
 
BSD
 
ba£d
 
İ”©šg
 
sy¡ems


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12  
	$funùiÚ
(
S
, 
hh
, 
c
, 
C
, 
ty³s
)

14 
loÿl
 
»t64
, 
»Šum
, 
»tfd
, 
»tboŞ
, 
»Œ
, 
»t™”
 = 
hh
.ret64, hh.retnum, hh.retfd, hh.retbool, hh.retptr, hh.retiter

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
”ºo
 = 
ffi
.errno

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
i¡y³
, 
mkty³
, 
g‘fd
 = 
h
.istype, h.mktype, h.getfd

22 
loÿl
 
où®
, 
¥l™
 = 
h
.octal, h.split

24 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

26 -- 
nÙe
 
emuÏ‹d
 
š
 
libc
 iÀ
N‘BSD


27 
C
.
g‘dœ’Œ›s
 
th’


28 
funùiÚ
 
S
.
	$g‘dœ’Œ›s
(
fd
, 
buf
, 
size
, 
ba£p
)

29 
size
 = siz
Ü
 4096

30 
buf
 = buà
Ü
 
t
.
	$bufãr
(
size
)

31 
ba£p
 = ba£°
Ü
 
t
.
	$lÚg1
()

32 
loÿl
 
»t
, 
”r
 = 
C
.
	`g‘dœ’Œ›s
(
	`g‘fd
(
fd
), 
buf
, 
size
, 
ba£p
)

33 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


34  
t
.
	$dœ’ts
(
buf
, 
»t
)

35 
’d


36 
’d


38 
funùiÚ
 
S
.
	$unmouÁ
(
rg‘
, 
æags
)

39  
	`»tboŞ
(
C
.
	$unmouÁ
(
rg‘
, 
c
.
MNT
[
æags
]))

40 
’d


42 
funùiÚ
 
S
.
	$»voke
(
·th
è 
	`»tboŞ
(
C
.
	$»voke
(
·th
)è
’d


43 
funùiÚ
 
S
.
	$chæags
(
·th
, 
æags
è 
	`»tboŞ
(
C
.
	$chæags
(
·th
, 
c
.
CHFLAGS
[
æags
])è
’d


44 
C
.
lchæags
 
th’


45 
funùiÚ
 
S
.
	$lchæags
(
·th
, 
æags
è 
	`»tboŞ
(
C
.
	$lchæags
(
·th
, 
c
.
CHFLAGS
[
æags
])è
’d


46 
’d


47 
funùiÚ
 
S
.
	$fchæags
(
fd
, 
æags
è 
	`»tboŞ
(
C
.
	`fchæags
(
	`g‘fd
(fd), 
c
.
CHFLAGS
[æags])è
’d


48 
C
.
chæag§t
 
th’


49 
funùiÚ
 
S
.
	$chæag§t
(
dœfd
, 
·th
, 
æags
, 
©æag
)

50  
	`»tboŞ
(
C
.
	$chæag§t
(
c
.
AT_FDCWD
[
dœfd
], 
·th
, c.
CHFLAGS
[
æags
], c.
AT
[
©æag
]))

51 
’d


52 
’d


54 
funùiÚ
 
S
.
	$·thcÚf
(
·th
, 
Çme
è 
	`»Šum
(
C
.
	$·thcÚf
(
·th
, 
c
.
PC
[
Çme
])è
’d


55 
funùiÚ
 
S
.
	$å©hcÚf
(
fd
, 
Çme
è 
	`»Šum
(
C
.
	`å©hcÚf
(
	`g‘fd
(fd), 
c
.
PC
[Çme])è
’d


56 
C
.
Í©hcÚf
 
th’


57 
funùiÚ
 
S
.
	$Í©hcÚf
(
·th
, 
Çme
è 
	`»Šum
(
C
.
	$Í©hcÚf
(
·th
, 
c
.
PC
[
Çme
])è
’d


58 
’d


60 
funùiÚ
 
S
.
	$kqueue
(è 
	`»tfd
(
C
.
	$kqueue
()è
’d


62 
loÿl
 
sysùÉy³s
 = 
	`»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".sysctl")

64 
loÿl
 
funùiÚ
 
	$sysùÊam‘omib
(
Çme
)

65 
loÿl
 
ÜigÇme
 = 
Çme


66 
Çme
 =‚ame:
	$low”
()

67 
loÿl
 

 = 
sysùÉy³s
[
Çme
]

68 
nÙ
 

 
th’
 
	`”rÜ
("unknowÀsysùÈ" .. 
Çme
è
’d


69 
	`ty³
(

è=ğ"bË" 
th’
°ğ[2] 
’d


70 -- 
ª
 
š‹º®
 
node
 
wl
 
be
 
a
 
numb”
 
Ü
 
lše
 
above
 wÈ
have
 
puÎed
 
out
 
bË


71 -- 
we
 dØ
®low
 
ÿÎs
 
Ú
 
š‹º®
 
node
 
to
 
£e
 
th©
 
subsy¡em
 
is
 
th”e
 
though


72 
	`ty³
(

è=ğ"numb”" 
Ü
y³Ñpè=ğ"bË" 
th’
°ğ"nÚe" 
’d


73 
Çme
 = 
	`¥l™
("%.",‚ame)

74 
loÿl
 
´efix


75 
loÿl
 
b


76 
i
 = 1, #name do

77 
nÙ
 
´efix
 
th’
…»fix = 
Çme
[
i
] ´efix =…»fix .. "." ..‚ame[i] 
’d


78 
loÿl
 
·¹
 = 
sysùÉy³s
[
´efix
]

79 
i
 =ğ#Çm
th’


80 
	`ty³
(
·¹
è=ğ"bË" 
th’
 
Çme
[
i
] =…art[1]

81 
–£if
 
	`ty³
(
·¹
è=ğ"numb”" 
th’
 
Çme
[
i
] =…art

83 
b
 
ªd
ab[
Çme
[
i
]] 
th’
‚ame[i] =ab[Çme[i]] 
	`”rÜ
("sysùÈunknowÀ" ..‚ame[i] .. " iÀ" .. 
ÜigÇme
è
’d


84 
’d


86 
	`ty³
(
·¹
è=ğ"bË" 
th’
 
Çme
[
i
], 
b
 =…¬t[1],…¬t[2] Çme[i] =…¬ˆ
’d


87 
’d


88 
’d


89  
Çme
, 



90 
’d


92 
loÿl
 
funùiÚ
 
	$sysùlsÜt
(
a
, 
b
)

93 
loÿl
 
a
 = 
	$sysùÊam‘omib
(
a
)

94 
loÿl
 
b
 = 
	$sysùÊam‘omib
(
b
)

95 
i
 = 1, #a do

96 
i
 > #b 
th’
  
Œue
 
’d


97 
a
[
i
] < 
b
[i] 
th’
  
Œue
 
’d


98 
b
[
i
] < 
a
[i] 
th’
  
çl£
 
’d


99 
’d


100  
Œue


101 
’d


103 
loÿl
 
®lm‘a
 = {

104 
__to¡ršg
 = 
	`funùiÚ
(
t
)

105 
loÿl
 
Çmes
 = {}

106 
k
, 
v
 
š
 
	`·œs
(
t
èdØ
Çmes
[#Çme + 1] = k 
’d


107 
bË
.
	`sÜt
(
Çmes
, 
sysùlsÜt
)

108 
loÿl
 
‰
 = {}

109 
i
, 
v
 
š
 
	`·œs
(
Çmes
èdØ
‰
[i] = v .. " = " .. 
	`to¡ršg
(
t
[v]è
’d


110  
bË
.
	`cÚÿt
(
‰
, '\n')

111 
’d
,

112 
	}
}

114 -- "-a" 
	gfunùiÚ®™y
, 
w–l
 
®l
 
the
 
Úes
 
we
 
know
 
	gabout


115 -- 
TODO
 
®so
 
u£
 
®l
 
und”
 
Úe
 
node


116 
loÿl
 
funùiÚ
 
	$®lsysùl
()

117 
loÿl
 
®l
 = {
	}
}

118 
k
, 
v
 
š
 
	$·œs
(
sysùÉy³s
) do

119 
	`ty³
(
v
è=ğ"bË" 
ªd
y³(v[2]è=ğ"¡ršg" 
th’
 v = v[2] 
’d


120 
	`ty³
(
v
è=ğ"¡ršg" 
th’


121 
loÿl
 
»s
, 
”r
 = 
S
.
	$sysùl
(
k
)

122 
»s
 
th’
 
®l
[
k
] =„e 
’d


123 
’d


124 
’d


125  
	$£tm‘©abË
(
®l
, 
®lm‘a
)

126 
’d


128 -- 
TODO
 
und”¡ªd
  
ty³s


129 
funùiÚ
 
S
.
	`sysùl
(
Çme
, 
Ãw
, 
Şd
è-- 
TODO
 
may
 
Ãed
 
to
 
chªge
 
¬gum’ts
, 
nÙe
 
Üd”
 
as
 
should
 
nÙ
‚“dØ
¥ecify
 old

130 
nÙ
 
Çme
 
th’
  
	$®lsysùl
(è
’d


131 
loÿl
 



132 
	`ty³
(
Çme
è=ğ"¡ršg" 
th’


133 
Çme
, 

 = 
	$sysùÊam‘omib
(
Çme
)

134 
’d


135 
loÿl
 
Çm–’
 = #name

136 
loÿl
 
ŞdËÅ
, 
ÃwËn


137 

 
th’


138 

 =ğ"¡ršg" 
th’


139 
ŞdËÅ
 = 
t
.
	`size1
(256è-- 
TODO
 
ad­t
 
too
 
sm®l


140 
Şd
 = 
t
.
	$bufãr
(
ŞdËÅ
[0])

141 
–£if
 

 =ğ"št" 
th’


142 
ŞdËÅ
 = 
t
.
	$size1
(
s
.)

143 
Şd
 = 
t
.
	$št1
()

144 
–£if
 

 =ğ"št64" 
th’


145 
ŞdËÅ
 = 
t
.
	$size1
(
s
.
št64
)

146 
Şd
 = 
t
.
	$št64_1
()

147 
–£if
 

 =ğ"nÚe" 
th’
 -- 
TODO
 
nÙ
 
­·»Ály
 
wÜkšg
, 
maybe
 
ju¡
 
li¡
 
®l
 
chd»n
 
š‹º®
 
node
 

148 
ŞdËÅ
 = 
t
.
	$size1
(
s
.)

149 
Şd
 = 
t
.
	$št1
()

151 
ŞdËÅ
 = 
t
.
	$size1
(
s
[

])

152 
Şd
 = 
t
[

]()

153 
’d


154 
–£if
 
	`ty³
(
Şd
è=ğ"numb”" 
th’
 -- 
¥ecif›d
 
Ëngth
 
of
 
bufãr


155 
ŞdËÅ
 = 
t
.
	$size1
(
Şd
)

156 
Şd
 = 
t
.
	$bufãr
(
Şd
)

157 
–£if
 
nÙ
 
Şd
 
th’
 --  
to
 

158 

 = "int"

159 
ŞdËÅ
 = 
t
.
	$size1
(
s
.)

160 
Şd
 = 
t
.
	$št1
()

162 
ŞdËÅ
 = 
t
.
	`size1
(#old)

163 
’d


164 
Ãw
 
th’
 
ÃwËn
 = #Ãw ÃwËÀğ0 
’d
 -- 
TODO
 
£t
 
ba£d
 
Ú
 
known
 
ty³s
 
too


165 
loÿl
 
Çme
 = 
t
.
	$šts
(
Çm–’
, 
Çme
)

166 
loÿl
 
»t
, 
”r
 = 
C
.
	$sysùl
(
Çme
, 
Çm–’
, 
Şd
, 
ŞdËÅ
, 
Ãw
, 
ÃwËn
)

167 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


168 

 
th’
 -- 
we
 
know
 
ty³
 
of
 
v®ue
 
bešg
 
»tuºed


169 

 =ğ"¡ršg" 
th’
  
ffi
.
	$¡ršg
(
Şd
)

170 
–£if
 

 =ğ"št" 
th’
  
	$tÚumb”
(
Şd
[0])

171 
–£if
 

 =ğ"št64" 
th’
  
Şd
[0]

172 
–£if
 

 =ğ"nÚe" 
th’
  
Œue


173  
Şd


174 
’d


175  
Şd


176 
’d


177  
Şd
, 
n
, 
ŞdËÅ
[0] -- 
nÙ
 
id—l
, 
but
 
add
 
the
 
sysùls
 
you
 
wªt
 
to
 
sysùl
.
lua
...

178 
’d


180 -- 
nÙe
 
osx
 
has
 
kev’t64
 
too
, 
difã»Á
 
ty³


181 
funùiÚ
 
S
.
	$kev’t
(
kq
, 
chªg–i¡
, 
ev’i¡
, 
timeout
)

182 
timeout
 
th’
imeouˆğ
	$mkty³
(
t
.
time¥ec
, 
timeout
è
’d


183 
loÿl
 
chªges
, 
chªgecouÁ
 = 
n
, 0

184 
chªg–i¡
 
th’
 
chªges
, 
chªgecouÁ
 = chªg–i¡.
kev
, chªg–i¡.
couÁ
 
’d


185 
ev’i¡
 
th’


186 
loÿl
 
»t
, 
”r
 = 
C
.
	`kev’t
(
	`g‘fd
(
kq
), 
chªges
, 
chªgecouÁ
, 
ev’i¡
.
kev
,ƒv’i¡.
couÁ
, 
timeout
)

187  
	$»t™”
(
»t
, 
”r
, 
ev’i¡
.
kev
)

188 
’d


189  
	`»Šum
(
C
.
	`kev’t
(
	`g‘fd
(
kq
), 
chªges
, 
chªgecouÁ
, 
n
, 0, 
timeout
))

190 
’d


192 
funùiÚ
 
S
.
	$tcg‘©Œ
(
fd
è 
S
.
	`ioùl
(fd, "TIOCGETA"è
’d


193 
loÿl
 
tc£ts
 = {

194 [
c
.
TCSA
.
NOW
] = "TIOCSETA",

195 [
c
.
TCSA
.
DRAIN
] = "TIOCSETAW",

196 [
c
.
TCSA
.
FLUSH
] = "TIOCSETAF",

197 
	}
}

198 
funùiÚ
 
	gS
.
tc£‰r
(
fd
, 
İtiÚ®_aùiÚs
, 
tio
)

199 -- 
TODO
 
®so
 
im¶em’t
 
	gTIOCSOFT
, 
which
 
Ãeds
 
to
 
make
 
a
 
modif›d
 
cİy
 
of
 
tio


200 
loÿl
 
	gšc
 = 
c
.
TCSA
[
İtiÚ®_aùiÚs
]

201  
S
.
	$ioùl
(
fd
, 
tc£ts
[
šc
], 
tio
)

202 
’d


203 
funùiÚ
 
S
.
	$tc£ndb»ak
(
fd
, 
du¿tiÚ
)

204 
loÿl
 
ok
, 
”r
 = 
S
.
	`ioùl
(
fd
, "TIOCSBRK")

205 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


206 
S
.
	`Çno¦“p
(0.4è-- 
BSD
 
ju¡
 
dÛs
 
cÚ¡ªt
 
time


207 
loÿl
 
ok
, 
”r
 = 
S
.
	`ioùl
(
fd
, "TIOCCBRK")

208 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


209  
Œue


210 
’d


211 
funùiÚ
 
S
.
	$tcd¿š
(
fd
)

212  
S
.
	`ioùl
(
fd
, "TIOCDRAIN")

213 
’d


214 
funùiÚ
 
S
.
	$tcæush
(
fd
, 
com
)

215  
S
.
	`ioùl
(
fd
, "TIOCFLUSH", 
c
.
TCFLUSH
[
com
]è-- 
defšed
 
as
 
FREAD
, 
FWRITE
, 
v®ues
 
§me


216 
’d


217 
loÿl
 
posix_vdi§bË
 = 
où®
 "0377" -- 
TODO
 
move
 
to
 
cÚ¡ªts
? 
check
 
š
 
®l
 
BSDs


218 
funùiÚ
 
S
.
	$tcæow
(
fd
, 
aùiÚ
)

219 
aùiÚ
 = 
c
.
TCFLOW
[action]

220 
aùiÚ
 =ğ
c
.
TCFLOW
.
OOFF
 
th’
  
S
.
	`ioùl
(
fd
, "TIOCSTOP"è
’d


221 
aùiÚ
 =ğ
c
.
TCFLOW
.
OON
 
th’
  
S
.
	`ioùl
(
fd
, "TIOCSTART"è
’d


222 
aùiÚ
 ~ğ
c
.
TCFLOW
.
ION
 
ªd
‡ùiÚ ~ğc.TCFLOW.
IOFF
 
th’
  
n
 
’d


223 
loÿl
 
‹rm
, 
”r
 = 
S
.
	$tcg‘©Œ
(
fd
)

224 
nÙ
 
‹rm
 
th’
  
n
, 
”r
 
’d


225 
loÿl
 
cc


226 
aùiÚ
 =ğ
c
.
TCFLOW
.
IOFF
 
th’
 
cc
 = 
‹rm
.
VSTOP
 cøğ‹rm.
VSTART
 
’d


227 
cc
 ~ğ
posix_vdi§bË
 
ªd
 
nÙ
 
S
.
	`wr™e
(
fd
, 
t
.
	`uch¬1
(cc), 1è
th’
  
n
 
’d


228  
Œue


229 
’d


230 
funùiÚ
 
S
.
	$is£tugid
(è 
C
.
	$is£tugid
(è
’d


232 -- 
the£
 
¬e
 
nÙ
 
š
 
N‘BSD
; 
they
‡» 
sysÿÎs
 iÀ
F»eBSD
, 
OSX
, 
libs
 
funùiÚs
 iÀ
Lšux
;hey 
could
 
be
 iÀ
maš
 
sysÿÎ
.

233 
C
.
shm_İ’
 
th’


234 
funùiÚ
 
S
.
	$shm_İ’
(
·thÇme
, 
æags
, 
mode
)

235 
	`ty³
(
·thÇme
è=ğ"¡ršg" 
ªd
…©hÇme:
	`sub
(1, 1è~ğ"/" 
th’
…©hÇmğ"/" ..…©hÇm
’d


236  
	`»tfd
(
C
.
	$shm_İ’
(
·thÇme
, 
c
.
O
[
æags
], c.
MODE
[
mode
]))

237 
’d


238 
’d


239 
C
.
shm_uÆšk
 
th’


240 
funùiÚ
 
S
.
	$shm_uÆšk
(
·thÇme
è 
	`»tboŞ
(
C
.
	$shm_uÆšk
(
·thÇme
)è
’d


241 
’d


243 -- 
TODO
 
move
 
the£
 
to
 
F»eBSD
 
Úly
 
as
 
­·»Ály
 
N‘BSD
 
d•»ÿ‹s
 
the
 
nÚ
 
Lšux
 
x©Œ
 
š‹rçûs


244 -- 
®though
 
th”e
 
¬e
 
no
 
mª
 
·ges
 
the
 
Lšux
 
Úes
...

245 -- 
doc
 
§ys
 
behaves
 
like
 
»ad
, 
wr™e
, 
but
 
as
 
th”e
 
£em
 
to
 
be
 
lim™s
 
Ú
 
©Œ
 
size
 
ªd
 
tÙ®
 size

246 -- 
£ems
 
pošess
 
to
 
nÙ
 
»ad
 
the
 
whŞe
 
thšg
 
©
 
Úû


248 
loÿl
 
funùiÚ
 
	$ex‰r_g‘_h–³r
(
â
, 
ff
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

249 
©ŒÇme¥aû
 = 
c
.
EXTATTR_NAMESPACE
[attrnamespace]

250 
d©a
 
Ü
 d©¨=ğ
çl£
 
th’


251 
d©a
 =ğ
çl£
 
th’
 d©a, 
nby‹s
 = 
n
, 0 
’d


252  
	`»Šum
(
	`â
(
ff
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
 
Ü
 #data))

253 
’d


254 
loÿl
 
nby‹s
, 
”r
 = 
	$â
(
ff
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
n
, 0)

255 
nby‹s
 = 
	$tÚumb”
(
nby‹s
)

256 
nby‹s
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


257 
loÿl
 
d©a
 = 
t
.
	$bufãr
(
nby‹s
)

258 
loÿl
 
n
, 
”r
 = 
	$â
(
ff
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

259 
n
 = 
	$tÚumb”
(
n
)

260 
n
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


261  
ffi
.
	$¡ršg
(
d©a
, 
n
)

262 
’d


264 
C
.
ex‰r_g‘_fd
 
th’


265 
funùiÚ
 
S
.
	$ex‰r_g‘_fd
(
fd
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

266  
	`ex‰r_g‘_h–³r
(
C
.
ex‰r_g‘_fd
, 
	`g‘fd
(
fd
), 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

267 
’d


268 
’d


270 
C
.
ex‰r_g‘_fe
 
th’


271 
funùiÚ
 
S
.
	$ex‰r_g‘_fe
(
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

272  
	$ex‰r_g‘_h–³r
(
C
.
ex‰r_g‘_fe
, 
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

273 
’d


274 
’d


276 
C
.
ex‰r_g‘_lšk
 
th’


277 
funùiÚ
 
S
.
	$ex‰r_g‘_lšk
(
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

278  
	$ex‰r_g‘_h–³r
(
C
.
ex‰r_g‘_lšk
, 
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

279 
’d


280 
’d


282 
C
.
ex‰r_£t_fd
 
th’


283 
funùiÚ
 
S
.
	$ex‰r_£t_fd
(
fd
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

284 
loÿl
 
¡r
 = 
d©a
 -- dØ
nÙ
 
gc


285 
	`ty³
(
d©a
è=ğ"¡ršg" 
th’
 d©a, 
nby‹s
 = 
±
.(
¡r
), #¡¸
’d


286  
	`»Šum
(
C
.
	`ex‰r_£t_fd
(
	`g‘fd
(
fd
), 
c
.
EXTATTR_NAMESPACE
[
©ŒÇme¥aû
], 
©ŒÇme
, 
d©a
, 
nby‹s
 
Ü
 #data))

287 
’d


288 
’d


290 
C
.
ex‰r_d–‘e_fd
 
th’


291 
funùiÚ
 
S
.
	$ex‰r_d–‘e_fd
(
fd
, 
©ŒÇme¥aû
, 
©ŒÇme
)

292  
	`»tboŞ
(
C
.
	`ex‰r_d–‘e_fd
(
	`g‘fd
(
fd
), 
c
.
EXTATTR_NAMESPACE
[
©ŒÇme¥aû
], 
©ŒÇme
))

293 
’d


294 
’d


296 
C
.
ex‰r_£t_fe
 
th’


297 
funùiÚ
 
S
.
	$ex‰r_£t_fe
(
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

298 
loÿl
 
¡r
 = 
d©a
 -- dØ
nÙ
 
gc


299 
	`ty³
(
d©a
è=ğ"¡ršg" 
th’
 d©a, 
nby‹s
 = 
±
.(
¡r
), #¡¸
’d


300  
	`»Šum
(
C
.
	`ex‰r_£t_fe
(
fe
, 
c
.
EXTATTR_NAMESPACE
[
©ŒÇme¥aû
], 
©ŒÇme
, 
d©a
, 
nby‹s
 
Ü
 #data))

301 
’d


302 
’d


304 
C
.
ex‰r_d–‘e_fe
 
th’


305 
funùiÚ
 
S
.
	$ex‰r_d–‘e_fe
(
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
)

306  
	`»tboŞ
(
C
.
	$ex‰r_d–‘e_fe
(
fe
, 
c
.
EXTATTR_NAMESPACE
[
©ŒÇme¥aû
], 
©ŒÇme
))

307 
’d


308 
’d


310 
C
.
ex‰r_£t_lšk
 
th’


311 
funùiÚ
 
S
.
	$ex‰r_£t_lšk
(
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
, 
d©a
, 
nby‹s
)

312 
loÿl
 
¡r
 = 
d©a
 -- dØ
nÙ
 
gc


313 
	`ty³
(
d©a
è=ğ"¡ršg" 
th’
 d©a, 
nby‹s
 = 
±
.(
¡r
), #¡¸
’d


314  
	`»Šum
(
C
.
	`ex‰r_£t_lšk
(
fe
, 
c
.
EXTATTR_NAMESPACE
[
©ŒÇme¥aû
], 
©ŒÇme
, 
d©a
, 
nby‹s
 
Ü
 #data))

315 
’d


316 
’d


318 
C
.
ex‰r_d–‘e_lšk
 
th’


319 
funùiÚ
 
S
.
	$ex‰r_d–‘e_lšk
(
fe
, 
©ŒÇme¥aû
, 
©ŒÇme
)

320  
	`»tboŞ
(
C
.
	$ex‰r_d–‘e_lšk
(
fe
, 
c
.
EXTATTR_NAMESPACE
[
©ŒÇme¥aû
], 
©ŒÇme
))

321 
’d


322 
’d


324 
loÿl
 
funùiÚ
 
	$·r£_ex‰r
(
buf
, 
n
)

325 
loÿl
 
b
, 
i
 = {
	}
}, 0

326 
	gn
 > 0 do

327 
loÿl
 
	gËn
 = 
buf
[
i
]

328 
b
[#b + 1] = 
ffi
.
¡ršg
(
buf
 + 
i
 + 1, 
Ën
)

329 
	gi
, 
	gn
 = 
i
 + (
Ën
 + 1),‚ - (
	gËn
 + 1)

330 
’d


331  
b


332 
’d


334 
loÿl
 
funùiÚ
 
	$ex‰r_li¡_h–³r
(
â
, 
ff
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

335 
©ŒÇme¥aû
 = 
c
.
EXTATTR_NAMESPACE
[attrnamespace]

336 
d©a
 =ğ
çl£
 
th’
  
	`»Šum
(
	$â
(
ff
, 
©ŒÇme¥aû
, 
n
, 0)è
’d


337 
d©a
 
th’


338  
	`»Šum
(
	`â
(
ff
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
 
Ü
 #d©a)è-- 
TODO
 
should
 
we
 
·r£
?

339 
’d


340 
loÿl
 
nby‹s
, 
”r
 = 
	$â
(
ff
, 
©ŒÇme¥aû
, 
n
, 0)

341 
nby‹s
 = 
	$tÚumb”
(
nby‹s
)

342 
nby‹s
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


343 
loÿl
 
d©a
 = 
t
.
	$bufãr
(
nby‹s
)

344 
loÿl
 
n
, 
”r
 = 
	$â
(
ff
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

345 
n
 = 
	$tÚumb”
(
n
)

346 
n
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


347  
	$·r£_ex‰r
(
d©a
, 
n
)

348 
’d


350 
C
.
ex‰r_li¡_fd
 
th’


351 
funùiÚ
 
S
.
	$ex‰r_li¡_fd
(
fd
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

352  
	`ex‰r_li¡_h–³r
(
C
.
ex‰r_li¡_fd
, 
	`g‘fd
(
fd
), 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

353 
’d


354 
’d


356 
C
.
ex‰r_li¡_fe
 
th’


357 
funùiÚ
 
S
.
	$ex‰r_li¡_fe
(
fe
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

358  
	$ex‰r_li¡_h–³r
(
C
.
ex‰r_li¡_fe
, 
fe
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

359 
’d


360 
’d


362 
C
.
ex‰r_li¡_lšk
 
th’


363 
funùiÚ
 
S
.
	$ex‰r_li¡_lšk
(
fe
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

364  
	$ex‰r_li¡_h–³r
(
C
.
ex‰r_li¡_lšk
, 
fe
, 
©ŒÇme¥aû
, 
d©a
, 
nby‹s
)

365 
’d


366 
’d


368  
S


370 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bsd/types.lua

1 -- 
BSD
 
sh¬ed
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
c
, 
ty³s
)

12 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

14 
loÿl
 
t
, 
±
, 
s
, 
ùy³s
 = 
ty³s
.t,ypes.pt,ypes.s,ypes.ctypes

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
addty³
, 
addty³_v¬
, 
addty³_â
, 
add¿w2
 = 
h
.addtype, h.addtype_var, h.addtype_fn, h.addraw2

22 
loÿl
 
±t
, 
»v™”
, 
mkty³
, 
i¡y³
, 
Ënâ
, 
Ënmt
, 
g‘fd
, 
Ãwâ


23 ğ
h
.
±t
, h.
»v™”
, h.
mkty³
, h.
i¡y³
, h.
Ënâ
, h.
Ënmt
, h.
g‘fd
, h.
Ãwâ


24 
loÿl
 
Áohl
,‚tohl, 
Áohs
, 
htÚs
 = 
h
.ntohl, h.ntohl, h.ntohs, h.htons

26 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


28 
loÿl
 
addty³s
 = {

31 
loÿl
 
add¡ruùs
 = {

34 
k
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


35 
k
, 
v
 
š
 
	$·œs
(
add¡ruùs
èdØ
	$addty³
(
ty³s
, 
k
, 
v
, 
Ënmt
è
’d


37 
mt
.
sockaddr
 = {

38 
šdex
 = {

39 
Ën
 = 
	`funùiÚ
(
§
è sa.
§_Ën
 
’d
,

40 
çmy
 = 
	`funùiÚ
(
§
è sa.
§_çmy
 
’d
,

42 
Ãwšdex
 = {

43 
Ën
 = 
	`funùiÚ
(
§
, 
v
è§.
§_Ën
 = v 
’d
,

45 
	}
}

47 
addty³
(
ty³s
, "sockaddr", "¡ruù sockaddr", 
mt
.
sockaddr
)

49 -- 
ÿ¡
 
sock‘
 
add»ss
 
to
 
aùu®
 
ty³
 
ba£d
 
Ú
 
	gçmy
, 
defšed
 
Ï‹r


50 
loÿl
 
	g§m­_±
 = {}

52 
mt
.
sockaddr_¡Üage
 = {

53 
šdex
 = {

54 
Ën
 = 
funùiÚ
(
§
è sa.
ss_Ën
 
’d
,

55 
	gçmy
 = 
funùiÚ
(
§
è sa.
ss_çmy
 
’d
,

57 
	gÃwšdex
 = {

58 
Ën
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gss_Ën
 = v 
’d
,

59 
	gçmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gss_çmy
 = 
c
.
AF
[v] 
’d
,

61 
	g__šdex
 = 
funùiÚ
(
§
, 
k
)

62 
	gmt
.
	gsockaddr_¡Üage
.
	gšdex
[
k
] 
th’
  mt.sockaddr_¡Üage.šdex[k](
	g§
è
’d


63 
loÿl
 
	g¡
 = 
§m­_±
[
§
.
ss_çmy
]

64 
¡
 
th’


65 
loÿl
 
cs
 = 
¡
(
§
)

66  
cs
[
k
]

67 
’d


68 
”rÜ
("šv®id index " .. 
k
)

69 
’d
,

70 
	g__Ãwšdex
 = 
funùiÚ
(
§
, 
k
, 
v
)

71 
	gmt
.
	gsockaddr_¡Üage
.
	gÃwšdex
[
k
] 
th’


72 
	gmt
.
	gsockaddr_¡Üage
.
	gÃwšdex
[
k
](
	g§
, 
	gv
)

74 
’d


75 
loÿl
 
	g¡
 = 
§m­_±
[
§
.
ss_çmy
]

76 
¡
 
th’


77 
loÿl
 
cs
 = 
¡
(
§
)

78 
cs
[
k
] = 
v


80 
’d


81 
”rÜ
("šv®id index " .. 
k
)

82 
’d
,

83 
	g__Ãw
 = 
funùiÚ
(

, 
š™
)

84 
loÿl
 
	gss
 = 
ffi
.
Ãw
(

)

85 
loÿl
 
çmy


86 
š™
 
ªd
 in™.
çmy
 
th’
 famy = 
c
.
AF
[š™.çmy] 
’d


87 
loÿl
 
¡


88 
çmy
 
th’


89 
¡
 = 
§m­_±
[
çmy
]

90 
ss
.
ss_çmy
 = 
çmy


91 
š™
.
çmy
 = 
n


92 
’d


93 
¡
 
th’


94 
loÿl
 
cs
 = 
¡
(
ss
)

95 
k
, 
v
 
š
 
·œs
(
š™
) do

96 
	gcs
[
k
] = 
v


97 
’d


98 
’d


99 
ss
.
Ën
 = #ss

100  
ss


101 
’d
,

102 -- 
Ãtbsd
 
likes
 
to
 
£e
 
the
 
cÜ»ù
 
size
 
wh’
 
™
 
g‘s
 
a
 
	gsockaddr
; 
Lšux
 
was
 
ok
 
w™h
‡ 
lÚg”
 
Úe


103 
	g__Ën
 = 
funùiÚ
(
§
)

104 
§m­_±
[
§
.
çmy
] 
th’


105 
loÿl
 
cs
 = 
§m­_±
[
§
.
çmy
](sa)

108  
s
.
sockaddr_¡Üage


109 
’d


110 
’d
,

113 -- 
	gex³rim’t
, 
£e
 
we
 
ÿn
 
u£
 
this
 
as
 
g’”ic
 
	gty³
, 
to
 
avoid
 
	g®loÿtiÚs
.

114 
addty³
(
ty³s
, "sockaddr_¡Üage", "¡ruù sockaddr_¡Üage", 
mt
.
sockaddr_¡Üage
)

116 
	gmt
.
	gsockaddr_š
 = {

117 
šdex
 = {

118 
Ën
 = 
funùiÚ
(
§
è sa.
sš_Ën
 
’d
,

119 
	gçmy
 = 
funùiÚ
(
§
è sa.
sš_çmy
 
’d
,

120 
	gpÜt
 = 
funùiÚ
(
§
è 
Áohs
(§.
sš_pÜt
è
’d
,

121 
	gaddr
 = 
funùiÚ
(
§
è sa.
sš_addr
 
’d
,

123 
	gÃwšdex
 = {

124 
Ën
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš_Ën
 = v 
’d
,

125 
	gçmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš_çmy
 = v 
’d
,

126 
	gpÜt
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš_pÜt
 = 
htÚs
(vè
’d
,

127 
	gaddr
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš_addr
 = 
mkty³
(
t
.
š_addr
, vè
	g’d
,

129 
	g__Ãw
 = 
funùiÚ
(

, 
pÜt
, 
addr
)

130 
ty³
(
pÜt
è=ğ"bË" 
th’


131 
pÜt
.
Ën
 = 
s
.
sockaddr_š


132  
Ãwâ
(

, 
pÜt
)

133 
’d


134  
Ãwâ
(

, {
Ën
 = 
s
.
sockaddr_š
, 
çmy
 = 
c
.
AF
.
INET
, 
pÜt
 =…Üt, 
addr
 =‡ddr})

135 
	g’d
,

136 
	g__Ën
 = 
funùiÚ
(

è 
s
.
sockaddr_š
 
’d
,

139 
addty³
(
ty³s
, "sockaddr_š", "¡ruù sockaddr_š", 
mt
.
sockaddr_š
)

141 
	gmt
.
	gsockaddr_š6
 = {

142 
šdex
 = {

143 
Ën
 = 
funùiÚ
(
§
è sa.
sš6_Ën
 
’d
,

144 
	gçmy
 = 
funùiÚ
(
§
è sa.
sš6_çmy
 
’d
,

145 
	gpÜt
 = 
funùiÚ
(
§
è 
Áohs
(§.
sš6_pÜt
è
’d
,

146 
	gaddr
 = 
funùiÚ
(
§
è sa.
sš6_addr
 
’d
,

148 
	gÃwšdex
 = {

149 
Ën
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_Ën
 = v 
’d
,

150 
	gçmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_çmy
 = v 
’d
,

151 
	gpÜt
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_pÜt
 = 
htÚs
(vè
’d
,

152 
	gaddr
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_addr
 = 
mkty³
(
t
.
š6_addr
, vè
	g’d
,

153 
	gæowšfo
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_æowšfo
 = v 
’d
,

154 
	gscİe_id
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_scİe_id
 = v 
’d
,

156 
	g__Ãw
 = 
funùiÚ
(

, 
pÜt
, 
addr
, 
æowšfo
, 
scİe_id
è-- 
»Üd”ed
 
	gš™Ÿli£rs
.

157 
ty³
(
pÜt
è=ğ"bË" 
th’


158 
pÜt
.
Ën
 = 
s
.
sockaddr_š6


159  
Ãwâ
(

, 
pÜt
)

160 
’d


161  
Ãwâ
(

, {
Ën
 = 
s
.
sockaddr_š6
, 
çmy
 = 
c
.
AF
.
INET6
, 
pÜt
 =…Üt, 
addr
 =‡ddr, 
æowšfo
 = flowšfo, 
scİe_id
 = scope_id})

162 
	g’d
,

163 
	g__Ën
 = 
funùiÚ
(

è 
s
.
sockaddr_š6
 
’d
,

166 
addty³
(
ty³s
, "sockaddr_š6", "¡ruù sockaddr_š6", 
mt
.
sockaddr_š6
)

168 
	gmt
.
	gsockaddr_un
 = {

169 
šdex
 = {

170 
çmy
 = 
funùiÚ
(
§
è sa.
sun_çmy
 
’d
,

171 
	g·th
 = 
funùiÚ
(
§
è 
ffi
.
¡ršg
(§.
sun_·th
è
’d
,

173 
	gÃwšdex
 = {

174 
çmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsun_çmy
 = v 
’d
,

175 
	g·th
 = 
funùiÚ
(
§
, 
v
è
	gffi
.
cİy
(§.
sun_·th
, vè
	g’d
,

177 
	g__Ãw
 = 
funùiÚ
(

, 
·th
è 
Ãwâ
Ñp, {
çmy
 = 
c
.
AF
.
UNIX
,…©h =…©h, 
sun_Ën
 = 
s
.
sockaddr_un
}è
	g’d
,

178 
	g__Ën
 = 
funùiÚ
(
§
è 2 + #§.
·th
 
’d
,

181 
addty³
(
ty³s
, "sockaddr_un", "¡ruù sockaddr_un", 
mt
.
sockaddr_un
)

183 
funùiÚ
 
	gt
.
	$§
(
addr
, 
add¾’
è‡dd¸
’d
 -- 
nÚ
 
Lšux
 
is
 
ŒivŸl
, Lšux 
has
 
odd
 
unix
 
hªdlšg


185 -- 
TODO
 
Ãed
 
to
 
check
 
š
 
d‘a
 
®l
 
this
 
as
 
pÜ‹d
 
äom
 
Lšux
 
ªd
 
may
 
difãr


186 
mt
.
‹rmios
 = {

187 
mak”aw
 = 
	`funùiÚ
(
‹rmios
)

188 
‹rmios
.
c_iæag
 = 
b™
.
	`bªd
Ñ”mios.
iæag
, b™.
	`bnÙ
(
c
.
IFLAG
["IGNBRK,BRKINT,PARMRK,ISTRIP,INLCR,IGNCR,ICRNL,IXON"]))

189 
‹rmios
.
c_oæag
 = 
b™
.
	`bªd
Ñ”mios.
oæag
, b™.
	`bnÙ
(
c
.
OFLAG
["OPOST"]))

190 
‹rmios
.
c_læag
 = 
b™
.
	`bªd
Ñ”mios.
læag
, b™.
	`bnÙ
(
c
.
LFLAG
["ECHO,ECHONL,ICANON,ISIG,IEXTEN"]))

191 
‹rmios
.
c_cæag
 = 
b™
.
	`bÜ
(b™.
	`bªd
Ñ”mios.
cæag
, b™.
	`bnÙ
(
c
.
CFLAG
["CSIZE,PARENB"])), c.CFLAG.
CS8
)

192 
‹rmios
.
c_cc
[
c
.
CC
.
VMIN
] = 1

193 
‹rmios
.
c_cc
[
c
.
CC
.
VTIME
] = 0

194  
Œue


195 
’d
,

196 
šdex
 = {

197 
iæag
 = 
	`funùiÚ
(
‹rmios
è 
	`tÚumb”
Ñ”mios.
c_iæag
è
’d
,

198 
oæag
 = 
	`funùiÚ
(
‹rmios
è 
	`tÚumb”
Ñ”mios.
c_oæag
è
’d
,

199 
cæag
 = 
	`funùiÚ
(
‹rmios
è 
	`tÚumb”
Ñ”mios.
c_cæag
è
’d
,

200 
læag
 = 
	`funùiÚ
(
‹rmios
è 
	`tÚumb”
Ñ”mios.
c_læag
è
’d
,

201 
mak”aw
 = 
	`funùiÚ
(
‹rmios
è 
mt
.‹rmios.mak”aw 
’d
,

202 
i¥“d
 = 
	`funùiÚ
(
‹rmios
è”mios.
c_i¥“d
 
’d
,

203 
o¥“d
 = 
	`funùiÚ
(
‹rmios
è”mios.
c_o¥“d
 
’d
,

205 
Ãwšdex
 = {

206 
iæag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_iæag
 = 
c
.
	`IFLAG
(vè
’d
,

207 
oæag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_oæag
 = 
c
.
	`OFLAG
(vè
’d
,

208 
cæag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_cæag
 = 
c
.
	`CFLAG
(vè
’d
,

209 
læag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_læag
 = 
c
.
	`LFLAG
(vè
’d
,

210 
i¥“d
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_i¥“d
 = v 
’d
,

211 
o¥“d
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_o¥“d
 = v 
’d
,

212 
¥“d
 = 
	`funùiÚ
(
‹rmios
, 
v
)

213 
‹rmios
.
c_i¥“d
 = 
v


214 
‹rmios
.
c_o¥“d
 = 
v


215 
’d
,

217 
	}
}

219 
	gk
, 
i
 
š
 
	$·œs
(
c
.
CC
) do

220 
mt
.
‹rmios
.
šdex
[
k
] = 
	$funùiÚ
(
‹rmios
è”mios.
c_cc
[
i
] 
’d


221 
mt
.
‹rmios
.
Ãwšdex
[
k
] = 
	$funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_cc
[
i
] = v 
’d


222 
’d


224 
	`addty³
(
ty³s
, "‹rmios", "¡ruù”mios", 
mt
.
‹rmios
)

226 
mt
.
kev’t
 = {

227 
šdex
 = {

228 
size
 = 
	`funùiÚ
(
kev
è 
	`tÚumb”
(kev.
d©a
è
’d
,

229 
fd
 = 
	`funùiÚ
(
kev
è 
	`tÚumb”
(kev.
id’t
è
’d
,

230 
sigÇl
 = 
	`funùiÚ
(
kev
è 
	`tÚumb”
(kev.
id’t
è
’d
,

232 
Ãwšdex
 = {

233 
fd
 = 
	`funùiÚ
(
kev
, 
v
èkev.
id’t
 = 
t
.
	`ušŒ
(
	`g‘fd
(v)è
’d
,

234 
sigÇl
 = 
	`funùiÚ
(
kev
, 
v
èkev.
id’t
 = 
c
.
SIG
[v] 
’d
,

235 -- 
due
 
to
 
Çmšg
, 
u£
 '£t' 
Çmes
 
TODO
 
b‘‹r
‚amšg 
scheme
 
»ads
 
oddly
 
as
 
nÙ
 
a
 
funùiÚ


236 
£tæags
 = 
	`funùiÚ
(
kev
, 
v
èkev.
æags
 = 
c
.
EV
[v] 
’d
,

237 
£tf‹r
 = 
	`funùiÚ
(
kev
, 
v
èkev.
f‹r
 = 
c
.
EVFILT
[v] 
’d
,

239 
__Ãw
 = 
	`funùiÚ
(

, 
b
)

240 
	`ty³
(
b
è=ğ"bË" 
th’


241 
b
.
æags
 = 
c
.
EV
[tab.flags]

242 
b
.
f‹r
 = 
c
.
EVFILT
[b.f‹r] -- 
TODO
 
this
 
should
 
®so
 
suµÜt
 
exŒa
 
Úes
 
vŸ
 
ioùl
 
£e
 
mª
 
·ge


243 
b
.
fæags
 = 
c
.
NOTE
[tab.fflags]

244 
’d


245 
loÿl
 
obj
 = 
ffi
.
	`Ãw
(

)

246 
k
, 
v
 
š
 
	`·œs
(
b
 
Ü
 {}èdØ
obj
[k] = v 
’d


247  
obj


248 
’d
,

249 
	}
}

251 
	gk
, 
v
 
š
 
	$·œs
(
c
.
NOTE
) do

252 
mt
.
kev’t
.
šdex
[
k
] = 
	$funùiÚ
(
kev
è 
b™
.
	`bªd
(kev.
fæags
, 
v
è~ğ0 
’d


253 
’d


255 
_
, 
k
 
š
 
·œs
{"FLAG1", "EOF", "ERROR"
	}
} do

256 
	gmt
.
	gkev’t
.
	gšdex
[
k
] = 
	$funùiÚ
(
kev
è 
b™
.
	`bªd
(kev.
æags
, 
c
.
EV
[
k
]è~ğ0 
’d


257 
’d


259 
	`addty³
(
ty³s
, "kev’t", "¡ruù kev’t", 
mt
.
kev’t
)

261 
mt
.
kev’ts
 = {

262 
__Ën
 = 
	`funùiÚ
(
kk
è kk.
couÁ
 
’d
,

263 
__Ãw
 = 
	`funùiÚ
(

, 
ks
)

264 
	`ty³
(
ks
è=ğ'numb”' 
th’
  
ffi
.
	`Ãw
(

, ks, ksè
’d


265 
loÿl
 
couÁ
 = #ks

266 
loÿl
 
kks
 = 
ffi
.
	`Ãw
(

, 
couÁ
, count)

267 
n
 = 1, 
couÁ
 dØ-- 
TODO
 
id—Îy
 
we
 
u£
 
aœs
 
Ú
 
bÙh
 
¬¿ys
/
bËs


268 
loÿl
 
v
 = 
	`mkty³
(
t
.
kev’t
, 
ks
[
n
])

269 
kks
.
kev
[
n
 - 1] = 
v


270 
’d


271  
kks


272 
’d
,

273 
__aœs
 = 
	`funùiÚ
(
kk
è 
»v™”
, kk.
kev
, kk.
couÁ
 
’d


274 
	}
}

276 
addty³_v¬
(
ty³s
, "kev’ts", "¡ruù {šˆcouÁ; sŒuù kev’ˆkev[?];}", 
mt
.
kev’ts
)

278 -- 
this
 
is
 
deş¬ed
 
above


279 
	g§m­_±
 = {

280 [
c
.
AF
.
UNIX
] = 
±
.
sockaddr_un
,

281 [
c
.
AF
.
INET
] = 
±
.
sockaddr_š
,

282 [
c
.
AF
.
INET6
] = 
±
.
sockaddr_š6
,

285  
ty³s


287 
’d


289  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/compat.lua

1 -- 
Com·tib™y
 
w¿µ”s
 
to
 
add
 
mÜe
 
commÚ®™y
 
b‘w“n
 
difã»Á
 
	gsy¡ems
, 
¶us
 
defše
 
commÚ
 
funùiÚs
 
äom
 
	$mª
(3)

3 
loÿl
 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

4 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

5 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg
 =

6 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

7 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

8 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
S
)

12 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

13 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

15 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

19 
loÿl
 
i¡y³
, 
mkty³
, 
g‘fd
 = 
h
.istype, h.mktype, h.getfd

21 
nÙ
 
S
.
ü—t
 
th’


22 
funùiÚ
 
S
.
	$ü—t
(
·thÇme
, 
mode
è 
S
.
	`İ’
Õ©hÇme, "CREAT,WRONLY,TRUNC", modeè
’d


23 
’d


25 
funùiÚ
 
S
.
	$niû
(
šc
)

26 
loÿl
 
´io
 = 
S
.
	`g‘´iÜ™y
("´oûss", 0è-- 
this
 
ÿÂÙ
 
ç
 
w™h
 
the£
 
¬gs
.

27 
loÿl
 
ok
, 
”r
 = 
S
.
	`£riÜ™y
("´oûss", 0, 
´io
 + 
šc
)

28 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


29  
S
.
	`g‘´iÜ™y
("process", 0)

30 
’d


32 -- 
d•»ÿ‹d
 
š
 
N‘BSD
 
ªd
 
nÙ
 iÀ
some
 
¬chs
 
Lšux
, 
im¶em’t
 
w™h
 
»cväom
/
£ndto


33 
funùiÚ
 
S
.
	$»cv
(
fd
, 
buf
, 
couÁ
, 
æags
è 
S
.
	$»cväom
(
fd
, 
buf
, 
couÁ
, 
æags
, 
n
,‚è
’d


34 
funùiÚ
 
S
.
	$£nd
(
fd
, 
buf
, 
couÁ
, 
æags
è 
S
.
	$£ndto
(
fd
, 
buf
, 
couÁ
, 
æags
, 
n
,‚è
’d


36 -- 
nÙ
 
a
 
sysÿÎ
 
š
 
mªy
 
sy¡ems
, 
defšed
 iÀ
‹rms
 
of
 
sigaùiÚ


37 
loÿl
 
sig»t
 = {
	}
}

38 
k
, 
v
 
š
 
	$·œs
(
c
.
SIGACT
èdØ
k
 ~ğ"ERR" 
th’
 
sig»t
[
v
] = k 
’d
ƒnd

40 
S
.
sigaùiÚ
 
th’


41 
funùiÚ
 
S
.
	`sigÇl
(
signum
, 
hªdËr
è-- 
defšed
 
š
 
‹rms
 
of
 
sigaùiÚ
, 
£e
 
pÜb™y
 
nÙes
 iÀ
Lšux
 
mª
 
·ge


42 
loÿl
 
Şdaù
 = 
t
.
	$sigaùiÚ
()

43 
loÿl
 
ok
, 
”r
 = 
S
.
	$sigaùiÚ
(
signum
, 
hªdËr
, 
Şdaù
)

44 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


45 
loÿl
 
num
 = 
	`tÚumb”
(
t
.
	$šŒ
(
Şdaù
.
hªdËr
))

46 
loÿl
 
»t
 = 
sig»t
[
num
]

47 
»t
 
th’
 „‘ 
’d
 --  
eg
 "IGN", "DFL" 
nÙ
 
a
 
funùiÚ
 
poš‹r


48  
Şdaù
.
hªdËr


49 
’d


50 
’d


52 
nÙ
 
S
.
·u£
 
ªd
 S.
sigsu¥’d
 
th’
 -- 
N‘BSD
‡nd 
OSX
 
d•»ÿ‹
…ause

53 
funùiÚ
 
S
.
	$·u£
(è 
S
.
	`sigsu¥’d
(
t
.
	$sig£t
()è
’d


54 
’d


56 
nÙ
 
S
.
®¬m
 
ªd
 S.
£t™im”
 
th’
 -- 
usu®ly
 
im¶em’‹d
 
vŸ
 
™im”
, 
®though
 
Lšux
 
´ovides
‡Ïrm 
as
 
sysÿÎ


57 
funùiÚ
 
S
.
	$®¬m
(
£c
)

58 
loÿl
 
Şd™
, 
”r
 = 
S
.
	`£t™im”
(
c
.
ITIMER
.
REAL
, {0, 
£c
})

59 
nÙ
 
Şd™
 
th’
  
	gn
, 
”r
 
	g’d
 -- 
®¬m
‚Ù 
suµo£d
 
to
  
”rÜs
 
but
 
hey


60  
	gŞd™
.
	gv®ue
.
£c


61 
’d


62 
	g’d


64 -- 
nÚ
 
¡ªd¬d
 
Çmes


65 
nÙ
 
	gS
.
umouÁ
 
th’
 S.
	gumouÁ
 = 
S
.
unmouÁ
 
’d


66 
nÙ
 
S
.
unmouÁ
 
th’
 S.unmouÁ = S.
umouÁ
 
’d


68 
S
.
g‘dœ’Œ›s
 
ªd
 
nÙ
 S.
g‘d’ts
 
th’
 -- 
eg
 
OSX
 
has
 
exŒa
 
¬g


69 
funùiÚ
 
S
.
	$g‘d’ts
(
fd
, 
buf
, 
Ën
)

70  
S
.
	$g‘dœ’Œ›s
(
fd
, 
buf
, 
Ën
, 
n
)

71 
’d


72 
’d


74 -- 
TODO
 
we
 
should
 
®low
 
utimbuf
 
ªd
 
®so
 
bË
 
of
 
times
 
»®ly
; 
this
 
is
 
the
 
v”y
 
Şd
 1
s
 
´ecisiÚ
 
v”siÚ
, 
NB
 
Lšux
 
has
 
sysÿÎ


75 
nÙ
 
S
.
utime
 
th’


76 
funùiÚ
 
S
.
	$utime
(
·th
, 
aùime
, 
modtime
)

77 
loÿl
 
tv


78 
modtime
 = modtim
Ü
 
aùime


79 
aùime
 
ªd
 
modtime
 
th’
 
tv
 = {aùime, 
	}
modtime} 
’d


80  
S
.
	$utimes
(
·th
, 
tv
)

81 
’d


82 
’d


84 -- 
nÙ
 
a
 
sysÿÎ
 
š
 
Lšux


85 
S
.
utim’§t
 
ªd
 
nÙ
 S.
futim’s
 
th’


86 
funùiÚ
 
S
.
	$futim’s
(
fd
, 
times
)

87  
S
.
	$utim’§t
(
fd
, 
n
, 
times
, 0)

88 
’d


89 
’d


91 -- 
some
 
lšux
 
¬hc™eùu»s
 
eg
 
ARM
 dØ
nÙ
 
have
 
a
 
time
 
sysÿÎ


92 
nÙ
 
S
.
time
 
th’


93 
funùiÚ
 
S
.
	$time
(
t
)

94 
loÿl
 
tv
 = 
S
.
	$g‘timeofday
()

95 
t
 
th’
[0] = 
tv
.
£c
 
’d


96  
tv
.
£c


97 
’d


98 
’d


100 -- 
the
 
utimes
, 
futimes
, 
lutimes
 
¬e
 
Ëgacy
, 
but
 
OSX
/
F»eBSD
 dØ
nÙ
 
suµÜt
h
Çno£cÚd
 
v”siÚs


101 -- 
we
 
suµÜt
 
the
 
Ëgacy
 
v”siÚs
 
but
 dØ
nÙ
 
çke
h
mÜe
 
´eci£
 
Úes


102 
S
.
futimes
 = S.futime 
Ü
 S.
futim’s


103 
S
.
utim’§t
 
ªd
 
nÙ
 S.
lutimes
 
th’


104 
funùiÚ
 
S
.
	$lutimes
(
f’ame
, 
times
)

105  
S
.
	`utim’§t
("FDCWD", 
f’ame
, 
times
, "SYMLINK_NOFOLLOW")

106 
’d


107 
’d


108 
S
.
utim’§t
 
ªd
 
nÙ
 S.
utimes
 
th’


109 
funùiÚ
 
S
.
	$utimes
(
f’ame
, 
times
)

110  
S
.
	`utim’§t
("FDCWD", 
f’ame
, 
times
, 0)

111 
’d


112 
’d


114 
nÙ
 
S
.
wa™
 
th’


115 
funùiÚ
 
S
.
	$wa™
(
¡©us
è 
S
.
	`wa™pid
(-1, 0, stusè
’d


116 
’d


118 
S
.
wa™3
 = 
	$funùiÚ
(
İtiÚs
, 
ru§ge
, 
¡©us
è 
S
.
	`wa™4
(-1, o±iÚs,„u§ge, stusè
’d


120 
nÙ
 
S
.
wa™pid
 
ªd
 S.
wa™4
 
th’


121 
S
.
wa™pid
 = 
	$funùiÚ
(
pid
, 
İtiÚs
, 
¡©us
è 
S
.
	$wa™4
(
pid
, 
İtiÚs
, 
çl£
, 
¡©us
è
’d


122 
’d


124 
S
.
wa™4
 
ªd
 
nÙ
 S.
wa™
 
th’


125 
S
.
wa™
 = 
	$funùiÚ
(
¡©us
è 
S
.
	`wa™4
(-1, 0, 
çl£
, stusè
’d


126 
’d


128 
nÙ
 
S
.
Çno¦“p
 
th’


129 
funùiÚ
 
S
.
	$Çno¦“p
(
»q
, 
»m
)

130 
S
.
	`£Ëù
({
	}
}, 
	g»q
)

131 
»m
 
th’
 
	g»m
.
	g£c
,„em.
	gn£c
 = 0, 0 
	g’d
 -- 
ÿÂÙ
 
‹Î
 
how
 
much
 
time
 
	gËá
, 
could
 
be
 
š‹¼u±ed
 
by
 
a
 
	gsigÇl
.

132  
Œue


133 
’d


134 
	g’d


136 -- 
commÚ
 
libc
 
funùiÚ


137 
nÙ
 
	gS
.
¦“p
 
ªd
 S.
Çno¦“p
 
th’


138 
funùiÚ
 
	gS
.
	$¦“p
(
£c
)

139 
loÿl
 
ok
, 
”r
, 
»m
 = 
S
.
	$Çno¦“p
(
£c
)

140 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


141 
»m
 
th’
  
	$tÚumb”
(
»m
.
tv_£c
è
’d


143 
’d


144 
’d


146  
S


148 
’d


150  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/ffitypes.lua

1 -- 
the£
 
¬e
 
ty³s
 
which
‡» 
cu¼’y
 
the
 
§me
 
®l
 
	gpÜts


2 -- 
š
 
a
 
moduË
 
so
 
rump
 
dÛs
 
nÙ
 
impÜt
 
	gtwiû


3 -- 
nÙe
 
th©
 
ev’
 
ty³
 
is
 
	$§me
 (
like
 
pŞlfd
è
the
 
m‘©y³
 
is
 
difã»Á
 
ÿÂÙ
 
be
 
h”e
 
due
 
to
 
ffi


5 -- 
TODO
 
nÙ
 
su»
 
we
 
wªt
 
the£
 
‹rm
, 
m”ge
 
to
 
šdividu®
 
OS
 
fes
.

7 
loÿl
 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

8 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

9 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg
 =

10 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

11 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

12 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg


14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

16 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

18 
loÿl
 
defs
 = {
	}
}

20 
loÿl
 
funùiÚ
 
	$­³nd
(
¡r
è
defs
[#def + 1] = sŒ 
’d


22 
­³nd
 [[

24 
cc_t
;

27 
ušt16_t
 
š_pÜt_t
;

30 
ušt32_t
 
uid_t
;

31 
ušt32_t
 
gid_t
;

32 
št32_t
 
pid_t
;

34 
sockËn_t
;

37 
št64_t
 
off_t
;

40 
ssize_t
;

41 
size_t
;

44 (*
sig_t
)();

46 
	siovec
 {

47 *
iov_ba£
;

48 
size_t
 
iov_Ën
;

50 
	swšsize
 {

51 
ws_row
;

52 
ws_cŞ
;

53 
ws_xpix–
;

54 
ws_ypix–
;

56 
	sš_addr
 {

57 
ušt32_t
 
s_addr
;

59 
	sš6_addr
 {

60 
s6_addr
[16];

62 
	s‘hhdr
 {

63 
h_de¡
[6];

64 
h_sourû
[6];

65 
h_´Ùo
;

66 } 
	`__©Œibu‹__
((
·cked
));

67 
	sudphdr
 {

68 
ušt16_t
 
sourû
;

69 
ušt16_t
 
de¡
;

70 
ušt16_t
 
Ën
;

71 
ušt16_t
 
check
;

75 -- 
’dŸn
 
d•’d’t
 
TODO
 
nÙ
 
»®ly
, 
defše
 
š
 
šd•’d’t
 
way


76 
abi
.
Ë
 
th’


77 
­³nd
 [[

78 
	shdr
 {

79 
ušt8_t
 
ihl
:4,

80 
v”siÚ
:4;

81 
ušt8_t
 
tos
;

82 
ušt16_t
 
tÙ_Ën
;

83 
ušt16_t
 
id
;

84 
ušt16_t
 
äag_off
;

85 
ušt8_t
 
‰l
;

86 
ušt8_t
 
´ÙocŞ
;

87 
ušt16_t
 
check
;

88 
ušt32_t
 
§ddr
;

89 
ušt32_t
 
daddr
;

93 
­³nd
 [[

94 
	shdr
 {

95 
ušt8_t
 
v”siÚ
:4,

96 
ihl
:4;

97 
ušt8_t
 
tos
;

98 
ušt16_t
 
tÙ_Ën
;

99 
ušt16_t
 
id
;

100 
ušt16_t
 
äag_off
;

101 
ušt8_t
 
‰l
;

102 
ušt8_t
 
´ÙocŞ
;

103 
ušt16_t
 
check
;

104 
ušt32_t
 
§ddr
;

105 
ušt32_t
 
daddr
;

108 
’d


110 
ffi
.
	`cdef
(
bË
.
	`cÚÿt
(
defs
, ""))

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/c.lua

1 -- 
This
 
£ts
 
up
 
the
 
bË
 
of
 
C
 
funùiÚs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "syscall.freebsd.ffi"

16 
loÿl
 
voidp
 = 
ffi
.
ty³of
("void *")

18 
loÿl
 
funùiÚ
 (
x
)

19  
ffi
.
	$ÿ¡
(
voidp
, 
x
)

20 
’d


22 -- 
basiÿÎy
 
®l
 
ty³s
 
·s£d
 
to
 
sysÿÎs
 
¬e
 
Ü
 , 
so
 
we
 dØ
nÙ
 
Ãed
Ø
u£
 
niûly
 
Çmed
y³s, sØw
ÿn
 
avoid
 
impÜtšg
 
t
.

23 
loÿl
 , ğ
ffi
.
	`ty³of
("int"), ffi.typeof("long")

24 
loÿl
 
ušt
, 
ulÚg
 = 
ffi
.
	`ty³of
("unsigned int"), ffi.typeof("unsigned†ong")

26 
loÿl
 
funùiÚ
 
	$šlibc_â
(
k
è 
ffi
.
C
[k] 
’d


28 
loÿl
 
C
 = 
	`£tm‘©abË
({
	}
}, {

29 
	g__šdex
 = 
funùiÚ
(
C
, 
k
)

30 
pÿÎ
(
šlibc_â
, 
k
è
th’


31 
	gC
[
k
] = 
ffi
.
C
[k] -- 
add
 
to
 
bË
, 
so
 
no
 
Ãed
 
this
 
¦ow
 
·th
 
agaš


32  
	gC
[
k
]

34  
n


35 
’d


36 
	g’d


39 -- 
qu™e
 
a
 
ãw
 
F»eBSD
 
funùiÚs
 
¬e
 
w—k
 
®Ÿ£s
 
to
 
__sys_
 
´efixed
 
	gv”siÚs
, 
some
 
£em
Ø
»sŞve
 
but
 
Ùh”s
 dØ
	gnÙ
, 
	godd
.

40 
	gC
.
	gfutimes
 = 
C
.
__sys_futimes


41 
C
.
lutimes
 = C.
__sys_lutimes


42 
C
.
utimes
 = C.
__sys_utimes


43 
C
.
wa™4
 = C.
__sys_wa™4


44 
C
.
sigaùiÚ
 = C.
__sys_sigaùiÚ


46  
C


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/constants.lua

1 -- 
bËs
 
of
 
cÚ¡ªts
 
N‘BSD


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
	g£Ëù
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
£Ëù


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

14 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

16 
loÿl
 
où®
, 
	gmuÉiæags
, 
	gch¬æags
, 
	gsw­æags
, 
	g¡ræag
, 
	g©æag
, 
	gmodeæags


17 ğ
h
.
où®
, 
	gh
.
	gmuÉiæags
, h.
	gch¬æags
, h.
	gsw­æags
, h.
	g¡ræag
, h.
	g©æag
, h.
modeæags


19 
loÿl
 
	gv”siÚ
 = 
»quœe
 "sysÿÎ.ä“bsd.v”siÚ".
v”siÚ


21 
loÿl
 
ffi
 = 
»quœe
 "ffi"

23 
loÿl
 
funùiÚ
 
	$ch¬p
(
n
è 
ffi
.
	`ÿ¡
("ch¬ *",‚è
’d


25 
loÿl
 
c
 = {
	}
}

27 
c
.
”rÜÇmes
 = 
»quœe
 "syscall.freebsd.errors"

29 
c
.
STD
 = 
¡ræag
 {

30 
IN_FILENO
 = 0,

31 
	gOUT_FILENO
 = 1,

32 
	gERR_FILENO
 = 2,

33 
	gIN
 = 0,

34 
	gOUT
 = 1,

35 
	gERR
 = 2,

38 
	gc
.
	gPATH_MAX
 = 1024

40 
c
.
E
 = 
¡ræag
 {

41 
PERM
 = 1,

42 
	gNOENT
 = 2,

43 
	gSRCH
 = 3,

44 
	gINTR
 = 4,

45 
	gIO
 = 5,

46 
	gNXIO
 = 6,

48 
	gNOEXEC
 = 8,

49 
	gBADF
 = 9,

50 
	gCHILD
 = 10,

51 
	gDEADLK
 = 11,

52 
	gNOMEM
 = 12,

53 
	gACCES
 = 13,

54 
	gFAULT
 = 14,

55 
	gNOTBLK
 = 15,

56 
	gBUSY
 = 16,

57 
	gEXIST
 = 17,

58 
	gXDEV
 = 18,

59 
	gNODEV
 = 19,

60 
	gNOTDIR
 = 20,

61 
	gISDIR
 = 21,

62 
	gINVAL
 = 22,

63 
	gNFILE
 = 23,

64 
	gMFILE
 = 24,

65 
	gNOTTY
 = 25,

66 
	gTXTBSY
 = 26,

67 
	gFBIG
 = 27,

68 
	gNOSPC
 = 28,

69 
	gSPIPE
 = 29,

70 
	gROFS
 = 30,

71 
	gMLINK
 = 31,

72 
	gPIPE
 = 32,

73 
	gDOM
 = 33,

74 
	gRANGE
 = 34,

75 
	gAGAIN
 = 35,

76 
	gINPROGRESS
 = 36,

77 
	gALREADY
 = 37,

78 
	gNOTSOCK
 = 38,

79 
	gDESTADDRREQ
 = 39,

80 
	gMSGSIZE
 = 40,

81 
	gPROTOTYPE
 = 41,

82 
	gNOPROTOOPT
 = 42,

83 
	gPROTONOSUPPORT
= 43,

84 
	gSOCKTNOSUPPORT
= 44,

85 
	gOPNOTSUPP
 = 45,

86 
	gPFNOSUPPORT
 = 46,

87 
	gAFNOSUPPORT
 = 47,

88 
	gADDRINUSE
 = 48,

89 
	gADDRNOTAVAIL
 = 49,

90 
	gNETDOWN
 = 50,

91 
	gNETUNREACH
 = 51,

92 
	gNETRESET
 = 52,

93 
	gCONNABORTED
 = 53,

94 
	gCONNRESET
 = 54,

95 
	gNOBUFS
 = 55,

96 
	gISCONN
 = 56,

97 
	gNOTCONN
 = 57,

98 
	gSHUTDOWN
 = 58,

99 
	gTOOMANYREFS
 = 59,

100 
	gTIMEDOUT
 = 60,

101 
	gCONNREFUSED
 = 61,

102 
	gLOOP
 = 62,

103 
	gNAMETOOLONG
 = 63,

104 
	gHOSTDOWN
 = 64,

105 
	gHOSTUNREACH
 = 65,

106 
	gNOTEMPTY
 = 66,

107 
	gPROCLIM
 = 67,

108 
	gUSERS
 = 68,

109 
	gDQUOT
 = 69,

110 
	gSTALE
 = 70,

111 
	gREMOTE
 = 71,

112 
	gBADRPC
 = 72,

113 
	gBADRPC
 = 72,

114 
	gRPCMISMATCH
 = 73,

115 
	gPROGUNAVAIL
 = 74,

116 
	gPROGMISMATCH
 = 75,

117 
	gPROCUNAVAIL
 = 76,

118 
	gNOLCK
 = 77,

119 
	gNOSYS
 = 78,

120 
	gFTYPE
 = 79,

121 
	gAUTH
 = 80,

122 
	gNEEDAUTH
 = 81,

123 
	gIDRM
 = 82,

124 
	gNOMSG
 = 83,

125 
	gOVERFLOW
 = 84,

126 
	gCANCELED
 = 85,

127 
	gILSEQ
 = 86,

128 
	gNOATTR
 = 87,

129 
	gDOOFUS
 = 88,

130 
	gBADMSG
 = 89,

131 
	gMULTIHOP
 = 90,

132 
	gNOLINK
 = 91,

133 
	gPROTO
 = 92,

134 
	gNOTCAPABLE
 = 93,

135 
	gCAPMODE
 = 94,

138 
	gv”siÚ
 >ğ10 
th’


139 
c
.
E
.
NOTRECOVERABLE
= 95

140 
c
.
E
.
OWNERDEAD
 = 96

141 
’d


143 -- 
®‹º©e
 
Çmes


144 
c
.
EALIAS
 = {

145 
WOULDBLOCK
 = 
c
.
E
.
AGAIN
,

148 
	gc
.
	gAF
 = 
¡ræag
 {

149 
UNSPEC
 = 0,

150 
	gLOCAL
 = 1,

151 
	gINET
 = 2,

152 
	gIMPLINK
 = 3,

153 
	gPUP
 = 4,

154 
	gCHAOS
 = 5,

155 
	gNETBIOS
 = 6,

156 
	gISO
 = 7,

157 
	gECMA
 = 8,

158 
	gDATAKIT
 = 9,

159 
	gCCITT
 = 10,

160 
	gSNA
 = 11,

161 
	gDECNET
 = 12,

162 
	gDLI
 = 13,

163 
	gLAT
 = 14,

164 
	gHYLINK
 = 15,

165 
	gAPPLETALK
 = 16,

166 
	gROUTE
 = 17,

167 
	gLINK
 = 18,

168 - #defš
	#p£udo_AF_XTP
 19

	)

169 
	gCOIP
 = 20,

170 
	gCNT
 = 21,

171 - #defš
	#p£udo_AF_RTIP
 22

	)

172 
	gIPX
 = 23,

173 
	gSIP
 = 24,

174 -- 
	gp£udo_AF_PIP
 25

175 
	gISDN
 = 26,

176 -- 
	gp£udo_AF_KEY
 27

177 
	gINET6
 = 28,

178 
	gNATM
 = 29,

179 
	gATM
 = 30,

180 -- 
	gp£udo_AF_HDRCMPLT
 31

181 
	gNETGRAPH
 = 32,

182 
	gSLOW
 = 33,

183 
	gSCLUSTER
 = 34,

184 
	gARP
 = 35,

185 
	gBLUETOOTH
 = 36,

186 
	gIEEE80211
 = 37,

189 
	gc
.
	gAF
.
	gUNIX
 = 
c
.
AF
.
LOCAL


190 
c
.
AF
.
OSI
 = c.AF.
ISO


191 
c
.
AF
.
E164
 = c.AF.
ISDN


193 
v”siÚ
 >ğ10 
th’


194 
c
.
AF
.
INET_SDP
 = 40

195 
c
.
AF
.
INET6_SDP
 = 42

196 
’d


198 
c
.
O
 = 
muÉiæags
 {

199 
RDONLY
 = 0x0000,

200 
	gWRONLY
 = 0x0001,

201 
	gRDWR
 = 0x0002,

202 
	gACCMODE
 = 0x0003,

203 
	gNONBLOCK
 = 0x0004,

204 
	gAPPEND
 = 0x0008,

205 
	gSHLOCK
 = 0x0010,

206 
	gEXLOCK
 = 0x0020,

207 
	gASYNC
 = 0x0040,

208 
	gFSYNC
 = 0x0080,

209 
	gSYNC
 = 0x0080,

210 
	gNOFOLLOW
 = 0x0100,

211 
	gCREAT
 = 0x0200,

212 
	gTRUNC
 = 0x0400,

213 
	gEXCL
 = 0x0800,

214 
	gNOCTTY
 = 0x8000,

215 
	gDIRECT
 = 0x00010000,

216 
	gDIRECTORY
 = 0x00020000,

217 
	gEXEC
 = 0x00040000,

218 
	gTTY_INIT
 = 0x00080000,

219 
	gCLOEXEC
 = 0x00100000,

222 -- 
	gpe2
, 
£Ëùed
 
æags
 
äom
 
	gc
.
O


223 
	gc
.
	gOPIPE
 = 
muÉiæags
 {

224 
NONBLOCK
 = 0x0004,

225 
	gCLOEXEC
 = 0x00100000,

228 -- 
	gsigaùiÚ
, 
nÙe
 
»Çmed
 
SIGACT
 
äom
 
SIG_


229 
	gc
.
	gSIGACT
 = 
¡ræag
 {

230 
ERR
 = -1,

231 
	gDFL
 = 0,

232 
	gIGN
 = 1,

233 
	gHOLD
 = 3,

236 
	gc
.
	gSIGEV
 = 
¡ræag
 {

237 
NONE
 = 0,

238 
	gSIGNAL
 = 1,

239 
	gTHREAD
 = 2,

240 
	gKEVENT
 = 3,

241 
	gTHREAD_ID
 = 4,

244 
	gc
.
	gSIG
 = 
¡ræag
 {

245 
HUP
 = 1,

246 
	gINT
 = 2,

247 
	gQUIT
 = 3,

248 
	gILL
 = 4,

249 
	gTRAP
 = 5,

250 
	gABRT
 = 6,

251 
	gEMT
 = 7,

252 
	gFPE
 = 8,

253 
	gKILL
 = 9,

254 
	gBUS
 = 10,

255 
	gSEGV
 = 11,

256 
	gSYS
 = 12,

257 
	gPIPE
 = 13,

258 
	gALRM
 = 14,

259 
	gTERM
 = 15,

260 
	gURG
 = 16,

261 
	gSTOP
 = 17,

262 
	gTSTP
 = 18,

263 
	gCONT
 = 19,

264 
	gCHLD
 = 20,

265 
	gTTIN
 = 21,

266 
	gTTOU
 = 22,

267 
	gIO
 = 23,

268 
	gXCPU
 = 24,

269 
	gXFSZ
 = 25,

270 
	gVTALRM
 = 26,

271 
	gPROF
 = 27,

272 
	gWINCH
 = 28,

273 
	gINFO
 = 29,

274 
	gUSR1
 = 30,

275 
	gUSR2
 = 31,

276 
	gTHR
 = 32,

279 
	gv”siÚ
 >=10 
th’
 
c
.
SIG
.
LIBRT
 = 33 
’d


282 
c
.
SIG
.
LWP
 = c.SIG.
THR


284 
c
.
EXIT
 = 
¡ræag
 {

285 
SUCCESS
 = 0,

286 
	gFAILURE
 = 1,

289 
	gc
.
	gOK
 = 
ch¬æags
 {

290 
F
 = 0,

291 
	gX
 = 0x01,

292 
	gW
 = 0x02,

293 
	gR
 = 0x04,

296 
	gc
.
	gMODE
 = 
modeæags
 {

297 
SUID
 = 
où®
('04000'),

298 
	gSGID
 = 
où®
('02000'),

299 
	gSTXT
 = 
où®
('01000'),

300 
	gRWXU
 = 
où®
('00700'),

301 
	gRUSR
 = 
où®
('00400'),

302 
	gWUSR
 = 
où®
('00200'),

303 
	gXUSR
 = 
où®
('00100'),

304 
	gRWXG
 = 
où®
('00070'),

305 
	gRGRP
 = 
où®
('00040'),

306 
	gWGRP
 = 
où®
('00020'),

307 
	gXGRP
 = 
où®
('00010'),

308 
	gRWXO
 = 
où®
('00007'),

309 
	gROTH
 = 
où®
('00004'),

310 
	gWOTH
 = 
où®
('00002'),

311 
	gXOTH
 = 
où®
('00001'),

314 
	gc
.
	gSEEK
 = 
¡ræag
 {

315 
SET
 = 0,

316 
	gCUR
 = 1,

317 
	gEND
 = 2,

318 
	gDATA
 = 3,

319 
	gHOLE
 = 4,

322 
	gc
.
	gSOCK
 = 
muÉiæags
 {

323 
STREAM
 = 1,

324 
	gDGRAM
 = 2,

325 
	gRAW
 = 3,

326 
	gRDM
 = 4,

327 
	gSEQPACKET
 = 5,

330 
	gv”siÚ
 >ğ10 
th’


331 
c
.
SOCK
.
CLOEXEC
 = 0x10000000

332 
c
.
SOCK
.
NONBLOCK
 = 0x20000000

333 
’d


335 
c
.
SOL
 = 
¡ræag
 {

336 
SOCKET
 = 0xffff,

339 
	gc
.
	gPOLL
 = 
muÉiæags
 {

340 
IN
 = 0x0001,

341 
	gPRI
 = 0x0002,

342 
	gOUT
 = 0x0004,

343 
	gRDNORM
 = 0x0040,

344 
	gRDBAND
 = 0x0080,

345 
	gWRBAND
 = 0x0100,

346 
	gINIGNEOF
 = 0x2000,

347 
	gERR
 = 0x0008,

348 
	gHUP
 = 0x0010,

349 
	gNVAL
 = 0x0020,

352 
	gc
.
	gPOLL
.
	gWRNORM
 = 
c
.
POLL
.
OUT


353 
c
.
POLL
.
STANDARD
 = c.POLL["IN,PRI,OUT,RDNORM,RDBAND,WRBAND,ERR,HUP,NVAL"]

355 
c
.
AT_FDCWD
 = 
©æag
 {

356 
FDCWD
 = -100,

359 
	gc
.
	gAT
 = 
muÉiæags
 {

360 
EACCESS
 = 0x100,

361 
	gSYMLINK_NOFOLLOW
 = 0x200,

362 
	gSYMLINK_FOLLOW
 = 0x400,

363 
	gREMOVEDIR
 = 0x800,

366 
	gc
.
	gS_I
 = 
modeæags
 {

367 
FMT
 = 
où®
('0170000'),

368 
	gFWHT
 = 
où®
('0160000'),

369 
	gFSOCK
 = 
où®
('0140000'),

370 
	gFLNK
 = 
où®
('0120000'),

371 
	gFREG
 = 
où®
('0100000'),

372 
	gFBLK
 = 
où®
('0060000'),

373 
	gFDIR
 = 
où®
('0040000'),

374 
	gFCHR
 = 
où®
('0020000'),

375 
	gFIFO
 = 
où®
('0010000'),

376 
	gSUID
 = 
où®
('0004000'),

377 
	gSGID
 = 
où®
('0002000'),

378 
	gSVTX
 = 
où®
('0001000'),

379 
	gSTXT
 = 
où®
('0001000'),

380 
	gRWXU
 = 
où®
('00700'),

381 
	gRUSR
 = 
où®
('00400'),

382 
	gWUSR
 = 
où®
('00200'),

383 
	gXUSR
 = 
où®
('00100'),

384 
	gRWXG
 = 
où®
('00070'),

385 
	gRGRP
 = 
où®
('00040'),

386 
	gWGRP
 = 
où®
('00020'),

387 
	gXGRP
 = 
où®
('00010'),

388 
	gRWXO
 = 
où®
('00007'),

389 
	gROTH
 = 
où®
('00004'),

390 
	gWOTH
 = 
où®
('00002'),

391 
	gXOTH
 = 
où®
('00001'),

394 
	gc
.
	gS_I
.
	gREAD
 = 
c
.
S_I
.
RUSR


395 
c
.
S_I
.
WRITE
 = c.S_I.
WUSR


396 
c
.
S_I
.
EXEC
 = c.S_I.
XUSR


398 
c
.
PROT
 = 
muÉiæags
 {

399 
NONE
 = 0x0,

400 
	gREAD
 = 0x1,

401 
	gWRITE
 = 0x2,

402 
	gEXEC
 = 0x4,

405 
	gc
.
	gMAP
 = 
muÉiæags
 {

406 
SHARED
 = 0x0001,

407 
	gPRIVATE
 = 0x0002,

408 
	gFILE
 = 0x0000,

409 
	gFIXED
 = 0x0010,

410 
	gRENAME
 = 0x0020,

411 
	gNORESERVE
 = 0x0040,

412 
	gRESERVED0080
 = 0x0080,

413 
	gRESERVED0100
 = 0x0100,

414 
	gHASSEMAPHORE
 = 0x0200,

415 
	gSTACK
 = 0x0400,

416 
	gNOSYNC
 = 0x0800,

417 
	gANON
 = 0x1000,

418 
	gNOCORE
 = 0x00020000,

419 -- 
TODO
 
add
 
®igÃd
 
m­s
 
	gš


422 
	gabi
.
abi64
 
ªd
 
	gv”siÚ
 >ğ10 
th’
 
c
.
MAP
["32BIT"] = 0x00080000 
’d


424 
c
.
MCL
 = 
¡ræag
 {

425 
CURRENT
 = 0x01,

426 
	gFUTURE
 = 0x02,

429 -- 
æags
 
	gto
 `
	gmsync
'. -‚ote was MS_„enamedo MSYNC_

430 
	gc
.
	gMSYNC
 = 
muÉiæags
 {

431 
SYNC
 = 0x0000,

432 
	gASYNC
 = 0x0001,

433 
	gINVALIDATE
 = 0x0002,

436 
	gc
.
	gMADV
 = 
¡ræag
 {

437 
NORMAL
 = 0,

438 
	gRANDOM
 = 1,

439 
	gSEQUENTIAL
 = 2,

440 
	gWILLNEED
 = 3,

441 
	gDONTNEED
 = 4,

442 
	gFREE
 = 5,

443 
	gNOSYNC
 = 6,

444 
	gAUTOSYNC
 = 7,

445 
	gNOCORE
 = 8,

446 
	gCORE
 = 9,

447 
	gPROTECT
 = 10,

450 
	gc
.
	gIPPROTO
 = 
¡ræag
 {

451 
IP
 = 0,

452 
	gHOPOPTS
 = 0,

453 
	gICMP
 = 1,

454 
	gIGMP
 = 2,

455 
	gGGP
 = 3,

456 
	gIPV4
 = 4,

457 
	gIPIP
 = 4,

458 
	gTCP
 = 6,

459 
	gST
 = 7,

460 
	gEGP
 = 8,

461 
	gPIGP
 = 9,

462 
	gRCCMON
 = 10,

463 
	gNVPII
 = 11,

464 
	gPUP
 = 12,

465 
	gARGUS
 = 13,

466 
	gEMCON
 = 14,

467 
	gXNET
 = 15,

468 
	gCHAOS
 = 16,

469 
	gUDP
 = 17,

470 
	gMUX
 = 18,

471 
	gMEAS
 = 19,

472 
	gHMP
 = 20,

473 
	gPRM
 = 21,

474 
	gIDP
 = 22,

475 
	gTRUNK1
 = 23,

476 
	gTRUNK2
 = 24,

477 
	gLEAF1
 = 25,

478 
	gLEAF2
 = 26,

479 
	gRDP
 = 27,

480 
	gIRTP
 = 28,

481 
	gTP
 = 29,

482 
	gBLT
 = 30,

483 
	gNSP
 = 31,

484 
	gINP
 = 32,

485 
	gSEP
 = 33,

487 
	gIDPR
 = 35,

488 
	gXTP
 = 36,

489 
	gDDP
 = 37,

490 
	gCMTP
 = 38,

491 
	gTPXX
 = 39,

492 
	gIL
 = 40,

493 
	gIPV6
 = 41,

494 
	gSDRP
 = 42,

495 
	gROUTING
 = 43,

496 
	gFRAGMENT
 = 44,

497 
	gIDRP
 = 45,

498 
	gRSVP
 = 46,

499 
	gGRE
 = 47,

500 
	gMHRP
 = 48,

501 
	gBHA
 = 49,

502 
	gESP
 = 50,

503 
	gAH
 = 51,

504 
	gINLSP
 = 52,

505 
	gSWIPE
 = 53,

506 
	gNHRP
 = 54,

507 
	gMOBILE
 = 55,

508 
	gTLSP
 = 56,

509 
	gSKIP
 = 57,

510 
	gICMPV6
 = 58,

511 
	gNONE
 = 59,

512 
	gDSTOPTS
 = 60,

513 
	gAHIP
 = 61,

514 
	gCFTP
 = 62,

515 
	gHELLO
 = 63,

516 
	gSATEXPAK
 = 64,

517 
	gKRYPTOLAN
 = 65,

518 
	gRVD
 = 66,

519 
	gIPPC
 = 67,

520 
	gADFS
 = 68,

521 
	gSATMON
 = 69,

522 
	gVISA
 = 70,

523 
	gIPCV
 = 71,

524 
	gCPNX
 = 72,

525 
	gCPHB
 = 73,

526 
	gWSN
 = 74,

527 
	gPVP
 = 75,

528 
	gBRSATMON
 = 76,

529 
	gND
 = 77,

530 
	gWBMON
 = 78,

531 
	gWBEXPAK
 = 79,

532 
	gEON
 = 80,

533 
	gVMTP
 = 81,

534 
	gSVMTP
 = 82,

535 
	gVINES
 = 83,

536 
	gTTP
 = 84,

537 
	gIGP
 = 85,

538 
	gDGP
 = 86,

539 
	gTCF
 = 87,

540 
	gIGRP
 = 88,

541 
	gOSPFIGP
 = 89,

542 
	gSRPC
 = 90,

543 
	gLARP
 = 91,

544 
	gMTP
 = 92,

545 
	gAX25
 = 93,

546 
	gIPEIP
 = 94,

547 
	gMICP
 = 95,

548 
	gSCCSP
 = 96,

549 
	gETHERIP
 = 97,

550 
	gENCAP
 = 98,

551 
	gAPES
 = 99,

552 
	gGMTP
 = 100,

553 
	gIPCOMP
 = 108,

554 
	gSCTP
 = 132,

555 
	gMH
 = 135,

556 
	gPIM
 = 103,

557 
	gCARP
 = 112,

558 
	gPGM
 = 113,

559 
	gMPLS
 = 137,

560 
	gPFSYNC
 = 240,

561 
	gRAW
 = 255,

564 
	gc
.
	gSCM
 = 
muÉiæags
 {

565 
RIGHTS
 = 0x01,

566 
	gTIMESTAMP
 = 0x02,

567 
	gCREDS
 = 0x03,

568 
	gBINTIME
 = 0x04,

571 
	gc
.
	gF
 = 
¡ræag
 {

572 
DUPFD
 = 0,

573 
	gGETFD
 = 1,

574 
	gSETFD
 = 2,

575 
	gGETFL
 = 3,

576 
	gSETFL
 = 4,

577 
	gGETOWN
 = 5,

578 
	gSETOWN
 = 6,

579 
	gOGETLK
 = 7,

580 
	gOSETLK
 = 8,

581 
	gOSETLKW
 = 9,

582 
	gDUP2FD
 = 10,

583 
	gGETLK
 = 11,

584 
	gSETLK
 = 12,

585 
	gSETLKW
 = 13,

586 
	gSETLK_REMOTE
= 14,

587 
	gREADAHEAD
 = 15,

588 
	gRDAHEAD
 = 16,

589 
	gDUPFD_CLOEXEC
= 17,

590 
	gDUP2FD_CLOEXEC
= 18,

593 
	gc
.
	gFD
 = 
muÉiæags
 {

594 
CLOEXEC
 = 1,

597 -- 
nÙe
 
chªged
 
äom
 
F_
 
to
 
FCNTL_LOCK


598 
	gc
.
	gFCNTL_LOCK
 = 
¡ræag
 {

599 
RDLCK
 = 1,

600 
	gUNLCK
 = 2,

601 
	gWRLCK
 = 3,

602 
	gUNLCKSYS
 = 4,

603 
	gCANCEL
 = 5,

606 -- 
	glockf
, 
chªged
 
äom
 
F_
 
to
 
LOCKF_


607 
	gc
.
	gLOCKF
 = 
¡ræag
 {

608 
ULOCK
 = 0,

609 
	gLOCK
 = 1,

610 
	gTLOCK
 = 2,

611 
	gTEST
 = 3,

614 -- 
	$æock
 (2)

615 
c
.
LOCK
 = 
muÉiæags
 {

616 
SH
 = 0x01,

617 
EX
 = 0x02,

618 
NB
 = 0x04,

619 
UN
 = 0x08,

620 
	}
}

622 
	gc
.
	gW
 = 
muÉiæags
 {

623 
NOHANG
 = 1,

624 
	gUNTRACED
 = 2,

625 
	gCONTINUED
 = 4,

626 
	gNOWAIT
 = 8,

627 
	gEXITED
 = 16,

628 
	gTRAPPED
 = 32,

629 
	gLINUXCLONE
 = 0x80000000,

632 
	gc
.
	gW
.
	gSTOPPED
 = 
c
.
W
.
UNTRACED


634 -- 
wa™pid
 
ªd
 
wa™4
 
pid


635 
c
.
WAIT
 = 
¡ræag
 {

636 
ANY
 = -1,

637 
	gMYPGRP
 = 0,

640 
	gc
.
	gMSG
 = 
muÉiæags
 {

641 
OOB
 = 0x1,

642 
	gPEEK
 = 0x2,

643 
	gDONTROUTE
 = 0x4,

644 
	gEOR
 = 0x8,

645 
	gTRUNC
 = 0x10,

646 
	gCTRUNC
 = 0x20,

647 
	gWAITALL
 = 0x40,

648 
	gDONTWAIT
 = 0x80,

649 
	gEOF
 = 0x100,

650 
	gNOTIFICATION
 = 0x2000,

651 
	gNBIO
 = 0x4000,

652 
	gCOMPAT
 = 0x8000,

653 
	gNOSIGNAL
 = 0x20000,

656 
	gv”siÚ
 >ğ10 
th’
 
c
.
MSG
.
CMSG_CLOEXEC
 = 0x40000 
’d


658 
c
.
PC
 = 
¡ræag
 {

659 
LINK_MAX
 = 1,

660 
	gMAX_CANON
 = 2,

661 
	gMAX_INPUT
 = 3,

662 
	gNAME_MAX
 = 4,

663 
	gPATH_MAX
 = 5,

664 
	gPIPE_BUF
 = 6,

665 
	gCHOWN_RESTRICTED
 = 7,

666 
	gNO_TRUNC
 = 8,

667 
	gVDISABLE
 = 9,

668 
	gALLOC_SIZE_MIN
 = 10,

669 
	gFILESIZEBITS
 = 12,

670 
	gREC_INCR_XFER_SIZE
= 14,

671 
	gREC_MAX_XFER_SIZE
 = 15,

672 
	gREC_MIN_XFER_SIZE
 = 16,

673 
	gREC_XFER_ALIGN
 = 17,

674 
	gSYMLINK_MAX
 = 18,

675 
	gMIN_HOLE_SIZE
 = 21,

676 
	gASYNC_IO
 = 53,

677 
	gPRIO_IO
 = 54,

678 
	gSYNC_IO
 = 55,

679 
	gACL_EXTENDED
 = 59,

680 
	gACL_PATH_MAX
 = 60,

681 
	gCAP_PRESENT
 = 61,

682 
	gINF_PRESENT
 = 62,

683 
	gMAC_PRESENT
 = 63,

684 
	gACL_NFS4
 = 64,

687 -- 
	gg‘´iÜ™y
, 
£riÜ™y
 
æags


688 
	gc
.
	gPRIO
 = 
¡ræag
 {

689 
PROCESS
 = 0,

690 
	gPGRP
 = 1,

691 
	gUSER
 = 2,

692 
	gMIN
 = -20, -- 
TODO
 
u£ful
 
to
 
have
 
Ùh”
 
OSs


693 
	gMAX
 = 20,

696 
	gc
.
	gRUSAGE
 = 
¡ræag
 {

697 
SELF
 = 0,

698 
	gCHILDREN
 = -1,

699 
	gTHREAD
 = 1,

702 
	gc
.
	gSOMAXCONN
 = 128

704 
c
.
SO
 = 
¡ræag
 {

705 
DEBUG
 = 0x0001,

706 
	gACCEPTCONN
 = 0x0002,

707 
	gREUSEADDR
 = 0x0004,

708 
	gKEEPALIVE
 = 0x0008,

709 
	gDONTROUTE
 = 0x0010,

710 
	gBROADCAST
 = 0x0020,

711 
	gUSELOOPBACK
 = 0x0040,

712 
	gLINGER
 = 0x0080,

713 
	gOOBINLINE
 = 0x0100,

714 
	gREUSEPORT
 = 0x0200,

715 
	gTIMESTAMP
 = 0x0400,

716 
	gNOSIGPIPE
 = 0x0800,

717 
	gACCEPTFILTER
 = 0x1000,

718 
	gBINTIME
 = 0x2000,

719 
	gNO_OFFLOAD
 = 0x4000,

720 
	gNO_DDP
 = 0x8000,

721 
	gSNDBUF
 = 0x1001,

722 
	gRCVBUF
 = 0x1002,

723 
	gSNDLOWAT
 = 0x1003,

724 
	gRCVLOWAT
 = 0x1004,

725 
	gSNDTIMEO
 = 0x1005,

726 
	gRCVTIMEO
 = 0x1006,

727 
	gERROR
 = 0x1007,

728 
	gTYPE
 = 0x1008,

729 
	gLABEL
 = 0x1009,

730 
	gPEERLABEL
 = 0x1010,

731 
	gLISTENQLIMIT
 = 0x1011,

732 
	gLISTENQLEN
 = 0x1012,

733 
	gLISTENINCQLEN
= 0x1013,

734 
	gSETFIB
 = 0x1014,

735 
	gUSER_COOKIE
 = 0x1015,

736 
	gPROTOCOL
 = 0x1016,

739 
	gc
.
	gSO
.
	gPROTOTYPE
 = 
c
.
SO
.
PROTOCOL


741 
c
.
DT
 = 
¡ræag
 {

742 
UNKNOWN
 = 0,

743 
	gFIFO
 = 1,

744 
	gCHR
 = 2,

745 
	gDIR
 = 4,

746 
	gBLK
 = 6,

747 
	gREG
 = 8,

748 
	gLNK
 = 10,

749 
	gSOCK
 = 12,

750 
	gWHT
 = 14,

753 
	gc
.
	gIP
 = 
¡ræag
 {

754 
OPTIONS
 = 1,

755 
	gHDRINCL
 = 2,

756 
	gTOS
 = 3,

757 
	gTTL
 = 4,

758 
	gRECVOPTS
 = 5,

759 
	gRECVRETOPTS
 = 6,

760 
	gRECVDSTADDR
 = 7,

761 
	gRETOPTS
 = 8,

762 
	gMULTICAST_IF
 = 9,

763 
	gMULTICAST_TTL
 = 10,

764 
	gMULTICAST_LOOP
 = 11,

765 
	gADD_MEMBERSHIP
 = 12,

766 
	gDROP_MEMBERSHIP
 = 13,

767 
	gMULTICAST_VIF
 = 14,

768 
	gRSVP_ON
 = 15,

769 
	gRSVP_OFF
 = 16,

770 
	gRSVP_VIF_ON
 = 17,

771 
	gRSVP_VIF_OFF
 = 18,

772 
	gPORTRANGE
 = 19,

773 
	gRECVIF
 = 20,

774 
	gIPSEC_POLICY
 = 21,

775 
	gFAITH
 = 22,

776 
	gONESBCAST
 = 23,

777 
	gBINDANY
 = 24,

778 
	gFW_TABLE_ADD
 = 40,

779 
	gFW_TABLE_DEL
 = 41,

780 
	gFW_TABLE_FLUSH
 = 42,

781 
	gFW_TABLE_GETSIZE
 = 43,

782 
	gFW_TABLE_LIST
 = 44,

783 
	gFW3
 = 48,

784 
	gDUMMYNET3
 = 49,

785 
	gFW_ADD
 = 50,

786 
	gFW_DEL
 = 51,

787 
	gFW_FLUSH
 = 52,

788 
	gFW_ZERO
 = 53,

789 
	gFW_GET
 = 54,

790 
	gFW_RESETLOG
 = 55,

791 
	gFW_NAT_CFG
 = 56,

792 
	gFW_NAT_DEL
 = 57,

793 
	gFW_NAT_GET_CONFIG
 = 58,

794 
	gFW_NAT_GET_LOG
 = 59,

795 
	gDUMMYNET_CONFIGURE
 = 60,

796 
	gDUMMYNET_DEL
 = 61,

797 
	gDUMMYNET_FLUSH
 = 62,

798 
	gDUMMYNET_GET
 = 64,

799 
	gRECVTTL
 = 65,

800 
	gMINTTL
 = 66,

801 
	gDONTFRAG
 = 67,

802 
	gRECVTOS
 = 68,

803 
	gADD_SOURCE_MEMBERSHIP
 = 70,

804 
	gDROP_SOURCE_MEMBERSHIP
 = 71,

805 
	gBLOCK_SOURCE
 = 72,

806 
	gUNBLOCK_SOURCE
 = 73,

809 
	gc
.
	gIP
.
	gSENDSRCADDR
 = 
c
.
IP
.
RECVDSTADDR


811 -- 
Baud
 
¿‹s
 
ju¡
 
the
 
id’t™y
 
funùiÚ
 
Ùh”
 
thª
 
EXTA
, 
EXTB


812 
	gc
.
	gB
 = 
¡ræag
 {

813 
EXTA
 = 19200,

814 
	gEXTB
 = 38400,

817 
	gc
.
	gCC
 = 
¡ræag
 {

818 
VEOF
 = 0,

819 
	gVEOL
 = 1,

820 
	gVEOL2
 = 2,

821 
	gVERASE
 = 3,

822 
	gVWERASE
 = 4,

823 
	gVKILL
 = 5,

824 
	gVREPRINT
 = 6,

825 
	gVINTR
 = 8,

826 
	gVQUIT
 = 9,

827 
	gVSUSP
 = 10,

828 
	gVDSUSP
 = 11,

829 
	gVSTART
 = 12,

830 
	gVSTOP
 = 13,

831 
	gVLNEXT
 = 14,

832 
	gVDISCARD
 = 15,

833 
	gVMIN
 = 16,

834 
	gVTIME
 = 17,

835 
	gVSTATUS
 = 18,

838 
	gc
.
	gIFLAG
 = 
muÉiæags
 {

839 
IGNBRK
 = 0x00000001,

840 
	gBRKINT
 = 0x00000002,

841 
	gIGNPAR
 = 0x00000004,

842 
	gPARMRK
 = 0x00000008,

843 
	gINPCK
 = 0x00000010,

844 
	gISTRIP
 = 0x00000020,

845 
	gINLCR
 = 0x00000040,

846 
	gIGNCR
 = 0x00000080,

847 
	gICRNL
 = 0x00000100,

848 
	gIXON
 = 0x00000200,

849 
	gIXOFF
 = 0x00000400,

850 
	gIXANY
 = 0x00000800,

851 
	gIMAXBEL
 = 0x00002000,

854 
	gc
.
	gOFLAG
 = 
muÉiæags
 {

855 
OPOST
 = 0x00000001,

856 
	gONLCR
 = 0x00000002,

857 
	gOXTABS
 = 0x00000004,

858 
	gONOEOT
 = 0x00000008,

859 
	gOCRNL
 = 0x00000010,

860 
	gONOCR
 = 0x00000020,

861 
	gONLRET
 = 0x00000040,

864 
	gc
.
	gCFLAG
 = 
muÉiæags
 {

865 
CIGNORE
 = 0x00000001,

866 
	gCSIZE
 = 0x00000300,

867 
	gCS5
 = 0x00000000,

868 
	gCS6
 = 0x00000100,

869 
	gCS7
 = 0x00000200,

870 
	gCS8
 = 0x00000300,

871 
	gCSTOPB
 = 0x00000400,

872 
	gCREAD
 = 0x00000800,

873 
	gPARENB
 = 0x00001000,

874 
	gPARODD
 = 0x00002000,

875 
	gHUPCL
 = 0x00004000,

876 
	gCLOCAL
 = 0x00008000,

877 
	gCCTS_OFLOW
 = 0x00010000,

878 
	gCRTS_IFLOW
 = 0x00020000,

879 
	gCDTR_IFLOW
 = 0x00040000,

880 
	gCDSR_OFLOW
 = 0x00080000,

881 
	gCCAR_OFLOW
 = 0x00100000,

884 
	gc
.
	gCFLAG
.
	gCRTSCTS
 = 
c
.
CFLAG
.
CCTS_OFLOW
 + c.CFLAG.
CRTS_IFLOW


886 
c
.
LFLAG
 = 
muÉiæags
 {

887 
ECHOKE
 = 0x00000001,

888 
	gECHOE
 = 0x00000002,

889 
	gECHOK
 = 0x00000004,

890 
	gECHO
 = 0x00000008,

891 
	gECHONL
 = 0x00000010,

892 
	gECHOPRT
 = 0x00000020,

893 
	gECHOCTL
 = 0x00000040,

894 
	gISIG
 = 0x00000080,

895 
	gICANON
 = 0x00000100,

896 
	gALTWERASE
 = 0x00000200,

897 
	gIEXTEN
 = 0x00000400,

898 
	gEXTPROC
 = 0x00000800,

899 
	gTOSTOP
 = 0x00400000,

900 
	gFLUSHO
 = 0x00800000,

901 
	gNOKERNINFO
 = 0x02000000,

902 
	gPENDIN
 = 0x20000000,

903 
	gNOFLSH
 = 0x80000000,

906 
	gc
.
	gTCSA
 = 
muÉiæags
 { -- 
this
 
is
 
ªÙh”
 
odd
 
Úe
, 
wh”e
 
you
 
ÿn
 
have
 oÃ 
æag
 
¶us
 
SOFT


907 
NOW
 = 0,

908 
	gDRAIN
 = 1,

909 
	gFLUSH
 = 2,

910 
	gSOFT
 = 0x10,

913 -- 
tcæush
(), 
»Çmed
 
äom
 
TC
 
to
 
TCFLUSH


914 
	gc
.
	gTCFLUSH
 = 
¡ræag
 {

915 
IFLUSH
 = 1,

916 
	gOFLUSH
 = 2,

917 
	gIOFLUSH
 = 3,

920 -- 
	g‹rmios
 - 
	$tcæow
(è
ªd
 
TCXONC
 
u£
 
the£
. 
»Çmed
 
äom
 
TC
 
to
 
TCFLOW


921 
c
.
TCFLOW
 = 
¡ræag
 {

922 
OOFF
 = 1,

923 
OON
 = 2,

924 
IOFF
 = 3,

925 
ION
 = 4,

926 
	}
}

928 -- 
chæags
 
ªd
 
	g¡©
. 
nÙe
 
the£
 
have
 
no
 
´efix


929 
	gc
.
	gCHFLAGS
 = 
muÉiæags
 {

930 
UF_NODUMP
 = 0x00000001,

931 
	gUF_IMMUTABLE
 = 0x00000002,

932 
	gUF_APPEND
 = 0x00000004,

933 
	gUF_OPAQUE
 = 0x00000008,

934 
	gUF_NOUNLINK
 = 0x00000010,

936 
	gSF_ARCHIVED
 = 0x00010000,

937 
	gSF_IMMUTABLE
 = 0x00020000,

938 
	gSF_APPEND
 = 0x00040000,

939 
	gSF_NOUNLINK
 = 0x00100000,

940 
	gSF_SNAPSHOT
 = 0x00200000,

943 
	gc
.
	gCHFLAGS
.
	gIMMUTABLE
 = 
c
.
CHFLAGS
.
UF_IMMUTABLE
 + c.CHFLAGS.
SF_IMMUTABLE


944 
c
.
CHFLAGS
.
APPEND
 = c.CHFLAGS.
UF_APPEND
 + c.CHFLAGS.
SF_APPEND


945 
c
.
CHFLAGS
.
OPAQUE
 = c.CHFLAGS.
UF_OPAQUE


946 
c
.
CHFLAGS
.
NOUNLINK
 = c.CHFLAGS.
UF_NOUNLINK
 + c.CHFLAGS.
SF_NOUNLINK


948 
v”siÚ
 >=10 
th’


949 
c
.
CHFLAGS
.
UF_SYSTEM
 = 0x00000080

950 
c
.
CHFLAGS
.
UF_SPARSE
 = 0x00000100

951 
c
.
CHFLAGS
.
UF_OFFLINE
 = 0x00000200

952 
c
.
CHFLAGS
.
UF_REPARSE
 = 0x00000400

953 
c
.
CHFLAGS
.
UF_ARCHIVE
 = 0x00000800

954 
c
.
CHFLAGS
.
UF_READONLY
 = 0x00001000

955 
c
.
CHFLAGS
.
UF_HIDDEN
 = 0x00008000

956 
’d


958 
c
.
TCP
 = 
¡ræag
 {

959 
NODELAY
 = 1,

960 
	gMAXSEG
 = 2,

961 
	gNOPUSH
 = 4,

962 
	gNOOPT
 = 8,

963 
	gMD5SIG
 = 16,

964 
	gINFO
 = 32,

965 
	gCONGESTION
 = 64,

966 
	gKEEPINIT
 = 128,

967 
	gKEEPIDLE
 = 256,

968 
	gKEEPINTVL
 = 512,

969 
	gKEEPCNT
 = 1024,

972 
	gc
.
	gRB
 = 
muÉiæags
 {

973 
AUTOBOOT
 = 0,

974 
	gASKNAME
 = 0x001,

975 
	gSINGLE
 = 0x002,

976 
	gNOSYNC
 = 0x004,

977 
	gHALT
 = 0x008,

978 
	gINITNAME
 = 0x010,

979 
	gDFLTROOT
 = 0x020,

980 
	gKDB
 = 0x040,

981 
	gRDONLY
 = 0x080,

982 
	gDUMP
 = 0x100,

983 
	gMINIROOT
 = 0x200,

984 
	gVERBOSE
 = 0x800,

985 
	gSERIAL
 = 0x1000,

986 
	gCDROM
 = 0x2000,

987 
	gPOWEROFF
 = 0x4000,

988 
	gGDB
 = 0x8000,

989 
	gMUTE
 = 0x10000,

990 
	gSELFTEST
 = 0x20000,

991 
	gRESERVED1
 = 0x40000,

992 
	gRESERVED2
 = 0x80000,

993 
	gPAUSE
 = 0x100000,

994 
	gMULTIPLE
 = 0x20000000,

995 
	gBOOTINFO
 = 0x80000000,

998 -- 
kqueue


999 
	gc
.
	gEV
 = 
muÉiæags
 {

1000 
ADD
 = 0x0001,

1001 
	gDELETE
 = 0x0002,

1002 
	gENABLE
 = 0x0004,

1003 
	gDISABLE
 = 0x0008,

1004 
	gONESHOT
 = 0x0010,

1005 
	gCLEAR
 = 0x0020,

1006 
	gRECEIPT
 = 0x0040,

1007 
	gDISPATCH
 = 0x0080,

1008 
	gSYSFLAGS
 = 0xF000,

1009 
	gFLAG1
 = 0x2000,

1010 
	gEOF
 = 0x8000,

1011 
	gERROR
 = 0x4000,

1014 
	gv”siÚ
 >ğ10 
th’
 
c
.
EV
.
DROP
 = 0x1000 
’d


1016 
c
.
EVFILT
 = 
¡ræag
 {

1017 
READ
 = -1,

1018 
	gWRITE
 = -2,

1019 
	gAIO
 = -3,

1020 
	gVNODE
 = -4,

1021 
	gPROC
 = -5,

1022 
	gSIGNAL
 = -6,

1023 
	gTIMER
 = -7,

1024 
	gFS
 = -9,

1025 
	gLIO
 = -10,

1026 
	gUSER
 = -11,

1027 
	gSYSCOUNT
 = 11,

1030 
	gc
.
	gNOTE
 = 
muÉiæags
 {

1031 -- 
u£r


1032 
FFNOP
 = 0x00000000,

1033 
	gFFAND
 = 0x40000000,

1034 
	gFFOR
 = 0x80000000,

1035 
	gFFCOPY
 = 0xc0000000,

1036 
	gFFCTRLMASK
 = 0xc0000000,

1037 
	gFFLAGSMASK
 = 0x00ffffff,

1038 
	gTRIGGER
 = 0x01000000,

1039 -- 
»ad
 
ªd
 
wr™e


1040 
	gLOWAT
 = 0x0001,

1041 -- 
vnode


1042 
	gDELETE
 = 0x0001,

1043 
	gWRITE
 = 0x0002,

1044 
	gEXTEND
 = 0x0004,

1045 
	gATTRIB
 = 0x0008,

1046 
	gLINK
 = 0x0010,

1047 
	gRENAME
 = 0x0020,

1048 
	gREVOKE
 = 0x0040,

1049 -- 
´oc


1050 
	gEXIT
 = 0x80000000,

1051 
	gFORK
 = 0x40000000,

1052 
	gEXEC
 = 0x20000000,

1053 
	gPCTRLMASK
 = 0xf0000000,

1054 
	gPDATAMASK
 = 0x000fffff,

1055 
	gTRACK
 = 0x00000001,

1056 
	gTRACKERR
 = 0x00000002,

1057 
	gCHILD
 = 0x00000004,

1060 
	gc
.
	gSHM
 = 
¡ræag
 {

1061 
ANON
 = 
ch¬p
(1),

1064 
	gc
.
	gPD
 = 
muÉiæags
 {

1065 
DAEMON
 = 0x00000001,

1068 
	gc
.
	gITIMER
 = 
¡ræag
 {

1069 
REAL
 = 0,

1070 
	gVIRTUAL
 = 1,

1071 
	gPROF
 = 2,

1074 
	gc
.
	gSA
 = 
muÉiæags
 {

1075 
ONSTACK
 = 0x0001,

1076 
	gRESTART
 = 0x0002,

1077 
	gRESETHAND
 = 0x0004,

1078 
	gNOCLDSTOP
 = 0x0008,

1079 
	gNODEFER
 = 0x0010,

1080 
	gNOCLDWAIT
 = 0x0020,

1081 
	gSIGINFO
 = 0x0040,

1084 -- 
v6
 
sockİts


1085 
	gc
.
	gIPV6
 = 
¡ræag
 {

1086 
SOCKOPT_RESERVED1
 = 3,

1087 
	gUNICAST_HOPS
 = 4,

1088 
	gMULTICAST_IF
 = 9,

1089 
	gMULTICAST_HOPS
 = 10,

1090 
	gMULTICAST_LOOP
 = 11,

1091 
	gJOIN_GROUP
 = 12,

1092 
	gLEAVE_GROUP
 = 13,

1093 
	gPORTRANGE
 = 14,

1094 --
	gICMP6_FILTER
 = 18, -- 
nÙ
 
Çme¥aûd
 
as
 
IPV6


1095 
	gCHECKSUM
 = 26,

1096 
	gV6ONLY
 = 27,

1097 
	gIPSEC_POLICY
 = 28,

1098 
	gFAITH
 = 29,

1099 
	gRTHDRDSTOPTS
 = 35,

1100 
	gRECVPKTINFO
 = 36,

1101 
	gRECVHOPLIMIT
 = 37,

1102 
	gRECVRTHDR
 = 38,

1103 
	gRECVHOPOPTS
 = 39,

1104 
	gRECVDSTOPTS
 = 40,

1105 
	gUSE_MIN_MTU
 = 42,

1106 
	gRECVPATHMTU
 = 43,

1107 
	gPATHMTU
 = 44,

1108 
	gPKTINFO
 = 46,

1109 
	gHOPLIMIT
 = 47,

1110 
	gNEXTHOP
 = 48,

1111 
	gHOPOPTS
 = 49,

1112 
	gDSTOPTS
 = 50,

1113 
	gRTHDR
 = 51,

1114 
	gRECVTCLASS
 = 57,

1115 
	gTCLASS
 = 61,

1116 
	gDONTFRAG
 = 62,

1119 
	gc
.
	gCLOCK
 = 
¡ræag
 {

1120 
REALTIME
 = 0,

1121 
	gVIRTUAL
 = 1,

1122 
	gPROF
 = 2,

1123 
	gMONOTONIC
 = 4,

1124 
	gUPTIME
 = 5,

1125 
	gUPTIME_PRECISE
 = 7,

1126 
	gUPTIME_FAST
 = 8,

1127 
	gREALTIME_PRECISE
 = 9,

1128 
	gREALTIME_FAST
 = 10,

1129 
	gMONOTONIC_PRECISE
 = 11,

1130 
	gMONOTONIC_FAST
 = 12,

1131 
	gSECOND
 = 13,

1132 
	gTHREAD_CPUTIME_ID
 = 14,

1133 
	gPROCESS_CPUTIME_ID
 = 15,

1136 
	gc
.
	gEXTATTR_NAMESPACE
 = 
¡ræag
 {

1137 
EMPTY
 = 0x00000000,

1138 
	gUSER
 = 0x00000001,

1139 
	gSYSTEM
 = 0x00000002,

1142 -- 
TODO
 
mouÁ
 
æag
 
is
 
ª
 , 
so
 
ULL
 i 
	godd
, 
but
 
the£
 
¬e
 
æags
 
	gtoo
...

1143 -- 
TODO
 
mªy
 
æags
 
	gmissšg
, 
¶us
 
F»eBSD
 
has
 
a
 
lÙ
 
mÜe
 
mouÁ
 
com¶ex™›s


1144 
	gc
.
	gMNT
 = 
¡ræag
 {

1145 
RDONLY
 = 0x0000000000000001ULL,

1146 
	gSYNCHRONOUS
 = 0x0000000000000002ULL,

1147 
	gNOEXEC
 = 0x0000000000000004ULL,

1148 
	gNOSUID
 = 0x0000000000000008ULL,

1149 
	gNFS4ACLS
 = 0x0000000000000010ULL,

1150 
	gUNION
 = 0x0000000000000020ULL,

1151 
	gASYNC
 = 0x0000000000000040ULL,

1152 
	gSUIDDIR
 = 0x0000000000100000ULL,

1153 
	gSOFTDEP
 = 0x0000000000200000ULL,

1154 
	gNOSYMFOLLOW
 = 0x0000000000400000ULL,

1155 
	gGJOURNAL
 = 0x0000000002000000ULL,

1156 
	gMULTILABEL
 = 0x0000000004000000ULL,

1157 
	gACLS
 = 0x0000000008000000ULL,

1158 
	gNOATIME
 = 0x0000000010000000ULL,

1159 
	gNOCLUSTERR
 = 0x0000000040000000ULL,

1160 
	gNOCLUSTERW
 = 0x0000000080000000ULL,

1161 
	gSUJ
 = 0x0000000100000000ULL,

1163 
	gFORCE
 = 0x0000000000080000ULL,

1166 
	gc
.
	gCTL
 = 
¡ræag
 {

1167 
UNSPEC
 = 0,

1168 
	gKERN
 = 1,

1169 
	gVM
 = 2,

1170 
	gVFS
 = 3,

1171 
	gNET
 = 4,

1172 
	gDEBUG
 = 5,

1173 
	gHW
 = 6,

1174 
	gMACHDEP
 = 7,

1175 
	gUSER
 = 8,

1176 
	gP1003_1B
 = 9,

1177 
	gMAXID
 = 10,

1180 
	gc
.
	gKERN
 = 
¡ræag
 {

1181 
OSTYPE
 = 1,

1182 
	gOSRELEASE
 = 2,

1183 
	gOSREV
 = 3,

1184 
	gVERSION
 = 4,

1185 
	gMAXVNODES
 = 5,

1186 
	gMAXPROC
 = 6,

1187 
	gMAXFILES
 = 7,

1188 
	gARGMAX
 = 8,

1189 
	gSECURELVL
 = 9,

1190 
	gHOSTNAME
 = 10,

1191 
	gHOSTID
 = 11,

1192 
	gCLOCKRATE
 = 12,

1193 
	gVNODE
 = 13,

1194 
	gPROC
 = 14,

1195 
	gFILE
 = 15,

1196 
	gPROF
 = 16,

1197 
	gPOSIX1
 = 17,

1198 
	gNGROUPS
 = 18,

1199 
	gJOB_CONTROL
 = 19,

1200 
	gSAVED_IDS
 = 20,

1201 
	gBOOTTIME
 = 21,

1202 
	gNISDOMAINNAME
 = 22,

1203 
	gUPDATEINTERVAL
 = 23,

1204 
	gOSRELDATE
 = 24,

1205 
	gNTP_PLL
 = 25,

1206 
	gBOOTFILE
 = 26,

1207 
	gMAXFILESPERPROC
 = 27,

1208 
	gMAXPROCPERUID
 = 28,

1209 
	gDUMPDEV
 = 29,

1210 
	gIPC
 = 30,

1211 
	gDUMMY
 = 31,

1212 
	gPS_STRINGS
 = 32,

1213 
	gUSRSTACK
 = 33,

1214 
	gLOGSIGEXIT
 = 34,

1215 
	gIOV_MAX
 = 35,

1216 
	gHOSTUUID
 = 36,

1217 
	gARND
 = 37,

1218 
	gMAXID
 = 38,

1221 
	gv”siÚ
 >ğ10 
th’
 -- 
nÙ
 
suµÜtšg
 
Ú
 
ä“bsd
 9 
as
 
difã»Á
 
ABI
, 
»comm’d
 
upg¿de
 
to
 
u£


1223 
loÿl
 
funùiÚ
 
	$CAPRIGHT
(
idx
, 
b
è 
b™
.
	`bÜ64
(b™.
	`lshiá64
(1, 57 + idx), bè
’d


1225 
c
.
CAP
 = 
muÉiæags
 {
	}
}

1227 -- 
šdex
 0

1228 
c
.
CAP
.
READ
 = 
	$CAPRIGHT
(0, 0x0000000000000001ULL)

1229 
c
.
CAP
.
WRITE
 = 
	$CAPRIGHT
(0, 0x0000000000000002ULL)

1230 
c
.
CAP
.
SEEK_TELL
 = 
	$CAPRIGHT
(0, 0x0000000000000004ULL)

1231 
c
.
CAP
.
SEEK
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
SEEK_TELL
, 0x0000000000000008ULL)

1232 
c
.
CAP
.
PREAD
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
SEEK
, c.CAP.
READ
)

1233 
c
.
CAP
.
PWRITE
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
SEEK
, c.CAP.
WRITE
)

1234 
c
.
CAP
.
MMAP
 = 
	$CAPRIGHT
(0, 0x0000000000000010ULL)

1235 
c
.
CAP
.
MMAP_R
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
MMAP
, c.CAP.
SEEK
, c.CAP.
READ
)

1236 
c
.
CAP
.
MMAP_W
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
MMAP
, c.CAP.
SEEK
, c.CAP.
WRITE
)

1237 
c
.
CAP
.
MMAP_X
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
MMAP
, c.CAP.
SEEK
, 0x0000000000000020ULL)

1238 
c
.
CAP
.
MMAP_RW
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
MMAP_R
, c.CAP.
MMAP_W
)

1239 
c
.
CAP
.
MMAP_RX
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
MMAP_R
, c.CAP.
MMAP_X
)

1240 
c
.
CAP
.
MMAP_WX
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
MMAP_W
, c.CAP.
MMAP_X
)

1241 
c
.
CAP
.
MMAP_RWX
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
MMAP_R
, c.CAP.
MMAP_W
, c.CAP.
MMAP_X
)

1242 
c
.
CAP
.
CREATE
 = 
	$CAPRIGHT
(0, 0x0000000000000040ULL)

1243 
c
.
CAP
.
FEXECVE
 = 
	$CAPRIGHT
(0, 0x0000000000000080ULL)

1244 
c
.
CAP
.
FSYNC
 = 
	$CAPRIGHT
(0, 0x0000000000000100ULL)

1245 
c
.
CAP
.
FTRUNCATE
 = 
	$CAPRIGHT
(0, 0x0000000000000200ULL)

1246 
c
.
CAP
.
LOOKUP
 = 
	$CAPRIGHT
(0, 0x0000000000000400ULL)

1247 
c
.
CAP
.
FCHDIR
 = 
	$CAPRIGHT
(0, 0x0000000000000800ULL)

1248 
c
.
CAP
.
FCHFLAGS
 = 
	$CAPRIGHT
(0, 0x0000000000001000ULL)

1249 
c
.
CAP
.
CHFLAGSAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
FCHFLAGS
, c.CAP.
LOOKUP
)

1250 
c
.
CAP
.
FCHMOD
 = 
	$CAPRIGHT
(0, 0x0000000000002000ULL)

1251 
c
.
CAP
.
FCHMODAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
FCHMOD
, c.CAP.
LOOKUP
)

1252 
c
.
CAP
.
FCHOWN
 = 
	$CAPRIGHT
(0, 0x0000000000004000ULL)

1253 
c
.
CAP
.
FCHOWNAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
FCHOWN
, c.CAP.
LOOKUP
)

1254 
c
.
CAP
.
FCNTL
 = 
	$CAPRIGHT
(0, 0x0000000000008000ULL)

1255 
c
.
CAP
.
FLOCK
 = 
	$CAPRIGHT
(0, 0x0000000000010000ULL)

1256 
c
.
CAP
.
FPATHCONF
 = 
	$CAPRIGHT
(0, 0x0000000000020000ULL)

1257 
c
.
CAP
.
FSCK
 = 
	$CAPRIGHT
(0, 0x0000000000040000ULL)

1258 
c
.
CAP
.
FSTAT
 = 
	$CAPRIGHT
(0, 0x0000000000080000ULL)

1259 
c
.
CAP
.
FSTATAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
FSTAT
, c.CAP.
LOOKUP
)

1260 
c
.
CAP
.
FSTATFS
 = 
	$CAPRIGHT
(0, 0x0000000000100000ULL)

1261 
c
.
CAP
.
FUTIMES
 = 
	$CAPRIGHT
(0, 0x0000000000200000ULL)

1262 
c
.
CAP
.
FUTIMESAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
FUTIMES
, c.CAP.
LOOKUP
)

1263 
c
.
CAP
.
LINKAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000000000400000ULL)

1264 
c
.
CAP
.
MKDIRAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000000000800000ULL)

1265 
c
.
CAP
.
MKFIFOAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000000001000000ULL)

1266 
c
.
CAP
.
MKNODAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000000002000000ULL)

1267 
c
.
CAP
.
RENAMEAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000000004000000ULL)

1268 
c
.
CAP
.
SYMLINKAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000000008000000ULL)

1269 
c
.
CAP
.
UNLINKAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000000010000000ULL)

1270 
c
.
CAP
.
ACCEPT
 = 
	$CAPRIGHT
(0, 0x0000000020000000ULL)

1271 
c
.
CAP
.
BIND
 = 
	$CAPRIGHT
(0, 0x0000000040000000ULL)

1272 
c
.
CAP
.
CONNECT
 = 
	$CAPRIGHT
(0, 0x0000000080000000ULL)

1273 
c
.
CAP
.
GETPEERNAME
 = 
	$CAPRIGHT
(0, 0x0000000100000000ULL)

1274 
c
.
CAP
.
GETSOCKNAME
 = 
	$CAPRIGHT
(0, 0x0000000200000000ULL)

1275 
c
.
CAP
.
GETSOCKOPT
 = 
	$CAPRIGHT
(0, 0x0000000400000000ULL)

1276 
c
.
CAP
.
LISTEN
 = 
	$CAPRIGHT
(0, 0x0000000800000000ULL)

1277 
c
.
CAP
.
PEELOFF
 = 
	$CAPRIGHT
(0, 0x0000001000000000ULL)

1278 
c
.
CAP
.
RECV
 = c.CAP.
READ


1279 
c
.
CAP
.
SEND
 = c.CAP.
WRITE


1280 
c
.
CAP
.
SETSOCKOPT
 = 
	$CAPRIGHT
(0, 0x0000002000000000ULL)

1281 
c
.
CAP
.
SHUTDOWN
 = 
	$CAPRIGHT
(0, 0x0000004000000000ULL)

1282 
c
.
CAP
.
BINDAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000008000000000ULL)

1283 
c
.
CAP
.
CONNECTAT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
LOOKUP
, 0x0000010000000000ULL)

1284 
c
.
CAP
.
SOCK_CLIENT
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
CONNECT
, c.CAP.
GETPEERNAME
, c.CAP.
GETSOCKNAME
, c.CAP.
GETSOCKOPT
,

1285 
c
.
CAP
.
PEELOFF
, c.CAP.
RECV
, c.CAP.
SEND
, c.CAP.
SETSOCKOPT
, c.CAP.
SHUTDOWN
)

1286 
c
.
CAP
.
SOCK_SERVER
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
ACCEPT
, c.CAP.
BIND
, c.CAP.
GETPEERNAME
, c.CAP.
GETSOCKNAME
,

1287 
c
.
CAP
.
GETSOCKOPT
, c.CAP.
LISTEN
, c.CAP.
PEELOFF
, c.CAP.
RECV
, c.CAP.
SEND
,

1288 
c
.
CAP
.
SETSOCKOPT
, c.CAP.
SHUTDOWN
)

1289 
c
.
CAP
.
ALL0
 = 
	$CAPRIGHT
(0, 0x0000007FFFFFFFFFULL)

1290 
c
.
CAP
.
UNUSED0_40
 = 
	$CAPRIGHT
(0, 0x0000008000000000ULL)

1291 
c
.
CAP_UNUSED0_57
 = 
	`CAPRIGHT
(0, 0x0100000000000000ULL)

1293 -- 
šdex
 1

1294 
c
.
CAP
.
MAC_GET
 = 
	$CAPRIGHT
(1, 0x0000000000000001ULL)

1295 
c
.
CAP
.
MAC_SET
 = 
	$CAPRIGHT
(1, 0x0000000000000002ULL)

1296 
c
.
CAP
.
SEM_GETVALUE
 = 
	$CAPRIGHT
(1, 0x0000000000000004ULL)

1297 
c
.
CAP
.
SEM_POST
 = 
	$CAPRIGHT
(1, 0x0000000000000008ULL)

1298 
c
.
CAP
.
SEM_WAIT
 = 
	$CAPRIGHT
(1, 0x0000000000000010ULL)

1299 
c
.
CAP
.
EVENT
 = 
	$CAPRIGHT
(1, 0x0000000000000020ULL)

1300 
c
.
CAP
.
KQUEUE_EVENT
 = 
	$CAPRIGHT
(1, 0x0000000000000040ULL)

1301 
c
.
CAP
.
IOCTL
 = 
	$CAPRIGHT
(1, 0x0000000000000080ULL)

1302 
c
.
CAP
.
TTYHOOK
 = 
	$CAPRIGHT
(1, 0x0000000000000100ULL)

1303 
c
.
CAP
.
PDGETPID
 = 
	$CAPRIGHT
(1, 0x0000000000000200ULL)

1304 
c
.
CAP
.
PDWAIT
 = 
	$CAPRIGHT
(1, 0x0000000000000400ULL)

1305 
c
.
CAP
.
PDKILL
 = 
	$CAPRIGHT
(1, 0x0000000000000800ULL)

1306 
c
.
CAP
.
EXTATTR_DELETE
 = 
	$CAPRIGHT
(1, 0x0000000000001000ULL)

1307 
c
.
CAP
.
EXTATTR_GET
 = 
	$CAPRIGHT
(1, 0x0000000000002000ULL)

1308 
c
.
CAP
.
EXTATTR_LIST
 = 
	$CAPRIGHT
(1, 0x0000000000004000ULL)

1309 
c
.
CAP
.
EXTATTR_SET
 = 
	$CAPRIGHT
(1, 0x0000000000008000ULL)

1311 
c
.
CAP_ACL_CHECK
 = 
	$CAPRIGHT
(1, 0x0000000000010000ULL)

1312 
c
.
CAP_ACL_DELETE
 = 
	$CAPRIGHT
(1, 0x0000000000020000ULL)

1313 
c
.
CAP_ACL_GET
 = 
	$CAPRIGHT
(1, 0x0000000000040000ULL)

1314 
c
.
CAP_ACL_SET
 = 
	$CAPRIGHT
(1, 0x0000000000080000ULL)

1315 
c
.
CAP_KQUEUE_CHANGE
 = 
	$CAPRIGHT
(1, 0x0000000000100000ULL)

1316 
c
.
CAP_KQUEUE
 = 
b™
.
	$bÜ64
(
c
.
CAP
.
KQUEUE_EVENT
, c.CAP.
KQUEUE_CHANGE
)

1317 
c
.
CAP_ALL1
 = 
	$CAPRIGHT
(1, 0x00000000001FFFFFULL)

1318 
c
.
CAP_UNUSED1_22
 = 
	$CAPRIGHT
(1, 0x0000000000200000ULL)

1319 
c
.
CAP_UNUSED1_57
 = 
	$CAPRIGHT
(1, 0x0100000000000000ULL)

1321 
c
.
CAP_FCNTL
 = 
muÉiæags
 {

1322 
GETFL
 = 
b™
.
	`lshiá
(1, 
c
.
F
.GETFL),

1323 
SETFL
 = 
b™
.
	`lshiá
(1, 
c
.
F
.SETFL),

1324 
GETOWN
 = 
b™
.
	`lshiá
(1, 
c
.
F
.GETOWN),

1325 
SETOWN
 = 
b™
.
	`lshiá
(1, 
c
.
F
.SETOWN),

1326 
	}
}

1328 
	gc
.
	gCAP_FCNTL
.
	gALL
 = 
b™
.
	$bÜ
(
c
.
CAP_FCNTL
.
GETFL
, c.CAP_FCNTL.
SETFL
, c.CAP_FCNTL.
GETOWN
, c.CAP_FCNTL.
SETOWN
)

1330 
c
.
CAP_IOCTLS
 = 
muÉiæags
 {

1331 
ALL
 = 
h
.
lÚgmax
,

1332 
	}
}

1334 
	gc
.
	gCAP_RIGHTS_VERSION
 = 0 -- 
we
 dØ
nÙ
 
und”¡ªd
 
Ùh”s


1336 
’d
 -- 
ä“bsd
 >= 10

1338 
v”siÚ
 >ğ11 
th’


1339 -- 
utim’§t


1340 
c
.
UTIME
 = 
¡ræag
 {

1341 
NOW
 = -1,

1342 
	gOMIT
 = -2,

1344 
’d


1346  
	gc


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/errors.lua

1 -- 
F»eBSD
 
”rÜ
 
mes§ges


3 
loÿl
 
	g»quœe
 = 
»quœe


5 
loÿl
 
v”siÚ
 = 
»quœe
 "syscall.freebsd.version".version

7 
loÿl
 
”rÜs
 = {

8 
PERM
 = "Operation‚ot…ermitted",

9 
	gNOENT
 = "No such file or directory",

10 
	gSRCH
 = "No such…rocess",

11 
	gINTR
 = "Interrupted system call",

12 
	gIO
 = "Input/outputƒrror",

13 
	gNXIO
 = "Device‚ot configured",

15 
	gNOEXEC
 = "Exec formatƒrror",

16 
	gBADF
 = "Bad file descriptor",

17 
	gCHILD
 = "No child…rocesses",

18 
	gDEADLK
 = "Resource deadlock‡voided",

19 
	gNOMEM
 = "Cannot‡llocate memory",

20 
	gACCES
 = "Permission denied",

21 
	gFAULT
 = "Bad‡ddress",

22 
	gNOTBLK
 = "Block device„equired",

23 
	gBUSY
 = "Resource busy",

24 
	gEXIST
 = "Fileƒxists",

25 
	gXDEV
 = "Cross-device†ink",

26 
	gNODEV
 = "Operation‚ot supported by device",

27 
	gNOTDIR
 = "Not‡ directory",

28 
	gISDIR
 = "Is‡ directory",

29 
	gINVAL
 = "Invalid‡rgument",

30 
	gNFILE
 = "Too many open files in system",

31 
	gMFILE
 = "Too many open files",

32 
	gNOTTY
 = "Inappropriate ioctl for device",

33 
	gTXTBSY
 = "Text file busy",

34 
	gFBIG
 = "Fileoo†arge",

35 
	gNOSPC
 = "No space†eft on device",

36 
	gSPIPE
 = "Illegal seek",

37 
	gROFS
 = "Read-only file system",

38 
	gMLINK
 = "Too many†inks",

39 
	gPIPE
 = "Broken…ipe",

40 
	gDOM
 = "Numerical‡rgument out of domain",

41 
	gRANGE
 = "Resultoo†arge",

42 
	gAGAIN
 = "Resourceemporarily unavailable",

43 
	gINPROGRESS
 = "Operation‚ow in…rogress",

44 
	gALREADY
 = "Operation‡lready in…rogress",

45 
	gNOTSOCK
 = "Socket operation on‚on-socket",

46 
	gDESTADDRREQ
 = "Destination‡ddress„equired",

47 
	gMSGSIZE
 = "Messageoo†ong",

48 
	gPROTOTYPE
 = "Protocol wrongype for socket",

49 
	gNOPROTOOPT
 = "Protocol‚ot‡vailable",

50 
	gPROTONOSUPPORT
 = "Protocol‚ot supported",

51 
	gSOCKTNOSUPPORT
 = "Socketype‚ot supported",

52 
	gOPNOTSUPP
 = "Operation‚ot supported",

53 
	gPFNOSUPPORT
 = "Protocol family‚ot supported",

54 
	gAFNOSUPPORT
 = "Address family‚ot supported by…rotocol family",

55 
	gADDRINUSE
 = "Address‡lready in use",

56 
	gADDRNOTAVAIL
 = "Can't‡ssign„equested‡ddress",

57 
	gNETDOWN
 = "Network is down",

58 
	gNETUNREACH
 = "Network is unreachable",

59 
	gNETRESET
 = "Network dropped connection on„eset",

60 
	gCONNABORTED
 = "Software caused connection‡bort",

61 
	gCONNRESET
 = "Connection„eset by…eer",

62 
	gNOBUFS
 = "No buffer space‡vailable",

63 
	gISCONN
 = "Socket is‡lready connected",

64 
	gNOTCONN
 = "Socket is‚ot connected",

65 
	gSHUTDOWN
 = "Can't send‡fter socket shutdown",

66 
	gTOOMANYREFS
 = "Too many„eferences: can't splice",

67 
	gTIMEDOUT
 = "Operationimed out",

68 
	gCONNREFUSED
 = "Connection„efused",

69 
	gLOOP
 = "Too many†evels of symbolic†inks",

70 
	gNAMETOOLONG
 = "File‚ameoo†ong",

71 
	gHOSTDOWN
 = "Host is down",

72 
	gHOSTUNREACH
 = "No„outeo host",

73 
	gNOTEMPTY
 = "Directory‚otƒmpty",

74 
	gPROCLIM
 = "Too many…rocesses",

75 
	gUSERS
 = "Too many users",

76 
	gDQUOT
 = "Disc quotaƒxceeded",

77 
	gSTALE
 = "Stale NFS file handle",

78 
	gREMOTE
 = "Too many†evels of„emote in…ath",

79 
	gBADRPC
 = "RPC struct is bad",

80 
	gRPCMISMATCH
 = "RPC version wrong",

81 
	gPROGUNAVAIL
 = "RPC…rog.‚ot‡vail",

82 
	gPROGMISMATCH
 = "Program version wrong",

83 
	gPROCUNAVAIL
 = "Bad…rocedure for…rogram",

84 
	gNOLCK
 = "No†ocks‡vailable",

85 
	gNOSYS
 = "Function‚ot implemented",

86 
	gFTYPE
 = "Inappropriate fileype or format",

87 
	gAUTH
 = "Authenticationƒrror",

88 
	gNEEDAUTH
 = "Need‡uthenticator",

89 
	gIDRM
 = "Identifier„emoved",

90 
	gNOMSG
 = "No message of desiredype",

91 
	gOVERFLOW
 = "Valueoo†argeo be stored in dataype",

92 
	gCANCELED
 = "Operation canceled",

93 
	gILSEQ
 = "Illegal byte sequence",

94 
	gNOATTR
 = "Attribute‚ot found",

95 
	gDOOFUS
 = "Programmingƒrror",

96 
	gBADMSG
 = "Bad message",

97 
	gMULTIHOP
 = "Multihop‡ttempted",

98 
	gNOLINK
 = "Link has been severed",

99 
	gPROTO
 = "Protocolƒrror",

100 
	gNOTCAPABLE
 = "Capabilities insufficient",

101 
	gCAPMODE
 = "Not…ermitted in capability mode",

104 
	gv”siÚ
 >ğ10 
th’


105 
”rÜs
.
NOTRECOVERABLE
 = "State‚ot„ecoverable"

106 
”rÜs
.
OWNERDEAD
 = "Previous owner died"

107 
’d


109  
”rÜs


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/fcntl.lua

1 -- 
F»eBSD
 
	gfú


2 -- 
TODO
 
	gšcom¶‘e
, 
lÙs
 
missšg


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

13 
loÿl
 
c
 = 
»quœe
 "syscall.freebsd.constants"

15 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
ùoboŞ
, 
boŞtoc
 = 
h
.ctobool, h.booltoc

23 
loÿl
 
fú
 = { -- 
TODO
 
some
 
funùiÚ®™y
 
missšg


24 
commªds
 = {

25 [
c
.
F
.
SETFL
] = 
	`funùiÚ
(
¬g
è c.
O
[¬g] 
’d
,

26 [
c
.
F
.
SETFD
] = 
	`funùiÚ
(
¬g
è c.
FD
[¬g] 
’d
,

27 [
c
.
F
.
GETLK
] = 
t
.
æock
,

28 [
c
.
F
.
SETLK
] = 
t
.
æock
,

29 [
c
.
F
.
SETLKW
] = 
t
.
æock
,

31 
»t
 = {

32 [
c
.
F
.
DUPFD
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

33 [
c
.
F
.
DUPFD_CLOEXEC
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

34 [
c
.
F
.
GETFD
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

35 [
c
.
F
.
GETFL
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

36 [
c
.
F
.
GETOWN
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

37 [
c
.
F
.
GETLK
] = 
	`funùiÚ
(
»t
, 
¬g
è‡rg 
’d
,

39 
	}
}

41  
fú


43 
’d


45  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/ffi.lua

1 -- 
This
 
¬e
 
the
 
ty³s
 
F»eBSD


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "syscall.ffitypes"

16 
loÿl
 
v”siÚ
 = 
»quœe
 "syscall.freebsd.version".version

18 
loÿl
 
defs
 = {}

20 
loÿl
 
funùiÚ
 
	$­³nd
(
¡r
è
defs
[#def + 1] = sŒ 
’d


22 
abi
.
abi64
 
th’


23 
­³nd
 [[

24 
št32_t
 
şock_t
;

27 
­³nd
 [[

28 
şock_t
;

30 
’d


32 
­³nd
 [[

33 
ušt32_t
 
blksize_t
;

34 
št64_t
 
blkút_t
;

35 
št32_t
 
şockid_t
;

36 
ušt32_t
 
fæags_t
;

37 
ušt64_t
 
fsblkút_t
;

38 
ušt64_t
 
fsfút_t
;

39 
št64_t
 
id_t
;

40 
ušt32_t
 
šo_t
;

41 
key_t
;

42 
št32_t
 
lwpid_t
;

43 
ušt16_t
 
mode_t
;

44 
accmode_t
;

45 
Æ_™em
;

46 
ušt16_t
 
Æšk_t
;

47 
št64_t
 
¾im_t
;

48 
ušt8_t
 
§_çmy_t
;

49 
su£cÚds_t
;

50 
__tim”
 *
tim”_t
;

51 
__mq
 *
mqd_t
;

52 
u£cÚds_t
;

53 
ıuwhich_t
;

54 
ıuËv–_t
;

55 
ıu£tid_t
;

56 
ušt32_t
 
dev_t
;

57 
ušt32_t
 
fix±_t
;

58 
nfds_t
;

59 
št64_t
 
daddr_t
;

60 
time_t
;

61 
tcæag_t
;

62 
¥“d_t
;

63 
št32_t
 
__lwpid_t
;

66 
ušt32_t
 
__fd_mask
;

67 
	sfd_£t
 {

68 
__fd_mask
 
__fds_b™s
[32];

69 } 
	tfd_£t
;

70 
	s__sig£t
 {

71 
ušt32_t
 
sig
[4];

72 } 
	tsig£t_t
;

73 
	scmsghdr
 {

74 
sockËn_t
 
cmsg_Ën
;

75 
cmsg_Ëv–
;

76 
cmsg_ty³
;

77 
cmsg_d©a
[?];

79 
	smsghdr
 {

80 *
msg_Çme
;

81 
sockËn_t
 
msg_Çm–’
;

82 
iovec
 *
msg_iov
;

83 
msg_iovËn
;

84 *
msg_cÚŒŞ
;

85 
sockËn_t
 
msg_cÚŒŞËn
;

86 
msg_æags
;

88 
	stime¥ec
 {

89 
time_t
 
tv_£c
;

90 
tv_n£c
;

92 
	stimev®
 {

93 
time_t
 
tv_£c
;

94 
su£cÚds_t
 
tv_u£c
;

96 
	s™im”¥ec
 {

97 
time¥ec
 
™_š‹rv®
;

98 
time¥ec
 
™_v®ue
;

100 
	s™im”v®
 {

101 
timev®
 
™_š‹rv®
;

102 
timev®
 
™_v®ue
;

104 
	ssockaddr
 {

105 
ušt8_t
 
§_Ën
;

106 
§_çmy_t
 
§_çmy
;

107 
§_d©a
[14];

109 
	ssockaddr_¡Üage
 {

110 
ušt8_t
 
ss_Ën
;

111 
§_çmy_t
 
ss_çmy
;

112 
__ss_·d1
[6];

113 
št64_t
 
__ss_®ign
;

114 
__ss_·d2
[128 - 2 - 8 - 6];

116 
	ssockaddr_š
 {

117 
ušt8_t
 
sš_Ën
;

118 
§_çmy_t
 
sš_çmy
;

119 
š_pÜt_t
 
sš_pÜt
;

120 
š_addr
 
sš_addr
;

121 
št8_t
 
sš_z”o
[8];

123 
	ssockaddr_š6
 {

124 
ušt8_t
 
sš6_Ën
;

125 
§_çmy_t
 
sš6_çmy
;

126 
š_pÜt_t
 
sš6_pÜt
;

127 
ušt32_t
 
sš6_æowšfo
;

128 
š6_addr
 
sš6_addr
;

129 
ušt32_t
 
sš6_scİe_id
;

131 
	ssockaddr_un
 {

132 
ušt8_t
 
sun_Ën
;

133 
§_çmy_t
 
sun_çmy
;

134 
sun_·th
[104];

136 
	spŞlfd
 {

137 
fd
;

138 
ev’ts
;

139 
»v’ts
;

141 
	s¡©
 {

142 
dev_t
 
¡_dev
;

143 
šo_t
 
¡_šo
;

144 
mode_t
 
¡_mode
;

145 
Æšk_t
 
¡_Æšk
;

146 
uid_t
 
¡_uid
;

147 
gid_t
 
¡_gid
;

148 
dev_t
 
¡_rdev
;

149 
time¥ec
 
¡_©im
;

150 
time¥ec
 
¡_mtim
;

151 
time¥ec
 
¡_ùim
;

152 
off_t
 
¡_size
;

153 
blkút_t
 
¡_blocks
;

154 
blksize_t
 
¡_blksize
;

155 
fæags_t
 
¡_æags
;

156 
ušt32_t
 
¡_g’
;

157 
št32_t
 
¡_l¥¬e
;

158 
time¥ec
 
¡_bœthtim
;

159 :(8 / 2è* (16 - ()(
time¥ec
));

160 :(8 / 2è* (16 - ()(
time¥ec
));

162 
	sru§ge
 {

163 
timev®
 
ru_utime
;

164 
timev®
 
ru_¡ime
;

165 
ru_maxrss
;

166 
ru_ixrss
;

167 
ru_idrss
;

168 
ru_i¤ss
;

169 
ru_mšæt
;

170 
ru_majæt
;

171 
ru_nsw­
;

172 
ru_šblock
;

173 
ru_oublock
;

174 
ru_msg¢d
;

175 
ru_msgrcv
;

176 
ru_nsigÇls
;

177 
ru_nvcsw
;

178 
ru_nivcsw
;

180 
	sæock
 {

181 
off_t
 
l_¡¬t
;

182 
off_t
 
l_Ën
;

183 
pid_t
 
l_pid
;

184 
l_ty³
;

185 
l_wh’û
;

186 
l_sysid
;

188 
	sdœ’t
 {

189 
ušt32_t
 
d_f’o
;

190 
ušt16_t
 
d_»ş’
;

191 
ušt8_t
 
d_ty³
;

192 
ušt8_t
 
d_ÇmËn
;

193 
d_Çme
[255 + 1];

195 
	s‹rmios
 {

196 
tcæag_t
 
c_iæag
;

197 
tcæag_t
 
c_oæag
;

198 
tcæag_t
 
c_cæag
;

199 
tcæag_t
 
c_læag
;

200 
cc_t
 
c_cc
[20];

201 
¥“d_t
 
c_i¥“d
;

202 
¥“d_t
 
c_o¥“d
;

204 
	sfiodgÇme_¬g
 {

205 
Ën
;

206 *
buf
;

208 
	skev’t
 {

209 
ušŒ_t
 
id’t
;

210 
f‹r
;

211 
æags
;

212 
fæags
;

213 
šŒ_t
 
d©a
;

214 *
ud©a
;

216 
	sÿp_rights
 {

217 
ušt64_t
 
ü_rights
[0 + 2];

219 
ÿp_rights
 
	tÿp_rights_t
;

220 
	usigv®
 {

221 
siv®_št
;

222 *
siv®_±r
;

223 
sigv®_št
;

224 *
sigv®_±r
;

226 
	s__sigšfo
 {

227 
si_signo
;

228 
si_”ºo
;

229 
si_code
;

230 
pid_t
 
si_pid
;

231 
uid_t
 
si_uid
;

232 
si_¡©us
;

233 *
si_addr
;

234 
sigv®
 
si_v®ue
;

237 
_Œ­no
;

238 } 
_çuÉ
;

240 
_tim”id
;

241 
_ov”run
;

242 } 
_tim”
;

244 
_mqd
;

245 } 
_mesgq
;

247 
_bªd
;

248 } 
_pŞl
;

250 
__¥¬e1__
;

251 
__¥¬e2__
[7];

252 } 
__¥¬e__
;

253 } 
_»asÚ
;

254 } 
	tsigšfo_t
;

255 
	ssigaùiÚ
 {

257 (*
__§_hªdËr
)();

258 (*
__§_sigaùiÚ
)(, 
__sigšfo
 *, *);

259 } 
__sigaùiÚ_u
;

260 
§_æags
;

261 
sig£t_t
 
§_mask
;

263 
	ssigev’t
 {

264 
sigev_nÙify
;

265 
sigev_signo
;

266 
sigv®
 
sigev_v®ue
;

268 
__lwpid_t
 
_th»adid
;

270 (*
_funùiÚ
)(
sigv®
);

271 *
_©Œibu‹
;

272 } 
_sigev_th»ad
;

273 
_kev’t_æags
;

274 
__¥¬e__
[8];

275 } 
_sigev_un
;

279 -- 
funùiÚs


280 
­³nd
 [[

281 
	`»boÙ
(
howto
);

282 
	`ioùl
(
d
, 
»que¡
, *
¬g
);

283 
	`mouÁ
(cÚ¡ *
ty³
, cÚ¡ *
dœ
, 
æags
, *
d©a
);

284 
	`nmouÁ
(
iovec
 *
iov
, 
niov
, 
æags
);

286 
	`cÚÃù©
(
fd
, 
s
, cÚ¡ 
sockaddr
 *
Çme
, 
sockËn_t
 
Çm–’
);

287 
	`bšd©
(
fd
, 
s
, cÚ¡ 
sockaddr
 *
addr
, 
sockËn_t
 
add¾’
);

288 
	`pdfÜk
(*
fdp
, 
æags
);

289 
	`pdg‘pid
(
fd
, 
pid_t
 *
pidp
);

290 
	`pdkl
(
fd
, 
signum
);

291 
	`pdwa™4
(
fd
, *
¡©us
, 
İtiÚs
, 
ru§ge
 *rusage);

292 
	`ÿp_’‹r
();

293 
	`ÿp_g‘mode
(*
mod•
);

294 
	`ÿp_rights_lim™
(
fd
, cÚ¡ 
ÿp_rights_t
 *
rights
);

295 
	`__ÿp_rights_g‘
(
v”siÚ
, 
fd
, 
ÿp_rights_t
 *
right¥
);

296 
	`ÿp_ioùls_lim™
(
fd
, cÚ¡ *
cmds
, 
size_t
 
ncmds
);

297 
ssize_t
 
	`ÿp_ioùls_g‘
(
fd
, *
cmds
, 
size_t
 
maxcmds
);

298 
	`ÿp_fús_lim™
(
fd
, 
ušt32_t
 
fúrights
);

299 
	`ÿp_fús_g‘
(
fd
, 
ušt32_t
 *
fúright¥
);

300 
	`f¡©©
(
dœfd
, cÚ¡ *
·thÇme
, 
¡©
 *
buf
, 
æags
);

302 
	`__sys_utimes
(cÚ¡ *
f’ame
, cÚ¡ 
timev®
 
times
[2]);

303 
	`__sys_futimes
(, cÚ¡ 
timev®
 
times
[2]);

304 
	`__sys_lutimes
(cÚ¡ *
f’ame
, cÚ¡ 
timev®
 
times
[2]);

305 
pid_t
 
	`__sys_wa™4
Õid_ˆ
wpid
, *
¡©us
, 
İtiÚs
, 
ru§ge
 *rusage);

306 
	`__sys_sigaùiÚ
(
signum
, cÚ¡ 
sigaùiÚ
 *
aù
, sigaùiÚ *
Şdaù
);

309 
loÿl
 
s
 = 
bË
.
	`cÚÿt
(
defs
, "")

311 
ffi
.
	`cdef
(
s
)

313 -- 
TODO
 
should
  
¡ršgs
?

314 
»quœe
 "syscall.bsd.ffi"

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/ioctl.lua

1 -- 
	gioùls
, 
flšg
 
š
 
as
 
Ãeded


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
s
, 
t
 = 
ty³s
.s,ypes.t

14 
loÿl
 
¡ræag
 = 
	`»quœe
("syscall.helpers").strflag

15 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

17 
loÿl
 
bªd
 = 
b™
.band

18 
loÿl
 
funùiÚ
 
	$bÜ
(...)

19 
loÿl
 
r
 = 
b™
.
	$bÜ
(...)

20 
r
 < 0 
th’
„ =„ + 4294967296 
’d
 -- 
TODO
 
£e
 
nÙe
 
š
 
N‘BSD


21  
r


22 
’d


23 
loÿl
 
lshiá
 = 
b™
.lshift

24 
loÿl
 
rshiá
 = 
b™
.rshift

26 
loÿl
 
IOC
 = {

27 
VOID
 = 0x20000000,

28 
OUT
 = 0x40000000,

29 
IN
 = 0x80000000,

30 
PARM_SHIFT
 = 13,

31 
	}
}

33 
	gIOC
.
	gPARM_MASK
 = 
lshiá
(1, 
IOC
.
PARM_SHIFT
) - 1

34 
	gIOC
.
	gINOUT
 = 
IOC
.
IN
 + IOC.
OUT


35 
IOC
.
DIRMASK
 = IOC.
IN
 + IOC.
OUT
 + IOC.
VOID


37 
loÿl
 
funùiÚ
 
	$ioc
(
dœ
, 
ch
, 
Ä
, 
size
)

38  
t
.
	`ulÚg
(
	`bÜ
(
dœ
,

39 
	`lshiá
(
	`bªd
(
size
, 
IOC
.
PARM_MASK
), 16),

40 
	`lshiá
(
ch
, 8),

41 
Ä
))

42 
’d


44 
loÿl
 
sšgËtÚm­
 = {

47 
ušt
 = "uint1",

48 
ušt64
 = "uint64_1",

49 
off
 = "off1",

50 
	}
}

52 
loÿl
 
funùiÚ
 
	$_IOC
(
dœ
, 
ch
, 
Ä
, 

)

53 
	`ty³
(
ch
è=ğ"¡ršg" 
th’
 ch = ch:
	$by‹
(è
’d


54 
	`ty³
(

è=ğ"numb”" 
th’
  
	$ioc
(
dœ
, 
ch
, 
Ä
, 

è
’d


55 
loÿl
 
size
 = 
s
[

]

56 
loÿl
 
sšgËtÚ
 = 
sšgËtÚm­
[

] ~ğ
n


57 

 = 
sšgËtÚm­
[] 
Ü
p

58  {
numb”
 = 
	`ioc
(
dœ
, 
ch
, 
Ä
, 
size
),

59 
»ad
 = 
dœ
 =ğ
IOC
.
OUT
 
Ü
 dœ =ğIOC.
INOUT
, 
wr™e
 = dœ =ğIOC.
IN
 or dir == IOC.INOUT,

60 
ty³
 = 
t
[

], 
sšgËtÚ
 = 
	}
singleton}

61 
’d


63 
loÿl
 
	g_IO
 = 
	$funùiÚ
(
ch
, 
Ä
è 
	$_IOC
(
IOC
.
VOID
, 
ch
, 
Ä
, 0è
’d


64 
loÿl
 
_IOR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
OUT
, 
ch
, 
Ä
, 

è
’d


65 
loÿl
 
_IOW
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
IN
, 
ch
, 
Ä
, 

è
’d


66 
loÿl
 
_IOWR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
INOUT
, 
ch
, 
Ä
, 

è
’d


67 
loÿl
 
_IOWINT
 = 
	$funùiÚ
(
ch
, 
Ä
è 
	`_IOC
(
IOC
.
VOID
, ch,‚r, "št"è
’d


69 
loÿl
 
ioùl
 = 
¡ræag
 {

70 -- 
‰y
 
ioùls


71 
TIOCEXCL
 = 
	`_IO
('t', 13),

72 
TIOCNXCL
 = 
	`_IO
('t', 14),

73 
TIOCGPTN
 = 
	`_IOR
('t', 15, "int"),

74 
TIOCFLUSH
 = 
	`_IOW
('t', 16, "int"),

75 
TIOCGETA
 = 
	`_IOR
('t', 19, "termios"),

76 
TIOCSETA
 = 
	`_IOW
('t', 20, "termios"),

77 
TIOCSETAW
 = 
	`_IOW
('t', 21, "termios"),

78 
TIOCSETAF
 = 
	`_IOW
('t', 22, "termios"),

79 
TIOCGETD
 = 
	`_IOR
('t', 26, "int"),

80 
TIOCSETD
 = 
	`_IOW
('t', 27, "int"),

81 
TIOCPTMASTER
 = 
	`_IO
('t', 28),

82 
TIOCGDRAINWAIT
 = 
	`_IOR
('t', 86, "int"),

83 
TIOCSDRAINWAIT
 = 
	`_IOW
('t', 87, "int"),

84 
TIOCTIMESTAMP
 = 
	`_IOR
('t', 89, "timeval"),

85 
TIOCMGDTRWAIT
 = 
	`_IOR
('t', 90, "int"),

86 
TIOCMSDTRWAIT
 = 
	`_IOW
('t', 91, "int"),

87 
TIOCDRAIN
 = 
	`_IO
('t', 94),

88 
TIOCSIG
 = 
	`_IOWINT
('t', 95),

89 
TIOCEXT
 = 
	`_IOW
('t', 96, "int"),

90 
TIOCSCTTY
 = 
	`_IO
('t', 97),

91 
TIOCCONS
 = 
	`_IOW
('t', 98, "int"),

92 
TIOCGSID
 = 
	`_IOR
('t', 99, "int"),

93 
TIOCSTAT
 = 
	`_IO
('t', 101),

94 
TIOCUCNTL
 = 
	`_IOW
('t', 102, "int"),

95 
TIOCSWINSZ
 = 
	`_IOW
('t', 103, "winsize"),

96 
TIOCGWINSZ
 = 
	`_IOR
('t', 104, "winsize"),

97 
TIOCMGET
 = 
	`_IOR
('t', 106, "int"),

98 
TIOCMBIC
 = 
	`_IOW
('t', 107, "int"),

99 
TIOCMBIS
 = 
	`_IOW
('t', 108, "int"),

100 
TIOCMSET
 = 
	`_IOW
('t', 109, "int"),

101 
TIOCSTART
 = 
	`_IO
('t', 110),

102 
TIOCSTOP
 = 
	`_IO
('t', 111),

103 
TIOCPKT
 = 
	`_IOW
('t', 112, "int"),

104 
TIOCNOTTY
 = 
	`_IO
('t', 113),

105 
TIOCSTI
 = 
	`_IOW
('t', 114, "char"),

106 
TIOCOUTQ
 = 
	`_IOR
('t', 115, "int"),

107 
TIOCSPGRP
 = 
	`_IOW
('t', 118, "int"),

108 
TIOCGPGRP
 = 
	`_IOR
('t', 119, "int"),

109 
TIOCCDTR
 = 
	`_IO
('t', 120),

110 
TIOCSDTR
 = 
	`_IO
('t', 121),

111 
TIOCCBRK
 = 
	`_IO
('t', 122),

112 
TIOCSBRK
 = 
	`_IO
('t', 123),

114 -- 
fe
 
desütÜ
 
ioùls


115 
FIOCLEX
 = 
	`_IO
('f', 1),

116 
FIONCLEX
 = 
	`_IO
('f', 2),

117 
FIONREAD
 = 
	`_IOR
('f', 127, "int"),

118 
FIONBIO
 = 
	`_IOW
('f', 126, "int"),

119 
FIOASYNC
 = 
	`_IOW
('f', 125, "int"),

120 
FIOSETOWN
 = 
	`_IOW
('f', 124, "int"),

121 
FIOGETOWN
 = 
	`_IOR
('f', 123, "int"),

122 
FIODTYPE
 = 
	`_IOR
('f', 122, "int"),

123 
FIOGETLBA
 = 
	`_IOR
('f', 121, "int"),

124 
FIODGNAME
 = 
	`_IOW
('f', 120, "fiodgname_arg"),

125 
FIONWRITE
 = 
	`_IOR
('f', 119, "int"),

126 
FIONSPACE
 = 
	`_IOR
('f', 118, "int"),

127 
FIOSEEKDATA
 = 
	`_IOWR
('f', 97, "off"),

128 
FIOSEEKHOLE
 = 
	`_IOWR
('f', 98, "off"),

130 -- 
®low
 
u£r
 
defšed
 
ioùls


131 
_IO
 = _IO,

132 
_IOR
 = _IOR,

133 
_IOW
 = _IOW,

134 
_IOWR
 = _IOWR,

135 
_IOWINT
 = _IOWINT,

136 
	}
}

138  
ioùl


140 
’d


142  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/syscalls.lua

1 -- 
F»eBSD
 
¥ecific
 
sysÿÎs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gv”siÚ
 = 
»quœe
 "sysÿÎ.ä“bsd.v”siÚ".
v”siÚ


12  
	$funùiÚ
(
S
, 
hh
, 
c
, 
C
, 
ty³s
)

14 
loÿl
 
»t64
, 
»Šum
, 
»tfd
, 
»tboŞ
, 
»Œ
 = 
hh
.ret64, hh.retnum, hh.retfd, hh.retbool, hh.retptr

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
”ºo
 = 
ffi
.errno

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
i¡y³
, 
mkty³
, 
g‘fd
 = 
h
.istype, h.mktype, h.getfd

23 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

25 
funùiÚ
 
S
.
	$»boÙ
(
howto
è 
C
.
	$»boÙ
(
c
.
RB
[
howto
]è
’d


27 
C
.
bšd©
 
th’


28 
funùiÚ
 
S
.
	$bšd©
(
dœfd
, 
sockfd
, 
addr
, 
add¾’
)

29 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

30  
	`»tboŞ
(
C
.
	`bšd©
(
c
.
AT_FDCWD
[
dœfd
], 
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
 
Ü
 #addr))

31 
’d


32 
’d


33 
C
.
cÚÃù©
 
th’


34 
funùiÚ
 
S
.
	$cÚÃù©
(
dœfd
, 
sockfd
, 
addr
, 
add¾’
)

35 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

36  
	`»tboŞ
(
C
.
	`cÚÃù©
(
c
.
AT_FDCWD
[
dœfd
], 
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
 
Ü
 #addr))

37 
’d


38 
’d


40 
funùiÚ
 
S
.
	`pdfÜk
(
æags
, 
fdp
è-- 
chªged
 
Üd”
 
as
 
¿»ly
 
suµly
 fdp

41 
fdp
 = fd°
Ü
 
t
.
	$št1
()

42 
loÿl
 
pid
, 
”r
 = 
C
.
	$pdfÜk
(
fdp
, 
c
.
PD
[
æags
])

43 
pid
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


44 
pid
 =ğ0 
th’
  0 
’d
 -- 
the
 
chd
 
dÛs
 
nÙ
 
g‘
 
ª
 
fd


45  
pid
, 
n
, 
t
.
	$fd
(
fdp
[0])

46 
’d


47 
funùiÚ
 
S
.
	$pdg‘pid
(
fd
, 
pidp
)

48 
pidp
 =…id°
Ü
 
t
.
	$št1
()

49 
loÿl
 
ok
, 
”r
 = 
C
.
	`pdg‘pid
(
	`g‘fd
(
fd
), 
pidp
)

50 
ok
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


51  
pidp
[0]

52 
’d


53 
funùiÚ
 
S
.
	$pdkl
(
fd
, 
sig
è 
	`»tboŞ
(
C
.
	`pdkl
(
	`g‘fd
(fd), 
c
.
SIG
[sig])è
’d


54 -- 
pdwa™4
 
nÙ
 
im¶em’‹d
 
š
 
F»eBSD
 
y‘


56 
C
.
ÿp_’‹r
 
ªd
 
v”siÚ
 >ğ10 
th’
 -- dØ
nÙ
 
suµÜt
 
Ú
 
F»eBSD
 9, 
Úly
 
·¹Ÿl
 
im¶em’tiÚ


57 
funùiÚ
 
S
.
	$ÿp_’‹r
(è 
	`»tboŞ
(
C
.
	$ÿp_’‹r
()è
’d


58 
’d


59 
C
.
ÿp_g‘mode
 
ªd
 
v”siÚ
 >ğ10 
th’


60 
funùiÚ
 
S
.
	$ÿp_g‘mode
(
mod•
)

61 
mod•
 = mod• 
Ü
 
t
.
	$ušt1
()

62 
loÿl
 
ok
, 
”r
 = 
C
.
	$ÿp_g‘mode
(
mod•
)

63 
ok
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


64  
mod•
[0]

65 
’d


66 
funùiÚ
 
S
.
	$ÿp_§ndboxed
()

67 
loÿl
 
mod•
 = 
S
.
	$ÿp_g‘mode
()

68 
nÙ
 
mod•
 
th’
  
çl£
 
’d


69  
mod•
 ~= 0

70 
’d


71 
’d


73 -- 
±y
 
funùiÚs


74 
loÿl
 
funùiÚ
 
	$i¥tma¡”
(
fd
è fd:
	`ioùl
("TIOCPTMASTER"è
’d


75 
S
.
g¿Á±
 = 
i¥tma¡”


76 
S
.
uÆock±
 = 
i¥tma¡”


78 
loÿl
 
SPECNAMELEN
 = 63

80 
funùiÚ
 
S
.
	$±¢ame
(
fd
)

81 
loÿl
 
ok
, 
”r
 = 
	$i¥tma¡”
(
fd
)

82 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


83 
loÿl
 
buf
 = 
t
.
	$bufãr
(
SPECNAMELEN
)

84 
loÿl
 
fgn
 = 
t
.
fiodgÇme_¬g
{
buf
 = buf, 
Ën
 = 
SPECNAMELEN
}

85 
loÿl
 
	gok
, 
	g”r
 = 
fd
:
ioùl
("FIODGNAME", 
fgn
)

86 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


87  "/dev/" .. 
	gffi
.
	$¡ršg
(
buf
)

88 
’d


90  
S


92 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/sysctl.lua

1 --
ty³s
 
F»eBSD
 
	gsysùl
, 
šcom¶‘e
 
©
 
´e£Á


3 
loÿl
 
	g»quœe
 = 
»quœe


5 
loÿl
 
c
 = 
»quœe
 "syscall.freebsd.constants"

7 
loÿl
 
ty³s
 = {

8 
k”n
 = {
c
.
CTL
.
KERN
, c.KERN},

22  
	gty³s


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/types.lua

1 -- 
F»eBSD
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

14 
loÿl
 
t
, 
±
, 
s
, 
ùy³s
 = 
ty³s
.t,ypes.pt,ypes.s,ypes.ctypes

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
addty³
, 
addty³_v¬
, 
addty³_â
, 
add¿w2
 = 
h
.addtype, h.addtype_var, h.addtype_fn, h.addraw2

22 
loÿl
 
±t
, 
»v™”
, 
mkty³
, 
i¡y³
, 
Ënâ
, 
Ënmt
, 
g‘fd
, 
Ãwâ


23 ğ
h
.
±t
, h.
»v™”
, h.
mkty³
, h.
i¡y³
, h.
Ënâ
, h.
Ënmt
, h.
g‘fd
, h.
Ãwâ


24 
loÿl
 
Áohl
,‚tohl, 
Áohs
, 
htÚs
, 
où®
 = 
h
.ntohl, h.ntohl, h.ntohs, h.htons, h.octal

26 
loÿl
 
c
 = 
»quœe
 "syscall.freebsd.constants"

28 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


30 
loÿl
 
addty³s
 = {

33 
loÿl
 
add¡ruùs
 = {

34 
fiodgÇme_¬g
 = "struct fiodgname_arg",

37 
	gk
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


38 
k
, 
v
 
š
 
	$·œs
(
add¡ruùs
èdØ
	$addty³
(
ty³s
, 
k
, 
v
, 
Ënmt
è
’d


40 -- 32 
b™
 
dev_t
, 24 b™ 
mšÜ
, 8 b™ 
majÜ
, 
but
 mšÜ 
is
 
a
 
cook›
 
ªd
 
Ã™h”
 
»®ly
 
u£d
 
ju¡
 
Ëgacy


41 
loÿl
 
funùiÚ
 
	$makedev
(
majÜ
, 
mšÜ
)

42 
	`ty³
(
majÜ
è=ğ"bË" 
th’
 majÜ, 
mšÜ
 = majÜ[1], majÜ[2] 
’d


43 
loÿl
 
dev
 = 
majÜ
 
Ü
 0

44 
mšÜ
 
th’
 
dev
 = 
b™
.
	`bÜ
(mšÜ, b™.
	$lshiá
(
majÜ
, 8)è
’d


45  
dev


46 
’d


48 
mt
.
deviû
 = {

49 
šdex
 = {

50 
majÜ
 = 
	`funùiÚ
(
dev
è 
b™
.
	`bÜ
(b™.
	`bªd
(b™.
	`rshiá
(dev.dev, 8), 0xff)è
’d
,

51 
mšÜ
 = 
	`funùiÚ
(
dev
è 
b™
.
	`bªd
(dev.dev, 0xffff00ffè
’d
,

52 
deviû
 = 
	`funùiÚ
(
dev
è 
	`tÚumb”
(dev.devè
’d
,

54 
Ãwšdex
 = {

55 
deviû
 = 
	`funùiÚ
(
dev
, 
majÜ
, 
mšÜ
èdev.dev = 
	`makedev
(majÜ, mšÜè
’d
,

57 
__Ãw
 = 
	`funùiÚ
(

, 
majÜ
, 
mšÜ
)

58  
ffi
.
	`Ãw
(

, 
	`makedev
(
majÜ
, 
mšÜ
))

59 
’d
,

60 
	}
}

62 
addty³
(
ty³s
, "deviû", "¡ruù {dev_ˆdev;}", 
mt
.
deviû
)

64 
	gmt
.
	g¡©
 = {

65 
šdex
 = {

66 
dev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_dev
è
’d
,

67 
	gmode
 = 
funùiÚ
(
¡
è st.
¡_mode
 
’d
,

68 
	gšo
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_šo
è
’d
,

69 
	gÆšk
 = 
funùiÚ
(
¡
è st.
¡_Æšk
 
’d
,

70 
	guid
 = 
funùiÚ
(
¡
è st.
¡_uid
 
’d
,

71 
	ggid
 = 
funùiÚ
(
¡
è st.
¡_gid
 
’d
,

72 
	grdev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_rdev
è
’d
,

73 
	g©ime
 = 
funùiÚ
(
¡
è st.
¡_©im
.
time
 
’d
,

74 
	gùime
 = 
funùiÚ
(
¡
è st.
¡_ùim
.
time
 
’d
,

75 
	gmtime
 = 
funùiÚ
(
¡
è st.
¡_mtim
.
time
 
’d
,

76 
	gbœthtime
 = 
funùiÚ
(
¡
è st.
¡_bœthtim
.
time
 
’d
,

77 
	gsize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_size
è
’d
,

78 
	gblocks
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blocks
è
’d
,

79 
	gblksize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blksize
è
’d
,

80 
	gæags
 = 
funùiÚ
(
¡
è st.
¡_æags
 
’d
,

81 
	gg’
 = 
funùiÚ
(
¡
è st.
¡_g’
 
’d
,

83 
	gty³
 = 
funùiÚ
(
¡
è 
b™
.
bªd
(¡.
¡_mode
, 
c
.
S_I
.
FMT
è
	g’d
,

84 
	gtodt
 = 
funùiÚ
(
¡
è 
b™
.
rshiá
(¡.
ty³
, 12è
	g’d
,

85 
	gi¤eg
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FREG
 
’d
,

86 
	gisdœ
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FDIR
 
’d
,

87 
	gischr
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FCHR
 
’d
,

88 
	gisblk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FBLK
 
’d
,

89 
	gisfifo
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FIFO
 
’d
,

90 
	gi¦nk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FLNK
 
’d
,

91 
	gissock
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FSOCK
 
’d
,

92 
	giswht
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FWHT
 
’d
,

96 -- 
add
 
some
 
ä›ndl›r
 
Çmes
 
to
 
	g¡©
, 
®so
 
luafesy¡em
 
com·tib™y


97 
	gmt
.
	g¡©
.
	gšdex
.
	gacûss
 = 
mt
.
¡©
.
šdex
.
©ime


98 
mt
.
¡©
.
šdex
.
modifiÿtiÚ
 = mt.¡©.šdex.
mtime


99 
mt
.
¡©
.
šdex
.
chªge
 = mt.¡©.šdex.
ùime


101 
loÿl
 
Çmem­
 = {

102 
fe
 = 
mt
.
¡©
.
šdex
.
i¤eg
,

103 
	gdœeùÜy
 = 
mt
.
¡©
.
šdex
.
isdœ
,

104 
	glšk
 = 
mt
.
¡©
.
šdex
.
i¦nk
,

105 
	gsock‘
 = 
mt
.
¡©
.
šdex
.
issock
,

106 ["ch¬ deviû"] = 
mt
.
¡©
.
šdex
.
ischr
,

107 ["block deviû"] = 
mt
.
¡©
.
šdex
.
isblk
,

108 ["Çmed…e"] = 
mt
.
¡©
.
šdex
.
isfifo
,

111 
	gmt
.
	g¡©
.
	gšdex
.
	gty³Çme
 = 
	$funùiÚ
(
¡
)

112 
k
, 
v
 
š
 
	$·œs
(
Çmem­
èdØ
	$v
(
¡
è
th’
  
k
 
’d
ƒnd

114 
’d


116 
	`addty³
(
ty³s
, "¡©", "¡ruù st", 
mt
.
¡©
)

118 
mt
.
æock
 = {

119 
šdex
 = {

120 
ty³
 = 
	`funùiÚ
(
£lf
è s–f.
l_ty³
 
’d
,

121 
wh’û
 = 
	`funùiÚ
(
£lf
è s–f.
l_wh’û
 
’d
,

122 
¡¬t
 = 
	`funùiÚ
(
£lf
è s–f.
l_¡¬t
 
’d
,

123 
Ën
 = 
	`funùiÚ
(
£lf
è s–f.
l_Ën
 
’d
,

124 
pid
 = 
	`funùiÚ
(
£lf
è s–f.
l_pid
 
’d
,

125 
sysid
 = 
	`funùiÚ
(
£lf
è s–f.
l_sysid
 
’d
,

127 
Ãwšdex
 = {

128 
ty³
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_ty³
 = 
c
.
FCNTL_LOCK
[v] 
’d
,

129 
wh’û
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_wh’û
 = 
c
.
SEEK
[v] 
’d
,

130 
¡¬t
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_¡¬t
 = v 
’d
,

131 
Ën
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_Ën
 = v 
’d
,

132 
pid
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_pid
 = v 
’d
,

133 
sysid
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_sysid
 = v 
’d
,

135 
__Ãw
 = 
Ãwâ
,

136 
	}
}

138 
addty³
(
ty³s
, "æock", "¡ruù flock", 
mt
.
æock
)

140 
	gmt
.
	gdœ’t
 = {

141 
šdex
 = {

142 
f’o
 = 
funùiÚ
(
£lf
è 
tÚumb”
(£lf.
d_f’o
è
’d
,

143 
	g»ş’
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

144 
	gÇmËn
 = 
funùiÚ
(
£lf
è s–f.
d_ÇmËn
 
’d
,

145 
	gty³
 = 
funùiÚ
(
£lf
è s–f.
d_ty³
 
’d
,

146 
	gÇme
 = 
funùiÚ
(
£lf
è 
ffi
.
¡ršg
(£lf.
d_Çme
, s–f.
d_ÇmËn
è
	g’d
,

147 
	gtoif
 = 
funùiÚ
(
£lf
è 
b™
.
lshiá
(£lf.
d_ty³
, 12è
	g’d
, -- 
cÚv”t
 
to
 
¡©
 
	gty³s


149 
	g__Ën
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

152 
	gmt
.
	gdœ’t
.
	gšdex
.
	gšo
 = 
mt
.
dœ’t
.
šdex
.
f’o
 -- 
®‹º©e
 
Çme


154 -- 
TODO
 
´eviou¦y
 
this
 
®lowed
 
low”
 
v®ues
, 
but
hi 
v”siÚ
 
dÛs
 
	gnÙ


155 -- 
could
 
add
 
	gmt
.
	gdœ’t
.
	gšdex
[
tŞow”
(
k
)] = 
mt
.
dœ’t
.
šdex
[k] 
but
 
Ãed
 
to
 dØ
cÚsi¡’y
 
–£wh”e


156 
k
, 
v
 
š
 
	$·œs
(
c
.
DT
) do

157 
mt
.
dœ’t
.
šdex
[
k
] = 
	$funùiÚ
(
£lf
è s–f.
ty³
 =ğ
v
 
’d


158 
’d


160 
	`addty³
(
ty³s
, "dœ’t", "¡ruù dœ’t", 
mt
.
dœ’t
)

162 
mt
.
fd£t
 = {

163 
šdex
 = {

164 
fds_b™s
 = 
	`funùiÚ
(
£lf
è s–f.
__fds_b™s
 
’d
,

166 
	}
}

168 
addty³
(
ty³s
, "fd£t", "fd_£t", 
mt
.
fd£t
)

170 
	gmt
.
	gÿp_rights
 = {

171 -- 
TODO


174 
addty³
(
ty³s
, "ÿp_rights", "ÿp_rights_t", 
mt
.
ÿp_rights
)

176 -- 
TODO
 
£e
 
Lšux
 
	gnÙes
. 
Also
 
maybe
 
ÿn
 
be
 
sh¬ed
 
w™h
 
	gBSDs
, 
have
 
nÙ
 
checked
 
	g´İ”ly


177 -- 
TODO
 
®so
 
»move
 
WIF
 
	g´efixes
.

178 
	gmt
.
	gwa™
 = {

179 
__šdex
 = 
funùiÚ
(
w
, 
k
)

180 
loÿl
 
	g_WSTATUS
 = 
b™
.
bªd
(
w
.
¡©us
, 
où®
("0177"))

181 
loÿl
 
	g_WSTOPPED
 = 
où®
("0177")

182 
loÿl
 
WTERMSIG
 = 
_WSTATUS


183 
loÿl
 
EXITSTATUS
 = 
b™
.
bªd
(b™.
rshiá
(
w
.
¡©us
, 8), 0xff)

184 
loÿl
 
	gWIFEXITED
 = (
_WSTATUS
 == 0)

185 
loÿl
 
b
 = {

186 
WIFEXITED
 = WIFEXITED,

187 
	gWIFSTOPPED
 = 
b™
.
bªd
(
w
.
¡©us
, 0xffè=ğ
_WSTOPPED
,

188 
	gWIFSIGNALED
 = 
_WSTATUS
 ~ğ
_WSTOPPED
 
ªd
 _WSTATUS ~= 0

190 
	gb
.
WIFEXITED
 
th’
ab.
	gEXITSTATUS
 = 
EXITSTATUS
 
’d


191 
b
.
WIFSTOPPED
 
th’
ab.
WSTOPSIG
 = 
EXITSTATUS
 
’d


192 
b
.
WIFSIGNALED
 
th’
ab.
WTERMSIG
 = WTERMSIG 
’d


193 
b
[
k
] 
th’
 ab[k] 
’d


194 
loÿl
 
uc
 = 'W' .. 
k
:
uµ”
()

195 
b
[
uc
] 
th’
 ab[uc] 
’d


196 
’d


199 
funùiÚ
 
t
.
	$wa™¡©us
(
¡©us
)

200  
	`£tm‘©abË
({
¡©us
 = 
	}
¡©us}, 
	gmt
.
	gwa™
)

201 
’d


203 
loÿl
 
	gsigÇmes
 = {}

204 
loÿl
 
du¶iÿ‹s
 = {
LWT
 = 
Œue
}

205 
	gk
, 
v
 
š
 
	$·œs
(
c
.
SIG
) do

206 
nÙ
 
du¶iÿ‹s
[
k
] 
th’
 
sigÇmes
[
v
] = k 
’d


207 
’d


209 
mt
.
sigšfo
 = {

210 
šdex
 = {

211 
signo
 = 
	`funùiÚ
(
s
è s.
si_signo
 
’d
,

212 
”ºo
 = 
	`funùiÚ
(
s
è s.
si_”ºo
 
’d
,

213 
code
 = 
	`funùiÚ
(
s
è s.
si_code
 
’d
,

214 
pid
 = 
	`funùiÚ
(
s
è s.
si_pid
 
’d
,

215 
uid
 = 
	`funùiÚ
(
s
è s.
si_uid
 
’d
,

216 
¡©us
 = 
	`funùiÚ
(
s
è s.
si_¡©us
 
’d
,

217 
addr
 = 
	`funùiÚ
(
s
è s.
si_addr
 
’d
,

218 
v®ue
 = 
	`funùiÚ
(
s
è s.
si_v®ue
 
’d
,

219 
Œ­no
 = 
	`funùiÚ
(
s
è s.
_çuÉ
.
_Œ­no
 
’d
,

220 
tim”id
 = 
	`funùiÚ
(
s
è s.
_tim”
.
_tim”id
 
’d
,

221 
ov”run
 = 
	`funùiÚ
(
s
è s.
_tim”
.
_ov”run
 
’d
,

222 
mqd
 = 
	`funùiÚ
(
s
è s.
_mesgq
.
_mqd
 
’d
,

223 
bªd
 = 
	`funùiÚ
(
s
è s.
_pŞl
.
_bªd
 
’d
,

224 
sigÇme
 = 
	`funùiÚ
(
s
è 
sigÇmes
[s.
signo
] 
’d
,

226 
Ãwšdex
 = {

227 
signo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_signo
 = v 
’d
,

228 
”ºo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_”ºo
 = v 
’d
,

229 
code
 = 
	`funùiÚ
(
s
, 
v
ès.
si_code
 = v 
’d
,

230 
pid
 = 
	`funùiÚ
(
s
, 
v
ès.
si_pid
 = v 
’d
,

231 
uid
 = 
	`funùiÚ
(
s
, 
v
ès.
si_uid
 = v 
’d
,

232 
¡©us
 = 
	`funùiÚ
(
s
, 
v
ès.
si_¡©us
 = v 
’d
,

233 
addr
 = 
	`funùiÚ
(
s
, 
v
ès.
si_addr
 = v 
’d
,

234 
v®ue
 = 
	`funùiÚ
(
s
, 
v
ès.
si_v®ue
 = v 
’d
,

235 
Œ­no
 = 
	`funùiÚ
(
s
, 
v
ès.
_çuÉ
.
_Œ­no
 = v 
’d
,

236 
tim”id
 = 
	`funùiÚ
(
s
, 
v
ès.
_tim”
.
_tim”id
 = v 
’d
,

237 
ov”run
 = 
	`funùiÚ
(
s
, 
v
ès.
_tim”
.
_ov”run
 = v 
’d
,

238 
mqd
 = 
	`funùiÚ
(
s
, 
v
ès.
_mesgq
.
_mqd
 = v 
’d
,

239 
bªd
 = 
	`funùiÚ
(
s
, 
v
ès.
_pŞl
.
_bªd
 = v 
’d
,

241 
__Ën
 = 
Ënâ
,

242 
	}
}

244 
addty³
(
ty³s
, "sigšfo", "sigšfo_t", 
mt
.
sigšfo
)

246 -- 
	gsigaùiÚ
, 
¡ªd¬d
 
POSIX
 
behaviour
 
w™h
 
of
 
hªdËr
 
ªd
 
sigaùiÚ


247 
addty³_â
(
ty³s
, "sa_sigaction", "void (*)(int, siginfo_t *, void *)")

249 
	gmt
.
	gsigaùiÚ
 = {

250 
šdex
 = {

251 
hªdËr
 = 
funùiÚ
(
§
è sa.
__sigaùiÚ_u
.
__§_hªdËr
 
’d
,

252 
	gsigaùiÚ
 = 
funùiÚ
(
§
è sa.
__sigaùiÚ_u
.
__§_sigaùiÚ
 
’d
,

253 
	gmask
 = 
funùiÚ
(
§
è sa.
§_mask
 
’d
,

254 
	gæags
 = 
funùiÚ
(
§
è 
tÚumb”
(§.
§_æags
è
’d
,

256 
	gÃwšdex
 = {

257 
hªdËr
 = 
funùiÚ
(
§
, 
v
)

258 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


259 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


260 
§
.
__sigaùiÚ_u
.
__§_hªdËr
 = 
v


261 
’d
,

262 
	gsigaùiÚ
 = 
funùiÚ
(
§
, 
v
)

263 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


264 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


265 
§
.
__sigaùiÚ_u
.
__§_sigaùiÚ
 = 
v


266 
’d
,

267 
	gmask
 = 
funùiÚ
(
§
, 
v
)

268 
nÙ
 
	gffi
.
i¡y³
(
t
.
sig£t
, 
v
è
th’
 
	gv
 =.sig£t(vè
’d


269 
§
.
§_mask
 = 
v


270 
’d
,

271 
	gæags
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g§_æags
 = 
c
.
SA
[v] 
’d
,

273 
	g__Ãw
 = 
funùiÚ
(

, 
b
)

274 
loÿl
 
	g§
 = 
ffi
.
Ãw
(

)

275 
b
 
th’
 
k
, 
v
 
š
 
·œs
ÑabèdØ
	g§
[k] = v 
’d
ƒnd

276 
b
 
ªd
ab.
sigaùiÚ
 
th’
 
§
.
§_æags
 = 
b™
.
bÜ
(§.
æags
, 
c
.
SA
.
SIGINFO
è
	g’d
 -- 
this
 
æag
 
mu¡
 
be
 
£t
 sigaction set

277  
§


278 
	g’d
,

281 
addty³
(
ty³s
, "sigaùiÚ", "¡ruù sigaùiÚ", 
mt
.
sigaùiÚ
)

283 -- 
TODO
 
some
 
f›lds
 
¡l
 
missšg


284 
	gmt
.
	gsigev’t
 = {

285 
šdex
 = {

286 
nÙify
 = 
funùiÚ
(
£lf
è s–f.
sigev_nÙify
 
’d
,

287 
	gsigno
 = 
funùiÚ
(
£lf
è s–f.
sigev_signo
 
’d
,

288 
	gv®ue
 = 
funùiÚ
(
£lf
è s–f.
sigev_v®ue
 
’d
,

290 
	gÃwšdex
 = {

291 
nÙify
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_nÙify
 = 
c
.
SIGEV
[v] 
’d
,

292 
	gsigno
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_signo
 = 
c
.
SIG
[v] 
’d
,

293 
	gv®ue
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_v®ue
 = 
t
.
sigv®
(vè
’d
, --‡utØ
assigns
 
ba£d
 
Ú
 
	gty³


295 
	g__Ãw
 = 
Ãwâ
,

298 
addty³
(
ty³s
, "sigev’t", "¡ruù sigev’t", 
mt
.
sigev’t
)

300  
ty³s


302 
’d


304  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/util.lua

1 -- 
F»eBSD
 
uts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
S
)

12 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

13 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

15 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

17 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
où®
 = 
h
.octal

21 
loÿl
 
ut
 = {
	}
}

23 
loÿl
 
mt
 = {}

26  
ut


28 
’d


30  {
š™
 = init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/version.lua

1 -- 
d‘eù
 
ä“bsd
 
v”siÚ


3 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

5 -- 
nÙ
 
Ú
 
F»eBSD
 
ju¡
  
mo¡
 
»ûÁ


6 
abi
.
os
 ~ğ"ä“bsd" 
th’
  {
v”siÚ
 = 10} 
’d


8 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

10 
»quœe
 "syscall.ffitypes"

12 
ffi
.
cdef
 [[

13 
sysùl
(cÚ¡ *
Çme
, 
Çm–’
, *
Şdp
, 
size_t
 *
ŞdËÅ
, cÚ¡ *
Ãwp
, size_ˆ
ÃwËn
);

16 
loÿl
 
	gsc
 = 
ffi
.
Ãw
("št[2]", 1, 24è-- 
	gk”n
.
o¤–d©e


17 
loÿl
 
	go¤evisiÚ
 = 
ffi
.
Ãw
("int[1]")

18 
loÿl
 
ËÅ
 = 
ffi
.
Ãw
("unsigned†ong[1]", ffi.("int"))

19 
loÿl
 
	g»s
 = 
ffi
.
C
.
	$sysùl
(
sc
, 2, 
o¤evisiÚ
, 
ËÅ
, 
n
, 0)

20 
»s
 =ğ-1 
th’
 
	`”rÜ
("ÿÂÙ id’tify F»eBSD v”siÚ"è
’d


22 
loÿl
 
v”siÚ
 = 
m©h
.
	`æoÜ
(
o¤evisiÚ
[0] / 100000è-- 
majÜ
 v”siÚ 
›
 9, 10

24  {
v”siÚ
 = 
	}
version}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/helpers.lua

1 -- 
misc
 
h–³r
 
funùiÚs
 
th©
 
we
 
u£
 
aüoss
 
the
 
bßrd


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
	gm©h
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
m©h


10 
loÿl
 
	gdebug
, 
	gcŞËùg¬bage
 = 
»quœe
 "debug", 
cŞËùg¬bage


12 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

17 
loÿl
 
h
 = {}

19 -- 
g’”ic
 
as£¹
 
h–³r
, 
mašly
 
‹¡s


20 
funùiÚ
 
	gh
.
	$as£¹
(
cÚd
, 
”r
, ...)

21 
nÙ
 
cÚd
 
th’


22 
	`”rÜ
(
	`to¡ršg
(
”r
 
Ü
 "un¥ecif›dƒ¼Ü")è-- 
ªnoyšgly
, 
as£¹
 
dÛs
 
nÙ
 
ÿÎ
 
to¡ršg
!

23 
’d


24 
	`cŞËùg¬bage
("cŞËù"è-- 
fÜû
 
gc
, 
to
 
‹¡
 
bugs


25 
	`ty³
(
cÚd
è=ğ"funùiÚ" 
th’
  cÚd, 
”r
, ... 
’d


26 
cÚd
 =ğ
Œue
 
th’
  ... 
’d


27  
cÚd
, ...

28 
’d


30 
loÿl
 
voidp
 = 
ffi
.
	`ty³of
("void *")

32 
loÿl
 
funùiÚ
 
	$±void
(
x
)

33  
ffi
.
	$ÿ¡
(
voidp
, 
x
)

34 
’d


36 
loÿl
 
funùiÚ
 
	$±t
(

)

37 
loÿl
 
±p
 = 
ffi
.
	`ty³of
(

 .. " *")

38  
	$funùiÚ
(
x
è 
ffi
.
	$ÿ¡
(
±p
, 
x
è
’d


39 
’d


40 
h
.
±t
 =…tt

42 -- 
cÚ¡ªts


43 
h
.
ušt64_max
 = 
ffi
.
	`ÿ¡
("uint64_t", 0) - ffi.cast("uint64_t", 1)

44 
h
.
”r64
 = 
ffi
.
	`ÿ¡
("int64_t", -1)

45 
abi
.
abi64
 
th’
 
h
.
”½oš‹r
 = 
	$±void
(
h
.
”r64
èh.
”½oš‹r
 = 
	$±void
(0xffffffffè
’d


46 
h
.
ušt32_max
 = 
ffi
.
	`ÿ¡
("uint32_t", 0xffffffff)

47 
h
.
št32_max
 = 0x7fffffff

48 
abi
.
abi64
 
th’
 
h
.
lÚgmax
 = 
b™
.
	$rshiá64
(
h
.
”r64
, 1èh.
lÚgmax
 = h.
št32_max
 
’d


50 -- 
g’”ic
 
™”©Ü
 
th©
 
couÁs
 
down
 
so
 
Ãeds
 
no
 
şosu»
 
to
 
hŞd
 
¡©e


51 
funùiÚ
 
h
.
	$»v™”
(
¬¿y
, 
i
)

52 
i
 = i - 1

53 
i
 >ğ0 
th’
  i, 
¬¿y
[i] 
’d


54 
’d


56 
funùiÚ
 
h
.
	$mkty³
(

, 
x
è
ffi
.
	$i¡y³
(

, 
x
è
th’
  x  
	$
(
x
è
’d
ƒnd

57 
funùiÚ
 
h
.
	$i¡y³
(

, 
x
è
ffi
.
	$i¡y³
(

, 
x
è
th’
  x  
çl£
 
’d
ƒnd

59 
loÿl
 
funùiÚ
 
	$Ënâ
(

è 
ffi
.Ñpè
’d


60 
h
.
Ënâ
 =†enfn

61 
h
.
Ënmt
 = {
__Ën
 = 
Ënâ
}

63 
loÿl
 
	gtšt
 = 
ffi
.
ty³of
("int")

64 
loÿl
 
funùiÚ
 
	$g‘fd
(
fd
)

65 
	`ty³
(
fd
è=ğ"numb”" 
Ü
 
ffi
.
	$i¡y³
(
tšt
, 
fd
è
th’
  fd 
’d


66  
fd
:
	$g‘fd
()

67 
’d


68 
h
.
g‘fd
 = getfd

70 -- 
g’”ic
 
funùiÚ
 
__Ãw


71 
funùiÚ
 
h
.
	$Ãwâ
(

, 
b
)

72 
loÿl
 
obj
 = 
ffi
.
	$Ãw
(

)

73 
nÙ
 
b
 
th’
  
obj
 
’d


74 -- 
the£
 
¬e
 
¥l™
 
out
 
so
 
__Ãwšdex
 
is
 
ÿÎed
, 
nÙ
 
ju¡
 
š™Ÿli£rs
 
luaj™
 
und”¡ªds


75 
k
, 
v
 
š
 
	$·œs
(
b
èdØ
	`ty³
(
k
è=ğ"¡ršg" 
th’
 
obj
[k] = 
v
 
’d
ƒnd -- 
£t
 
¡ršg
 
šdexes


76  
obj


77 
’d


79 -- 
g’”ic
 
funùiÚ
 
__to¡ršg


80 
loÿl
 
funùiÚ
 
	$sim¶•ršt
(
±
, 
x
)

81 
loÿl
 
out
 = {
	}
}

82 
_
, 
v
 
š
 
	$aœs
(
±
èdØ
out
[#ouˆ+ 1] = 
v
 .. " = " .. 
	$to¡ršg
(
x
[
v
]è
’d


83  "{ " .. 
bË
.
	`cÚÿt
(
out
, ", ") .. " }"

84 
’d


86 -- 
ty³
 
š™Ÿli§tiÚ
 
h–³rs


87 
funùiÚ
 
h
.
	$addty³
(
ty³s
, 
Çme
, 

, 
mt
)

88 
abi
.
rumpâ
 
th’
 

 =‡bi.
	$rumpâ
(

è
’d


89 
mt
 
th’


90 
mt
.
šdex
 
ªd
 
nÙ
 mt.
__šdex
 
th’
 -- 
g’”ic
 index 
m‘hod


91 
loÿl
 
šdex
 = 
mt
.index

92 
mt
.
šdex
 = 
n


93 
mt
.
__šdex
 = 
	$funùiÚ
(

, 
k
è
šdex
[k] 
th’
  index[k]Ñpè
	`”rÜ
("šv®id index " .. kè
’d
ƒnd

94 
’d


95 
mt
.
Ãwšdex
 
ªd
 
nÙ
 mt.
__Ãwšdex
 
th’
 -- 
g’”ic
‚ewšdex 
m‘hod


96 
loÿl
 
Ãwšdex
 = 
mt
.newindex

97 
mt
.
Ãwšdex
 = 
n


98 
mt
.
__Ãwšdex
 = 
	$funùiÚ
(

, 
k
, 
v
è
Ãwšdex
[k] 
th’
‚ewšdex[k]Ñp, vè
	`”rÜ
("šv®id index " .. kè
’d
ƒnd

99 
’d


100 
nÙ
 
mt
.
__Ën
 
th’
 mt.__ËÀğ
Ënâ
 
’d
 --  
Ëngth
 
funùiÚ
 
is
 
ju¡
 

101 
nÙ
 
mt
.
__to¡ršg
 
ªd
 mt.
´št
 
th’
 mt.__to¡ršg = 
	$funùiÚ
(
x
è 
	$sim¶•ršt
(
mt
.
´št
, 
x
è
’d
ƒnd

102 
ty³s
.
t
[
Çme
] = 
ffi
.
	$m‘©y³
(

, 
mt
)

104 
ty³s
.
t
[
Çme
] = 
ffi
.
	$ty³of
(

)

105 
’d


106 
ty³s
.
ùy³s
[

] =y³s.
t
[
Çme
]

107 
ty³s
.
±
[
Çme
] = 
	$±t
(

)

108 
ty³s
.
s
[
Çme
] = 
ffi
.Ñy³s.
t
[name])

109 
’d


111 -- 
v¬ŸbËs
 
Ëngth
 
ty³s
, 
›
 
tho£
 
w™h
 
¬¿ys


112 
funùiÚ
 
h
.
	$addty³_v¬
(
ty³s
, 
Çme
, 

, 
mt
)

113 
abi
.
rumpâ
 
th’
 

 =‡bi.
	$rumpâ
(

è
’d


114 
nÙ
 
mt
.
__Ën
 
th’
 mt.__ËÀğ
Ënâ
 
’d
 --  
Ëngth
 
funùiÚ
 
is
 
ju¡
 , 
gives
 
š¡ªû
 
size
 
v¬
 
Êgth


115 
ty³s
.
t
[
Çme
] = 
ffi
.
	$m‘©y³
(

, 
mt
)

116 
ty³s
.
±
[
Çme
] = 
	$±t
(

)

117 
’d


119 
funùiÚ
 
h
.
	$addty³_â
(
ty³s
, 
Çme
, 

)

120 
abi
.
rumpâ
 
th’
 

 =‡bi.
	$rumpâ
(

è
’d


121 
ty³s
.
t
[
Çme
] = 
ffi
.
	$ty³of
(

)

122 
ty³s
.
s
[
Çme
] = 
ffi
.Ñy³s.
t
[name])

123 
’d


125 
funùiÚ
 
h
.
	$add¿w2
(
ty³s
, 
Çme
, 

)

126 
abi
.
rumpâ
 
th’
 

 =‡bi.
	$rumpâ
(

è
’d


127 
ty³s
.
t
[
Çme
] = 
ffi
.
	`ty³of
(

 .. "[2]")

128 
’d


130 
funùiÚ
 
h
.
	$addty³1
(
ty³s
, 
Çme
, 

)

131 
ty³s
.
t
[
Çme
] = 
ffi
.
	`ty³of
(

 .. "[1]")

132 
ty³s
.
s
[
Çme
] = 
ffi
.Ñy³s.
t
[name])

133 
’d


135 
funùiÚ
 
h
.
	$addty³2
(
ty³s
, 
Çme
, 

)

136 
ty³s
.
t
[
Çme
] = 
ffi
.
	`ty³of
(

 .. "[2]")

137 
ty³s
.
s
[
Çme
] = 
ffi
.Ñy³s.
t
[name])

138 
’d


140 
funùiÚ
 
h
.
	$add±¹y³
(
ty³s
, 
Çme
, 

)

141 
loÿl
 
±r
 = 
ffi
.
	$ty³of
(

)

142 
ty³s
.
t
[
Çme
] = 
	$funùiÚ
(
v
è 
ffi
.
	$ÿ¡
(
±r
, 
v
è
’d


143 
ty³s
.
s
[
Çme
] = 
ffi
.(
±r
)

144 
’d


146 -- 
’dŸn
 
cÚv”siÚ


147 -- 
TODO
 
add
 
‹¡s
 
eg
 
signs
.

148 
abi
.
be
 
th’
 -- 
nÙhšg
 
to
 do

149 
funùiÚ
 
h
.
	$htÚl
(
b
è b 
’d


150 
funùiÚ
 
h
.
	$htÚs
(
b
è b 
’d


151 
funùiÚ
 
h
.
	$cÚvË32
(
b
è 
b™
.
	$bsw­
(
b
è
’d
 -- 
u£d
 
by
 
fe
 
sy¡em
 
ÿ·b™›s
, 
®ways
 
¡Üed
 
as
 
Ë


153 
funùiÚ
 
h
.
	$htÚl
(
b
è 
b™
.
	$bsw­
(
b
è
’d


154 
funùiÚ
 
h
.
	$htÚs
(
b
è 
b™
.
	`rshiá
(b™.
	`bsw­
(b), 16è
’d


155 
funùiÚ
 
h
.
	$cÚvË32
(
b
è b 
’d
 -- 
u£d
 
by
 
fe
 
sy¡em
 
ÿ·b™›s
, 
®ways
 
¡Üed
 
as
 
Ë


156 
’d


157 
h
.
Áohl
 = h.
htÚl
 -- 
»v”£
 
is
 
the
 
§me


158 
h
.
Áohs
 = h.
htÚs
 -- 
»v”£
 
is
 
the
 
§me


160 
funùiÚ
 
h
.
	$où®
(
s
è 
	$tÚumb”
(
s
, 8è
’d


161 
loÿl
 
où®
 = 
h
.octal

163 
funùiÚ
 
h
.
	$¥l™
(
d–im™”
, 
‹xt
)

164 
d–im™”
 =ğ"" 
th’
  {
‹xt
}ƒnd

165 #‹xˆ=ğ0 
th’
  {} 
’d


166 
loÿl
 
li¡
 = {}

167 
loÿl
 
pos
 = 1

168 
Œue
 do

169 
loÿl
 
fœ¡
, 
	gÏ¡
 = 
‹xt
:
	$fšd
(
d–im™”
, 
pos
)

170 
fœ¡
 
th’


171 
li¡
[#li¡ + 1] = 
‹xt
:
	`sub
(
pos
, 
fœ¡
 - 1)

172 
pos
 = 
Ï¡
 + 1

174 
li¡
[#li¡ + 1] = 
‹xt
:
	$sub
(
pos
)

176 
’d


177 
’d


178  
li¡


179 
’d


181 
funùiÚ
 
h
.
	`Œim
(
s
è-- 
TODO
 
should
 
»¶aû
 
und”scÜe
 
w™h
 
¥aû


182  (
s
:
	`gsub
("^%s*(.-)%s*$", "%1"))

183 
’d


185 
loÿl
 
¥l™
, 
Œim
 = 
h
.split, h.trim

187 -- 
AT_FDCWD


188 
funùiÚ
 
h
.
	$©æag
(
b
)

189 
loÿl
 
funùiÚ
 
	$æag
(
ÿche
, 
¡r
)

190 
nÙ
 
¡r
 
th’
  
b
.
FDCWD
 
’d


191 
	`ty³
(
¡r
è=ğ"numb”" 
th’
  sŒ 
’d


192 
	`ty³
(
¡r
è~ğ"¡ršg" 
th’
  
	$g‘fd
(
¡r
è
’d


193 #¡¸=ğ0 
th’
  0 
’d


194 
loÿl
 
s
 = 
	$Œim
(
¡r
):
	$uµ”
()

195 # =ğ0 
th’
  0 
’d


196 
loÿl
 
v®
 = 
	$¿wg‘
(
b
, 
s
)

197 
nÙ
 
v®
 
th’
 
	`”rÜ
("šv®id fÏg " .. 
s
è
’d


198 
ÿche
[
¡r
] = 
v®


199  
v®


200 
’d


201  
	`£tm‘©abË
(
b
, {
__šdex
 = s‘m‘©abË({}, {__šdex = 
æag
}), 
__ÿÎ
 = 
	`funùiÚ
(
t
, 
a
è[a] 
’d
})

202 
	g’d


204 -- 
sšgË
 
v®ued
 
æags


205 
funùiÚ
 
	gh
.
	$¡ræag
(
b
)

206 
loÿl
 
funùiÚ
 
	$æag
(
ÿche
, 
¡r
)

207 
	`ty³
(
¡r
è~ğ"¡ršg" 
th’
  sŒ 
’d


208 #¡¸=ğ0 
th’
  0 
’d


209 
loÿl
 
s
 = 
	$Œim
(
¡r
):
	$uµ”
()

210 # =ğ0 
th’
  0 
’d


211 
loÿl
 
v®
 = 
	$¿wg‘
(
b
, 
s
)

212 
nÙ
 
v®
 
th’
  
n
 
’d


213 
ÿche
[
¡r
] = 
v®


214  
v®


215 
’d


216  
	`£tm‘©abË
(
b
, {
__šdex
 = s‘m‘©abË({}, {__šdex = 
æag
}), 
__ÿÎ
 = 
	`funùiÚ
(
t
, 
a
è[a] 
’d
})

217 
	g’d


219 -- 
ke
 
a
 
bunch
 
of
 
æags
 
š
‡ 
¡ršg
 
ªd
 ‡ 
	gnumb”


220 -- 
®lows
 
muÉË
 
comma
 
£p
 
æags
 
th©
 
¬e
 
ORed


221 
funùiÚ
 
	gh
.
	$muÉiæags
(
b
)

222 
loÿl
 
funùiÚ
 
	$æag
(
ÿche
, 
¡r
)

223 
nÙ
 
¡r
 
th’
  0 
’d


224 
	`ty³
(
¡r
è~ğ"¡ršg" 
th’
  sŒ 
’d


225 #¡¸=ğ0 
th’
  0 
’d


226 
loÿl
 
f
 = 0

227 
loÿl
 
a
 = 
	`¥l™
(",", 
¡r
)

228 #¨=ğ1 
ªd
 
¡r
 =ğ¡r:
	$uµ”
(è
th’
  
n
 
’d
 -- 
this
 
is
 
to
 
®low
 
‹¡šg
 
´e£n£
, 
ÿtchšg
 
”rÜs


229 
_
, 
v
 
š
 
	$aœs
(
a
) do

230 
loÿl
 
s
 = 
	$Œim
(
v
):
	$uµ”
()

231 # =ğ0 
th’
 
	`”rÜ
("em±y fÏg"è
’d


232 
loÿl
 
v®
 = 
	$¿wg‘
(
b
, 
s
)

233 
nÙ
 
v®
 
th’
 
	`”rÜ
("šv®id fÏg " .. 
s
è
’d


234 
f
 = 
b™
.
	$bÜ
(
f
, 
v®
)

235 
’d


236 
ÿche
[
¡r
] = 
f


237  
f


238 
’d


239  
	`£tm‘©abË
(
b
, {

240 
__šdex
 = 
	`£tm‘©abË
({}, {__šdex = 
æag
}),

241 
__ÿÎ
 = 
	`funùiÚ
(
b
, 
x
, ...è-- 
this
 
®lows
 
—sy
 
addšg
 
Ü
 
»movšg
 
a
 
æag


242 
loÿl
 
a
 = 
b
[
x
]

243 
_
, 
v
 
š
 
aœs
{...} do

244 
	`ty³
(
v
è=ğ"¡ršg" 
ªd
 v:
	`fšd
("~"è
th’
 -- 
®low
 
Ãg©iÚ
 
eg
 
c
.
	`IFF
(
Şd
, "~UP")

245 
loÿl
 
§
 = 
	`¥l™
(",", 
v
)

246 
_
, 
vv
 
š
 
	`aœs
(
§
) do

247 
loÿl
 
s
 = 
	`Œim
(
vv
):
	`uµ”
()

248 # =ğ0 
th’
 
	`”rÜ
("em±y fÏg"è
’d


249 
loÿl
 
Ãg©e
 = 
çl£


250 
s
:
	`sub
(1, 1è=ğ"~" 
th’


251 
Ãg©e
 = 
Œue


252 
s
 = 
	`Œim
(s:
	`sub
(2))

253 # =ğ0 
th’
 
	`”rÜ
("em±y fÏg"è
’d


254 
’d


255 
loÿl
 
v®
 = 
	`¿wg‘
(
b
, 
s
)

256 
nÙ
 
v®
 
th’
 
	`”rÜ
("šv®id fÏg " .. 
s
è
’d


257 
Ãg©e
 
th’
 
a
 = 
b™
.
	`bªd
×, b™.
	`bnÙ
(
v®
)è¨ğb™.
	`bÜ
×, v®è
’d


258 
’d


260 
a
 = 
b™
.
	`bÜ
×, 
b
[
v
])

261 
’d


262 
’d


263  
a


264 
’d
,

265 
	}
})

266 
	g’d


268 -- 
like
 
muÉiæags
 
but
 
®so
 
®low
 
où®
 
v®ues
 
š
 
¡ršg


269 
funùiÚ
 
	gh
.
	$modeæags
(
b
)

270 
loÿl
 
funùiÚ
 
	$æag
(
ÿche
, 
¡r
)

271 
nÙ
 
¡r
 
th’
  0 
’d


272 
	`ty³
(
¡r
è~ğ"¡ršg" 
th’
  sŒ 
’d


273 #¡¸=ğ0 
th’
  0 
’d


274 
loÿl
 
f
 = 0

275 
loÿl
 
a
 = 
	`¥l™
(",", 
¡r
)

276 #¨=ğ1 
ªd
 
¡r
 =ğ¡r:
	$uµ”
(è
ªd
 
¡r
:
	`sub
(1,1è~ğ"0" 
th’
  
n
 
’d
 -- 
this
 
is
 
to
 
®low
 
‹¡šg
 
´e£n£
, 
ÿtchšg
 
”rÜs


277 
i
, 
v
 
š
 
	$aœs
(
a
) do

278 
loÿl
 
s
 = 
	$Œim
(
v
):
	$uµ”
()

279 # =ğ0 
th’
 
	`”rÜ
("em±y fÏg"è
’d


280 
loÿl
 
v®


281 
s
:
	`sub
(1, 1è=ğ"0" 
th’


282 
v®
 = 
	$où®
(
s
)

284 
v®
 = 
	$¿wg‘
(
b
, 
s
)

285 
nÙ
 
v®
 
th’
 
	`”rÜ
("šv®id fÏg " .. 
s
è
’d


286 
’d


287 
f
 = 
b™
.
	$bÜ
(
f
, 
v®
)

288 
’d


289 
ÿche
[
¡r
] = 
f


290  
f


291 
’d


292  
	`£tm‘©abË
(
b
, {
__šdex
 = s‘m‘©abË({}, {__šdex = 
æag
}), 
__ÿÎ
 = 
	`funùiÚ
(
t
, 
a
è[a] 
’d
})

293 
’d


295 
funùiÚ
 
	gh
.
	$sw­æags
(
b
)

296 
loÿl
 
funùiÚ
 
	$æag
(
ÿche
, 
¡r
)

297 
nÙ
 
¡r
 
th’
  0 
’d


298 
	`ty³
(
¡r
è~ğ"¡ršg" 
th’
  sŒ 
’d


299 #¡¸=ğ0 
th’
  0 
’d


300 
loÿl
 
f
 = 0

301 
loÿl
 
a
 = 
	`¥l™
(",", 
¡r
)

302 #¨=ğ1 
ªd
 
¡r
 =ğ¡r:
	$uµ”
(è
th’
  
n
 
’d
 -- 
this
 
is
 
to
 
®low
 
‹¡šg
 
´e£n£
, 
ÿtchšg
 
”rÜs


303 
i
, 
v
 
š
 
	$aœs
(
a
) do

304 
loÿl
 
s
 = 
	$Œim
(
v
):
	$uµ”
()

305 # =ğ0 
th’
 
	`”rÜ
("em±y fÏg"è
’d


306 
	$tÚumb”
(
s
è
th’


307 
loÿl
 
v®
 = 
	$tÚumb”
(
s
)

308 
f
 = 
b™
.
	`bÜ
(f, 
	`¿wg‘
(
b
, "PREFER"), b™.
	`lshiá
(b™.
	`bªd
Ôawg‘Ñab, "PRIO_MASK"), 
v®
),„awget(tab, "PRIO_SHIFT")))

310 
loÿl
 
v®
 = 
	$¿wg‘
(
b
, 
s
)

311 
nÙ
 
v®
 
th’
 
	`”rÜ
("šv®id fÏg " .. 
s
è
’d


312 
f
 = 
b™
.
	$bÜ
(
f
, 
v®
)

313 
’d


314 
’d


315 
ÿche
[
¡r
] = 
f


316  
f


317 
’d


318  
	`£tm‘©abË
(
b
, {
__šdex
 = s‘m‘©abË({}, {__šdex = 
æag
}), 
__ÿÎ
 = 
	`funùiÚ
(
t
, 
a
è[a] 
’d
})

319 
	g’d


321 -- 
sšgË
 
	gæags
, 
eg
 
u£d
 
acûss
 
which
 
	g®lows
 "rwx"

322 
funùiÚ
 
	gh
.
	$ch¬æags
(
b
)

323 
loÿl
 
funùiÚ
 
	$æag
(
ÿche
, 
¡r
)

324 
nÙ
 
¡r
 
th’
  0 
’d


325 
	`ty³
(
¡r
è~ğ"¡ršg" 
th’
  sŒ 
’d


326 
¡r
 = 
	`Œim
(¡r:
	$uµ”
())

327 
loÿl
 
æag
 = 0

328 
i
 = 1, #str do

329 
loÿl
 
c
 = 
¡r
:
	$sub
(
i
, i)

330 
loÿl
 
v®
 = 
	$¿wg‘
(
b
, 
c
)

331 
nÙ
 
v®
 
th’
 
	`”rÜ
("šv®id fÏg " .. 
c
è
’d


332 
æag
 = 
b™
.
	$bÜ
(
æag
, 
v®
)

333 
’d


334 
ÿche
[
¡r
] = 
æag


335  
æag


336 
’d


337  
	`£tm‘©abË
(
b
, {
__šdex
 = s‘m‘©abË({}, {__šdex = 
æag
}), 
__ÿÎ
 = 
	`funùiÚ
(
t
, 
a
è[a] 
’d
})

338 
’d


340 
	gh
.
	gdivmod
 = 
	$funùiÚ
(
a
, 
b
)

341  
m©h
.
	`æoÜ
(
a
 / 
b
),‡ % b

342 
’d


344 
h
.
boŞtoc
 = 
	`£tm‘©abË
({

347 [
çl£
] = 0,

348 [
Œue
] = 1,

349 
	}
}, {
	g__ÿÎ
 = 
funùiÚ
(
tb
, 
¬g
è 
	gtb
[¬g 
Ü
 0] 
	g’d
}è-- 
®low
 
n
 
as
 
çl£


351 
funùiÚ
 
	gh
.
	$ùoboŞ
(
i
è 
	`tÚumb”
(iè~ğ0 
’d


353 
loÿl
 
funùiÚ
 
	$®ign
(
Ën
, 
a
è 
b™
.
	`bªd
(
	`tÚumb”
Ö’è+‡ - 1, b™.
	`bnÙ
× - 1)è
’d


354 
h
.
®ign
 =‡lign

356  
h


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/lfs.lua

1 -- 
this
 
is
 
š‹nded
 
to
 
be
 
com·tibË
 
w™h
 
luafesy¡em
 
	gh‰ps
:

3 -- 
cu¼’y
 
dÛs
 
nÙ
 
im¶em’t
 
locks


5 
loÿl
 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

6 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

7 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

8 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

9 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

10 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg


12 -- 
TODO
 
®low
 
u£
 
eg
 
w™h
 
rump
 
	gk”Ãl
, 
Ãeds
 
ª
 
š™Ÿli§tiÚ
 
	gİtiÚ


13 -- 
maybe
  
a
 
bË
 
w™h
‡ 
m‘©abË
 
th©
 
®lows
 
š™
 
Ü
 
u£s
  
no
 
	gš™
?

14 
loÿl
 
	gS
 = 
»quœe
 "syscall"

16 -- 
TODO
 
nÙ
 
im¶em’‹d


17 -- 
lfs
.
lock_dœ


18 -- 
lfs
.
lock


19 -- 
uÆock


21 
loÿl
 
funùiÚ
 
	$lfsw¿p
(
f
)

22  
	$funùiÚ
(...)

23 
loÿl
 
»t
, 
”r
 = 
	$f
(...)

24 
nÙ
 
»t
 
th’
  
n
, 
	$to¡ršg
(
”r
è
’d


25  
»t


26 
’d


27 
’d


29 
loÿl
 
lfs
 = {
	}
}

31 
lfs
.
_VERSION
 = "ljsyscall†fs 1"

33 
loÿl
 
©Œibu‹s
 = {

34 
dev
 = "dev",

35 
	gšo
 = "ino",

36 
	gmode
 = "ty³Çme", -- 
nÙ
 
su»
 
why
 
lfs
 
šsi¡s
 
Ú
 
ÿÎšg
 
this
 
mode


37 
	gÆšk
 = "nlink",

38 
	guid
 = "uid",

39 
	ggid
 = "gid",

40 
	grdev
 = "rdev",

41 
	gacûss
 = "access",

42 
	gmodifiÿtiÚ
 = "modification",

43 
	gchªge
 = "change",

44 
	gsize
 = "size",

45 
	gblocks
 = "blocks",

46 
	gblksize
 = "blksize",

49 
loÿl
 
funùiÚ
 
	$©Œ
(
¡
, 
ªame
)

50 
ªame
 
th’


51 
ªame
 = 
©Œibu‹s
[aname]

52  
¡
[
ªame
]

53 
’d


54 
loÿl
 
»t
 = {
	}
}

55 
k
, 
v
 
š
 
	$·œs
(
©Œibu‹s
èdØ
»t
[
k
] = 
¡
[
v
] 
’d


56  
»t


57 
’d


59 
funùiÚ
 
lfs
.
	$©Œibu‹s
(
f•©h
, 
ªame
)

60 
loÿl
 
¡
, 
”r
 = 
S
.
	$¡©
(
f•©h
)

61 
nÙ
 
¡
 
th’
  
n
, 
	$to¡ršg
(
”r
è
’d


62  
	$©Œ
(
¡
, 
ªame
)

63 
’d


64 
funùiÚ
 
lfs
.
	$symlšk©Œibu‹s
(
f•©h
, 
ªame
)

65 
loÿl
 
¡
, 
”r
 = 
S
.
	$l¡©
(
f•©h
)

66 
nÙ
 
¡
 
th’
  
n
, 
	$to¡ršg
(
”r
è
’d


67  
	$©Œ
(
¡
, 
ªame
)

68 
’d


70 
lfs
.
chdœ
 = 
	$lfsw¿p
(
S
.
chdœ
)

71 
lfs
.
cu¼’tdœ
 = 
	$lfsw¿p
(
S
.
g‘cwd
)

72 
lfs
.
rmdœ
 = 
	$lfsw¿p
(
S
.
rmdœ
)

73 
lfs
.
touch
 = 
	$lfsw¿p
(
S
.
utime
)

75 
funùiÚ
 
lfs
.
	$mkdœ
(
·th
)

76 
loÿl
 
»t
, 
”r
 = 
S
.
	`mkdœ
(
·th
, "0777")

77 
nÙ
 
»t
 
th’
  
n
, 
	$to¡ršg
(
”r
è
’d


78  
»t


79 
’d


81 
loÿl
 
funùiÚ
 
	$dœ_şo£
(
dœ
)

82 
dœ
.
fd
:
	$şo£
()

83 
dœ
.
fd
 = 
n


84 
’d


86 
loÿl
 
funùiÚ
 
	$dœ_Ãxt
(
dœ
)

87 
nÙ
 
dœ
.
fd
 
th’
 
”rÜ
 "dœƒnded" 
’d


88 
loÿl
 
d


89 
»³©


90 
nÙ
 
dœ
.
di
 
th’


91 
loÿl
 
”r


92 
dœ
.
di
, 
”r
 = dœ.
fd
:
	$g‘d’ts
(
dœ
.
buf
, dœ.
size
)

93 
nÙ
 
dœ
.
di
 
th’


94 
	$dœ_şo£
(
dœ
)

95 
	`”rÜ
(
	`to¡ršg
(
”r
)è-- 
nÙ
 
su»
 
how
 
we
 
¬e
 
suµo£
 
to
 
hªdË
 
”rÜs


96 
’d


97 
dœ
.
fœ¡
 = 
Œue


98 
’d


99 
d
 = 
dœ
.
	$di
()

100 
nÙ
 
d
 
th’


101 
dœ
.
di
 = 
n


102 
dœ
.
fœ¡
 
th’


103 
	$dœ_şo£
(
dœ
)

104  
n


105 
’d


106 
’d


107 
dœ
.
fœ¡
 = 
çl£


108 
uÁ
 
d


109  
d
.
Çme


110 
’d


112 
funùiÚ
 
lfs
.
	$dœ
(
·th
)

113 
loÿl
 
size
 = 4096

114 
loÿl
 
buf
 = 
S
.
t
.
	$bufãr
(
size
)

115 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
·th
, "directory,„donly")

116 
”r
 
th’
  
n
, 
	$to¡ršg
(
”r
è
’d


117  
dœ_Ãxt
, {
size
 = size, 
buf
 = buf, 
fd
 = fd, 
Ãxt
 = dœ_Ãxt, 
şo£
 = 
dœ_şo£
}

118 
’d


120 
loÿl
 
	gæšk
, 
	gfsymlšk
 = 
lfsw¿p
(
S
.
lšk
), 
	$lfsw¿p
(
S
.
symlšk
)

122 
funùiÚ
 
lfs
.
	$lšk
(
Şd
, 
Ãw
, 
symlšk
)

123 
symlšk
 
th’


124  
	$fsymlšk
(
Şd
, 
Ãw
)

126  
	$æšk
(
Şd
, 
Ãw
)

127 
’d


128 
’d


130 
funùiÚ
 
lfs
.
	$£tmode
(
fe
, 
mode
è 
Œue
, "bš¬y" 
’d


132  
lfs


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/libc.lua

1 -- 
thšgs
 
th©
 
¬e
 
libc
 
	gÚly
, 
nÙ
 
	gsysÿÎs


2 -- 
this
 
fe
 
wl
 
nÙ
 
be
 
šşuded
 nÙ 
ruÂšg
 
w™h
 
libc
 
eg
 
rump


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
funùiÚ
 
	$š™
(
S
)

13 
loÿl
 
c
 = 
S
.c

14 
loÿl
 
ty³s
 = 
S
.types

15 
loÿl
 
t
, 
s
, 
±
 = 
ty³s
.t,ypes.s,ypes.pt

17 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
z”İoš‹r
 = 
±
.(0)

23 
loÿl
 
funùiÚ
 
	$»tboŞ
(
»t
)

24 
»t
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


25  
Œue


26 
’d


28 -- 
g‘cwd
 
nÙ
 
defšed
, 
çÎ
 
back
 
to
 
libc
 
	`im¶em’tiÚ
 (
cu¼’y
 
osx
, 
ä“bsd
)

29 -- 
ä“bsd
 
im¶em’tiÚ
 
çœly
 
com¶ex


30 
nÙ
 
S
.
g‘cwd
 
th’


31 
ffi
.
cdef
 [[

32 *
	`g‘cwd
(*
buf
, 
size_t
 
size
);

34 
funùiÚ
 
S
.
	$g‘cwd
(
buf
, 
size
)

35 
size
 = siz
Ü
 
c
.
PATH_MAX


36 
buf
 = buà
Ü
 
t
.
	$bufãr
(
size
)

37 
loÿl
 
»t
 = 
ffi
.
C
.
	$g‘cwd
(
buf
, 
size
)

38 
»t
 =ğ
z”İoš‹r
 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


39  
ffi
.
	$¡ršg
(
buf
)

40 
’d


41 
’d


43 -- 
š
 
N‘BSD
, 
OSX
 
ex™
 
defšed
 iÀ
libc
, 
no
 
_ex™
 
sysÿÎ
 
avaabË


44 
nÙ
 
S
.
ex™
 
th’


45 
funùiÚ
 
S
.
	$ex™
(
¡©us
è 
	`»tboŞ
(
ffi
.
C
.
	$ex™
(
c
.
EXIT
[
¡©us
 
Ü
 0])è
’d


46 
’d


48 
nÙ
 
S
.
_ex™
 
th’


49 
S
.
_ex™
 = S.
ex™
 -- 
´ovide
 
sysÿÎ
ƒx™ 
possibË


50 
’d


52 
ffi
.
cdef
 [[

53 
	`__cxa_©ex™
((*
func
è(*), * 
¬g
, * 
dso_hªdË
);

56 
loÿl
 
funùiÚ
 
	$šlibc
(
k
è 
ffi
.
C
[k] 
’d


58 
	`pÿÎ
(
šlibc
, "ex™"è
ªd
…ÿÎ(šlibc, "__cxa_©ex™"è
th’


59 
funùiÚ
 
S
.
	$ex™
(
¡©us
è 
	`»tboŞ
(
ffi
.
C
.
	$ex™
(
c
.
EXIT
[
¡©us
 
Ü
 0])è
’d
 -- 
u£
 
libc
 
ex™
 
š¡—d


60 
funùiÚ
 
S
.
	$©ex™
(
f
è 
	`»tboŞ
(
ffi
.
C
.
	$__cxa_©ex™
(
f
, 
n
,‚)è
’d


61 
’d


63 --[[ -- 
Ãed
 
mÜe
 
ty³s
 
defšed


64 
	`uÇme
(
ut¢ame
 *
buf
);

65 
time_t
 
	`time
Ñime_ˆ*
t
);

69 
	`g‘ho¡Çme
(*
Çme
, 
size_t
 
Çm–’
);

70 
	`£tho¡Çme
(cÚ¡ *
Çme
, 
size_t
 
Ën
);

71 
	`g‘domašÇme
(*
Çme
, 
size_t
 
Çm–’
);

72 
	`£tdomašÇme
(cÚ¡ *
Çme
, 
size_t
 
Ën
);

75 -- 
’vœÚm’t


76 
ffi
.
cdef
 [[

78 **
’vœÚ
;

80 
	`£‹nv
(cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
ov”wr™e
);

81 
	`un£‹nv
(cÚ¡ *
Çme
);

82 
	`ş—»nv
();

83 *
	`g‘’v
(cÚ¡ *
Çme
);

86 
funùiÚ
 
S
.
	`’vœÚ
(è--  
whŞe
 
’vœÚm’t
 
as
 
bË


87 
loÿl
 
’vœÚ
 = 
ffi
.
C
.environ

88 
nÙ
 
’vœÚ
 
th’
  
n
 
’d


89 
loÿl
 
r
 = {
	}
}

90 
loÿl
 
i
 = 0

91 
’vœÚ
[
i
] ~ğ
z”İoš‹r
 do

92 
loÿl
 
e
 = 
ffi
.
	$¡ršg
(
’vœÚ
[
i
])

93 
loÿl
 
eq
 = 
e
:
	`fšd
('=')

94 
eq
 
th’


95 
r
[
e
:
	`sub
(1, 
eq
 - 1)] =ƒ:sub(eq + 1)

96 
’d


97 
i
 = i + 1

98 
’d


99  
r


100 
’d


102 
funùiÚ
 
S
.
	$g‘’v
(
Çme
)

103  
S
.
	`’vœÚ
()[
Çme
]

104 
’d


105 
funùiÚ
 
S
.
	$un£‹nv
(
Çme
è 
	`»tboŞ
(
ffi
.
C
.
	$un£‹nv
(
Çme
)è
’d


106 
funùiÚ
 
S
.
	$£‹nv
(
Çme
, 
v®ue
, 
ov”wr™e
)

107 
ov”wr™e
 = 
h
.
	`boŞtoc
(ov”wr™eè-- 
®lows
 
n
 
as
 
çl£
/0

108  
	`»tboŞ
(
ffi
.
C
.
	$£‹nv
(
Çme
, 
v®ue
, 
ov”wr™e
))

109 
’d


110 
funùiÚ
 
S
.
	$ş—»nv
(è 
	`»tboŞ
(
ffi
.
C
.
	$ş—»nv
()è
’d


112 
S
.
”ºo
 = 
ffi
.errno

114  
S


116 
’d


118  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/constants.lua

1 -- 
¬m
 
¥ecific
 
cÚ¡ªts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
où®
 = 
	$funùiÚ
 (
s
è 
	$tÚumb”
(
s
, 8è
’d


14 
loÿl
 
¬ch
 = {
	}
}

16 
¬ch
.
O
 = {

17 
RDONLY
 = 
où®
('0000'),

18 
	gWRONLY
 = 
où®
('0001'),

19 
	gRDWR
 = 
où®
('0002'),

20 
	gACCMODE
 = 
où®
('0003'),

21 
	gCREAT
 = 
où®
('0100'),

22 
	gEXCL
 = 
où®
('0200'),

23 
	gNOCTTY
 = 
où®
('0400'),

24 
	gTRUNC
 = 
où®
('01000'),

25 
	gAPPEND
 = 
où®
('02000'),

26 
	gNONBLOCK
 = 
où®
('04000'),

27 
	gDSYNC
 = 
où®
('010000'),

28 
	gASYNC
 = 
où®
('020000'),

29 
	gDIRECTORY
 = 
où®
('040000'),

30 
	gNOFOLLOW
 = 
où®
('0100000'),

31 
	gDIRECT
 = 
où®
('0200000'),

32 
	gLARGEFILE
 = 
où®
('0400000'),

33 
	gNOATIME
 = 
où®
('01000000'),

34 
	gCLOEXEC
 = 
où®
('02000000'),

35 
	gSYNC
 = 
où®
('04010000'),

38  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/ffi.lua

1 -- 
¬m
 
¥ecific
 
defš™iÚs


4 
	gucÚ‹xt
 = [[

5 
g»g_t
, 
g»g£t_t
[18];

6 
	ssigcÚ‹xt
 {

7 
	gŒ­_no
, 
	g”rÜ_code
, 
	gŞdmask
;

8 
	g¬m_r0
, 
	g¬m_r1
, 
	g¬m_r2
, 
	g¬m_r3
;

9 
	g¬m_r4
, 
	g¬m_r5
, 
	g¬m_r6
, 
	g¬m_r7
;

10 
	g¬m_r8
, 
	g¬m_r9
, 
	g¬m_r10
, 
	g¬m_å
;

11 
	g¬m_
, 
	g¬m_¥
, 
	g¬m_Ì
, 
	g¬m_pc
;

12 
	g¬m_ı¤
, 
	gçuÉ_add»ss
;

13 } 
	tmcÚ‹xt_t
;

14 
	s__ucÚ‹xt
 {

15 
	guc_æags
;

16 
__ucÚ‹xt
 *
	guc_lšk
;

17 
¡ack_t
 
	guc_¡ack
;

18 
mcÚ‹xt_t
 
	guc_mcÚ‹xt
;

19 
sig£t_t
 
	guc_sigmask
;

20 
	guc_»g¥aû
[64];

21 } 
	tucÚ‹xt_t
;

23 
	g¡©
 = [[

24 
	s¡©
 {

25 
¡_dev
;

26 
__·d0
[4];

27 
	g__¡_šo
;

28 
	g¡_mode
;

29 
	g¡_Æšk
;

30 
	g¡_uid
;

31 
	g¡_gid
;

32 
	g¡_rdev
;

33 
	g__·d3
[4];

34 
	g¡_size
;

35 
	g¡_blksize
;

36 
	g¡_blocks
;

37 
	g¡_©ime
;

38 
	g¡_©ime_n£c
;

39 
	g¡_mtime
;

40 
	g¡_mtime_n£c
;

41 
	g¡_ùime
;

42 
	g¡_ùime_n£c
;

43 
	g¡_šo
;

46 
	g¡©fs
 = [[

47 
ušt32_t
 
¡©fs_wÜd
;

48 
	s¡©fs64
 {

49 
¡©fs_wÜd
 
f_ty³
;

50 
¡©fs_wÜd
 
f_bsize
;

51 
ušt64_t
 
f_blocks
;

52 
ušt64_t
 
f_bä“
;

53 
ušt64_t
 
f_bava
;

54 
ušt64_t
 
f_fes
;

55 
ušt64_t
 
f_fä“
;

56 
k”Ãl_fsid_t
 
f_fsid
;

57 
¡©fs_wÜd
 
f_Çm–’
;

58 
¡©fs_wÜd
 
f_äsize
;

59 
¡©fs_wÜd
 
f_æags
;

60 
¡©fs_wÜd
 
f_¥¬e
[4];

61 } 
__©Œibu‹__
((
·cked
,
®igÃd
(4)));

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/ioctl.lua

1 -- 
ARM
 
ioùl
 
difã»nûs


3 
loÿl
 
	g¬ch
 = {

4 
ioùl
 = {

5 
FIOQSIZE
 = 0x545E,

9  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/nr.lua

1 -- 
¬m
 
sysÿÎ
 
	gnumb”s


3 -- 
—bi
 
Úly


5 
loÿl
 
	gÄ
 = {

6 
z”İad
 = 
Œue
,

7 
	gSYS
 = {

8 
»¡¬t_sysÿÎ
 = 0,

9 
	gex™
 = 1,

10 
	gfÜk
 = 2,

11 
	g»ad
 = 3,

12 
	gwr™e
 = 4,

13 
	gİ’
 = 5,

14 
	gşo£
 = 6,

15 
	gü—t
 = 8,

16 
	glšk
 = 9,

17 
	guÆšk
 = 10,

18 
	gexecve
 = 11,

19 
	gchdœ
 = 12,

20 
	gmknod
 = 14,

21 
	gchmod
 = 15,

22 
	glchown
 = 16,

23 
	gl£ek
 = 19,

24 
	gg‘pid
 = 20,

25 
	gmouÁ
 = 21,

26 
	g£tuid
 = 23,

27 
	gg‘uid
 = 24,

28 
	g±¿û
 = 26,

29 
	g·u£
 = 29,

30 
	gacûss
 = 33,

31 
	gniû
 = 34,

32 
	gsync
 = 36,

33 
	gkl
 = 37,

34 
	g»Çme
 = 38,

35 
	gmkdœ
 = 39,

36 
	grmdœ
 = 40,

37 
	gdup
 = 41,

38 
	gpe
 = 42,

39 
	gtimes
 = 43,

40 
	gbrk
 = 45,

41 
	g£tgid
 = 46,

42 
	gg‘gid
 = 47,

43 
	gg‘euid
 = 49,

44 
	gg‘egid
 = 50,

45 
	gacù
 = 51,

46 
	gumouÁ2
 = 52,

47 
	gioùl
 = 54,

48 
	gfú
 = 55,

49 
	g£gid
 = 57,

50 
	gumask
 = 60,

51 
	gchroÙ
 = 61,

52 
	gu¡©
 = 62,

53 
	gdup2
 = 63,

54 
	gg‘µid
 = 64,

55 
	gg‘pg½
 = 65,

56 
	g£tsid
 = 66,

57 
	gsigaùiÚ
 = 67,

58 
	g£Œeuid
 = 70,

59 
	g£Œegid
 = 71,

60 
	gsigsu¥’d
 = 72,

61 
	gsig³ndšg
 = 73,

62 
	g£tho¡Çme
 = 74,

63 
	g£Œlim™
 = 75,

64 
	gg‘ru§ge
 = 77,

65 
	gg‘timeofday
 = 78,

66 
	g£‰imeofday
 = 79,

67 
	gg‘groups
 = 80,

68 
	g£tgroups
 = 81,

69 
	gsymlšk
 = 83,

70 
	g»adlšk
 = 85,

71 
	gu£lib
 = 86,

72 
	gsw­Ú
 = 87,

73 
	g»boÙ
 = 88,

74 
	gmunm­
 = 91,

75 
	gŒunÿ‹
 = 92,

76 
	gárunÿ‹
 = 93,

77 
	gfchmod
 = 94,

78 
	gfchown
 = 95,

79 
	gg‘´iÜ™y
 = 96,

80 
	g£riÜ™y
 = 97,

81 
	g¡©fs
 = 99,

82 
	gf¡©fs
 = 100,

83 
	gsy¦og
 = 103,

84 
	g£t™im”
 = 104,

85 
	gg‘™im”
 = 105,

86 
	g¡©
 = 106,

87 
	gl¡©
 = 107,

88 
	gf¡©
 = 108,

89 
	gvhªgup
 = 111,

90 
	gwa™4
 = 114,

91 
	gsw­off
 = 115,

92 
	gsysšfo
 = 116,

93 
	gfsync
 = 118,

94 
	gsig»tuº
 = 119,

95 
	gşÚe
 = 120,

96 
	g£tdomašÇme
 = 121,

97 
	guÇme
 = 122,

98 
	gadjtimex
 = 124,

99 
	gm´Ùeù
 = 125,

100 
	gsig´ocmask
 = 126,

101 
	gš™_moduË
 = 128,

102 
	gd–‘e_moduË
 = 129,

103 
	gquÙaùl
 = 131,

104 
	gg‘pgid
 = 132,

105 
	gfchdœ
 = 133,

106 
	gbdæush
 = 134,

107 
	gsysfs
 = 135,

108 
	g³rsÚ®™y
 = 136,

109 
	g£tfsuid
 = 138,

110 
	g£tfsgid
 = 139,

111 
	g_Î£ek
 = 140,

112 
	gg‘d’ts
 = 141,

113 
	g_Ãw£Ëù
 = 142,

114 
	gæock
 = 143,

115 
	gmsync
 = 144,

116 
	g»adv
 = 145,

117 
	gwr™ev
 = 146,

118 
	gg‘sid
 = 147,

119 
	gfd©async
 = 148,

120 
	g_sysùl
 = 149,

121 
	gmlock
 = 150,

122 
	gmuÆock
 = 151,

123 
	gmlock®l
 = 152,

124 
	gmuÆock®l
 = 153,

125 
	gsched_£¬am
 = 154,

126 
	gsched_g‘·¿m
 = 155,

127 
	gsched_£tscheduËr
 = 156,

128 
	gsched_g‘scheduËr
 = 157,

129 
	gsched_y›ld
 = 158,

130 
	gsched_g‘_´iÜ™y_max
 = 159,

131 
	gsched_g‘_´iÜ™y_mš
 = 160,

132 
	gsched_¼_g‘_š‹rv®
 = 161,

133 
	gÇno¦“p
 = 162,

134 
	gm»m­
 = 163,

135 
	g£Œesuid
 = 164,

136 
	gg‘»suid
 = 165,

137 
	gpŞl
 = 168,

138 
	gnfs£rvùl
 = 169,

139 
	g£Œesgid
 = 170,

140 
	gg‘»sgid
 = 171,

141 
	g´ùl
 = 172,

142 
	g¹_sig»tuº
 = 173,

143 
	g¹_sigaùiÚ
 = 174,

144 
	g¹_sig´ocmask
 = 175,

145 
	g¹_sig³ndšg
 = 176,

146 
	g¹_sigtimedwa™
 = 177,

147 
	g¹_sigqueuešfo
 = 178,

148 
	g¹_sigsu¥’d
 = 179,

149 
	g´—d64
 = 180,

150 
	gpwr™e64
 = 181,

151 
	gchown
 = 182,

152 
	gg‘cwd
 = 183,

153 
	gÿpg‘
 = 184,

154 
	gÿp£t
 = 185,

155 
	gsig®t¡ack
 = 186,

156 
	g£ndfe
 = 187,

157 
	gvfÜk
 = 190,

158 
	gug‘¾im™
 = 191,

159 
	gmm­2
 = 192,

160 
	gŒunÿ‹64
 = 193,

161 
	gárunÿ‹64
 = 194,

162 
	g¡©64
 = 195,

163 
	gl¡©64
 = 196,

164 
	gf¡©64
 = 197,

165 
	glchown32
 = 198,

166 
	gg‘uid32
 = 199,

167 
	gg‘gid32
 = 200,

168 
	gg‘euid32
 = 201,

169 
	gg‘egid32
 = 202,

170 
	g£Œeuid32
 = 203,

171 
	g£Œegid32
 = 204,

172 
	gg‘groups32
 = 205,

173 
	g£tgroups32
 = 206,

174 
	gfchown32
 = 207,

175 
	g£Œesuid32
 = 208,

176 
	gg‘»suid32
 = 209,

177 
	g£Œesgid32
 = 210,

178 
	gg‘»sgid32
 = 211,

179 
	gchown32
 = 212,

180 
	g£tuid32
 = 213,

181 
	g£tgid32
 = 214,

182 
	g£tfsuid32
 = 215,

183 
	g£tfsgid32
 = 216,

184 
	gg‘d’ts64
 = 217,

185 
	gpivÙ_roÙ
 = 218,

186 
	gmšcÜe
 = 219,

187 
	gmadvi£
 = 220,

188 
	gfú64
 = 221,

189 
	gg‘tid
 = 224,

190 
	g»adah—d
 = 225,

191 
	g£tx©Œ
 = 226,

192 
	gl£tx©Œ
 = 227,

193 
	gf£tx©Œ
 = 228,

194 
	gg‘x©Œ
 = 229,

195 
	glg‘x©Œ
 = 230,

196 
	gfg‘x©Œ
 = 231,

197 
	gli¡x©Œ
 = 232,

198 
	gÎi¡x©Œ
 = 233,

199 
	gæi¡x©Œ
 = 234,

200 
	g»movex©Œ
 = 235,

201 
	gÌemovex©Œ
 = 236,

202 
	gäemovex©Œ
 = 237,

203 
	gtkl
 = 238,

204 
	g£ndfe64
 = 239,

205 
	gfu‹x
 = 240,

206 
	gsched_£ffš™y
= 241,

207 
	gsched_g‘affš™y
= 242,

208 
	gio_£tup
 = 243,

209 
	gio_de¡roy
 = 244,

210 
	gio_g‘ev’ts
 = 245,

211 
	gio_subm™
 = 246,

212 
	gio_ÿnûl
 = 247,

213 
	gex™_group
 = 248,

214 
	glookup_dcook›
 = 249,

215 
	g•Şl_ü—‹
 = 250,

216 
	g•Şl_ùl
 = 251,

217 
	g•Şl_wa™
 = 252,

218 
	g»m­_fe_·ges
 = 253,

219 
	g£t_tid_add»ss
 = 256,

220 
	gtim”_ü—‹
 = 257,

221 
	gtim”_£‰ime
 = 258,

222 
	gtim”_g‘time
 = 259,

223 
	gtim”_g‘ov”run
 = 260,

224 
	gtim”_d–‘e
 = 261,

225 
	gşock_£‰ime
 = 262,

226 
	gşock_g‘time
 = 263,

227 
	gşock_g‘»s
 = 264,

228 
	gşock_Çno¦“p
 = 265,

229 
	g¡©fs64
 = 266,

230 
	gf¡©fs64
 = 267,

231 
	gtgkl
 = 268,

232 
	gutimes
 = 269,

233 
	gçdvi£64_64
 = 270,

234 
	gpcicÚfig_ioba£
 = 271,

235 
	gpcicÚfig_»ad
 = 272,

236 
	gpcicÚfig_wr™e
 = 273,

237 
	gmq_İ’
 = 274,

238 
	gmq_uÆšk
 = 275,

239 
	gmq_timed£nd
 = 276,

240 
	gmq_timed»ûive
 = 277,

241 
	gmq_nÙify
 = 278,

242 
	gmq_g‘£‰r
 = 279,

243 
	gwa™id
 = 280,

244 
	gsock‘
 = 281,

245 
	gbšd
 = 282,

246 
	gcÚÃù
 = 283,

247 
	gli¡’
 = 284,

248 
	gacû±
 = 285,

249 
	gg‘sockÇme
 = 286,

250 
	gg‘³”Çme
 = 287,

251 
	gsock‘·œ
 = 288,

252 
	g£nd
 = 289,

253 
	g£ndto
 = 290,

254 
	g»cv
 = 291,

255 
	g»cväom
 = 292,

256 
	gshutdown
 = 293,

257 
	g£tsockİt
 = 294,

258 
	gg‘sockİt
 = 295,

259 
	g£ndmsg
 = 296,

260 
	g»cvmsg
 = 297,

261 
	g£mİ
 = 298,

262 
	g£mg‘
 = 299,

263 
	g£mùl
 = 300,

264 
	gmsg¢d
 = 301,

265 
	gmsgrcv
 = 302,

266 
	gmsgg‘
 = 303,

267 
	gmsgùl
 = 304,

268 
	gshm©
 = 305,

269 
	gshmdt
 = 306,

270 
	gshmg‘
 = 307,

271 
	gshmùl
 = 308,

272 
	gadd_key
 = 309,

273 
	g»que¡_key
 = 310,

274 
	gkeyùl
 = 311,

275 
	g£mtimedİ
 = 312,

276 
	gv£rv”
 = 313,

277 
	giİrio_£t
 = 314,

278 
	giİrio_g‘
 = 315,

279 
	gšÙify_š™
 = 316,

280 
	gšÙify_add_w©ch
= 317,

281 
	gšÙify_rm_w©ch
 = 318,

282 
	gmbšd
 = 319,

283 
	gg‘_mempŞicy
 = 320,

284 
	g£t_mempŞicy
 = 321,

285 
	gİ’©
 = 322,

286 
	gmkdœ©
 = 323,

287 
	gmknod©
 = 324,

288 
	gfchowÇt
 = 325,

289 
	gfutime§t
 = 326,

290 
	gf¡©©64
 = 327,

291 
	guÆšk©
 = 328,

292 
	g»Çm—t
 = 329,

293 
	glšk©
 = 330,

294 
	gsymlšk©
 = 331,

295 
	g»adlšk©
 = 332,

296 
	gfchmod©
 = 333,

297 
	gçcûs§t
 = 334,

298 
	gp£Ëù6
 = 335,

299 
	gµŞl
 = 336,

300 
	gunsh¬e
 = 337,

301 
	g£t_robu¡_li¡
 = 338,

302 
	gg‘_robu¡_li¡
 = 339,

303 
	g¥liû
 = 340,

304 
	gsync_fe_¿nge2
 = 341,

305 
	g‹e
 = 342,

306 
	gvm¥liû
 = 343,

307 
	gmove_·ges
 = 344,

308 
	gg‘ıu
 = 345,

309 
	g•Şl_pwa™
 = 346,

310 
	gkexec_lßd
 = 347,

311 
	gutim’§t
 = 348,

312 
	gsigÇlfd
 = 349,

313 
	gtim”fd_ü—‹
 = 350,

314 
	gev’tfd
 = 351,

315 
	gçÎoÿ‹
 = 352,

316 
	gtim”fd_£‰ime
 = 353,

317 
	gtim”fd_g‘time
 = 354,

318 
	gsigÇlfd4
 = 355,

319 
	gev’tfd2
 = 356,

320 
	g•Şl_ü—‹1
 = 357,

321 
	gdup3
 = 358,

322 
	gpe2
 = 359,

323 
	gšÙify_š™1
 = 360,

324 
	g´—dv
 = 361,

325 
	gpwr™ev
 = 362,

326 
	g¹_tgsigqueuešfo
= 363,

327 
	g³rf_ev’t_İ’
 = 364,

328 
	g»cvmmsg
 = 365,

329 
	gacû±4
 = 366,

330 
	gçnÙify_š™
 = 367,

331 
	gçnÙify_m¬k
 = 368,

332 
	g´lim™64
 = 369,

333 
	gÇme_to_hªdË_©
= 370,

334 
	gİ’_by_hªdË_©
= 371,

335 
	gşock_adjtime
 = 372,

336 
	gsyncfs
 = 373,

337 
	g£ndmmsg
 = 374,

338 
	g£Šs
 = 375,

339 
	g´oûss_vm_»adv
 = 376,

340 
	g´oûss_vm_wr™ev
= 377,

341 
	gkcmp
 = 378,

342 
	gfš™_moduË
 = 379,

343 
	gsched_£‰r
 = 380,

344 
	gsched_g‘©Œ
 = 381,

345 
	g»Çm—t2
 = 382,

346 
	g£ccomp
 = 383,

347 
	gg‘¿ndom
 = 384,

348 
	gmemfd_ü—‹
 = 385,

349 
	gbpf
 = 386,

353  
	gÄ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/constants.lua

1 -- 
¬m64
 
¥ecific
 
cÚ¡ªts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
où®
 = 
	$funùiÚ
 (
s
è 
	$tÚumb”
(
s
, 8è
’d


14 
loÿl
 
¬ch
 = {
	}
}

16 
¬ch
.
O
 = {

17 
RDONLY
 = 
où®
('0000'),

18 
	gWRONLY
 = 
où®
('0001'),

19 
	gRDWR
 = 
où®
('0002'),

20 
	gACCMODE
 = 
où®
('0003'),

21 
	gCREAT
 = 
où®
('0100'),

22 
	gEXCL
 = 
où®
('0200'),

23 
	gNOCTTY
 = 
où®
('0400'),

24 
	gTRUNC
 = 
où®
('01000'),

25 
	gAPPEND
 = 
où®
('02000'),

26 
	gNONBLOCK
 = 
où®
('04000'),

27 
	gDSYNC
 = 
où®
('010000'),

28 
	gASYNC
 = 
où®
('020000'),

29 
	gDIRECTORY
 = 
où®
('040000'),

30 
	gNOFOLLOW
 = 
où®
('0100000'),

31 
	gDIRECT
 = 
où®
('0200000'),

32 
	gLARGEFILE
 = 
où®
('0400000'),

33 
	gNOATIME
 = 
où®
('01000000'),

34 
	gCLOEXEC
 = 
où®
('02000000'),

35 
	gSYNC
 = 
où®
('04010000'),

38  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/ffi.lua

1 -- 
¬m64
 
¥ecific
 
defš™iÚs


4 
	gucÚ‹xt
 = [[

5 
g»g_t
;

6 
g»g£t_t
[34];

8 
	gv»gs
[32];

9 
	gå¤
;

10 
	gåü
;

11 } 
	tå»g£t_t
;

12 
	ssigcÚ‹xt


14 
	gçuÉ_add»ss
;

15 
	g»gs
[31];

16 
	g¥
, 
	gpc
, 
	gp¡©e
;

17 
	g__»£rved
[256];

18 } 
	tmcÚ‹xt_t
;

19 
	s__ucÚ‹xt
 {

20 
	guc_æags
;

21 
ucÚ‹xt
 *
	guc_lšk
;

22 
¡ack_t
 
	guc_¡ack
;

23 
sig£t_t
 
	guc_sigmask
;

24 
mcÚ‹xt_t
 
	guc_mcÚ‹xt
;

25 } 
	tucÚ‹xt_t
;

27 
	g¡©
 = [[

28 
	s¡©
 {

29 
¡_dev
;

30 
¡_šo
;

31 
¡_mode
;

32 
¡_Æšk
;

33 
¡_uid
;

34 
¡_gid
;

35 
¡_rdev
;

36 
__·d1
;

37 
¡_size
;

38 
¡_blksize
;

39 
__·d2
;

40 
¡_blocks
;

41 
¡_©ime
;

42 
¡_©ime_n£c
;

43 
¡_mtime
;

44 
¡_mtime_n£c
;

45 
¡_ùime
;

46 
¡_ùime_n£c
;

47 
__unu£d4
;

48 
__unu£d5
;

51 
	g¡©fs
 = [[

52 
	s¡©fs64
 {

53 
f_ty³
, 
f_bsize
;

54 
fsblkút_t
 
f_blocks
, 
f_bä“
, 
f_bava
;

55 
fsfút_t
 
f_fes
, 
f_fä“
;

56 
fsid_t
 
f_fsid
;

57 
f_Çm–’
, 
f_äsize
, 
f_æags
, 
f_¥¬e
[4];

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/ioctl.lua

1 -- 
¬m64
 
ioùl
 
difã»nûs


3 
loÿl
 
	g¬ch
 = {

4 
ioùl
 = {

8  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/nr.lua

1 -- 
¬m64
 
sysÿÎ
 
numb”s
 
¬e
 
the
 
Ãw
 
¬ch™eùu»
 
	gdeçuÉs


2 -- 
so
 
we
 
could
 
»u£
 
this
 
fe
 
Ùh”
 
	g¬ch™eùu»s


3 -- 
nÙe
 
th©
 
th”e
 
¬e
 
some
 
Çme
 
difã»nûs
 
	gÃw
 32 
b™
 
¬ch™eùu»s


5 
loÿl
 
	gÄ
 = {

6 
SYS
 = {

7 
io_£tup
 = 0,

8 
	gio_de¡roy
 = 1,

9 
	gio_subm™
 = 2,

10 
	gio_ÿnûl
 = 3,

11 
	gio_g‘ev’ts
 = 4,

12 
	g£tx©Œ
 = 5,

13 
	gl£tx©Œ
 = 6,

14 
	gf£tx©Œ
 = 7,

15 
	gg‘x©Œ
 = 8,

16 
	glg‘x©Œ
 = 9,

17 
	gfg‘x©Œ
 = 10,

18 
	gli¡x©Œ
 = 11,

19 
	gÎi¡x©Œ
 = 12,

20 
	gæi¡x©Œ
 = 13,

21 
	g»movex©Œ
 = 14,

22 
	gÌemovex©Œ
 = 15,

23 
	gäemovex©Œ
 = 16,

24 
	gg‘cwd
 = 17,

25 
	glookup_dcook›
 = 18,

26 
	gev’tfd2
 = 19,

27 
	g•Şl_ü—‹1
 = 20,

28 
	g•Şl_ùl
 = 21,

29 
	g•Şl_pwa™
 = 22,

30 
	gdup
 = 23,

31 
	gdup3
 = 24,

32 
	gfú
 = 25,

33 
	gšÙify_š™1
 = 26,

34 
	gšÙify_add_w©ch
 = 27,

35 
	gšÙify_rm_w©ch
 = 28,

36 
	gioùl
 = 29,

37 
	giİrio_£t
 = 30,

38 
	giİrio_g‘
 = 31,

39 
	gæock
 = 32,

40 
	gmknod©
 = 33,

41 
	gmkdœ©
 = 34,

42 
	guÆšk©
 = 35,

43 
	gsymlšk©
 = 36,

44 
	glšk©
 = 37,

45 
	g»Çm—t
 = 38,

46 
	gumouÁ2
 = 39,

47 
	gmouÁ
 = 40,

48 
	gpivÙ_roÙ
 = 41,

49 
	gnfs£rvùl
 = 42,

50 
	g¡©fs
 = 43,

51 
	gf¡©fs
 = 44,

52 
	gŒunÿ‹
 = 45,

53 
	gárunÿ‹
 = 46,

54 
	gçÎoÿ‹
 = 47,

55 
	gçcûs§t
 = 48,

56 
	gchdœ
 = 49,

57 
	gfchdœ
 = 50,

58 
	gchroÙ
 = 51,

59 
	gfchmod
 = 52,

60 
	gfchmod©
 = 53,

61 
	gfchowÇt
 = 54,

62 
	gfchown
 = 55,

63 
	gİ’©
 = 56,

64 
	gşo£
 = 57,

65 
	gvhªgup
 = 58,

66 
	gpe2
 = 59,

67 
	gquÙaùl
 = 60,

68 
	gg‘d’ts64
 = 61,

69 
	gl£ek
 = 62,

70 
	g»ad
 = 63,

71 
	gwr™e
 = 64,

72 
	g»adv
 = 65,

73 
	gwr™ev
 = 66,

74 
	g´—d64
 = 67,

75 
	gpwr™e64
 = 68,

76 
	g´—dv
 = 69,

77 
	gpwr™ev
 = 70,

78 
	g£ndfe
 = 71,

79 
	gp£Ëù6
 = 72,

80 
	gµŞl
 = 73,

81 
	gsigÇlfd4
 = 74,

82 
	gvm¥liû
 = 75,

83 
	g¥liû
 = 76,

84 
	g‹e
 = 77,

85 
	g»adlšk©
 = 78,

86 
	gf¡©©
 = 79,

87 
	gf¡©
 = 80,

88 
	gsync
 = 81,

89 
	gfsync
 = 82,

90 
	gfd©async
 = 83,

91 
	gsync_fe_¿nge
 = 84,

92 
	gtim”fd_ü—‹
 = 85,

93 
	gtim”fd_£‰ime
 = 86,

94 
	gtim”fd_g‘time
 = 87,

95 
	gutim’§t
 = 88,

96 
	gacù
 = 89,

97 
	gÿpg‘
 = 90,

98 
	gÿp£t
 = 91,

99 
	g³rsÚ®™y
 = 92,

100 
	gex™
 = 93,

101 
	gex™_group
 = 94,

102 
	gwa™id
 = 95,

103 
	g£t_tid_add»ss
 = 96,

104 
	gunsh¬e
 = 97,

105 
	gfu‹x
 = 98,

106 
	g£t_robu¡_li¡
 = 99,

107 
	gg‘_robu¡_li¡
 = 100,

108 
	gÇno¦“p
 = 101,

109 
	gg‘™im”
 = 102,

110 
	g£t™im”
 = 103,

111 
	gkexec_lßd
 = 104,

112 
	gš™_moduË
 = 105,

113 
	gd–‘e_moduË
 = 106,

114 
	gtim”_ü—‹
 = 107,

115 
	gtim”_g‘time
 = 108,

116 
	gtim”_g‘ov”run
 = 109,

117 
	gtim”_£‰ime
 = 110,

118 
	gtim”_d–‘e
 = 111,

119 
	gşock_£‰ime
 = 112,

120 
	gşock_g‘time
 = 113,

121 
	gşock_g‘»s
 = 114,

122 
	gşock_Çno¦“p
 = 115,

123 
	gsy¦og
 = 116,

124 
	g±¿û
 = 117,

125 
	gsched_£¬am
 = 118,

126 
	gsched_£tscheduËr
 = 119,

127 
	gsched_g‘scheduËr
 = 120,

128 
	gsched_g‘·¿m
 = 121,

129 
	gsched_£ffš™y
 = 122,

130 
	gsched_g‘affš™y
 = 123,

131 
	gsched_y›ld
 = 124,

132 
	gsched_g‘_´iÜ™y_max
 = 125,

133 
	gsched_g‘_´iÜ™y_mš
 = 126,

134 
	gsched_¼_g‘_š‹rv®
 = 127,

135 
	g»¡¬t_sysÿÎ
 = 128,

136 
	gkl
 = 129,

137 
	gtkl
 = 130,

138 
	gtgkl
 = 131,

139 
	gsig®t¡ack
 = 132,

140 
	g¹_sigsu¥’d
 = 133,

141 
	g¹_sigaùiÚ
 = 134,

142 
	g¹_sig´ocmask
 = 135,

143 
	g¹_sig³ndšg
 = 136,

144 
	g¹_sigtimedwa™
 = 137,

145 
	g¹_sigqueuešfo
 = 138,

146 
	g¹_sig»tuº
 = 139,

147 
	g£riÜ™y
 = 140,

148 
	gg‘´iÜ™y
 = 141,

149 
	g»boÙ
 = 142,

150 
	g£Œegid
 = 143,

151 
	g£tgid
 = 144,

152 
	g£Œeuid
 = 145,

153 
	g£tuid
 = 146,

154 
	g£Œesuid
 = 147,

155 
	gg‘»suid
 = 148,

156 
	g£Œesgid
 = 149,

157 
	gg‘»sgid
 = 150,

158 
	g£tfsuid
 = 151,

159 
	g£tfsgid
 = 152,

160 
	gtimes
 = 153,

161 
	g£gid
 = 154,

162 
	gg‘pgid
 = 155,

163 
	gg‘sid
 = 156,

164 
	g£tsid
 = 157,

165 
	gg‘groups
 = 158,

166 
	g£tgroups
 = 159,

167 
	guÇme
 = 160,

168 
	g£tho¡Çme
 = 161,

169 
	g£tdomašÇme
 = 162,

170 
	gg‘¾im™
 = 163,

171 
	g£Œlim™
 = 164,

172 
	gg‘ru§ge
 = 165,

173 
	gumask
 = 166,

174 
	g´ùl
 = 167,

175 
	gg‘ıu
 = 168,

176 
	gg‘timeofday
 = 169,

177 
	g£‰imeofday
 = 170,

178 
	gadjtimex
 = 171,

179 
	gg‘pid
 = 172,

180 
	gg‘µid
 = 173,

181 
	gg‘uid
 = 174,

182 
	gg‘euid
 = 175,

183 
	gg‘gid
 = 176,

184 
	gg‘egid
 = 177,

185 
	gg‘tid
 = 178,

186 
	gsysšfo
 = 179,

187 
	gmq_İ’
 = 180,

188 
	gmq_uÆšk
 = 181,

189 
	gmq_timed£nd
 = 182,

190 
	gmq_timed»ûive
 = 183,

191 
	gmq_nÙify
 = 184,

192 
	gmq_g‘£‰r
 = 185,

193 
	gmsgg‘
 = 186,

194 
	gmsgùl
 = 187,

195 
	gmsgrcv
 = 188,

196 
	gmsg¢d
 = 189,

197 
	g£mg‘
 = 190,

198 
	g£mùl
 = 191,

199 
	g£mtimedİ
 = 192,

200 
	g£mİ
 = 193,

201 
	gshmg‘
 = 194,

202 
	gshmùl
 = 195,

203 
	gshm©
 = 196,

204 
	gshmdt
 = 197,

205 
	gsock‘
 = 198,

206 
	gsock‘·œ
 = 199,

207 
	gbšd
 = 200,

208 
	gli¡’
 = 201,

209 
	gacû±
 = 202,

210 
	gcÚÃù
 = 203,

211 
	gg‘sockÇme
 = 204,

212 
	gg‘³”Çme
 = 205,

213 
	g£ndto
 = 206,

214 
	g»cväom
 = 207,

215 
	g£tsockİt
 = 208,

216 
	gg‘sockİt
 = 209,

217 
	gshutdown
 = 210,

218 
	g£ndmsg
 = 211,

219 
	g»cvmsg
 = 212,

220 
	g»adah—d
 = 213,

221 
	gbrk
 = 214,

222 
	gmunm­
 = 215,

223 
	gm»m­
 = 216,

224 
	gadd_key
 = 217,

225 
	g»que¡_key
 = 218,

226 
	gkeyùl
 = 219,

227 
	gşÚe
 = 220,

228 
	gexecve
 = 221,

229 
	gmm­
 = 222,

230 
	gçdvi£64
 = 223,

231 
	gsw­Ú
 = 224,

232 
	gsw­off
 = 225,

233 
	gm´Ùeù
 = 226,

234 
	gmsync
 = 227,

235 
	gmlock
 = 228,

236 
	gmuÆock
 = 229,

237 
	gmlock®l
 = 230,

238 
	gmuÆock®l
 = 231,

239 
	gmšcÜe
 = 232,

240 
	gmadvi£
 = 233,

241 
	g»m­_fe_·ges
 = 234,

242 
	gmbšd
 = 235,

243 
	gg‘_mempŞicy
 = 236,

244 
	g£t_mempŞicy
 = 237,

245 
	gmig¿‹_·ges
 = 238,

246 
	gmove_·ges
 = 239,

247 
	g¹_tgsigqueuešfo
 = 240,

248 
	g³rf_ev’t_İ’
 = 241,

249 
	gacû±4
 = 242,

250 
	g»cvmmsg
 = 243,

251 
	gwa™4
 = 260,

252 
	g´lim™64
 = 261,

253 
	gçnÙify_š™
 = 262,

254 
	gçnÙify_m¬k
 = 263,

255 
	gÇme_to_hªdË_©
 = 264,

256 
	gİ’_by_hªdË_©
 = 265,

257 
	gşock_adjtime
 = 266,

258 
	gsyncfs
 = 267,

259 
	g£Šs
 = 268,

260 
	g£ndmmsg
 = 269,

261 
	g´oûss_vm_»adv
 = 270,

262 
	g´oûss_vm_wr™ev
 = 271,

263 
	gkcmp
 = 272,

264 
	gfš™_moduË
 = 273,

265 
	gsched_£‰r
 = 274,

266 
	gsched_g‘©Œ
 = 275,

267 
	g»Çm—t2
 = 276,

268 
	g£ccomp
 = 277,

269 
	gg‘¿ndom
 = 278,

270 
	gmemfd_ü—‹
 = 279,

271 
	gbpf
 = 280,

272 
	gexecv—t
 = 281,

276  
	gÄ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/c.lua

1 -- 
This
 
£ts
 
up
 
the
 
bË
 
of
 
C
 
	gfunùiÚs


3 -- 
this
 
should
 
be
 
g’”©ed
 
	gid—Îy
, 
as
 
™
 
is
 
the
 
ABI
 
	g¥ec


6 
NÙe
 
a
 
çœ
 
numb”
 
¬e
 
bešg
 
d•»ÿ‹d
, 
£e
 
šşude
/
u­i
/
asm
-
g’”ic
/
uni¡d
.
h
 
und”
 
__ARCH_WANT_SYSCALL_NO_AT
, 
__ARCH_WANT_SYSCALL_NO_FLAGS
, 
ªd
 
__ARCH_WANT_SYSCALL_DEPRECATED


7 
Some
 
of
 
the£
 
we
 
®»ady
 
dÚ
't use, but some we do,ƒg use open‚ot openatƒtc.

10 
loÿl
 
	g»quœe
, 
	gtÚumb”
, 
	gpÿÎ
, 
	g£Ëù
 =

11 
»quœe
, 
	gtÚumb”
, 
	gpÿÎ
, 
£Ëù


13 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

15 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

19 
»quœe
 "syscall.linux.ffi"

21 
loÿl
 
voidp
 = 
ffi
.
ty³of
("void *")

23 
loÿl
 
funùiÚ
 (
x
)

24  
ffi
.
	$ÿ¡
(
voidp
, 
x
)

25 
’d


27 -- 
basiÿÎy
 
®l
 
ty³s
 
·s£d
 
to
 
sysÿÎs
 
¬e
 
Ü
 , 
so
 
we
 dØ
nÙ
 
Ãed
Ø
u£
 
niûly
 
Çmed
y³s, sØw
ÿn
 
avoid
 
impÜtšg
 
t
.

28 
loÿl
 , ğ
ffi
.
	`ty³of
("int"), ffi.typeof("long")

29 
loÿl
 
ušt
, 
ulÚg
 = 
ffi
.
	`ty³of
("unsigned int"), ffi.typeof("unsigned†ong")

31 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

32 
loÿl
 
”r64
 = 
h
.err64

34 
loÿl
 
i6432
, 
u6432
 = 
b™
.i6432, bit.u6432

36 
loÿl
 
¬g64
, 
¬g64u


37 
abi
.
Ë
 
th’


38 
¬g64
 = 
	$funùiÚ
(
v®
)

39 
loÿl
 
v2
, 
v1
 = 
	$i6432
(
v®
)

40  
v1
, 
v2


41 
’d


42 
¬g64u
 = 
	$funùiÚ
(
v®
)

43 
loÿl
 
v2
, 
v1
 = 
	$u6432
(
v®
)

44  
v1
, 
v2


45 
’d


47 
¬g64
 = 
	$funùiÚ
(
v®
è 
	$i6432
(
v®
è
’d


48 
¬g64u
 = 
	$funùiÚ
(
v®
è 
	$u6432
(
v®
è
’d


49 
’d


50 -- 
_Î£ek
 
v”y
 
odd
, 
´—dv


51 
loÿl
 
funùiÚ
 
	$Î¬g64
(
v®
è 
	$i6432
(
v®
è
’d


53 
loÿl
 
C
 = {
	}
}

55 
loÿl
 
Ä
 = 
»quœe
("syscall.linux.nr")

57 
loÿl
 
z”İad
 = 
Ä
.zeropad

58 
loÿl
 
sys
 = 
Ä
.
SYS


59 
loÿl
 
sock‘ÿÎs
 = 
Ä
.socketcalls

61 
loÿl
 
u64
 = 
ffi
.
ty³of
("uint64_t")

63 -- 
TODO
 
could
 
make
 
the£
  
”ºo
 
h”e
, 
®so
 
¬e
he£ 
be¡
 
	gÿ¡s
?

64 
loÿl
 
	gsysÿÎ_lÚg
 = 
ffi
.
C
.
sysÿÎ
 -- 
»tuºs
 

65 
loÿl
 
funùiÚ
 
	$sysÿÎ
(...è 
	`tÚumb”
(
	$sysÿÎ_lÚg
(...)è
’d
 -- 
is
  
as
 
mo¡
 
commÚ


66 
loÿl
 
funùiÚ
 
	$sysÿÎ_void
(...è (
	$sysÿÎ_lÚg
(...)è
’d


67 
loÿl
 
funùiÚ
 
	$sysÿÎ_off
(...è 
	`u64
(
	$sysÿÎ_lÚg
(...)è
’d
 -- 
off_t


69 
loÿl
 
lÚg¡y³
 = 
ffi
.
	`ty³of
("long[?]")

71 
loÿl
 
funùiÚ
 
	$lÚgs
(...)

72 
loÿl
 
n
 = 
	`£Ëù
('#', ...)

73 
loÿl
 
Î
 = 
ffi
.
	$Ãw
(
lÚg¡y³
, 
n
)

74 
i
 = 1, 
n
 do

75 
Î
[
i
 - 1] = 
ffi
.
	`ÿ¡
(, 
	$£Ëù
(
i
, ...))

76 
’d


77  
Î


78 
’d


80 -- 
now
 
the
 
sy¡em
 
ÿÎs


82 -- 
u£
 64 
b™
 
feİs
 
Ú
 32 b™ 
®ways
. 
As
 
may
 
be
 
missšg
 
wl
 u£ 
sysÿÎs
 
dœeùly


83 
abi
.
abi32
 
th’


84 
z”İad
 
th’


85 
funùiÚ
 
C
.
	$Œunÿ‹
(
·th
, 
Ëngth
)

86 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64u
(
Ëngth
)

87  
	`sysÿÎ
(
sys
.
Œunÿ‹64
, 
·th
, (0), (
Ën1
), (
Ën2
))

88 
’d


89 
funùiÚ
 
C
.
	$árunÿ‹
(
fd
, 
Ëngth
)

90 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64u
(
Ëngth
)

91  
	`sysÿÎ
(
sys
.
árunÿ‹64
, (
fd
), (0), (
Ën1
), (
Ën2
))

92 
’d


93 
funùiÚ
 
C
.
	$»adah—d
(
fd
, 
off£t
, 
couÁ
)

94 
loÿl
 
off1
, 
off2
 = 
	$¬g64u
(
off£t
)

95  
	`sysÿÎ
(
sys
.
»adah—d
, (
fd
), (0), (
off1
), (
off2
), 
	$ulÚg
(
couÁ
))

96 
’d


97 
funùiÚ
 
C
.
	$´—d
(
fd
, 
buf
, 
size
, 
off£t
)

98 
loÿl
 
off1
, 
off2
 = 
	$¬g64
(
off£t
)

99  
	`sysÿÎ_lÚg
(
sys
.
´—d64
, (
fd
), (
buf
), 
	`ulÚg
(
size
), (0), (
off1
), (
off2
))

100 
’d


101 
funùiÚ
 
C
.
	$pwr™e
(
fd
, 
buf
, 
size
, 
off£t
)

102 
loÿl
 
off1
, 
off2
 = 
	$¬g64
(
off£t
)

103  
	`sysÿÎ_lÚg
(
sys
.
pwr™e64
, (
fd
), (
buf
), 
	`ulÚg
(
size
), (0), (
off1
), (
off2
))

104 
’d


106 
funùiÚ
 
C
.
	$Œunÿ‹
(
·th
, 
Ëngth
)

107 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64u
(
Ëngth
)

108  
	`sysÿÎ
(
sys
.
Œunÿ‹64
, 
·th
, (
Ën1
), (
Ën2
))

109 
’d


110 
funùiÚ
 
C
.
	$árunÿ‹
(
fd
, 
Ëngth
)

111 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64u
(
Ëngth
)

112  
	`sysÿÎ
(
sys
.
árunÿ‹64
, (
fd
), (
Ën1
), (
Ën2
))

113 
’d


114 
funùiÚ
 
C
.
	$»adah—d
(
fd
, 
off£t
, 
couÁ
)

115 
loÿl
 
off1
, 
off2
 = 
	$¬g64u
(
off£t
)

116  
	`sysÿÎ
(
sys
.
»adah—d
, (
fd
), (
off1
), (
off2
), 
	$ulÚg
(
couÁ
))

117 
’d


118 
funùiÚ
 
C
.
	$´—d
(
fd
, 
buf
, 
size
, 
off£t
)

119 
loÿl
 
off1
, 
off2
 = 
	$¬g64
(
off£t
)

120  
	`sysÿÎ_lÚg
(
sys
.
´—d64
, (
fd
), (
buf
), 
	`ulÚg
(
size
), (
off1
), (
off2
))

121 
’d


122 
funùiÚ
 
C
.
	$pwr™e
(
fd
, 
buf
, 
size
, 
off£t
)

123 
loÿl
 
off1
, 
off2
 = 
	$¬g64
(
off£t
)

124  
	`sysÿÎ_lÚg
(
sys
.
pwr™e64
, (
fd
), (
buf
), 
	`ulÚg
(
size
), (
off1
), (
off2
))

125 
’d


126 
’d


127 -- 
nÙe
 
¡©fs
,
f¡©fs
 
·ss
 
size
 
of
 
Ú
 32 
b™
 
Úly


128 
funùiÚ
 
C
.
	$¡©fs
(
·th
, 
buf
è 
	`sysÿÎ
(
sys
.
¡©fs64
, Õ©h), 
	`ušt
(
ffi
.(buf)), (buf)è
’d


129 
funùiÚ
 
C
.
	$f¡©fs
(
fd
, 
buf
è 
	`sysÿÎ
(
sys
.
f¡©fs64
, (fd), 
	`ušt
(
ffi
.(buf)), (buf)è
’d


130 -- 
NÙe
 
v”y
 
odd
 
¥l™
 64 
b™
 
¬gum’ts
 
ev’
 
Ú
 64 b™ 
¶©fÜm
.

131 
funùiÚ
 
C
.
	$´—dv
(
fd
, 
iov
, 
iovút
, 
off£t
)

132 
loÿl
 
off1
, 
off2
 = 
	$Î¬g64
(
off£t
)

133  
	`sysÿÎ_lÚg
(
sys
.
´—dv
, (
fd
), (
iov
), (
iovút
), (
off2
), (
off1
))

134 
’d


135 
funùiÚ
 
C
.
	$pwr™ev
(
fd
, 
iov
, 
iovút
, 
off£t
)

136 
loÿl
 
off1
, 
off2
 = 
	$Î¬g64
(
off£t
)

137  
	`sysÿÎ_lÚg
(
sys
.
pwr™ev
, (
fd
), (
iov
), (
iovút
), (
off2
), (
off1
))

138 
’d


139 -- 
l£ek
 
is
 
a
 
mess
 
š
 32 
b™
, 
u£
 
_Î£ek
 
sysÿÎ
 
to
 
g‘
 
ş—n
 
»suÉ
.

140 -- 
TODO
 
move
 
this
 
to
 
sysÿÎ
.
lua


141 
loÿl
 
off1
 = 
ffi
.
	`ty³of
("uint64_t[1]")

142 
funùiÚ
 
C
.
	$l£ek
(
fd
, 
off£t
, 
wh’û
)

143 
loÿl
 
»suÉ
 = 
	$off1
()

144 
loÿl
 
off1
, 
off2
 = 
	$Î¬g64
(
off£t
)

145 
loÿl
 
»t
 = 
	`sysÿÎ
(
sys
.
_Î£ek
, (
fd
), (
off1
), (
off2
), (
»suÉ
), 
	$ušt
(
wh’û
))

146 
»t
 =ğ-1 
th’
  
”r64
 
’d


147  
»suÉ
[0]

148 
’d


149 
funùiÚ
 
C
.
	$£ndfe
(
outfd
, 
šfd
, 
off£t
, 
couÁ
)

150  
	`sysÿÎ_lÚg
(
sys
.
£ndfe64
, (
outfd
), (
šfd
), (
off£t
), 
	$ulÚg
(
couÁ
))

151 
’d


152 -- 
Ú
 32 
b™
 
sy¡ems
 
mm­
 
u£s
 
off_t
 
so
 
we
 
ÿÂÙ
 
‹Î
 
wh©
 
ABI
 
is
. 
U£
 
und”lyšg
 
mm­2
 
sysÿÎ


153 
funùiÚ
 
C
.
	$mm­
(
addr
, 
Ëngth
, 
´Ù
, 
æags
, 
fd
, 
off£t
)

154 
loÿl
 
pgoff£t
 = 
b™
.
	$rshiá
(
off£t
, 12)

155  
	`sysÿÎ_void
(
sys
.
mm­2
, (
addr
), 
	`ulÚg
(
Ëngth
), (
´Ù
), (
æags
), (
fd
), 
	$ušt
(
pgoff£t
))

156 
’d


157 -- 64 
b™


158 
funùiÚ
 
C
.
	$Œunÿ‹
(
·th
, 
Ëngth
è 
	`sysÿÎ
(
sys
.
Œunÿ‹
, Õ©h), 
	$ulÚg
(
Ëngth
)è
’d


159 
funùiÚ
 
C
.
	$árunÿ‹
(
fd
, 
Ëngth
è 
	`sysÿÎ
(
sys
.
árunÿ‹
, (fd), 
	$ulÚg
(
Ëngth
)è
’d


160 
funùiÚ
 
C
.
	$»adah—d
(
fd
, 
off£t
, 
couÁ
è 
	`sysÿÎ
(
sys
.
»adah—d
, (fd), 
	`ulÚg
(off£t), 
	$ulÚg
(
couÁ
)è
’d


161 
funùiÚ
 
C
.
	$´—d
(
fd
, 
buf
, 
couÁ
, 
off£t
è 
	`sysÿÎ_lÚg
(
sys
.
´—d64
, (fd), (buf), 
	`ulÚg
(couÁ), 
	$ulÚg
(
off£t
)è
’d


162 
funùiÚ
 
C
.
	$pwr™e
(
fd
, 
buf
, 
couÁ
, 
off£t
è 
	`sysÿÎ_lÚg
(
sys
.
pwr™e64
, (fd), (buf), 
	`ulÚg
(couÁ), 
	$ulÚg
(
off£t
)è
’d


163 
funùiÚ
 
C
.
	$¡©fs
(
·th
, 
buf
è 
	`sysÿÎ
(
sys
.
¡©fs
, Õ©h), (buf)è
’d


164 
funùiÚ
 
C
.
	$f¡©fs
(
fd
, 
buf
è 
	`sysÿÎ
(
sys
.
f¡©fs
, (fd), (buf)è
’d


165 
funùiÚ
 
C
.
	$´—dv
(
fd
, 
iov
, 
iovút
, 
off£t
è 
	`sysÿÎ_lÚg
(
sys
.
´—dv
, (fd), (iov), (iovút), 
	$ulÚg
(
off£t
)è
’d


166 
funùiÚ
 
C
.
	$pwr™ev
(
fd
, 
iov
, 
iovút
, 
off£t
è 
	`sysÿÎ_lÚg
(
sys
.
pwr™ev
, (fd), (iov), (iovút), 
	$ulÚg
(
off£t
)è
’d


167 
funùiÚ
 
C
.
	$l£ek
(
fd
, 
off£t
, 
wh’û
è 
	`sysÿÎ_off
(
sys
.
l£ek
, (fd), 
	`ulÚg
(off£t), (wh’û)è
’d


168 
funùiÚ
 
C
.
	$£ndfe
(
outfd
, 
šfd
, 
off£t
, 
couÁ
)

169  
	`sysÿÎ_lÚg
(
sys
.
£ndfe
, (
outfd
), (
šfd
), (
off£t
), 
	$ulÚg
(
couÁ
))

170 
’d


171 
funùiÚ
 
C
.
	$mm­
(
addr
, 
Ëngth
, 
´Ù
, 
æags
, 
fd
, 
off£t
)

172  
	`sysÿÎ_void
(
sys
.
mm­
, (
addr
), 
	`ulÚg
(
Ëngth
), (
´Ù
), (
æags
), (
fd
), 
	$ulÚg
(
off£t
))

173 
’d


174 
’d


176 -- 
glibc
 
ÿches
 
pid
, 
but
 
this
 
çs
 
to
 
wÜk
 
eg
 
aá”
 
	`şÚe
().

177 
funùiÚ
 
C
.
	$g‘pid
(è 
	$sysÿÎ
(
sys
.
g‘pid
è
’d


179 -- 
und”lyšg
 
sysÿÎs


180 
funùiÚ
 
C
.
	$ex™_group
(
¡©us
è 
	`sysÿÎ
(
sys
.
ex™_group
, (¡©us)è
’d
 --  
»®ly


181 
funùiÚ
 
C
.
	$ex™
(
¡©us
è 
	`sysÿÎ
(
sys
.
ex™
, (¡©us)è
’d
 --  
»®ly


183 
C
.
_ex™
 = C.
ex™_group
 -- 
¡ªd¬d
 
m‘hod


185 -- 
şÚe
 
š‹rçû
 
´ovided
 
is
 
nÙ
 
§me
 
as
 
sy¡em
 
Úe
, 
ªd
 i 
Ëss
 
cÚv’›Á


186 
funùiÚ
 
C
.
	$şÚe
(
æags
, 
sigÇl
, 
¡ack
, 
±id
, 
s
, 
ùid
)

187  
	`sysÿÎ
(
sys
.
şÚe
, (
æags
), (
¡ack
), (
±id
), (
s
), (
ùid
)è-- 
‹chniÿÎy
 

188 
’d


190 -- 
g‘d’ts
 
is
 
nÙ
 
´ovided
 
by
 
glibc
. 
Mu¦
 
has
 
w—k
 
®Ÿs
 
so
‚Ù 
visibË
.

191 
funùiÚ
 
C
.
	$g‘d’ts
(
fd
, 
buf
, 
size
)

192  
	`sysÿÎ
(
sys
.
g‘d’ts64
, (
fd
), 
buf
, 
	$ušt
(
size
))

193 
’d


195 -- 
glibc
 
has
 
»que¡
 
as
 
ª
 , 
k”Ãl
 
is
 , 
Ùh”
 
libcs
 
¬e
 , 
so
 
u£
 
sysÿÎ
 
dœeùly


196 
funùiÚ
 
C
.
	$ioùl
(
fd
, 
»que¡
, 
¬g
)

197  
	`sysÿÎ
(
sys
.
ioùl
, (
fd
), 
	`ušt
(
»que¡
), (
¬g
))

198 
’d


200 -- 
g‘cwd
 
š
 
libc
 
may
 
®loÿ‹
 
memÜy
 
ªd
 
has
 
šcÚsi¡’t
  
v®ue
, 
so
 
u£
 
sysÿÎ


201 
funùiÚ
 
C
.
	$g‘cwd
(
buf
, 
size
è 
	`sysÿÎ
(
sys
.
g‘cwd
, (buf), 
	$ulÚg
(
size
)è
’d


203 -- 
niû
 
š
 
libc
 
may
 
Ü
 may 
nÙ
  
Şd
 
v®ue
, 
sysÿÎ
 
Ãv”
 
dÛs
; 
howev”
‚iû sysÿÎ may‚Ù 
exi¡


204 
sys
.
niû
 
th’


205 
funùiÚ
 
C
.
	$niû
(
šc
è 
	`sysÿÎ
(
sys
.
niû
, (šc)è
’d


206 
’d


208 -- 
avoid
 
havšg
 
to
 
£t
 
”ºo
 
by
 
ÿÎšg
 
g‘´iÜ™y
 
dœeùly
 
ªd
 
adju¡šg
  
v®ues


209 
funùiÚ
 
C
.
	$g‘´iÜ™y
(
which
, 
who
è 
	`sysÿÎ
(
sys
.
g‘´iÜ™y
, (which), (who)è
’d


211 -- 
uClibc
 
Úly
 
´ovides
 
a
 
v”siÚ
 
of
 
ev’tfd
 
w™hout
 
æags
, 
ªd
 
we
 
ÿÂÙ
 
d‘eù
 
this


212 
funùiÚ
 
C
.
	$ev’tfd
(
š™v®
, 
æags
è 
	`sysÿÎ
(
sys
.
ev’tfd2
, 
	`ušt
(š™v®), (æags)è
’d


214 -- 
Mu¦
 
®ways
 
»tuºs
 
ENOSYS
 
the£


215 
funùiÚ
 
C
.
	$sched_g‘scheduËr
(
pid
è 
	`sysÿÎ
(
sys
.
sched_g‘scheduËr
, Õid)è
’d


216 
funùiÚ
 
C
.
	$sched_£tscheduËr
(
pid
, 
pŞicy
, 
·¿m
)

217  
	`sysÿÎ
(
sys
.
sched_£tscheduËr
, (
pid
), (
pŞicy
), (
·¿m
))

218 
’d


220 
loÿl
 
sys_çdvi£64
 = 
sys
.
çdvi£64_64
 
Ü
 sys.
çdvi£64


221 
abi
.
abi64
 
th’


222 
sys
.
¡©
 
th’


223 
funùiÚ
 
C
.
	$¡©
(
·th
, 
buf
)

224  
	`sysÿÎ
(
sys
.
¡©
, 
·th
, (
buf
))

225 
’d


226 
’d


227 
sys
.
l¡©
 
th’


228 
funùiÚ
 
C
.
	$l¡©
(
·th
, 
buf
)

229  
	`sysÿÎ
(
sys
.
l¡©
, 
·th
, (
buf
))

230 
’d


231 
’d


232 
funùiÚ
 
C
.
	$f¡©
(
fd
, 
buf
)

233  
	`sysÿÎ
(
sys
.
f¡©
, (
fd
), (
buf
))

234 
’d


235 
funùiÚ
 
C
.
	$f¡©©
(
fd
, 
·th
, 
buf
, 
æags
)

236  
	`sysÿÎ
(
sys
.
f¡©©
, (
fd
), 
·th
, (
buf
), (
æags
))

237 
’d


238 
funùiÚ
 
C
.
	$çdvi£64
(
fd
, 
off£t
, 
Ën
, 
advi£
)

239  
	`sysÿÎ
(
sys_çdvi£64
, (
fd
), 
	`ulÚg
(
off£t
), ulÚg(
Ën
), (
advi£
))

240 
’d


241 
funùiÚ
 
C
.
	$çÎoÿ‹
(
fd
, 
mode
, 
off£t
, 
Ën
)

242  
	`sysÿÎ
(
sys
.
çÎoÿ‹
, (
fd
), 
	`ušt
(
mode
), 
	`ulÚg
(
off£t
), 
	$ulÚg
(
Ën
))

243 
’d


245 
funùiÚ
 
C
.
	$¡©
(
·th
, 
buf
)

246  
	`sysÿÎ
(
sys
.
¡©64
, 
·th
, (
buf
))

247 
’d


248 
funùiÚ
 
C
.
	$l¡©
(
·th
, 
buf
)

249  
	`sysÿÎ
(
sys
.
l¡©64
, 
·th
, (
buf
))

250 
’d


251 
funùiÚ
 
C
.
	$f¡©
(
fd
, 
buf
)

252  
	`sysÿÎ
(
sys
.
f¡©64
, (
fd
), (
buf
))

253 
’d


254 
funùiÚ
 
C
.
	$f¡©©
(
fd
, 
·th
, 
buf
, 
æags
)

255  
	`sysÿÎ
(
sys
.
f¡©©64
, (
fd
), 
·th
, (
buf
), (
æags
))

256 
’d


257 
z”İad
 
th’


258 
funùiÚ
 
C
.
	$çdvi£64
(
fd
, 
off£t
, 
Ën
, 
advi£
)

259 
loÿl
 
off1
, 
off2
 = 
	$¬g64u
(
off£t
)

260 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64u
(
Ën
)

261  
	`sysÿÎ
(
sys_çdvi£64
, (
fd
), 0, 
	`ušt
(
off1
), ušt(
off2
), ušt(
Ën1
), ušt(
Ën2
), (
advi£
))

262 
’d


264 
funùiÚ
 
C
.
	$çdvi£64
(
fd
, 
off£t
, 
Ën
, 
advi£
)

265 
loÿl
 
off1
, 
off2
 = 
	$¬g64u
(
off£t
)

266 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64u
(
Ën
)

267  
	`sysÿÎ
(
sys_çdvi£64
, (
fd
), 
	`ušt
(
off1
), ušt(
off2
), ušt(
Ën1
), ušt(
Ën2
), (
advi£
))

268 
’d


269 
’d


270 
funùiÚ
 
C
.
	$çÎoÿ‹
(
fd
, 
mode
, 
off£t
, 
Ën
)

271 
loÿl
 
off1
, 
off2
 = 
	$¬g64u
(
off£t
)

272 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64u
(
Ën
)

273  
	`sysÿÎ
(
sys
.
çÎoÿ‹
, (
fd
), 
	`ušt
(
mode
), ušt(
off1
), ušt(
off2
), ušt(
Ën1
), 
	$ušt
(
Ën2
))

274 
’d


275 
’d


277 -- 
Çtive
 
Lšux
 
aio
 
nÙ
 
g’”®ly
 
suµÜ‹d
 
by
 
libc
, 
Úly
 
posix
 
API


278 
funùiÚ
 
C
.
	$io_£tup
(
Ä_ev’ts
, 
ùx
)

279  
	`sysÿÎ
(
sys
.
io_£tup
, 
	`ušt
(
Ä_ev’ts
), (
ùx
))

280 
’d


281 
funùiÚ
 
C
.
	$io_de¡roy
(
ùx
)

282  
	`sysÿÎ
(
sys
.
io_de¡roy
, 
	$ulÚg
(
ùx
))

283 
’d


284 
funùiÚ
 
C
.
	$io_ÿnûl
(
ùx
, 
iocb
, 
»suÉ
)

285  
	`sysÿÎ
(
sys
.
io_ÿnûl
, 
	`ulÚg
(
ùx
), (
iocb
), (
»suÉ
))

286 
’d


287 
funùiÚ
 
C
.
	$io_g‘ev’ts
(
ùx
, 
mš
, 
Ä
, 
ev’ts
, 
timeout
)

288  
	`sysÿÎ
(
sys
.
io_g‘ev’ts
, 
	`ulÚg
(
ùx
), (
mš
), (
Ä
), (
ev’ts
), (
timeout
))

289 
’d


290 
funùiÚ
 
C
.
	$io_subm™
(
ùx
, 
iocb
, 
Ä
)

291  
	`sysÿÎ
(
sys
.
io_subm™
, 
	`ulÚg
(
ùx
), (
Ä
), (
iocb
))

292 
’d


294 -- 
mq
 
funùiÚs
 
š
 -
¹
 
glibc
, 
¶us
 
sysÿÎs
 
difãr
 
¦ighy


295 
funùiÚ
 
C
.
	$mq_İ’
(
Çme
, 
æags
, 
mode
, 
©Œ
)

296  
	`sysÿÎ
(
sys
.
mq_İ’
, (
Çme
), (
æags
), 
	`ušt
(
mode
), (
©Œ
))

297 
’d


298 
funùiÚ
 
C
.
	$mq_uÆšk
(
Çme
è 
	`sysÿÎ
(
sys
.
mq_uÆšk
, Òame)è
’d


299 
funùiÚ
 
C
.
	$mq_g‘£‰r
(
mqd
, 
Ãw
, 
Şd
)

300  
	`sysÿÎ
(
sys
.
mq_g‘£‰r
, (
mqd
), (
Ãw
), (
Şd
))

301 
’d


302 
funùiÚ
 
C
.
	$mq_timed£nd
(
mqd
, 
msg_±r
, 
msg_Ën
, 
msg_´io
, 
abs_timeout
)

303  
	`sysÿÎ
(
sys
.
mq_timed£nd
, (
mqd
), (
msg_±r
), 
	`ulÚg
(
msg_Ën
), 
	`ušt
(
msg_´io
), (
abs_timeout
))

304 
’d


305 
funùiÚ
 
C
.
	$mq_timed»ûive
(
mqd
, 
msg_±r
, 
msg_Ën
, 
msg_´io
, 
abs_timeout
)

306  
	`sysÿÎ
(
sys
.
mq_timed»ûive
, (
mqd
), (
msg_±r
), 
	`ulÚg
(
msg_Ën
), (
msg_´io
), (
abs_timeout
))

307 
’d


309 
sys
.
mknod
 
th’


310 
funùiÚ
 
C
.
	$mknod
(
·thÇme
, 
mode
, 
dev
è 
	`sysÿÎ
(
sys
.
mknod
,…©hÇme, 
	`ušt
(mode), 
	$ušt
(
dev
)è
’d


311 
’d


312 
funùiÚ
 
C
.
	$mknod©
(
fd
, 
·thÇme
, 
mode
, 
dev
)

313  
	`sysÿÎ
(
sys
.
mknod©
, (
fd
), 
·thÇme
, 
	`ušt
(
mode
), 
	$ušt
(
dev
))

314 
’d


315 -- 
pivÙ_roÙ
 
is
 
nÙ
 
´ovided
 
by
 
glibc
, i ´ovided by 
Mu¦


316 
funùiÚ
 
C
.
	$pivÙ_roÙ
(
Ãw_roÙ
, 
put_Şd
)

317  
	$sysÿÎ
(
sys
.
pivÙ_roÙ
, 
Ãw_roÙ
, 
put_Şd
)

318 
’d


319 -- 
£Šs
 
nÙ
 
š
 
some
 
glibc
 
v”siÚs


320 
funùiÚ
 
C
.
	$£Šs
(
fd
, 
n¡y³
)

321  
	`sysÿÎ
(
sys
.
£Šs
, (
fd
), (
n¡y³
))

322 
’d


323 -- 
´lim™64
 
nÙ
 
š
 
my
 
ARM
 
glibc


324 
funùiÚ
 
C
.
	$´lim™64
(
pid
, 
»sourû
, 
Ãw_lim™
, 
Şd_lim™
)

325  
	`sysÿÎ
(
sys
.
´lim™64
, (
pid
), (
»sourû
), (
Ãw_lim™
), (
Şd_lim™
))

326 
’d


328 -- 
sched_£ffš™y
 
ªd
 
sched_g‘affš™y
 
nÙ
 
š
 
Mu¦
 
©
 
the
 
mom’t
, 
u£
 
sysÿÎs
. 
Could
 
‹¡
 
š¡—d
.

329 
funùiÚ
 
C
.
	$sched_g‘affš™y
(
pid
, 
Ën
, 
mask
)

330  
	`sysÿÎ
(
sys
.
sched_g‘affš™y
, (
pid
), 
	`ušt
(
Ën
), (
mask
))

331 
’d


332 
funùiÚ
 
C
.
	$sched_£ffš™y
(
pid
, 
Ën
, 
mask
)

333  
	`sysÿÎ
(
sys
.
sched_£ffš™y
, (
pid
), 
	`ušt
(
Ën
), (
mask
))

334 
’d


335 -- 
sched_£¬am
 
ªd
 
sched_g‘·¿m
 
š
 
Mu¦
  
ENOSYS
, 
´obably
 
as
 
they
 
wÜk
 
Ú
 
th»ads
 
nÙ
 
´oûs£s
.

336 
funùiÚ
 
C
.
	$sched_g‘·¿m
(
pid
, 
·¿m
)

337  
	`sysÿÎ
(
sys
.
sched_g‘·¿m
, (
pid
), (
·¿m
))

338 
’d


339 
funùiÚ
 
C
.
	$sched_£¬am
(
pid
, 
·¿m
)

340  
	`sysÿÎ
(
sys
.
sched_£¬am
, (
pid
), (
·¿m
))

341 
’d


343 -- 
š
 
lib¹
 
glibc
 
but
 
u£
 
sysÿÎs
 
š¡—d
 
of
 
lßdšg
 
ªÙh”
 
lib¿ry


344 
funùiÚ
 
C
.
	$şock_Çno¦“p
(
şk_id
, 
æags
, 
»q
, 
»m
)

345  
	`sysÿÎ
(
sys
.
şock_Çno¦“p
, (
şk_id
), (
æags
), (
»q
), (
»m
))

346 
’d


347 
funùiÚ
 
C
.
	$şock_g‘»s
(
şk_id
, 
ts
)

348  
	`sysÿÎ
(
sys
.
şock_g‘»s
, (
şk_id
), (
ts
))

349 
’d


350 
funùiÚ
 
C
.
	$şock_£‰ime
(
şk_id
, 
ts
)

351  
	`sysÿÎ
(
sys
.
şock_£‰ime
, (
şk_id
), (
ts
))

352 
’d


354 -- 
glibc
 
wl
 
nÙ
 
ÿÎ
 
this
 
w™h
 
a
 
nuÎ
 
·th
, 
which
 
is
 
Ãeded
 
to
 
im¶em’t
 
futim’s
 
š
 
Lšux


355 
funùiÚ
 
C
.
	$utim’§t
(
fd
, 
·th
, 
times
, 
æags
)

356  
	`sysÿÎ
(
sys
.
utim’§t
, (
fd
), (
·th
), (
times
), (
æags
))

357 
’d


359 -- 
nÙ
 
š
 
Android
 
BiÚic


360 
funùiÚ
 
C
.
	$lšk©
(
Şddœfd
, 
Şd·th
, 
Ãwdœfd
, 
Ãw·th
, 
æags
)

361  
	`sysÿÎ
(
sys
.
lšk©
, (
Şddœfd
), (
Şd·th
), (
Ãwdœfd
), (
Ãw·th
), (
æags
))

362 
’d


363 
funùiÚ
 
C
.
	$symlšk©
(
Şd·th
, 
Ãwdœfd
, 
Ãw·th
)

364  
	`sysÿÎ
(
sys
.
symlšk©
, (
Şd·th
), (
Ãwdœfd
), (
Ãw·th
))

365 
’d


366 
funùiÚ
 
C
.
	$»adlšk©
(
dœfd
, 
·thÇme
, 
buf
, 
bufsiz
)

367  
	`sysÿÎ
(
sys
.
»adlšk©
, (
dœfd
), (
·thÇme
), (
buf
), 
	$ulÚg
(
bufsiz
))

368 
’d


369 
funùiÚ
 
C
.
	$šÙify_š™1
(
æags
)

370  
	`sysÿÎ
(
sys
.
šÙify_š™1
, (
æags
))

371 
’d


372 
funùiÚ
 
C
.
	$adjtimex
(
buf
)

373  
	`sysÿÎ
(
sys
.
adjtimex
, (
buf
))

374 
’d


375 
funùiÚ
 
C
.
	$•Şl_ü—‹1
(
æags
)

376  
	`sysÿÎ
(
sys
.
•Şl_ü—‹1
, (
æags
))

377 
’d


378 
sys
.
•Şl_wa™
 
th’


379 
funùiÚ
 
C
.
	$•Şl_wa™
(
•fd
, 
ev’ts
, 
maxev’ts
, 
timeout
)

380  
	`sysÿÎ
(
sys
.
•Şl_wa™
, (
•fd
), (
ev’ts
), (
maxev’ts
), (
timeout
))

381 
’d


382 
’d


383 
funùiÚ
 
C
.
	$sw­Ú
(
·th
, 
sw­æags
)

384  
	`sysÿÎ
(
sys
.
sw­Ú
, (
·th
), (
sw­æags
))

385 
’d


386 
funùiÚ
 
C
.
	$sw­off
(
·th
)

387  
	`sysÿÎ
(
sys
.
sw­off
, (
·th
))

388 
’d


389 
funùiÚ
 
C
.
	$tim”fd_ü—‹
(
şockid
, 
æags
)

390  
	`sysÿÎ
(
sys
.
tim”fd_ü—‹
, (
şockid
), (
æags
))

391 
’d


392 
funùiÚ
 
C
.
	$tim”fd_£‰ime
(
fd
, 
æags
, 
Ãw_v®ue
, 
Şd_v®ue
)

393  
	`sysÿÎ
(
sys
.
tim”fd_£‰ime
, (
fd
), (
æags
), (
Ãw_v®ue
), (
Şd_v®ue
))

394 
’d


395 
funùiÚ
 
C
.
	$tim”fd_g‘time
(
fd
, 
cu¼_v®ue
)

396  
	`sysÿÎ
(
sys
.
tim”fd_g‘time
, (
fd
), (
cu¼_v®ue
))

397 
’d


398 
funùiÚ
 
C
.
	$¥liû
(
fd_š
, 
off_š
, 
fd_out
, 
off_out
, 
Ën
, 
æags
)

399  
	`sysÿÎ
(
sys
.
¥liû
, (
fd_š
), (
off_š
), (
fd_out
), (
off_out
), 
	`ulÚg
(
Ën
), 
	$ušt
(
æags
))

400 
’d


401 
funùiÚ
 
C
.
	$‹e
(
¤c
, 
de¡
, 
Ën
, 
æags
)

402  
	`sysÿÎ
(
sys
.
‹e
, (
¤c
), (
de¡
), 
	`ulÚg
(
Ën
), 
	$ušt
(
æags
))

403 
’d


404 
funùiÚ
 
C
.
	$vm¥liû
(
fd
, 
iovec
, 
út
, 
æags
)

405  
	`sysÿÎ
(
sys
.
vm¥liû
, (
fd
), (
iovec
), 
	`ulÚg
(
út
), 
	$ušt
(
æags
))

406 
’d


407 -- 
TODO
 
nÙe
 
th©
 
I
 
thšk
 
the£
 
may
 
be
 
šcÜ»ù
 
Ú
 32 
b™
 
¶©fÜms
, 
ªd
 
¡¿û
 
is
 
buggy


408 
sys
.
sync_fe_¿nge
 
th’


409 
abi
.
abi64
 
th’


410 
funùiÚ
 
C
.
	$sync_fe_¿nge
(
fd
, 
pos
, 
Ën
, 
æags
)

411  
	`sysÿÎ
(
sys
.
sync_fe_¿nge
, (
fd
), (
pos
), (
Ën
), 
	$ušt
(
æags
))

412 
’d


414 
z”İad
 
th’
 -- 
Úly
 
Ú
 
ms


415 
funùiÚ
 
C
.
	$sync_fe_¿nge
(
fd
, 
pos
, 
Ën
, 
æags
)

416 
loÿl
 
pos1
, 
pos2
 = 
	$¬g64
(
pos
)

417 
loÿl
 
Ën1
, 
Ën2
 = 
	`¬g64
(
Ën
)

418 -- 
TODO
 
the£
 
¬gs
 
­³¬
 
to
 
be
 
»v”£d
 
but
 
is
 
this
 
mi¡ak’
/
’dŸÂess
/
®so
 
Œue
 
–£wh”e
? 
¡¿û
 
brok’
...

419  
	`sysÿÎ
(
sys
.
sync_fe_¿nge
, (
fd
), 0, (
pos2
), (
pos1
), (
Ën2
), (
Ën1
), 
	$ušt
(
æags
))

420 
’d


422 
funùiÚ
 
C
.
	$sync_fe_¿nge
(
fd
, 
pos
, 
Ën
, 
æags
)

423 
loÿl
 
pos1
, 
pos2
 = 
	$¬g64
(
pos
)

424 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64
(
Ën
)

425  
	`sysÿÎ
(
sys
.
sync_fe_¿nge
, (
fd
), (
pos1
), (
pos2
), (
Ën1
), (
Ën2
), 
	$ušt
(
æags
))

426 
’d


427 
’d


428 
’d


429 
–£if
 
sys
.
sync_fe_¿nge2
 
th’
 -- 
Úly
 
Ú
 32 
b™
 
¶©fÜms


430 
funùiÚ
 
C
.
	$sync_fe_¿nge
(
fd
, 
pos
, 
Ën
, 
æags
)

431 
loÿl
 
pos1
, 
pos2
 = 
	$¬g64
(
pos
)

432 
loÿl
 
Ën1
, 
Ën2
 = 
	$¬g64
(
Ën
)

433  
	`sysÿÎ
(
sys
.
sync_fe_¿nge2
, (
fd
), 
	`ušt
(
æags
), (
pos1
), (
pos2
), (
Ën1
), (
Ën2
))

434 
’d


435 
’d


437 -- 
TODO
 
this
 
should
 
be
 
gÙ
 
äom
 
somewh”e
 
mÜe
 
g’”ic


438 -- 
¡¬‹d
 
movšg
 
što
 
lšux
/
sysÿÎ
.
lua
 
som
 
	$ex¶ic™
 (
£e
 
sigÇlfd
è
but
 
Ãeds
 
some
 
mÜe
 
ş—nups


439 
loÿl
 
sig£t_size
 = 8

440 
abi
.
¬ch
 =ğ"ms" 
Ü
‡bi.¬ch =ğ"m£l" 
th’


441 
sig£t_size
 = 16

442 
’d


444 
loÿl
 
funùiÚ
 
	$sigmasksize
(
sigmask
)

445 
loÿl
 
size
 = 0

446 
sigmask
 
th’
 
size
 = 
sig£t_size
 
’d


447  
	$ulÚg
(
size
)

448 
’d


450 
funùiÚ
 
C
.
	$•Şl_pwa™
(
•fd
, 
ev’ts
, 
maxev’ts
, 
timeout
, 
sigmask
)

451  
	`sysÿÎ
(
sys
.
•Şl_pwa™
, (
•fd
), (
ev’ts
), (
maxev’ts
), (
timeout
), (
sigmask
), 
	$sigmasksize
(
sigmask
))

452 
’d


454 
funùiÚ
 
C
.
	$µŞl
(
fds
, 
nfds
, 
timeout_ts
, 
sigmask
)

455  
	`sysÿÎ
(
sys
.
µŞl
, (
fds
), 
	`ulÚg
(
nfds
), (
timeout_ts
), (
sigmask
), 
	$sigmasksize
(
sigmask
))

456 
’d


457 
funùiÚ
 
C
.
	$sigÇlfd
(
fd
, 
mask
, 
size
, 
æags
)

458  
	`sysÿÎ
(
sys
.
sigÇlfd4
, (
fd
), (
mask
), 
	`ulÚg
(
size
), (
æags
))

459 
’d


461 -- 
addšg
 
mÜe


462 
funùiÚ
 
C
.
	$dup
(
Şdfd
è 
	`sysÿÎ
(
sys
.
dup
, (Şdfd)è
’d


463 
sys
.
dup2
 
th’
 
funùiÚ
 
C
.
	$dup2
(
Şdfd
, 
Ãwfd
è 
	`sysÿÎ
(
sys
.
dup2
, (Şdfd), Òewfd)è
’d
ƒnd

464 
funùiÚ
 
C
.
	$dup3
(
Şdfd
, 
Ãwfd
, 
æags
è 
	`sysÿÎ
(
sys
.
dup3
, (Şdfd), Òewfd), (æags)è
’d


465 
sys
.
chmod
 
th’
 
funùiÚ
 
C
.
	$chmod
(
·th
, 
mode
è 
	`sysÿÎ
(
sys
.
chmod
, Õ©h), 
	$ušt
(
mode
)è
’d
ƒnd

466 
funùiÚ
 
C
.
	$fchmod
(
fd
, 
mode
è 
	`sysÿÎ
(
sys
.
fchmod
, (fd), 
	$ušt
(
mode
)è
’d


467 
funùiÚ
 
C
.
	$umask
(
mode
è 
	`sysÿÎ
(
sys
.
umask
, 
	$ušt
(
mode
)è
’d


468 
sys
.
acûss
 
th’
 
funùiÚ
 
C
.
	$acûss
(
·th
, 
mode
è 
	`sysÿÎ
(
sys
.
acûss
, Õ©h), 
	$ušt
(
mode
)è
’d
ƒnd

469 
funùiÚ
 
C
.
	$g‘µid
(è 
	$sysÿÎ
(
sys
.
g‘µid
è
’d


470 
funùiÚ
 
C
.
	$g‘uid
(è 
	$sysÿÎ
(
sys
.
g‘uid
è
’d


471 
funùiÚ
 
C
.
	$g‘euid
(è 
	$sysÿÎ
(
sys
.
g‘euid
è
’d


472 
funùiÚ
 
C
.
	$g‘gid
(è 
	$sysÿÎ
(
sys
.
g‘gid
è
’d


473 
funùiÚ
 
C
.
	$g‘egid
(è 
	$sysÿÎ
(
sys
.
g‘egid
è
’d


474 
funùiÚ
 
C
.
	$g‘»suid
(
ruid
, 
euid
, 
suid
è 
	`sysÿÎ
(
sys
.
g‘»suid
, Ôuid), Óuid), (suid)è
’d


475 
funùiÚ
 
C
.
	$g‘»sgid
(
rgid
, 
egid
, 
sgid
è 
	`sysÿÎ
(
sys
.
g‘»sgid
, Ôgid), Ógid), (sgid)è
’d


476 
funùiÚ
 
C
.
	$£tuid
(
id
è 
	`sysÿÎ
(
sys
.
£tuid
, 
	$ušt
(
id
)è
’d


477 
funùiÚ
 
C
.
	$£tgid
(
id
è 
	`sysÿÎ
(
sys
.
£tgid
, 
	$ušt
(
id
)è
’d


478 
funùiÚ
 
C
.
	$£Œesuid
(
ruid
, 
euid
, 
suid
è 
	`sysÿÎ
(
sys
.
£Œesuid
, 
	`ušt
Ôuid), uštÓuid), 
	$ušt
(
suid
)è
’d


479 
funùiÚ
 
C
.
	$£Œesgid
(
rgid
, 
egid
, 
sgid
è 
	`sysÿÎ
(
sys
.
£Œesgid
, 
	`ušt
Ôgid), uštÓgid), 
	$ušt
(
sgid
)è
’d


480 
funùiÚ
 
C
.
	$£Œeuid
(
uid
, 
euid
è 
	`sysÿÎ
(
sys
.
£Œeuid
, 
	`ušt
(uid), 
	$ušt
(
euid
)è
’d


481 
funùiÚ
 
C
.
	$£Œegid
(
gid
, 
egid
è 
	`sysÿÎ
(
sys
.
£Œegid
, 
	`ušt
(gid), 
	$ušt
(
egid
)è
’d


482 
funùiÚ
 
C
.
	$æock
(
fd
, 
İ”©iÚ
è 
	`sysÿÎ
(
sys
.
æock
, (fd), (İ”©iÚ)è
’d


483 
funùiÚ
 
C
.
	$g‘ru§ge
(
who
, 
u§ge
è 
	`sysÿÎ
(
sys
.
g‘ru§ge
, (who), (u§ge)è
’d


484 
sys
.
rmdœ
 
th’
 
funùiÚ
 
C
.
	$rmdœ
(
·th
è 
	`sysÿÎ
(
sys
.
rmdœ
, Õ©h)è
’d
ƒnd

485 
funùiÚ
 
C
.
	$chdœ
(
·th
è 
	`sysÿÎ
(
sys
.
chdœ
, Õ©h)è
’d


486 
funùiÚ
 
C
.
	$fchdœ
(
fd
è 
	`sysÿÎ
(
sys
.
fchdœ
, (fd)è
’d


487 
sys
.
chown
 
th’
 
funùiÚ
 
C
.
	$chown
(
·th
, 
owÃr
, 
group
è 
	`sysÿÎ
(
sys
.
chown
, Õ©h), 
	`ušt
(owÃr), 
	$ušt
(
group
)è
’d
ƒnd

488 
funùiÚ
 
C
.
	$fchown
(
fd
, 
owÃr
, 
group
è 
	`sysÿÎ
(
sys
.
fchown
, (fd), 
	`ušt
(owÃr), 
	$ušt
(
group
)è
’d


489 
funùiÚ
 
C
.
	$lchown
(
·th
, 
owÃr
, 
group
è 
	`sysÿÎ
(
sys
.
lchown
, Õ©h), 
	`ušt
(owÃr), 
	$ušt
(
group
)è
’d


490 
sys
.
İ’
 
th’


491 
funùiÚ
 
C
.
	$İ’
(
·thÇme
, 
æags
, 
mode
è 
	`sysÿÎ
(
sys
.
İ’
, Õ©hÇme), (æags), 
	$ušt
(
mode
)è
’d


492 
’d


493 
funùiÚ
 
C
.
	$İ’©
(
dœfd
, 
·thÇme
, 
æags
, 
mode
è 
	`sysÿÎ
(
sys
.
İ’©
, (dœfd), Õ©hÇme), (æags), 
	$ušt
(
mode
)è
’d


494 
sys
.
ü—t
 
th’
 
funùiÚ
 
C
.
	$ü—t
(
·thÇme
, 
mode
è 
	`sysÿÎ
(
sys
.
ü—t
, Õ©hÇme), 
	$ušt
(
mode
)è
’d
ƒnd

495 
funùiÚ
 
C
.
	$şo£
(
fd
è 
	`sysÿÎ
(
sys
.
şo£
, (fd)è
’d


496 
funùiÚ
 
C
.
	$»ad
(
fd
, 
buf
, 
couÁ
è 
	`sysÿÎ_lÚg
(
sys
.
»ad
, (fd), (buf), 
	$ulÚg
(
couÁ
)è
’d


497 
funùiÚ
 
C
.
	$wr™e
(
fd
, 
buf
, 
couÁ
è 
	`sysÿÎ_lÚg
(
sys
.
wr™e
, (fd), (buf), 
	$ulÚg
(
couÁ
)è
’d


498 
funùiÚ
 
C
.
	$»adv
(
fd
, 
iov
, 
iovút
è 
	`sysÿÎ_lÚg
(
sys
.
»adv
, (fd), (iov), (iovút)è
’d


499 
funùiÚ
 
C
.
	$wr™ev
(
fd
, 
iov
, 
iovút
è 
	`sysÿÎ_lÚg
(
sys
.
wr™ev
, (fd), (iov), (iovút)è
’d


500 
sys
.
»adlšk
 
th’
 
funùiÚ
 
C
.
	$»adlšk
(
·th
, 
buf
, 
bufsiz
è 
	`sysÿÎ_lÚg
(
sys
.
»adlšk
, Õ©h), (buf), 
	$ulÚg
(
bufsiz
)è
’d
ƒnd

501 
sys
.
»Çme
 
th’
 
funùiÚ
 
C
.
	$»Çme
(
Şd·th
, 
Ãw·th
è 
	`sysÿÎ
(
sys
.
»Çme
, (Şd·th), Òew·th)è
’d
ƒnd

502 
funùiÚ
 
C
.
	$»Çm—t
(
Şddœfd
, 
Şd·th
, 
Ãwdœfd
, 
Ãw·th
)

503  
	`sysÿÎ
(
sys
.
»Çm—t
, (
Şddœfd
), (
Şd·th
), (
Ãwdœfd
), (
Ãw·th
))

504 
’d


505 
sys
.
»Çm—t2
 
th’


506 
funùiÚ
 
C
.
	$»Çm—t2
(
Şddœfd
, 
Şd·th
, 
Ãwdœfd
, 
Ãw·th
, 
æags
)

507  
	`sysÿÎ
(
sys
.
»Çm—t2
, (
Şddœfd
), (
Şd·th
), (
Ãwdœfd
), (
Ãw·th
), (
æags
))

508 
’d


509 
’d


510 
sys
.
uÆšk
 
th’
 
funùiÚ
 
C
.
	$uÆšk
(
·thÇme
è 
	`sysÿÎ
(
sys
.
uÆšk
, Õ©hÇme)è
’d
ƒnd

511 
funùiÚ
 
C
.
	$uÆšk©
(
dœfd
, 
·thÇme
, 
æags
è 
	`sysÿÎ
(
sys
.
uÆšk©
, (dœfd), Õ©hÇme), (æags)è
’d


512 
funùiÚ
 
C
.
	$´ùl
(
İtiÚ
, 
¬g2
, 
¬g3
, 
¬g4
, 
¬g5
)

513  
	`sysÿÎ
(
sys
.
´ùl
, (
İtiÚ
), 
	`ulÚg
(
¬g2
), ulÚg(
¬g3
), ulÚg(
¬g4
), 
	$ulÚg
(
¬g5
))

514 
’d


515 
abi
.
¬ch
 ~ğ"ms" 
ªd
‡bi.¬ch ~ğ"m£l"‡nd 
sys
.
pe
 
th’
 -- 
ms
 
u£s
 
Şd
 
¡yË
 
du®
  
ÿÎšg
 
cÚv’tiÚ
 
th©
 
we
 
ÿÂÙ
 
u£


516 
funùiÚ
 
C
.
	$pe
(
pefd
è 
	`sysÿÎ
(
sys
.
pe
, Õefd)è
’d


517 
’d


518 
funùiÚ
 
C
.
	$pe2
(
pefd
, 
æags
è 
	`sysÿÎ
(
sys
.
pe2
, Õefd), (æags)è
’d


519 
funùiÚ
 
C
.
	$·u£
(è 
	$sysÿÎ
(
sys
.
·u£
è
’d


520 
funùiÚ
 
C
.
	$»m­_fe_·ges
(
addr
, 
size
, 
´Ù
, 
pgoff
, 
æags
)

521  
	`sysÿÎ
(
sys
.
»m­_fe_·ges
, (
addr
), 
	`ulÚg
(
size
), (
´Ù
), (
pgoff
), (
æags
))

522 
’d


523 
sys
.
fÜk
 
th’
 
funùiÚ
 
C
.
	$fÜk
(è 
	$sysÿÎ
(
sys
.
fÜk
è
’d
ƒnd

524 
funùiÚ
 
C
.
	$kl
(
pid
, 
sig
è 
	`sysÿÎ
(
sys
.
kl
, Õid), (sig)è
’d


525 
sys
.
mkdœ
 
th’
 
funùiÚ
 
C
.
	$mkdœ
(
·thÇme
, 
mode
è 
	`sysÿÎ
(
sys
.
mkdœ
, Õ©hÇme), 
	$ušt
(
mode
)è
’d
ƒnd

526 
funùiÚ
 
C
.
	$fsync
(
fd
è 
	`sysÿÎ
(
sys
.
fsync
, (fd)è
’d


527 
funùiÚ
 
C
.
	$fd©async
(
fd
è 
	`sysÿÎ
(
sys
.
fd©async
, (fd)è
’d


528 
funùiÚ
 
C
.
	$sync
(è 
	$sysÿÎ
(
sys
.
sync
è
’d


529 
funùiÚ
 
C
.
	$syncfs
(
fd
è 
	`sysÿÎ
(
sys
.
syncfs
, (fd)è
’d


530 
sys
.
lšk
 
th’
 
funùiÚ
 
C
.
	$lšk
(
Şd·th
, 
Ãw·th
è 
	`sysÿÎ
(
sys
.
lšk
, (Şd·th), Òew·th)è
’d
ƒnd

531 
sys
.
symlšk
 
th’
 
funùiÚ
 
C
.
	$symlšk
(
Şd·th
, 
Ãw·th
è 
	`sysÿÎ
(
sys
.
symlšk
, (Şd·th), Òew·th)è
’d
ƒnd

532 
funùiÚ
 
C
.
	$•Şl_ùl
(
•fd
, 
İ
, 
fd
, 
ev’t
è 
	`sysÿÎ
(
sys
.
•Şl_ùl
, Ópfd), (İ), (fd), Óv’t)è
’d


533 
funùiÚ
 
C
.
	$uÇme
(
buf
è 
	`sysÿÎ
(
sys
.
uÇme
, (buf)è
’d


534 
funùiÚ
 
C
.
	$g‘sid
(
pid
è 
	`sysÿÎ
(
sys
.
g‘sid
, Õid)è
’d


535 
funùiÚ
 
C
.
	$g‘pgid
(
pid
è 
	`sysÿÎ
(
sys
.
g‘pgid
, Õid)è
’d


536 
funùiÚ
 
C
.
	$£gid
(
pid
, 
pgid
è 
	`sysÿÎ
(
sys
.
£gid
, Õid), Õgid)è
’d


537 
sys
.
g‘pg½
 
th’
 
funùiÚ
 
C
.
	$g‘pg½
(è 
	$sysÿÎ
(
sys
.
g‘pg½
è
’d
ƒnd

538 
funùiÚ
 
C
.
	$£tsid
(è 
	$sysÿÎ
(
sys
.
£tsid
è
’d


539 
funùiÚ
 
C
.
	$chroÙ
(
·th
è 
	`sysÿÎ
(
sys
.
chroÙ
, Õ©h)è
’d


540 
funùiÚ
 
C
.
	$mouÁ
(
sourû
, 
rg‘
, 
fesy¡emty³
, 
mouÁæags
, 
d©a
)

541  
	`sysÿÎ
(
sys
.
mouÁ
, (
sourû
), (
rg‘
), (
fesy¡emty³
), 
	`ulÚg
(
mouÁæags
), (
d©a
))

542 
’d


543 
funùiÚ
 
C
.
	$umouÁ
(
rg‘
è 
	`sysÿÎ
(
sys
.
umouÁ
, Ñ¬g‘)è
’d


544 
funùiÚ
 
C
.
	$umouÁ2
(
rg‘
, 
æags
è 
	`sysÿÎ
(
sys
.
umouÁ2
, Ñ¬g‘), (æags)è
’d


545 
funùiÚ
 
C
.
	$li¡x©Œ
(
·th
, 
li¡
, 
size
è 
	`sysÿÎ_lÚg
(
sys
.
li¡x©Œ
, Õ©h), Öi¡), 
	$ulÚg
(
size
)è
’d


546 
funùiÚ
 
C
.
	$Îi¡x©Œ
(
·th
, 
li¡
, 
size
è 
	`sysÿÎ_lÚg
(
sys
.
Îi¡x©Œ
, Õ©h), Öi¡), 
	$ulÚg
(
size
)è
’d


547 
funùiÚ
 
C
.
	$æi¡x©Œ
(
fd
, 
li¡
, 
size
è 
	`sysÿÎ_lÚg
(
sys
.
æi¡x©Œ
, (fd), Öi¡), 
	$ulÚg
(
size
)è
’d


548 
funùiÚ
 
C
.
	$£tx©Œ
(
·th
, 
Çme
, 
v®ue
, 
size
, 
æags
)

549  
	`sysÿÎ
(
sys
.
£tx©Œ
, (
·th
), (
Çme
), (
v®ue
), 
	`ulÚg
(
size
), (
æags
))

550 
’d


551 
funùiÚ
 
C
.
	$l£tx©Œ
(
·th
, 
Çme
, 
v®ue
, 
size
, 
æags
)

552  
	`sysÿÎ
(
sys
.
l£tx©Œ
, (
·th
), (
Çme
), (
v®ue
), 
	`ulÚg
(
size
), (
æags
))

553 
’d


554 
funùiÚ
 
C
.
	$f£tx©Œ
(
fd
, 
Çme
, 
v®ue
, 
size
, 
æags
)

555  
	`sysÿÎ
(
sys
.
f£tx©Œ
, (
fd
), (
Çme
), (
v®ue
), 
	`ulÚg
(
size
), (
æags
))

556 
’d


557 
funùiÚ
 
C
.
	$g‘x©Œ
(
·th
, 
Çme
, 
v®ue
, 
size
)

558  
	`sysÿÎ_lÚg
(
sys
.
g‘x©Œ
, (
·th
), (
Çme
), (
v®ue
), 
	$ulÚg
(
size
))

559 
’d


560 
funùiÚ
 
C
.
	$lg‘x©Œ
(
·th
, 
Çme
, 
v®ue
, 
size
)

561  
	`sysÿÎ_lÚg
(
sys
.
lg‘x©Œ
, (
·th
), (
Çme
), (
v®ue
), 
	$ulÚg
(
size
))

562 
’d


563 
funùiÚ
 
C
.
	$fg‘x©Œ
(
fd
, 
Çme
, 
v®ue
, 
size
)

564  
	`sysÿÎ_lÚg
(
sys
.
fg‘x©Œ
, (
fd
), (
Çme
), (
v®ue
), 
	$ulÚg
(
size
))

565 
’d


566 
funùiÚ
 
C
.
	$»movex©Œ
(
·th
, 
Çme
è 
	`sysÿÎ
(
sys
.
»movex©Œ
, Õ©h), Òame)è
’d


567 
funùiÚ
 
C
.
	$Ìemovex©Œ
(
·th
, 
Çme
è 
	`sysÿÎ
(
sys
.
Ìemovex©Œ
, Õ©h), Òame)è
’d


568 
funùiÚ
 
C
.
	$äemovex©Œ
(
fd
, 
Çme
è 
	`sysÿÎ
(
sys
.
äemovex©Œ
, (fd), Òame)è
’d


569 
funùiÚ
 
C
.
	$šÙify_add_w©ch
(
fd
, 
·thÇme
, 
mask
è 
	`sysÿÎ
(
sys
.
šÙify_add_w©ch
, (fd), Õ©hÇme), 
	$ušt
(
mask
)è
’d


570 
funùiÚ
 
C
.
	$šÙify_rm_w©ch
(
fd
, 
wd
è 
	`sysÿÎ
(
sys
.
šÙify_rm_w©ch
, (fd), (wd)è
’d


571 
funùiÚ
 
C
.
	$unsh¬e
(
æags
è 
	`sysÿÎ
(
sys
.
unsh¬e
, (æags)è
’d


572 
funùiÚ
 
C
.
	$»boÙ
(
magic
, 
magic2
, 
cmd
è 
	`sysÿÎ
(
sys
.
»boÙ
, (magic), (magic2), (cmd)è
’d


573 
funùiÚ
 
C
.
	$£tho¡Çme
(
Çme
, 
Ën
è 
	`sysÿÎ
(
sys
.
£tho¡Çme
, Òame), 
	$ulÚg
(
Ën
)è
’d


574 
funùiÚ
 
C
.
	$£tdomašÇme
(
Çme
, 
Ën
è 
	`sysÿÎ
(
sys
.
£tdomašÇme
, Òame), 
	$ulÚg
(
Ën
)è
’d


575 
funùiÚ
 
C
.
	$g‘™im”
(
which
, 
cu¼_v®ue
è 
	`sysÿÎ
(
sys
.
g‘™im”
, (which), (cu¼_v®ue)è
’d


576 
funùiÚ
 
C
.
	$£t™im”
(
which
, 
Ãw_v®ue
, 
Şd_v®ue
è 
	`sysÿÎ
(
sys
.
£t™im”
, (which), Òew_v®ue), (Şd_v®ue)è
’d


577 
funùiÚ
 
C
.
	$sched_y›ld
(è 
	$sysÿÎ
(
sys
.
sched_y›ld
è
’d


578 
funùiÚ
 
C
.
	$acù
(
f’ame
è 
	`sysÿÎ
(
sys
.
acù
, (f’ame)è
’d


579 
funùiÚ
 
C
.
	$munm­
(
addr
, 
Ëngth
è 
	`sysÿÎ
(
sys
.
munm­
, ×ddr), 
	$ulÚg
(
Ëngth
)è
’d


580 
funùiÚ
 
C
.
	$çcûs§t
(
dœfd
, 
·th
, 
mode
, 
æags
è 
	`sysÿÎ
(
sys
.
çcûs§t
, (dœfd), Õ©h), 
	`ušt
(mode), (æags)è
’d


581 
funùiÚ
 
C
.
	$fchmod©
(
dœfd
, 
·th
, 
mode
, 
æags
è 
	`sysÿÎ
(
sys
.
fchmod©
, (dœfd), Õ©h), 
	`ušt
(mode), (æags)è
’d


582 
funùiÚ
 
C
.
	$mkdœ©
(
dœfd
, 
·thÇme
, 
mode
è 
	`sysÿÎ
(
sys
.
mkdœ©
, (dœfd), Õ©hÇme), 
	$ušt
(
mode
)è
’d


583 
funùiÚ
 
C
.
	$fchowÇt
(
dœfd
, 
·thÇme
, 
owÃr
, 
group
, 
æags
)

584  
	`sysÿÎ
(
sys
.
fchowÇt
, (
dœfd
), (
·thÇme
), 
	`ušt
(
owÃr
), ušt(
group
), (
æags
))

585 
’d


586 
funùiÚ
 
C
.
	$£riÜ™y
(
which
, 
who
, 
´io
è 
	`sysÿÎ
(
sys
.
£riÜ™y
, (which), (who), Õrio)è
’d


587 
funùiÚ
 
C
.
	$sched_g‘_´iÜ™y_mš
(
pŞicy
è 
	`sysÿÎ
(
sys
.
sched_g‘_´iÜ™y_mš
, ÕŞicy)è
’d


588 
funùiÚ
 
C
.
	$sched_g‘_´iÜ™y_max
(
pŞicy
è 
	`sysÿÎ
(
sys
.
sched_g‘_´iÜ™y_max
, ÕŞicy)è
’d


589 
funùiÚ
 
C
.
	$sched_¼_g‘_š‹rv®
(
pid
, 

è 
	`sysÿÎ
(
sys
.
sched_¼_g‘_š‹rv®
, Õid), Ñp)è
’d


590 
sys
.
pŞl
 
th’
 
funùiÚ
 
C
.
	$pŞl
(
fds
, 
nfds
, 
timeout
è 
	`sysÿÎ
(
sys
.
pŞl
, (fds), Òfds), Ñimeout)è
’d
ƒnd

591 
funùiÚ
 
C
.
	$msync
(
addr
, 
Ëngth
, 
æags
è 
	`sysÿÎ
(
sys
.
msync
, ×ddr), 
	`ulÚg
Ö’gth), (æags)è
’d


592 
funùiÚ
 
C
.
	$madvi£
(
addr
, 
Ëngth
, 
adviû
è 
	`sysÿÎ
(
sys
.
madvi£
, ×ddr), 
	`ulÚg
Ö’gth), ×dviû)è
’d


593 
funùiÚ
 
C
.
	$mlock
(
addr
, 
Ën
è 
	`sysÿÎ
(
sys
.
mlock
, ×ddr), 
	$ulÚg
(
Ën
)è
’d


594 
funùiÚ
 
C
.
	$muÆock
(
addr
, 
Ën
è 
	`sysÿÎ
(
sys
.
muÆock
, ×ddr), 
	$ulÚg
(
Ën
)è
’d


595 
funùiÚ
 
C
.
	$mlock®l
(
æags
è 
	`sysÿÎ
(
sys
.
mlock®l
, (æags)è
’d


596 
funùiÚ
 
C
.
	$muÆock®l
(è 
	$sysÿÎ
(
sys
.
muÆock®l
è
’d


597 
funùiÚ
 
C
.
	$ÿpg‘
(
hd½
, 
d©­
è 
	`sysÿÎ
(
sys
.
ÿpg‘
, (hd½), (d©­)è
’d


598 
funùiÚ
 
C
.
	$ÿp£t
(
hd½
, 
d©­
è 
	`sysÿÎ
(
sys
.
ÿp£t
, (hd½), (d©­)è
’d


599 
funùiÚ
 
C
.
	$sysšfo
(
šfo
è 
	`sysÿÎ
(
sys
.
sysšfo
, (šfo)è
’d


600 
funùiÚ
 
C
.
	$execve
(
f’ame
, 
¬gv
, 
’vp
è 
	`sysÿÎ
(
sys
.
execve
, (f’ame), ×rgv), Ónvp)è
’d


601 
funùiÚ
 
C
.
	$g‘groups
(
size
, 
li¡
è 
	`sysÿÎ
(
sys
.
g‘groups
, (size), Öi¡)è
’d


602 
funùiÚ
 
C
.
	$£tgroups
(
size
, 
li¡
è 
	`sysÿÎ
(
sys
.
£tgroups
, (size), Öi¡)è
’d


603 
funùiÚ
 
C
.
	$klogùl
(

, 
buå
, 
Ën
è 
	`sysÿÎ
(
sys
.
sy¦og
, Ñp), (buå), Ö’)è
’d


604 
funùiÚ
 
C
.
	$sig´ocmask
(
how
, 
£t
, 
Şd£t
)

605  
	`sysÿÎ
(
sys
.
¹_sig´ocmask
, (
how
), (
£t
), (
Şd£t
), 
	$sigmasksize
(
£t
 
Ü
 
Şd£t
))

606 
’d


607 
funùiÚ
 
C
.
	$sig³ndšg
(
£t
è 
	`sysÿÎ
(
sys
.
¹_sig³ndšg
, (£t), 
	$sigmasksize
(
£t
)è
’d


608 
funùiÚ
 
C
.
	$m»m­
(
Şd_add»ss
, 
Şd_size
, 
Ãw_size
, 
æags
, 
Ãw_add»ss
)

609  
	`sysÿÎ_void
(
sys
.
m»m­
, (
Şd_add»ss
), 
	`ulÚg
(
Şd_size
), ulÚg(
Ãw_size
), (
æags
), (
Ãw_add»ss
))

610 
’d


611 
funùiÚ
 
C
.
	$Çno¦“p
(
»q
, 
»m
è 
	`sysÿÎ
(
sys
.
Çno¦“p
, Ôeq), Ôem)è
’d


612 
funùiÚ
 
C
.
	$wa™4
(
pid
, 
¡©us
, 
İtiÚs
, 
ru§ge
è 
	`sysÿÎ
(
sys
.
wa™4
, Õid), (¡©us), (İtiÚs), Ôu§ge)è
’d


613 
funùiÚ
 
C
.
	$wa™id
(
idty³
, 
id
, 
šfİ
, 
İtiÚs
, 
ru§ge
)

614  
	`sysÿÎ
(
sys
.
wa™id
, (
idty³
), 
	`ušt
(
id
), (
šfİ
), (
İtiÚs
), (
ru§ge
))

615 
’d


616 
funùiÚ
 
C
.
	$£‰imeofday
(
tv
, 
tz
)

617  
	`sysÿÎ
(
sys
.
£‰imeofday
, (
tv
), (
tz
))

618 
’d


619 
funùiÚ
 
C
.
	$tim”_ü—‹
(
şockid
, 
£vp
, 
tim”id
è 
	`sysÿÎ
(
sys
.
tim”_ü—‹
, (şockid), (£vp), Ñim”id)è
’d


620 
funùiÚ
 
C
.
	$tim”_£‰ime
(
tim”id
, 
æags
, 
Ãw_v®ue
, 
Şd_v®ue
)

621  
	`sysÿÎ
(
sys
.
tim”_£‰ime
, (
tim”id
), (
æags
), (
Ãw_v®ue
), (
Şd_v®ue
))

622 
’d


623 
funùiÚ
 
C
.
	$tim”_g‘time
(
tim”id
, 
cu¼_v®ue
è 
	`sysÿÎ
(
sys
.
tim”_g‘time
, Ñim”id), (cu¼_v®ue)è
’d


624 
funùiÚ
 
C
.
	$tim”_d–‘e
(
tim”id
è 
	`sysÿÎ
(
sys
.
tim”_d–‘e
, Ñim”id)è
’d


625 
funùiÚ
 
C
.
	$tim”_g‘ov”run
(
tim”id
è 
	`sysÿÎ
(
sys
.
tim”_g‘ov”run
, Ñim”id)è
’d


626 
funùiÚ
 
C
.
	$vhªgup
(è 
	$sysÿÎ
(
sys
.
vhªgup
è
’d


628 -- 
Úly
 
Ú
 
some
 
¬ch™eùu»s


629 
sys
.
wa™pid
 
th’


630 
funùiÚ
 
C
.
	$wa™pid
(
pid
, 
¡©us
, 
İtiÚs
è 
	`sysÿÎ
(
sys
.
wa™pid
, Õid), (¡©us), (İtiÚs)è
’d


631 
’d


633 -- 
fú
 
Ãeds
 
a
 
ÿ¡
 
as
 
Ï¡
 
¬gum’t
 
may
 
be
 
Ü
 
poš‹r


634 
loÿl
 
fú
 = 
sys
.
fú64
 
Ü
 sys.fcntl

635 
funùiÚ
 
C
.
	$fú
(
fd
, 
cmd
, 
¬g
è 
	`sysÿÎ
(
fú
, (fd), (cmd), 
ffi
.
	$ÿ¡
(, 
¬g
)è
’d


637 
funùiÚ
 
C
.
	$p£Ëù
(
nfds
, 
»adfds
, 
wr™efds
, 
exû±fds
, 
timeout
, 
sigmask
)

638 
loÿl
 
size
 = 0

639 
sigmask
 
th’
 
size
 = 
sig£t_size
 
’d


640 
loÿl
 
d©a
 = 
	`lÚgs
((
sigmask
), 
size
)

641  
	`sysÿÎ
(
sys
.
p£Ëù6
, (
nfds
), (
»adfds
), (
wr™efds
), (
exû±fds
), (
timeout
), (
d©a
))

642 
’d


644 -- 
Ãed
 
_Ãw£Ëù
 
sysÿÎ
 
Ú
 
some
 
¶©fÜms


645 
loÿl
 
sys£Ëù
 = 
sys
.
_Ãw£Ëù
 
Ü
 sys.
£Ëù


646 
sys£Ëù
 
th’


647 
funùiÚ
 
C
.
	$£Ëù
(
nfds
, 
»adfds
, 
wr™efds
, 
exû±fds
, 
timeout
)

648  
	`sysÿÎ
(
sys£Ëù
, (
nfds
), (
»adfds
), (
wr™efds
), (
exû±fds
), (
timeout
))

649 
’d


650 
’d


652 -- 
missšg
 
Ú
 
some
 
¶©fÜms
 
eg
 
ARM


653 
sys
.
®¬m
 
th’


654 
funùiÚ
 
C
.
	$®¬m
(
£cÚds
è 
	`sysÿÎ
(
sys
.
®¬m
, 
	$ušt
(
£cÚds
)è
’d


655 
’d


657 -- 
Ãw
 
sy¡em
 
ÿÎs
, 
may
 
be
 
missšg
 
TODO
 
fix
 
so
 
is
 
nÙ


658 
sys
.
g‘¿ndom
 
th’


659 
funùiÚ
 
C
.
	$g‘¿ndom
(
buf
, 
couÁ
, 
æags
è 
	`sysÿÎ
(
sys
.
g‘¿ndom
, (buf), 
	`ušt
(couÁ), 
	$ušt
(
æags
)è
’d


660 
’d


661 
sys
.
memfd_ü—‹
 
th’


662 
funùiÚ
 
C
.
	$memfd_ü—‹
(
Çme
, 
æags
è 
	`sysÿÎ
(
sys
.
memfd_ü—‹
, Òame), 
	$ušt
(
æags
)è
’d


663 
’d


665 -- 
k”Ãl
 
sigaùiÚ
 
¡ruùu»s
 
aùu®ly
 
¿th”
 
difã»Á
 
š
 
Lšux
 
äom
 
libc
 
Úes


666 
funùiÚ
 
C
.
	$sigaùiÚ
(
signum
, 
aù
, 
Şdaù
)

667  
	`sysÿÎ
(
sys
.
¹_sigaùiÚ
, (
signum
), (
aù
), (
Şdaù
), 
	`ulÚg
(
sig£t_size
)è-- 
size
 
is
 siz
of
 
sig£t
 
f›ld


668 
’d


670 -- 
š
 
VDSO
 
mªy
 
¬chs
, 
so
 
u£
 
ffi
 
¥“d
; 
TODO
 
»ad
 VDSO 
to
 
fšd
 
funùiÚs
 
th”e
, 
Ãeds
 
–f
 
»ad”


671 
	`pÿÎ
(
	$funùiÚ
(
k
è 
ffi
.
C
[k] 
’d
, "şock_g‘time"è
th’


672 
C
.
şock_g‘time
 = 
ffi
.C.clock_gettime

674 
funùiÚ
 
C
.
	$şock_g‘time
(
şk_id
, 
ts
è 
	`sysÿÎ
(
sys
.
şock_g‘time
, (şk_id), Ñs)è
’d


675 
’d


677 
C
.
g‘timeofday
 = 
ffi
.C.gettimeofday

678 --
funùiÚ
 
C
.
	$g‘timeofday
(
tv
, 
tz
è 
	`sysÿÎ
(
sys
.
g‘timeofday
, Ñv), Ñz)è
’d


680 -- 
glibc
 
dÛs
 
nÙ
 
´ovide
 
g‘ıu
; 
™
 
is
 
howev”
 
VDSO


681 
funùiÚ
 
C
.
	$g‘ıu
(
ıu
, 
node
, 
tÿche
è 
	`sysÿÎ
(
sys
.
g‘ıu
, (ıu), Òode), Ñÿche)è
’d


682 -- 
time
 
is
 
VDSO
 
but
 
nÙ
 
»®ly
 
³rfÜmªû
 
ü™iÿl
; 
dÛs
‚Ù 
exi¡
 
some
 
¬ch™eùu»s


683 
sys
.
time
 
th’


684 
funùiÚ
 
C
.
	$time
(
t
è 
	`sysÿÎ
(
sys
.
time
, Ñ)è
’d


685 
’d


687 -- 
bpf
 
sysÿÎ
 
th©
 
is
 
Úly
 
Ú
 
Lšux
 3.19+

688 
sys
.
bpf
 
th’


689 
funùiÚ
 
C
.
	$bpf
(
cmd
, 
©Œ
)

690  
	`sysÿÎ
(
sys
.
bpf
, (
cmd
), (
©Œ
), 
	`u64
(
ffi
.('union bpf_attr')))

691 
’d


692 
’d


693 
sys
.
³rf_ev’t_İ’
 
th’


694 
funùiÚ
 
C
.
	$³rf_ev’t_İ’
(
©Œ
, 
pid
, 
ıu
, 
group_fd
, 
æags
)

695  
	`sysÿÎ
(
sys
.
³rf_ev’t_İ’
, (
©Œ
), (
pid
), (
ıu
), (
group_fd
), 
	$ulÚg
(
æags
))

696 
’d


697 
’d


699 -- 
sock‘ÿÎs


700 
nÙ
 
sys
.
sock‘ÿÎ
 
th’


701 
funùiÚ
 
C
.
	$sock‘
(
domaš
, 

, 
´ÙocŞ
è 
	`sysÿÎ
(
sys
.
sock‘
, (domaš), Ñp), ÕrÙocŞ)è
’d


702 
funùiÚ
 
C
.
	$bšd
(
sockfd
, 
addr
, 
add¾’
è 
	`sysÿÎ
(
sys
.
bšd
, (sockfd), ×ddr), 
	$ušt
(
add¾’
)è
’d


703 
funùiÚ
 
C
.
	$cÚÃù
(
sockfd
, 
addr
, 
add¾’
è 
	`sysÿÎ
(
sys
.
cÚÃù
, (sockfd), ×ddr), 
	$ušt
(
add¾’
)è
’d


704 
funùiÚ
 
C
.
	$li¡’
(
sockfd
, 
backlog
è 
	`sysÿÎ
(
sys
.
li¡’
, (sockfd), (backlog)è
’d


705 
funùiÚ
 
C
.
	$acû±
(
sockfd
, 
addr
, 
add¾’
)

706  
	`sysÿÎ
(
sys
.
acû±
, (
sockfd
), (
addr
), (
add¾’
))

707 
’d


708 
funùiÚ
 
C
.
	$g‘sockÇme
(
sockfd
, 
addr
, 
add¾’
è 
	`sysÿÎ
(
sys
.
g‘sockÇme
, (sockfd), ×ddr), ×dd¾’)è
’d


709 
funùiÚ
 
C
.
	$g‘³”Çme
(
sockfd
, 
addr
, 
add¾’
è 
	`sysÿÎ
(
sys
.
g‘³”Çme
, (sockfd), ×ddr), ×dd¾’)è
’d


710 
funùiÚ
 
C
.
	$sock‘·œ
(
domaš
, 

, 
´ÙocŞ
, 
sv
è 
	`sysÿÎ
(
sys
.
sock‘·œ
, (domaš), Ñp), ÕrÙocŞ), (sv)è
’d


711 
funùiÚ
 
C
.
	$£nd
(
sockfd
, 
buf
, 
Ën
, 
æags
è 
	`sysÿÎ_lÚg
(
sys
.
£nd
, (sockfd), (buf), 
	`ulÚg
Ö’), (æags)è
’d


712 
funùiÚ
 
C
.
	$»cv
(
sockfd
, 
buf
, 
Ën
, 
æags
è 
	`sysÿÎ_lÚg
(
sys
.
»cv
, (sockfd), (buf), 
	`ulÚg
Ö’), (æags)è
’d


713 
funùiÚ
 
C
.
	$£ndto
(
sockfd
, 
buf
, 
Ën
, 
æags
, 
de¡_addr
, 
add¾’
)

714  
	`sysÿÎ_lÚg
(
sys
.
£ndto
, (
sockfd
), (
buf
), 
	`ulÚg
(
Ën
), (
æags
), (
de¡_addr
), 
	$ušt
(
add¾’
))

715 
’d


716 
funùiÚ
 
C
.
	$»cväom
(
sockfd
, 
buf
, 
Ën
, 
æags
, 
¤c_addr
, 
add¾’
)

717  
	`sysÿÎ_lÚg
(
sys
.
»cväom
, (
sockfd
), (
buf
), 
	`ulÚg
(
Ën
), (
æags
), (
¤c_addr
), (
add¾’
))

718 
’d


719 
funùiÚ
 
C
.
	$shutdown
(
sockfd
, 
how
è 
	`sysÿÎ
(
sys
.
shutdown
, (sockfd), (how)è
’d


720 
funùiÚ
 
C
.
	$£tsockİt
(
sockfd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)

721  
	`sysÿÎ
(
sys
.
£tsockİt
, (
sockfd
), (
Ëv–
), (
İŠame
), (
İtv®
), 
	$ušt
(
İ’
))

722 
’d


723 
funùiÚ
 
C
.
	$g‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)

724  
	`sysÿÎ
(
sys
.
g‘sockİt
, (
sockfd
), (
Ëv–
), (
İŠame
), (
İtv®
), (
İ’
))

725 
’d


726 
funùiÚ
 
C
.
	$£ndmsg
(
sockfd
, 
msg
, 
æags
è 
	`sysÿÎ_lÚg
(
sys
.
£ndmsg
, (sockfd), (msg), (æags)è
’d


727 
funùiÚ
 
C
.
	$»cvmsg
(
sockfd
, 
msg
, 
æags
è 
	`sysÿÎ_lÚg
(
sys
.
»cvmsg
, (sockfd), (msg), (æags)è
’d


728 
funùiÚ
 
C
.
	$acû±4
(
sockfd
, 
addr
, 
add¾’
, 
æags
)

729  
	`sysÿÎ
(
sys
.
acû±4
, (
sockfd
), (
addr
), (
add¾’
), (
æags
))

730 
’d


731 
funùiÚ
 
C
.
	$»cvmmsg
(
sockfd
, 
msgvec
, 
vËn
, 
æags
, 
timeout
)

732  
	`sysÿÎ
(
sys
.
»cvmmsg
, (
sockfd
), (
msgvec
), 
	`ušt
(
vËn
), (
æags
), (
timeout
))

733 
’d


734 
funùiÚ
 
C
.
	$£ndmmsg
(
sockfd
, 
msgvec
, 
vËn
, 
æags
)

735  
	`sysÿÎ
(
sys
.
£ndmmsg
, (
sockfd
), (
msgvec
), 
	`ušt
(
vËn
), (
æags
))

736 
’d


738 
funùiÚ
 
C
.
	$sock‘
(
domaš
, 

, 
´ÙocŞ
)

739 
loÿl
 
¬gs
 = 
	$lÚgs
(
domaš
, 

, 
´ÙocŞ
)

740  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SOCKET
), (
¬gs
))

741 
’d


742 
funùiÚ
 
C
.
	$bšd
(
sockfd
, 
addr
, 
add¾’
)

743 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
addr
), 
add¾’
)

744  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
BIND
), (
¬gs
))

745 
’d


746 
funùiÚ
 
C
.
	$cÚÃù
(
sockfd
, 
addr
, 
add¾’
)

747 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
addr
), 
add¾’
)

748  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
CONNECT
), (
¬gs
))

749 
’d


750 
funùiÚ
 
C
.
	$li¡’
(
sockfd
, 
backlog
)

751 
loÿl
 
¬gs
 = 
	$lÚgs
(
sockfd
, 
backlog
)

752  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
LISTEN
), (
¬gs
))

753 
’d


754 
funùiÚ
 
C
.
	$acû±
(
sockfd
, 
addr
, 
add¾’
)

755 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
addr
), (
add¾’
))

756  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
ACCEPT
), (
¬gs
))

757 
’d


758 
funùiÚ
 
C
.
	$g‘sockÇme
(
sockfd
, 
addr
, 
add¾’
)

759 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
addr
), (
add¾’
))

760  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
GETSOCKNAME
), (
¬gs
))

761 
’d


762 
funùiÚ
 
C
.
	$g‘³”Çme
(
sockfd
, 
addr
, 
add¾’
)

763 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
addr
), (
add¾’
))

764  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
GETPEERNAME
), (
¬gs
))

765 
’d


766 
funùiÚ
 
C
.
	$sock‘·œ
(
domaš
, 

, 
´ÙocŞ
, 
sv
)

767 
loÿl
 
¬gs
 = 
	`lÚgs
(
domaš
, 

, 
´ÙocŞ
, (
sv
))

768  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SOCKETPAIR
), (
¬gs
))

769 
’d


770 
funùiÚ
 
C
.
	$£nd
(
sockfd
, 
buf
, 
Ën
, 
æags
)

771 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
buf
), 
Ën
, 
æags
)

772  
	`sysÿÎ_lÚg
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SEND
), (
¬gs
))

773 
’d


774 
funùiÚ
 
C
.
	$»cv
(
sockfd
, 
buf
, 
Ën
, 
æags
)

775 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
buf
), 
Ën
, 
æags
)

776  
	`sysÿÎ_lÚg
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
RECV
), (
¬gs
))

777 
’d


778 
funùiÚ
 
C
.
	$£ndto
(
sockfd
, 
buf
, 
Ën
, 
æags
, 
de¡_addr
, 
add¾’
)

779 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
buf
), 
Ën
, 
æags
, (
de¡_addr
), 
add¾’
)

780  
	`sysÿÎ_lÚg
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SENDTO
), (
¬gs
))

781 
’d


782 
funùiÚ
 
C
.
	$»cväom
(
sockfd
, 
buf
, 
Ën
, 
æags
, 
¤c_addr
, 
add¾’
)

783 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
buf
), 
Ën
, 
æags
, (
¤c_addr
), (
add¾’
))

784  
	`sysÿÎ_lÚg
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
RECVFROM
), (
¬gs
))

785 
’d


786 
funùiÚ
 
C
.
	$shutdown
(
sockfd
, 
how
)

787 
loÿl
 
¬gs
 = 
	$lÚgs
(
sockfd
, 
how
)

788  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SHUTDOWN
), (
¬gs
))

789 
’d


790 
funùiÚ
 
C
.
	$£tsockİt
(
sockfd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)

791 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, 
Ëv–
, 
İŠame
, (
İtv®
), 
İ’
)

792  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SETSOCKOPT
), (
¬gs
))

793 
’d


794 
funùiÚ
 
C
.
	$g‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)

795 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, 
Ëv–
, 
İŠame
, (
İtv®
), (
İ’
))

796  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
GETSOCKOPT
), (
¬gs
))

797 
’d


798 
funùiÚ
 
C
.
	$£ndmsg
(
sockfd
, 
msg
, 
æags
)

799 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
msg
), 
æags
)

800  
	`sysÿÎ_lÚg
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SENDMSG
), (
¬gs
))

801 
’d


802 
funùiÚ
 
C
.
	$»cvmsg
(
sockfd
, 
msg
, 
æags
)

803 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
msg
), 
æags
)

804  
	`sysÿÎ_lÚg
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
RECVMSG
), (
¬gs
))

805 
’d


806 
funùiÚ
 
C
.
	$acû±4
(
sockfd
, 
addr
, 
add¾’
, 
æags
)

807 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
addr
), (
add¾’
), 
æags
)

808  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
ACCEPT4
), (
¬gs
))

809 
’d


810 
funùiÚ
 
C
.
	$»cvmmsg
(
sockfd
, 
msgvec
, 
vËn
, 
æags
, 
timeout
)

811 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
msgvec
), 
vËn
, 
æags
, (
timeout
))

812  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
RECVMMSG
), (
¬gs
))

813 
’d


814 
funùiÚ
 
C
.
	$£ndmmsg
(
sockfd
, 
msgvec
, 
vËn
, 
æags
)

815 
loÿl
 
¬gs
 = 
	`lÚgs
(
sockfd
, (
msgvec
), 
vËn
, 
æags
)

816  
	`sysÿÎ
(
sys
.
sock‘ÿÎ
, (
sock‘ÿÎs
.
SENDMMSG
), (
¬gs
))

817 
’d


818 
’d


820  
C


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/cgroup.lua

1 -- 
Lšux
 
cgroup
 
	gAPI


2 -- 
this
 
is
 
®l
 
fe
 
sy¡em
 
İ”©iÚs
 
·ckaged
 
up
 
to
 
be
 
—s›r
Ø
u£


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
funùiÚ
 
	$š™
(
S
)

13 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

14 
loÿl
 
¥l™
 = 
h
.split

16 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

17 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

19 
loÿl
 
ut
 = 
S
.util

21 
loÿl
 
cgroup
 = {
	}
}

23 
loÿl
 
funùiÚ
 
mkgroup
(
Çme
)

24 -- 
­³nd
  
loÿtiÚ
, 
should
 
be
 
tmpfs
 
mouÁ


25 
	gÇme
:
sub
(1, 1è~ğ"/" 
th’
  "/sys/fs/cgroup" .. 
Çme
 ‚am
’d


26 
’d


28 
funùiÚ
 
cgroup
.
	$mouÁ
(
b
)

29 
b
.
sourû
 =ab.sourû 
Ü
 "cgroup"

30 
b
.
ty³
 = "cgroup"

31 
b
.
rg‘
 = 
	$mkgroup
(
b
.
rg‘
)

32  
S
.
	$mouÁ
(
b
)

33 
’d


35 
funùiÚ
 
cgroup
.
	$cgroups
(
ps
)

36 
ps
 = 
	`to¡ršg
Õ 
Ü
 "self")

37 
loÿl
 
cgf
 = 
ut
.
	`»adfe
("/´oc/" .. 
ps
 .. "/cgroup")

38 
loÿl
 
lšes
 = 
	`¥l™
("\n", 
cgf
)

39 
loÿl
 
cgroups
 = {
	}
}

40 
i
 = 1, #lines - 1 do

41 
loÿl
 
	g·¹s
 = 
¥l™
Ğ":", 
lšes
[
i
])

42 
	gcgroups
[
·¹s
[1]] = {
Çme
 =…¬ts[2], 
	g·th
 =…arts[3]}

43 
’d


44  
cgroups


45 
’d


47  
cgroup


49 
’d


51  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/constants.lua

1 -- 
bËs
 
of
 
cÚ¡ªts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

14 
loÿl
 
tob™
 = 
b™
.tobit

16 
loÿl
 
¬ch
 = 
»quœe
("sysÿÎ.lšux." .. 
abi
.¬ch .. ".cÚ¡ªts"è-- 
¬ch™eùu»
 
¥ecific
 
code


18 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

20 
loÿl
 
où®
, 
	gmuÉiæags
, 
	gch¬æags
, 
	gsw­æags
, 
	g¡ræag
, 
	g©æag
, 
	gmodeæags


21 ğ
h
.
où®
, 
	gh
.
	gmuÉiæags
, h.
	gch¬æags
, h.
	gsw­æags
, h.
	g¡ræag
, h.
	g©æag
, h.
modeæags


23 
loÿl
 
funùiÚ
 
	$add¬ch
(
tb
, 
a
, )

24 
loÿl
 
add
 = 
a
 
Ü
 

25 
k
, 
v
 
š
 
	$·œs
(
add
èdØ
tb
[
k
] = 
v
 
’d


26 
’d


28 
loÿl
 
c
 = {
	}
}

30 
c
.
”rÜÇmes
 = 
»quœe
 "syscall.linux.errors"

32 
c
.
REG
 = 
¬ch
.REG

34 -- 
TODO
 
Úly
 
defše
 
Úe
 
of
 
the£


35 
c
.
STD
 = 
¡ræag
 {

36 
IN_FILENO
 = 0,

37 
	gOUT_FILENO
 = 1,

38 
	gERR_FILENO
 = 2,

39 
	gIN
 = 0,

40 
	gOUT
 = 1,

41 
	gERR
 = 2,

44 -- 
sizes


45 
	gc
.
	gPATH_MAX
 = 4096

47 -- 
İ’
, 
fú
 
TODO
 
nÙ
 
£‰šg
 
Ïrgefe
 
m©ches
 
exaùly
 
š
 
uµ”
 , 
pÙ’tŸÎy
 
cÚfusšg


48 
	gc
.
	gO
 = 
muÉiæags
(
¬ch
.
O
 
Ü
 {

49 
RDONLY
 = 
où®
('0000'),

50 
WRONLY
 = 
où®
('0001'),

51 
RDWR
 = 
où®
('0002'),

52 
ACCMODE
 = 
où®
('0003'),

53 
CREAT
 = 
où®
('0100'),

54 
EXCL
 = 
où®
('0200'),

55 
NOCTTY
 = 
où®
('0400'),

56 
TRUNC
 = 
où®
('01000'),

57 
APPEND
 = 
où®
('02000'),

58 
NONBLOCK
 = 
où®
('04000'),

59 
DSYNC
 = 
où®
('010000'),

60 
ASYNC
 = 
où®
('020000'),

61 
DIRECT
 = 
où®
('040000'),

62 
DIRECTORY
 = 
où®
('0200000'),

63 
NOFOLLOW
 = 
où®
('0400000'),

64 
NOATIME
 = 
où®
('01000000'),

65 
CLOEXEC
 = 
où®
('02000000'),

66 
SYNC
 = 
où®
('04010000'),

69 
	gc
.
	gO
.
	gFSYNC
 = 
c
.
O
.
SYNC


70 
c
.
O
.
RSYNC
 = c.O.
SYNC


71 
c
.
O
.
NDELAY
 = c.O.
NONBLOCK


73 
nÙ
 
c
.
O
.
LARGEFILE
 
th’
 -- 
®so
 
ÿn
 
be
 
¬ch
 
d•’d’t


74 
abi
.
abi32
 
th’
 
c
.
O
.
LARGEFILE
 = 
où®
('0100000'èc.O.LARGEFILE = 0 
’d


75 
’d


77 -- 
ju¡
 
pe2


78 
c
.
OPIPE
 = 
muÉiæags
 {

79 
NONBLOCK
 = 
c
.
O
.NONBLOCK,

80 
	gCLOEXEC
 = 
c
.
O
.
CLOEXEC
,

81 
	gDIRECT
 = 
c
.
O
.
DIRECT
,

84 -- 
mq_©Œ
 
NONBLOCK
 
Úly
 
æag
 
®lowed


85 
	gc
.
	gOMQATTR
 = 
muÉiæags
 {

86 
NONBLOCK
 = 
c
.
O
.NONBLOCK,

89 -- 
modes
 
ªd
 
fe
 
	gty³s
. 
nÙe
 
»Çmed
 
£cÚd
 
£t
 
äom
 
S_
 
to
 
MODE_
 
but
 
du¶iÿ‹d
 
š
 
S
 
¡©


90 
	gc
.
	gS_I
 = 
modeæags
 {

91 
FMT
 = 
où®
('0170000'),

92 
	gFSOCK
 = 
où®
('0140000'),

93 
	gFLNK
 = 
où®
('0120000'),

94 
	gFREG
 = 
où®
('0100000'),

95 
	gFBLK
 = 
où®
('0060000'),

96 
	gFDIR
 = 
où®
('0040000'),

97 
	gFCHR
 = 
où®
('0020000'),

98 
	gFIFO
 = 
où®
('0010000'),

99 
	gSUID
 = 
où®
('0004000'),

100 
	gSGID
 = 
où®
('0002000'),

101 
	gSVTX
 = 
où®
('0001000'),

102 
	gRWXU
 = 
où®
('00700'),

103 
	gRUSR
 = 
où®
('00400'),

104 
	gWUSR
 = 
où®
('00200'),

105 
	gXUSR
 = 
où®
('00100'),

106 
	gRWXG
 = 
où®
('00070'),

107 
	gRGRP
 = 
où®
('00040'),

108 
	gWGRP
 = 
où®
('00020'),

109 
	gXGRP
 = 
où®
('00010'),

110 
	gRWXO
 = 
où®
('00007'),

111 
	gROTH
 = 
où®
('00004'),

112 
	gWOTH
 = 
où®
('00002'),

113 
	gXOTH
 = 
où®
('00001'),

116 
	gc
.
	gMODE
 = 
modeæags
 {

117 
SUID
 = 
où®
('04000'),

118 
	gSGID
 = 
où®
('02000'),

119 
	gSVTX
 = 
où®
('01000'),

120 
	gRWXU
 = 
où®
('00700'),

121 
	gRUSR
 = 
où®
('00400'),

122 
	gWUSR
 = 
où®
('00200'),

123 
	gXUSR
 = 
où®
('00100'),

124 
	gRWXG
 = 
où®
('00070'),

125 
	gRGRP
 = 
où®
('00040'),

126 
	gWGRP
 = 
où®
('00020'),

127 
	gXGRP
 = 
où®
('00010'),

128 
	gRWXO
 = 
où®
('00007'),

129 
	gROTH
 = 
où®
('00004'),

130 
	gWOTH
 = 
où®
('00002'),

131 
	gXOTH
 = 
où®
('00001'),

134 -- 
acûss


135 
	gc
.
	gOK
 = 
ch¬æags
 {

136 
R
 = 4,

137 
	gW
 = 2,

138 
	gX
 = 1,

139 
	gF
 = 0,

142 -- 
fú


143 
	gc
.
	gF
 = 
¡ræag
(
¬ch
.
F
 
Ü
 {

144 
DUPFD
 = 0,

145 
GETFD
 = 1,

146 
SETFD
 = 2,

147 
GETFL
 = 3,

148 
SETFL
 = 4,

149 
GETLK
 = 5,

150 
SETLK
 = 6,

151 
SETLKW
 = 7,

152 
SETOWN
 = 8,

153 
GETOWN
 = 9,

154 
SETSIG
 = 10,

155 
GETSIG
 = 11,

156 
GETLK64
 = 12,

157 
SETLK64
 = 13,

158 
SETLKW64
 = 14,

159 
SETOWN_EX
 = 15,

160 
GETOWN_EX
 = 16,

161 
SETLEASE
 = 1024,

162 
GETLEASE
 = 1025,

163 
NOTIFY
 = 1026,

164 
SETPIPE_SZ
 = 1031,

165 
GETPIPE_SZ
 = 1032,

166 
DUPFD_CLOEXEC
 = 1030,

169 -- 
messy


170 
	gabi
.
abi64
 
th’


171 
	gc
.
	gF
.
	gGETLK64
 = 
c
.
F
.
GETLK


172 
c
.
F
.
SETLK64
 = c.F.
SETLK


173 
c
.
F
.
SETLKW64
 = c.F.
SETLKW


175 
c
.
F
.
GETLK
 = c.F.
GETLK64


176 
c
.
F
.
SETLK
 = c.F.
SETLK64


177 
c
.
F
.
SETLKW
 = c.F.
SETLKW64


178 
’d


180 
c
.
FD
 = 
muÉiæags
 {

181 
CLOEXEC
 = 1,

184 -- 
nÙe
 
chªged
 
äom
 
F_
 
to
 
FCNTL_LOCK


185 
	gc
.
	gFCNTL_LOCK
 = 
¡ræag
 {

186 
RDLCK
 = 0,

187 
	gWRLCK
 = 1,

188 
	gUNLCK
 = 2,

191 -- 
	glockf
, 
chªged
 
äom
 
F_
 
to
 
LOCKF_


192 
	gc
.
	gLOCKF
 = 
¡ræag
 {

193 
ULOCK
 = 0,

194 
	gLOCK
 = 1,

195 
	gTLOCK
 = 2,

196 
	gTEST
 = 3,

199 -- 
	$æock
 (2)

200 
c
.
LOCK
 = 
muÉiæags
 {

201 
SH
 = 1,

202 
EX
 = 2,

203 
NB
 = 4,

204 
UN
 = 8,

205 
MAND
 = 32,

206 
READ
 = 64,

207 
WRITE
 = 128,

208 
RW
 = 192,

209 
	}
}

211 --
mm­


212 
	gc
.
	gPROT
 = 
muÉiæags
 {

213 
NONE
 = 0x0,

214 
	gREAD
 = 0x1,

215 
	gWRITE
 = 0x2,

216 
	gEXEC
 = 0x4,

217 
	gGROWSDOWN
 = 0x01000000,

218 
	gGROWSUP
 = 0x02000000,

221 
add¬ch
(
c
.
PROT
, 
¬ch
.PROT, {})

223 -- 
Sh¬šg
 
ty³s


224 
	gc
.
	gMAP
 = 
muÉiæags
(
¬ch
.
MAP
 
Ü
 {

225 
FILE
 = 0,

226 
SHARED
 = 0x01,

227 
PRIVATE
 = 0x02,

228 
TYPE
 = 0x0f,

229 
FIXED
 = 0x10,

230 
ANONYMOUS
 = 0x20,

231 
GROWSDOWN
 = 0x00100,

232 
DENYWRITE
 = 0x00800,

233 
EXECUTABLE
 = 0x01000,

234 
LOCKED
 = 0x02000,

235 
NORESERVE
 = 0x04000,

236 
POPULATE
 = 0x08000,

237 
NONBLOCK
 = 0x10000,

238 
STACK
 = 0x20000,

239 
HUGETLB
 = 0x40000,

242 
	gabi
.
abi64
 
th’
 
	gc
.
	gMAP
["32BIT"] = 0x40 
’d


244 
c
.
MAP
.
ANON
 = c.MAP.
ANONYMOUS


246 -- 
æags
 `
mlock®l
'.

247 
c
.
MCL
 = 
¡ræag
 (
¬ch
.MCL 
Ü
 {

248 
CURRENT
 = 1,

249 
FUTURE
 = 2,

252 -- 
æags
 `
	gm»m­
'.

253 
	gc
.
	gMREMAP
 = 
muÉiæags
 {

254 
MAYMOVE
 = 1,

255 
	gFIXED
 = 2,

258 -- 
madvi£
 
adviû
 
·¿m‘”


259 
	gc
.
	gMADV
 = 
¡ræag
 {

260 
NORMAL
 = 0,

261 
	gRANDOM
 = 1,

262 
	gSEQUENTIAL
 = 2,

263 
	gWILLNEED
 = 3,

264 
	gDONTNEED
 = 4,

265 
	gREMOVE
 = 9,

266 
	gDONTFORK
 = 10,

267 
	gDOFORK
 = 11,

268 
	gMERGEABLE
 = 12,

269 
	gUNMERGEABLE
 = 13,

270 
	gHUGEPAGE
 = 14,

271 
	gNOHUGEPAGE
 = 15,

272 
	gHWPOISON
 = 100,

275 -- 
posix
 
çdvi£


276 
	gc
.
	gPOSIX_FADV
 = 
¡ræag
 {

277 
NORMAL
 = 0,

278 
	gRANDOM
 = 1,

279 
	gSEQUENTIAL
 = 2,

280 
	gWILLNEED
 = 3,

281 
	gDONTNEED
 = 4,

282 
	gNOREUSE
 = 5,

285 -- 
çÎoÿ‹


286 
	gc
.
	gFALLOC_FL
 = 
¡ræag
 {

287 
KEEP_SIZE
 = 0x01,

288 
	gPUNCH_HOLE
 = 0x02,

291 -- 
	gg‘´iÜ™y
, 
£riÜ™y
 
æags


292 
	gc
.
	gPRIO
 = 
¡ræag
 {

293 
PROCESS
 = 0,

294 
	gPGRP
 = 1,

295 
	gUSER
 = 2,

298 -- 
l£ek


299 
	gc
.
	gSEEK
 = 
¡ræag
 {

300 
SET
 = 0,

301 
	gCUR
 = 1,

302 
	gEND
 = 2,

305 -- 
ex™


306 
	gc
.
	gEXIT
 = 
¡ræag
 {

307 
SUCCESS
 = 0,

308 
	gFAILURE
 = 1,

311 -- 
	gsigaùiÚ
, 
nÙe
 
»Çmed
 
SIGACT
 
äom
 
SIG_


312 
	gc
.
	gSIGACT
 = 
¡ræag
 {

313 
ERR
 = -1,

314 
	gDFL
 = 0,

315 
	gIGN
 = 1,

316 
	gHOLD
 = 2,

319 
	gc
.
	gSIGEV
 = 
¡ræag
 {

320 
SIGNAL
 = 0,

321 
	gNONE
 = 1,

322 
	gTHREAD
 = 2,

323 
	gTHREAD_ID
 = 4,

326 
	gc
.
	gSIG
 = 
¡ræag
(
¬ch
.
SIG
 
Ü
 {

327 
HUP
 = 1,

328 
INT
 = 2,

329 
QUIT
 = 3,

330 
ILL
 = 4,

331 
TRAP
 = 5,

332 
ABRT
 = 6,

333 
BUS
 = 7,

334 
FPE
 = 8,

335 
KILL
 = 9,

336 
USR1
 = 10,

337 
SEGV
 = 11,

338 
USR2
 = 12,

339 
PIPE
 = 13,

340 
ALRM
 = 14,

341 
TERM
 = 15,

342 
STKFLT
 = 16,

343 
CHLD
 = 17,

344 
CONT
 = 18,

345 
STOP
 = 19,

346 
TSTP
 = 20,

347 
TTIN
 = 21,

348 
TTOU
 = 22,

349 
URG
 = 23,

350 
XCPU
 = 24,

351 
XFSZ
 = 25,

352 
VTALRM
 = 26,

353 
PROF
 = 27,

354 
WINCH
 = 28,

355 
IO
 = 29,

356 
PWR
 = 30,

357 
SYS
 = 31,

360 
	gc
.
	gSIG
.
	gIOT
 = 
c
.
SIG
.
ABRT


361 --
c
.
SIG
.
UNUSED
 = 31 -- 
TODO
 
this
 
looks
 
¬ch
 
d•’d’t


362 
c
.
SIG
.
CLD
 = c.SIG.
CHLD


363 
c
.
SIG
.
POLL
 = c.SIG.
IO


365 -- 
sig´ocmask
 
nÙe
 
»Çmšg
 
of
 
SIG
 
to
 
SIGPM


366 
c
.
SIGPM
 = 
¡ræag
(
¬ch
.SIGPM 
Ü
 {

367 
BLOCK
 = 0,

368 
UNBLOCK
 = 1,

369 
SETMASK
 = 2,

372 -- 
sigÇlfd


373 
	gc
.
	gSFD
 = 
muÉiæags
(
¬ch
.
SFD
 
Ü
 {

374 
CLOEXEC
 = 
où®
('02000000'),

375 
NONBLOCK
 = 
où®
('04000'),

378 -- 
sock‘s
 
nÙe
 
mix
 
of
 
sšgË
 
ªd
 
muÉË
 
æags
 
TODO
 
code
 
to
 
hªdË
 
‹mpÜ¬y
 
usšg
 
muÉi
 
which
 
is
 
kšd
 oà
ok


379 
	gc
.
	gSOCK
 = 
muÉiæags
(
¬ch
.
SOCK
 
Ü
 {

380 
STREAM
 = 1,

381 
DGRAM
 = 2,

382 
RAW
 = 3,

383 
RDM
 = 4,

384 
SEQPACKET
 = 5,

385 
DCCP
 = 6,

386 
PACKET
 = 10,

388 
CLOEXEC
 = 
où®
('02000000'),

389 
NONBLOCK
 = 
où®
('04000'),

392 -- 
misc
 
sock‘
 
cÚ¡ªts


393 
	gc
.
	gSCM
 = 
¡ræag
 {

394 
RIGHTS
 = 0x01,

395 
	gCREDENTIALS
 = 0x02,

398 -- 
£tsockİt


399 
	gc
.
	gSOL
 = 
¡ræag
 {

400 
IP
 = 0,

401 
	gIPV6
 = 41,

402 
	gICMPV6
 = 58,

403 
	gRAW
 = 255,

404 
	gDECNET
 = 261,

405 
	gX25
 = 262,

406 
	gPACKET
 = 263,

407 
	gATM
 = 264,

408 
	gAAL
 = 265,

409 
	gIRDA
 = 266,

412 
	g¬ch
.
SOLSOCKET
 
th’
 
	gc
.
	gSOL
.
	gSOCKET
 = 
¬ch
.SOLSOCKET 
c
.
SOL
.
SOCKET
 = 1 
’d


414 
c
.
SO
 = 
¡ræag
(
¬ch
.SO 
Ü
 {

415 
DEBUG
 = 1,

416 
REUSEADDR
 = 2,

417 
TYPE
 = 3,

418 
ERROR
 = 4,

419 
DONTROUTE
 = 5,

420 
BROADCAST
 = 6,

421 
SNDBUF
 = 7,

422 
RCVBUF
 = 8,

423 
KEEPALIVE
 = 9,

424 
OOBINLINE
 = 10,

425 
NO_CHECK
 = 11,

426 
PRIORITY
 = 12,

427 
LINGER
 = 13,

428 
BSDCOMPAT
 = 14,

429 
REUSEPORT
 = 15, -- 
Ãw
, 
may
 
nÙ
 
be
 
defšed
 
y‘


430 
PASSCRED
 = 16,

431 
PEERCRED
 = 17,

432 
RCVLOWAT
 = 18,

433 
SNDLOWAT
 = 19,

434 
RCVTIMEO
 = 20,

435 
SNDTIMEO
 = 21,

436 
SECURITY_AUTHENTICATION
 = 22,

437 
SECURITY_ENCRYPTION_TRANSPORT
 = 23,

438 
SECURITY_ENCRYPTION_NETWORK
 = 24,

439 
BINDTODEVICE
 = 25,

440 
ATTACH_FILTER
 = 26,

441 
DETACH_FILTER
 = 27,

442 
PEERNAME
 = 28,

443 
TIMESTAMP
 = 29,

444 
ACCEPTCONN
 = 30,

445 
PEERSEC
 = 31,

446 
SNDBUFFORCE
 = 32,

447 
RCVBUFFORCE
 = 33,

448 
PASSSEC
 = 34,

449 
TIMESTAMPNS
 = 35,

450 
MARK
 = 36,

451 
TIMESTAMPING
 = 37,

452 
PROTOCOL
 = 38,

453 
DOMAIN
 = 39,

454 
RXQ_OVFL
 = 40,

455 
WIFI_STATUS
 = 41,

456 
PEEK_OFF
 = 42,

457 
NOFCS
 = 43,

458 
LOCK_FILTER
 = 44,

459 
SELECT_ERR_QUEUE
 = 45,

460 
BUSY_POLL
 = 46,

461 
MAX_PACING_RATE
 = 47,

462 
BPF_EXTENSIONS
 = 48,

463 
INCOMING_CPU
 = 49,

464 
ATTACH_BPF
 = 50,

465 
ATTACH_REUSEPORT_CBPF
 = 51,

466 
ATTACH_REUSEPORT_EBPF
 = 52,

469 
	gc
.
	gSO
.
	gGET_FILTER
 = 
c
.
SO
.
ATTACH_FILTER


470 
c
.
SO
.
DETACH_BPF
 = c.SO.
DETACH_FILTER


472 -- 
Maximum
 
queue
 
Ëngth
 
¥ecifŸbË
 
by
 
li¡’
.

473 
c
.
SOMAXCONN
 = 128

475 -- 
shutdown


476 
c
.
SHUT
 = 
¡ræag
 {

477 
RD
 = 0,

478 
	gWR
 = 1,

479 
	gRDWR
 = 2,

482 -- 
	gwa™pid
 3
rd
 
¬g


483 
	gc
.
	gW
 = 
muÉiæags
 {

484 
NOHANG
 = 1,

485 
	gUNTRACED
 = 2,

486 
	gEXITED
 = 4,

487 
	gCONTINUED
 = 8,

488 
	gNOWAIT
 = 0x01000000,

489 
	gNOTHREAD
 = 0x20000000, -- 
__WNOTHREAD


490 
	gALL
 = 0x40000000, -- 
__WALL


491 
	gCLONE
 = 0x80000000, -- 
	g__WCLONE


494 
	gc
.
	gW
.
	gSTOPPED
 = 
c
.
W
.
UNTRACED


496 -- 
wa™id


497 
c
.
P
 = 
¡ræag
{

498 
ALL
 = 0,

499 
	gPID
 = 1,

500 
	gPGID
 = 2,

503 -- 
	gsigšfo
, 
eg
 
wa™id


504 
	gc
.
	gSI
 = 
¡ræag
(
¬ch
.
SI
 
Ü
 {

505 
ASYNCNL
 = -60,

506 
TKILL
 = -6,

507 
SIGIO
 = -5,

508 
ASYNCIO
 = -4,

509 
MESGQ
 = -3,

510 
TIMER
 = -2,

511 
QUEUE
 = -1,

512 
USER
 = 0,

513 
KERNEL
 = 0x80,

516 -- 
nÙe
 
»Çmed
 
ILL
 
to
 
SIGILL
 
‘c
 
as
 
POLL
 
şashes


518 
	gc
.
	gSIGILL
 = 
¡ræag
 {

519 
ILLOPC
 = 1,

520 
	gILLOPN
 = 2,

521 
	gILLADR
 = 3,

522 
	gILLTRP
 = 4,

523 
	gPRVOPC
 = 5,

524 
	gPRVREG
 = 6,

525 
	gCOPROC
 = 7,

526 
	gBADSTK
 = 8,

529 
	gc
.
	gSIGFPE
 = 
¡ræag
 {

530 
INTDIV
 = 1,

531 
	gINTOVF
 = 2,

532 
	gFLTDIV
 = 3,

533 
	gFLTOVF
 = 4,

534 
	gFLTUND
 = 5,

535 
	gFLTRES
 = 6,

536 
	gFLTINV
 = 7,

537 
	gFLTSUB
 = 8,

540 
	gc
.
	gSIGSEGV
 = 
¡ræag
 {

541 
MAPERR
 = 1,

542 
	gACCERR
 = 2,

545 
	gc
.
	gSIGBUS
 = 
¡ræag
 {

546 
ADRALN
 = 1,

547 
	gADRERR
 = 2,

548 
	gOBJERR
 = 3,

551 
	gc
.
	gSIGTRAP
 = 
¡ræag
 {

552 
BRKPT
 = 1,

553 
	gTRACE
 = 2,

556 
	gc
.
	gSIGCLD
 = 
¡ræag
 {

557 
EXITED
 = 1,

558 
	gKILLED
 = 2,

559 
	gDUMPED
 = 3,

560 
	gTRAPPED
 = 4,

561 
	gSTOPPED
 = 5,

562 
	gCONTINUED
 = 6,

565 
	gc
.
	gSIGPOLL
 = 
¡ræag
 {

566 
IN
 = 1,

567 
	gOUT
 = 2,

568 
	gMSG
 = 3,

569 
	gERR
 = 4,

570 
	gPRI
 = 5,

571 
	gHUP
 = 6,

574 -- 
	gsigaùiÚ
 -- 
nÙe
 
nÙ
 
ÿ¡
 
	$to
 (*)(è
as
 
we
 dØ
nÙ
 
know
 
ty³
 
h”e


575 
c
.
SA
 = 
	`muÉiæags
(
¬ch
.SA 
Ü
 {

576 
NOCLDSTOP
 = 0x00000001,

577 
NOCLDWAIT
 = 0x00000002,

578 
SIGINFO
 = 0x00000004,

579 
ONSTACK
 = 0x08000000,

580 
RESTART
 = 0x10000000,

581 
NODEFER
 = 0x40000000,

582 
RESETHAND
 = 0x80000000,

583 
RESTORER
 = 0x04000000,

584 
	}
})

586 
	gc
.
	gSA
.
	gNOMASK
 = 
c
.
SA
.
NODEFER


587 
c
.
SA
.
ONESHOT
 = c.SA.
RESETHAND


589 -- 
tim”s


590 
c
.
ITIMER
 = 
¡ræag
 {

591 
REAL
 = 0,

592 
	gVIRTUAL
 = 1,

593 
	gPROF
 = 2,

596 -- 
şocks


597 
	gc
.
	gCLOCK
 = 
¡ræag
 {

598 
REALTIME
 = 0,

599 
	gMONOTONIC
 = 1,

600 
	gPROCESS_CPUTIME_ID
 = 2,

601 
	gTHREAD_CPUTIME_ID
 = 3,

602 
	gMONOTONIC_RAW
 = 4,

603 
	gREALTIME_COARSE
 = 5,

604 
	gMONOTONIC_COARSE
 = 6,

607 
	gc
.
	gTIMER
 = 
¡ræag
 {

608 
ABSTIME
 = 1,

611 -- 
adjtimex


612 
	gc
.
	gADJ
 = 
muÉiæags
 {

613 
OFFSET
 = 0x0001,

614 
	gFREQUENCY
 = 0x0002,

615 
	gMAXERROR
 = 0x0004,

616 
	gESTERROR
 = 0x0008,

617 
	gSTATUS
 = 0x0010,

618 
	gTIMECONST
 = 0x0020,

619 
	gTAI
 = 0x0080,

620 
	gMICRO
 = 0x1000,

621 
	gNANO
 = 0x2000,

622 
	gTICK
 = 0x4000,

623 
	gOFFSET_SINGLESHOT
 = 0x8001,

624 
	gOFFSET_SS_READ
 = 0xa001,

627 
	gc
.
	gSTA
 = 
muÉiæags
 {

628 
PLL
 = 0x0001,

629 
	gPPSFREQ
 = 0x0002,

630 
	gPPSTIME
 = 0x0004,

631 
	gFLL
 = 0x0008,

632 
	gINS
 = 0x0010,

633 
	gDEL
 = 0x0020,

634 
	gUNSYNC
 = 0x0040,

635 
	gFREQHOLD
 = 0x0080,

636 
	gPPSSIGNAL
 = 0x0100,

637 
	gPPSJITTER
 = 0x0200,

638 
	gPPSWANDER
 = 0x0400,

639 
	gPPSERROR
 = 0x0800,

640 
	gCLOCKERR
 = 0x1000,

641 
	gNANO
 = 0x2000,

642 
	gMODE
 = 0x4000,

643 
	gCLK
 = 0x8000,

646 --  
v®ues
 
adjtimex


647 
	gc
.
	gTIME
 = 
¡ræag
 {

648 
OK
 = 0,

649 
	gINS
 = 1,

650 
	gDEL
 = 2,

651 
	gOOP
 = 3,

652 
	gWAIT
 = 4,

653 
	gERROR
 = 5,

656 
	gc
.
	gTIME
.
	gBAD
 = 
c
.
TIME
.
ERROR


658 -- 
x©Œ
; 
defšed
 
as
 
muÉi
 
	gas
 0 
is
 , 
ev’
 
though
 
bÙh
 
æags
 
makes
 
no
 
£n£


659 
	gc
.
	gXATTR
 = 
muÉiæags
 {

660 
CREATE
 = 1,

661 
	gREPLACE
 = 2,

664 -- 
utime


665 
	gc
.
	gUTIME
 = 
¡ræag
 {

666 
NOW
 = 
b™
.
lshiá
(1, 30) - 1,

667 
	gOMIT
 = 
b™
.
lshiá
(1, 30) - 2,

670 
	gc
.
	gAT_FDCWD
 = 
©æag
 {

671 
FDCWD
 = -100,

674 -- 
nÙ
 
®l
 
combš©iÚs
 
v®id


675 
	gc
.
	gAT
 = 
muÉiæags
 {

676 
SYMLINK_NOFOLLOW
 = 0x100,

677 
	gREMOVEDIR
 = 0x200,

678 
	gEACCESS
 = 0x200,

679 
	gSYMLINK_FOLLOW
 = 0x400,

680 
	gNO_AUTOMOUNT
 = 0x800,

681 
	gEMPTY_PATH
 = 0x1000,

684 -- 
	g£nd
, 
»cv
 
‘c


685 
	gc
.
	gMSG
 = 
muÉiæags
 {

686 
OOB
 = 0x01,

687 
	gPEEK
 = 0x02,

688 
	gDONTROUTE
 = 0x04,

689 
	gCTRUNC
 = 0x08,

690 
	gPROXY
 = 0x10,

691 
	gTRUNC
 = 0x20,

692 
	gDONTWAIT
 = 0x40,

693 
	gEOR
 = 0x80,

694 
	gWAITALL
 = 0x100,

695 
	gFIN
 = 0x200,

696 
	gSYN
 = 0x400,

697 
	gCONFIRM
 = 0x800,

698 
	gRST
 = 0x1000,

699 
	gERRQUEUE
 = 0x2000,

700 
	gNOSIGNAL
 = 0x4000,

701 
	gMORE
 = 0x8000,

702 
	gWAITFORONE
 = 0x10000,

703 
	gCMSG_CLOEXEC
 = 0x40000000,

706 
	gc
.
	gMSG
.
	gTRYHARD
 = 
c
.
MSG
.
DONTROUTE


708 -- 
¾im™


709 
c
.
RLIMIT
 = 
¡ræag
(
¬ch
.RLIMIT 
Ü
 {

710 
CPU
 = 0,

711 
FSIZE
 = 1,

712 
DATA
 = 2,

713 
STACK
 = 3,

714 
CORE
 = 4,

715 
RSS
 = 5,

716 
NPROC
 = 6,

717 
NOFILE
 = 7,

718 
MEMLOCK
 = 8,

719 
AS
 = 9,

720 
LOCKS
 = 10,

721 
SIGPENDING
 = 11,

722 
MSGQUEUE
 = 12,

723 
NICE
 = 13,

724 
RTPRIO
 = 14,

725 
RTTIME
 = 15,

728 
	gc
.
	gRLIMIT
.
	gOFILE
 = 
c
.
RLIMIT
.
NOFILE


730 
c
.
RLIM
 = 
¡ræag
 {

731 
INFINITY
 = 
h
.
ušt64_max
,

734 -- 
tim”fd


735 
	gc
.
	gTFD
 = 
muÉiæags
(
¬ch
.
TFD
 
Ü
 {

736 
CLOEXEC
 = 
où®
("02000000"),

737 
NONBLOCK
 = 
où®
("04000"),

740 
	gc
.
	gTFD_TIMER
 = 
¡ræag
 {

741 
ABSTIME
 = 1,

742 
	gCANCEL_ON_SET
 = 2,

745 -- 
pŞl


746 
	gc
.
	gPOLL
 = 
muÉiæags
(
¬ch
.
POLL
 
Ü
 {

747 
IN
 = 0x001,

748 
PRI
 = 0x002,

749 
OUT
 = 0x004,

750 
ERR
 = 0x008,

751 
HUP
 = 0x010,

752 
NVAL
 = 0x020,

753 
RDNORM
 = 0x040,

754 
RDBAND
 = 0x080,

755 
WRNORM
 = 0x100,

756 
WRBAND
 = 0x200,

757 
MSG
 = 0x400,

758 
REMOVE
 = 0x1000,

759 
RDHUP
 = 0x2000,

762 -- 
•Şl
 
»Çmed
 
äom
 
EPOLL_
 
to
 
EPOLLCREATE


763 
	gc
.
	gEPOLLCREATE
 = 
muÉiæags
 {

764 
CLOEXEC
 = 
où®
("02000000"),

765 
	gNONBLOCK
 = 
où®
("04000"),

768 
	gc
.
	gEPOLL
 = 
muÉiæags
 {

769 
IN
 = 0x001,

770 
	gPRI
 = 0x002,

771 
	gOUT
 = 0x004,

772 
	gRDNORM
 = 0x040,

773 
	gRDBAND
 = 0x080,

774 
	gWRNORM
 = 0x100,

775 
	gWRBAND
 = 0x200,

776 
	gMSG
 = 0x400,

777 
	gERR
 = 0x008,

778 
	gHUP
 = 0x010,

779 
	gRDHUP
 = 0x2000,

780 
	gONESHOT
 = 
b™
.
lshiá
(1, 30),

781 
	gET
 = 
b™
.
lshiá
(1, 30è* 2, -- 2^31 
but
 
makšg
 
su»
 
no
 
sign
 
	gissue


784 
	gc
.
	gEPOLL_CTL
 = 
¡ræag
 {

785 
ADD
 = 1,

786 
	gDEL
 = 2,

787 
	gMOD
 = 3,

790 -- 
¥liû
 
‘c


791 
	gc
.
	gSPLICE_F
 = 
muÉiæags
 {

792 
MOVE
 = 1,

793 
	gNONBLOCK
 = 2,

794 
	gMORE
 = 4,

795 
	gGIFT
 = 8,

798 -- 
	gaio
 - 
	g£e
 /
	gu¤
/
	gšşude
/
	glšux
/
	gaio_abi
.
h


799 
	gc
.
	gIOCB_CMD
 = 
¡ræag
 {

800 
PREAD
 = 0,

801 
	gPWRITE
 = 1,

802 
	gFSYNC
 = 2,

803 
	gFDSYNC
 = 3,

804 -- 
	gPREADX
 = 4,

805 -- 
	gPOLL
 = 5,

806 
	gNOOP
 = 6,

807 
	gPREADV
 = 7,

808 
	gPWRITEV
 = 8,

811 
	gc
.
	gIOCB_FLAG
 = 
¡ræag
 {

812 
RESFD
 = 1,

815 -- 
fe
 
ty³s
 
š
 
dœeùÜy


816 
	gc
.
	gDT
 = 
¡ræag
 {

817 
UNKNOWN
 = 0,

818 
	gFIFO
 = 1,

819 
	gCHR
 = 2,

820 
	gDIR
 = 4,

821 
	gBLK
 = 6,

822 
	gREG
 = 8,

823 
	gLNK
 = 10,

824 
	gSOCK
 = 12,

825 
	gWHT
 = 14,

828 -- 
sync
 
fe
 
¿nge


829 
	gc
.
	gSYNC_FILE_RANGE
 = 
muÉiæags
 {

830 
WAIT_BEFORE
 = 1,

831 
	gWRITE
 = 2,

832 
	gWAIT_AFTER
 = 4,

835 -- 
Ãšk


836 
	gc
.
	gNETLINK
 = 
¡ræag
 {

837 
ROUTE
 = 0,

838 
	gUNUSED
 = 1,

839 
	gUSERSOCK
 = 2,

840 
	gFIREWALL
 = 3,

841 
	gINET_DIAG
 = 4,

842 
	gNFLOG
 = 5,

843 
	gXFRM
 = 6,

844 
	gSELINUX
 = 7,

845 
	gISCSI
 = 8,

846 
	gAUDIT
 = 9,

847 
	gFIB_LOOKUP
 = 10,

848 
	gCONNECTOR
 = 11,

849 
	gNETFILTER
 = 12,

850 
	gIP6_FW
 = 13,

851 
	gDNRTMSG
 = 14,

852 
	gKOBJECT_UEVENT
= 15,

853 
	gGENERIC
 = 16,

854 
	gSCSITRANSPORT
 = 18,

855 
	gECRYPTFS
 = 19,

858 -- 
£e
 
mª
 
	$Ãšk
(7è
d‘as
. 
NÙe
 
us
 
of
 
æags
 
by
 
cÚ‹xt


859 
c
.
NLM_F
 = 
muÉiæags
 {

860 
REQUEST
 = 1,

861 
MULTI
 = 2,

862 
ACK
 = 4,

863 
ECHO
 = 8,

864 -- 
GET


865 
ROOT
 = 0x100,

866 
MATCH
 = 0x200,

867 
ATOMIC
 = 0x400,

868 -- 
NEW


869 
REPLACE
 = 0x100,

870 
EXCL
 = 0x200,

871 
CREATE
 = 0x400,

872 
APPEND
 = 0x800,

873 
	}
}

875 
	gc
.
	gNLM_F
.
	gDUMP
 = 
b™
.
bÜ
(
c
.
NLM_F
.
ROOT
, c.NLM_F.
MATCH
)

877 -- 
g’”ic
 
	gty³s
. 
The£
 
¬e
 
·¹
 
of
 
§me
 
£qu’û
 
as
 
RTM


878 
	gc
.
	gNLMSG
 = 
¡ræag
{

879 
NOOP
 = 0x1,

880 
	gERROR
 = 0x2,

881 
	gDONE
 = 0x3,

882 
	gOVERRUN
 = 0x4,

885 -- 
routšg


886 
	gc
.
	gRTM
 = 
¡ræag
 {

887 
NEWLINK
 = 16,

888 
	gDELLINK
 = 17,

889 
	gGETLINK
 = 18,

890 
	gSETLINK
 = 19,

891 
	gNEWADDR
 = 20,

892 
	gDELADDR
 = 21,

893 
	gGETADDR
 = 22,

894 
	gNEWROUTE
 = 24,

895 
	gDELROUTE
 = 25,

896 
	gGETROUTE
 = 26,

897 
	gNEWNEIGH
 = 28,

898 
	gDELNEIGH
 = 29,

899 
	gGETNEIGH
 = 30,

900 
	gNEWRULE
 = 32,

901 
	gDELRULE
 = 33,

902 
	gGETRULE
 = 34,

903 
	gNEWQDISC
 = 36,

904 
	gDELQDISC
 = 37,

905 
	gGETQDISC
 = 38,

906 
	gNEWTCLASS
 = 40,

907 
	gDELTCLASS
 = 41,

908 
	gGETTCLASS
 = 42,

909 
	gNEWTFILTER
 = 44,

910 
	gDELTFILTER
 = 45,

911 
	gGETTFILTER
 = 46,

912 
	gNEWACTION
 = 48,

913 
	gDELACTION
 = 49,

914 
	gGETACTION
 = 50,

915 
	gNEWPREFIX
 = 52,

916 
	gGETMULTICAST
 = 58,

917 
	gGETANYCAST
 = 62,

918 
	gNEWNEIGHTBL
 = 64,

919 
	gGETNEIGHTBL
 = 66,

920 
	gSETNEIGHTBL
 = 67,

921 
	gNEWNDUSEROPT
 = 68,

922 
	gNEWADDRLABEL
 = 72,

923 
	gDELADDRLABEL
 = 73,

924 
	gGETADDRLABEL
 = 74,

925 
	gGETDCB
 = 78,

926 
	gSETDCB
 = 79,

929 -- 
	glšux
/
	gif_lšc
.
h


930 
	gc
.
	gIFLA
 = 
¡ræag
 {

931 
UNSPEC
 = 0,

932 
	gADDRESS
 = 1,

933 
	gBROADCAST
 = 2,

934 
	gIFNAME
 = 3,

935 
	gMTU
 = 4,

936 
	gLINK
 = 5,

937 
	gQDISC
 = 6,

938 
	gSTATS
 = 7,

939 
	gCOST
 = 8,

940 
	gPRIORITY
 = 9,

941 
	gMASTER
 = 10,

942 
	gWIRELESS
 = 11,

943 
	gPROTINFO
 = 12,

944 
	gTXQLEN
 = 13,

945 
	gMAP
 = 14,

946 
	gWEIGHT
 = 15,

947 
	gOPERSTATE
 = 16,

948 
	gLINKMODE
 = 17,

949 
	gLINKINFO
 = 18,

950 
	gNET_NS_PID
= 19,

951 
	gIFALIAS
 = 20,

952 
	gNUM_VF
 = 21,

953 
	gVFINFO_LIST
 = 22,

954 
	gSTATS64
 = 23,

955 
	gVF_PORTS
 = 24,

956 
	gPORT_SELF
 = 25,

957 
	gAF_SPEC
 = 26,

958 
	gGROUP
 = 27,

959 
	gNET_NS_FD
 = 28,

962 
	gc
.
	gIFLA_INET
 = 
¡ræag
 {

963 
UNSPEC
 = 0,

964 
	gCONF
 = 1,

967 
	gc
.
	gIFLA_INET6
 = 
¡ræag
 {

968 
UNSPEC
 = 0,

969 
	gFLAGS
 = 1,

970 
	gCONF
 = 2,

971 
	gSTATS
 = 3,

972 
	gMCAST
 = 4,

973 
	gCACHEINFO
 = 5,

974 
	gICMP6STATS
 = 6,

977 
	gc
.
	gIFLA_INFO
 = 
¡ræag
 {

978 
UNSPEC
 = 0,

979 
	gKIND
 = 1,

980 
	gDATA
 = 2,

981 
	gXSTATS
 = 3,

984 
	gc
.
	gIFLA_VLAN
 = 
¡ræag
 {

985 
UNSPEC
 = 0,

986 
	gID
 = 1,

987 
	gFLAGS
 = 2,

988 
	gEGRESS_QOS
 = 3,

989 
	gINGRESS_QOS
 = 4,

992 
	gc
.
	gIFLA_VLAN_QOS
 = 
¡ræag
 {

993 
UNSPEC
 = 0,

994 
	gMAPPING
 = 1,

997 
	gc
.
	gIFLA_MACVLAN
 = 
¡ræag
 {

998 
UNSPEC
 = 0,

999 
	gMODE
 = 1,

1002 
	gc
.
	gMACVLAN_MODE
 = 
muÉiæags
 {

1003 
PRIVATE
 = 1,

1004 
	gVEPA
 = 2,

1005 
	gBRIDGE
 = 4,

1006 
	gPASSTHRU
 = 8,

1009 
	gc
.
	gIFLA_VF_INFO
 = 
¡ræag
 {

1010 
UNSPEC
 = 0,

1011 
	gINFO
 = 1, -- 
nÙe
 
»Çmed
 
IFLA_VF_INFO
 
to
 
	gIFLA_VF_INFO
.INFO

1014 
	gc
.
	gIFLA_VF
 = 
¡ræag
 {

1015 
UNSPEC
 = 0,

1016 
	gMAC
 = 1,

1017 
	gVLAN
 = 2,

1018 
	gTX_RATE
 = 3,

1019 
	gSPOOFCHK
 = 4,

1022 
	gc
.
	gIFLA_VF_PORT
 = 
¡ræag
 {

1023 
UNSPEC
 = 0,

1024 
	gPORT
 = 1, -- 
nÙe
 
»Çmed
 
äom
 
IFLA_VF_PORT
 
to
 
	gIFLA_VF_PORT
.PORT?

1027 
	gc
.
	gIFLA_PORT
 = 
¡ræag
 {

1028 
UNSPEC
 = 0,

1029 
	gVF
 = 1,

1030 
	gPROFILE
 = 2,

1031 
	gVSI_TYPE
 = 3,

1032 
	gINSTANCE_UUID
 = 4,

1033 
	gHOST_UUID
 = 5,

1034 
	gREQUEST
 = 6,

1035 
	gRESPONSE
 = 7,

1038 
	gc
.
	gVETH_INFO
 = 
¡ræag
 {

1039 
UNSPEC
 = 0,

1040 
	gPEER
 = 1,

1043 
	gc
.
	gPORT
 = 
¡ræag
 {

1044 
PROFILE_MAX
 = 40,

1045 
	gUUID_MAX
 = 16,

1046 
	gSELF_VF
 = -1,

1049 
	gc
.
	gPORT_REQUEST
 = 
¡ræag
 {

1050 
PREASSOCIATE
 = 0,

1051 
	gPREASSOCIATE_RR
 = 1,

1052 
	gASSOCIATE
 = 2,

1053 
	gDISASSOCIATE
 = 3,

1056 
	gc
.
	gPORT_VDP_RESPONSE
 = 
¡ræag
 {

1057 
SUCCESS
 = 0,

1058 
	gINVALID_FORMAT
 = 1,

1059 
	gINSUFFICIENT_RESOURCES
 = 2,

1060 
	gUNUSED_VTID
 = 3,

1061 
	gVTID_VIOLATION
 = 4,

1062 
	gVTID_VERSION_VIOALTION
 = 5, -- 
£ems
 
to
 
be
 
mis¥–Ëd
 
š
 
h—d”s
 
TODO
 
fix


1063 
	gOUT_OF_SYNC
 = 6,

1066 
	gc
.
	gPORT_PROFILE_RESPONSE
 = 
¡ræag
 {

1067 
SUCCESS
 = 0x100,

1068 
	gINPROGRESS
 = 0x101,

1069 
	gINVALID
 = 0x102,

1070 
	gBADSTATE
 = 0x103,

1071 
	gINSUFFICIENT_RESOURCES
 = 0x104,

1072 
	gERROR
 = 0x105,

1075 -- 
äom
 
	gif_addr
.
h
 
š‹rçû
 
add»ss
 
ty³s
 
ªd
 
æags


1076 
	gc
.
	gIFA
 = 
¡ræag
 {

1077 
UNSPEC
 = 0,

1078 
	gADDRESS
 = 1,

1079 
	gLOCAL
 = 2,

1080 
	gLABEL
 = 3,

1081 
	gBROADCAST
 = 4,

1082 
	gANYCAST
 = 5,

1083 
	gCACHEINFO
 = 6,

1084 
	gMULTICAST
 = 7,

1087 
	gc
.
	gIFA_F
 = 
muÉiæags
 {

1088 
SECONDARY
 = 0x01,

1089 
	gNODAD
 = 0x02,

1090 
	gOPTIMISTIC
 = 0x04,

1091 
	gDADFAILED
 = 0x08,

1092 
	gHOMEADDRESS
 = 0x10,

1093 
	gDEPRECATED
 = 0x20,

1094 
	gTENTATIVE
 = 0x40,

1095 
	gPERMANENT
 = 0x80,

1098 
	gc
.
	gIFA_F
.
	gTEMPORARY
 = 
c
.
IFA_F
.
SECONDARY


1100 -- 
routšg


1101 
c
.
RTN
 = 
¡ræag
 {

1102 
UNSPEC
 = 0,

1103 
	gUNICAST
 = 1,

1104 
	gLOCAL
 = 2,

1105 
	gBROADCAST
 = 3,

1106 
	gANYCAST
 = 4,

1107 
	gMULTICAST
 = 5,

1108 
	gBLACKHOLE
 = 6,

1109 
	gUNREACHABLE
 = 7,

1110 
	gPROHIBIT
 = 8,

1111 
	gTHROW
 = 9,

1112 
	gNAT
 = 10,

1113 
	gXRESOLVE
 = 11,

1116 
	gc
.
	gRTPROT
 = 
¡ræag
 {

1117 
UNSPEC
 = 0,

1118 
	gREDIRECT
 = 1,

1119 
	gKERNEL
 = 2,

1120 
	gBOOT
 = 3,

1121 
	gSTATIC
 = 4,

1122 
	gGATED
 = 8,

1123 
	gRA
 = 9,

1124 
	gMRT
 = 10,

1125 
	gZEBRA
 = 11,

1126 
	gBIRD
 = 12,

1127 
	gDNROUTED
 = 13,

1128 
	gXORP
 = 14,

1129 
	gNTK
 = 15,

1130 
	gDHCP
 = 16,

1133 
	gc
.
	gRT_SCOPE
 = 
¡ræag
 {

1134 
UNIVERSE
 = 0,

1135 
	gSITE
 = 200,

1136 
	gLINK
 = 253,

1137 
	gHOST
 = 254,

1138 
	gNOWHERE
 = 255,

1141 
	gc
.
	gRTM_F
 = 
muÉiæags
 {

1142 
NOTIFY
 = 0x100,

1143 
	gCLONED
 = 0x200,

1144 
	gEQUALIZE
 = 0x400,

1145 
	gPREFIX
 = 0x800,

1148 
	gc
.
	gRT_TABLE
 = 
¡ræag
 {

1149 
UNSPEC
 = 0,

1150 
	gCOMPAT
 = 252,

1151 
	gDEFAULT
 = 253,

1152 
	gMAIN
 = 254,

1153 
	gLOCAL
 = 255,

1154 
	gMAX
 = 0xFFFFFFFF,

1157 
	gc
.
	gRTA
 = 
¡ræag
 {

1158 
UNSPEC
 = 0,

1159 
	gDST
 = 1,

1160 
	gSRC
 = 2,

1161 
	gIIF
 = 3,

1162 
	gOIF
 = 4,

1163 
	gGATEWAY
 = 5,

1164 
	gPRIORITY
 = 6,

1165 
	gPREFSRC
 = 7,

1166 
	gMETRICS
 = 8,

1167 
	gMULTIPATH
 = 9,

1168 
	gPROTOINFO
 = 10,

1169 
	gFLOW
 = 11,

1170 
	gCACHEINFO
 = 12,

1171 
	gSESSION
 = 13,

1172 
	gMP_ALGO
 = 14,

1173 
	gTABLE
 = 15,

1174 
	gMARK
 = 16,

1175 
	gMFC_STATS
 = 17,

1176 
	gVIA
 = 18,

1177 
	gNEWDST
 = 19,

1178 
	gPREF
 = 20,

1181 -- 
rou‹
 
æags


1182 
	gc
.
	gRTF
 = 
muÉiæags
 {

1183 
UP
 = 0x0001,

1184 
	gGATEWAY
 = 0x0002,

1185 
	gHOST
 = 0x0004,

1186 
	gREINSTATE
 = 0x0008,

1187 
	gDYNAMIC
 = 0x0010,

1188 
	gMODIFIED
 = 0x0020,

1189 
	gMTU
 = 0x0040,

1190 
	gWINDOW
 = 0x0080,

1191 
	gIRTT
 = 0x0100,

1192 
	gREJECT
 = 0x0200,

1193 -- 
v6
 
rou‹
 
æags


1194 
	gDEFAULT
 = 0x00010000,

1195 
	gALLONLINK
 = 0x00020000,

1196 
	gADDRCONF
 = 0x00040000,

1197 
	gPREFIX_RT
 = 0x00080000,

1198 
	gANYCAST
 = 0x00100000,

1199 
	gNONEXTHOP
 = 0x00200000,

1200 
	gEXPIRES
 = 0x00400000,

1201 
	gROUTEINFO
 = 0x00800000,

1202 
	gCACHE
 = 0x01000000,

1203 
	gFLOW
 = 0x02000000,

1204 
	gPOLICY
 = 0x04000000,

1205 
	gLOCAL
 = 0x80000000,

1208 
	gc
.
	gRTF
.
	gMSS
 = 
c
.
RTF
.
MTU


1210 -#defš
	#RTF_PREF
(
´ef
è(Õ»fè<< 27)

	)

1211 -#defš
	#RTF_PREF_MASK
 0x18000000

	)

1213 -- 
š‹rçû
 
æags


1214 
c
.
IFF
 = 
muÉiæags
 {

1215 
UP
 = 0x1,

1216 
	gBROADCAST
 = 0x2,

1217 
	gDEBUG
 = 0x4,

1218 
	gLOOPBACK
 = 0x8,

1219 
	gPOINTOPOINT
= 0x10,

1220 
	gNOTRAILERS
 = 0x20,

1221 
	gRUNNING
 = 0x40,

1222 
	gNOARP
 = 0x80,

1223 
	gPROMISC
 = 0x100,

1224 
	gALLMULTI
 = 0x200,

1225 
	gMASTER
 = 0x400,

1226 
	gSLAVE
 = 0x800,

1227 
	gMULTICAST
 = 0x1000,

1228 
	gPORTSEL
 = 0x2000,

1229 
	gAUTOMEDIA
 = 0x4000,

1230 
	gDYNAMIC
 = 0x8000,

1231 
	gLOWER_UP
 = 0x10000,

1232 
	gDORMANT
 = 0x20000,

1233 
	gECHO
 = 0x40000,

1236 
	gc
.
	gIFF
.
	gALL
 = 0xffffffff

1237 
c
.
IFF
.
NONE
 = 
b™
.
bnÙ
(0x7ffffè-- 
this
 
is
 
a
 b™ 
of
‡ 
fudge
 
as
 
z”o
 
should
 
wÜk
, 
but
 
dÛs
 
nÙ
 
hi¡Üiÿl
 
»asÚs
 
£e
 
	gÃt
/
	gcÜe
/
	g¹Ãšc
.c

1239 
	gc
.
	gIFF
.
	gVOLATILE
 = 
c
.
IFF
.
LOOPBACK
 + c.IFF.
POINTOPOINT
 + c.IFF.
BROADCAST
 + c.IFF.
ECHO
 +

1240 
c
.
IFF
.
MASTER
 + c.IFF.
SLAVE
 + c.IFF.
RUNNING
 + c.IFF.
LOWER_UP
 + c.IFF.
DORMANT


1242 -- 
Ãšk
 
muÉiÿ¡
 
groups


1243 -- 
Ëgacy
 
Çmes
, 
which
 
¬e
 
	gmasks
.

1244 
	gc
.
	gRTMGRP
 = 
muÉiæags
 {

1245 
LINK
 = 1,

1246 
	gNOTIFY
 = 2,

1247 
	gNEIGH
 = 4,

1248 
	gTC
 = 8,

1249 
	gIPV4_IFADDR
 = 0x10,

1250 
	gIPV4_MROUTE
 = 0x20,

1251 
	gIPV4_ROUTE
 = 0x40,

1252 
	gIPV4_RULE
 = 0x80,

1253 
	gIPV6_IFADDR
 = 0x100,

1254 
	gIPV6_MROUTE
 = 0x200,

1255 
	gIPV6_ROUTE
 = 0x400,

1256 
	gIPV6_IFINFO
 = 0x800,

1257 --
	gDECNET_IFADDR
 = 0x1000,

1258 --
	gDECNET_ROUTE
 = 0x4000,

1259 
	gIPV6_PREFIX
 = 0x20000,

1262 -- 
¹Ãšk
 
muÉiÿ¡
 
	$groups
 (
b™
 
numb”s
 
nÙ
 
masks
)

1263 
c
.
RTNLGRP
 = 
¡ræag
 {

1264 
NONE
 = 0,

1265 
LINK
 = 1,

1266 
NOTIFY
 = 2,

1267 
NEIGH
 = 3,

1268 
TC
 = 4,

1269 
IPV4_IFADDR
 = 5,

1270 
IPV4_MROUTE
 = 6,

1271 
IPV4_ROUTE
 = 7,

1272 
IPV4_RULE
 = 8,

1273 
IPV6_IFADDR
 = 9,

1274 
IPV6_MROUTE
 = 10,

1275 
IPV6_ROUTE
 = 11,

1276 
IPV6_IFINFO
 = 12,

1277 -- 
DECNET_IFADDR
 = 13,

1278 
NOP2
 = 14,

1279 -- 
DECNET_ROUTE
 = 15,

1280 -- 
DECNET_RULE
 = 16,

1281 
NOP4
 = 17,

1282 
IPV6_PREFIX
 = 18,

1283 
IPV6_RULE
 = 19,

1284 
ND_USEROPT
 = 20,

1285 
PHONET_IFADDR
 = 21,

1286 
PHONET_ROUTE
 = 22,

1287 
DCB
 = 23,

1288 
	}
}

1290 -- 
Ãšk
 
	$Ãighbours
 (
¬p
)

1291 
c
.
NDA
 = 
¡ræag
 {

1292 
UNSPEC
 = 0,

1293 
DST
 = 1,

1294 
LLADDR
 = 2,

1295 
CACHEINFO
 = 3,

1296 
PROBES
 = 4,

1297 
	}
}

1299 
	gc
.
	gNTF
 = 
muÉiæags
 {

1300 
USE
 = 0x01,

1301 
	gPROXY
 = 0x08,

1302 
	gROUTER
 = 0x80,

1303 
	gSELF
 = 0x02,

1304 
	gMASTER
 = 0x04,

1307 
	gc
.
	gNUD
 = 
muÉiæags
 {

1308 
INCOMPLETE
 = 0x01,

1309 
	gREACHABLE
 = 0x02,

1310 
	gSTALE
 = 0x04,

1311 
	gDELAY
 = 0x08,

1312 
	gPROBE
 = 0x10,

1313 
	gFAILED
 = 0x20,

1314 
	gNOARP
 = 0x40,

1315 
	gPERMANENT
 = 0x80,

1316 
	gNONE
 = 0x00,

1319 
	gc
.
	gNDTPA
 = 
¡ræag
 {

1320 
UNSPEC
 = 0,

1321 
	gIFINDEX
 = 1,

1322 
	gREFCNT
 = 2,

1323 
	gREACHABLE_TIME
 = 3,

1324 
	gBASE_REACHABLE_TIME
 = 4,

1325 
	gRETRANS_TIME
 = 5,

1326 
	gGC_STALETIME
 = 6,

1327 
	gDELAY_PROBE_TIME
 = 7,

1328 
	gQUEUE_LEN
 = 8,

1329 
	gAPP_PROBES
 = 9,

1330 
	gUCAST_PROBES
 = 10,

1331 
	gMCAST_PROBES
 = 11,

1332 
	gANYCAST_DELAY
 = 12,

1333 
	gPROXY_DELAY
 = 13,

1334 
	gPROXY_QLEN
 = 14,

1335 
	gLOCKTIME
 = 15,

1336 
	gQUEUE_LENBYTES
 = 16,

1339 
	gc
.
	gNDTA
 = 
¡ræag
 {

1340 
UNSPEC
 = 0,

1341 
	gNAME
 = 1,

1342 
	gTHRESH1
 = 2,

1343 
	gTHRESH2
 = 3,

1344 
	gTHRESH3
 = 4,

1345 
	gCONFIG
 = 5,

1346 
	gPARMS
 = 6,

1347 
	gSTATS
 = 7,

1348 
	gGC_INTERVAL
 = 8,

1351 -- 
add»ss
 
çm›s


1352 
	gc
.
	gAF
 = 
¡ræag
 {

1353 
UNSPEC
 = 0,

1354 
	gLOCAL
 = 1,

1355 
	gINET
 = 2,

1356 
	gAX25
 = 3,

1357 
	gIPX
 = 4,

1358 
	gAPPLETALK
 = 5,

1359 
	gNETROM
 = 6,

1360 
	gBRIDGE
 = 7,

1361 
	gATMPVC
 = 8,

1362 
	gX25
 = 9,

1363 
	gINET6
 = 10,

1364 
	gROSE
 = 11,

1365 
	gDECNET
 = 12,

1366 
	gNETBEUI
 = 13,

1367 
	gSECURITY
 = 14,

1368 
	gKEY
 = 15,

1369 
	gNETLINK
 = 16,

1370 
	gPACKET
 = 17,

1371 
	gASH
 = 18,

1372 
	gECONET
 = 19,

1373 
	gATMSVC
 = 20,

1374 
	gRDS
 = 21,

1375 
	gSNA
 = 22,

1376 
	gIRDA
 = 23,

1377 
	gPPPOX
 = 24,

1378 
	gWANPIPE
 = 25,

1379 
	gLLC
 = 26,

1380 
	gCAN
 = 29,

1381 
	gTIPC
 = 30,

1382 
	gBLUETOOTH
 = 31,

1383 
	gIUCV
 = 32,

1384 
	gRXRPC
 = 33,

1385 
	gISDN
 = 34,

1386 
	gPHONET
 = 35,

1387 
	gIEEE802154
 = 36,

1388 
	gCAIF
 = 37,

1389 
	gALG
 = 38,

1390 
	gNFC
 = 39,

1393 
	gc
.
	gAF
.
	gUNIX
 = 
c
.
AF
.
LOCAL


1394 
c
.
AF
.
FILE
 = c.AF.
LOCAL


1395 
c
.
AF
.
ROUTE
 = c.AF.
NETLINK


1397 -- 
¬p
 
ty³s
, 
which
 
¬e
 
®so
 
š‹rçû
y³ 
ifi_ty³


1398 
	gc
.
	gARPHRD
 = 
¡ræag
 {

1399 
NETROM
 = 0,

1400 
	gETHER
 = 1,

1401 
	gEETHER
 = 2,

1402 
	gAX25
 = 3,

1403 
	gPRONET
 = 4,

1404 
	gCHAOS
 = 5,

1405 
	gIEEE802
 = 6,

1406 
	gARCNET
 = 7,

1407 
	gAPPLETLK
 = 8,

1408 
	gDLCI
 = 15,

1409 
	gATM
 = 19,

1410 
	gMETRICOM
 = 23,

1411 
	gIEEE1394
 = 24,

1412 
	gEUI64
 = 27,

1413 
	gINFINIBAND
 = 32,

1414 
	gSLIP
 = 256,

1415 
	gCSLIP
 = 257,

1416 
	gSLIP6
 = 258,

1417 
	gCSLIP6
 = 259,

1418 
	gRSRVD
 = 260,

1419 
	gADAPT
 = 264,

1420 
	gROSE
 = 270,

1421 
	gX25
 = 271,

1422 
	gHWX25
 = 272,

1423 
	gCAN
 = 280,

1424 
	gPPP
 = 512,

1425 
	gCISCO
 = 513,

1426 
	gLAPB
 = 516,

1427 
	gDDCMP
 = 517,

1428 
	gRAWHDLC
 = 518,

1429 
	gTUNNEL
 = 768,

1430 
	gTUNNEL6
 = 769,

1431 
	gFRAD
 = 770,

1432 
	gSKIP
 = 771,

1433 
	gLOOPBACK
 = 772,

1434 
	gLOCALTLK
 = 773,

1435 
	gFDDI
 = 774,

1436 
	gBIF
 = 775,

1437 
	gSIT
 = 776,

1438 
	gIPDDP
 = 777,

1439 
	gIPGRE
 = 778,

1440 
	gPIMREG
 = 779,

1441 
	gHIPPI
 = 780,

1442 
	gASH
 = 781,

1443 
	gECONET
 = 782,

1444 
	gIRDA
 = 783,

1445 
	gFCPP
 = 784,

1446 
	gFCAL
 = 785,

1447 
	gFCPL
 = 786,

1448 
	gFCFABRIC
 = 787,

1449 
	gIEEE802_TR
 = 800,

1450 
	gIEEE80211
 = 801,

1451 
	gIEEE80211_PRISM
 = 802,

1452 
	gIEEE80211_RADIOTAP
 = 803,

1453 
	gIEEE802154
 = 804,

1454 
	gPHONET
 = 820,

1455 
	gPHONET_PIPE
 = 821,

1456 
	gCAIF
 = 822,

1457 
	gVOID
 = 0xFFFF,

1458 
	gNONE
 = 0xFFFE,

1461 
	gc
.
	gARPHRD
.
	gHDLC
 = 
c
.
ARPHRD
.
CISCO


1463 -- 
IP


1464 
c
.
IPPROTO
 = 
¡ræag
 {

1465 
IP
 = 0,

1466 
	gICMP
 = 1,

1467 
	gIGMP
 = 2,

1468 
	gIPIP
 = 4,

1469 
	gTCP
 = 6,

1470 
	gEGP
 = 8,

1471 
	gPUP
 = 12,

1472 
	gUDP
 = 17,

1473 
	gIDP
 = 22,

1474 
	gTP
 = 29,

1475 
	gDCCP
 = 33,

1476 
	gIPV6
 = 41,

1477 
	gROUTING
 = 43,

1478 
	gFRAGMENT
 = 44,

1479 
	gRSVP
 = 46,

1480 
	gGRE
 = 47,

1481 
	gESP
 = 50,

1482 
	gAH
 = 51,

1483 
	gICMPV6
 = 58,

1484 
	gNONE
 = 59,

1485 
	gDSTOPTS
 = 60,

1486 
	gMTP
 = 92,

1487 
	gENCAP
 = 98,

1488 
	gPIM
 = 103,

1489 
	gCOMP
 = 108,

1490 
	gSCTP
 = 132,

1491 
	gUDPLITE
 = 136,

1492 
	gRAW
 = 255,

1495 
	gc
.
	gIP
 = 
¡ræag
 {

1496 
TOS
 = 1,

1497 
	gTTL
 = 2,

1498 
	gHDRINCL
 = 3,

1499 
	gOPTIONS
 = 4,

1500 
	gROUTER_ALERT
 = 5,

1501 
	gRECVOPTS
 = 6,

1502 
	gRETOPTS
 = 7,

1503 
	gPKTINFO
 = 8,

1504 
	gPKTOPTIONS
 = 9,

1505 
	gMTU_DISCOVER
 = 10,

1506 
	gRECVERR
 = 11,

1507 
	gRECVTTL
 = 12,

1508 
	gRECVTOS
 = 13,

1509 
	gMTU
 = 14,

1510 
	gFREEBIND
 = 15,

1511 
	gIPSEC_POLICY
 = 16,

1512 
	gXFRM_POLICY
 = 17,

1513 
	gPASSSEC
 = 18,

1514 
	gTRANSPARENT
 = 19,

1515 
	gORIGDSTADDR
 = 20,

1516 
	gMINTTL
 = 21,

1517 
	gNODEFRAG
 = 22,

1518 
	gMULTICAST_IF
 = 32,

1519 
	gMULTICAST_TTL
 = 33,

1520 
	gMULTICAST_LOOP
 = 34,

1521 
	gADD_MEMBERSHIP
 = 35,

1522 
	gDROP_MEMBERSHIP
 = 36,

1523 
	gUNBLOCK_SOURCE
 = 37,

1524 
	gBLOCK_SOURCE
 = 38,

1525 
	gADD_SOURCE_MEMBERSHIP
 = 39,

1526 
	gDROP_SOURCE_MEMBERSHIP
 = 40,

1527 
	gMSFILTER
 = 41,

1529 
	gMULTICAST_ALL
 = 49,

1530 
	gUNICAST_IF
 = 50,

1533 
	gc
.
	gETH_P
 = 
¡ræag
 {

1534 
LOOP
 = 0x0060,

1535 
	gPUP
 = 0x0200,

1536 
	gPUPAT
 = 0x0201,

1537 
	gIP
 = 0x0800,

1538 
	gX25
 = 0x0805,

1539 
	gARP
 = 0x0806,

1540 
	gBPQ
 = 0x08FF,

1541 
	gIEEEPUP
 = 0x0a00,

1542 
	gIEEEPUPAT
 = 0x0a01,

1543 
	gDEC
 = 0x6000,

1544 
	gDNA_DL
 = 0x6001,

1545 
	gDNA_RC
 = 0x6002,

1546 
	gDNA_RT
 = 0x6003,

1547 
	gLAT
 = 0x6004,

1548 
	gDIAG
 = 0x6005,

1549 
	gCUST
 = 0x6006,

1550 
	gSCA
 = 0x6007,

1551 
	gTEB
 = 0x6558,

1552 
	gRARP
 = 0x8035,

1553 
	gATALK
 = 0x809B,

1554 
	gAARP
 = 0x80F3,

1556 
	gIPX
 = 0x8137,

1557 
	gIPV6
 = 0x86DD,

1558 
	gPAUSE
 = 0x8808,

1559 
	gSLOW
 = 0x8809,

1560 
	gWCCP
 = 0x883E,

1561 
	gPPP_DISC
 = 0x8863,

1562 
	gPPP_SES
 = 0x8864,

1563 
	gMPLS_UC
 = 0x8847,

1564 
	gMPLS_MC
 = 0x8848,

1565 
	gATMMPOA
 = 0x884c,

1566 
	gLINK_CTL
 = 0x886c,

1567 
	gATMFATE
 = 0x8884,

1568 
	gPAE
 = 0x888E,

1569 
	gAOE
 = 0x88A2,

1572 
	gTIPC
 = 0x88CA,

1575 
	gFCOE
 = 0x8906,

1576 
	gTDLS
 = 0x890D,

1577 
	gFIP
 = 0x8914,

1578 
	gQINQ1
 = 0x9100,

1579 
	gQINQ2
 = 0x9200,

1580 
	gQINQ3
 = 0x9300,

1581 
	gEDSA
 = 0xDADA,

1582 
	gAF_IUCV
 = 0xFBFB,

1584 
	gAX25
 = 0x0002,

1585 
	gALL
 = 0x0003,

1587 
	gSNAP
 = 0x0005,

1588 
	gDDCMP
 = 0x0006,

1589 
	gWAN_PPP
 = 0x0007,

1590 
	gPPP_MP
 = 0x0008,

1591 
	gLOCALTALK
 = 0x0009,

1592 
	gCAN
 = 0x000C,

1593 
	gPPPTALK
 = 0x0010,

1594 
	gTR_802_2
 = 0x0011,

1595 
	gMOBITEX
 = 0x0015,

1596 
	gCONTROL
 = 0x0016,

1597 
	gIRDA
 = 0x0017,

1598 
	gECONET
 = 0x0018,

1599 
	gHDLC
 = 0x0019,

1600 
	gARCNET
 = 0x001A,

1601 
	gDSA
 = 0x001B,

1602 
	gTRAILER
 = 0x001C,

1603 
	gPHONET
 = 0x00F5,

1604 
	gIEEE802154
= 0x00F6,

1605 
	gCAIF
 = 0x00F7,

1608 
	gc
.
	gETHERTYPE
 = 
¡ræag
 {

1609 
PUP
 = 0x0200,

1610 
	gSPRITE
 = 0x0500,

1611 
	gIP
 = 0x0800,

1612 
	gARP
 = 0x0806,

1613 
	gREVARP
 = 0x8035,

1614 
	gAT
 = 0x809B,

1615 
	gAARP
 = 0x80F3,

1616 
	gVLAN
 = 0x8100,

1617 
	gIPX
 = 0x8137,

1618 
	gIPV6
 = 0x86dd,

1619 
	gLOOPBACK
 = 0x9000,

1620 
	gTRAIL
 = 0x1000,

1623 -- 
ev’tfd


1624 
	gc
.
	gEFD
 = 
muÉiæags
 {

1625 
SEMAPHORE
 = 1,

1626 
	gCLOEXEC
 = 
c
.
O
.
CLOEXEC
,

1627 
	gNONBLOCK
 = 
c
.
O
.
NONBLOCK
,

1630 -- 
mouÁ


1631 
	gc
.
	gMS
 = 
muÉiæags
 {

1632 
RDONLY
 = 1,

1633 
	gNOSUID
 = 2,

1634 
	gNODEV
 = 4,

1635 
	gNOEXEC
 = 8,

1636 
	gSYNCHRONOUS
 = 16,

1637 
	gREMOUNT
 = 32,

1638 
	gMANDLOCK
 = 64,

1639 
	gDIRSYNC
 = 128,

1640 
	gNOATIME
 = 1024,

1641 
	gNODIRATIME
 = 2048,

1642 
	gBIND
 = 4096,

1643 
	gMOVE
 = 8192,

1644 
	gREC
 = 16384,

1645 
	gSILENT
 = 32768,

1646 
	gPOSIXACL
 = 
b™
.
lshiá
(1, 16),

1647 
	gUNBINDABLE
 = 
b™
.
lshiá
(1, 17),

1648 
	gPRIVATE
 = 
b™
.
lshiá
(1, 18),

1649 
	gSLAVE
 = 
b™
.
lshiá
(1, 19),

1650 
	gSHARED
 = 
b™
.
lshiá
(1, 20),

1651 
	gRELATIME
 = 
b™
.
lshiá
(1, 21),

1652 
	gKERNMOUNT
 = 
b™
.
lshiá
(1, 22),

1653 
	gI_VERSION
 = 
b™
.
lshiá
(1, 23),

1654 
	gSTRICTATIME
 = 
b™
.
lshiá
(1, 24),

1655 
	gACTIVE
 = 
b™
.
lshiá
(1, 30),

1656 
	gNOUSER
 = 
b™
.
lshiá
(1, 31),

1659 -- 
çke
 
æags


1660 
	gc
.
	gMS
.
	gRO
 = 
c
.
MS
.
RDONLY
 -- 
®low
 
u£
 
of
 "ro" 
as
 
æag
‡ 
th©
 
is
 
wh©
 /
´oc
/
mouÁs
 
u£s


1661 
c
.
MS
.
RW
 = 0 -- 
®low
 
u£
 
of
 "rw" 
as
 
æag
‡ 
­³¬s
 
š
 /
´oc
/
mouÁs


1662 
c
.
MS
.
SECLABEL
 = 0 -- 
­³¬s
 
š
 /
´oc
/
mouÁs
 iÀ
some
 
di¡ros
, 
	gignÜe


1664 -- 
æags
 
	gto
 `
	gmsync
'. -‚ote was MS_„enamedo MSYNC_

1665 
	gc
.
	gMSYNC
 = 
muÉiæags
 {

1666 
ASYNC
 = 1,

1667 
	gINVALIDATE
 = 2,

1668 
	gSYNC
 = 4,

1671 -- 
Úe
 
bË
 
umouÁ
 
as
 
™
 
u£s
 
MNT_
 
ªd
 
UMOUNT_
 
İtiÚs


1672 
	gc
.
	gUMOUNT
 = 
muÉiæags
 {

1673 
FORCE
 = 1,

1674 
	gDETACH
 = 2,

1675 
	gEXPIRE
 = 4,

1676 
	gNOFOLLOW
 = 8,

1679 -- 
»boÙ


1680 
	gc
.
	gLINUX_REBOOT_CMD
 = 
¡ræag
 {

1681 
RESTART
 = 0x01234567,

1682 
	gHALT
 = 0xCDEF0123,

1683 
	gCAD_ON
 = 0x89ABCDEF,

1684 
	gCAD_OFF
 = 0x00000000,

1685 
	gPOWER_OFF
 = 0x4321FEDC,

1686 
	gRESTART2
 = 0xA1B2C3D4,

1687 
	gSW_SUSPEND
 = 0xD000FCE2,

1688 
	gKEXEC
 = 0x45584543,

1691 -- 
şÚe


1692 
	gc
.
	gCLONE
 = 
muÉiæags
 {

1693 
VM
 = 0x00000100,

1694 
	gFS
 = 0x00000200,

1695 
	gFILES
 = 0x00000400,

1696 
	gSIGHAND
 = 0x00000800,

1697 
	gPTRACE
 = 0x00002000,

1698 
	gVFORK
 = 0x00004000,

1699 
	gPARENT
 = 0x00008000,

1700 
	gTHREAD
 = 0x00010000,

1701 
	gNEWNS
 = 0x00020000,

1702 
	gSYSVSEM
 = 0x00040000,

1703 
	gSETTLS
 = 0x00080000,

1704 
	gPARENT_SETTID
 = 0x00100000,

1705 
	gCHILD_CLEARTID
 = 0x00200000,

1706 
	gDETACHED
 = 0x00400000,

1707 
	gUNTRACED
 = 0x00800000,

1708 
	gCHILD_SETTID
 = 0x01000000,

1709 
	gNEWUTS
 = 0x04000000,

1710 
	gNEWIPC
 = 0x08000000,

1711 
	gNEWUSER
 = 0x10000000,

1712 
	gNEWPID
 = 0x20000000,

1713 
	gNEWNET
 = 0x40000000,

1714 
	gIO
 = 0x80000000,

1717 -- 
	gšÙify


1718 -- 
æags
 
nÙe
 
»Çme
 
äom
 
IN_
 
to
 
IN_INIT


1719 
	gc
.
	gIN_INIT
 = 
muÉiæags
(
¬ch
.
IN_INIT
 
Ü
 {

1720 
CLOEXEC
 = 
où®
("02000000"),

1721 
NONBLOCK
 = 
où®
("04000"),

1724 -- 
ev’ts


1725 
	gc
.
	gIN
 = 
muÉiæags
 {

1726 
ACCESS
 = 0x00000001,

1727 
	gMODIFY
 = 0x00000002,

1728 
	gATTRIB
 = 0x00000004,

1729 
	gCLOSE_WRITE
 = 0x00000008,

1730 
	gCLOSE_NOWRITE
 = 0x00000010,

1731 
	gOPEN
 = 0x00000020,

1732 
	gMOVED_FROM
 = 0x00000040,

1733 
	gMOVED_TO
 = 0x00000080,

1734 
	gCREATE
 = 0x00000100,

1735 
	gDELETE
 = 0x00000200,

1736 
	gDELETE_SELF
 = 0x00000400,

1737 
	gMOVE_SELF
 = 0x00000800,

1738 
	gUNMOUNT
 = 0x00002000,

1739 
	gQ_OVERFLOW
 = 0x00004000,

1740 
	gIGNORED
 = 0x00008000,

1742 
	gONLYDIR
 = 0x01000000,

1743 
	gDONT_FOLLOW
 = 0x02000000,

1744 
	gEXCL_UNLINK
 = 0x04000000,

1745 
	gMASK_ADD
 = 0x20000000,

1746 
	gISDIR
 = 0x40000000,

1747 
	gONESHOT
 = 0x80000000,

1750 
	gc
.
	gIN
.
	gCLOSE
 = 
c
.
IN
.
CLOSE_WRITE
 + c.IN.
CLOSE_NOWRITE


1751 
c
.
IN
.
MOVE
 = c.IN.
MOVED_FROM
 + c.IN.
MOVED_TO


1753 
c
.
IN
.
ALL_EVENTS
 = c.IN.
ACCESS
 + c.IN.
MODIFY
 + c.IN.
ATTRIB
 + c.IN.
CLOSE_WRITE


1754 + 
c
.
IN
.
CLOSE_NOWRITE
 + c.IN.
OPEN
 + c.IN.
MOVED_FROM


1755 + 
c
.
IN
.
MOVED_TO
 + c.IN.
CREATE
 + c.IN.
DELETE


1756 + 
c
.
IN
.
DELETE_SELF
 + c.IN.
MOVE_SELF


1758 --
´ùl


1759 
c
.
PR
 = 
¡ræag
 {

1760 
SET_PDEATHSIG
 = 1,

1761 
	gGET_PDEATHSIG
 = 2,

1762 
	gGET_DUMPABLE
 = 3,

1763 
	gSET_DUMPABLE
 = 4,

1764 
	gGET_UNALIGN
 = 5,

1765 
	gSET_UNALIGN
 = 6,

1766 
	gGET_KEEPCAPS
 = 7,

1767 
	gSET_KEEPCAPS
 = 8,

1768 
	gGET_FPEMU
 = 9,

1769 
	gSET_FPEMU
 = 10,

1770 
	gGET_FPEXC
 = 11,

1771 
	gSET_FPEXC
 = 12,

1772 
	gGET_TIMING
 = 13,

1773 
	gSET_TIMING
 = 14,

1774 
	gSET_NAME
 = 15,

1775 
	gGET_NAME
 = 16,

1776 
	gGET_ENDIAN
 = 19,

1777 
	gSET_ENDIAN
 = 20,

1778 
	gGET_SECCOMP
 = 21,

1779 
	gSET_SECCOMP
 = 22,

1780 
	gCAPBSET_READ
 = 23,

1781 
	gCAPBSET_DROP
 = 24,

1782 
	gGET_TSC
 = 25,

1783 
	gSET_TSC
 = 26,

1784 
	gGET_SECUREBITS
= 27,

1785 
	gSET_SECUREBITS
= 28,

1786 
	gSET_TIMERSLACK
= 29,

1787 
	gGET_TIMERSLACK
= 30,

1788 
	gTASK_PERF_EVENTS_DISABLE
=31,

1789 
	gTASK_PERF_EVENTS_ENABLE
=32,

1790 
	gMCE_KILL
 = 33,

1791 
	gMCE_KILL_GET
 = 34,

1792 
	gSET_NO_NEW_PRIVS
 = 38,

1793 
	gGET_NO_NEW_PRIVS
 = 39,

1794 
	gGET_TID_ADDRESS
 = 40,

1797 -- 
PR
 
	gg‘
/
£t
 
uÇlign


1798 
	gc
.
	gPR_UNALIGN
 = 
¡ræag
 {

1799 
NOPRINT
 = 1,

1800 
	gSIGBUS
 = 2,

1803 -- 
PR
 
åemu


1804 
	gc
.
	gPR_FPEMU
 = 
¡ræag
 {

1805 
NOPRINT
 = 1,

1806 
	gSIGFPE
 = 2,

1809 -- 
PR
 
	gåexc
 -- 
TODO
 
should
 
be
 
a
 
combo
 
of
 
¡ršgæag
 
ªd
 
æags


1810 
	gc
.
	gPR_FP_EXC
 = 
muÉiæags
 {

1811 
SW_ENABLE
 = 0x80,

1812 
	gDIV
 = 0x010000,

1813 
	gOVF
 = 0x020000,

1814 
	gUND
 = 0x040000,

1815 
	gRES
 = 0x080000,

1816 
	gINV
 = 0x100000,

1817 
	gDISABLED
 = 0,

1818 
	gNONRECOV
 = 1,

1819 
	gASYNC
 = 2,

1820 
	gPRECISE
 = 3,

1823 -- 
PR
 
g‘
 
£t
 
timšg


1824 
	gc
.
	gPR_TIMING
 = 
¡ræag
 {

1825 
STATISTICAL
= 0,

1826 
	gTIMESTAMP
 = 1,

1829 -- 
PR
 
£t
 
’dŸn


1830 
	gc
.
	gPR_ENDIAN
 = 
¡ræag
 {

1831 
BIG
 = 0,

1832 
	gLITTLE
 = 1,

1833 
	gPPC_LITTLE
 = 2,

1836 -- 
PR
 
TSC


1837 
	gc
.
	gPR_TSC
 = 
¡ræag
 {

1838 
ENABLE
 = 1,

1839 
	gSIGSEGV
 = 2,

1842 -- 
somewh©
 
cÚfusšg
 
as
 
th”e
 
¬e
 
some
 
š
 
PR
 
	gtoo
.

1843 
	gc
.
	gPR_MCE_KILL
 = 
¡ræag
 {

1844 
CLEAR
 = 0,

1845 
	gSET
 = 1,

1848 -- 
nÙe
 
	g»Çme
, 
this
 
is
 
exŒa
 
İtiÚ
 
£e
 
´ùl
 
code


1849 
	gc
.
	gPR_MCE_KILL_OPT
 = 
¡ræag
 {

1850 
LATE
 = 0,

1851 
	gEARLY
 = 1,

1852 
	gDEFAULT
 = 2,

1855 
	gc
.
	gLINUX_CAPABILITY_VERSION
 = {0x19980330, 0x20071026, 0x20080522}

1856 
c
.
LINUX_CAPABILITY_U32S
 = {1, 2, 2}

1858 -- 
ÿ·b™›s
 
NB
 
the£
 
¬e
 
b™
 
shiás


1859 
c
.
CAP
 = 
¡ræag
 {

1860 
CHOWN
 = 0,

1861 
	gDAC_OVERRIDE
 = 1,

1862 
	gDAC_READ_SEARCH
 = 2,

1863 
	gFOWNER
 = 3,

1864 
	gFSETID
 = 4,

1865 
	gKILL
 = 5,

1866 
	gSETGID
 = 6,

1867 
	gSETUID
 = 7,

1868 
	gSETPCAP
 = 8,

1869 
	gLINUX_IMMUTABLE
 = 9,

1870 
	gNET_BIND_SERVICE
 = 10,

1871 
	gNET_BROADCAST
 = 11,

1872 
	gNET_ADMIN
 = 12,

1873 
	gNET_RAW
 = 13,

1874 
	gIPC_LOCK
 = 14,

1875 
	gIPC_OWNER
 = 15,

1876 
	gSYS_MODULE
 = 16,

1877 
	gSYS_RAWIO
 = 17,

1878 
	gSYS_CHROOT
 = 18,

1879 
	gSYS_PTRACE
 = 19,

1880 
	gSYS_PACCT
 = 20,

1881 
	gSYS_ADMIN
 = 21,

1882 
	gSYS_BOOT
 = 22,

1883 
	gSYS_NICE
 = 23,

1884 
	gSYS_RESOURCE
 = 24,

1885 
	gSYS_TIME
 = 25,

1886 
	gSYS_TTY_CONFIG
 = 26,

1887 
	gMKNOD
 = 27,

1888 
	gLEASE
 = 28,

1889 
	gAUDIT_WRITE
 = 29,

1890 
	gAUDIT_CONTROL
 = 30,

1891 
	gSETFCAP
 = 31,

1892 
	gMAC_OVERRIDE
 = 32,

1893 
	gMAC_ADMIN
 = 33,

1894 
	gSYSLOG
 = 34,

1895 
	gWAKE_ALARM
 = 35,

1898 -- 
ÿ·b™›s
 
as
 
¡Üed
 
Ú
 
fe
 
sy¡em
 
š
 
x©Œ


1899 
	gc
.
	gVFS_CAP
 = 
¡ræag
 {

1900 
REVISION_MASK
 = 0xFF000000,

1901 
	gREVISION_SHIFT
 = 24,

1902 
	gREVISION_1
 = 0x01000000,

1903 
	gU32_1
 = 1,

1904 
	gREVISION_2
 = 0x02000000,

1905 
	gU32_2
 = 2,

1908 
	gc
.
	gVFS_CAP
.
	gFLAGS_MASK
 = 
b™
.
	$bnÙ
(
c
.
VFS_CAP
.
REVISION_MASK
)

1909 
c
.
VFS_CAP
.
U32
 = c.VFS_CAP.
U32_2


1910 
c
.
VFS_CAP
.
REVISION
 = c.VFS_CAP.
REVISION_2


1912 
c
.
VFS_CAP_FLAGS
 = 
¡ræag
 {

1913 
EFFECTIVE
 = 0x000001,

1914 
	}
}

1916 
	gc
.
	gXATTR_CAPS
 = 
¡ræag
 {

1917 
SZ_1
 = 4 * (1 + 2 * 
c
.
VFS_CAP
.
U32_1
),

1918 
	gSZ_2
 = 4 * (1 + 2 * 
c
.
VFS_CAP
.
U32_2
),

1921 
	gc
.
	gXATTR_CAPS
.
	gSZ
 = 
c
.
XATTR_CAPS
.
SZ_2


1923 -- 
Ãw
 
SECCOMP
 
modes
, 
now
 
th”e
 
is
 
f‹r
 
as
 
w–l
‡ 
¡riù


1924 
	gc
.
	gSECCOMP_MODE
 = 
¡ræag
 {

1925 
DISABLED
 = 0,

1926 
	gSTRICT
 = 1,

1927 
	gFILTER
 = 2,

1930 
	gc
.
	gSECCOMP_RET
 = 
muÉiæags
 {

1931 
KILL
 = 0x00000000,

1932 
	gTRAP
 = 0x00030000,

1933 
	gERRNO
 = 0x00050000,

1934 
	gTRACE
 = 0x7ff00000,

1935 
	gALLOW
 = 0x7fff0000,

1937 
	gACTION
 = 0x7fff0000, -- 
mask


1938 
	gDATA
 = 0x0000ffff, -- 
	gmask


1941 -- 
Elf
 
machše
 
æags


1942 
	gc
.
	gEM
 = 
¡ræag
 {

1943 
NONE
 = 0,

1944 
	gM32
 = 1,

1945 
	gSPARC
 = 2,

1950 
	gMIPS
 = 8,

1951 
	gMIPS_RS3_LE
 = 10,

1952 
	gMIPS_RS4_BE
 = 10,

1953 
	gPARISC
 = 15,

1954 
	gSPARC32PLUS
 = 18,

1955 
	gPPC
 = 20,

1956 
	gPPC64
 = 21,

1957 
	gS390
 = 22,

1958 
	gSPU
 = 23,

1959 
	gARM
 = 40,

1960 
	gSH
 = 42,

1961 
	gSPARCV9
 = 43,

1962 
	gH8_300
 = 46,

1963 
	gIA_64
 = 50,

1964 
	gX86_64
 = 62,

1965 
	gCRIS
 = 76,

1966 
	gV850
 = 87,

1967 
	gM32R
 = 88,

1968 
	gMN10300
 = 89,

1969 
	gBLACKFIN
 = 106,

1970 
	gTI_C6000
 = 140,

1971 
	gAARCH64
 = 183,

1972 
	gFRV
 = 0x5441,

1973 
	gAVR32
 = 0x18ad,

1974 
	gALPHA
 = 0x9026,

1975 
	gCYGNUS_V850
 = 0x9080,

1976 
	gCYGNUS_M32R
 = 0x9041,

1977 
	gS390_OLD
 = 0xA390,

1978 
	gCYGNUS_MN10300
 = 0xbeef,

1981 -- 
aud™
 
æags
 (
lÙs
 
missšg
 
äom
 
lšux
/aud™.
h
)

1983 -- 
I
 
	gdÚ
'think we‚eedoƒxporthese

1984 
loÿl
 
	g__AUDIT_ARCH_64BIT
 = 0x80000000

1985 
loÿl
 
__AUDIT_ARCH_LE
 = 0x40000000

1987 
c
.
AUDIT_ARCH
 = 
¡ræag
 {

1988 
AARCH64
 = 
c
.
EM
.AARCH64 + 
__AUDIT_ARCH_64BIT
 + 
__AUDIT_ARCH_LE
,

1989 
	gALPHA
 = 
c
.
EM
.
ALPHA
 + 
__AUDIT_ARCH_64BIT
 + 
__AUDIT_ARCH_LE
,

1990 
	gARM
 = 
c
.
EM
.
ARM
 + 
__AUDIT_ARCH_LE
,

1991 
	gARMEB
 = 
c
.
EM
.
ARM
,

1992 
	gCRIS
 = 
c
.
EM
.
CRIS
 + 
__AUDIT_ARCH_LE
,

1993 
	gFRV
 = 
c
.
EM
.
FRV
,

1994 
	gH8300
 = 
c
.
EM
.
H8_300
,

1995 
	gI386
 = 
c
.
EM
["386"] + 
__AUDIT_ARCH_LE
,

1996 
	gIA64
 = 
c
.
EM
.
IA_64
 + 
__AUDIT_ARCH_64BIT
 + 
__AUDIT_ARCH_LE
,

1997 
	gM32R
 = 
c
.
EM
.
M32R
,

1998 
	gM68K
 = 
c
.
EM
["68K"],

1999 
	gMIPS
 = 
c
.
EM
.
MIPS
,

2000 
	gMIPSEL
 = 
c
.
EM
.
MIPS
 + 
__AUDIT_ARCH_LE
,

2001 
	gMIPS64
 = 
c
.
EM
.
MIPS
 + 
__AUDIT_ARCH_64BIT
,

2002 
	gMIPSEL64
 = 
c
.
EM
.
MIPS
 + 
__AUDIT_ARCH_64BIT
 + 
__AUDIT_ARCH_LE
,

2003 
	gPARISC
 = 
c
.
EM
.
PARISC
,

2004 
	gPARISC64
 = 
c
.
EM
.
PARISC
 + 
__AUDIT_ARCH_64BIT
,

2005 
	gPPC
 = 
c
.
EM
.
PPC
,

2006 
	gPPC64
 = 
c
.
EM
.
PPC64
 + 
__AUDIT_ARCH_64BIT
,

2007 
	gS390
 = 
c
.
EM
.
S390
,

2008 
	gS390X
 = 
c
.
EM
.
S390
 + 
__AUDIT_ARCH_64BIT
,

2009 
	gSH
 = 
c
.
EM
.
SH
,

2010 
	gSHEL
 = 
c
.
EM
.
SH
 + 
__AUDIT_ARCH_LE
,

2011 
	gSH64
 = 
c
.
EM
.
SH
 + 
__AUDIT_ARCH_64BIT
,

2012 
	gSHEL64
 =
c
.
EM
.
SH
 + 
__AUDIT_ARCH_64BIT
 + 
__AUDIT_ARCH_LE
,

2013 
	gSPARC
 =
c
.
EM
.
SPARC
,

2014 
	gSPARC64
 =
c
.
EM
.
SPARCV9
 + 
__AUDIT_ARCH_64BIT
,

2015 
	gX86_64
 = 
c
.
EM
.
X86_64
 + 
__AUDIT_ARCH_64BIT
 + 
__AUDIT_ARCH_LE
,

2018 -- 
BPF
 
sock‘
 
f‹r


2019 
	gc
.
	gBPF
 = 
muÉiæags
 {

2020 -- 
şass


2021 
LD
 = 0x00,

2022 
	gLDX
 = 0x01,

2023 
	gST
 = 0x02,

2024 
	gSTX
 = 0x03,

2025 
	gALU
 = 0x04,

2026 
	gALU64
 = 0x07,

2027 
	gJMP
 = 0x05,

2028 
	gRET
 = 0x06,

2029 
	gMISC
 = 0x07,

2030 -- 
size


2031 
	gW
 = 0x00,

2032 
	gH
 = 0x08,

2033 
	gB
 = 0x10,

2034 
	gDW
 = 0x18,

2035 -- 
mode


2036 
	gIMM
 = 0x00,

2037 
	gABS
 = 0x20,

2038 
	gIND
 = 0x40,

2039 
	gMEM
 = 0x60,

2040 
	gLEN
 = 0x80,

2041 
	gMSH
 = 0xa0,

2042 -- 
İ


2043 
	gADD
 = 0x00,

2044 
	gSUB
 = 0x10,

2045 
	gMUL
 = 0x20,

2046 
	gDIV
 = 0x30,

2047 
	gOR
 = 0x40,

2048 
	gAND
 = 0x50,

2049 
	gLSH
 = 0x60,

2050 
	gRSH
 = 0x70,

2051 
	gARSH
 = 0xc0,

2052 
	gNEG
 = 0x80,

2053 
	gMOD
 = 0x90,

2054 
	gXOR
 = 0xa0,

2055 
	gMOV
 = 0xb0,

2056 
	gXADD
 = 0xc0,

2057 
	gEND
 = 0xd0,

2058 
	gJA
 = 0x00,

2059 
	gJEQ
 = 0x10,

2060 
	gJGT
 = 0x20,

2061 
	gJGE
 = 0x30,

2062 
	gJSET
 = 0x40,

2063 
	gJNE
 = 0x50,

2064 
	gJSGT
 = 0x60,

2065 
	gJSGE
 = 0x70,

2066 
	gCALL
 = 0x80,

2067 
	gEXIT
 = 0x90,

2068 -- 
¤c


2069 
	gK
 = 0x00,

2070 
	gX
 = 0x08,

2071 -- 
rv®


2072 
	gA
 = 0x10,

2073 -- 
miscİ


2074 
	gTAX
 = 0x00,

2075 
	gTXA
 = 0x80,

2076 
	gTO_LE
 = 0x00,

2077 
	gTO_BE
 = 0x08,

2078 -- 
æags


2079 
	gANY
 = 0,

2080 
	gNOEXIST
 = 1,

2081 
	gEXIST
 = 2,

2084 -- 
BPF
 
m­
 
ty³


2085 
	gc
.
	gBPF_MAP
 = 
¡ræag
 {

2086 
UNSPEC
 = 0,

2087 
	gHASH
 = 1,

2088 
	gARRAY
 = 2,

2089 
	gPROG_ARRAY
 = 3,

2090 
	gPERF_EVENT_ARRAY
 = 4,

2091 
	gPERCPU_HASH
 = 5,

2092 
	gPERCPU_ARRAY
 = 6,

2093 
	gSTACK_TRACE
 = 7,

2094 
	gCGROUP_ARRAY
 = 8,

2097 -- 
BPF
 
sysÿÎ
 
commªds


2098 
	gc
.
	gBPF_CMD
 = 
¡ræag
 {

2099 
MAP_CREATE
 = 0,

2100 
	gMAP_LOOKUP_ELEM
 = 1,

2101 
	gMAP_UPDATE_ELEM
 = 2,

2102 
	gMAP_DELETE_ELEM
 = 3,

2103 
	gMAP_GET_NEXT_KEY
 = 4,

2104 
	gPROG_LOAD
 = 5,

2105 
	gOBJ_PIN
 = 6,

2106 
	gOBJ_GET
 = 7,

2109 -- 
BPF
 
´og¿m
 
ty³s


2110 
	gc
.
	gBPF_PROG
 = 
¡ræag
 {

2111 
UNSPEC
 = 0,

2112 
	gSOCKET_FILTER
 = 1,

2113 
	gKPROBE
 = 2,

2114 
	gSCHED_CLS
 = 3,

2115 
	gSCHED_ACT
 = 4,

2116 
	gTRACEPOINT
 = 5,

2117 
	gXDP
 = 6,

2120 -- 
Lšux
 
³rfÜmªû
 
	gmÚ™Üšg


2121 -- 
	g³rf_ev’t_©Œ
.
ty³


2122 
	gc
.
	gPERF_TYPE
 = 
¡ræag
 {

2123 
HARDWARE
 = 0,

2124 
	gSOFTWARE
 = 1,

2125 
	gTRACEPOINT
 = 2,

2126 
	gHW_CACHE
 = 3,

2127 
	gRAW
 = 4,

2128 
	gBREAKPOINT
 = 5,

2131 -- 
	g³rf_ev’t_©Œ
.
ev’t_id


2132 
	gc
.
	gPERF_COUNT
 = 
¡ræag
 {

2133 -- 
G’”®ized
 
³rfÜmªû
 
ev’t
 
ev’t_id
 
ty³s


2134 
HW_CPU_CYCLES
 = 0,

2135 
	gHW_INSTRUCTIONS
 = 1,

2136 
	gHW_CACHE_REFERENCES
 = 2,

2137 
	gHW_CACHE_MISSES
 = 3,

2138 
	gHW_BRANCH_INSTRUCTIONS
 = 4,

2139 
	gHW_BRANCH_MISSES
 = 5,

2140 
	gHW_BUS_CYCLES
 = 6,

2141 
	gHW_STALLED_CYCLES_FRONTEND
 = 7,

2142 
	gHW_STALLED_CYCLES_BACKEND
 = 8,

2143 
	gHW_REF_CPU_CYCLES
 = 9,

2144 -- 
G’”®ized
 
h¬dw¬e
 
ÿche
 
ev’ts


2145 
	gHW_CACHE_L1D
 = 0,

2146 
	gHW_CACHE_L1I
 = 1,

2147 
	gHW_CACHE_LL
 = 2,

2148 
	gHW_CACHE_DTLB
 = 3,

2149 
	gHW_CACHE_ITLB
 = 4,

2150 
	gHW_CACHE_BPU
 = 5,

2151 
	gHW_CACHE_NODE
 = 6,

2152 
	gHW_CACHE_OP_READ
 = 0,

2153 
	gHW_CACHE_OP_WRITE
 = 1,

2154 
	gHW_CACHE_OP_PREFETCH
 = 2,

2155 
	gHW_CACHE_RESULT_ACCESS
 = 0,

2156 
	gHW_CACHE_RESULT_MISS
 = 1,

2157 -- 
	gS³cŸl
 "soáw¬e" 
ev’ts
 
´ovided
 
by
 
the
 
k”Ãl


2158 
	gSW_CPU_CLOCK
 = 0,

2159 
	gSW_TASK_CLOCK
 = 1,

2160 
	gSW_PAGE_FAULTS
 = 2,

2161 
	gSW_CONTEXT_SWITCHES
 = 3,

2162 
	gSW_CPU_MIGRATIONS
 = 4,

2163 
	gSW_PAGE_FAULTS_MIN
 = 5,

2164 
	gSW_PAGE_FAULTS_MAJ
 = 6,

2165 
	gSW_ALIGNMENT_FAULTS
 = 7,

2166 
	gSW_EMULATION_FAULTS
 = 8,

2167 
	gSW_DUMMY
 = 9,

2168 
	gSW_BPF_OUTPUT
 = 10,

2171 -- 
B™s
 
th©
 
ÿn
 
be
 
£t
 
š
 
	g³rf_ev’t_©Œ
.
§m¶e_ty³
 
to
 
»que¡
 
šfÜm©iÚ


2172 
	gc
.
	gPERF_SAMPLE
 = 
muÉiæags
 {

2173 
IP
 = 
b™
.
lshiá
(1, 0),

2174 
	gTID
 = 
b™
.
lshiá
(1, 1),

2175 
	gTIME
 = 
b™
.
lshiá
(1, 2),

2176 
	gADDR
 = 
b™
.
lshiá
(1, 3),

2177 
	gREAD
 = 
b™
.
lshiá
(1, 4),

2178 
	gCALLCHAIN
 = 
b™
.
lshiá
(1, 5),

2179 
	gID
 = 
b™
.
lshiá
(1, 6),

2180 
	gCPU
 = 
b™
.
lshiá
(1, 7),

2181 
	gPERIOD
 = 
b™
.
lshiá
(1, 8),

2182 
	gSTREAM_ID
 = 
b™
.
lshiá
(1, 9),

2183 
	gRAW
 = 
b™
.
lshiá
(1, 10),

2184 
	gBRANCH_STACK
 = 
b™
.
lshiá
(1, 11),

2185 
	gREGS_USER
 = 
b™
.
lshiá
(1, 12),

2186 
	gSTACK_USER
 = 
b™
.
lshiá
(1, 13),

2187 
	gWEIGHT
 = 
b™
.
lshiá
(1, 14),

2188 
	gDATA_SRC
 = 
b™
.
lshiá
(1, 15),

2189 
	gIDENTIFIER
 = 
b™
.
lshiá
(1, 16),

2190 
	gTRANSACTION
 = 
b™
.
lshiá
(1, 17),

2191 
	gREGS_INTR
 = 
b™
.
lshiá
(1, 18),

2194 -- 
v®ues
 
to
 
´og¿m
 
što
 
	g³rf_ev’t_©Œ
.
b¿nch_§m¶e_ty³
 
wh’
 
PERF_SAMPLE_BRANCH
 
is
 
£t


2195 
	gc
.
	gPERF_SAMPLE_BRANCH
 = 
muÉiæags
 {

2196 
USER_SHIFT
 = 0,

2197 
	gKERNEL_SHIFT
 = 1,

2198 
	gHV_SHIFT
 = 2,

2199 
	gANY_SHIFT
 = 3,

2200 
	gANY_CALL_SHIFT
 = 4,

2201 
	gANY_RETURN_SHIFT
 = 5,

2202 
	gIND_CALL_SHIFT
 = 6,

2203 
	gABORT_TX_SHIFT
 = 7,

2204 
	gIN_TX_SHIFT
 = 8,

2205 
	gNO_TX_SHIFT
 = 9,

2206 
	gCOND_SHIFT
 = 10,

2207 
	gCALL_STACK_SHIFT
 = 11,

2208 
	gIND_JUMP_SHIFT
 = 12,

2209 
	gCALL_SHIFT
 = 13,

2210 
	gNO_FLAGS_SHIFT
 = 14,

2211 
	gNO_CYCLES_SHIFT
 = 15,

2213 
	gc
.
	gPERF_SAMPLE_BRANCH
.
	gUSER
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
USER_SHIFT
)

2214 
c
.
PERF_SAMPLE_BRANCH
.
KERNEL
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
KERNEL_SHIFT
)

2215 
c
.
PERF_SAMPLE_BRANCH
.
HV
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
HV_SHIFT
)

2216 
c
.
PERF_SAMPLE_BRANCH
.
ANY
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
ANY_SHIFT
)

2217 
c
.
PERF_SAMPLE_BRANCH
.
ANY_CALL
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
ANY_CALL_SHIFT
)

2218 
c
.
PERF_SAMPLE_BRANCH
.
ANY_RETURN
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
ANY_RETURN_SHIFT
)

2219 
c
.
PERF_SAMPLE_BRANCH
.
IND_CALL
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
IND_CALL_SHIFT
)

2220 
c
.
PERF_SAMPLE_BRANCH
.
ABORT_TX
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
ABORT_TX_SHIFT
)

2221 
c
.
PERF_SAMPLE_BRANCH
.
IN_TX
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
IN_TX_SHIFT
)

2222 
c
.
PERF_SAMPLE_BRANCH
.
NO_TX
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
NO_TX_SHIFT
)

2223 
c
.
PERF_SAMPLE_BRANCH
.
COND
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
COND_SHIFT
)

2224 
c
.
PERF_SAMPLE_BRANCH
.
CALL_STACK
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
CALL_STACK_SHIFT
)

2225 
c
.
PERF_SAMPLE_BRANCH
.
IND_JUMP
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
IND_JUMP_SHIFT
)

2226 
c
.
PERF_SAMPLE_BRANCH
.
CALL
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
CALL_SHIFT
)

2227 
c
.
PERF_SAMPLE_BRANCH
.
NO_FLAGS
 = 
b™
.
	$lshiá
(1, 
c
.
PERF_SAMPLE_BRANCH
.
NO_FLAGS_SHIFT
)

2228 
c
.
PERF_SAMPLE_BRANCH
.
NO_CYCLES
 = 
b™
.
	`lshiá
(1, c.PERF_SAMPLE_BRANCH.
NO_CYCLES_SHIFT
)

2230 -- 
FÏgs
 
³rf_©Œ
.
»ad_fÜm©


2231 
c
.
PERF_READ_FORMAT
 = 
muÉiæags
 {

2232 
TOTAL_TIME_ENABLED
 = 
b™
.
	`lshiá
(1, 0),

2233 
TOTAL_TIME_RUNNING
 = 
b™
.
	`lshiá
(1, 1),

2234 
ID
 = 
b™
.
	`lshiá
(1, 2),

2235 
GROUP
 = 
b™
.
	`lshiá
(1, 3),

2236 
	}
}

2238 -- 
FÏgs
 
³rf_ev’t_İ’


2239 
	gc
.
	gPERF_FLAG
 = 
muÉiæags
 {

2240 
FD_NO_GROUP
 = 
b™
.
lshiá
(1, 0),

2241 
	gFD_OUTPUT
 = 
b™
.
lshiá
(1, 1),

2242 
	gPID_CGROUP
 = 
b™
.
lshiá
(1, 2),

2243 
	gFD_CLOEXEC
 = 
b™
.
lshiá
(1, 3),

2247 -- 
If
 
	g³rf_ev’t_©Œ
.
§m¶e_id_®l
 
is
 
£t
 
th’
 
®l
 
ev’t
 
ty³s
 
	gwl


2248 -- 
have
 
the
 
§m¶e_ty³
 
£Ëùed
 
f›lds
 
»Ï‹d
 
to
 
	gwh”e
/
	gwh’


2249 -- (
	gid’t™y
è
ª
 
ev’t
 
took
 
	$¶aû
 (
TID
, 
TIME
, 
ID
, 
STREAM_ID
, 
CPU
, 
IDENTIFIER
)

2250 
c
.
PERF_RECORD
 = 
¡ræag
 {

2251 
MMAP
 = 1,

2252 
LOST
 = 2,

2253 
COMM
 = 3,

2254 
EXIT
 = 4,

2255 
THROTTLE
 = 5,

2256 
UNTHROTTLE
 = 6,

2257 
FORK
 = 7,

2258 
READ
 = 8,

2259 
SAMPLE
 = 9,

2260 
MMAP2
 = 10,

2261 
AUX
 = 11,

2262 
ITRACE_START
 = 12,

2263 
LOST_SAMPLES
 = 13,

2264 
SWITCH
 = 14,

2265 
SWITCH_CPU_WIDE
= 15,

2266 
	}
}

2268 -- 
	g‹rmios
 - 
c_cc
 
ch¬aù”s


2269 
	gc
.
	gCC
 = 
¡ræag
(
¬ch
.
CC
 
Ü
 {

2270 
VINTR
 = 0,

2271 
VQUIT
 = 1,

2272 
VERASE
 = 2,

2273 
VKILL
 = 3,

2274 
VEOF
 = 4,

2275 
VTIME
 = 5,

2276 
VMIN
 = 6,

2277 
VSWTC
 = 7,

2278 
VSTART
 = 8,

2279 
VSTOP
 = 9,

2280 
VSUSP
 = 10,

2281 
VEOL
 = 11,

2282 
VREPRINT
 = 12,

2283 
VDISCARD
 = 13,

2284 
VWERASE
 = 14,

2285 
VLNEXT
 = 15,

2286 
VEOL2
 = 16,

2289 -- 
	g‹rmios
 - 
c_iæag
 
b™s


2290 
	gc
.
	gIFLAG
 = 
muÉiæags
(
¬ch
.
IFLAG
 
Ü
 {

2291 
IGNBRK
 = 
où®
('0000001'),

2292 
BRKINT
 = 
où®
('0000002'),

2293 
IGNPAR
 = 
où®
('0000004'),

2294 
PARMRK
 = 
où®
('0000010'),

2295 
INPCK
 = 
où®
('0000020'),

2296 
ISTRIP
 = 
où®
('0000040'),

2297 
INLCR
 = 
où®
('0000100'),

2298 
IGNCR
 = 
où®
('0000200'),

2299 
ICRNL
 = 
où®
('0000400'),

2300 
IUCLC
 = 
où®
('0001000'),

2301 
IXON
 = 
où®
('0002000'),

2302 
IXANY
 = 
où®
('0004000'),

2303 
IXOFF
 = 
où®
('0010000'),

2304 
IMAXBEL
 = 
où®
('0020000'),

2305 
IUTF8
 = 
où®
('0040000'),

2308 -- 
	g‹rmios
 - 
c_oæag
 
b™s


2309 
	gc
.
	gOFLAG
 = 
muÉiæags
(
¬ch
.
OFLAG
 
Ü
 {

2310 
OPOST
 = 
où®
('0000001'),

2311 
OLCUC
 = 
où®
('0000002'),

2312 
ONLCR
 = 
où®
('0000004'),

2313 
OCRNL
 = 
où®
('0000010'),

2314 
ONOCR
 = 
où®
('0000020'),

2315 
ONLRET
 = 
où®
('0000040'),

2316 
OFILL
 = 
où®
('0000100'),

2317 
OFDEL
 = 
où®
('0000200'),

2318 
NLDLY
 = 
où®
('0000400'),

2319 
NL0
 = 
où®
('0000000'),

2320 
NL1
 = 
où®
('0000400'),

2321 
CRDLY
 = 
où®
('0003000'),

2322 
CR0
 = 
où®
('0000000'),

2323 
CR1
 = 
où®
('0001000'),

2324 
CR2
 = 
où®
('0002000'),

2325 
CR3
 = 
où®
('0003000'),

2326 
TABDLY
 = 
où®
('0014000'),

2327 
TAB0
 = 
où®
('0000000'),

2328 
TAB1
 = 
où®
('0004000'),

2329 
TAB2
 = 
où®
('0010000'),

2330 
TAB3
 = 
où®
('0014000'),

2331 
BSDLY
 = 
où®
('0020000'),

2332 
BS0
 = 
où®
('0000000'),

2333 
BS1
 = 
où®
('0020000'),

2334 
FFDLY
 = 
où®
('0100000'),

2335 
FF0
 = 
où®
('0000000'),

2336 
FF1
 = 
où®
('0100000'),

2337 
VTDLY
 = 
où®
('0040000'),

2338 
VT0
 = 
où®
('0000000'),

2339 
VT1
 = 
où®
('0040000'),

2340 
XTABS
 = 
où®
('0014000'),

2343 -- 
usšg
 
¡ršg
 
keys
 
as
 
¥¬£
 
¬¿y
 
u£s
 
a
 
lÙ
 
of
 
memÜy


2344 
	gc
.
	gB
 = 
£tm‘©abË
(
¬ch
.
B
 
Ü
 {

2345 ['0'] = 
où®
('0000000'),

2346 ['50'] = 
où®
('0000001'),

2347 ['75'] = 
où®
('0000002'),

2348 ['110'] = 
où®
('0000003'),

2349 ['134'] = 
où®
('0000004'),

2350 ['150'] = 
où®
('0000005'),

2351 ['200'] = 
où®
('0000006'),

2352 ['300'] = 
où®
('0000007'),

2353 ['600'] = 
où®
('0000010'),

2354 ['1200'] = 
où®
('0000011'),

2355 ['1800'] = 
où®
('0000012'),

2356 ['2400'] = 
où®
('0000013'),

2357 ['4800'] = 
où®
('0000014'),

2358 ['9600'] = 
où®
('0000015'),

2359 ['19200'] = 
où®
('0000016'),

2360 ['38400'] = 
où®
('0000017'),

2361 ['57600'] = 
où®
('0010001'),

2362 ['115200'] = 
où®
('0010002'),

2363 ['230400'] = 
où®
('0010003'),

2364 ['460800'] = 
où®
('0010004'),

2365 ['500000'] = 
où®
('0010005'),

2366 ['576000'] = 
où®
('0010006'),

2367 ['921600'] = 
où®
('0010007'),

2368 ['1000000'] = 
où®
('0010010'),

2369 ['1152000'] = 
où®
('0010011'),

2370 ['1500000'] = 
où®
('0010012'),

2371 ['2000000'] = 
où®
('0010013'),

2372 ['2500000'] = 
où®
('0010014'),

2373 ['3000000'] = 
où®
('0010015'),

2374 ['3500000'] = 
où®
('0010016'),

2375 ['4000000'] = 
où®
('0010017'),

2377 
__šdex
 = 
funùiÚ
(
b
, 
k
)

2378  
b
[
to¡ršg
(
k
)]

2379 
’d
,

2383 
c
.
__MAX_BAUD
 = c.
B4000000


2384 
c
.
EXTA
 = c.
B19200


2385 
c
.
EXTB
 = c.
B38400


2388 -- 
TODO
 
ş—n
 
up
 
how
 
to
 
hªdË
 
	$the£
 (
u£d
 
cu¡om
 
¥“ds
)

2389 
c
.
CBAUD
 = 
¬ch
.CBAUD 
Ü
 
	`où®
('0010017')

2390 
c
.
CBAUDEX
 = 
¬ch
.CBAUDEX 
Ü
 
	`où®
('0010000')

2391 
c
.
CIBAUD
 = 
¬ch
.CIBAUD 
Ü
 
	`où®
('002003600000'è-- 
šput
 
baud
 
	$¿‹
 (
nÙ
 
u£d
)

2393 
c
.
CMSPAR
 = 
	`où®
('010000000000'è-- 
m¬k
 
Ü
 
	$¥aû
 (
¡ick
è
·r™y


2394 
c
.
CRTSCTS
 = 
	`où®
('020000000000'è-- 
æow
 
cÚŒŞ


2396 -- 
‹rmios
 - 
c_cæag
 
b™s


2397 
c
.
CFLAG
 = 
	`muÉiæags
(
¬ch
.CFLAG 
Ü
 {

2398 
CSIZE
 = 
	`où®
('0000060'),

2399 
CS5
 = 
	`où®
('0000000'),

2400 
CS6
 = 
	`où®
('0000020'),

2401 
CS7
 = 
	`où®
('0000040'),

2402 
CS8
 = 
	`où®
('0000060'),

2403 
CSTOPB
 = 
	`où®
('0000100'),

2404 
CREAD
 = 
	`où®
('0000200'),

2405 
PARENB
 = 
	`où®
('0000400'),

2406 
PARODD
 = 
	`où®
('0001000'),

2407 
HUPCL
 = 
	`où®
('0002000'),

2408 
CLOCAL
 = 
	`où®
('0004000'),

2409 
	}
})

2411 -- 
	g‹rmios
 - 
c_læag
 
b™s


2412 
	gc
.
	gLFLAG
 = 
muÉiæags
(
¬ch
.
LFLAG
 
Ü
 {

2413 
ISIG
 = 
où®
('0000001'),

2414 
ICANON
 = 
où®
('0000002'),

2415 
XCASE
 = 
où®
('0000004'),

2416 
ECHO
 = 
où®
('0000010'),

2417 
ECHOE
 = 
où®
('0000020'),

2418 
ECHOK
 = 
où®
('0000040'),

2419 
ECHONL
 = 
où®
('0000100'),

2420 
NOFLSH
 = 
où®
('0000200'),

2421 
TOSTOP
 = 
où®
('0000400'),

2422 
ECHOCTL
 = 
où®
('0001000'),

2423 
ECHOPRT
 = 
où®
('0002000'),

2424 
ECHOKE
 = 
où®
('0004000'),

2425 
FLUSHO
 = 
où®
('0010000'),

2426 
PENDIN
 = 
où®
('0040000'),

2427 
IEXTEN
 = 
où®
('0100000'),

2428 
EXTPROC
 = 
où®
('0200000'),

2431 -- 
	g‹rmios
 - 
	$tcæow
(è
ªd
 
TCXONC
 
u£
 
the£
. 
»Çmed
 
äom
 
TC
 
to
 
TCFLOW


2432 
c
.
TCFLOW
 = 
¡ræag
 {

2433 
OOFF
 = 0,

2434 
OON
 = 1,

2435 
IOFF
 = 2,

2436 
ION
 = 3,

2437 
	}
}

2439 -- 
	g‹rmios
 - 
	$tcæush
(è
ªd
 
TCFLSH
 
u£
 
the£
. 
»Çmed
 
äom
 
TC
 
to
 
TCFLUSH


2440 
c
.
TCFLUSH
 = 
¡ræag
 {

2441 
IFLUSH
 = 0,

2442 
OFLUSH
 = 1,

2443 
IOFLUSH
 = 2,

2444 
	}
}

2446 -- 
	g‹rmios
 - 
tc£‰r
 
u£s
 
the£


2447 
	gc
.
	gTCSA
 = 
¡ræag
 {

2448 
NOW
 = 0,

2449 
	gDRAIN
 = 1,

2450 
	gFLUSH
 = 2,

2453 -- 
TIOCM


2454 
	gc
.
	gTIOCM
 = 
muÉiæags
(
¬ch
.
TIOCM
 
Ü
 {

2455 
LE
 = 0x001,

2456 
DTR
 = 0x002,

2457 
RTS
 = 0x004,

2458 
ST
 = 0x008,

2459 
SR
 = 0x010,

2460 
CTS
 = 0x020,

2461 
CAR
 = 0x040,

2462 
RNG
 = 0x080,

2463 
DSR
 = 0x100,

2466 
	gc
.
	gTIOCM
.
	gCD
 = 
c
.
TIOCM
.
CAR


2467 
c
.
TIOCM
.
RI
 = c.TIOCM.
RNG


2469 -- 
sysfs
 
v®ues


2470 
c
.
SYSFS_BRIDGE_ATTR
 = "bridge"

2471 
c
.
SYSFS_BRIDGE_FDB
 = "brforward"

2472 
c
.
SYSFS_BRIDGE_PORT_SUBDIR
 = "brif"

2473 
c
.
SYSFS_BRIDGE_PORT_ATTR
 = "brport"

2474 
c
.
SYSFS_BRIDGE_PORT_LINK
 = "bridge"

2476 -- 
sizes
 -- 
TODO
 
š
 
bËs
?

2477 
c
.
HOST_NAME_MAX
 = 64

2478 
c
.
IFNAMSIZ
 = 16

2479 
c
.
IFHWADDRLEN
 = 6

2481 -- 
šput
 
subsy¡em
. 
TODO
 
¥l™
 
što
 
ªÙh”
 
fe
 
as
 
a
 
lÙ
 
of
 
them


2482 
c
.
INPUT_PROP
 = 
¡ræag
 {

2483 
POINTER
 = 0x00,

2484 
	gDIRECT
 = 0x01,

2485 
	gBUTTONPAD
 = 0x02,

2486 
	gSEMI_MT
 = 0x03,

2489 
	gc
.
	gEV
 = 
¡ræag
 {

2490 
SYN
 = 0x00,

2491 
	gKEY
 = 0x01,

2492 
	gREL
 = 0x02,

2493 
	gABS
 = 0x03,

2494 
	gMSC
 = 0x04,

2495 
	gSW
 = 0x05,

2496 
	gLED
 = 0x11,

2497 
	gSND
 = 0x12,

2498 
	gREP
 = 0x14,

2499 
	gFF
 = 0x15,

2500 
	gPWR
 = 0x16,

2501 
	gFF_STATUS
 = 0x17,

2502 
	gMAX
 = 0x1f,

2505 
	gc
.
	gSYN
 = 
¡ræag
 {

2506 
REPORT
 = 0,

2507 
	gCONFIG
 = 1,

2508 
	gMT_REPORT
 = 2,

2509 
	gDROPPED
 = 3,

2512 -- 
TODO
 
odd
 
Çme¥acšg
 
issue
 
w™h
 
KEY
 
ªd
 
	gBTN
, 
nÙ
 
su»
 
be¡
 
	g»sŞutiÚ
, 
maybe
 
have
 
KEYBTN
 
bË
 w™h 
bÙh


2513 
	gc
.
	gKEY
 = 
¡ræag
 {

2514 
RESERVED
 = 0,

2515 
	gESC
 = 1,

2526 
	gMINUS
 = 12,

2527 
	gEQUAL
 = 13,

2528 
	gBACKSPACE
 = 14,

2529 
	gTAB
 = 15,

2530 
	gQ
 = 16,

2531 
	gW
 = 17,

2532 
	gE
 = 18,

2533 
	gR
 = 19,

2534 
	gT
 = 20,

2535 
	gY
 = 21,

2536 
	gU
 = 22,

2537 
	gI
 = 23,

2538 
	gO
 = 24,

2539 
	gP
 = 25,

2540 
	gLEFTBRACE
 = 26,

2541 
	gRIGHTBRACE
 = 27,

2542 
	gENTER
 = 28,

2543 
	gLEFTCTRL
 = 29,

2544 
	gA
 = 30,

2545 
	gS
 = 31,

2546 
	gD
 = 32,

2547 
	gF
 = 33,

2548 
	gG
 = 34,

2549 
	gH
 = 35,

2550 
	gJ
 = 36,

2551 
	gK
 = 37,

2552 
	gL
 = 38,

2553 
	gSEMICOLON
 = 39,

2554 
	gAPOSTROPHE
 = 40,

2555 
	gGRAVE
 = 41,

2556 
	gLEFTSHIFT
 = 42,

2557 
	gBACKSLASH
 = 43,

2558 
	gZ
 = 44,

2559 
	gX
 = 45,

2560 
	gC
 = 46,

2561 
	gV
 = 47,

2562 
	gB
 = 48,

2563 
	gN
 = 49,

2564 
	gM
 = 50,

2565 
	gCOMMA
 = 51,

2566 
	gDOT
 = 52,

2567 
	gSLASH
 = 53,

2568 
	gRIGHTSHIFT
 = 54,

2569 
	gKPASTERISK
 = 55,

2570 
	gLEFTALT
 = 56,

2571 
	gSPACE
 = 57,

2572 
	gCAPSLOCK
 = 58,

2573 
	gF1
 = 59,

2574 
	gF2
 = 60,

2575 
	gF3
 = 61,

2576 
	gF4
 = 62,

2577 
	gF5
 = 63,

2578 
	gF6
 = 64,

2579 
	gF7
 = 65,

2580 
	gF8
 = 66,

2581 
	gF9
 = 67,

2582 
	gF10
 = 68,

2583 
	gNUMLOCK
 = 69,

2584 
	gSCROLLLOCK
 = 70,

2585 
	gKP7
 = 71,

2586 
	gKP8
 = 72,

2587 
	gKP9
 = 73,

2588 
	gKPMINUS
 = 74,

2589 
	gKP4
 = 75,

2590 
	gKP5
 = 76,

2591 
	gKP6
 = 77,

2592 
	gKPPLUS
 = 78,

2593 
	gKP1
 = 79,

2594 
	gKP2
 = 80,

2595 
	gKP3
 = 81,

2596 
	gKP0
 = 82,

2597 
	gKPDOT
 = 83,

2598 
	gZENKAKUHANKAKU
 = 85,

2600 
	gF11
 = 87,

2601 
	gF12
 = 88,

2602 
	gRO
 = 89,

2603 
	gKATAKANA
 = 90,

2604 
	gHIRAGANA
 = 91,

2605 
	gHENKAN
 = 92,

2606 
	gKATAKANAHIRAGANA
 = 93,

2607 
	gMUHENKAN
 = 94,

2608 
	gKPJPCOMMA
 = 95,

2609 
	gKPENTER
 = 96,

2610 
	gRIGHTCTRL
 = 97,

2611 
	gKPSLASH
 = 98,

2612 
	gSYSRQ
 = 99,

2613 
	gRIGHTALT
 = 100,

2614 
	gLINEFEED
 = 101,

2615 
	gHOME
 = 102,

2616 
	gUP
 = 103,

2617 
	gPAGEUP
 = 104,

2618 
	gLEFT
 = 105,

2619 
	gRIGHT
 = 106,

2620 
	gEND
 = 107,

2621 
	gDOWN
 = 108,

2622 
	gPAGEDOWN
 = 109,

2623 
	gINSERT
 = 110,

2624 
	gDELETE
 = 111,

2625 
	gMACRO
 = 112,

2626 
	gMUTE
 = 113,

2627 
	gVOLUMEDOWN
 = 114,

2628 
	gVOLUMEUP
 = 115,

2629 
	gPOWER
 = 116,

2630 
	gKPEQUAL
 = 117,

2631 
	gKPPLUSMINUS
 = 118,

2632 
	gPAUSE
 = 119,

2633 
	gSCALE
 = 120,

2634 
	gKPCOMMA
 = 121,

2635 
	gHANGEUL
 = 122,

2636 
	gHANJA
 = 123,

2637 
	gYEN
 = 124,

2638 
	gLEFTMETA
 = 125,

2639 
	gRIGHTMETA
 = 126,

2640 
	gCOMPOSE
 = 127,

2641 
	gSTOP
 = 128,

2642 
	gAGAIN
 = 129,

2643 
	gPROPS
 = 130,

2644 
	gUNDO
 = 131,

2645 
	gFRONT
 = 132,

2646 
	gCOPY
 = 133,

2647 
	gOPEN
 = 134,

2648 
	gPASTE
 = 135,

2649 
	gFIND
 = 136,

2650 
	gCUT
 = 137,

2651 
	gHELP
 = 138,

2652 
	gMENU
 = 139,

2653 
	gCALC
 = 140,

2654 
	gSETUP
 = 141,

2655 
	gSLEEP
 = 142,

2656 
	gWAKEUP
 = 143,

2657 
	gFILE
 = 144,

2658 
	gSENDFILE
 = 145,

2659 
	gDELETEFILE
 = 146,

2660 
	gXFER
 = 147,

2661 
	gPROG1
 = 148,

2662 
	gPROG2
 = 149,

2663 
	gWWW
 = 150,

2664 
	gMSDOS
 = 151,

2665 
	gCOFFEE
 = 152,

2666 
	gDIRECTION
 = 153,

2667 
	gCYCLEWINDOWS
 = 154,

2668 
	gMAIL
 = 155,

2669 
	gBOOKMARKS
 = 156,

2670 
	gCOMPUTER
 = 157,

2671 
	gBACK
 = 158,

2672 
	gFORWARD
 = 159,

2673 
	gCLOSECD
 = 160,

2674 
	gEJECTCD
 = 161,

2675 
	gEJECTCLOSECD
 = 162,

2676 
	gNEXTSONG
 = 163,

2677 
	gPLAYPAUSE
 = 164,

2678 
	gPREVIOUSSONG
 = 165,

2679 
	gSTOPCD
 = 166,

2680 
	gRECORD
 = 167,

2681 
	gREWIND
 = 168,

2682 
	gPHONE
 = 169,

2683 
	gISO
 = 170,

2684 
	gCONFIG
 = 171,

2685 
	gHOMEPAGE
 = 172,

2686 
	gREFRESH
 = 173,

2687 
	gEXIT
 = 174,

2688 
	gMOVE
 = 175,

2689 
	gEDIT
 = 176,

2690 
	gSCROLLUP
 = 177,

2691 
	gSCROLLDOWN
 = 178,

2692 
	gKPLEFTPAREN
 = 179,

2693 
	gKPRIGHTPAREN
 = 180,

2694 
	gNEW
 = 181,

2695 
	gREDO
 = 182,

2696 
	gF13
 = 183,

2697 
	gF14
 = 184,

2698 
	gF15
 = 185,

2699 
	gF16
 = 186,

2700 
	gF17
 = 187,

2701 
	gF18
 = 188,

2702 
	gF19
 = 189,

2703 
	gF20
 = 190,

2704 
	gF21
 = 191,

2705 
	gF22
 = 192,

2706 
	gF23
 = 193,

2707 
	gF24
 = 194,

2708 
	gPLAYCD
 = 200,

2709 
	gPAUSECD
 = 201,

2710 
	gPROG3
 = 202,

2711 
	gPROG4
 = 203,

2712 
	gDASHBOARD
 = 204,

2713 
	gSUSPEND
 = 205,

2714 
	gCLOSE
 = 206,

2715 
	gPLAY
 = 207,

2716 
	gFASTFORWARD
 = 208,

2717 
	gBASSBOOST
 = 209,

2718 
	gPRINT
 = 210,

2719 
	gHP
 = 211,

2720 
	gCAMERA
 = 212,

2721 
	gSOUND
 = 213,

2722 
	gQUESTION
 = 214,

2723 
	gEMAIL
 = 215,

2724 
	gCHAT
 = 216,

2725 
	gSEARCH
 = 217,

2726 
	gCONNECT
 = 218,

2727 
	gFINANCE
 = 219,

2728 
	gSPORT
 = 220,

2729 
	gSHOP
 = 221,

2730 
	gALTERASE
 = 222,

2731 
	gCANCEL
 = 223,

2732 
	gBRIGHTNESSDOWN
 = 224,

2733 
	gBRIGHTNESSUP
 = 225,

2734 
	gMEDIA
 = 226,

2735 
	gSWITCHVIDEOMODE
 = 227,

2736 
	gKBDILLUMTOGGLE
 = 228,

2737 
	gKBDILLUMDOWN
 = 229,

2738 
	gKBDILLUMUP
 = 230,

2739 
	gSEND
 = 231,

2740 
	gREPLY
 = 232,

2741 
	gFORWARDMAIL
 = 233,

2742 
	gSAVE
 = 234,

2743 
	gDOCUMENTS
 = 235,

2744 
	gBATTERY
 = 236,

2745 
	gBLUETOOTH
 = 237,

2746 
	gWLAN
 = 238,

2747 
	gUWB
 = 239,

2748 
	gUNKNOWN
 = 240,

2749 
	gVIDEO_NEXT
 = 241,

2750 
	gVIDEO_PREV
 = 242,

2751 
	gBRIGHTNESS_CYCLE
 = 243,

2752 
	gBRIGHTNESS_ZERO
 = 244,

2753 
	gDISPLAY_OFF
 = 245,

2754 
	gWIMAX
 = 246,

2755 
	gRFKILL
 = 247,

2756 
	gMICMUTE
 = 248,

2757 -- 
BTN
 
v®ues
 
go
 
š
 
h”e


2758 
	gOK
 = 0x160,

2759 
	gSELECT
 = 0x161,

2760 
	gGOTO
 = 0x162,

2761 
	gCLEAR
 = 0x163,

2762 
	gPOWER2
 = 0x164,

2763 
	gOPTION
 = 0x165,

2764 
	gINFO
 = 0x166,

2765 
	gTIME
 = 0x167,

2766 
	gVENDOR
 = 0x168,

2767 
	gARCHIVE
 = 0x169,

2768 
	gPROGRAM
 = 0x16a,

2769 
	gCHANNEL
 = 0x16b,

2770 
	gFAVORITES
 = 0x16c,

2771 
	gEPG
 = 0x16d,

2772 
	gPVR
 = 0x16e,

2773 
	gMHP
 = 0x16f,

2774 
	gLANGUAGE
 = 0x170,

2775 
	gTITLE
 = 0x171,

2776 
	gSUBTITLE
 = 0x172,

2777 
	gANGLE
 = 0x173,

2778 
	gZOOM
 = 0x174,

2779 
	gMODE
 = 0x175,

2780 
	gKEYBOARD
 = 0x176,

2781 
	gSCREEN
 = 0x177,

2782 
	gPC
 = 0x178,

2783 
	gTV
 = 0x179,

2784 
	gTV2
 = 0x17a,

2785 
	gVCR
 = 0x17b,

2786 
	gVCR2
 = 0x17c,

2787 
	gSAT
 = 0x17d,

2788 
	gSAT2
 = 0x17e,

2789 
	gCD
 = 0x17f,

2790 
	gTAPE
 = 0x180,

2791 
	gRADIO
 = 0x181,

2792 
	gTUNER
 = 0x182,

2793 
	gPLAYER
 = 0x183,

2794 
	gTEXT
 = 0x184,

2795 
	gDVD
 = 0x185,

2796 
	gAUX
 = 0x186,

2797 
	gMP3
 = 0x187,

2798 
	gAUDIO
 = 0x188,

2799 
	gVIDEO
 = 0x189,

2800 
	gDIRECTORY
 = 0x18a,

2801 
	gLIST
 = 0x18b,

2802 
	gMEMO
 = 0x18c,

2803 
	gCALENDAR
 = 0x18d,

2804 
	gRED
 = 0x18e,

2805 
	gGREEN
 = 0x18f,

2806 
	gYELLOW
 = 0x190,

2807 
	gBLUE
 = 0x191,

2808 
	gCHANNELUP
 = 0x192,

2809 
	gCHANNELDOWN
 = 0x193,

2810 
	gFIRST
 = 0x194,

2811 
	gLAST
 = 0x195,

2812 
	gAB
 = 0x196,

2813 
	gNEXT
 = 0x197,

2814 
	gRESTART
 = 0x198,

2815 
	gSLOW
 = 0x199,

2816 
	gSHUFFLE
 = 0x19a,

2817 
	gBREAK
 = 0x19b,

2818 
	gPREVIOUS
 = 0x19c,

2819 
	gDIGITS
 = 0x19d,

2820 
	gTEEN
 = 0x19e,

2821 
	gTWEN
 = 0x19f,

2822 
	gVIDEOPHONE
 = 0x1a0,

2823 
	gGAMES
 = 0x1a1,

2824 
	gZOOMIN
 = 0x1a2,

2825 
	gZOOMOUT
 = 0x1a3,

2826 
	gZOOMRESET
 = 0x1a4,

2827 
	gWORDPROCESSOR
 = 0x1a5,

2828 
	gEDITOR
 = 0x1a6,

2829 
	gSPREADSHEET
 = 0x1a7,

2830 
	gGRAPHICSEDITOR
 = 0x1a8,

2831 
	gPRESENTATION
 = 0x1a9,

2832 
	gDATABASE
 = 0x1aa,

2833 
	gNEWS
 = 0x1ab,

2834 
	gVOICEMAIL
 = 0x1ac,

2835 
	gADDRESSBOOK
 = 0x1ad,

2836 
	gMESSENGER
 = 0x1ae,

2837 
	gDISPLAYTOGGLE
 = 0x1af,

2838 
	gSPELLCHECK
 = 0x1b0,

2839 
	gLOGOFF
 = 0x1b1,

2840 
	gDOLLAR
 = 0x1b2,

2841 
	gEURO
 = 0x1b3,

2842 
	gFRAMEBACK
 = 0x1b4,

2843 
	gFRAMEFORWARD
 = 0x1b5,

2844 
	gCONTEXT_MENU
 = 0x1b6,

2845 
	gMEDIA_REPEAT
 = 0x1b7,

2848 
	gIMAGES
 = 0x1ba,

2849 
	gDEL_EOL
 = 0x1c0,

2850 
	gDEL_EOS
 = 0x1c1,

2851 
	gINS_LINE
 = 0x1c2,

2852 
	gDEL_LINE
 = 0x1c3,

2853 
	gFN
 = 0x1d0,

2854 
	gFN_ESC
 = 0x1d1,

2855 
	gFN_F1
 = 0x1d2,

2856 
	gFN_F2
 = 0x1d3,

2857 
	gFN_F3
 = 0x1d4,

2858 
	gFN_F4
 = 0x1d5,

2859 
	gFN_F5
 = 0x1d6,

2860 
	gFN_F6
 = 0x1d7,

2861 
	gFN_F7
 = 0x1d8,

2862 
	gFN_F8
 = 0x1d9,

2863 
	gFN_F9
 = 0x1da,

2864 
	gFN_F10
 = 0x1db,

2865 
	gFN_F11
 = 0x1dc,

2866 
	gFN_F12
 = 0x1dd,

2867 
	gFN_1
 = 0x1de,

2868 
	gFN_2
 = 0x1df,

2869 
	gFN_D
 = 0x1e0,

2870 
	gFN_E
 = 0x1e1,

2871 
	gFN_F
 = 0x1e2,

2872 
	gFN_S
 = 0x1e3,

2873 
	gFN_B
 = 0x1e4,

2874 
	gBRL_DOT1
 = 0x1f1,

2875 
	gBRL_DOT2
 = 0x1f2,

2876 
	gBRL_DOT3
 = 0x1f3,

2877 
	gBRL_DOT4
 = 0x1f4,

2878 
	gBRL_DOT5
 = 0x1f5,

2879 
	gBRL_DOT6
 = 0x1f6,

2880 
	gBRL_DOT7
 = 0x1f7,

2881 
	gBRL_DOT8
 = 0x1f8,

2882 
	gBRL_DOT9
 = 0x1f9,

2883 
	gBRL_DOT10
 = 0x1fa,

2884 
	gNUMERIC_0
 = 0x200,

2885 
	gNUMERIC_1
 = 0x201,

2886 
	gNUMERIC_2
 = 0x202,

2887 
	gNUMERIC_3
 = 0x203,

2888 
	gNUMERIC_4
 = 0x204,

2889 
	gNUMERIC_5
 = 0x205,

2890 
	gNUMERIC_6
 = 0x206,

2891 
	gNUMERIC_7
 = 0x207,

2892 
	gNUMERIC_8
 = 0x208,

2893 
	gNUMERIC_9
 = 0x209,

2894 
	gNUMERIC_STAR
 = 0x20a,

2895 
	gNUMERIC_POUND
 = 0x20b,

2896 
	gCAMERA_FOCUS
 = 0x210,

2897 
	gWPS_BUTTON
 = 0x211,

2898 
	gTOUCHPAD_TOGGLE
 = 0x212,

2899 
	gTOUCHPAD_ON
 = 0x213,

2900 
	gTOUCHPAD_OFF
 = 0x214,

2901 
	gCAMERA_ZOOMIN
 = 0x215,

2902 
	gCAMERA_ZOOMOUT
 = 0x216,

2903 
	gCAMERA_UP
 = 0x217,

2904 
	gCAMERA_DOWN
 = 0x218,

2905 
	gCAMERA_LEFT
 = 0x219,

2906 
	gCAMERA_RIGHT
 = 0x21a,

2909 
	gc
.
	gKEY
.
	gSCREENLOCK
 = 
c
.
KEY
.
COFFEE


2910 
c
.
KEY
.
HANGUEL
 = c.KEY.
HANGEUL


2912 
c
.
BTN
 = 
¡ræag
 {

2913 
MISC
 = 0x100,

2924 
	gMOUSE
 = 0x110,

2925 
	gLEFT
 = 0x110,

2926 
	gRIGHT
 = 0x111,

2927 
	gMIDDLE
 = 0x112,

2928 
	gSIDE
 = 0x113,

2929 
	gEXTRA
 = 0x114,

2930 
	gFORWARD
 = 0x115,

2931 
	gBACK
 = 0x116,

2932 
	gTASK
 = 0x117,

2933 
	gJOYSTICK
 = 0x120,

2934 
	gTRIGGER
 = 0x120,

2935 
	gTHUMB
 = 0x121,

2936 
	gTHUMB2
 = 0x122,

2937 
	gTOP
 = 0x123,

2938 
	gTOP2
 = 0x124,

2939 
	gPINKIE
 = 0x125,

2940 
	gBASE
 = 0x126,

2941 
	gBASE2
 = 0x127,

2942 
	gBASE3
 = 0x128,

2943 
	gBASE4
 = 0x129,

2944 
	gBASE5
 = 0x12a,

2945 
	gBASE6
 = 0x12b,

2946 
	gDEAD
 = 0x12f,

2947 
	gGAMEPAD
 = 0x130,

2948 
	gA
 = 0x130,

2949 
	gB
 = 0x131,

2950 
	gC
 = 0x132,

2951 
	gX
 = 0x133,

2952 
	gY
 = 0x134,

2953 
	gZ
 = 0x135,

2954 
	gTL
 = 0x136,

2955 
	gTR
 = 0x137,

2956 
	gTL2
 = 0x138,

2957 
	gTR2
 = 0x139,

2958 
	gSELECT
 = 0x13a,

2959 
	gSTART
 = 0x13b,

2960 
	gMODE
 = 0x13c,

2961 
	gTHUMBL
 = 0x13d,

2962 
	gTHUMBR
 = 0x13e,

2963 
	gDIGI
 = 0x140,

2964 
	gTOOL_PEN
 = 0x140,

2965 
	gTOOL_RUBBER
 = 0x141,

2966 
	gTOOL_BRUSH
 = 0x142,

2967 
	gTOOL_PENCIL
 = 0x143,

2968 
	gTOOL_AIRBRUSH
 = 0x144,

2969 
	gTOOL_FINGER
 = 0x145,

2970 
	gTOOL_MOUSE
 = 0x146,

2971 
	gTOOL_LENS
 = 0x147,

2972 
	gTOOL_QUINTTAP
 = 0x148,

2973 
	gTOUCH
 = 0x14a,

2974 
	gSTYLUS
 = 0x14b,

2975 
	gSTYLUS2
 = 0x14c,

2976 
	gTOOL_DOUBLETAP
 = 0x14d,

2977 
	gTOOL_TRIPLETAP
 = 0x14e,

2978 
	gTOOL_QUADTAP
 = 0x14f,

2979 
	gWHEEL
 = 0x150,

2980 
	gGEAR_DOWN
 = 0x150,

2981 
	gGEAR_UP
 = 0x151,

2983 
	gTRIGGER_HAPPY
 = 0x2c0,

2984 
	gTRIGGER_HAPPY1
 = 0x2c0,

2985 
	gTRIGGER_HAPPY2
 = 0x2c1,

2986 
	gTRIGGER_HAPPY3
 = 0x2c2,

2987 
	gTRIGGER_HAPPY4
 = 0x2c3,

2988 
	gTRIGGER_HAPPY5
 = 0x2c4,

2989 
	gTRIGGER_HAPPY6
 = 0x2c5,

2990 
	gTRIGGER_HAPPY7
 = 0x2c6,

2991 
	gTRIGGER_HAPPY8
 = 0x2c7,

2992 
	gTRIGGER_HAPPY9
 = 0x2c8,

2993 
	gTRIGGER_HAPPY10
 = 0x2c9,

2994 
	gTRIGGER_HAPPY11
 = 0x2ca,

2995 
	gTRIGGER_HAPPY12
 = 0x2cb,

2996 
	gTRIGGER_HAPPY13
 = 0x2cc,

2997 
	gTRIGGER_HAPPY14
 = 0x2cd,

2998 
	gTRIGGER_HAPPY15
 = 0x2ce,

2999 
	gTRIGGER_HAPPY16
 = 0x2cf,

3000 
	gTRIGGER_HAPPY17
 = 0x2d0,

3001 
	gTRIGGER_HAPPY18
 = 0x2d1,

3002 
	gTRIGGER_HAPPY19
 = 0x2d2,

3003 
	gTRIGGER_HAPPY20
 = 0x2d3,

3004 
	gTRIGGER_HAPPY21
 = 0x2d4,

3005 
	gTRIGGER_HAPPY22
 = 0x2d5,

3006 
	gTRIGGER_HAPPY23
 = 0x2d6,

3007 
	gTRIGGER_HAPPY24
 = 0x2d7,

3008 
	gTRIGGER_HAPPY25
 = 0x2d8,

3009 
	gTRIGGER_HAPPY26
 = 0x2d9,

3010 
	gTRIGGER_HAPPY27
 = 0x2da,

3011 
	gTRIGGER_HAPPY28
 = 0x2db,

3012 
	gTRIGGER_HAPPY29
 = 0x2dc,

3013 
	gTRIGGER_HAPPY30
 = 0x2dd,

3014 
	gTRIGGER_HAPPY31
 = 0x2de,

3015 
	gTRIGGER_HAPPY32
 = 0x2df,

3016 
	gTRIGGER_HAPPY33
 = 0x2e0,

3017 
	gTRIGGER_HAPPY34
 = 0x2e1,

3018 
	gTRIGGER_HAPPY35
 = 0x2e2,

3019 
	gTRIGGER_HAPPY36
 = 0x2e3,

3020 
	gTRIGGER_HAPPY37
 = 0x2e4,

3021 
	gTRIGGER_HAPPY38
 = 0x2e5,

3022 
	gTRIGGER_HAPPY39
 = 0x2e6,

3023 
	gTRIGGER_HAPPY40
 = 0x2e7,

3026 
	gc
.
	gREL
 = 
¡ræag
 {

3027 
X
 = 0x00,

3028 
	gY
 = 0x01,

3029 
	gZ
 = 0x02,

3030 
	gRX
 = 0x03,

3031 
	gRY
 = 0x04,

3032 
	gRZ
 = 0x05,

3033 
	gHWHEEL
 = 0x06,

3034 
	gDIAL
 = 0x07,

3035 
	gWHEEL
 = 0x08,

3036 
	gMISC
 = 0x09,

3037 
	gMAX
 = 0x0f,

3040 
	gc
.
	gABS
 = 
¡ræag
 {

3041 
X
 = 0x00,

3042 
	gY
 = 0x01,

3043 
	gZ
 = 0x02,

3044 
	gRX
 = 0x03,

3045 
	gRY
 = 0x04,

3046 
	gRZ
 = 0x05,

3047 
	gTHROTTLE
 = 0x06,

3048 
	gRUDDER
 = 0x07,

3049 
	gWHEEL
 = 0x08,

3050 
	gGAS
 = 0x09,

3051 
	gBRAKE
 = 0x0a,

3052 
	gHAT0X
 = 0x10,

3053 
	gHAT0Y
 = 0x11,

3054 
	gHAT1X
 = 0x12,

3055 
	gHAT1Y
 = 0x13,

3056 
	gHAT2X
 = 0x14,

3057 
	gHAT2Y
 = 0x15,

3058 
	gHAT3X
 = 0x16,

3059 
	gHAT3Y
 = 0x17,

3060 
	gPRESSURE
 = 0x18,

3061 
	gDISTANCE
 = 0x19,

3062 
	gTILT_X
 = 0x1a,

3063 
	gTILT_Y
 = 0x1b,

3064 
	gTOOL_WIDTH
 = 0x1c,

3065 
	gVOLUME
 = 0x20,

3066 
	gMISC
 = 0x28,

3067 
	gMT_SLOT
 = 0x2f,

3068 
	gMT_TOUCH_MAJOR
 = 0x30,

3069 
	gMT_TOUCH_MINOR
 = 0x31,

3070 
	gMT_WIDTH_MAJOR
 = 0x32,

3071 
	gMT_WIDTH_MINOR
 = 0x33,

3072 
	gMT_ORIENTATION
 = 0x34,

3073 
	gMT_POSITION_X
 = 0x35,

3074 
	gMT_POSITION_Y
 = 0x36,

3075 
	gMT_TOOL_TYPE
 = 0x37,

3076 
	gMT_BLOB_ID
 = 0x38,

3077 
	gMT_TRACKING_ID
 = 0x39,

3078 
	gMT_PRESSURE
 = 0x3a,

3079 
	gMT_DISTANCE
 = 0x3b,

3080 
	gMAX
 = 0x3f,

3083 
	gc
.
	gMSC
 = 
¡ræag
 {

3084 
SERIAL
 = 0x00,

3085 
	gPULSELED
 = 0x01,

3086 
	gGESTURE
 = 0x02,

3087 
	gRAW
 = 0x03,

3088 
	gSCAN
 = 0x04,

3089 
	gMAX
 = 0x07,

3092 
	gc
.
	gLED
 = 
¡ræag
 {

3093 
NUML
 = 0x00,

3094 
	gCAPSL
 = 0x01,

3095 
	gSCROLLL
 = 0x02,

3096 
	gCOMPOSE
 = 0x03,

3097 
	gKANA
 = 0x04,

3098 
	gSLEEP
 = 0x05,

3099 
	gSUSPEND
 = 0x06,

3100 
	gMUTE
 = 0x07,

3101 
	gMISC
 = 0x08,

3102 
	gMAIL
 = 0x09,

3103 
	gCHARGING
 = 0x0a,

3104 
	gMAX
 = 0x0f,

3107 
	gc
.
	gREP
 = 
¡ræag
 {

3108 
DELAY
 = 0x00,

3109 
	gPERIOD
 = 0x01,

3110 
	gMAX
 = 0x01,

3113 
	gc
.
	gSND
 = 
¡ræag
 {

3114 
CLICK
 = 0x00,

3115 
	gBELL
 = 0x01,

3116 
	gTONE
 = 0x02,

3117 
	gMAX
 = 0x07,

3120 
	gc
.
	gID
 = 
¡ræag
 {

3121 
BUS
 = 0,

3122 
	gVENDOR
 = 1,

3123 
	gPRODUCT
 = 2,

3124 
	gVERSION
 = 3,

3127 
	gc
.
	gBUS
 = 
¡ræag
 {

3128 
PCI
 = 0x01,

3129 
	gISAPNP
 = 0x02,

3130 
	gUSB
 = 0x03,

3131 
	gHIL
 = 0x04,

3132 
	gBLUETOOTH
 = 0x05,

3133 
	gVIRTUAL
 = 0x06,

3134 
	gISA
 = 0x10,

3135 
	gI8042
 = 0x11,

3136 
	gXTKBD
 = 0x12,

3137 
	gRS232
 = 0x13,

3138 
	gGAMEPORT
 = 0x14,

3139 
	gPARPORT
 = 0x15,

3140 
	gAMIGA
 = 0x16,

3141 
	gADB
 = 0x17,

3142 
	gI2C
 = 0x18,

3143 
	gHOST
 = 0x19,

3144 
	gGSC
 = 0x1A,

3145 
	gATARI
 = 0x1B,

3146 
	gSPI
 = 0x1C,

3149 
	gc
.
	gMT_TOOL
 = 
¡ræag
 {

3150 
FINGER
 = 0,

3151 
	gPEN
 = 1,

3152 
	gMAX
 = 1,

3155 
	gc
.
	gFF_STATUS
 = 
¡ræag
 {

3156 
STOPPED
 = 0x00,

3157 
	gPLAYING
 = 0x01,

3158 
	gMAX
 = 0x01,

3161 -- 
TODO
 
nÙe
 
the£
 
¬e
 
¥l™
 
što
 
difã»Á
 
ÿ‹gÜ›s
 
eg
 
	gEFFECT
, 
WAVEFORM
 
unş—r
 
how
 
be¡
 
to
 
hªdË
 (
FF_STATUS
 
too
?)

3162 
	gc
.
	gFF
 = 
¡ræag
 {

3163 -- 
EFFECT


3164 
RUMBLE
 = 0x50,

3165 
	gPERIODIC
 = 0x51,

3166 
	gCONSTANT
 = 0x52,

3167 
	gSPRING
 = 0x53,

3168 
	gFRICTION
 = 0x54,

3169 
	gDAMPER
 = 0x55,

3170 
	gINERTIA
 = 0x56,

3171 
	gRAMP
 = 0x57,

3172 -- 
WAVEFORM


3173 
	gSQUARE
 = 0x58,

3174 
	gTRIANGLE
 = 0x59,

3175 
	gSINE
 = 0x5a,

3176 
	gSAW_UP
 = 0x5b,

3177 
	gSAW_DOWN
 = 0x5c,

3178 
	gCUSTOM
 = 0x5d,

3179 -- 
dev
 
´İs


3180 
	gGAIN
 = 0x60,

3181 
	gAUTOCENTER
 = 0x61,

3184 -- 
”rÜs


3185 
	gc
.
	gE
 = 
¡ræag
(
¬ch
.
E
 
Ü
 {

3186 
PERM
 = 1,

3187 
NOENT
 = 2,

3188 
SRCH
 = 3,

3189 
INTR
 = 4,

3190 
IO
 = 5,

3191 
NXIO
 = 6,

3193 
NOEXEC
 = 8,

3194 
BADF
 = 9,

3195 
CHILD
 = 10,

3196 
AGAIN
 = 11,

3197 
NOMEM
 = 12,

3198 
ACCES
 = 13,

3199 
FAULT
 = 14,

3200 
NOTBLK
 = 15,

3201 
BUSY
 = 16,

3202 
EXIST
 = 17,

3203 
XDEV
 = 18,

3204 
NODEV
 = 19,

3205 
NOTDIR
 = 20,

3206 
ISDIR
 = 21,

3207 
INVAL
 = 22,

3208 
NFILE
 = 23,

3209 
MFILE
 = 24,

3210 
NOTTY
 = 25,

3211 
TXTBSY
 = 26,

3212 
FBIG
 = 27,

3213 
NOSPC
 = 28,

3214 
SPIPE
 = 29,

3215 
ROFS
 = 30,

3216 
MLINK
 = 31,

3217 
PIPE
 = 32,

3218 
DOM
 = 33,

3219 
RANGE
 = 34,

3220 
DEADLK
 = 35,

3221 
NAMETOOLONG
 = 36,

3222 
NOLCK
 = 37,

3223 
NOSYS
 = 38,

3224 
NOTEMPTY
 = 39,

3225 
LOOP
 = 40,

3226 
NOMSG
 = 42,

3227 
IDRM
 = 43,

3228 
CHRNG
 = 44,

3229 
L2NSYNC
 = 45,

3230 
L3HLT
 = 46,

3231 
L3RST
 = 47,

3232 
LNRNG
 = 48,

3233 
UNATCH
 = 49,

3234 
NOCSI
 = 50,

3235 
L2HLT
 = 51,

3236 
BADE
 = 52,

3237 
BADR
 = 53,

3238 
XFULL
 = 54,

3239 
NOANO
 = 55,

3240 
BADRQC
 = 56,

3241 
BADSLT
 = 57,

3242 
BFONT
 = 59,

3243 
NOSTR
 = 60,

3244 
NODATA
 = 61,

3245 
TIME
 = 62,

3246 
NOSR
 = 63,

3247 
NONET
 = 64,

3248 
NOPKG
 = 65,

3249 
REMOTE
 = 66,

3250 
NOLINK
 = 67,

3251 
ADV
 = 68,

3252 
SRMNT
 = 69,

3253 
COMM
 = 70,

3254 
PROTO
 = 71,

3255 
MULTIHOP
 = 72,

3256 
DOTDOT
 = 73,

3257 
BADMSG
 = 74,

3258 
OVERFLOW
 = 75,

3259 
NOTUNIQ
 = 76,

3260 
BADFD
 = 77,

3261 
REMCHG
 = 78,

3262 
LIBACC
 = 79,

3263 
LIBBAD
 = 80,

3264 
LIBSCN
 = 81,

3265 
LIBMAX
 = 82,

3266 
LIBEXEC
 = 83,

3267 
ILSEQ
 = 84,

3268 
RESTART
 = 85,

3269 
STRPIPE
 = 86,

3270 
USERS
 = 87,

3271 
NOTSOCK
 = 88,

3272 
DESTADDRREQ
 = 89,

3273 
MSGSIZE
 = 90,

3274 
PROTOTYPE
 = 91,

3275 
NOPROTOOPT
 = 92,

3276 
PROTONOSUPPORT
= 93,

3277 
SOCKTNOSUPPORT
= 94,

3278 
OPNOTSUPP
 = 95,

3279 
PFNOSUPPORT
 = 96,

3280 
AFNOSUPPORT
 = 97,

3281 
ADDRINUSE
 = 98,

3282 
ADDRNOTAVAIL
 = 99,

3283 
NETDOWN
 = 100,

3284 
NETUNREACH
 = 101,

3285 
NETRESET
 = 102,

3286 
CONNABORTED
 = 103,

3287 
CONNRESET
 = 104,

3288 
NOBUFS
 = 105,

3289 
ISCONN
 = 106,

3290 
NOTCONN
 = 107,

3291 
SHUTDOWN
 = 108,

3292 
TOOMANYREFS
 = 109,

3293 
TIMEDOUT
 = 110,

3294 
CONNREFUSED
 = 111,

3295 
HOSTDOWN
 = 112,

3296 
HOSTUNREACH
 = 113,

3297 
ALREADY
 = 114,

3298 
INPROGRESS
 = 115,

3299 
STALE
 = 116,

3300 
UCLEAN
 = 117,

3301 
NOTNAM
 = 118,

3302 
NAVAIL
 = 119,

3303 
ISNAM
 = 120,

3304 
REMOTEIO
 = 121,

3305 
DQUOT
 = 122,

3306 
NOMEDIUM
 = 123,

3307 
MEDIUMTYPE
 = 124,

3308 
CANCELED
 = 125,

3309 
NOKEY
 = 126,

3310 
KEYEXPIRED
 = 127,

3311 
KEYREVOKED
 = 128,

3312 
KEYREJECTED
 = 129,

3313 
OWNERDEAD
 = 130,

3314 
NOTRECOVERABLE
= 131,

3315 
RFKILL
 = 132,

3318 -- 
µc
 
Úly
 
»defšes
 
	gDEADLOCK
, 
ms
„edefše 
®l


3319 
	g¬ch
.
EDEADLOCK
 
th’
 
	gc
.
	gE
.
	gDEADLOCK
 = 
¬ch
.EDEADLOCK 
’d


3321 -- 
®‹º©e
 
Çmes


3322 
c
.
EALIAS
 = {

3323 
WOULDBLOCK
 = 
c
.
E
.
AGAIN
,

3324 
	gNOATTR
 = 
c
.
E
.
NODATA
,

3325 
	gNOTSUP
 = 
c
.
E
.
OPNOTSUPP
,

3327 -- 
mo¡
 
¬ch™eùu»s
 
this
 
is
 
ª
 
	g®Ÿs
, 
but
 
nÙ
 
	gµc
, 
ms


3328 
nÙ
 
	gc
.
	gE
.
DEADLOCK
 
th’
 c.
	gEALIAS
.
	gDEADLOCK
 = 
c
.
E
.
DEADLK
 
’d


3330 
c
.
SWAP_FLAG
 = 
sw­æags
 {

3331 
PREFER
 = 0x8000,

3332 
	gPRIO_MASK
 = 0x7fff,

3333 
	gPRIO_SHIFT
 = 0,

3334 
	gDISCARD
 = 0x10000,

3337 --
	gc
.
	gFUTEX
 =

3339 -- 
bËs
/
xbËs


3341 
c
.
NF
 = 
¡ræag
 {

3342 
DROP
 = 0,

3343 
	gACCEPT
 = 1,

3344 
	gSTOLEN
 = 2,

3345 
	gQUEUE
 = 3,

3346 
	gREPEAT
 = 4,

3347 
	gSTOP
 = 5,

3350 -- 
misc
 
	gv®ues
, 
ju¡
 
g©h”ed
 
š
 
a
 
bË
 
as
 
b‘‹r
 
Çme¥acšg


3351 
	gc
.
	gXT
 = 
¡ræag
 {

3352 
FUNCTION_MAXNAMELEN
 = 30,

3353 
	gEXTENSION_MAXNAMELEN
 = 29,

3354 
	gTABLE_MAXNAMELEN
 = 32,

3357 
loÿl
 
	gIPT_BASE_CTL
 = 64

3359 
c
.
IPT_SO_SET
 = 
¡ræag
 {

3360 
REPLACE
 = 
IPT_BASE_CTL
,

3361 
	gADD_COUNTERS
 = 
IPT_BASE_CTL
 + 1,

3364 
	gc
.
	gIPT_SO_GET
 = 
¡ræag
 {

3365 
INFO
 = 
IPT_BASE_CTL
,

3366 
	gENTRIES
 = 
IPT_BASE_CTL
 + 1,

3367 
	gREVISION_MATCH
 = 
IPT_BASE_CTL
 + 2,

3368 
	gREVISION_TARGET
 = 
IPT_BASE_CTL
 + 3,

3371 
	gc
.
	gSCHED
 = 
muÉiæags
 {

3372 
NORMAL
 = 0,

3373 
	gOTHER
 = 0,

3374 
	gFIFO
 = 1,

3375 
	gRR
 = 2,

3376 
	gBATCH
 = 3,

3377 -- 
ISO


3378 
	gIDLE
 = 5,

3379 
	gRESET_ON_FORK
 = 0x40000000, -- 
TODO
 
Úly
 
this
 
æag
 
ÿn
 
be
 
	gORed


3382 
	gc
.
	gTUN_READQ
 = 
¡ræag
 {

3383 
SIZE
 = 500,

3386 
	gc
.
	gTUN
 = 
muÉiæags
 {

3387 
TUN_DEV
 = 0x0001,

3388 
	gTAP_DEV
 = 0x0002,

3389 
	gTYPE_MASK
 = 0x000f,

3390 
	gFASYNC
 = 0x0010,

3391 
	gNOCHECKSUM
 = 0x0020,

3392 
	gNO_PI
 = 0x0040,

3393 
	gONE_QUEUE
 = 0x0080,

3394 
	gPERSIST
 = 0x0100,

3395 
	gVNET_HDR
 = 0x0200,

3396 
	gTAP_MQ
 = 0x0400,

3399 -- 
nÙe
 
th©
 
the£
 
¬e
 
IFF_
 
but
h© 
is
 
a
 
du¶iÿ‹d
 
´efix
 
so
 
usšg
 
	gthis
.

3400 -- 
The£
 
¬e
 
v®id
 
İtiÚs
 
iäeq
 
	gæags
, 
the
 
Ùh”
 
IFF_
‡» 
ifšfo


3401 
	gc
.
	gIFREQ
 = 
muÉiæags
 {

3402 -- 
tun
 
p
 
š‹rçûs


3403 
TUN
 = 0x0001,

3404 
	gTAP
 = 0x0002,

3405 
	gNO_PI
 = 0x1000,

3406 
	gONE_QUEUE
 = 0x2000,

3407 
	gVNET_HDR
 = 0x4000,

3408 
	gTUN_EXCL
 = 0x8000,

3409 
	gMULTI_QUEUE
 = 0x0100,

3410 
	gATTACH_QUEUE
 = 0x0200,

3411 
	gDETACH_QUEUE
 = 0x0400,

3412 -- 
bridge
 
š‹rçûs


3413 
	gSLAVE_NEEDARP
 = 0x40,

3414 
	gISATAP
 = 0x80,

3415 
	gMASTER_ARPMON
 = 0x100,

3416 
	gWAN_HDLC
 = 0x200,

3417 
	gXMIT_DST_RELEASE
 = 0x400,

3418 
	gDONT_BRIDGE
 = 0x800,

3419 
	gDISABLE_NETPOLL
 = 0x1000,

3420 
	gMACVLAN_PORT
 = 0x2000,

3421 
	gBRIDGE_PORT
 = 0x4000,

3422 
	gOVS_DATAPATH
 = 0x8000,

3423 
	gTX_SKB_SHARING
 = 0x10000,

3424 
	gUNICAST_FLT
 = 0x20000,

3427 
	gc
.
	gTUN_F
 = 
muÉiæags
 {

3428 
CSUM
 = 0x01,

3429 
	gTSO4
 = 0x02,

3430 
	gTSO6
 = 0x04,

3431 
	gTSO_ECN
 = 0x08,

3432 
	gUFO
 = 0x10,

3435 
	gc
.
	gTUN_PKT
 = 
¡ræag
 {

3436 
STRIP
 = 0x0001,

3439 
	gc
.
	gTUN_FLT
 = 
¡ræag
 {

3440 
ALLMULTI
 = 0x0001,

3443 
	gc
.
	gPC
 = 
¡ræag
 {

3444 
LINK_MAX
 = 0,

3445 
	gMAX_CANON
 = 1,

3446 
	gMAX_INPUT
 = 2,

3447 
	gNAME_MAX
 = 3,

3448 
	gPATH_MAX
 = 4,

3449 
	gPIPE_BUF
 = 5,

3450 
	gCHOWN_RESTRICTED
 = 6,

3451 
	gNO_TRUNC
 = 7,

3452 
	gVDISABLE
 = 8,

3453 
	gSYNC_IO
 = 9,

3454 
	gASYNC_IO
 = 10,

3455 
	gPRIO_IO
 = 11,

3456 
	gSOCK_MAXBUF
 = 12,

3457 
	gFILESIZEBITS
 = 13,

3458 
	gREC_INCR_XFER_SIZE
= 14,

3459 
	gREC_MAX_XFER_SIZE
 = 15,

3460 
	gREC_MIN_XFER_SIZE
 = 16,

3461 
	gREC_XFER_ALIGN
 = 17,

3462 
	gALLOC_SIZE_MIN
 = 18,

3463 
	gSYMLINK_MAX
 = 19,

3467 
	gc
.
	gRUSAGE
 = 
¡ræag
 {

3468 
SELF
 = 0,

3469 
	gCHILDREN
 = -1,

3470 
	gBOTH
 = -2,

3471 
	gTHREAD
 = 1,

3474 -- 
wa™pid
 
ªd
 
wa™4
 
pid


3475 
	gc
.
	gWAIT
 = 
¡ræag
 {

3476 
ANY
 = -1,

3477 
	gMYPGRP
 = 0,

3480 -- 
vœtio
 
funùiÚs


3481 
	gc
.
	gVIRTIO
 = 
¡ræag
 {

3482 
PCI_HOST_FEATURES
 = 0,

3483 
	gPCI_GUEST_FEATURES
 = 4,

3484 
	gPCI_QUEUE_PFN
 = 8,

3485 
	gPCI_QUEUE_NUM
 = 12,

3486 
	gPCI_QUEUE_SEL
 = 14,

3487 
	gPCI_QUEUE_NOTIFY
 = 16,

3488 
	gPCI_STATUS
 = 18,

3489 
	gPCI_ISR
 = 19,

3490 
	gPCI_ISR_CONFIG
 = 0x2,

3491 
	gMSI_CONFIG_VECTOR
 = 20,

3492 
	gMSI_QUEUE_VECTOR
 = 22,

3493 
	gMSI_NO_VECTOR
 = 0xffff,

3494 
	gPCI_ABI_VERSION
 = 0,

3495 
	gPCI_QUEUE_ADDR_SHIFT
 = 12,

3496 
	gPCI_VRING_ALIGN
 = 4096,

3497 -- 
TODO
 
VIRTIO_PCI_CONFIG_OFF
(
msix_’abËd
è((
	gmsix_’abËd
) ? 24 : 20)

3500 -- 
äom
 
lšux
/
pci_»gs
.
h


3501 
c
.
PCI
 = 
¡ræag
 {

3502 
VENDOR_ID
 = 0x00,

3503 
	gDEVICE_ID
 = 0x02,

3504 
	gCOMMAND
 = 0x04,

3505 
	gSTATUS
 = 0x06,

3506 
	gCLASS_REVISION
 = 0x08,

3507 
	gREVISION_ID
 = 0x08,

3508 
	gCLASS_PROG
 = 0x09,

3509 
	gCLASS_DEVICE
 = 0x0a,

3510 
	gCACHE_LINE_SIZE
 = 0x0c,

3511 
	gLATENCY_TIMER
 = 0x0d,

3512 
	gHEADER_TYPE
 = 0x0e,

3513 
	gCACHE_LINE_SIZE
 = 0x0c,

3514 
	gLATENCY_TIMER
 = 0x0d,

3515 
	gHEADER_TYPE
 = 0x0e,

3516 
	gBIST
 = 0x0f,

3517 
	gBASE_ADDRESS_0
 = 0x10,

3518 
	gBASE_ADDRESS_1
 = 0x14,

3519 
	gBASE_ADDRESS_2
 = 0x18,

3520 
	gBASE_ADDRESS_3
 = 0x1c,

3521 
	gBASE_ADDRESS_4
 = 0x20,

3522 
	gBASE_ADDRESS_5
 = 0x24,

3523 -- 
H—d”
 
	gty³
 0 (
	gNÜm®
)

3524 
	gCARDBUS_CIS
 = 0x28,

3525 
	gSUBSYSTEM_VENDOR_ID
= 0x2c,

3526 
	gSUBSYSTEM_ID
 = 0x2e,

3527 
	gROM_ADDRESS
 = 0x30,

3528 
	gCAPABILITY_LIST
 = 0x34,

3529 
	gINTERRUPT_LINE
 = 0x3c,

3530 
	gINTERRUPT_PIN
 = 0x3d,

3531 
	gMIN_GNT
 = 0x3e,

3532 
	gMAX_LAT
 = 0x3f,

3533 -- 
H—d”
 
	gty³
 1 (
	gPCI
-
	gto
-
PCI
 
	gbridges
)

3534 
	gPRIMARY_BUS
 = 0x18,

3535 
	gSECONDARY_BUS
 = 0x19,

3536 
	gSUBORDINATE_BUS
 = 0x1a,

3537 
	gSEC_LATENCY_TIMER
 = 0x1b,

3538 
	gIO_BASE
 = 0x1c,

3539 
	gIO_LIMIT
 = 0x1d,

3540 
	gSEC_STATUS
 = 0x1e,

3541 
	gMEMORY_BASE
 = 0x20,

3542 
	gMEMORY_LIMIT
 = 0x22,

3543 
	gPREF_MEMORY_BASE
 = 0x24,

3544 
	gPREF_MEMORY_LIMIT
 = 0x26,

3545 
	gPREF_BASE_UPPER32
 = 0x28,

3546 
	gPREF_LIMIT_UPPER32
 = 0x2c,

3547 
	gIO_BASE_UPPER16
 = 0x30,

3548 
	gIO_LIMIT_UPPER16
 = 0x32,

3549 
	gROM_ADDRESS1
 = 0x38,

3550 
	gBRIDGE_CONTROL
 = 0x3e,

3551 -- 
H—d”
 
	gty³
 2 (
C¬dBus
 
	gbridges
)

3552 
	gCB_CAPABILITY_LIST
 = 0x14,

3553 
	gCB_SEC_STATUS
 = 0x16,

3554 
	gCB_PRIMARY_BUS
 = 0x18,

3555 
	gCB_CARD_BUS
 = 0x19,

3556 
	gCB_SUBORDINATE_BUS
 = 0x1a,

3557 
	gCB_LATENCY_TIMER
 = 0x1b,

3558 
	gCB_MEMORY_BASE_0
 = 0x1c,

3559 
	gCB_MEMORY_LIMIT_0
 = 0x20,

3560 
	gCB_MEMORY_BASE_1
 = 0x24,

3561 
	gCB_MEMORY_LIMIT_1
 = 0x28,

3562 
	gCB_IO_BASE_0
 = 0x2c,

3563 
	gCB_IO_BASE_0_HI
 = 0x2e,

3564 
	gCB_IO_LIMIT_0
 = 0x30,

3565 
	gCB_IO_LIMIT_0_HI
 = 0x32,

3566 
	gCB_IO_BASE_1
 = 0x34,

3567 
	gCB_IO_BASE_1_HI
 = 0x36,

3568 
	gCB_IO_LIMIT_1
 = 0x38,

3569 
	gCB_IO_LIMIT_1_HI
 = 0x3a,

3570 
	gCB_BRIDGE_CONTROL
 = 0x3e,

3571 
	gCB_SUBSYSTEM_VENDOR_ID
 = 0x40,

3572 
	gCB_SUBSYSTEM_ID
 = 0x42,

3573 
	gCB_LEGACY_MODE_BASE
 = 0x44,

3576 -- 
unş—r
 
how
 
be¡
 
to
 
group
 
	gthe£
, 
maybe
 
ju¡
 
put
 
ev”ythšg
 
š
 
PCI
 
ªd
 
Ët
 
­p
 
fix
 
™


3577 
	gc
.
	gPCI_BASE_ADDRESS
 = 
¡ræag
 {

3578 
SPACE
 = 0x01,

3579 
	gSPACE_IO
 = 0x01,

3580 
	gSPACE_MEMORY
 = 0x00,

3581 
	gMEM_TYPE_MASK
 = 0x06,

3582 
	gMEM_TYPE_32
 = 0x00,

3583 
	gMEM_TYPE_1M
 = 0x02,

3584 
	gMEM_TYPE_64
 = 0x04,

3585 
	gMEM_PREFETCH
 = 0x08,

3586 --
MEM_MASK
 (~0x0fUL)

3587 --
IO_MASK
 (~0x03UL)

3590 
	gc
.
	gTCP
 = 
¡ræag
 {

3591 
NODELAY
 = 1,

3592 
	gMAXSEG
 = 2,

3593 
	gCORK
 = 3,

3594 
	gKEEPIDLE
 = 4,

3595 
	gKEEPINTVL
 = 5,

3596 
	gKEEPCNT
 = 6,

3597 
	gSYNCNT
 = 7,

3598 
	gLINGER2
 = 8,

3599 
	gDEFER_ACCEPT
 = 9,

3600 
	gWINDOW_CLAMP
 = 10,

3601 
	gINFO
 = 11,

3602 
	gQUICKACK
 = 12,

3603 
	gCONGESTION
 = 13,

3604 
	gMD5SIG
 = 14,

3605 
	gTHIN_LINEAR_TIMEOUTS
= 16,

3606 
	gTHIN_DUPACK
 = 17,

3607 
	gUSER_TIMEOUT
 = 18,

3608 
	gREPAIR
 = 19,

3609 
	gREPAIR_QUEUE
 = 20,

3610 
	gQUEUE_SEQ
 = 21,

3611 
	gREPAIR_OPTIONS
 = 22,

3612 
	gFASTOPEN
 = 23,

3613 
	gTIMESTAMP
 = 24,

3616 -- 
v6
 
sockİts


3617 
	gc
.
	gIPV6
 = 
¡ræag
 {

3618 
ADDRFORM
 = 1,

3624 
	gCHECKSUM
 = 7,

3626 
	gNEXTHOP
 = 9,

3627 
	gAUTHHDR
 = 10,

3628 
	gFLOWINFO
 = 11,

3629 
	gUNICAST_HOPS
 = 16,

3630 
	gMULTICAST_IF
 = 17,

3631 
	gMULTICAST_HOPS
 = 18,

3632 
	gMULTICAST_LOOP
 = 19,

3633 
	gADD_MEMBERSHIP
 = 20,

3634 
	gDROP_MEMBERSHIP
 = 21,

3635 
	gROUTER_ALERT
 = 22,

3636 
	gMTU_DISCOVER
 = 23,

3637 
	gMTU
 = 24,

3638 
	gRECVERR
 = 25,

3639 
	gV6ONLY
 = 26,

3640 
	gJOIN_ANYCAST
 = 27,

3641 
	gLEAVE_ANYCAST
 = 28,

3644 -- 
Ãed
 
to
 
u£
 
tob™
Ø
make
 
su»
 
w™hš
 
¿nge


3645 
	gc
.
	gLINUX_REBOOT
 = 
¡ræag
 {

3646 
MAGIC1
 = 
tob™
(0xfee1dead),

3647 
	gMAGIC2
 = 
tob™
(672274793),

3648 
	gMAGIC2A
 = 
tob™
(85072278),

3649 
	gMAGIC2B
 = 
tob™
(369367448),

3650 
	gMAGIC2C
 = 
tob™
(537993216),

3653 
	gc
.
	gGRND
 = 
muÉiæags
 {

3654 
NONBLOCK
 = 0x0001,

3655 
	gRANDOM
 = 0x0002,

3658 
	gc
.
	gMFD
 = 
muÉiæags
 {

3659 
CLOEXEC
 = 0x0001,

3660 
	gALLOW_SEALING
 = 0x0002,

3663  
	gc


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/errors.lua

1 -- 
Lšux
 
”rÜ
 
mes§ges


4 
	gPERM
 = "Operation‚ot…ermitted",

5 
	gNOENT
 = "No such file or directory",

6 
	gSRCH
 = "No such…rocess",

7 
	gINTR
 = "Interrupted system call",

8 
	gIO
 = "Input/outputƒrror",

9 
	gNXIO
 = "No such device or‡ddress",

11 
	gNOEXEC
 = "Exec formatƒrror",

12 
	gBADF
 = "Bad file descriptor",

13 
	gCHILD
 = "No child…rocesses",

14 
	gAGAIN
 = "Resourceemporarily unavailable",

15 
	gNOMEM
 = "Cannot‡llocate memory",

16 
	gACCES
 = "Permission denied",

17 
	gFAULT
 = "Bad‡ddress",

18 
	gNOTBLK
 = "Block device„equired",

19 
	gBUSY
 = "Device or„esource busy",

20 
	gEXIST
 = "Fileƒxists",

21 
	gXDEV
 = "Invalid cross-device†ink",

22 
	gNODEV
 = "No such device",

23 
	gNOTDIR
 = "Not‡ directory",

24 
	gISDIR
 = "Is‡ directory",

25 
	gINVAL
 = "Invalid‡rgument",

26 
	gNFILE
 = "Too many open files in system",

27 
	gMFILE
 = "Too many open files",

28 
	gNOTTY
 = "Inappropriate ioctl for device",

29 
	gTXTBSY
 = "Text file busy",

30 
	gFBIG
 = "Fileoo†arge",

31 
	gNOSPC
 = "No space†eft on device",

32 
	gSPIPE
 = "Illegal seek",

33 
	gROFS
 = "Read-only file system",

34 
	gMLINK
 = "Too many†inks",

35 
	gPIPE
 = "Broken…ipe",

36 
	gDOM
 = "Numerical‡rgument out of domain",

37 
	gRANGE
 = "Numerical„esult out of„ange",

38 
	gDEADLK
 = "Resource deadlock‡voided",

39 
	gNAMETOOLONG
 = "File‚ameoo†ong",

40 
	gNOLCK
 = "No†ocks‡vailable",

41 
	gNOSYS
 = "Function‚ot implemented",

42 
	gNOTEMPTY
 = "Directory‚otƒmpty",

43 
	gLOOP
 = "Too many†evels of symbolic†inks",

44 
	gNOMSG
 = "No message of desiredype",

45 
	gIDRM
 = "Identifier„emoved",

46 
	gCHRNG
 = "Channel‚umber out of„ange",

47 
	gL2NSYNC
 = "Level 2‚ot synchronized",

48 
	gL3HLT
 = "Level 3 halted",

49 
	gL3RST
 = "Level 3„eset",

50 
	gLNRNG
 = "Link‚umber out of„ange",

51 
	gUNATCH
 = "Protocol driver‚ot‡ttached",

52 
	gNOCSI
 = "No CSI structure‡vailable",

53 
	gL2HLT
 = "Level 2 halted",

54 
	gBADE
 = "Invalidƒxchange",

55 
	gBADR
 = "Invalid„equest descriptor",

56 
	gXFULL
 = "Exchange full",

57 
	gNOANO
 = "No‡node",

58 
	gBADRQC
 = "Invalid„equest code",

59 
	gBADSLT
 = "Invalid slot",

60 
	gBFONT
 = "Bad font file format",

61 
	gNOSTR
 = "Device‚ot‡ stream",

62 
	gNODATA
 = "No data‡vailable",

63 
	gTIME
 = "Timerƒxpired",

64 
	gNOSR
 = "Out of streams„esources",

65 
	gNONET
 = "Machine is‚ot onhe‚etwork",

66 
	gNOPKG
 = "Package‚ot installed",

67 
	gREMOTE
 = "Object is„emote",

68 
	gNOLINK
 = "Link has been severed",

69 
	gADV
 = "Advertiseƒrror",

70 
	gSRMNT
 = "Srmountƒrror",

71 
	gCOMM
 = "Communicationƒrror on send",

72 
	gPROTO
 = "Protocolƒrror",

73 
	gMULTIHOP
 = "Multihop‡ttempted",

74 
	gDOTDOT
 = "RFS specificƒrror",

75 
	gBADMSG
 = "Bad message",

76 
	gOVERFLOW
 = "Valueoo†arge for defined dataype",

77 
	gNOTUNIQ
 = "Name‚ot unique on‚etwork",

78 
	gBADFD
 = "File descriptor in bad state",

79 
	gREMCHG
 = "Remote‡ddress changed",

80 
	gLIBACC
 = "Can‚ot‡ccess‡‚eeded shared†ibrary",

81 
	gLIBBAD
 = "Accessing‡ corrupted shared†ibrary",

82 
	gLIBSCN
 = ".lib section in‡.out corrupted",

83 
	gLIBMAX
 = "Attemptingo†ink inoo many shared†ibraries",

84 
	gLIBEXEC
 = "Cannotƒxec‡ shared†ibrary directly",

85 
	gILSEQ
 = "Invalid or incomplete multibyte or wide character",

86 
	gRESTART
 = "Interrupted system call should be„estarted",

87 
	gSTRPIPE
 = "Streams…ipeƒrror",

88 
	gUSERS
 = "Too many users",

89 
	gNOTSOCK
 = "Socket operation on‚on-socket",

90 
	gDESTADDRREQ
 = "Destination‡ddress„equired",

91 
	gMSGSIZE
 = "Messageoo†ong",

92 
	gPROTOTYPE
 = "Protocol wrongype for socket",

93 
	gNOPROTOOPT
 = "Protocol‚ot‡vailable",

94 
	gPROTONOSUPPORT
 = "Protocol‚ot supported",

95 
	gSOCKTNOSUPPORT
 = "Socketype‚ot supported",

96 
	gOPNOTSUPP
 = "Operation‚ot supported",

97 
	gPFNOSUPPORT
 = "Protocol family‚ot supported",

98 
	gAFNOSUPPORT
 = "Address family‚ot supported by…rotocol",

99 
	gADDRINUSE
 = "Address‡lready in use",

100 
	gADDRNOTAVAIL
 = "Cannot‡ssign„equested‡ddress",

101 
	gNETDOWN
 = "Network is down",

102 
	gNETUNREACH
 = "Network is unreachable",

103 
	gNETRESET
 = "Network dropped connection on„eset",

104 
	gCONNABORTED
 = "Software caused connection‡bort",

105 
	gCONNRESET
 = "Connection„eset by…eer",

106 
	gNOBUFS
 = "No buffer space‡vailable",

107 
	gISCONN
 = "Transportƒndpoint is‡lready connected",

108 
	gNOTCONN
 = "Transportƒndpoint is‚ot connected",

109 
	gSHUTDOWN
 = "Cannot send‡fterransportƒndpoint shutdown",

110 
	gTOOMANYREFS
 = "Too many„eferences: cannot splice",

111 
	gTIMEDOUT
 = "Connectionimed out",

112 
	gCONNREFUSED
 = "Connection„efused",

113 
	gHOSTDOWN
 = "Host is down",

114 
	gHOSTUNREACH
 = "No„outeo host",

115 
	gALREADY
 = "Operation‡lready in…rogress",

116 
	gINPROGRESS
 = "Operation‚ow in…rogress",

117 
	gSTALE
 = "Stale NFS file handle",

118 
	gUCLEAN
 = "Structure‚eeds cleaning",

119 
	gNOTNAM
 = "Not‡ XENIX‚amedype file",

120 
	gNAVAIL
 = "No XENIX semaphores‡vailable",

121 
	gISNAM
 = "Is‡‚amedype file",

122 
	gREMOTEIO
 = "Remote I/Oƒrror",

123 
	gDQUOT
 = "Disk quotaƒxceeded",

124 
	gNOMEDIUM
 = "No medium found",

125 
	gMEDIUMTYPE
 = "Wrong mediumype",

126 
	gCANCELED
 = "Operation canceled",

127 
	gNOKEY
 = "Required key‚ot‡vailable",

128 
	gKEYEXPIRED
 = "Key hasƒxpired",

129 
	gKEYREVOKED
 = "Key has been„evoked",

130 
	gKEYREJECTED
 = "Key was„ejected by service",

131 
	gOWNERDEAD
 = "Owner died",

132 
	gNOTRECOVERABLE
 = "State‚ot„ecoverable",

133 
	gRFKILL
 = "Operation‚ot…ossible dueo RF-kill",

134 -- 
Úly
 
Ú
 
some
 
¶©fÜms


135 
	gDEADLOCK
 = "File†ocking deadlockƒrror",

136 
	gINIT
 = "Re£rved EINIT", -- 
wh©
 
is
 
cÜ»ù
 
	gmes§ge
?

137 
	gREMDEV
 = "RemÙdeviû", -- 
wh©
 
is
 
cÜ»ù
 
	gmes§ge
?

138 
	gHWPOISON
 = "Re£rved EHWPOISON", -- 
wh©
 
is
 
cÜ»ù
 
	gmes§ge
?

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/fcntl.lua

1 -- 
fú
 
is
 
Úe
 
of
 
tho£
 
b™s
 oà
the
 
Unix
 
API
 
th©
 i 
a
 
b™
 
	g¿ndom
, 
so
 
give
 
™
 
™s
 
own
 
fe


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
c
 = 
»quœe
 "syscall.linux.constants"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

16 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

18 
loÿl
 
fú
 = {

19 
commªds
 = {

20 [
c
.
F
.
SETFL
] = 
	`funùiÚ
(
¬g
è c.
O
[¬g] 
’d
,

21 [
c
.
F
.
SETFD
] = 
	`funùiÚ
(
¬g
è c.
FD
[¬g] 
’d
,

22 [
c
.
F
.
GETLK
] = 
t
.
æock
,

23 [
c
.
F
.
SETLK
] = 
t
.
æock
,

24 [
c
.
F
.
SETLKW
] = 
t
.
æock
,

26 
»t
 = {

27 [
c
.
F
.
DUPFD
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

28 [
c
.
F
.
DUPFD_CLOEXEC
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

29 [
c
.
F
.
GETFD
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

30 [
c
.
F
.
GETFL
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

31 [
c
.
F
.
GETLEASE
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

32 [
c
.
F
.
GETOWN
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

33 [
c
.
F
.
GETSIG
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

34 [
c
.
F
.
GETPIPE_SZ
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

35 [
c
.
F
.
GETLK
] = 
	`funùiÚ
(
»t
, 
¬g
è‡rg 
’d
,

37 
	}
}

39  
fú


41 
’d


43  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ffi.lua

1 -- 
ffi
 
defš™iÚs
 
of
 
Lšux
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "syscall.ffitypes"

16 
loÿl
 
¬ch
 = 
»quœe
("sysÿÎ.lšux." .. 
abi
.¬ch .. ".ffi"è-- 
¬ch™eùu»
 
¥ecific
 
defš™iÚs


18 
loÿl
 
defs
 = {}

20 
loÿl
 
funùiÚ
 
	$­³nd
(
¡r
è
defs
[#def + 1] = sŒ 
’d


22 
­³nd
 [[

23 
ušt32_t
 
mode_t
;

24 
§_çmy_t
;

25 
ušt64_t
 
¾im64_t
;

26 
Æšk_t
;

27 
šo_t
;

28 
time_t
;

29 
št32_t
 
daddr_t
;

30 
blkút_t
;

31 
blksize_t
;

32 
št32_t
 
şockid_t
;

33 
şock_t
;

34 
ušt32_t
 
off32_t
;

35 
ušt32_t
 
Ë32
;

36 
ušt32_t
 
id_t
;

37 
tcæag_t
;

38 
¥“d_t
;

39 
tim”_t
;

40 
ušt64_t
 
fsblkút_t
;

41 
ušt64_t
 
fsfút_t
;

44 
ušt32_t
 
dev_t
;

46 
aio_cÚ‹xt_t
;

47 
nfds_t
;

50 
št32_t
 
fd_mask
;

55 
	sıu_£t_t
 {

56 
št32_t
 
v®
[1024 / (8 *  (int32_t))];

59 
	tmqd_t
;

60 
	tidty³_t
;

62 
	stime¥ec
 {

63 
time_t
 
tv_£c
;

64 
tv_n£c
;

68 (*
	tsighªdËr_t
) ();

71 
	stimev®
 {

72 
tv_£c
;

73 
tv_u£c
;

75 
	s™im”¥ec
 {

76 
time¥ec
 
™_š‹rv®
;

77 
time¥ec
 
™_v®ue
;

79 
	s™im”v®
 {

80 
timev®
 
™_š‹rv®
;

81 
timev®
 
™_v®ue
;

83 
	s__fsid_t
 {

84 
__v®
[2];

85 } 
	tfsid_t
;

87 
	sut¢ame
 {

88 
sy¢ame
[65];

89 
nod’ame
[65];

90 
»Ëa£
[65];

91 
v”siÚ
[65];

92 
machše
[65];

93 
domašÇme
[65];

95 
	spŞlfd
 {

96 
fd
;

97 
ev’ts
;

98 
»v’ts
;

101 
fd_mask
 
fds_b™s
[1024 / ( (fd_mask) * 8)];

102 } 
	tfd_£t
;

103 
	suüed
 {

104 
pid_t
 
pid
;

105 
uid_t
 
uid
;

106 
gid_t
 
gid
;

108 
	s¾im™64
 {

109 
¾im64_t
 
¾im_cur
;

110 
¾im64_t
 
¾im_max
;

112 
	ssysšfo
 {

113 
u±ime
;

114 
lßds
[3];

115 
tÙ®¿m
;

116 
ä“¿m
;

117 
sh¬ed¿m
;

118 
bufã¼am
;

119 
tÙ®sw­
;

120 
ä“sw­
;

121 
´ocs
;

122 
·d
;

123 
tÙ®high
;

124 
ä“high
;

125 
mem_un™
;

126 
_f
[20-2*()-()];

128 
	stimex
 {

129 
modes
;

130 
off£t
;

131 
äeq
;

132 
max”rÜ
;

133 
e¡”rÜ
;

134 
¡©us
;

135 
cÚ¡ªt
;

136 
´ecisiÚ
;

137 
tŞ”ªû
;

138 
timev®
 
time
;

139 
tick
;

141 
µsäeq
;

142 
j™‹r
;

143 
shiá
;

144 
¡ab
;

145 
j™út
;

146 
ÿlút
;

147 
”rút
;

148 
¡bút
;

150 
i
;

156 
	usigv®
 {

157 
siv®_št
;

158 *
siv®_±r
;

159 } 
	tsigv®_t
;

160 
	scmsghdr
 {

161 
size_t
 
cmsg_Ën
;

162 
cmsg_Ëv–
;

163 
cmsg_ty³
;

164 
cmsg_d©a
[?];

166 
	smsghdr
 {

167 *
msg_Çme
;

168 
sockËn_t
 
msg_Çm–’
;

169 
iovec
 *
msg_iov
;

170 
size_t
 
msg_iovËn
;

171 *
msg_cÚŒŞ
;

172 
size_t
 
msg_cÚŒŞËn
;

173 
msg_æags
;

175 
	smmsghdr
 {

176 
msghdr
 
msg_hdr
;

177 
msg_Ën
;

179 
	ssockaddr
 {

180 
§_çmy_t
 
§_çmy
;

181 
§_d©a
[14];

183 
	ssockaddr_¡Üage
 {

184 
§_çmy_t
 
ss_çmy
;

185 
__ss_®ign
;

186 
__ss_·ddšg
[128 - 2 * ()];

188 
	ssockaddr_š
 {

189 
§_çmy_t
 
sš_çmy
;

190 
š_pÜt_t
 
sš_pÜt
;

191 
š_addr
 
sš_addr
;

192 
sš_z”o
[8];

194 
	ssockaddr_š6
 {

195 
§_çmy_t
 
sš6_çmy
;

196 
š_pÜt_t
 
sš6_pÜt
;

197 
ušt32_t
 
sš6_æowšfo
;

198 
š6_addr
 
sš6_addr
;

199 
ušt32_t
 
sš6_scİe_id
;

201 
	ssockaddr_un
 {

202 
§_çmy_t
 
sun_çmy
;

203 
sun_·th
[108];

205 
	ssockaddr_Æ
 {

206 
§_çmy_t
 
Æ_çmy
;

207 
Æ_·d
;

208 
ušt32_t
 
Æ_pid
;

209 
ušt32_t
 
Æ_groups
;

211 
	ssockaddr_Î
 {

212 
¦l_çmy
;

213 
¦l_´ÙocŞ
;

214 
¦l_ifšdex
;

215 
¦l_h©y³
;

216 
¦l_pk‰y³
;

217 
¦l_h®’
;

218 
¦l_addr
[8];

220 
	sÆmsghdr
 {

221 
ušt32_t
 
Æmsg_Ën
;

222 
ušt16_t
 
Æmsg_ty³
;

223 
ušt16_t
 
Æmsg_æags
;

224 
ušt32_t
 
Æmsg_£q
;

225 
ušt32_t
 
Æmsg_pid
;

227 
	s¹g’msg
 {

228 
¹g’_çmy
;

230 
	sifšfomsg
 {

231 
ifi_çmy
;

232 
__ifi_·d
;

233 
ifi_ty³
;

234 
ifi_šdex
;

235 
ifi_æags
;

236 
ifi_chªge
;

238 
	s¹©Œ
 {

239 
¹a_Ën
;

240 
¹a_ty³
;

242 
	sÆmsg”r
 {

243 
”rÜ
;

244 
Æmsghdr
 
msg
;

246 
	s¹msg
 {

247 
¹m_çmy
;

248 
¹m_d¡_Ën
;

249 
¹m_¤c_Ën
;

250 
¹m_tos
;

251 
¹m_bË
;

252 
¹m_´ÙocŞ
;

253 
¹m_scİe
;

254 
¹m_ty³
;

255 
¹m_æags
;

258 cÚ¡ 
IFNAMSIZ
 = 16;

260 
	sifm­
 {

261 
mem_¡¬t
;

262 
mem_’d
;

263 
ba£_addr
;

264 
œq
;

265 
dma
;

266 
pÜt
;

268 
	s¹Æ_lšk_¡©s
 {

269 
ušt32_t
 
rx_·ck‘s
;

270 
ušt32_t
 
tx_·ck‘s
;

271 
ušt32_t
 
rx_by‹s
;

272 
ušt32_t
 
tx_by‹s
;

273 
ušt32_t
 
rx_”rÜs
;

274 
ušt32_t
 
tx_”rÜs
;

275 
ušt32_t
 
rx_drİ³d
;

276 
ušt32_t
 
tx_drİ³d
;

277 
ušt32_t
 
muÉiÿ¡
;

278 
ušt32_t
 
cŞlisiÚs
;

279 
ušt32_t
 
rx_Ëngth_”rÜs
;

280 
ušt32_t
 
rx_ov”_”rÜs
;

281 
ušt32_t
 
rx_üc_”rÜs
;

282 
ušt32_t
 
rx_äame_”rÜs
;

283 
ušt32_t
 
rx_fifo_”rÜs
;

284 
ušt32_t
 
rx_mis£d_”rÜs
;

285 
ušt32_t
 
tx_abÜ‹d_”rÜs
;

286 
ušt32_t
 
tx_ÿ¼›r_”rÜs
;

287 
ušt32_t
 
tx_fifo_”rÜs
;

288 
ušt32_t
 
tx_h—¹b—t_”rÜs
;

289 
ušt32_t
 
tx_wšdow_”rÜs
;

290 
ušt32_t
 
rx_com´es£d
;

291 
ušt32_t
 
tx_com´es£d
;

293 
	sndmsg
 {

294 
ušt8_t
 
ndm_çmy
;

295 
ušt8_t
 
ndm_·d1
;

296 
ušt16_t
 
ndm_·d2
;

297 
št32_t
 
ndm_ifšdex
;

298 
ušt16_t
 
ndm_¡©e
;

299 
ušt8_t
 
ndm_æags
;

300 
ušt8_t
 
ndm_ty³
;

302 
	snda_ÿchešfo
 {

303 
ušt32_t
 
ndm_cÚfœmed
;

304 
ušt32_t
 
ndm_u£d
;

305 
ušt32_t
 
ndm_upd©ed
;

306 
ušt32_t
 
ndm_»fút
;

308 
	sndt_¡©s
 {

309 
ušt64_t
 
ndts_®locs
;

310 
ušt64_t
 
ndts_de¡roys
;

311 
ušt64_t
 
ndts_hash_grows
;

312 
ušt64_t
 
ndts_»s_çed
;

313 
ušt64_t
 
ndts_lookups
;

314 
ušt64_t
 
ndts_h™s
;

315 
ušt64_t
 
ndts_rcv_´obes_mÿ¡
;

316 
ušt64_t
 
ndts_rcv_´obes_uÿ¡
;

317 
ušt64_t
 
ndts_³riodic_gc_runs
;

318 
ušt64_t
 
ndts_fÜûd_gc_runs
;

320 
	sndtmsg
 {

321 
ušt8_t
 
ndtm_çmy
;

322 
ušt8_t
 
ndtm_·d1
;

323 
ušt16_t
 
ndtm_·d2
;

325 
	sndt_cÚfig
 {

326 
ušt16_t
 
ndtc_key_Ën
;

327 
ušt16_t
 
ndtc_’Œy_size
;

328 
ušt32_t
 
ndtc_’Œ›s
;

329 
ušt32_t
 
ndtc_Ï¡_æush
;

330 
ušt32_t
 
ndtc_Ï¡_¿nd
;

331 
ušt32_t
 
ndtc_hash_ºd
;

332 
ušt32_t
 
ndtc_hash_mask
;

333 
ušt32_t
 
ndtc_hash_chaš_gc
;

334 
ušt32_t
 
ndtc_´oxy_qËn
;

337 
şock_¿‹
;

338 
şock_ty³
;

339 
loİback
;

340 } 
	tsync_£rŸl_£‰šgs
;

342 
şock_¿‹
;

343 
şock_ty³
;

344 
loİback
;

345 
¦Ù_m­
;

346 } 
	t‹1_£‰šgs
;

348 
’codšg
;

349 
·r™y
;

350 } 
	t¿w_hdlc_´Ùo
;

352 
t391
;

353 
t392
;

354 
n391
;

355 
n392
;

356 
n393
;

357 
lmi
;

358 
dû
;

359 } 
	tä_´Ùo
;

361 
dlci
;

362 } 
	tä_´Ùo_pvc
;

364 
dlci
;

365 
ma¡”
[
IFNAMSIZ
];

366 } 
	tä_´Ùo_pvc_šfo
;

368 
š‹rv®
;

369 
timeout
;

370 } 
	tcisco_´Ùo
;

371 
	sif_£‰šgs
 {

372 
ty³
;

373 
size
;

375 
¿w_hdlc_´Ùo
 *
¿w_hdlc
;

376 
cisco_´Ùo
 *
cisco
;

377 
ä_´Ùo
 *
ä
;

378 
ä_´Ùo_pvc
 *
ä_pvc
;

379 
ä_´Ùo_pvc_šfo
 *
ä_pvc_šfo
;

381 
sync_£rŸl_£‰šgs
 *
sync
;

382 
‹1_£‰šgs
 *
‹1
;

383 } 
ifs_ifsu
;

385 
	siäeq
 {

387 
iän_Çme
[
IFNAMSIZ
];

388 } 
iä_iän
;

390 
sockaddr
 
iäu_addr
;

391 
sockaddr
 
iäu_d¡addr
;

392 
sockaddr
 
iäu_brßdaddr
;

393 
sockaddr
 
iäu_Ãtmask
;

394 
sockaddr
 
iäu_hwaddr
;

395 
iäu_æags
;

396 
iäu_iv®ue
;

397 
iäu_mtu
;

398 
ifm­
 
iäu_m­
;

399 
iäu_¦ave
[
IFNAMSIZ
];

400 
iäu_ÃwÇme
[
IFNAMSIZ
];

401 * 
iäu_d©a
;

402 
if_£‰šgs
 
iäu_£‰šgs
;

403 } 
iä_iäu
;

405 
	siçddrmsg
 {

406 
ušt8_t
 
iç_çmy
;

407 
ušt8_t
 
iç_´efixËn
;

408 
ušt8_t
 
iç_æags
;

409 
ušt8_t
 
iç_scİe
;

410 
ušt32_t
 
iç_šdex
;

412 
	siç_ÿchešfo
 {

413 
ušt32_t
 
iç_´eã»d
;

414 
ušt32_t
 
iç_v®id
;

415 
ušt32_t
 
c¡amp
;

416 
ušt32_t
 
t¡amp
;

418 
	s¹a_ÿchešfo
 {

419 
ušt32_t
 
¹a_şÁ»f
;

420 
ušt32_t
 
¹a_Ï¡u£
;

421 
ušt32_t
 
¹a_expœes
;

422 
ušt32_t
 
¹a_”rÜ
;

423 
ušt32_t
 
¹a_u£d
;

424 
ušt32_t
 
¹a_id
;

425 
ušt32_t
 
¹a_ts
;

426 
ušt32_t
 
¹a_t§ge
;

428 
	sfdb_’Œy
 {

429 
ušt8_t
 
mac_addr
[6];

430 
ušt8_t
 
pÜt_no
;

431 
ušt8_t
 
is_loÿl
;

432 
ušt32_t
 
agešg_tim”_v®ue
;

433 
ušt8_t
 
pÜt_hi
;

434 
ušt8_t
 
·d0
;

435 
ušt16_t
 
unu£d
;

437 
	sšÙify_ev’t
 {

438 
wd
;

439 
ušt32_t
 
mask
;

440 
ušt32_t
 
cook›
;

441 
ušt32_t
 
Ën
;

442 
Çme
[?];

444 
	slšux_dœ’t64
 {

445 
ušt64_t
 
d_šo
;

446 
št64_t
 
d_off
;

447 
d_»ş’
;

448 
d_ty³
;

449 
d_Çme
[0];

451 
	sæock64
 {

452 
l_ty³
;

453 
l_wh’û
;

454 
off_t
 
l_¡¬t
;

455 
off_t
 
l_Ën
;

456 
pid_t
 
l_pid
;

458 
	u•Şl_d©a
 {

459 *
±r
;

460 
fd
;

461 
ušt32_t
 
u32
;

462 
ušt64_t
 
u64
;

463 } 
	t•Şl_d©a_t
;

464 
	ssigÇlfd_sigšfo
 {

465 
ušt32_t
 
ssi_signo
;

466 
št32_t
 
ssi_”ºo
;

467 
št32_t
 
ssi_code
;

468 
ušt32_t
 
ssi_pid
;

469 
ušt32_t
 
ssi_uid
;

470 
št32_t
 
ssi_fd
;

471 
ušt32_t
 
ssi_tid
;

472 
ušt32_t
 
ssi_bªd
;

473 
ušt32_t
 
ssi_ov”run
;

474 
ušt32_t
 
ssi_Œ­no
;

475 
št32_t
 
ssi_¡©us
;

476 
št32_t
 
ssi_št
;

477 
ušt64_t
 
ssi_±r
;

478 
ušt64_t
 
ssi_utime
;

479 
ušt64_t
 
ssi_¡ime
;

480 
ušt64_t
 
ssi_addr
;

481 
ušt8_t
 
__·d
[48];

483 
	sio_ev’t
 {

484 
ušt64_t
 
d©a
;

485 
ušt64_t
 
obj
;

486 
št64_t
 
»s
;

487 
št64_t
 
»s2
;

489 
	s£ccomp_d©a
 {

490 
Ä
;

491 
ušt32_t
 
¬ch
;

492 
ušt64_t
 
š¡ruùiÚ_poš‹r
;

493 
ušt64_t
 
¬gs
[6];

495 
	ssock_f‹r
 {

496 
ušt16_t
 
code
;

497 
ušt8_t
 
jt
;

498 
ušt8_t
 
jf
;

499 
ušt32_t
 
k
;

501 
	sbpf_š¢_sysÿÎ
 {

502 
ušt8_t
 
code
;

503 
ušt8_t
 
d¡_»g
:4;

504 
ušt8_t
 
¤c_»g
:4;

505 
ušt16_t
 
off
;

506 
ušt32_t
 
imm
;

508 
	ssock_årog
 {

509 
Ën
;

510 
sock_f‹r
 *
f‹r
;

512 
	ubpf_©Œ
 {

514 
ušt32_t
 
m­_ty³
;

515 
ušt32_t
 
key_size
;

516 
ušt32_t
 
v®ue_size
;

517 
ušt32_t
 
max_’Œ›s
;

520 
ušt32_t
 
m­_fd
;

521 
ušt64_t
 
key
 
	`__©Œibu‹__
((
	`®igÃd
(8)));

523 
ušt64_t
 
v®ue
 
	`__©Œibu‹__
((
	`®igÃd
(8)));

524 
ušt64_t
 
Ãxt_key
 
	`__©Œibu‹__
((
	`®igÃd
(8)));

526 
ušt64_t
 
æags
;

529 
ušt32_t
 
´og_ty³
;

530 
ušt32_t
 
š¢_út
;

531 
ušt64_t
 
š¢s
 
	`__©Œibu‹__
((
	`®igÃd
(8)));

532 
ušt64_t
 
liûn£
 
	`__©Œibu‹__
((
	`®igÃd
(8)));

533 
ušt32_t
 
log_Ëv–
;

534 
ušt32_t
 
log_size
;

535 
ušt64_t
 
log_buf
 
	`__©Œibu‹__
((
	`®igÃd
(8)));

536 
ušt32_t
 
k”n_v”siÚ
;

539 
ušt64_t
 
·thÇme
 
	`__©Œibu‹__
((
	`®igÃd
(8)));

540 
ušt32_t
 
bpf_fd
;

542 } 
	`__©Œibu‹__
((
	`®igÃd
(8)));

543 
	s³rf_ev’t_©Œ
 {

544 
ušt32_t
 
³_ty³
;

545 
ušt32_t
 
size
;

546 
ušt64_t
 
³_cÚfig
;

548 
ušt64_t
 
§m¶e_³riod
;

549 
ušt64_t
 
§m¶e_äeq
;

551 
ušt64_t
 
³_§m¶e_ty³
;

552 
ušt64_t
 
»ad_fÜm©
;

553 
ušt32_t
 
di§bËd
:1,

554 
šh”™
:1,

555 
pšÃd
:1,

556 
exşusive
:1,

557 
exşude_u£r
:1,

558 
exşude_k”Ãl
:1,

559 
exşude_hv
:1,

560 
exşude_idË
:1,

561 
mm­
:1,

562 
comm
:1,

563 
äeq
:1,

564 
šh”™_¡©
:1,

565 
’abË_Ú_exec
:1,

566 
sk
:1,

567 
w©”m¬k
:1,

568 
´eci£_
:2,

569 
mm­_d©a
:1,

570 
§m¶e_id_®l
:1,

571 
exşude_ho¡
:1,

572 
exşude_gue¡
:1,

573 
exşude_ÿÎchaš_k”Ãl
:1,

574 
exşude_ÿÎchaš_u£r
:1,

575 
mm­2
:1,

576 
comm_exec
:1,

577 
u£_şockid
:1,

578 
__»£rved_1a
:6;

579 
ušt32_t
 
__»£rved_1b
;

581 
ušt32_t
 
wakeup_ev’ts
;

582 
ušt32_t
 
wakeup_w©”m¬k
;

584 
ušt32_t
 
bp_ty³
;

586 
ušt64_t
 
bp_addr
;

587 
ušt64_t
 
cÚfig1
;

590 
ušt64_t
 
bp_Ën
;

591 
ušt64_t
 
cÚfig2
;

593 
ušt64_t
 
b¿nch_§m¶e_ty³
;

594 
ušt64_t
 
§m¶e_»gs_u£r
;

595 
ušt32_t
 
§m¶e_¡ack_u£r
;

596 
št32_t
 
şockid
;

597 
ušt64_t
 
§m¶e_»gs_šŒ
;

598 
ušt32_t
 
aux_w©”m¬k
;

599 
ušt32_t
 
__»£rved_2
;

601 
	s³rf_ev’t_mm­_·ge
 {

602 
ušt32_t
 
v”siÚ
;

603 
ušt32_t
 
com·t_v”siÚ
;

604 
ušt32_t
 
lock
;

605 
ušt32_t
 
šdex
;

606 
št64_t
 
off£t
;

607 
ušt64_t
 
time_’abËd
;

608 
ušt64_t
 
time_ruÂšg
;

610 
ušt64_t
 
ÿ·b™›s
;

612 
ušt32_t
 
ÿp_b™0
 : 1,

613 
ÿp_b™0_is_d•»ÿ‹d
 : 1,

614 
ÿp_u£r_rdpmc
 : 1,

615 
ÿp_u£r_time
 : 1,

616 
ÿp_u£r_time_z”o
 : 1;

619 
ušt16_t
 
pmc_width
;

620 
ušt16_t
 
time_shiá
;

621 
ušt32_t
 
time_muÉ
;

622 
ušt64_t
 
time_off£t
;

623 
ušt64_t
 
__»£rved
[120];

624 vŞ©
ušt64_t
 
d©a_h—d
;

625 vŞ©
ušt64_t
 
d©a_
;

626 vŞ©
ušt64_t
 
d©a_off£t
;

627 vŞ©
ušt64_t
 
d©a_size
;

628 
ušt64_t
 
aux_h—d
;

629 
ušt64_t
 
aux_
;

630 
ušt64_t
 
aux_off£t
;

631 
ušt64_t
 
aux_size
;

633 
	s³rf_ev’t_h—d”
 {

634 
ušt32_t
 
ty³
;

635 
ušt16_t
 
misc
;

636 
ušt16_t
 
size
;

638 
	smq_©Œ
 {

639 
mq_æags
, 
mq_maxmsg
, 
mq_msgsize
, 
mq_curmsgs
, 
__unu£d
[4];

641 
	s‹rmios2
 {

642 
tcæag_t
 
c_iæag
;

643 
tcæag_t
 
c_oæag
;

644 
tcæag_t
 
c_cæag
;

645 
tcæag_t
 
c_læag
;

646 
cc_t
 
c_lše
;

647 
cc_t
 
c_cc
[19];

648 
¥“d_t
 
c_i¥“d
;

649 
¥“d_t
 
c_o¥“d
;

651 
	sšput_ev’t
 {

652 
timev®
 
time
;

653 
ušt16_t
 
ty³
;

654 
ušt16_t
 
code
;

655 
št32_t
 
v®ue
;

657 
	sšput_id
 {

658 
ušt16_t
 
bu¡y³
;

659 
ušt16_t
 
v’dÜ
;

660 
ušt16_t
 
´oduù
;

661 
ušt16_t
 
v”siÚ
;

663 
	sšput_absšfo
 {

664 
št32_t
 
v®ue
;

665 
št32_t
 
mšimum
;

666 
št32_t
 
maximum
;

667 
št32_t
 
fuzz
;

668 
št32_t
 
æ©
;

669 
št32_t
 
»sŞutiÚ
;

671 
	sšput_keym­_’Œy
 {

672 
ušt8_t
 
æags
;

673 
ušt8_t
 
Ën
;

674 
ušt16_t
 
šdex
;

675 
ušt32_t
 
keycode
;

676 
ušt8_t
 
sÿncode
[32];

678 
	sff_»¶ay
 {

679 
ušt16_t
 
Ëngth
;

680 
ušt16_t
 
d–ay
;

682 
	sff_Œigg”
 {

683 
ušt16_t
 
bu‰Ú
;

684 
ušt16_t
 
š‹rv®
;

686 
	sff_’v–İe
 {

687 
ušt16_t
 
©ck_Ëngth
;

688 
ušt16_t
 
©ck_Ëv–
;

689 
ušt16_t
 
çde_Ëngth
;

690 
ušt16_t
 
çde_Ëv–
;

692 
	sff_cÚ¡ªt_efãù
 {

693 
št16_t
 
Ëv–
;

694 
ff_’v–İe
 
’v–İe
;

696 
	sff_¿mp_efãù
 {

697 
št16_t
 
¡¬t_Ëv–
;

698 
št16_t
 
’d_Ëv–
;

699 
ff_’v–İe
 
’v–İe
;

701 
	sff_cÚd™iÚ_efãù
 {

702 
ušt16_t
 
right_§tu¿tiÚ
;

703 
ušt16_t
 
Ëá_§tu¿tiÚ
;

704 
št16_t
 
right_cÛff
;

705 
št16_t
 
Ëá_cÛff
;

706 
ušt16_t
 
d—dbªd
;

707 
št16_t
 
ûÁ”
;

709 
	sff_³riodic_efãù
 {

710 
ušt16_t
 
wavefÜm
;

711 
ušt16_t
 
³riod
;

712 
št16_t
 
magn™ude
;

713 
št16_t
 
off£t
;

714 
ušt16_t
 
pha£
;

715 
ff_’v–İe
 
’v–İe
;

716 
ušt32_t
 
cu¡om_Ën
;

717 
št16_t
 *
cu¡om_d©a
;

719 
	sff_rumbË_efãù
 {

720 
ušt16_t
 
¡rÚg_magn™ude
;

721 
ušt16_t
 
w—k_magn™ude
;

723 
	sff_efãù
 {

724 
ušt16_t
 
ty³
;

725 
št16_t
 
id
;

726 
ušt16_t
 
dœeùiÚ
;

727 
ff_Œigg”
 
Œigg”
;

728 
ff_»¶ay
 
»¶ay
;

730 
ff_cÚ¡ªt_efãù
 
cÚ¡ªt
;

731 
ff_¿mp_efãù
 
¿mp
;

732 
ff_³riodic_efãù
 
³riodic
;

733 
ff_cÚd™iÚ_efãù
 
cÚd™iÚ
[2];

734 
ff_rumbË_efãù
 
rumbË
;

735 } 
u
;

738 
v®
[2];

739 } 
	tk”Ãl_fsid_t
;

741 
	su£r_ÿp_h—d”
 {

742 
ušt32_t
 
v”siÚ
;

743 
pid
;

745 
	su£r_ÿp_d©a
 {

746 
ušt32_t
 
efãùive
;

747 
ušt32_t
 
³rm™‹d
;

748 
ušt32_t
 
šh”™abË
;

751 
	sÿp
 {

752 
ušt32_t
 
ÿp
[2];

754 
	sÿ·b™›s
 {

755 
ušt32_t
 
v”siÚ
;

756 
pid
;

757 
ÿp
 
efãùive
;

758 
ÿp
 
³rm™‹d
;

759 
ÿp
 
šh”™abË
;

761 
	sxt_g‘_»visiÚ
 {

762 
Çme
[29];

763 
ušt8_t
 
»visiÚ
;

765 
	svfs_ÿp_d©a
 {

766 
Ë32
 
magic_‘c
;

768 
Ë32
 
³rm™‹d
;

769 
Ë32
 
šh”™abË
;

770 } 
d©a
[2];

773 *
ss_¥
;

774 
ss_æags
;

775 
size_t
 
ss_size
;

776 } 
	t¡ack_t
;

777 
	ssched_·¿m
 {

778 
sched_´iÜ™y
;

780 
sched_ss_low_´iÜ™y
;

781 
time¥ec
 
sched_ss_»¶_³riod
;

782 
time¥ec
 
sched_ss_š™_budg‘
;

783 
sched_ss_max_»¶
;

785 
	stun_f‹r
 {

786 
ušt16_t
 
æags
;

787 
ušt16_t
 
couÁ
;

788 
ušt8_t
 
addr
[0][6];

790 
	stun_pi
 {

791 
ušt16_t
 
æags
;

792 
ušt16_t
 
´Ùo
;

794 
	svho¡_vršg_¡©e
 {

795 
šdex
;

796 
num
;

798 
	svho¡_vršg_fe
 {

799 
šdex
;

800 
fd
;

802 
	svho¡_vršg_addr
 {

803 
šdex
;

804 
æags
;

805 
ušt64_t
 
desc_u£r_addr
;

806 
ušt64_t
 
u£d_u£r_addr
;

807 
ušt64_t
 
ava_u£r_addr
;

808 
ušt64_t
 
log_gue¡_addr
;

810 
	svho¡_memÜy_»giÚ
 {

811 
ušt64_t
 
gue¡_phys_addr
;

812 
ušt64_t
 
memÜy_size
;

813 
ušt64_t
 
u£r¥aû_addr
;

814 
ušt64_t
 
æags_·ddšg
;

816 
	svho¡_memÜy
 {

817 
ušt32_t
 
ÄegiÚs
;

818 
ušt32_t
 
·ddšg
;

819 
vho¡_memÜy_»giÚ
 
»giÚs
[0];

821 
	sru§ge
 {

822 
timev®
 
ru_utime
;

823 
timev®
 
ru_¡ime
;

824 
ru_maxrss
;

825 
ru_ixrss
;

826 
ru_idrss
;

827 
ru_i¤ss
;

828 
ru_mšæt
;

829 
ru_majæt
;

830 
ru_nsw­
;

831 
ru_šblock
;

832 
ru_oublock
;

833 
ru_msg¢d
;

834 
ru_msgrcv
;

835 
ru_nsigÇls
;

836 
ru_nvcsw
;

837 
ru_nivcsw
;

841 
	`­³nd
(
¬ch
.
nsig
 
Ü
 [[

842 cÚ¡ 
_NSIG
 = 64;

846 
	`­³nd
(
¬ch
.
sig£t
 
Ü
 [[

848 cÚ¡ 
_NSIG_BPW
 = 32;

850 
št32_t
 
sig
[
_NSIG
 / 
_NSIG_BPW
];

851 } 
	tsig£t_t
;

855 -- 
bÙh
 
Glibc
 
ªd
 
Mu¦
 
have
 
Ïrg”
 
‹rmios
 
©
 
Ëa¡
 
some
 
¬ch™eùu»s
; 
I
 
b–›ve
 
this
 
is
 
cÜ»ù
 
k”Ãl


856 
	`­³nd
(
¬ch
.
‹rmios
 
Ü
 [[

857 
	s‹rmios
 {

858 
tcæag_t
 
c_iæag
;

859 
tcæag_t
 
c_oæag
;

860 
tcæag_t
 
c_cæag
;

861 
tcæag_t
 
c_læag
;

862 
cc_t
 
c_lše
;

863 
cc_t
 
c_cc
[19];

868 -- 
Lšux
 
sigšfo
 
·ddšg
 
d•’ds
 
Ú
 
¬ch™eùu»


869 
abi
.
abi64
 
th’


870 
­³nd
 [[

871 cÚ¡ 
SI_MAX_SIZE
 = 128;

872 cÚ¡ 
SI_PAD_SIZE
 = (
SI_MAX_SIZE
 /  ()) - 4;

875 
­³nd
 [[

876 cÚ¡ 
SI_MAX_SIZE
 = 128;

877 cÚ¡ 
SI_PAD_SIZE
 = (
SI_MAX_SIZE
 /  ()) - 3;

879 
’d


881 
	`­³nd
(
¬ch
.
sigšfo
 
Ü
 [[

882 
	ssigšfo
 {

883 
si_signo
;

884 
si_”ºo
;

885 
si_code
;

888 
_·d
[
SI_PAD_SIZE
];

891 
pid_t
 
si_pid
;

892 
uid_t
 
si_uid
;

893 } 
kl
;

896 
si_tid
;

897 
si_ov”run
;

898 
sigv®_t
 
si_sigv®
;

899 } 
tim”
;

902 
pid_t
 
si_pid
;

903 
uid_t
 
si_uid
;

904 
sigv®_t
 
si_sigv®
;

905 } 
¹
;

908 
pid_t
 
si_pid
;

909 
uid_t
 
si_uid
;

910 
si_¡©us
;

911 
şock_t
 
si_utime
;

912 
şock_t
 
si_¡ime
;

913 } 
sigchld
;

916 *
si_addr
;

917 } 
sigçuÉ
;

920 
si_bªd
;

921 
si_fd
;

922 } 
sigpŞl
;

923 } 
_sif›lds
;

924 } 
	tsigšfo_t
;

928 -- 
this
 
is
 
the
 
ty³
 
u£d
 
by
h
¹_sigaùiÚ
 
sysÿÎ
 
NB
 
have
 
»Çmed
h
f›lds
 
to
 
§_


929 
	`­³nd
(
¬ch
.
sigaùiÚ
 
Ü
 [[

930 
	sk_sigaùiÚ
 {

931 (*
§_hªdËr
)();

932 
§_æags
;

933 (*
§_»¡Ü”
)();

934 
§_mask
[2];

939 -- 
the£
 
could
 
v¬y
 
be
 
¬ch
 
but
 dØ
nÙ
 
y‘


940 
­³nd
 [[

941 cÚ¡ 
sigev_´—mbË_size
 = (è* 2 + (
sigv®_t
);

942 cÚ¡ 
sigev_max_size
 = 64;

943 cÚ¡ 
sigev_·d_size
 = (
sigev_max_size
 - 
sigev_´—mbË_size
) / ();

944 
	ssigev’t
 {

945 
sigv®_t
 
sigev_v®ue
;

946 
sigev_signo
;

947 
sigev_nÙify
;

949 
_·d
[
sigev_·d_size
];

950 
_tid
;

952 (*
_funùiÚ
)(
sigv®_t
);

953 *
_©Œibu‹
;

954 } 
_sigev_th»ad
;

955 } 
_sigev_un
;

956 } 
	tsigev’t_t
;

959 
	`­³nd
(
¬ch
.
ucÚ‹xt
è-- 
th”e
 
is
 
no
  ucÚ‹xˆ
ªd
 
»Ï‹d
 
ty³s
 
as
 
v”y
 
machše
 
¥ecific


961 
¬ch
.
¡©fs
 
th’
 
	$­³nd
(
¬ch
.
¡©fs
)

963 -- 
Lšux
 
¡©fs
/
¡©fs64
 
d•’ds
 
Ú
 64/32 
b™


964 
abi
.
abi64
 
th’


965 
­³nd
 [[

966 
¡©fs_wÜd
;

969 
­³nd
 [[

970 
ušt32_t
 
¡©fs_wÜd
;

972 
’d


974 
­³nd
 [[

975 
	s¡©fs64
 {

976 
¡©fs_wÜd
 
f_ty³
;

977 
¡©fs_wÜd
 
f_bsize
;

978 
ušt64_t
 
f_blocks
;

979 
ušt64_t
 
f_bä“
;

980 
ušt64_t
 
f_bava
;

981 
ušt64_t
 
f_fes
;

982 
ušt64_t
 
f_fä“
;

983 
k”Ãl_fsid_t
 
f_fsid
;

984 
¡©fs_wÜd
 
f_Çm–’
;

985 
¡©fs_wÜd
 
f_äsize
;

986 
¡©fs_wÜd
 
f_æags
;

987 
¡©fs_wÜd
 
f_¥¬e
[4];

990 
’d


992 
	`­³nd
(
¬ch
.
¡©
)

994 -- 
•Şl
 
·cked
 
Ú
 
x86_64
 
	$Úly
 (
so
 
§me
 
as
 
x86
)

995 
	`­³nd
(
¬ch
.
•Şl
 
Ü
 [[

996 
	s•Şl_ev’t
 {

997 
ušt32_t
 
ev’ts
;

998 
•Şl_d©a_t
 
d©a
;

1003 -- 
’dŸn
 
d•’d’t


1004 
abi
.
Ë
 
th’


1005 
­³nd
 [[

1006 
	siocb
 {

1007 
ušt64_t
 
aio_d©a
;

1008 
ušt32_t
 
aio_key
, 
aio_»£rved1
;

1009 
ušt16_t
 
aio_lio_İcode
;

1010 
št16_t
 
aio_»q´io
;

1011 
ušt32_t
 
aio_fdes
;

1012 
ušt64_t
 
aio_buf
;

1013 
ušt64_t
 
aio_nby‹s
;

1014 
št64_t
 
aio_off£t
;

1015 
ušt64_t
 
aio_»£rved2
;

1016 
ušt32_t
 
aio_æags
;

1017 
ušt32_t
 
aio_»sfd
;

1021 
­³nd
 [[

1022 
	siocb
 {

1023 
ušt64_t
 
aio_d©a
;

1024 
ušt32_t
 
aio_»£rved1
, 
aio_key
;

1025 
ušt16_t
 
aio_lio_İcode
;

1026 
št16_t
 
aio_»q´io
;

1027 
ušt32_t
 
aio_fdes
;

1028 
ušt64_t
 
aio_buf
;

1029 
ušt64_t
 
aio_nby‹s
;

1030 
št64_t
 
aio_off£t
;

1031 
ušt64_t
 
aio_»£rved2
;

1032 
ušt32_t
 
aio_æags
;

1033 
ušt32_t
 
aio_»sfd
;

1036 
’d


1038 -- 
funùiÚs
, 
mšim®
 
Lšux
 
as
 
mašly
 
u£
 
sysÿÎ


1039 
­³nd
 [[

1040 
	`sysÿÎ
(
numb”
, ...);

1042 
	`g‘timeofday
(
timev®
 *
tv
, *
tz
);

1043 
	`şock_g‘time
(
şockid_t
 
şk_id
, 
time¥ec
 *

);

1045 
	`ex™
(
¡©us
);

1048 
ffi
.
	`cdef
(
bË
.
	`cÚÿt
(
defs
, ""))

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ioctl.lua

1 -- 
	gioùls
, 
flšg
 
š
 
as
 
	gÃeded


2 -- 
nÙe
 
th”e
 
¬e
 
some
 
¬ch™eùu»
 
d•’d’t
 
v®ues


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

13 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

15 
loÿl
 
s
, 
t
 = 
ty³s
.s,ypes.t

17 
loÿl
 
¡ræag
 = 
»quœe
 "syscall.helpers".strflag

19 
loÿl
 
¬ch
 = 
	`»quœe
("sysÿÎ.lšux." .. 
abi
.arch .. ".ioctl")

21 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

23 
loÿl
 
bªd
 = 
b™
.band

24 
loÿl
 
funùiÚ
 
	$bÜ
(...)

25 
loÿl
 
r
 = 
b™
.
	$bÜ
(...)

26 
r
 < 0 
th’
„ =„ + 4294967296 
’d
 -- 
TODO
 
£e
 
nÙe
 
š
 
N‘BSD


27  
r


28 
’d


29 
loÿl
 
lshiá
 = 
b™
.lshift

30 
loÿl
 
rshiá
 = 
b™
.rshift

32 -- 
the£
 
ÿn
 
v¬y
 
by
 
¬ch™eùu»


33 
loÿl
 
IOC
 = 
¬ch
.IOC 
Ü
 {

34 
SIZEBITS
 = 14,

35 
DIRBITS
 = 2,

36 
NONE
 = 0,

37 
WRITE
 = 1,

38 
READ
 = 2,

39 
	}
}

41 
	gIOC
.
	gREADWRITE
 = 
IOC
.
READ
 + IOC.
WRITE


43 
IOC
.
NRBITS
 = 8

44 
IOC
.
TYPEBITS
 = 8

46 
IOC
.
NRMASK
 = 
lshiá
(1, IOC.
NRBITS
) - 1

47 
	gIOC
.
	gTYPEMASK
 = 
lshiá
(1, 
IOC
.
TYPEBITS
) - 1

48 
	gIOC
.
	gSIZEMASK
 = 
lshiá
(1, 
IOC
.
SIZEBITS
) - 1

49 
	gIOC
.
	gDIRMASK
 = 
lshiá
(1, 
IOC
.
DIRBITS
) - 1

51 
	gIOC
.
	gNRSHIFT
 = 0

52 
IOC
.
TYPESHIFT
 = IOC.
NRSHIFT
 + IOC.
NRBITS


53 
IOC
.
SIZESHIFT
 = IOC.
TYPESHIFT
 + IOC.
TYPEBITS


54 
IOC
.
DIRSHIFT
 = IOC.
SIZESHIFT
 + IOC.
SIZEBITS


56 
loÿl
 
funùiÚ
 
	$ioc
(
dœ
, 
ch
, 
Ä
, 
size
)

57 
	`ty³
(
ch
è=ğ"¡ršg" 
th’
 ch = ch:
	$by‹
(è
’d


58  
	`bÜ
(
	`lshiá
(
dœ
, 
IOC
.
DIRSHIFT
),

59 
	`lshiá
(
ch
, 
IOC
.
TYPESHIFT
),

60 
	`lshiá
(
Ä
, 
IOC
.
NRSHIFT
),

61 
	$lshiá
(
size
, 
IOC
.
SIZESHIFT
))

62 
’d


64 
loÿl
 
sšgËtÚm­
 = {

67 
ušt
 = "uint1",

68 
ušt32
 = "uint32_1",

69 
ušt64
 = "uint64_1",

70 
	}
}

72 
loÿl
 
funùiÚ
 
	$_IOC
(
dœ
, 
ch
, 
Ä
, 

)

73 
nÙ
 

 
Ü
 
	`ty³
Ñpè=ğ"numb”" 
th’
  
	$ioc
(
dœ
, 
ch
, 
Ä
, 

 
Ü
 0è
’d


74 
loÿl
 
size
 = 
s
[

]

75 
loÿl
 
sšgËtÚ
 = 
sšgËtÚm­
[

] ~ğ
n


76 

 = 
sšgËtÚm­
[] 
Ü
p

77  {
numb”
 = 
	`ioc
(
dœ
, 
ch
, 
Ä
, 
size
),

78 
»ad
 = 
dœ
 =ğ
IOC
.
READ
 
Ü
 dœ =ğIOC.
READWRITE
, 
wr™e
 = dœ =ğIOC.
WRITE
 or dir == IOC.READWRITE,

79 
ty³
 = 
t
[

], 
sšgËtÚ
 = 
	}
singleton}

80 
	g’d


82 -- 
u£d
 
to
 
ü—‹
 
numb”s


83 
loÿl
 
	g_IO
 = 
	$funùiÚ
(
ch
, 
Ä
è 
	$_IOC
(
IOC
.
NONE
, 
ch
, 
Ä
, 0è
’d


84 
loÿl
 
_IOR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
READ
, 
ch
, 
Ä
, 

è
’d


85 
loÿl
 
_IOW
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
WRITE
, 
ch
, 
Ä
, 

è
’d


86 
loÿl
 
_IOWR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
READWRITE
, 
ch
, 
Ä
, 

è
’d


88 -- 
u£d
 
to
 
decode
 
ioùl
 
numb”s
..

89 
loÿl
 
_IOC_DIR
 = 
	$funùiÚ
(
Ä
è 
	`bªd
(
	`rshiá
Òr, 
IOC
.
DIRSHIFT
), IOC.
DIRMASK
è
’d


90 
loÿl
 
_IOC_TYPE
 = 
	$funùiÚ
(
Ä
è 
	`bªd
(
	`rshiá
Òr, 
IOC
.
TYPESHIFT
), IOC.
TYPEMASK
è
’d


91 
loÿl
 
_IOC_NR
 = 
	$funùiÚ
(
Ä
è 
	`bªd
(
	`rshiá
Òr, 
IOC
.
NRSHIFT
), IOC.
NRMASK
è
’d


92 
loÿl
 
_IOC_SIZE
 = 
	$funùiÚ
(
Ä
è 
	`bªd
(
	`rshiá
Òr, 
IOC
.
SIZESHIFT
), IOC.
SIZEMASK
è
’d


94 -- ...
ªd
 
the
 
driv”s
/
sound
 
fes
...

96 
IOC
.
IN
 = 
	$lshiá
(
IOC
.
WRITE
, IOC.
DIRSHIFT
)

97 
IOC
.
OUT
 = 
	$lshiá
(
IOC
.
READ
, IOC.
DIRSHIFT
)

98 
IOC
.
INOUT
 = 
	`lshiá
(
	`bÜ
(IOC.
WRITE
, IOC.
READ
), IOC.
DIRSHIFT
)

99 
loÿl
 
IOCSIZE_MASK
 = 
	$lshiá
(
IOC
.
SIZEMASK
, IOC.
SIZESHIFT
)

100 
loÿl
 
IOCSIZE_SHIFT
 = 
IOC
.
SIZESHIFT


102 -- 
VFIO
 
driv”
 
wr™”
 
decided
 
nÙ
 
to
 
u£
 
¡ªd¬d
 
IOR
/
IOW
 
®as


103 
loÿl
 
funùiÚ
 
	$vfio
(
dœ
, 
Ä
, 

)

104 
loÿl
 
ch
 = ";"

105 
Ä
 =‚¸+ 100 -- 
vfio
 
ba£


106 
dœ
 = 
IOC
[
¡ršg
.
	`uµ”
(dir)]

107 
loÿl
 
io
 = 
	$_IOC
(
dœ
, 
ch
, 
Ä
, 

)

108 
	`ty³
(
io
è=ğ"numb”" 
th’
  iØ
’d
 -- 
ju¡
 
IO
, 
nÙ
 

109 
io
.
numb”
 = 
	`ioc
(
IOC
.
NONE
, 
ch
, 
Ä
, 0è--‚umb” 
’code
 
nÙhšg
, 
but
 
we
 
wªt
 
to
 
know
 
ªyway


110  
io


111 
’d


113 
loÿl
 
ioùl
 = 
¡ræag
 {

114 -- 
‹rmios
, 
nÚ
 
¡ªd¬d
 
v®ues
 
g’”®ly
 0x54 = 'T'

115 
TCGETS
 = {
numb”
 = 0x5401, 
»ad
 = 
Œue
, 
ty³
 = "termios"},

116 
TCSETS
 = 0x5402,

117 
TCSETSW
 = 0x5403,

118 
TCSETSF
 = 0x5404,

119 
TCSBRK
 = 0x5409, -- 
kes
 
l™”®
 
numb”


120 
TCXONC
 = 0x540A,

121 
TCFLSH
 = 0x540B, -- 
kes
 
l™”®
 
numb”


122 
TIOCEXCL
 = 0x540C,

123 
TIOCNXCL
 = 0x540D,

124 
TIOCSCTTY
 = 0x540E,

125 
TIOCGPGRP
 = 0x540F,

126 
TIOCSPGRP
 = 0x5410,

127 
TIOCOUTQ
 = 0x5411,

128 
TIOCSTI
 = 0x5412,

129 
TIOCGWINSZ
 = {
numb”
 = 0x5413, 
»ad
 = 
Œue
, 
ty³
 = "winsize"},

130 
TIOCSWINSZ
 = {
numb”
 = 0x5414, 
wr™e
 = 
Œue
, 
ty³
 = "winsize"},

131 
TIOCMGET
 = 0x5415,

132 
TIOCMBIS
 = 0x5416,

133 
TIOCMBIC
 = 0x5417,

134 
TIOCMSET
 = 0x5418,

135 
TIOCGSOFTCAR
 = 0x5419,

136 
TIOCSSOFTCAR
 = 0x541A,

137 
FIONREAD
 = 0x541B,

138 
TIOCLINUX
 = 0x541C,

139 
TIOCCONS
 = 0x541D,

140 
TIOCGSERIAL
 = 0x541E,

141 
TIOCSSERIAL
 = 0x541F,

142 
TIOCPKT
 = 0x5420,

143 
FIONBIO
 = 0x5421,

144 
TIOCNOTTY
 = 0x5422,

145 
TIOCSETD
 = 0x5423,

146 
TIOCGETD
 = 0x5424,

147 
TCSBRKP
 = 0x5425,

148 
TIOCSBRK
 = 0x5427,

149 
TIOCCBRK
 = 0x5428,

150 
TIOCGSID
 = 0x5429,

151 
TCGETS2
 = 
	`_IOR
('T', 0x2A, "termios2"),

152 
TCSETS2
 = 
	`_IOW
('T', 0x2B, "termios2"),

153 
TCSETSW2
 = 
	`_IOW
('T', 0x2C, "termios2"),

154 
TCSETSF2
 = 
	`_IOW
('T', 0x2D, "termios2"),

155 
TIOCGPTN
 = 
	`_IOR
('T', 0x30, "uint"),

156 
TIOCSPTLCK
 = 
	`_IOW
('T', 0x31, "int"),

157 
TIOCGDEV
 = 
	`_IOR
('T', 0x32, "uint"),

158 
TCGETX
 = 0x5432,

159 
TCSETX
 = 0x5433,

160 
TCSETXF
 = 0x5434,

161 
TCSETXW
 = 0x5435,

162 
TIOCSIG
 = 
	`_IOW
('T', 0x36, "int"),

163 
TIOCVHANGUP
 = 0x5437,

164 
FIONCLEX
 = 0x5450,

165 
FIOCLEX
 = 0x5451,

166 
FIOASYNC
 = 0x5452,

167 
TIOCSERCONFIG
 = 0x5453,

168 
TIOCSERGWILD
 = 0x5454,

169 
TIOCSERSWILD
 = 0x5455,

170 
TIOCGLCKTRMIOS
 = 0x5456,

171 
TIOCSLCKTRMIOS
 = 0x5457,

172 
TIOCSERGSTRUCT
 = 0x5458,

173 
TIOCSERGETLSR
 = 0x5459,

174 
TIOCSERGETMULTI
 = 0x545A,

175 
TIOCSERSETMULTI
 = 0x545B,

176 
TIOCMIWAIT
 = 0x545C,

177 
TIOCGICOUNT
 = 0x545D,

178 
FIOQSIZE
 = 0x5460,

179 -- 
sock‘
 
ioùls
 
äom
 
lšux
/
sockios
.
h
 - 
mªy
 
of
 
the£
 
you
 
ÿn
 
u£
 
Ãšk
 
š¡—d


180 
FIOSETOWN
 = 0x8901,

181 
SIOCSPGRP
 = 0x8902,

182 
FIOGETOWN
 = 0x8903,

183 
SIOCGPGRP
 = 0x8904,

184 
SIOCATMARK
 = 0x8905,

185 
SIOCGSTAMP
 = 0x8906,

186 
SIOCGSTAMPNS
 = 0x8907,

188 
SIOCADDRT
 = 0x890B,

189 
SIOCDELRT
 = 0x890C,

190 
SIOCRTMSG
 = 0x890D,

192 
SIOCGIFINDEX
 = 0x8933,

194 
SIOCDARP
 = 0x8953,

195 
SIOCGARP
 = 0x8954,

196 
SIOCSARP
 = 0x8955,

198 
SIOCBRADDBR
 = 0x89a0,

199 
SIOCBRDELBR
 = 0x89a1,

200 
SIOCBRADDIF
 = 0x89a2,

201 
SIOCBRDELIF
 = 0x89a3,

202 -- 
ev’t
 
sy¡em


203 
EVIOCGVERSION
 = 
	`_IOR
('E', 0x01, "int"),

204 
EVIOCGID
 = 
	`_IOR
('E', 0x02, "input_id"),

205 
EVIOCGREP
 = 
	`_IOR
('E', 0x03, "uint2"),

206 
EVIOCSREP
 = 
	`_IOW
('E', 0x03, "uint2"),

207 
EVIOCGKEYCODE
 = 
	`_IOR
('E', 0x04, "uint2"),

208 
EVIOCGKEYCODE_V2
 = 
	`_IOR
('E', 0x04, "input_keymap_entry"),

209 
EVIOCSKEYCODE
 = 
	`_IOW
('E', 0x04, "uint2"),

210 
EVIOCSKEYCODE_V2
 = 
	`_IOW
('E', 0x04, "input_keymap_entry"),

211 
EVIOCGNAME
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x06,†’è
’d
,

212 
EVIOCGPHYS
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x07,†’è
’d
,

213 
EVIOCGUNIQ
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x08,†’è
’d
,

214 
EVIOCGPROP
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x09,†’è
’d
,

215 
EVIOCGKEY
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x18,†’è
’d
,

216 
EVIOCGLED
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x19,†’è
’d
,

217 
EVIOCGSND
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x1a,†’è
’d
,

218 
EVIOCGSW
 = 
	`funùiÚ
(
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x1b,†’è
’d
,

219 
EVIOCGBIT
 = 
	`funùiÚ
(
ev
, 
Ën
è 
	`_IOC
(
IOC
.
READ
, 'E', 0x20 +ƒv,†’è
’d
,

220 
EVIOCGABS
 = 
	`funùiÚ
(
abs
è 
	`_IOR
('E', 0x40 +‡bs, "šput_absšfo"è
’d
,

221 
EVIOCSABS
 = 
	`funùiÚ
(
abs
è 
	`_IOW
('E', 0xc0 +‡bs, "šput_absšfo"è
’d
,

222 
EVIOCSFF
 = 
	`_IOC
(
IOC
.
WRITE
, 'E', 0x80, "ff_effect"),

223 
EVIOCRMFF
 = 
	`_IOW
('E', 0x81, "int"),

224 
EVIOCGEFFECTS
 = 
	`_IOR
('E', 0x84, "int"),

225 
EVIOCGRAB
 = 
	`_IOW
('E', 0x90, "int"),

226 -- 
šput
 
deviûs


227 
UI_DEV_CREATE
 = 
	`_IO
 ('U', 1),

228 
UI_DEV_DESTROY
 = 
	`_IO
 ('U', 2),

229 
UI_SET_EVBIT
 = 
	`_IOW
('U', 100, "int"),

230 
UI_SET_KEYBIT
 = 
	`_IOW
('U', 101, "int"),

231 -- 
tun
/
p


232 
TUNSETNOCSUM
 = 
	`_IOW
('T', 200, "int"),

233 
TUNSETDEBUG
 = 
	`_IOW
('T', 201, "int"),

234 
TUNSETIFF
 = 
	`_IOW
('T', 202, "int"),

235 
TUNSETPERSIST
 = 
	`_IOW
('T', 203, "int"),

236 
TUNSETOWNER
 = 
	`_IOW
('T', 204, "int"),

237 
TUNSETLINK
 = 
	`_IOW
('T', 205, "int"),

238 
TUNSETGROUP
 = 
	`_IOW
('T', 206, "int"),

239 
TUNGETFEATURES
 = 
	`_IOR
('T', 207, "uint"),

240 
TUNSETOFFLOAD
 = 
	`_IOW
('T', 208, "uint"),

241 
TUNSETTXFILTER
 = 
	`_IOW
('T', 209, "uint"),

242 
TUNGETIFF
 = 
	`_IOR
('T', 210, "uint"),

243 
TUNGETSNDBUF
 = 
	`_IOR
('T', 211, "int"),

244 
TUNSETSNDBUF
 = 
	`_IOW
('T', 212, "int"),

245 
TUNATTACHFILTER
ğ
	`_IOW
('T', 213, "sock_fprog"),

246 
TUNDETACHFILTER
ğ
	`_IOW
('T', 214, "sock_fprog"),

247 
TUNGETVNETHDRSZ
ğ
	`_IOR
('T', 215, "int"),

248 
TUNSETVNETHDRSZ
ğ
	`_IOW
('T', 216, "int"),

249 
TUNSETQUEUE
 = 
	`_IOW
('T', 217, "int"),

250 -- 
äom
 
lšux
/
vho¡
.
h
 
VHOST_VIRTIO
 0xAF

251 
VHOST_GET_FEATURES
 = 
	`_IOR
(0xAF, 0x00, "uint64"),

252 
VHOST_SET_FEATURES
 = 
	`_IOW
(0xAF, 0x00, "uint64"),

253 
VHOST_SET_OWNER
 = 
	`_IO
(0xAF, 0x01),

254 
VHOST_RESET_OWNER
 = 
	`_IO
(0xAF, 0x02),

255 
VHOST_SET_MEM_TABLE
 = 
	`_IOW
(0xAF, 0x03, "vhost_memory"),

256 
VHOST_SET_LOG_BASE
 = 
	`_IOW
(0xAF, 0x04, "uint64"),

257 
VHOST_SET_LOG_FD
 = 
	`_IOW
(0xAF, 0x07, "int"),

258 
VHOST_SET_VRING_NUM
 = 
	`_IOW
(0xAF, 0x10, "vhost_vring_state"),

259 
VHOST_SET_VRING_ADDR
 = 
	`_IOW
(0xAF, 0x11, "vhost_vring_addr"),

260 
VHOST_SET_VRING_BASE
 = 
	`_IOW
(0xAF, 0x12, "vhost_vring_state"),

261 
VHOST_GET_VRING_BASE
 = 
	`_IOWR
(0xAF, 0x12, "vhost_vring_state"),

262 
VHOST_SET_VRING_KICK
 = 
	`_IOW
(0xAF, 0x20, "vhost_vring_file"),

263 
VHOST_SET_VRING_CALL
 = 
	`_IOW
(0xAF, 0x21, "vhost_vring_file"),

264 
VHOST_SET_VRING_ERR
 = 
	`_IOW
(0xAF, 0x22, "vhost_vring_file"),

265 
VHOST_NET_SET_BACKEND
ğ
	`_IOW
(0xAF, 0x30, "vhost_vring_file"),

266 -- 
äom
 
lšux
/
vfio
.
h
 
ty³
 
is
 ';' 
ba£
 is 100

267 
VFIO_GET_API_VERSION
 = 
	`vfio
('NONE', 0),

268 
VFIO_CHECK_EXTENSION
 = 
	`vfio
('WRITE', 1, "uint32"),

269 -- 
äom
 
lšux
/
³rf_ev’t
.
h


270 
PERF_EVENT_IOC_ENABLE
 = 
	`_IO
('$', 0),

271 
PERF_EVENT_IOC_DISABLE
 = 
	`_IO
('$', 1),

272 
PERF_EVENT_IOC_REFRESH
 = 
	`_IO
('$', 2),

273 
PERF_EVENT_IOC_RESET
 = 
	`_IO
('$', 3),

274 
PERF_EVENT_IOC_PERIOD
 = 
	`_IOW
('$', 4, "uint64"),

275 
PERF_EVENT_IOC_SET_OUTPUT
ğ
	`_IO
('$', 5),

276 
PERF_EVENT_IOC_SET_FILTER
ğ
	`_IOW
('$', 6, "uintptr"),

277 
PERF_EVENT_IOC_ID
 = 
	`_IOR
('$', 7, "uint64_1"),

278 
PERF_EVENT_IOC_SET_BPF
 = 
	`_IOW
('$', 8, "uint32"),

280 -- 
®low
 
u£r
 
defšed
 
ioùls


281 
_IO
 = _IO,

282 
_IOR
 = _IOR,

283 
_IOW
 = _IOW,

284 
_IOWR
 = _IOWR,

285 
	}
}

287 
loÿl
 
	gov”ride
 = 
¬ch
.
ioùl
 
Ü
 {}

288 
ty³
(
ov”ride
è=ğ"funùiÚ" 
th’
 ov”ridğ
	$ov”ride
(
_IO
, 
_IOR
, 
_IOW
, 
_IOWR
è
’d


289 
k
, 
v
 
š
 
	$·œs
(
ov”ride
èdØ
ioùl
[
k
] = 
v
 
’d


291 -- 
®low
 
Çmes
 
ty³s
 
š
 
bË
 
ioùls


292 
k
, 
v
 
š
 
	$·œs
(
ioùl
èdØ
	`ty³
(
v
è=ğ"bË" 
ªd
y³(v.
ty³
è=ğ"¡ršg" 
th’
 v.ty³ = 
t
[v.ty³] 
’d
ƒnd

294 -- 
®‹º©e
 
Çmes


295 
ioùl
.
TIOCINQ
 = ioùl.
FIONREAD


297  
ioùl


299 
’d


301  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/constants.lua

1 -- 
ms
 
¥ecific
 
cÚ¡ªts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gh
 = 
»quœe
 "syscall.helpers"

12 
loÿl
 
où®
 = 
h
.octal

14 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

16 
loÿl
 
¬ch
 = {}

18 
¬ch
.
SIG
 = {

19 
HUP
 = 1,

20 
	gINT
 = 2,

21 
	gQUIT
 = 3,

22 
	gILL
 = 4,

23 
	gTRAP
 = 5,

24 
	gABRT
 = 6,

25 
	gEMT
 = 7,

26 
	gFPE
 = 8,

27 
	gKILL
 = 9,

28 
	gBUS
 = 10,

29 
	gSEGV
 = 11,

30 
	gSYS
 = 12,

31 
	gPIPE
 = 13,

32 
	gALRM
 = 14,

33 
	gTERM
 = 15,

34 
	gUSR1
 = 16,

35 
	gUSR2
 = 17,

36 
	gCHLD
 = 18,

37 
	gPWR
 = 19,

38 
	gWINCH
 = 20,

39 
	gURG
 = 21,

40 
	gIO
 = 22,

41 
	gSTOP
 = 23,

42 
	gTSTP
 = 24,

43 
	gCONT
 = 25,

44 
	gTTIN
 = 26,

45 
	gTTOU
 = 27,

46 
	gVTALRM
 = 28,

47 
	gPROF
 = 29,

48 
	gXCPU
 = 30,

49 
	gXFSZ
 = 31,

52 
	g¬ch
.
	gSOCK
 = {

53 
DGRAM
 = 1,

54 
	gSTREAM
 = 2,

55 
	gRAW
 = 3,

56 
	gRDM
 = 4,

57 
	gSEQPACKET
 = 5,

58 
	gDCCP
 = 6,

59 
	gPACKET
 = 10,

61 
	gCLOEXEC
 = 
où®
('02000000'),

62 
	gNONBLOCK
 = 
où®
('0200'),

65 
	g¬ch
.
	gMAP
 = {

66 
SHARED
 = 0x001,

67 
	gPRIVATE
 = 0x002,

68 
	gTYPE
 = 0x00f,

69 
	gFIXED
 = 0x010,

70 
	gNORESERVE
 = 0x0400,

71 
	gANONYMOUS
 = 0x0800,

72 
	gGROWSDOWN
 = 0x1000,

73 
	gDENYWRITE
 = 0x2000,

74 
	gEXECUTABLE
 = 0x4000,

75 
	gLOCKED
 = 0x8000,

76 
	gPOPULATE
 = 0x10000,

77 
	gNONBLOCK
 = 0x20000,

78 
	gSTACK
 = 0x40000,

79 
	gHUGETLB
 = 0x80000,

82 
loÿl
 
	g__O_SYNC
 = 0x4000

84 
¬ch
.
O
 = {

85 
RDONLY
 = 0x0000,

86 
	gWRONLY
 = 0x0001,

87 
	gRDWR
 = 0x0002,

88 
	gACCMODE
 = 0x0003,

89 
	gAPPEND
 = 0x0008,

90 
	gDSYNC
 = 0x0010,

91 
	gNONBLOCK
 = 0x0080,

92 
	gCREAT
 = 0x0100,

93 
	gTRUNC
 = 0x0200,

94 
	gEXCL
 = 0x0400,

95 
	gNOCTTY
 = 0x0800,

96 
	gLARGEFILE
= 0x2000,

97 
	gDIRECT
 = 0x8000,

98 
	gDIRECTORY
= 0x10000,

99 
	gNOFOLLOW
 = 0x20000,

100 
	gNOATIME
 = 0x40000,

101 
	gCLOEXEC
 = 
où®
 '02000000',

104 
	g¬ch
.
	gO_SYNC
 = 
__O_SYNC
 + 
¬ch
.
O
.
DSYNC
 -- 
com·tib™y
, 
£e
 
nÙes
 
š
 
	gh—d”
, 
we
 dØ
nÙ
 
expo£
 __O_SYNC 
TODO
 
check
 
this
 
is
 
be¡
 
way


106 
	g¬ch
.
	gTFD
 = {

107 
CLOEXEC
 = 
où®
 '02000000',

108 
	gNONBLOCK
 = 
où®
 '00000200',

111 
	g¬ch
.
	gE
 = {

112 
PERM
 = 1,

113 
	gNOENT
 = 2,

114 
	gSRCH
 = 3,

115 
	gINTR
 = 4,

116 
	gIO
 = 5,

117 
	gNXIO
 = 6,

119 
	gNOEXEC
 = 8,

120 
	gBADF
 = 9,

121 
	gCHILD
 = 10,

122 
	gAGAIN
 = 11,

123 
	gNOMEM
 = 12,

124 
	gACCES
 = 13,

125 
	gFAULT
 = 14,

126 
	gNOTBLK
 = 15,

127 
	gBUSY
 = 16,

128 
	gEXIST
 = 17,

129 
	gXDEV
 = 18,

130 
	gNODEV
 = 19,

131 
	gNOTDIR
 = 20,

132 
	gISDIR
 = 21,

133 
	gINVAL
 = 22,

134 
	gNFILE
 = 23,

135 
	gMFILE
 = 24,

136 
	gNOTTY
 = 25,

137 
	gTXTBSY
 = 26,

138 
	gFBIG
 = 27,

139 
	gNOSPC
 = 28,

140 
	gSPIPE
 = 29,

141 
	gROFS
 = 30,

142 
	gMLINK
 = 31,

143 
	gPIPE
 = 32,

144 
	gDOM
 = 33,

145 
	gRANGE
 = 34,

146 
	gNOMSG
 = 35,

147 
	gIDRM
 = 36,

148 
	gCHRNG
 = 37,

149 
	gL2NSYNC
 = 38,

150 
	gL3HLT
 = 39,

151 
	gL3RST
 = 40,

152 
	gLNRNG
 = 41,

153 
	gUNATCH
 = 42,

154 
	gNOCSI
 = 43,

155 
	gL2HLT
 = 44,

156 
	gDEADLK
 = 45,

157 
	gNOLCK
 = 46,

158 
	gBADE
 = 50,

159 
	gBADR
 = 51,

160 
	gXFULL
 = 52,

161 
	gNOANO
 = 53,

162 
	gBADRQC
 = 54,

163 
	gBADSLT
 = 55,

164 
	gDEADLOCK
 = 56,

165 
	gBFONT
 = 59,

166 
	gNOSTR
 = 60,

167 
	gNODATA
 = 61,

168 
	gTIME
 = 62,

169 
	gNOSR
 = 63,

170 
	gNONET
 = 64,

171 
	gNOPKG
 = 65,

172 
	gREMOTE
 = 66,

173 
	gNOLINK
 = 67,

174 
	gADV
 = 68,

175 
	gSRMNT
 = 69,

176 
	gCOMM
 = 70,

177 
	gPROTO
 = 71,

178 
	gDOTDOT
 = 73,

179 
	gMULTIHOP
 = 74,

180 
	gBADMSG
 = 77,

181 
	gNAMETOOLONG
 = 78,

182 
	gOVERFLOW
 = 79,

183 
	gNOTUNIQ
 = 80,

184 
	gBADFD
 = 81,

185 
	gREMCHG
 = 82,

186 
	gLIBACC
 = 83,

187 
	gLIBBAD
 = 84,

188 
	gLIBSCN
 = 85,

189 
	gLIBMAX
 = 86,

190 
	gLIBEXEC
 = 87,

191 
	gILSEQ
 = 88,

192 
	gNOSYS
 = 89,

193 
	gLOOP
 = 90,

194 
	gRESTART
 = 91,

195 
	gSTRPIPE
 = 92,

196 
	gNOTEMPTY
 = 93,

197 
	gUSERS
 = 94,

198 
	gNOTSOCK
 = 95,

199 
	gDESTADDRREQ
 = 96,

200 
	gMSGSIZE
 = 97,

201 
	gPROTOTYPE
 = 98,

202 
	gNOPROTOOPT
 = 99,

203 
	gPROTONOSUPPORT
= 120,

204 
	gSOCKTNOSUPPORT
= 121,

205 
	gOPNOTSUPP
 = 122,

206 
	gPFNOSUPPORT
 = 123,

207 
	gAFNOSUPPORT
 = 124,

208 
	gADDRINUSE
 = 125,

209 
	gADDRNOTAVAIL
 = 126,

210 
	gNETDOWN
 = 127,

211 
	gNETUNREACH
 = 128,

212 
	gNETRESET
 = 129,

213 
	gCONNABORTED
 = 130,

214 
	gCONNRESET
 = 131,

215 
	gNOBUFS
 = 132,

216 
	gISCONN
 = 133,

217 
	gNOTCONN
 = 134,

218 
	gUCLEAN
 = 135,

219 
	gNOTNAM
 = 137,

220 
	gNAVAIL
 = 138,

221 
	gISNAM
 = 139,

222 
	gREMOTEIO
 = 140,

223 
	gINIT
 = 141,

224 
	gREMDEV
 = 142,

225 
	gSHUTDOWN
 = 143,

226 
	gTOOMANYREFS
 = 144,

227 
	gTIMEDOUT
 = 145,

228 
	gCONNREFUSED
 = 146,

229 
	gHOSTDOWN
 = 147,

230 
	gHOSTUNREACH
 = 148,

231 
	gALREADY
 = 149,

232 
	gINPROGRESS
 = 150,

233 
	gSTALE
 = 151,

234 
	gCANCELED
 = 158,

235 
	gNOMEDIUM
 = 159,

236 
	gMEDIUMTYPE
 = 160,

237 
	gNOKEY
 = 161,

238 
	gKEYEXPIRED
 = 162,

239 
	gKEYREVOKED
 = 163,

240 
	gKEYREJECTED
 = 164,

241 
	gOWNERDEAD
 = 165,

242 
	gNOTRECOVERABLE
= 166,

243 
	gRFKILL
 = 167,

244 
	gHWPOISON
 = 168,

245 
	gDQUOT
 = 1133,

248 
	g¬ch
.
	gSFD
 = {

249 
CLOEXEC
 = 
où®
 "02000000",

250 
	gNONBLOCK
 = 
où®
 "00000200",

253 
	g¬ch
.
	gIN_INIT
 = {

254 
CLOEXEC
 = 
où®
("02000000"),

255 
	gNONBLOCK
 = 
où®
("00000200"),

258 
	g¬ch
.
	gSA
 = {

259 
ONSTACK
 = 0x08000000,

260 
	gRESETHAND
 = 0x80000000,

261 
	gRESTART
 = 0x10000000,

262 
	gSIGINFO
 = 0x00000008,

263 
	gNODEFER
 = 0x40000000,

264 
	gNOCLDWAIT
 = 0x00010000,

265 
	gNOCLDSTOP
 = 0x00000001,

268 
	g¬ch
.
	gSIGPM
 = {

269 
BLOCK
 = 1,

270 
	gUNBLOCK
 = 2,

271 
	gSETMASK
 = 3,

274 
	g¬ch
.
	gSI
 = {

275 
ASYNCNL
 = -60,

276 
	gTKILL
 = -6,

277 
	gSIGIO
 = -5,

278 
	gMESGQ
 = -4,

279 
	gTIMER
 = -3,

280 
	gASYNCIO
 = -2,

281 
	gQUEUE
 = -1,

282 
	gUSER
 = 0,

283 
	gKERNEL
 = 0x80,

286 
	g¬ch
.
	gPOLL
 = {

287 
IN
 = 0x001,

288 
	gPRI
 = 0x002,

289 
	gOUT
 = 0x004,

290 
	gERR
 = 0x008,

291 
	gHUP
 = 0x010,

292 
	gNVAL
 = 0x020,

293 
	gRDNORM
 = 0x040,

294 
	gRDBAND
 = 0x080,

295 
	gWRBAND
 = 0x100,

296 
	gMSG
 = 0x400,

297 
	gREMOVE
 = 0x1000,

298 
	gRDHUP
 = 0x2000,

301 
	g¬ch
.
	gPOLL
.
	gWRNORM
 = 
¬ch
.
POLL
.
OUT


303 
¬ch
.
RLIMIT
 = {

304 
CPU
 = 0,

305 
	gFSIZE
 = 1,

306 
	gDATA
 = 2,

307 
	gSTACK
 = 3,

308 
	gCORE
 = 4,

309 
	gNOFILE
 = 5,

310 
	gAS
 = 6,

311 
	gRSS
 = 7,

312 
	gNPROC
 = 8,

313 
	gMEMLOCK
 = 9,

314 
	gLOCKS
 = 10,

315 
	gSIGPENDING
 = 11,

316 
	gMSGQUEUE
 = 12,

317 
	gNICE
 = 13,

318 
	gRTPRIO
 = 14,

319 
	gRTTIME
 = 15,

322 -- 
nÙe
 
RLIM64_INFINITY
 
looks
 
like
 
™
 
v¬›s
 
by
 
MIPS
 
ABI
 
but
 
this
 
is
 
a
 
glibc
 
bug


324 
	g¬ch
.
	gSO
 = {

325 
DEBUG
 = 0x0001,

326 
	gREUSEADDR
 = 0x0004,

327 
	gKEEPALIVE
 = 0x0008,

328 
	gDONTROUTE
 = 0x0010,

329 
	gBROADCAST
 = 0x0020,

330 
	gLINGER
 = 0x0080,

331 
	gOOBINLINE
 = 0x0100,

332 --
	gREUSEPORT
 = 0x0200, -- 
nÙ
 
š
 
k”Ãl
 
	gh—d”s
, 
®though
 
MIPS
 
has
 
had
 
lÚg”


333 
	gTYPE
 = 0x1008,

334 
	gERROR
 = 0x1007,

335 
	gSNDBUF
 = 0x1001,

336 
	gRCVBUF
 = 0x1002,

337 
	gSNDLOWAT
 = 0x1003,

338 
	gRCVLOWAT
 = 0x1004,

339 
	gSNDTIMEO
 = 0x1005,

340 
	gRCVTIMEO
 = 0x1006,

341 
	gACCEPTCONN
 = 0x1009,

342 
	gPROTOCOL
 = 0x1028,

343 
	gDOMAIN
 = 0x1029,

345 
	gNO_CHECK
 = 11,

346 
	gPRIORITY
 = 12,

347 
	gBSDCOMPAT
 = 14,

348 
	gPASSCRED
 = 17,

349 
	gPEERCRED
 = 18,

351 
	gSECURITY_AUTHENTICATION
 = 22,

352 
	gSECURITY_ENCRYPTION_TRANSPORT
 = 23,

353 
	gSECURITY_ENCRYPTION_NETWORK
 = 24,

354 
	gBINDTODEVICE
 = 25,

355 
	gATTACH_FILTER
 = 26,

356 
	gDETACH_FILTER
 = 27,

357 
	gPEERNAME
 = 28,

358 
	gTIMESTAMP
 = 29,

359 
	gPEERSEC
 = 30,

360 
	gSNDBUFFORCE
 = 31,

361 
	gRCVBUFFORCE
 = 33,

362 
	gPASSSEC
 = 34,

363 
	gTIMESTAMPNS
 = 35,

364 
	gMARK
 = 36,

365 
	gTIMESTAMPING
 = 37,

366 
	gRXQ_OVFL
 = 40,

367 
	gWIFI_STATUS
 = 41,

368 
	gPEEK_OFF
 = 42,

369 
	gNOFCS
 = 43,

370 --
	gLOCK_FILTER
 = 44, -- 
Ã™h”
 
š
 
our
 
k”Ãl
 
	gh—d”s


371 --
	gSELECT_ERR_QUEUE
 = 45,

374 
	g¬ch
.
	gSO
.
	gSTYLE
 = 
¬ch
.
SO
.
TYPE


376 
¬ch
.
SOLSOCKET
 = 0xfffà-- 
»mašd”
 
of
 
SOL
 
v®ues
 
§me


378 
¬ch
.
F
 = {

379 
DUPFD
 = 0,

380 
	gGETFD
 = 1,

381 
	gSETFD
 = 2,

382 
	gGETFL
 = 3,

383 
	gSETFL
 = 4,

384 
	gGETLK
 = 14,

385 
	gSETLK
 = 6,

386 
	gSETLKW
 = 7,

387 
	gSETOWN
 = 24,

388 
	gGETOWN
 = 23,

389 
	gSETSIG
 = 10,

390 
	gGETSIG
 = 11,

391 
	gGETLK64
 = 33,

392 
	gSETLK64
 = 34,

393 
	gSETLKW64
 = 35,

394 
	gSETOWN_EX
 = 15,

395 
	gGETOWN_EX
 = 16,

396 
	gSETLEASE
 = 1024,

397 
	gGETLEASE
 = 1025,

398 
	gNOTIFY
 = 1026,

399 
	gSETPIPE_SZ
 = 1031,

400 
	gGETPIPE_SZ
 = 1032,

401 
	gDUPFD_CLOEXEC
 = 1030,

404 
	g¬ch
.
	gTIOCM
 = {

405 
LE
 = 0x001,

406 
	gDTR
 = 0x002,

407 
	gRTS
 = 0x004,

408 
	gST
 = 0x010,

409 
	gSR
 = 0x020,

410 
	gCTS
 = 0x040,

411 
	gCAR
 = 0x100,

412 
	gRNG
 = 0x200,

413 
	gDSR
 = 0x400,

414 
	gOUT1
 = 0x2000,

415 
	gOUT2
 = 0x4000,

416 
	gLOOP
 = 0x8000,

419 
	g¬ch
.
	gCC
 = {

420 
VINTR
 = 0,

421 
	gVQUIT
 = 1,

422 
	gVERASE
 = 2,

423 
	gVKILL
 = 3,

424 
	gVMIN
 = 4,

425 
	gVTIME
 = 5,

426 
	gVEOL2
 = 6,

427 
	gVSWTC
 = 7,

428 
	gVSTART
 = 8,

429 
	gVSTOP
 = 9,

430 
	gVSUSP
 = 10,

431 -- 
VDSUSP
 
nÙ
 
suµÜ‹d


432 
	gVREPRINT
 = 12,

433 
	gVDISCARD
 = 13,

434 
	gVWERASE
 = 14,

435 
	gVLNEXT
 = 15,

436 
	gVEOF
 = 16,

437 
	gVEOL
 = 17,

440 
	g¬ch
.
	gCC
.
	gVSWTCH
 = 
¬ch
.
CC
.
VSWTC


442 
¬ch
.
LFLAG
 = {

443 
ISIG
 = 
où®
 '0000001',

444 
	gICANON
 = 
où®
 '0000002',

445 
	gXCASE
 = 
où®
 '0000004',

446 
	gECHO
 = 
où®
 '0000010',

447 
	gECHOE
 = 
où®
 '0000020',

448 
	gECHOK
 = 
où®
 '0000040',

449 
	gECHONL
 = 
où®
 '0000100',

450 
	gNOFLSH
 = 
où®
 '0000200',

451 
	gIEXTEN
 = 
où®
 '0000400',

452 
	gECHOCTL
 = 
où®
 '0001000',

453 
	gECHOPRT
 = 
où®
 '0002000',

454 
	gECHOKE
 = 
où®
 '0004000',

455 
	gFLUSHO
 = 
où®
 '0020000',

456 
	gPENDIN
 = 
où®
 '0040000',

457 
	gTOSTOP
 = 
où®
 '0100000',

458 
	gEXTPROC
 = 
où®
 '0200000',

461 
	g¬ch
.
	gLFLAG
.
	gITOSTOP
 = 
¬ch
.
LFLAG
.
TOSTOP


463  
¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/ffi.lua

1 -- 
MIPS
 
¥ecific
 
	gdefš™iÚs


3 -- 
sig£t_t
 
size
 
is
 
£t
 
äom
 
_NSIG
 
h”e


6 
	gnsig
 = [[

7 cÚ¡ 
_NSIG
 = 128;

9 
	gucÚ‹xt
 = [[

10 
	ssig®t¡ack
 {

11 *
ss_¥
;

12 
size_t
 
ss_size
;

13 
ss_æags
;

14 } 
¡ack_t
;

16 
__mc1
[2];

17 
	g__mc2
[65];

18 
	g__mc3
[5];

19 
	g__mc4
[2];

20 
	g__mc5
[6];

21 } 
	tmcÚ‹xt_t
;

22 
	s__ucÚ‹xt
 {

23 
	guc_æags
;

24 
__ucÚ‹xt
 *
	guc_lšk
;

25 
¡ack_t
 
	guc_¡ack
;

26 
mcÚ‹xt_t
 
	guc_mcÚ‹xt
;

27 
sig£t_t
 
	guc_sigmask
;

28 
	guc_»g¥aû
[128];

29 } 
	tucÚ‹xt_t
;

31 
	gsigaùiÚ
 = [[

32 
	sk_sigaùiÚ
 {

33 
§_æags
;

34 (*
§_hªdËr
)();

35 
sig£t_t
 
§_mask
;

38 
	gsigšfo
 = [[

40 
	ssigšfo
 {

41 
si_signo
;

42 
si_code
;

43 
si_”ºo
;

44 
__·d0
[
SI_MAX_SIZE
 / (è- 
SI_PAD_SIZE
 - 3];

47 
	g_·d
[
SI_PAD_SIZE
];

50 
pid_t
 
	gsi_pid
;

51 
uid_t
 
	gsi_uid
;

52 } 
	gkl
;

55 
tim”_t
 
	gsi_tid
;

56 
	gsi_ov”run
;

57 
	g_·d
[(
uid_t
) - ()];

58 
sigv®_t
 
	gsi_sigv®
;

59 
	g_sys_´iv©e
;

60 } 
	gtim”
;

63 
pid_t
 
	gsi_pid
;

64 
uid_t
 
	gsi_uid
;

65 
sigv®_t
 
	gsi_sigv®
;

66 } 
	g¹
;

69 
pid_t
 
	gsi_pid
;

70 
uid_t
 
	gsi_uid
;

71 
	gsi_¡©us
;

72 
şock_t
 
	gsi_utime
;

73 
şock_t
 
	gsi_¡ime
;

74 } 
	gsigchld
;

77 
pid_t
 
	gsi_pid
;

78 
şock_t
 
	gsi_utime
;

79 
	gsi_¡©us
;

80 
şock_t
 
	gsi_¡ime
;

81 } 
	gœix_sigchld
;

84 *
	gsi_addr
;

85 
	gsi_addr_lsb
;

86 } 
	gsigçuÉ
;

89 
	gsi_bªd
;

90 
	gsi_fd
;

91 } 
	gsigpŞl
;

94 *
	gsi_ÿÎ_addr
;

95 
	gsi_sysÿÎ
;

96 
	gsi_¬ch
;

97 } 
	gsigsys
;

98 } 
	g_sif›lds
;

99 } 
	tsigšfo_t
;

101 -- 
nÙe
 
this
 
is
 
¡©64


102 
	g¡©
 = [[

103 
	s¡©
 {

104 
¡_dev
;

105 
__¡_·d0
[3];

106 
	g¡_šo
;

107 
mode_t
 
	g¡_mode
;

108 
Æšk_t
 
	g¡_Æšk
;

109 
uid_t
 
	g¡_uid
;

110 
gid_t
 
	g¡_gid
;

111 
	g¡_rdev
;

112 
	g__¡_·d1
[3];

113 
	g¡_size
;

114 
time_t
 
	g¡_©ime
;

115 
	g¡_©ime_n£c
;

116 
time_t
 
	g¡_mtime
;

117 
	g¡_mtime_n£c
;

118 
time_t
 
	g¡_ùime
;

119 
	g¡_ùime_n£c
;

120 
	g¡_blksize
;

121 
	g__¡_·d2
;

122 
	g¡_blocks
;

123 
	g__¡_·ddšg4
[14];

126 
	g¡©fs
 = [[

127 
	s¡©fs64
 {

128 
ušt32_t
 
f_ty³
;

129 
ušt32_t
 
f_bsize
;

130 
ušt32_t
 
f_äsize
;

131 
ušt32_t
 
__·d
;

132 
ušt64_t
 
f_blocks
;

133 
ušt64_t
 
f_bä“
;

134 
ušt64_t
 
f_fes
;

135 
ušt64_t
 
f_fä“
;

136 
ušt64_t
 
f_bava
;

137 
k”Ãl_fsid_t
 
f_fsid
;

138 
ušt32_t
 
f_Çm–’
;

139 
ušt32_t
 
f_æags
;

140 
ušt32_t
 
f_¥¬e
[5];

143 
	gnsig
 = [[

144 cÚ¡ 
_NSIG
 = 128;

146 
	g‹rmios
 = [[

147 
	s‹rmios
 {

148 
tcæag_t
 
c_iæag
;

149 
tcæag_t
 
c_oæag
;

150 
tcæag_t
 
c_cæag
;

151 
tcæag_t
 
c_læag
;

152 
cc_t
 
c_lše
;

153 
cc_t
 
c_cc
[23];

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/ioctl.lua

1 -- 
MIPS
 
ioùl
 
difã»nûs


3 
loÿl
 
	g¬ch
 = {

4 
IOC
 = {

5 
SIZEBITS
 = 13,

6 
	gDIRBITS
 = 3,

7 
	gNONE
 = 1,

8 
	gREAD
 = 2,

9 
	gWRITE
 = 4,

11 
	gioùl
 = 
funùiÚ
(
_IO
, 
_IOR
, 
_IOW
, 
_IORW
)

13 
	gFIONREAD
 = 0x467f,

14 
	gTCSBRK
 = 0x5405,

15 
	gTCXONC
 = 0x5406,

16 
	gTCFLSH
 = 0x5407,

17 
	gTCGETS
 = {
numb”
 = 0x540d, 
	g»ad
 = 
Œue
, 
	gty³
 = "termios"},

18 
	gTCSETS
 = 0x540e,

19 
	gTCSETSW
 = 0x540f,

20 
	gTCSETSF
 = 0x5410,

21 
	gTIOCPKT
 = 0x5470,

22 
	gTIOCNOTTY
 = 0x5471,

23 
	gTIOCSTI
 = 0x5472,

24 
	gTIOCSCTTY
 = 0x5480,

25 
	gTIOCGSOFTCAR
 = 0x5481,

26 
	gTIOCSSOFTCAR
 = 0x5482,

27 
	gTIOCLINUX
 = 0x5483,

28 
	gTIOCGSERIAL
 = 0x5484,

29 
	gTIOCSSERIAL
 = 0x5485,

30 
	gTCSBRKP
 = 0x5486,

31 
	gTIOCSERCONFIG
 = 0x5488,

32 
	gTIOCSERGWILD
 = 0x5489,

33 
	gTIOCSERSWILD
 = 0x548a,

34 
	gTIOCGLCKTRMIOS
 = 0x548b,

35 
	gTIOCSLCKTRMIOS
 = 0x548c,

36 
	gTIOCSERGSTRUCT
 = 0x548d,

37 
	gTIOCSERGETLSR
 = 0x548e,

38 
	gTIOCSERGETMULTI
= 0x548f,

39 
	gTIOCSERSETMULTI
= 0x5490,

40 
	gTIOCMIWAIT
 = 0x5491,

41 
	gTIOCGICOUNT
 = 0x5492,

42 
	gFIOCLEX
 = 0x6601,

43 
	gFIONCLEX
 = 0x6602,

44 
	gFIOASYNC
 = 0x667d,

45 
	gFIONBIO
 = 0x667e,

46 
	gFIOQSIZE
 = 0x667f,

47 
	gTIOCGETD
 = 0x7400,

48 
	gTIOCSETD
 = 0x7401,

49 
	gTIOCEXCL
 = 0x740d,

50 
	gTIOCNXCL
 = 0x740e,

51 
	gTIOCGSID
 = 0x7416,

52 
	gTIOCMSET
 = 0x741a,

53 
	gTIOCMBIS
 = 0x741b,

54 
	gTIOCMBIC
 = 0x741c,

55 
	gTIOCMGET
 = 0x741d,

56 
	gTIOCOUTQ
 = 0x7472,

57 
	gFIOGETOWN
 = 
_IOR
('f', 123, "int"),

58 
	gFIOSETOWN
 = 
_IOW
('f', 124, "int"),

59 
	gSIOCATMARK
 = 
_IOR
('s', 7, "int"),

60 
	gSIOCSPGRP
 = 
_IOW
('s', 8, "pid"),

61 
	gSIOCGPGRP
 = 
_IOR
('s', 9, "pid"),

62 
	gTIOCSWINSZ
 = 
_IOW
('t', 103, "winsize"),

63 
	gTIOCGWINSZ
 = 
_IOR
('t', 104, "winsize"),

64 
	gTIOCSPGRP
 = 
_IOW
('t', 118, "int"),

65 
	gTIOCGPGRP
 = 
_IOR
('t', 119, "int"),

66 
	gTIOCCONS
 = 
_IOW
('t', 120, "int"),

68 
	g’d
,

71  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/nr.lua

1 -- 
MIPS
 
sysÿÎ
 
numb”s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg


10 -- 
the£
 
¬e
 
difã»Á
 difã»Á 
ABIs
 
TODO
 
add
 
the
 
	g»¡
, TODO 
maybe
 
put
 
them
 
š
 difã»Á 
fes


12 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

13 
as£¹
(
abi
.
m§bi
 == "o32", "FIXME: syscalls only defined for o32 MIPS ABI")

15 
loÿl
 
	gÄ
 = {

16 
z”İad
 = 
Œue
,

17 
	gSYS
 = {

18 
sysÿÎ
 = 4000,

19 
	gex™
 = 4001,

20 
	gfÜk
 = 4002,

21 
	g»ad
 = 4003,

22 
	gwr™e
 = 4004,

23 
	gİ’
 = 4005,

24 
	gşo£
 = 4006,

25 
	gwa™pid
 = 4007,

26 
	gü—t
 = 4008,

27 
	glšk
 = 4009,

28 
	guÆšk
 = 4010,

29 
	gexecve
 = 4011,

30 
	gchdœ
 = 4012,

31 
	gtime
 = 4013,

32 
	gmknod
 = 4014,

33 
	gchmod
 = 4015,

34 
	glchown
 = 4016,

36 
	gunu£d18
 = 4018,

37 
	gl£ek
 = 4019,

38 
	gg‘pid
 = 4020,

39 
	gmouÁ
 = 4021,

40 
	gumouÁ
 = 4022,

41 
	g£tuid
 = 4023,

42 
	gg‘uid
 = 4024,

43 
	g¡ime
 = 4025,

44 
	g±¿û
 = 4026,

45 
	g®¬m
 = 4027,

46 
	gunu£d28
 = 4028,

47 
	g·u£
 = 4029,

48 
	gutime
 = 4030,

49 
	g¡ty
 = 4031,

50 
	gg‰y
 = 4032,

51 
	gacûss
 = 4033,

52 
	gniû
 = 4034,

53 
	gáime
 = 4035,

54 
	gsync
 = 4036,

55 
	gkl
 = 4037,

56 
	g»Çme
 = 4038,

57 
	gmkdœ
 = 4039,

58 
	grmdœ
 = 4040,

59 
	gdup
 = 4041,

60 
	gpe
 = 4042,

61 
	gtimes
 = 4043,

62 
	g´of
 = 4044,

63 
	gbrk
 = 4045,

64 
	g£tgid
 = 4046,

65 
	gg‘gid
 = 4047,

66 
	gsigÇl
 = 4048,

67 
	gg‘euid
 = 4049,

68 
	gg‘egid
 = 4050,

69 
	gacù
 = 4051,

70 
	gumouÁ2
 = 4052,

71 
	glock
 = 4053,

72 
	gioùl
 = 4054,

73 
	gfú
 = 4055,

74 
	gmpx
 = 4056,

75 
	g£gid
 = 4057,

76 
	gulim™
 = 4058,

77 
	gunu£d59
 = 4059,

78 
	gumask
 = 4060,

79 
	gchroÙ
 = 4061,

80 
	gu¡©
 = 4062,

81 
	gdup2
 = 4063,

82 
	gg‘µid
 = 4064,

83 
	gg‘pg½
 = 4065,

84 
	g£tsid
 = 4066,

85 
	gsigaùiÚ
 = 4067,

86 
	gsg‘mask
 = 4068,

87 
	gs£tmask
 = 4069,

88 
	g£Œeuid
 = 4070,

89 
	g£Œegid
 = 4071,

90 
	gsigsu¥’d
 = 4072,

91 
	gsig³ndšg
 = 4073,

92 
	g£tho¡Çme
 = 4074,

93 
	g£Œlim™
 = 4075,

94 
	gg‘¾im™
 = 4076,

95 
	gg‘ru§ge
 = 4077,

96 
	gg‘timeofday
 = 4078,

97 
	g£‰imeofday
 = 4079,

98 
	gg‘groups
 = 4080,

99 
	g£tgroups
 = 4081,

100 
	g»£rved82
 = 4082,

101 
	gsymlšk
 = 4083,

102 
	gunu£d84
 = 4084,

103 
	g»adlšk
 = 4085,

104 
	gu£lib
 = 4086,

105 
	gsw­Ú
 = 4087,

106 
	g»boÙ
 = 4088,

107 
	g»addœ
 = 4089,

108 
	gmm­
 = 4090,

109 
	gmunm­
 = 4091,

110 
	gŒunÿ‹
 = 4092,

111 
	gárunÿ‹
 = 4093,

112 
	gfchmod
 = 4094,

113 
	gfchown
 = 4095,

114 
	gg‘´iÜ™y
 = 4096,

115 
	g£riÜ™y
 = 4097,

116 
	g´of
 = 4098,

117 
	g¡©fs
 = 4099,

118 
	gf¡©fs
 = 4100,

119 
	giİ”m
 = 4101,

120 
	gsock‘ÿÎ
 = 4102,

121 
	gsy¦og
 = 4103,

122 
	g£t™im”
 = 4104,

123 
	gg‘™im”
 = 4105,

124 
	g¡©
 = 4106,

125 
	gl¡©
 = 4107,

126 
	gf¡©
 = 4108,

127 
	gunu£d109
 = 4109,

128 
	giİl
 = 4110,

129 
	gvhªgup
 = 4111,

130 
	gidË
 = 4112,

131 
	gvm86
 = 4113,

132 
	gwa™4
 = 4114,

133 
	gsw­off
 = 4115,

134 
	gsysšfo
 = 4116,

135 
	gc
 = 4117,

136 
	gfsync
 = 4118,

137 
	gsig»tuº
 = 4119,

138 
	gşÚe
 = 4120,

139 
	g£tdomašÇme
 = 4121,

140 
	guÇme
 = 4122,

141 
	gmodify_ldt
 = 4123,

142 
	gadjtimex
 = 4124,

143 
	gm´Ùeù
 = 4125,

144 
	gsig´ocmask
 = 4126,

145 
	gü—‹_moduË
 = 4127,

146 
	gš™_moduË
 = 4128,

147 
	gd–‘e_moduË
 = 4129,

148 
	gg‘_k”Ãl_syms
 = 4130,

149 
	gquÙaùl
 = 4131,

150 
	gg‘pgid
 = 4132,

151 
	gfchdœ
 = 4133,

152 
	gbdæush
 = 4134,

153 
	gsysfs
 = 4135,

154 
	g³rsÚ®™y
 = 4136,

155 
	gafs_sysÿÎ
 = 4137,

156 
	g£tfsuid
 = 4138,

157 
	g£tfsgid
 = 4139,

158 
	g_Î£ek
 = 4140,

159 
	gg‘d’ts
 = 4141,

160 
	g_Ãw£Ëù
 = 4142,

161 
	gæock
 = 4143,

162 
	gmsync
 = 4144,

163 
	g»adv
 = 4145,

164 
	gwr™ev
 = 4146,

165 
	gÿcheæush
 = 4147,

166 
	gÿcheùl
 = 4148,

167 
	gsysms
 = 4149,

168 
	gunu£d150
 = 4150,

169 
	gg‘sid
 = 4151,

170 
	gfd©async
 = 4152,

171 
	g_sysùl
 = 4153,

172 
	gmlock
 = 4154,

173 
	gmuÆock
 = 4155,

174 
	gmlock®l
 = 4156,

175 
	gmuÆock®l
 = 4157,

176 
	gsched_£¬am
 = 4158,

177 
	gsched_g‘·¿m
 = 4159,

178 
	gsched_£tscheduËr
 = 4160,

179 
	gsched_g‘scheduËr
 = 4161,

180 
	gsched_y›ld
 = 4162,

181 
	gsched_g‘_´iÜ™y_max
= 4163,

182 
	gsched_g‘_´iÜ™y_mš
= 4164,

183 
	gsched_¼_g‘_š‹rv®
 = 4165,

184 
	gÇno¦“p
 = 4166,

185 
	gm»m­
 = 4167,

186 
	gacû±
 = 4168,

187 
	gbšd
 = 4169,

188 
	gcÚÃù
 = 4170,

189 
	gg‘³”Çme
 = 4171,

190 
	gg‘sockÇme
 = 4172,

191 
	gg‘sockİt
 = 4173,

192 
	gli¡’
 = 4174,

193 
	g»cv
 = 4175,

194 
	g»cväom
 = 4176,

195 
	g»cvmsg
 = 4177,

196 
	g£nd
 = 4178,

197 
	g£ndmsg
 = 4179,

198 
	g£ndto
 = 4180,

199 
	g£tsockİt
 = 4181,

200 
	gshutdown
 = 4182,

201 
	gsock‘
 = 4183,

202 
	gsock‘·œ
 = 4184,

203 
	g£Œesuid
 = 4185,

204 
	gg‘»suid
 = 4186,

205 
	gqu”y_moduË
 = 4187,

206 
	gpŞl
 = 4188,

207 
	gnfs£rvùl
 = 4189,

208 
	g£Œesgid
 = 4190,

209 
	gg‘»sgid
 = 4191,

210 
	g´ùl
 = 4192,

211 
	g¹_sig»tuº
 = 4193,

212 
	g¹_sigaùiÚ
 = 4194,

213 
	g¹_sig´ocmask
 = 4195,

214 
	g¹_sig³ndšg
 = 4196,

215 
	g¹_sigtimedwa™
 = 4197,

216 
	g¹_sigqueuešfo
 = 4198,

217 
	g¹_sigsu¥’d
 = 4199,

218 
	g´—d64
 = 4200,

219 
	gpwr™e64
 = 4201,

220 
	gchown
 = 4202,

221 
	gg‘cwd
 = 4203,

222 
	gÿpg‘
 = 4204,

223 
	gÿp£t
 = 4205,

224 
	gsig®t¡ack
 = 4206,

225 
	g£ndfe
 = 4207,

226 
	gg‘pmsg
 = 4208,

227 
	gpumsg
 = 4209,

228 
	gmm­2
 = 4210,

229 
	gŒunÿ‹64
 = 4211,

230 
	gárunÿ‹64
 = 4212,

231 
	g¡©64
 = 4213,

232 
	gl¡©64
 = 4214,

233 
	gf¡©64
 = 4215,

234 
	gpivÙ_roÙ
 = 4216,

235 
	gmšcÜe
 = 4217,

236 
	gmadvi£
 = 4218,

237 
	gg‘d’ts64
 = 4219,

238 
	gfú64
 = 4220,

239 
	g»£rved221
 = 4221,

240 
	gg‘tid
 = 4222,

241 
	g»adah—d
 = 4223,

242 
	g£tx©Œ
 = 4224,

243 
	gl£tx©Œ
 = 4225,

244 
	gf£tx©Œ
 = 4226,

245 
	gg‘x©Œ
 = 4227,

246 
	glg‘x©Œ
 = 4228,

247 
	gfg‘x©Œ
 = 4229,

248 
	gli¡x©Œ
 = 4230,

249 
	gÎi¡x©Œ
 = 4231,

250 
	gæi¡x©Œ
 = 4232,

251 
	g»movex©Œ
 = 4233,

252 
	gÌemovex©Œ
 = 4234,

253 
	gäemovex©Œ
 = 4235,

254 
	gtkl
 = 4236,

255 
	g£ndfe64
 = 4237,

256 
	gfu‹x
 = 4238,

257 
	gsched_£ffš™y
 = 4239,

258 
	gsched_g‘affš™y
 = 4240,

259 
	gio_£tup
 = 4241,

260 
	gio_de¡roy
 = 4242,

261 
	gio_g‘ev’ts
 = 4243,

262 
	gio_subm™
 = 4244,

263 
	gio_ÿnûl
 = 4245,

264 
	gex™_group
 = 4246,

265 
	glookup_dcook›
 = 4247,

266 
	g•Şl_ü—‹
 = 4248,

267 
	g•Şl_ùl
 = 4249,

268 
	g•Şl_wa™
 = 4250,

269 
	g»m­_fe_·ges
 = 4251,

270 
	g£t_tid_add»ss
 = 4252,

271 
	g»¡¬t_sysÿÎ
 = 4253,

272 
	gçdvi£64
 = 4254,

273 
	g¡©fs64
 = 4255,

274 
	gf¡©fs64
 = 4256,

275 
	gtim”_ü—‹
 = 4257,

276 
	gtim”_£‰ime
 = 4258,

277 
	gtim”_g‘time
 = 4259,

278 
	gtim”_g‘ov”run
 = 4260,

279 
	gtim”_d–‘e
 = 4261,

280 
	gşock_£‰ime
 = 4262,

281 
	gşock_g‘time
 = 4263,

282 
	gşock_g‘»s
 = 4264,

283 
	gşock_Çno¦“p
 = 4265,

284 
	gtgkl
 = 4266,

285 
	gutimes
 = 4267,

286 
	gmbšd
 = 4268,

287 
	gg‘_mempŞicy
 = 4269,

288 
	g£t_mempŞicy
 = 4270,

289 
	gmq_İ’
 = 4271,

290 
	gmq_uÆšk
 = 4272,

291 
	gmq_timed£nd
 = 4273,

292 
	gmq_timed»ûive
 = 4274,

293 
	gmq_nÙify
 = 4275,

294 
	gmq_g‘£‰r
 = 4276,

295 
	gv£rv”
 = 4277,

296 
	gwa™id
 = 4278,

297 
	gadd_key
 = 4280,

298 
	g»que¡_key
 = 4281,

299 
	gkeyùl
 = 4282,

300 
	g£t_th»ad_¬—
 = 4283,

301 
	gšÙify_š™
 = 4284,

302 
	gšÙify_add_w©ch
 = 4285,

303 
	gšÙify_rm_w©ch
 = 4286,

304 
	gmig¿‹_·ges
 = 4287,

305 
	gİ’©
 = 4288,

306 
	gmkdœ©
 = 4289,

307 
	gmknod©
 = 4290,

308 
	gfchowÇt
 = 4291,

309 
	gfutime§t
 = 4292,

310 
	gf¡©©64
 = 4293,

311 
	guÆšk©
 = 4294,

312 
	g»Çm—t
 = 4295,

313 
	glšk©
 = 4296,

314 
	gsymlšk©
 = 4297,

315 
	g»adlšk©
 = 4298,

316 
	gfchmod©
 = 4299,

317 
	gçcûs§t
 = 4300,

318 
	gp£Ëù6
 = 4301,

319 
	gµŞl
 = 4302,

320 
	gunsh¬e
 = 4303,

321 
	g¥liû
 = 4304,

322 
	gsync_fe_¿nge
 = 4305,

323 
	g‹e
 = 4306,

324 
	gvm¥liû
 = 4307,

325 
	gmove_·ges
 = 4308,

326 
	g£t_robu¡_li¡
 = 4309,

327 
	gg‘_robu¡_li¡
 = 4310,

328 
	gkexec_lßd
 = 4311,

329 
	gg‘ıu
 = 4312,

330 
	g•Şl_pwa™
 = 4313,

331 
	giİrio_£t
 = 4314,

332 
	giİrio_g‘
 = 4315,

333 
	gutim’§t
 = 4316,

334 
	gsigÇlfd
 = 4317,

335 
	gtim”fd
 = 4318,

336 
	gev’tfd
 = 4319,

337 
	gçÎoÿ‹
 = 4320,

338 
	gtim”fd_ü—‹
 = 4321,

339 
	gtim”fd_g‘time
 = 4322,

340 
	gtim”fd_£‰ime
 = 4323,

341 
	gsigÇlfd4
 = 4324,

342 
	gev’tfd2
 = 4325,

343 
	g•Şl_ü—‹1
 = 4326,

344 
	gdup3
 = 4327,

345 
	gpe2
 = 4328,

346 
	gšÙify_š™1
 = 4329,

347 
	g´—dv
 = 4330,

348 
	gpwr™ev
 = 4331,

349 
	g¹_tgsigqueuešfo
 = 4332,

350 
	g³rf_ev’t_İ’
 = 4333,

351 
	gacû±4
 = 4334,

352 
	g»cvmmsg
 = 4335,

353 
	gçnÙify_š™
 = 4336,

354 
	gçnÙify_m¬k
 = 4337,

355 
	g´lim™64
 = 4338,

356 
	gÇme_to_hªdË_©
 = 4339,

357 
	gİ’_by_hªdË_©
 = 4340,

358 
	gşock_adjtime
 = 4341,

359 
	gsyncfs
 = 4342,

360 
	g£ndmmsg
 = 4343,

361 
	g£Šs
 = 4344,

362 
	g´oûss_vm_»adv
 = 4345,

363 
	g´oûss_vm_wr™ev
 = 4346,

367  
	gÄ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/netfilter.lua

1 -- 
moduË
 
Ãtf‹r
 
	gcode


2 -- 
wl
 
cov”
 
	gbËs
, 
	g6bËs
, 
	gebbËs
, 
¬±abËs
 
	gev’tu®ly


3 -- 
ev’
 
Ëss
 
docum’tiÚ
 
thª
 
Ãšk
 
but
 
™
 
dÛs
 
nÙ
 
look
 
too
 
	gbad
...

5 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

6 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

7 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

8 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

9 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

10 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


12 
loÿl
 
	gnf
 = {} -- 
expÜts


14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

16 
loÿl
 
S
 = 
»quœe
 "syscall"

17 
loÿl
 
h–³rs
 = 
»quœe
 "syscall.helpers"

18 
loÿl
 
c
 = 
S
.c

19 
loÿl
 
ty³s
 = 
S
.types

20 
loÿl
 
t
, 
	g±
, 
	gs
 = 
ty³s
.t, 
	gty³s
.±,y³s.
s


22 
funùiÚ
 
	gnf
.
	$sock‘
(
çmy
)

23  
S
.
	`sock‘
(
çmy
, "raw", "raw")

24 
’d


26 
loÿl
 
Ëv–
 = {

27 [
c
.
AF
.
INET
] = c.
IPPROTO
.
IP
,

28 [
c
.
AF
.
INET6
] = c.
IPPROTO
.
IPV6
,

29 
	}
}

31 
funùiÚ
 
	gnf
.
	$v”siÚ
(
çmy
)

32 
çmy
 = famy 
Ü
 
c
.
AF
.
INET


33 
loÿl
 
sock
, 
”r
 = 
nf
.
	$sock‘
(
çmy
)

34 
nÙ
 
sock
 
th’
  
n
, 
”r
 
’d


35 
loÿl
 
»v
 = 
t
.
	$xt_g‘_»visiÚ
()

36 
loÿl
 
max
, 
”r
 = 
sock
:
	`g‘sockİt
(
Ëv–
[
çmy
], 
c
.
IPT_SO_GET
.
REVISION_TARGET
, 
»v
, 
s
.
xt_g‘_»visiÚ
);

37 
loÿl
 
ok
, 
û¼
 = 
sock
:
	$şo£
()

38 
nÙ
 
ok
 
th’
  
n
, 
û¼
 
’d


39 
nÙ
 
max
 
th’
  
n
, 
”r
 
’d


40  
max


41 
’d


43  
nf


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/nl.lua

1 -- 
moduÏrize
 
Ãšk
 
code
 
as
 
™
 
is
 
Ïrge
 
ªd
 
¡ªd®Úe


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
S
)

12 
loÿl
 
Æ
 = {
	}
} -- 
expÜts


14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

17 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

19 
loÿl
 
ut
 = 
S
.util

21 
loÿl
 
ty³s
 = 
S
.types

22 
loÿl
 
c
 = 
S
.c

24 
loÿl
 
htÚl
 = 
h
.htonl

25 
loÿl
 
®ign
 = 
h
.align

27 
loÿl
 
t
, 
	g±
, 
	gs
 = 
ty³s
.t, 
	gty³s
.±,y³s.
s


29 
loÿl
 
	gad‰
 = {

30 [
c
.
AF
.
INET
] = 
t
.
š_addr
,

31 [
c
.
AF
.
INET6
] = 
t
.
š6_addr
,

34 
loÿl
 
funùiÚ
 
	$add¹y³
(
af
)

35 
loÿl
 

 = 
ad‰
[
	`tÚumb”
(
af
)]

36 
nÙ
 

 
th’
 
	`”rÜ
("bad‡dd»s çmy"è
’d


37  
	$
()

38 
’d


40 
loÿl
 
funùiÚ
 
	$mkty³
(

, 
x
è
ffi
.
	$i¡y³
(

, 
x
è
th’
  x  
	$
(
x
è
’d
ƒnd

42 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


43 
loÿl
 
m‘h
 = {}

45 -- 
sim¬
 
funùiÚs
 
Ãšk
 
mes§ges


46 
loÿl
 
funùiÚ
 
	$Æmsg_®ign
(
Ën
è 
	$®ign
(
Ën
, 4è
’d


47 
loÿl
 
Æmsg_hd¾’
 = 
	$Æmsg_®ign
(
s
.
Æmsghdr
)

48 
loÿl
 
funùiÚ
 
	$Æmsg_Ëngth
(
Ën
è†’ + 
Æmsg_hd¾’
 
’d


49 
loÿl
 
funùiÚ
 
	$Æmsg_ok
(
msg
, 
Ën
)

50  
Ën
 >ğ
Æmsg_hd¾’
 
ªd
 
msg
.
Æmsg_Ën
 >=‚lmsg_hdrlen‡nd msg.nlmsg_len <=†en

51 
’d


52 
loÿl
 
funùiÚ
 
	$Æmsg_Ãxt
(
msg
, 
buf
, 
Ën
)

53 
loÿl
 
šc
 = 
	$Æmsg_®ign
(
msg
.
Æmsg_Ën
)

54  
±
.
	`Æmsghdr
(
buf
 + 
šc
), buà+ inc, 
Ën
 - inc

55 
’d


57 
loÿl
 
¹a_®ign
 = 
Æmsg_®ign
 -- 
®so
 4 
by‹
 
®ign


58 
loÿl
 
funùiÚ
 
	$¹a_Ëngth
(
Ën
è†’ + 
	$¹a_®ign
(
s
.
¹©Œ
è
’d


59 
loÿl
 
funùiÚ
 
	$¹a_ok
(
msg
, 
Ën
)

60  
Ën
 >ğ
s
.
¹©Œ
 
ªd
 
msg
.
¹a_Ën
 >= s.rtattr‡nd msg.rta_len <=†en

61 
’d


62 
loÿl
 
funùiÚ
 
	$¹a_Ãxt
(
msg
, 
buf
, 
Ën
)

63 
loÿl
 
šc
 = 
	$¹a_®ign
(
msg
.
¹a_Ën
)

64  
±
.
	`¹©Œ
(
buf
 + 
šc
), buà+ inc, 
Ën
 - inc

65 
’d


67 
loÿl
 
add¾’m­
 = { -- 
m­
 
š‹rçû
 
ty³
 
to
 
Ëngth
 
of
 
h¬dw¬e
 
add»ss
 
TODO
 
¬e
 
the£
 
®ways
 
§me
?

68 [
c
.
ARPHRD
.
ETHER
] = 6,

69 [
c
.
ARPHRD
.
EETHER
] = 6,

70 [
c
.
ARPHRD
.
LOOPBACK
] = 6,

71 
	}
}

73 
loÿl
 
	giæa_decode
 = {

74 [
c
.
IFLA
.
IFNAME
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

75 
	gœ
.
	gÇme
 = 
ffi
.
¡ršg
(
buf
)

76 
’d
,

77 [
c
.
IFLA
.
ADDRESS
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

78 
loÿl
 
	gadd¾’
 = 
add¾’m­
[
œ
.
ty³
]

79 ià(
add¾’
è
th’


80 
œ
.
add¾’
 =‡ddrlen

81 
œ
.
maÿddr
 = 
t
.macaddr()

82 
ffi
.
cİy
(
œ
.
maÿddr
, 
buf
, 
add¾’
)

83 
’d


84 
	g’d
,

85 [
c
.
IFLA
.
BROADCAST
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

86 
loÿl
 
	gadd¾’
 = 
add¾’m­
[
œ
.
ty³
] -- 
TODO
 
®ways
 
§me


87 ià(
add¾’
è
th’


88 
œ
.
brßdÿ¡
 = 
t
.
maÿddr
()

89 
ffi
.
cİy
(
œ
.
brßdÿ¡
, 
buf
, 
add¾’
)

90 
’d


91 
	g’d
,

92 [
c
.
IFLA
.
MTU
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

93 
loÿl
 
	gu
 = 
±
.
ušt
(
buf
)

94 
œ
.
mtu
 = 
tÚumb”
(
u
[0])

95 
’d
,

96 [
c
.
IFLA
.
LINK
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

97 
loÿl
 
	gi
 = 
±
.(
buf
)

98 
œ
.
lšk
 = 
tÚumb”
(
i
[0])

99 
’d
,

100 [
c
.
IFLA
.
QDISC
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

101 
	gœ
.
	gqdisc
 = 
ffi
.
¡ršg
(
buf
)

102 
’d
,

103 [
c
.
IFLA
.
STATS
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

104 
	gœ
.
	g¡©s
 = 
t
.
¹Æ_lšk_¡©s
(è-- 
de¥™e
 
mª
 
·ge
, 
this
 
is
 
wh©
 
k”Ãl
 
	gu£s
. 
So
 
Úly
 
	gg‘
 32 
b™
 
¡©s
 
	gh”e
.

105 
	gffi
.
cİy
(
œ
.
¡©s
, 
buf
, 
s
.
¹Æ_lšk_¡©s
)

106 
	g’d


109 
loÿl
 
	giç_decode
 = {

110 [
c
.
IFA
.
ADDRESS
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

111 
	gœ
.
	gaddr
 = 
add¹y³
(
œ
.
çmy
)

112 
ffi
.
cİy
(
œ
.
addr
, 
buf
, ffi.(ir.addr))

113 
	g’d
,

114 [
c
.
IFA
.
LOCAL
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

115 
	gœ
.
	gloc
 = 
add¹y³
(
œ
.
çmy
)

116 
ffi
.
cİy
(
œ
.
loc
, 
buf
, ffi.(ir.loc))

117 
	g’d
,

118 [
c
.
IFA
.
BROADCAST
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

119 
	gœ
.
	gbrßdÿ¡
 = 
add¹y³
(
œ
.
çmy
)

120 
ffi
.
cİy
(
œ
.
brßdÿ¡
, 
buf
, ffi.(ir.broadcast))

121 
	g’d
,

122 [
c
.
IFA
.
LABEL
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

123 
	gœ
.
	gÏb–
 = 
ffi
.
¡ršg
(
buf
)

124 
’d
,

125 [
c
.
IFA
.
ANYCAST
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

126 
	gœ
.
	gªyÿ¡
 = 
add¹y³
(
œ
.
çmy
)

127 
ffi
.
cİy
(
œ
.
ªyÿ¡
, 
buf
, ffi.(ir.anycast))

128 
	g’d
,

129 [
c
.
IFA
.
CACHEINFO
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

130 
	gœ
.
	gÿchešfo
 = 
t
.
iç_ÿchešfo
()

131 
ffi
.
cİy
(
œ
.
ÿchešfo
, 
buf
, ffi.(
t
.
iç_ÿchešfo
))

132 
	g’d
,

135 
loÿl
 
	g¹a_decode
 = {

136 [
c
.
RTA
.
DST
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

137 
	gœ
.
	gd¡
 = 
add¹y³
(
œ
.
çmy
)

138 
ffi
.
cİy
(
œ
.
d¡
, 
buf
, ffi.(ir.dst))

139 
	g’d
,

140 [
c
.
RTA
.
SRC
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

141 
	gœ
.
	g¤c
 = 
add¹y³
(
œ
.
çmy
)

142 
ffi
.
cİy
(
œ
.
¤c
, 
buf
, ffi.(ir.src))

143 
	g’d
,

144 [
c
.
RTA
.
IIF
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

145 
loÿl
 
	gi
 = 
±
.(
buf
)

146 
œ
.
iif
 = 
tÚumb”
(
i
[0])

147 
’d
,

148 [
c
.
RTA
.
OIF
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

149 
loÿl
 
	gi
 = 
±
.(
buf
)

150 
œ
.
oif
 = 
tÚumb”
(
i
[0])

151 
’d
,

152 [
c
.
RTA
.
GATEWAY
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

153 
	gœ
.
	gg©eway
 = 
add¹y³
(
œ
.
çmy
)

154 
ffi
.
cİy
(
œ
.
g©eway
, 
buf
, ffi.(ir.gateway))

155 
	g’d
,

156 [
c
.
RTA
.
PRIORITY
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

157 
loÿl
 
	gi
 = 
±
.(
buf
)

158 
œ
.
´iÜ™y
 = 
tÚumb”
(
i
[0])

159 
’d
,

160 [
c
.
RTA
.
PREFSRC
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

161 
loÿl
 
	gi
 = 
±
.
ušt32
(
buf
)

162 
œ
.
´ef¤c
 = 
tÚumb”
(
i
[0])

163 
’d
,

164 [
c
.
RTA
.
METRICS
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

165 
loÿl
 
	gi
 = 
±
.(
buf
)

166 
œ
.
m‘rics
 = 
tÚumb”
(
i
[0])

167 
’d
,

168 [
c
.
RTA
.
TABLE
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

169 
loÿl
 
	gi
 = 
±
.
ušt32
(
buf
)

170 
œ
.
bË
 = 
tÚumb”
(
i
[0])

171 
’d
,

172 [
c
.
RTA
.
CACHEINFO
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

173 
	gœ
.
	gÿchešfo
 = 
t
.
¹a_ÿchešfo
()

174 
ffi
.
cİy
(
œ
.
ÿchešfo
, 
buf
, 
s
.
¹a_ÿchešfo
)

175 
	g’d
,

176 [
c
.
RTA
.
PREF
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

177 
loÿl
 
	gi
 = 
±
.
ušt8
(
buf
)

178 
œ
.
´ef
 = 
tÚumb”
(
i
[0])

179 
’d
,

180 -- 
TODO
 
some
 
	gmissšg


183 
loÿl
 
	gnda_decode
 = {

184 [
c
.
NDA
.
DST
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

185 
	gœ
.
	gd¡
 = 
add¹y³
(
œ
.
çmy
)

186 
ffi
.
cİy
(
œ
.
d¡
, 
buf
, ffi.(ir.dst))

187 
	g’d
,

188 [
c
.
NDA
.
LLADDR
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

189 
	gœ
.
	gÎaddr
 = 
t
.
maÿddr
()

190 
ffi
.
cİy
(
œ
.
Îaddr
, 
buf
, 
s
.
maÿddr
)

191 
	g’d
,

192 [
c
.
NDA
.
CACHEINFO
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

193 
	gœ
.
	gÿchešfo
 = 
t
.
nda_ÿchešfo
()

194 
ffi
.
cİy
(
œ
.
ÿchešfo
, 
buf
, 
s
.
nda_ÿchešfo
)

195 
	g’d
,

196 [
c
.
NDA
.
PROBES
] = 
funùiÚ
(
œ
, 
buf
, 
Ën
)

197 -- 
TODO
 
wh©
 
is
 
	gthis
? 4 
by‹s


198 
	g’d
,

201 
loÿl
 
	gifæi¡
 = {}

202 
k
, 
_
 
š
 
	$·œs
(
c
.
IFF
èdØ
ifæi¡
[#ifæi¡ + 1] = 
k
 
’d


204 
mt
.
iff
 = {

205 
__to¡ršg
 = 
	`funùiÚ
(
f
)

206 
loÿl
 
s
 = {}

207 
_
, 
k
 
š
 
	`·œs
(
ifæi¡
èdØ
b™
.
	`bªd
(
f
.
æags
, 
c
.
IFF
[k]è~ğ0 
th’
 
s
[# + 1] = k 
’d
ƒnd

208  
bË
.
	`cÚÿt
(
s
, ' ')

209 
’d
,

210 
__šdex
 = 
	`funùiÚ
(
f
, 
k
)

211 
c
.
IFF
[
k
] 
th’
  
b™
.
	`bªd
(
f
.
æags
, c.IFF[k]è~ğ0 
’d


212 
’d


213 
	}
}

215 
	gÆ
.
	g’ÿ²ames
 = {

216 [
c
.
ARPHRD
.
ETHER
] = "Ethernet",

217 [
c
.
ARPHRD
.
LOOPBACK
] = "Local Loopback",

220 
	gm‘h
.
	giæšks
 = {

221 
â
 = {

222 
»äesh
 = 
funùiÚ
(
i
)

223 
loÿl
 
j
, 
	g”r
 = 
Æ
.
š‹rçûs
()

224 
nÙ
 
j
 
th’
  
n
, 
”r
 
’d


225 
	gk
, 
_
 
š
 
·œs
(
i
èdØ
	gi
[
k
] = 
n
 
’d


226 
k
, 
v
 
š
 
·œs
(
j
èdØ
	gi
[k] = v 
’d


227  
i


228 
’d
,

232 
	gmt
.
	giæšks
 = {

233 
__šdex
 = 
funùiÚ
(
i
, 
k
)

234 
	gm‘h
.
	giæšks
.
	gâ
[
k
] 
th’
  m‘h.iæšks.â[k] 
’d


235 
	g’d
,

236 
	g__to¡ršg
 = 
funùiÚ
(
is
)

237 
loÿl
 
s
 = {}

238 
_
, 
v
 
š
 
aœs
(
is
) do

239 
	gs
[# + 1] = 
to¡ršg
(
v
)

240 
’d


241  
bË
.
cÚÿt
(
s
, '\n')

242 
	g’d


245 
	gm‘h
.
	giæšk
 = {

246 
šdex
 = {

247 
çmy
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
ifšfo
.
ifi_çmy
è
’d
,

248 
	gty³
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
ifšfo
.
ifi_ty³
è
’d
,

249 
	gty³Çme
 = 
funùiÚ
(
i
)

250 
loÿl
 
n
 = 
Æ
.
’ÿ²ames
[
i
.
ty³
]

251  
n
 
Ü
 'unknowÀ' .. 
i
.
ty³


252 
’d
,

253 
	gšdex
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
ifšfo
.
ifi_šdex
è
’d
,

254 
	gæags
 = 
funùiÚ
(
i
è 
£tm‘©abË
({
æags
 = 
tÚumb”
(i.
ifšfo
.
ifi_æags
)}, 
mt
.
iff
è
	g’d
,

255 
	gchªge
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
ifšfo
.
ifi_chªge
è
’d
,

257 
	gâ
 = {

258 
£tæags
 = 
funùiÚ
(
i
, 
æags
, 
chªge
)

259 
loÿl
 
	gok
, 
	g”r
 = 
Æ
.
Ãwlšk
(
i
, 0, 
æags
, 
chªge
 
Ü
 
c
.
IFF
.
ALL
)

260 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


261  
	gi
:
»äesh
()

262 
’d
,

263 
	gup
 = 
funùiÚ
(
i
è i:
£tæags
("up", "up"è
	g’d
,

264 
	gdown
 = 
funùiÚ
(
i
è i:
£tæags
("", "up"è
	g’d
,

265 
	g£tmtu
 = 
funùiÚ
(
i
, 
mtu
)

266 
loÿl
 
	gok
, 
	g”r
 = 
Æ
.
Ãwlšk
(
i
.
šdex
, 0, 0, 0, "mtu", 
mtu
)

267 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


268  
	gi
:
»äesh
()

269 
’d
,

270 
	g£tmac
 = 
funùiÚ
(
i
, 
mac
)

271 
loÿl
 
	gok
, 
	g”r
 = 
Æ
.
Ãwlšk
(
i
.
šdex
, 0, 0, 0, "add»ss", 
mac
)

272 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


273  
	gi
:
»äesh
()

274 
’d
,

275 
	gadd»ss
 = 
funùiÚ
(
i
, 
add»ss
, 
Ãtmask
è-- 
add
‡ddress

276 
ty³
(
add»ss
è=ğ"¡ršg" 
th’
‡dd»ss, 
	gÃtmask
 = 
ut
.
š‘_Çme
×dd»ss, 
Ãtmask
è
’d


277 
nÙ
 
add»ss
 
th’
  
n
 
’d


278 
loÿl
 
	gok
, 
”r


279 
	gffi
.
i¡y³
(
t
.
š6_addr
, 
add»ss
è
th’


280 
	gok
, 
	g”r
 = 
Æ
.
Ãwaddr
(
i
.
šdex
, 
c
.
AF
.
INET6
, 
Ãtmask
, "³rmª’t", "loÿl", 
add»ss
)

282 
loÿl
 
	gbrßdÿ¡
 = 
add»ss
:
g‘_mask_bÿ¡
(
Ãtmask
).
brßdÿ¡


283 
ok
, 
	g”r
 = 
Æ
.
Ãwaddr
(
i
.
šdex
, 
c
.
AF
.
INET
, 
Ãtmask
, "³rmª’t", "loÿl", 
add»ss
, "brßdÿ¡", 
brßdÿ¡
)

284 
’d


285 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


286  
	gi
:
»äesh
()

287 
’d
,

288 
	gd–add»ss
 = 
funùiÚ
(
i
, 
add»ss
, 
Ãtmask
)

289 
ty³
(
add»ss
è=ğ"¡ršg" 
th’
‡dd»ss, 
	gÃtmask
 = 
ut
.
š‘_Çme
×dd»ss, 
Ãtmask
è
’d


290 
nÙ
 
add»ss
 
th’
  
n
 
’d


291 
loÿl
 
af


292 
	gffi
.
i¡y³
(
t
.
š6_addr
, 
add»ss
è
th’
 
	gaf
 = 
c
.
AF
.
INET6
 
af
 = c.AF.
INET
 
’d


293 
loÿl
 
ok
, 
	g”r
 = 
Æ
.
d–addr
(
i
.
šdex
, 
af
, 
Ãtmask
, "loÿl", 
add»ss
)

294 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


295  
	gi
:
»äesh
()

296 
’d
,

297 
	gd–‘e
 = 
funùiÚ
(
i
)

298 
loÿl
 
ok
, 
	g”r
 = 
Æ
.
d–lšk
(
i
.
šdex
)

299 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


300  
Œue


301 
	g’d
,

302 
	gmove_ns
 = 
funùiÚ
(
i
, 
ns
è-- 
TODO
 
®so
 
suµÜt
 
fe
 
desütÜ
 
fÜm
 
as
 
w–l
‡ 
pid


303 
loÿl
 
	gok
, 
	g”r
 = 
Æ
.
Ãwlšk
(
i
.
šdex
, 0, 0, 0, "Ãt_ns_pid", 
ns
)

304 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


305  
	gŒue
 -- 
no
 
lÚg”
 
h”e
 
so
 
ÿÂÙ
 
»äesh


306 
	g’d
,

307 
	g»Çme
 = 
funùiÚ
(
i
, 
Çme
)

308 
loÿl
 
	gok
, 
	g”r
 = 
Æ
.
Ãwlšk
(
i
.
šdex
, 0, 0, 0, "iâame", 
Çme
)

309 
nÙ
 
ok
 
th’
  
	gn
, 
”r
 
’d


310 
	gi
.
	gÇme
 = 
Çme
 -- 
»äesh
 
nÙ
 
wÜkšg
 
Ùh”wi£
 
as
 
dÚe
 
by
‚am
TODO
 
fix
 
so
 by 
šdex


311  
i
:
»äesh
()

312 
’d
,

313 
	g»äesh
 = 
funùiÚ
(
i
)

314 
loÿl
 
j
, 
	g”r
 = 
Æ
.
š‹rçû
(
i
.
Çme
)

315 
nÙ
 
j
 
th’
  
n
, 
”r
 
’d


316 
	gk
, 
_
 
š
 
·œs
(
i
èdØ
	gi
[
k
] = 
n
 
’d


317 
k
, 
v
 
š
 
·œs
(
j
èdØ
	gi
[k] = v 
’d


318  
i


319 
’d
,

323 
	gmt
.
	giæšk
 = {

324 
__šdex
 = 
funùiÚ
(
i
, 
k
)

325 
	gm‘h
.
	giæšk
.
	gšdex
[
k
] 
th’
  m‘h.iæšk.šdex[k](
	gi
è
’d


326 
	gm‘h
.
	giæšk
.
	gâ
[
k
] 
th’
  m‘h.iæšk.â[k] 
’d


327 
	gk
 =ğ"š‘" 
Ü
 
k
 =ğ"š‘6" 
th’
  
’d
 -- 
might
 
nÙ
 
be
 
£t
, 
as
 
we
 
add
 
	g™
, 
k”Ãl
 
dÛs
‚Ù 
´ovide


328 
	gc
.
	gARPHRD
[
k
] 
th’
  
	gi
.
	gifšfo
.
	gifi_ty³
 =ğ
c
.
ARPHRD
[k] 
’d


329 
’d
,

330 
	g__to¡ršg
 = 
funùiÚ
(
i
)

331 
loÿl
 
hw
 = ''

332 
nÙ
 
i
.
loİback
 
ªd
 i.
maÿddr
 
th’
 
hw
 = ' HWadd¸' .. 
to¡ršg
(i.maÿddrè
’d


333 
loÿl
 
s
 = 
i
.
Çme
 .. 
¡ršg
.
»p
(' ', 10 - #i.Çmeè.. 'Lškƒnÿp:' .. 
	gi
.
	gty³Çme
 .. 
	ghw
 .. '\n'

334 
	gi
.
š‘
 
th’
 
	ga
 = 1, #i.inet do

335 
	gs
 = 
s
 .. ' ' .. 'š‘‡ddr: ' .. 
to¡ršg
(
i
.
š‘
[
a
].
addr
è.. '/' .. i.š‘[a].
´efixËn
 .. '\n'

336 
’d
ƒnd

337 
i
.
š‘6
 
th’
 
a
 = 1, #i.inet6 do

338 
	gs
 = 
s
 .. ' ' .. 'š‘6‡ddr: ' .. 
to¡ršg
(
i
.
š‘6
[
a
].
addr
è.. '/' .. i.š‘6[a].
´efixËn
 .. '\n'

339 
’d
ƒnd

340 
s
 = s .. ' ' .. 
to¡ršg
(
i
.
æags
è.. ' MTU: ' .. i.
mtu
 .. '\n'

341 
s
 = s .. ' ' .. 'RX…ack‘s:' .. 
i
.
¡©s
.
rx_·ck‘s
 .. 'ƒ¼Üs:' .. i.¡©s.
rx_”rÜs
 .. ' drİ³d:' .. i.¡©s.
rx_drİ³d
 .. '\n'

342 
s
 = s .. ' ' .. 'TX…ack‘s:' .. 
i
.
¡©s
.
tx_·ck‘s
 .. 'ƒ¼Üs:' .. i.¡©s.
tx_”rÜs
 .. ' drİ³d:' .. i.¡©s.
tx_drİ³d
 .. '\n'

343  
s


344 
’d


347 
	gm‘h
.
	g¹msg
 = {

348 
šdex
 = {

349 
çmy
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
¹msg
.
¹m_çmy
è
’d
,

350 
	gd¡_Ën
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
¹msg
.
¹m_d¡_Ën
è
’d
,

351 
	g¤c_Ën
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
¹msg
.
¹m_¤c_Ën
è
’d
,

352 
	gšdex
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
oif
è
’d
,

353 
	gæags
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
¹msg
.
¹m_æags
è
’d
,

354 
	gde¡
 = 
funùiÚ
(
i
è i.
d¡
 
Ü
 
add¹y³
(i.
çmy
è
’d
,

355 
	gsourû
 = 
funùiÚ
(
i
è i.
¤c
 
Ü
 
add¹y³
(i.
çmy
è
’d
,

356 
	ggw
 = 
funùiÚ
(
i
è i.
g©eway
 
Ü
 
add¹y³
(i.
çmy
è
’d
,

357 -- 
might
 
nÙ
 
be
 
£t
 
š
 
Lua
 
	gbË
, 
so
  
n


358 
	giif
 = 
funùiÚ
(è 
n
 
’d
,

359 
	goif
 = 
funùiÚ
(è 
n
 
’d
,

360 
	g¤c
 = 
funùiÚ
(è 
n
 
’d
,

361 
	gd¡
 = 
funùiÚ
(è 
n
 
’d
,

363 
	gæags
 = { -- 
TODO
 
»wÜk
 
so
 
™”©es
 
š
 
fixed
 
Üd”
. TODO 
Do
 
nÙ
 
£em
 
to
 
be
 
£t
, 
fšd
 
how
Ø
»Œ›ve
.

364 [
c
.
RTF
.
UP
] = "U",

365 [
c
.
RTF
.
GATEWAY
] = "G",

366 [
c
.
RTF
.
HOST
] = "H",

367 [
c
.
RTF
.
REINSTATE
] = "R",

368 [
c
.
RTF
.
DYNAMIC
] = "D",

369 [
c
.
RTF
.
MODIFIED
] = "M",

370 [
c
.
RTF
.
REJECT
] = "!",

374 
	gmt
.
	g¹msg
 = {

375 
__šdex
 = 
funùiÚ
(
i
, 
k
)

376 
	gm‘h
.
	g¹msg
.
	gšdex
[
k
] 
th’
  m‘h.¹msg.šdex[k](
	gi
è
	g’d


377 -- 
	gS
.
	gRTF
[
k
] 
th’
  
	gb™
.
bªd
(
i
.
æags
, 
S
.
RTF
[k]è~ğ0 
’d
 -- 
TODO
 
£e
 
above


378 
’d
,

379 
	g__to¡ršg
 = 
funùiÚ
(
i
è-- 
TODO
 
make
 
mÜe
 
like
 
ouut
 
of
 

 
rou‹


380 
loÿl
 
s
 = "d¡: " .. 
to¡ršg
(
i
.
de¡
è.. "/" .. i.
d¡_Ën
 .. " g©eway: " ..o¡ršg(i.
gw
è.. " src: " ..o¡ršg(i.
sourû
è.. "/" .. i.
¤c_Ën
 .. " if: " .. (i.
ouut
 
Ü
 i.
oif
)

381  
s


382 
’d
,

385 
	gm‘h
.
	grou‹s
 = {

386 
â
 = {

387 
m©ch
 = 
funùiÚ
(
rs
, 
addr
, 
Ën
è-- 
exaù
 match

388 
ty³
(
addr
è=ğ"¡ršg" 
th’


389 
loÿl
 
¦
 = 
addr
:
fšd
("/", 1, 
Œue
)

390 
¦
 
th’


391 
	gËn
 = 
tÚumb”
(
addr
:
sub
(
¦
 + 1))

392 
addr
 =‡ddr:
sub
(1, 
¦
 - 1)

393 
’d


394 
	grs
.
	gçmy
 =ğ
c
.
AF
.
INET6
 
th’
 
addr
 = 
t
.
š6_addr
×ddrèadd¸ğt.
š_addr
×ddrè
’d


395 
’d


396 
loÿl
 
m©ches
 = {}

397 
_
, 
v
 
š
 
aœs
(
rs
) do

398 
	gËn
 =ğ
v
.
d¡_Ën
 
th’


399 
v
.
çmy
 =ğ
c
.
AF
.
INET
 
th’


400 
addr
.
s_addr
 =ğ
v
.
de¡
.s_add¸
th’
 
m©ches
[#m©che + 1] = v 
’d


402 
loÿl
 
m©ch
 = 
Œue


403 
i
 = 0, 15 do

404 
	gaddr
.
	gs6_addr
[
i
] ~ğ
v
.
de¡
.
s6_addr
[i] 
th’
 
m©ch
 = 
çl£
 
’d


405 
’d


406 
m©ch
 
th’
 
m©ches
[#m©che + 1] = 
v
 
’d


407 
’d


408 
’d


409 
’d


410 
m©ches
.

, 
	gm©ches
.
	gçmy
 = 
rs
., 
	grs
.
çmy


411  
£tm‘©abË
(
m©ches
, 
mt
.
rou‹s
)

412 
	g’d
,

413 
	g»äesh
 = 
funùiÚ
(
rs
)

414 
loÿl
 
Ä
 = 
Æ
.
rou‹s
(
rs
.
çmy
,„s.

)

415 
	gk
, 
_
 
š
 
·œs
(
rs
èdØ
	grs
[
k
] = 
n
 
’d


416 
k
, 
v
 
š
 
·œs
(
Ä
èdØ
	grs
[k] = v 
’d


417  
rs


418 
’d
,

422 
	gmt
.
	grou‹s
 = {

423 
__šdex
 = 
funùiÚ
(
i
, 
k
)

424 
	gm‘h
.
	grou‹s
.
	gâ
[
k
] 
th’
  m‘h.rou‹s.â[k] 
’d


425 
	g’d
,

426 
	g__to¡ršg
 = 
funùiÚ
(
is
)

427 
loÿl
 
s
 = {}

428 
k
, 
v
 
š
 
aœs
(
is
) do

429 
	gs
[# + 1] = 
to¡ršg
(
v
)

430 
’d


431  
bË
.
cÚÿt
(
s
, '\n')

432 
	g’d
,

435 
	gm‘h
.
	giçddr
 = {

436 
šdex
 = {

437 
çmy
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
içddr
.
iç_çmy
è
’d
,

438 
	g´efixËn
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
içddr
.
iç_´efixËn
è
’d
,

439 
	gšdex
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
içddr
.
iç_šdex
è
’d
,

440 
	gæags
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
içddr
.
iç_æags
è
’d
,

441 
	gscİe
 = 
funùiÚ
(
i
è 
tÚumb”
(i.
içddr
.
iç_scİe
è
’d
,

445 
	gmt
.
	giçddr
 = {

446 
__šdex
 = 
funùiÚ
(
i
, 
k
)

447 
	gm‘h
.
	giçddr
.
	gšdex
[
k
] 
th’
  m‘h.içddr.šdex[k](
	gi
è
’d


448 
	gc
.
	gIFA_F
[
k
] 
th’
  
	gb™
.
bªd
(
i
.
içddr
.
iç_æags
, 
c
.
IFA_F
[k]è~ğ0 
’d


449 
’d


452 -- 
TODO
 
funùiÚs
 
»³t™ious


453 
loÿl
 
funùiÚ
 
	$decode_lšk
(
buf
, 
Ën
)

454 
loÿl
 
içû
 = 
±
.
	$ifšfomsg
(
buf
)

455 
buf
 = buà+ 
	$Æmsg_®ign
(
s
.
ifšfomsg
)

456 
Ën
 =†’ - 
	$Æmsg_®ign
(
s
.
ifšfomsg
)

457 
loÿl
 
¹©Œ
 = 
±
.
	$¹©Œ
(
buf
)

458 
loÿl
 
œ
 = 
	`£tm‘©abË
({
ifšfo
 = 
t
.
	`ifšfomsg
()
	}
}, 
	gmt
.
	giæšk
)

459 
	gffi
.
	$cİy
(
œ
.
ifšfo
, 
içû
, 
s
.
ifšfomsg
)

460 
	$¹a_ok
(
¹©Œ
, 
Ën
) do

461 
iæa_decode
[
¹©Œ
.
¹a_ty³
] 
th’


462 
iæa_decode
[
¹©Œ
.
¹a_ty³
](
œ
, 
buf
 + 
	`¹a_Ëngth
(0), 
	`¹a_®ign
Ô‰r.
¹a_Ën
è- 
	$¹a_Ëngth
(0))

463 
’d


464 
¹©Œ
, 
buf
, 
Ën
 = 
	$¹a_Ãxt
(
¹©Œ
, 
buf
, 
Ën
)

465 
’d


466  
œ


467 
’d


469 
loÿl
 
funùiÚ
 
	$decode_add»ss
(
buf
, 
Ën
)

470 
loÿl
 
addr
 = 
±
.
	$içddrmsg
(
buf
)

471 
buf
 = buà+ 
	$Æmsg_®ign
(
s
.
içddrmsg
)

472 
Ën
 =†’ - 
	$Æmsg_®ign
(
s
.
içddrmsg
)

473 
loÿl
 
¹©Œ
 = 
±
.
	$¹©Œ
(
buf
)

474 
loÿl
 
œ
 = 
	`£tm‘©abË
({
içddr
 = 
t
.
	`içddrmsg
(), 
addr
 = {}
	}
}, 
	gmt
.
	giçddr
)

475 
	gffi
.
	$cİy
(
œ
.
içddr
, 
addr
, 
s
.
içddrmsg
)

476 
	$¹a_ok
(
¹©Œ
, 
Ën
) do

477 
iç_decode
[
¹©Œ
.
¹a_ty³
] 
th’


478 
iç_decode
[
¹©Œ
.
¹a_ty³
](
œ
, 
buf
 + 
	`¹a_Ëngth
(0), 
	`¹a_®ign
Ô‰r.
¹a_Ën
è- 
	$¹a_Ëngth
(0))

479 
’d


480 
¹©Œ
, 
buf
, 
Ën
 = 
	$¹a_Ãxt
(
¹©Œ
, 
buf
, 
Ën
)

481 
’d


482  
œ


483 
’d


485 
loÿl
 
funùiÚ
 
	$decode_rou‹
(
buf
, 
Ën
)

486 
loÿl
 
¹
 = 
±
.
	$¹msg
(
buf
)

487 
buf
 = buà+ 
	$Æmsg_®ign
(
s
.
¹msg
)

488 
Ën
 =†’ - 
	$Æmsg_®ign
(
s
.
¹msg
)

489 
loÿl
 
¹©Œ
 = 
±
.
	$¹©Œ
(
buf
)

490 
loÿl
 
œ
 = 
	`£tm‘©abË
({
¹msg
 = 
t
.
	`¹msg
()
	}
}, 
	gmt
.
	g¹msg
)

491 
	gffi
.
	$cİy
(
œ
.
¹msg
, 
¹
, 
s
.rtmsg)

492 
	$¹a_ok
(
¹©Œ
, 
Ën
) do

493 
¹a_decode
[
¹©Œ
.
¹a_ty³
] 
th’


494 
¹a_decode
[
¹©Œ
.
¹a_ty³
](
œ
, 
buf
 + 
	`¹a_Ëngth
(0), 
	`¹a_®ign
Ô‰r.
¹a_Ën
è- 
	$¹a_Ëngth
(0))

495 
	`”rÜ
("NYI: " .. 
¹©Œ
.
¹a_ty³
)

496 
’d


497 
¹©Œ
, 
buf
, 
Ën
 = 
	$¹a_Ãxt
(
¹©Œ
, 
buf
, 
Ën
)

498 
’d


499  
œ


500 
’d


502 
loÿl
 
funùiÚ
 
	$decode_Ãigh
(
buf
, 
Ën
)

503 
loÿl
 
¹
 = 
±
.
	$¹msg
(
buf
)

504 
buf
 = buà+ 
	$Æmsg_®ign
(
s
.
¹msg
)

505 
Ën
 =†’ - 
	$Æmsg_®ign
(
s
.
¹msg
)

506 
loÿl
 
¹©Œ
 = 
±
.
	$¹©Œ
(
buf
)

507 
loÿl
 
œ
 = 
	`£tm‘©abË
({
¹msg
 = 
t
.
	`¹msg
()
	}
}, 
	gmt
.
	g¹msg
)

508 
	gffi
.
	$cİy
(
œ
.
¹msg
, 
¹
, 
s
.rtmsg)

509 
	$¹a_ok
(
¹©Œ
, 
Ën
) do

510 
nda_decode
[
¹©Œ
.
¹a_ty³
] 
th’


511 
nda_decode
[
¹©Œ
.
¹a_ty³
](
œ
, 
buf
 + 
	`¹a_Ëngth
(0), 
	`¹a_®ign
Ô‰r.
¹a_Ën
è- 
	$¹a_Ëngth
(0))

512 
	`”rÜ
("NYI: " .. 
¹©Œ
.
¹a_ty³
)

513 
’d


514 
¹©Œ
, 
buf
, 
Ën
 = 
	$¹a_Ãxt
(
¹©Œ
, 
buf
, 
Ën
)

515 
’d


516  
œ


517 
’d


519 -- 
TODO
 
Ùh”
 
thª
 
the
 
fœ¡
 
ãw
 
the£
 
could
 
be
 
a
 
bË


520 
loÿl
 
Æmsg_d©a_decode
 = {

521 [
c
.
NLMSG
.
NOOP
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
è„ 
’d
,

522 [
c
.
NLMSG
.
ERROR
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

523 
loÿl
 
e
 = 
±
.
	`Æmsg”r
(
buf
)

524 
e
.
”rÜ
 ~ğ0 
th’
 
r
.”rÜ = 
t
.
	`”rÜ
(-e.”rÜèr.
ack
 = 
Œue
 
’d
 --ƒ¼Ü 
z”o
 
is
 
ACK
, 
Ùh”s
 
Ãg©ive


525  
r


526 
’d
,

527 [
c
.
NLMSG
.
DONE
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
è„ 
’d
,

528 [
c
.
NLMSG
.
OVERRUN
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

529 
r
.
ov”run
 = 
Œue


530  
r


531 
’d
,

532 [
c
.
RTM
.
NEWADDR
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

533 
loÿl
 
œ
 = 
	`decode_add»ss
(
buf
, 
Ën
)

534 
œ
.
İ
, ir.
Ãwaddr
, ir.
Æ
 = "Ãwaddr", 
Œue
, 
c
.
RTM
.
NEWADDR


535 
r
[#¸+ 1] = 
œ


536  
r


537 
’d
,

538 [
c
.
RTM
.
DELADDR
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

539 
loÿl
 
œ
 = 
	`decode_add»ss
(
buf
, 
Ën
)

540 
œ
.
İ
, ir.
d–addr
, ir.
Æ
 = "d–ddr", 
Œue
, 
c
.
RTM
.
DELADDR


541 
r
[#¸+ 1] = 
œ


542  
r


543 
’d
,

544 [
c
.
RTM
.
GETADDR
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

545 
loÿl
 
œ
 = 
	`decode_add»ss
(
buf
, 
Ën
)

546 
œ
.
İ
, ir.
g‘addr
, ir.
Æ
 = "g‘addr", 
Œue
, 
c
.
RTM
.
GETADDR


547 
r
[#¸+ 1] = 
œ


548  
r


549 
’d
,

550 [
c
.
RTM
.
NEWLINK
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

551 
loÿl
 
œ
 = 
	`decode_lšk
(
buf
, 
Ën
)

552 
œ
.
İ
, ir.
Ãwlšk
, ir.
Æ
 = "Ãwlšk", 
Œue
, 
c
.
RTM
.
NEWLINK


553 
r
[
œ
.
Çme
] = ir

554 
r
[#¸+ 1] = 
œ


555  
r


556 
’d
,

557 [
c
.
RTM
.
DELLINK
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

558 
loÿl
 
œ
 = 
	`decode_lšk
(
buf
, 
Ën
)

559 
œ
.
İ
, ir.
d–lšk
, ir.
Æ
 = "d–lšk", 
Œue
, 
c
.
RTM
.
DELLINK


560 
r
[
œ
.
Çme
] = ir

561 
r
[#¸+ 1] = 
œ


562  
r


563 
’d
,

564 -- 
TODO
 
Ãed
 
‹¡
 
th©
 
»tuºs
 
the£
, 
assume
 
upd©es
 do

565 [
c
.
RTM
.
GETLINK
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

566 
loÿl
 
œ
 = 
	`decode_lšk
(
buf
, 
Ën
)

567 
œ
.
İ
, ir.
g‘lšk
, ir.
Æ
 = "g‘lšk", 
Œue
, 
c
.
RTM
.
GETLINK


568 
r
[
œ
.
Çme
] = ir

569 
r
[#¸+ 1] = 
œ


570  
r


571 
’d
,

572 [
c
.
RTM
.
NEWROUTE
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

573 
loÿl
 
œ
 = 
	`decode_rou‹
(
buf
, 
Ën
)

574 
œ
.
İ
, ir.
Ãwrou‹
, ir.
Æ
 = "Ãwrou‹", 
Œue
, 
c
.
RTM
.
NEWROUTE


575 
r
[#¸+ 1] = 
œ


576  
r


577 
’d
,

578 [
c
.
RTM
.
DELROUTE
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

579 
loÿl
 
œ
 = 
	`decode_rou‹
(
buf
, 
Ën
)

580 
œ
.
İ
, ir.
d–rou‹
, ir.
Æ
 = "d–rou‹", 
Œue
, 
c
.
RTM
.
DELROUTE


581 
r
[#¸+ 1] = 
œ


582  
r


583 
’d
,

584 [
c
.
RTM
.
GETROUTE
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

585 
loÿl
 
œ
 = 
	`decode_rou‹
(
buf
, 
Ën
)

586 
œ
.
İ
, ir.
g‘rou‹
, ir.
Æ
 = "g‘rou‹", 
Œue
, 
c
.
RTM
.
GETROUTE


587 
r
[#¸+ 1] = 
œ


588  
r


589 
’d
,

590 [
c
.
RTM
.
NEWNEIGH
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

591 
loÿl
 
œ
 = 
	`decode_Ãigh
(
buf
, 
Ën
)

592 
œ
.
İ
, ir.
ÃwÃigh
, ir.
Æ
 = "ÃwÃigh", 
Œue
, 
c
.
RTM
.
NEWNEIGH


593 
r
[#¸+ 1] = 
œ


594  
r


595 
’d
,

596 [
c
.
RTM
.
DELNEIGH
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

597 
loÿl
 
œ
 = 
	`decode_Ãigh
(
buf
, 
Ën
)

598 
œ
.
İ
, ir.
d–Ãigh
, ir.
Æ
 = "d–Ãigh", 
Œue
, 
c
.
RTM
.
DELNEIGH


599 
r
[#¸+ 1] = 
œ


600  
r


601 
’d
,

602 [
c
.
RTM
.
GETNEIGH
] = 
	`funùiÚ
(
r
, 
buf
, 
Ën
)

603 
loÿl
 
œ
 = 
	`decode_Ãigh
(
buf
, 
Ën
)

604 
œ
.
İ
, ir.
g‘Ãigh
, ir.
Æ
 = "g‘Ãigh", 
Œue
, 
c
.
RTM
.
GETNEIGH


605 
r
[#¸+ 1] = 
œ


606  
r


607 
’d
,

608 
	}
}

610 
funùiÚ
 
	gÆ
.
	$»ad
(
s
, 
addr
, 
bufsize
, 
uÁdÚe
)

611 
addr
 =‡dd¸
Ü
 
t
.
	`sockaddr_Æ
(è--  
to
 
k”Ãl


612 
bufsize
 = bufsiz
Ü
 8192

613 
loÿl
 
»¶y
 = 
t
.
	$bufãr
(
bufsize
)

614 
loÿl
 
iÜ
 = 
t
.
iovecs
{{
»¶y
, 
bufsize
}
	}
}

615 
loÿl
 
m
 = 
t
.
msghdr
{
msg_iov
 = 
iÜ
.
iov
, 
	gmsg_iovËn
 = #iÜ, 
	gmsg_Çme
 = 
addr
, 
	gmsg_Çm–’
 = 
ffi
.(addr)}

617 
loÿl
 
	gdÚe
 = 
çl£
 -- 
wh©
 
should
 
we
 dØw
g‘
 
a
 
dÚe
 
mes§ge
 
but
 
th”e
 
is
 
some
 
exŒa
 
bufãr
? 
could
 
be
 
Ãxt
 message...

618 
loÿl
 
r
 = {}

620 
nÙ
 
dÚe
 do

621 
loÿl
 
Ën
, 
	g”r
 = 
s
:
	$»cvmsg
(
m
)

622 
nÙ
 
Ën
 
th’
  
n
, 
”r
 
’d


623 
loÿl
 
bufãr
 = 
»¶y


625 
loÿl
 
msg
 = 
±
.
	$Æmsghdr
(
bufãr
)

627 
nÙ
 
dÚe
 
ªd
 
	$Æmsg_ok
(
msg
, 
Ën
) do

628 
loÿl
 

 = 
	$tÚumb”
(
msg
.
Æmsg_ty³
)

630 
Æmsg_d©a_decode
[

] 
th’


631 
r
 = 
Æmsg_d©a_decode
[

]Ô, 
bufãr
 + 
Æmsg_hd¾’
, 
msg
.
Æmsg_Ën
 -‚lmsg_hdrlen)

633 
r
.
ov”run
 
th’
  
S
.
	$»ad
(
s
, 
addr
, 
bufsize
 * 2è
’d
 -- 
TODO
 
add
 
‹¡


634 
r
.
”rÜ
 
th’
  
n
,„.”rÜ 
’d
 -- 
nÙ
 
su»
 
wh©
 
the
 
”rÜs
 
m—n
 
though
!

635 
r
.
ack
 
th’
 
dÚe
 = 
Œue
 
’d


637 
	`”rÜ
("unknowÀd©¨" .. 

)

638 
’d


640 

 =ğ
c
.
NLMSG
.
DONE
 
th’
 
dÚe
 = 
Œue
 
’d


641 
msg
, 
bufãr
, 
Ën
 = 
	$Æmsg_Ãxt
(
msg
, 
bufãr
, 
Ën
)

642 
’d


643 
nÙ
 
uÁdÚe
 
th’
 
dÚe
 = 
Œue
 
’d


644 
’d


646  
r


647 
’d


649 -- 
TODO
 
sh¬e
 
w™h
 
»ad
 
side


650 
loÿl
 
iæa_msg_ty³s
 = {

651 
iæa
 = {

652 -- 
IFLA
.
UNSPEC


653 [
c
.
IFLA
.
ADDRESS
] = 
t
.
maÿddr
,

654 [
c
.
IFLA
.
BROADCAST
] = 
t
.
maÿddr
,

655 [
c
.
IFLA
.
IFNAME
] = "asciiz",

656 -- 
TODO
 
IFLA
.
MAP


657 [
c
.
IFLA
.
MTU
] = 
t
.
ušt32
,

658 [
c
.
IFLA
.
LINK
] = 
t
.
ušt32
,

659 [
c
.
IFLA
.
MASTER
] = 
t
.
ušt32
,

660 [
c
.
IFLA
.
TXQLEN
] = 
t
.
ušt32
,

661 [
c
.
IFLA
.
WEIGHT
] = 
t
.
ušt32
,

662 [
c
.
IFLA
.
OPERSTATE
] = 
t
.
ušt8
,

663 [
c
.
IFLA
.
LINKMODE
] = 
t
.
ušt8
,

664 [
c
.
IFLA
.
LINKINFO
] = {"iæa_šfo", c.
IFLA_INFO
},

665 [
c
.
IFLA
.
NET_NS_PID
] = 
t
.
ušt32
,

666 [
c
.
IFLA
.
NET_NS_FD
] = 
t
.
ušt32
,

667 [
c
.
IFLA
.
IFALIAS
] = "asciiz",

668 --[
c
.
IFLA
.
VFINFO_LIST
] = "nested",

669 --[
c
.
IFLA
.
VF_PORTS
] = "nested",

670 --[
c
.
IFLA
.
PORT_SELF
] = "nested",

671 --[
c
.
IFLA
.
AF_SPEC
] = "nested",

673 
iæa_šfo
 = {

674 [
c
.
IFLA_INFO
.
KIND
] = "ascii",

675 [
c
.
IFLA_INFO
.
DATA
] = "kind",

677 
iæa_vÏn
 = {

678 [
c
.
IFLA_VLAN
.
ID
] = 
t
.
ušt16
,

679 -- 
Ùh”
 
vÏn
 
·¿ms


681 
iç
 = {

682 -- 
IFA
.
UNSPEC


683 [
c
.
IFA
.
ADDRESS
] = "address",

684 [
c
.
IFA
.
LOCAL
] = "address",

685 [
c
.
IFA
.
LABEL
] = "asciiz",

686 [
c
.
IFA
.
BROADCAST
] = "address",

687 [
c
.
IFA
.
ANYCAST
] = "address",

688 -- 
IFA
.
CACHEINFO


690 
¹a
 = {

691 -- 
RTA_UNSPEC


692 [
c
.
RTA
.
DST
] = "address",

693 [
c
.
RTA
.
SRC
] = "address",

694 [
c
.
RTA
.
IIF
] = 
t
.
ušt32
,

695 [
c
.
RTA
.
OIF
] = 
t
.
ušt32
,

696 [
c
.
RTA
.
GATEWAY
] = "address",

697 [
c
.
RTA
.
PRIORITY
] = 
t
.
ušt32
,

698 [
c
.
RTA
.
METRICS
] = 
t
.
ušt32
,

699 -- 
RTA
.
PREFSRC


700 -- 
RTA
.
MULTIPATH


701 -- 
RTA
.
PROTOINFO


702 -- 
RTA
.
FLOW


703 -- 
RTA
.
CACHEINFO


705 
v‘h_šfo
 = {

706 -- 
VETH_INFO_UNSPEC


707 [
c
.
VETH_INFO
.
PEER
] = {"iæa", c.
IFLA
},

709 
nda
 = {

710 [
c
.
NDA
.
DST
] = "address",

711 [
c
.
NDA
.
LLADDR
] = 
t
.
maÿddr
,

712 [
c
.
NDA
.
CACHEINFO
] = 
t
.
nda_ÿchešfo
,

713 -- [
c
.
NDA
.
PROBES
] = ,

715 
	}
}

717 --[[ 
TODO
 
add


718 cÚ¡ 
Æa_pŞicy
 
iæa_vfšfo_pŞicy
[
IFLA_VF_INFO_MAX
+1] = {

719 [
IFLA_VF_INFO
] = { .
ty³
 = 
NLA_NESTED
 },

722 cÚ¡ 
Æa_pŞicy
 
	giæa_vf_pŞicy
[
IFLA_VF_MAX
+1] = {

723 [
IFLA_VF_MAC
] = { .
ty³
 = 
NLA_BINARY
,

724 .
	gËn
 = (
iæa_vf_mac
) },

725 [
IFLA_VF_VLAN
] = { .
ty³
 = 
NLA_BINARY
,

726 .
	gËn
 = (
iæa_vf_vÏn
) },

727 [
IFLA_VF_TX_RATE
] = { .
ty³
 = 
NLA_BINARY
,

728 .
	gËn
 = (
iæa_vf_tx_¿‹
) },

729 [
IFLA_VF_SPOOFCHK
] = { .
ty³
 = 
NLA_BINARY
,

730 .
	gËn
 = (
iæa_vf_¥oofchk
) },

733 cÚ¡ 
Æa_pŞicy
 
	giæa_pÜt_pŞicy
[
IFLA_PORT_MAX
+1] = {

734 [
IFLA_PORT_VF
] = { .
ty³
 = 
NLA_U32
 },

735 [
IFLA_PORT_PROFILE
] = { .
ty³
 = 
NLA_STRING
,

736 .
	gËn
 = 
PORT_PROFILE_MAX
 },

737 [
IFLA_PORT_VSI_TYPE
] = { .
ty³
 = 
NLA_BINARY
,

738 .
	gËn
 = (
iæa_pÜt_vsi
)},

739 [
IFLA_PORT_INSTANCE_UUID
] = { .
ty³
 = 
NLA_BINARY
,

740 .
	gËn
 = 
PORT_UUID_MAX
 },

741 [
IFLA_PORT_HOST_UUID
] = { .
ty³
 = 
NLA_STRING
,

742 .
	gËn
 = 
PORT_UUID_MAX
 },

743 [
IFLA_PORT_REQUEST
] = { .
ty³
 = 
NLA_U8
, },

744 [
IFLA_PORT_RESPONSE
] = { .
ty³
 = 
NLA_U16
, },

748 
loÿl
 
funùiÚ
 
	$iæa_g‘msg
(
¬gs
, 
mes§ges
, 
v®ues
, 
b
, 
lookup
, 
kšd
, 
af
)

749 
loÿl
 
msg
 = 
bË
.
	$»move
(
¬gs
, 1)

750 
loÿl
 
v®ue
, 
Ën


751 
loÿl
 



753 
	`ty³
(
msg
è=ğ"bË" 
th’
 -- 
Ã¡ed
 
©Œibu‹s


754 
loÿl
 
Çrgs
 = 
msg


755 
Ën
 = 0

757 
loÿl
 
Æ’


758 
Æ’
, 
Çrgs
, 
mes§ges
, 
v®ues
, 
kšd
 = 
	$iæa_g‘msg
(
Çrgs
, 
mes§ges
, 
v®ues
, 
b
, 
lookup
, 
kšd
, 
af
)

759 
Ën
 =†’ + 
Æ’


760 
’d


761  
Ën
, 
¬gs
, 
mes§ges
, 
v®ues
, 
kšd


762 
’d


764 
	`ty³
(
msg
è=ğ"cd©a" 
Ü
y³(msgè=ğ"u£rd©a" 
th’


765 

 = 
msg


766 
v®ue
 = 
bË
.
	$»move
(
¬gs
, 1)

767 
nÙ
 
v®ue
 
th’
 
	`”rÜ
("nÙƒnough‡rgum’ts"è
’d


768 
v®ue
 = 
	$mkty³
(

, 
v®ue
)

769 
Ën
 = 
ffi
.(
v®ue
)

770 
mes§ges
[#mes§ge + 1] = 



771 
v®ues
[#v®ue + 1] = 
v®ue


772  
Ën
, 
¬gs
, 
mes§ges
, 
v®ues
, 
kšd


773 
’d


775 
loÿl
 
¿wmsg
 = 
msg


776 
msg
 = 
lookup
[msg]

778 

 = 
iæa_msg_ty³s
[
b
][
msg
]

779 
nÙ
 

 
th’
 
	`”rÜ
("unknowÀmes§gty³ " .. 
	`to¡ršg
(
¿wmsg
è.. " iÀ" .. 
b
è
’d


781 

 =ğ"kšd" 
th’


782 
loÿl
 
kšds
 = {

783 
vÏn
 = {"iæa_vÏn", 
c
.
IFLA_VLAN
},

784 
v‘h
 = {"v‘h_šfo", 
c
.
VETH_INFO
},

785 
	}
}

786 
	g
 = 
kšds
[
kšd
]

787 
’d


789 
ty³
(

è=ğ"bË" 
th’


790 
v®ue
 = 
t
.
¹©Œ
{
¹a_ty³
 = 
msg
} -- 
missšg
 
	g¹a_Ën
, 
but
 
have
 
»ã»nû
 
ªd
 
ÿn
 
fix


792 
	gmes§ges
[#mes§ge + 1] = 
t
.
¹©Œ


793 
v®ues
[#v®ue + 1] = 
v®ue


795 
b
, 
	glookup
 = 

[1], 
	g
[2]

797 
	gËn
, 
	g¬gs
, 
	gmes§ges
, 
	gv®ues
, 
	gkšd
 = 
	$iæa_g‘msg
(
¬gs
, 
mes§ges
, 
v®ues
, 
b
, 
lookup
, 
kšd
, 
af
)

798 
Ën
 = 
	`Æmsg_®ign
(
s
.
¹©Œ
) +†en

800 
v®ue
.
¹a_Ën
 = 
Ën


802  
Ën
, 
¬gs
, 
mes§ges
, 
v®ues
, 
kšd


804 -- 
»cursiÚ
 
ba£
 , 
ju¡
 
a
 
v®ue
, 
nÙ
 
Ã¡ed


807 
v®ue
 = 
bË
.
	$»move
(
¬gs
, 1)

808 
nÙ
 
v®ue
 
th’
 
	`”rÜ
("nÙƒnough‡rgum’ts"è
’d


809 
’d


811 
b
 =ğ"iæa_šfo" 
ªd
 
msg
 =ğ
c
.
IFLA_INFO
.
KIND
 
th’


812 
kšd
 = 
v®ue


813 
’d


815 
loÿl
 
¦’


817 

 =ğ"asciiz" 
th’
 -- 
z”o
 
‹rmš©ed


818 

 = 
t
.
	`bufãr
(#value + 1)

819 
¦’
 = 
	`Æmsg_®ign
(
s
.
¹©Œ
) + #value + 1

820 
–£if
 

 =ğ"ascii" 
th’
 -- 
nÙ
 
z”o
 
‹rmš©ed


821 

 = 
t
.
	`bufãr
(#value)

822 
¦’
 = 
	`Æmsg_®ign
(
s
.
¹©Œ
) + #value

824 

 =ğ"add»ss" 
th’


825 

 = 
ad‰
[
	`tÚumb”
(
af
)]

826 
’d


827 
v®ue
 = 
	$mkty³
(

, 
v®ue
)

828 
’d


830 
Ën
 = 
	`Æmsg_®ign
(
s
.
¹©Œ
è+‚lmsg_®ign(
ffi
.(

))

831 
¦’
 = sËÀ
Ü
 
Ën


833 
mes§ges
[#mes§ge + 1] = 
t
.
¹©Œ


834 
mes§ges
[#mes§ge + 1] = 



835 
v®ues
[#v®ue + 1] = 
t
.
¹©Œ
{
¹a_ty³
 = 
msg
, 
¹a_Ën
 = 
¦’
}

836 
	gv®ues
[#v®ue + 1] = 
v®ue


838  
Ën
, 
	g¬gs
, 
	gmes§ges
, 
	gv®ues
, 
kšd


839 
’d


841 
loÿl
 
funùiÚ
 
	$iæa_f
(
b
, 
lookup
, 
af
, ...)

842 
loÿl
 
Ën
, 
kšd


843 
loÿl
 
mes§ges
, 
v®ues
 = {
t
.
Æmsghdr
}, {çl£}

845 
loÿl
 
	g¬gs
 = {...}

847 
Ën
, 
	g¬gs
, 
	gmes§ges
, 
	gv®ues
, 
	gkšd
 = 
	$iæa_g‘msg
(
¬gs
, 
mes§ges
, 
v®ues
, 
b
, 
lookup
, 
kšd
, 
af
)

848 
’d


850 
loÿl
 
Ën
 = 0

851 
loÿl
 
off£ts
 = {
	}
}

852 
loÿl
 
®ignm’t
 = 
	$Æmsg_®ign
(1)

853 
i
, 

 
š
 
	$aœs
(
mes§ges
) do

854 
loÿl
 
™em_®ignm’t
 = 
	`®ign
(
ffi
.(

), 
®ignm’t
)

855 
off£ts
[
i
] = 
Ën


856 
Ën
 =†’ + 
™em_®ignm’t


857 
’d


858 
loÿl
 
buf
 = 
t
.
	$bufãr
(
Ën
)

860 
i
 = 2, #off£t dØ-- 
sk
 
h—d”


861 
loÿl
 
v®ue
 = 
v®ues
[
i
]

862 
	`ty³
(
v®ue
è=ğ"¡ršg" 
th’


863 
ffi
.
	`cİy
(
buf
 + 
off£ts
[
i
], 
v®ue
)

865 -- 
¦ighy
 
Ç¡y


866 
ffi
.
	$i¡y³
(
t
.
ušt32
, 
v®ue
è
th’
 v®uğt.
	$ušt32_1
(
v®ue
è
’d


867 
ffi
.
	$i¡y³
(
t
.
ušt16
, 
v®ue
è
th’
 v®uğt.
	$ušt16_1
(
v®ue
è
’d


868 
ffi
.
	$i¡y³
(
t
.
ušt8
, 
v®ue
è
th’
 v®uğt.
	$ušt8_1
(
v®ue
è
’d


869 
ffi
.
	`cİy
(
buf
 + 
off£ts
[
i
], 
v®ue
, ffi.(value))

870 
’d


871 
’d


873  
buf
, 
Ën


874 
’d


876 
loÿl
 
¹´ef
 = {

877 [
c
.
RTM
.
NEWLINK
] = {"iæa", c.
IFLA
},

878 [
c
.
RTM
.
GETLINK
] = {"iæa", c.
IFLA
},

879 [
c
.
RTM
.
DELLINK
] = {"iæa", c.
IFLA
},

880 [
c
.
RTM
.
NEWADDR
] = {"iç", c.
IFA
},

881 [
c
.
RTM
.
GETADDR
] = {"iç", c.
IFA
},

882 [
c
.
RTM
.
DELADDR
] = {"iç", c.
IFA
},

883 [
c
.
RTM
.
NEWROUTE
] = {"¹a", c.
RTA
},

884 [
c
.
RTM
.
GETROUTE
] = {"¹a", c.
RTA
},

885 [
c
.
RTM
.
DELROUTE
] = {"¹a", c.
RTA
},

886 [
c
.
RTM
.
NEWNEIGH
] = {"nda", c.
NDA
},

887 [
c
.
RTM
.
DELNEIGH
] = {"nda", c.
NDA
},

888 [
c
.
RTM
.
GETNEIGH
] = {"nda", c.
NDA
},

889 [
c
.
RTM
.
NEWNEIGHTBL
] = {"nda", c.
NDTPA
},

890 [
c
.
RTM
.
GETNEIGHTBL
] = {"nda", c.
NDTPA
},

891 [
c
.
RTM
.
SETNEIGHTBL
] = {"nda", c.
NDTPA
},

892 
	}
}

894 
funùiÚ
 
	gÆ
.
	$sock‘
(

, 
addr
)

895 

 = 
c
.
NETLINK
[tp]

896 
loÿl
 
sock
, 
”r
 = 
S
.
	$sock‘
(
c
.
AF
.
NETLINK
, c.
SOCK
.
RAW
, 

)

897 
nÙ
 
sock
 
th’
  
n
, 
”r
 
’d


898 
addr
 
th’


899 
	`ty³
(
addr
è=ğ"bË" 
th’
‡ddr.
ty³
 = 

 
’d
 -- 
Ãed
y³ 
to
 
cÚv”t
 
group
 
Çmes
 
äom
 
¡ršg


900 
nÙ
 
ffi
.
	$i¡y³
(
t
.
sockaddr_Æ
, 
addr
è
th’
‡dd¸ğt.
	$sockaddr_Æ
(
addr
è
’d


901 
loÿl
 
ok
, 
”r
 = 
S
.
	$bšd
(
sock
, 
addr
)

902 
nÙ
 
ok
 
th’


903 
S
.
	$şo£
(
sock
)

904  
n
, 
”r


905 
’d


906 
’d


907  
sock


908 
’d


910 
funùiÚ
 
Æ
.
	$wr™e
(
sock
, 
de¡
, 
Áy³
, 
æags
, 
af
, ...)

911 
loÿl
 
a
, 
”r
 = 
sock
:
	`g‘sockÇme
(è-- 
to
 
g‘
 
bound
 
add»ss


912 
nÙ
 
a
 
th’
  
n
, 
”r
 
’d


914 
de¡
 = de¡ 
Ü
 
t
.
	`sockaddr_Æ
(è-- 
k”Ãl
 
de¡š©iÚ
 

916 
loÿl
 

 = 
¹´ef
[
Áy³
]

917 
nÙ
 

 
th’
 
	`”rÜ
("NYI: ", 
Áy³
è
’d


918 
loÿl
 
b
, 
lookup
 = 

[1],l[2]

920 
loÿl
 
buf
, 
Ën
 = 
	$iæa_f
(
b
, 
lookup
, 
af
, ...)

922 
loÿl
 
hdr
 = 
±
.
	$Æmsghdr
(
buf
)

924 
hdr
[0] = {
Æmsg_Ën
 = 
Ën
, 
Æmsg_ty³
 = 
Áy³
, 
Æmsg_æags
 = 
æags
, 
Æmsg_£q
 = 
sock
:
	`£q
(), 
Æmsg_pid
 = 
a
.
pid
}

926 
loÿl
 
	gios
 = 
t
.
iovecs
{{
buf
, 
Ën
}}

927 
loÿl
 
m
 = 
t
.
msghdr
{
msg_iov
 = 
ios
.
iov
, 
	gmsg_iovËn
 = #ios, 
	gmsg_Çme
 = 
de¡
, 
	gmsg_Çm–’
 = 
s
.
sockaddr_Æ
}

929  
	gsock
:
	$£ndmsg
(
m
)

930 
’d


932 -- 
TODO
 "rou‹" 
should
 
be
 
·s£d
 
š
 
as
 
·¿m‘”
, 
‹¡
 
w™h
 
Ùh”
 
Ãšk
 
ty³s


933 
loÿl
 
funùiÚ
 
	$Æmsg
(
Áy³
, 
æags
, 
af
, ...)

934 
Áy³
 = 
c
.
RTM
[ntype]

935 
æags
 = 
c
.
NLM_F
[flags]

936 
loÿl
 
sock
, 
”r
 = 
Æ
.
	`sock‘
("rou‹", {
	}
}è-- 
bšd
 
to
 
em±y
 
	gsockaddr_Æ
, 
k”Ãl
 
fls
 
add»ss


937 
nÙ
 
sock
 
th’
  
	gn
, 
”r
 
’d


939 
loÿl
 
	gk
 = 
t
.
sockaddr_Æ
(è-- 
k”Ãl
 
de¡š©iÚ


941 
loÿl
 
ok
, 
	g”r
 = 
Æ
.
	$wr™e
(
sock
, 
k
, 
Áy³
, 
æags
, 
af
, ...)

942 
nÙ
 
ok
 
th’


943 
sock
:
	$şo£
()

944  
n
, 
”r


945 
’d


947 
loÿl
 
r
, 
”r
 = 
Æ
.
	`»ad
(
sock
, 
k
, 
n
, 
Œue
è--ru
m—ns
 
uÁ
 
g‘
 
dÚe
 
mes§ge


948 
nÙ
 
r
 
th’


949 
sock
:
	$şo£
()

950  
n
, 
”r


951 
’d


953 
loÿl
 
ok
, 
”r
 = 
sock
:
	$şo£
()

954 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


956  
r


957 
’d


959 -- 
TODO
 dØ
nÙ
 
have
 
®l
 
the£
 
difã»Á
 
¬gum’ts
 the£ 
funùiÚs
, 
·ss
 
a
 
bË
 
š™Ÿliz©iÚ
. 
S“
 
®so
 
lšk
.

961 
funùiÚ
 
Æ
.
	$Ãwlšk
(
šdex
, 
æags
, 
iæags
, 
chªge
, ...)

962 
chªge
 =ğ0 
th’
 chªgğ
c
.
IFF
.
NONE
 
’d
 -- 0 
should
 
wÜk
, 
but
 
dÛs
 
nÙ


963 
æags
 = 
c
.
	`NLM_F
("request", "ack", flags)

964 
	`ty³
(
šdex
è=ğ'bË' 
th’
 index = index.šdex 
’d


965 
loÿl
 
ifv
 = {
ifi_šdex
 = 
šdex
, 
ifi_æags
 = 
c
.
IFF
[
iæags
], 
ifi_chªge
 = c.IFF[
chªge
]
	}
}

966  
Æmsg
("Ãwlšk", 
æags
, 
n
, 
t
.
ifšfomsg
, 
ifv
, ...)

967 
’d


969 
funùiÚ
 
	gÆ
.
	$d–lšk
(
šdex
, ...)

970 
	`ty³
(
šdex
è=ğ'bË' 
th’
 index = index.šdex 
’d


971 
loÿl
 
ifv
 = {
ifi_šdex
 = 
šdex
}

972  
Æmsg
("d–lšk", "»que¡,‡ck", 
n
, 
t
.
ifšfomsg
, 
ifv
, ...)

973 
	g’d


975 -- 
»ad
 
š‹rçûs
 
ªd
 
	gd‘as
.

976 
funùiÚ
 
	gÆ
.
	$g‘lšk
(...)

977  
	`Æmsg
("g‘lšk", "»que¡, dump", 
n
, 
t
.
¹g’msg
, {
¹g’_çmy
 = 
c
.
AF
.
PACKET
}, ...)

978 
	g’d


980 -- 
»ad
 
rou‹s


981 
funùiÚ
 
	gÆ
.
	$g‘rou‹
(
af
, 

, 
b
, 
´Ù
, 
scİe
, ...)

982 
loÿl
 
¹m
 = 
t
.
¹msg
{
çmy
 = 
af
, 
bË
 = 
b
, 
´ÙocŞ
 = 
´Ù
, 
ty³
 = 

, 
scİe
 = 
	}
scope}

983 
loÿl
 
	gr
, 
	g”r
 = 
Æmsg
(
c
.
RTM
.
GETROUTE
, "»que¡, dump", 
af
, 
t
.
¹msg
, 
¹m
)

984 
nÙ
 
r
 
th’
  
	gn
, 
”r
 
’d


985  
	$£tm‘©abË
(
r
, 
mt
.
rou‹s
)

986 
’d


988 
funùiÚ
 
Æ
.
	$rou‹s
(
af
, 

)

989 
af
 = 
c
.
AF
[af]

990 
nÙ
 

 
th’
°ğ
c
.
RTN
.
UNICAST
 
’d


991 

 = 
c
.
RTN
[tp]

992 
loÿl
 
r
, 
”r
 = 
Æ
.
	$g‘rou‹
(
af
, 

)

993 
nÙ
 
r
 
th’
  
n
, 
”r
 
’d


994 
loÿl
 
ifs
, 
”r
 = 
Æ
.
	$g‘lšk
()

995 
nÙ
 
ifs
 
th’
  
n
, 
”r
 
’d


996 
loÿl
 
šdexm­
 = {
	}
} -- 
TODO
 
tuº
 
što
 
m‘am‘hod
 
as
 
u£d
 
–£wh”e


997 
i
, 
v
 
š
 
	$·œs
(
ifs
) do

998 
v
.
š‘
, v.
š‘6
 = {
	}
}, {}

999 
	gšdexm­
[
v
.
šdex
] = 
i


1000 
’d


1001 
k
, 
v
 
š
 
	$aœs
(
r
) do

1002 
ifs
[
šdexm­
[
v
.
iif
]] 
th’
 v.
šput
 = ifs[šdexm­[v.iif]].
Çme
 
’d


1003 
ifs
[
šdexm­
[
v
.
oif
]] 
th’
 v.
ouut
 = ifs[šdexm­[v.oif]].
Çme
 
’d


1004 

 > 0 
ªd
 
v
.
¹msg
.
¹m_ty³
 ~ğ 
th’
 
r
[
k
] = 
n
 
’d
 -- 
f‹r
 
unwª‹d
 
rou‹s


1005 
’d


1006 
r
.
çmy
 = 
af


1007 
r
.

 =p

1008  
r


1009 
’d


1011 
loÿl
 
funùiÚ
 
	$´eáabË
(
b
, 
´efix
)

1012 
k
, 
v
 
š
 
	$·œs
(
b
) do

1013 
k
:
	`sub
(1, #´efixè~ğ
´efix
 
th’


1014 
b
[
´efix
 .. 
k
] = 
v


1015 
b
[
k
] = 
n


1016 
’d


1017 
’d


1018  
b


1019 
’d


1021 
funùiÚ
 
Æ
.
	$Ãwrou‹
(
æags
, 
¹m
, ...)

1022 
æags
 = 
c
.
	`NLM_F
("request", "ack", flags)

1023 
¹m
 = 
	$mkty³
(
t
.
¹msg
, 
¹m
)

1024  
	`Æmsg
("Ãwrou‹", 
æags
, 
¹m
.
çmy
, 
t
.
¹msg
,„tm, ...)

1025 
’d


1027 
funùiÚ
 
Æ
.
	$d–rou‹
(
¹m
, ...)

1028 
¹m
 = 
	$mkty³
(
t
.
¹msg
, 
¹m
)

1029  
	`Æmsg
("d–rou‹", "»que¡,‡ck", 
¹m
.
çmy
, 
t
.
¹msg
,„tm, ...)

1030 
’d


1032 -- 
»ad
 
add»s£s
 
äom
 
š‹rçû
 
TODO
 
æag
 
ş—nup


1033 
funùiÚ
 
Æ
.
	$g‘addr
(
af
, ...)

1034 
loÿl
 
çmy
 = 
c
.
AF
[
af
]

1035 
loÿl
 
içv
 = {
iç_çmy
 = 
çmy
}

1036  
Æmsg
("g‘addr", "»que¡,„oÙ", 
çmy
, 
t
.
içddrmsg
, 
içv
, ...)

1037 
	g’d


1039 -- 
TODO
 
may
 
Ãed
 
iç_scİe


1040 
funùiÚ
 
	gÆ
.
	$Ãwaddr
(
šdex
, 
af
, 
´efixËn
, 
æags
, ...)

1041 
	`ty³
(
šdex
è=ğ'bË' 
th’
 index = index.šdex 
’d


1042 
loÿl
 
çmy
 = 
c
.
AF
[
af
]

1043 
loÿl
 
içv
 = {
iç_çmy
 = 
çmy
, 
iç_´efixËn
 = 
´efixËn
 
Ü
 0, 
iç_æags
 = 
c
.
IFA_F
[
æags
], 
iç_šdex
 = 
šdex
} --__TODO iÀ__Ãw

1044  
Æmsg
("Ãwaddr", "»que¡,‡ck", 
çmy
, 
t
.
içddrmsg
, 
içv
, ...)

1045 
’d


1047 
funùiÚ
 
	gÆ
.
	$d–addr
(
šdex
, 
af
, 
´efixËn
, ...)

1048 
	`ty³
(
šdex
è=ğ'bË' 
th’
 index = index.šdex 
’d


1049 
loÿl
 
çmy
 = 
c
.
AF
[
af
]

1050 
loÿl
 
içv
 = {
iç_çmy
 = 
çmy
, 
iç_´efixËn
 = 
´efixËn
 
Ü
 0, 
iç_æags
 = 0, 
iç_šdex
 = 
šdex
}

1051  
Æmsg
("d–addr", "»que¡,‡ck", 
çmy
, 
t
.
içddrmsg
, 
içv
, ...)

1052 
’d


1054 
funùiÚ
 
	gÆ
.
	$g‘Ãigh
(
šdex
, 
b
, ...)

1055 
	`ty³
(
šdex
è=ğ'bË' 
th’
 index = index.šdex 
’d


1056 
b
.
ifšdex
 = 
šdex


1057 
loÿl
 
ndm
 = 
t
.
	$ndmsg
(
b
)

1058  
	`Æmsg
("g‘Ãigh", "»que¡, dump", 
ndm
.
çmy
, 
t
.
ndmsg
,‚dm, ...)

1059 
’d


1061 
funùiÚ
 
Æ
.
	$ÃwÃigh
(
šdex
, 
b
, ...)

1062 
	`ty³
(
šdex
è=ğ'bË' 
th’
 index = index.šdex 
’d


1063 
b
.
ifšdex
 = 
šdex


1064 
loÿl
 
ndm
 = 
t
.
	$ndmsg
(
b
)

1065  
	`Æmsg
("ÃwÃigh", "»que¡,‡ck,ƒxş, c»©e", 
ndm
.
çmy
, 
t
.
ndmsg
,‚dm, ...)

1066 
’d


1068 
funùiÚ
 
Æ
.
	$d–Ãigh
(
šdex
, 
b
, ...)

1069 
	`ty³
(
šdex
è=ğ'bË' 
th’
 index = index.šdex 
’d


1070 
b
.
ifšdex
 = 
šdex


1071 
loÿl
 
ndm
 = 
t
.
	$ndmsg
(
b
)

1072  
	`Æmsg
("d–Ãigh", "»que¡,‡ck", 
ndm
.
çmy
, 
t
.
ndmsg
,‚dm, ...)

1073 
’d


1075 
funùiÚ
 
Æ
.
	`š‹rçûs
(è-- 
»tuºs
 
w™h
 
add»ss
 
šfo
 
too
.

1076 
loÿl
 
ifs
, 
”r
 = 
Æ
.
	$g‘lšk
()

1077 
nÙ
 
ifs
 
th’
  
n
, 
”r
 
’d


1078 
loÿl
 
addr4
, 
”r
 = 
Æ
.
	$g‘addr
(
c
.
AF
.
INET
)

1079 
nÙ
 
addr4
 
th’
  
n
, 
”r
 
’d


1080 
loÿl
 
addr6
, 
”r
 = 
Æ
.
	$g‘addr
(
c
.
AF
.
INET6
)

1081 
nÙ
 
addr6
 
th’
  
n
, 
”r
 
’d


1082 
loÿl
 
šdexm­
 = {
	}
}

1083 
i
, 
v
 
š
 
	$·œs
(
ifs
) do

1084 
v
.
š‘
, v.
š‘6
 = {
	}
}, {}

1085 
	gšdexm­
[
v
.
šdex
] = 
i


1086 
’d


1087 
i
 = 1, #addr4 do

1088 
loÿl
 
	gv
 = 
ifs
[
šdexm­
[
addr4
[
i
].
šdex
]]

1089 
v
.
š‘
[#v.š‘ + 1] = 
addr4
[
i
]

1090 
’d


1091 
i
 = 1, #addr6 do

1092 
loÿl
 
	gv
 = 
ifs
[
šdexm­
[
addr6
[
i
].
šdex
]]

1093 
v
.
š‘6
[#v.š‘6 + 1] = 
addr6
[
i
]

1094 
’d


1095  
	$£tm‘©abË
(
ifs
, 
mt
.
iæšks
)

1096 
’d


1098 
funùiÚ
 
Æ
.
	`š‹rçû
(
i
è-- 
could
 
İtimize
 
ju¡
 
to
 
»Œ›ve
 
šfo
 
Úe


1099 
loÿl
 
ifs
, 
”r
 = 
Æ
.
	$š‹rçûs
()

1100 
nÙ
 
ifs
 
th’
  
n
, 
”r
 
’d


1101  
ifs
[
i
]

1102 
’d


1104 
loÿl
 
lšk_´oûss_f


1105 
loÿl
 
lšk_´oûss
 = { -- 
TODO
 
v”y
 
šcom¶‘e
. 
g’”©e
?

1106 
Çme
 = 
	`funùiÚ
(
¬gs
, 
v
è {"iâame", v} 
’d
,

1107 
lšk
 = 
	`funùiÚ
(
¬gs
, 
v
è {"lšk", v} 
’d
,

1108 
add»ss
 = 
	`funùiÚ
(
¬gs
, 
v
è {"add»ss", v} 
’d
,

1109 
ty³
 = 
	`funùiÚ
(
¬gs
, 
v
, 
b
)

1110 
v
 =ğ"vÏn" 
th’


1111 
loÿl
 
id
 = 
b
.id

1112 
id
 
th’


1113 
b
.
id
 = 
n


1114  {"lškšfo", {"kšd", "vÏn", "d©a", {"id", 
id
}}}

1115 
’d


1116 
–£if
 
v
 =ğ"v‘h" 
th’


1117 
loÿl
 
³”
 = 
b
.peer

1118 
b
.
³”
 = 
n


1119 
loÿl
 
³”b
 = 
	`lšk_´oûss_f
(
³”
)

1120  {"lškšfo", {"kšd", "v‘h", "d©a", {"³”", {
t
.
ifšfomsg
, {}, 
³”b
}}}}

1121 
’d


1122  {"lškšfo", "kšd", 
v
}

1123 
’d
,

1124 
	}
}

1126 
funùiÚ
 
	$lšk_´oûss_f
(
b
, 
¬gs
)

1127 
¬gs
 =‡rg 
Ü
 {
	}
}

1128 
_
, 
k
 
š
 
	gaœs
{"link", "name", "type"} do

1129 
loÿl
 
	gv
 = 
b
[
k
]

1130 
v
 
th’


1131 
lšk_´oûss
[
k
] 
th’


1132 
loÿl
 
a
 = 
lšk_´oûss
[
k
](
¬gs
, 
	gv
, 
	gb
)

1133 
	gi
 = 1, #¨dØ
	g¬gs
[#¬g + 1] = 
a
[
i
] 
’d


1134 
”rÜ
("bad i¶šk commªd " .. 
k
)

1135 
’d


1136 
’d


1137 
’d


1138  
¬gs


1139 
’d


1141 -- 
TODO
 
b‘‹r
 
Çme
. 
ev’
 
mÜe
 
g’”®
, 
nÙ
 
ju¡
 
	gÃwlšk
. 
Ü
 
make
 
this
 
the
 
expo£d
 
Ãwlšk
 
	gš‹rçû
?

1142 -- 
I
 
thšk
 
this
 
is
 
g’”®ly
 
a
 
niûr
 
š‹rçû
 
to
 
expo£
 
thª
 
the
 
Úes
 
	gabove
, 
®l
 
funùiÚs


1143 
funùiÚ
 
	gÆ
.
	$lšk
(
b
)

1144 
loÿl
 
¬gs
 = {
b
.
šdex
 
Ü
 0,ab.
modif›r
 o¸0,ab.
æags
 o¸0,ab.
chªge
 o¸0
	}
}

1145 
loÿl
 
¬gs
 = 
	$lšk_´oûss_f
(
b
, 
¬gs
)

1146  
Æ
.
	`Ãwlšk
(
	$uÅack
(
¬gs
))

1147 
’d


1149 -- 
TODO
 
lšk
 
may
 
nÙ
 
be
 
­´İrŸ‹
 
®ways
 
sÜt
 
out
 
æags


1150 
funùiÚ
 
Æ
.
	$ü—‹_š‹rçû
(
b
)

1151 
b
.
modif›r
 = 
c
.
NLM_F
.
CREATE


1152  
Æ
.
	$lšk
(
b
)

1153 
’d


1155  
Æ


1157 
’d


1159  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/nr.lua

1 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

2 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

3 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

4 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


8 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

10 
loÿl
 
Ä
 = 
»quœe
("sysÿÎ.lšux." .. 
abi
.
¬ch
 .. ".nr")

12 
Ä
.
SYS
.
sock‘ÿÎ
 
th’
‚r.
sock‘ÿÎs
 = {

13 
SOCKET
 = 1,

14 
	gBIND
 = 2,

15 
	gCONNECT
 = 3,

16 
	gLISTEN
 = 4,

17 
	gACCEPT
 = 5,

18 
	gGETSOCKNAME
 = 6,

19 
	gGETPEERNAME
 = 7,

20 
	gSOCKETPAIR
 = 8,

21 
	gSEND
 = 9,

22 
	gRECV
 = 10,

23 
	gSENDTO
 = 11,

24 
	gRECVFROM
 = 12,

25 
	gSHUTDOWN
 = 13,

26 
	gSETSOCKOPT
 = 14,

27 
	gGETSOCKOPT
 = 15,

28 
	gSENDMSG
 = 16,

29 
	gRECVMSG
 = 17,

30 
	gACCEPT4
 = 18,

31 
	gRECVMMSG
 = 19,

32 
	gSENDMMSG
 = 20,

34 
’d


36  
	gÄ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/constants.lua

1 -- 
µc
 
¥ecific
 
cÚ¡ªts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gh
 = 
»quœe
 "syscall.helpers"

12 
loÿl
 
où®
 = 
h
.octal

14 
loÿl
 
¬ch
 = {}

16 
¬ch
.
EDEADLOCK
 = 58 -- 
Úly
 
”rÜ
 
th©
 
difãrs
 
äom
 
g’”ic


18 
¬ch
.
SO
 = { -- 16-21 
difãr
 
µc


19 
DEBUG
 = 1,

20 
	gREUSEADDR
 = 2,

21 
	gTYPE
 = 3,

22 
	gERROR
 = 4,

23 
	gDONTROUTE
 = 5,

24 
	gBROADCAST
 = 6,

25 
	gSNDBUF
 = 7,

26 
	gRCVBUF
 = 8,

27 
	gKEEPALIVE
 = 9,

28 
	gOOBINLINE
 = 10,

29 
	gNO_CHECK
 = 11,

30 
	gPRIORITY
 = 12,

31 
	gLINGER
 = 13,

32 
	gBSDCOMPAT
 = 14,

33 --
	gREUSEPORT
 = 15, -- 
	gÃw
, 
may
 
nÙ
 
be
 
defšed
 
y‘


34 
	gRCVLOWAT
 = 16,

35 
	gSNDLOWAT
 = 17,

36 
	gRCVTIMEO
 = 18,

37 
	gSNDTIMEO
 = 19,

38 
	gPASSCRED
 = 20,

39 
	gPEERCRED
 = 21,

40 
	gSECURITY_AUTHENTICATION
 = 22,

41 
	gSECURITY_ENCRYPTION_TRANSPORT
 = 23,

42 
	gSECURITY_ENCRYPTION_NETWORK
 = 24,

43 
	gBINDTODEVICE
 = 25,

44 
	gATTACH_FILTER
 = 26,

45 
	gDETACH_FILTER
 = 27,

46 
	gPEERNAME
 = 28,

47 
	gTIMESTAMP
 = 29,

48 
	gACCEPTCONN
 = 30,

49 
	gPEERSEC
 = 31,

50 
	gSNDBUFFORCE
 = 32,

51 
	gRCVBUFFORCE
 = 33,

52 
	gPASSSEC
 = 34,

53 
	gTIMESTAMPNS
 = 35,

54 
	gMARK
 = 36,

55 
	gTIMESTAMPING
 = 37,

56 
	gPROTOCOL
 = 38,

57 
	gDOMAIN
 = 39,

58 
	gRXQ_OVFL
 = 40,

59 
	gWIFI_STATUS
 = 41,

60 
	gPEEK_OFF
 = 42,

61 
	gNOFCS
 = 43,

64 
	g¬ch
.
	gOFLAG
 = {

65 
OPOST
 = 
où®
('00000001'),

66 
	gONLCR
 = 
où®
('00000002'),

67 
	gOLCUC
 = 
où®
('00000004'),

68 
	gOCRNL
 = 
où®
('00000010'),

69 
	gONOCR
 = 
où®
('00000020'),

70 
	gONLRET
 = 
où®
('00000040'),

71 
	gOFILL
 = 
où®
('00000100'),

72 
	gOFDEL
 = 
où®
('00000200'),

73 
	gNLDLY
 = 
où®
('00001400'),

74 
	gNL0
 = 
où®
('00000000'),

75 
	gNL1
 = 
où®
('00000400'),

76 
	gNL2
 = 
où®
('00001000'),

77 
	gNL3
 = 
où®
('00001400'),

78 
	gCRDLY
 = 
où®
('00030000'),

79 
	gCR0
 = 
où®
('00000000'),

80 
	gCR1
 = 
où®
('00010000'),

81 
	gCR2
 = 
où®
('00020000'),

82 
	gCR3
 = 
où®
('00030000'),

83 
	gTABDLY
 = 
où®
('00006000'),

84 
	gTAB0
 = 
où®
('00000000'),

85 
	gTAB1
 = 
où®
('00002000'),

86 
	gTAB2
 = 
où®
('00004000'),

87 
	gTAB3
 = 
où®
('00006000'),

88 
	gBSDLY
 = 
où®
('00100000'),

89 
	gBS0
 = 
où®
('00000000'),

90 
	gBS1
 = 
où®
('00100000'),

91 
	gFFDLY
 = 
où®
('00040000'),

92 
	gFF0
 = 
où®
('00000000'),

93 
	gFF1
 = 
où®
('00040000'),

94 
	gVTDLY
 = 
où®
('00200000'),

95 
	gVT0
 = 
où®
('00000000'),

96 
	gVT1
 = 
où®
('00200000'),

97 
	gXTABS
 = 
où®
('00006000'),

100 
	g¬ch
.
	gLFLAG
 = {

101 
ISIG
 = 0x00000080,

102 
	gICANON
 = 0x00000100,

103 
	gXCASE
 = 0x00004000,

104 
	gECHO
 = 0x00000008,

105 
	gECHOE
 = 0x00000002,

106 
	gECHOK
 = 0x00000004,

107 
	gECHONL
 = 0x00000010,

108 
	gNOFLSH
 = 0x80000000,

109 
	gTOSTOP
 = 0x00400000,

110 
	gECHOCTL
 = 0x00000040,

111 
	gECHOPRT
 = 0x00000020,

112 
	gECHOKE
 = 0x00000001,

113 
	gFLUSHO
 = 0x00800000,

114 
	gPENDIN
 = 0x20000000,

115 
	gIEXTEN
 = 0x00000400,

116 
	gEXTPROC
 = 0x10000000,

119 -- 
TODO
 
the£
 
wl
 
be
 
š
 
a
 
bË


120 
	g¬ch
.
	gCBAUD
 = 
où®
('0000377')

121 
¬ch
.
CBAUDEX
 = 
où®
('0000000')

122 
¬ch
.
CIBAUD
 = 
où®
('077600000')

124 
¬ch
.
CFLAG
 = {

125 
CSIZE
 = 
où®
('00001400'),

126 
	gCS5
 = 
où®
('00000000'),

127 
	gCS6
 = 
où®
('00000400'),

128 
	gCS7
 = 
où®
('00001000'),

129 
	gCS8
 = 
où®
('00001400'),

130 
	gCSTOPB
 = 
où®
('00002000'),

131 
	gCREAD
 = 
où®
('00004000'),

132 
	gPARENB
 = 
où®
('00010000'),

133 
	gPARODD
 = 
où®
('00020000'),

134 
	gHUPCL
 = 
où®
('00040000'),

135 
	gCLOCAL
 = 
où®
('00100000'),

138 
	g¬ch
.
	gIFLAG
 = {

139 
IGNBRK
 = 
où®
('0000001'),

140 
	gBRKINT
 = 
où®
('0000002'),

141 
	gIGNPAR
 = 
où®
('0000004'),

142 
	gPARMRK
 = 
où®
('0000010'),

143 
	gINPCK
 = 
où®
('0000020'),

144 
	gISTRIP
 = 
où®
('0000040'),

145 
	gINLCR
 = 
où®
('0000100'),

146 
	gIGNCR
 = 
où®
('0000200'),

147 
	gICRNL
 = 
où®
('0000400'),

148 
	gIXON
 = 
où®
('0001000'),

149 
	gIXOFF
 = 
où®
('0002000'),

150 
	gIXANY
 = 
où®
('0004000'),

151 
	gIUCLC
 = 
où®
('0010000'),

152 
	gIMAXBEL
 = 
où®
('0020000'),

153 
	gIUTF8
 = 
où®
('0040000'),

156 
	g¬ch
.
	gCC
 = {

157 
VINTR
 = 0,

158 
	gVQUIT
 = 1,

159 
	gVERASE
 = 2,

160 
	gVKILL
 = 3,

161 
	gVEOF
 = 4,

162 
	gVMIN
 = 5,

163 
	gVEOL
 = 6,

164 
	gVTIME
 = 7,

165 
	gVEOL2
 = 8,

166 
	gVSWTC
 = 9,

167 
	gVWERASE
 = 10,

168 
	gVREPRINT
 = 11,

169 
	gVSUSP
 = 12,

170 
	gVSTART
 = 13,

171 
	gVSTOP
 = 14,

172 
	gVLNEXT
 = 15,

173 
	gVDISCARD
 = 16,

176 
	g¬ch
.
	gB
 = {

177 ['0'] = 
où®
('0000000'),

178 ['50'] = 
où®
('0000001'),

179 ['75'] = 
où®
('0000002'),

180 ['110'] = 
où®
('0000003'),

181 ['134'] = 
où®
('0000004'),

182 ['150'] = 
où®
('0000005'),

183 ['200'] = 
où®
('0000006'),

184 ['300'] = 
où®
('0000007'),

185 ['600'] = 
où®
('0000010'),

186 ['1200'] = 
où®
('0000011'),

187 ['1800'] = 
où®
('0000012'),

188 ['2400'] = 
où®
('0000013'),

189 ['4800'] = 
où®
('0000014'),

190 ['9600'] = 
où®
('0000015'),

191 ['19200'] = 
où®
('0000016'),

192 ['38400'] = 
où®
('0000017'),

193 ['57600'] = 
où®
('00020'),

194 ['115200'] = 
où®
('00021'),

195 ['230400'] = 
où®
('00022'),

196 ['460800'] = 
où®
('00023'),

197 ['500000'] = 
où®
('00024'),

198 ['576000'] = 
où®
('00025'),

199 ['921600'] = 
où®
('00026'),

200 ['1000000'] = 
où®
('00027'),

201 ['1152000'] = 
où®
('00030'),

202 ['1500000'] = 
où®
('00031'),

203 ['2000000'] = 
où®
('00032'),

204 ['2500000'] = 
où®
('00033'),

205 ['3000000'] = 
où®
('00034'),

206 ['3500000'] = 
où®
('00035'),

207 ['4000000'] = 
où®
('00036'),

210 
	g¬ch
.
	gO
 = {

211 
RDONLY
 = 
où®
('0000'),

212 
	gWRONLY
 = 
où®
('0001'),

213 
	gRDWR
 = 
où®
('0002'),

214 
	gACCMODE
 = 
où®
('0003'),

215 
	gCREAT
 = 
où®
('0100'),

216 
	gEXCL
 = 
où®
('0200'),

217 
	gNOCTTY
 = 
où®
('0400'),

218 
	gTRUNC
 = 
où®
('01000'),

219 
	gAPPEND
 = 
où®
('02000'),

220 
	gNONBLOCK
 = 
où®
('04000'),

221 
	gDSYNC
 = 
où®
('010000'),

222 
	gASYNC
 = 
où®
('020000'),

223 
	gDIRECTORY
 = 
où®
('040000'),

224 
	gNOFOLLOW
 = 
où®
('0100000'),

225 
	gLARGEFILE
 = 
où®
('0200000'),

226 
	gDIRECT
 = 
où®
('0400000'),

227 
	gNOATIME
 = 
où®
('01000000'),

228 
	gCLOEXEC
 = 
où®
('02000000'),

229 
	gSYNC
 = 
où®
('04010000'),

232 
	g¬ch
.
	gMAP
 = {

233 
FILE
 = 0,

234 
	gSHARED
 = 0x01,

235 
	gPRIVATE
 = 0x02,

236 
	gTYPE
 = 0x0f,

237 
	gFIXED
 = 0x10,

238 
	gANONYMOUS
 = 0x20,

239 
	gNORESERVE
 = 0x40,

240 
	gLOCKED
 = 0x80,

241 
	gGROWSDOWN
 = 0x00100,

242 
	gDENYWRITE
 = 0x00800,

243 
	gEXECUTABLE
 = 0x01000,

244 
	gPOPULATE
 = 0x08000,

245 
	gNONBLOCK
 = 0x10000,

246 
	gSTACK
 = 0x20000,

247 
	gHUGETLB
 = 0x40000,

250 
	g¬ch
.
	gMCL
 = {

251 
CURRENT
 = 0x2000,

252 
	gFUTURE
 = 0x4000,

255 
	g¬ch
.
	gPROT
 = {

256 
SAO
 = 0x10, -- 
SŒÚg
 
Acûss
 
	gOrd”šg


259  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/ffi.lua

1 -- 
µc
 
¥ecific
 
defš™iÚs


4 
	g‹rmios
 = [[

5 
	s‹rmios
 {

6 
tcæag_t
 
c_iæag
;

7 
tcæag_t
 
c_oæag
;

8 
tcæag_t
 
c_cæag
;

9 
tcæag_t
 
c_læag
;

10 
cc_t
 
c_cc
[19];

11 
cc_t
 
	gc_lše
;

12 
¥“d_t
 
	gc_i¥“d
;

13 
¥“d_t
 
	gc_o¥“d
;

16 
	gucÚ‹xt
 = [[

17 
g»g_t
, 
g»g£t_t
[48];

19 
	gå»gs
[32];

20 
	gåsü
;

21 
	g_·d
[2];

22 } 
	tå»g£t_t
;

24 
	gv¼egs
[32][4];

25 
	gvr§ve
;

26 
	g_·d
[2];

27 
	gvsü
;

28 } 
	tv¼eg£t_t
;

30 
g»g£t_t
 
	gg»gs
;

31 
å»g£t_t
 
	gå»gs
;

32 
v¼eg£t_t
 
v¼egs
 
__©Œibu‹__
((
__®igÃd__
(16)));

33 } 
	tmcÚ‹xt_t
;

34 
	sucÚ‹xt
 {

35 
	guc_æags
;

36 
ucÚ‹xt
 *
	guc_lšk
;

37 
¡ack_t
 
	guc_¡ack
;

38 
	guc_·d
[7];

39 
	uuc_»gs_±r
 {

40 
±_»gs
 *
	g»gs
;

41 
mcÚ‹xt_t
 *
	guc_»gs
;

42 } 
	guc_mcÚ‹xt
;

43 
sig£t_t
 
	guc_sigmask
;

44 
	guc_»g_¥aû
[(
mcÚ‹xt_t
) + 12];

45 } 
	tucÚ‹xt_t
;

47 
	g¡©
 = [[

48 
	s¡©
 {

49 
¡_dev
;

50 
¡_šo
;

51 
¡_mode
;

52 
¡_Æšk
;

53 
¡_uid
;

54 
¡_gid
;

55 
¡_rdev
;

56 
__·d1
;

57 
¡_size
;

58 
¡_blksize
;

59 
__·d2
;

60 
¡_blocks
;

61 
¡_©ime
;

62 
¡_©ime_n£c
;

63 
¡_mtime
;

64 
¡_mtime_n£c
;

65 
¡_ùime
;

66 
¡_ùime_n£c
;

67 
__unu£d4
;

68 
__unu£d5
;

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/ioctl.lua

1 -- 
µc
 
ioùl
 
difã»nûs


3 
loÿl
 
	g¬ch
 = {

4 
IOC
 = {

5 
SIZEBITS
 = 13,

6 
	gDIRBITS
 = 3,

7 
	gNONE
 = 1,

8 
	gREAD
 = 2,

9 
	gWRITE
 = 4,

11 
	gioùl
 = 
funùiÚ
(
_IO
, 
_IOR
, 
_IOW
, 
_IORW
)

13 
	gFIOCLEX
 = 
_IO
('f', 1),

14 
	gFIONCLEX
 = 
_IO
('f', 2),

15 
	gFIOQSIZE
 = 
_IOR
('f', 128, "off"),

16 
	gFIOASYNC
 = 
_IOW
('f', 125, "int"),

17 
	gTCGETS
 = 
_IOR
('t', 19, "termios"),

18 
	gTCSETS
 = 
_IOW
('t', 20, "termios"),

19 
	gTCSETSW
 = 
_IOW
('t', 21, "termios"),

20 
	gTCSETSF
 = 
_IOW
('t', 22, "termios"),

21 
	gTCSBRK
 = 
_IO
('t', 29),

22 
	gTCXONC
 = 
_IO
('t', 30),

23 
	gTCFLSH
 = 
_IO
('t', 31),

24 
	gTIOCSWINSZ
 = 
_IOW
('t', 103, "winsize"),

25 
	gTIOCGWINSZ
 = 
_IOR
('t', 104, "winsize"),

26 
	gTIOCOUTQ
 = 
_IOR
('t', 115, "int"),

27 
	gTIOCSPGRP
 = 
_IOW
('t', 118, "int"),

28 
	gTIOCGPGRP
 = 
_IOR
('t', 119, "int"),

29 
	gFIONBIO
 = 
_IOW
('f', 126, "int"),

30 
	gFIONREAD
 = 
_IOR
('f', 127, "int"),

32 
	g’d
,

35  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/nr.lua

1 -- 
µc
 
sysÿÎ
 
numb”s


3 
loÿl
 
	gÄ
 = {

4 
z”İad
 = 
Œue
,

5 
	gSYS
 = {

6 
»¡¬t_sysÿÎ
 = 0,

7 
	gex™
 = 1,

8 
	gfÜk
 = 2,

9 
	g»ad
 = 3,

10 
	gwr™e
 = 4,

11 
	gİ’
 = 5,

12 
	gşo£
 = 6,

13 
	gwa™pid
 = 7,

14 
	gü—t
 = 8,

15 
	glšk
 = 9,

16 
	guÆšk
 = 10,

17 
	gexecve
 = 11,

18 
	gchdœ
 = 12,

19 
	gtime
 = 13,

20 
	gmknod
 = 14,

21 
	gchmod
 = 15,

22 
	glchown
 = 16,

24 
	gŞd¡©
 = 18,

25 
	gl£ek
 = 19,

26 
	gg‘pid
 = 20,

27 
	gmouÁ
 = 21,

28 
	gumouÁ
 = 22,

29 
	g£tuid
 = 23,

30 
	gg‘uid
 = 24,

31 
	g¡ime
 = 25,

32 
	g±¿û
 = 26,

33 
	g®¬m
 = 27,

34 
	gŞdf¡©
 = 28,

35 
	g·u£
 = 29,

36 
	gutime
 = 30,

37 
	g¡ty
 = 31,

38 
	gg‰y
 = 32,

39 
	gacûss
 = 33,

40 
	gniû
 = 34,

41 
	gáime
 = 35,

42 
	gsync
 = 36,

43 
	gkl
 = 37,

44 
	g»Çme
 = 38,

45 
	gmkdœ
 = 39,

46 
	grmdœ
 = 40,

47 
	gdup
 = 41,

48 
	gpe
 = 42,

49 
	gtimes
 = 43,

50 
	g´of
 = 44,

51 
	gbrk
 = 45,

52 
	g£tgid
 = 46,

53 
	gg‘gid
 = 47,

54 
	gsigÇl
 = 48,

55 
	gg‘euid
 = 49,

56 
	gg‘egid
 = 50,

57 
	gacù
 = 51,

58 
	gumouÁ2
 = 52,

59 
	glock
 = 53,

60 
	gioùl
 = 54,

61 
	gfú
 = 55,

62 
	gmpx
 = 56,

63 
	g£gid
 = 57,

64 
	gulim™
 = 58,

65 
	gŞdŞduÇme
 = 59,

66 
	gumask
 = 60,

67 
	gchroÙ
 = 61,

68 
	gu¡©
 = 62,

69 
	gdup2
 = 63,

70 
	gg‘µid
 = 64,

71 
	gg‘pg½
 = 65,

72 
	g£tsid
 = 66,

73 
	gsigaùiÚ
 = 67,

74 
	gsg‘mask
 = 68,

75 
	gs£tmask
 = 69,

76 
	g£Œeuid
 = 70,

77 
	g£Œegid
 = 71,

78 
	gsigsu¥’d
 = 72,

79 
	gsig³ndšg
 = 73,

80 
	g£tho¡Çme
 = 74,

81 
	g£Œlim™
 = 75,

82 
	gg‘¾im™
 = 76,

83 
	gg‘ru§ge
 = 77,

84 
	gg‘timeofday
 = 78,

85 
	g£‰imeofday
 = 79,

86 
	gg‘groups
 = 80,

87 
	g£tgroups
 = 81,

88 
	g£Ëù
 = 82,

89 
	gsymlšk
 = 83,

90 
	gŞdl¡©
 = 84,

91 
	g»adlšk
 = 85,

92 
	gu£lib
 = 86,

93 
	gsw­Ú
 = 87,

94 
	g»boÙ
 = 88,

95 
	g»addœ
 = 89,

96 
	gmm­
 = 90,

97 
	gmunm­
 = 91,

98 
	gŒunÿ‹
 = 92,

99 
	gárunÿ‹
 = 93,

100 
	gfchmod
 = 94,

101 
	gfchown
 = 95,

102 
	gg‘´iÜ™y
 = 96,

103 
	g£riÜ™y
 = 97,

104 
	g´of
 = 98,

105 
	g¡©fs
 = 99,

106 
	gf¡©fs
 = 100,

107 
	giİ”m
 = 101,

108 
	gsock‘ÿÎ
 = 102,

109 
	gsy¦og
 = 103,

110 
	g£t™im”
 = 104,

111 
	gg‘™im”
 = 105,

112 
	g¡©
 = 106,

113 
	gl¡©
 = 107,

114 
	gf¡©
 = 108,

115 
	gŞduÇme
 = 109,

116 
	giİl
 = 110,

117 
	gvhªgup
 = 111,

118 
	gidË
 = 112,

119 
	gvm86
 = 113,

120 
	gwa™4
 = 114,

121 
	gsw­off
 = 115,

122 
	gsysšfo
 = 116,

123 
	gc
 = 117,

124 
	gfsync
 = 118,

125 
	gsig»tuº
 = 119,

126 
	gşÚe
 = 120,

127 
	g£tdomašÇme
 = 121,

128 
	guÇme
 = 122,

129 
	gmodify_ldt
 = 123,

130 
	gadjtimex
 = 124,

131 
	gm´Ùeù
 = 125,

132 
	gsig´ocmask
 = 126,

133 
	gü—‹_moduË
 = 127,

134 
	gš™_moduË
 = 128,

135 
	gd–‘e_moduË
 = 129,

136 
	gg‘_k”Ãl_syms
 = 130,

137 
	gquÙaùl
 = 131,

138 
	gg‘pgid
 = 132,

139 
	gfchdœ
 = 133,

140 
	gbdæush
 = 134,

141 
	gsysfs
 = 135,

142 
	g³rsÚ®™y
 = 136,

143 
	gafs_sysÿÎ
 = 137,

144 
	g£tfsuid
 = 138,

145 
	g£tfsgid
 = 139,

146 
	g_Î£ek
 = 140,

147 
	gg‘d’ts
 = 141,

148 
	g_Ãw£Ëù
 = 142,

149 
	gæock
 = 143,

150 
	gmsync
 = 144,

151 
	g»adv
 = 145,

152 
	gwr™ev
 = 146,

153 
	gg‘sid
 = 147,

154 
	gfd©async
 = 148,

155 
	g_sysùl
 = 149,

156 
	gmlock
 = 150,

157 
	gmuÆock
 = 151,

158 
	gmlock®l
 = 152,

159 
	gmuÆock®l
 = 153,

160 
	gsched_£¬am
 = 154,

161 
	gsched_g‘·¿m
 = 155,

162 
	gsched_£tscheduËr
 = 156,

163 
	gsched_g‘scheduËr
 = 157,

164 
	gsched_y›ld
 = 158,

165 
	gsched_g‘_´iÜ™y_max
= 159,

166 
	gsched_g‘_´iÜ™y_mš
= 160,

167 
	gsched_¼_g‘_š‹rv®
 = 161,

168 
	gÇno¦“p
 = 162,

169 
	gm»m­
 = 163,

170 
	g£Œesuid
 = 164,

171 
	gg‘»suid
 = 165,

172 
	gqu”y_moduË
 = 166,

173 
	gpŞl
 = 167,

174 
	gnfs£rvùl
 = 168,

175 
	g£Œesgid
 = 169,

176 
	gg‘»sgid
 = 170,

177 
	g´ùl
 = 171,

178 
	g¹_sig»tuº
 = 172,

179 
	g¹_sigaùiÚ
 = 173,

180 
	g¹_sig´ocmask
 = 174,

181 
	g¹_sig³ndšg
 = 175,

182 
	g¹_sigtimedwa™
 = 176,

183 
	g¹_sigqueuešfo
 = 177,

184 
	g¹_sigsu¥’d
 = 178,

185 
	g´—d64
 = 179,

186 
	gpwr™e64
 = 180,

187 
	gchown
 = 181,

188 
	gg‘cwd
 = 182,

189 
	gÿpg‘
 = 183,

190 
	gÿp£t
 = 184,

191 
	gsig®t¡ack
 = 185,

192 
	g£ndfe
 = 186,

193 
	gg‘pmsg
 = 187,

194 
	gpumsg
 = 188,

195 
	gvfÜk
 = 189,

196 
	gug‘¾im™
 = 190,

197 
	g»adah—d
 = 191,

198 
	gmm­2
 = 192,

199 
	gŒunÿ‹64
 = 193,

200 
	gárunÿ‹64
 = 194,

201 
	g¡©64
 = 195,

202 
	gl¡©64
 = 196,

203 
	gf¡©64
 = 197,

204 
	gpcicÚfig_»ad
 = 198,

205 
	gpcicÚfig_wr™e
 = 199,

206 
	gpcicÚfig_ioba£
 = 200,

207 
	gmuÉËx”
 = 201,

208 
	gg‘d’ts64
 = 202,

209 
	gpivÙ_roÙ
 = 203,

210 
	gfú64
 = 204,

211 
	gmadvi£
 = 205,

212 
	gmšcÜe
 = 206,

213 
	gg‘tid
 = 207,

214 
	gtkl
 = 208,

215 
	g£tx©Œ
 = 209,

216 
	gl£tx©Œ
 = 210,

217 
	gf£tx©Œ
 = 211,

218 
	gg‘x©Œ
 = 212,

219 
	glg‘x©Œ
 = 213,

220 
	gfg‘x©Œ
 = 214,

221 
	gli¡x©Œ
 = 215,

222 
	gÎi¡x©Œ
 = 216,

223 
	gæi¡x©Œ
 = 217,

224 
	g»movex©Œ
 = 218,

225 
	gÌemovex©Œ
 = 219,

226 
	gäemovex©Œ
 = 220,

227 
	gfu‹x
 = 221,

228 
	gsched_£ffš™y
 = 222,

229 
	gsched_g‘affš™y
 = 223,

230 
	gtuxÿÎ
 = 225,

231 
	g£ndfe64
 = 226,

232 
	gio_£tup
 = 227,

233 
	gio_de¡roy
 = 228,

234 
	gio_g‘ev’ts
 = 229,

235 
	gio_subm™
 = 230,

236 
	gio_ÿnûl
 = 231,

237 
	g£t_tid_add»ss
 = 232,

238 
	gçdvi£64
 = 233,

239 
	gex™_group
 = 234,

240 
	glookup_dcook›
 = 235,

241 
	g•Şl_ü—‹
 = 236,

242 
	g•Şl_ùl
 = 237,

243 
	g•Şl_wa™
 = 238,

244 
	g»m­_fe_·ges
 = 239,

245 
	gtim”_ü—‹
 = 240,

246 
	gtim”_£‰ime
 = 241,

247 
	gtim”_g‘time
 = 242,

248 
	gtim”_g‘ov”run
 = 243,

249 
	gtim”_d–‘e
 = 244,

250 
	gşock_£‰ime
 = 245,

251 
	gşock_g‘time
 = 246,

252 
	gşock_g‘»s
 = 247,

253 
	gşock_Çno¦“p
 = 248,

254 
	gsw­cÚ‹xt
 = 249,

255 
	gtgkl
 = 250,

256 
	gutimes
 = 251,

257 
	g¡©fs64
 = 252,

258 
	gf¡©fs64
 = 253,

259 
	gçdvi£64_64
 = 254,

260 
	g¹as
 = 255,

261 
	gsys_debug_£tcÚ‹xt
 = 256,

262 
	gmig¿‹_·ges
 = 258,

263 
	gmbšd
 = 259,

264 
	gg‘_mempŞicy
 = 260,

265 
	g£t_mempŞicy
 = 261,

266 
	gmq_İ’
 = 262,

267 
	gmq_uÆšk
 = 263,

268 
	gmq_timed£nd
 = 264,

269 
	gmq_timed»ûive
 = 265,

270 
	gmq_nÙify
 = 266,

271 
	gmq_g‘£‰r
 = 267,

272 
	gkexec_lßd
 = 268,

273 
	gadd_key
 = 269,

274 
	g»que¡_key
 = 270,

275 
	gkeyùl
 = 271,

276 
	gwa™id
 = 272,

277 
	giİrio_£t
 = 273,

278 
	giİrio_g‘
 = 274,

279 
	gšÙify_š™
 = 275,

280 
	gšÙify_add_w©ch
 = 276,

281 
	gšÙify_rm_w©ch
 = 277,

282 
	g¥u_run
 = 278,

283 
	g¥u_ü—‹
 = 279,

284 
	gp£Ëù6
 = 280,

285 
	gµŞl
 = 281,

286 
	gunsh¬e
 = 282,

287 
	g¥liû
 = 283,

288 
	g‹e
 = 284,

289 
	gvm¥liû
 = 285,

290 
	gİ’©
 = 286,

291 
	gmkdœ©
 = 287,

292 
	gmknod©
 = 288,

293 
	gfchowÇt
 = 289,

294 
	gfutime§t
 = 290,

295 
	gf¡©©64
 = 291,

296 
	guÆšk©
 = 292,

297 
	g»Çm—t
 = 293,

298 
	glšk©
 = 294,

299 
	gsymlšk©
 = 295,

300 
	g»adlšk©
 = 296,

301 
	gfchmod©
 = 297,

302 
	gçcûs§t
 = 298,

303 
	gg‘_robu¡_li¡
 = 299,

304 
	g£t_robu¡_li¡
 = 300,

305 
	gmove_·ges
 = 301,

306 
	gg‘ıu
 = 302,

307 
	g•Şl_pwa™
 = 303,

308 
	gutim’§t
 = 304,

309 
	gsigÇlfd
 = 305,

310 
	gtim”fd_ü—‹
 = 306,

311 
	gev’tfd
 = 307,

312 
	gsync_fe_¿nge2
 = 308,

313 
	gçÎoÿ‹
 = 309,

314 
	gsub·ge_´Ù
 = 310,

315 
	gtim”fd_£‰ime
 = 311,

316 
	gtim”fd_g‘time
 = 312,

317 
	gsigÇlfd4
 = 313,

318 
	gev’tfd2
 = 314,

319 
	g•Şl_ü—‹1
 = 315,

320 
	gdup3
 = 316,

321 
	gpe2
 = 317,

322 
	gšÙify_š™1
 = 318,

323 
	g³rf_ev’t_İ’
 = 319,

324 
	g´—dv
 = 320,

325 
	gpwr™ev
 = 321,

326 
	g¹_tgsigqueuešfo
 = 322,

327 
	gçnÙify_š™
 = 323,

328 
	gçnÙify_m¬k
 = 324,

329 
	g´lim™64
 = 325,

330 
	gsock‘
 = 326,

331 
	gbšd
 = 327,

332 
	gcÚÃù
 = 328,

333 
	gli¡’
 = 329,

334 
	gacû±
 = 330,

335 
	gg‘sockÇme
 = 331,

336 
	gg‘³”Çme
 = 332,

337 
	gsock‘·œ
 = 333,

338 
	g£nd
 = 334,

339 
	g£ndto
 = 335,

340 
	g»cv
 = 336,

341 
	g»cväom
 = 337,

342 
	gshutdown
 = 338,

343 
	g£tsockİt
 = 339,

344 
	gg‘sockİt
 = 340,

345 
	g£ndmsg
 = 341,

346 
	g»cvmsg
 = 342,

347 
	g»cvmmsg
 = 343,

348 
	gacû±4
 = 344,

349 
	gÇme_to_hªdË_©
 = 345,

350 
	gİ’_by_hªdË_©
 = 346,

351 
	gşock_adjtime
 = 347,

352 
	gsyncfs
 = 348,

353 
	g£ndmmsg
 = 349,

354 
	g£Šs
 = 350,

355 
	g´oûss_vm_»adv
 = 351,

356 
	g´oûss_vm_wr™ev
 = 352,

357 
	gkcmp
 = 353,

358 
	gfš™_moduË
 = 354,

359 
	gsched_£‰r
 = 355,

360 
	gsched_g‘©Œ
 = 356,

361 
	g»Çm—t2
 = 357,

362 
	g£ccomp
 = 358,

363 
	gg‘¿ndom
 = 359,

364 
	gmemfd_ü—‹
 = 360,

365 
	gbpf
 = 361,

369  
	gÄ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/constants.lua

1 -- 
µc
 
¥ecific
 
cÚ¡ªts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gh
 = 
»quœe
 "syscall.helpers"

12 
loÿl
 
où®
 = 
h
.octal

14 
loÿl
 
¬ch
 = {}

16 
¬ch
.
EDEADLOCK
 = 58 -- 
Úly
 
”rÜ
 
th©
 
difãrs
 
äom
 
g’”ic


18 
¬ch
.
SO
 = { -- 16-21 
difãr
 
µc


19 
DEBUG
 = 1,

20 
	gREUSEADDR
 = 2,

21 
	gTYPE
 = 3,

22 
	gERROR
 = 4,

23 
	gDONTROUTE
 = 5,

24 
	gBROADCAST
 = 6,

25 
	gSNDBUF
 = 7,

26 
	gRCVBUF
 = 8,

27 
	gKEEPALIVE
 = 9,

28 
	gOOBINLINE
 = 10,

29 
	gNO_CHECK
 = 11,

30 
	gPRIORITY
 = 12,

31 
	gLINGER
 = 13,

32 
	gBSDCOMPAT
 = 14,

33 --
	gREUSEPORT
 = 15, -- 
	gÃw
, 
may
 
nÙ
 
be
 
defšed
 
y‘


34 
	gRCVLOWAT
 = 16,

35 
	gSNDLOWAT
 = 17,

36 
	gRCVTIMEO
 = 18,

37 
	gSNDTIMEO
 = 19,

38 
	gPASSCRED
 = 20,

39 
	gPEERCRED
 = 21,

40 
	gSECURITY_AUTHENTICATION
 = 22,

41 
	gSECURITY_ENCRYPTION_TRANSPORT
 = 23,

42 
	gSECURITY_ENCRYPTION_NETWORK
 = 24,

43 
	gBINDTODEVICE
 = 25,

44 
	gATTACH_FILTER
 = 26,

45 
	gDETACH_FILTER
 = 27,

46 
	gPEERNAME
 = 28,

47 
	gTIMESTAMP
 = 29,

48 
	gACCEPTCONN
 = 30,

49 
	gPEERSEC
 = 31,

50 
	gSNDBUFFORCE
 = 32,

51 
	gRCVBUFFORCE
 = 33,

52 
	gPASSSEC
 = 34,

53 
	gTIMESTAMPNS
 = 35,

54 
	gMARK
 = 36,

55 
	gTIMESTAMPING
 = 37,

56 
	gPROTOCOL
 = 38,

57 
	gDOMAIN
 = 39,

58 
	gRXQ_OVFL
 = 40,

59 
	gWIFI_STATUS
 = 41,

60 
	gPEEK_OFF
 = 42,

61 
	gNOFCS
 = 43,

64 
	g¬ch
.
	gOFLAG
 = {

65 
OPOST
 = 
où®
('00000001'),

66 
	gONLCR
 = 
où®
('00000002'),

67 
	gOLCUC
 = 
où®
('00000004'),

68 
	gOCRNL
 = 
où®
('00000010'),

69 
	gONOCR
 = 
où®
('00000020'),

70 
	gONLRET
 = 
où®
('00000040'),

71 
	gOFILL
 = 
où®
('00000100'),

72 
	gOFDEL
 = 
où®
('00000200'),

73 
	gNLDLY
 = 
où®
('00001400'),

74 
	gNL0
 = 
où®
('00000000'),

75 
	gNL1
 = 
où®
('00000400'),

76 
	gNL2
 = 
où®
('00001000'),

77 
	gNL3
 = 
où®
('00001400'),

78 
	gCRDLY
 = 
où®
('00030000'),

79 
	gCR0
 = 
où®
('00000000'),

80 
	gCR1
 = 
où®
('00010000'),

81 
	gCR2
 = 
où®
('00020000'),

82 
	gCR3
 = 
où®
('00030000'),

83 
	gTABDLY
 = 
où®
('00006000'),

84 
	gTAB0
 = 
où®
('00000000'),

85 
	gTAB1
 = 
où®
('00002000'),

86 
	gTAB2
 = 
où®
('00004000'),

87 
	gTAB3
 = 
où®
('00006000'),

88 
	gBSDLY
 = 
où®
('00100000'),

89 
	gBS0
 = 
où®
('00000000'),

90 
	gBS1
 = 
où®
('00100000'),

91 
	gFFDLY
 = 
où®
('00040000'),

92 
	gFF0
 = 
où®
('00000000'),

93 
	gFF1
 = 
où®
('00040000'),

94 
	gVTDLY
 = 
où®
('00200000'),

95 
	gVT0
 = 
où®
('00000000'),

96 
	gVT1
 = 
où®
('00200000'),

97 
	gXTABS
 = 
où®
('00006000'),

100 
	g¬ch
.
	gLFLAG
 = {

101 
ISIG
 = 0x00000080,

102 
	gICANON
 = 0x00000100,

103 
	gXCASE
 = 0x00004000,

104 
	gECHO
 = 0x00000008,

105 
	gECHOE
 = 0x00000002,

106 
	gECHOK
 = 0x00000004,

107 
	gECHONL
 = 0x00000010,

108 
	gNOFLSH
 = 0x80000000,

109 
	gTOSTOP
 = 0x00400000,

110 
	gECHOCTL
 = 0x00000040,

111 
	gECHOPRT
 = 0x00000020,

112 
	gECHOKE
 = 0x00000001,

113 
	gFLUSHO
 = 0x00800000,

114 
	gPENDIN
 = 0x20000000,

115 
	gIEXTEN
 = 0x00000400,

116 
	gEXTPROC
 = 0x10000000,

119 -- 
TODO
 
the£
 
wl
 
be
 
š
 
a
 
bË


120 
	g¬ch
.
	gCBAUD
 = 
où®
('0000377')

121 
¬ch
.
CBAUDEX
 = 
où®
('0000000')

122 
¬ch
.
CIBAUD
 = 
où®
('077600000')

124 
¬ch
.
CFLAG
 = {

125 
CSIZE
 = 
où®
('00001400'),

126 
	gCS5
 = 
où®
('00000000'),

127 
	gCS6
 = 
où®
('00000400'),

128 
	gCS7
 = 
où®
('00001000'),

129 
	gCS8
 = 
où®
('00001400'),

130 
	gCSTOPB
 = 
où®
('00002000'),

131 
	gCREAD
 = 
où®
('00004000'),

132 
	gPARENB
 = 
où®
('00010000'),

133 
	gPARODD
 = 
où®
('00020000'),

134 
	gHUPCL
 = 
où®
('00040000'),

135 
	gCLOCAL
 = 
où®
('00100000'),

138 
	g¬ch
.
	gIFLAG
 = {

139 
IGNBRK
 = 
où®
('0000001'),

140 
	gBRKINT
 = 
où®
('0000002'),

141 
	gIGNPAR
 = 
où®
('0000004'),

142 
	gPARMRK
 = 
où®
('0000010'),

143 
	gINPCK
 = 
où®
('0000020'),

144 
	gISTRIP
 = 
où®
('0000040'),

145 
	gINLCR
 = 
où®
('0000100'),

146 
	gIGNCR
 = 
où®
('0000200'),

147 
	gICRNL
 = 
où®
('0000400'),

148 
	gIXON
 = 
où®
('0001000'),

149 
	gIXOFF
 = 
où®
('0002000'),

150 
	gIXANY
 = 
où®
('0004000'),

151 
	gIUCLC
 = 
où®
('0010000'),

152 
	gIMAXBEL
 = 
où®
('0020000'),

153 
	gIUTF8
 = 
où®
('0040000'),

156 
	g¬ch
.
	gCC
 = {

157 
VINTR
 = 0,

158 
	gVQUIT
 = 1,

159 
	gVERASE
 = 2,

160 
	gVKILL
 = 3,

161 
	gVEOF
 = 4,

162 
	gVMIN
 = 5,

163 
	gVEOL
 = 6,

164 
	gVTIME
 = 7,

165 
	gVEOL2
 = 8,

166 
	gVSWTC
 = 9,

167 
	gVWERASE
 = 10,

168 
	gVREPRINT
 = 11,

169 
	gVSUSP
 = 12,

170 
	gVSTART
 = 13,

171 
	gVSTOP
 = 14,

172 
	gVLNEXT
 = 15,

173 
	gVDISCARD
 = 16,

176 
	g¬ch
.
	gB
 = {

177 ['0'] = 
où®
('0000000'),

178 ['50'] = 
où®
('0000001'),

179 ['75'] = 
où®
('0000002'),

180 ['110'] = 
où®
('0000003'),

181 ['134'] = 
où®
('0000004'),

182 ['150'] = 
où®
('0000005'),

183 ['200'] = 
où®
('0000006'),

184 ['300'] = 
où®
('0000007'),

185 ['600'] = 
où®
('0000010'),

186 ['1200'] = 
où®
('0000011'),

187 ['1800'] = 
où®
('0000012'),

188 ['2400'] = 
où®
('0000013'),

189 ['4800'] = 
où®
('0000014'),

190 ['9600'] = 
où®
('0000015'),

191 ['19200'] = 
où®
('0000016'),

192 ['38400'] = 
où®
('0000017'),

193 ['57600'] = 
où®
('00020'),

194 ['115200'] = 
où®
('00021'),

195 ['230400'] = 
où®
('00022'),

196 ['460800'] = 
où®
('00023'),

197 ['500000'] = 
où®
('00024'),

198 ['576000'] = 
où®
('00025'),

199 ['921600'] = 
où®
('00026'),

200 ['1000000'] = 
où®
('00027'),

201 ['1152000'] = 
où®
('00030'),

202 ['1500000'] = 
où®
('00031'),

203 ['2000000'] = 
où®
('00032'),

204 ['2500000'] = 
où®
('00033'),

205 ['3000000'] = 
où®
('00034'),

206 ['3500000'] = 
où®
('00035'),

207 ['4000000'] = 
où®
('00036'),

210 
	g¬ch
.
	gO
 = {

211 
RDONLY
 = 
où®
('0000'),

212 
	gWRONLY
 = 
où®
('0001'),

213 
	gRDWR
 = 
où®
('0002'),

214 
	gACCMODE
 = 
où®
('0003'),

215 
	gCREAT
 = 
où®
('0100'),

216 
	gEXCL
 = 
où®
('0200'),

217 
	gNOCTTY
 = 
où®
('0400'),

218 
	gTRUNC
 = 
où®
('01000'),

219 
	gAPPEND
 = 
où®
('02000'),

220 
	gNONBLOCK
 = 
où®
('04000'),

221 
	gDSYNC
 = 
où®
('010000'),

222 
	gASYNC
 = 
où®
('020000'),

223 
	gDIRECTORY
 = 
où®
('040000'),

224 
	gNOFOLLOW
 = 
où®
('0100000'),

225 
	gLARGEFILE
 = 
où®
('0200000'),

226 
	gDIRECT
 = 
où®
('0400000'),

227 
	gNOATIME
 = 
où®
('01000000'),

228 
	gCLOEXEC
 = 
où®
('02000000'),

229 
	gSYNC
 = 
où®
('04010000'),

232 
	g¬ch
.
	gMAP
 = {

233 
FILE
 = 0,

234 
	gSHARED
 = 0x01,

235 
	gPRIVATE
 = 0x02,

236 
	gTYPE
 = 0x0f,

237 
	gFIXED
 = 0x10,

238 
	gANONYMOUS
 = 0x20,

239 
	gNORESERVE
 = 0x40,

240 
	gLOCKED
 = 0x80,

241 
	gGROWSDOWN
 = 0x00100,

242 
	gDENYWRITE
 = 0x00800,

243 
	gEXECUTABLE
 = 0x01000,

244 
	gPOPULATE
 = 0x08000,

245 
	gNONBLOCK
 = 0x10000,

246 
	gSTACK
 = 0x20000,

247 
	gHUGETLB
 = 0x40000,

250 
	g¬ch
.
	gMCL
 = {

251 
CURRENT
 = 0x2000,

252 
	gFUTURE
 = 0x4000,

255 
	g¬ch
.
	gPROT
 = {

256 
SAO
 = 0x10, -- 
SŒÚg
 
Acûss
 
	gOrd”šg


259  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/ffi.lua

1 -- 
µc
 
¥ecific
 
defš™iÚs


4 
	g‹rmios
 = [[

5 
	s‹rmios
 {

6 
tcæag_t
 
c_iæag
;

7 
tcæag_t
 
c_oæag
;

8 
tcæag_t
 
c_cæag
;

9 
tcæag_t
 
c_læag
;

10 
cc_t
 
c_cc
[19];

11 
cc_t
 
	gc_lše
;

12 
¥“d_t
 
	gc_i¥“d
;

13 
¥“d_t
 
	gc_o¥“d
;

16 
	gucÚ‹xt
 = [[

17 
g»g_t
, 
g»g£t_t
[48];

19 
	gå»gs
[32];

20 
	gåsü
;

21 
	g_·d
[2];

22 } 
	tå»g£t_t
;

24 
	gv¼egs
[32][4];

25 
	gvr§ve
;

26 
	g_·d
[2];

27 
	gvsü
;

28 } 
	tv¼eg£t_t
;

30 
g»g£t_t
 
	gg»gs
;

31 
å»g£t_t
 
	gå»gs
;

32 
v¼eg£t_t
 
v¼egs
 
__©Œibu‹__
((
__®igÃd__
(16)));

33 } 
	tmcÚ‹xt_t
;

34 
	sucÚ‹xt
 {

35 
	guc_æags
;

36 
ucÚ‹xt
 *
	guc_lšk
;

37 
¡ack_t
 
	guc_¡ack
;

38 
sig£t_t
 
	guc_sigmask
;

39 
mcÚ‹xt_t
 
	guc_mcÚ‹xt
;

40 } 
	tucÚ‹xt_t
;

42 
	g¡©
 = [[

43 
	s¡©
 {

44 
¡_dev
;

45 
¡_šo
;

46 
¡_Æšk
;

47 
¡_mode
;

48 
¡_uid
;

49 
¡_gid
;

50 
__·d0
;

51 
¡_rdev
;

52 
¡_size
;

53 
¡_blksize
;

54 
¡_blocks
;

55 
¡_©ime
;

56 
¡_©ime_n£c
;

57 
¡_mtime
;

58 
¡_mtime_n£c
;

59 
¡_ùime
;

60 
¡_ùime_n£c
;

61 
__unu£d
[3];

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/ioctl.lua

1 -- 
µc
 
ioùl
 
difã»nûs


3 
loÿl
 
	g¬ch
 = {

4 
IOC
 = {

5 
SIZEBITS
 = 13,

6 
	gDIRBITS
 = 3,

7 
	gNONE
 = 1,

8 
	gREAD
 = 2,

9 
	gWRITE
 = 4,

11 
	gioùl
 = 
funùiÚ
(
_IO
, 
_IOR
, 
_IOW
, 
_IORW
)

13 
	gFIOCLEX
 = 
_IO
('f', 1),

14 
	gFIONCLEX
 = 
_IO
('f', 2),

15 
	gFIOQSIZE
 = 
_IOR
('f', 128, "off"),

16 
	gFIOASYNC
 = 
_IOW
('f', 125, "int"),

17 
	gTCGETS
 = 
_IOR
('t', 19, "termios"),

18 
	gTCSETS
 = 
_IOW
('t', 20, "termios"),

19 
	gTCSETSW
 = 
_IOW
('t', 21, "termios"),

20 
	gTCSETSF
 = 
_IOW
('t', 22, "termios"),

21 
	gTCSBRK
 = 
_IO
('t', 29),

22 
	gTCXONC
 = 
_IO
('t', 30),

23 
	gTCFLSH
 = 
_IO
('t', 31),

24 
	gTIOCSWINSZ
 = 
_IOW
('t', 103, "winsize"),

25 
	gTIOCGWINSZ
 = 
_IOR
('t', 104, "winsize"),

26 
	gTIOCOUTQ
 = 
_IOR
('t', 115, "int"),

27 
	gTIOCSPGRP
 = 
_IOW
('t', 118, "int"),

28 
	gTIOCGPGRP
 = 
_IOR
('t', 119, "int"),

29 
	gFIONBIO
 = 
_IOW
('f', 126, "int"),

30 
	gFIONREAD
 = 
_IOR
('f', 127, "int"),

32 
	g’d
,

35  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/nr.lua

1 -- 
µc64Ë
 
sysÿÎ
 
numb”s


3 
loÿl
 
	gÄ
 = {

4 
z”İad
 = 
Œue
,

5 
	gSYS
 = {

6 
»¡¬t_sysÿÎ
 = 0,

7 
	gex™
 = 1,

8 
	gfÜk
 = 2,

9 
	g»ad
 = 3,

10 
	gwr™e
 = 4,

11 
	gİ’
 = 5,

12 
	gşo£
 = 6,

13 
	gwa™pid
 = 7,

14 
	gü—t
 = 8,

15 
	glšk
 = 9,

16 
	guÆšk
 = 10,

17 
	gexecve
 = 11,

18 
	gchdœ
 = 12,

19 
	gtime
 = 13,

20 
	gmknod
 = 14,

21 
	gchmod
 = 15,

22 
	glchown
 = 16,

24 
	gŞd¡©
 = 18,

25 
	gl£ek
 = 19,

26 
	gg‘pid
 = 20,

27 
	gmouÁ
 = 21,

28 
	gumouÁ
 = 22,

29 
	g£tuid
 = 23,

30 
	gg‘uid
 = 24,

31 
	g¡ime
 = 25,

32 
	g±¿û
 = 26,

33 
	g®¬m
 = 27,

34 
	gŞdf¡©
 = 28,

35 
	g·u£
 = 29,

36 
	gutime
 = 30,

37 
	g¡ty
 = 31,

38 
	gg‰y
 = 32,

39 
	gacûss
 = 33,

40 
	gniû
 = 34,

41 
	gáime
 = 35,

42 
	gsync
 = 36,

43 
	gkl
 = 37,

44 
	g»Çme
 = 38,

45 
	gmkdœ
 = 39,

46 
	grmdœ
 = 40,

47 
	gdup
 = 41,

48 
	gpe
 = 42,

49 
	gtimes
 = 43,

50 
	g´of
 = 44,

51 
	gbrk
 = 45,

52 
	g£tgid
 = 46,

53 
	gg‘gid
 = 47,

54 
	gsigÇl
 = 48,

55 
	gg‘euid
 = 49,

56 
	gg‘egid
 = 50,

57 
	gacù
 = 51,

58 
	gumouÁ2
 = 52,

59 
	glock
 = 53,

60 
	gioùl
 = 54,

61 
	gfú
 = 55,

62 
	gmpx
 = 56,

63 
	g£gid
 = 57,

64 
	gulim™
 = 58,

65 
	gŞdŞduÇme
 = 59,

66 
	gumask
 = 60,

67 
	gchroÙ
 = 61,

68 
	gu¡©
 = 62,

69 
	gdup2
 = 63,

70 
	gg‘µid
 = 64,

71 
	gg‘pg½
 = 65,

72 
	g£tsid
 = 66,

73 
	gsigaùiÚ
 = 67,

74 
	gsg‘mask
 = 68,

75 
	gs£tmask
 = 69,

76 
	g£Œeuid
 = 70,

77 
	g£Œegid
 = 71,

78 
	gsigsu¥’d
 = 72,

79 
	gsig³ndšg
 = 73,

80 
	g£tho¡Çme
 = 74,

81 
	g£Œlim™
 = 75,

82 
	gg‘¾im™
 = 76,

83 
	gg‘ru§ge
 = 77,

84 
	gg‘timeofday
 = 78,

85 
	g£‰imeofday
 = 79,

86 
	gg‘groups
 = 80,

87 
	g£tgroups
 = 81,

88 
	g£Ëù
 = 82,

89 
	gsymlšk
 = 83,

90 
	gŞdl¡©
 = 84,

91 
	g»adlšk
 = 85,

92 
	gu£lib
 = 86,

93 
	gsw­Ú
 = 87,

94 
	g»boÙ
 = 88,

95 
	g»addœ
 = 89,

96 
	gmm­
 = 90,

97 
	gmunm­
 = 91,

98 
	gŒunÿ‹
 = 92,

99 
	gárunÿ‹
 = 93,

100 
	gfchmod
 = 94,

101 
	gfchown
 = 95,

102 
	gg‘´iÜ™y
 = 96,

103 
	g£riÜ™y
 = 97,

104 
	g´of
 = 98,

105 
	g¡©fs
 = 99,

106 
	gf¡©fs
 = 100,

107 
	giİ”m
 = 101,

108 
	gsock‘ÿÎ
 = 102,

109 
	gsy¦og
 = 103,

110 
	g£t™im”
 = 104,

111 
	gg‘™im”
 = 105,

112 
	g¡©
 = 106,

113 
	gl¡©
 = 107,

114 
	gf¡©
 = 108,

115 
	gŞduÇme
 = 109,

116 
	giİl
 = 110,

117 
	gvhªgup
 = 111,

118 
	gidË
 = 112,

119 
	gvm86
 = 113,

120 
	gwa™4
 = 114,

121 
	gsw­off
 = 115,

122 
	gsysšfo
 = 116,

123 
	gc
 = 117,

124 
	gfsync
 = 118,

125 
	gsig»tuº
 = 119,

126 
	gşÚe
 = 120,

127 
	g£tdomašÇme
 = 121,

128 
	guÇme
 = 122,

129 
	gmodify_ldt
 = 123,

130 
	gadjtimex
 = 124,

131 
	gm´Ùeù
 = 125,

132 
	gsig´ocmask
 = 126,

133 
	gü—‹_moduË
 = 127,

134 
	gš™_moduË
 = 128,

135 
	gd–‘e_moduË
 = 129,

136 
	gg‘_k”Ãl_syms
 = 130,

137 
	gquÙaùl
 = 131,

138 
	gg‘pgid
 = 132,

139 
	gfchdœ
 = 133,

140 
	gbdæush
 = 134,

141 
	gsysfs
 = 135,

142 
	g³rsÚ®™y
 = 136,

143 
	gafs_sysÿÎ
 = 137,

144 
	g£tfsuid
 = 138,

145 
	g£tfsgid
 = 139,

146 
	g_Î£ek
 = 140,

147 
	gg‘d’ts
 = 141,

148 
	g_Ãw£Ëù
 = 142,

149 
	gæock
 = 143,

150 
	gmsync
 = 144,

151 
	g»adv
 = 145,

152 
	gwr™ev
 = 146,

153 
	gg‘sid
 = 147,

154 
	gfd©async
 = 148,

155 
	g_sysùl
 = 149,

156 
	gmlock
 = 150,

157 
	gmuÆock
 = 151,

158 
	gmlock®l
 = 152,

159 
	gmuÆock®l
 = 153,

160 
	gsched_£¬am
 = 154,

161 
	gsched_g‘·¿m
 = 155,

162 
	gsched_£tscheduËr
 = 156,

163 
	gsched_g‘scheduËr
 = 157,

164 
	gsched_y›ld
 = 158,

165 
	gsched_g‘_´iÜ™y_max
= 159,

166 
	gsched_g‘_´iÜ™y_mš
= 160,

167 
	gsched_¼_g‘_š‹rv®
 = 161,

168 
	gÇno¦“p
 = 162,

169 
	gm»m­
 = 163,

170 
	g£Œesuid
 = 164,

171 
	gg‘»suid
 = 165,

172 
	gqu”y_moduË
 = 166,

173 
	gpŞl
 = 167,

174 
	gnfs£rvùl
 = 168,

175 
	g£Œesgid
 = 169,

176 
	gg‘»sgid
 = 170,

177 
	g´ùl
 = 171,

178 
	g¹_sig»tuº
 = 172,

179 
	g¹_sigaùiÚ
 = 173,

180 
	g¹_sig´ocmask
 = 174,

181 
	g¹_sig³ndšg
 = 175,

182 
	g¹_sigtimedwa™
 = 176,

183 
	g¹_sigqueuešfo
 = 177,

184 
	g¹_sigsu¥’d
 = 178,

185 
	g´—d64
 = 179,

186 
	gpwr™e64
 = 180,

187 
	gchown
 = 181,

188 
	gg‘cwd
 = 182,

189 
	gÿpg‘
 = 183,

190 
	gÿp£t
 = 184,

191 
	gsig®t¡ack
 = 185,

192 
	g£ndfe
 = 186,

193 
	gg‘pmsg
 = 187,

194 
	gpumsg
 = 188,

195 
	gvfÜk
 = 189,

196 
	gug‘¾im™
 = 190,

197 
	g»adah—d
 = 191,

198 
	gpcicÚfig_»ad
 = 198,

199 
	gpcicÚfig_wr™e
 = 199,

200 
	gpcicÚfig_ioba£
 = 200,

201 
	gmuÉËx”
 = 201,

202 
	gg‘d’ts64
 = 202,

203 
	gpivÙ_roÙ
 = 203,

204 
	gmadvi£
 = 205,

205 
	gmšcÜe
 = 206,

206 
	gg‘tid
 = 207,

207 
	gtkl
 = 208,

208 
	g£tx©Œ
 = 209,

209 
	gl£tx©Œ
 = 210,

210 
	gf£tx©Œ
 = 211,

211 
	gg‘x©Œ
 = 212,

212 
	glg‘x©Œ
 = 213,

213 
	gfg‘x©Œ
 = 214,

214 
	gli¡x©Œ
 = 215,

215 
	gÎi¡x©Œ
 = 216,

216 
	gæi¡x©Œ
 = 217,

217 
	g»movex©Œ
 = 218,

218 
	gÌemovex©Œ
 = 219,

219 
	gäemovex©Œ
 = 220,

220 
	gfu‹x
 = 221,

221 
	gsched_£ffš™y
 = 222,

222 
	gsched_g‘affš™y
 = 223,

223 
	gtuxÿÎ
 = 225,

224 
	gio_£tup
 = 227,

225 
	gio_de¡roy
 = 228,

226 
	gio_g‘ev’ts
 = 229,

227 
	gio_subm™
 = 230,

228 
	gio_ÿnûl
 = 231,

229 
	g£t_tid_add»ss
 = 232,

230 
	gçdvi£64
 = 233,

231 
	gex™_group
 = 234,

232 
	glookup_dcook›
 = 235,

233 
	g•Şl_ü—‹
 = 236,

234 
	g•Şl_ùl
 = 237,

235 
	g•Şl_wa™
 = 238,

236 
	g»m­_fe_·ges
 = 239,

237 
	gtim”_ü—‹
 = 240,

238 
	gtim”_£‰ime
 = 241,

239 
	gtim”_g‘time
 = 242,

240 
	gtim”_g‘ov”run
 = 243,

241 
	gtim”_d–‘e
 = 244,

242 
	gşock_£‰ime
 = 245,

243 
	gşock_g‘time
 = 246,

244 
	gşock_g‘»s
 = 247,

245 
	gşock_Çno¦“p
 = 248,

246 
	gsw­cÚ‹xt
 = 249,

247 
	gtgkl
 = 250,

248 
	gutimes
 = 251,

249 
	g¡©fs64
 = 252,

250 
	gf¡©fs64
 = 253,

251 
	g¹as
 = 255,

252 
	gsys_debug_£tcÚ‹xt
 = 256,

253 
	gmig¿‹_·ges
 = 258,

254 
	gmbšd
 = 259,

255 
	gg‘_mempŞicy
 = 260,

256 
	g£t_mempŞicy
 = 261,

257 
	gmq_İ’
 = 262,

258 
	gmq_uÆšk
 = 263,

259 
	gmq_timed£nd
 = 264,

260 
	gmq_timed»ûive
 = 265,

261 
	gmq_nÙify
 = 266,

262 
	gmq_g‘£‰r
 = 267,

263 
	gkexec_lßd
 = 268,

264 
	gadd_key
 = 269,

265 
	g»que¡_key
 = 270,

266 
	gkeyùl
 = 271,

267 
	gwa™id
 = 272,

268 
	giİrio_£t
 = 273,

269 
	giİrio_g‘
 = 274,

270 
	gšÙify_š™
 = 275,

271 
	gšÙify_add_w©ch
 = 276,

272 
	gšÙify_rm_w©ch
 = 277,

273 
	g¥u_run
 = 278,

274 
	g¥u_ü—‹
 = 279,

275 
	gp£Ëù6
 = 280,

276 
	gµŞl
 = 281,

277 
	gunsh¬e
 = 282,

278 
	g¥liû
 = 283,

279 
	g‹e
 = 284,

280 
	gvm¥liû
 = 285,

281 
	gİ’©
 = 286,

282 
	gmkdœ©
 = 287,

283 
	gmknod©
 = 288,

284 
	gfchowÇt
 = 289,

285 
	gfutime§t
 = 290,

286 
	gÃwf¡©©
 = 291,

287 
	guÆšk©
 = 292,

288 
	g»Çm—t
 = 293,

289 
	glšk©
 = 294,

290 
	gsymlšk©
 = 295,

291 
	g»adlšk©
 = 296,

292 
	gfchmod©
 = 297,

293 
	gçcûs§t
 = 298,

294 
	gg‘_robu¡_li¡
 = 299,

295 
	g£t_robu¡_li¡
 = 300,

296 
	gmove_·ges
 = 301,

297 
	gg‘ıu
 = 302,

298 
	g•Şl_pwa™
 = 303,

299 
	gutim’§t
 = 304,

300 
	gsigÇlfd
 = 305,

301 
	gtim”fd_ü—‹
 = 306,

302 
	gev’tfd
 = 307,

303 
	gsync_fe_¿nge2
 = 308,

304 
	gçÎoÿ‹
 = 309,

305 
	gsub·ge_´Ù
 = 310,

306 
	gtim”fd_£‰ime
 = 311,

307 
	gtim”fd_g‘time
 = 312,

308 
	gsigÇlfd4
 = 313,

309 
	gev’tfd2
 = 314,

310 
	g•Şl_ü—‹1
 = 315,

311 
	gdup3
 = 316,

312 
	gpe2
 = 317,

313 
	gšÙify_š™1
 = 318,

314 
	g³rf_ev’t_İ’
 = 319,

315 
	g´—dv
 = 320,

316 
	gpwr™ev
 = 321,

317 
	g¹_tgsigqueuešfo
 = 322,

318 
	gçnÙify_š™
 = 323,

319 
	gçnÙify_m¬k
 = 324,

320 
	g´lim™64
 = 325,

321 
	gsock‘
 = 326,

322 
	gbšd
 = 327,

323 
	gcÚÃù
 = 328,

324 
	gli¡’
 = 329,

325 
	gacû±
 = 330,

326 
	gg‘sockÇme
 = 331,

327 
	gg‘³”Çme
 = 332,

328 
	gsock‘·œ
 = 333,

329 
	g£nd
 = 334,

330 
	g£ndto
 = 335,

331 
	g»cv
 = 336,

332 
	g»cväom
 = 337,

333 
	gshutdown
 = 338,

334 
	g£tsockİt
 = 339,

335 
	gg‘sockİt
 = 340,

336 
	g£ndmsg
 = 341,

337 
	g»cvmsg
 = 342,

338 
	g»cvmmsg
 = 343,

339 
	gacû±4
 = 344,

340 
	gÇme_to_hªdË_©
 = 345,

341 
	gİ’_by_hªdË_©
 = 346,

342 
	gşock_adjtime
 = 347,

343 
	gsyncfs
 = 348,

344 
	g£ndmmsg
 = 349,

345 
	g£Šs
 = 350,

346 
	g´oûss_vm_»adv
 = 351,

347 
	g´oûss_vm_wr™ev
 = 352,

348 
	gfš™_moduË
 = 353,

349 
	gkcmp
 = 354,

350 
	gsched_£‰r
 = 355,

351 
	gsched_g‘©Œ
 = 356,

352 
	gkcmp
 = 357,

353 
	gfš™_moduË
 = 358,

354 
	gsched_£‰r
 = 359,

355 
	gsched_g‘©Œ
 = 360,

356 
	g»Çm—t2
 = 361,

357 
	g£ccomp
 = 362,

358 
	gg‘¿ndom
 = 363,

359 
	gmemfd_ü—‹
 = 364,

360 
	gbpf
 = 365,

364 
	gÄ
.
	gSYS
.
	gf¡©©
 = 
Ä
.
SYS
.
Ãwf¡©©


366  
Ä


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/sockopt.lua

1 -- 
sock‘
 
İtiÚs
 
m­pšg


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg


10 -- 
TODO
 
add
 
ty³m­
 
cmsghdr
 
äom
 
	gsysÿÎ
/
	gty³s
.
lua
 
as
 
v”y
 
	gsim¬


11 -- 
like
 
ioùls
 
ªd
 
so
 
	gÚ
, 
sock‘
 
İtiÚs
 
¬e
 
a
 
¿ndom
 
š‹rçû
 
th©
 
Ãeds
 
some
 
h–p
 
to
 
make
 
™
 
niû
Ø
	gu£


12 -- 
we
 
Ãed
 
to
 
know
 
the
 
ty³s
 
of
h
İtiÚs
 (
š
 
·¹icuÏr
 
tho£
 
th©
 
¬e
 
nÙ
he  )

13 -- 
š
 
çù
 
mªy
 
šts
 
¬e
 
»®ly
 
	gboŞ
, 
so
 
niûr
 
to
 
know
 
th©
 
	gtoo
.

15 -- 
	gexam¶e


16 --
	gc
.
	gSOL
.
	gSOCKET
, c.
	gSO
.
	gPASSCRED
 - 
	gboŞ


18 -- 
nÙe
 
th©
 
cu¼’y
 
we
 
u£
 
	gc
.
	gSOL
[
Ëv–
], c.
	gSO
[
İŠame
] 
as
 
	gËv–
, o±Çm
£tsockİt
 
ªd
 
nÙhšg
 
	gg‘sockİt


19 -- 
but
 
the
 
£cÚd
 
Úe
 
d•’ds
 
Ú
h
fœ¡
 
like
 
cmsghdr
 
İtiÚs
 
ªd
 fœ¡ 
£ems
 
mÜe
 
	gcom¶ex
.

21 -- 
eg
 
Ãtf‹r
 
u£s
 
	gc
.
	gIPPROTO
.
IP
 
Ü
 c.IPPROTO.
IPV6
 
as
 
Ëv–
 
ªd
ƒg c.
	gIPT_SO_GET
.
REVISION_TARGET
‡ 
	gËv–
, 
	gİŠame


22 -- 
so
 
you
 
Ãed
 
to
 
·ss
 
the
 
Ëv–
 
of
h
sock‘
 you 
	gİ’ed
? 
We
 
ÿn
 
¡Üe
 
w™h
 
fd
 you 
u£
 
	gm‘hods
, sØ
	gg‘
/
£t
 
sockİt
 
	gknow
... 
th©
 
wl
 
be
 
—s›r
 
as
 
we
 
	gÿn
't know option‚ames otherwise.

23 -- 
®though
 
you
 
ÿn
 
®ways
 
u£
 
SOL_SOCKET
 (1 
š
 
Lšux
, 
ffff
 
BSD
), 
so
 
Ãed
 
to
 
¥ecŸl
 . 
Lucky
 
	$ICMP
 (
´Ùo
 1è
has
 
no
 
sock‘s


25 -- 
IP
 
suµÜts
 
bÙh
 
	$IP_
 (
ªd
 
MULTI_
èªd 
eg
 
IPT_
 
groups
 - 
BSD
 
mÜe
 
cÚsi¡’t
 
I
 
thšk
 
š
 
th©
 
IPT
 
is
 
©
 
¿w
 
IP
 
sock‘
 
Ëv–


26 -- 
so
 
wl
 
Ãed
 
some
 
fudgšg
. 
Obviou¦y
 
the
 
numb”s
 
dÚt
 
	`ov”Ïp
 (
IPT
 
is
 >=64è
£e
 
nÙe
 /
u¤
/
šşude
/
lšux
/
Ãtf‹r_v4
/
_bËs
.
h


28 -- 
d¿á


30 -- 
wl
 
be
 
mÜe
 
com¶ex
 
thª
 
this


33 
loÿl
 
Ëv–m­s
 = {

34 [
c
.
SOL
.
SOCKET
] = c.
SO
,

38 
	}
}

40 
loÿl
 
	gty³s
 = {

41 
SO
 = {

42 -- 
Ü
 
could
 
u£
 [
c
.
SO
.
ACCEPTCON
] 
but
 
nÙ
 
as
 
niû


43 
ACCEPTCONN
 = "boŞ—n", -- 
NB
 
»ad
 
	gÚly
, 
pÙ’tŸÎy
 
u£ful
 
to
 
add


44 
	gBINDTODEVICE
 = "string",

45 
	gBROADCAST
 = "boolean",

48 
	gIP
 = {

49 
ADD_MEMBERSHIP
 = 
t
.
_m»qn
, -- 
IP
 
	gmuÉiÿ¡


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/syscalls.lua

1 -- 
This
 
is
 
the
 
aùu®
 
sy¡em
 
ÿÎs
 
Lšux


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12  
	$funùiÚ
(
S
, 
hh
, 
c
, 
C
, 
ty³s
)

14 
loÿl
 
»t64
, 
»Šum
, 
»tfd
, 
»tboŞ
, 
»Œ
, 
»t™”
 = 
hh
.ret64, hh.retnum, hh.retfd, hh.retbool, hh.retptr, hh.retiter

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
”ºo
 = 
ffi
.errno

19 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

21 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

23 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

25 
loÿl
 
i¡y³
, 
mkty³
, 
g‘fd
 = 
h
.istype, h.mktype, h.getfd

27 
abi
.
abi32
 
th’


28 -- 
ov”ride
 
İ’
 
ÿÎ
 
w™h
 
Ïrgefe
 -- 
TODO
 
move
 
this
 
hack
 
to
 
c
.
lua
 
š¡—d


29 
funùiÚ
 
S
.
	$İ’
(
·thÇme
, 
æags
, 
mode
)

30 
æags
 = 
c
.
	`O
(flags, "LARGEFILE")

31  
	`»tfd
(
C
.
	$İ’
(
·thÇme
, 
æags
, 
c
.
MODE
[
mode
]))

32 
’d


33 
funùiÚ
 
S
.
	$İ’©
(
dœfd
, 
·thÇme
, 
æags
, 
mode
)

34 
æags
 = 
c
.
	`O
(flags, "LARGEFILE")

35  
	`»tfd
(
C
.
	$İ’©
(
c
.
AT_FDCWD
[
dœfd
], 
·thÇme
, 
æags
, c.
MODE
[
mode
]))

36 
’d


37 -- 
ü—t
 
has
 
no
 
Ïrgefe
 
æag
 
so
 
ÿÂÙ
 
be
 
u£d


38 
funùiÚ
 
S
.
	$ü—t
(
·thÇme
, 
mode
è 
S
.
	`İ’
Õ©hÇme, "CREAT,WRONLY,TRUNC", modeè
’d


39 
’d


41 
funùiÚ
 
S
.
	$·u£
(è 
	`»tboŞ
(
C
.
	$·u£
()è
’d


43 
funùiÚ
 
S
.
	$acù
(
f’ame
è 
	`»tboŞ
(
C
.
	$acù
(
f’ame
)è
’d


45 
funùiÚ
 
S
.
	$g‘´iÜ™y
(
which
, 
who
)

46 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘´iÜ™y
(
c
.
PRIO
[
which
], 
who
 
Ü
 0)

47 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


48  20 - 
»t
 -- 
adju¡
 
k”Ãl
 
»tuºed
 
v®ues
 
as
 
this
 
is
 
sysÿÎ
 
nÙ
 
libc


49 
’d


51 -- 
we
 
could
 
®loÿ‹
 
±id
, 
ùid
, 
s
 
»quœed
 
š
 
æags
 
š¡—d
. 
TODO
 
add
 
sigÇl
 
što
 
æag
 
·rsšg
 
dœeùly


52 
funùiÚ
 
S
.
	$şÚe
(
æags
, 
sigÇl
, 
¡ack
, 
±id
, 
s
, 
ùid
)

53 
æags
 = 
c
.
CLONE
[æags] + c.
SIG
[
sigÇl
 
Ü
 0]

54  
	`»Šum
(
C
.
	$şÚe
(
æags
, 
¡ack
, 
±id
, 
s
, 
ùid
))

55 
’d


57 
C
.
unsh¬e
 
th’
 -- 
qu™e
 
Ãw
, 
®so
 
nÙ
 
defšed
 
š
 
rump
 
y‘


58 
funùiÚ
 
S
.
	$unsh¬e
(
æags
è 
	`»tboŞ
(
C
.
	$unsh¬e
(
c
.
CLONE
[
æags
])è
’d


59 
’d


60 
C
.
£Šs
 
th’


61 
funùiÚ
 
S
.
	$£Šs
(
fd
, 
n¡y³
è 
	`»tboŞ
(
C
.
	`£Šs
(
	`g‘fd
(fd), 
c
.
CLONE
[n¡y³])è
’d


62 
’d


64 
funùiÚ
 
S
.
	$»boÙ
(
cmd
)

65  
	`»tboŞ
(
C
.
	$»boÙ
(
c
.
LINUX_REBOOT
.
MAGIC1
, c.LINUX_REBOOT.
MAGIC2
, c.
LINUX_REBOOT_CMD
[
cmd
]))

66 
’d


68 -- 
nÙe
 
wa™id
 
®so
 
´ovides
 
ru§ge
 
th©
 
Posix
 
dÛs
 
nÙ
 
have
, 
ov”ride
 

69 
funùiÚ
 
S
.
	`wa™id
(
idty³
, 
id
, 
İtiÚs
, 
šfİ
, 
ru§ge
è-- 
nÙe
 
Üd”
 
of
 
¬gs
, 
as
 
usu®ly
 
dÚt
 
suµly
 infop,„usage

70 
nÙ
 
šfİ
 
th’
 infİ = 
t
.
	$sigšfo
(è
’d


71 
nÙ
 
ru§ge
 
ªd
„u§g~ğ
çl£
 
th’
„u§gğ
t
.
	$ru§ge
(è
’d


72 
loÿl
 
»t
, 
”r
 = 
C
.
	$wa™id
(
c
.
P
[
idty³
], 
id
 
Ü
 0, 
šfİ
, c.
W
[
İtiÚs
], 
ru§ge
)

73 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


74  
šfİ
, 
n
, 
ru§ge


75 
’d


77 
funùiÚ
 
S
.
	$ex™
(
¡©us
è
C
.
	$ex™_group
(
c
.
EXIT
[
¡©us
 
Ü
 0]è
’d


79 
funùiÚ
 
S
.
	$sync_fe_¿nge
(
fd
, 
off£t
, 
couÁ
, 
æags
)

80  
	`»tboŞ
(
C
.
	`sync_fe_¿nge
(
	`g‘fd
(
fd
), 
off£t
, 
couÁ
, 
c
.
SYNC_FILE_RANGE
[
æags
]))

81 
’d


83 
funùiÚ
 
S
.
	$g‘cwd
(
buf
, 
size
)

84 
size
 = siz
Ü
 
c
.
PATH_MAX


85 
buf
 = buà
Ü
 
t
.
	$bufãr
(
size
)

86 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘cwd
(
buf
, 
size
)

87 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


88  
ffi
.
	$¡ršg
(
buf
)

89 
’d


91 
funùiÚ
 
S
.
	$¡©fs
(
·th
)

92 
loÿl
 
¡
 = 
t
.
	$¡©fs
()

93 
loÿl
 
»t
, 
”r
 = 
C
.
	$¡©fs
(
·th
, 
¡
)

94 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


95  
¡


96 
’d


98 
funùiÚ
 
S
.
	$f¡©fs
(
fd
)

99 
loÿl
 
¡
 = 
t
.
	$¡©fs
()

100 
loÿl
 
»t
, 
”r
 = 
C
.
	`f¡©fs
(
	`g‘fd
(
fd
), 
¡
)

101 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


102  
¡


103 
’d


105 
funùiÚ
 
S
.
	$m»m­
(
Şd_add»ss
, 
Şd_size
, 
Ãw_size
, 
æags
, 
Ãw_add»ss
)

106  
	`»Œ
(
C
.
	$m»m­
(
Şd_add»ss
, 
Şd_size
, 
Ãw_size
, 
c
.
MREMAP
[
æags
], 
Ãw_add»ss
))

107 
’d


108 
funùiÚ
 
S
.
	$»m­_fe_·ges
(
addr
, 
size
, 
´Ù
, 
pgoff
, 
æags
)

109  
	`»tboŞ
(
C
.
	$»m­_fe_·ges
(
addr
, 
size
, 
c
.
PROT
[
´Ù
], 
pgoff
, c.
MAP
[
æags
]))

110 
’d


111 
funùiÚ
 
S
.
	`çdvi£
(
fd
, 
adviû
, 
off£t
, 
Ën
è-- 
nÙe
 
¬gum’t
 
Üd”
 
TODO
 
chªge
 
back
?

112  
	`»tboŞ
(
C
.
	`çdvi£64
(
	`g‘fd
(
fd
), 
off£t
 
Ü
 0, 
Ën
 o¸0, 
c
.
POSIX_FADV
[
adviû
]))

113 
’d


114 
funùiÚ
 
S
.
	$çÎoÿ‹
(
fd
, 
mode
, 
off£t
, 
Ën
)

115  
	`»tboŞ
(
C
.
	`çÎoÿ‹
(
	`g‘fd
(
fd
), 
c
.
FALLOC_FL
[
mode
], 
off£t
 
Ü
 0, 
Ën
))

116 
’d


117 
funùiÚ
 
S
.
	$posix_çÎoÿ‹
(
fd
, 
off£t
, 
Ën
è 
S
.
	$çÎoÿ‹
(
fd
, 0, 
off£t
, 
Ën
è
’d


118 
funùiÚ
 
S
.
	$»adah—d
(
fd
, 
off£t
, 
couÁ
è 
	`»tboŞ
(
C
.
	`»adah—d
(
	`g‘fd
(fd), off£t, couÁ)è
’d


120 -- 
TODO
 
chªge
 
to
 
ty³
?

121 
funùiÚ
 
S
.
	$uÇme
()

122 
loÿl
 
u
 = 
t
.
	$ut¢ame
()

123 
loÿl
 
»t
, 
”r
 = 
C
.
	$uÇme
(
u
)

124 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


125  {
sy¢ame
 = 
ffi
.
	`¡ršg
(
u
.sy¢ame), 
nod’ame
 = ffi.¡ršg(u.nod’ame), 
»Ëa£
 = ffi.string(u.release),

126 
v”siÚ
 = 
ffi
.
	`¡ršg
(
u
.v”siÚ), 
machše
 = ffi.¡ršg(u.machše), 
domašÇme
 = ffi.¡ršg(u.domašÇme)
	}
}

127 
’d


129 
funùiÚ
 
	gS
.
	$£tho¡Çme
(
s
, 
Ën
è 
	`»tboŞ
(
C
.
	`£tho¡Çme
(s,†’ 
Ü
 #s)è
’d


130 
funùiÚ
 
S
.
	$£tdomašÇme
(
s
, 
Ën
è 
	`»tboŞ
(
C
.
	`£tdomašÇme
(s,†’ 
Ü
 #s)è
’d


132 
C
.
time
 
th’


133 
funùiÚ
 
S
.
	$time
(
time
è 
	`»Šum
(
C
.
	$time
(
time
)è
’d


134 
’d


136 
funùiÚ
 
S
.
	$sysšfo
(
šfo
)

137 
šfo
 = infØ
Ü
 
t
.
	$sysšfo
()

138 
loÿl
 
»t
, 
”r
 = 
C
.
	$sysšfo
(
šfo
)

139 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


140  
šfo


141 
’d


143 
funùiÚ
 
S
.
	`sigÇlfd
(
£t
, 
æags
, 
fd
è-- 
nÙe
 
difã»Á
 
Üd”
 
of
 
¬gs
, 
as
 fd 
usu®ly
 
em±y
. 
S“
 
®so
 
	$sigÇlfd_»ad
()

144 
£t
 = 
	$mkty³
(
t
.
sig£t
, 
£t
)

145 
fd
 
th’
 fd = 
	$g‘fd
(
fd
èfd = -1 
’d


146 -- 
nÙe
 
	$šşudes
 (
hidd’
è
size
 
¬gum’t


147  
	`»tfd
(
C
.
	$sigÇlfd
(
fd
, 
£t
, 
s
.
sig£t
, 
c
.
SFD
[
æags
]))

148 
’d


150 -- 
nÙe
 
th©
 
sysÿÎ
 
dÛs
  
timeout
 
»maššg
 
but
 
libc
 dÛ 
nÙ
, 
due
 
to
 
¡ªd¬d
 
´ÙÙy³
 
TODO
 
u£
 syscall

151 -- 
nÙe
 
this
 
is
 
the
 
Úly
 
difã»nû
 
w™h
 
N‘BSD
 
pŞÉs
, 
so
 
could
 
m”ge
 
them


152 
funùiÚ
 
S
.
	$µŞl
(
fds
, 
timeout
, 
£t
)

153 
timeout
 
th’
imeouˆğ
	$mkty³
(
t
.
time¥ec
, 
timeout
è
’d


154 
£t
 
th’
 s‘ = 
	$mkty³
(
t
.
sig£t
, 
£t
è
’d


155  
	`»Šum
(
C
.
	`µŞl
(
fds
.
pfd
, #fds, 
timeout
, 
£t
))

156 
’d


157 
nÙ
 
S
.
pŞl
 
th’


158 
funùiÚ
 
S
.
	$pŞl
(
fd
, 
timeout
)

159 
timeout
 
th’
imeouˆğ
	`mkty³
(
t
.
time¥ec
,imeouˆ/ 1000è
’d


160  
S
.
	$µŞl
(
fd
, 
timeout
)

161 
’d


162 
’d


163 
funùiÚ
 
S
.
	$mouÁ
(
sourû
, 
rg‘
, 
f¡y³
, 
mouÁæags
, 
d©a
)

164  
	`»tboŞ
(
C
.
	`mouÁ
(
sourû
 
Ü
 "nÚe", 
rg‘
, 
f¡y³
, 
c
.
MS
[
mouÁæags
], 
d©a
))

165 
’d


167 
funùiÚ
 
S
.
	$umouÁ
(
rg‘
, 
æags
)

168  
	`»tboŞ
(
C
.
	$umouÁ2
(
rg‘
, 
c
.
UMOUNT
[
æags
]))

169 
’d


171 
funùiÚ
 
S
.
	$´lim™
(
pid
, 
»sourû
, 
Ãw_lim™
, 
Şd_lim™
)

172 
Ãw_lim™
 
th’
‚ew_lim™ = 
	$mkty³
(
t
.
¾im™
, 
Ãw_lim™
è
’d


173 
Şd_lim™
 = old_lim™ 
Ü
 
t
.
	$¾im™
()

174 
loÿl
 
»t
, 
”r
 = 
C
.
	$´lim™64
(
pid
 
Ü
 0, 
c
.
RLIMIT
[
»sourû
], 
Ãw_lim™
, 
Şd_lim™
)

175 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


176  
Şd_lim™


177 
’d


179 
funùiÚ
 
S
.
	$•Şl_ü—‹
(
æags
)

180  
	`»tfd
(
C
.
	$•Şl_ü—‹1
(
c
.
EPOLLCREATE
[
æags
]))

181 
’d


183 
funùiÚ
 
S
.
	$•Şl_ùl
(
•fd
, 
İ
, 
fd
, 
ev’t
)

184 
	`ty³
(
ev’t
è=ğ"¡ršg" 
Ü
y³Óv’tè=ğ"numb”" 
th’
ƒv’ˆğ{
ev’ts
 =ƒv’t, 
fd
 = 
	`g‘fd
(fd)
	}
} 
’d


185 
	gev’t
 = 
	$mkty³
(
t
.
•Şl_ev’t
, 
ev’t
)

186  
	`»tboŞ
(
C
.
	`•Şl_ùl
(
	`g‘fd
(
•fd
), 
c
.
EPOLL_CTL
[
İ
], g‘fd(
fd
), 
ev’t
))

187 
’d


189 
C
.
•Şl_wa™
 
th’


190 
funùiÚ
 
S
.
	$•Şl_wa™
(
•fd
, 
ev’ts
, 
timeout
)

191 
loÿl
 
»t
, 
”r
 = 
C
.
	`•Şl_wa™
(
	`g‘fd
(
•fd
), 
ev’ts
.
•
, #ev’ts, 
timeout
 
Ü
 -1)

192  
	$»t™”
(
»t
, 
”r
, 
ev’ts
.
•
)

193 
’d


195 
funùiÚ
 
S
.
	$•Şl_wa™
(
•fd
, 
ev’ts
, 
timeout
)

196 
loÿl
 
»t
, 
”r
 = 
C
.
	`•Şl_pwa™
(
	`g‘fd
(
•fd
), 
ev’ts
.
•
, #ev’ts, 
timeout
 
Ü
 -1, 
n
)

197  
	$»t™”
(
»t
, 
”r
, 
ev’ts
.
•
)

198 
’d


199 
’d


201 
funùiÚ
 
S
.
	$•Şl_pwa™
(
•fd
, 
ev’ts
, 
timeout
, 
sigmask
)

202 
sigmask
 
th’
 sigmask = 
	$mkty³
(
t
.
sig£t
, 
sigmask
è
’d


203 
loÿl
 
»t
, 
”r
 = 
C
.
	`•Şl_pwa™
(
	`g‘fd
(
•fd
), 
ev’ts
.
•
, #ev’ts, 
timeout
 
Ü
 -1, 
sigmask
)

204  
	$»t™”
(
»t
, 
”r
, 
ev’ts
.
•
)

205 
’d


207 
funùiÚ
 
S
.
	$¥liû
(
fd_š
, 
off_š
, 
fd_out
, 
off_out
, 
Ën
, 
æags
)

208 
loÿl
 
offš
, 
offout
 = 
off_š
, 
off_out


209 
off_š
 
ªd
 
nÙ
 
ffi
.
	$i¡y³
(
t
.
off1
, 
off_š
è
th’


210 
offš
 = 
t
.
	$off1
()

211 
offš
[0] = 
off_š


212 
’d


213 
off_out
 
ªd
 
nÙ
 
ffi
.
	$i¡y³
(
t
.
off1
, 
off_out
è
th’


214 
offout
 = 
t
.
	$off1
()

215 
offout
[0] = 
off_out


216 
’d


217  
	`»Šum
(
C
.
	`¥liû
(
	`g‘fd
(
fd_š
), 
offš
, g‘fd(
fd_out
), 
offout
, 
Ën
, 
c
.
SPLICE_F
[
æags
]))

218 
’d


220 
funùiÚ
 
S
.
	$vm¥liû
(
fd
, 
iov
, 
æags
)

221 
iov
 = 
	$mkty³
(
t
.
iovecs
, 
iov
)

222  
	`»Šum
(
C
.
	`vm¥liû
(
	`g‘fd
(
fd
), 
iov
.iov, #iov, 
c
.
SPLICE_F
[
æags
]))

223 
’d


225 
funùiÚ
 
S
.
	$‹e
(
fd_š
, 
fd_out
, 
Ën
, 
æags
)

226  
	`»Šum
(
C
.
	`‹e
(
	`g‘fd
(
fd_š
), g‘fd(
fd_out
), 
Ën
, 
c
.
SPLICE_F
[
æags
]))

227 
’d


229 
funùiÚ
 
S
.
	$šÙify_š™
(
æags
è 
	`»tfd
(
C
.
	$šÙify_š™1
(
c
.
IN_INIT
[
æags
])è
’d


230 
funùiÚ
 
S
.
	$šÙify_add_w©ch
(
fd
, 
·thÇme
, 
mask
è 
	`»Šum
(
C
.
	`šÙify_add_w©ch
(
	`g‘fd
(fd),…©hÇme, 
c
.
IN
[mask])è
’d


231 
funùiÚ
 
S
.
	$šÙify_rm_w©ch
(
fd
, 
wd
è 
	`»tboŞ
(
C
.
	`šÙify_rm_w©ch
(
	`g‘fd
(fd), wd)è
’d


233 
funùiÚ
 
S
.
	$£ndfe
(
out_fd
, 
š_fd
, 
off£t
, 
couÁ
)

234 
	`ty³
(
off£t
è=ğ"numb”" 
th’


235 
off£t
 = 
t
.
	$off1
(
off£t
)

236 
’d


237  
	`»Šum
(
C
.
	`£ndfe
(
	`g‘fd
(
out_fd
), g‘fd(
š_fd
), 
off£t
, 
couÁ
))

238 
’d


240 
funùiÚ
 
S
.
	$ev’tfd
(
š™v®
, 
æags
è 
	`»tfd
(
C
.
	$ev’tfd
(
š™v®
 
Ü
 0, 
c
.
EFD
[
æags
])è
’d


242 
funùiÚ
 
S
.
	$tim”fd_ü—‹
(
şockid
, 
æags
)

243  
	`»tfd
(
C
.
	$tim”fd_ü—‹
(
c
.
CLOCK
[
şockid
], c.
TFD
[
æags
]))

244 
’d


246 
funùiÚ
 
S
.
	$tim”fd_£‰ime
(
fd
, 
æags
, 
™
, 
Şdtime
)

247 
Şdtime
 = oldtim
Ü
 
t
.
	$™im”¥ec
()

248 
loÿl
 
»t
, 
”r
 = 
C
.
	`tim”fd_£‰ime
(
	`g‘fd
(
fd
), 
c
.
TFD_TIMER
[
æags
 
Ü
 0], 
	`mkty³
(
t
.
™im”¥ec
, 
™
), 
Şdtime
)

249 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


250  
Şdtime


251 
’d


253 
funùiÚ
 
S
.
	$tim”fd_g‘time
(
fd
, 
cu¼_v®ue
)

254 
cu¼_v®ue
 = cu¼_v®u
Ü
 
t
.
	$™im”¥ec
()

255 
loÿl
 
»t
, 
”r
 = 
C
.
	`tim”fd_g‘time
(
	`g‘fd
(
fd
), 
cu¼_v®ue
)

256 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


257  
cu¼_v®ue


258 
’d


260 
funùiÚ
 
S
.
	$pivÙ_roÙ
(
Ãw_roÙ
, 
put_Şd
è 
	`»tboŞ
(
C
.
	$pivÙ_roÙ
(
Ãw_roÙ
, 
put_Şd
)è
’d


262 -- 
aio
 
funùiÚs


263 
funùiÚ
 
S
.
	$io_£tup
(
Ä_ev’ts
)

264 
loÿl
 
ùx
 = 
t
.
	$aio_cÚ‹xt1
()

265 
loÿl
 
»t
, 
”r
 = 
C
.
	$io_£tup
(
Ä_ev’ts
, 
ùx
)

266 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


267  
ùx
[0]

268 
’d


270 
funùiÚ
 
S
.
	$io_de¡roy
(
ùx
è 
	`»tboŞ
(
C
.
	$io_de¡roy
(
ùx
)è
’d


272 
funùiÚ
 
S
.
	$io_ÿnûl
(
ùx
, 
iocb
, 
»suÉ
)

273 
»suÉ
 =„esuÉ 
Ü
 
t
.
	$io_ev’t
()

274 
loÿl
 
»t
, 
”r
 = 
C
.
	$io_ÿnûl
(
ùx
, 
iocb
, 
»suÉ
)

275 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


276  
»suÉ


277 
’d


279 
funùiÚ
 
S
.
	$io_g‘ev’ts
(
ùx
, 
mš
, 
ev’ts
, 
timeout
)

280 
timeout
 
th’
imeouˆğ
	$mkty³
(
t
.
time¥ec
, 
timeout
è
’d


281 
loÿl
 
»t
, 
”r
 = 
C
.
	$io_g‘ev’ts
(
ùx
, 
mš
 
Ü
 
ev’ts
.
couÁ
,ƒv’ts.couÁ,ƒv’ts.
ev
, 
timeout
)

282  
	$»t™”
(
»t
, 
”r
, 
ev’ts
.
ev
)

283 
’d


285 -- 
iocb
 
mu¡
 
³rsi¡
 
uÁ
 
	`»Œ›ved
 (
as
 
we
 
g‘
 
poš‹r
), 
so
 
ÿÂÙ
 
be
 
·s£d
‡ 
bË
 mu¡ 
ke
 
t
.
iocb_¬¿y


286 
funùiÚ
 
S
.
	$io_subm™
(
ùx
, 
iocb
)

287  
	`»Šum
(
C
.
	$io_subm™
(
ùx
, 
iocb
.
±rs
, iocb.
Ä
))

288 
’d


290 -- 
TODO
 
´ùl
 
should
 
be
 
š
 
a
 
£³¿‹
 
fe
 
like
 
ioùl
 
	`âùl
 (
this
 
is
‡ 
Lšux
 
Úly
 
š‹rçû
)

291 -- 
m­
 
v®id
 
İtiÚs
 
¬g2


292 
loÿl
 
´ùlm­
 = {

293 [
c
.
PR
.
CAPBSET_READ
] = c.
CAP
,

294 [
c
.
PR
.
CAPBSET_DROP
] = c.
CAP
,

295 [
c
.
PR
.
SET_ENDIAN
] = c.
PR_ENDIAN
,

296 [
c
.
PR
.
SET_FPEMU
] = c.
PR_FPEMU
,

297 [
c
.
PR
.
SET_FPEXC
] = c.
PR_FP_EXC
,

298 [
c
.
PR
.
SET_PDEATHSIG
] = c.
SIG
,

299 --[
c
.
PR
.
SET_SECUREBITS
] = c.
SECBIT
, -- 
TODO
 
nÙ
 
defšed
 
y‘


300 [
c
.
PR
.
SET_TIMING
] = c.
PR_TIMING
,

301 [
c
.
PR
.
SET_TSC
] = c.
PR_TSC
,

302 [
c
.
PR
.
SET_UNALIGN
] = c.
PR_UNALIGN
,

303 [
c
.
PR
.
MCE_KILL
] = c.
PR_MCE_KILL
,

304 [
c
.
PR
.
SET_SECCOMP
] = c.
SECCOMP_MODE
,

305 [
c
.
PR
.
SET_NO_NEW_PRIVS
] = 
h
.
boŞtoc
,

306 
	}
}

308 
loÿl
 
	g´ùÌšt
 = { -- 
»tuºs
 
ª
 
š‹g”
 
dœeùly
 
TODO
 
add
 
m‘©abËs
 
to
 
£t
 
Çmes


309 [
c
.
PR
.
GET_DUMPABLE
] = 
Œue
,

310 [
c
.
PR
.
GET_KEEPCAPS
] = 
Œue
,

311 [
c
.
PR
.
CAPBSET_READ
] = 
Œue
,

312 [
c
.
PR
.
GET_TIMING
] = 
Œue
,

313 [
c
.
PR
.
GET_SECUREBITS
] = 
Œue
,

314 [
c
.
PR
.
MCE_KILL_GET
] = 
Œue
,

315 [
c
.
PR
.
GET_SECCOMP
] = 
Œue
,

316 [
c
.
PR
.
GET_NO_NEW_PRIVS
] = 
Œue
,

319 
loÿl
 
	g´ùÍšt
 = { -- 
»tuºs
 
»suÉ
 
š
 
a
 
loÿtiÚ
 
poš‹d
 
to
 
by
 
¬g2


320 [
c
.
PR
.
GET_ENDIAN
] = 
Œue
,

321 [
c
.
PR
.
GET_FPEMU
] = 
Œue
,

322 [
c
.
PR
.
GET_FPEXC
] = 
Œue
,

323 [
c
.
PR
.
GET_PDEATHSIG
] = 
Œue
,

324 [
c
.
PR
.
GET_UNALIGN
] = 
Œue
,

327 -- 
this
 
is
 
	gmessy
, 
TODO
 
ş—n
 
	gup
, 
™s
 
own
 
fe
 
£e
 
above


328 
funùiÚ
 
	gS
.
	$´ùl
(
İtiÚ
, 
¬g2
, 
¬g3
, 
¬g4
, 
¬g5
)

329 
loÿl
 
i
, 
Çme


330 
İtiÚ
 = 
c
.
PR
[option]

331 
loÿl
 
m
 = 
´ùlm­
[
İtiÚ
]

332 
m
 
th’
 
¬g2
 = m[¬g2] 
’d


333 
İtiÚ
 =ğ
c
.
PR
.
MCE_KILL
 
ªd
 
¬g2
 =ğc.
PR_MCE_KILL
.
SET
 
th’


334 
¬g3
 = 
c
.
PR_MCE_KILL_OPT
[arg3]

335 
–£if
 
´ùÍšt
[
İtiÚ
] 
th’


336 
i
 = 
t
.
	$št1
()

337 
¬g2
 = 
ffi
.
	$ÿ¡
(
t
.
ulÚg
, 
i
)

338 
–£if
 
İtiÚ
 =ğ
c
.
PR
.
GET_NAME
 
th’


339 
Çme
 = 
t
.
	$bufãr
(16)

340 
¬g2
 = 
ffi
.
	$ÿ¡
(
t
.
ulÚg
, 
Çme
)

341 
–£if
 
İtiÚ
 =ğ
c
.
PR
.
SET_NAME
 
th’


342 
	`ty³
(
¬g2
è=ğ"¡ršg" 
th’
‡rg2 = 
ffi
.
	$ÿ¡
(
t
.
ulÚg
, 
¬g2
è
’d


343 
–£if
 
İtiÚ
 =ğ
c
.
PR
.
SET_SECCOMP
 
th’


344 
¬g3
 = 
t
.
	$šŒ
(
¬g3
 
Ü
 0)

345 
’d


346 
loÿl
 
»t
 = 
C
.
	$´ùl
(
İtiÚ
, 
¬g2
 
Ü
 0, 
¬g3
 o¸0, 
¬g4
 o¸0, 
¬g5
 or 0)

347 
»t
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


348 
´ùÌšt
[
İtiÚ
] 
th’
  
»t
 
’d


349 
´ùÍšt
[
İtiÚ
] 
th’
  
i
[0] 
’d


350 
İtiÚ
 =ğ
c
.
PR
.
GET_NAME
 
th’


351 
Çme
[15] ~ğ0 
th’
  
ffi
.
	$¡ršg
(
Çme
, 16è
’d
 -- 
aùu®ly
, 15 
by‹s
 
£ems
 
to
 
be
 
lÚge¡
, 
aways
 0 
‹rmš©ed


352  
ffi
.
	$¡ršg
(
Çme
)

353 
’d


354  
Œue


355 
’d


357 
funùiÚ
 
S
.
	$sy¦og
(

, 
buf
, 
Ën
)

358 
nÙ
 
buf
 
	$ªd
 (

 =ğ2 
Ü
°=ğ3 o¸ =ğ4è
th’


359 
nÙ
 
Ën
 
th’


360 -- 
this
 
is
 
the
 
glibc
 
Çme
 th
sy¦og
 
sysÿÎ


361 
Ën
 = 
C
.
	`klogùl
(10, 
n
, 0è-- 
g‘
 
size
 
so
 
we
 
ÿn
 
®loÿ‹
 
bufãr


362 
Ën
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


363 
’d


364 
buf
 = 
t
.
	$bufãr
(
Ën
)

365 
’d


366 
loÿl
 
»t
, 
”r
 = 
C
.
	$klogùl
(

, 
buf
 
Ü
 
n
, 
Ën
 or 0)

367 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


368 

 =ğ9 
Ü
°=ğ10 
th’
  
	$tÚumb”
(
»t
è
’d


369 

 =ğ2 
Ü
°=ğ3 o¸ =ğ4 
th’
  
ffi
.
	$¡ršg
(
buf
, 
»t
è
’d


370  
Œue


371 
’d


373 
funùiÚ
 
S
.
	$adjtimex
(
a
)

374 
a
 = 
	$mkty³
(
t
.
timex
, 
a
)

375 
loÿl
 
»t
, 
”r
 = 
C
.
	$adjtimex
(
a
)

376 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


377  
t
.
	$adjtimex
(
»t
, 
a
)

378 
’d


380 
C
.
®¬m
 
th’


381 
funùiÚ
 
S
.
	$®¬m
(
s
è 
C
.
	$®¬m
(
s
è
’d


382 
’d


384 
funùiÚ
 
S
.
	$£Œeuid
(
ruid
, 
euid
è 
	`»tboŞ
(
C
.
	$£Œeuid
(
ruid
, 
euid
)è
’d


385 
funùiÚ
 
S
.
	$£Œegid
(
rgid
, 
egid
è 
	`»tboŞ
(
C
.
	$£Œegid
(
rgid
, 
egid
)è
’d


387 
funùiÚ
 
S
.
	$g‘»suid
(
ruid
, 
euid
, 
suid
)

388 
ruid
, 
euid
, 
suid
 =„uid 
Ü
 
t
.
	`uid1
(),ƒuid o¸t.uid1(), suid o¸t.
	$uid1
()

389 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘»suid
(
ruid
, 
euid
, 
suid
)

390 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


391  
Œue
, 
n
, 
ruid
[0], 
euid
[0], 
suid
[0]

392 
’d


393 
funùiÚ
 
S
.
	$g‘»sgid
(
rgid
, 
egid
, 
sgid
)

394 
rgid
, 
egid
, 
sgid
 =„gid 
Ü
 
t
.
	`gid1
(),ƒgid o¸t.gid1(), sgid o¸t.
	$gid1
()

395 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘»sgid
(
rgid
, 
egid
, 
sgid
)

396 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


397  
Œue
, 
n
, 
rgid
[0], 
egid
[0], 
sgid
[0]

398 
’d


399 
funùiÚ
 
S
.
	$£Œesuid
(
ruid
, 
euid
, 
suid
è 
	`»tboŞ
(
C
.
	$£Œesuid
(
ruid
, 
euid
, 
suid
)è
’d


400 
funùiÚ
 
S
.
	$£Œesgid
(
rgid
, 
egid
, 
sgid
è 
	`»tboŞ
(
C
.
	$£Œesgid
(
rgid
, 
egid
, 
sgid
)è
’d


402 
funùiÚ
 
S
.
	$vhªgup
(è 
	`»tboŞ
(
C
.
	$vhªgup
()è
’d


404 
funùiÚ
 
S
.
	$sw­Ú
(
·th
, 
sw­æags
è 
	`»tboŞ
(
C
.
	$sw­Ú
(
·th
, 
c
.
SWAP_FLAG
[
sw­æags
])è
’d


405 
funùiÚ
 
S
.
	$sw­off
(
·th
è 
	`»tboŞ
(
C
.
	$sw­off
(
·th
)è
’d


407 
C
.
g‘¿ndom
 
th’


408 
funùiÚ
 
S
.
	$g‘¿ndom
(
buf
, 
couÁ
, 
æags
)

409  
	`»Šum
(
C
.
	`g‘¿ndom
(
buf
, 
couÁ
 
Ü
 #buàÜ 64, 
c
.
GRND
[
æags
]))

410 
’d


411 
’d


413 
C
.
memfd_ü—‹
 
th’


414 
funùiÚ
 
S
.
	$memfd_ü—‹
(
Çme
, 
æags
è 
	`»tfd
(
C
.
	$memfd_ü—‹
(
Çme
, 
c
.
MFD
[
æags
])è
’d


415 
’d


417 -- 
ÿ·b™›s
. 
Somewh©
 
com¶ex
 
k”Ãl
 
š‹rçû
 
due
 
to
 
v”siÚšg
, 
Posix
 
»quœšg
 
m®loc
 
š
 
API
.

418 -- 
Úly
 
suµÜt
 
v”siÚ
 3, 
should
 
be
 
ok
 
»ûÁ
 
k”Ãls
, 
Ü
 
·ss
 
your
 
own
 
hdr
, 
d©a
 
š


419 -- 
to
 
d‘eù
 
ÿ·b™y
 
API
 
v”siÚ
, 
·ss
 
š
 
hdr
 
w™h
 
em±y
 v”siÚ, v”siÚ 
wl
 
be
 
£t


420 
funùiÚ
 
S
.
	`ÿpg‘
(
hdr
, 
d©a
è-- 
nÜm®ly
 
ju¡
 
Ëave
 
as
 
n
 
g‘
, 
ÿn
 
·ss
 
pid
 
š


421 
hdr
 = 
	$i¡y³
(
t
.
u£r_ÿp_h—d”
, 
hdr
è
Ü
.
	$u£r_ÿp_h—d”
(
c
.
LINUX_CAPABILITY_VERSION
[3], 
hdr
 
Ü
 0)

422 
nÙ
 
d©a
 
ªd
 
hdr
.
v”siÚ
 ~ğ0 
th’
 d©¨ğ
t
.
	$u£r_ÿp_d©a2
(è
’d


423 
loÿl
 
»t
, 
”r
 = 
C
.
	$ÿpg‘
(
hdr
, 
d©a
)

424 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


425 
nÙ
 
d©a
 
th’
  
hdr
 
’d


426  
t
.
	$ÿ·b™›s
(
hdr
, 
d©a
)

427 
’d


429 
funùiÚ
 
S
.
	$ÿp£t
(
hdr
, 
d©a
)

430 
ffi
.
	$i¡y³
(
t
.
ÿ·b™›s
, 
hdr
è
th’
 hdr, 
d©a
 = hdr:
	$hdrd©a
(è
’d


431  
	`»tboŞ
(
C
.
	$ÿp£t
(
hdr
, 
d©a
))

432 
’d


434 
funùiÚ
 
S
.
	$g‘ıu
(
ıu
, 
node
)

435 
ıu
 = cpu 
Ü
 
t
.
	$ušt1
()

436 
node
 =‚od
Ü
 
t
.
	$ušt1
()

437 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘ıu
(
ıu
, 
node
)

438 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


439  {
ıu
 = cpu[0], 
node
 =‚ode[0]
	}
}

440 
’d


442 
funùiÚ
 
	gS
.
	$sched_g‘scheduËr
(
pid
è 
	`»Šum
(
C
.
	$sched_g‘scheduËr
(
pid
 
Ü
 0)è
’d


443 
funùiÚ
 
S
.
	$sched_£tscheduËr
(
pid
, 
pŞicy
, 
·¿m
)

444 
·¿m
 = 
	$mkty³
(
t
.
sched_·¿m
, 
·¿m
 
Ü
 0)

445  
	`»tboŞ
(
C
.
	$sched_£tscheduËr
(
pid
 
Ü
 0, 
c
.
SCHED
[
pŞicy
], 
·¿m
))

446 
’d


447 
funùiÚ
 
S
.
	$sched_y›ld
(è 
	`»tboŞ
(
C
.
	$sched_y›ld
()è
’d


449 
funùiÚ
 
S
.
	`sched_g‘affš™y
(
pid
, 
mask
, 
Ën
è-- 
nÙe
†’ 
Ï¡
 
as
 
¿»ly
 
u£d
. 
AÎ
 
·¿m‘”s
 
İtiÚ®


450 
mask
 = 
	$mkty³
(
t
.
ıu_£t
, 
mask
)

451 
loÿl
 
»t
, 
”r
 = 
C
.
	$sched_g‘affš™y
(
pid
 
Ü
 0, 
Ën
 o¸
s
.
ıu_£t
, 
mask
)

452 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


453  
mask


454 
’d


456 
funùiÚ
 
S
.
	`sched_£ffš™y
(
pid
, 
mask
, 
Ën
è-- 
nÙe
†’ 
Ï¡
 
as
 
¿»ly
 
u£d


457  
	`»tboŞ
(
C
.
	`sched_£ffš™y
(
pid
 
Ü
 0, 
Ën
 o¸
s
.
ıu_£t
, 
	$mkty³
(
t
.
ıu_£t
, 
mask
)))

458 
’d


460 
funùiÚ
 
S
.
	$sched_g‘_´iÜ™y_max
(
pŞicy
è 
	`»Šum
(
C
.
	$sched_g‘_´iÜ™y_max
(
c
.
SCHED
[
pŞicy
])è
’d


461 
funùiÚ
 
S
.
	$sched_g‘_´iÜ™y_mš
(
pŞicy
è 
	`»Šum
(
C
.
	$sched_g‘_´iÜ™y_mš
(
c
.
SCHED
[
pŞicy
])è
’d


463 
funùiÚ
 
S
.
	$sched_£¬am
(
pid
, 
·¿m
)

464  
	`»tboŞ
(
C
.
	`sched_£¬am
(
pid
 
Ü
 0, 
	$mkty³
(
t
.
sched_·¿m
, 
·¿m
 
Ü
 0)))

465 
’d


466 
funùiÚ
 
S
.
	$sched_g‘·¿m
(
pid
, 
·¿m
)

467 
·¿m
 = 
	$mkty³
(
t
.
sched_·¿m
, 
·¿m
 
Ü
 0)

468 
loÿl
 
»t
, 
”r
 = 
C
.
	$sched_g‘·¿m
(
pid
 
Ü
 0, 
·¿m
)

469 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


470  
·¿m
.
sched_´iÜ™y
 -- 
Úly
 
Úe
 
u£ful
 
·¿m‘”


471 
’d


473 
funùiÚ
 
S
.
	$sched_¼_g‘_š‹rv®
(
pid
, 
ts
)

474 
ts
 = 
	$mkty³
(
t
.
time¥ec
, 
ts
)

475 
loÿl
 
»t
, 
”r
 = 
C
.
	$sched_¼_g‘_š‹rv®
(
pid
 
Ü
 0, 
ts
)

476 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


477  
ts


478 
’d


480 -- 
this
 
is
 
»comm’ded
 
way
 
to
 
size
 
bufãrs
 
x©Œ


481 
loÿl
 
funùiÚ
 
	$grow©Œbuf
(
f
, 
a
, 
b
)

482 
loÿl
 
Ën
 = 512

483 
loÿl
 
bufãr
 = 
t
.
	$bufãr
(
Ën
)

484 
loÿl
 
»t
, 
”r


485 
»³©


486 
b
 
th’


487 
»t
, 
”r
 = 
	$f
(
a
, 
b
, 
bufãr
, 
Ën
)

489 
»t
, 
”r
 = 
	$f
(
a
, 
bufãr
, 
Ën
)

490 
’d


491 
»t
 = 
	$tÚumb”
(
»t
)

492 
»t
 =ğ-1 
	`ªd
 (
”r
 
Ü
 
	`”ºo
()è~ğ
c
.
E
.
RANGE
 
th’
  
n
, 
t
.
	`”rÜ
Ó¼ o¸
	$”ºo
()è
’d


493 
»t
 =ğ-1 
th’


494 
Ën
 =†en * 2

495 
bufãr
 = 
t
.
	$bufãr
(
Ën
)

496 
’d


497 
uÁ
 
»t
 >= 0

499  
ffi
.
	$¡ršg
(
bufãr
, 
»t
)

500 
’d


502 
loÿl
 
funùiÚ
 
	$Ï‰rbuf
(
f
, 
a
)

503 
loÿl
 
s
, 
”r
 = 
	$grow©Œbuf
(
f
, 
a
)

504 
nÙ
 
s
 
th’
  
n
, 
”r
 
’d


505 
loÿl
 
b
 = 
h
.
	`¥l™
('\0', 
s
)

506 
b
[#b] = 
n
 -- 
th”e
 
is
 
a
 
Œašg
 \0 
so
 
Úe
 
exŒa


507  
b


508 
’d


510 -- 
TODO
 
NÙe
 
the£
 
should
 
be
 
š
 
N‘BSD
 
too
, 
but
 
no
 
u£ful
 
	$fesy¡em
 (
ex
 
nfs
è
has
 
x©Œ
 
suµÜt
, 
so
 
Ãv”
 
‹¡ed


511 
C
.
li¡x©Œ
 
th’


512 
funùiÚ
 
S
.
	$li¡x©Œ
(
·th
è 
	$Ï‰rbuf
(
C
.
li¡x©Œ
, 
·th
è
’d


513 
funùiÚ
 
S
.
	$Îi¡x©Œ
(
·th
è 
	$Ï‰rbuf
(
C
.
Îi¡x©Œ
, 
·th
è
’d


514 
funùiÚ
 
S
.
	$æi¡x©Œ
(
fd
è 
	`Ï‰rbuf
(
C
.
æi¡x©Œ
, 
	$g‘fd
(
fd
)è
’d


515 
’d


517 
C
.
£tx©Œ
 
th’


518 
funùiÚ
 
S
.
	$£tx©Œ
(
·th
, 
Çme
, 
v®ue
, 
æags
è 
	`»tboŞ
(
C
.
	`£tx©Œ
Õ©h,‚ame, v®ue, #v®ue, 
c
.
XATTR
[æags])è
’d


519 
funùiÚ
 
S
.
	$l£tx©Œ
(
·th
, 
Çme
, 
v®ue
, 
æags
è 
	`»tboŞ
(
C
.
	`l£tx©Œ
Õ©h,‚ame, v®ue, #v®ue, 
c
.
XATTR
[æags])è
’d


520 
funùiÚ
 
S
.
	$f£tx©Œ
(
fd
, 
Çme
, 
v®ue
, 
æags
è 
	`»tboŞ
(
C
.
	`f£tx©Œ
(
	`g‘fd
(fd),‚ame, v®ue, #v®ue, 
c
.
XATTR
[æags])è
’d


521 
’d


523 
C
.
g‘x©Œ
 
th’


524 
funùiÚ
 
S
.
	$g‘x©Œ
(
·th
, 
Çme
è 
	$grow©Œbuf
(
C
.
g‘x©Œ
, 
·th
, 
Çme
è
’d


525 
funùiÚ
 
S
.
	$lg‘x©Œ
(
·th
, 
Çme
è 
	$grow©Œbuf
(
C
.
lg‘x©Œ
, 
·th
, 
Çme
è
’d


526 
funùiÚ
 
S
.
	$fg‘x©Œ
(
fd
, 
Çme
è 
	`grow©Œbuf
(
C
.
fg‘x©Œ
, 
	`g‘fd
(fd),‚ameè
’d


527 
’d


529 
C
.
»movex©Œ
 
th’


530 
funùiÚ
 
S
.
	$»movex©Œ
(
·th
, 
Çme
è 
	`»tboŞ
(
C
.
	$»movex©Œ
(
·th
, 
Çme
)è
’d


531 
funùiÚ
 
S
.
	$Ìemovex©Œ
(
·th
, 
Çme
è 
	`»tboŞ
(
C
.
	$Ìemovex©Œ
(
·th
, 
Çme
)è
’d


532 
funùiÚ
 
S
.
	$äemovex©Œ
(
fd
, 
Çme
è 
	`»tboŞ
(
C
.
	`äemovex©Œ
(
	`g‘fd
(fd),‚ame)è
’d


533 
’d


535 -- 
h–³r
 
funùiÚ
 
to
 
£t
 
ªd
  
©Œibu‹s
 
š
 
bËs


536 -- 
TODO
 
this
 
would
 
make
 
mÜe
 
£n£
 
as
 
ty³s
?

537 -- 
TODO
 
li¡x©Œ
 
should
  
ª
 
™”©Ü
 
nÙ
 
a
 
bË
?

538 
loÿl
 
funùiÚ
 
	$x©Œ
(
li¡
, 
g‘
, 
£t
, 
»move
, 
·th
, 
t
)

539 
loÿl
 
l
, 
”r
 = 
	$li¡
(
·th
)

540 
nÙ
 
l
 
th’
  
n
, 
”r
 
’d


541 
nÙ
 
t
 
th’
 -- 
no
 
bË
, 
so
 
»ad


542 
loÿl
 
r
 = {
	}
}

543 
_
, 
Çme
 
š
 
	$aœs
(
l
) do

544 
r
[
Çme
] = 
	`g‘
(
·th
,‚ameè-- 
ignÜe
 
”rÜs


545 
’d


546  
r


547 
’d


548 -- 
wr™e


549 
_
, 
Çme
 
š
 
	$aœs
(
l
) do

550 
t
[
Çme
] 
th’


551 
	`£t
(
·th
, 
Çme
, 
t
[Çme]è-- 
ignÜe
 
”rÜs
, 
»¶aû


552 
t
[
Çme
] = 
n


554 
	$»move
(
·th
, 
Çme
)

555 
’d


556 
’d


557 
Çme
, 
v®ue
 
š
 
	$·œs
(
t
) do

558 
	`£t
(
·th
, 
Çme
, 
v®ue
è-- 
ignÜe
 
”rÜs
, 
ü—‹


559 
’d


560  
Œue


561 
’d


563 
S
.
li¡x©Œ
 
ªd
 S.
g‘x©Œ
 
th’


564 
funùiÚ
 
S
.
	$x©Œ
(
·th
, 
t
è 
	$x©Œ
(
S
.
li¡x©Œ
, S.
g‘x©Œ
, S.
£tx©Œ
, S.
»movex©Œ
, 
·th
, 
t
è
’d


565 
funùiÚ
 
S
.
	$lx©Œ
(
·th
, 
t
è 
	$x©Œ
(
S
.
Îi¡x©Œ
, S.
lg‘x©Œ
, S.
l£tx©Œ
, S.
Ìemovex©Œ
, 
·th
, 
t
è
’d


566 
funùiÚ
 
S
.
	$fx©Œ
(
fd
, 
t
è 
	$x©Œ
(
S
.
æi¡x©Œ
, S.
fg‘x©Œ
, S.
f£tx©Œ
, S.
äemovex©Œ
, 
fd
, 
t
è
’d


567 
’d


569 -- 
POSIX
 
mes§ge
 
queues
. 
NÙe
 
th”e
 
is
 
no
 
mq_şo£
 
as
 
™
 i 
ju¡
 
şo£
 
š
 
Lšux


570 
funùiÚ
 
S
.
	$mq_İ’
(
Çme
, 
æags
, 
mode
, 
©Œ
)

571 
loÿl
 
»t
, 
”r
 = 
C
.
	`mq_İ’
(
Çme
, 
c
.
O
[
æags
], c.
MODE
[
mode
], 
	$mkty³
(
t
.
mq_©Œ
, 
©Œ
))

572 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


573  
t
.
	$mqd
(
»t
)

574 
’d


576 
funùiÚ
 
S
.
	$mq_uÆšk
(
Çme
)

577  
	`»tboŞ
(
C
.
	$mq_uÆšk
(
Çme
))

578 
’d


580 
funùiÚ
 
S
.
	`mq_g‘£‰r
(
mqd
, 
Ãw
, 
Şd
è-- 
´ovided
 
com¶‘’ess
, 
but
 
u£
 
g‘©Œ
, 
£‰r
 
which
 
¬e
 
m‘hods


581  
	`»tboŞ
(
C
.
	`mq_g‘£‰r
(
	`g‘fd
(
mqd
), 
Ãw
, 
Şd
))

582 
’d


584 
funùiÚ
 
S
.
	$mq_timed£nd
(
mqd
, 
msg_±r
, 
msg_Ën
, 
msg_´io
, 
abs_timeout
)

585 
abs_timeout
 
th’
‡bs_timeouˆğ
	$mkty³
(
t
.
time¥ec
, 
abs_timeout
è
’d


586  
	`»tboŞ
(
C
.
	`mq_timed£nd
(
	`g‘fd
(
mqd
), 
msg_±r
, 
msg_Ën
 
Ü
 #msg_±r, 
msg_´io
 o¸0, 
abs_timeout
))

587 
’d


589 -- 
like
 
»ad
,  
¡ršg
 
bufãr
 
nÙ
 
´ovided
. 
L’gth
 
»quœed
. 
TODO
 
should
 
we
  
´io
?

590 
funùiÚ
 
S
.
	$mq_timed»ûive
(
mqd
, 
msg_±r
, 
msg_Ën
, 
msg_´io
, 
abs_timeout
)

591 
abs_timeout
 
th’
‡bs_timeouˆğ
	$mkty³
(
t
.
time¥ec
, 
abs_timeout
è
’d


592 
msg_±r
 
th’
  
	`»tboŞ
(
C
.
	`mq_timed»ûive
(
	`g‘fd
(
mqd
), msg_±r, 
msg_Ën
 
Ü
 #msg_±r, 
msg_´io
, 
abs_timeout
)è
’d


593 
msg_±r
 = 
t
.
	$bufãr
(
msg_Ën
)

594 
loÿl
 
»t
, 
”r
 = 
C
.
	`mq_timed»ûive
(
	`g‘fd
(
mqd
), 
msg_±r
, 
msg_Ën
 
Ü
 #msg_±r, 
msg_´io
, 
abs_timeout
)

595 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


596  
ffi
.
	$¡ršg
(
msg_±r
,
»t
)

597 
’d


599 -- 
±y
 
funùiÚs
 
wh”e
 
nÙ
 
š
 
commÚ
 
code
 
TODO
 
move
 
to
 
lšux
/
libc
?

600 
funùiÚ
 
S
.
	$g¿Á±
(
fd
è 
Œue
 
’d
 -- 
Lšux
 
dÛs
 
nÙ
 
Ãed
 
to
 dØ
ªythšg
 
	$h”e
 (
Mu¦
 
dÛs
 
nÙ
)

601 
funùiÚ
 
S
.
	$uÆock±
(
fd
è 
S
.
	`ioùl
(fd, "TIOCSPTLCK", 0è
’d


602 
funùiÚ
 
S
.
	$±¢ame
(
fd
)

603 
loÿl
 
±s
, 
”r
 = 
S
.
	`ioùl
(
fd
, "TIOCGPTN")

604 
nÙ
 
±s
 
th’
  
n
, 
”r
 
’d


605  "/dev/±s/" .. 
	$to¡ršg
(
±s
)

606 
’d


607 
funùiÚ
 
S
.
	$tcg‘©Œ
(
fd
è 
S
.
	`ioùl
(fd, "TCGETS"è
’d


608 
loÿl
 
tc£ts
 = {

609 [
c
.
TCSA
.
NOW
] = "TCSETS",

610 [
c
.
TCSA
.
DRAIN
] = "TCSETSW",

611 [
c
.
TCSA
.
FLUSH
] = "TCSETSF",

612 
	}
}

613 
funùiÚ
 
	gS
.
	$tc£‰r
(
fd
, 
İtiÚ®_aùiÚs
, 
tio
)

614 
loÿl
 
šc
 = 
c
.
TCSA
[
İtiÚ®_aùiÚs
]

615  
S
.
	$ioùl
(
fd
, 
tc£ts
[
šc
], 
tio
)

616 
’d


617 
funùiÚ
 
S
.
	$tc£ndb»ak
(
fd
, 
du¿tiÚ
)

618  
S
.
	`ioùl
(
fd
, "TCSBRK", 
±
.(0)è-- 
Lšux
 
ignÜes
 
du¿tiÚ


619 
’d


620 
funùiÚ
 
S
.
	$tcd¿š
(
fd
)

621  
S
.
	`ioùl
(
fd
, "TCSBRK", 
±
.(1)è-- 
nÙe
 
u£
 
of
 
l™”®
 1 
ÿ¡
 
to
 
poš‹r


622 
’d


623 
funùiÚ
 
S
.
	$tcæush
(
fd
, 
queue_£ËùÜ
)

624  
S
.
	`ioùl
(
fd
, "TCFLSH", 
±
.(
c
.
TCFLUSH
[
queue_£ËùÜ
]))

625 
’d


626 
funùiÚ
 
S
.
	$tcæow
(
fd
, 
aùiÚ
)

627  
S
.
	`ioùl
(
fd
, "TCXONC", 
±
.(
c
.
TCFLOW
[
aùiÚ
]))

628 
’d


630 -- 
com·t
 
code
 
¡uff
 
th©
 
is
 
nÙ
 
aùu®ly
 
a
 
sysÿÎ
 
und”
 
Lšux


632 -- 
Şd
 
¾im™
 
funùiÚs
 
š
 
Lšux
 
¬e
 32 
b™
 
Úly
 
so
 
now
 
defšed
 
usšg
 
´lim™


633 
funùiÚ
 
S
.
	$g‘¾im™
(
»sourû
)

634  
S
.
	$´lim™
(0, 
»sourû
)

635 
’d


637 
funùiÚ
 
S
.
	$£Œlim™
(
»sourû
, 
¾im
)

638 
loÿl
 
»t
, 
”r
 = 
S
.
	$´lim™
(0, 
»sourû
, 
¾im
)

639 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


640  
Œue


641 
’d


643 
funùiÚ
 
S
.
	$g‘ho¡Çme
()

644 
loÿl
 
u
, 
”r
 = 
S
.
	$uÇme
()

645 
nÙ
 
u
 
th’
  
n
, 
”r
 
’d


646  
u
.
nod’ame


647 
’d


649 
funùiÚ
 
S
.
	$g‘domašÇme
()

650 
loÿl
 
u
, 
”r
 = 
S
.
	$uÇme
()

651 
nÙ
 
u
 
th’
  
n
, 
”r
 
’d


652  
u
.
domašÇme


653 
’d


655 
funùiÚ
 
S
.
	$kÍg
(
pg½
, 
sig
è 
S
.
	`kl
(-pg½, sigè
’d


657 -- 
h–³r
 
funùiÚ
 
to
 
»ad
 
šÙify
 
¡ruùs
 
as
 
bË
 
äom
 inÙify 
fd
, 
TODO
 
could
 
be
 
š
 
ut


658 
funùiÚ
 
S
.
	$šÙify_»ad
(
fd
, 
bufãr
, 
Ën
)

659 
Ën
 =†’ 
Ü
 1024

660 
bufãr
 = bufã¸
Ü
 
t
.
	$bufãr
(
Ën
)

661 
loÿl
 
»t
, 
”r
 = 
S
.
	$»ad
(
fd
, 
bufãr
, 
Ën
)

662 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


663  
t
.
	$šÙify_ev’ts
(
bufãr
, 
»t
)

664 
’d


666 -- 
š
 
Lšux
 
mkfifo
 
is
 
nÙ
 
a
 
sysÿÎ
, 
emuÏ‹


667 
funùiÚ
 
S
.
	$mkfifo
(
·th
, 
mode
è 
S
.
	`mknod
Õ©h, 
b™
.
	$bÜ
(
c
.
MODE
[
mode
], c.
S_I
.
FIFO
)è
’d


668 
funùiÚ
 
S
.
	$mkfifßt
(
fd
, 
·th
, 
mode
è 
S
.
	`mknod©
(fd,…©h, 
b™
.
	`bÜ
(
c
.
MODE
[mode], c.
S_I
.
FIFO
), 0è
’d


670 -- 
š
 
Lšux
 
g‘·gesize
 
is
 
nÙ
 
a
 
sysÿÎ
 
mo¡
 
¬ch™eùu»s
.

671 -- 
It
 
is
 
´‘ty
 
obscu»
 
how
 
you
 
g‘
 
the
 
·ge
 
size
 
¬ch™eùu»s
 
th©
 
have
 
v¬ŸbË
…agsize, 
I
 
thšk
 
™
 i 
coded
 
što
 
libc


672 -- 
th©
 
m©ches
 
k”Ãl
. 
Which
 
is
 
nÙ
 
much
 
u£
 
us
.

673 -- 
fÜtuÇ‹ly
 
	$Lšux
 (
uÆike
 
BSD
è
checks
 
cÜ»ù
 
off£ts
 
Ú
 
m­pšg
 /
dev
/
z”o


674 
loÿl
 
·gesize
 -- 
¡Üe
 
so
 
we
 dØ
nÙ
 
»³©
 
this


676 
nÙ
 
S
.
g‘·gesize
 
th’


677 
funùiÚ
 
S
.
	$g‘·gesize
()

678 
·gesize
 
th’
 …agesiz
’d


679 
loÿl
 
sz
 = 4096

680 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
("/dev/zero", "rdwr")

681 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


682 
sz
 < 4096 * 1024 + 1024 do

683 
loÿl
 
mm
, 
”r
 = 
S
.
	`mm­
(
n
, 
sz
, "»ad", "sh¬ed", 
fd
, sz)

684 
mm
 
th’


685 
S
.
	$munm­
(
mm
, 
sz
)

686 
·gesize
 = 
sz


687  
sz


688 
’d


689 
sz
 = sz * 2

690 
’d


691 
’d


692 
’d


694 -- 
š
 
Lšux
 
shm_İ’
 
ªd
 
shm_uÆšk
 
¬e
 
nÙ
 
sysÿÎs


695 
loÿl
 
shm
 = "/dev/shm"

697 
funùiÚ
 
S
.
	$shm_İ’
(
·thÇme
, 
æags
, 
mode
)

698 
·thÇme
:
	`sub
(1, 1è~ğ"/" 
th’
…©hÇmğ"/" ..…©hÇm
’d


699 
·thÇme
 = 
shm
 ..…athname

700  
S
.
	`İ’
(
·thÇme
, 
c
.
	`O
(
æags
, "nofŞlow", "şÛxec", "nÚblock"), 
mode
)

701 
’d


703 
funùiÚ
 
S
.
	$shm_uÆšk
(
·thÇme
)

704 
·thÇme
:
	`sub
(1, 1è~ğ"/" 
th’
…©hÇmğ"/" ..…©hÇm
’d


705 
·thÇme
 = 
shm
 ..…athname

706  
S
.
	$uÆšk
(
·thÇme
)

707 
’d


709 -- 
TODO
 
£g½
 
ªd
 
sim¬
 - 
£e
 
the
 
mª
 
·ge


711 -- 
š
 
Lšux
 
·thcÚf
 
ÿn
 
ju¡
  
cÚ¡ªts


713 -- 
TODO
 
the£
 
could
 
go
 
što
 
cÚ¡ªts
, 
®though
 
maybe
 
b‘‹r
 
to
 
g‘
 
äom
 
h”e


714 
loÿl
 
PAGE_SIZE
 = 
S
.
g‘·gesize


715 
loÿl
 
NAME_MAX
 = 255

716 
loÿl
 
PATH_MAX
 = 4096 -- 
TODO
 
this
 
is
 
š
 
cÚ¡ªts
, 
šcÚsi¡’y


717 
loÿl
 
PIPE_BUF
 = 4096

718 
loÿl
 
FILESIZEBITS
 = 64

719 
loÿl
 
SYMLINK_MAX
 = 255

720 
loÿl
 
_POSIX_LINK_MAX
 = 8

721 
loÿl
 
_POSIX_MAX_CANON
 = 255

722 
loÿl
 
_POSIX_MAX_INPUT
 = 255

724 
loÿl
 
·thcÚf_v®ues
 = {

725 [
c
.
PC
.
LINK_MAX
] = 
_POSIX_LINK_MAX
,

726 [
c
.
PC
.
MAX_CANON
] = 
_POSIX_MAX_CANON
,

727 [
c
.
PC
.
MAX_INPUT
] = 
_POSIX_MAX_INPUT
,

728 [
c
.
PC
.
NAME_MAX
] = NAME_MAX,

729 [
c
.
PC
.
PATH_MAX
] = PATH_MAX,

730 [
c
.
PC
.
PIPE_BUF
] = PIPE_BUF,

731 [
c
.
PC
.
CHOWN_RESTRICTED
] = 1,

732 [
c
.
PC
.
NO_TRUNC
] = 1,

733 [
c
.
PC
.
VDISABLE
] = 0,

734 [
c
.
PC
.
SYNC_IO
] = 1,

735 [
c
.
PC
.
ASYNC_IO
] = -1,

736 [
c
.
PC
.
PRIO_IO
] = -1,

737 [
c
.
PC
.
SOCK_MAXBUF
] = -1,

738 [
c
.
PC
.
FILESIZEBITS
] = FILESIZEBITS,

739 [
c
.
PC
.
REC_INCR_XFER_SIZE
] = 
PAGE_SIZE
,

740 [
c
.
PC
.
REC_MAX_XFER_SIZE
] = 
PAGE_SIZE
,

741 [
c
.
PC
.
REC_MIN_XFER_SIZE
] = 
PAGE_SIZE
,

742 [
c
.
PC
.
REC_XFER_ALIGN
] = 
PAGE_SIZE
,

743 [
c
.
PC
.
ALLOC_SIZE_MIN
] = 
PAGE_SIZE
,

744 [
c
.
PC
.
SYMLINK_MAX
] = SYMLINK_MAX,

745 [
c
.
PC
["2_SYMLINKS"]] = 1,

746 
	}
}

748 
funùiÚ
 
	gS
.
	$·thcÚf
(
_
, 
Çme
)

749 
loÿl
 
pc
 = 
·thcÚf_v®ues
[
c
.
PC
[
Çme
]]

750 
	`ty³
(
pc
è=ğ"funùiÚ" 
th’
…øğ
	$pc
(è
’d


751  
pc


752 
’d


753 
S
.
å©hcÚf
 = S.
·thcÚf


755 -- 
£‹gid
 
ªd
 
£t
 
euid
 
¬e
 
nÙ
 
sysÿÎs


756 
funùiÚ
 
S
.
	$£‹uid
(
euid
è 
S
.
	`£Œesuid
(-1,ƒuid, -1è
’d


757 
funùiÚ
 
S
.
	$£‹gid
(
egid
è 
S
.
	`£Œesgid
(-1,ƒgid, -1è
’d


759 -- 
š
 
Lšux
 
sysùl
 
is
 
nÙ
 
a
 
syÿÎ
 
ªy
 
	`mÜe
 (
w–l
 
™
 i 
but
 
Ëgacy
)

760 -- 
nÙe
 
cu¼’y
 
®l
 
»tuºed
 
as
 
¡ršgs
, 
may
 
wªt
 
to
 
li¡
 
which
 
should
 
be
 
numb”s


761 
funùiÚ
 
S
.
	$sysùl
(
Çme
, 
Ãw
)

762 
Çme
 = "/´oc/sys/" ..‚ame:
	`gsub
("%.", "/")

763 
loÿl
 
æag
 = 
c
.
O
.
RDONLY


764 
Ãw
 
th’
 
æag
 = 
c
.
O
.
RDWR
 
’d


765 
loÿl
 
fd
, 
”r
 = 
S
.
	$İ’
(
Çme
, 
æag
)

766 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


767 
loÿl
 
Ën
 = 1024

768 
loÿl
 
Şd
, 
”r
 = 
S
.
	$»ad
(
fd
, 
n
, 
Ën
)

769 
nÙ
 
Şd
 
th’
  
n
, 
”r
 
’d


770 
Şd
 = old:
	`sub
(1, #Şd - 1è-- 
»move
 
Œašg
 
Ãwlše


771 
nÙ
 
Ãw
 
th’
  
Şd
 
’d


772 
loÿl
 
ok
, 
”r
 = 
S
.
	$wr™e
(
fd
, 
Ãw
)

773 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


774  
Şd


775 
’d


777 -- 
BPF
 
sysÿÎ
 
has
 
a
 
com¶ex
 
£mªtics
 
w™h
 
Úe
 
£rvšg
 
®l
 
pu½o£s


778 -- 
The
 
š‹rçû
 
expÜts
 
bÙh
 
¿w
 
sysÿÎ
 
ªd
 
h–³r
 
funùiÚs
 
ba£d
 
Ú
 
libbpf


779 
C
.
bpf
 
th’


780 
loÿl
 
funùiÚ
 
	$±r_to_u64
(
p
è 
ffi
.
	`ÿ¡
('ušt64_t', ffi.ÿ¡('void *',…)è
’d


781 
funùiÚ
 
S
.
	$bpf
(
cmd
, 
©Œ
)

782  
C
.
	$bpf
(
cmd
, 
©Œ
)

783 
’d


784 
funùiÚ
 
S
.
	$bpf_´og_lßd
(
ty³
, 
š¢s
, 
Ën
, 
liûn£
, 
v”siÚ
, 
log_Ëv–
)

785 
nÙ
 
liûn£
 
th’
†iûn£ = "GPL" 
’d
 -- 
Mu¡
 
¡ay
 
®ive
 
duršg
 
the
 
sysÿÎ


786 
loÿl
 
bpf_log_buf
 = 
ffi
.
	`Ãw
('ch¬ [?]', 64*1024è-- 
Mu¡
 
¡ay
 
®ive
 
duršg
 
the
 
sysÿÎ


787 
nÙ
 
v”siÚ
 
th’


788 -- 
We
 
have
 
no
 
b‘‹r
 
way
 
to
 
exŒaù
 
cu¼’t
 
k”Ãl
 
hex
-
¡ršg
 
Ùh”


789 -- 
thª
 
·rsšg
 
h—d”s
, 
compšg
 
a
 
h–³r
 
funùiÚ
 
Ü
 
»adšg
 /
´oc


790 
loÿl
 
v”_¡r
, 
couÁ
 = 
S
.
	`sysùl
('k”Ãl.o¤–—£'):
	`m©ch
('%d+.%d+.%d+'), 2

791 
v”siÚ
 = 0

792 
i
 
š
 
v”_¡r
:
	`gm©ch
('%d+'èdØ-- 
CÚv”t
 'X.Y.Z' 
to
 0xXX
YYZZ


793 
v”siÚ
 = 
b™
.
	`bÜ
(v”siÚ, b™.
	`lshiá
(
	`tÚumb”
(
i
), 8*
couÁ
))

794 
couÁ
 = count - 1

795 
’d


796 
’d


797 
loÿl
 
©Œ
 = 
t
.
	$bpf_©Œ1
()

798 
©Œ
[0].
´og_ty³
 = 
ty³


799 
©Œ
[0].
š¢s
 = 
	$±r_to_u64
(
š¢s
)

800 
©Œ
[0].
š¢_út
 = 
Ën


801 
©Œ
[0].
liûn£
 = 
	$±r_to_u64
(
liûn£
)

802 
©Œ
[0].
log_buf
 = 
	$±r_to_u64
(
bpf_log_buf
)

803 
©Œ
[0].
log_size
 = 
ffi
.(
bpf_log_buf
)

804 
©Œ
[0].
log_Ëv–
 =†og_Ëv– 
Ü
 1

805 
©Œ
[0].
k”n_v”siÚ
 = 
v”siÚ
 -- 
MUST
 
m©ch
 
cu¼’t
 
k”Ãl
 version

806 
loÿl
 
fd
 = 
S
.
	$bpf
(
c
.
BPF_CMD
.
PROG_LOAD
, 
©Œ
)

807 
fd
 < 0 
th’


808  
n
, 
t
.
	`”rÜ
(
	`”ºo
()), 
ffi
.
	$¡ršg
(
bpf_log_buf
)

809 
’d


810  
	`»tfd
(
fd
), 
ffi
.
	$¡ršg
(
bpf_log_buf
)

811 
’d


812 
funùiÚ
 
S
.
	$bpf_m­_ü—‹
(
ty³
, 
key_size
, 
v®ue_size
, 
max_’Œ›s
)

813 
loÿl
 
©Œ
 = 
t
.
	$bpf_©Œ1
()

814 
©Œ
[0].
m­_ty³
 = 
ty³


815 
©Œ
[0].
key_size
 = key_size

816 
©Œ
[0].
v®ue_size
 = value_size

817 
©Œ
[0].
max_’Œ›s
 = max_entries

818 
loÿl
 
fd
 = 
S
.
	$bpf
(
c
.
BPF_CMD
.
MAP_CREATE
, 
©Œ
)

819 
fd
 < 0 
th’


820  
n
, 
t
.
	`”rÜ
(
	$”ºo
())

821 
’d


822  
	$»tfd
(
fd
)

823 
’d


824 
funùiÚ
 
S
.
	$bpf_m­_İ
(
İ
, 
fd
, 
key
, 
v®_Ü_Ãxt
, 
æags
)

825 
loÿl
 
©Œ
 = 
t
.
	$bpf_©Œ1
()

826 
©Œ
[0].
m­_fd
 = 
fd


827 
©Œ
[0].
key
 = 
	$±r_to_u64
(
key
)

828 
©Œ
[0].
v®ue
 = 
	$±r_to_u64
(
v®_Ü_Ãxt
)

829 
©Œ
[0].
æags
 = fÏg 
Ü
 0

830 
loÿl
 
»t
 = 
S
.
	$bpf
(
İ
, 
©Œ
)

831 
»t
 ~ğ0 
th’


832  
n
, 
t
.
	`”rÜ
(
	$”ºo
())

833 
’d


834  
»t


835 
’d


836 
’d


838 -- 
Lšux
 
³rfÜmªû
 
mÚ™Üšg


839 
C
.
³rf_ev’t_İ’
 
th’


840 -- 
O³n
 
³rf
 
ev’t
 
fd


841 -- @
nÙe
 
£e
 
mª
 2 
³rf_ev’t_İ’


842 -- @ 
fd
, 
”r


843 
funùiÚ
 
S
.
	$³rf_ev’t_İ’
(
©Œ
, 
pid
, 
ıu
, 
group_fd
, 
æags
)

844 
©Œ
[0].
size
 =ğ0 
th’
‡‰r[0].sizğ
ffi
.×‰r[0]è
’d


845 
loÿl
 
fd
 = 
C
.
	`³rf_ev’t_İ’
(
©Œ
, 
pid
 
Ü
 0, 
ıu
 o¸-1, 
group_fd
 o¸-1, 
c
.
PERF_FLAG
[
æags
 or 0])

846 
fd
 < 0 
th’


847  
n
, 
t
.
	`”rÜ
(
	$”ºo
())

848 
’d


849  
	$»tfd
(
fd
)

850 
’d


851 -- 
R—d
 
the
 
Œaûpošt
 
	`cÚfigu¿tiÚ
 (
£e
 "/sys/kernel/debug/tracing/available_events")

852 -- @
·¿m
 
ev’t_·th
 
·th
 
to
 
	`Œaûpošt
 (
e
.
g
. "/sys/kernel/debug/tracing/events/syscalls/sys_enter_write")

853 -- @ 

, 
	$”r
 (
e
.
g
. 538, 
n
)

854 
funùiÚ
 
S
.
	$³rf_Œaûpošt
(
ev’t_·th
)

855 
loÿl
 
cÚfig
 = 
n


856 
ev’t_·th
 =ƒvent_path.."/id"

857 
loÿl
 
fd
, 
”r
 = 
S
.
	$İ’
(
ev’t_·th
, 
c
.
O
.
RDONLY
)

858 
fd
 
th’


859 
loÿl
 
»t
, 
”r
 = 
fd
:
	$»ad
(
n
, 256)

860 
»t
 
th’


861 
cÚfig
 = 
	$tÚumb”
(
»t
)

862 
’d


863 
fd
:
	$şo£
()

864 
’d


865  
cÚfig
, 
”r


866 
’d


867 -- 
A‰ach
 
Ü
 
d‘ach
 
a
 
´obe
, 
§me
 
£mªtics
 
as
 
Lua
 
bËs
.

868 -- 
S“
 
h‰ps
:

869 -- (
Wh’
 
the
 
defš™iÚ
 
is
 
nÙ
 
n
, 
™
 
wl
 
be
 
ü—‹d
, 
Ùh”wi£
 iˆwÈb
d‘ached
)

870 -- @
·¿m
 
´obe_ty³
 
e™h”
 "k´obe" 
Ü
 "u´obe", 
no
 
Ùh”
 
´obe
 
ty³s
 
¬e
 
suµÜ‹d


871 -- @
·¿m
 
Çme
 
cho£n
 
´obe
 
	`Çme
 (
e
.
g
. "myprobe")

872 -- @
·¿m
 
	$defš™iÚ
 (
£t
 
to
 
n
Ø
di§bË
 
´obe
è(
e
.
g
. "do_sys_open $retval")

873 -- @
·¿m
 
»tv®
 
Œue
/
çl£
 
this
 
should
 
be
 
’Œypošt
 
´obe
 
Ü
 …robe

874 -- @ 

, 
	$”r
 (
e
.
g
. 1099, 
n
)

875 
funùiÚ
 
S
.
	$³rf_´obe
(
´obe_ty³
, 
Çme
, 
defš™iÚ
, 
»tv®
)

876 
loÿl
 
ev’t_·th
 = 
¡ršg
.
	`fÜm©
('/sys/k”Ãl/debug/Œacšg/%s_ev’ts', 
´obe_ty³
)

877 
loÿl
 
´obe_·th
 = 
¡ršg
.
	`fÜm©
('/sys/k”Ãl/debug/Œacšg/ev’ts/%ss/%s', 
´obe_ty³
, 
Çme
)

878 -- 
Check
 
´obe
 
®»ady
 
exi¡s


879 
defš™iÚ
 
ªd
 
S
.
	$¡©fs
(
´obe_·th
è
th’
  
n
, 
t
.
	$”rÜ
(
c
.
E
.
EEXIST
è
’d


880 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
ev’t_·th
, "wronly,‡ppend")

881 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


882 -- 
FÜm©
 
a
 
´obe
 
defš™iÚ


883 
nÙ
 
defš™iÚ
 
th’


884 
defš™iÚ
 = "-:"..
Çme
 -- 
D‘ach


886 
defš™iÚ
 = 
¡ršg
.
	`fÜm©
("%s:% %s", 
»tv®
 
ªd
 "r" 
Ü
 "p", 
Çme
, definition)

887 
’d


888 
loÿl
 
ok
, 
”r
 = 
fd
:
	$wr™e
(
defš™iÚ
)

889 
fd
:
	`şo£
()

890 -- 
R‘uº
 
Œaûpošt
 
Ü
 
sucûss


891 
ok
 
ªd
 
defš™iÚ
 
th’


892  
S
.
	$³rf_Œaûpošt
(
´obe_·th
)

893 
’d


894  
ok
, 
”r


895 
’d


896 -- 
A‰ach
 
³rf
 
ev’t
 
»ad”
 
to
 
	`Œaûpošt
 (
£e
 "/sys/kernel/debug/tracing/available_events")

897 -- @
·¿m
 

 
Œaûpošt
 
	`id’tif›r
 (
e
.
g
.: 538, 
u£
 `
S
.
	`³rf_Œaûpošt
()`)

898 -- @
·¿m
 
ty³
 
³rf_©Œ
.
	`§m¶e_ty³
 (: "raw")

899 -- @
·¿m
 
©Œs
 
bË
 
of
 
	`©Œibu‹s
 (
e
.
g
. {
§m¶e_ty³
="¿w, c®lchaš"
	}
}, 
	g£e
 `
	g³rf_ev’t_©Œ
`)

900 -- @ 
	g»ad”
, 
”r


901 
funùiÚ
 
	gS
.
	$³rf_©ch_Œaûpošt
(

, 
pid
, 
ıu
, 
group_fd
, 
©Œs
)

902 
loÿl
 
³
 = 
t
.
	$³rf_ev’t_©Œ1
()

903 
³
[0].
ty³
 = "tracepoint"

904 
³
[0].
cÚfig
 = 



905 
³
[0].
§m¶e_ty³
 = "raw"

906 
³
[0].
§m¶e_³riod
 = 1

907 
³
[0].
wakeup_ev’ts
 = 1

908 
©Œs
 
th’


909 
k
,
v
 
š
 
	$·œs
(
©Œs
èdØ
³
[0][
k
] = 
v
 
’d


910 
’d


911 -- 
O³n
 
³rf
 
ev’t
 
»ad”
 
w™h
 
giv’
 
·¿m‘”s


912 
loÿl
 
fd
, 
”r
 = 
S
.
	`³rf_ev’t_İ’
(
³
, 
pid
, 
ıu
, 
group_fd
, "fd_cloexec")

913 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


914  
t
.
	$³rf_»ad”
(
fd
)

915 
’d


916 
’d


918  
S


920 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/types.lua

1 -- 
Lšux
 
k”Ãl
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg


10 -- 
TODO
 
add
 
__Ën
 
to
 
m‘©abËs
 
of
 
mÜe


12 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

14 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

16 
loÿl
 
t
, 
±
, 
s
, 
ùy³s
 = 
ty³s
.t,ypes.pt,ypes.s,ypes.ctypes

18 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

21 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

23 
loÿl
 
addty³
, 
addty³_v¬
, 
addty³_â
, 
add¿w2
 = 
h
.addtype, h.addtype_var, h.addtype_fn, h.addraw2

24 
loÿl
 
±t
, 
»v™”
, 
mkty³
, 
i¡y³
, 
Ënâ
, 
Ënmt
, 
g‘fd
, 
Ãwâ


25 ğ
h
.
±t
, h.
»v™”
, h.
mkty³
, h.
i¡y³
, h.
Ënâ
, h.
Ënmt
, h.
g‘fd
, h.
Ãwâ


26 
loÿl
 
Áohl
,‚tohl, 
Áohs
, 
htÚs
 = 
h
.ntohl, h.ntohl, h.ntohs, h.htons

27 
loÿl
 
¥l™
, 
Œim
 = 
h
.split, h.trim

29 
loÿl
 
c
 = 
»quœe
 "syscall.linux.constants"

31 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


33 -- 
TODO
 
ş—nup
 
this
 (
wh©
 
should
 
´ovide
his?)

34 
loÿl
 
sigÇl_»asÚs_g’
 = {}

35 
loÿl
 
sigÇl_»asÚs
 = {}

37 
k
, 
v
 
š
 
	$·œs
(
c
.
SI
) do

38 
sigÇl_»asÚs_g’
[
v
] = 
k


39 
’d


41 
sigÇl_»asÚs
[
c
.
SIG
.
ILL
] = {
	}
}

42 
k
, 
v
 
š
 
	$·œs
(
c
.
SIGILL
) do

43 
sigÇl_»asÚs
[
c
.
SIG
.
ILL
][
v
] = 
k


44 
’d


46 
sigÇl_»asÚs
[
c
.
SIG
.
FPE
] = {
	}
}

47 
k
, 
v
 
š
 
	$·œs
(
c
.
SIGFPE
 ) do

48 
sigÇl_»asÚs
[
c
.
SIG
.
FPE
][
v
] = 
k


49 
’d


51 
sigÇl_»asÚs
[
c
.
SIG
.
SEGV
] = {
	}
}

52 
k
, 
v
 
š
 
	$·œs
(
c
.
SIGSEGV
) do

53 
sigÇl_»asÚs
[
c
.
SIG
.
SEGV
][
v
] = 
k


54 
’d


56 
sigÇl_»asÚs
[
c
.
SIG
.
BUS
] = {
	}
}

57 
k
, 
v
 
š
 
	$·œs
(
c
.
SIGBUS
) do

58 
sigÇl_»asÚs
[
c
.
SIG
.
BUS
][
v
] = 
k


59 
’d


61 
sigÇl_»asÚs
[
c
.
SIG
.
TRAP
] = {
	}
}

62 
k
, 
v
 
š
 
	$·œs
(
c
.
SIGTRAP
) do

63 
sigÇl_»asÚs
[
c
.
SIG
.
TRAP
][
v
] = 
k


64 
’d


66 
sigÇl_»asÚs
[
c
.
SIG
.
CHLD
] = {
	}
}

67 
k
, 
v
 
š
 
	$·œs
(
c
.
SIGCLD
) do

68 
sigÇl_»asÚs
[
c
.
SIG
.
CHLD
][
v
] = 
k


69 
’d


71 
sigÇl_»asÚs
[
c
.
SIG
.
POLL
] = {
	}
}

72 
k
, 
v
 
š
 
·œs
(
c
.
SIGPOLL
 
Ü
 {}) do

73 
	gsigÇl_»asÚs
[
c
.
SIG
.
POLL
][
v
] = 
k


74 
’d


76 
loÿl
 
addty³s
 = {

77 
fd£t
 = "fd_set",

78 
	gşockid
 = "clockid_t",

79 
	gsighªdËr
 = "sighandler_t",

80 
	gaio_cÚ‹xt
 = "aio_context_t",

81 
	gşockid
 = "clockid_t",

84 
loÿl
 
	gadd¡ruùs
 = {

85 
uüed
 = "struct ucred",

86 
	gsysšfo
 = "struct sysinfo",

87 
	gÆmsghdr
 = "struct‚lmsghdr",

88 
	g¹g’msg
 = "struct„tgenmsg",

89 
	gifšfomsg
 = "struct ifinfomsg",

90 
	giçddrmsg
 = "struct ifaddrmsg",

91 
	g¹©Œ
 = "struct„tattr",

92 
	g¹a_ÿchešfo
 = "struct„ta_cacheinfo",

93 
	gÆmsg”r
 = "struct‚lmsgerr",

94 
	gnda_ÿchešfo
 = "struct‚da_cacheinfo",

95 
	gndt_¡©s
 = "struct‚dt_stats",

96 
	gndtmsg
 = "struct‚dtmsg",

97 
	gndt_cÚfig
 = "struct‚dt_config",

98 
	gut¢ame
 = "struct utsname",

99 
	gfdb_’Œy
 = "struct fdb_entry",

100 
	g£ccomp_d©a
 = "struct seccomp_data",

101 
	g¹Æ_lšk_¡©s
 = "struct„tnl_link_stats",

102 
	g¡©fs
 = "struct statfs64",

103 
	giç_ÿchešfo
 = "struct ifa_cacheinfo",

104 
	gšput_ev’t
 = "struct input_event",

105 
	gšput_id
 = "struct input_id",

106 
	gšput_absšfo
 = "struct input_absinfo",

107 
	gšput_keym­_’Œy
 = "struct input_keymap_entry",

108 
	gff_»¶ay
 = "struct ff_replay",

109 
	gff_Œigg”
 = "struct ff_trigger",

110 
	gff_’v–İe
 = "struct ff_envelope",

111 
	gff_cÚ¡ªt_efãù
 = "struct ff_constant_effect",

112 
	gff_¿mp_efãù
 = "struct ff_ramp_effect",

113 
	gff_cÚd™iÚ_efãù
 = "struct ff_condition_effect",

114 
	gff_³riodic_efãù
 = "struct ff_periodic_effect",

115 
	gff_rumbË_efãù
 = "struct ff_rumble_effect",

116 
	gff_efãù
 = "struct ff_effect",

117 
	gsock_årog
 = "struct sock_fprog",

118 
	gbpf_©Œ
 = "union bpf_attr",

119 
	gu£r_ÿp_h—d”
 = "struct user_cap_header",

120 
	gu£r_ÿp_d©a
 = "struct user_cap_data",

121 
	gxt_g‘_»visiÚ
 = "struct xt_get_revision",

122 
	gvfs_ÿp_d©a
 = "struct vfs_cap_data",

123 
	gucÚ‹xt
 = "ucontext_t",

124 
	gmcÚ‹xt
 = "mcontext_t",

125 
	gtun_pi
 = "structun_pi",

126 
	gtun_f‹r
 = "structun_filter",

127 
	gvho¡_vršg_¡©e
 = "struct vhost_vring_state",

128 
	gvho¡_vršg_fe
 = "struct vhost_vring_file",

129 
	gvho¡_vršg_addr
 = "struct vhost_vring_addr",

130 
	gvho¡_memÜy_»giÚ
 = "struct vhost_memory_region",

131 
	gvho¡_memÜy
 = "struct vhost_memory",

134 
	gk
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


135 
k
, 
v
 
š
 
	$·œs
(
add¡ruùs
èdØ
	$addty³
(
ty³s
, 
k
, 
v
, 
Ënmt
è
’d


137 -- 
the£
 
Úes
 
nÙ
 
š
 
bË
 
as
‚Ù 
h–pful
 
w™h
 
v¬¬g
 
Ü
 
¬¿ys
 
TODO
 
add
 
mÜe
 
addty³
 
v¬ŸÁs


138 
t
.
šÙify_ev’t
 = 
ffi
.
	`ty³of
("struct inotify_event")

139 
±
.
šÙify_ev’t
 = 
	`±t
("¡ruù inÙify_ev’t"è-- 
¡l
 
Ãed
 
poš‹r
 
to
 
this


140 
±
.
³rf_ev’t_h—d”
 = 
	`±t
("struct…erf_event_header")

142 
t
.
aio_cÚ‹xt1
 = 
ffi
.
	`ty³of
("aio_context_t[1]")

143 
t
.
sock_årog1
 = 
ffi
.
	`ty³of
("struct sock_fprog[1]")

144 
t
.
bpf_©Œ1
 = 
ffi
.
	`ty³of
("union bpf_attr[1]")

145 
t
.
³rf_ev’t_©Œ1
 = 
ffi
.
	`ty³of
("struct…erf_event_attr[1]")

147 
t
.
u£r_ÿp_d©a2
 = 
ffi
.
	`ty³of
("struct user_cap_data[2]")

149 -- 
luaffi
 
g‘s
 
cÚfu£d
 
ÿÎ
 
ffi
.
	`ty³of
("...[?]"è
™
 
ÿÎs
 
__Ãw
 
so
 
»defše
 
as
 
funùiÚs


150 
loÿl
 
iocbs
 = 
ffi
.
	`ty³of
("struct iocb[?]")

151 
t
.
iocbs
 = 
	$funùiÚ
(
n
, ...è 
ffi
.
	$Ãw
(
iocbs
, 
n
, ...è
’d


152 
loÿl
 
sock_f‹rs
 = 
ffi
.
	`ty³of
("struct sock_filter[?]")

153 
t
.
sock_f‹rs
 = 
	$funùiÚ
(
n
, ...è 
ffi
.
	$Ãw
(
sock_f‹rs
, 
n
, ...è
’d


154 
loÿl
 
bpf_š¢s
 = 
ffi
.
	`ty³of
("struct bpf_insn_syscall[?]")

155 
t
.
bpf_š¢s
 = 
	$funùiÚ
(
n
, ...è 
ffi
.
	$Ãw
(
bpf_š¢s
, 
n
, ...è
’d


156 
loÿl
 
iocb_±rs
 = 
ffi
.
	`ty³of
("struct iocb *[?]")

157 
t
.
iocb_±rs
 = 
	$funùiÚ
(
n
, ...è 
ffi
.
	$Ãw
(
iocb_±rs
, 
n
, ...è
’d


159 -- 
ty³s
 
w™h
 
m‘©y³s


161 -- 
NÙe
 32 
b™
 
dev_t
; 
glibc
 
has
 64 b™ dev_ˆ
but
 
we
 
u£
 
sysÿÎ
 
API
 
which
 
dÛs
 
nÙ


162 
loÿl
 
funùiÚ
 
	$makedev
(
majÜ
, 
mšÜ
)

163 
	`ty³
(
majÜ
è=ğ"bË" 
th’
 majÜ, 
mšÜ
 = majÜ[1], majÜ[2] 
’d


164 
loÿl
 
dev
 = 
majÜ
 
Ü
 0

165 
mšÜ
 
th’
 
dev
 = 
b™
.
	`bÜ
(b™.
	`lshiá
(b™.
	`bªd
(mšÜ, 0xffffff00), 12), b™.bªd(mšÜ, 0xff), b™.
	$lshiá
(
majÜ
, 8)è
’d


166  
dev


167 
’d


169 
mt
.
deviû
 = {

170 
šdex
 = {

171 
majÜ
 = 
	`funùiÚ
(
dev
)

172 
loÿl
 
d
 = 
dev
.dev

173  
b™
.
	`bªd
(b™.
	`rshiá
(
d
, 8), 0x00000fff)

174 
’d
,

175 
mšÜ
 = 
	`funùiÚ
(
dev
)

176 
loÿl
 
d
 = 
dev
.dev

177  
b™
.
	`bÜ
(b™.
	`bªd
(
d
, 0x000000ff), b™.bªd(b™.
	`rshiá
(d, 12), 0x000000ff))

178 
’d
,

179 
deviû
 = 
	`funùiÚ
(
dev
è 
	`tÚumb”
(dev.devè
’d
,

181 
Ãwšdex
 = {

182 
deviû
 = 
	`funùiÚ
(
dev
, 
majÜ
, 
mšÜ
èdev.dev = 
	`makedev
(majÜ, mšÜè
’d
,

184 
__Ãw
 = 
	`funùiÚ
(

, 
majÜ
, 
mšÜ
)

185  
ffi
.
	`Ãw
(

, 
	`makedev
(
majÜ
, 
mšÜ
))

186 
’d
,

187 
	}
}

189 
addty³
(
ty³s
, "deviû", "¡ruù {dev_ˆdev;}", 
mt
.
deviû
)

191 
	gmt
.
	gsockaddr
 = {

192 
šdex
 = {

193 
çmy
 = 
funùiÚ
(
§
è sa.
§_çmy
 
’d
,

197 
addty³
(
ty³s
, "sockaddr", "¡ruù sockaddr", 
mt
.
sockaddr
)

199 -- 
ÿ¡
 
sock‘
 
add»ss
 
to
 
aùu®
 
ty³
 
ba£d
 
Ú
 
	gçmy
, 
defšed
 
Ï‹r


200 
loÿl
 
	g§m­_±
 = {}

202 
mt
.
sockaddr_¡Üage
 = {

203 
šdex
 = {

204 
çmy
 = 
funùiÚ
(
§
è sa.
ss_çmy
 
’d
,

206 
	gÃwšdex
 = {

207 
çmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gss_çmy
 = 
c
.
AF
[v] 
’d
,

209 
	g__šdex
 = 
funùiÚ
(
§
, 
k
)

210 
	gmt
.
	gsockaddr_¡Üage
.
	gšdex
[
k
] 
th’
  mt.sockaddr_¡Üage.šdex[k](
	g§
è
’d


211 
loÿl
 
	g¡
 = 
§m­_±
[
§
.
ss_çmy
]

212 
¡
 
th’


213 
loÿl
 
cs
 = 
¡
(
§
)

214  
cs
[
k
]

215 
’d


216 
”rÜ
("šv®id index " .. 
k
)

217 
’d
,

218 
	g__Ãwšdex
 = 
funùiÚ
(
§
, 
k
, 
v
)

219 
	gmt
.
	gsockaddr_¡Üage
.
	gÃwšdex
[
k
] 
th’


220 
	gmt
.
	gsockaddr_¡Üage
.
	gÃwšdex
[
k
](
	g§
, 
	gv
)

222 
’d


223 
loÿl
 
	g¡
 = 
§m­_±
[
§
.
ss_çmy
]

224 
¡
 
th’


225 
loÿl
 
cs
 = 
¡
(
§
)

226 
cs
[
k
] = 
v


228 
’d


229 
”rÜ
("šv®id index " .. 
k
)

230 
’d
,

231 
	g__Ãw
 = 
funùiÚ
(

, 
š™
)

232 
loÿl
 
	gss
 = 
ffi
.
Ãw
(

)

233 
loÿl
 
çmy


234 
š™
 
ªd
 in™.
çmy
 
th’
 famy = 
c
.
AF
[š™.çmy] 
’d


235 
loÿl
 
¡


236 
çmy
 
th’


237 
¡
 = 
§m­_±
[
çmy
]

238 
ss
.
ss_çmy
 = 
çmy


239 
š™
.
çmy
 = 
n


240 
’d


241 
¡
 
th’


242 
loÿl
 
cs
 = 
¡
(
ss
)

243 
k
, 
v
 
š
 
·œs
(
š™
) do

244 
	gcs
[
k
] = 
v


245 
’d


246 
’d


247  
ss


248 
’d
,

249 -- 
Ãtbsd
 
likes
 
to
 
£e
 
the
 
cÜ»ù
 
size
 
wh’
 
™
 
g‘s
 
a
 
	gsockaddr
; 
Lšux
 
was
 
ok
 
w™h
‡ 
lÚg”
 
Úe


250 
	g__Ën
 = 
funùiÚ
(
§
)

251 
§m­_±
[
§
.
çmy
] 
th’


252 
loÿl
 
cs
 = 
§m­_±
[
§
.
çmy
](sa)

255  
s
.
sockaddr_¡Üage


256 
’d


257 
’d
,

260 -- 
	gex³rim’t
, 
£e
 
we
 
ÿn
 
u£
 
this
 
as
 
g’”ic
 
	gty³
, 
to
 
avoid
 
	g®loÿtiÚs
.

261 
addty³
(
ty³s
, "sockaddr_¡Üage", "¡ruù sockaddr_¡Üage", 
mt
.
sockaddr_¡Üage
)

263 
	gmt
.
	gsockaddr_š
 = {

264 
šdex
 = {

265 
çmy
 = 
funùiÚ
(
§
è sa.
sš_çmy
 
’d
,

266 
	gpÜt
 = 
funùiÚ
(
§
è 
Áohs
(§.
sš_pÜt
è
’d
,

267 
	gaddr
 = 
funùiÚ
(
§
è sa.
sš_addr
 
’d
,

269 
	gÃwšdex
 = {

270 
çmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš_çmy
 = v 
’d
,

271 
	gpÜt
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš_pÜt
 = 
htÚs
(vè
’d
,

272 
	gaddr
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš_addr
 = 
mkty³
(
t
.
š_addr
, vè
	g’d
,

274 
	g__Ãw
 = 
funùiÚ
(

, 
pÜt
, 
addr
)

275 
ty³
(
pÜt
è=ğ"bË" 
th’
  
Ãwâ
(

,…Ütè
’d


276  
Ãwâ
(

, {
çmy
 = 
c
.
AF
.
INET
, 
pÜt
 =…Üt, 
addr
 =‡ddr})

277 
	g’d
,

278 
	g__Ën
 = 
funùiÚ
(

è 
s
.
sockaddr_š
 
’d
,

281 
addty³
(
ty³s
, "sockaddr_š", "¡ruù sockaddr_š", 
mt
.
sockaddr_š
)

283 
	gmt
.
	gsockaddr_š6
 = {

284 
šdex
 = {

285 
çmy
 = 
funùiÚ
(
§
è sa.
sš6_çmy
 
’d
,

286 
	gpÜt
 = 
funùiÚ
(
§
è 
Áohs
(§.
sš6_pÜt
è
’d
,

287 
	gaddr
 = 
funùiÚ
(
§
è sa.
sš6_addr
 
’d
,

289 
	gÃwšdex
 = {

290 
çmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_çmy
 = v 
’d
,

291 
	gpÜt
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_pÜt
 = 
htÚs
(vè
’d
,

292 
	gaddr
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_addr
 = 
mkty³
(
t
.
š6_addr
, vè
	g’d
,

293 
	gæowšfo
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_æowšfo
 = v 
’d
,

294 
	gscİe_id
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsš6_scİe_id
 = v 
’d
,

296 
	g__Ãw
 = 
funùiÚ
(

, 
pÜt
, 
addr
, 
æowšfo
, 
scİe_id
è-- 
»Üd”ed
 
	gš™Ÿli£rs
.

297 
ty³
(
pÜt
è=ğ"bË" 
th’
  
Ãwâ
(

,…Ütè
’d


298  
Ãwâ
(

, {
çmy
 = 
c
.
AF
.
INET6
, 
pÜt
 =…Üt, 
addr
 =‡ddr, 
æowšfo
 = flowšfo, 
scİe_id
 = scope_id})

299 
	g’d
,

300 
	g__Ën
 = 
funùiÚ
(

è 
s
.
sockaddr_š6
 
’d
,

303 
addty³
(
ty³s
, "sockaddr_š6", "¡ruù sockaddr_š6", 
mt
.
sockaddr_š6
)

305 -- 
we
 dØ
´ovide
 
this
 
dœeùly
 
	gcom·tib™y
, 
Úly
 
u£
 
¡ªd¬d
 
Çmes


306 
	gmt
.
	gsockaddr_un
 = {

307 
šdex
 = {

308 
çmy
 = 
funùiÚ
(
§
è sa.
sun_çmy
 
’d
,

309 
	g·th
 = 
funùiÚ
(
§
è 
ffi
.
¡ršg
(§.
sun_·th
è
’d
, -- 
Úly
 
v®id
 
´İ”
 
	gÇmes


311 
	gÃwšdex
 = {

312 
çmy
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gsun_çmy
 = v 
’d
,

313 
	g·th
 = 
funùiÚ
(
§
, 
v
è
	gffi
.
cİy
(§.
sun_·th
, vè
	g’d
,

315 
	g__Ãw
 = 
funùiÚ
(

, 
·th
è 
Ãwâ
Ñp, {
çmy
 = 
c
.
AF
.
UNIX
,…©h =…©h}è
	g’d
, -- 
TODO
 
acû±
 
bË
 
š™Ÿli£r


316 
	g__Ën
 = 
funùiÚ
(

è 
s
.
sockaddr_un
 
’d
, -- 
TODO
 
Ënâ
 (è
	gš¡—d


319 
addty³
(
ty³s
, "sockaddr_un", "¡ruù sockaddr_un", 
mt
.
sockaddr_un
)

321 -- 
this
 
is
 
a
 
b™
 
	godd
, 
but
 
we
 
aùu®ly
 
u£
 
Lua
 
m‘©abËs
 
	gsockaddr_un
, 
ªd
 u£ 
	gt
.
§
 
to
 
	gmuÉËx


322 -- 
basiÿÎy
 
the
 
lINUX
 
unix
 
sock‘
 
¡ruùu»
 
is
 
nÙ
 
possibË
 
to
 
š‹½»t
 
w™hout
 
	gsize
, 
but
 
dÛs
‚Ù 
have
 
size
 
š
 

323 -- 
	gÇ¡y
, 
but
 
have
 
nÙ
 
thought
 
of
 
a
 
b‘‹r
 
way
 
	gy‘
; 
could
 
make
 
ª
 
ffi
 
ty³


324 
loÿl
 
	glua_sockaddr_un_mt
 = {

325 
__šdex
 = 
funùiÚ
(
un
, 
k
)

326 
loÿl
 
	g§
 = 
un
.
addr


327 
k
 =ğ'çmy' 
th’
  
§
.
çmy
 
’d


328 
loÿl
 
Çm–’
 = 
un
.
add¾’
 - 
s
.
sun_çmy


329 
Çm–’
 > 0 
th’


330 
§
.
sun_·th
[0] =ğ0 
th’


331 
k
 =ğ'ab¡¿ù' 
th’
  
Œue
 
’d


332 
k
 =ğ'Çme' 
th’
  
ffi
.
¡ršg
(
§
.
sun_·th
, 
Çm–’
è
	g’d
 -- 
should
 
we
 
®so
 
»move
 
	gËadšg
 \0?

334 
	gk
 =ğ'Çme' 
th’
  
ffi
.
¡ršg
(
§
.
sun_·th
è
’d


335 
’d


337 
k
 =ğ'uÂamed' 
th’
  
Œue
 
’d


338 
’d


339 
’d
,

340 
	g__Ën
 = 
funùiÚ
(
un
è un.
add¾’
 
’d
,

343 
funùiÚ
 
	gt
.
	$§
(
addr
, 
add¾’
)

344 
loÿl
 
çmy
 = 
addr
.family

345 
çmy
 =ğ
c
.
AF
.
UNIX
 
th’
 -- 
we
  
Lua
 
m‘©abË
 
nÙ
 
m‘©y³
, 
as
 
Ãed
 
Ëngth
 
to
 
decode


346 
loÿl
 
§
 = 
t
.
	$sockaddr_un
()

347 
ffi
.
	$cİy
(
§
, 
addr
, 
add¾’
)

348  
	`£tm‘©abË
({
addr
 = 
§
, 
add¾’
 = 
	}
add¾’}, 
	glua_sockaddr_un_mt
)

349 
’d


350  
addr


351 
’d


353 
loÿl
 
	gÆgroupm­
 = { -- 
m­
 
äom
 
Ãšk
 
sock‘
 
ty³
 
to
 
group
 
Çmes
. 
NÙe
 
th”e
 
¬e
 
two
 
fÜms
 
of
 
Çme
 
though
, 
b™s
 
ªd
 
shiás
.

354 [
c
.
NETLINK
.
ROUTE
] = c.
RTMGRP
, -- 
Ü
 
RTNLGRP_
 
ªd
 
shiá
 
nÙ
 
mask
 
TODO
 
make
 
shiáæags
 
	gfunùiÚ


355 -- 
add
 
»¡
 
of
 
	gthe£


356 -- [
c
.
NETLINK
.
SELINUX
] = c.
SELNLGRP
,

359 
	gmt
.
	gsockaddr_Æ
 = {

360 
šdex
 = {

361 
çmy
 = 
funùiÚ
(
§
è sa.
Æ_çmy
 
’d
,

362 
	gpid
 = 
funùiÚ
(
§
è sa.
Æ_pid
 
’d
,

363 
	ggroups
 = 
funùiÚ
(
§
è sa.
Æ_groups
 
’d
,

365 
	gÃwšdex
 = {

366 
pid
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gÆ_pid
 = v 
’d
,

367 
	ggroups
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	gÆ_groups
 = v 
’d
,

369 
	g__Ãw
 = 
funùiÚ
(

, 
pid
, 
groups
, 
Æty³
)

370 
ty³
(
pid
è=ğ"bË" 
th’


371 
loÿl
 
tb
 = 
pid


372 
pid
, 
	ggroups
, 
	gÆty³
 = 
tb
.
Æ_pid
 
Ü
b.pid, 
	gtb
.
Æ_groups
 o¸tb.groups,b.
ty³


373 
’d


374 
Æty³
 
ªd
 
	gÆgroupm­
[Æty³] 
th’
 
	ggroups
 = 
Ægroupm­
[Æty³][
groups
] 
’d
 -- 
£e
 
nÙe
 
about
 
shiáæags


375  
ffi
.
Ãw
(

, {
Æ_çmy
 = 
c
.
AF
.
NETLINK
, 
Æ_pid
 = 
pid
, 
Æ_groups
 = 
groups
})

376 
	g’d
,

377 
	g__Ën
 = 
funùiÚ
(

è 
s
.
sockaddr_Æ
 
’d
,

380 
addty³
(
ty³s
, "sockaddr_Æ", "¡ruù sockaddr_Æ", 
mt
.
sockaddr_Æ
)

382 
	gmt
.
	gsockaddr_Î
 = {

383 
šdex
 = {

384 
çmy
 = 
funùiÚ
(
§
è sa.
¦l_çmy
 
’d
,

385 
	g´ÙocŞ
 = 
funùiÚ
(
§
è 
Áohs
(§.
¦l_´ÙocŞ
è
’d
,

386 
	gifšdex
 = 
funùiÚ
(
§
è sa.
¦l_ifšdex
 
’d
,

387 
	gh©y³
 = 
funùiÚ
(
§
è sa.
¦l_h©y³
 
’d
,

388 
	gpk‰y³
 = 
funùiÚ
(
§
è sa.
¦l_pk‰y³
 
’d
,

389 
	gh®’
 = 
funùiÚ
(
§
è sa.
¦l_h®’
 
’d
,

390 
	gaddr
 = 
funùiÚ
(
§
)

391 
§
.
¦l_h®’
 =ğ6 
th’
  
±
.
maÿddr
(§.
¦l_addr
è 
ffi
.
¡ršg
(§.¦l_addr, sa.¦l_h®’è
’d


392 
	g’d
,

394 
	gÃwšdex
 = {

395 
´ÙocŞ
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g¦l_´ÙocŞ
 = 
htÚs
(
c
.
ETH_P
[v]è
’d
,

396 
	gifšdex
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g¦l_ifšdex
 = v 
’d
,

397 
	gh©y³
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g¦l_h©y³
 = v 
’d
,

398 
	gpk‰y³
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g¦l_pk‰y³
 = v 
’d
,

399 
	gh®’
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g¦l_h®’
 = v 
’d
,

400 
	gaddr
 = 
funùiÚ
(
§
, 
v
)

401 
	gffi
.
i¡y³
(
t
.
maÿddr
, 
v
è
th’


402 
	g§
.
	g¦l_h®’
 = 6

403 
ffi
.
cİy
(
§
.
¦l_addr
, 
v
, 6)

404 
	g§
.
	g¦l_addr
 = 
v
 
’d


405 
’d
,

407 
	g__Ãw
 = 
funùiÚ
(

, 
tb
)

408 
loÿl
 
	g§
 = 
ffi
.
Ãw
(

, {
¦l_çmy
 = 
c
.
AF
.
PACKET
})

409 
	gk
, 
v
 
š
 
·œs
(
tb
 
Ü
 {}èdØ
	g§
[
k
] = v 
’d


410  
§


411 
’d
,

412 
	g__Ën
 = 
funùiÚ
(

è 
s
.
sockaddr_Î
 
’d
,

415 
addty³
(
ty³s
, "sockaddr_Î", "¡ruù sockaddr_Î", 
mt
.
sockaddr_Î
)

417 
	gmt
.
	g¡©
 = {

418 
šdex
 = {

419 
dev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_dev
è
’d
,

420 
	gšo
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_šo
è
’d
,

421 
	gmode
 = 
funùiÚ
(
¡
è st.
¡_mode
 
’d
,

422 
	gÆšk
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_Æšk
è
’d
,

423 
	guid
 = 
funùiÚ
(
¡
è st.
¡_uid
 
’d
,

424 
	ggid
 = 
funùiÚ
(
¡
è st.
¡_gid
 
’d
,

425 
	gsize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_size
è
’d
,

426 
	gblksize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blksize
è
’d
,

427 
	gblocks
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blocks
è
’d
,

428 
	g©ime
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_©ime
è
’d
,

429 
	gùime
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_ùime
è
’d
,

430 
	gmtime
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_mtime
è
’d
,

431 
	grdev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_rdev
è
’d
,

433 
	gty³
 = 
funùiÚ
(
¡
è 
b™
.
bªd
(¡.
¡_mode
, 
c
.
S_I
.
FMT
è
	g’d
,

434 
	gtodt
 = 
funùiÚ
(
¡
è 
b™
.
rshiá
(¡.
ty³
, 12è
	g’d
,

435 
	gi¤eg
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FREG
 
’d
,

436 
	gisdœ
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FDIR
 
’d
,

437 
	gischr
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FCHR
 
’d
,

438 
	gisblk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FBLK
 
’d
,

439 
	gisfifo
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FIFO
 
’d
,

440 
	gi¦nk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FLNK
 
’d
,

441 
	gissock
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FSOCK
 
’d
,

445 -- 
add
 
some
 
ä›ndl›r
 
Çmes
 
to
 
	g¡©
, 
®so
 
luafesy¡em
 
com·tib™y


446 
	gmt
.
	g¡©
.
	gšdex
.
	gacûss
 = 
mt
.
¡©
.
šdex
.
©ime


447 
mt
.
¡©
.
šdex
.
modifiÿtiÚ
 = mt.¡©.šdex.
mtime


448 
mt
.
¡©
.
šdex
.
chªge
 = mt.¡©.šdex.
ùime


450 
loÿl
 
Çmem­
 = {

451 
fe
 = 
mt
.
¡©
.
šdex
.
i¤eg
,

452 
	gdœeùÜy
 = 
mt
.
¡©
.
šdex
.
isdœ
,

453 
	glšk
 = 
mt
.
¡©
.
šdex
.
i¦nk
,

454 
	gsock‘
 = 
mt
.
¡©
.
šdex
.
issock
,

455 ["ch¬ deviû"] = 
mt
.
¡©
.
šdex
.
ischr
,

456 ["block deviû"] = 
mt
.
¡©
.
šdex
.
isblk
,

457 ["Çmed…e"] = 
mt
.
¡©
.
šdex
.
isfifo
,

460 
	gmt
.
	g¡©
.
	gšdex
.
	gty³Çme
 = 
	$funùiÚ
(
¡
)

461 
k
, 
v
 
š
 
	$·œs
(
Çmem­
èdØ
	$v
(
¡
è
th’
  
k
 
’d
ƒnd

463 
’d


465 
	`addty³
(
ty³s
, "¡©", "¡ruù st", 
mt
.
¡©
)

467 
loÿl
 
sigÇmes
 = {
	}
}

468 
loÿl
 
du¶iÿ‹s
 = {
IOT
 = 
Œue
, 
	gCLD
 =rue, 
	gPOLL
 =rue}

469 
	gk
, 
v
 
š
 
	$·œs
(
c
.
SIG
) do

470 
nÙ
 
du¶iÿ‹s
[
k
] 
th’
 
sigÇmes
[
v
] = k 
’d


471 
’d


473 -- 
TODO
 
this
 
is
 
brok’
, 
Ãed
 
to
 
u£
 
f›lds
 
äom
 
the
 
cÜ»ù
 
‹chniÿÎy


474 -- 
›
 
check
 
which
 
of
 
the
 
uniÚs
 
we
 
should
 
be
 
usšg
 
ªd
 
g‘
 
®l
 
f›lds
 
äom
 
th©


475 -- (
nÙe
 
as
 
³r
 
Mu¦
 
li¡
 
the
 
¡ªd¬d
 
k”Ãl
,
glibc
 
defš™iÚs
 
¬e
 
wrÚg
 
too
...)

476 
mt
.
sigšfo
 = {

477 
šdex
 = {

478 
signo
 = 
	`funùiÚ
(
s
è s.
si_signo
 
’d
,

479 
”ºo
 = 
	`funùiÚ
(
s
è s.
si_”ºo
 
’d
,

480 
code
 = 
	`funùiÚ
(
s
è s.
si_code
 
’d
,

481 
pid
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
kl
.
si_pid
 
’d
,

482 
uid
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
kl
.
si_uid
 
’d
,

483 
tim”id
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
tim”
.
si_tid
 
’d
,

484 
ov”run
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
tim”
.
si_ov”run
 
’d
,

485 
¡©us
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
sigchld
.
si_¡©us
 
’d
,

486 
utime
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
sigchld
.
si_utime
 
’d
,

487 
¡ime
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
sigchld
.
si_¡ime
 
’d
,

488 
v®ue
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
¹
.
si_sigv®
 
’d
,

489 ğ
	`funùiÚ
(
s
è s.
_sif›lds
.
¹
.
si_sigv®
.
siv®_št
 
’d
,

490 
±r
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
¹
.
si_sigv®
.
siv®_±r
 
’d
,

491 
addr
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
sigçuÉ
.
si_addr
 
’d
,

492 
bªd
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
sigpŞl
.
si_bªd
 
’d
,

493 
fd
 = 
	`funùiÚ
(
s
è s.
_sif›lds
.
sigpŞl
.
si_fd
 
’d
,

494 
sigÇme
 = 
	`funùiÚ
(
s
è 
sigÇmes
[s.
signo
] 
’d
,

496 
Ãwšdex
 = {

497 
signo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_signo
 = v 
’d
,

498 
”ºo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_”ºo
 = v 
’d
,

499 
code
 = 
	`funùiÚ
(
s
, 
v
ès.
si_code
 = v 
’d
,

500 
pid
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
kl
.
si_pid
 = v 
’d
,

501 
uid
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
kl
.
si_uid
 = v 
’d
,

502 
tim”id
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
tim”
.
si_tid
 = v 
’d
,

503 
ov”run
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
tim”
.
si_ov”run
 = v 
’d
,

504 
¡©us
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
sigchld
.
si_¡©us
 = v 
’d
,

505 
utime
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
sigchld
.
si_utime
 = v 
’d
,

506 
¡ime
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
sigchld
.
si_¡ime
 = v 
’d
,

507 
v®ue
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
¹
.
si_sigv®
 = v 
’d
,

508 ğ
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
¹
.
si_sigv®
.
siv®_št
 = v 
’d
,

509 
±r
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
¹
.
si_sigv®
.
siv®_±r
 = v 
’d
,

510 
addr
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
sigçuÉ
.
si_addr
 = v 
’d
,

511 
bªd
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
sigpŞl
.
si_bªd
 = v 
’d
,

512 
fd
 = 
	`funùiÚ
(
s
, 
v
ès.
_sif›lds
.
sigpŞl
.
si_fd
 = v 
’d
,

514 
	}
}

516 
addty³
(
ty³s
, "sigšfo", "¡ruù sigšfo", 
mt
.
sigšfo
)

518 -- 
Lšux
 
š‹º®ly
 
u£s
 
nÚ
 
¡ªd¬d
 
sigaùiÚ
 
ty³
 
k_sigaùiÚ


519 
loÿl
 
	g§_hªdËr_ty³
 = 
ffi
.
ty³of
("void (*)(int)")

520 
loÿl
 
to_hªdËr
 = 
	$funùiÚ
(
v
è 
ffi
.
	`ÿ¡
(
§_hªdËr_ty³
, 
t
.
	$ušŒ
(
v
)è
’d
 -- 
luaffi
 
Ãeds
 
ušŒ
, 
ªd
 
fuÎ
 
ÿ¡


521 
mt
.
sigaùiÚ
 = {

522 
šdex
 = {

523 
hªdËr
 = 
	`funùiÚ
(
§
è sa.
§_hªdËr
 
’d
,

524 
sigaùiÚ
 = 
	`funùiÚ
(
§
è sa.
§_hªdËr
 
’d
,

525 
mask
 = 
	`funùiÚ
(
§
è sa.
§_mask
 
’d
, -- 
TODO
 
would
 
¿th”
  
ty³
 
of
 
sig£t_t


526 
æags
 = 
	`funùiÚ
(
§
è 
	`tÚumb”
(§.
§_æags
è
’d
,

528 
Ãwšdex
 = {

529 
hªdËr
 = 
	`funùiÚ
(
§
, 
v
)

530 
	`ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
	`to_hªdËr
(
c
.
SIGACT
[v]è
’d


531 
	`ty³
(
v
è=ğ"numb”" 
th’
 v = 
	`to_hªdËr
(vè
’d


532 
§
.
§_hªdËr
 = 
v


533 
’d
,

534 
sigaùiÚ
 = 
	`funùiÚ
(
§
, 
v
)

535 
	`ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
	`to_hªdËr
(
c
.
SIGACT
[v]è
’d


536 
	`ty³
(
v
è=ğ"numb”" 
th’
 v = 
	`to_hªdËr
(vè
’d


537 
§
.
§_hªdËr
.
§_sigaùiÚ
 = 
v


538 
’d
,

539 
mask
 = 
	`funùiÚ
(
§
, 
v
)

540 
nÙ
 
ffi
.
	`i¡y³
(
t
.
sig£t
, 
v
è
th’
 v =.
	`sig£t
(vè
’d


541 
ffi
.
	`cİy
(
§
.
§_mask
, 
v
, ffi.(sa.sa_mask))

542 
’d
,

543 
æags
 = 
	`funùiÚ
(
§
, 
v
è§.
§_æags
 = 
c
.
SA
[v] 
’d
,

545 
__Ãw
 = 
	`funùiÚ
(

, 
b
)

546 
loÿl
 
§
 = 
ffi
.
	`Ãw
(

)

547 
b
 
th’
 
k
, 
v
 
š
 
	`·œs
ÑabèdØ
§
[k] = v 
’d
ƒnd

548 
b
 
ªd
ab.
sigaùiÚ
 
th’
 
§
.
§_æags
 = 
b™
.
	`bÜ
(§.
æags
, 
c
.
SA
.
SIGINFO
è
’d
 -- 
this
 
æag
 
mu¡
 
be
 
£t
 sigaction set

549  
§


550 
’d
,

551 
	}
}

553 
addty³
(
ty³s
, "sigaùiÚ", "¡ruù k_sigaùiÚ", 
mt
.
sigaùiÚ
)

555 
	gmt
.
	g¾im™
 = {

556 
šdex
 = {

557 
cur
 = 
funùiÚ
(
r
èr.
¾im_cur
 =ğ
c
.
RLIM
.
INFINITY
 
th’
  -1  
tÚumb”
Ô.¾im_curè
’d
ƒnd,

558 
	gmax
 = 
funùiÚ
(
r
èr.
¾im_max
 =ğ
c
.
RLIM
.
INFINITY
 
th’
  -1  
tÚumb”
Ô.¾im_maxè
’d
ƒnd,

560 
	gÃwšdex
 = {

561 
cur
 = 
funùiÚ
(
r
, 
v
)

562 
	gv
 =ğ-1 
th’
 
v
 = 
c
.
RLIM
.
INFINITY
 
’d


563 
r
.
¾im_cur
 = 
c
.
RLIM
[
v
] -- 
®lows
 
u£
 
of
 "infinity"

564 
’d
,

565 
	gmax
 = 
funùiÚ
(
r
, 
v
)

566 
	gv
 =ğ-1 
th’
 
v
 = 
c
.
RLIM
.
INFINITY
 
’d


567 
r
.
¾im_max
 = 
c
.
RLIM
[
v
] -- 
®lows
 
u£
 
of
 "infinity"

568 
’d
,

570 
	g__Ãw
 = 
Ãwâ
,

573 -- 
TODO
 
some
 
f›lds
 
¡l
 
missšg


574 
	gmt
.
	gsigev’t
 = {

575 
šdex
 = {

576 
nÙify
 = 
funùiÚ
(
£lf
è s–f.
sigev_nÙify
 
’d
,

577 
	gsigno
 = 
funùiÚ
(
£lf
è s–f.
sigev_signo
 
’d
,

578 
	gv®ue
 = 
funùiÚ
(
£lf
è s–f.
sigev_v®ue
 
’d
,

580 
	gÃwšdex
 = {

581 
nÙify
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_nÙify
 = 
c
.
SIGEV
[v] 
’d
,

582 
	gsigno
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_signo
 = 
c
.
SIG
[v] 
’d
,

583 
	gv®ue
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_v®ue
 = 
t
.
sigv®
(vè
’d
, --‡utØ
assigns
 
ba£d
 
Ú
 
	gty³


585 
	g__Ãw
 = 
Ãwâ
,

588 
addty³
(
ty³s
, "sigev’t", "¡ruù sigev’t", 
mt
.
sigev’t
)

590 
addty³
(
ty³s
, "¾im™", "¡ruù„lim™64", 
mt
.
¾im™
)

592 
	gmt
.
	gsigÇlfd
 = {

593 
šdex
 = {

594 
signo
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_signo
è
’d
,

595 
	gcode
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_code
è
’d
,

596 
	gpid
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_pid
è
’d
,

597 
	guid
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_uid
è
’d
,

598 
	gfd
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_fd
è
’d
,

599 
	gtid
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_tid
è
’d
,

600 
	gbªd
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_bªd
è
’d
,

601 
	gov”run
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_ov”run
è
’d
,

602 
	gŒ­no
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_Œ­no
è
’d
,

603 
	g¡©us
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_¡©us
è
’d
,

604 ğ
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_št
è
’d
,

605 
	g±r
 = 
funùiÚ
(
ss
è ss.
ssi_±r
 
’d
,

606 
	gutime
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_utime
è
’d
,

607 
	g¡ime
 = 
funùiÚ
(
ss
è 
tÚumb”
(ss.
ssi_¡ime
è
’d
,

608 
	gaddr
 = 
funùiÚ
(
ss
è ss.
ssi_addr
 
’d
,

610 
	g__šdex
 = 
funùiÚ
(
ss
, 
k
è-- 
TODO
 
sim¶ify
 
this


611 
loÿl
 
	gsig
 = 
c
.
SIG
[
k
]

612 
sig
 
th’
  
tÚumb”
(
ss
.
ssi_signo
è=ğsig 
’d


613 
loÿl
 
ºame
 = 
sigÇl_»asÚs_g’
[
ss
.
ssi_code
]

614 
nÙ
 
ºame
 
ªd
 
sigÇl_»asÚs
[
ss
.
ssi_signo
] 
th’
„ÇmğsigÇl_»asÚs[ss.ssi_signo][ss.
ssi_code
] 
’d


615 
ºame
 =ğ
k
 
th’
  
Œue
 
’d


616 
ºame
 =ğ
k
:
uµ”
(è
th’
  
Œue
 
’d
 -- 
TODO
 
u£
 
some
 
m‘©abË
 
to
 
hide
 
this
?

617 
mt
.
sigÇlfd
.
šdex
[
k
] 
th’
  mt.sigÇlfd.šdex[k](
ss
è
’d


618 
”rÜ
("šv®id index " .. 
k
)

619 
’d
,

622 
addty³
(
ty³s
, "sigÇlfd_sigšfo", "¡ruù sigÇlfd_sigšfo", 
mt
.
sigÇlfd
)

624 
	gmt
.
	gsigšfos
 = {

625 
__šdex
 = 
funùiÚ
(
ss
, 
k
)

626  
	gss
.
	gsfd
[
k
 - 1]

627 
	g’d
,

628 
	g__Ën
 = 
funùiÚ
(
p
è….
couÁ
 
’d
,

629 
	g__Ãw
 = 
funùiÚ
(

, 
ss
)

630  
	gffi
.
Ãw
(

, 
ss
, ss, s * 
s
.
sigÇlfd_sigšfo
)

631 
	g’d
,

634 
addty³_v¬
(
ty³s
, "sigšfos", "¡ruù {šˆcouÁ, by‹s; sŒuù sigÇlfd_sigšfØsfd[?];}", 
mt
.
sigšfos
)

636 -- 
TODO
 
cÚv”t
 
to
 
u£
 
	gcÚ¡ªts
? 
nÙe
 
missšg
 
some
 
maüos
 
eg
 
WCOREDUMP
(). 
AÎow
 
low”
 . 
Also
 dØ
nÙ
 
ü—‹
 
bË
 
	gdyÇmiÿÎy
.

637 
	gmt
.
	gwa™
 = {

638 
__šdex
 = 
funùiÚ
(
w
, 
k
)

639 
loÿl
 
	gWTERMSIG
 = 
b™
.
bªd
(
w
.
¡©us
, 0x7f)

640 
loÿl
 
	gEXITSTATUS
 = 
b™
.
rshiá
(b™.
bªd
(
w
.
¡©us
, 0xff00), 8)

641 
loÿl
 
	gWIFEXITED
 = (
WTERMSIG
 == 0)

642 
loÿl
 
b
 = {

643 
WIFEXITED
 = WIFEXITED,

644 
	gWIFSTOPPED
 = 
b™
.
bªd
(
w
.
¡©us
, 0xff) == 0x7f,

645 
	gWIFSIGNALED
 = 
nÙ
 
WIFEXITED
 
ªd
 
b™
.
bªd
(
w
.
¡©us
, 0x7fè~ğ0x7à-- 
I
 
thšk
 
this
 
is
 
right
????? 
TODO
 
»check
, 
	gş—nup


647 
	gb
.
WIFEXITED
 
th’
ab.
	gEXITSTATUS
 = 
EXITSTATUS
 
’d


648 
b
.
WIFSTOPPED
 
th’
ab.
WSTOPSIG
 = 
EXITSTATUS
 
’d


649 
b
.
WIFSIGNALED
 
th’
ab.
WTERMSIG
 = WTERMSIG 
’d


650 
b
[
k
] 
th’
 ab[k] 
’d


651 
loÿl
 
uc
 = 'W' .. 
k
:
uµ”
()

652 
b
[
uc
] 
th’
 ab[uc] 
’d


653 
’d


656 -- 
ÿÂÙ
 
u£
 
m‘©y³
 
as
 
ju¡
 
ª
 
š‹g”


657 
funùiÚ
 
t
.
	$wa™¡©us
(
¡©us
)

658  
	`£tm‘©abË
({
¡©us
 = 
	}
¡©us}, 
	gmt
.
	gwa™
)

659 
	g’d


661 -- 
‹rmios


663 
loÿl
 
	gb™s_to_¥“d
 = {}

664 
k
, 
v
 
š
 
	$·œs
(
c
.
B
) do

665 
b™s_to_¥“d
[
v
] = 
	$tÚumb”
(
k
)

666 
’d


668 
mt
.
‹rmios
 = {

669 
mak”aw
 = 
	`funùiÚ
(
‹rmios
)

670 
‹rmios
.
c_iæag
 = 
b™
.
	`bªd
Ñ”mios.c_iæag, b™.
	`bnÙ
(
c
.
IFLAG
["IGNBRK,BRKINT,PARMRK,ISTRIP,INLCR,IGNCR,ICRNL,IXON"]))

671 
‹rmios
.
c_oæag
 = 
b™
.
	`bªd
Ñ”mios.c_oæag, b™.
	`bnÙ
(
c
.
OFLAG
["OPOST"]))

672 
‹rmios
.
c_læag
 = 
b™
.
	`bªd
Ñ”mios.c_læag, b™.
	`bnÙ
(
c
.
LFLAG
["ECHO,ECHONL,ICANON,ISIG,IEXTEN"]))

673 
‹rmios
.
c_cæag
 = 
b™
.
	`bÜ
(b™.
	`bªd
Ñ”mios.c_cæag, b™.
	`bnÙ
(
c
.
CFLAG
["CSIZE,PARENB"])), c.CFLAG.
CS8
)

674 
‹rmios
.
c_cc
[
c
.
CC
.
VMIN
] = 1

675 
‹rmios
.
c_cc
[
c
.
CC
.
VTIME
] = 0

676  
Œue


677 
’d
,

678 
šdex
 = {

679 
iæag
 = 
	`funùiÚ
(
‹rmios
è”mios.
c_iæag
 
’d
,

680 
oæag
 = 
	`funùiÚ
(
‹rmios
è”mios.
c_oæag
 
’d
,

681 
cæag
 = 
	`funùiÚ
(
‹rmios
è”mios.
c_cæag
 
’d
,

682 
læag
 = 
	`funùiÚ
(
‹rmios
è”mios.
c_læag
 
’d
,

683 
mak”aw
 = 
	`funùiÚ
(
‹rmios
è 
mt
.‹rmios.mak”aw 
’d
,

684 
¥“d
 = 
	`funùiÚ
(
‹rmios
)

685 
loÿl
 
b™s
 = 
b™
.
	`bªd
(
‹rmios
.
c_cæag
, 
c
.
CBAUD
)

686  
b™s_to_¥“d
[
b™s
]

687 
’d
,

689 
Ãwšdex
 = {

690 
iæag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_iæag
 = 
c
.
	`IFLAG
(vè
’d
,

691 
oæag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_oæag
 = 
c
.
	`OFLAG
(vè
’d
,

692 
cæag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_cæag
 = 
c
.
	`CFLAG
(vè
’d
,

693 
læag
 = 
	`funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_læag
 = 
c
.
	`LFLAG
(vè
’d
,

694 
¥“d
 = 
	`funùiÚ
(
‹rmios
, speed)

695 
loÿl
 
¥“d
 = 
c
.
B
[speed]

696 
‹rmios
.
c_cæag
 = 
b™
.
	`bÜ
(b™.
	`bªd
Ñ”mios.c_cæag, b™.
	`bnÙ
(
c
.
CBAUD
)), 
¥“d
)

697 
’d
,

699 
	}
}

701 
	gmt
.
	g‹rmios
.
	gšdex
.
	go¥“d
 = 
mt
.
‹rmios
.
šdex
.
¥“d


702 
mt
.
‹rmios
.
šdex
.
i¥“d
 = mt.‹rmios.šdex.
¥“d


703 
mt
.
‹rmios
.
Ãwšdex
.
o¥“d
 = mt.‹rmios.Ãwšdex.
¥“d


704 
mt
.
‹rmios
.
Ãwšdex
.
i¥“d
 = mt.‹rmios.Ãwšdex.
¥“d


706 
k
, 
i
 
š
 
	$·œs
(
c
.
CC
) do

707 
mt
.
‹rmios
.
šdex
[
k
] = 
	$funùiÚ
(
‹rmios
è”mios.
c_cc
[
i
] 
’d


708 
mt
.
‹rmios
.
Ãwšdex
[
k
] = 
	$funùiÚ
(
‹rmios
, 
v
è‹rmios.
c_cc
[
i
] = v 
’d


709 
’d


711 
	`addty³
(
ty³s
, "‹rmios", "¡ruù”mios", 
mt
.
‹rmios
)

712 
	`addty³
(
ty³s
, "‹rmios2", "¡ruù”mios2", 
mt
.
‹rmios
)

714 
mt
.
iocb
 = {

715 
šdex
 = {

716 
İcode
 = 
	`funùiÚ
(
iocb
è iocb.
aio_lio_İcode
 
’d
,

717 
d©a
 = 
	`funùiÚ
(
iocb
è 
	`tÚumb”
(iocb.
aio_d©a
è
’d
,

718 
»q´io
 = 
	`funùiÚ
(
iocb
è iocb.
aio_»q´io
 
’d
,

719 
fdes
 = 
	`funùiÚ
(
iocb
è iocb.
aio_fdes
 
’d
, -- dØ
nÙ
 
cÚv”t
 
to
 
fd
 
as
 
wl
 
®»ady
 
be
 
İ’
, 
dÚ
't wanto gc

720 
buf
 = 
	`funùiÚ
(
iocb
è iocb.
aio_buf
 
’d
,

721 
nby‹s
 = 
	`funùiÚ
(
iocb
è 
	`tÚumb”
(iocb.
aio_nby‹s
è
’d
,

722 
off£t
 = 
	`funùiÚ
(
iocb
è 
	`tÚumb”
(iocb.
aio_off£t
è
’d
,

723 
»sfd
 = 
	`funùiÚ
(
iocb
è iocb.
aio_»sfd
 
’d
,

724 
æags
 = 
	`funùiÚ
(
iocb
è iocb.
aio_æags
 
’d
,

726 
Ãwšdex
 = {

727 
İcode
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_lio_İcode
 = 
c
.
IOCB_CMD
[v] 
’d
,

728 
d©a
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_d©a
 = v 
’d
,

729 
»q´io
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_»q´io
 = v 
’d
,

730 
fdes
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_fdes
 = 
	`g‘fd
(vè
’d
,

731 
buf
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_buf
 = 
ffi
.
	`ÿ¡
(
t
.
št64
, 
±
.(v)è
’d
,

732 
nby‹s
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_nby‹s
 = v 
’d
,

733 
off£t
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_off£t
 = v 
’d
,

734 
æags
 = 
	`funùiÚ
(
iocb
, 
v
èiocb.
aio_æags
 = 
c
.
IOCB_FLAG
[v] 
’d
,

735 
»sfd
 = 
	`funùiÚ
(
iocb
, 
v
)

736 
iocb
.
aio_æags
 = 
b™
.
	`bÜ
(iocb.aio_æags, 
c
.
IOCB_FLAG
.
RESFD
)

737 
iocb
.
aio_»sfd
 = 
	`g‘fd
(
v
)

738 
’d
,

740 
__Ãw
 = 
Ãwâ
,

741 
	}
}

743 
addty³
(
ty³s
, "iocb", "¡ruù iocb", 
mt
.
iocb
)

745 -- 
aio
 
İ”©iÚs
 
wªt
 
ª
 
¬¿y
 
of
 
poš‹rs
 
to
 
	giocb
. 
To
 
make
 
su»
 
no
 
	ggc
, 
we
 
´ovide
 
a
 
bË
 
w™h
‡¼ay 
ªd
 
	gpoš‹rs


746 -- 
—s›¡
 
to
 dØ
as
 
Lua
 
bË
 
nÙ
 
ffi
 
	gty³
.

747 -- 
ex³ùs
 
Lua
 
bË
 
of
 
e™h”
 
bËs
 
Ü
 
iocb
 
as
 
	gšput
. 
ÿn
 
´ovide
 
±r
abË 
	gtoo


748 -- 
TODO
 
check
 
maybe
 
the
 
im¶em’tiÚ
 
aùu®ly
 
cİ›s
 
	gthe£
? 
Úly
h
posix
 
aio
 
§ys
 
you
 
Ãed
 
to
 
	gk“p
.

750 
	gt
.
	giocb_¬¿y
 = 
	$funùiÚ
(
b
, 
±rs
)

751 
loÿl
 
Ä
 = #tab

752 
loÿl
 
a
 = {
Ä
 =‚r, 
iocbs
 = {}, 
±rs
 =…Œ 
Ü
 
t
.
	`iocb_±rs
Òr)
	}
}

753 
	gi
 = 1, 
Ä
 do

754 
loÿl
 
	giocb
 = 
b
[
i
]

755 
a
.
iocbs
[
i
] = 
	$i¡y³
(
t
.
iocb
, iocbè
Ü
.
	$iocb
(
iocb
)

756 
a
.
±rs
[
i
 - 1] =‡.
iocbs
[i]

757 
’d


758  
a


759 
’d


761 
mt
.
sock_f‹r
 = {

762 
__Ãw
 = 
	`funùiÚ
(

, 
code
, 
k
, 
jt
, 
jf
)

763  
ffi
.
	`Ãw
(

, 
c
.
BPF
[
code
], 
jt
 
Ü
 0, 
jf
 o¸0, 
k
 or 0)

764 
’d


765 
	}
}

767 
addty³
(
ty³s
, "sock_f‹r", "¡ruù sock_f‹r", 
mt
.
sock_f‹r
)

769 
	gmt
.
	gbpf_š¢
 = {

770 
__Ãw
 = 
funùiÚ
(

, 
code
, 
d¡_»g
, 
¤c_»g
, 
off
, 
imm
)

771  
	gffi
.
Ãw
(

, 
c
.
BPF
[
code
], 
d¡_»g
 
Ü
 0, 
¤c_»g
 o¸0, 
off
 o¸0, 
imm
 or 0)

772 
	g’d


775 
addty³
(
ty³s
, "bpf_š¢", "¡ruù bpf_š¢_sysÿÎ", 
mt
.
bpf_š¢
)

777 -- 
ÿ·b™›s
 
d©a
 
is
 
ª
 
¬¿y
 
so
 
ÿÂÙ
 
put
 
m‘©abË
 
Ú
 
	g™
. 
Also
 
d•’ds
 oÀ
	gv”siÚ
, sØ
combše
 
što
 
Úe
 
	g¡ruùu»
.

779 -- 
TODO
 
maybe
 
add
 
ÿchšg


780 
loÿl
 
funùiÚ
 
	$ÿpæags
(
v®
, 
¡r
)

781 
nÙ
 
¡r
 
th’
  
v®
 
’d


782 #¡¸=ğ0 
th’
  
v®
 
’d


783 
loÿl
 
a
 = 
h
.
	`¥l™
(",", 
¡r
)

784 
i
, 
v
 
š
 
	$aœs
(
a
) do

785 
loÿl
 
s
 = 
h
.
	$Œim
(
v
):
	$uµ”
()

786 
nÙ
 
c
.
CAP
[
s
] 
th’
 
	`”rÜ
("šv®id c­ab™y " .. sè
’d


787 
v®
[
s
] = 
Œue


788 
’d


789  
v®


790 
’d


792 
mt
.
ÿp
 = {

793 
__šdex
 = 
	`funùiÚ
(
ÿp
, 
k
)

794 
loÿl
 
ci
 = 
c
.
CAP
[
k
]

795 
nÙ
 
ci
 
th’
 
	`”rÜ
("šv®id c­ab™y " .. 
k
è
’d


796 
loÿl
 
i
, 
shiá
 = 
h
.
	`divmod
(
ci
, 32)

797 
loÿl
 
mask
 = 
b™
.
	`lshiá
(1, 
shiá
)

798  
b™
.
	`bªd
(
ÿp
.ÿp[
i
], 
mask
) ~= 0

799 
’d
,

800 
__Ãwšdex
 = 
	`funùiÚ
(
ÿp
, 
k
, 
v
)

801 
v
 =ğ
Œue
 
th’
 v = 1 
–£if
 v =ğ
çl£
h’ v = 0 
’d


802 
loÿl
 
ci
 = 
c
.
CAP
[
k
]

803 
nÙ
 
ci
 
th’
 
	`”rÜ
("šv®id c­ab™y " .. 
k
è
’d


804 
loÿl
 
i
, 
shiá
 = 
h
.
	`divmod
(
ci
, 32)

805 
loÿl
 
mask
 = 
b™
.
	`bnÙ
(b™.
	`lshiá
(1, 
shiá
))

806 
loÿl
 
£t
 = 
b™
.
	`lshiá
(
v
, 
shiá
)

807 
ÿp
.ÿp[
i
] = 
b™
.
	`bÜ
(b™.
	`bªd
(ÿp.ÿp[i], 
mask
), 
£t
)

808 
’d
,

809 
__to¡ršg
 = 
	`funùiÚ
(
ÿp
)

810 
loÿl
 
b
 = {}

811 
k
, 
_
 
š
 
	`·œs
(
c
.
CAP
) do

812 
ÿp
[
k
] 
th’
 
b
[#b + 1] = k 
’d


813 
’d


814  
bË
.
	`cÚÿt
(
b
, ",")

815 
’d
,

816 
__Ãw
 = 
	`funùiÚ
(

, 
¡r
)

817 
loÿl
 
ÿp
 = 
ffi
.
	`Ãw
(

)

818 
¡r
 
th’
 
	`ÿpæags
(
ÿp
, sŒè
’d


819  
ÿp


820 
’d
,

821 
	}
}

823 
addty³
(
ty³s
, "ÿp", "¡ruù c­", 
mt
.
ÿp
)

825 
	gmt
.
	gÿ·b™›s
 = {

826 
hdrd©a
 = 
funùiÚ
(
ÿp
)

827 
loÿl
 
hdr
, 
	gd©a
 = 
t
.
u£r_ÿp_h—d”
(
ÿp
.
v”siÚ
, c­.
pid
), 
	gt
.
u£r_ÿp_d©a2
()

828 
	gd©a
[0].
	gefãùive
, d©a[1].efãùivğ
ÿp
.
efãùive
.ÿp[0], 
	gÿp
.effective.cap[1]

829 
	gd©a
[0].
	g³rm™‹d
, d©a[1].³rm™‹d = 
ÿp
.
³rm™‹d
.ÿp[0], 
	gÿp
.permitted.cap[1]

830 
	gd©a
[0].
	gšh”™abË
, d©a[1].šh”™abË = 
ÿp
.
šh”™abË
.ÿp[0], 
	gÿp
.inheritable.cap[1]

831  
	ghdr
, 
d©a


832 
	g’d
,

833 
	gšdex
 = {

834 
hdrd©a
 = 
funùiÚ
(
ÿp
è 
mt
.
ÿ·b™›s
.hdrd©¨
’d
,

836 
	g__Ãw
 = 
funùiÚ
(

, 
hdr
, 
d©a
)

837 
loÿl
 
	gÿp
 = 
ffi
.
Ãw
(

, 
c
.
LINUX_CAPABILITY_VERSION
[3], 0)

838 
ty³
(
hdr
è=ğ"bË" 
th’


839 
hdr
.
³rm™‹d
 
th’
 
ÿp
.³rm™‹d = 
t
.ÿp(hdr.³rm™‹dè
’d


840 
hdr
.
efãùive
 
th’
 
ÿp
.efãùivğ
t
.ÿp(hdr.efãùiveè
’d


841 
hdr
.
šh”™abË
 
th’
 
ÿp
.šh”™abË = 
t
.ÿp(hdr.šh”™abËè
’d


842 
ÿp
.
pid
 = 
hdr
.pid 
Ü
 0

843 
hdr
.
v”siÚ
 
th’
 
ÿp
.v”siÚ = 
c
.
LINUX_CAPABILITY_VERSION
[hdr.v”siÚ] 
’d


844  
ÿp


845 
’d


846 -- 
nÙ
 
·s£d
 
a
 
bË


847 
hdr
 
th’
 
ÿp
.
v”siÚ
, 
	gÿp
.
	gpid
 = hdr.v”siÚ, 
	ghdr
.
pid
 
’d


848 
d©a
 
th’


849 
	gÿp
.
	gefãùive
.ÿp[0], c­.efãùive.ÿp[1] = 
d©a
[0].
efãùive
, 
	gd©a
[1].effective

850 
	gÿp
.
	g³rm™‹d
.ÿp[0], c­.³rm™‹d.ÿp[1] = 
d©a
[0].
³rm™‹d
, 
	gd©a
[1].permitted

851 
	gÿp
.
	gšh”™abË
.ÿp[0], c­.šh”™abË.ÿp[1] = 
d©a
[0].
šh”™abË
, 
	gd©a
[1].inheritable

852 
’d


853  
ÿp


854 
	g’d
,

855 
	g__to¡ršg
 = 
funùiÚ
(
ÿp
)

856 
loÿl
 
¡r
 = ""

857 
nm
, 
ÿ±
 
š
 
	g·œs
{
	g³rm™‹d
 = 
ÿp
.
³rm™‹d
, 
	gšh”™abË
 = c­.
šh”™abË
, 
	gefãùive
 = c­.
efãùive
} do

858 
	g¡r
 = 
¡r
 .. 
nm
 .. ": "

859 
¡r
 = sŒ .. 
to¡ršg
(
ÿ±
) .. "\n"

860 
’d


861  
¡r


862 
’d
,

865 
addty³
(
ty³s
, "ÿ·b™›s", "¡ruù c­ab™›s", 
mt
.
ÿ·b™›s
)

867 -- 
difficuÉ
 
to
 
§Ãly
 
u£
 
ª
 
ffi
 
m‘©y³
 
šÙify
 
	gev’ts
, 
so
 u£ 
Lua
 
bË


868 
	gmt
.
	gšÙify_ev’ts
 = {

869 
__šdex
 = 
funùiÚ
(
b
, 
k
)

870 
	gc
.
	gIN
[
k
] 
th’
  
	gb™
.
bªd
(
b
.
mask
, 
c
.
IN
[k]è~ğ0 
’d


871 
”rÜ
("šv®id index " .. 
k
)

872 
’d


875 
	gt
.
	gšÙify_ev’ts
 = 
	$funùiÚ
(
bufãr
, 
Ën
)

876 
loÿl
 
off
, 
“
 = 0, {
	}
}

877 
	goff
 < 
Ën
 do

878 
loÿl
 
	gev
 = 
±
.
šÙify_ev’t
(
bufãr
 + 
off
)

879 
loÿl
 
Ë
 = 
£tm‘©abË
({
wd
 = 
ev
.wd, 
mask
 =ƒv.mask, 
cook›
 =ƒv.cook›}, 
mt
.
šÙify_ev’ts
)

880 
	gev
.
	gËn
 > 0 
th’
 
	gË
.
	gÇme
 = 
ffi
.
	$¡ršg
(
ev
.
Çme
è
’d


881 
“
[#“ + 1] = 
Ë


882 
off
 = ofà+ 
ffi
.(
t
.
	$šÙify_ev’t
(
ev
.
Ën
))

883 
’d


884  
“


885 
’d


887 -- 
TODO
 
šput
 
should
 
be
 
abË
 
to
 
£t
 
modes
 
autom©iÿÎy
 
äom
 
which
 
f›lds
 
¬e
 set.

888 
mt
.
timex
 = {

889 
__Ãw
 = 
	`funùiÚ
(

, 
a
)

890 
	`ty³
(
a
è=ğ'bË' 
th’


891 
a
.
modes
 
th’
‡.mode ğ
c
.
ADJ
[a.modes] 
’d


892 
a
.
¡©us
 
th’
‡.¡©u ğ
c
.
STA
[a.¡©us] 
’d


893  
ffi
.
	`Ãw
(

, 
a
)

894 
’d


895  
ffi
.
	`Ãw
(

)

896 
’d
,

897 
	}
}

899 
addty³
(
ty³s
, "timex", "¡ruùimex", 
mt
.
timex
)

901 -- 
nÙ
 
§Ã
 
to
 
cÚv”t
Ø
ffi
 
	gm‘©y³
, 
Úly
 
u£d
 
as
 
adjtimex
 
Ãeds
Ø 
»t
 
ªd
 
a
 

902 
	gmt
.
	gadjtimex
 = {

903 
__šdex
 = 
funùiÚ
(
timex
, 
k
)

904 
	gc
.
	gTIME
[
k
] 
th’
  
	gtimex
.
	g¡©e
 =ğ
c
.
TIME
[k] 
’d


905  
n


906 
’d


909 
	gt
.
	gadjtimex
 = 
	$funùiÚ
(
»t
, 
timex
)

910  
	`£tm‘©abË
({
¡©e
 = 
»t
, 
timex
 = 
	}
timex}, 
	gmt
.
	gadjtimex
)

911 
’d


913 
	gmt
.
	g•Şl_ev’t
 = {

914 
šdex
 = {

915 
fd
 = 
funùiÚ
(
e
è 
tÚumb”
Ó.
d©a
.fdè
’d
,

916 
	gu64
 = 
funùiÚ
(
e
èƒ.
d©a
.
u64
 
’d
,

917 
	gu32
 = 
funùiÚ
(
e
èƒ.
d©a
.
u32
 
’d
,

918 
	g±r
 = 
funùiÚ
(
e
èƒ.
d©a
.
±r
 
’d
,

920 
	gÃwšdex
 = {

921 
fd
 = 
funùiÚ
(
e
, 
v
è
	ge
.
	gd©a
.
	gfd
 = v 
’d
,

922 
	gu64
 = 
funùiÚ
(
e
, 
v
è
	ge
.
	gd©a
.u64 = v 
’d
,

923 
	gu32
 = 
funùiÚ
(
e
, 
v
è
	ge
.
	gd©a
.u32 = v 
’d
,

924 
	g±r
 = 
funùiÚ
(
e
, 
v
è
	ge
.
	gd©a
.±¸ğv 
’d
,

926 
	g__Ãw
 = 
funùiÚ
(

, 
a
)

927 
loÿl
 
	ge
 = 
ffi
.
Ãw
(

)

928 
a
 
th’


929 
ty³
(
a
è=ğ"¡ršg" 
th’
‡.
ev’ts
 = 
c
.
EPOLL
[a]

931 
a
.
ev’ts
 
th’
‡.ev’t ğ
c
.
EPOLL
[a.ev’ts] 
’d


932 
k
, 
v
 
š
 
·œs
(
a
èdØ
	ge
[k] = v 
’d


933 
’d


934 
’d


935  
e


936 
’d
,

939 
	gk
, 
v
 
š
 
	$·œs
(
c
.
EPOLL
) do

940 
mt
.
•Şl_ev’t
.
šdex
[
k
] = 
	$funùiÚ
(
e
è 
b™
.
	`bªd
Ó.
ev’ts
, 
v
è~ğ0 
’d


941 
’d


943 
	`addty³
(
ty³s
, "•Şl_ev’t", "¡ruùƒpŞl_ev’t", 
mt
.
•Şl_ev’t
)

945 
mt
.
•Şl_ev’ts
 = {

946 
__Ën
 = 
	`funùiÚ
(
•
èƒp.
couÁ
 
’d
,

947 
__Ãw
 = 
	`funùiÚ
(

, 
n
è 
ffi
.
	`Ãw
Ñp,‚,‚è
’d
,

948 
__aœs
 = 
	`funùiÚ
(
•
è 
»v™”
,ƒp.•,ƒp.
couÁ
 
’d


949 
	}
}

951 
addty³_v¬
(
ty³s
, "•Şl_ev’ts", "¡ruù {šˆcouÁ; sŒuùƒpŞl_ev’ˆ•[?];}", 
mt
.
•Şl_ev’ts
)

953 
	gmt
.
	gio_ev’t
 = {

954 
šdex
 = {

955 
”rÜ
 = 
funùiÚ
(
ev
èiàÓv.
»s
 < 0è
th’
  
t
.”rÜ(-ev.»sè
’d
ƒnd,

959 
addty³
(
ty³s
, "io_ev’t", "¡ruù io_ev’t", 
mt
.
io_ev’t
)

961 
	gmt
.
	gio_ev’ts
 = {

962 
__Ën
 = 
funùiÚ
(
evs
èƒvs.
couÁ
 
’d
,

963 
	g__Ãw
 = 
funùiÚ
(

, 
n
è 
	gffi
.
Ãw
Ñp,‚,‚è
	g’d
,

964 
	g__aœs
 = 
funùiÚ
(
evs
è 
»v™”
, 
	gevs
.
	gev
,ƒvs.
couÁ
 
	g’d


967 
addty³_v¬
(
ty³s
, "io_ev’ts", "¡ruù {šˆcouÁ; sŒuù io_ev’ˆev[?];}", 
mt
.
io_ev’ts
)

969 
	gmt
.
	gıu_£t
 = {

970 
šdex
 = {

971 
z”o
 = 
funùiÚ
(
£t
è
ffi
.
fl
(£t, 
s
.
ıu_£t
è
	g’d
,

972 
	g£t
 = 
funùiÚ
(
£t
, 
ıu
)

973 
ty³
(
ıu
è=ğ"bË" 
th’
 -- 
bË
 
is
 
ª
 
¬¿y
 
of
 
CPU
 
numb”s
 
eg
 {1, 2, 4}

974 
i
 = 1, #ıu dØ
	g£t
:
£t
(
ıu
[i]è
’d


975  
£t


976 
’d


977 
loÿl
 
d
 = 
b™
.
rshiá
(
ıu
, 5è-- 5 
	gis
 32 
b™s


978 
	g£t
.
	gv®
[
d
] = 
b™
.
bÜ
(
£t
.
v®
[d], b™.
lshiá
(1, 
ıu
 % 32))

979  
£t


980 
	g’d
,

981 
	gş—r
 = 
funùiÚ
(
£t
, 
ıu
)

982 
ty³
(
ıu
è=ğ"bË" 
th’
 -- 
bË
 
is
 
ª
 
¬¿y
 
of
 
CPU
 
numb”s
 
eg
 {1, 2, 4}

983 
i
 = 1, #ıu dØ
	g£t
:
ş—r
(
ıu
[i]è
’d


984  
£t


985 
’d


986 
loÿl
 
d
 = 
b™
.
rshiá
(
ıu
, 5è-- 5 
	gis
 32 
b™s


987 
	g£t
.
	gv®
[
d
] = 
b™
.
bªd
(
£t
.
v®
[d], b™.
bnÙ
(b™.
lshiá
(1, 
ıu
 % 32)))

988  
£t


989 
	g’d
,

990 
	gg‘
 = 
funùiÚ
(
£t
, 
ıu
)

991 
loÿl
 
	gd
 = 
b™
.
rshiá
(
ıu
, 5è-- 5 
	gis
 32 
b™s


992  
	gb™
.
bªd
(
£t
.
v®
[
d
], 
b™
.
lshiá
(1, 
ıu
 % 32)) ~= 0

993 
’d
,

994 -- 
TODO
 
add
 
»¡
 
of
 
š‹rçû
 
äom
 
mª
(3è
	gCPU_SET


996 
	g__šdex
 = 
funùiÚ
(
£t
, 
k
)

997 
	gmt
.
	gıu_£t
.
	gšdex
[
k
] 
th’
  mt.ıu_£t.šdex[k] 
’d


998 
ty³
(
k
è=ğ"numb”" 
th’
  
£t
:
g‘
(kè
’d


999 
”rÜ
("šv®id index " .. 
k
)

1000 
’d
,

1001 
	g__Ãwšdex
 = 
funùiÚ
(
£t
, 
k
, 
v
)

1002 
ty³
(
k
è~ğ"numb”" 
th’
 
”rÜ
("šv®id index " .. kè
’d


1003 
v
 
th’
 
£t
:£t(
k
è£t:
ş—r
(kè
’d


1004 
’d
,

1005 
	g__Ãw
 = 
funùiÚ
(

, 
b
)

1006 
loÿl
 
	g£t
 = 
ffi
.
Ãw
(

)

1007 
b
 
th’
 
£t
:£tÑabè
’d


1008  
£t


1009 
’d
,

1010 
	g__to¡ršg
 = 
funùiÚ
(
£t
)

1011 
loÿl
 
b
 = {}

1012 
i
 = 0, 
	gs
.
	gıu_£t
 * 8 - 1 dØ
	g£t
:
g‘
(iè
th’
 
b
[#b + 1] = i 
’d
ƒnd

1013  "{" .. 
bË
.
cÚÿt
(
b
, ",") .. "}"

1014 
	g’d
,

1017 
addty³
(
ty³s
, "ıu_£t", "¡ruù cpu_£t_t", 
mt
.
ıu_£t
)

1019 
	gmt
.
	gmq_©Œ
 = {

1020 
šdex
 = {

1021 
æags
 = 
funùiÚ
(
mqa
è 
tÚumb”
(mqa.
mq_æags
è
’d
,

1022 
	gmaxmsg
 = 
funùiÚ
(
mqa
è 
tÚumb”
(mqa.
mq_maxmsg
è
’d
,

1023 
	gmsgsize
 = 
funùiÚ
(
mqa
è 
tÚumb”
(mqa.
mq_msgsize
è
’d
,

1024 
	gcurmsgs
 = 
funùiÚ
(
mqa
è 
tÚumb”
(mqa.
mq_curmsgs
è
’d
,

1026 
	gÃwšdex
 = {

1027 
æags
 = 
funùiÚ
(
mqa
, 
v
è
	gmqa
.
	gmq_æags
 = 
c
.
OMQATTR
[v] 
’d
, -- 
Úly
 
®lows
 
	gO
.
NONBLOCK


1028 
	gmaxmsg
 = 
funùiÚ
(
mqa
, 
v
è
	gmqa
.
	gmq_maxmsg
 = v 
’d
,

1029 
	gmsgsize
 = 
funùiÚ
(
mqa
, 
v
è
	gmqa
.
	gmq_msgsize
 = v 
’d
,

1030 -- 
no
 
£n£
 
š
 
wr™šg
 
	gcurmsgs


1032 
	g__Ãw
 = 
Ãwâ
,

1035 
addty³
(
ty³s
, "mq_©Œ", "¡ruù mq_©Œ", 
mt
.
mq_©Œ
)

1037 
	gmt
.
	giäeq
 = {

1038 
šdex
 = {

1039 
Çme
 = 
funùiÚ
(
iä
è 
ffi
.
¡ršg
(iä.
iä_iän
.
iän_Çme
è
’d
,

1040 
	gaddr
 = 
funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_addr
 
’d
,

1041 
	gd¡addr
 = 
funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_d¡addr
 
’d
,

1042 
	gbrßdaddr
 = 
funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_brßdaddr
 
’d
,

1043 
	gÃtmask
 = 
funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_Ãtmask
 
’d
,

1044 
	ghwaddr
 = 
funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_hwaddr
 
’d
,

1045 
	gæags
 = 
funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_æags
 
’d
,

1046 
	giv®ue
 = 
funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_iv®ue
 
’d
,

1047 -- 
TODO
 
»¡
 
of
 
	gf›lds


1049 
	gÃwšdex
 = {

1050 
Çme
 = 
funùiÚ
(
iä
, 
v
)

1051 
as£¹
(#v <ğ
c
.
IFNAMSIZ
, "nameoo†ong")

1052 
	giä
.
	giä_iän
.
	giän_Çme
 = 
v


1053 
’d
,

1054 
	gæags
 = 
funùiÚ
(
iä
, 
v
è
	giä
.
	giä_iäu
.
	giäu_æags
 = 
c
.
IFREQ
[v] 
’d
,

1055 
	giv®ue
 = 
funùiÚ
(
iä
, 
v
è
	giä
.
	giä_iäu
.
	giäu_iv®ue
 = v 
’d
,

1056 -- 
TODO
 
»¡
 
of
 
	gf›lds


1058 
	g__Ãw
 = 
Ãwâ
,

1061 
addty³
(
ty³s
, "iäeq", "¡ruù iäeq", 
mt
.
iäeq
)

1063 -- 
nÙe
 
	gt
.
dœ’ts
 
™”©Ü
 
is
 
defšed
 
š
 
commÚ
 
ty³s


1064 
loÿl
 
	gd_Çme_off£t
 = 
ffi
.
off£tof
("¡ruù†šux_dœ’t64", "d_Çme"è-- 
d_Çme
 
is
 
©
 
’d
 
of
 

1065 
	gmt
.
	gdœ’t
 = {

1066 
šdex
 = {

1067 
šo
 = 
funùiÚ
(
£lf
è 
tÚumb”
(£lf.
d_šo
è
’d
,

1068 
	goff
 = 
funùiÚ
(
£lf
è s–f.
d_off
 
’d
,

1069 
	g»ş’
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

1070 
	gÇme
 = 
funùiÚ
(
£lf
è 
ffi
.
¡ršg
(
±
.(£lfè+ 
d_Çme_off£t
è
’d
,

1071 
	gty³
 = 
funùiÚ
(
£lf
è s–f.
d_ty³
 
’d
,

1072 
	gtoif
 = 
funùiÚ
(
£lf
è 
b™
.
lshiá
(£lf.
d_ty³
, 12è
	g’d
, -- 
cÚv”t
 
to
 
¡©
 
	gty³s


1074 
	g__Ën
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

1077 -- 
TODO
 
´eviou¦y
 
this
 
®lowed
 
low”
 
	gv®ues
, 
but
hi 
v”siÚ
 
dÛs
 
	gnÙ


1078 -- 
could
 
add
 
	gmt
.
	gdœ’t
.
	gšdex
[
tŞow”
(
k
)] = 
mt
.
dœ’t
.
šdex
[k] 
but
 
Ãed
 
to
 dØ
cÚsi¡’y
 
–£wh”e


1079 
k
, 
v
 
š
 
	$·œs
(
c
.
DT
) do

1080 
mt
.
dœ’t
.
šdex
[
k
] = 
	$funùiÚ
(
£lf
è s–f.
ty³
 =ğ
v
 
’d


1081 
’d


1083 
	`addty³
(
ty³s
, "dœ’t", "¡ruù†šux_dœ’t64", 
mt
.
dœ’t
)

1085 
mt
.
¹msg
 = {

1086 
šdex
 = {

1087 
çmy
 = 
	`funùiÚ
(
£lf
è 
	`tÚumb”
(£lf.
¹m_çmy
è
’d
,

1089 
Ãwšdex
 = {

1090 
çmy
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_çmy
 = 
c
.
AF
[v] 
’d
,

1091 
´ÙocŞ
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_´ÙocŞ
 = 
c
.
RTPROT
[v] 
’d
,

1092 
ty³
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_ty³
 = 
c
.
RTN
[v] 
’d
,

1093 
scİe
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_scİe
 = 
c
.
RT_SCOPE
[v] 
’d
,

1094 
æags
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_æags
 = 
c
.
RTM_F
[v] 
’d
,

1095 
bË
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_bË
 = 
c
.
RT_TABLE
[v] 
’d
,

1096 
d¡_Ën
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_d¡_Ën
 = v 
’d
,

1097 
¤c_Ën
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_¤c_Ën
 = v 
’d
,

1098 
tos
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
¹m_tos
 = v 
’d
,

1100 
__Ãw
 = 
Ãwâ
,

1101 
	}
}

1103 
addty³
(
ty³s
, "¹msg", "¡ruù„tmsg", 
mt
.
¹msg
)

1105 
	gmt
.
	gndmsg
 = {

1106 
šdex
 = {

1107 
çmy
 = 
funùiÚ
(
£lf
è 
tÚumb”
(£lf.
ndm_çmy
è
’d
,

1109 
	gÃwšdex
 = {

1110 
çmy
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gndm_çmy
 = 
c
.
AF
[v] 
’d
,

1111 
	g¡©e
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gndm_¡©e
 = 
c
.
NUD
[v] 
’d
,

1112 
	gæags
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gndm_æags
 = 
c
.
NTF
[v] 
’d
,

1113 
	gty³
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gndm_ty³
 = v 
’d
, -- 
which
 
	glookup
?

1114 
	gifšdex
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gndm_ifšdex
 = v 
’d
,

1116 
	g__Ãw
 = 
Ãwâ
,

1119 
addty³
(
ty³s
, "ndmsg", "¡ruù‚dmsg", 
mt
.
ndmsg
)

1121 
	gmt
.
	gsched_·¿m
 = {

1122 
__Ãw
 = 
funùiÚ
(

, 
v
è-- 
®low
 
pos™iÚ®
 
·¿m‘”s
 
as
 
Úly
 
fœ¡
 
is
 
ev”
 
u£d


1123 
loÿl
 
	gobj
 = 
ffi
.
Ãw
(

)

1124 
obj
.
sched_´iÜ™y
 = 
v
 
Ü
 0

1125  
obj


1126 
’d
,

1129 
addty³
(
ty³s
, "sched_·¿m", "¡ruù sched_·¿m", 
mt
.
sched_·¿m
)

1131 
	gmt
.
	gæock
 = {

1132 
šdex
 = {

1133 
ty³
 = 
funùiÚ
(
£lf
è s–f.
l_ty³
 
’d
,

1134 
	gwh’û
 = 
funùiÚ
(
£lf
è s–f.
l_wh’û
 
’d
,

1135 
	g¡¬t
 = 
funùiÚ
(
£lf
è s–f.
l_¡¬t
 
’d
,

1136 
	gËn
 = 
funùiÚ
(
£lf
è s–f.
l_Ën
 
’d
,

1137 
	gpid
 = 
funùiÚ
(
£lf
è s–f.
l_pid
 
’d
,

1139 
	gÃwšdex
 = {

1140 
ty³
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_ty³
 = 
c
.
FCNTL_LOCK
[v] 
’d
,

1141 
	gwh’û
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_wh’û
 = 
c
.
SEEK
[v] 
’d
,

1142 
	g¡¬t
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_¡¬t
 = v 
’d
,

1143 
	gËn
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_Ën
 = v 
’d
,

1144 
	gpid
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_pid
 = v 
’d
,

1146 
	g__Ãw
 = 
Ãwâ
,

1149 
addty³
(
ty³s
, "æock", "¡ruù flock64", 
mt
.
æock
)

1151 
	gmt
.
	gmmsghdr
 = {

1152 
šdex
 = {

1153 
hdr
 = 
funùiÚ
(
£lf
è s–f.
msg_hdr
 
’d
,

1154 
	gËn
 = 
funùiÚ
(
£lf
è s–f.
msg_Ën
 
’d
,

1156 
	gÃwšdex
 = {

1157 
hdr
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	ghdr
 = v 
’d
,

1159 
	g__Ãw
 = 
Ãwâ
,

1162 
addty³
(
ty³s
, "mmsghdr", "¡ruù mmsghdr", 
mt
.
mmsghdr
)

1164 
	gmt
.
	gmmsghdrs
 = {

1165 
__Ën
 = 
funùiÚ
(
p
è….
couÁ
 
’d
,

1166 
	g__Ãw
 = 
funùiÚ
(

, 
ps
)

1167 
ty³
(
ps
è=ğ'numb”' 
th’
  
ffi
.
Ãw
(

,…s,…sè
’d


1168 
loÿl
 
	gcouÁ
 = #ps

1169 
loÿl
 
mms
 = 
ffi
.
Ãw
(

, 
couÁ
, count)

1170 
	gn
 = 1, 
couÁ
 do

1171 
	gmms
.
	gmsg
[
n
 - 1].
	gmsg_hdr
 = 
mkty³
(
t
.
msghdr
, 
ps
[n])

1172 
’d


1173  
mms


1174 
	g’d
,

1175 
	g__aœs
 = 
funùiÚ
(
p
è 
»v™”
, 
	gp
.
	gmsg
,….
couÁ
 
	g’d
 -- 
TODO
 
wªt
 
fÜw¬d
 
™”©Ü
 
	g»®ly
...

1178 
addty³_v¬
(
ty³s
, "mmsghdrs", "¡ruù {šˆcouÁ; sŒuù mmsghd¸msg[?];}", 
mt
.
mmsghdrs
)

1180 
addty³
(
ty³s
, "bpf_attr", "union bpf_attr")

1182 -- 
M‘©y³
 
Lšux
 
³rf
 
ev’ts


1183 
	gmt
.
	g³rf_ev’t_©Œ
 = {

1184 
šdex
 = {

1185 
ty³
 = 
funùiÚ
(
£lf
è s–f.
³_ty³
 
’d
,

1186 
	gcÚfig
 = 
funùiÚ
(
£lf
è s–f.
³_cÚfig
 
’d
,

1187 
	g§m¶e_ty³
 = 
funùiÚ
(
£lf
è s–f.
³_§m¶e_ty³
 
’d
,

1189 
	gÃwšdex
 = {

1190 
ty³
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	g³_ty³
 = 
c
.
PERF_TYPE
[v] 
’d
,

1191 
	gcÚfig
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	g³_cÚfig
 = 
c
.
PERF_COUNT
[v] 
’d
,

1192 
	g§m¶e_ty³
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	g³_§m¶e_ty³
 = 
c
.
PERF_SAMPLE
[v] 
’d
,

1195 
addty³
(
ty³s
, "³rf_ev’t_©Œ", "¡ruù…”f_ev’t_©Œ", 
mt
.
³rf_ev’t_©Œ
)

1197 -- 
this
 
is
 
deş¬ed
 
above


1198 
	g§m­_±
 = {

1199 [
c
.
AF
.
UNIX
] = 
±
.
sockaddr_un
,

1200 [
c
.
AF
.
INET
] = 
±
.
sockaddr_š
,

1201 [
c
.
AF
.
INET6
] = 
±
.
sockaddr_š6
,

1202 [
c
.
AF
.
NETLINK
] = 
±
.
sockaddr_Æ
,

1203 [
c
.
AF
.
PACKET
] = 
±
.
sockaddr_Î
,

1206  
ty³s


1208 
’d


1210  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/util.lua

1 -- 
misc
 
	guts


3 -- 
aim
 
is
 
to
 
move
 
a
 
lÙ
 
of
 
¡uff
 
th©
 i 
nÙ
 
¡riùly
 
sysÿÎs
 
out
 oà
maš
 
code
Ø
moduÏri£
 
	gb‘‹r


4 -- 
mo¡
 
code
 
h”e
 
is
 
	$mª
(1è
Ü
 
	$mª
(3è
Ü
 
misc
 
h–³rs
 
commÚ
 
sks
.

6 -- 
TODO
 
»wÜk
 
so
 
th©
 
™ems
 
ÿn
 
be
 
m‘hods
 
Ú
 
fd
 
agaš
, 
ev’tfd
, 
tim”fd
, 
sigÇlfd
 
ªd
 
‰y


8 
loÿl
 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

9 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

10 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg
 =

11 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

12 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

13 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg


15 
loÿl
 
funùiÚ
 
	$š™
(
S
)

17 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

18 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

20 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

22 
loÿl
 
ffi
 = 
»quœe
 "ffi"

24 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

26 
loÿl
 
où®
 = 
h
.octal

28 -- 
TODO
 
move
 
to
 
h–³rs
? 
£e
 
nÙes
 
š
 
sysÿÎ
.
lua
 
about
 
»wÜkšg
 
though


29 
loÿl
 
funùiÚ
 
	$i¡y³
(

, 
x
)

30 
ffi
.
	$i¡y³
(

, 
x
è
th’
  x 
’d


31  
çl£


32 
’d


34 
loÿl
 
ut
 = {
	}
}

36 
loÿl
 
mt
 = {}

38 
loÿl
 
funùiÚ
 
	$if_Çm‘ošdex
(
Çme
, 
s
)

39 
loÿl
 
iä
 = 
t
.
iäeq
{
Çme
 = 
	}
name}

40 
loÿl
 
	g»t
, 
	g”r
 = 
S
.
ioùl
(
s
, "SIOCGIFINDEX", 
iä
)

41 
nÙ
 
»t
 
th’
  
	gn
, 
”r
 
’d


42  
	giä
.
iv®ue


43 
’d


45 
funùiÚ
 
	gut
.
if_Çm‘ošdex
(
Çme
è-- 
¡ªd¬d
 funùiÚ 
š
 
some
 
libc
 
v”siÚs


46 
loÿl
 
	gs
, 
	g”r
 = 
S
.
	$sock‘
(
c
.
AF
.
LOCAL
, c.
SOCK
.
STREAM
, 0)

47 
nÙ
 
s
 
th’
  
n
, 
”r
 
’d


48 
loÿl
 
i
, 
”r
 = 
	$if_Çm‘ošdex
(
Çme
, 
s
)

49 
nÙ
 
i
 
th’


50 
S
.
	$şo£
(
s
)

51  
n
, 
”r


52 
’d


53 
loÿl
 
ok
, 
”r
 = 
S
.
	$şo£
(
s
)

54 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


55  
i


56 
’d


58 -- 
bridge
 
funùiÚs
.

59 
loÿl
 
funùiÚ
 
	$bridge_ioùl
(
io
, 
Çme
)

60 
loÿl
 
s
, 
”r
 = 
S
.
	$sock‘
(
c
.
AF
.
LOCAL
, c.
SOCK
.
STREAM
, 0)

61 
nÙ
 
s
 
th’
  
n
, 
”r
 
’d


62 
loÿl
 
»t
, 
”r
 = 
S
.
	$ioùl
(
s
, 
io
, 
Çme
)

63 
nÙ
 
»t
 
th’


64 
s
:
	$şo£
()

65  
n
, 
”r


66 
’d


67 
loÿl
 
ok
, 
”r
 = 
s
:
	$şo£
()

68 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


69  
»t


70 
’d


72 
funùiÚ
 
ut
.
	$bridge_add
(
Çme
è 
	`bridge_ioùl
("SIOCBRADDBR",‚ameè
’d


73 
funùiÚ
 
ut
.
	$bridge_d–
(
Çme
è 
	`bridge_ioùl
("SIOCBRDELBR",‚ameè
’d


75 
loÿl
 
funùiÚ
 
	$bridge_if_ioùl
(
io
, 
Çme
, 
dev
)

76 
loÿl
 
”r
, 
s
, 
iä
, 
Ën
, 
»t
, 
ok


77 
s
, 
”r
 = 
S
.
	$sock‘
(
c
.
AF
.
LOCAL
, c.
SOCK
.
STREAM
, 0)

78 
nÙ
 
s
 
th’
  
n
, 
”r
 
’d


79 
	`ty³
(
dev
è=ğ"¡ršg" 
th’


80 
dev
, 
”r
 = 
	$if_Çm‘ošdex
(
dev
, 
s
)

81 
nÙ
 
dev
 
th’
  
n
, 
”r
 
’d


82 
’d


83 
iä
 = 
t
.
iäeq
{
Çme
 =‚ame, 
iv®ue
 = 
dev
}

84 
	g»t
, 
	g”r
 = 
S
.
ioùl
(
s
, 
io
, 
iä
);

85 
nÙ
 
»t
 
th’


86 
	gs
:
	$şo£
()

87  
n
, 
”r


88 
’d


89 
ok
, 
”r
 = 
s
:
	$şo£
()

90 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


91  
»t


92 
’d


94 
funùiÚ
 
ut
.
	$bridge_add_š‹rçû
(
bridge
, 
dev
è 
	$bridge_if_ioùl
(
c
.
SIOC
.
BRADDIF
, 
bridge
, 
dev
è
’d


95 
funùiÚ
 
ut
.
	$bridge_add_š‹rçû
(
bridge
, 
dev
è 
	$bridge_if_ioùl
(
c
.
SIOC
.
BRDELIF
, 
bridge
, 
dev
è
’d


97 
loÿl
 
funùiÚ
 
	`bršfo
(
d
è-- 
ÿn
 
be
 
u£d
 
as
 
sub·¹
 
of
 
g’”®
 
š‹rçû
 
šfo


98 
loÿl
 
bd
 = "/sys/şass/Ãt/" .. 
d
 .. "/" .. 
c
.
SYSFS_BRIDGE_ATTR


99 
nÙ
 
S
.
	$¡©
(
bd
è
th’
  
n
 
’d


100 
loÿl
 
bridge
 = {
	}
}

101 
â
, 
f
 
š
 
	gut
.
	$ls
(
bd
) do

102 
loÿl
 
s
 = 
ut
.
	`»adfe
(
bd
 .. "/" .. 
â
)

103 
s
 
th’


104 
s
 = s:
	`sub
(1, # - 1è-- 
»move
 
Ãwlše
 
©
 
’d


105 
â
 =ğ"group_addr" 
Ü
 fÀ=ğ"roÙ_id" o¸â =ğ"bridge_id" 
th’
 -- 
¡ršg
 
v®ues


106 
bridge
[
â
] = 
s


107 
–£if
 
f
 =ğ"¡p_¡©e" 
th’
 -- 
boŞ


108 
bridge
[
â
] = 
s
 == 1

109 
–£if
 
â
 ~ğ"." 
ªd
 fÀ~=".." 
th’


110 
bridge
[
â
] = 
	`tÚumb”
(
s
è-- 
nÙ
 
qu™e
 
cÜ»ù
, 
mo¡
 
¬e
 
timev®s
 
TODO


111 
’d


112 
’d


113 
’d


115 
loÿl
 
brif
, 
”r
 = 
ut
.
	`dœbË
("/sys/şass/Ãt/" .. 
d
 .. "/" .. 
c
.
SYSFS_BRIDGE_PORT_SUBDIR
, 
Œue
)

116 
nÙ
 
brif
 
th’
  
n
 
’d


118 
loÿl
 
fdb
 = "/sys/şass/Ãt/" .. 
d
 .. "/" .. 
c
.
SYSFS_BRIDGE_FDB


119 
nÙ
 
S
.
	$¡©
(
fdb
è
th’
  
n
 
’d


120 
loÿl
 
¦
 = 2048

121 
loÿl
 
bufãr
 = 
t
.
	$bufãr
(
¦
)

122 
loÿl
 
fd
 = 
S
.
	`İ’
(
fdb
, "rdonly")

123 
nÙ
 
fd
 
th’
  
n
 
’d


124 
loÿl
 
brfÜw¬d
 = {
	}
}

126 
»³©


127 
loÿl
 
n
 = 
S
.
	$»ad
(
fd
, 
bufãr
, 
¦
)

128 
nÙ
 
n
 
th’
  
n
 
’d


130 
loÿl
 
fdbs
 = 
±
.
	$fdb_’Œy
(
bufãr
)

132 
i
 = 1, 
b™
.
	$rshiá
(
n
, 4èdØ-- 
fdb_’Œy
 
is
 16 
by‹s


133 
loÿl
 
fdb
 = 
fdbs
[
i
 - 1]

134 
loÿl
 
mac
 = 
t
.
	$maÿddr
()

135 
ffi
.
	`cİy
(
mac
, 
fdb
.
mac_addr
, 
s
.
maÿddr
)

137 -- 
TODO
 
agešg_tim”_v®ue
 
is
 
nÙ
 
ª
 , 
time
, 

138 
brfÜw¬d
[#brforward + 1] = {

139 
mac_addr
 = 
mac
, 
pÜt_no
 = 
	`tÚumb”
(
fdb
.port_no),

140 
is_loÿl
 = 
fdb
.is_local ~= 0,

141 
agešg_tim”_v®ue
 = 
	`tÚumb”
(
fdb
.ageing_timer_value)

142 
	}
}

143 
’d


145 
uÁ
 
	gn
 == 0

146 
nÙ
 
fd
:
	$şo£
(è
th’
  
n
 
’d


148  {
bridge
 = bridge, 
brif
 = brif, 
brfÜw¬d
 = 
	}
brforward}

149 
’d


151 
funùiÚ
 
	gut
.
	$bridge_li¡
()

152 
loÿl
 
b
 = {
	}
}

153 
d
 
š
 
ut
.
ls
("/sys/class/net") do

154 
d
 ~ğ"." 
ªd
 d ~ğ".." 
th’
 
b
[d] = 
	$bršfo
(
d
è
’d


155 
’d


156  
b


157 
’d


159 -- 
ev’tfd
 
»ad
 
ªd
 
wr™e
 
h–³rs
, 
as
 
š
 
glibc
 
but
 
Lua
 
ä›ndly
. 
NÙe
 
»tuºs
 0 
EAGAIN
,‡ 0 
Ãv”
 
»tuºed
 
dœeùly


160 -- 
»tuºs
 
Lua
 
numb”
 - 
you
 
Ãed
 
®l
 64 
b™s
, 
·ss
 
your
 
own
 
v®ue
 
š
 
ªd
 
u£
 
th©
 
the
 
exaù
 
»suÉ


161 
funùiÚ
 
ut
.
	$ev’tfd_»ad
(
fd
, 
v®ue
)

162 
nÙ
 
v®ue
 
th’
 v®uğ
t
.
	$ušt64_1
(è
’d


163 
loÿl
 
»t
, 
”r
 = 
S
.
	$»ad
(
fd
, 
v®ue
, 8)

164 
”r
 
ªd
ƒ¼.
AGAIN
 
th’


165 
v®ue
[0] = 0

167 
’d


168 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


169  
	$tÚumb”
(
v®ue
[0])

170 
’d


171 
funùiÚ
 
ut
.
	$ev’tfd_wr™e
(
fd
, 
v®ue
)

172 
nÙ
 
v®ue
 
th’
 v®uğ1 
’d


173 
	`ty³
(
v®ue
è=ğ"numb”" 
th’
 v®uğ
t
.
	$ušt64_1
(
v®ue
è
’d


174 
loÿl
 
»t
, 
”r
 = 
S
.
	$wr™e
(
fd
, 
v®ue
, 8)

175 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


176  
Œue


177 
’d


179 
funùiÚ
 
ut
.
	$sigÇlfd_»ad
(
fd
, 
ss
)

180 
ss
 = 
	$i¡y³
(
t
.
sigšfos
, 
ss
è
Ü
.
	$sigšfos
(
ss
 
Ü
 8)

181 
loÿl
 
»t
, 
”r
 = 
S
.
	$»ad
(
fd
, 
ss
.
sfd
, ss.
by‹s
)

182 
»t
 =ğ0 
	$Ü
 (
”r
 
ªd
ƒ¼.
AGAIN
è
th’
  {
	}
} 
’d


183 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


184 
	gss
.
	gcouÁ
 = 
»t
 / 
s
.
sigÇlfd_sigšfo
 -- 
may
 
nÙ
 
be
 
fuÎ
 
Ëngth


185  
ss


186 
’d


188 
funùiÚ
 
ut
.
	$tim”fd_»ad
(
fd
, 
bufãr
)

189 
nÙ
 
bufãr
 
th’
 bufã¸ğ
t
.
	$ušt64_1
(è
’d


190 
loÿl
 
»t
, 
”r
 = 
S
.
	$»ad
(
fd
, 
bufãr
, 8)

191 
nÙ
 
»t
 
ªd
 
”r
.
AGAIN
 
th’
  0 
’d
 -- 
wl
 
Ãv”
 
aùu®ly
  0

192 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


193  
	$tÚumb”
(
bufãr
[0])

194 
’d


196 
loÿl
 
aud™¬ch_Ë
 = {

197 
x86
 = "I386",

198 
x64
 = "X86_64",

199 
¬m
 = "ARM",

200 
¬m64
 = "AARCH64",

201 
m£l
 = "MIPSEL",

202 
µc64Ë
 = "PPC64LE",

203 
	}
}

205 
loÿl
 
	gaud™¬ch_be
 = {

206 
µc
 = "PPC",

207 
	g¬m
 = "ARMEB",

208 
	g¬m64
 = "AARCH64",

209 
	gms
 = "MIPS",

212 
funùiÚ
 
	gut
.
	$aud™¬ch
()

213 
abi
.
Ë
 
th’
  
c
.
AUDIT_ARCH
[
aud™¬ch_Ë
[abi.
¬ch
]]  c.AUDIT_ARCH[
aud™¬ch_be
[abi.¬ch]] 
’d


214 
’d


216 -- 
fe
 
sy¡em
 
ÿ·b™›s


217 
loÿl
 
£cÿp
 = "security.capability"

219 
funùiÚ
 
ut
.
	$ÿpg‘
(
f
)

220 
loÿl
 
©Œ
, 
”r


221 
	`ty³
(
f
è=ğ"¡ršg" 
th’
 
©Œ
, 
”r
 = 
S
.
	$g‘x©Œ
(
f
, 
£cÿp
è
©Œ
, 
”r
 = f:
	$g‘x©Œ
(
£cÿp
è
’d


222 
nÙ
 
©Œ
 
th’
  
n
, 
”r
 
’d


223 
loÿl
 
vfs
 = 
±
.
	$vfs_ÿp_d©a
(
©Œ
)

224 
loÿl
 
magic_‘c
 = 
h
.
	$cÚvË32
(
vfs
.
magic_‘c
)

225 
loÿl
 
v”siÚ
 = 
b™
.
	`bªd
(
c
.
VFS_CAP
.
REVISION_MASK
, 
magic_‘c
)

226 -- 
TODO
 
you
 
Ãed
 
suµÜt
 
v”siÚ
 1 
fesy¡em
 
ÿps
 
add
 
h”e
, 
çœly
 
sim¶e


227 
	`as£¹
(
v”siÚ
 =ğ
c
.
VFS_CAP
.
REVISION_2
, "FIXME: Currently only support version 2 filesystem capabilities")

228 
loÿl
 
ÿp
 = 
t
.
	$ÿ·b™›s
()

229 
ÿp
.
³rm™‹d
.ÿp[0], c­.³rm™‹d.ÿp[1] = 
h
.
	`cÚvË32
(
vfs
.
d©a
[0].³rm™‹d), h.
	$cÚvË32
(
vfs
.
d©a
[1].
³rm™‹d
)

230 
ÿp
.
šh”™abË
.ÿp[0], c­.šh”™abË.ÿp[1] = 
h
.
	`cÚvË32
(
vfs
.
d©a
[0].šh”™abË), h.
	$cÚvË32
(
vfs
.
d©a
[1].
šh”™abË
)

231 
b™
.
	`bªd
(
magic_‘c
, 
c
.
VFS_CAP_FLAGS
.
EFFECTIVE
è~ğ0 
th’


232 
ÿp
.
efãùive
.ÿp[0] = 
b™
.
	$bÜ
(
ÿp
.
³rm™‹d
.ÿp[0], c­.
šh”™abË
.cap[0])

233 
ÿp
.
efãùive
.ÿp[1] = 
b™
.
	$bÜ
(
ÿp
.
³rm™‹d
.ÿp[1], c­.
šh”™abË
.cap[1])

234 
’d


235  
ÿp


236 
’d


238 
funùiÚ
 
ut
.
	$ÿp£t
(
f
, 
ÿp
, 
æags
)

239 
ÿp
 = 
	$i¡y³
(
t
.
ÿ·b™›s
, 
ÿp
è
Ü
.
	$ÿ·b™›s
(
ÿp
)

240 
loÿl
 
vfsæags
 = 0

241 -- 
is
 
this
 
the
 
cÜ»ù
 
way
 
to
 dØthis? 
TODO
 
check


242 
k
, 
_
 
š
 
	$·œs
(
c
.
CAP
èdØ
ÿp
.
efãùive
[
k
] 
th’
 
vfsæags
 = c.
VFS_CAP_FLAGS
.
EFFECTIVE
 
’d
ƒnd

243 
loÿl
 
vfs
 = 
t
.
	$vfs_ÿp_d©a
()

244 
vfs
.
magic_‘c
 = 
h
.
	`cÚvË32
(
c
.
VFS_CAP
.
REVISION_2
 + 
vfsæags
)

245 
vfs
.
d©a
[0].
³rm™‹d
, vfs.d©a[1].³rm™‹d = 
h
.
	`cÚvË32
(
ÿp
.³rm™‹d.ÿp[0]), h.
	$cÚvË32
(
ÿp
.
³rm™‹d
.cap[1])

246 
vfs
.
d©a
[0].
šh”™abË
, vfs.d©a[1].šh”™abË = 
h
.
	`cÚvË32
(
ÿp
.šh”™abË.ÿp[0]), h.
	$cÚvË32
(
ÿp
.
šh”™abË
.cap[1])

247 
	`ty³
(
f
è=ğ"¡ršg" 
th’
  
S
.
	$£tx©Œ
(
f
, 
£cÿp
, 
vfs
, 
æags
è f:
	$g‘x©Œ
(
£cÿp
, 
vfs
, 
æags
è
’d


248 
’d


250 -- 
TODO
 
could
 
add
 
umouÁ
 
m‘hod
.

251 
mt
.
mouÁ
 = {

252 
__to¡ršg
 = 
	`funùiÚ
(
m
è m.
sourû
 .. " oÀ" .. m.
rg‘
 .. "y³ " .. m.
ty³
 .. " (" .. m.
æags
 .. ")" 
’d
,

253 
	}
}

255 
	gmt
.
	gmouÁs
 = {

256 
__to¡ršg
 = 
funùiÚ
(
ms
)

257 
loÿl
 
rs
 = ""

258 
i
 = 1, #ms do

259 
	grs
 = 
rs
 .. 
to¡ršg
(
ms
[
i
]) .. '\n'

260 
’d


261  
rs


262 
’d


265 -- 
wl
 
wÜk
 
Ú
 
Ãtbsd
 
w™h
 
Lšux
 
	gcom·t
, 
but
 
should
 
u£
 
	$g‘vfs¡©
()

266 
funùiÚ
 
ut
.
	$mouÁs
(
fe
)

267 
loÿl
 
mf
, 
”r
 = 
ut
.
	`»adfe
(
fe
 
Ü
 "/proc/mounts")

268 
nÙ
 
mf
 
th’
  
n
, 
”r
 
’d


269 
loÿl
 
mouÁs
 = {
	}
}

270 
lše
 
š
 
mf
:
gm©ch
("[^\r\n]+") do

271 
loÿl
 
l
 = {}

272 
loÿl
 
·¹s
 = {"source", "target", "type", "flags", "freq", "passno"}

273 
loÿl
 
p
 = 1

274 
wÜd
 
š
 
lše
:
gm©ch
("%S+") do

275 
l
[
·¹s
[
p
]] = 
wÜd


276 
p
 =… + 1

277 
’d


278 
mouÁs
[#mouÁ + 1] = 
	$£tm‘©abË
(
l
, 
mt
.
mouÁ
)

279 
’d


280 -- 
TODO
 
some
 
of
 
the
 
İtiÚs
 
you
 
g‘
 
š
 /
´oc
/
mouÁs
 
¬e
 
fe
 
sy¡em
 
¥ecific
 
ªd
 
should
 
be
 
moved
 
to
 
l
.
d©a


281 -- 
id—
 
is
 
you
 
ÿn
 
round
-
Œ
 
this
 
d©a


282 -- 
a
 
lÙ
 
of
 
the
 
fs
 
¥ecific
 
İtiÚs
 
¬e
 
key
=
v®ue
 
so
 
—s›r
 
to
 
»cogni£


283  
	$£tm‘©abË
(
mouÁs
, 
mt
.mounts)

284 
’d


286 -- 
bË
 
ba£d
 
mouÁ
, 
mÜe
 
üoss
 
OS
 
com·tibË


287 
funùiÚ
 
ut
.
	$mouÁ
(
b
)

288 
loÿl
 
sourû
 = 
b
.sourû 
Ü
 "nÚe" -- 
¡ªd¬d
 

289 
loÿl
 
rg‘
 = 
b
.rg‘ 
Ü
ab.
dœ
 -- 
Ãtbsd
 
com·tibË


290 
loÿl
 
fesy¡emty³
 = 
b
.
ty³


291 
loÿl
 
mouÁæags
 = 
b
.
æags


292 
loÿl
 
d©a
 = 
b
.data

293  
S
.
	$mouÁ
(
sourû
, 
rg‘
, 
fesy¡emty³
, 
mouÁæags
, 
d©a
)

294 
’d


296 
funùiÚ
 
ut
.
	$£ndüed
(
fd
, 
pid
, 
uid
, 
gid
)

297 
nÙ
 
pid
 
th’
…id = 
S
.
	$g‘pid
(è
’d


298 
nÙ
 
uid
 
th’
 uid = 
S
.
	$g‘uid
(è
’d


299 
nÙ
 
gid
 
th’
 gid = 
S
.
	$g‘gid
(è
’d


300 
loÿl
 
uüed
 = 
t
.uüed{
pid
 =…id, 
uid
 = uid, 
gid
 = 
	}
gid}

301 
loÿl
 
	gbuf1
 = 
t
.
bufãr
(1è-- 
Ãed
 
to
 
£nd
 
Úe
 
by‹


302 
loÿl
 
io
 = 
t
.
iovecs
{{
buf1
, 1}}

303 
loÿl
 
cmsg
 = 
t
.
cmsghdr
("sock‘", "üed’tŸls", 
uüed
)

304 
loÿl
 
	gmsg
 = 
t
.
msghdr
{
iov
 = 
io
, 
	gcÚŒŞ
 = 
cmsg
}

305  
	gS
.
	$£ndmsg
(
fd
, 
msg
, 0)

306 
’d


308  
ut


310 
’d


312  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/constants.lua

1 -- 
x64
 
¥ecific
 
cÚ¡ªts


3 
loÿl
 
	g¬ch
 = {}

5 
¬ch
.
REG
 = {

6 
R8
 = 0,

7 
	gR9
 = 1,

8 
	gR10
 = 2,

9 
	gR11
 = 3,

10 
	gR12
 = 4,

11 
	gR13
 = 5,

12 
	gR14
 = 6,

13 
	gR15
 = 7,

14 
	gRDI
 = 8,

15 
	gRSI
 = 9,

16 
	gRBP
 = 10,

17 
	gRBX
 = 11,

18 
	gRDX
 = 12,

19 
	gRAX
 = 13,

20 
	gRCX
 = 14,

21 
	gRSP
 = 15,

22 
	gRIP
 = 16,

23 
	gEFL
 = 17,

24 
	gCSGSFS
 = 18,

25 
	gERR
 = 19,

26 
	gTRAPNO
 = 20,

27 
	gOLDMASK
 = 21,

28 
	gCR2
 = 22,

31  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/ffi.lua

1 -- 
x64
 
¥ecific
 
defš™iÚs


4 
	g•Şl
 = [[

5 
	s•Şl_ev’t
 {

6 
ušt32_t
 
ev’ts
;

7 
•Şl_d©a_t
 
d©a
;

8 } 
__©Œibu‹__
 ((
·cked
));

10 
	gucÚ‹xt
 = [[

11 
g»g_t
, 
g»g£t_t
[23];

12 
	s_å¡©e
 {

13 
	gcwd
, 
	gswd
, 
	gáw
, 
	gfİ
;

14 
	gr
, 
	grdp
;

15 
	gmxc¤
, 
	gmxü_mask
;

17 
	gsignifiÿnd
[4], 
	gexpÚ’t
, 
	g·ddšg
[3];

18 } 
	g_¡
[8];

20 
	g–em’t
[4];

21 } 
	g_xmm
[16];

22 
	g·ddšg
[24];

23 } *
	tå»g£t_t
;

25 
g»g£t_t
 
	gg»gs
;

26 
å»g£t_t
 
	gå»gs
;

27 
	g__»£rved1
[8];

28 } 
	tmcÚ‹xt_t
;

29 
	s__ucÚ‹xt
 {

30 
	guc_æags
;

31 
__ucÚ‹xt
 *
	guc_lšk
;

32 
¡ack_t
 
	guc_¡ack
;

33 
mcÚ‹xt_t
 
	guc_mcÚ‹xt
;

34 
sig£t_t
 
	guc_sigmask
;

35 
	g__å»gs_mem
[64];

36 } 
	tucÚ‹xt_t
;

38 
	g¡©
 = [[

39 
	s¡©
 {

40 
¡_dev
;

41 
¡_šo
;

42 
¡_Æšk
;

43 
¡_mode
;

44 
¡_uid
;

45 
¡_gid
;

46 
__·d0
;

47 
¡_rdev
;

48 
¡_size
;

49 
¡_blksize
;

50 
¡_blocks
;

51 
¡_©ime
;

52 
¡_©ime_n£c
;

53 
¡_mtime
;

54 
¡_mtime_n£c
;

55 
¡_ùime
;

56 
¡_ùime_n£c
;

57 
__unu£d
[3];

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/ioctl.lua

1 -- 
x64
 
ioùl
 
difã»nûs


3 
loÿl
 
	g¬ch
 = {

4 
ioùl
 = {

8  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/nr.lua

1 -- 
x64
 
sysÿÎ
 
numb”s


3 
loÿl
 
	gÄ
 = {

4 
SYS
 = {

5 
»ad
 = 0,

6 
	gwr™e
 = 1,

7 
	gİ’
 = 2,

8 
	gşo£
 = 3,

9 
	g¡©
 = 4,

10 
	gf¡©
 = 5,

11 
	gl¡©
 = 6,

12 
	gpŞl
 = 7,

13 
	gl£ek
 = 8,

14 
	gmm­
 = 9,

15 
	gm´Ùeù
 = 10,

16 
	gmunm­
 = 11,

17 
	gbrk
 = 12,

18 
	g¹_sigaùiÚ
 = 13,

19 
	g¹_sig´ocmask
 = 14,

20 
	g¹_sig»tuº
 = 15,

21 
	gioùl
 = 16,

22 
	g´—d64
 = 17,

23 
	gpwr™e64
 = 18,

24 
	g»adv
 = 19,

25 
	gwr™ev
 = 20,

26 
	gacûss
 = 21,

27 
	gpe
 = 22,

28 
	g£Ëù
 = 23,

29 
	gsched_y›ld
 = 24,

30 
	gm»m­
 = 25,

31 
	gmsync
 = 26,

32 
	gmšcÜe
 = 27,

33 
	gmadvi£
 = 28,

34 
	gshmg‘
 = 29,

35 
	gshm©
 = 30,

36 
	gshmùl
 = 31,

37 
	gdup
 = 32,

38 
	gdup2
 = 33,

39 
	g·u£
 = 34,

40 
	gÇno¦“p
 = 35,

41 
	gg‘™im”
 = 36,

42 
	g®¬m
 = 37,

43 
	g£t™im”
 = 38,

44 
	gg‘pid
 = 39,

45 
	g£ndfe
 = 40,

46 
	gsock‘
 = 41,

47 
	gcÚÃù
 = 42,

48 
	gacû±
 = 43,

49 
	g£ndto
 = 44,

50 
	g»cväom
 = 45,

51 
	g£ndmsg
 = 46,

52 
	g»cvmsg
 = 47,

53 
	gshutdown
 = 48,

54 
	gbšd
 = 49,

55 
	gli¡’
 = 50,

56 
	gg‘sockÇme
 = 51,

57 
	gg‘³”Çme
 = 52,

58 
	gsock‘·œ
 = 53,

59 
	g£tsockİt
 = 54,

60 
	gg‘sockİt
 = 55,

61 
	gşÚe
 = 56,

62 
	gfÜk
 = 57,

63 
	gvfÜk
 = 58,

64 
	gexecve
 = 59,

65 
	gex™
 = 60,

66 
	gwa™4
 = 61,

67 
	gkl
 = 62,

68 
	guÇme
 = 63,

69 
	g£mg‘
 = 64,

70 
	g£mİ
 = 65,

71 
	g£mùl
 = 66,

72 
	gshmdt
 = 67,

73 
	gmsgg‘
 = 68,

74 
	gmsg¢d
 = 69,

75 
	gmsgrcv
 = 70,

76 
	gmsgùl
 = 71,

77 
	gfú
 = 72,

78 
	gæock
 = 73,

79 
	gfsync
 = 74,

80 
	gfd©async
 = 75,

81 
	gŒunÿ‹
 = 76,

82 
	gárunÿ‹
 = 77,

83 
	gg‘d’ts
 = 78,

84 
	gg‘cwd
 = 79,

85 
	gchdœ
 = 80,

86 
	gfchdœ
 = 81,

87 
	g»Çme
 = 82,

88 
	gmkdœ
 = 83,

89 
	grmdœ
 = 84,

90 
	gü—t
 = 85,

91 
	glšk
 = 86,

92 
	guÆšk
 = 87,

93 
	gsymlšk
 = 88,

94 
	g»adlšk
 = 89,

95 
	gchmod
 = 90,

96 
	gfchmod
 = 91,

97 
	gchown
 = 92,

98 
	gfchown
 = 93,

99 
	glchown
 = 94,

100 
	gumask
 = 95,

101 
	gg‘timeofday
 = 96,

102 
	gg‘¾im™
 = 97,

103 
	gg‘ru§ge
 = 98,

104 
	gsysšfo
 = 99,

105 
	gtimes
 = 100,

106 
	g±¿û
 = 101,

107 
	gg‘uid
 = 102,

108 
	gsy¦og
 = 103,

109 
	gg‘gid
 = 104,

110 
	g£tuid
 = 105,

111 
	g£tgid
 = 106,

112 
	gg‘euid
 = 107,

113 
	gg‘egid
 = 108,

114 
	g£gid
 = 109,

115 
	gg‘µid
 = 110,

116 
	gg‘pg½
 = 111,

117 
	g£tsid
 = 112,

118 
	g£Œeuid
 = 113,

119 
	g£Œegid
 = 114,

120 
	gg‘groups
 = 115,

121 
	g£tgroups
 = 116,

122 
	g£Œesuid
 = 117,

123 
	gg‘»suid
 = 118,

124 
	g£Œesgid
 = 119,

125 
	gg‘»sgid
 = 120,

126 
	gg‘pgid
 = 121,

127 
	g£tfsuid
 = 122,

128 
	g£tfsgid
 = 123,

129 
	gg‘sid
 = 124,

130 
	gÿpg‘
 = 125,

131 
	gÿp£t
 = 126,

132 
	g¹_sig³ndšg
 = 127,

133 
	g¹_sigtimedwa™
 = 128,

134 
	g¹_sigqueuešfo
 = 129,

135 
	g¹_sigsu¥’d
 = 130,

136 
	gsig®t¡ack
 = 131,

137 
	gutime
 = 132,

138 
	gmknod
 = 133,

139 
	gu£lib
 = 134,

140 
	g³rsÚ®™y
 = 135,

141 
	gu¡©
 = 136,

142 
	g¡©fs
 = 137,

143 
	gf¡©fs
 = 138,

144 
	gsysfs
 = 139,

145 
	gg‘´iÜ™y
 = 140,

146 
	g£riÜ™y
 = 141,

147 
	gsched_£¬am
 = 142,

148 
	gsched_g‘·¿m
 = 143,

149 
	gsched_£tscheduËr
 = 144,

150 
	gsched_g‘scheduËr
 = 145,

151 
	gsched_g‘_´iÜ™y_max
 = 146,

152 
	gsched_g‘_´iÜ™y_mš
 = 147,

153 
	gsched_¼_g‘_š‹rv®
 = 148,

154 
	gmlock
 = 149,

155 
	gmuÆock
 = 150,

156 
	gmlock®l
 = 151,

157 
	gmuÆock®l
 = 152,

158 
	gvhªgup
 = 153,

159 
	gmodify_ldt
 = 154,

160 
	gpivÙ_roÙ
 = 155,

161 
	g_sysùl
 = 156,

162 
	g´ùl
 = 157,

163 
	g¬ch_´ùl
 = 158,

164 
	gadjtimex
 = 159,

165 
	g£Œlim™
 = 160,

166 
	gchroÙ
 = 161,

167 
	gsync
 = 162,

168 
	gacù
 = 163,

169 
	g£‰imeofday
 = 164,

170 
	gmouÁ
 = 165,

171 
	gumouÁ2
 = 166,

172 
	gsw­Ú
 = 167,

173 
	gsw­off
 = 168,

174 
	g»boÙ
 = 169,

175 
	g£tho¡Çme
 = 170,

176 
	g£tdomašÇme
 = 171,

177 
	giİl
 = 172,

178 
	giİ”m
 = 173,

179 
	gü—‹_moduË
 = 174,

180 
	gš™_moduË
 = 175,

181 
	gd–‘e_moduË
 = 176,

182 
	gg‘_k”Ãl_syms
 = 177,

183 
	gqu”y_moduË
 = 178,

184 
	gquÙaùl
 = 179,

185 
	gnfs£rvùl
 = 180,

186 
	gg‘pmsg
 = 181,

187 
	gpumsg
 = 182,

188 
	gafs_sysÿÎ
 = 183,

189 
	gtuxÿÎ
 = 184,

190 
	g£cur™y
 = 185,

191 
	gg‘tid
 = 186,

192 
	g»adah—d
 = 187,

193 
	g£tx©Œ
 = 188,

194 
	gl£tx©Œ
 = 189,

195 
	gf£tx©Œ
 = 190,

196 
	gg‘x©Œ
 = 191,

197 
	glg‘x©Œ
 = 192,

198 
	gfg‘x©Œ
 = 193,

199 
	gli¡x©Œ
 = 194,

200 
	gÎi¡x©Œ
 = 195,

201 
	gæi¡x©Œ
 = 196,

202 
	g»movex©Œ
 = 197,

203 
	gÌemovex©Œ
 = 198,

204 
	gäemovex©Œ
 = 199,

205 
	gtkl
 = 200,

206 
	gtime
 = 201,

207 
	gfu‹x
 = 202,

208 
	gsched_£ffš™y
 = 203,

209 
	gsched_g‘affš™y
 = 204,

210 
	g£t_th»ad_¬—
 = 205,

211 
	gio_£tup
 = 206,

212 
	gio_de¡roy
 = 207,

213 
	gio_g‘ev’ts
 = 208,

214 
	gio_subm™
 = 209,

215 
	gio_ÿnûl
 = 210,

216 
	gg‘_th»ad_¬—
 = 211,

217 
	glookup_dcook›
 = 212,

218 
	g•Şl_ü—‹
 = 213,

219 
	g•Şl_ùl_Şd
 = 214,

220 
	g•Şl_wa™_Şd
 = 215,

221 
	g»m­_fe_·ges
 = 216,

222 
	gg‘d’ts64
 = 217,

223 
	g£t_tid_add»ss
 = 218,

224 
	g»¡¬t_sysÿÎ
 = 219,

225 
	g£mtimedİ
 = 220,

226 
	gçdvi£64
 = 221,

227 
	gtim”_ü—‹
 = 222,

228 
	gtim”_£‰ime
 = 223,

229 
	gtim”_g‘time
 = 224,

230 
	gtim”_g‘ov”run
 = 225,

231 
	gtim”_d–‘e
 = 226,

232 
	gşock_£‰ime
 = 227,

233 
	gşock_g‘time
 = 228,

234 
	gşock_g‘»s
 = 229,

235 
	gşock_Çno¦“p
 = 230,

236 
	gex™_group
 = 231,

237 
	g•Şl_wa™
 = 232,

238 
	g•Şl_ùl
 = 233,

239 
	gtgkl
 = 234,

240 
	gutimes
 = 235,

241 
	gv£rv”
 = 236,

242 
	gmbšd
 = 237,

243 
	g£t_mempŞicy
 = 238,

244 
	gg‘_mempŞicy
 = 239,

245 
	gmq_İ’
 = 240,

246 
	gmq_uÆšk
 = 241,

247 
	gmq_timed£nd
 = 242,

248 
	gmq_timed»ûive
 = 243,

249 
	gmq_nÙify
 = 244,

250 
	gmq_g‘£‰r
 = 245,

251 
	gkexec_lßd
 = 246,

252 
	gwa™id
 = 247,

253 
	gadd_key
 = 248,

254 
	g»que¡_key
 = 249,

255 
	gkeyùl
 = 250,

256 
	giİrio_£t
 = 251,

257 
	giİrio_g‘
 = 252,

258 
	gšÙify_š™
 = 253,

259 
	gšÙify_add_w©ch
 = 254,

260 
	gšÙify_rm_w©ch
 = 255,

261 
	gmig¿‹_·ges
 = 256,

262 
	gİ’©
 = 257,

263 
	gmkdœ©
 = 258,

264 
	gmknod©
 = 259,

265 
	gfchowÇt
 = 260,

266 
	gfutime§t
 = 261,

267 
	gÃwf¡©©
 = 262,

268 
	guÆšk©
 = 263,

269 
	g»Çm—t
 = 264,

270 
	glšk©
 = 265,

271 
	gsymlšk©
 = 266,

272 
	g»adlšk©
 = 267,

273 
	gfchmod©
 = 268,

274 
	gçcûs§t
 = 269,

275 
	gp£Ëù6
 = 270,

276 
	gµŞl
 = 271,

277 
	gunsh¬e
 = 272,

278 
	g£t_robu¡_li¡
 = 273,

279 
	gg‘_robu¡_li¡
 = 274,

280 
	g¥liû
 = 275,

281 
	g‹e
 = 276,

282 
	gsync_fe_¿nge
 = 277,

283 
	gvm¥liû
 = 278,

284 
	gmove_·ges
 = 279,

285 
	gutim’§t
 = 280,

286 
	g•Şl_pwa™
 = 281,

287 
	gsigÇlfd
 = 282,

288 
	gtim”fd_ü—‹
 = 283,

289 
	gev’tfd
 = 284,

290 
	gçÎoÿ‹
 = 285,

291 
	gtim”fd_£‰ime
 = 286,

292 
	gtim”fd_g‘time
 = 287,

293 
	gacû±4
 = 288,

294 
	gsigÇlfd4
 = 289,

295 
	gev’tfd2
 = 290,

296 
	g•Şl_ü—‹1
 = 291,

297 
	gdup3
 = 292,

298 
	gpe2
 = 293,

299 
	gšÙify_š™1
 = 294,

300 
	g´—dv
 = 295,

301 
	gpwr™ev
 = 296,

302 
	g¹_tgsigqueuešfo
 = 297,

303 
	g³rf_ev’t_İ’
 = 298,

304 
	g»cvmmsg
 = 299,

305 
	gçnÙify_š™
 = 300,

306 
	gçnÙify_m¬k
 = 301,

307 
	g´lim™64
 = 302,

308 
	gÇme_to_hªdË_©
 = 303,

309 
	gİ’_by_hªdË_©
 = 304,

310 
	gşock_adjtime
 = 305,

311 
	gsyncfs
 = 306,

312 
	g£ndmmsg
 = 307,

313 
	g£Šs
 = 308,

314 
	gg‘ıu
 = 309,

315 
	g´oûss_vm_»adv
 = 310,

316 
	g´oûss_vm_wr™ev
 = 311,

317 
	gkcmp
 = 312,

318 
	gfš™_moduË
 = 313,

319 
	gsched_£‰r
= 314,

320 
	gsched_g‘©Œ
= 315,

321 
	g»Çm—t2
 = 316,

322 
	g£ccomp
 = 317,

323 
	gg‘¿ndom
 = 318,

324 
	gmemfd_ü—‹
 = 319,

325 
	gkexec_fe_lßd
 = 320,

326 
	gbpf
 = 321,

330 
	gÄ
.
	gSYS
.
	gf¡©©
 = 
Ä
.
SYS
.
Ãwf¡©©


332  
Ä


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/constants.lua

1 -- 
x86
 
¥ecific
 
code


3 
loÿl
 
	g¬ch
 = {}

5 -- 
x86
 
Çmes


6 
¬ch
.
REG
 = {

7 
GS
 = 0,

8 
	gFS
 = 1,

9 
	gES
 = 2,

10 
	gDS
 = 3,

11 
	gEDI
 = 4,

12 
	gESI
 = 5,

13 
	gEBP
 = 6,

14 
	gESP
 = 7,

15 
	gEBX
 = 8,

16 
	gEDX
 = 9,

17 
	gECX
 = 10,

18 
	gEAX
 = 11,

19 
	gTRAPNO
 = 12,

20 
	gERR
 = 13,

21 
	gEIP
 = 14,

22 
	gCS
 = 15,

23 
	gEFL
 = 16,

24 
	gUESP
 = 17,

25 
	gSS
 = 18,

28  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/ffi.lua

1 -- 
x86
 
¥ecific
 
defš™iÚs


4 
	gucÚ‹xt
 = [[

5 
g»g_t
, 
g»g£t_t
[19];

6 
	s_å¡©e
 {

7 
	gcw
, 
	gsw
, 
	gg
, 
	goff
, 
	gcs£l
, 
	gd©aoff
, 
	gd©a£l
;

9 
	gsignifiÿnd
[4], 
	gexpÚ’t
;

10 } 
	g_¡
[8];

11 
	g¡©us
;

12 } *
	tå»g£t_t
;

14 
g»g£t_t
 
	gg»gs
;

15 
å»g£t_t
 
	gå»gs
;

16 
	gŞdmask
, 
	gü2
;

17 } 
	tmcÚ‹xt_t
;

18 
	s__ucÚ‹xt
 {

19 
	guc_æags
;

20 
__ucÚ‹xt
 *
	guc_lšk
;

21 
¡ack_t
 
	guc_¡ack
;

22 
mcÚ‹xt_t
 
	guc_mcÚ‹xt
;

23 
sig£t_t
 
	guc_sigmask
;

24 
	g__å»gs_mem
[28];

25 } 
	tucÚ‹xt_t
;

27 
	g¡©
 = [[

28 
	s¡©
 {

29 
¡_dev
;

30 
__·d0
[4];

31 
	g__¡_šo
;

32 
	g¡_mode
;

33 
	g¡_Æšk
;

34 
	g¡_uid
;

35 
	g¡_gid
;

36 
	g¡_rdev
;

37 
	g__·d3
[4];

38 
	g¡_size
;

39 
	g¡_blksize
;

40 
	g¡_blocks
;

41 
	g¡_©ime
;

42 
	g¡_©ime_n£c
;

43 
	g¡_mtime
;

44 
	g¡_mtime_n£c
;

45 
	g¡_ùime
;

46 
	g¡_ùime_n£c
;

47 
	g¡_šo
;

50 
	g¡©fs
 = [[

51 
¡©fs_wÜd
;

52 
	s¡©fs64
 {

53 
¡©fs_wÜd
 
f_ty³
;

54 
¡©fs_wÜd
 
f_bsize
;

55 
ušt64_t
 
f_blocks
;

56 
ušt64_t
 
f_bä“
;

57 
ušt64_t
 
f_bava
;

58 
ušt64_t
 
f_fes
;

59 
ušt64_t
 
f_fä“
;

60 
k”Ãl_fsid_t
 
f_fsid
;

61 
¡©fs_wÜd
 
f_Çm–’
;

62 
¡©fs_wÜd
 
f_äsize
;

63 
¡©fs_wÜd
 
f_æags
;

64 
¡©fs_wÜd
 
f_¥¬e
[4];

65 } 
__©Œibu‹__
((
·cked
,
®igÃd
(4)));

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/ioctl.lua

1 -- 
x86
 
ioùl
 
difã»nûs


3 
loÿl
 
	g¬ch
 = {

4 
ioùl
 = {

8  
	g¬ch


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/nr.lua

1 -- 
x86
 
sysÿÎ
 
numb”s


3 
loÿl
 
	gÄ
 = {

4 
SYS
 = {

5 
»¡¬t_sysÿÎ
 = 0,

6 
	gex™
 = 1,

7 
	gfÜk
 = 2,

8 
	g»ad
 = 3,

9 
	gwr™e
 = 4,

10 
	gİ’
 = 5,

11 
	gşo£
 = 6,

12 
	gwa™pid
 = 7,

13 
	gü—t
 = 8,

14 
	glšk
 = 9,

15 
	guÆšk
 = 10,

16 
	gexecve
 = 11,

17 
	gchdœ
 = 12,

18 
	gtime
 = 13,

19 
	gmknod
 = 14,

20 
	gchmod
 = 15,

21 
	glchown
 = 16,

23 
	gŞd¡©
 = 18,

24 
	gl£ek
 = 19,

25 
	gg‘pid
 = 20,

26 
	gmouÁ
 = 21,

27 
	gumouÁ
 = 22,

28 
	g£tuid
 = 23,

29 
	gg‘uid
 = 24,

30 
	g¡ime
 = 25,

31 
	g±¿û
 = 26,

32 
	g®¬m
 = 27,

33 
	gŞdf¡©
 = 28,

34 
	g·u£
 = 29,

35 
	gutime
 = 30,

36 
	g¡ty
 = 31,

37 
	gg‰y
 = 32,

38 
	gacûss
 = 33,

39 
	gniû
 = 34,

40 
	gáime
 = 35,

41 
	gsync
 = 36,

42 
	gkl
 = 37,

43 
	g»Çme
 = 38,

44 
	gmkdœ
 = 39,

45 
	grmdœ
 = 40,

46 
	gdup
 = 41,

47 
	gpe
 = 42,

48 
	gtimes
 = 43,

49 
	g´of
 = 44,

50 
	gbrk
 = 45,

51 
	g£tgid
 = 46,

52 
	gg‘gid
 = 47,

53 
	gsigÇl
 = 48,

54 
	gg‘euid
 = 49,

55 
	gg‘egid
 = 50,

56 
	gacù
 = 51,

57 
	gumouÁ2
 = 52,

58 
	glock
 = 53,

59 
	gioùl
 = 54,

60 
	gfú
 = 55,

61 
	gmpx
 = 56,

62 
	g£gid
 = 57,

63 
	gulim™
 = 58,

64 
	gŞdŞduÇme
 = 59,

65 
	gumask
 = 60,

66 
	gchroÙ
 = 61,

67 
	gu¡©
 = 62,

68 
	gdup2
 = 63,

69 
	gg‘µid
 = 64,

70 
	gg‘pg½
 = 65,

71 
	g£tsid
 = 66,

72 
	gsigaùiÚ
 = 67,

73 
	gsg‘mask
 = 68,

74 
	gs£tmask
 = 69,

75 
	g£Œeuid
 = 70,

76 
	g£Œegid
 = 71,

77 
	gsigsu¥’d
 = 72,

78 
	gsig³ndšg
 = 73,

79 
	g£tho¡Çme
 = 74,

80 
	g£Œlim™
 = 75,

81 
	gg‘¾im™
 = 76,

82 
	gg‘ru§ge
 = 77,

83 
	gg‘timeofday
 = 78,

84 
	g£‰imeofday
 = 79,

85 
	gg‘groups
 = 80,

86 
	g£tgroups
 = 81,

87 
	g£Ëù
 = 82,

88 
	gsymlšk
 = 83,

89 
	gŞdl¡©
 = 84,

90 
	g»adlšk
 = 85,

91 
	gu£lib
 = 86,

92 
	gsw­Ú
 = 87,

93 
	g»boÙ
 = 88,

94 
	g»addœ
 = 89,

95 
	gmm­
 = 90,

96 
	gmunm­
 = 91,

97 
	gŒunÿ‹
 = 92,

98 
	gárunÿ‹
 = 93,

99 
	gfchmod
 = 94,

100 
	gfchown
 = 95,

101 
	gg‘´iÜ™y
 = 96,

102 
	g£riÜ™y
 = 97,

103 
	g´of
 = 98,

104 
	g¡©fs
 = 99,

105 
	gf¡©fs
 = 100,

106 
	giİ”m
 = 101,

107 
	gsock‘ÿÎ
 = 102,

108 
	gsy¦og
 = 103,

109 
	g£t™im”
 = 104,

110 
	gg‘™im”
 = 105,

111 
	g¡©
 = 106,

112 
	gl¡©
 = 107,

113 
	gf¡©
 = 108,

114 
	gŞduÇme
 = 109,

115 
	giİl
 = 110,

116 
	gvhªgup
 = 111,

117 
	gidË
 = 112,

118 
	gvm86Şd
 = 113,

119 
	gwa™4
 = 114,

120 
	gsw­off
 = 115,

121 
	gsysšfo
 = 116,

122 
	gc
 = 117,

123 
	gfsync
 = 118,

124 
	gsig»tuº
 = 119,

125 
	gşÚe
 = 120,

126 
	g£tdomašÇme
 = 121,

127 
	guÇme
 = 122,

128 
	gmodify_ldt
 = 123,

129 
	gadjtimex
 = 124,

130 
	gm´Ùeù
 = 125,

131 
	gsig´ocmask
 = 126,

132 
	gü—‹_moduË
 = 127,

133 
	gš™_moduË
 = 128,

134 
	gd–‘e_moduË
 = 129,

135 
	gg‘_k”Ãl_syms
 = 130,

136 
	gquÙaùl
 = 131,

137 
	gg‘pgid
 = 132,

138 
	gfchdœ
 = 133,

139 
	gbdæush
 = 134,

140 
	gsysfs
 = 135,

141 
	g³rsÚ®™y
 = 136,

142 
	gafs_sysÿÎ
 = 137,

143 
	g£tfsuid
 = 138,

144 
	g£tfsgid
 = 139,

145 
	g_Î£ek
 = 140,

146 
	gg‘d’ts
 = 141,

147 
	g_Ãw£Ëù
 = 142,

148 
	gæock
 = 143,

149 
	gmsync
 = 144,

150 
	g»adv
 = 145,

151 
	gwr™ev
 = 146,

152 
	gg‘sid
 = 147,

153 
	gfd©async
 = 148,

154 
	g_sysùl
 = 149,

155 
	gmlock
 = 150,

156 
	gmuÆock
 = 151,

157 
	gmlock®l
 = 152,

158 
	gmuÆock®l
 = 153,

159 
	gsched_£¬am
 = 154,

160 
	gsched_g‘·¿m
 = 155,

161 
	gsched_£tscheduËr
 = 156,

162 
	gsched_g‘scheduËr
 = 157,

163 
	gsched_y›ld
 = 158,

164 
	gsched_g‘_´iÜ™y_max
 = 159,

165 
	gsched_g‘_´iÜ™y_mš
 = 160,

166 
	gsched_¼_g‘_š‹rv®
 = 161,

167 
	gÇno¦“p
 = 162,

168 
	gm»m­
 = 163,

169 
	g£Œesuid
 = 164,

170 
	gg‘»suid
 = 165,

171 
	gvm86
 = 166,

172 
	gqu”y_moduË
 = 167,

173 
	gpŞl
 = 168,

174 
	gnfs£rvùl
 = 169,

175 
	g£Œesgid
 = 170,

176 
	gg‘»sgid
 = 171,

177 
	g´ùl
 = 172,

178 
	g¹_sig»tuº
 = 173,

179 
	g¹_sigaùiÚ
 = 174,

180 
	g¹_sig´ocmask
 = 175,

181 
	g¹_sig³ndšg
 = 176,

182 
	g¹_sigtimedwa™
 = 177,

183 
	g¹_sigqueuešfo
 = 178,

184 
	g¹_sigsu¥’d
 = 179,

185 
	g´—d64
 = 180,

186 
	gpwr™e64
 = 181,

187 
	gchown
 = 182,

188 
	gg‘cwd
 = 183,

189 
	gÿpg‘
 = 184,

190 
	gÿp£t
 = 185,

191 
	gsig®t¡ack
 = 186,

192 
	g£ndfe
 = 187,

193 
	gg‘pmsg
 = 188,

194 
	gpumsg
 = 189,

195 
	gvfÜk
 = 190,

196 
	gug‘¾im™
 = 191,

197 
	gmm­2
 = 192,

198 
	gŒunÿ‹64
 = 193,

199 
	gárunÿ‹64
 = 194,

200 
	g¡©64
 = 195,

201 
	gl¡©64
 = 196,

202 
	gf¡©64
 = 197,

203 
	glchown32
 = 198,

204 
	gg‘uid32
 = 199,

205 
	gg‘gid32
 = 200,

206 
	gg‘euid32
 = 201,

207 
	gg‘egid32
 = 202,

208 
	g£Œeuid32
 = 203,

209 
	g£Œegid32
 = 204,

210 
	gg‘groups32
 = 205,

211 
	g£tgroups32
 = 206,

212 
	gfchown32
 = 207,

213 
	g£Œesuid32
 = 208,

214 
	gg‘»suid32
 = 209,

215 
	g£Œesgid32
 = 210,

216 
	gg‘»sgid32
 = 211,

217 
	gchown32
 = 212,

218 
	g£tuid32
 = 213,

219 
	g£tgid32
 = 214,

220 
	g£tfsuid32
 = 215,

221 
	g£tfsgid32
 = 216,

222 
	gpivÙ_roÙ
 = 217,

223 
	gmšcÜe
 = 218,

224 
	gmadvi£
 = 219,

225 
	gg‘d’ts64
 = 220,

226 
	gfú64
 = 221,

227 
	gg‘tid
 = 224,

228 
	g»adah—d
 = 225,

229 
	g£tx©Œ
 = 226,

230 
	gl£tx©Œ
 = 227,

231 
	gf£tx©Œ
 = 228,

232 
	gg‘x©Œ
 = 229,

233 
	glg‘x©Œ
 = 230,

234 
	gfg‘x©Œ
 = 231,

235 
	gli¡x©Œ
 = 232,

236 
	gÎi¡x©Œ
 = 233,

237 
	gæi¡x©Œ
 = 234,

238 
	g»movex©Œ
 = 235,

239 
	gÌemovex©Œ
 = 236,

240 
	gäemovex©Œ
 = 237,

241 
	gtkl
 = 238,

242 
	g£ndfe64
 = 239,

243 
	gfu‹x
 = 240,

244 
	gsched_£ffš™y
 = 241,

245 
	gsched_g‘affš™y
 = 242,

246 
	g£t_th»ad_¬—
 = 243,

247 
	gg‘_th»ad_¬—
 = 244,

248 
	gio_£tup
 = 245,

249 
	gio_de¡roy
 = 246,

250 
	gio_g‘ev’ts
 = 247,

251 
	gio_subm™
 = 248,

252 
	gio_ÿnûl
 = 249,

253 
	gçdvi£64
 = 250,

254 
	gex™_group
 = 252,

255 
	glookup_dcook›
 = 253,

256 
	g•Şl_ü—‹
 = 254,

257 
	g•Şl_ùl
 = 255,

258 
	g•Şl_wa™
 = 256,

259 
	g»m­_fe_·ges
 = 257,

260 
	g£t_tid_add»ss
 = 258,

261 
	gtim”_ü—‹
 = 259,

262 
	gtim”_£‰ime
 = 260,

263 
	gtim”_g‘time
 = 261,

264 
	gtim”_g‘ov”run
 = 262,

265 
	gtim”_d–‘e
 = 263,

266 
	gşock_£‰ime
 = 264,

267 
	gşock_g‘time
 = 265,

268 
	gşock_g‘»s
 = 266,

269 
	gşock_Çno¦“p
 = 267,

270 
	g¡©fs64
 = 268,

271 
	gf¡©fs64
 = 269,

272 
	gtgkl
 = 270,

273 
	gutimes
 = 271,

274 
	gçdvi£64_64
 = 272,

275 
	gv£rv”
 = 273,

276 
	gmbšd
 = 274,

277 
	gg‘_mempŞicy
 = 275,

278 
	g£t_mempŞicy
 = 276,

279 
	gmq_İ’
 = 277,

280 
	gmq_uÆšk
 = 278,

281 
	gmq_timed£nd
 = 279,

282 
	gmq_timed»ûive
 = 280,

283 
	gmq_nÙify
 = 281,

284 
	gmq_g‘£‰r
 = 282,

285 
	gkexec_lßd
 = 283,

286 
	gwa™id
 = 284,

287 
	gadd_key
 = 286,

288 
	g»que¡_key
 = 287,

289 
	gkeyùl
 = 288,

290 
	giİrio_£t
 = 289,

291 
	giİrio_g‘
 = 290,

292 
	gšÙify_š™
 = 291,

293 
	gšÙify_add_w©ch
 = 292,

294 
	gšÙify_rm_w©ch
 = 293,

295 
	gmig¿‹_·ges
 = 294,

296 
	gİ’©
 = 295,

297 
	gmkdœ©
 = 296,

298 
	gmknod©
 = 297,

299 
	gfchowÇt
 = 298,

300 
	gfutime§t
 = 299,

301 
	gf¡©©64
 = 300,

302 
	guÆšk©
 = 301,

303 
	g»Çm—t
 = 302,

304 
	glšk©
 = 303,

305 
	gsymlšk©
 = 304,

306 
	g»adlšk©
 = 305,

307 
	gfchmod©
 = 306,

308 
	gçcûs§t
 = 307,

309 
	gp£Ëù6
 = 308,

310 
	gµŞl
 = 309,

311 
	gunsh¬e
 = 310,

312 
	g£t_robu¡_li¡
 = 311,

313 
	gg‘_robu¡_li¡
 = 312,

314 
	g¥liû
 = 313,

315 
	gsync_fe_¿nge
 = 314,

316 
	g‹e
 = 315,

317 
	gvm¥liû
 = 316,

318 
	gmove_·ges
 = 317,

319 
	gg‘ıu
 = 318,

320 
	g•Şl_pwa™
 = 319,

321 
	gutim’§t
 = 320,

322 
	gsigÇlfd
 = 321,

323 
	gtim”fd_ü—‹
 = 322,

324 
	gev’tfd
 = 323,

325 
	gçÎoÿ‹
 = 324,

326 
	gtim”fd_£‰ime
 = 325,

327 
	gtim”fd_g‘time
 = 326,

328 
	gsigÇlfd4
 = 327,

329 
	gev’tfd2
 = 328,

330 
	g•Şl_ü—‹1
 = 329,

331 
	gdup3
 = 330,

332 
	gpe2
 = 331,

333 
	gšÙify_š™1
 = 332,

334 
	g´—dv
 = 333,

335 
	gpwr™ev
 = 334,

336 
	g´lim™64
 = 340,

337 
	gÇme_to_hªdË_©
 = 341,

338 
	gİ’_by_hªdË_©
 = 342,

339 
	gşock_adjtime
 = 343,

340 
	gsyncfs
 = 344,

341 
	g£ndmmsg
 = 345,

342 
	g£Šs
 = 346,

343 
	g´oûss_vm_»adv
 = 347,

344 
	g´oûss_vm_wr™ev
 = 348,

345 
	gkcmp
 = 349,

346 
	gfš™_moduË
 = 350,

347 
	gsched_£‰r
 = 351,

348 
	gsched_g‘©Œ
 = 352,

349 
	g»Çm—t2
 = 353,

350 
	g£ccomp
 = 354,

351 
	gg‘¿ndom
 = 355,

352 
	gmemfd_ü—‹
 = 356,

353 
	gbpf
 = 357,

357  
	gÄ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/methods.lua

1 -- 
this
 
ü—‹s
 
ty³s
 
w™h
 
	gm‘hods


2 -- 
ÿÂÙ
 dØ
this
 
š
 
ty³s
 
as
 
the
 
funùiÚs
 
have
 
nÙ
 
b“n
 
defšed
 
y‘
 (a 
they
 
d•’d
 
Ú
ypes)

3 -- 
w–l
 
we
 
	gcould
, 
by
 
·ssšg
 
š
 
the
 
em±y
 
bË
 
	gS
, 
but
 
this
 
is
 
mÜe
 
moduÏr


5 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

6 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

7 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

8 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

9 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

10 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


12 
loÿl
 
funùiÚ
 
	$š™
(
S
)

14 
loÿl
 
abi
 = 
S
.abi

16 
loÿl
 
c
 = 
S
.c

17 
loÿl
 
ty³s
 = 
S
.types

18 
loÿl
 
t
, 
s
, 
±
 = 
ty³s
.t,ypes.s,ypes.pt

20 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

22 
loÿl
 
ffi
 = 
»quœe
 "ffi"

24 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

26 
loÿl
 
g‘fd
, 
i¡y³
, 
mkty³
 = 
h
.getfd, h.istype, h.mktype

28 
loÿl
 
funùiÚ
 
	$m‘©y³
(

, 
mt
)

29 
abi
.
rumpâ
 
th’
 

 =‡bi.
	$rumpâ
(

è
’d


30  
ffi
.
	$m‘©y³
(

, 
mt
)

31 
’d


33 -- 
—s›r
 
š‹rçûs
 
to
 
some
 
funùiÚs
 
th©
 
¬e
 
š
 
commÚ
 
u£
 
TODO
 
Ãw
 
fú
 
code
 
should
 
make
ƒasier

34 
loÿl
 
funùiÚ
 
	$nÚblock
(
fd
)

35 
loÿl
 
æ
, 
”r
 = 
S
.
	$fú
(
fd
, 
c
.
F
.
GETFL
)

36 
nÙ
 
æ
 
th’
  
n
, 
”r
 
’d


37 
æ
, 
”r
 = 
S
.
	`fú
(
fd
, 
c
.
F
.
SETFL
, c.
	`O
(fl, "nonblock"))

38 
nÙ
 
æ
 
th’
  
n
, 
”r
 
’d


39  
Œue


40 
’d


42 
loÿl
 
funùiÚ
 
	$block
(
fd
)

43 
loÿl
 
æ
, 
”r
 = 
S
.
	$fú
(
fd
, 
c
.
F
.
GETFL
)

44 
nÙ
 
æ
 
th’
  
n
, 
”r
 
’d


45 
æ
, 
”r
 = 
S
.
	`fú
(
fd
, 
c
.
F
.
SETFL
, c.
	`O
(fl, "~nonblock"))

46 
nÙ
 
æ
 
th’
  
n
, 
”r
 
’d


47  
Œue


48 
’d


50 
loÿl
 
funùiÚ
 
	$‹Î
(
fd
è 
S
.
	$l£ek
(
fd
, 0, 
c
.
SEEK
.
CUR
è
’d


52 -- 
somewh©
 
cÚfusšg
 
now
 
we
 
have
 
æock
 
too
. 
I
 
thšk
 
this
 
comes
 
äom
 
nixio
.

53 
loÿl
 
funùiÚ
 
	$lockf
(
fd
, 
cmd
, 
Ën
)

54 
cmd
 = 
c
.
LOCKF
[cmd]

55 
cmd
 =ğ
c
.
LOCKF
.
LOCK
 
th’


56  
S
.
	`fú
(
fd
, 
c
.
F
.
SETLKW
, {
l_ty³
 = c.
FCNTL_LOCK
.
WRLCK
, 
l_wh’û
 = c.
SEEK
.
CUR
, 
l_¡¬t
 = 0, 
l_Ën
 = 
Ën
})

57 
–£if
 
	gcmd
 =ğ
c
.
LOCKF
.
TLOCK
 
th’


58  
S
.
fú
(
fd
, 
c
.
F
.
SETLK
, {
l_ty³
 = c.
FCNTL_LOCK
.
WRLCK
, 
l_wh’û
 = c.
SEEK
.
CUR
, 
l_¡¬t
 = 0, 
l_Ën
 = 
Ën
})

59 
–£if
 
	gcmd
 =ğ
c
.
LOCKF
.
ULOCK
 
th’


60  
S
.
fú
(
fd
, 
c
.
F
.
SETLK
, {
l_ty³
 = c.
FCNTL_LOCK
.
UNLCK
, 
l_wh’û
 = c.
SEEK
.
CUR
, 
l_¡¬t
 = 0, 
l_Ën
 = 
Ën
})

61 
–£if
 
	gcmd
 =ğ
c
.
LOCKF
.
TEST
 
th’


62 
loÿl
 
»t
, 
	g”r
 = 
S
.
fú
(
fd
, 
c
.
F
.
GETLK
, {
l_ty³
 = c.
FCNTL_LOCK
.
WRLCK
, 
l_wh’û
 = c.
SEEK
.
CUR
, 
l_¡¬t
 = 0, 
l_Ën
 = 
Ën
})

63 
nÙ
 
»t
 
th’
  
	gn
, 
”r
 
’d


64  
	g»t
.
	gl_ty³
 =ğ
c
.
FCNTL_LOCK
.
UNLCK


65 
’d


66 
’d


68 -- 
m‘hods
 
Ú
 
ª
 
fd


69 -- 
nÙe
 
could
 
¥l™
, 
so
 
a
 
sock‘
 
dÛs
 
nÙ
 
have
 
m‘hods
 
Úly
 
­´İrŸ‹
 ¨
	gfe
; 
som‘imes
 
you
 dØnÙ 
know
 
wh©
 
ty³
 
ª
 
fd
 
is


70 
loÿl
 
	gfdm‘hods
 = {'dup', 'dup2', 'dup3', 'read', 'write', 'pread', 'pwrite',

87 'fchæags', 'fchroÙ', 'fsync_¿nge', 'kev’t', '·cû±', 'fkŒaû', -- 
bsd
 
Úly


88 'pdg‘pid', 'pdkl' -- 
ä“bsd
 
Úly


90 
loÿl
 
fm‘h
 = {}

91 
_
, 
v
 
š
 
	$aœs
(
fdm‘hods
èdØ
fm‘h
[
v
] = 
S
[v] 
’d


93 -- 
defšed
 
above


94 
fm‘h
.
block
 = block

95 
fm‘h
.
nÚblock
 =‚onblock

96 
fm‘h
.
‹Î
 =ell

97 
fm‘h
.
lockf
 =†ockf

99 -- 
fd
 
nÙ
 
fœ¡
 
¬gum’t


100 
fm‘h
.
mm­
 = 
	$funùiÚ
(
fd
, 
addr
, 
Ëngth
, 
´Ù
, 
æags
, 
off£t
è 
S
.
	$mm­
(
addr
, 
Ëngth
, 
´Ù
, 
æags
, 
fd
, 
off£t
è
’d


101 
S
.
bšd©
 
th’
 
fm‘h
.bšd© = 
	$funùiÚ
(
s
, 
dœfd
, 
addr
, 
add¾’
è 
S
.
	$bšd©
(
dœfd
, 
s
, 
addr
, 
add¾’
è
’d
ƒnd

102 
S
.
cÚÃù©
 
th’
 
fm‘h
.cÚÃù© = 
	$funùiÚ
(
s
, 
dœfd
, 
addr
, 
add¾’
è 
S
.
	$cÚÃù©
(
dœfd
, 
s
, 
addr
, 
add¾’
è
’d
ƒnd

104 -- 
®low
 
ÿÎšg
 
w™hout
 
Ëadšg
 
f


105 
fm‘h
.
¡©
 = 
S
.
f¡©


106 
fm‘h
.
chdœ
 = 
S
.
fchdœ


107 
fm‘h
.
sync
 = 
S
.
fsync


108 
fm‘h
.
d©async
 = 
S
.
fd©async


109 
fm‘h
.
chmod
 = 
S
.
fchmod


110 
fm‘h
.
£tx©Œ
 = 
S
.
f£tx©Œ


111 
fm‘h
.
g‘x©Œ
 = 
S
.
g£tx©Œ


112 
fm‘h
.
Œunÿ‹
 = 
S
.
árunÿ‹


113 
fm‘h
.
¡©fs
 = 
S
.
f¡©fs


114 
fm‘h
.
utim’s
 = 
S
.
futim’s


115 
fm‘h
.
utimes
 = 
S
.
futimes


116 
fm‘h
.
£ek
 = 
S
.
l£ek


117 
fm‘h
.
chown
 = 
S
.
fchown


118 
fm‘h
.
lock
 = 
S
.
æock


119 
fm‘h
.
·thcÚf
 = 
S
.
å©hcÚf


120 -- 
Ãtbsd
 
Úly


121 
fm‘h
.
chæags
 = 
S
.
fchæags


122 
fm‘h
.
chroÙ
 = 
S
.
fchroÙ


123 
fm‘h
.
sync_¿nge
 = 
S
.
fsync_¿nge


124 
fm‘h
.
kŒaû
 = 
S
.
fkŒaû


125 -- 
no
 
pošt
 
havšg
 
fd
 
š
 
Çme
 - 
bsd
 
Úly


126 
fm‘h
.
ex‰r_g‘
 = 
S
.
ex‰r_g‘_fd


127 
fm‘h
.
ex‰r_£t
 = 
S
.
ex‰r_£t_fd


128 
fm‘h
.
ex‰r_d–‘e
 = 
S
.
ex‰r_d–‘e_fd


129 
fm‘h
.
ex‰r_li¡
 = 
S
.
ex‰r_li¡_fd


131 
loÿl
 
funùiÚ
 
	$nogc
(
d
è 
ffi
.
	$gc
(
d
, 
n
è
’d


133 
fm‘h
.
nogc
 =‚ogc

135 -- 
£qu’û
 
numb”
 
u£d
 
by
 
Ãšk
 
mes§ges


136 
fm‘h
.
£q
 = 
	$funùiÚ
(
fd
)

137 
fd
.
£qu’û
 = fd.sequence + 1

138  
fd
.
£qu’û


139 
’d


141 -- 
TODO
 
nÙe
 
this
 
is
 
nÙ
 
v”y
 
ä›ndly
 
to
 
u£r
, 
as
 
wl
 
ju¡
 
g‘
 
EBADF
 
äom
 
®l
 
ÿÎs


142 
funùiÚ
 
fm‘h
.
	$şo£
(
fd
)

143 
loÿl
 
f’o
 = 
	$g‘fd
(
fd
)

144 
f’o
 =ğ-1 
th’
  
Œue
 
’d
 -- 
®»ady
 
şo£d


145 
loÿl
 
ok
, 
”r
 = 
S
.
	$şo£
(
f’o
)

146 
fd
.
f’um
 = -1 -- 
make
 
su»
 
ÿÂÙ
 
accid’Îy
 
şo£
 
this
 fd 
objeù
 
agaš


147  
ok
, 
”r


148 
’d


150 
fm‘h
.
g‘fd
 = 
	$funùiÚ
(
fd
è fd.
f’um
 
’d


152 
t
.
fd
 = 
	`m‘©y³
("struct {int filenum; int sequence;}", {

153 
__šdex
 = 
fm‘h
,

154 
__gc
 = 
fm‘h
.
şo£
,

155 
__Ãw
 = 
	`funùiÚ
(

, 
i
)

156  
	`i¡y³
(

, 
i
è
Ü
 
ffi
.
	`Ãw
(tp, i or -1)

157 
’d
,

158 
	}
})

160 
	gS
.
	g¡dš
 = 
t
.
	$fd
(
c
.
STD
.
IN
):
	$nogc
()

161 
S
.
¡dout
 = 
t
.
	$fd
(
c
.
STD
.
OUT
):
	$nogc
()

162 
S
.
¡d”r
 = 
t
.
	$fd
(
c
.
STD
.
ERR
):
	$nogc
()

164 
S
.
mq_İ’
 
th’
 -- 
TODO
 
b‘‹r
 
‹¡
. TODO 
suµÜt
 
š
 
BSD


165 
loÿl
 
mqm‘h
 = {

166 
şo£
 = 
fm‘h
.close,

167 
nogc
 =‚ogc,

168 
g‘fd
 = 
	`funùiÚ
(
fd
è fd.
f’um
 
’d
,

169 
g‘©Œ
 = 
	`funùiÚ
(
mqd
, 
©Œ
)

170 
©Œ
 =‡‰¸
Ü
 
t
.
	`mq_©Œ
()

171 
loÿl
 
ok
, 
”r
 = 
S
.
	`mq_g‘£‰r
(
mqd
, 
n
, 
©Œ
)

172 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


173  
©Œ


174 
’d
,

175 
£‰r
 = 
	`funùiÚ
(
mqd
, 
©Œ
)

176 
	`ty³
(
©Œ
è=ğ"numb”" 
Ü
y³×‰rè=ğ"¡ršg" 
th’
‡‰¸ğ{
æags
 =‡‰r} 
’d
 -- 
Úly
 fÏg 
ÿn
 
be
 
£t
 
so
 
®low
 
this


177 
©Œ
 = 
	`mkty³
(
t
.
mq_©Œ
,‡ttr)

178  
S
.
	`mq_g‘£‰r
(
mqd
, 
©Œ
, 
n
)

179 
’d
,

180 
timed£nd
 = 
S
.
mq_timed£nd
,

181 
£nd
 = 
	`funùiÚ
(
mqd
, 
msg_±r
, 
msg_Ën
, 
msg_´io
è 
S
.
	`mq_timed£nd
(mqd, msg_±r, msg_Ën, msg_´ioè
’d
,

182 
timed»ûive
 = 
S
.
mq_timed»ûive
,

183 
»ûive
 = 
	`funùiÚ
(
mqd
, 
msg_±r
, 
msg_Ën
, 
msg_´io
è 
S
.
	`mq_timed»ûive
(mqd, msg_±r, msg_Ën, msg_´ioè
’d
,

184 
	}
}

186 
	gt
.
	gmqd
 = 
m‘©y³
("struct {mqd_t filenum;}", {

187 
__šdex
 = 
mqm‘h
,

188 
__gc
 = 
mqm‘h
.
şo£
,

189 
__Ãw
 = 
funùiÚ
(

, 
i
)

190  
i¡y³
(

, 
i
è
Ü
 
ffi
.
Ãw
(tp, i or -1)

191 
’d
,

193 
	g’d


195 -- 
TODO
 
d—l
 
w™h
 
d–‘e
 
twiû
 
issue
 w™h d–‘
ªd
 
gc


196 
	gt
.
	gtim”
 = 
m‘©y³
("struct {timer_timerid[1];}", {

197 
__šdex
 = {

198 
g‘tim”p
 = 
funùiÚ
(
£lf
è s–f.
tim”id
 
’d
,

199 
g‘tim”
 = 
funùiÚ
(
£lf
è s–f.
tim”id
[0] 
’d
,

200 
£‰ime
 = 
S
.
tim”_£‰ime
,

201 
g‘time
 = 
S
.
tim”_g‘time
,

202 
d–‘e
 = 
S
.
tim”_d–‘e
,

203 
g‘ov”run
 = 
S
.
tim”_g‘ov”run
,

205 --
__gc
 = 
S
.
tim”_d–‘e
,

208 
	gabi
.
	gos
 =ğ"lšux" 
th’


209 -- 
Lšux
 
³rfÜmªû
 
mÚ™Üšg
 
»ad”


210 
t
.
³rf_»ad”
 = 
m‘©y³
("struct {int fd; char *map; size_t map_pages; }", {

211 
__Ãw
 = 
funùiÚ
 (
ù
, 
fd
)

212 
nÙ
 
fd
 
th’
  
ffi
.
Ãw
(
ù
è
’d


213 
i¡y³
(
t
.
fd
, fdè
th’
 fd = fd:
nogc
():
g‘fd
(è
’d


214  
ffi
.
Ãw
(
ù
, 
fd
)

215 
’d
,

216 
__Ën
 = 
funùiÚ
(
t
è 
ffi
.Ñè
’d
,

217 
__gc
 = 
funùiÚ
 (
t
èt:
şo£
(è
’d
,

218 
__šdex
 = {

219 
şo£
 = 
funùiÚ
(
t
)

220 
t
:
munm­
()

221 
t
.
fd
 > 0 
th’
 
S
.
şo£
Ñ.fdè
’d


222 
’d
,

223 
munm­
 = 
funùiÚ
 (
t
)

224 
t
.
m­_·ges
 > 0 
th’


225 
S
.
munm­
(
t
.
m­
, (t.
m­_·ges
 + 1è* S.
g‘·gesize
())

226 
t
.
m­_·ges
 = 0

227 
’d


228 
’d
,

229 -- 
»ad
(2è
š‹rçû
, 
£e
 `
³rf_©Œ
.
»ad_fÜm©
`

230 -- @ 
u64
 
Ü
 
ª
 
¬¿y
 
of
 u64

231 
»ad
 = 
funùiÚ
 (
t
, 
Ën
)

232 
loÿl
 
rv®s
 = 
ffi
.
Ãw
('uint64_t [4]')

233 
loÿl
 
nb
, 
”r
 = 
S
.
»ad
(
t
.
fd
, 
rv®s
, 
Ën
 
Ü
 
ffi
.(rvals))

234 
nÙ
 
nb
 
th’
  
n
, 
”r
 
’d


235  
nb
 =ğ8 
ªd
 
rv®s
[0] 
Ü
„vals

236 
’d
,

237 -- 
mm­
(2è
š‹rçû
, 
£e
 
§m¶šg
 iÁ”çû (`
³rf_©Œ
.
§m¶e_ty³
` 
ªd
 `perf_attr.mmap`)

238 -- 
fœ¡
 
·ge
 
is
 
m‘ad©a
…age, 
the
 
Ùh”s
 
¬e
 
§m¶e_ty³
 
d•’d’t


239 
mm­
 = 
funùiÚ
 (
t
, 
·ges
)

240 
t
:
munm­
()

241 
·ges
 =…age 
Ü
 8

242 
loÿl
 
m­
, 
”r
 = 
S
.
mm­
(
n
, (
·ges
 + 1è* S.
g‘·gesize
(), "»ad, wr™e", "sh¬ed", 
t
.
fd
, 0)

243 
nÙ
 
m­
 
th’
  
n
, 
”r
 
’d


244 
t
.
m­
 = map

245 
t
.
m­_·ges
 = 
·ges


246  
·ges


247 
’d
,

248 
m‘a
 = 
funùiÚ
 (
t
)

249  
t
.
m­_·ges
 > 0 
ªd
 
ffi
.
ÿ¡
("¡ruù…”f_ev’t_mm­_·g*",.
m­
è
Ü
 
n


250 
’d
,

251 -- 
Ãxt
(è
funùiÚ
 
__aœs
 
»tuºšg
 (
Ën
, 
ev’t
è
·œs


252 -- 
™
 
Úly
 
»tœes
 
»ad
 
ev’ts
 
wh’
 
cu¼’t
 
ev’t
 
Ëngth
 
is
 
·s£d


253 
Ãxt
 = 
funùiÚ
 (
t
, 
cu¾’
)

254 
loÿl
 
bufãr_size
 = 
S
.
g‘·gesize
(è* 
t
.
m­_·ges


255 
loÿl
 
ba£
 = 
t
.
m­
 + 
S
.
g‘·gesize
()

256 
loÿl
 
m‘a
 = 
t
:meta()

257 -- 
R‘œe
 
Ï¡
 
»ad
 
ev’t
 
Ü
 
¡¬t
 
™”©šg


258 
cu¾’
 
th’


259 
m‘a
.
d©a_
 = m‘a.d©a_ + 
cu¾’


260 
’d


261 -- 
End
 
of
 
ršg
 
bufãr
, 
y›ld


262 -- 
TODO
: <
š£¹
 
memÜy
 
b¬r›r
 
h”e
>

263 
m‘a
.
d©a_h—d
 =ğm‘a.
d©a_
 
th’


265 
’d


266 
loÿl
 
e
 = 
±
.
³rf_ev’t_h—d”
(
ba£
 + (
m‘a
.
d©a_
 % 
bufãr_size
))

267 
loÿl
 
e_’d
 = 
ba£
 + (
m‘a
.
d©a_
 + 
e
.
size
è% 
bufãr_size
;

268 -- 
If
 
the
 
³rf
 
ev’t
 
w¿ps
 
¬ound
h
ršg
, 
we
 
Ãed
 
to
 
make
 
a
 
cÚtiguous
 
cİy


269 
ffi
.
ÿ¡
("ušŒ_t", 
e_’d
è< ffi.ÿ¡("ušŒ_t", 
e
è
th’


270 
loÿl
 
tmp_e
 = 
ffi
.
Ãw
("ch¬ [?]", 
e
.
size
)

271 
loÿl
 
Ën
 = (
ba£
 + 
bufãr_size
è- 
ffi
.
ÿ¡
('ch¬ *', 
e
)

272 
ffi
.
cİy
(
tmp_e
, 
e
, 
Ën
)

273 
ffi
.
cİy
(
tmp_e
 + 
Ën
, 
ba£
, 
e
.
size
 -†en)

274 
e
 = 
ffi
.
ÿ¡
(ffi.
ty³of
Ó), 
tmp_e
)

275 
’d


276  
e
.
size
,ƒ

277 
’d
,

278 -- 
V¬ious
 
ioùl
(è
w¿µ”s


279 
ioùl
 = 
funùiÚ
(
t
, 
cmd
, 
v®
è 
S
.ioùlÑ.
fd
, cmd, v® 
Ü
 0è
’d
,

280 
¡¬t
 = 
funùiÚ
(
t
è:
ioùl
("PERF_EVENT_IOC_ENABLE"è
’d
,

281 
¡İ
 = 
funùiÚ
(
t
è:
ioùl
("PERF_EVENT_IOC_DISABLE"è
’d
,

282 
»äesh
 = 
funùiÚ
(
t
è:
ioùl
("PERF_EVENT_IOC_REFRESH"è
’d
,

283 
»£t
 = 
funùiÚ
(
t
è:
ioùl
("PERF_EVENT_IOC_RESET"è
’d
,

284 
£tf‹r
 = 
funùiÚ
(
t
, 
v®
è:
ioùl
("PERF_EVENT_IOC_SET_FILTER", v®è
’d
,

285 
£tbpf
 = 
funùiÚ
(
t
, 
fd
è:
ioùl
("PERF_EVENT_IOC_SET_BPF", 
±
.(fd)è
’d
,

287 
__aœs
 = 
funùiÚ
(
t
è.
Ãxt
,, 
n
 
’d


289 
	g’d


291 -- 
TODO
 
»š¡©e
 
	gthis
, 
mÜe
 
like
 
fd
 
	gis
, 
h’û
 
chªges
 
to
 
	gde¡roy


293 
t
.
aio_cÚ‹xt
 = 
m‘©y³
("struct {aio_context_t ctx;}", {

294 
__šdex
 = {
de¡roy
 = 
S
.
io_de¡roy
, 
subm™
 = S.
io_subm™
, 
g‘ev’ts
 = S.
io_g‘ev’ts
, 
ÿnûl
 = S.
io_ÿnûl
, 
nogc
 =‚ogc},

295 
__gc
 = 
S
.
io_de¡roy


299  
S


301 
’d


303  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/c.lua

1 -- 
This
 
£ts
 
up
 
the
 
bË
 
of
 
C
 
funùiÚs
 
	gBSD


2 -- 
We
 
Ãed
 
to
 
ov”ride
 
funùiÚs
 
th©
 
¬e
 
v”siÚed
 
as
 
the
 
Şd
 
Úes
 
£Ëùed
 
Ùh”wi£


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

13 
loÿl
 
v”siÚ
 = 
»quœe
 "syscall.netbsd.version".version

15 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
funùiÚ
 
	$šlibc_â
(
k
è 
ffi
.
C
[k] 
’d


19 -- 
SysÿÎs
 
th©
 
ju¡
  
ENOSYS
 
but
 
¬e
 
š
 
libc
.

20 
loÿl
 
nosys_ÿÎs


21 
v”siÚ
 =ğ6 
th’
 
nosys_ÿÎs
 = {

22 
İ’©
 = 
Œue
,

23 
çcûs§t
 = 
Œue
,

24 
symlšk©
 = 
Œue
,

25 
mkdœ©
 = 
Œue
,

26 
uÆšk©
 = 
Œue
,

27 
»Çm—t
 = 
Œue
,

28 
f¡©©
 = 
Œue
,

29 
fchmod©
 = 
Œue
,

30 
fchowÇt
 = 
Œue
,

31 
mkfifßt
 = 
Œue
,

32 
mknod©
 = 
Œue
,

33 
	}
}

34 
’d


36 
loÿl
 
	gC
 = 
£tm‘©abË
({}, {

37 
__šdex
 = 
funùiÚ
(
C
, 
k
)

38 
nosys_ÿÎs
 
ªd
‚osys_ÿÎs[
k
] 
th’
  
n
 
’d


39 
pÿÎ
(
šlibc_â
, 
k
è
th’


40 
C
[
k
] = 
ffi
.C[k] -- 
add
 
to
 
bË
, 
so
 
no
 
Ãed
 
this
 
¦ow
 
·th
 
agaš


41  
C
[
k
]

43  
n


44 
’d


45 
’d


48 -- 
N‘BSD
 
we
 
u£
 
libc
 
Çmes
 
nÙ
 
	gsysÿÎs
, 
as
 
assume
 
you
 
wl
 
have
†ibø
lšked
 
Ü
 
¡©iÿÎy
†šked 
w™h
 
®l
 
symbŞs
 
	gexpÜ‹d
.

49 -- 
this
 
is
 
so
 
we
 
ÿn
 
u£
 
N‘BSD
 
libc
 
ev’
 
wh”e
 
sysÿÎs
 
have
 
b“n
 
»dœeùed
 
to
 
rump
 
	gÿÎs
.

51 -- 
u£
 
Ãw
 
v”siÚs


52 
	gC
.
	gmouÁ
 = 
C
.
__mouÁ50


53 
C
.
¡©
 = C.
__¡©50


54 
C
.
f¡©
 = C.
__f¡©50


55 
C
.
l¡©
 = C.
__l¡©50


56 
C
.
g‘d’ts
 = C.
__g‘d’ts30


57 
C
.
sock‘
 = C.
__sock‘30


58 
C
.
£Ëù
 = C.
__£Ëù50


59 
C
.
p£Ëù
 = C.
__p£Ëù50


60 
C
.
fhİ’
 = C.
__fhİ’40


61 
C
.
fh¡©
 = C.
__fh¡©50


62 
C
.
fh¡©vfs1
 = C.
__fh¡©vfs140


63 
C
.
utimes
 = C.
__utimes50


64 
C
.
posix_çdvi£
 = C.
__posix_çdvi£50


65 
C
.
lutimes
 = C.
__lutimes50


66 
C
.
futimes
 = C.
__futimes50


67 
C
.
g‘fh
 = C.
__g‘fh30


68 
C
.
kev’t
 = C.
__kev’t50


69 
C
.
mknod
 = C.
__mknod50


70 
C
.
pŞÉs
 = C.
__pŞÉs50


72 
C
.
g‘timeofday
 = C.
__g‘timeofday50


73 
C
.
£‰imeofday
 = C.
__£‰imeofday50


74 
C
.
adjtime
 = C.
__adjtime50


75 
C
.
£t™im”
 = C.
__£t™im”50


76 
C
.
g‘™im”
 = C.
__g‘™im”50


77 
C
.
şock_g‘time
 = C.
__şock_g‘time50


78 
C
.
şock_£‰ime
 = C.
__şock_£‰ime50


79 
C
.
şock_g‘»s
 = C.
__şock_g‘»s50


80 
C
.
Çno¦“p
 = C.
__Çno¦“p50


81 
C
.
tim”_£‰ime
 = C.
__tim”_£‰ime50


82 
C
.
tim”_g‘time
 = C.
__tim”_g‘time50


84 -- 
u£
 
und”lyšg
 
sysÿÎ
 
nÙ
 
w¿µ”


85 
C
.
g‘cwd
 = C.
__g‘cwd


87 
C
.
sigaùiÚ
 = C.
__libc_sigaùiÚ14
 -- 
TODO
 
nÙ
 
wÜkšg
 
I
 
thšk
 
Ãed
 
to
 
u£
 
Œamp_sigaùiÚ
, 
£e
 
®so
 
Ãtbsd
 
	$·u£
()

89  
C


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/constants.lua

1 -- 
bËs
 
of
 
cÚ¡ªts
 
N‘BSD


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

14 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

16 
loÿl
 
où®
, 
	gmuÉiæags
, 
	gch¬æags
, 
	gsw­æags
, 
	g¡ræag
, 
	g©æag
, 
	gmodeæags


17 ğ
h
.
où®
, 
	gh
.
	gmuÉiæags
, h.
	gch¬æags
, h.
	gsw­æags
, h.
	g¡ræag
, h.
	g©æag
, h.
modeæags


19 
loÿl
 
	gc
 = {}

21 
c
.
”rÜÇmes
 = 
»quœe
 "syscall.netbsd.errors"

23 
c
.
SYS
 = 
»quœe
 "syscall.netbsd.nr".SYS

25 
c
.
IFNAMSIZ
 = 16

27 
c
.
STD
 = 
¡ræag
 {

28 
IN_FILENO
 = 0,

29 
	gOUT_FILENO
 = 1,

30 
	gERR_FILENO
 = 2,

31 
	gIN
 = 0,

32 
	gOUT
 = 1,

33 
	gERR
 = 2,

36 
	gc
.
	gPATH_MAX
 = 1024

38 
c
.
E
 = 
¡ræag
 {

39 
PERM
 = 1,

40 
	gNOENT
 = 2,

41 
	gSRCH
 = 3,

42 
	gINTR
 = 4,

43 
	gIO
 = 5,

44 
	gNXIO
 = 6,

46 
	gNOEXEC
 = 8,

47 
	gBADF
 = 9,

48 
	gCHILD
 = 10,

49 
	gDEADLK
 = 11,

50 
	gNOMEM
 = 12,

51 
	gACCES
 = 13,

52 
	gFAULT
 = 14,

53 
	gNOTBLK
 = 15,

54 
	gBUSY
 = 16,

55 
	gEXIST
 = 17,

56 
	gXDEV
 = 18,

57 
	gNODEV
 = 19,

58 
	gNOTDIR
 = 20,

59 
	gISDIR
 = 21,

60 
	gINVAL
 = 22,

61 
	gNFILE
 = 23,

62 
	gMFILE
 = 24,

63 
	gNOTTY
 = 25,

64 
	gTXTBSY
 = 26,

65 
	gFBIG
 = 27,

66 
	gNOSPC
 = 28,

67 
	gSPIPE
 = 29,

68 
	gROFS
 = 30,

69 
	gMLINK
 = 31,

70 
	gPIPE
 = 32,

71 
	gDOM
 = 33,

72 
	gRANGE
 = 34,

73 
	gAGAIN
 = 35,

74 
	gINPROGRESS
 = 36,

75 
	gALREADY
 = 37,

76 
	gNOTSOCK
 = 38,

77 
	gDESTADDRREQ
 = 39,

78 
	gMSGSIZE
 = 40,

79 
	gPROTOTYPE
 = 41,

80 
	gNOPROTOOPT
 = 42,

81 
	gPROTONOSUPPORT
= 43,

82 
	gSOCKTNOSUPPORT
= 44,

83 
	gOPNOTSUPP
 = 45,

84 
	gPFNOSUPPORT
 = 46,

85 
	gAFNOSUPPORT
 = 47,

86 
	gADDRINUSE
 = 48,

87 
	gADDRNOTAVAIL
 = 49,

88 
	gNETDOWN
 = 50,

89 
	gNETUNREACH
 = 51,

90 
	gNETRESET
 = 52,

91 
	gCONNABORTED
 = 53,

92 
	gCONNRESET
 = 54,

93 
	gNOBUFS
 = 55,

94 
	gISCONN
 = 56,

95 
	gNOTCONN
 = 57,

96 
	gSHUTDOWN
 = 58,

97 
	gTOOMANYREFS
 = 59,

98 
	gTIMEDOUT
 = 60,

99 
	gCONNREFUSED
 = 61,

100 
	gLOOP
 = 62,

101 
	gNAMETOOLONG
 = 63,

102 
	gHOSTDOWN
 = 64,

103 
	gHOSTUNREACH
 = 65,

104 
	gNOTEMPTY
 = 66,

105 
	gPROCLIM
 = 67,

106 
	gUSERS
 = 68,

107 
	gDQUOT
 = 69,

108 
	gSTALE
 = 70,

109 
	gREMOTE
 = 71,

110 
	gBADRPC
 = 72,

111 
	gRPCMISMATCH
 = 73,

112 
	gPROGUNAVAIL
 = 74,

113 
	gPROGMISMATCH
 = 75,

114 
	gPROCUNAVAIL
 = 76,

115 
	gNOLCK
 = 77,

116 
	gNOSYS
 = 78,

117 
	gFTYPE
 = 79,

118 
	gAUTH
 = 80,

119 
	gNEEDAUTH
 = 81,

120 
	gIDRM
 = 82,

121 
	gNOMSG
 = 83,

122 
	gOVERFLOW
 = 84,

123 
	gILSEQ
 = 85,

124 
	gNOTSUP
 = 86,

125 
	gCANCELED
 = 87,

126 
	gBADMSG
 = 88,

127 
	gNODATA
 = 89,

128 
	gNOSR
 = 90,

129 
	gNOSTR
 = 91,

130 
	gTIME
 = 92,

131 
	gNOATTR
 = 93,

132 
	gMULTIHOP
 = 94,

133 
	gNOLINK
 = 95,

134 
	gPROTO
 = 96,

137 -- 
®‹º©e
 
Çmes


138 
	gc
.
	gEALIAS
 = {

139 
WOULDBLOCK
 = 
c
.
E
.
AGAIN
,

142 
	gc
.
	gAF
 = 
¡ræag
 {

143 
UNSPEC
 = 0,

144 
	gLOCAL
 = 1,

145 
	gINET
 = 2,

146 
	gIMPLINK
 = 3,

147 
	gPUP
 = 4,

148 
	gCHAOS
 = 5,

149 
	gNS
 = 6,

150 
	gISO
 = 7,

151 
	gECMA
 = 8,

152 
	gDATAKIT
 = 9,

153 
	gCCITT
 = 10,

154 
	gSNA
 = 11,

155 
	gDECNET
 = 12,

156 
	gDLI
 = 13,

157 
	gLAT
 = 14,

158 
	gHYLINK
 = 15,

159 
	gAPPLETALK
 = 16,

160 
	gOROUTE
 = 17,

161 
	gLINK
 = 18,

162 - #defš
	#p£udo_AF_XTP
 19

	)

163 
	gCOIP
 = 20,

164 
	gCNT
 = 21,

165 - #defš
	#p£udo_AF_RTIP
 22

	)

166 
	gIPX
 = 23,

167 
	gINET6
 = 24,

168 -- 
	gp£udo_AF_PIP
 25

169 
	gISDN
 = 26,

170 
	gNATM
 = 27,

171 
	gARP
 = 28,

172 - #defš
	#p£udo_AF_KEY
 29

	)

173 - #defš
	#p£udo_AF_HDRCMPLT
 30

	)

174 
	gBLUETOOTH
 = 31,

175 
	gIEEE80211
 = 32,

176 
	gMPLS
 = 33,

177 
	gROUTE
 = 34,

180 
	gc
.
	gAF
.
	gUNIX
 = 
c
.
AF
.
LOCAL


181 
c
.
AF
.
OSI
 = c.AF.
ISO


182 
c
.
AF
.
E164
 = c.AF.
ISDN


184 
c
.
O
 = 
muÉiæags
 {

185 
RDONLY
 = 0x00000000,

186 
	gWRONLY
 = 0x00000001,

187 
	gRDWR
 = 0x00000002,

188 
	gACCMODE
 = 0x00000003,

189 
	gNONBLOCK
 = 0x00000004,

190 
	gAPPEND
 = 0x00000008,

191 
	gSHLOCK
 = 0x00000010,

192 
	gEXLOCK
 = 0x00000020,

193 
	gASYNC
 = 0x00000040,

194 
	gNOFOLLOW
 = 0x00000100,

195 
	gCREAT
 = 0x00000200,

196 
	gTRUNC
 = 0x00000400,

197 
	gEXCL
 = 0x00000800,

198 
	gNOCTTY
 = 0x00008000,

199 
	gDSYNC
 = 0x00010000,

200 
	gRSYNC
 = 0x00020000,

201 
	gALT_IO
 = 0x00040000,

202 
	gDIRECT
 = 0x00080000,

203 
	gDIRECTORY
 = 0x00200000,

204 
	gCLOEXEC
 = 0x00400000,

205 
	gSEARCH
 = 0x00800000,

206 
	gNOSIGPIPE
 = 0x01000000,

209 -- 
	gsigaùiÚ
, 
nÙe
 
»Çmed
 
SIGACT
 
äom
 
SIG_


210 
	gc
.
	gSIGACT
 = 
¡ræag
 {

211 
ERR
 = -1,

212 
	gDFL
 = 0,

213 
	gIGN
 = 1,

214 
	gHOLD
 = 3,

217 
	gc
.
	gSIGEV
 = 
¡ræag
 {

218 
NONE
 = 0,

219 
	gSIGNAL
 = 1,

220 
	gTHREAD
 = 2,

221 
	gSA
 = 3,

224 
	gc
.
	gSIG
 = 
¡ræag
 {

225 
HUP
 = 1,

226 
	gINT
 = 2,

227 
	gQUIT
 = 3,

228 
	gILL
 = 4,

229 
	gTRAP
 = 5,

230 
	gABRT
 = 6,

231 
	gEMT
 = 7,

232 
	gFPE
 = 8,

233 
	gKILL
 = 9,

234 
	gBUS
 = 10,

235 
	gSEGV
 = 11,

236 
	gSYS
 = 12,

237 
	gPIPE
 = 13,

238 
	gALRM
 = 14,

239 
	gTERM
 = 15,

240 
	gURG
 = 16,

241 
	gSTOP
 = 17,

242 
	gTSTP
 = 18,

243 
	gCONT
 = 19,

244 
	gCHLD
 = 20,

245 
	gTTIN
 = 21,

246 
	gTTOU
 = 22,

247 
	gIO
 = 23,

248 
	gXCPU
 = 24,

249 
	gXFSZ
 = 25,

250 
	gVTALRM
 = 26,

251 
	gPROF
 = 27,

252 
	gWINCH
 = 28,

253 
	gINFO
 = 29,

254 
	gUSR1
 = 30,

255 
	gUSR2
 = 31,

256 
	gPWR
 = 32,

259 
	gc
.
	gSIG
.
	gIOT
 = 
c
.
SIG
.
ABRT


261 -- 
sig´ocmask
 
nÙe
 
»Çmšg
 
of
 
SIG
 
to
 
SIGPM


262 
c
.
SIGPM
 = 
¡ræag
 {

263 
BLOCK
 = 1,

264 
	gUNBLOCK
 = 2,

265 
	gSETMASK
 = 3,

268 
	gc
.
	gSA
 = 
muÉiæags
 {

269 
ONSTACK
 = 0x0001,

270 
	gRESTART
 = 0x0002,

271 
	gRESETHAND
 = 0x0004,

272 
	gNOCLDSTOP
 = 0x0008,

273 
	gNODEFER
 = 0x0010,

274 
	gNOCLDWAIT
 = 0x0020,

275 
	gSIGINFO
 = 0x0040,

276 
	gNOKERNINFO
= 0x0080,

279 
	gc
.
	gEXIT
 = 
¡ræag
 {

280 
SUCCESS
 = 0,

281 
	gFAILURE
 = 1,

284 
	gc
.
	gOK
 = 
ch¬æags
 {

285 
R
 = 4,

286 
	gW
 = 2,

287 
	gX
 = 1,

288 
	gF
 = 0,

291 
	gc
.
	gMODE
 = 
modeæags
 {

292 
SUID
 = 
où®
('04000'),

293 
	gSGID
 = 
où®
('02000'),

294 
	gSTXT
 = 
où®
('01000'),

295 
	gRWXU
 = 
où®
('00700'),

296 
	gRUSR
 = 
où®
('00400'),

297 
	gWUSR
 = 
où®
('00200'),

298 
	gXUSR
 = 
où®
('00100'),

299 
	gRWXG
 = 
où®
('00070'),

300 
	gRGRP
 = 
où®
('00040'),

301 
	gWGRP
 = 
où®
('00020'),

302 
	gXGRP
 = 
où®
('00010'),

303 
	gRWXO
 = 
où®
('00007'),

304 
	gROTH
 = 
où®
('00004'),

305 
	gWOTH
 = 
où®
('00002'),

306 
	gXOTH
 = 
où®
('00001'),

309 
	gc
.
	gSEEK
 = 
¡ræag
 {

310 
SET
 = 0,

311 
	gCUR
 = 1,

312 
	gEND
 = 2,

315 
	gc
.
	gSOCK
 = 
muÉiæags
 {

316 
STREAM
 = 1,

317 
	gDGRAM
 = 2,

318 
	gRAW
 = 3,

319 
	gRDM
 = 4,

320 
	gSEQPACKET
 = 5,

322 
	gCLOEXEC
 = 0x10000000,

323 
	gNONBLOCK
 = 0x20000000,

324 
	gNOSIGPIPE
 = 0x40000000,

325 
	gFLAGS_MASK
= 0xf0000000,

328 
	gc
.
	gSOL
 = 
¡ræag
 {

329 
SOCKET
 = 0xffff,

332 
	gc
.
	gIPPROTO
 = 
¡ræag
 {

333 
IP
 = 0,

334 
	gHOPOPTS
 = 0,

335 
	gICMP
 = 1,

336 
	gIGMP
 = 2,

337 
	gGGP
 = 3,

338 
	gIPV4
 = 4,

339 
	gIPIP
 = 4,

340 
	gTCP
 = 6,

341 
	gEGP
 = 8,

342 
	gPUP
 = 12,

343 
	gUDP
 = 17,

344 
	gIDP
 = 22,

345 
	gTP
 = 29,

346 
	gIPV6
 = 41,

347 
	gROUTING
 = 43,

348 
	gFRAGMENT
 = 44,

349 
	gRSVP
 = 46,

350 
	gGRE
 = 47,

351 
	gESP
 = 50,

352 
	gAH
 = 51,

353 
	gMOBILE
 = 55,

354 
	gIPV6_ICMP
 = 58,

355 
	gICMPV6
 = 58,

356 
	gNONE
 = 59,

357 
	gDSTOPTS
 = 60,

358 
	gEON
 = 80,

359 
	gETHERIP
 = 97,

360 
	gENCAP
 = 98,

361 
	gPIM
 = 103,

362 
	gIPCOMP
 = 108,

363 
	gVRRP
 = 112,

364 
	gCARP
 = 112,

365 
	gPFSYNC
 = 240,

366 
	gRAW
 = 255,

369 
	gc
.
	gMSG
 = 
muÉiæags
 {

370 
OOB
 = 0x0001,

371 
	gPEEK
 = 0x0002,

372 
	gDONTROUTE
 = 0x0004,

373 
	gEOR
 = 0x0008,

374 
	gTRUNC
 = 0x0010,

375 
	gCTRUNC
 = 0x0020,

376 
	gWAITALL
 = 0x0040,

377 
	gDONTWAIT
 = 0x0080,

378 
	gBCAST
 = 0x0100,

379 
	gMCAST
 = 0x0200,

380 
	gNOSIGNAL
 = 0x0400,

381 
	gCMSG_CLOEXEC
 = 0x0800,

382 
	gNBIO
 = 0x1000,

385 
	gc
.
	gF
 = 
¡ræag
 {

386 
DUPFD
 = 0,

387 
	gGETFD
 = 1,

388 
	gSETFD
 = 2,

389 
	gGETFL
 = 3,

390 
	gSETFL
 = 4,

391 
	gGETOWN
 = 5,

392 
	gSETOWN
 = 6,

393 
	gGETLK
 = 7,

394 
	gSETLK
 = 8,

395 
	gSETLKW
 = 9,

396 
	gCLOSEM
 = 10,

397 
	gMAXFD
 = 11,

398 
	gDUPFD_CLOEXEC
= 12,

399 
	gGETNOSIGPIPE
= 13,

400 
	gSETNOSIGPIPE
= 14,

403 
	gc
.
	gFD
 = 
muÉiæags
 {

404 
CLOEXEC
 = 1,

407 -- 
nÙe
 
chªged
 
äom
 
F_
 
to
 
FCNTL_LOCK


408 
	gc
.
	gFCNTL_LOCK
 = 
¡ræag
 {

409 
RDLCK
 = 1,

410 
	gUNLCK
 = 2,

411 
	gWRLCK
 = 3,

414 
	gc
.
	gS_I
 = 
modeæags
 {

415 
FMT
 = 
où®
('0170000'),

416 
	gFWHT
 = 
où®
('0160000'),

417 
	gFSOCK
 = 
où®
('0140000'),

418 
	gFLNK
 = 
où®
('0120000'),

419 
	gFREG
 = 
où®
('0100000'),

420 
	gFBLK
 = 
où®
('0060000'),

421 
	gFDIR
 = 
où®
('0040000'),

422 
	gFCHR
 = 
où®
('0020000'),

423 
	gFIFO
 = 
où®
('0010000'),

424 
	gSUID
 = 
où®
('0004000'),

425 
	gSGID
 = 
où®
('0002000'),

426 
	gSTXT
 = 
où®
('0001000'),

427 
	gRWXU
 = 
où®
('00700'),

428 
	gRUSR
 = 
où®
('00400'),

429 
	gWUSR
 = 
où®
('00200'),

430 
	gXUSR
 = 
où®
('00100'),

431 
	gRWXG
 = 
où®
('00070'),

432 
	gRGRP
 = 
où®
('00040'),

433 
	gWGRP
 = 
où®
('00020'),

434 
	gXGRP
 = 
où®
('00010'),

435 
	gRWXO
 = 
où®
('00007'),

436 
	gROTH
 = 
où®
('00004'),

437 
	gWOTH
 = 
où®
('00002'),

438 
	gXOTH
 = 
où®
('00001'),

441 
	gc
.
	gS_I
.
	gREAD
 = 
c
.
S_I
.
RUSR


442 
c
.
S_I
.
WRITE
 = c.S_I.
WUSR


443 
c
.
S_I
.
EXEC
 = c.S_I.
XUSR


445 
c
.
SOMAXCONN
 = 128

447 
c
.
SHUT
 = 
¡ræag
 {

448 
RD
 = 0,

449 
	gWR
 = 1,

450 
	gRDWR
 = 2,

453 
	gc
.
	gMNT
 = 
muÉiæags
 {

454 
RDONLY
 = 0x00000001,

455 
	gSYNCHRONOUS
 = 0x00000002,

456 
	gNOEXEC
 = 0x00000004,

457 
	gNOSUID
 = 0x00000008,

458 
	gNODEV
 = 0x00000010,

459 
	gUNION
 = 0x00000020,

460 
	gASYNC
 = 0x00000040,

461 
	gNOCOREDUMP
 = 0x00008000,

462 
	gRELATIME
 = 0x00020000,

463 
	gFORCE
 = 0x00080000,

464 
	gIGNORE
 = 0x00100000,

465 
	gEXTATTR
 = 0x01000000,

466 
	gLOG
 = 0x02000000,

467 
	gNOATIME
 = 0x04000000,

468 
	gSYMPERM
 = 0x20000000,

469 
	gNODEVMTIME
 = 0x40000000,

470 
	gSOFTDEP
 = 0x80000000,

472 
	gEXRDONLY
 = 0x00000080,

473 
	gEXPORTED
 = 0x00000100,

474 
	gDEFEXPORTED
 = 0x00000200,

475 
	gEXPORTANON
 = 0x00000400,

476 
	gEXKERB
 = 0x00000800,

477 
	gEXNORESPORT
 = 0x08000000,

478 
	gEXPUBLIC
 = 0x10000000,

480 
	gLOCAL
 = 0x00001000,

481 
	gQUOTA
 = 0x00002000,

482 
	gROOTFS
 = 0x00004000,

484 
	gUPDATE
 = 0x00010000,

485 
	gRELOAD
 = 0x00040000,

486 
	gFORCE
 = 0x00080000,

487 
	gGETARGS
 = 0x00400000,

490 
	gc
.
	gVFSMNT
 = 
¡ræag
 { -- 
nÙe
 
»Çmed
, 
vfs_sync
(è
ªd
 
g‘vfs¡©
(è(
®so
 
¥ecif›d
 
as
 
ST_
)

491 
WAIT
 = 1,

492 
	gNOWAIT
 = 2,

493 
	gLAZY
 = 3,

496 
	gc
.
	gRB
 = 
muÉiæags
 {

497 
ASKNAME
 = 0x00000001,

498 
	gSINGLE
 = 0x00000002,

499 
	gNOSYNC
 = 0x00000004,

500 
	gHALT
 = 0x00000008,

501 
	gINITNAME
 = 0x00000010,

502 
	gKDB
 = 0x00000040,

503 
	gRDONLY
 = 0x00000080,

504 
	gDUMP
 = 0x00000100,

505 
	gMINIROOT
 = 0x00000200,

506 
	gSTRING
 = 0x00000400,

507 
	gUSERCONF
 = 0x00001000,

510 
	gc
.
	gRB
.
	gPOWERDOWN
 = 
c
.
RB
.
HALT
 + 0x800

512 
c
.
TMPFS_ARGS
 = 
¡ræag
 {

513 
VERSION
 = 1,

516 
	gc
.
	gMODULE_CLASS
 = 
¡ræag
 {

517 
ANY
 = 0,

518 
	gMISC
 = 1,

519 
	gVFS
 = 2,

520 
	gDRIVER
 = 3,

521 
	gEXEC
 = 4,

522 
	gSECMODEL
 = 5,

525 
	gc
.
	gMODULE_SOURCE
 = 
¡ræag
 {

526 
KERNEL
 = 0,

527 
	gBOOT
 = 1,

528 
	gFILESYS
 = 2,

531 
	gc
.
	gMODULE_CMD
 = 
¡ræag
 {

532 
INIT
 = 0,

533 
	gFINI
 = 1,

534 
	gSTAT
 = 2,

535 
	gAUTOUNLOAD
 = 3,

538 
	gc
.
	gDT
 = 
¡ræag
 {

539 
UNKNOWN
 = 0,

540 
	gFIFO
 = 1,

541 
	gCHR
 = 2,

542 
	gDIR
 = 4,

543 
	gBLK
 = 6,

544 
	gREG
 = 8,

545 
	gLNK
 = 10,

546 
	gSOCK
 = 12,

547 
	gWHT
 = 14,

550 
	gc
.
	gUTIME
 = 
¡ræag
 {

551 
NOW
 = 
b™
.
lshiá
(1, 30) - 1,

552 
	gOMIT
 = 
b™
.
lshiá
(1, 30) - 2,

555 -- 
	gpe2
, 
£Ëùed
 
æags
 
äom
 
	gc
.
O


556 
	gc
.
	gOPIPE
 = 
muÉiæags
 {

557 
NONBLOCK
 = 0x00000004,

558 
	gCLOEXEC
 = 0x00400000,

559 
	gNOSIGPIPE
 = 0x01000000,

562 
	gc
.
	gPROT
 = 
muÉiæags
 {

563 
NONE
 = 0x0,

564 
	gREAD
 = 0x1,

565 
	gWRITE
 = 0x2,

566 
	gEXEC
 = 0x4,

569 
loÿl
 
funùiÚ
 
	$m­_®igÃd
(
n
è 
b™
.
	$lshiá
(
n
, 24è
’d


571 
c
.
MAP
 = 
muÉiæags
 {

572 
SHARED
 = 0x0001,

573 
PRIVATE
 = 0x0002,

574 
FILE
 = 0x0000,

575 
FIXED
 = 0x0010,

576 
RENAME
 = 0x0020,

577 
NORESERVE
 = 0x0040,

578 
INHERIT
 = 0x0080,

579 
HASSEMAPHORE
= 0x0200,

580 
TRYFIXED
 = 0x0400,

581 
WIRED
 = 0x0800,

582 
ANON
 = 0x1000,

583 
STACK
 = 0x2000,

584 
ALIGNMENT_64KB
 = 
	`m­_®igÃd
(16),

585 
ALIGNMENT_16MB
 = 
	`m­_®igÃd
(24),

586 
ALIGNMENT_4GB
 = 
	`m­_®igÃd
(32),

587 
ALIGNMENT_1TB
 = 
	`m­_®igÃd
(40),

588 
ALIGNMENT_256TB
 = 
	`m­_®igÃd
(48),

589 
ALIGNMENT_64PB
 = 
	`m­_®igÃd
(56),

590 
	}
}

592 
	gc
.
	gMCL
 = 
¡ræag
 {

593 
CURRENT
 = 0x01,

594 
	gFUTURE
 = 0x02,

597 -- 
æags
 
	gto
 `
	gmsync
'. -‚ote was MS_„enamedo MSYNC_

598 
	gc
.
	gMSYNC
 = 
muÉiæags
 {

599 
ASYNC
 = 0x01,

600 
	gINVALIDATE
 = 0x02,

601 
	gSYNC
 = 0x04,

604 
	gc
.
	gMADV
 = 
¡ræag
 {

605 
NORMAL
 = 0,

606 
	gRANDOM
 = 1,

607 
	gSEQUENTIAL
 = 2,

608 
	gWILLNEED
 = 3,

609 
	gDONTNEED
 = 4,

610 
	gSPACEAVAIL
 = 5,

611 
	gFREE
 = 6,

614 
	gc
.
	gIFF
 = 
muÉiæags
 {

615 
UP
 = 0x0001,

616 
	gBROADCAST
 = 0x0002,

617 
	gDEBUG
 = 0x0004,

618 
	gLOOPBACK
 = 0x0008,

619 
	gPOINTOPOINT
 = 0x0010,

620 
	gNOTRAILERS
 = 0x0020,

621 
	gRUNNING
 = 0x0040,

622 
	gNOARP
 = 0x0080,

623 
	gPROMISC
 = 0x0100,

624 
	gALLMULTI
 = 0x0200,

625 
	gOACTIVE
 = 0x0400,

626 
	gSIMPLEX
 = 0x0800,

627 
	gLINK0
 = 0x1000,

628 
	gLINK1
 = 0x2000,

629 
	gLINK2
 = 0x4000,

630 
	gMULTICAST
 = 0x8000,

633 
	gc
.
	gIFF
.
	gCANTCHANGE
 = 
c
.
IFF
.
BROADCAST
 + c.IFF.
POINTOPOINT
 + c.IFF.
RUNNING
 + c.IFF.
OACTIVE
 +

634 
c
.
IFF
.
SIMPLEX
 + c.IFF.
MULTICAST
 + c.IFF.
ALLMULTI
 + c.IFF.
PROMISC


636 
c
.
POLL
 = 
muÉiæags
 {

637 
IN
 = 0x0001,

638 
	gPRI
 = 0x0002,

639 
	gOUT
 = 0x0004,

640 
	gRDNORM
 = 0x0040,

641 
	gRDBAND
 = 0x0080,

642 
	gWRBAND
 = 0x0100,

643 
	gERR
 = 0x0008,

644 
	gHUP
 = 0x0010,

645 
	gNVAL
 = 0x0020,

648 
	gc
.
	gPOLL
.
	gWRNORM
 = 
c
.
POLL
.
OUT


650 
c
.
IP
 = 
¡ræag
 {

651 
OPTIONS
 = 1,

652 
	gHDRINCL
 = 2,

653 
	gTOS
 = 3,

654 
	gTTL
 = 4,

655 
	gRECVOPTS
 = 5,

656 
	gRECVRETOPTS
 = 6,

657 
	gRECVDSTADDR
 = 7,

658 
	gRETOPTS
 = 8,

659 
	gMULTICAST_IF
 = 9,

660 
	gMULTICAST_TTL
 = 10,

661 
	gMULTICAST_LOOP
 = 11,

662 
	gADD_MEMBERSHIP
 = 12,

663 
	gDROP_MEMBERSHIP
 = 13,

664 
	gPORTRANGE
 = 19,

665 
	gRECVIF
 = 20,

666 
	gERRORMTU
 = 21,

667 
	gIPSEC_POLICY
 = 22,

668 
	gRECVTTL
 = 23,

669 
	gMINTTL
 = 24,

672 
	gc
.
	gSO
 = 
¡ræag
 {

673 
DEBUG
 = 0x0001,

674 
	gACCEPTCONN
 = 0x0002,

675 
	gREUSEADDR
 = 0x0004,

676 
	gKEEPALIVE
 = 0x0008,

677 
	gDONTROUTE
 = 0x0010,

678 
	gBROADCAST
 = 0x0020,

679 
	gUSELOOPBACK
 = 0x0040,

680 
	gLINGER
 = 0x0080,

681 
	gOOBINLINE
 = 0x0100,

682 
	gREUSEPORT
 = 0x0200,

683 
	gNOSIGPIPE
 = 0x0800,

684 
	gACCEPTFILTER
 = 0x1000,

685 
	gTIMESTAMP
 = 0x2000,

686 
	gSNDBUF
 = 0x1001,

687 
	gRCVBUF
 = 0x1002,

688 
	gSNDLOWAT
 = 0x1003,

689 
	gRCVLOWAT
 = 0x1004,

690 
	gERROR
 = 0x1007,

691 
	gTYPE
 = 0x1008,

692 
	gOVERFLOWED
 = 0x1009,

693 
	gNOHEADER
 = 0x100a,

694 
	gSNDTIMEO
 = 0x100b,

695 
	gRCVTIMEO
 = 0x100c,

698 -- 
	glockf
, 
chªged
 
äom
 
F_
 
to
 
LOCKF_


699 
	gc
.
	gLOCKF
 = 
¡ræag
 {

700 
ULOCK
 = 0,

701 
	gLOCK
 = 1,

702 
	gTLOCK
 = 2,

703 
	gTEST
 = 3,

706 -- 
	$æock
 (2)

707 
c
.
LOCK
 = 
muÉiæags
 {

708 
SH
 = 1,

709 
EX
 = 2,

710 
NB
 = 4,

711 
UN
 = 8,

712 
	}
}

714 -- 
BPF
 
sock‘
 
f‹r


715 
	gc
.
	gBPF
 = 
muÉiæags
 {

716 -- 
şass


717 
LD
 = 0x00,

718 
	gLDX
 = 0x01,

719 
	gST
 = 0x02,

720 
	gSTX
 = 0x03,

721 
	gALU
 = 0x04,

722 
	gJMP
 = 0x05,

723 
	gRET
 = 0x06,

724 
	gMISC
 = 0x07,

725 -- 
size


726 
	gW
 = 0x00,

727 
	gH
 = 0x08,

728 
	gB
 = 0x10,

729 -- 
mode


730 
	gIMM
 = 0x00,

731 
	gABS
 = 0x20,

732 
	gIND
 = 0x40,

733 
	gMEM
 = 0x60,

734 
	gLEN
 = 0x80,

735 
	gMSH
 = 0xa0,

736 -- 
İ


737 
	gADD
 = 0x00,

738 
	gSUB
 = 0x10,

739 
	gMUL
 = 0x20,

740 
	gDIV
 = 0x30,

741 
	gOR
 = 0x40,

742 
	gAND
 = 0x50,

743 
	gLSH
 = 0x60,

744 
	gRSH
 = 0x70,

745 
	gNEG
 = 0x80,

746 
	gJA
 = 0x00,

747 
	gJEQ
 = 0x10,

748 
	gJGT
 = 0x20,

749 
	gJGE
 = 0x30,

750 
	gJSET
 = 0x40,

751 -- 
¤c


752 
	gK
 = 0x00,

753 
	gX
 = 0x08,

754 -- 
rv®


755 
	gA
 = 0x10,

756 -- 
miscİ


757 
	gTAX
 = 0x00,

758 
	gTXA
 = 0x80,

761 -- 
chæags
 
ªd
 
	g¡©
. 
nÙe
 
the£
 
have
 
no
 
´efix


762 
	gc
.
	gCHFLAGS
 = 
muÉiæags
 {

763 
UF_IMMUTABLE
 = 0x00000002,

764 
	gUF_APPEND
 = 0x00000004,

765 
	gUF_OPAQUE
 = 0x00000008,

766 
	gSF_ARCHIVED
 = 0x00010000,

767 
	gSF_IMMUTABLE
 = 0x00020000,

768 
	gSF_APPEND
 = 0x00040000,

769 
	gSF_SNAPSHOT
 = 0x00200000,

770 
	gSF_LOG
 = 0x00400000,

771 
	gSF_SNAPINVAL
 = 0x00800000,

774 
	gc
.
	gCHFLAGS
.
	gIMMUTABLE
 = 
c
.
CHFLAGS
.
UF_IMMUTABLE
 -- 
commÚ
 
fÜms


775 
c
.
CHFLAGS
.
APPEND
 = c.CHFLAGS.
UF_APPEND


776 
c
.
CHFLAGS
.
OPAQUE
 = c.CHFLAGS.
UF_OPAQUE


778 
c
.
PC
 = 
¡ræag
 {

779 
LINK_MAX
 = 1,

780 
	gMAX_CANON
 = 2,

781 
	gMAX_INPUT
 = 3,

782 
	gNAME_MAX
 = 4,

783 
	gPATH_MAX
 = 5,

784 
	gPIPE_BUF
 = 6,

785 
	gCHOWN_RESTRICTED
 = 7,

786 
	gNO_TRUNC
 = 8,

787 
	gVDISABLE
 = 9,

788 
	gSYNC_IO
 = 10,

789 
	gFILESIZEBITS
 = 11,

790 
	gSYMLINK_MAX
 = 12,

792 
	gACL_EXTENDED
 = 14,

793 
	gMIN_HOLE_SIZE
 = 15,

796 -- 
cÚ¡ªts
 
	gfsync_¿nge
 - 
nÙe
 
com¶ex
 
»Çme
 
äom
 
FDATASYNC
 
to
 
	gFSYNC
.
DATA


797 
	gc
.
	gFSYNC
 = 
muÉiæags
 {

798 
DATA
 = 0x0010,

799 
	gFILE
 = 0x0020,

800 
	gDISK
 = 0x0040,

803 -- 
Baud
 
¿‹s
 
ju¡
 
the
 
id’t™y
 
funùiÚ
 
š
 
	gN‘BSD
...

804 
	gc
.
	gB
 = 
¡ræag
 {}

806 
c
.
CC
 = 
¡ræag
 {

807 
VEOF
 = 0,

808 
	gVEOL
 = 1,

809 
	gVEOL2
 = 2,

810 
	gVERASE
 = 3,

811 
	gVWERASE
 = 4,

812 
	gVKILL
 = 5,

813 
	gVREPRINT
 = 6,

814 
	gVINTR
 = 8,

815 
	gVQUIT
 = 9,

816 
	gVSUSP
 = 10,

817 
	gVDSUSP
 = 11,

818 
	gVSTART
 = 12,

819 
	gVSTOP
 = 13,

820 
	gVLNEXT
 = 14,

821 
	gVDISCARD
 = 15,

822 
	gVMIN
 = 16,

823 
	gVTIME
 = 17,

824 
	gVSTATUS
 = 18,

827 
	gc
.
	gIFLAG
 = 
muÉiæags
 {

828 
IGNBRK
 = 0x00000001,

829 
	gBRKINT
 = 0x00000002,

830 
	gIGNPAR
 = 0x00000004,

831 
	gPARMRK
 = 0x00000008,

832 
	gINPCK
 = 0x00000010,

833 
	gISTRIP
 = 0x00000020,

834 
	gINLCR
 = 0x00000040,

835 
	gIGNCR
 = 0x00000080,

836 
	gICRNL
 = 0x00000100,

837 
	gIXON
 = 0x00000200,

838 
	gIXOFF
 = 0x00000400,

839 
	gIXANY
 = 0x00000800,

840 
	gIMAXBEL
 = 0x00002000,

843 
	gc
.
	gOFLAG
 = 
muÉiæags
 {

844 
OPOST
 = 0x00000001,

845 
	gONLCR
 = 0x00000002,

846 
	gOXTABS
 = 0x00000004,

847 
	gONOEOT
 = 0x00000008,

848 
	gOCRNL
 = 0x00000010,

849 
	gONOCR
 = 0x00000020,

850 
	gONLRET
 = 0x00000040,

853 
	gc
.
	gCFLAG
 = 
muÉiæags
 {

854 
CIGNORE
 = 0x00000001,

855 
	gCSIZE
 = 0x00000300,

856 
	gCS5
 = 0x00000000,

857 
	gCS6
 = 0x00000100,

858 
	gCS7
 = 0x00000200,

859 
	gCS8
 = 0x00000300,

860 
	gCSTOPB
 = 0x00000400,

861 
	gCREAD
 = 0x00000800,

862 
	gPARENB
 = 0x00001000,

863 
	gPARODD
 = 0x00002000,

864 
	gHUPCL
 = 0x00004000,

865 
	gCLOCAL
 = 0x00008000,

866 
	gCRTSCTS
 = 0x00010000,

867 
	gCDTRCTS
 = 0x00020000,

868 
	gMDMBUF
 = 0x00100000,

871 
	gc
.
	gCFLAG
.
	gCRTS_IFLOW
 = 
c
.
CFLAG
.
CRTSCTS


872 
c
.
CFLAG
.
CCTS_OFLOW
 = c.CFLAG.
CRTSCTS


873 
c
.
CFLAG
.
CHWFLOW
 = c.CFLAG.
MDMBUF
 + c.CFLAG.
CRTSCTS
 + c.CFLAG.
CDTRCTS


875 
c
.
LFLAG
 = 
muÉiæags
 {

876 
ECHOKE
 = 0x00000001,

877 
	gECHOE
 = 0x00000002,

878 
	gECHOK
 = 0x00000004,

879 
	gECHO
 = 0x00000008,

880 
	gECHONL
 = 0x00000010,

881 
	gECHOPRT
 = 0x00000020,

882 
	gECHOCTL
 = 0x00000040,

883 
	gISIG
 = 0x00000080,

884 
	gICANON
 = 0x00000100,

885 
	gALTWERASE
 = 0x00000200,

886 
	gIEXTEN
 = 0x00000400,

887 
	gEXTPROC
 = 0x00000800,

888 
	gTOSTOP
 = 0x00400000,

889 
	gFLUSHO
 = 0x00800000,

890 
	gNOKERNINFO
 = 0x02000000,

891 
	gPENDIN
 = 0x20000000,

892 
	gNOFLSH
 = 0x80000000,

895 
	gc
.
	gTCSA
 = 
muÉiæags
 { -- 
this
 
is
 
ªÙh”
 
odd
 
Úe
, 
wh”e
 
you
 
ÿn
 
have
 oÃ 
æag
 
¶us
 
SOFT


896 
NOW
 = 0,

897 
	gDRAIN
 = 1,

898 
	gFLUSH
 = 2,

899 
	gSOFT
 = 0x10,

902 -- 
tcæush
(), 
»Çmed
 
äom
 
TC
 
to
 
TCFLUSH


903 
	gc
.
	gTCFLUSH
 = 
¡ræag
 {

904 
IFLUSH
 = 1,

905 
	gOFLUSH
 = 2,

906 
	gIOFLUSH
 = 3,

909 -- 
	g‹rmios
 - 
	$tcæow
(è
ªd
 
TCXONC
 
u£
 
the£
. 
»Çmed
 
äom
 
TC
 
to
 
TCFLOW


910 
c
.
TCFLOW
 = 
¡ræag
 {

911 
OOFF
 = 1,

912 
OON
 = 2,

913 
IOFF
 = 3,

914 
ION
 = 4,

915 
	}
}

917 -- 
kqueue


918 
	gc
.
	gEV
 = 
muÉiæags
 {

919 
ADD
 = 0x0001,

920 
	gDELETE
 = 0x0002,

921 
	gENABLE
 = 0x0004,

922 
	gDISABLE
 = 0x0008,

923 
	gONESHOT
 = 0x0010,

924 
	gCLEAR
 = 0x0020,

925 
	gSYSFLAGS
 = 0xF000,

926 
	gFLAG1
 = 0x2000,

927 
	gEOF
 = 0x8000,

928 
	gERROR
 = 0x4000,

931 
	gc
.
	gEVFILT
 = 
¡ræag
 {

932 
READ
 = 0,

933 
	gWRITE
 = 1,

934 
	gAIO
 = 2,

935 
	gVNODE
 = 3,

936 
	gPROC
 = 4,

937 
	gSIGNAL
 = 5,

938 
	gTIMER
 = 6,

939 
	gSYSCOUNT
 = 7,

942 
	gc
.
	gNOTE
 = 
muÉiæags
 {

943 -- 
»ad
 
ªd
 
wr™e


944 
LOWAT
 = 0x0001,

945 -- 
vnode


946 
	gDELETE
 = 0x0001,

947 
	gWRITE
 = 0x0002,

948 
	gEXTEND
 = 0x0004,

949 
	gATTRIB
 = 0x0008,

950 
	gLINK
 = 0x0010,

951 
	gRENAME
 = 0x0020,

952 
	gREVOKE
 = 0x0040,

953 -- 
´oc


954 
	gEXIT
 = 0x80000000,

955 
	gFORK
 = 0x40000000,

956 
	gEXEC
 = 0x20000000,

957 
	gPCTRLMASK
 = 0xf0000000,

958 
	gPDATAMASK
 = 0x000fffff,

959 
	gTRACK
 = 0x00000001,

960 
	gTRACKERR
 = 0x00000002,

961 
	gCHILD
 = 0x00000004,

964 
	gc
.
	gRUSAGE
 = 
¡ræag
 {

965 
SELF
 = 0,

966 
	gCHILDREN
 = -1,

969 -- 
	gg‘´iÜ™y
, 
£riÜ™y
 
æags


970 
	gc
.
	gPRIO
 = 
¡ræag
 {

971 
PROCESS
 = 0,

972 
	gPGRP
 = 1,

973 
	gUSER
 = 2,

976 
	gc
.
	gW
 = 
muÉiæags
 {

977 
NOHANG
 = 0x00000001,

978 
	gUNTRACED
 = 0x00000002,

979 
	gALTSIG
 = 0x00000004,

980 
	gALLSIG
 = 0x00000008,

981 
	gNOWAIT
 = 0x00010000,

982 
	gNOZOMBIE
 = 0x00020000,

983 
	gOPTSCHECKED
 = 0x00040000,

986 
	gc
.
	gW
.
	gWCLONE
 = 
c
.
W
.
WALTSIG
 -- 
__WCLONE


987 
c
.
W
.
WALL
 = c.W.
WALLSIG
 -- 
__WALL


989 -- 
wa™pid
 
ªd
 
wa™4
 
pid


990 
c
.
WAIT
 = 
¡ræag
 {

991 
ANY
 = -1,

992 
	gMYPGRP
 = 0,

995 
	gc
.
	gAT_FDCWD
 = 
©æag
 {

996 
FDCWD
 = -100,

999 
	gc
.
	gAT
 = 
muÉiæags
 {

1000 
EACCESS
 = 0x100,

1001 
	gSYMLINK_NOFOLLOW
 = 0x200,

1002 
	gSYMLINK_FOLLOW
 = 0x400,

1003 
	gREMOVEDIR
 = 0x800,

1006 
	gc
.
	gKTR
 = 
¡ræag
 {

1007 
SYSCALL
 = 1,

1008 
	gSYSRET
 = 2,

1009 
	gNAMEI
 = 3,

1010 
	gGENIO
 = 4,

1011 
	gPSIG
 = 5,

1012 
	gCSW
 = 6,

1013 
	gEMUL
 = 7,

1014 
	gUSER
 = 8,

1015 
	gEXEC_ARG
 = 10,

1016 
	gEXEC_ENV
 = 11,

1017 
	gSAUPCALL
 = 13,

1018 
	gMIB
 = 14,

1019 
	gEXEC_FD
 = 15,

1022 
	gc
.
	gKTRFAC
 = 
muÉiæags
 {

1023 
MASK
 = 0x00ffffff,

1024 
	gSYSCALL
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
SYSCALL
),

1025 
	gSYSRET
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
SYSRET
),

1026 
	gNAMEI
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
NAMEI
),

1027 
	gGENIO
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
GENIO
),

1028 
	gPSIG
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
PSIG
),

1029 
	gCSW
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
CSW
),

1030 
	gEMUL
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
EMUL
),

1031 
	gUSER
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
USER
),

1032 
	gEXEC_ARG
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
EXEC_ARG
),

1033 
	gEXEC_ENV
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
EXEC_ENV
),

1034 --
	gSAUPCALL
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
SAUPCALL
), -- 
­³¬s
 
to
 
be
 
gÚe
 
š
 
	gN‘BSD
 7

1035 
	gMIB
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
MIB
),

1036 
	gEXEC_FD
 = 
b™
.
lshiá
(1, 
c
.
KTR
.
EXEC_FD
),

1037 
	gPERSISTENT
 = 0x80000000,

1038 
	gINHERIT
 = 0x40000000,

1039 
	gTRC_EMUL
 = 0x10000000,

1040 
	gVER_MASK
 = 0x0f000000,

1041 
	gV0
 = 
b™
.
lshiá
(0, 24),

1042 
	gV1
 = 
b™
.
lshiá
(1, 24),

1043 
	gV2
 = 
b™
.
lshiá
(2, 24),

1046 
	gc
.
	gKTROP
 = 
muÉiæags
 {

1047 
SET
 = 0,

1048 
	gCLEAR
 = 1,

1049 
	gCLEARFILE
 = 2,

1050 
	gDESCEND
 = 4,

1053 -- 
uio


1054 
	gc
.
	gUIO
 = 
¡ræag
 {

1055 
READ
 = 0,

1056 
	gWRITE
 = 1,

1059 
	gc
.
	gSCM
 = 
muÉiæags
 {

1060 
RIGHTS
 = 0x01,

1062 
	gCREDS
 = 0x04,

1063 
	gTIMESTAMP
 = 0x08,

1066 
	gc
.
	gBRDG
 = 
¡ræag
 {

1067 
ADD
 = 0,

1068 
	gDEL
 = 1,

1069 
	gGIFFLGS
 = 2,

1070 
	gSIFFLGS
 = 3,

1071 
	gSCACHE
 = 4,

1072 
	gGCACHE
 = 5,

1073 
	gGIFS
 = 6,

1074 
	gRTS
 = 7,

1075 
	gSADDR
 = 8,

1076 
	gSTO
 = 9,

1077 
	gGTO
 = 10,

1078 
	gDADDR
 = 11,

1079 
	gFLUSH
 = 12,

1080 
	gGPRI
 = 13,

1081 
	gSPRI
 = 14,

1082 
	gGHT
 = 15,

1083 
	gSHT
 = 16,

1084 
	gGFD
 = 17,

1085 
	gSFD
 = 18,

1086 
	gGMA
 = 19,

1087 
	gSMA
 = 20,

1088 
	gSIFPRIO
 = 21,

1089 
	gSIFCOST
 = 22,

1090 
	gGFILT
 = 23,

1091 
	gSFILT
 = 24,

1094 
	gc
.
	gND6
 = 
¡ræag
 {

1095 
INFINITE_LIFETIME
 = 
h
.
ušt32_max
,

1098 
	gc
.
	gTCP
 = 
¡ræag
 {

1099 
NODELAY
 = 1,

1100 
	gMAXSEG
 = 2,

1101 
	gKEEPIDLE
 = 3,

1102 
	gKEEPINTVL
 = 5,

1103 
	gKEEPCNT
 = 6,

1104 
	gKEEPINIT
 = 7,

1105 
	gMD5SIG
 = 0x10,

1106 
	gCONGCTL
 = 0x20,

1109 
	gc
.
	gITIMER
 = 
¡ræag
 {

1110 
REAL
 = 0,

1111 
	gVIRTUAL
 = 1,

1112 
	gPROF
 = 2,

1113 
	gMONOTONIC
 = 3,

1116 
	gc
.
	gTIMER
 = 
¡ræag
 {

1117 
RELTIME
 = 0x0,

1118 
	gABSTIME
 = 0x1,

1121 -- 
v6
 
sockİts


1122 
	gc
.
	gIPV6
 = 
¡ræag
 {

1123 
SOCKOPT_RESERVED1
 = 3,

1124 
	gUNICAST_HOPS
 = 4,

1125 
	gMULTICAST_IF
 = 9,

1126 
	gMULTICAST_HOPS
 = 10,

1127 
	gMULTICAST_LOOP
 = 11,

1128 
	gJOIN_GROUP
 = 12,

1129 
	gLEAVE_GROUP
 = 13,

1130 
	gPORTRANGE
 = 14,

1131 --
	gPORTALGO
 = 17, -- 
	gÃtbsd
 7 
	gÚly


1132 --
	gICMP6_FILTER
 = 18, -- 
nÙ
 
Çme¥aûd
 
as
 
IPV6


1133 
	gCHECKSUM
 = 26,

1134 
	gV6ONLY
 = 27,

1135 
	gIPSEC_POLICY
 = 28,

1136 
	gFAITH
 = 29,

1137 
	gRTHDRDSTOPTS
 = 35,

1138 
	gRECVPKTINFO
 = 36,

1139 
	gRECVHOPLIMIT
 = 37,

1140 
	gRECVRTHDR
 = 38,

1141 
	gRECVHOPOPTS
 = 39,

1142 
	gRECVDSTOPTS
 = 40,

1143 
	gUSE_MIN_MTU
 = 42,

1144 
	gRECVPATHMTU
 = 43,

1145 
	gPATHMTU
 = 44,

1146 
	gPKTINFO
 = 46,

1147 
	gHOPLIMIT
 = 47,

1148 
	gNEXTHOP
 = 48,

1149 
	gHOPOPTS
 = 49,

1150 
	gDSTOPTS
 = 50,

1151 
	gRTHDR
 = 51,

1152 
	gRECVTCLASS
 = 57,

1153 
	gTCLASS
 = 61,

1154 
	gDONTFRAG
 = 62,

1157 
	gc
.
	gRTF
 = 
muÉiæags
 {

1158 
UP
 = 0x1,

1159 
	gGATEWAY
 = 0x2,

1160 
	gHOST
 = 0x4,

1161 
	gREJECT
 = 0x8,

1162 
	gDYNAMIC
 = 0x10,

1163 
	gMODIFIED
 = 0x20,

1164 
	gDONE
 = 0x40,

1165 
	gMASK
 = 0x80,

1166 
	gCLONING
 = 0x100,

1167 
	gXRESOLVE
 = 0x200,

1168 
	gLLINFO
 = 0x400,

1169 
	gSTATIC
 = 0x800,

1170 
	gBLACKHOLE
 = 0x1000,

1171 
	gCLONED
 = 0x2000,

1172 
	gPROTO2
 = 0x4000,

1173 
	gPROTO1
 = 0x8000,

1174 
	gSRC
 = 0x10000,

1175 
	gANNOUNCE
 = 0x20000,

1178 
	gc
.
	gRTM
 = 
¡ræag
 {

1179 
VERSION
 = 4,

1181 
	gADD
 = 0x1,

1182 
	gDELETE
 = 0x2,

1183 
	gCHANGE
 = 0x3,

1184 
	gGET
 = 0x4,

1185 
	gLOSING
 = 0x5,

1186 
	gREDIRECT
 = 0x6,

1187 
	gMISS
 = 0x7,

1188 
	gLOCK
 = 0x8,

1189 
	gOLDADD
 = 0x9,

1190 
	gOLDDEL
 = 0xa,

1191 
	gRESOLVE
 = 0xb,

1192 
	gNEWADDR
 = 0xc,

1193 
	gDELADDR
 = 0xd,

1194 
	gOOIFINFO
 = 0xe,

1195 
	gOIFINFO
 = 0xf,

1196 
	gIFANNOUNCE
 = 0x10,

1197 
	gIEEE80211
 = 0x11,

1198 
	gSETGATE
 = 0x12,

1199 
	gLLINFO_UPD
 = 0x13,

1200 
	gIFINFO
 = 0x14,

1201 
	gCHGADDR
 = 0x15,

1204 
	gc
.
	gRTV
 = 
muÉiæags
 {

1205 
MTU
 = 0x1,

1206 
	gHOPCOUNT
 = 0x2,

1207 
	gEXPIRE
 = 0x4,

1208 
	gRPIPE
 = 0x8,

1209 
	gSPIPE
 = 0x10,

1210 
	gSSTHRESH
 = 0x20,

1211 
	gRTT
 = 0x40,

1212 
	gRTTVAR
 = 0x80,

1215 
	gc
.
	gRTA
 = 
muÉiæags
 {

1216 
DST
 = 0x1,

1217 
	gGATEWAY
 = 0x2,

1218 
	gNETMASK
 = 0x4,

1219 
	gGENMASK
 = 0x8,

1220 
	gIFP
 = 0x10,

1221 
	gIFA
 = 0x20,

1222 
	gAUTHOR
 = 0x40,

1223 
	gBRD
 = 0x80,

1224 
	gTAG
 = 0x100,

1227 
	gc
.
	gRTAX
 = 
¡ræag
 {

1228 
DST
 = 0,

1229 
	gGATEWAY
 = 1,

1230 
	gNETMASK
 = 2,

1231 
	gGENMASK
 = 3,

1232 
	gIFP
 = 4,

1233 
	gIFA
 = 5,

1234 
	gAUTHOR
 = 6,

1235 
	gBRD
 = 7,

1236 
	gTAG
 = 8,

1237 
	gMAX
 = 9,

1240 
	gc
.
	gCLOCK
 = 
¡ræag
 {

1241 
REALTIME
 = 0,

1242 
	gVIRTUAL
 = 1,

1243 
	gPROF
 = 2,

1244 
	gMONOTONIC
 = 3,

1247 
	gc
.
	gEXTATTR_NAMESPACE
 = 
¡ræag
 {

1248 
USER
 = 0x00000001,

1249 
	gSYSTEM
 = 0x00000002,

1252 
	gc
.
	gXATTR
 = 
muÉiæags
 {

1253 
CREATE
 = 0x01,

1254 
	gREPLACE
 = 0x02,

1257 
	gc
.
	gAIO
 = 
¡ræag
 {

1258 
CANCELED
 = 0x1,

1259 
	gNOTCANCELED
 = 0x2,

1260 
	gALLDONE
 = 0x3,

1263 
	gc
.
	gLIO
 = 
¡ræag
 {

1264 -- 
LIO
 
İcodes


1265 
NOP
 = 0x0,

1266 
	gWRITE
 = 0x1,

1267 
	gREAD
 = 0x2,

1268 -- 
LIO
 
modes


1269 
	gNOWAIT
 = 0x0,

1270 
	gWAIT
 = 0x1,

1273 
	gc
.
	gCTLTYPE
 = 
¡ræag
 {

1274 
NODE
 = 1,

1275 
	gINT
 = 2,

1276 
	gSTRING
 = 3,

1277 
	gQUAD
 = 4,

1278 
	gSTRUCT
 = 5,

1279 
	gBOOL
 = 6,

1282 
	gabi
.
abi64
 
th’


1283 
	gc
.
	gCTLTYPE
.
	gLONG
 = 
c
.
CTLTYPE
.
QUAD


1285 
c
.
CTLTYPE_LONG
 = c.
CTLTYPE
.
INT


1286 
’d


1288 
c
.
CTLFLAG
 = 
muÉiæags
 {

1289 
READONLY
 = 0x00000000,

1290 
	gREADWRITE
 = 0x00000070,

1291 
	gANYWRITE
 = 0x00000080,

1292 
	gPRIVATE
 = 0x00000100,

1293 
	gPERMANENT
 = 0x00000200,

1294 
	gOWNDATA
 = 0x00000400,

1295 
	gIMMEDIATE
 = 0x00000800,

1296 
	gHEX
 = 0x00001000,

1297 
	gROOT
 = 0x00002000,

1298 
	gANYNUMBER
 = 0x00004000,

1299 
	gHIDDEN
 = 0x00008000,

1300 
	gALIAS
 = 0x00010000,

1301 
	gMMAP
 = 0x00020000,

1302 
	gOWNDESC
 = 0x00040000,

1303 
	gUNSIGNED
 = 0x00080000,

1306 
	gc
.
	gCTL
 = 
¡ræag
 {

1307 -- 
m‘a


1308 
EOL
 = -1,

1309 
	gQUERY
 = -2,

1310 
	gCREATE
 = -3,

1311 
	gCREATESYM
 = -4,

1312 
	gDESTROY
 = -5,

1313 
	gMMAP
 = -6,

1314 
	gDESCRIBE
 = -7,

1315 -- 
tİ
 
Ëv–


1316 
	gUNSPEC
 = 0,

1317 
	gKERN
 = 1,

1318 
	gVM
 = 2,

1319 
	gVFS
 = 3,

1320 
	gNET
 = 4,

1321 
	gDEBUG
 = 5,

1322 
	gHW
 = 6,

1323 
	gMACHDEP
 = 7,

1324 
	gUSER
 = 8,

1325 
	gDDB
 = 9,

1326 
	gPROC
 = 10,

1327 
	gVENDOR
 = 11,

1328 
	gEMUL
 = 12,

1329 
	gSECURITY
 = 13,

1330 
	gMAXID
 = 14,

1333 
	gc
.
	gKERN
 = 
¡ræag
 {

1334 
OSTYPE
 = 1,

1335 
	gOSRELEASE
 = 2,

1336 
	gOSREV
 = 3,

1337 
	gVERSION
 = 4,

1338 
	gMAXVNODES
 = 5,

1339 
	gMAXPROC
 = 6,

1340 
	gMAXFILES
 = 7,

1341 
	gARGMAX
 = 8,

1342 
	gSECURELVL
 = 9,

1343 
	gHOSTNAME
 = 10,

1344 
	gHOSTID
 = 11,

1345 
	gCLOCKRATE
 = 12,

1346 
	gVNODE
 = 13,

1347 
	gPROC
 = 14,

1348 
	gFILE
 = 15,

1349 
	gPROF
 = 16,

1350 
	gPOSIX1
 = 17,

1351 
	gNGROUPS
 = 18,

1352 
	gJOB_CONTROL
 = 19,

1353 
	gSAVED_IDS
 = 20,

1354 
	gOBOOTTIME
 = 21,

1355 
	gDOMAINNAME
 = 22,

1356 
	gMAXPARTITIONS
 = 23,

1357 
	gRAWPARTITION
 = 24,

1358 
	gNTPTIME
 = 25,

1359 
	gTIMEX
 = 26,

1360 
	gAUTONICETIME
 = 27,

1361 
	gAUTONICEVAL
 = 28,

1362 
	gRTC_OFFSET
 = 29,

1363 
	gROOT_DEVICE
 = 30,

1364 
	gMSGBUFSIZE
 = 31,

1365 
	gFSYNC
 = 32,

1366 
	gOLDSYSVMSG
 = 33,

1367 
	gOLDSYSVSEM
 = 34,

1368 
	gOLDSYSVSHM
 = 35,

1369 
	gOLDSHORTCORENAME
 = 36,

1370 
	gSYNCHRONIZED_IO
 = 37,

1371 
	gIOV_MAX
 = 38,

1372 
	gMBUF
 = 39,

1373 
	gMAPPED_FILES
 = 40,

1374 
	gMEMLOCK
 = 41,

1375 
	gMEMLOCK_RANGE
 = 42,

1376 
	gMEMORY_PROTECTION
 = 43,

1377 
	gLOGIN_NAME_MAX
 = 44,

1378 
	gDEFCORENAME
 = 45,

1379 
	gLOGSIGEXIT
 = 46,

1380 
	gPROC2
 = 47,

1381 
	gPROC_ARGS
 = 48,

1382 
	gFSCALE
 = 49,

1383 
	gCCPU
 = 50,

1384 
	gCP_TIME
 = 51,

1385 
	gOLDSYSVIPC_INFO
 = 52,

1386 
	gMSGBUF
 = 53,

1387 
	gCONSDEV
 = 54,

1388 
	gMAXPTYS
 = 55,

1389 
	gPIPE
 = 56,

1390 
	gMAXPHYS
 = 57,

1391 
	gSBMAX
 = 58,

1392 
	gTKSTAT
 = 59,

1393 
	gMONOTONIC_CLOCK
 = 60,

1394 
	gURND
 = 61,

1395 
	gLABELSECTOR
 = 62,

1396 
	gLABELOFFSET
 = 63,

1397 
	gLWP
 = 64,

1398 
	gFORKFSLEEP
 = 65,

1399 
	gPOSIX_THREADS
 = 66,

1400 
	gPOSIX_SEMAPHORES
 = 67,

1401 
	gPOSIX_BARRIERS
 = 68,

1402 
	gPOSIX_TIMERS
 = 69,

1403 
	gPOSIX_SPIN_LOCKS
 = 70,

1404 
	gPOSIX_READER_WRITER_LOCKS
 = 71,

1405 
	gDUMP_ON_PANIC
 = 72,

1406 
	gSOMAXKVA
 = 73,

1407 
	gROOT_PARTITION
 = 74,

1408 
	gDRIVERS
 = 75,

1409 
	gBUF
 = 76,

1410 
	gFILE2
 = 77,

1411 
	gVERIEXEC
 = 78,

1412 
	gCP_ID
 = 79,

1413 
	gHARDCLOCK_TICKS
 = 80,

1414 
	gARND
 = 81,

1415 
	gSYSVIPC
 = 82,

1416 
	gBOOTTIME
 = 83,

1417 
	gEVCNT
 = 84,

1418 
	gMAXID
 = 85,

1421 
	gc
.
	gKERN_PIPE
 = 
¡ræag
 {

1422 
MAXKVASZ
 = 1,

1423 
	gLIMITKVA
 = 2,

1424 
	gMAXBIGPIPES
 = 3,

1425 
	gNBIGPIPES
 = 4,

1426 
	gKVASIZE
 = 5,

1429 
	gc
.
	gKERN_PIPE
.
	gMAXLOANKVASZ
 = 
c
.
KERN_PIPE
.
LIMITKVA
 -- 
®‹º©e
 
Çme
 
TODO
 
move
 
to
 
®Ÿ£s


1431 
c
.
KERN_TKSTAT
 = 
¡ræag
 {

1432 
NIN
 = 1,

1433 
	gNOUT
 = 2,

1434 
	gCANCC
 = 3,

1435 
	gRAWCC
 = 4,

1438 
	gc
.
	gHW
 = 
¡ræag
 {

1439 
MACHINE
 = 1,

1440 
	gMODEL
 = 2,

1441 
	gNCPU
 = 3,

1442 
	gBYTEORDER
 = 4,

1443 
	gPHYSMEM
 = 5,

1444 
	gUSERMEM
 = 6,

1445 
	gPAGESIZE
 = 7,

1446 
	gDISKNAMES
 = 8,

1447 
	gIOSTATS
 = 9,

1448 
	gMACHINE_ARCH
= 10,

1449 
	gALIGNBYTES
 = 11,

1450 
	gCNMAGIC
 = 12,

1451 
	gPHYSMEM64
 = 13,

1452 
	gUSERMEM64
 = 14,

1453 
	gIOSTATNAMES
 = 15,

1454 
	gNCPUONLINE
 = 16,

1457 
	gc
.
	gVM
 = 
¡ræag
 {

1458 
METER
 = 1,

1459 
	gLOADAVG
 = 2,

1460 
	gUVMEXP
 = 3,

1461 
	gNKMEMPAGES
 = 4,

1462 
	gUVMEXP2
 = 5,

1463 
	gANONMIN
 = 6,

1464 
	gEXECMIN
 = 7,

1465 
	gFILEMIN
 = 8,

1466 
	gMAXSLP
 = 9,

1467 
	gUSPACE
 = 10,

1468 
	gANONMAX
 = 11,

1469 
	gEXECMAX
 = 12,

1470 
	gFILEMAX
 = 13,

1473 
	gc
.
	gIPCTL
 = 
¡ræag
 {

1474 
FORWARDING
 = 1,

1475 
	gSENDREDIRECTS
 = 2,

1476 
	gDEFTTL
 = 3,

1477 --
	gDEFMTU
 = 4,

1478 
	gFORWSRCRT
 = 5,

1479 
	gDIRECTEDBCAST
 = 6,

1480 
	gALLOWSRCRT
 = 7,

1481 
	gSUBNETSARELOCAL
 = 8,

1482 
	gMTUDISC
 = 9,

1483 
	gANONPORTMIN
 = 10,

1484 
	gANONPORTMAX
 = 11,

1485 
	gMTUDISCTIMEOUT
 = 12,

1486 
	gMAXFLOWS
 = 13,

1487 
	gHOSTZEROBROADCAST
 = 14,

1488 
	gGIF_TTL
 = 15,

1489 
	gLOWPORTMIN
 = 16,

1490 
	gLOWPORTMAX
 = 17,

1491 
	gMAXFRAGPACKETS
 = 18,

1492 
	gGRE_TTL
 = 19,

1493 
	gCHECKINTERFACE
 = 20,

1494 
	gIFQ
 = 21,

1495 
	gRANDOMID
 = 22,

1496 
	gLOOPBACKCKSUM
 = 23,

1497 
	gSTATS
 = 24,

1500 
	gc
.
	gIPV6CTL
 = 
¡ræag
 {

1501 
FORWARDING
 = 1,

1502 
	gSENDREDIRECTS
 = 2,

1503 
	gDEFHLIM
 = 3,

1504 --
	gDEFMTU
 = 4,

1505 
	gFORWSRCRT
 = 5,

1506 
	gSTATS
 = 6,

1507 
	gMRTSTATS
 = 7,

1508 
	gMRTPROTO
 = 8,

1509 
	gMAXFRAGPACKETS
 = 9,

1510 
	gSOURCECHECK
 = 10,

1511 
	gSOURCECHECK_LOGINT
 = 11,

1512 
	gACCEPT_RTADV
 = 12,

1513 
	gKEEPFAITH
 = 13,

1514 
	gLOG_INTERVAL
 = 14,

1515 
	gHDRNESTLIMIT
 = 15,

1516 
	gDAD_COUNT
 = 16,

1517 
	gAUTO_FLOWLABEL
 = 17,

1518 
	gDEFMCASTHLIM
 = 18,

1519 
	gGIF_HLIM
 = 19,

1520 
	gKAME_VERSION
 = 20,

1521 
	gUSE_DEPRECATED
 = 21,

1522 
	gRR_PRUNE
 = 22,

1523 
	gV6ONLY
 = 24,

1524 
	gANONPORTMIN
 = 28,

1525 
	gANONPORTMAX
 = 29,

1526 
	gLOWPORTMIN
 = 30,

1527 
	gLOWPORTMAX
 = 31,

1528 
	gUSE_DEFAULTZONE
= 39,

1529 
	gMAXFRAGS
 = 41,

1530 
	gIFQ
 = 42,

1531 
	gRTADV_MAXROUTES
= 43,

1532 
	gRTADV_NUMROUTES
= 44,

1535 
	gc
.
	gUSER
 = 
¡ræag
 {

1536 
CS_PATH
 = 1,

1537 
	gBC_BASE_MAX
 = 2,

1538 
	gBC_DIM_MAX
 = 3,

1539 
	gBC_SCALE_MAX
 = 4,

1540 
	gBC_STRING_MAX
 = 5,

1541 
	gCOLL_WEIGHTS_MAX
 = 6,

1542 
	gEXPR_NEST_MAX
 = 7,

1543 
	gLINE_MAX
 = 8,

1544 
	gRE_DUP_MAX
 = 9,

1545 
	gPOSIX2_VERSION
 = 10,

1546 
	gPOSIX2_C_BIND
 = 11,

1547 
	gPOSIX2_C_DEV
 = 12,

1548 
	gPOSIX2_CHAR_TERM
 = 13,

1549 
	gPOSIX2_FORT_DEV
 = 14,

1550 
	gPOSIX2_FORT_RUN
 = 15,

1551 
	gPOSIX2_LOCALEDEF
 = 16,

1552 
	gPOSIX2_SW_DEV
 = 17,

1553 
	gPOSIX2_UPE
 = 18,

1554 
	gSTREAM_MAX
 = 19,

1555 
	gTZNAME_MAX
 = 20,

1556 
	gATEXIT_MAX
 = 21,

1559  
	gc


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/errors.lua

1 -- 
N‘BSD
 
”rÜ
 
mes§ges


4 
	gPERM
 = "Operation‚ot…ermitted",

5 
	gNOENT
 = "No such file or directory",

6 
	gSRCH
 = "No such…rocess",

7 
	gINTR
 = "Interrupted system call",

8 
	gIO
 = "Input/outputƒrror",

9 
	gNXIO
 = "Device‚ot configured",

11 
	gNOEXEC
 = "Exec formatƒrror",

12 
	gBADF
 = "Bad file descriptor",

13 
	gCHILD
 = "No child…rocesses",

14 
	gDEADLK
 = "Resource deadlock‡voided",

15 
	gNOMEM
 = "Cannot‡llocate memory",

16 
	gACCES
 = "Permission denied",

17 
	gFAULT
 = "Bad‡ddress",

18 
	gNOTBLK
 = "Block device„equired",

19 
	gBUSY
 = "Device busy",

20 
	gEXIST
 = "Fileƒxists",

21 
	gXDEV
 = "Cross-device†ink",

22 
	gNODEV
 = "Operation‚ot supported by device",

23 
	gNOTDIR
 = "Not‡ directory",

24 
	gISDIR
 = "Is‡ directory",

25 
	gINVAL
 = "Invalid‡rgument",

26 
	gNFILE
 = "Too many open files in system",

27 
	gMFILE
 = "Too many open files",

28 
	gNOTTY
 = "Inappropriate ioctl for device",

29 
	gTXTBSY
 = "Text file busy",

30 
	gFBIG
 = "Fileoo†arge",

31 
	gNOSPC
 = "No space†eft on device",

32 
	gSPIPE
 = "Illegal seek",

33 
	gROFS
 = "Read-only file system",

34 
	gMLINK
 = "Too many†inks",

35 
	gPIPE
 = "Broken…ipe",

36 
	gDOM
 = "Numerical‡rgument out of domain",

37 
	gRANGE
 = "Resultoo†arge oroo small",

38 
	gAGAIN
 = "Resourceemporarily unavailable",

39 
	gINPROGRESS
 = "Operation‚ow in…rogress",

40 
	gALREADY
 = "Operation‡lready in…rogress",

41 
	gNOTSOCK
 = "Socket operation on‚on-socket",

42 
	gDESTADDRREQ
 = "Destination‡ddress„equired",

43 
	gMSGSIZE
 = "Messageoo†ong",

44 
	gPROTOTYPE
 = "Protocol wrongype for socket",

45 
	gNOPROTOOPT
 = "Protocol option‚ot‡vailable",

46 
	gPROTONOSUPPORT
 = "Protocol‚ot supported",

47 
	gSOCKTNOSUPPORT
 = "Socketype‚ot supported",

48 
	gOPNOTSUPP
 = "Operation‚ot supported",

49 
	gPFNOSUPPORT
 = "Protocol family‚ot supported",

50 
	gAFNOSUPPORT
 = "Address family‚ot supported by…rotocol family",

51 
	gADDRINUSE
 = "Address‡lready in use",

52 
	gADDRNOTAVAIL
 = "Can't‡ssign„equested‡ddress",

53 
	gNETDOWN
 = "Network is down",

54 
	gNETUNREACH
 = "Network is unreachable",

55 
	gNETRESET
 = "Network dropped connection on„eset",

56 
	gCONNABORTED
 = "Software caused connection‡bort",

57 
	gCONNRESET
 = "Connection„eset by…eer",

58 
	gNOBUFS
 = "No buffer space‡vailable",

59 
	gISCONN
 = "Socket is‡lready connected",

60 
	gNOTCONN
 = "Socket is‚ot connected",

61 
	gSHUTDOWN
 = "Can't send‡fter socket shutdown",

62 
	gTOOMANYREFS
 = "Too many„eferences: can't splice",

63 
	gTIMEDOUT
 = "Connectionimed out",

64 
	gCONNREFUSED
 = "Connection„efused",

65 
	gLOOP
 = "Too many†evels of symbolic†inks",

66 
	gNAMETOOLONG
 = "File‚ameoo†ong",

67 
	gHOSTDOWN
 = "Host is down",

68 
	gHOSTUNREACH
 = "No„outeo host",

69 
	gNOTEMPTY
 = "Directory‚otƒmpty",

70 
	gPROCLIM
 = "Too many…rocesses",

71 
	gUSERS
 = "Too many users",

72 
	gDQUOT
 = "Disc quotaƒxceeded",

73 
	gSTALE
 = "Stale NFS file handle",

74 
	gREMOTE
 = "Too many†evels of„emote in…ath",

75 
	gBADRPC
 = "RPC struct is bad",

76 
	gRPCMISMATCH
 = "RPC version wrong",

77 
	gPROGUNAVAIL
 = "RPC…rog.‚ot‡vail",

78 
	gPROGMISMATCH
 = "Program version wrong",

79 
	gPROCUNAVAIL
 = "Bad…rocedure for…rogram",

80 
	gNOLCK
 = "No†ocks‡vailable",

81 
	gNOSYS
 = "Function‚ot implemented",

82 
	gFTYPE
 = "Inappropriate fileype or format",

83 
	gAUTH
 = "Authenticationƒrror",

84 
	gNEEDAUTH
 = "Need‡uthenticator",

85 
	gIDRM
 = "Identifier„emoved",

86 
	gNOMSG
 = "No message of desiredype",

87 
	gOVERFLOW
 = "Valueoo†argeo be stored in dataype",

88 
	gILSEQ
 = "Illegal byte sequence",

89 
	gNOTSUP
 = "Not supported",

90 
	gCANCELED
 = "Operation Canceled",

91 
	gBADMSG
 = "Bad or Corrupt message",

92 
	gNODATA
 = "No message‡vailable",

93 
	gNOSR
 = "No STREAM„esources",

94 
	gNOSTR
 = "Not‡ STREAM",

95 
	gTIME
 = "STREAM ioctlimeout",

96 
	gNOATTR
 = "Attribute‚ot found",

97 
	gMULTIHOP
 = "Multihop‡ttempted",

98 
	gNOLINK
 = "Link has been severed",

99 
	gPROTO
 = "Protocolƒrror",

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/fcntl.lua

1 -- 
N‘BSD
 
fú


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
c
 = 
»quœe
 "syscall.netbsd.constants"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

16 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

18 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

20 
loÿl
 
ùoboŞ
, 
boŞtoc
 = 
h
.ctobool, h.booltoc

22 
loÿl
 
fú
 = {

23 
commªds
 = {

24 [
c
.
F
.
SETFL
] = 
	`funùiÚ
(
¬g
è c.
O
[¬g] 
’d
,

25 [
c
.
F
.
SETFD
] = 
	`funùiÚ
(
¬g
è c.
FD
[¬g] 
’d
,

26 [
c
.
F
.
GETLK
] = 
t
.
æock
,

27 [
c
.
F
.
SETLK
] = 
t
.
æock
,

28 [
c
.
F
.
SETLKW
] = 
t
.
æock
,

29 [
c
.
F
.
SETNOSIGPIPE
] = 
	`funùiÚ
(
¬g
è 
	`boŞtoc
×rgè
’d
,

31 
»t
 = {

32 [
c
.
F
.
DUPFD
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

33 [
c
.
F
.
DUPFD_CLOEXEC
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

34 [
c
.
F
.
GETFD
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

35 [
c
.
F
.
GETFL
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

36 [
c
.
F
.
GETOWN
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

37 [
c
.
F
.
GETLK
] = 
	`funùiÚ
(
»t
, 
¬g
è‡rg 
’d
,

38 [
c
.
F
.
MAXFD
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

39 [
c
.
F
.
GETNOSIGPIPE
] = 
	`funùiÚ
(
»t
è 
	`ùoboŞ
Ô‘è
’d
,

41 
	}
}

43  
fú


45 
’d


47  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/ffifunctions.lua

1 -- 
defše
 
sy¡em
 
ÿÎs
 
	gffi
, 
N‘BSD
 
¥ecific
 calls

3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
	g»quœe
 "syscall.bsd.ffi"

12 
loÿl
 
	gcdef
 = 
»quœe
 "ffi".
cdef


14 
cdef
[[

15 
fsync_¿nge
(
fd
, 
how
, 
off_t
 
¡¬t
, off_ˆ
Ëngth
);

16 
·cû±
(
s
, 
sockaddr
 *
addr
, 
sockËn_t
 *
add¾’
, cÚ¡ 
sig£t_t
 *
sigmask
, 
æags
);

17 
»boÙ
(
howto
, *
boÙ¡r
);

18 
ioùl
(
d
, 
»que¡
, *
¬g
);

19 
g‘vfs¡©
(
¡©vfs
 *
buf
, 
size_t
 
bufsize
, 
æags
);

20 
uŒaû
(cÚ¡ *
Ïb–
, *
addr
, 
size_t
 
Ën
);

21 
fkŒaû
(
fd
, 
İs
, 
Œpošts
, 
pid_t
 
pid
);

23 
ssize_t
 
li¡x©Œ
(cÚ¡ *
·th
, *
li¡
, 
size_t
 
size
);

24 
ssize_t
 
Îi¡x©Œ
(cÚ¡ *
·th
, *
li¡
, 
size_t
 
size
);

25 
ssize_t
 
æi¡x©Œ
(
fd
, *
li¡
, 
size_t
 
size
);

26 
ssize_t
 
g‘x©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, *
v®ue
, 
size_t
 
size
);

27 
ssize_t
 
lg‘x©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, *
v®ue
, 
size_t
 
size
);

28 
ssize_t
 
fg‘x©Œ
(
fd
, cÚ¡ *
Çme
, *
v®ue
, 
size_t
 
size
);

29 
£tx©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
size
, 
æags
);

30 
l£tx©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
size
, 
æags
);

31 
f£tx©Œ
(
fd
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
size
, 
æags
);

32 
»movex©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
);

33 
Ìemovex©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
);

34 
äemovex©Œ
(
fd
, cÚ¡ *
Çme
);

36 
__mouÁ50
(cÚ¡ *
ty³
, cÚ¡ *
dœ
, 
æags
, *
d©a
, 
size_t
 
d©a_Ën
);

37 
__¡©50
(cÚ¡ *
·th
, 
¡©
 *
sb
);

38 
__l¡©50
(cÚ¡ *
·th
, 
¡©
 *
sb
);

39 
__f¡©50
(
fd
, 
¡©
 *
sb
);

40 
__g‘d’ts30
(
fd
, *
buf
, 
size_t
 
nby‹s
);

41 
__sock‘30
(
domaš
, 
ty³
, 
´ÙocŞ
);

42 
__£Ëù50
(
nfds
, 
fd_£t
 *
»adfds
, fd_£ˆ*
wr™efds
, fd_£ˆ*
exû±fds
, 
timev®
 *
timeout
);

43 
__p£Ëù50
(
nfds
, 
fd_£t
 *
»adfds
, fd_£ˆ*
wr™efds
, fd_£ˆ*
exû±fds
, cÚ¡ 
time¥ec
 *
timeout
, cÚ¡ 
sig£t_t
 *
sigmask
);

44 
__fhİ’40
(cÚ¡ *
fhp
, 
size_t
 
fh_size
, 
æags
);

45 
__fh¡©50
(cÚ¡ *
fhp
, 
size_t
 
fh_size
, 
¡©
 *
sb
);

46 
__fh¡©vfs140
(cÚ¡ *
fhp
, 
size_t
 
fh_size
, 
¡©vfs
 *
buf
, 
æags
);

47 
__g‘fh30
(cÚ¡ *
·th
, *
fhp
, 
size_t
 *
fh_size
);

48 
__utimes50
(cÚ¡ *
·th
, cÚ¡ 
timev®
 
times
[2]);

49 
__lutimes50
(cÚ¡ *
·th
, cÚ¡ 
timev®
 
times
[2]);

50 
__futimes50
(
fd
, cÚ¡ 
timev®
 
times
[2]);

51 
__posix_çdvi£50
(
fd
, 
off_t
 
off£t
, off_ˆ
size
, 
hšt
);

52 
__kev’t50
(
kq
, cÚ¡ 
kev’t
 *
chªg–i¡
, 
size_t
 
nchªges
, kev’ˆ*
ev’i¡
, size_ˆ
Ãv’ts
, cÚ¡ 
time¥ec
 *
timeout
);

53 
__mknod50
(cÚ¡ *
·th
, 
mode_t
 
mode
, 
dev_t
 
dev
);

54 
__pŞÉs50
(
pŞlfd
 * 
»¡riù
 
fds
, 
nfds_t
 
nfds
, cÚ¡ 
time¥ec
 *„e¡riù 
ts
, cÚ¡ 
sig£t_t
 *„e¡riù 
sigmask
);

56 
__g‘cwd
(*
buf
, 
size_t
 
size
);

57 
__libc_sigaùiÚ14
(
signum
, cÚ¡ 
sigaùiÚ
 *
aù
, sigaùiÚ *
Şdaù
);

59 
_k£m_š™
(, 
šŒ_t
 *);

60 
_k£m_İ’
(cÚ¡ *, , 
mode_t
, , 
šŒ_t
 *);

61 
_k£m_uÆšk
(const *);

62 
_k£m_şo£
(
šŒ_t
);

63 
_k£m_po¡
(
šŒ_t
);

64 
_k£m_wa™
(
šŒ_t
);

65 
_k£m_Œywa™
(
šŒ_t
);

66 
_k£m_g‘v®ue
(
šŒ_t
, *);

67 
_k£m_de¡roy
(
šŒ_t
);

68 
_k£m_timedwa™
(
šŒ_t
, cÚ¡ 
time¥ec
 *);

70 
__g‘timeofday50
(
timev®
 *
tv
, *
tz
);

71 
__£‰imeofday50
(cÚ¡ 
timev®
 *
tv
, cÚ¡ *
tz
);

72 
__g‘™im”50
(
which
, 
™im”v®
 *
cu¼_v®ue
);

73 
__£t™im”50
(
which
, cÚ¡ 
™im”v®
 *
Ãw_v®ue
, ™im”v® *
Şd_v®ue
);

74 
__şock_g‘»s50
(
şockid_t
 
şk_id
, 
time¥ec
 *
»s
);

75 
__şock_g‘time50
(
şockid_t
 
şk_id
, 
time¥ec
 *

);

76 
__şock_£‰ime50
(
şockid_t
 
şk_id
, cÚ¡ 
time¥ec
 *

);

77 
__Çno¦“p50
(cÚ¡ 
time¥ec
 *
»q
, time¥eø*
»m
);

78 
__tim”_£‰ime50
(
tim”_t
 
tim”id
, 
æags
, cÚ¡ 
™im”¥ec
 *
Ãw_v®ue
, ™im”¥eø* 
Şd_v®ue
);

79 
__tim”_g‘time50
(
tim”_t
 
tim”id
, 
™im”¥ec
 *
cu¼_v®ue
);

80 
__adjtime50
(cÚ¡ 
timev®
 *
d–
, timev® *
Şdd–
);

82 
f¡©©
(
dœfd
, cÚ¡ *
·thÇme
, 
¡©
 *
buf
, 
æags
);

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/ffitypes.lua

1 -- 
This
 
is
 
ty³s
 
N‘BSD
 
ªd
 
rump
 
	gk”Ãl
, 
which
 
¬e
 
the
 
§me
 
b¬
 
	gÇmes
.

3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "syscall.ffitypes"

16 
loÿl
 
h–³rs
 = 
»quœe
 "syscall.helpers"

18 
loÿl
 
v”siÚ
 = 
»quœe
 "syscall.netbsd.version".version

20 
loÿl
 
defs
 = {}

22 
loÿl
 
funùiÚ
 
	$­³nd
(
¡r
è
defs
[#def + 1] = sŒ 
’d


24 -- 
the£
 
¬e
 
the
 
§me
, 
could
 
ju¡
 
defše
 
as
 
ušt


25 
abi
.
abi64
 
th’


26 
­³nd
 [[

27 
_Ãtbsd_şock_t
;

30 
­³nd
 [[

31 
_Ãtbsd_şock_t
;

33 
’d


35 -- 
»gi¡”_t
 
v¬›s
 
by
 
¬ch


36 
loÿl
 
»gi¡”_t
 = {

37 
x86
 = "int",

38 
x64
 = "long int",

39 
ms
 = "int32_t",

40 
ms64
 = "int64_t",

41 
¥¬c
 = "unsigned†ong int",

42 
¥¬c64
 = "unsigned†ong int",

43 
Ÿ64
 = "long int",

44 
®pha
 = "long int",

45 
µc
 = "long int",

46 
µc64
 = "long int",

47 
¬m
 = "int",

48 
sh3
 = "int",

49 
m68k
 = "int",

50 
hµa
 = "int",

51 
vax
 = "int",

52 
	}
}

54 
­³nd
("ty³deà" .. 
»gi¡”_t
[
abi
.
¬ch
] .. " _netbsd_register_t;")

56 
	g­³nd
 [[

57 
ušt32_t
 
_Ãtbsd_mode_t
;

58 
ušt8_t
 
_Ãtbsd_§_çmy_t
;

59 
ušt64_t
 
_Ãtbsd_dev_t
;

60 
ušt32_t
 
_Ãtbsd_Æšk_t
;

61 
ušt64_t
 
_Ãtbsd_šo_t
;

62 
št64_t
 
_Ãtbsd_time_t
;

63 
št64_t
 
_Ãtbsd_daddr_t
;

64 
ušt64_t
 
_Ãtbsd_blkút_t
;

65 
ušt64_t
 
_Ãtbsd_fsblkút_t
;

66 
ušt64_t
 
_Ãtbsd_fsfút_t
;

67 
ušt32_t
 
_Ãtbsd_blksize_t
;

68 
_Ãtbsd_şockid_t
;

69 
_Ãtbsd_tim”_t
;

70 
_Ãtbsd_su£cÚds_t
;

71 
_Ãtbsd_nfds_t
;

72 
ušt32_t
 
_Ãtbsd_id_t
;

73 
_Ãtbsd_tcæag_t
;

74 
_Ãtbsd_¥“d_t
;

75 
št32_t
 
_Ãtbsd_lwpid_t
;

76 
ušt32_t
 
_Ãtbsd_fix±_t
;

78 
u_shÜt
;

79 
u_ch¬
;

80 
ušt64_t
 
u_quad_t
;

83 
u£cÚds_t
;

84 
št32_t
 
lwpid_t
;

86 ¡ruù { 
št32_t
 
__fsid_v®
[2]; } 
	t_Ãtbsd_fsid_t
;

88 
ušt32_t
 
	t_Ãtbsd_fd_mask
;

90 
_Ãtbsd_fd_mask
 
	mfds_b™s
[8];

91 } 
	t_Ãtbsd_fd_£t
;

92 
	s_Ãtbsd_cmsghdr
 {

93 
size_t
 
	mcmsg_Ën
;

94 
	mcmsg_Ëv–
;

95 
	mcmsg_ty³
;

96 
	mcmsg_d©a
[?];

98 
	s_Ãtbsd_msghdr
 {

99 *
	mmsg_Çme
;

100 
sockËn_t
 
	mmsg_Çm–’
;

101 
iovec
 *
	mmsg_iov
;

102 
	mmsg_iovËn
;

103 *
	mmsg_cÚŒŞ
;

104 
sockËn_t
 
	mmsg_cÚŒŞËn
;

105 
	mmsg_æags
;

107 
	s_Ãtbsd_mmsghdr
 {

108 
_Ãtbsd_msghdr
 
	mmsg_hdr
;

109 
	mmsg_Ën
;

111 
	s_Ãtbsd_time¥ec
 {

112 
_Ãtbsd_time_t
 
	mtv_£c
;

113 
	mtv_n£c
;

115 
	s_Ãtbsd_timev®
 {

116 
_Ãtbsd_time_t
 
	mtv_£c
;

117 
_Ãtbsd_su£cÚds_t
 
	mtv_u£c
;

119 
	s_Ãtbsd_™im”¥ec
 {

120 
_Ãtbsd_time¥ec
 
	m™_š‹rv®
;

121 
_Ãtbsd_time¥ec
 
	m™_v®ue
;

123 
	s_Ãtbsd_™im”v®
 {

124 
_Ãtbsd_timev®
 
	m™_š‹rv®
;

125 
_Ãtbsd_timev®
 
	m™_v®ue
;

128 
ušt32_t
 
	msig
[4];

129 } 
	t_Ãtbsd_sig£t_t
;

130 
	s_Ãtbsd_sockaddr
 {

131 
ušt8_t
 
	m§_Ën
;

132 
_Ãtbsd_§_çmy_t
 
	m§_çmy
;

133 
	m§_d©a
[14];

135 
	s_Ãtbsd_sockaddr_¡Üage
 {

136 
ušt8_t
 
	mss_Ën
;

137 
_Ãtbsd_§_çmy_t
 
	mss_çmy
;

138 
	m__ss_·d1
[6];

139 
št64_t
 
	m__ss_®ign
;

140 
	m__ss_·d2
[128 - 2 - 8 - 6];

142 
	s_Ãtbsd_sockaddr_š
 {

143 
ušt8_t
 
	msš_Ën
;

144 
_Ãtbsd_§_çmy_t
 
	msš_çmy
;

145 
š_pÜt_t
 
	msš_pÜt
;

146 
š_addr
 
	msš_addr
;

147 
št8_t
 
	msš_z”o
[8];

149 
	s_Ãtbsd_sockaddr_š6
 {

150 
ušt8_t
 
	msš6_Ën
;

151 
_Ãtbsd_§_çmy_t
 
	msš6_çmy
;

152 
š_pÜt_t
 
	msš6_pÜt
;

153 
ušt32_t
 
	msš6_æowšfo
;

154 
š6_addr
 
	msš6_addr
;

155 
ušt32_t
 
	msš6_scİe_id
;

157 
	s_Ãtbsd_sockaddr_un
 {

158 
ušt8_t
 
	msun_Ën
;

159 
_Ãtbsd_§_çmy_t
 
	msun_çmy
;

160 
	msun_·th
[104];

162 
	s_Ãtbsd_¡©
 {

163 
_Ãtbsd_dev_t
 
	m¡_dev
;

164 
_Ãtbsd_mode_t
 
	m¡_mode
;

165 
_Ãtbsd_šo_t
 
	m¡_šo
;

166 
_Ãtbsd_Æšk_t
 
	m¡_Æšk
;

167 
uid_t
 
	m¡_uid
;

168 
gid_t
 
	m¡_gid
;

169 
_Ãtbsd_dev_t
 
	m¡_rdev
;

170 
_Ãtbsd_time¥ec
 
	m¡_©ime¥ec
;

171 
_Ãtbsd_time¥ec
 
	m¡_mtime¥ec
;

172 
_Ãtbsd_time¥ec
 
	m¡_ùime¥ec
;

173 
_Ãtbsd_time¥ec
 
	m¡_bœthtime¥ec
;

174 
off_t
 
	m¡_size
;

175 
_Ãtbsd_blkút_t
 
	m¡_blocks
;

176 
_Ãtbsd_blksize_t
 
	m¡_blksize
;

177 
ušt32_t
 
	m¡_æags
;

178 
ušt32_t
 
	m¡_g’
;

179 
ušt32_t
 
	m¡_¥¬e
[2];

181 
	u_Ãtbsd_sigv®
 {

182 
	msiv®_št
;

183 *
	msiv®_±r
;

184 } 
	t_Ãtbsd_sigv®_t
;

185 
	s_Ãtbsd_sigev’t
 {

186 
	msigev_nÙify
;

187 
	msigev_signo
;

188 
_Ãtbsd_sigv®
 
	msigev_v®ue
;

189 (*
	msigev_nÙify_funùiÚ
)(
	m_Ãtbsd_sigv®
);

190 *
	msigev_nÙify_©Œibu‹s
;

192 
	s_Ãtbsd_kev’t
 {

193 
ušŒ_t
 
	mid’t
;

194 
ušt32_t
 
	mf‹r
;

195 
ušt32_t
 
	mæags
;

196 
ušt32_t
 
	mfæags
;

197 
št64_t
 
	md©a
;

198 
šŒ_t
 
	mud©a
;

200 
	s_Ãtbsd_kf‹r_m­pšg
 {

201 *
	mÇme
;

202 
size_t
 
	mËn
;

203 
ušt32_t
 
	mf‹r
;

207 
	gabi
.
abi64
 
th’


208 
	g­³nd
 [[

209 
	s_ksigšfo
 {

210 
_signo
;

211 
_code
;

212 
_”ºo
;

213 
_·d
;

216 
pid_t
 
_pid
;

217 
uid_t
 
_uid
;

218 
_Ãtbsd_sigv®_t
 
_v®ue
;

219 } 
_¹
;

221 
pid_t
 
_pid
;

222 
uid_t
 
_uid
;

223 
_¡©us
;

224 
_Ãtbsd_şock_t
 
_utime
;

225 
_Ãtbsd_şock_t
 
_¡ime
;

226 } 
_chd
;

228 *
_addr
;

229 
_Œ­
;

230 } 
_çuÉ
;

232 
_bªd
;

233 
_fd
;

234 } 
_pŞl
;

235 } 
_»asÚ
;

239 
	g­³nd
 [[

240 
	s_ksigšfo
 {

241 
_signo
;

242 
_code
;

243 
_”ºo
;

246 
pid_t
 
_pid
;

247 
uid_t
 
_uid
;

248 
_Ãtbsd_sigv®_t
 
_v®ue
;

249 } 
_¹
;

251 
pid_t
 
_pid
;

252 
uid_t
 
_uid
;

253 
_¡©us
;

254 
_Ãtbsd_şock_t
 
_utime
;

255 
_Ãtbsd_şock_t
 
_¡ime
;

256 } 
_chd
;

258 *
_addr
;

259 
_Œ­
;

260 } 
_çuÉ
;

262 
_bªd
;

263 
_fd
;

264 } 
_pŞl
;

265 } 
_»asÚ
;

268 
’d


270 
	g­³nd
 [[

271 
	u_Ãtbsd_sigšfo
 {

272 
si_·d
[128];

273 
_ksigšfo
 
	m_šfo
;

274 } 
	t_Ãtbsd_sigšfo_t
;

275 
	s_Ãtbsd_sigaùiÚ
 {

277 (*
	m_§_hªdËr
)();

278 (*
	m_§_sigaùiÚ
)(, 
	m_Ãtbsd_sigšfo_t
 *, *);

279 } 
	m_§_u
;

280 
_Ãtbsd_sig£t_t
 
	m§_mask
;

281 
	m§_æags
;

283 
	s_Ãtbsd_ufs_¬gs
 {

284 *
	mf¥ec
;

286 
	s_Ãtbsd_tmpfs_¬gs
 {

287 
	m_v”siÚ
;

288 
_Ãtbsd_šo_t
 
	m_nodes_max
;

289 
off_t
 
	m_size_max
;

290 
uid_t
 
	m_roÙ_uid
;

291 
gid_t
 
	m_roÙ_gid
;

292 
_Ãtbsd_mode_t
 
	m_roÙ_mode
;

294 
	s_Ãtbsd_±yfs_¬gs
 {

295 
	mv”siÚ
;

296 
gid_t
 
	mgid
;

297 
_Ãtbsd_mode_t
 
	mmode
;

298 
	mæags
;

300 
	s_Ãtbsd_´ocfs_¬gs
 {

301 
	mv”siÚ
;

302 
	mæags
;

304 
	s_Ãtbsd_dœ’t
 {

305 
_Ãtbsd_šo_t
 
	md_f’o
;

306 
ušt16_t
 
	md_»ş’
;

307 
ušt16_t
 
	md_ÇmËn
;

308 
ušt8_t
 
	md_ty³
;

309 
	md_Çme
[512];

311 
	s_Ãtbsd_iäeq
 {

312 
	miä_Çme
[16];

314 
_Ãtbsd_sockaddr
 
	miäu_addr
;

315 
_Ãtbsd_sockaddr
 
	miäu_d¡addr
;

316 
_Ãtbsd_sockaddr
 
	miäu_brßdaddr
;

317 
_Ãtbsd_sockaddr_¡Üage
 
	miäu_¥aû
;

318 
	miäu_æags
;

319 
	miäu_m‘ric
;

320 
	miäu_mtu
;

321 
	miäu_dÉ
;

322 
	miäu_v®ue
;

323 * 
	miäu_d©a
;

325 
ušt32_t
 
	mb_buæ’
;

326 *
	mb_buf
;

327 } 
	miäu_b
;

328 } 
	miä_iäu
;

330 
	s_Ãtbsd_içlŸ¤eq
 {

331 
	miäa_Çme
[16];

332 
_Ãtbsd_sockaddr
 
	miäa_addr
;

333 
_Ãtbsd_sockaddr
 
	miäa_d¡addr
;

334 
_Ãtbsd_sockaddr
 
	miäa_mask
;

336 
	s_Ãtbsd_pŞlfd
 {

337 
	mfd
;

338 
	mev’ts
;

339 
	m»v’ts
;

341 
	s_Ãtbsd_æock
 {

342 
off_t
 
	ml_¡¬t
;

343 
off_t
 
	ml_Ën
;

344 
pid_t
 
	ml_pid
;

345 
	ml_ty³
;

346 
	ml_wh’û
;

348 
	s_Ãtbsd_‹rmios
 {

349 
_Ãtbsd_tcæag_t
 
	mc_iæag
;

350 
_Ãtbsd_tcæag_t
 
	mc_oæag
;

351 
_Ãtbsd_tcæag_t
 
	mc_cæag
;

352 
_Ãtbsd_tcæag_t
 
	mc_læag
;

353 
cc_t
 
	mc_cc
[20];

354 
	mc_i¥“d
;

355 
	mc_o¥“d
;

358 
	s_Ãtbsd_com·t_60_±mg‘
 {

359 
	mcfd
;

360 
	msfd
;

361 
	mú
[16];

362 
	m¢
[16];

364 
	s_Ãtbsd_±mg‘
 {

365 
	mcfd
;

366 
	msfd
;

367 
	mú
[1024];

368 
	m¢
[1024];

370 
	s_Ãtbsd_¡©vfs
 {

371 
	mf_æag
;

372 
	mf_bsize
;

373 
	mf_äsize
;

374 
	mf_iosize
;

375 
_Ãtbsd_fsblkút_t
 
	mf_blocks
;

376 
_Ãtbsd_fsblkút_t
 
	mf_bä“
;

377 
_Ãtbsd_fsblkút_t
 
	mf_bava
;

378 
_Ãtbsd_fsblkút_t
 
	mf_b»svd
;

379 
_Ãtbsd_fsfút_t
 
	mf_fes
;

380 
_Ãtbsd_fsfút_t
 
	mf_fä“
;

381 
_Ãtbsd_fsfút_t
 
	mf_çva
;

382 
_Ãtbsd_fsfút_t
 
	mf_äesvd
;

383 
ušt64_t
 
	mf_synü—ds
;

384 
ušt64_t
 
	mf_syncwr™es
;

385 
ušt64_t
 
	mf_asynü—ds
;

386 
ušt64_t
 
	mf_asyncwr™es
;

387 
_Ãtbsd_fsid_t
 
	mf_fsidx
;

388 
	mf_fsid
;

389 
	mf_Çmemax
;

390 
uid_t
 
	mf_owÃr
;

391 
ušt32_t
 
	mf_¥¬e
[4];

392 
	mf_f¡y³Çme
[32];

393 
	mf_mÁÚÇme
[1024];

394 
	mf_mÁäomÇme
[1024];

396 
	s_Ãtbsd_ru§ge
 {

397 
_Ãtbsd_timev®
 
	mru_utime
;

398 
_Ãtbsd_timev®
 
	mru_¡ime
;

399 
	mru_maxrss
;

400 
	mru_ixrss
;

401 
	mru_idrss
;

402 
	mru_i¤ss
;

403 
	mru_mšæt
;

404 
	mru_majæt
;

405 
	mru_nsw­
;

406 
	mru_šblock
;

407 
	mru_oublock
;

408 
	mru_msg¢d
;

409 
	mru_msgrcv
;

410 
	mru_nsigÇls
;

411 
	mru_nvcsw
;

412 
	mru_nivcsw
;

416 
	gabi
.
Ë
 
th’


417 
	g­³nd
 [[

418 
	s_Ãtbsd_kŒ_h—d”
 {

419 
kŒ_Ën
;

420 
kŒ_ty³
;

421 
kŒ_v”siÚ
;

422 
pid_t
 
kŒ_pid
;

423 
kŒ_comm
[17];

427 
št32_t
 
	mtv_£c
;

428 
	mtv_u£c
;

429 } 
	m_tv
;

430 cÚ¡ *
	m_buf
;

431 } 
	m_v0
;

434 
št32_t
 
	mtv_£c
;

435 
	mtv_n£c
;

436 } 
	m_ts
;

437 
lwpid_t
 
	m_lid
;

438 } 
	m_v1
;

440 
_Ãtbsd_time¥ec
 
	m_ts
;

441 
lwpid_t
 
	m_lid
;

442 } 
	m_v2
;

443 } 
	m_v
;

447 
	g­³nd
 [[

448 
	s_Ãtbsd_kŒ_h—d”
 {

449 
kŒ_Ën
;

450 
kŒ_v”siÚ
;

451 
kŒ_ty³
;

452 
pid_t
 
kŒ_pid
;

453 
kŒ_comm
[17];

457 
št32_t
 
	mtv_£c
;

458 
	mtv_u£c
;

459 } 
	m_tv
;

460 cÚ¡ *
	m_buf
;

461 } 
	m_v0
;

464 
št32_t
 
	mtv_£c
;

465 
	mtv_n£c
;

466 } 
	m_ts
;

467 
lwpid_t
 
	m_lid
;

468 } 
	m_v1
;

470 
_Ãtbsd_time¥ec
 
	m_ts
;

471 
lwpid_t
 
	m_lid
;

472 } 
	m_v2
;

473 } 
	m_v
;

476 
’d


478 
	g­³nd
 [[

479 
	s_Ãtbsd_kŒ_sysÿÎ
 {

480 
kŒ_code
;

481 
kŒ_¬gsize
;

483 
	s_Ãtbsd_kŒ_sy¤‘
 {

484 
kŒ_code
;

485 
kŒ_eosys
;

486 
kŒ_”rÜ
;

487 
_Ãtbsd_»gi¡”_t
 
kŒ_»tv®
;

488 
_Ãtbsd_»gi¡”_t
 
kŒ_»tv®_1
;

490 
	s_Ãtbsd_kŒ_g’io
 {

491 
kŒ_fd
;

492 
kŒ_rw
;

494 
	s_Ãtbsd_kŒ_psig
 {

495 
signo
;

496 
sig_t
 
aùiÚ
;

497 
_Ãtbsd_sig£t_t
 
mask
;

498 
code
;

500 
	s_Ãtbsd_kŒ_csw
 {

501 
out
;

502 
u£r
;

504 
	s_Ãtbsd_kŒ_u£r
 {

505 
kŒ_id
[20];

507 
	s_Ãtbsd_kŒ_§upÿÎ
 {

508 
	mkŒ_ty³
;

509 
	mkŒ_Ãv’t
;

510 
	mkŒ_nšt
;

511 *
	mkŒ_§s
;

512 *
	mkŒ_­
;

514 
	s_Ãtbsd_kŒ_execfd
 {

515 
	mkŒ_fd
;

516 
	mkŒ_dty³
;

518 
	s_Ãtbsd_ifdrv
 {

519 
	mifd_Çme
[16];

520 
	mifd_cmd
;

521 
size_t
 
	mifd_Ën
;

522 *
	mifd_d©a
;

524 
	s_Ãtbsd_ifb»q
 {

525 
	mifbr_if¢ame
[16];

526 
ušt32_t
 
	mifbr_ifsæags
;

527 
ušt8_t
 
	mifbr_¡©e
;

528 
ušt8_t
 
	mifbr_´iÜ™y
;

529 
ušt8_t
 
	mifbr_·th_co¡
;

530 
ušt8_t
 
	mifbr_pÜŠo
;

532 
	s_Ãtbsd_š6_add¾iãtime
 {

533 
_Ãtbsd_time_t
 
	mŸ6t_expœe
;

534 
_Ãtbsd_time_t
 
	mŸ6t_´eã¼ed
;

535 
ušt32_t
 
	mŸ6t_vÉime
;

536 
ušt32_t
 
	mŸ6t_¶time
;

538 
	s_Ãtbsd_š6_if¡©
 {

539 
u_quad_t
 
	mifs6_š_»ûive
;

540 
u_quad_t
 
	mifs6_š_hd»¼
;

541 
u_quad_t
 
	mifs6_š_toobig
;

542 
u_quad_t
 
	mifs6_š_nÜou‹
;

543 
u_quad_t
 
	mifs6_š_add»¼
;

544 
u_quad_t
 
	mifs6_š_´Ùounknown
;

545 
u_quad_t
 
	mifs6_š_Œunÿ‹d
;

546 
u_quad_t
 
	mifs6_š_disÿrd
;

547 
u_quad_t
 
	mifs6_š_d–iv”
;

548 
u_quad_t
 
	mifs6_out_fÜw¬d
;

549 
u_quad_t
 
	mifs6_out_»que¡
;

550 
u_quad_t
 
	mifs6_out_disÿrd
;

551 
u_quad_t
 
	mifs6_out_äagok
;

552 
u_quad_t
 
	mifs6_out_äagç
;

553 
u_quad_t
 
	mifs6_out_äagü—t
;

554 
u_quad_t
 
	mifs6_»ass_»qd
;

555 
u_quad_t
 
	mifs6_»ass_ok
;

556 
u_quad_t
 
	mifs6_»ass_ç
;

557 
u_quad_t
 
	mifs6_š_mÿ¡
;

558 
u_quad_t
 
	mifs6_out_mÿ¡
;

560 
	s_Ãtbsd_icmp6_if¡©
 {

561 
u_quad_t
 
	mifs6_š_msg
;

562 
u_quad_t
 
	mifs6_š_”rÜ
;

563 
u_quad_t
 
	mifs6_š_d¡uÄ—ch
;

564 
u_quad_t
 
	mifs6_š_admš´ohib
;

565 
u_quad_t
 
	mifs6_š_tim“xûed
;

566 
u_quad_t
 
	mifs6_š_·¿m´ob
;

567 
u_quad_t
 
	mifs6_š_pk‰oobig
;

568 
u_quad_t
 
	mifs6_š_echo
;

569 
u_quad_t
 
	mifs6_š_echÜ•ly
;

570 
u_quad_t
 
	mifs6_š_rou‹rsŞic™
;

571 
u_quad_t
 
	mifs6_š_rou‹¿dv”t
;

572 
u_quad_t
 
	mifs6_š_ÃighbÜsŞic™
;

573 
u_quad_t
 
	mifs6_š_ÃighbÜadv”t
;

574 
u_quad_t
 
	mifs6_š_»dœeù
;

575 
u_quad_t
 
	mifs6_š_mldqu”y
;

576 
u_quad_t
 
	mifs6_š_mld»pÜt
;

577 
u_quad_t
 
	mifs6_š_mlddÚe
;

578 
u_quad_t
 
	mifs6_out_msg
;

579 
u_quad_t
 
	mifs6_out_”rÜ
;

580 
u_quad_t
 
	mifs6_out_d¡uÄ—ch
;

581 
u_quad_t
 
	mifs6_out_admš´ohib
;

582 
u_quad_t
 
	mifs6_out_tim“xûed
;

583 
u_quad_t
 
	mifs6_out_·¿m´ob
;

584 
u_quad_t
 
	mifs6_out_pk‰oobig
;

585 
u_quad_t
 
	mifs6_out_echo
;

586 
u_quad_t
 
	mifs6_out_echÜ•ly
;

587 
u_quad_t
 
	mifs6_out_rou‹rsŞic™
;

588 
u_quad_t
 
	mifs6_out_rou‹¿dv”t
;

589 
u_quad_t
 
	mifs6_out_ÃighbÜsŞic™
;

590 
u_quad_t
 
	mifs6_out_ÃighbÜadv”t
;

591 
u_quad_t
 
	mifs6_out_»dœeù
;

592 
u_quad_t
 
	mifs6_out_mldqu”y
;

593 
u_quad_t
 
	mifs6_out_mld»pÜt
;

594 
u_quad_t
 
	mifs6_out_mlddÚe
;

596 
	s_Ãtbsd_š6_iäeq
 {

597 
	miä_Çme
[16];

599 
_Ãtbsd_sockaddr_š6
 
	miäu_addr
;

600 
_Ãtbsd_sockaddr_š6
 
	miäu_d¡addr
;

601 
	miäu_æags
;

602 
	miäu_æags6
;

603 
	miäu_m‘ric
;

604 * 
	miäu_d©a
;

605 
_Ãtbsd_š6_add¾iãtime
 
	miäu_liãtime
;

606 
_Ãtbsd_š6_if¡©
 
	miäu_¡©
;

607 
_Ãtbsd_icmp6_if¡©
 
	miäu_icmp6¡©
;

608 } 
	miä_iäu
;

610 
	s_Ãtbsd_š6_®Ÿ¤eq
 {

611 
	miäa_Çme
[16];

612 
_Ãtbsd_sockaddr_š6
 
	miäa_addr
;

613 
_Ãtbsd_sockaddr_š6
 
	miäa_d¡addr
;

614 
_Ãtbsd_sockaddr_š6
 
	miäa_´efixmask
;

615 
	miäa_æags
;

616 
_Ãtbsd_š6_add¾iãtime
 
	miäa_liãtime
;

618 
	s_Ãtbsd_¹_m‘rics
 {

619 
ušt64_t
 
	mrmx_locks
;

620 
ušt64_t
 
	mrmx_mtu
;

621 
ušt64_t
 
	mrmx_hİcouÁ
;

622 
ušt64_t
 
	mrmx_»cvpe
;

623 
ušt64_t
 
	mrmx_£ndpe
;

624 
ušt64_t
 
	mrmx_s¡h»sh
;

625 
ušt64_t
 
	mrmx_¹t
;

626 
ušt64_t
 
	mrmx_¹tv¬
;

627 
_Ãtbsd_time_t
 
	mrmx_expœe
;

628 
_Ãtbsd_time_t
 
	mrmx_pk£Á
;

630 
	s_Ãtbsd_¹_msghdr
 {

631 
u_shÜt
 
¹m_msgËn
 
__©Œibu‹__
 ((
®igÃd
 (8)));

632 
u_ch¬
 
	m¹m_v”siÚ
;

633 
u_ch¬
 
	m¹m_ty³
;

634 
u_shÜt
 
	m¹m_šdex
;

635 
	m¹m_æags
;

636 
	m¹m_addrs
;

637 
pid_t
 
	m¹m_pid
;

638 
	m¹m_£q
;

639 
	m¹m_”ºo
;

640 
	m¹m_u£
;

641 
	m¹m_š™s
;

642 
_Ãtbsd_¹_m‘rics
 
¹m_rmx
 
__©Œibu‹__
 ((
®igÃd
 (8)));

644 
	s_Ãtbsd_şockšfo
 {

645 
	mhz
;

646 
	mtick
;

647 
	mtickadj
;

648 
	m¡©hz
;

649 
	m´ofhz
;

651 
	s_Ãtbsd_lßdavg
 {

652 
_Ãtbsd_fix±_t
 
	mldavg
[3];

653 
	mfsÿË
;

655 
	s_Ãtbsd_vmtÙ®


657 
št16_t
 
	mt_rq
;

658 
št16_t
 
	mt_dw
;

659 
št16_t
 
	mt_pw
;

660 
št16_t
 
	mt_¦
;

661 
št16_t
 
	m_»£rved1
;

662 
št32_t
 
	mt_vm
;

663 
št32_t
 
	mt_avm
;

664 
št32_t
 
	mt_rm
;

665 
št32_t
 
	mt_¬m
;

666 
št32_t
 
	mt_vmshr
;

667 
št32_t
 
	mt_avmshr
;

668 
št32_t
 
	mt_rmshr
;

669 
št32_t
 
	mt_¬mshr
;

670 
št32_t
 
	mt_ä“
;

672 
	s_Ãtbsd_ùÊame
 {

673 cÚ¡ *
	mùl_Çme
;

674 
	mùl_ty³
;

677 
	s_Ãtbsd_aiocb
 {

678 
off_t
 
	maio_off£t
;

679 vŞ©*
	maio_buf
;

680 
size_t
 
	maio_nby‹s
;

681 
	maio_fdes
;

682 
	maio_lio_İcode
;

683 
	maio_»q´io
;

684 
_Ãtbsd_sigev’t
 
	maio_sigev’t
;

686 
	m_¡©e
;

687 
	m_”ºo
;

688 
ssize_t
 
	m_»tv®
;

692 
loÿl
 
	gs
 = 
bË
.
cÚÿt
(
defs
, "")

694 -- 
TODO
 
	gbrok’
, 
makes
 
this
 
moduË
 
nÙ
 
a
 
´İ”
 
	gfunùiÚ
, 
	g£e
 #120

695 -- 
®though
 
this
 
wl
 
nÙ
 
ev”
 
aùu®ly
 
	gh­³n
...

696 
	gabi
.
	gho¡
 =ğ"Ãtbsd" 
th’


697 
s
 = 
¡ršg
.
gsub
(s, "_Ãtbsd_", ""è-- 
»move
 
Ãtbsd
 
ty³s


698 
’d


700 
	gffi
.
cdef
(
s
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/init.lua

1 -- 
N‘BSD
 
	gš™


3 -- 
This
 
»tuºs
 
N‘BSD
 
ty³s
 
ªd
 
	$cÚ¡ªts
 (
but
 
no
 
sysÿÎs
è
und”
 
ªy
 
OS
.

4 -- 
Also
 
»tuºs
 
ut
, 
which
 
is
 
a
 
b™
 
of
‡ 
´obËm
, 
as
 
some
 oà
the£
 
wl
 
u£
 
sysÿÎs


5 -- 
Cu¼’y
 
u£d
 
by
 
kdump
 
exam¶e
 
to
 
g‘
 
N‘BSD
 
kŒaû
 
ty³s


7 
loÿl
 
»quœe
 =„equire

9 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

11 
loÿl
 
Şdos
, 
Şdbsd
 = 
abi
.
os
,‡bi.
bsd


13 
abi
.
os
 = "netbsd"

14 
abi
.
bsd
 = 
Œue


16 -- 
TODO
 
this
 
should
 
be
 
sh¬ed
 
w™h
 
rump
! 
‹mpÜ¬y
 
h”e


17 
loÿl
 
unchªged
 = {

18 ğ
Œue
,

19 ğ
Œue
,

20 ğ
Œue
,

21 ğ
Œue
,

22 ["unsigÃd ch¬"] = 
Œue
,

23 ["unsigÃd iÁ"] = 
Œue
,

24 ["unsigÃd†Úg"] = 
Œue
,

25 
št8_t
 = 
Œue
,

26 
št16_t
 = 
Œue
,

27 
št32_t
 = 
Œue
,

28 
št64_t
 = 
Œue
,

29 
šŒ_t
 = 
Œue
,

30 
ušt8_t
 = 
Œue
,

31 
ušt16_t
 = 
Œue
,

32 
ušt32_t
 = 
Œue
,

33 
ušt64_t
 = 
Œue
,

34 
ušŒ_t
 = 
Œue
,

35 -- 
§me
 
š
 
®l
 
OSs
 
©
 
´e£Á


36 
š_pÜt_t
 = 
Œue
,

37 
uid_t
 = 
Œue
,

38 
gid_t
 = 
Œue
,

39 
pid_t
 = 
Œue
,

40 
off_t
 = 
Œue
,

41 
size_t
 = 
Œue
,

42 
ssize_t
 = 
Œue
,

43 
sockËn_t
 = 
Œue
,

44 ["¡ruù in_addr"] = 
Œue
,

45 ["¡ruù in6_addr"] = 
Œue
,

46 ["¡ruù iovec"] = 
Œue
,

47 ["¡ruù iphdr"] = 
Œue
,

48 ["¡ruù udphdr"] = 
Œue
,

49 ["¡ruùƒthhdr"] = 
Œue
,

50 ["¡ruù wšsize"] = 
Œue
,

51 ["¡ruù {šˆcouÁ; sŒuù ioveøiov[?];}"] = 
Œue
,

52 
	}
}

54 
loÿl
 
funùiÚ
 
	$rumpâ
(

)

55 
unchªged
[

] 
th’
 °
’d


56 

 =ğ"void (*)(št, sigšfo_ˆ*, void *)" 
th’
  "void (*)(št, _Ãtbsd_sigšfo_ˆ*, void *)" 
’d


57 

 =ğ"¡ruù {dev_ˆdev;}" 
th’
  "¡ruù {_Ãtbsd_dev_ˆdev;}" 
’d


58 
¡ršg
.
	`fšd
(

, "¡ruù"è
th’


59  (
¡ršg
.
	`gsub
(

, "struct (%a)", "struct _netbsd_%1"))

60 
’d


61  "_Ãtbsd_" .. 



62 
’d


64 
abi
.
rumpâ
 =„umpfn

66 
abi
.
ty³s
 = "netbsd"

68 
loÿl
 
S
 = {
	}
}

70 
»quœe
 "syscall.netbsd.ffitypes"

72 
loÿl
 
o¡y³s
 = 
»quœe
 "syscall.netbsd.types"

73 
loÿl
 
c
 = 
»quœe
 "syscall.netbsd.constants"

74 
loÿl
 
bsdty³s
 = 
»quœe
 "syscall.bsd.types"

75 
loÿl
 
ty³s
 = 
»quœe
 "sysÿÎ.ty³s".
	$š™
(
c
, 
o¡y³s
, 
bsdty³s
)

77 
c
.
IOCTL
 = 
	`»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".ioùl").
	$š™
(
ty³s
)

78 
S
.
c
 = c

79 
S
.
ty³s
 =ypes

80 
S
.
t
 = 
ty³s
.t

81 
S
.
abi
 =‡bi

82 
S
.
ut
 = 
»quœe
 "sysÿÎ.ut".
	$š™
(
S
)

84 
abi
.
os
,‡bi.
bsd
 = 
Şdos
, 
Şdbsd


85 
abi
.
rumpâ
 = 
n


87  
S


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/ioctl.lua

1 -- 
	gioùls
, 
flšg
 
š
 
as
 
Ãeded


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
s
, 
t
 = 
ty³s
.s,ypes.t

14 
loÿl
 
¡ræag
 = 
	`»quœe
("syscall.helpers").strflag

15 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

17 
loÿl
 
bªd
 = 
b™
.band

18 
loÿl
 
funùiÚ
 
	$bÜ
(...)

19 
loÿl
 
r
 = 
b™
.
	$bÜ
(...)

20 
r
 < 0 
th’
„ =„ + 4294967296 
’d
 -- 
wªt
 
¿nge


21  
r


22 
’d


23 
loÿl
 
lshiá
 = 
b™
.lshift

24 
loÿl
 
rshiá
 = 
b™
.rshift

26 
loÿl
 
IOC
 = {

27 
VOID
 = 0x20000000,

28 
OUT
 = 0x40000000,

29 
IN
 = 0x80000000,

31 
DIRMASK
 = 0xe0000000,

32 
PARM_MASK
 = 0x1fff,

33 
PARM_SHIFT
 = 16,

34 
GROUP_SHIFT
 = 8,

35 
	}
}

37 
	gIOC
.
	gINOUT
 = 
IOC
.
IN
 + IOC.
OUT


39 
loÿl
 
funùiÚ
 
	$ioc
(
dœ
, 
ch
, 
Ä
, 
size
)

40  
t
.
	`ulÚg
(
	`bÜ
(
dœ
,

41 
	`lshiá
(
	`bªd
(
size
, 
IOC
.
PARM_MASK
), IOC.
PARM_SHIFT
),

42 
	`lshiá
(
ch
, 
IOC
.
GROUP_SHIFT
),

43 
Ä
))

44 
’d


46 
loÿl
 
sšgËtÚm­
 = {

49 
ušt
 = "uint1",

50 
ušt64
 = "uint64_1",

51 
	}
}

53 
loÿl
 
funùiÚ
 
	$_IOC
(
dœ
, 
ch
, 
Ä
, 

)

54 
	`ty³
(
ch
è=ğ"¡ršg" 
th’
 ch = ch:
	$by‹
(è
’d


55 
	`ty³
(

è=ğ"numb”" 
th’
  
	$ioc
(
dœ
, 
ch
, 
Ä
, 

è
’d


56 
loÿl
 
size
 = 
s
[

]

57 
loÿl
 
sšgËtÚ
 = 
sšgËtÚm­
[

] ~ğ
n


58 

 = 
sšgËtÚm­
[] 
Ü
p

59  {
numb”
 = 
	`ioc
(
dœ
, 
ch
, 
Ä
, 
size
),

60 
»ad
 = 
dœ
 =ğ
IOC
.
OUT
 
Ü
 dœ =ğIOC.
INOUT
, 
wr™e
 = dœ =ğIOC.
IN
 or dir == IOC.INOUT,

61 
ty³
 = 
t
[

], 
sšgËtÚ
 = 
	}
singleton}

62 
’d


64 
loÿl
 
	g_IO
 = 
	$funùiÚ
(
ch
, 
Ä
è 
	$_IOC
(
IOC
.
VOID
, 
ch
, 
Ä
, 0è
’d


65 
loÿl
 
_IOR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
OUT
, 
ch
, 
Ä
, 

è
’d


66 
loÿl
 
_IOW
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
IN
, 
ch
, 
Ä
, 

è
’d


67 
loÿl
 
_IOWR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
INOUT
, 
ch
, 
Ä
, 

è
’d


70 
	#IOCPARM_LEN
(
x
è(((xè>> 
IOCPARM_SHIFT
è& 
IOCPARM_MASK
)

	)

71 
	#IOCBASECMD
(
x
è((xè& ~(
IOCPARM_MASK
 << 
IOCPARM_SHIFT
))

	)

72 
	#IOCGROUP
(
x
è(((xè>> 
IOCGROUP_SHIFT
è& 0xff)

	)

74 
	#IOCPARM_MAX
 
NBPG


	)

77 
loÿl
 
ioùl
 = 
¡ræag
 {

78 -- 
‰y
 
ioùls


79 
TIOCEXCL
 = 
	`_IO
('t', 13),

80 
TIOCNXCL
 = 
	`_IO
('t', 14),

81 
TIOCFLUSH
 = 
	`_IOW
('t', 16, "int"),

82 
TIOCGETA
 = 
	`_IOR
('t', 19, "termios"),

83 
TIOCSETA
 = 
	`_IOW
('t', 20, "termios"),

84 
TIOCSETAW
 = 
	`_IOW
('t', 21, "termios"),

85 
TIOCSETAF
 = 
	`_IOW
('t', 22, "termios"),

86 
TIOCGETD
 = 
	`_IOR
('t', 26, "int"),

87 
TIOCSETD
 = 
	`_IOW
('t', 27, "int"),

88 -#defš
	#TTLINEDNAMELEN
 32

	)

89 --
	tlšedn_t
[
TTLINEDNAMELEN
]

90 --
	tTIOCGLINED
 = 
	t_IOR
('t', 66, 
	tlšedn_t
),

91 --
	tTIOCSLINED
 = 
	t_IOW
('t', 67, 
	tlšedn_t
),

92 
	tTIOCSBRK
 = 
	t_IO
('t', 123),

93 
	tTIOCCBRK
 = 
	t_IO
('t', 122),

94 
	tTIOCSDTR
 = 
	t_IO
('t', 121),

95 
	tTIOCCDTR
 = 
	t_IO
('t', 120),

96 
	tTIOCGPGRP
 = 
	t_IOR
('t', 119, "int"),

97 
	tTIOCSPGRP
 = 
	t_IOW
('t', 118, "int"),

98 
	tTIOCOUTQ
 = 
	t_IOR
('t', 115, "int"),

99 
	tTIOCSTI
 = 
	t_IOW
('t', 114, "char"),

100 
	tTIOCNOTTY
 = 
	t_IO
('t', 113),

101 
	tTIOCPKT
 = 
	t_IOW
('t', 112, "št"), -- 
	tTODO
 
	tthis
 
	tdefšes
 
	tcÚ¡ªts
 
	teg
 
	tTIOCPKT_DATA
 
	tÃed
 
	tway
 
	tto
 
	tsuµÜt


102 
	tTIOCSTOP
 = 
	t_IO
('t', 111),

103 
	tTIOCSTART
 = 
	t_IO
('t', 110),

104 
	tTIOCMSET
 = 
	t_IOW
('t', 109, "št"), -- 
	ttodo
 
	tu£s
 
	tcÚ¡ªts
 
	teg
 
	tTIOCM_LE


105 
	tTIOCMBIS
 = 
	t_IOW
('t', 108, "int"),

106 
	tTIOCMBIC
 = 
	t_IOW
('t', 107, "int"),

107 
	tTIOCMGET
 = 
	t_IOR
('t', 106, "int"),

108 
	tTIOCREMOTE
 = 
	t_IOW
('t', 105, "int"),

109 
	tTIOCGWINSZ
 = 
	t_IOR
('t', 104, "winsize"),

110 
	tTIOCSWINSZ
 = 
	t_IOW
('t', 103, "winsize"),

111 
	tTIOCUCNTL
 = 
	t_IOW
('t', 102, "int"),

112 
	tTIOCSTAT
 = 
	t_IOW
('t', 101, "int"),

113 --
	tUIOCCMD
(
	tn
èğ
	t_IO
('u',‚),

114 
	tTIOCGSID
 = 
	t_IOR
('t', 99, "int"),

115 
	tTIOCCONS
 = 
	t_IOW
('t', 98, "int"),

116 
	tTIOCSCTTY
 = 
	t_IO
('t', 97),

117 
	tTIOCEXT
 = 
	t_IOW
('t', 96, "int"),

118 
	tTIOCSCTTY
 = 
	t_IO
('t', 97),

119 
	tTIOCEXT
 = 
	t_IOW
('t', 96, "int"),

120 
	tTIOCSIG
 = 
	t_IO
('t', 95),

121 
	tTIOCDRAIN
 = 
	t_IO
('t', 94),

122 
	tTIOCGFLAGS
 = 
	t_IOR
('t', 93, "int"),

123 
	tTIOCSFLAGS
 = 
	t_IOW
('t', 92, "št"), -- 
	tTODO
 
	tdefšes
 
	tæags
 
	tTIOCFLAG_
*

124 
	tTIOCDCDTIMESTAMP
=
	t_IOR
('t', 88, "timeval"),

125 --
	tTIOCRCVFRAME
 = 
	t_IOW
('t', 69, 
	tmbuf
 *), -- 
	tTODO
 
	tpoš‹r
 
	tnÙ
 

126 --
	tTIOCXMTFRAME
 = 
	t_IOW
('t', 68, 
	tmbuf
 *), -- 
	tTODO
 
	tpoš‹r
 
	tnÙ
 

127 
	tTIOCPTMGET
 = 
	t_IOR
('t', 70, "ptmget"),

128 
	tTIOCGRANTPT
 = 
	t_IO
('t', 71),

129 
	tTIOCPTSNAME
 = 
	t_IOR
('t', 72, "ptmget"),

130 
	tTIOCSQSIZE
 = 
	t_IOW
('t', 128, "int"),

131 
	tTIOCGQSIZE
 = 
	t_IOR
('t', 129, "int"),

132 -- 
	tsock‘
 
	tioùls


133 
	tSIOCSHIWAT
 = 
	t_IOW
('s', 0, "int"),

134 
	tSIOCGHIWAT
 = 
	t_IOR
('s', 1, "int"),

135 
	tSIOCSLOWAT
 = 
	t_IOW
('s', 2, "int"),

136 
	tSIOCGLOWAT
 = 
	t_IOR
('s', 3, "int"),

137 
	tSIOCATMARK
 = 
	t_IOR
('s', 7, "int"),

138 
	tSIOCSPGRP
 = 
	t_IOW
('s', 8, "int"),

139 
	tSIOCGPGRP
 = 
	t_IOR
('s', 9, "int"),

140 --
	tSIOCADDRT
 = 
	t_IOW
('r', 10, "ortentry"),

141 --
	tSIOCDELRT
 = 
	t_IOW
('r', 11, "ortentry"),

142 
	tSIOCSIFADDR
 = 
	t_IOW
('i', 12, "ifreq"),

143 
	tSIOCGIFADDR
 = 
	t_IOWR
('i', 33, "ifreq"),

144 
	tSIOCSIFDSTADDR
 = 
	t_IOW
('i', 14, "ifreq"),

145 
	tSIOCGIFDSTADDR
 = 
	t_IOWR
('i', 34, "ifreq"),

146 
	tSIOCSIFFLAGS
 = 
	t_IOW
('i', 16, "ifreq"),

147 
	tSIOCGIFFLAGS
 = 
	t_IOWR
('i', 17, "ifreq"),

148 
	tSIOCGIFBRDADDR
 = 
	t_IOWR
('i', 35, "ifreq"),

149 
	tSIOCSIFBRDADDR
 = 
	t_IOW
('i', 19, "ifreq"),

150 --
	tSIOCGIFCONF
 = 
	t_IOWR
('i', 38, "ifconf"),

151 
	tSIOCGIFNETMASK
 = 
	t_IOWR
('i', 37, "ifreq"),

152 
	tSIOCSIFNETMASK
 = 
	t_IOW
('i', 22, "ifreq"),

153 
	tSIOCGIFMETRIC
 = 
	t_IOWR
('i', 23, "ifreq"),

154 
	tSIOCSIFMETRIC
 = 
	t_IOW
('i', 24, "ifreq"),

155 
	tSIOCDIFADDR
 = 
	t_IOW
('i', 25, "ifreq"),

156 
	tSIOCAIFADDR
 = 
	t_IOW
('i', 26, "ifaliasreq"),

157 
	tSIOCGIFALIAS
 = 
	t_IOWR
('i', 27, "ifaliasreq"),

158 --
	tSIOCALIFADDR
 = 
	t_IOW
('i', 28, "if_laddrreq"),

159 --
	tSIOCGLIFADDR
 = 
	t_IOWR
('i', 29, "if_laddrreq"),

160 --
	tSIOCDLIFADDR
 = 
	t_IOW
('i', 30, "if_laddrreq"),

161 --
	tSIOCSIFADDRPREF
ğ
	t_IOW
('i', 31, "if_addrprefreq"),

162 --
	tSIOCGIFADDRPREF
ğ
	t_IOWR
('i', 32, "if_addrprefreq"),

163 
	tSIOCADDMULTI
 = 
	t_IOW
('i', 49, "ifreq"),

164 
	tSIOCDELMULTI
 = 
	t_IOW
('i', 50, "ifreq"),

165 --
	tSIOCGETVIFCNT
 = 
	t_IOWR
('u', 51, "sioc_vif_req"),

166 --
	tSIOCGETSGCNT
 = 
	t_IOWR
('u', 52, "sioc_sg_req"),

167 
	tSIOCSIFMEDIA
 = 
	t_IOWR
('i', 53, "ifreq"),

168 --
	tSIOCGIFMEDIA
 = 
	t_IOWR
('i', 54, "ifmediareq"),

169 
	tSIOCSIFGENERIC
 = 
	t_IOW
('i', 57, "ifreq"),

170 
	tSIOCGIFGENERIC
 = 
	t_IOWR
('i', 58, "ifreq"),

171 
	tSIOCSIFPHYADDR
 = 
	t_IOW
('i', 70, "ifaliasreq"),

172 
	tSIOCGIFPSRCADDR
ğ
	t_IOWR
('i', 71, "ifreq"),

173 
	tSIOCGIFPDSTADDR
ğ
	t_IOWR
('i', 72, "ifreq"),

174 
	tSIOCDIFPHYADDR
 = 
	t_IOW
('i', 73, "ifreq"),

175 --
	tSIOCSLIFPHYADDR
ğ
	t_IOW
('i', 74, "if_laddrreq"),

176 --
	tSIOCGLIFPHYADDR
ğ
	t_IOWR
('i', 75, "if_laddrreq"),

177 
	tSIOCSIFMTU
 = 
	t_IOW
('i', 127, "ifreq"),

178 
	tSIOCGIFMTU
 = 
	t_IOWR
('i', 126, "ifreq"),

179 
	tSIOCSDRVSPEC
 = 
	t_IOW
('i', 123, "ifdrv"),

180 
	tSIOCGDRVSPEC
 = 
	t_IOWR
('i', 123, "ifdrv"),

181 
	tSIOCIFCREATE
 = 
	t_IOW
('i', 122, "ifreq"),

182 
	tSIOCIFDESTROY
 = 
	t_IOW
('i', 121, "ifreq"),

183 --
	tSIOCIFGCLONERS
 = 
	t_IOWR
('i', 120, "if_clonereq"),

184 
	tSIOCGIFDLT
 = 
	t_IOWR
('i', 119, "ifreq"),

185 --
	tSIOCGIFCAP
 = 
	t_IOWR
('i', 118, "ifcapreq"),

186 --
	tSIOCSIFCAP
 = 
	t_IOW
('i', 117, "ifcapreq"),

187 
	tSIOCSVH
 = 
	t_IOWR
('i', 130, "ifreq"),

188 
	tSIOCGVH
 = 
	t_IOWR
('i', 131, "ifreq"),

189 --
	tSIOCINITIFADDR
 = 
	t_IOWR
('i', 132, "ifaddr"),

190 --
	tSIOCGIFDATA
 = 
	t_IOWR
('i', 133, "ifdatareq"),

191 --
	tSIOCZIFDATA
 = 
	t_IOWR
('i', 134, "ifdatareq"),

192 
	tSIOCGLINKSTR
 = 
	t_IOWR
('i', 135, "ifdrv"),

193 
	tSIOCSLINKSTR
 = 
	t_IOW
('i', 136, "ifdrv"),

194 
	tSIOCSETPFSYNC
 = 
	t_IOW
('i', 247, "ifreq"),

195 
	tSIOCGETPFSYNC
 = 
	t_IOWR
('i', 248, "ifreq"),

197 -- 
	tv6
 
	tioùls


198 
	tSIOCSIFADDR_IN6
 = 
	t_IOW
('i', 12, "in6_ifreq"),

199 
	tSIOCGIFADDR_IN6
 = 
	t_IOWR
('i', 33, "in6_ifreq"),

200 
	tSIOCGIFDSTADDR_IN6
 = 
	t_IOWR
('i', 34, "in6_ifreq"),

201 
	tSIOCGIFNETMASK_IN6
 = 
	t_IOWR
('i', 37, "in6_ifreq"),

202 
	tSIOCDIFADDR_IN6
 = 
	t_IOW
('i', 25, "in6_ifreq"),

203 
	tSIOCGIFPSRCADDR_IN6
 = 
	t_IOWR
('i', 71, "in6_ifreq"),

204 
	tSIOCGIFPDSTADDR_IN6
 = 
	t_IOWR
('i', 72, "in6_ifreq"),

205 
	tSIOCGIFAFLAG_IN6
 = 
	t_IOWR
('i', 73, "in6_ifreq"),

206 --
	tSIOCGDRLST_IN6
 = 
	t_IOWR
('i', 74, "in6_drlist"),

207 --
	tSIOCGPRLST_IN6
 = 
	t_IOWR
('i', 75, "in6_oprlist"),

208 
	tSIOCSNDFLUSH_IN6
 = 
	t_IOWR
('i', 77, "in6_ifreq"),

209 --
	tSIOCGNBRINFO_IN6
 = 
	t_IOWR
('i', 78, "in6_nbrinfo"),

210 
	tSIOCSPFXFLUSH_IN6
 = 
	t_IOWR
('i', 79, "in6_ifreq"),

211 
	tSIOCSRTRFLUSH_IN6
 = 
	t_IOWR
('i', 80, "in6_ifreq"),

212 
	tSIOCGIFSTAT_IN6
 = 
	t_IOWR
('i', 83, "in6_ifreq"),

213 
	tSIOCGIFSTAT_ICMP6
 = 
	t_IOWR
('i', 84, "in6_ifreq"),

214 --
	tSIOCSDEFIFACE_IN6
 = 
	t_IOWR
('i', 85, "in6_ndifreq"),

215 --
	tSIOCGDEFIFACE_IN6
 = 
	t_IOWR
('i', 86, "in6_ndifreq"),

216 --
	tSIOCSIFINFO_FLAGS
 = 
	t_IOWR
('i', 87, "in6_ndireq"),

217 --
	tSIOCSIFPREFIX_IN6
 = 
	t_IOW
('i', 100, "in6_prefixreq"),

218 --
	tSIOCGIFPREFIX_IN6
 = 
	t_IOWR
('i', 101, "in6_prefixreq"),

219 --
	tSIOCDIFPREFIX_IN6
 = 
	t_IOW
('i', 102, "in6_prefixreq"),

220 --
	tSIOCAIFPREFIX_IN6
 = 
	t_IOW
('i', 103, "in6_rrenumreq"),

221 --
	tSIOCCIFPREFIX_IN6
 = 
	t_IOW
('i', 104, "in6_rrenumreq"),

222 --
	tSIOCSGIFPREFIX_IN6
 = 
	t_IOW
('i', 105, "in6_rrenumreq"),

223 
	tSIOCGIFALIFETIME_IN6
ğ
	t_IOWR
('i', 106, "in6_ifreq"),

224 
	tSIOCAIFADDR_IN6
 = 
	t_IOW
('i', 107, "in6_aliasreq"),

225 --
	tSIOCGIFINFO_IN6
 = 
	t_IOWR
('i', 108, 
	tš6_ndœeq
),

226 --
	tSIOCSIFINFO_IN6
 = 
	t_IOWR
('i', 109, 
	tš6_ndœeq
),

227 
	tSIOCSIFPHYADDR_IN6
 = 
	t_IOW
('i', 110, "in6_aliasreq"),

229 -- 
	tkqueue
 
	tioùls


230 
	tKFILTER_BYFILTER
 = 
	t_IOWR
('k', 0, "kfilter_mapping"),

231 
	tKFILTER_BYNAME
 = 
	t_IOWR
('k', 1, "kfilter_mapping"),

233 -- 
	t®low
 
	tu£r
 
	tdefšed
 
	tioùls


234 
	t_IO
 = _IO,

235 
	t_IOR
 = _IOR,

236 
	t_IOW
 = _IOW,

237 
	t_IOWR
 = _IOWR,

238 
	}
}

240 
	gioùl
.
	gTIOCM_CD
 = 
ioùl
.
TIOCM_CAR


241 
ioùl
.
TIOCM_RI
 = ioùl.
TIOCM_RNG


243  
ioùl


245 
’d


247  {
	tš™
 = init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/nr.lua

1 -- 
N‘BSD
 
sysÿÎ
 
numb”s


3 
loÿl
 
	gÄ
 = {

4 
SYS
 = {

5 
sysÿÎ
 = 0,

6 
	gex™
 = 1,

7 
	gfÜk
 = 2,

8 
	g»ad
 = 3,

9 
	gwr™e
 = 4,

10 
	gİ’
 = 5,

11 
	gşo£
 = 6,

12 
	gcom·t_50_wa™4
 = 7,

13 
	gcom·t_43_oü—t
 = 8,

14 
	glšk
 = 9,

15 
	guÆšk
 = 10,

16 
	gchdœ
 = 12,

17 
	gfchdœ
 = 13,

18 
	gcom·t_50_mknod
 = 14,

19 
	gchmod
 = 15,

20 
	gchown
 = 16,

22 
	gcom·t_20_g‘fs¡©
 = 18,

23 
	gcom·t_43_Ş£ek
 = 19,

24 
	gg‘pid
 = 20,

25 
	gcom·t_40_mouÁ
 = 21,

26 
	gunmouÁ
 = 22,

27 
	g£tuid
 = 23,

28 
	gg‘uid
 = 24,

29 
	gg‘euid
 = 25,

30 
	g±¿û
 = 26,

31 
	g»cvmsg
 = 27,

32 
	g£ndmsg
 = 28,

33 
	g»cväom
 = 29,

34 
	gacû±
 = 30,

35 
	gg‘³”Çme
 = 31,

36 
	gg‘sockÇme
 = 32,

37 
	gacûss
 = 33,

38 
	gchæags
 = 34,

39 
	gfchæags
 = 35,

40 
	gsync
 = 36,

41 
	gkl
 = 37,

42 
	gcom·t_43_¡©43
 = 38,

43 
	gg‘µid
 = 39,

44 
	gcom·t_43_l¡©43
 = 40,

45 
	gdup
 = 41,

46 
	gpe
 = 42,

47 
	gg‘egid
 = 43,

48 
	g´of
 = 44,

49 
	gkŒaû
 = 45,

50 
	gcom·t_13_sigaùiÚ13
 = 46,

51 
	gg‘gid
 = 47,

52 
	gcom·t_13_sig´ocmask13
 = 48,

53 
	g__g‘logš
 = 49,

54 
	g__£ogš
 = 50,

55 
	gacù
 = 51,

56 
	gcom·t_13_sig³ndšg13
 = 52,

57 
	gcom·t_13_sig®t¡ack13
 = 53,

58 
	gioùl
 = 54,

59 
	gcom·t_12_ÜeboÙ
 = 55,

60 
	g»voke
 = 56,

61 
	gsymlšk
 = 57,

62 
	g»adlšk
 = 58,

63 
	gexecve
 = 59,

64 
	gumask
 = 60,

65 
	gchroÙ
 = 61,

66 
	gcom·t_43_f¡©43
 = 62,

67 
	gcom·t_43_og‘k”nšfo
 = 63,

68 
	gcom·t_43_og‘·gesize
 = 64,

69 
	gcom·t_12_msync
 = 65,

70 
	gvfÜk
 = 66,

71 
	gsbrk
 = 69,

72 
	gs¡k
 = 70,

73 
	gcom·t_43_omm­
 = 71,

74 
	gvadvi£
 = 72,

75 
	gmunm­
 = 73,

76 
	gm´Ùeù
 = 74,

77 
	gmadvi£
 = 75,

78 
	gmšcÜe
 = 78,

79 
	gg‘groups
 = 79,

80 
	g£tgroups
 = 80,

81 
	gg‘pg½
 = 81,

82 
	g£gid
 = 82,

83 
	gcom·t_50_£t™im”
 = 83,

84 
	gcom·t_43_owa™
 = 84,

85 
	gcom·t_12_osw­Ú
 = 85,

86 
	gcom·t_50_g‘™im”
 = 86,

87 
	gcom·t_43_og‘ho¡Çme
 = 87,

88 
	gcom·t_43_o£tho¡Çme
 = 88,

89 
	gcom·t_43_og‘dbËsize
 = 89,

90 
	gdup2
 = 90,

91 
	gfú
 = 92,

92 
	gcom·t_50_£Ëù
 = 93,

93 
	gfsync
 = 95,

94 
	g£riÜ™y
 = 96,

95 
	gcom·t_30_sock‘
 = 97,

96 
	gcÚÃù
 = 98,

97 
	gcom·t_43_ßcû±
 = 99,

98 
	gg‘´iÜ™y
 = 100,

99 
	gcom·t_43_o£nd
 = 101,

100 
	gcom·t_43_Üecv
 = 102,

101 
	gcom·t_13_sig»tuº13
 = 103,

102 
	gbšd
 = 104,

103 
	g£tsockİt
 = 105,

104 
	gli¡’
 = 106,

105 
	gcom·t_43_osigvec
 = 108,

106 
	gcom·t_43_osigblock
 = 109,

107 
	gcom·t_43_osig£tmask
 = 110,

108 
	gcom·t_13_sigsu¥’d13
 = 111,

109 
	gcom·t_43_osig¡ack
 = 112,

110 
	gcom·t_43_Üecvmsg
 = 113,

111 
	gcom·t_43_o£ndmsg
 = 114,

112 
	gcom·t_50_g‘timeofday
 = 116,

113 
	gcom·t_50_g‘ru§ge
 = 117,

114 
	gg‘sockİt
 = 118,

115 
	g»adv
 = 120,

116 
	gwr™ev
 = 121,

117 
	gcom·t_50_£‰imeofday
 = 122,

118 
	gfchown
 = 123,

119 
	gfchmod
 = 124,

120 
	gcom·t_43_Üecväom
 = 125,

121 
	g£Œeuid
 = 126,

122 
	g£Œegid
 = 127,

123 
	g»Çme
 = 128,

124 
	gcom·t_43_Ùrunÿ‹
 = 129,

125 
	gcom·t_43_oárunÿ‹
 = 130,

126 
	gæock
 = 131,

127 
	gmkfifo
 = 132,

128 
	g£ndto
 = 133,

129 
	gshutdown
 = 134,

130 
	gsock‘·œ
 = 135,

131 
	gmkdœ
 = 136,

132 
	grmdœ
 = 137,

133 
	gcom·t_50_utimes
 = 138,

134 
	gcom·t_50_adjtime
 = 140,

135 
	gcom·t_43_og‘³”Çme
 = 141,

136 
	gcom·t_43_og‘ho¡id
 = 142,

137 
	gcom·t_43_o£tho¡id
 = 143,

138 
	gcom·t_43_og‘¾im™
 = 144,

139 
	gcom·t_43_o£Œlim™
 = 145,

140 
	gcom·t_43_okÍg
 = 146,

141 
	g£tsid
 = 147,

142 
	gcom·t_50_quÙaùl
 = 148,

143 
	gcom·t_43_oquÙa
 = 149,

144 
	gcom·t_43_og‘sockÇme
 = 150,

145 
	gnfssvc
 = 155,

146 
	gcom·t_43_og‘dœ’Œ›s
 = 156,

147 
	gcom·t_20_¡©fs
 = 157,

148 
	gcom·t_20_f¡©fs
 = 158,

149 
	gcom·t_30_g‘fh
 = 161,

150 
	gcom·t_09_og‘domašÇme
 = 162,

151 
	gcom·t_09_o£tdomašÇme
 = 163,

152 
	gcom·t_09_ouÇme
 = 164,

153 
	gsy§rch
 = 165,

154 
	gcom·t_10_o£msys
 = 169,

155 
	gcom·t_10_omsgsys
 = 170,

156 
	gcom·t_10_oshmsys
 = 171,

157 
	g´—d
 = 173,

158 
	gpwr™e
 = 174,

159 
	gcom·t_30_Áp_g‘time
 = 175,

160 
	gÁp_adjtime
 = 176,

161 
	g£tgid
 = 181,

162 
	g£‹gid
 = 182,

163 
	g£‹uid
 = 183,

164 
	glfs_bm­v
 = 184,

165 
	glfs_m¬kv
 = 185,

166 
	glfs_£gş—n
 = 186,

167 
	gcom·t_50_lfs_£gwa™
 = 187,

168 
	gcom·t_12_¡©12
 = 188,

169 
	gcom·t_12_f¡©12
 = 189,

170 
	gcom·t_12_l¡©12
 = 190,

171 
	g·thcÚf
 = 191,

172 
	gå©hcÚf
 = 192,

173 
	gg‘¾im™
 = 194,

174 
	g£Œlim™
 = 195,

175 
	gcom·t_12_g‘dœ’Œ›s
 = 196,

176 
	gmm­
 = 197,

177 
	g__sysÿÎ
 = 198,

178 
	gl£ek
 = 199,

179 
	gŒunÿ‹
 = 200,

180 
	gárunÿ‹
 = 201,

181 
	g__sysùl
 = 202,

182 
	gmlock
 = 203,

183 
	gmuÆock
 = 204,

184 
	gund–‘e
 = 205,

185 
	gcom·t_50_futimes
 = 206,

186 
	gg‘pgid
 = 207,

187 
	g»boÙ
 = 208,

188 
	gpŞl
= 209,

189 
	gcom·t_14___£mùl
 = 220,

190 
	g£mg‘
 = 221,

191 
	g£mİ
 = 222,

192 
	g£mcÚfig
 = 223,

193 
	gcom·t_14_msgùl
 = 224,

194 
	gmsgg‘
 = 225,

195 
	gmsg¢d
 = 226,

196 
	gmsgrcv
 = 227,

197 
	gshm©
 = 228,

198 
	gcom·t_14_shmùl
 = 229,

199 
	gshmdt
 = 230,

200 
	gshmg‘
 = 231,

201 
	gcom·t_50_şock_g‘time
 = 232,

202 
	gcom·t_50_şock_£‰ime
 = 233,

203 
	gcom·t_50_şock_g‘»s
 = 234,

204 
	gtim”_ü—‹
 = 235,

205 
	gtim”_d–‘e
 = 236,

206 
	gcom·t_50_tim”_£‰ime
 = 237,

207 
	gcom·t_50_tim”_g‘time
 = 238,

208 
	gtim”_g‘ov”run
 = 239,

209 
	gcom·t_50_Çno¦“p
 = 240,

210 
	gfd©async
 = 241,

211 
	gmlock®l
 = 242,

212 
	gmuÆock®l
 = 243,

213 
	gcom·t_50___sigtimedwa™
 = 244,

214 
	gsigqueuešfo
 = 245,

215 
	g_k£m_š™
 = 247,

216 
	g_k£m_İ’
 = 248,

217 
	g_k£m_uÆšk
 = 249,

218 
	g_k£m_şo£
 = 250,

219 
	g_k£m_po¡
 = 251,

220 
	g_k£m_wa™
 = 252,

221 
	g_k£m_Œywa™
 = 253,

222 
	g_k£m_g‘v®ue
 = 254,

223 
	g_k£m_de¡roy
 = 255,

224 
	gmq_İ’
 = 257,

225 
	gmq_şo£
 = 258,

226 
	gmq_uÆšk
 = 259,

227 
	gmq_g‘©Œ
 = 260,

228 
	gmq_£‰r
 = 261,

229 
	gmq_nÙify
 = 262,

230 
	gmq_£nd
 = 263,

231 
	gmq_»ûive
 = 264,

232 
	gcom·t_50_mq_timed£nd
 = 265,

233 
	gcom·t_50_mq_timed»ûive
 = 266,

234 
	g__posix_»Çme
 = 270,

235 
	gsw­ùl
 = 271,

236 
	gcom·t_30_g‘d’ts
 = 272,

237 
	gmšh”™
 = 273,

238 
	glchmod
 = 274,

239 
	glchown
 = 275,

240 
	gcom·t_50_lutimes
 = 276,

241 
	g__msync13
 = 277,

242 
	gcom·t_30___¡©13
 = 278,

243 
	gcom·t_30___f¡©13
 = 279,

244 
	gcom·t_30___l¡©13
 = 280,

245 
	g__sig®t¡ack14
 = 281,

246 
	g__vfÜk14
 = 282,

247 
	g__posix_chown
 = 283,

248 
	g__posix_fchown
 = 284,

249 
	g__posix_lchown
 = 285,

250 
	gg‘sid
 = 286,

251 
	g__şÚe
 = 287,

252 
	gfkŒaû
 = 288,

253 
	g´—dv
 = 289,

254 
	gpwr™ev
 = 290,

255 
	gcom·t_16___sigaùiÚ14
 = 291,

256 
	g__sig³ndšg14
 = 292,

257 
	g__sig´ocmask14
 = 293,

258 
	g__sigsu¥’d14
 = 294,

259 
	gcom·t_16___sig»tuº14
 = 295,

260 
	g__g‘cwd
 = 296,

261 
	gfchroÙ
 = 297,

262 
	gcom·t_30_fhİ’
 = 298,

263 
	gcom·t_30_fh¡©
 = 299,

264 
	gcom·t_20_fh¡©fs
 = 300,

265 
	gcom·t_50_____£mùl13
 = 301,

266 
	gcom·t_50___msgùl13
 = 302,

267 
	gcom·t_50___shmùl13
 = 303,

268 
	glchæags
 = 304,

269 
	gis£tugid
 = 305,

270 
	guŒaû
 = 306,

271 
	gg‘cÚ‹xt
 = 307,

272 
	g£tcÚ‹xt
 = 308,

273 
	g_lwp_ü—‹
 = 309,

274 
	g_lwp_ex™
 = 310,

275 
	g_lwp_£lf
 = 311,

276 
	g_lwp_wa™
 = 312,

277 
	g_lwp_su¥’d
 = 313,

278 
	g_lwp_cÚtšue
 = 314,

279 
	g_lwp_wakeup
 = 315,

280 
	g_lwp_g‘´iv©e
 = 316,

281 
	g_lwp_£riv©e
 = 317,

282 
	g_lwp_kl
 = 318,

283 
	g_lwp_d‘ach
 = 319,

284 
	gcom·t_50__lwp_·rk
 = 320,

285 
	g_lwp_uÅ¬k
 = 321,

286 
	g_lwp_uÅ¬k_®l
 = 322,

287 
	g_lwp_£Šame
 = 323,

288 
	g_lwp_g‘Çme
 = 324,

289 
	g_lwp_ùl
 = 325,

290 
	gcom·t_60_§_»gi¡”
 = 330,

291 
	gcom·t_60_§_¡acks
 = 331,

292 
	gcom·t_60_§_’abË
 = 332,

293 
	gcom·t_60_§_£tcÚcu¼’cy
 = 333,

294 
	gcom·t_60_§_y›ld
 = 334,

295 
	gcom·t_60_§_´“m±
 = 335,

296 
	g__sigaùiÚ_sigŒamp
 = 340,

297 
	gpmc_g‘_šfo
 = 341,

298 
	gpmc_cÚŒŞ
 = 342,

299 
	g¿sùl
 = 343,

300 
	gkqueue
 = 344,

301 
	gcom·t_50_kev’t
 = 345,

302 
	g_sched_£¬am
 = 346,

303 
	g_sched_g‘·¿m
 = 347,

304 
	g_sched_£ffš™y
 = 348,

305 
	g_sched_g‘affš™y
 = 349,

306 
	gsched_y›ld
 = 350,

307 
	gfsync_¿nge
 = 354,

308 
	guuidg’
 = 355,

309 
	gg‘vfs¡©
 = 356,

310 
	g¡©vfs1
 = 357,

311 
	gf¡©vfs1
 = 358,

312 
	gcom·t_30_fh¡©vfs1
 = 359,

313 
	gex‰rùl
 = 360,

314 
	gex‰r_£t_fe
 = 361,

315 
	gex‰r_g‘_fe
 = 362,

316 
	gex‰r_d–‘e_fe
 = 363,

317 
	gex‰r_£t_fd
 = 364,

318 
	gex‰r_g‘_fd
 = 365,

319 
	gex‰r_d–‘e_fd
 = 366,

320 
	gex‰r_£t_lšk
 = 367,

321 
	gex‰r_g‘_lšk
 = 368,

322 
	gex‰r_d–‘e_lšk
 = 369,

323 
	gex‰r_li¡_fd
 = 370,

324 
	gex‰r_li¡_fe
 = 371,

325 
	gex‰r_li¡_lšk
 = 372,

326 
	gcom·t_50_p£Ëù
 = 373,

327 
	gcom·t_50_pŞÉs
 = 374,

328 
	g£tx©Œ
 = 375,

329 
	gl£tx©Œ
 = 376,

330 
	gf£tx©Œ
 = 377,

331 
	gg‘x©Œ
 = 378,

332 
	glg‘x©Œ
 = 379,

333 
	gfg‘x©Œ
 = 380,

334 
	gli¡x©Œ
 = 381,

335 
	gÎi¡x©Œ
 = 382,

336 
	gæi¡x©Œ
 = 383,

337 
	g»movex©Œ
 = 384,

338 
	gÌemovex©Œ
 = 385,

339 
	gäemovex©Œ
 = 386,

340 
	gcom·t_50___¡©30
 = 387,

341 
	gcom·t_50___f¡©30
 = 388,

342 
	gcom·t_50___l¡©30
 = 389,

343 
	g__g‘d’ts30
 = 390,

344 
	gcom·t_30___fh¡©30
 = 392,

345 
	gcom·t_50___Áp_g‘time30
 = 393,

346 
	g__sock‘30
 = 394,

347 
	g__g‘fh30
 = 395,

348 
	g__fhİ’40
 = 396,

349 
	g__fh¡©vfs140
 = 397,

350 
	gcom·t_50___fh¡©40
 = 398,

351 
	gaio_ÿnûl
 = 399,

352 
	gaio_”rÜ
 = 400,

353 
	gaio_fsync
 = 401,

354 
	gaio_»ad
 = 402,

355 
	gaio_»tuº
 = 403,

356 
	gcom·t_50_aio_su¥’d
 = 404,

357 
	gaio_wr™e
 = 405,

358 
	glio_li¡io
 = 406,

359 
	g__mouÁ50
 = 410,

360 
	gm»m­
 = 411,

361 
	gp£t_ü—‹
 = 412,

362 
	gp£t_de¡roy
 = 413,

363 
	gp£t_assign
 = 414,

364 
	g_p£t_bšd
 = 415,

365 
	g__posix_çdvi£50
 = 416,

366 
	g__£Ëù50
 = 417,

367 
	g__g‘timeofday50
 = 418,

368 
	g__£‰imeofday50
 = 419,

369 
	g__utimes50
 = 420,

370 
	g__adjtime50
 = 421,

371 
	g__lfs_£gwa™50
 = 422,

372 
	g__futimes50
 = 423,

373 
	g__lutimes50
 = 424,

374 
	g__£t™im”50
 = 425,

375 
	g__g‘™im”50
 = 426,

376 
	g__şock_g‘time50
 = 427,

377 
	g__şock_£‰ime50
 = 428,

378 
	g__şock_g‘»s50
 = 429,

379 
	g__Çno¦“p50
 = 430,

380 
	g____sigtimedwa™50
 = 431,

381 
	g__mq_timed£nd50
 = 432,

382 
	g__mq_timed»ûive50
 = 433,

383 
	gcom·t_60__lwp_·rk
 = 434,

384 
	g__kev’t50
 = 435,

385 
	g__p£Ëù50
 = 436,

386 
	g__pŞÉs50
 = 437,

387 
	g__aio_su¥’d50
 = 438,

388 
	g__¡©50
 = 439,

389 
	g__f¡©50
 = 440,

390 
	g__l¡©50
 = 441,

391 
	g____£mùl50
 = 442,

392 
	g__shmùl50
 = 443,

393 
	g__msgùl50
 = 444,

394 
	g__g‘ru§ge50
 = 445,

395 
	g__tim”_g‘time50
 = 447,

396 
	g__Áp_g‘time50
 = 448,

397 
	g__wa™450
 = 449,

398 
	g__mknod50
 = 450,

399 
	g__fh¡©50
 = 451,

400 
	gpe2
 = 453,

401 
	gdup3
 = 454,

402 
	gkqueue1
 = 455,

403 
	g·cû±
 = 456,

404 
	glšk©
 = 457,

405 
	g»Çm—t
 = 458,

406 
	gmkfifßt
 = 459,

407 
	gmknod©
 = 460,

408 
	gmkdœ©
 = 461,

409 
	gçcûs§t
 = 462,

410 
	gfchmod©
 = 463,

411 
	gfchowÇt
 = 464,

412 
	gãxecve
 = 465,

413 
	gf¡©©
 = 466,

414 
	gutim’§t
 = 467,

415 
	gİ’©
 = 468,

416 
	g»adlšk©
 = 469,

417 
	gsymlšk©
 = 470,

418 
	guÆšk©
 = 471,

419 
	gfutim’s
 = 472,

420 
	g__quÙaùl
 = 473,

421 
	gposix_¥awn
 = 474,

422 
	g»cvmmsg
 = 475,

423 
	g£ndmmsg
 = 476,

424 
	gşock_Çno¦“p
 = 477,

425 
	g___lwp_·rk60
 = 478,

429  
	gÄ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/syscalls.lua

1 -- 
BSD
 
¥ecific
 
sysÿÎs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12  
	$funùiÚ
(
S
, 
hh
, 
c
, 
C
, 
ty³s
)

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

16 
loÿl
 
”ºo
 = 
ffi
.errno

18 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

20 
loÿl
 
»t64
, 
»Šum
, 
»tfd
, 
»tboŞ
, 
»Œ
, 
»t™”
 = 
hh
.ret64, hh.retnum, hh.retfd, hh.retbool, hh.retptr, hh.retiter

22 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

23 
loÿl
 
i¡y³
, 
mkty³
, 
g‘fd
 = 
h
.istype, h.mktype, h.getfd

24 
loÿl
 
où®
 = 
h
.octal

26 
funùiÚ
 
S
.
	$·cû±
(
sockfd
, 
addr
, 
add¾’
, 
£t
, 
æags
)

27 
£t
 
th’
 s‘ = 
	$mkty³
(
t
.
sig£t
, 
£t
è
’d


28 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

29  
	`»tfd
(
C
.
	`·cû±
(
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
, 
£t
, 
c
.
SOCK
[
æags
]))

30 
’d


32 
loÿl
 
mÁ¡ruù
 = {

33 
ffs
 = 
t
.
ufs_¬gs
,

34 --
nfs
 = 
t
.
nfs_¬gs
,

35 --
mfs
 = 
t
.
mfs_¬gs
,

36 
tmpfs
 = 
t
.
tmpfs_¬gs
,

37 
sysvbfs
 = 
t
.
ufs_¬gs
,

38 
±yfs
 = 
t
.
±yfs_¬gs
,

39 
´ocfs
 = 
t
.
´ocfs_¬gs
,

40 
	}
}

42 
funùiÚ
 
	gS
.
	$mouÁ
(
f¡y³
, 
dœ
, 
æags
, 
d©a
, 
d©®’
)

43 
loÿl
 
¡r


44 
	`ty³
(
d©a
è=ğ"¡ršg" 
th’
 -- 
commÚ
 , 
ufs
 
‘c


45 
¡r
 = 
d©a


46 
d©a
 = {
f¥ec
 = 
±
.(
¡r
)
	}
}

47 
’d


48 
d©a
 
th’


49 
loÿl
 
	g
 = 
mÁ¡ruù
[
f¡y³
]

50 

 
th’
 
d©a
 = 
	$mkty³
(

, 
d©a
è
’d


52 
d©®’
 = 0

53 
’d


54 
loÿl
 
»t
 = 
C
.
	`mouÁ
(
f¡y³
, 
dœ
, 
c
.
MNT
[
æags
], 
d©a
, 
d©®’
 
Ü
 #data)

55  
	$»tboŞ
(
»t
)

56 
’d


58 
funùiÚ
 
S
.
	$»boÙ
(
how
, 
boÙ¡r
)

59  
	`»tboŞ
(
C
.
	$»boÙ
(
c
.
RB
[
how
], 
boÙ¡r
))

60 
’d


62 
funùiÚ
 
S
.
	$fsync_¿nge
(
fd
, 
how
, 
¡¬t
, 
Ëngth
è 
	`»tboŞ
(
C
.
	`fsync_¿nge
(
	`g‘fd
(fd), 
c
.
FSYNC
[how], s¹,†’gth)è
’d


64 
funùiÚ
 
S
.
	`g‘vfs¡©
(
æags
, 
buf
, 
size
è-- 
nÙe
 
Üd”
 
of
 
¬gs
 
as
 
usu®ly
 
Ëave
 buà
em±y


65 
æags
 = 
c
.
VFSMNT
[æag 
Ü
 "WAIT"] --  
nÙ
 
z”o


66 
nÙ
 
buf
 
th’


67 
loÿl
 
n
, 
”r
 = 
C
.
	$g‘vfs¡©
(
n
, 0, 
æags
)

68 
nÙ
 
n
 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


69 --
buf
 = 
t
.
	`¡©vfss
(
n
è-- 
TODO
 
defše


70 
size
 = 
s
.
¡©vfs
 * 
n


71 
’d


72 
size
 = siz
Ü
 #buf

73 
loÿl
 
n
, 
”r
 = 
C
.
	$g‘vfs¡©
(
buf
, 
size
, 
æags
)

74 
nÙ
 
n
 
th’
  
n
, 
”r
 
’d


75  
buf
 -- 
TODO
 
Ãed
 
ty³
 
w™h
 
numb”


76 
’d


78 -- 
TODO
 
wh’
 
we
 
defše
 
this
 
osx
 
ÿn
 
go
 
š
 
commÚ
 
	$code
 (
cu»Ály
 
defšed
 
š
 
libc
.
lua
)

79 
funùiÚ
 
S
.
	$g‘cwd
(
buf
, 
size
)

80 
size
 = siz
Ü
 
c
.
PATH_MAX


81 
buf
 = buà
Ü
 
t
.
	$bufãr
(
size
)

82 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘cwd
(
buf
, 
size
)

83 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


84  
ffi
.
	$¡ršg
(
buf
)

85 
’d


87 
funùiÚ
 
S
.
	$kqueue1
(
æags
è 
	`»tfd
(
C
.
	$kqueue1
(
c
.
O
[
æags
])è
’d


89 -- 
TODO
 
this
 
is
 
the
 
§me
 
as
 
µŞl
 
Ùh”
 
thª
 
timeout
 i 
modif›d
, 
which
 
Lšux
 
sysÿÎ
 
but
 
nÙ
 
libc
 
dÛs
; 
could
 
m”ge


90 
funùiÚ
 
S
.
	$pŞÉs
(
fds
, 
timeout
, 
£t
)

91 
timeout
 
th’
imeouˆğ
	$mkty³
(
t
.
time¥ec
, 
timeout
è
’d


92 
£t
 
th’
 s‘ = 
	$mkty³
(
t
.
sig£t
, 
£t
è
’d


93  
	`»Šum
(
C
.
	`pŞÉs
(
fds
.
pfd
, #fds, 
timeout
, 
£t
))

94 
’d


96 
funùiÚ
 
S
.
	$kŒaû
(
Œaûfe
, 
İs
, 
Œpošts
, 
pid
)

97  
	`»tboŞ
(
C
.
	`kŒaû
(
Œaûfe
, 
c
.
KTROP
[
İs
], c.
	`KTRFAC
(
Œpošts
, "V2"), 
pid
))

98 
’d


99 
funùiÚ
 
S
.
	$fkŒaû
(
fd
, 
İs
, 
Œpošts
, 
pid
)

100  
	`»tboŞ
(
C
.
	`fkŒaû
(
	`g‘fd
(
fd
), 
c
.
KTROP
[
İs
], c.
	`KTRFAC
(
Œpošts
, "V2"), 
pid
))

101 
’d


102 
funùiÚ
 
S
.
	$uŒaû
(
Ïb–
, 
addr
, 
Ën
)

103  
	`»tboŞ
(
C
.
	`uŒaû
(
Ïb–
, 
addr
, 
Ën
)è-- 
TODO
 
®low
 
¡ršg
 
to
 
be
 
·s£d
 
as
‡ddr?

104 
’d


106 -- 
±y
 
funùiÚs


107 
funùiÚ
 
S
.
	$g¿Á±
(
fd
è 
S
.
	`ioùl
(fd, "TIOCGRANTPT"è
’d


108 
funùiÚ
 
S
.
	$uÆock±
(
fd
è 0 
’d


109 
funùiÚ
 
S
.
	$±¢ame
(
fd
)

110 
loÿl
 
pm
, 
”r
 = 
S
.
	`ioùl
(
fd
, "TIOCPTSNAME")

111 
nÙ
 
pm
 
th’
  
n
, 
”r
 
’d


112  
ffi
.
	$¡ršg
(
pm
.
¢
)

113 
’d


115 -- 
TODO
 
we
 
Ãed
 
to
 
fix
 
sigaùiÚ
 
š
 
N‘BSD
, 
sysÿÎ
 
£ems
Ø
have
 
chªged
Ø
sigaùiÚ_Œamp


116 
funùiÚ
 
S
.
	$·u£
(è 
S
.
	`£Ëù
({
	}
}è
	g’d
 -- 
£Ëù
 
Ú
 
nÙhšg
 
	gfÜev”


118 -- 
k£m
 
	gfunùiÚs
. 
NÙ
 
v”y
 
w–l
 
	gdocum’‹d
! 
You
 
shoudl
 
´obably
 
u£
 
±h»ads
 
š
 
mo¡
 
ÿ£s


119 
funùiÚ
 
	gS
.
	$k£m_š™
(
v®ue
, 
£mid
)

120 
£mid
 = semid 
Ü
 
t
.
	$šŒ1
()

121 
loÿl
 
ok
, 
”r
 = 
C
.
	$_k£m_š™
(
v®ue
, 
£mid
)

122 
nÙ
 
ok
 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


123  
£mid
[0]

124 
’d


126 
funùiÚ
 
S
.
	$k£m_de¡roy
(
£mid
)

127  
	`»tboŞ
(
C
.
	$_k£m_de¡roy
(
£mid
))

128 
’d


130  
S


132 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/sysctl.lua

1 --
ty³s
 
N‘BSD
 
	gsysùl
, 
šcom¶‘e
 
©
 
´e£Á


3 
loÿl
 
	g»quœe
 = 
»quœe


5 
loÿl
 
c
 = 
»quœe
 "syscall.netbsd.constants"

7 -- 
TODO
 
nÙe
 
might
 
be
 
cÚsid”ed
 
boŞ
, 
CTLTYPE_BOOL
 
is
 
	gdefšed
.

9 -- 
TODO
 
we
 
should
 
Œav”£
 
Œ“
 
ªd
 
»ad
 
ty³s
 
š¡—d
 
of
 
´edefšed
 
v®ues


11 
loÿl
 
	gty³s
 = {

12 
un¥ec
 = 
c
.
CTL
.
UNSPEC
,

13 
	gk”n
 = {
c
.
CTL
.
KERN
, c.KERN}, -- 
TODO
 
maybe
 
chªge
 
to
 
´eã¼ed
 
fÜm
 
wh”e
 
’d
 
node
 
	ghas
 {
	gc
.
	gKERN
.
	gOSTYPE
, "string"}

14 
	gvm
 = {
c
.
CTL
.
VM
, c.VM},

15 
	gvfs
 = 
c
.
CTL
.
VFS
,

16 
	gÃt
 = 
c
.
CTL
.
NET
,

17 
	gdebug
 = 
c
.
CTL
.
DEBUG
,

18 
	ghw
 = {
c
.
CTL
.
HW
, c.HW},

19 
	gmachd•
 = 
c
.
CTL
.
MACHDEP
,

20 
	gu£r
 = {
c
.
CTL
.
USER
, c.USER},

21 
	gddb
 = 
c
.
CTL
.
DDB
,

22 
	g´oc
 = 
c
.
CTL
.
PROC
,

23 
	gv’dÜ
 = 
c
.
CTL
.
VENDOR
,

24 
	gemul
 = 
c
.
CTL
.
EMUL
,

25 
	g£cur™y
 = 
c
.
CTL
.
SECURITY
,

29 ["k”n.o¤evisiÚ"]ğ{
c
.
KERN
.
OSREV
, "int"},

39 -- 
	gKERN_VNODE
 13

40 -- 
	gKERN_PROC
 14

41 -- 
	gKERN_FILE
 15

42 -- 
	gKERN_PROF
 16

47 -- 
	gKERN_OBOOTTIME
 21

51 -- 
	gKERN_NTPTIME
 25

52 -- 
	gKERN_TIMEX
 26

61 -- 
	gKERN_MBUF
 39

68 -- 
	gKERN_PROC2
 47

69 -- 
	gKERN_PROC_ARGS
 48

71 -- 
	gKERN_CP_TIME
 51

72 -- 
	gKERN_MSGBUF
 53

73 -- 
	gKERN_CONSDEV
 54

75 ["k”n.pe"] = {
c
.
KERN
.
PIPE
, c.
KERN_PIPE
},

83 ["k”n.tk¡©"] = {
c
.
KERN
.
TKSTAT
, c.
KERN_TKSTAT
},

92 -- 
	gKERN_LWP
 64

103 -- 
	gKERN_DRIVERS
 75

104 -- 
	gKERN_BUF
 76

105 -- 
	gKERN_FILE2
 77

106 -- 
	gKERN_VERIEXEC
 78

107 -- 
	gKERN_CP_ID
 79

109 -- 
	gKERN_ARND
 81

110 -- 
	gKERN_SYSVIPC
 82

111 -- 
	gKERN_BOOTTIME
 83

112 -- 
	gKERN_EVCNT
 84

121 ["hw.driv’ames"] = {
c
.
HW
.
DISKNAMES
, "string"},

122 --["hw.drive¡©s"] = {
c
.
HW
.
IOSTATS
, "iostat[]"},

130 ["vm.vmm‘”"] = {
c
.
VM
.
METER
, "vmtotal"},

144 -- 
	gÃt
.*, 
no
 
cÚ¡ªt
 
	gÇmes


177 -- 
š‘
 
´ÙocŞ
 
Çmes
 
	gCTL_IPPROTO_NAMES


178 ["Ãt.š‘."] = {0, 
c
.
IPCTL
},

190 -- 

 
	gIPCTL_NAMES


192 ["Ãt.š‘..»dœeù"] = {
c
.
IPCTL
.
SENDREDIRECTS
, "int"},

193 ["Ãt.š‘..‰l"] = {
c
.
IPCTL
.
DEFTTL
, "int"},

194 --["Ãt.š‘..mtu"] = {
c
.
IPCTL
.
DEFMTU
, "int"},

196 ["Ãt.š‘..dœeùed-brßdÿ¡"] = {
c
.
IPCTL
.
DIRECTEDBCAST
, "int"},

205 ["Ãt.š‘..giá"] = {
c
.
IPCTL
.
GIF_TTL
, "int"},

209 ["Ãt.š‘..g»‰l"] = {
c
.
IPCTL
.
GRE_TTL
, "int"},

211 --["Ãt.š‘..ifq"], 
	gCTLTYPE_NODE


212 ["Ãt.š‘..¿ndom_id"] = {
c
.
IPCTL
.
RANDOMID
, "int"},

213 ["Ãt.š‘..do_loİback_cksum"] = {
c
.
IPCTL
.
LOOPBACKCKSUM
, "int"},

214 --["Ãt.š‘..¡©s", 
CTLTYPE_STRUCT


216 -- 
v6


217 -- 
TODO
 
»¡
 
of
 
v®ues


220 ["Ãt.š‘6.6"] = {41, 
c
.
IPV6CTL
},

226 ["Ãt.š‘6.6.»dœeù"] = {
c
.
IPV6CTL
.
SENDREDIRECTS
, "int"},

227 ["Ãt.š‘6.6.hlim"] = {
c
.
IPV6CTL
.
DEFHLIM
, "int"},

228 --["Ãt.š‘6.6.mtu"] = {
c
.
IPV6CTL
.
DEFMTU
, "int"},

242 ["Ãt.š‘6.6.gifhlim"] = {
c
.
IPV6CTL
.
GIF_HLIM
, "int"},

252 --["Ãt.š‘6.6.ifq"], 
	gCTLTYPE_NODE
 }, \

256 -- 
the£
 
¬e
 
´ovided
 
by
 
	glibc
, 
so
 
we
 
	gdÚ
't get‡ny values from syscall on„ump

280  
	gty³s


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/types.lua

1 -- 
N‘BSD
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

14 
loÿl
 
v”siÚ
 = 
»quœe
 "syscall.netbsd.version".version

16 
loÿl
 
t
, 
±
, 
s
, 
ùy³s
 = 
ty³s
.t,ypes.pt,ypes.s,ypes.ctypes

18 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

21 
loÿl
 
i6432
, 
u6432
 = 
b™
.i6432, bit.u6432

23 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

25 
loÿl
 
addty³
, 
addty³_v¬
, 
addty³_â
, 
add¿w2
 = 
h
.addtype, h.addtype_var, h.addtype_fn, h.addraw2

26 
loÿl
 
±t
, 
»v™”
, 
mkty³
, 
i¡y³
, 
Ënâ
, 
Ënmt
, 
g‘fd
, 
Ãwâ


27 ğ
h
.
±t
, h.
»v™”
, h.
mkty³
, h.
i¡y³
, h.
Ënâ
, h.
Ënmt
, h.
g‘fd
, h.
Ãwâ


28 
loÿl
 
Áohl
,‚tohl, 
Áohs
, 
htÚs
, 
où®
 = 
h
.ntohl, h.ntohl, h.ntohs, h.htons, h.octal

30 
loÿl
 
c
 = 
»quœe
 "syscall.netbsd.constants"

32 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


34 
loÿl
 
addty³s
 = {

35 
fd£t
 = "fd_set",

36 
	gşockid
 = "clockid_t",

38 
	glwpid
 = "lwpid_t",

41 
loÿl
 
	gadd¡ruùs
 = {

42 
ufs_¬gs
 = "struct ufs_args",

43 
	gtmpfs_¬gs
 = "structmpfs_args",

44 
	g±yfs_¬gs
 = "struct…tyfs_args",

45 
	g´ocfs_¬gs
 = "struct…rocfs_args",

46 
	g¡©vfs
 = "struct statvfs",

47 
	gkf‹r_m­pšg
 = "struct kfilter_mapping",

48 
	gš6_if¡©
 = "struct in6_ifstat",

49 
	gicmp6_if¡©
 = "struct icmp6_ifstat",

50 
	gš6_iäeq
 = "struct in6_ifreq",

51 
	gš6_add¾iãtime
 = "struct in6_addrlifetime",

54 
	gv”siÚ
 =ğ6 
th’


55 
add¡ruùs
.
±mg‘
 = "struct compat_60_ptmget"

57 
add¡ruùs
.
±mg‘
 = "struct…tmget"

58 
’d


60 
k
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


61 
k
, 
v
 
š
 
	$·œs
(
add¡ruùs
èdØ
	$addty³
(
ty³s
, 
k
, 
v
, 
Ënmt
è
’d


63 -- 64 
b™
 
dev_t


64 
loÿl
 
funùiÚ
 
	$makedev
(
majÜ
, 
mšÜ
)

65 
	`ty³
(
majÜ
è=ğ"bË" 
th’
 majÜ, 
mšÜ
 = majÜ[1], majÜ[2] 
’d


66 
loÿl
 
dev
 = 
t
.
	$dev
(
majÜ
 
Ü
 0)

67 
mšÜ
 
th’


68 
loÿl
 
low
 = 
b™
.
	`bÜ
(b™.
	`bªd
(
mšÜ
, 0xff), b™.
	`lshiá
(b™.bªd(
majÜ
, 0xfff), 8), b™.lshiá(b™.bªd(mšÜ, b™.
	`bnÙ
(0xff)), 12))

69 
loÿl
 
high
 = 
b™
.
	`bªd
(
majÜ
, b™.
	$bnÙ
(0xfff))

70 
dev
 = 
t
.
	`dev
(
low
è+ 0x100000000 *.
	$dev
(
high
)

71 
’d


72  
dev


73 
’d


75 
mt
.
deviû
 = {

76 
šdex
 = {

77 
majÜ
 = 
	`funùiÚ
(
dev
)

78 
loÿl
 
h
, 
l
 = 
	`i6432
(
dev
.dev)

79  
b™
.
	`bÜ
(b™.
	`bªd
(b™.
	`rshiá
(
l
, 8), 0xfff), b™.bªd(
h
, b™.
	`bnÙ
(0xfff)))

80 
’d
,

81 
mšÜ
 = 
	`funùiÚ
(
dev
)

82 
loÿl
 
h
, 
l
 = 
	`i6432
(
dev
.dev)

83  
b™
.
	`bÜ
(b™.
	`bªd
(
l
, 0xff), b™.bªd(b™.
	`rshiá
Ö, 12), b™.
	`bnÙ
(0xff)))

84 
’d
,

85 
deviû
 = 
	`funùiÚ
(
dev
è 
	`tÚumb”
(dev.devè
’d
,

87 
Ãwšdex
 = {

88 
deviû
 = 
	`funùiÚ
(
dev
, 
majÜ
, 
mšÜ
èdev.dev = 
	`makedev
(majÜ, mšÜè
’d
,

90 
__Ãw
 = 
	`funùiÚ
(

, 
majÜ
, 
mšÜ
)

91  
ffi
.
	`Ãw
(

, 
	`makedev
(
majÜ
, 
mšÜ
))

92 
’d
,

93 
	}
}

95 
addty³
(
ty³s
, "deviû", "¡ruù {dev_ˆdev;}", 
mt
.
deviû
)

97 
	gmt
.
	g¡©
 = {

98 
šdex
 = {

99 
dev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_dev
è
’d
,

100 
	gmode
 = 
funùiÚ
(
¡
è st.
¡_mode
 
’d
,

101 
	gšo
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_šo
è
’d
,

102 
	gÆšk
 = 
funùiÚ
(
¡
è st.
¡_Æšk
 
’d
,

103 
	guid
 = 
funùiÚ
(
¡
è st.
¡_uid
 
’d
,

104 
	ggid
 = 
funùiÚ
(
¡
è st.
¡_gid
 
’d
,

105 
	grdev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_rdev
è
’d
,

106 
	g©ime
 = 
funùiÚ
(
¡
è st.
¡_©ime¥ec
.
time
 
’d
,

107 
	gùime
 = 
funùiÚ
(
¡
è st.
¡_ùime¥ec
.
time
 
’d
,

108 
	gmtime
 = 
funùiÚ
(
¡
è st.
¡_mtime¥ec
.
time
 
’d
,

109 
	gbœthtime
 = 
funùiÚ
(
¡
è st.
¡_bœthtime¥ec
.
time
 
’d
,

110 
	gsize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_size
è
’d
,

111 
	gblocks
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blocks
è
’d
,

112 
	gblksize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blksize
è
’d
,

113 
	gæags
 = 
funùiÚ
(
¡
è st.
¡_æags
 
’d
,

114 
	gg’
 = 
funùiÚ
(
¡
è st.
¡_g’
 
’d
,

116 
	gty³
 = 
funùiÚ
(
¡
è 
b™
.
bªd
(¡.
¡_mode
, 
c
.
S_I
.
FMT
è
	g’d
,

117 
	gtodt
 = 
funùiÚ
(
¡
è 
b™
.
rshiá
(¡.
ty³
, 12è
	g’d
,

118 
	gi¤eg
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FREG
 
’d
, -- 
TODO
 
®low
 
uµ”
 
	gtoo
?

119 
	gisdœ
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FDIR
 
’d
,

120 
	gischr
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FCHR
 
’d
,

121 
	gisblk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FBLK
 
’d
,

122 
	gisfifo
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FIFO
 
’d
,

123 
	gi¦nk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FLNK
 
’d
,

124 
	gissock
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FSOCK
 
’d
,

125 
	giswht
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FWHT
 
’d
,

129 -- 
add
 
some
 
ä›ndl›r
 
Çmes
 
to
 
	g¡©
, 
®so
 
luafesy¡em
 
com·tib™y


130 
	gmt
.
	g¡©
.
	gšdex
.
	gacûss
 = 
mt
.
¡©
.
šdex
.
©ime


131 
mt
.
¡©
.
šdex
.
modifiÿtiÚ
 = mt.¡©.šdex.
mtime


132 
mt
.
¡©
.
šdex
.
chªge
 = mt.¡©.šdex.
ùime


134 
loÿl
 
Çmem­
 = {

135 
fe
 = 
mt
.
¡©
.
šdex
.
i¤eg
,

136 
	gdœeùÜy
 = 
mt
.
¡©
.
šdex
.
isdœ
,

137 
	glšk
 = 
mt
.
¡©
.
šdex
.
i¦nk
,

138 
	gsock‘
 = 
mt
.
¡©
.
šdex
.
issock
,

139 ["ch¬ deviû"] = 
mt
.
¡©
.
šdex
.
ischr
,

140 ["block deviû"] = 
mt
.
¡©
.
šdex
.
isblk
,

141 ["Çmed…e"] = 
mt
.
¡©
.
šdex
.
isfifo
,

144 
	gmt
.
	g¡©
.
	gšdex
.
	gty³Çme
 = 
	$funùiÚ
(
¡
)

145 
k
, 
v
 
š
 
	$·œs
(
Çmem­
èdØ
	$v
(
¡
è
th’
  
k
 
’d
ƒnd

147 
’d


149 
	`addty³
(
ty³s
, "¡©", "¡ruù st", 
mt
.
¡©
)

151 
loÿl
 
sigÇmes
 = {
	}
}

152 
loÿl
 
du¶iÿ‹s
 = {
IOT
 = 
Œue
}

153 
	gk
, 
v
 
š
 
	$·œs
(
c
.
SIG
) do

154 
nÙ
 
du¶iÿ‹s
[
k
] 
th’
 
sigÇmes
[
v
] = k 
’d


155 
’d


157 -- 
TODO
 
£e
 
nÙe
 
š
 
Lšux
, 
we
 
should
 
be
 
cÚsi¡’y
 
usšg
 
the
 
cÜ»ù
 

158 
mt
.
sigšfo
 = {

159 
šdex
 = {

160 
signo
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_signo
 
’d
,

161 
code
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_code
 
’d
,

162 
”ºo
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_”ºo
 
’d
,

163 
v®ue
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_¹
.
_v®ue
 
’d
,

164 
pid
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_chd
.
_pid
 
’d
,

165 
uid
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_chd
.
_uid
 
’d
,

166 
¡©us
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_chd
.
_¡©us
 
’d
,

167 
utime
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_chd
.
_utime
 
’d
,

168 
¡ime
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_chd
.
_¡ime
 
’d
,

169 
addr
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_çuÉ
.
_addr
 
’d
,

170 
bªd
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_pŞl
.
_bªd
 
’d
,

171 
fd
 = 
	`funùiÚ
(
s
è s.
_šfo
.
_»asÚ
.
_pŞl
.
_fd
 
’d
,

172 
sigÇme
 = 
	`funùiÚ
(
s
è 
sigÇmes
[s.
signo
] 
’d
,

174 
Ãwšdex
 = {

175 
signo
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_signo
 = v 
’d
,

176 
code
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_code
 = v 
’d
,

177 
”ºo
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_”ºo
 = v 
’d
,

178 
v®ue
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_¹
.
_v®ue
 = v 
’d
,

179 
pid
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_chd
.
_pid
 = v 
’d
,

180 
uid
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_chd
.
_uid
 = v 
’d
,

181 
¡©us
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_chd
.
_¡©us
 = v 
’d
,

182 
utime
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_chd
.
_utime
 = v 
’d
,

183 
¡ime
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_chd
.
_¡ime
 = v 
’d
,

184 
addr
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_çuÉ
.
_addr
 = v 
’d
,

185 
bªd
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_pŞl
.
_bªd
 = v 
’d
,

186 
fd
 = 
	`funùiÚ
(
s
, 
v
ès.
_šfo
.
_»asÚ
.
_pŞl
.
_fd
 = v 
’d
,

188 
	}
}

190 
addty³
(
ty³s
, "sigšfo", "sigšfo_t", 
mt
.
sigšfo
)

192 -- 
	gsigaùiÚ
, 
¡ªd¬d
 
POSIX
 
behaviour
 
w™h
 
of
 
hªdËr
 
ªd
 
sigaùiÚ


193 
addty³_â
(
ty³s
, "sa_sigaction", "void (*)(int, siginfo_t *, void *)")

195 
	gmt
.
	gsigaùiÚ
 = {

196 
šdex
 = {

197 
hªdËr
 = 
funùiÚ
(
§
è sa.
_§_u
.
_§_hªdËr
 
’d
,

198 
	gsigaùiÚ
 = 
funùiÚ
(
§
è sa.
_§_u
.
_§_sigaùiÚ
 
’d
,

199 
	gmask
 = 
funùiÚ
(
§
è sa.
§_mask
 
’d
,

200 
	gæags
 = 
funùiÚ
(
§
è 
tÚumb”
(§.
§_æags
è
’d
,

202 
	gÃwšdex
 = {

203 
hªdËr
 = 
funùiÚ
(
§
, 
v
)

204 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


205 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


206 
§
.
_§_u
.
_§_hªdËr
 = 
v


207 
’d
,

208 
	gsigaùiÚ
 = 
funùiÚ
(
§
, 
v
)

209 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


210 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


211 
§
.
_§_u
.
_§_sigaùiÚ
 = 
v


212 
’d
,

213 
	gmask
 = 
funùiÚ
(
§
, 
v
)

214 
nÙ
 
	gffi
.
i¡y³
(
t
.
sig£t
, 
v
è
th’
 
	gv
 =.sig£t(vè
’d


215 
§
.
§_mask
 = 
v


216 
’d
,

217 
	gæags
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g§_æags
 = 
c
.
SA
[v] 
’d
,

219 
	g__Ãw
 = 
funùiÚ
(

, 
b
)

220 
loÿl
 
	g§
 = 
ffi
.
Ãw
(

)

221 
b
 
th’
 
k
, 
v
 
š
 
·œs
ÑabèdØ
	g§
[k] = v 
’d
ƒnd

222 
b
 
ªd
ab.
sigaùiÚ
 
th’
 
§
.
§_æags
 = 
b™
.
bÜ
(§.
æags
, 
c
.
SA
.
SIGINFO
è
	g’d
 -- 
this
 
æag
 
mu¡
 
be
 
£t
 sigaction set

223  
§


224 
	g’d
,

227 
addty³
(
ty³s
, "sigaùiÚ", "¡ruù sigaùiÚ", 
mt
.
sigaùiÚ
)

229 -- 
TODO
 
some
 
f›lds
 
¡l
 
missšg


230 
	gmt
.
	gsigev’t
 = {

231 
šdex
 = {

232 
nÙify
 = 
funùiÚ
(
£lf
è s–f.
sigev_nÙify
 
’d
,

233 
	gsigno
 = 
funùiÚ
(
£lf
è s–f.
sigev_signo
 
’d
,

234 
	gv®ue
 = 
funùiÚ
(
£lf
è s–f.
sigev_v®ue
 
’d
,

236 
	gÃwšdex
 = {

237 
nÙify
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_nÙify
 = 
c
.
SIGEV
[v] 
’d
,

238 
	gsigno
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_signo
 = 
c
.
SIG
[v] 
’d
,

239 
	gv®ue
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsigev_v®ue
 = 
t
.
sigv®
(vè
’d
, --‡utØ
assigns
 
ba£d
 
Ú
 
	gty³


241 
	g__Ãw
 = 
Ãwâ
,

244 
addty³
(
ty³s
, "sigev’t", "¡ruù sigev’t", 
mt
.
sigev’t
)

246 
	gmt
.
	gdœ’t
 = {

247 
šdex
 = {

248 
f’o
 = 
funùiÚ
(
£lf
è 
tÚumb”
(£lf.
d_f’o
è
’d
,

249 
	g»ş’
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

250 
	gÇmËn
 = 
funùiÚ
(
£lf
è s–f.
d_ÇmËn
 
’d
,

251 
	gty³
 = 
funùiÚ
(
£lf
è s–f.
d_ty³
 
’d
,

252 
	gÇme
 = 
funùiÚ
(
£lf
è 
ffi
.
¡ršg
(£lf.
d_Çme
, s–f.
d_ÇmËn
è
	g’d
,

253 
	gtoif
 = 
funùiÚ
(
£lf
è 
b™
.
lshiá
(£lf.
d_ty³
, 12è
	g’d
, -- 
cÚv”t
 
to
 
¡©
 
	gty³s


255 
	g__Ën
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

258 
	gmt
.
	gdœ’t
.
	gšdex
.
	gšo
 = 
mt
.
dœ’t
.
šdex
.
f’o
 -- 
®‹º©e
 
Çme


260 -- 
TODO
 
´eviou¦y
 
this
 
®lowed
 
low”
 
v®ues
, 
but
hi 
v”siÚ
 
dÛs
 
	gnÙ


261 -- 
could
 
add
 
	gmt
.
	gdœ’t
.
	gšdex
[
tŞow”
(
k
)] = 
mt
.
dœ’t
.
šdex
[k] 
but
 
Ãed
 
to
 dØ
cÚsi¡’y
 
–£wh”e


262 
k
, 
v
 
š
 
	$·œs
(
c
.
DT
) do

263 
mt
.
dœ’t
.
šdex
[
k
] = 
	$funùiÚ
(
£lf
è s–f.
ty³
 =ğ
v
 
’d


264 
’d


266 
	`addty³
(
ty³s
, "dœ’t", "¡ruù dœ’t", 
mt
.
dœ’t
)

268 
mt
.
iäeq
 = {

269 
šdex
 = {

270 
Çme
 = 
	`funùiÚ
(
iä
è 
ffi
.
	`¡ršg
(iä.
iä_Çme
è
’d
,

271 
addr
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_addr
 
’d
,

272 
d¡addr
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_d¡addr
 
’d
,

273 
brßdaddr
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_brßdaddr
 
’d
,

274 
¥aû
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_¥aû
 
’d
,

275 
æags
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_æags
 
’d
,

276 
m‘ric
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_m‘ric
 
’d
,

277 
mtu
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_mtu
 
’d
,

278 
dÉ
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_dÉ
 
’d
,

279 
v®ue
 = 
	`funùiÚ
(
iä
è iä.
iä_iäu
.
iäu_v®ue
 
’d
,

280 -- 
TODO
 
»¡
 
of
 
	`f›lds
 (
buf
, 
buæ’
)

282 
Ãwšdex
 = {

283 
Çme
 = 
	`funùiÚ
(
iä
, 
v
)

284 
	`as£¹
(#v < 
c
.
IFNAMSIZ
, "nameoo†ong")

285 
iä
.
iä_Çme
 = 
v


286 
’d
,

287 
æags
 = 
	`funùiÚ
(
iä
, 
v
)

288 
iä
.
iä_iäu
.
iäu_æags
 = 
c
.
IFF
[
v
]

289 
’d
,

290 -- 
TODO
 
»¡
 
of
 
f›lds


292 
__Ãw
 = 
Ãwâ
,

293 
	}
}

295 
addty³
(
ty³s
, "iäeq", "¡ruù iäeq", 
mt
.
iäeq
)

297 -- 
içlŸ¤eq
 
kes
 
	gsockaddr
, 
but
 
oá’
 
wªt
 
to
 
suµly
 
š_addr
 
as
 
pÜt
 
	gœ»Ëvªt


298 -- 
TODO
 
wªt
 
to
  
a
 
sockaddr
 
so
 
ÿn
 
asign
 
vs
 
	gffi
.
cİy
 
	gb–ow
, 
Ü
 
fix
 sockadd¸tØ
be
 
mÜe
 
like
 
sockaddr_¡Üage


299 
loÿl
 
funùiÚ
 
	$tosockaddr
(
v
)

300 
ffi
.
	$i¡y³
(
t
.
š_addr
, 
v
è
th’
 .
	$sockaddr_š
(0, 
v
è
’d


301 
ffi
.
	$i¡y³
(
t
.
š6_addr
, 
v
è
th’
 .
	$sockaddr_š6
(0, 
v
è
’d


302  
	$mkty³
(
t
.
sockaddr
, 
v
)

303 
’d


305 
mt
.
içlŸ¤eq
 = {

306 
šdex
 = {

307 
Çme
 = 
	`funùiÚ
(
iäa
è 
ffi
.
	`¡ršg
(iäa.
iäa_Çme
è
’d
,

308 
addr
 = 
	`funùiÚ
(
iäa
è iäa.
iäa_addr
 
’d
,

309 
d¡addr
 = 
	`funùiÚ
(
iäa
è iäa.
iäa_d¡addr
 
’d
,

310 
mask
 = 
	`funùiÚ
(
iäa
è iäa.
iäa_mask
 
’d
,

312 
Ãwšdex
 = {

313 
Çme
 = 
	`funùiÚ
(
iäa
, 
v
)

314 
	`as£¹
(#v < 
c
.
IFNAMSIZ
, "nameoo†ong")

315 
iäa
.
iäa_Çme
 = 
v


316 
’d
,

317 
addr
 = 
	`funùiÚ
(
iäa
, 
v
)

318 
loÿl
 
addr
 = 
	`tosockaddr
(
v
)

319 
ffi
.
	`cİy
(
iäa
.
iäa_addr
, 
addr
, #addr)

320 
’d
,

321 
d¡addr
 = 
	`funùiÚ
(
iäa
, 
v
)

322 
loÿl
 
addr
 = 
	`tosockaddr
(
v
)

323 
ffi
.
	`cİy
(
iäa
.
iäa_d¡addr
, 
addr
, #addr)

324 
’d
,

325 
mask
 = 
	`funùiÚ
(
iäa
, 
v
)

326 
loÿl
 
addr
 = 
	`tosockaddr
(
v
)

327 
ffi
.
	`cİy
(
iäa
.
iäa_mask
, 
addr
, #addr)

328 
’d
,

330 
__Ãw
 = 
Ãwâ
,

331 
	}
}

333 
	gmt
.
	giçlŸ¤eq
.
	gšdex
.
	gbrßdaddr
 = 
mt
.
içlŸ¤eq
.
šdex
.
d¡addr


334 
mt
.
içlŸ¤eq
.
Ãwšdex
.
brßdaddr
 = mt.içlŸ¤eq.Ãwšdex.
d¡addr


336 
addty³
(
ty³s
, "içlŸ¤eq", "¡ruù içlŸ¤eq", 
mt
.
içlŸ¤eq
)

338 
	gmt
.
	gš6_®Ÿ¤eq
 = {

339 
šdex
 = {

340 
Çme
 = 
funùiÚ
(
iäa
è 
ffi
.
¡ršg
(iäa.
iäa_Çme
è
’d
,

341 
	gaddr
 = 
funùiÚ
(
iäa
è iäa.
iäa_addr
 
’d
,

342 
	gd¡addr
 = 
funùiÚ
(
iäa
è iäa.
iäa_d¡addr
 
’d
,

343 
	g´efixmask
 = 
funùiÚ
(
iäa
è iäa.
iäa_´efixmask
 
’d
,

344 
	gliãtime
 = 
funùiÚ
(
iäa
è iäa.
iäa_liãtime
 
’d
,

346 
	gÃwšdex
 = {

347 
Çme
 = 
funùiÚ
(
iäa
, 
v
)

348 
as£¹
(#v < 
c
.
IFNAMSIZ
, "nameoo†ong")

349 
	giäa
.
	giäa_Çme
 = 
v


350 
’d
,

351 
	gaddr
 = 
funùiÚ
(
iäa
, 
v
)

352 
loÿl
 
	gaddr
 = 
tosockaddr
(
v
)

353 
ffi
.
cİy
(
iäa
.
iäa_addr
, 
addr
, #addr)

354 
	g’d
,

355 
	gd¡addr
 = 
funùiÚ
(
iäa
, 
v
)

356 
loÿl
 
	gaddr
 = 
tosockaddr
(
v
)

357 
ffi
.
cİy
(
iäa
.
iäa_d¡addr
, 
addr
, #addr)

358 
	g’d
,

359 
	g´efixmask
 = 
funùiÚ
(
iäa
, 
v
)

360 
loÿl
 
	gaddr
 = 
tosockaddr
(
v
)

361 
ffi
.
cİy
(
iäa
.
iäa_´efixmask
, 
addr
, #addr)

362 
	g’d
,

363 
	gliãtime
 = 
funùiÚ
(
iäa
, 
v
è
	giäa
.
	giäa_liãtime
 = 
mkty³
(
t
.
š6_add¾iãtime
, vè
	g’d
,

365 
	g__Ãw
 = 
Ãwâ
,

368 
addty³
(
ty³s
, "š6_®Ÿ¤eq", "¡ruù in6_®Ÿ¤eq", 
mt
.
š6_®Ÿ¤eq
)

370 
	gmt
.
	gš6_add¾iãtime
 = {

371 
šdex
 = {

372 
expœe
 = 
funùiÚ
(
£lf
è s–f.
Ÿ6t_expœe
 
’d
,

373 
	g´eã¼ed
 = 
funùiÚ
(
£lf
è s–f.
Ÿ6t_´eã¼ed
 
’d
,

374 
	gvÉime
 = 
funùiÚ
(
£lf
è s–f.
Ÿ6t_vÉime
 
’d
,

375 
	g¶time
 = 
funùiÚ
(
£lf
è s–f.
Ÿ6t_¶time
 
’d
,

377 
	gÃwšdex
 = {

378 
expœe
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gŸ6t_expœe
 = 
mkty³
(
t
.
time
, vè
	g’d
,

379 
	g´eã¼ed
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gŸ6t_´eã¼ed
 = 
mkty³
(
t
.
time
, vè
	g’d
,

380 
	gvÉime
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gŸ6t_vÉime
 = 
c
.
ND6
[v] 
’d
,

381 
	g¶time
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gŸ6t_¶time
 = 
c
.
ND6
[v] 
’d
,

383 
	g__Ãw
 = 
Ãwâ
,

386 
loÿl
 
	gkŒ_ty³
 = {}

387 
k
, 
v
 
š
 
	$·œs
(
c
.
KTR
èdØ
kŒ_ty³
[
v
] = 
k
 
’d


389 
loÿl
 
kŒ_v®_
 = {

390 
SYSCALL
 = "ktr_syscall",

391 
SYSRET
 = "ktr_sysret",

392 
NAMEI
 = "string",

393 -- 
TODO
 
GENIO


394 -- 
TODO
 
PSIG


395 
CSW
 = "ktr_csw",

396 
EMUL
 = "string",

397 -- 
TODO
 
USER


398 
EXEC_ARG
 = "string",

399 
EXEC_ENV
 = "string",

400 -- 
TODO
 
SAUPCALL


401 
MIB
 = "string",

402 -- 
TODO
 
EXEC_FD


403 
	}
}

405 
	gmt
.
	gkŒ_h—d”
 = {

406 
šdex
 = {

407 
Ën
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_Ën
 
’d
,

408 
	gv”siÚ
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_v”siÚ
 
’d
,

409 
	gty³
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_ty³
 
’d
,

410 
	gty³Çme
 = 
funùiÚ
(
kŒ
è 
kŒ_ty³
[kŒ.kŒ_ty³] 
’d
,

411 
	gpid
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_pid
 
’d
,

412 
	gcomm
 = 
funùiÚ
(
kŒ
è 
ffi
.
¡ršg
(kŒ.
kŒ_comm
è
’d
,

413 
	glid
 = 
funùiÚ
(
kŒ
è kŒ.
_v
.
_v2
.
_lid
 
’d
,

414 
	gŞid
 = 
funùiÚ
(
kŒ
è kŒ.
_v
.
_v1
.
_lid
 
’d
,

415 
	gtime
 = 
funùiÚ
(
kŒ
è kŒ.
_v
.
_v2
.
_ts
 
’d
,

416 
	gÙv
 = 
funùiÚ
(
kŒ
è kŒ.
_v
.
_v0
.
_tv
 
’d
,

417 
	gÙs
 = 
funùiÚ
(
kŒ
è kŒ.
_v
.
_v1
.
_ts
 
’d
,

418 
	gunu£d
 = 
funùiÚ
(
kŒ
è kŒ.
_v
.
_v0
.
_buf
 
’d
,

419 
	gv®±r
 = 
funùiÚ
(
kŒ
è 
±
.(kŒè+ 
s
.
kŒ_h—d”
 
’d
, -- 
assumes
 kŒ 
is
 
a
 
poš‹r


420 
	gv®ues
 = 
funùiÚ
(
kŒ
)

421 
nÙ
 
kŒ
.
ty³Çme
 
th’
  "bad kŒaûy³" 
’d


422 
loÿl
 
Çm
 = 
kŒ_v®_
[
kŒ
.
ty³Çme
]

423 
nÙ
 
Çm
 
th’
  "unim¶em’‹d kŒaûy³" 
’d


424 
Çm
 =ğ"¡ršg" 
th’
  
ffi
.
¡ršg
(
kŒ
.
v®±r
, kŒ.
Ën
è
’d


425  
	g±
[
Çm
](
	gkŒ
.
	gv®±r
)

426 
	g’d
,

428 
	g__Ën
 = 
funùiÚ
(
kŒ
è 
s
.
kŒ_h—d”
 + kŒ.
Ën
 
’d
,

429 
	g__to¡ršg
 = 
funùiÚ
(
kŒ
)

430  
kŒ
.
pid
 .. " " .. kŒ.
comm
 .. " " .. (kŒ.
ty³Çme
 
Ü
 "??"è.. " " .. 
to¡ršg
(kŒ.
v®ues
)

431 
’d
,

434 
addty³
(
ty³s
, "kŒ_h—d”", "¡ruù kŒ_h—d”", 
mt
.
kŒ_h—d”
)

436 
loÿl
 
	gsy¢ame
 = {}

437 
k
, 
v
 
š
 
	$·œs
(
c
.
SYS
èdØ
sy¢ame
[
v
] = 
k
 
’d


439 
loÿl
 
ioùÊame


441 -- 
TODO
 
this
 
is
 
a
 
‹mpÜ¬y
 
hack
, 
Ãeds
 
b‘‹r
 
code


442 
loÿl
 
¥ecŸl
 = {

443 
ioùl
 = 
	`funùiÚ
(
fd
, 
»que¡
, 
v®
)

444 
nÙ
 
ioùÊame
 
th’


445 
ioùÊame
 = {}

446 
loÿl
 
IOCTL
 = 
»quœe
 "sysÿÎ.Ãtbsd.cÚ¡ªts".IOCTL -- 
£e
 #94 
as
 
w–l
, 
we
 
ÿÂÙ
 
lßd
 
—¾y
‡ 
ioùl
 
d•’ds
 
Ú
 
ty³s


447 
k
, 
v
 
š
 
	`·œs
(
IOCTL
) do

448 
	`ty³
(
v
è=ğ"bË" 
th’
 v = v.
numb”
 
’d


449 
v
 = 
	`tÚumb”
(v)

450 
v
 
th’
 
ioùÊame
[v] = 
k
 
’d


451 
’d


452 
’d


453 
fd
 = 
	`tÚumb”
(
t
.(fd))

454 
»que¡
 = 
	`tÚumb”
(
t
.(request))

455 
v®
 = 
	`tÚumb”
(val)

456 
loÿl
 
iÚm
 = 
ioùÊame
[
»que¡
] 
Ü
 
	`to¡ršg
(request)

457  
	`to¡ršg
(
fd
è.. ", " .. 
iÚm
 .. ", " ..o¡ršg(
v®
)

458 
’d
,

459 
	}
}

461 
	gmt
.
	gkŒ_sysÿÎ
 = {

462 
šdex
 = {

463 
code
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_code
 
’d
,

464 
	gÇme
 = 
funùiÚ
(
kŒ
è 
sy¢ame
[kŒ.
code
] 
Ü
 
to¡ršg
(kŒ.codeè
’d
,

465 
	g¬gsize
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_¬gsize
 
’d
,

466 
	gÄeg
 = 
funùiÚ
(
kŒ
è kŒ.
¬gsize
 / 
s
.
’d
,

467 
	g»gi¡”s
 = 
funùiÚ
(
kŒ
è 
±
.Õt.(kŒè+ 
s
.
kŒ_sysÿÎ
è
’d
 -- 
assumes
 kŒ 
is
 
a
 
poš‹r


469 
	g__Ën
 = 
funùiÚ
(
kŒ
è 
s
.
kŒ_sysÿÎ
 + kŒ.
¬gsize
 
’d
,

470 
	g__to¡ršg
 = 
funùiÚ
(
kŒ
)

471 
loÿl
 
¹ab
 = {}

472 
i
 = 0, 
	gkŒ
.
	gÄeg
 - 1 dØ
	g¹ab
[˜+ 1] = 
to¡ršg
(
kŒ
.
»gi¡”s
[i]è
’d


473 
¥ecŸl
[
kŒ
.
Çme
] 
th’


474 
i
 = 0, 
	gkŒ
.
	gÄeg
 - 1 dØ
	g¹ab
[˜+ 1] = 
kŒ
.
»gi¡”s
[i] 
’d


475  
kŒ
.
Çme
 .. " (" .. 
¥ecŸl
[kŒ.Çme](
uÅack
(
¹ab
)) .. ")"

476 
’d


477 
i
 = 0, 
	gkŒ
.
	gÄeg
 - 1 dØ
	g¹ab
[˜+ 1] = 
to¡ršg
(
kŒ
.
»gi¡”s
[i]è
’d


478  
kŒ
.
Çme
 .. " (" .. 
bË
.
cÚÿt
(
¹ab
, ",") .. ")"

479 
	g’d
,

482 
addty³
(
ty³s
, "kŒ_sysÿÎ", "¡ruù kŒ_sysÿÎ", 
mt
.
kŒ_sysÿÎ
)

484 
	gmt
.
	gkŒ_sy¤‘
 = {

485 
šdex
 = {

486 
code
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_code
 
’d
,

487 
	gÇme
 = 
funùiÚ
(
kŒ
è 
sy¢ame
[kŒ.
code
] 
Ü
 
to¡ršg
(kŒ.codeè
’d
,

488 
	g”rÜ
 = 
funùiÚ
(
kŒ
èkŒ.
kŒ_”rÜ
 ~ğ0 
th’
  
t
.
”rÜ
(kŒ.kŒ_”rÜè
’d
ƒnd,

489 
	g»tv®
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_»tv®
 
’d
,

490 
	g»tv®1
 = 
funùiÚ
(
kŒ
è kŒ.
kŒ_»tv®_1
 
’d
,

492 
	g__to¡ršg
 = 
funùiÚ
(
kŒ
)

493 
kŒ
.
”rÜ
 
th’


494  
kŒ
.
Çme
 .. " " .. (kŒ.
”rÜ
.
sym
 
Ü
 kŒ.”rÜ.
”ºo
è.. " " .. (
to¡ršg
(ktr.error) or "")

496  
kŒ
.
Çme
 .. " " .. 
to¡ršg
(kŒ.
»tv®
è.. " " ..o¡ršg(kŒ.
»tv®1
) .. " "

497 
’d


498 
’d


501 
addty³
(
ty³s
, "kŒ_sy¤‘", "¡ruù kŒ_sy¤‘", 
mt
.
kŒ_sy¤‘
)

503 
	gmt
.
	gkŒ_csw
 = {

504 
__to¡ršg
 = 
funùiÚ
(
kŒ
)

505  "cÚ‹xˆsw™ch" -- 
TODO


506 
’d
,

509 
addty³
(
ty³s
, "kŒ_csw", "¡ruù kŒ_csw", 
mt
.
kŒ_csw
)

511 -- 
¦ighy
 
misûÎªeous
 
	gty³s
, 
eg
 
Ãed
 
to
 
u£
 
Lua
 
	gm‘©abËs


513 -- 
TODO
 
£e
 
Lšux
 
nÙes


514 
	gmt
.
	gwa™
 = {

515 
__šdex
 = 
funùiÚ
(
w
, 
k
)

516 
loÿl
 
	g_WSTATUS
 = 
b™
.
bªd
(
w
.
¡©us
, 
où®
("0177"))

517 
loÿl
 
	g_WSTOPPED
 = 
où®
("0177")

518 
loÿl
 
WTERMSIG
 = 
_WSTATUS


519 
loÿl
 
EXITSTATUS
 = 
b™
.
bªd
(b™.
rshiá
(
w
.
¡©us
, 8), 0xff)

520 
loÿl
 
	gWIFEXITED
 = (
_WSTATUS
 == 0)

521 
loÿl
 
b
 = {

522 
WIFEXITED
 = WIFEXITED,

523 
	gWIFSTOPPED
 = 
b™
.
bªd
(
w
.
¡©us
, 0xffè=ğ
_WSTOPPED
,

524 
	gWIFSIGNALED
 = 
_WSTATUS
 ~ğ
_WSTOPPED
 
ªd
 _WSTATUS ~= 0

526 
	gb
.
WIFEXITED
 
th’
ab.
	gEXITSTATUS
 = 
EXITSTATUS
 
’d


527 
b
.
WIFSTOPPED
 
th’
ab.
WSTOPSIG
 = 
EXITSTATUS
 
’d


528 
b
.
WIFSIGNALED
 
th’
ab.
WTERMSIG
 = WTERMSIG 
’d


529 
b
[
k
] 
th’
 ab[k] 
’d


530 
loÿl
 
uc
 = 'W' .. 
k
:
uµ”
()

531 
b
[
uc
] 
th’
 ab[uc] 
’d


532 
’d


535 
funùiÚ
 
t
.
	$wa™¡©us
(
¡©us
)

536  
	`£tm‘©abË
({
¡©us
 = 
	}
¡©us}, 
	gmt
.
	gwa™
)

537 
’d


539 
	gmt
.
	gifdrv
 = {

540 
šdex
 = {

541 
Çme
 = 
funùiÚ
(
£lf
è 
ffi
.
¡ršg
(£lf.
ifd_Çme
è
’d
,

543 
	gÃwšdex
 = {

544 
Çme
 = 
funùiÚ
(
£lf
, 
v
)

545 
as£¹
(#v < 
c
.
IFNAMSIZ
, "nameoo†ong")

546 
	g£lf
.
	gifd_Çme
 = 
v


547 
’d
,

548 
	gcmd
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gifd_cmd
 = v 
’d
, -- 
TODO
 
which
 
Çme¥aû
(
s
)?

549 
	gd©a
 = 
funùiÚ
(
£lf
, 
v
)

550 
	g£lf
.
	gifd_d©a
 = 
v


551 
£lf
.
ifd_Ën
 = #v

552 
’d
,

553 
	gËn
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gifd_Ën
 = v 
’d
,

555 
	g__Ãw
 = 
Ãwâ
,

558 
addty³
(
ty³s
, "ifdrv", "¡ruù ifdrv", 
mt
.
ifdrv
)

560 
	gmt
.
	gifb»q
 = {

561 
šdex
 = {

562 
if¢ame
 = 
funùiÚ
(
£lf
è 
ffi
.
¡ršg
(£lf.
ifbr_if¢ame
è
’d
,

564 
	gÃwšdex
 = {

565 
if¢ame
 = 
funùiÚ
(
£lf
, 
v
)

566 
as£¹
(#v < 
c
.
IFNAMSIZ
, "nameoo†ong")

567 
	g£lf
.
	gifbr_if¢ame
 = 
v


568 
’d
,

570 
	g__Ãw
 = 
Ãwâ
,

573 
addty³
(
ty³s
, "ifb»q", "¡ruù ifb»q", 
mt
.
ifb»q
)

575 
	gmt
.
	gæock
 = {

576 
šdex
 = {

577 
ty³
 = 
funùiÚ
(
£lf
è s–f.
l_ty³
 
’d
,

578 
	gwh’û
 = 
funùiÚ
(
£lf
è s–f.
l_wh’û
 
’d
,

579 
	g¡¬t
 = 
funùiÚ
(
£lf
è s–f.
l_¡¬t
 
’d
,

580 
	gËn
 = 
funùiÚ
(
£lf
è s–f.
l_Ën
 
’d
,

581 
	gpid
 = 
funùiÚ
(
£lf
è s–f.
l_pid
 
’d
,

583 
	gÃwšdex
 = {

584 
ty³
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_ty³
 = 
c
.
FCNTL_LOCK
[v] 
’d
,

585 
	gwh’û
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_wh’û
 = 
c
.
SEEK
[v] 
’d
,

586 
	g¡¬t
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_¡¬t
 = v 
’d
,

587 
	gËn
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_Ën
 = v 
’d
,

588 
	gpid
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gl_pid
 = v 
’d
,

590 
	g__Ãw
 = 
Ãwâ
,

593 
addty³
(
ty³s
, "æock", "¡ruù flock", 
mt
.
æock
)

595 
	gmt
.
	gşockšfo
 = {

596 
´št
 = {"tick", "tickadj", "hz", "profhz", "stathz"},

597 
	g__Ãw
 = 
Ãwâ
,

600 
addty³
(
ty³s
, "şockšfo", "¡ruù clockšfo", 
mt
.
şockšfo
)

602 
	gmt
.
	glßdavg
 = {

603 
šdex
 = {

604 
lßdavg
 = 
funùiÚ
(
£lf
è {
tÚumb”
(£lf.
ldavg
[0]è/Úumb”(£lf.
fsÿË
),

605 
tÚumb”
(
£lf
.
ldavg
[1]è/Úumb”(£lf.
fsÿË
),

606 
tÚumb”
(
£lf
.
ldavg
[2]è/Úumb”(£lf.
fsÿË
)}

607 
’d
,

609 
	g__to¡ršg
 = 
funùiÚ
(
£lf
)

610 
loÿl
 
lßdavg
 = 
£lf
.loadavg

611  
¡ršg
.
fÜm©
("{ %.2f, %.2f, %.2à}", 
lßdavg
[1],†oadavg[2],†oadavg[3])

612 
	g’d
,

615 
addty³
(
ty³s
, "lßdavg", "¡ruù†ßdavg", 
mt
.
lßdavg
)

617 
	gmt
.
	gvmtÙ®
 = {

618 
šdex
 = {

619 
rq
 = 
funùiÚ
(
£lf
è s–f.
t_rq
 
’d
,

620 
	gdw
 = 
funùiÚ
(
£lf
è s–f.
t_dw
 
’d
,

621 
	gpw
 = 
funùiÚ
(
£lf
è s–f.
t_pw
 
’d
,

622 
	g¦
 = 
funùiÚ
(
£lf
è s–f.
t_¦
 
’d
,

623 
	gvm
 = 
funùiÚ
(
£lf
è s–f.
t_vm
 
’d
,

624 
	gavm
 = 
funùiÚ
(
£lf
è s–f.
t_avm
 
’d
,

625 
	grm
 = 
funùiÚ
(
£lf
è s–f.
t_rm
 
’d
,

626 
	g¬m
 = 
funùiÚ
(
£lf
è s–f.
t_¬m
 
’d
,

627 
	gvmshr
ğ
funùiÚ
(
£lf
è s–f.
t_vmshr
 
’d
,

628 
	gavmshr
ğ
funùiÚ
(
£lf
è s–f.
t_avmshr
 
’d
,

629 
	grmshr
 = 
funùiÚ
(
£lf
è s–f.
t_rmshr
 
’d
,

630 
	g¬mshr
 = 
funùiÚ
(
£lf
è s–f.
t_¬mshr
 
’d
,

631 
	gä“
 = 
funùiÚ
(
£lf
è s–f.
t_ä“
 
’d
,

633 
	g´št
 = {"rq", "dw", "pw", "sl", "vm", "avm", "rm", "arm", "vmshr", "avmshr", "rmshr", "armshr", "free"},

636 
addty³
(
ty³s
, "vmtÙ®", "¡ruù vmtÙ®", 
mt
.
vmtÙ®
)

638 
	gmt
.
	gmmsghdr
 = {

639 
šdex
 = {

640 
hdr
 = 
funùiÚ
(
£lf
è s–f.
msg_hdr
 
’d
,

641 
	gËn
 = 
funùiÚ
(
£lf
è s–f.
msg_Ën
 
’d
,

643 
	gÃwšdex
 = {

644 
hdr
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	ghdr
 = v 
’d
,

646 
	g__Ãw
 = 
Ãwâ
,

649 
addty³
(
ty³s
, "mmsghdr", "¡ruù mmsghdr", 
mt
.
mmsghdr
)

651 
	gmt
.
	gmmsghdrs
 = {

652 
__Ën
 = 
funùiÚ
(
p
è….
couÁ
 
’d
,

653 
	g__Ãw
 = 
funùiÚ
(

, 
ps
)

654 
ty³
(
ps
è=ğ'numb”' 
th’
  
ffi
.
Ãw
(

,…s,…sè
’d


655 
loÿl
 
	gcouÁ
 = #ps

656 
loÿl
 
mms
 = 
ffi
.
Ãw
(

, 
couÁ
, count)

657 
	gn
 = 1, 
couÁ
 do

658 
	gmms
.
	gmsg
[
n
 - 1].
	gmsg_hdr
 = 
mkty³
(
t
.
msghdr
, 
ps
[n])

659 
’d


660  
mms


661 
	g’d
,

662 
	g__aœs
 = 
funùiÚ
(
p
è 
»v™”
, 
	gp
.
	gmsg
,….
couÁ
 
	g’d
 -- 
TODO
 
wªt
 
fÜw¬d
 
™”©Ü
 
	g»®ly
...

665 
addty³_v¬
(
ty³s
, "mmsghdrs", "¡ruù {šˆcouÁ; sŒuù mmsghd¸msg[?];}", 
mt
.
mmsghdrs
)

667  
ty³s


669 
’d


671  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/util.lua

1 -- 
N‘BSD
 
ut™y
 
funùiÚs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
S
)

12 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

13 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

15 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

16 
loÿl
 
divmod
 = 
h
.divmod

18 
loÿl
 
ffi
 = 
»quœe
 "ffi"

20 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

22 
loÿl
 
où®
 = 
h
.octal

24 -- 
TODO
 
move
 
to
 
h–³rs
? 
£e
 
nÙes
 
š
 
sysÿÎ
.
lua
 
about
 
»wÜkšg
 
though


25 
loÿl
 
funùiÚ
 
	$i¡y³
(

, 
x
)

26 
ffi
.
	$i¡y³
(

, 
x
è
th’
  x 
’d


27  
çl£


28 
’d


30 
loÿl
 
ut
 = {
	}
}

32 
loÿl
 
mt
 = {}

34 -- 
š™Ÿl
 
im¶em’tiÚ
 
of
 
ÃtwÜk
 
ioùls
, 
no
 
»®
 
©‹m±
 
to
 
make
 
™
 
com·tibË
 
w™h
 
	gLšux
...

35 -- 
š™ŸÎy
 
ju¡
 
im¶em’t
 
the
 
Úes
 
äom
 
rump
 
	gÃtcÚfig
, 
make
 
š‹rçû
 
	gÏ‹r


37 -- 
™
 
is
 
a
 
b™
 
messy
 
ü—tšg
 
Ãw
 
sock‘
 
ev”y
 
	gtime
, 
b‘‹r
 
make
‡ 
£qu’û
 
of
 
commªds


39 
loÿl
 
funùiÚ
 
	$sockioùl
(
domaš
, 

, 
io
, 
d©a
)

40 
loÿl
 
sock
, 
”r
 = 
S
.
	$sock‘
(
domaš
, 

)

41 
nÙ
 
sock
 
th’
  
n
, 
”r
 
’d


42 
loÿl
 
io
, 
”r
 = 
sock
:
	$ioùl
(
io
, 
d©a
)

43 
sock
:
	$şo£
()

44 
nÙ
 
io
 
th’
  
n
, 
”r
 
’d


45  
io


46 
’d


48 
funùiÚ
 
ut
.
	$ifü—‹
(
Çme
è 
	`sockioùl
("š‘", "dg¿m", "SIOCIFCREATE", 
t
.
iäeq
{Çmğ
	}
Çme}è
’d


49 
funùiÚ
 
	gut
.
	$ifde¡roy
(
Çme
è 
	`sockioùl
("š‘", "dg¿m", "SIOCIFDESTROY", 
t
.
iäeq
{Çmğ
	}
Çme}è
’d


50 
funùiÚ
 
	gut
.
	$ifg‘æags
(
Çme
)

51 
loÿl
 
io
, 
”r
 = 
	`sockioùl
("š‘", "dg¿m", "SIOCGIFFLAGS", 
t
.
iäeq
{
Çme
 = 
	}
name})

52 
nÙ
 
io
 
th’
  
	gn
, 
”r
 
’d


53  
	gio
.
æags


54 
’d


55 
funùiÚ
 
	gut
.
	$if£tæags
(
Çme
, 
æags
)

56  
	`sockioùl
("š‘", "dg¿m", "SIOCSIFFLAGS", {
Çme
 =‚ame, 
æags
 = 
c
.
IFF
[æags]
	}
})

57 
’d


58 
funùiÚ
 
	gut
.
	$ifup
(
Çme
)

59 
loÿl
 
æags
, 
”r
 = 
ut
.
	$ifg‘æags
(
Çme
)

60 
nÙ
 
æags
 
th’
  
n
, 
”r
 
’d


61  
ut
.
	`if£tæags
(
Çme
, 
c
.
	`IFF
(
æags
, "up"))

62 
’d


63 
funùiÚ
 
ut
.
	$ifdown
(
Çme
)

64 
loÿl
 
æags
, 
”r
 = 
ut
.
	$ifg‘æags
(
Çme
)

65 
nÙ
 
æags
 
th’
  
n
, 
”r
 
’d


66  
ut
.
	`if£tæags
(
Çme
, 
c
.
	`IFF
(
æags
, "~up"))

67 
’d


69 
funùiÚ
 
ut
.
	`if£šk¡r
(
Çme
, 
¡r
è-- 
u£d
 
to
 
	$·ss
 (
İtiÚ®
è
¡ršg
 
to
 
rump
 
	$vœtif
 (
eg
 
Çme
 
of
 
und”lyšg
 
p
 
deviû
)

70  
	`sockioùl
("š‘", "dg¿m", "SIOCSLINKSTR", {
Çme
 =‚ame, 
cmd
 = 0, 
d©a
 = 
¡r
})

71 
	g’d


73 -- 
TODO
 
m”ge
 
što
 
Úe
 
içddr
 
funùiÚ


74 
funùiÚ
 
	gut
.
içddr_š‘4
(
Çme
, 
addr
, 
mask
)

75 -- 
TODO
 
this
 
funùiÚ
 
Ãeds
 
mask
 
as
 
ª
 
	gšaddr
, 
so
 
Ãed
 
to
 
fix
hi 
·s£d
 
	gas
 / 
fÜm©
 
Ü
 
numb”


76 
loÿl
 
	gaddr
, 
	gmask
 = 
ut
.
	$š‘_Çme
(
addr
, 
mask
)

78 
loÿl
 
bn
 = 
addr
:
	$g‘_mask_bÿ¡
(
mask
)

79 
loÿl
 
brßdÿ¡
, 
Ãtmask
 = 
bn
.broadcast, bn.netmask

81 
loÿl
 
Ÿ
 = 
t
.
içlŸ¤eq
{
Çme
 =‚ame, 
addr
 =‡ddr, 
mask
 = 
Ãtmask
, 
brßdaddr
 = 
brßdÿ¡
}

83  
sockioùl
("š‘", "dg¿m", "SIOCAIFADDR", 
Ÿ
)

84 
’d


85 
funùiÚ
 
	gut
.
	$içddr_š‘6
(
Çme
, 
addr
, 
mask
)

86 
loÿl
 
addr
, 
mask
 = 
ut
.
	$š‘_Çme
(
addr
, 
mask
)

87 
	`as£¹
(
ffi
.
	`i¡y³
(
t
.
š6_addr
, 
addr
), "nÙ‡Àv6‡dd»ss"è-- 
TODO
 
»move
 
Úû
 
m”ged


89 
loÿl
 
´efixmask
 = 
t
.
	$š6_addr
()

90 
loÿl
 
bb
, 
b
 = 
	$divmod
(
mask
, 8)

91 
i
 = 0, 
bb
 - 1 dØ
´efixmask
.
s6_addr
[i] = 0xfà
’d


92 
bb
 < 16 
th’
 
´efixmask
.
s6_addr
[bb] = 
b™
.
	`lshiá
(0xff, 8 - 
b
è
’d
 -- 
TODO
 
Ãeds
 
‹¡
!

94 
loÿl
 
Ÿ
 = 
t
.
š6_®Ÿ¤eq
{
Çme
 =‚ame, 
addr
 =‡ddr, 
´efixmask
 =…refixmask,

95 
liãtime
 = {
¶time
 = "šfš™e_liãtime", 
vÉime
 = "šfš™e_liãtime"}
	}
}

97  
sockioùl
("š‘6", "dg¿m", "SIOCAIFADDR_IN6", 
Ÿ
)

98 
	g’d


100 -- 
bË
 
ba£d
 
	gmouÁ
, 
mÜe
 
üoss
 
OS
 
com·tibË


101 
funùiÚ
 
	gut
.
	$mouÁ
(
b
)

102 
loÿl
 
fesy¡emty³
 = 
b
.
ty³


103 
loÿl
 
dœ
 = 
b
.
rg‘
 
Ü
ab.dir

104 
loÿl
 
æags
 = 
b
.flags

105 
loÿl
 
d©a
 = 
b
.data

106 
loÿl
 
d©®’
 = 
b
.datalen

107 
b
.
f¥ec
 
th’
 
d©a
 =ab.f¥eø
’d


108  
S
.
	$mouÁ
(
fesy¡emty³
, 
dœ
, 
æags
, 
d©a
, 
d©®’
)

109 
’d


111 
loÿl
 
funùiÚ
 
	$kdumpâ
(
Ën
)

112  
	$funùiÚ
(
buf
, 
pos
)

113 
pos
 + 
s
.
kŒ_h—d”
 >ğ
Ën
 
th’
  
n
 
’d


114 
loÿl
 
kŒ
 = 
±
.
	`kŒ_h—d”
(
buf
 + 
pos
)

115 
pos
 + 
s
.
kŒ_h—d”
 + 
kŒ
.
Ën
 >ğËÀ
th’
  
n
 
’d


116  
pos
 + #kŒ, 
kŒ


117 
’d


118 
’d


120 
funùiÚ
 
ut
.
	$kdump
(
buf
, 
Ën
)

121  
	`kdumpâ
(
Ën
), 
buf
, 0

122 
’d


124 
loÿl
 
funùiÚ
 
	$do_bridge_£tcmd
(
Çme
, 
İ
, 
¬g
)

125  
	`sockioùl
("š‘", "dg¿m", "SIOCSDRVSPEC", {
Çme
 =‚ame, 
cms
 = 
İ
, 
d©a
 = 
¬g
})

126 
’d


127 
loÿl
 
funùiÚ
 
do_bridge_g‘cmd
(
Çme
, 
İ
, 
¬g
è-- 
TODO
 
should
 
®loÿ‹
 
cÜ»ù
‡rg 
ty³
 
h”e
 
ba£d
 
Ú
‡rg

128 
loÿl
 
	gd©a
, 
	g”r
 = 
sockioùl
("š‘", "dg¿m", "SIOCGDRVSPEC", {
Çme
 =‚ame, 
cms
 = 
İ
, 
d©a
 = 
¬g
})

129 
nÙ
 
d©a
 
th’
  
	gn
, 
”r
 
’d


130  
¬g


131 
’d


133  
ut


135 
’d


137  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/version.lua

1 -- 
d‘eù
 
Ãtbsd
 
v”siÚ


3 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

5 
loÿl
 
ffi
 = 
»quœe
 "ffi"

7 
»quœe
 "syscall.ffitypes"

9 
loÿl
 
v”siÚ
, 
	gmajÜ
, 
mšÜ


11 
loÿl
 
funùiÚ
 
	$šlibc_â
(
k
è 
ffi
.
C
[k] 
’d


13 -- 
N‘BSD
 
ABI
 
v”siÚ


14 -- 
TODO
 
ruÂšg
 
rump
 
Ú
 
N‘BSD
 
the
 
v”siÚ
 
d‘eùiÚ
 
is
 
a
 
b™
 
æaky
 th
ho¡
 
ªd
„um°
difãr


15 -- 
nÜm®ly
 
this
 
is
 
ok
 
you
 
š™
 
Ãtbsd
 
fœ¡
 
ªd
 
have
 
com·t
 
š¡®Ëd
 
rump
, 
Ü
 dØ
nÙ
 
u£
 
bÙh
...

16 
ffi
.
cdef
[[

17 
	`sysùl
(cÚ¡ *, , *, 
size_t
 *, const *, size_t);

18 
	`__sysùl
(cÚ¡ *, , *, 
size_t
 *, const *, size_t);

19 
	`rump_g‘v”siÚ
();

21 
loÿl
 
sc
 = 
ffi
.
	`Ãw
("št[2]", 1, 3è-- 
k”n
.
o¤ev


22 
loÿl
 
o¤evisiÚ
 = 
ffi
.
	`Ãw
("int[1]")

23 
loÿl
 
ËÅ
 = 
ffi
.
	`Ãw
("unsigned†ong[1]", ffi.("int"))

24 
loÿl
 
majÜ
, 
mšÜ


25 
loÿl
 
ok
, 
»s


26 
abi
.
ho¡
 =ğ"Ãtbsd" 
th’


27 
ok
, 
»s
 = 
	$pÿÎ
(
ffi
.
C
.
sysùl
, 
sc
, 2, 
o¤evisiÚ
, 
ËÅ
, 
n
, 0)

28 
o¤evisiÚ
 = osrevision[0]

29 
’d


30 
nÙ
 
ok
 
Ü
 
»s
 =ğ-1 
th’
 
	`pÿÎ
(
šlibc_â
, "rump_g‘v”siÚ"èth’ ok, 
o¤evisiÚ
 = 
	$pÿÎ
(
ffi
.
C
.
rump_g‘v”siÚ
è
’d
ƒnd

31 
nÙ
 
ok
 
th’


32 
v”siÚ
 = 7

34 
majÜ
 = 
m©h
.
	`æoÜ
(
o¤evisiÚ
 / 100000000)

35 
mšÜ
 = 
m©h
.
	`æoÜ
(
o¤evisiÚ
 / 1000000è- 
majÜ
 * 100

36 
v”siÚ
 = 
majÜ


37 
mšÜ
 =ğ99 
th’
 
v”siÚ
 = v”siÚ + 1 
’d


38 
’d


39  {
v”siÚ
 = v”siÚ, 
majÜ
 = majÜ, 
mšÜ
 = 
	}
minor}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/c.lua

1 -- 
This
 
£ts
 
up
 
the
 
bË
 
of
 
C
 
funùiÚs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
loÿl
 
voidp
 = 
ffi
.
ty³of
("void *")

16 
loÿl
 
funùiÚ
 (
x
)

17  
ffi
.
	$ÿ¡
(
voidp
, 
x
)

18 
’d


20 -- 
basiÿÎy
 
®l
 
ty³s
 
·s£d
 
to
 
sysÿÎs
 
¬e
 
Ü
 , 
so
 
we
 dØ
nÙ
 
Ãed
Ø
u£
 
niûly
 
Çmed
y³s, sØw
ÿn
 
avoid
 
impÜtšg
 
t
.

21 
loÿl
 , ğ
ffi
.
	`ty³of
("int"), ffi.typeof("long")

22 
loÿl
 
ušt
, 
ulÚg
 = 
ffi
.
	`ty³of
("unsigned int"), ffi.typeof("unsigned†ong")

24 
loÿl
 
funùiÚ
 
	$šlibc_â
(
k
è 
ffi
.
C
[k] 
’d


26 -- 
SysÿÎs
 
th©
 
ju¡
  
ENOSYS
 
but
 
¬e
 
š
 
libc
. 
NÙe
 
the£
 
might
 
v¬y
 
by
 
v”siÚ
 iÀ
futu»


27 
loÿl
 
nosys_ÿÎs
 = {

28 
tim”_ü—‹
 = 
Œue
,

29 
tim”_g‘time
 = 
Œue
,

30 
tim”_£‰ime
 = 
Œue
,

31 
tim”_d–‘e
 = 
Œue
,

32 
tim”_g‘ov”run
 = 
Œue
,

33 
	}
}

35 
loÿl
 
	gC
 = 
£tm‘©abË
({}, {

36 
__šdex
 = 
funùiÚ
(
C
, 
k
)

37 
nosys_ÿÎs
[
k
] 
th’
  
n
 
’d


38 
pÿÎ
(
šlibc_â
, 
k
è
th’


39 
C
[
k
] = 
ffi
.C[k] -- 
add
 
to
 
bË
, 
so
 
no
 
Ãed
 
this
 
¦ow
 
·th
 
agaš


40  
C
[
k
]

42  
n


43 
’d


44 
’d


47 -- 
qu™e
 
a
 
ãw
 
O³nBSD
 
funùiÚs
 
¬e
 
w—k
 
®Ÿ£s
 
to
 
__sys_
 
´efixed
 
	gv”siÚs
, 
some
 
£em
Ø
»sŞve
 
but
 
Ùh”s
 dØ
	gnÙ
, 
	godd
.

48 -- 
this
 
is
 
	gŒue
, 
but
 
nÙ
 
Ãeded
 
Ú
 
	gO³nBSD
?

49 --
	gC
.
	gfutimes
 = 
ffi
.
C
.
__sys_futimes


50 --
C
.
lutimes
 = 
ffi
.C.
__sys_lutimes


51 --
C
.
utimes
 = 
ffi
.C.
__sys_utimes


52 --
C
.
wa™4
 = 
ffi
.C.
__sys_wa™4


53 --
C
.
sigaùiÚ
 = 
ffi
.C.
__sys_sigaùiÚ


55  
C


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/constants.lua

1 -- 
bËs
 
of
 
cÚ¡ªts
 
N‘BSD


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
	g£Ëù
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
£Ëù


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

14 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

16 
loÿl
 
v”siÚ
 = 
»quœe
 "syscall.openbsd.version".version

18 
loÿl
 
où®
, 
	gmuÉiæags
, 
	gch¬æags
, 
	gsw­æags
, 
	g¡ræag
, 
	g©æag
, 
	gmodeæags


19 ğ
h
.
où®
, 
	gh
.
	gmuÉiæags
, h.
	gch¬æags
, h.
	gsw­æags
, h.
	g¡ræag
, h.
	g©æag
, h.
modeæags


21 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

23 
loÿl
 
funùiÚ
 
	$ch¬p
(
n
è 
ffi
.
	`ÿ¡
("ch¬ *",‚è
’d


25 
loÿl
 
c
 = {
	}
}

27 
c
.
”rÜÇmes
 = 
»quœe
 "syscall.openbsd.errors"

29 
c
.
STD
 = 
¡ræag
 {

30 
IN_FILENO
 = 0,

31 
	gOUT_FILENO
 = 1,

32 
	gERR_FILENO
 = 2,

33 
	gIN
 = 0,

34 
	gOUT
 = 1,

35 
	gERR
 = 2,

38 
	gc
.
	gE
 = 
¡ræag
 {

39 
PERM
 = 1,

40 
	gNOENT
 = 2,

41 
	gSRCH
 = 3,

42 
	gINTR
 = 4,

43 
	gIO
 = 5,

44 
	gNXIO
 = 6,

46 
	gNOEXEC
 = 8,

47 
	gBADF
 = 9,

48 
	gCHILD
 = 10,

49 
	gDEADLK
 = 11,

50 
	gNOMEM
 = 12,

51 
	gACCES
 = 13,

52 
	gFAULT
 = 14,

53 
	gNOTBLK
 = 15,

54 
	gBUSY
 = 16,

55 
	gEXIST
 = 17,

56 
	gXDEV
 = 18,

57 
	gNODEV
 = 19,

58 
	gNOTDIR
 = 20,

59 
	gISDIR
 = 21,

60 
	gINVAL
 = 22,

61 
	gNFILE
 = 23,

62 
	gMFILE
 = 24,

63 
	gNOTTY
 = 25,

64 
	gTXTBSY
 = 26,

65 
	gFBIG
 = 27,

66 
	gNOSPC
 = 28,

67 
	gSPIPE
 = 29,

68 
	gROFS
 = 30,

69 
	gMLINK
 = 31,

70 
	gPIPE
 = 32,

71 
	gDOM
 = 33,

72 
	gRANGE
 = 34,

73 
	gAGAIN
 = 35,

74 
	gINPROGRESS
 = 36,

75 
	gALREADY
 = 37,

76 
	gNOTSOCK
 = 38,

77 
	gDESTADDRREQ
 = 39,

78 
	gMSGSIZE
 = 40,

79 
	gPROTOTYPE
 = 41,

80 
	gNOPROTOOPT
 = 42,

81 
	gPROTONOSUPPORT
= 43,

82 
	gSOCKTNOSUPPORT
= 44,

83 
	gOPNOTSUPP
 = 45,

84 
	gPFNOSUPPORT
 = 46,

85 
	gAFNOSUPPORT
 = 47,

86 
	gADDRINUSE
 = 48,

87 
	gADDRNOTAVAIL
 = 49,

88 
	gNETDOWN
 = 50,

89 
	gNETUNREACH
 = 51,

90 
	gNETRESET
 = 52,

91 
	gCONNABORTED
 = 53,

92 
	gCONNRESET
 = 54,

93 
	gNOBUFS
 = 55,

94 
	gISCONN
 = 56,

95 
	gNOTCONN
 = 57,

96 
	gSHUTDOWN
 = 58,

97 
	gTOOMANYREFS
 = 59,

98 
	gTIMEDOUT
 = 60,

99 
	gCONNREFUSED
 = 61,

100 
	gLOOP
 = 62,

101 
	gNAMETOOLONG
 = 63,

102 
	gHOSTDOWN
 = 64,

103 
	gHOSTUNREACH
 = 65,

104 
	gNOTEMPTY
 = 66,

105 
	gPROCLIM
 = 67,

106 
	gUSERS
 = 68,

107 
	gDQUOT
 = 69,

108 
	gSTALE
 = 70,

109 
	gREMOTE
 = 71,

110 
	gBADRPC
 = 72,

111 
	gBADRPC
 = 72,

112 
	gRPCMISMATCH
 = 73,

113 
	gPROGUNAVAIL
 = 74,

114 
	gPROGMISMATCH
 = 75,

115 
	gPROCUNAVAIL
 = 76,

116 
	gNOLCK
 = 77,

117 
	gNOSYS
 = 78,

118 
	gFTYPE
 = 79,

119 
	gAUTH
 = 80,

120 
	gNEEDAUTH
 = 81,

121 
	gIPSEC
 = 82,

122 
	gNOATTR
 = 83,

123 
	gILSEQ
 = 84,

124 
	gNOMEDIUM
 = 85,

125 
	gMEDIUMTYPE
 = 86,

126 
	gOVERFLOW
 = 87,

127 
	gCANCELED
 = 88,

128 
	gIDRM
 = 89,

129 
	gNOMSG
 = 90,

130 
	gNOTSUP
 = 91,

133 -- 
®‹º©e
 
Çmes


134 
	gc
.
	gEALIAS
 = {

135 
WOULDBLOCK
 = 
c
.
E
.
AGAIN
,

138 
	gc
.
	gAF
 = 
¡ræag
 {

139 
UNSPEC
 = 0,

140 
	gLOCAL
 = 1,

141 
	gINET
 = 2,

142 
	gIMPLINK
 = 3,

143 
	gPUP
 = 4,

144 
	gCHAOS
 = 5,

145 
	gISO
 = 7,

146 
	gECMA
 = 8,

147 
	gDATAKIT
 = 9,

148 
	gCCITT
 = 10,

149 
	gSNA
 = 11,

150 
	gDECNET
 = 12,

151 
	gDLI
 = 13,

152 
	gLAT
 = 14,

153 
	gHYLINK
 = 15,

154 
	gAPPLETALK
 = 16,

155 
	gROUTE
 = 17,

156 
	gLINK
 = 18,

157 -- 
	gp£udo_AF_XTP
 19

158 
	gCOIP
 = 20,

159 
	gCNT
 = 21,

160 -- 
	gp£udo_AF_RTIP
 22

161 
	gIPX
 = 23,

162 
	gINET6
 = 24,

163 -- 
	gp£udo_AF_PIP
 25

164 
	gISDN
 = 26,

165 
	gNATM
 = 27,

166 
	gENCAP
 = 28,

167 
	gSIP
 = 29,

168 
	gKEY
 = 30,

169 -- 
	gp£udo_AF_HDRCMPLT
 31

170 
	gBLUETOOTH
 = 32,

171 
	gMPLS
 = 33,

172 -- 
	gp£udo_AF_PFLOW
 34

173 -- 
	gp£udo_AF_PIPEX
 35

176 
	gc
.
	gAF
.
	gUNIX
 = 
c
.
AF
.
LOCAL


177 
c
.
AF
.
OSI
 = c.AF.
ISO


178 
c
.
AF
.
E164
 = c.AF.
ISDN


180 
c
.
O
 = 
muÉiæags
 {

181 
RDONLY
 = 0x0000,

182 
	gWRONLY
 = 0x0001,

183 
	gRDWR
 = 0x0002,

184 
	gACCMODE
 = 0x0003,

185 
	gNONBLOCK
 = 0x0004,

186 
	gAPPEND
 = 0x0008,

187 
	gSHLOCK
 = 0x0010,

188 
	gEXLOCK
 = 0x0020,

189 
	gASYNC
 = 0x0040,

190 
	gFSYNC
 = 0x0080,

191 
	gSYNC
 = 0x0080,

192 
	gNOFOLLOW
 = 0x0100,

193 
	gCREAT
 = 0x0200,

194 
	gTRUNC
 = 0x0400,

195 
	gEXCL
 = 0x0800,

196 
	gNOCTTY
 = 0x8000,

197 
	gCLOEXEC
 = 0x10000,

198 
	gDIRECTORY
 = 0x20000,

201 -- 
	gpe2
, 
£Ëùed
 
æags
 
äom
 
	gc
.
O


202 
	gc
.
	gOPIPE
 = 
muÉiæags
 {

203 
NONBLOCK
 = 0x0004,

204 
	gCLOEXEC
 = 0x10000,

207 -- 
	gsigaùiÚ
, 
nÙe
 
»Çmed
 
SIGACT
 
äom
 
SIG_


208 
	gc
.
	gSIGACT
 = 
¡ræag
 {

209 
ERR
 = -1,

210 
	gDFL
 = 0,

211 
	gIGN
 = 1,

212 
	gHOLD
 = 3,

215 
	gc
.
	gSIG
 = 
¡ræag
 {

216 
HUP
 = 1,

217 
	gINT
 = 2,

218 
	gQUIT
 = 3,

219 
	gILL
 = 4,

220 
	gTRAP
 = 5,

221 
	gABRT
 = 6,

222 
	gEMT
 = 7,

223 
	gFPE
 = 8,

224 
	gKILL
 = 9,

225 
	gBUS
 = 10,

226 
	gSEGV
 = 11,

227 
	gSYS
 = 12,

228 
	gPIPE
 = 13,

229 
	gALRM
 = 14,

230 
	gTERM
 = 15,

231 
	gURG
 = 16,

232 
	gSTOP
 = 17,

233 
	gTSTP
 = 18,

234 
	gCONT
 = 19,

235 
	gCHLD
 = 20,

236 
	gTTIN
 = 21,

237 
	gTTOU
 = 22,

238 
	gIO
 = 23,

239 
	gXCPU
 = 24,

240 
	gXFSZ
 = 25,

241 
	gVTALRM
 = 26,

242 
	gPROF
 = 27,

243 
	gWINCH
 = 28,

244 
	gINFO
 = 29,

245 
	gUSR1
 = 30,

246 
	gUSR2
 = 31,

247 
	gTHR
 = 32,

250 
	gc
.
	gEXIT
 = 
¡ræag
 {

251 
SUCCESS
 = 0,

252 
	gFAILURE
 = 1,

255 
	gc
.
	gOK
 = 
ch¬æags
 {

256 
F
 = 0,

257 
	gX
 = 0x01,

258 
	gW
 = 0x02,

259 
	gR
 = 0x04,

262 
	gc
.
	gMODE
 = 
modeæags
 {

263 
SUID
 = 
où®
('04000'),

264 
	gSGID
 = 
où®
('02000'),

265 
	gSTXT
 = 
où®
('01000'),

266 
	gRWXU
 = 
où®
('00700'),

267 
	gRUSR
 = 
où®
('00400'),

268 
	gWUSR
 = 
où®
('00200'),

269 
	gXUSR
 = 
où®
('00100'),

270 
	gRWXG
 = 
où®
('00070'),

271 
	gRGRP
 = 
où®
('00040'),

272 
	gWGRP
 = 
où®
('00020'),

273 
	gXGRP
 = 
où®
('00010'),

274 
	gRWXO
 = 
où®
('00007'),

275 
	gROTH
 = 
où®
('00004'),

276 
	gWOTH
 = 
où®
('00002'),

277 
	gXOTH
 = 
où®
('00001'),

280 
	gc
.
	gSEEK
 = 
¡ræag
 {

281 
SET
 = 0,

282 
	gCUR
 = 1,

283 
	gEND
 = 2,

286 
	gc
.
	gSOCK
 = 
muÉiæags
 {

287 
STREAM
 = 1,

288 
	gDGRAM
 = 2,

289 
	gRAW
 = 3,

290 
	gRDM
 = 4,

291 
	gSEQPACKET
 = 5,

294 
	gv”siÚ
 >ğ201505 
th’


295 
c
.
SOCK
.
NONBLOCK
 = 0x4000

296 
c
.
SOCK
.
CLOEXEC
 = 0x8000

297 
’d


299 
c
.
SOL
 = 
¡ræag
 {

300 
SOCKET
 = 0xffff,

303 
	gc
.
	gPOLL
 = 
muÉiæags
 {

304 
IN
 = 0x0001,

305 
	gPRI
 = 0x0002,

306 
	gOUT
 = 0x0004,

307 
	gRDNORM
 = 0x0040,

308 
	gRDBAND
 = 0x0080,

309 
	gWRBAND
 = 0x0100,

310 
	gERR
 = 0x0008,

311 
	gHUP
 = 0x0010,

312 
	gNVAL
 = 0x0020,

315 
	gc
.
	gPOLL
.
	gWRNORM
 = 
c
.
POLL
.
OUT


317 
c
.
AT_FDCWD
 = 
©æag
 {

318 
FDCWD
 = -100,

321 
	gc
.
	gAT
 = 
muÉiæags
 {

322 
EACCESS
 = 0x01,

323 
	gSYMLINK_NOFOLLOW
 = 0x02,

324 
	gSYMLINK_FOLLOW
 = 0x04,

325 
	gREMOVEDIR
 = 0x08,

328 
	gc
.
	gS_I
 = 
modeæags
 {

329 
FMT
 = 
où®
('0170000'),

330 
	gFSOCK
 = 
où®
('0140000'),

331 
	gFLNK
 = 
où®
('0120000'),

332 
	gFREG
 = 
où®
('0100000'),

333 
	gFBLK
 = 
où®
('0060000'),

334 
	gFDIR
 = 
où®
('0040000'),

335 
	gFCHR
 = 
où®
('0020000'),

336 
	gFIFO
 = 
où®
('0010000'),

337 
	gSUID
 = 
où®
('0004000'),

338 
	gSGID
 = 
où®
('0002000'),

339 
	gSVTX
 = 
où®
('0001000'),

340 
	gSTXT
 = 
où®
('0001000'),

341 
	gRWXU
 = 
où®
('00700'),

342 
	gRUSR
 = 
où®
('00400'),

343 
	gWUSR
 = 
où®
('00200'),

344 
	gXUSR
 = 
où®
('00100'),

345 
	gRWXG
 = 
où®
('00070'),

346 
	gRGRP
 = 
où®
('00040'),

347 
	gWGRP
 = 
où®
('00020'),

348 
	gXGRP
 = 
où®
('00010'),

349 
	gRWXO
 = 
où®
('00007'),

350 
	gROTH
 = 
où®
('00004'),

351 
	gWOTH
 = 
où®
('00002'),

352 
	gXOTH
 = 
où®
('00001'),

355 
	gc
.
	gS_I
.
	gREAD
 = 
c
.
S_I
.
RUSR


356 
c
.
S_I
.
WRITE
 = c.S_I.
WUSR


357 
c
.
S_I
.
EXEC
 = c.S_I.
XUSR


359 
c
.
PROT
 = 
muÉiæags
 {

360 
NONE
 = 0x0,

361 
	gREAD
 = 0x1,

362 
	gWRITE
 = 0x2,

363 
	gEXEC
 = 0x4,

366 
	gc
.
	gMAP
 = 
muÉiæags
 {

367 
SHARED
 = 0x0001,

368 
	gPRIVATE
 = 0x0002,

369 
	gFILE
 = 0x0000,

370 
	gFIXED
 = 0x0010,

371 
	gANON
 = 0x1000,

374 
	gv”siÚ
 < 201411 
	gth’
 -- 
defšed
 
	gš
 5.6 
but
 
as
 
z”o
 
so
 
no
 
efãù


375 
	gc
.
	gMAP
.
	gRENAME
 = 0x0020

376 
c
.
MAP
.
NORESERVE
 = 0x0040

377 
c
.
MAP
.
HASSEMAPHORE
 = 0x0200

378 
’d


380 
c
.
MCL
 = 
¡ræag
 {

381 
CURRENT
 = 0x01,

382 
	gFUTURE
 = 0x02,

385 -- 
æags
 
	gto
 `
	gmsync
'. -‚ote was MS_„enamedo MSYNC_

386 
	gc
.
	gMSYNC
 = 
muÉiæags
 {

387 
ASYNC
 = 0x01,

388 
	gSYNC
 = 0x02,

389 
	gINVALIDATE
 = 0x04,

392 
	gc
.
	gMADV
 = 
¡ræag
 {

393 
NORMAL
 = 0,

394 
	gRANDOM
 = 1,

395 
	gSEQUENTIAL
 = 2,

396 
	gWILLNEED
 = 3,

397 
	gDONTNEED
 = 4,

398 
	gSPACEAVAIL
 = 5,

399 
	gFREE
 = 6,

402 
	gc
.
	gIPPROTO
 = 
¡ræag
 {

403 
IP
 = 0,

404 
	gHOPOPTS
 = 0,

405 
	gICMP
 = 1,

406 
	gIGMP
 = 2,

407 
	gGGP
 = 3,

408 
	gIPV4
 = 4,

409 
	gIPIP
 = 4,

410 
	gTCP
 = 6,

411 
	gEGP
 = 8,

412 
	gPUP
 = 12,

413 
	gUDP
 = 17,

414 
	gIDP
 = 22,

415 
	gTP
 = 29,

416 
	gIPV6
 = 41,

417 
	gROUTING
 = 43,

418 
	gFRAGMENT
 = 44,

419 
	gRSVP
 = 46,

420 
	gGRE
 = 47,

421 
	gESP
 = 50,

422 
	gAH
 = 51,

423 
	gMOBILE
 = 55,

424 
	gICMPV6
 = 58,

425 
	gNONE
 = 59,

426 
	gDSTOPTS
 = 60,

427 
	gEON
 = 80,

428 
	gETHERIP
 = 97,

429 
	gENCAP
 = 98,

430 
	gPIM
 = 103,

431 
	gIPCOMP
 = 108,

432 
	gCARP
 = 112,

433 
	gMPLS
 = 137,

434 
	gPFSYNC
 = 240,

435 
	gRAW
 = 255,

438 
	gc
.
	gSCM
 = 
muÉiæags
 {

439 
RIGHTS
 = 0x01,

440 
	gTIMESTAMP
 = 0x04,

443 
	gc
.
	gF
 = 
¡ræag
 {

444 
DUPFD
 = 0,

445 
	gGETFD
 = 1,

446 
	gSETFD
 = 2,

447 
	gGETFL
 = 3,

448 
	gSETFL
 = 4,

449 
	gGETOWN
 = 5,

450 
	gSETOWN
 = 6,

451 
	gGETLK
 = 7,

452 
	gSETLK
 = 8,

453 
	gSETLKW
 = 9,

454 
	gDUPFD_CLOEXEC
= 10,

457 
	gc
.
	gFD
 = 
muÉiæags
 {

458 
CLOEXEC
 = 1,

461 -- 
nÙe
 
chªged
 
äom
 
F_
 
to
 
FCNTL_LOCK


462 
	gc
.
	gFCNTL_LOCK
 = 
¡ræag
 {

463 
RDLCK
 = 1,

464 
	gUNLCK
 = 2,

465 
	gWRLCK
 = 3,

468 -- 
	glockf
, 
chªged
 
äom
 
F_
 
to
 
LOCKF_


469 
	gc
.
	gLOCKF
 = 
¡ræag
 {

470 
ULOCK
 = 0,

471 
	gLOCK
 = 1,

472 
	gTLOCK
 = 2,

473 
	gTEST
 = 3,

476 -- 
	$æock
 (2)

477 
c
.
LOCK
 = 
muÉiæags
 {

478 
SH
 = 0x01,

479 
EX
 = 0x02,

480 
NB
 = 0x04,

481 
UN
 = 0x08,

482 
	}
}

484 
	gc
.
	gW
 = 
muÉiæags
 {

485 
NOHANG
 = 1,

486 
	gUNTRACED
 = 2,

487 
	gCONTINUED
 = 8,

488 
	gSTOPPED
 = 
où®
 "0177",

491 
	gv”siÚ
 < 201405 
th’


492 
	gc
.
	gW
.
	gALTSIG
 = 4

493 
’d


495 -- 
wa™pid
 
ªd
 
wa™4
 
pid


496 
c
.
WAIT
 = 
¡ræag
 {

497 
ANY
 = -1,

498 
	gMYPGRP
 = 0,

501 
	gc
.
	gMSG
 = 
muÉiæags
 {

502 
OOB
 = 0x1,

503 
	gPEEK
 = 0x2,

504 
	gDONTROUTE
 = 0x4,

505 
	gEOR
 = 0x8,

506 
	gTRUNC
 = 0x10,

507 
	gCTRUNC
 = 0x20,

508 
	gWAITALL
 = 0x40,

509 
	gDONTWAIT
 = 0x80,

510 
	gBCAST
 = 0x100,

511 
	gMCAST
 = 0x200,

512 
	gNOSIGNAL
 = 0x400,

515 
	gc
.
	gPC
 = 
¡ræag
 {

516 
LINK_MAX
 = 1,

517 
	gMAX_CANON
 = 2,

518 
	gMAX_INPUT
 = 3,

519 
	gNAME_MAX
 = 4,

520 
	gPATH_MAX
 = 5,

521 
	gPIPE_BUF
 = 6,

522 
	gCHOWN_RESTRICTED
 = 7,

523 
	gNO_TRUNC
 = 8,

524 
	gVDISABLE
 = 9,

526 
	gALLOC_SIZE_MIN
 = 11,

527 
	gASYNC_IO
 = 12,

528 
	gFILESIZEBITS
 = 13,

529 
	gPRIO_IO
 = 14,

530 
	gREC_INCR_XFER_SIZE
= 15,

531 
	gREC_MAX_XFER_SIZE
 = 16,

532 
	gREC_MIN_XFER_SIZE
 = 17,

533 
	gREC_XFER_ALIGN
 = 18,

534 
	gSYMLINK_MAX
 = 19,

535 
	gSYNC_IO
 = 20,

536 
	gTIMESTAMP_RESOLUTION
 = 21,

539 -- 
	gg‘´iÜ™y
, 
£riÜ™y
 
æags


540 
	gc
.
	gPRIO
 = 
¡ræag
 {

541 
PROCESS
 = 0,

542 
	gPGRP
 = 1,

543 
	gUSER
 = 2,

544 
	gMIN
 = -20, -- 
TODO
 
u£ful
 
to
 
have
 
Ùh”
 
OSs


545 
	gMAX
 = 20,

548 
	gc
.
	gRUSAGE
 = 
¡ræag
 {

549 
SELF
 = 0,

550 
	gCHILDREN
 = -1,

551 
	gTHREAD
 = 1,

554 
	gc
.
	gSOMAXCONN
 = 128

556 
c
.
SO
 = 
¡ræag
 {

557 
DEBUG
 = 0x0001,

558 
	gACCEPTCONN
 = 0x0002,

559 
	gREUSEADDR
 = 0x0004,

560 
	gKEEPALIVE
 = 0x0008,

561 
	gDONTROUTE
 = 0x0010,

562 
	gBROADCAST
 = 0x0020,

563 
	gUSELOOPBACK
 = 0x0040,

564 
	gLINGER
 = 0x0080,

565 
	gOOBINLINE
 = 0x0100,

566 
	gREUSEPORT
 = 0x0200,

567 
	gTIMESTAMP
 = 0x0800,

568 
	gBINDANY
 = 0x1000,

569 
	gSNDBUF
 = 0x1001,

570 
	gRCVBUF
 = 0x1002,

571 
	gSNDLOWAT
 = 0x1003,

572 
	gRCVLOWAT
 = 0x1004,

573 
	gSNDTIMEO
 = 0x1005,

574 
	gRCVTIMEO
 = 0x1006,

575 
	gERROR
 = 0x1007,

576 
	gTYPE
 = 0x1008,

577 
	gNETPROC
 = 0x1020,

578 
	gRTABLE
 = 0x1021,

579 
	gPEERCRED
 = 0x1022,

580 
	gSPLICE
 = 0x1023,

583 
	gc
.
	gDT
 = 
¡ræag
 {

584 
UNKNOWN
 = 0,

585 
	gFIFO
 = 1,

586 
	gCHR
 = 2,

587 
	gDIR
 = 4,

588 
	gBLK
 = 6,

589 
	gREG
 = 8,

590 
	gLNK
 = 10,

591 
	gSOCK
 = 12,

594 
	gc
.
	gIP
 = 
¡ræag
 {

595 
OPTIONS
 = 1,

596 
	gHDRINCL
 = 2,

597 
	gTOS
 = 3,

598 
	gTTL
 = 4,

599 
	gRECVOPTS
 = 5,

600 
	gRECVRETOPTS
 = 6,

601 
	gRECVDSTADDR
 = 7,

602 
	gRETOPTS
 = 8,

603 
	gMULTICAST_IF
 = 9,

604 
	gMULTICAST_TTL
 = 10,

605 
	gMULTICAST_LOOP
 = 11,

606 
	gADD_MEMBERSHIP
 = 12,

607 
	gDROP_MEMBERSHIP
 = 13,

609 
	gPORTRANGE
 = 19,

610 
	gAUTH_LEVEL
 = 20,

611 
	gESP_TRANS_LEVEL
 = 21,

612 
	gESP_NETWORK_LEVEL
 = 22,

613 
	gIPSEC_LOCAL_ID
 = 23,

614 
	gIPSEC_REMOTE_ID
 = 24,

615 
	gIPSEC_LOCAL_CRED
 = 25,

616 
	gIPSEC_REMOTE_CRED
 = 26,

617 
	gIPSEC_LOCAL_AUTH
 = 27,

618 
	gIPSEC_REMOTE_AUTH
 = 28,

619 
	gIPCOMP_LEVEL
 = 29,

620 
	gRECVIF
 = 30,

621 
	gRECVTTL
 = 31,

622 
	gMINTTL
 = 32,

623 
	gRECVDSTPORT
 = 33,

624 
	gPIPEX
 = 34,

625 
	gRECVRTABLE
 = 35,

626 
	gIPSECFLOWINFO
 = 36,

628 
	gRTABLE
 = 0x1021,

629 
	gDIVERTFL
 = 0x1022,

632 -- 
Baud
 
¿‹s
 
ju¡
 
the
 
id’t™y
 
funùiÚ
 
Ùh”
 
thª
 
	gEXTA
, 
EXTB
 
TODO
 
check


633 
	gc
.
	gB
 = 
¡ræag
 {

636 
c
.
CC
 = 
¡ræag
 {

637 
VEOF
 = 0,

638 
	gVEOL
 = 1,

639 
	gVEOL2
 = 2,

640 
	gVERASE
 = 3,

641 
	gVWERASE
 = 4,

642 
	gVKILL
 = 5,

643 
	gVREPRINT
 = 6,

644 
	gVINTR
 = 8,

645 
	gVQUIT
 = 9,

646 
	gVSUSP
 = 10,

647 
	gVDSUSP
 = 11,

648 
	gVSTART
 = 12,

649 
	gVSTOP
 = 13,

650 
	gVLNEXT
 = 14,

651 
	gVDISCARD
 = 15,

652 
	gVMIN
 = 16,

653 
	gVTIME
 = 17,

654 
	gVSTATUS
 = 18,

657 
	gc
.
	gIFLAG
 = 
muÉiæags
 {

658 
IGNBRK
 = 0x00000001,

659 
	gBRKINT
 = 0x00000002,

660 
	gIGNPAR
 = 0x00000004,

661 
	gPARMRK
 = 0x00000008,

662 
	gINPCK
 = 0x00000010,

663 
	gISTRIP
 = 0x00000020,

664 
	gINLCR
 = 0x00000040,

665 
	gIGNCR
 = 0x00000080,

666 
	gICRNL
 = 0x00000100,

667 
	gIXON
 = 0x00000200,

668 
	gIXOFF
 = 0x00000400,

669 
	gIXANY
 = 0x00000800,

670 
	gIMAXBEL
 = 0x00002000,

673 
	gc
.
	gOFLAG
 = 
muÉiæags
 {

674 
OPOST
 = 0x00000001,

675 
	gONLCR
 = 0x00000002,

676 
	gOXTABS
 = 0x00000004,

677 
	gONOEOT
 = 0x00000008,

678 
	gOCRNL
 = 0x00000010,

679 
	gOLCUC
 = 0x00000020,

680 
	gONOCR
 = 0x00000040,

681 
	gONLRET
 = 0x00000080,

684 
	gc
.
	gCFLAG
 = 
muÉiæags
 {

685 
CIGNORE
 = 0x00000001,

686 
	gCSIZE
 = 0x00000300,

687 
	gCS5
 = 0x00000000,

688 
	gCS6
 = 0x00000100,

689 
	gCS7
 = 0x00000200,

690 
	gCS8
 = 0x00000300,

691 
	gCSTOPB
 = 0x00000400,

692 
	gCREAD
 = 0x00000800,

693 
	gPARENB
 = 0x00001000,

694 
	gPARODD
 = 0x00002000,

695 
	gHUPCL
 = 0x00004000,

696 
	gCLOCAL
 = 0x00008000,

697 
	gCRTSCTS
 = 0x00010000,

698 
	gMDMBUF
 = 0x00100000,

701 
	gc
.
	gCFLAG
.
	gCRTS_IFLOW
 = 
c
.
CFLAG
.
CRTSCTS


702 
c
.
CFLAG
.
CCTS_OFLOW
 = c.CFLAG.
CRTSCTS


703 
c
.
CFLAG
.
CHWFLOW
 = c.CFLAG.
MDMBUF
 + c.CFLAG.
CRTSCTS


705 
c
.
LFLAG
 = 
muÉiæags
 {

706 
ECHOKE
 = 0x00000001,

707 
	gECHOE
 = 0x00000002,

708 
	gECHOK
 = 0x00000004,

709 
	gECHO
 = 0x00000008,

710 
	gECHONL
 = 0x00000010,

711 
	gECHOPRT
 = 0x00000020,

712 
	gECHOCTL
 = 0x00000040,

713 
	gISIG
 = 0x00000080,

714 
	gICANON
 = 0x00000100,

715 
	gALTWERASE
 = 0x00000200,

716 
	gIEXTEN
 = 0x00000400,

717 
	gEXTPROC
 = 0x00000800,

718 
	gTOSTOP
 = 0x00400000,

719 
	gFLUSHO
 = 0x00800000,

720 
	gNOKERNINFO
 = 0x02000000,

721 
	gPENDIN
 = 0x20000000,

722 
	gNOFLSH
 = 0x80000000,

725 
	gc
.
	gTCSA
 = 
muÉiæags
 { -- 
this
 
is
 
ªÙh”
 
odd
 
Úe
, 
wh”e
 
you
 
ÿn
 
have
 oÃ 
æag
 
¶us
 
SOFT


726 
NOW
 = 0,

727 
	gDRAIN
 = 1,

728 
	gFLUSH
 = 2,

729 
	gSOFT
 = 0x10,

732 -- 
tcæush
(), 
»Çmed
 
äom
 
TC
 
to
 
TCFLUSH


733 
	gc
.
	gTCFLUSH
 = 
¡ræag
 {

734 
IFLUSH
 = 1,

735 
	gOFLUSH
 = 2,

736 
	gIOFLUSH
 = 3,

739 -- 
	g‹rmios
 - 
	$tcæow
(è
ªd
 
TCXONC
 
u£
 
the£
. 
»Çmed
 
äom
 
TC
 
to
 
TCFLOW


740 
c
.
TCFLOW
 = 
¡ræag
 {

741 
OOFF
 = 1,

742 
OON
 = 2,

743 
IOFF
 = 3,

744 
ION
 = 4,

745 
	}
}

747 -- 
chæags
 
ªd
 
	g¡©
. 
nÙe
 
the£
 
have
 
no
 
´efix


748 
	gc
.
	gCHFLAGS
 = 
muÉiæags
 {

749 
UF_NODUMP
 = 0x00000001,

750 
	gUF_IMMUTABLE
 = 0x00000002,

751 
	gUF_APPEND
 = 0x00000004,

752 
	gUF_OPAQUE
 = 0x00000008,

754 
	gSF_ARCHIVED
 = 0x00010000,

755 
	gSF_IMMUTABLE
 = 0x00020000,

756 
	gSF_APPEND
 = 0x00040000,

759 
	gc
.
	gCHFLAGS
.
	gIMMUTABLE
 = 
c
.
CHFLAGS
.
UF_IMMUTABLE
 + c.CHFLAGS.
SF_IMMUTABLE


760 
c
.
CHFLAGS
.
APPEND
 = c.CHFLAGS.
UF_APPEND
 + c.CHFLAGS.
SF_APPEND


761 
c
.
CHFLAGS
.
OPAQUE
 = c.CHFLAGS.
UF_OPAQUE


763 
c
.
TCP
 = 
¡ræag
 {

764 
NODELAY
 = 0x01,

765 
	gMAXSEG
 = 0x02,

766 
	gMD5SIG
 = 0x04,

767 
	gSACK_ENABLE
 = 0x08,

770 
	gc
.
	gRB
 = 
muÉiæags
 {

771 
AUTOBOOT
 = 0,

772 
	gASKNAME
 = 0x0001,

773 
	gSINGLE
 = 0x0002,

774 
	gNOSYNC
 = 0x0004,

775 
	gHALT
 = 0x0008,

776 
	gINITNAME
 = 0x0010,

777 
	gDFLTROOT
 = 0x0020,

778 
	gKDB
 = 0x0040,

779 
	gRDONLY
 = 0x0080,

780 
	gDUMP
 = 0x0100,

781 
	gMINIROOT
 = 0x0200,

782 
	gCONFIG
 = 0x0400,

783 
	gTIMEBAD
 = 0x0800,

784 
	gPOWERDOWN
 = 0x1000,

785 
	gSERCONS
 = 0x2000,

786 
	gUSERREQ
 = 0x4000,

789 -- 
kqueue


790 
	gc
.
	gEV
 = 
muÉiæags
 {

791 
ADD
 = 0x0001,

792 
	gDELETE
 = 0x0002,

793 
	gENABLE
 = 0x0004,

794 
	gDISABLE
 = 0x0008,

795 
	gONESHOT
 = 0x0010,

796 
	gCLEAR
 = 0x0020,

797 
	gSYSFLAGS
 = 0xF000,

798 
	gFLAG1
 = 0x2000,

799 
	gEOF
 = 0x8000,

800 
	gERROR
 = 0x4000,

803 
	gc
.
	gEVFILT
 = 
¡ræag
 {

804 
READ
 = -1,

805 
	gWRITE
 = -2,

806 
	gAIO
 = -3,

807 
	gVNODE
 = -4,

808 
	gPROC
 = -5,

809 
	gSIGNAL
 = -6,

810 
	gTIMER
 = -7,

811 
	gSYSCOUNT
 = 7,

814 
	gc
.
	gNOTE
 = 
muÉiæags
 {

815 -- 
»ad
 
ªd
 
wr™e


816 
LOWAT
 = 0x0001,

817 -- 
vnode


818 
	gDELETE
 = 0x0001,

819 
	gWRITE
 = 0x0002,

820 
	gEXTEND
 = 0x0004,

821 
	gATTRIB
 = 0x0008,

822 
	gLINK
 = 0x0010,

823 
	gRENAME
 = 0x0020,

824 
	gREVOKE
 = 0x0040,

825 -- 
´oc


826 
	gEXIT
 = 0x80000000,

827 
	gFORK
 = 0x40000000,

828 
	gEXEC
 = 0x20000000,

829 
	gPCTRLMASK
 = 0xf0000000,

830 
	gPDATAMASK
 = 0x000fffff,

831 
	gTRACK
 = 0x00000001,

832 
	gTRACKERR
 = 0x00000002,

833 
	gCHILD
 = 0x00000004,

836 
	gc
.
	gITIMER
 = 
¡ræag
 {

837 
REAL
 = 0,

838 
	gVIRTUAL
 = 1,

839 
	gPROF
 = 2,

842 
	gc
.
	gSA
 = 
muÉiæags
 {

843 
ONSTACK
 = 0x0001,

844 
	gRESTART
 = 0x0002,

845 
	gRESETHAND
 = 0x0004,

846 
	gNOCLDSTOP
 = 0x0008,

847 
	gNODEFER
 = 0x0010,

848 
	gNOCLDWAIT
 = 0x0020,

849 
	gSIGINFO
 = 0x0040,

852 -- 
v6
 
sockİts


853 
	gc
.
	gIPV6
 = 
¡ræag
 {

854 
UNICAST_HOPS
 = 4,

855 
	gMULTICAST_IF
 = 9,

856 
	gMULTICAST_HOPS
 = 10,

857 
	gMULTICAST_LOOP
 = 11,

858 
	gJOIN_GROUP
 = 12,

859 
	gLEAVE_GROUP
 = 13,

860 
	gPORTRANGE
 = 14,

861 --
	gICMP6_FILTER
 = 18, -- 
nÙ
 
Çme¥aûd
 
as
 
IPV6


862 
	gCHECKSUM
 = 26,

863 
	gV6ONLY
 = 27,

864 
	gRTHDRDSTOPTS
 = 35,

865 
	gRECVPKTINFO
 = 36,

866 
	gRECVHOPLIMIT
 = 37,

867 
	gRECVRTHDR
 = 38,

868 
	gRECVHOPOPTS
 = 39,

869 
	gRECVDSTOPTS
 = 40,

870 
	gUSE_MIN_MTU
 = 42,

871 
	gRECVPATHMTU
 = 43,

872 
	gPATHMTU
 = 44,

873 
	gPKTINFO
 = 46,

874 
	gHOPLIMIT
 = 47,

875 
	gNEXTHOP
 = 48,

876 
	gHOPOPTS
 = 49,

877 
	gDSTOPTS
 = 50,

878 
	gRTHDR
 = 51,

879 
	gRECVTCLASS
 = 57,

880 
	gTCLASS
 = 61,

881 
	gDONTFRAG
 = 62,

884 
	gv”siÚ
 < 201405 
th’


885 
	gc
.
	gIPV6
.
	gSOCKOPT_RESERVED1
 = 3

886 
c
.
IPV6
.
FAITH
 = 29

887 
’d


889 
c
.
CLOCK
 = 
¡ræag
 {

890 
REALTIME
 = 0,

891 
	gPROCESS_CPUTIME_ID
 = 2,

892 
	gMONOTONIC
 = 3,

893 
	gTHREAD_CPUTIME_ID
 = 4,

896 
	gv”siÚ
 < 201505 
th’


897 
	gc
.
	gCLOCK
.
	gVIRTUAL
 = 1

898 
’d


900 
v”siÚ
 >ğ201505 
th’


901 
c
.
CLOCK
.
UPTIME
 = 5

902 
’d


904 
c
.
UTIME
 = 
¡ræag
 {

905 
NOW
 = -2,

906 
	gOMIT
 = -1,

909 
	gc
.
	gPATH_MAX
 = 1024

911 
c
.
CTL
 = 
¡ræag
 {

912 
UNSPEC
 = 0,

913 
	gKERN
 = 1,

914 
	gVM
 = 2,

915 
	gFS
 = 3,

916 
	gNET
 = 4,

917 
	gDEBUG
 = 5,

918 
	gHW
 = 6,

919 
	gMACHDEP
 = 7,

920 
	gDDB
 = 9,

921 
	gVFS
 = 10,

922 
	gMAXID
 = 11,

925 
	gc
.
	gKERN
 = 
¡ræag
 {

926 
OSTYPE
 = 1,

927 
	gOSRELEASE
 = 2,

928 
	gOSREV
 = 3,

929 
	gVERSION
 = 4,

930 
	gMAXVNODES
 = 5,

931 
	gMAXPROC
 = 6,

932 
	gMAXFILES
 = 7,

933 
	gARGMAX
 = 8,

934 
	gSECURELVL
 = 9,

935 
	gHOSTNAME
 = 10,

936 
	gHOSTID
 = 11,

937 
	gCLOCKRATE
 = 12,

938 
	gPROF
 = 16,

939 
	gPOSIX1
 = 17,

940 
	gNGROUPS
 = 18,

941 
	gJOB_CONTROL
 = 19,

942 
	gSAVED_IDS
 = 20,

943 
	gBOOTTIME
 = 21,

944 
	gDOMAINNAME
 = 22,

945 
	gMAXPARTITIONS
 = 23,

946 
	gRAWPARTITION
 = 24,

947 
	gMAXTHREAD
 = 25,

948 
	gNTHREADS
 = 26,

949 
	gOSVERSION
 = 27,

950 
	gSOMAXCONN
 = 28,

951 
	gSOMINCONN
 = 29,

952 
	gUSERMOUNT
 = 30,

953 
	gRND
 = 31,

954 
	gNOSUIDCOREDUMP
 = 32,

955 
	gFSYNC
 = 33,

956 
	gSYSVMSG
 = 34,

957 
	gSYSVSEM
 = 35,

958 
	gSYSVSHM
 = 36,

959 
	gARND
 = 37,

960 
	gMSGBUFSIZE
 = 38,

961 
	gMALLOCSTATS
 = 39,

962 
	gCPTIME
 = 40,

963 
	gNCHSTATS
 = 41,

964 
	gFORKSTAT
 = 42,

965 
	gNSELCOLL
 = 43,

966 
	gTTY
 = 44,

967 
	gCCPU
 = 45,

968 
	gFSCALE
 = 46,

969 
	gNPROCS
 = 47,

970 
	gMSGBUF
 = 48,

971 
	gPOOL
 = 49,

972 
	gSTACKGAPRANDOM
 = 50,

973 
	gSYSVIPC_INFO
 = 51,

974 
	gSPLASSERT
 = 54,

975 
	gPROC_ARGS
 = 55,

976 
	gNFILES
 = 56,

977 
	gTTYCOUNT
 = 57,

978 
	gNUMVNODES
 = 58,

979 
	gMBSTAT
 = 59,

980 
	gSEMINFO
 = 61,

981 
	gSHMINFO
 = 62,

982 
	gINTRCNT
 = 63,

983 
	gWATCHDOG
 = 64,

984 
	gEMUL
 = 65,

985 
	gPROC
 = 66,

986 
	gMAXCLUSTERS
 = 67,

987 
	gEVCOUNT
 = 68,

988 
	gTIMECOUNTER
 = 69,

989 
	gMAXLOCKSPERUID
 = 70,

990 
	gCPTIME2
 = 71,

991 
	gCACHEPCT
 = 72,

992 
	gFILE
 = 73,

993 
	gCONSDEV
 = 75,

994 
	gNETLIVELOCKS
 = 76,

995 
	gPOOL_DEBUG
 = 77,

996 
	gPROC_CWD
 = 78,

999 
	gv”siÚ
 < 201405 
th’


1000 
	gc
.
	gKERN
.
	gFILE
 = 15

1001 
c
.
KERN
.
FILE2
 = 73

1002 
’d


1004 
v”siÚ
 >ğ201411 
th’


1005 
c
.
KERN
.
PROC_NOBROADCASTKILL
 = 79

1006 
’d


1008 
v”siÚ
 < 201505 
th’


1009 
c
.
KERN
.
VNODE
 = 13

1010 
c
.
KERN
.
USERCRYPTO
 = 52

1011 
c
.
KERN
.
CRYPTODEVALLOWSOFT
 = 53

1012 
c
.
KERN
.
USERASYMCRYPTO
 = 60

1013 
’d


1015  
c


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/errors.lua

1 -- 
O³nBSD
 
”rÜ
 
mes§ges


3 
loÿl
 
	g»quœe
 = 
»quœe


5 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

7 
loÿl
 
”rÜs
 = {

8 
PERM
 = "Operation‚ot…ermitted",

9 
	gNOENT
 = "No such file or directory",

10 
	gSRCH
 = "No such…rocess",

11 
	gINTR
 = "Interrupted system call",

12 
	gIO
 = "Input/outputƒrror",

13 
	gNXIO
 = "Device‚ot configured",

15 
	gNOEXEC
 = "Exec formatƒrror",

16 
	gBADF
 = "Bad file descriptor",

17 
	gCHILD
 = "No child…rocesses",

18 
	gDEADLK
 = "Resource deadlock‡voided",

19 
	gNOMEM
 = "Cannot‡llocate memory",

20 
	gACCES
 = "Permission denied",

21 
	gFAULT
 = "Bad‡ddress",

22 
	gNOTBLK
 = "Block device„equired",

23 
	gBUSY
 = "Resource busy",

24 
	gEXIST
 = "Fileƒxists",

25 
	gXDEV
 = "Cross-device†ink",

26 
	gNODEV
 = "Operation‚ot supported by device",

27 
	gNOTDIR
 = "Not‡ directory",

28 
	gISDIR
 = "Is‡ directory",

29 
	gINVAL
 = "Invalid‡rgument",

30 
	gNFILE
 = "Too many open files in system",

31 
	gMFILE
 = "Too many open files",

32 
	gNOTTY
 = "Inappropriate ioctl for device",

33 
	gTXTBSY
 = "Text file busy",

34 
	gFBIG
 = "Fileoo†arge",

35 
	gNOSPC
 = "No space†eft on device",

36 
	gSPIPE
 = "Illegal seek",

37 
	gROFS
 = "Read-only file system",

38 
	gMLINK
 = "Too many†inks",

39 
	gPIPE
 = "Broken…ipe",

40 
	gDOM
 = "Numerical‡rgument out of domain",

41 
	gRANGE
 = "Resultoo†arge",

42 
	gAGAIN
 = "Resourceemporarily unavailable",

43 
	gINPROGRESS
 = "Operation‚ow in…rogress",

44 
	gALREADY
 = "Operation‡lready in…rogress",

45 
	gNOTSOCK
 = "Socket operation on‚on-socket",

46 
	gDESTADDRREQ
 = "Destination‡ddress„equired",

47 
	gMSGSIZE
 = "Messageoo†ong",

48 
	gPROTOTYPE
 = "Protocol wrongype for socket",

49 
	gNOPROTOOPT
 = "Protocol‚ot‡vailable",

50 
	gPROTONOSUPPORT
 = "Protocol‚ot supported",

51 
	gSOCKTNOSUPPORT
 = "Socketype‚ot supported",

52 
	gOPNOTSUPP
 = "Operation‚ot supported",

53 
	gPFNOSUPPORT
 = "Protocol family‚ot supported",

54 
	gAFNOSUPPORT
 = "Address family‚ot supported by…rotocol family",

55 
	gADDRINUSE
 = "Address‡lready in use",

56 
	gADDRNOTAVAIL
 = "Can't‡ssign„equested‡ddress",

57 
	gNETDOWN
 = "Network is down",

58 
	gNETUNREACH
 = "Network is unreachable",

59 
	gNETRESET
 = "Network dropped connection on„eset",

60 
	gCONNABORTED
 = "Software caused connection‡bort",

61 
	gCONNRESET
 = "Connection„eset by…eer",

62 
	gNOBUFS
 = "No buffer space‡vailable",

63 
	gISCONN
 = "Socket is‡lready connected",

64 
	gNOTCONN
 = "Socket is‚ot connected",

65 
	gSHUTDOWN
 = "Can't send‡fter socket shutdown",

66 
	gTOOMANYREFS
 = "Too many„eferences: can't splice",

67 
	gTIMEDOUT
 = "Operationimed out",

68 
	gCONNREFUSED
 = "Connection„efused",

69 
	gLOOP
 = "Too many†evels of symbolic†inks",

70 
	gNAMETOOLONG
 = "File‚ameoo†ong",

71 
	gHOSTDOWN
 = "Host is down",

72 
	gHOSTUNREACH
 = "No„outeo host",

73 
	gNOTEMPTY
 = "Directory‚otƒmpty",

74 
	gPROCLIM
 = "Too many…rocesses",

75 
	gUSERS
 = "Too many users",

76 
	gDQUOT
 = "Disc quotaƒxceeded",

77 
	gSTALE
 = "Stale NFS file handle",

78 
	gREMOTE
 = "Too many†evels of„emote in…ath",

79 
	gBADRPC
 = "RPC struct is bad",

80 
	gRPCMISMATCH
 = "RPC version wrong",

81 
	gPROGUNAVAIL
 = "RPC…rog.‚ot‡vail",

82 
	gPROGMISMATCH
 = "Program version wrong",

83 
	gPROCUNAVAIL
 = "Bad…rocedure for…rogram",

84 
	gNOLCK
 = "No†ocks‡vailable",

85 
	gNOSYS
 = "Function‚ot implemented",

86 
	gFTYPE
 = "Inappropriate fileype or format",

87 
	gAUTH
 = "Authenticationƒrror",

88 
	gNEEDAUTH
 = "Need‡uthenticator",

89 
	gIPSEC
 = "IPsec…rocessing failure",

90 
	gNOATTR
 = "Attribute‚ot found",

91 
	gILSEQ
 = "Illegal byte sequence",

92 
	gNOMEDIUM
 = "No medium found",

93 
	gMEDIUMTYPE
 = "Wrong Medium Type",

94 
	gOVERFLOW
 = "Conversion overflow",

95 
	gCANCELED
 = "Operation canceled",

96 
	gIDRM
 = "Identifier„emoved",

97 
	gNOMSG
 = "No message of desiredype",

98 
	gNOTSUP
 = "Not supported",

101  
	g”rÜs


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/fcntl.lua

1 -- 
O³nBSD
 
	gfú


2 -- 
TODO
 
	gšcom¶‘e
, 
lÙs
 
missšg


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

13 
loÿl
 
c
 = 
»quœe
 "syscall.openbsd.constants"

15 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
ùoboŞ
, 
boŞtoc
 = 
h
.ctobool, h.booltoc

23 
loÿl
 
fú
 = { -- 
TODO
 
some
 
funùiÚ®™y
 
missšg


24 
commªds
 = {

25 [
c
.
F
.
SETFL
] = 
	`funùiÚ
(
¬g
è c.
O
[¬g] 
’d
,

26 [
c
.
F
.
SETFD
] = 
	`funùiÚ
(
¬g
è c.
FD
[¬g] 
’d
,

27 [
c
.
F
.
GETLK
] = 
t
.
æock
,

28 [
c
.
F
.
SETLK
] = 
t
.
æock
,

29 [
c
.
F
.
SETLKW
] = 
t
.
æock
,

31 
»t
 = {

32 [
c
.
F
.
DUPFD
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

33 [
c
.
F
.
DUPFD_CLOEXEC
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

34 [
c
.
F
.
GETFD
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

35 [
c
.
F
.
GETFL
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

36 [
c
.
F
.
GETOWN
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

37 [
c
.
F
.
GETLK
] = 
	`funùiÚ
(
»t
, 
¬g
è‡rg 
’d
,

39 
	}
}

41  
fú


43 
’d


45  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/ffi.lua

1 -- 
This
 
¬e
 
the
 
ty³s
 
O³nBSD


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "syscall.ffitypes"

16 
loÿl
 
v”siÚ
 = 
»quœe
 "syscall.openbsd.version".version

18 
loÿl
 
defs
 = {}

20 
loÿl
 
funùiÚ
 
	$­³nd
(
¡r
è
defs
[#def + 1] = sŒ 
’d


22 
­³nd
 [[

23 
št32_t
 
şockid_t
;

24 
ušt32_t
 
fæags_t
;

25 
ušt64_t
 
fsblkút_t
;

26 
ušt64_t
 
fsfút_t
;

27 
št32_t
 
id_t
;

28 
key_t
;

29 
št32_t
 
lwpid_t
;

30 
ušt32_t
 
mode_t
;

31 
accmode_t
;

32 
Æ_™em
;

33 
ušt32_t
 
Æšk_t
;

34 
št64_t
 
¾im_t
;

35 
ušt8_t
 
§_çmy_t
;

36 
su£cÚds_t
;

37 
u£cÚds_t
;

38 
ıuwhich_t
;

39 
ıuËv–_t
;

40 
ıu£tid_t
;

41 
ušt32_t
 
dev_t
;

42 
ušt32_t
 
fix±_t
;

43 
nfds_t
;

44 
št64_t
 
daddr_t
;

45 
št32_t
 
tim”_t
;

47 
v”siÚ
 <ğ201311 
th’
 
­³nd
 [[

48 
ušt32_t
 
šo_t
;

49 
št32_t
 
time_t
;

50 
št32_t
 
şock_t
;

51 ]] 
­³nd
 [[

52 
ušt64_t
 
šo_t
;

53 
št64_t
 
time_t
;

54 
št64_t
 
şock_t
;

55 ]] 
’d


56 
­³nd
 [[

57 
tcæag_t
;

58 
¥“d_t
;

59 * 
ÿddr_t
;

62 
ušt32_t
 
__fd_mask
;

63 
	sfd_£t
 {

64 
__fd_mask
 
fds_b™s
[32];

65 } 
	tfd_£t
;

66 
	s__sig£t
 {

67 
ušt32_t
 
sig
[1];

68 } 
	tsig£t_t
;

70 
	scmsghdr
 {

71 
sockËn_t
 
cmsg_Ën
;

72 
cmsg_Ëv–
;

73 
cmsg_ty³
;

74 
cmsg_d©a
[?];

76 
	smsghdr
 {

77 *
msg_Çme
;

78 
sockËn_t
 
msg_Çm–’
;

79 
iovec
 *
msg_iov
;

80 
msg_iovËn
;

81 *
msg_cÚŒŞ
;

82 
sockËn_t
 
msg_cÚŒŞËn
;

83 
msg_æags
;

85 
	stime¥ec
 {

86 
time_t
 
tv_£c
;

87 
tv_n£c
;

89 
	stimev®
 {

90 
time_t
 
tv_£c
;

91 
su£cÚds_t
 
tv_u£c
;

93 
	s™im”¥ec
 {

94 
time¥ec
 
™_š‹rv®
;

95 
time¥ec
 
™_v®ue
;

97 
	s™im”v®
 {

98 
timev®
 
™_š‹rv®
;

99 
timev®
 
™_v®ue
;

101 
	ssockaddr
 {

102 
ušt8_t
 
§_Ën
;

103 
§_çmy_t
 
§_çmy
;

104 
§_d©a
[14];

106 
	ssockaddr_¡Üage
 {

107 
ušt8_t
 
ss_Ën
;

108 
§_çmy_t
 
ss_çmy
;

109 
__ss_·d1
[6];

110 
ušt64_t
 
__ss_·d2
;

111 
__ss_·d3
[240];

113 
	ssockaddr_š
 {

114 
ušt8_t
 
sš_Ën
;

115 
§_çmy_t
 
sš_çmy
;

116 
š_pÜt_t
 
sš_pÜt
;

117 
š_addr
 
sš_addr
;

118 
št8_t
 
sš_z”o
[8];

120 
	ssockaddr_š6
 {

121 
ušt8_t
 
sš6_Ën
;

122 
§_çmy_t
 
sš6_çmy
;

123 
š_pÜt_t
 
sš6_pÜt
;

124 
ušt32_t
 
sš6_æowšfo
;

125 
š6_addr
 
sš6_addr
;

126 
ušt32_t
 
sš6_scİe_id
;

128 
	ssockaddr_un
 {

129 
ušt8_t
 
sun_Ën
;

130 
§_çmy_t
 
sun_çmy
;

131 
sun_·th
[104];

133 
	spŞlfd
 {

134 
fd
;

135 
ev’ts
;

136 
»v’ts
;

139 
v”siÚ
 <ğ201311 
th’
 
­³nd
 [[

140 
	s¡©
 {

141 
dev_t
 
¡_dev
;

142 
šo_t
 
¡_šo
;

143 
mode_t
 
¡_mode
;

144 
Æšk_t
 
¡_Æšk
;

145 
uid_t
 
¡_uid
;

146 
gid_t
 
¡_gid
;

147 
dev_t
 
¡_rdev
;

148 
št32_t
 
¡_l¥¬e0
;

149 
time¥ec
 
¡_©im
;

150 
time¥ec
 
¡_mtim
;

151 
time¥ec
 
¡_ùim
;

152 
off_t
 
¡_size
;

153 
št64_t
 
¡_blocks
;

154 
ušt32_t
 
¡_blksize
;

155 
ušt32_t
 
¡_æags
;

156 
ušt32_t
 
¡_g’
;

157 
št32_t
 
¡_l¥¬e1
;

158 
time¥ec
 
__¡_bœthtim
;

159 
št64_t
 
¡_q¥¬e
[2];

161 ]] 
­³nd
 [[

162 
	s¡©
 {

163 
mode_t
 
¡_mode
;

164 
dev_t
 
¡_dev
;

165 
šo_t
 
¡_šo
;

166 
Æšk_t
 
¡_Æšk
;

167 
uid_t
 
¡_uid
;

168 
gid_t
 
¡_gid
;

169 
dev_t
 
¡_rdev
;

170 
time¥ec
 
¡_©im
;

171 
time¥ec
 
¡_mtim
;

172 
time¥ec
 
¡_ùim
;

173 
off_t
 
¡_size
;

174 
št64_t
 
¡_blocks
;

175 
ušt32_t
 
¡_blksize
;

176 
ušt32_t
 
¡_æags
;

177 
ušt32_t
 
¡_g’
;

178 
time¥ec
 
__¡_bœthtim
;

180 ]] 
’d
 
­³nd
 [[

181 
	sru§ge
 {

182 
timev®
 
ru_utime
;

183 
timev®
 
ru_¡ime
;

184 
ru_maxrss
;

185 
ru_ixrss
;

186 
ru_idrss
;

187 
ru_i¤ss
;

188 
ru_mšæt
;

189 
ru_majæt
;

190 
ru_nsw­
;

191 
ru_šblock
;

192 
ru_oublock
;

193 
ru_msg¢d
;

194 
ru_msgrcv
;

195 
ru_nsigÇls
;

196 
ru_nvcsw
;

197 
ru_nivcsw
;

199 
	sæock
 {

200 
off_t
 
l_¡¬t
;

201 
off_t
 
l_Ën
;

202 
pid_t
 
l_pid
;

203 
l_ty³
;

204 
l_wh’û
;

206 
	s‹rmios
 {

207 
tcæag_t
 
c_iæag
;

208 
tcæag_t
 
c_oæag
;

209 
tcæag_t
 
c_cæag
;

210 
tcæag_t
 
c_læag
;

211 
cc_t
 
c_cc
[20];

212 
¥“d_t
 
c_i¥“d
;

213 
¥“d_t
 
c_o¥“d
;

216 
v”siÚ
 <ğ201311 
th’
 
­³nd
 [[

217 
	sdœ’t
 {

218 
ušt32_t
 
d_f’o
;

219 
ušt16_t
 
d_»ş’
;

220 
ušt8_t
 
d_ty³
;

221 
ušt8_t
 
d_ÇmËn
;

222 
d_Çme
[255 + 1];

224 
	skev’t
 {

225 
id’t
;

226 
f‹r
;

227 
æags
;

228 
fæags
;

229 
d©a
;

230 *
ud©a
;

232 ]] 
­³nd
 [[

233 
	sdœ’t
 {

234 
ušt64_t
 
d_f’o
;

235 
št64_t
 
d_off
;

236 
ušt16_t
 
d_»ş’
;

237 
ušt8_t
 
d_ty³
;

238 
ušt8_t
 
d_ÇmËn
;

239 
__d_·ddšg
[4];

240 
d_Çme
[255 + 1];

242 
	skev’t
 {

243 
šŒ_t
 
id’t
;

244 
f‹r
;

245 
æags
;

246 
fæags
;

247 
št64_t
 
d©a
;

248 *
ud©a
;

250 ]] 
’d


251 
­³nd
 [[

252 
	usigv®
 {

253 
siv®_št
;

254 *
siv®_±r
;

256 cÚ¡ 
SI_MAXSZ
 = 128;

257 cÚ¡ 
SI_PAD
 = ((
SI_MAXSZ
 /  ()) - 3);

259 
si_signo
;

260 
si_code
;

261 
si_”ºo
;

263 
_·d
[
SI_PAD
];

265 
pid_t
 
_pid
;

268 
uid_t
 
_uid
;

269 
sigv®
 
_v®ue
;

270 } 
_kl
;

272 
şock_t
 
_utime
;

273 
_¡©us
;

274 
şock_t
 
_¡ime
;

275 } 
_şd
;

276 } 
_pd©a
;

277 } 
_´oc
;

279 
ÿddr_t
 
_addr
;

280 
_Œ­no
;

281 } 
_çuÉ
;

282 } 
_d©a
;

283 } 
	tsigšfo_t
;

284 
	ssigaùiÚ
 {

286 (*
__§_hªdËr
)();

287 (*
__§_sigaùiÚ
)(, 
sigšfo_t
 *, *);

288 } 
__sigaùiÚ_u
;

289 
sig£t_t
 
§_mask
;

290 
§_æags
;

294 -- 
funùiÚs


295 
­³nd
 [[

296 
	`»boÙ
(
howto
);

297 
	`ioùl
(
d
, 
»que¡
, *
¬g
);

298 
	`f¡©©
(
dœfd
, cÚ¡ *
·thÇme
, 
¡©
 *
buf
, 
æags
);

301 
	`g¿Á±
(
fdes
);

302 
	`uÆock±
(
fdes
);

303 *
	`±¢ame
(
fdes
);

306 
v”siÚ
 >ğ201405 
th’


307 
­³nd
 [[

308 
	`g‘d’ts
(
fd
, *
buf
, 
size_t
 
nby‹s
);

310 
’d


312 
loÿl
 
s
 = 
bË
.
	`cÚÿt
(
defs
, "")

314 
ffi
.
	$cdef
(
s
)

316 
»quœe
 "syscall.bsd.ffi"

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/ioctl.lua

1 -- 
	gioùls
, 
flšg
 
š
 
as
 
Ãeded


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
s
, 
t
 = 
ty³s
.s,ypes.t

14 
loÿl
 
¡ræag
 = 
	`»quœe
("syscall.helpers").strflag

15 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

17 
loÿl
 
bªd
 = 
b™
.band

18 
loÿl
 
funùiÚ
 
	$bÜ
(...)

19 
loÿl
 
r
 = 
b™
.
	$bÜ
(...)

20 
r
 < 0 
th’
„ =„ + 4294967296 
’d
 -- 
TODO
 
£e
 
nÙe
 
š
 
N‘BSD


21  
r


22 
’d


23 
loÿl
 
lshiá
 = 
b™
.lshift

24 
loÿl
 
rshiá
 = 
b™
.rshift

26 
loÿl
 
IOC
 = {

27 
VOID
 = 0x20000000,

28 
OUT
 = 0x40000000,

29 
IN
 = 0x80000000,

30 
PARM_SHIFT
 = 13,

31 
	}
}

33 
	gIOC
.
	gPARM_MASK
 = 
lshiá
(1, 
IOC
.
PARM_SHIFT
) - 1

34 
	gIOC
.
	gINOUT
 = 
IOC
.
IN
 + IOC.
OUT


35 
IOC
.
DIRMASK
 = IOC.
IN
 + IOC.
OUT
 + IOC.
VOID


37 
loÿl
 
funùiÚ
 
	$ioc
(
dœ
, 
ch
, 
Ä
, 
size
)

38  
t
.
	`ulÚg
(
	`bÜ
(
dœ
,

39 
	`lshiá
(
	`bªd
(
size
, 
IOC
.
PARM_MASK
), 16),

40 
	`lshiá
(
ch
, 8),

41 
Ä
))

42 
’d


44 
loÿl
 
sšgËtÚm­
 = {

47 
ušt
 = "uint1",

48 
ušt64
 = "uint64_1",

49 
off
 = "off1",

50 
	}
}

52 
loÿl
 
funùiÚ
 
	$_IOC
(
dœ
, 
ch
, 
Ä
, 

)

53 
	`ty³
(
ch
è=ğ"¡ršg" 
th’
 ch = ch:
	$by‹
(è
’d


54 
	`ty³
(

è=ğ"numb”" 
th’
  
	$ioc
(
dœ
, 
ch
, 
Ä
, 

è
’d


55 
loÿl
 
size
 = 
s
[

]

56 
loÿl
 
sšgËtÚ
 = 
sšgËtÚm­
[

] ~ğ
n


57 

 = 
sšgËtÚm­
[] 
Ü
p

58  {
numb”
 = 
	`ioc
(
dœ
, 
ch
, 
Ä
, 
size
),

59 
»ad
 = 
dœ
 =ğ
IOC
.
OUT
 
Ü
 dœ =ğIOC.
INOUT
, 
wr™e
 = dœ =ğIOC.
IN
 or dir == IOC.INOUT,

60 
ty³
 = 
t
[

], 
sšgËtÚ
 = 
	}
singleton}

61 
’d


63 
loÿl
 
	g_IO
 = 
	$funùiÚ
(
ch
, 
Ä
è 
	$_IOC
(
IOC
.
VOID
, 
ch
, 
Ä
, 0è
’d


64 
loÿl
 
_IOR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
OUT
, 
ch
, 
Ä
, 

è
’d


65 
loÿl
 
_IOW
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
IN
, 
ch
, 
Ä
, 

è
’d


66 
loÿl
 
_IOWR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
INOUT
, 
ch
, 
Ä
, 

è
’d


68 
loÿl
 
ioùl
 = 
¡ræag
 {

69 -- 
‰y
 
ioùls


70 
TIOCEXCL
 = 
	`_IO
('t', 13),

71 
TIOCNXCL
 = 
	`_IO
('t', 14),

72 
TIOCFLUSH
 = 
	`_IOW
('t', 16, "int"),

73 
TIOCGETA
 = 
	`_IOR
('t', 19, "termios"),

74 
TIOCSETA
 = 
	`_IOW
('t', 20, "termios"),

75 
TIOCSETAW
 = 
	`_IOW
('t', 21, "termios"),

76 
TIOCSETAF
 = 
	`_IOW
('t', 22, "termios"),

77 
TIOCGETD
 = 
	`_IOR
('t', 26, "int"),

78 
TIOCSETD
 = 
	`_IOW
('t', 27, "int"),

79 
TIOCDRAIN
 = 
	`_IO
('t', 94),

80 
TIOCSIG
 = 
	`_IOW
('t', 95, "int"),

81 
TIOCEXT
 = 
	`_IOW
('t', 96, "int"),

82 
TIOCSCTTY
 = 
	`_IO
('t', 97),

83 
TIOCCONS
 = 
	`_IOW
('t', 98, "int"),

84 
TIOCSTAT
 = 
	`_IOW
('t', 101, "int"),

85 
TIOCUCNTL
 = 
	`_IOW
('t', 102, "int"),

86 
TIOCSWINSZ
 = 
	`_IOW
('t', 103, "winsize"),

87 
TIOCGWINSZ
 = 
	`_IOR
('t', 104, "winsize"),

88 
TIOCMGET
 = 
	`_IOR
('t', 106, "int"),

89 
TIOCMBIC
 = 
	`_IOW
('t', 107, "int"),

90 
TIOCMBIS
 = 
	`_IOW
('t', 108, "int"),

91 
TIOCMSET
 = 
	`_IOW
('t', 109, "int"),

92 
TIOCSTART
 = 
	`_IO
('t', 110),

93 
TIOCSTOP
 = 
	`_IO
('t', 111),

94 
TIOCPKT
 = 
	`_IOW
('t', 112, "int"),

95 
TIOCNOTTY
 = 
	`_IO
('t', 113),

96 
TIOCSTI
 = 
	`_IOW
('t', 114, "char"),

97 
TIOCOUTQ
 = 
	`_IOR
('t', 115, "int"),

98 
TIOCSPGRP
 = 
	`_IOW
('t', 118, "int"),

99 
TIOCGPGRP
 = 
	`_IOR
('t', 119, "int"),

100 
TIOCCDTR
 = 
	`_IO
('t', 120),

101 
TIOCSDTR
 = 
	`_IO
('t', 121),

102 
TIOCCBRK
 = 
	`_IO
('t', 122),

103 
TIOCSBRK
 = 
	`_IO
('t', 123),

105 -- 
fe
 
desütÜ
 
ioùls


106 
FIOCLEX
 = 
	`_IO
('f', 1),

107 
FIONCLEX
 = 
	`_IO
('f', 2),

108 
FIONREAD
 = 
	`_IOR
('f', 127, "int"),

109 
FIONBIO
 = 
	`_IOW
('f', 126, "int"),

110 
FIOASYNC
 = 
	`_IOW
('f', 125, "int"),

111 
FIOSETOWN
 = 
	`_IOW
('f', 124, "int"),

112 
FIOGETOWN
 = 
	`_IOR
('f', 123, "int"),

114 -- 
®low
 
u£r
 
defšed
 
ioùls


115 
_IO
 = _IO,

116 
_IOR
 = _IOR,

117 
_IOW
 = _IOW,

118 
_IOWR
 = _IOWR,

119 
	}
}

121  
ioùl


123 
’d


125  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/syscalls.lua

1 -- 
O³nBSD
 
¥ecific
 
sysÿÎs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12  
	$funùiÚ
(
S
, 
hh
, 
c
, 
C
, 
ty³s
)

14 
loÿl
 
»t64
, 
»Šum
, 
»tfd
, 
»tboŞ
, 
»Œ
 = 
hh
.ret64, hh.retnum, hh.retfd, hh.retbool, hh.retptr

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
”ºo
 = 
ffi
.errno

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
i¡y³
, 
mkty³
, 
g‘fd
 = 
h
.istype, h.mktype, h.getfd

23 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

25 
funùiÚ
 
S
.
	$»boÙ
(
howto
è 
C
.
	$»boÙ
(
c
.
RB
[
howto
]è
’d


27 -- 
±y
 
funùiÚs
, 
usšg
 
libc
 
Úes
 
now
; 
the
†ibøÚe 
u£
 
a
 
d©aba£
 
of
 
Çme
 
to
 
dev
 
m­pšgs


28 
funùiÚ
 
S
.
	$±¢ame
(
fd
)

29 
loÿl
 
Çme
 = 
ffi
.
C
.
	`±¢ame
(
	$g‘fd
(
fd
))

30 
nÙ
 
Çme
 
th’
  
n
 
’d


31  
ffi
.
	$¡ršg
(
Çme
)

32 
’d


34 
funùiÚ
 
S
.
	$g¿Á±
(
fd
è 
	`»tboŞ
(
ffi
.
C
.
	`g¿Á±
(
	$g‘fd
(
fd
))è
’d


35 
funùiÚ
 
S
.
	$uÆock±
(
fd
è 
	`»tboŞ
(
ffi
.
C
.
	`uÆock±
(
	$g‘fd
(
fd
))è
’d


37  
S


39 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/sysctl.lua

1 --
ty³s
 
O³nBSD
 
	gsysùl
, 
šcom¶‘e
 
©
 
´e£Á


3 
loÿl
 
	g»quœe
 = 
»quœe


5 
loÿl
 
c
 = 
»quœe
 "syscall.openbsd.constants"

7 
loÿl
 
ty³s
 = {

8 
k”n
 = {
c
.
CTL
.
KERN
, c.KERN},

22  
	gty³s


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/types.lua

1 -- 
O³nBSD
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

14 
loÿl
 
t
, 
±
, 
s
, 
ùy³s
 = 
ty³s
.t,ypes.pt,ypes.s,ypes.ctypes

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
addty³
, 
addty³_v¬
, 
addty³_â
, 
add¿w2
 = 
h
.addtype, h.addtype_var, h.addtype_fn, h.addraw2

22 
loÿl
 
±t
, 
»v™”
, 
mkty³
, 
i¡y³
, 
Ënâ
, 
Ënmt
, 
g‘fd
, 
Ãwâ


23 ğ
h
.
±t
, h.
»v™”
, h.
mkty³
, h.
i¡y³
, h.
Ënâ
, h.
Ënmt
, h.
g‘fd
, h.
Ãwâ


24 
loÿl
 
Áohl
,‚tohl, 
Áohs
, 
htÚs
, 
où®
 = 
h
.ntohl, h.ntohl, h.ntohs, h.htons, h.octal

26 
loÿl
 
c
 = 
»quœe
 "syscall.openbsd.constants"

28 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


30 
loÿl
 
addty³s
 = {

33 
loÿl
 
add¡ruùs
 = {

36 
k
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


37 
k
, 
v
 
š
 
	$·œs
(
add¡ruùs
èdØ
	$addty³
(
ty³s
, 
k
, 
v
, 
Ënmt
è
’d


39 -- 32 
b™
 
dev_t
, 24 b™ 
mšÜ
, 8 b™ 
majÜ
, 
but
 mšÜ 
is
 
a
 
cook›
 
ªd
 
Ã™h”
 
»®ly
 
u£d
 
ju¡
 
Ëgacy


40 
loÿl
 
funùiÚ
 
	$makedev
(
majÜ
, 
mšÜ
)

41 
	`ty³
(
majÜ
è=ğ"bË" 
th’
 majÜ, 
mšÜ
 = majÜ[1], majÜ[2] 
’d


42 
loÿl
 
dev
 = 
majÜ
 
Ü
 0

43 
mšÜ
 
th’
 
dev
 = 
b™
.
	`bÜ
(mšÜ, b™.
	$lshiá
(
majÜ
, 8)è
’d


44  
dev


45 
’d


47 
mt
.
deviû
 = {

48 
šdex
 = {

49 
majÜ
 = 
	`funùiÚ
(
dev
è 
b™
.
	`bÜ
(b™.
	`bªd
(b™.
	`rshiá
(dev.dev, 8), 0xff)è
’d
,

50 
mšÜ
 = 
	`funùiÚ
(
dev
è 
b™
.
	`bªd
(dev.dev, 0xffff00ffè
’d
,

51 
deviû
 = 
	`funùiÚ
(
dev
è 
	`tÚumb”
(dev.devè
’d
,

53 
Ãwšdex
 = {

54 
deviû
 = 
	`funùiÚ
(
dev
, 
majÜ
, 
mšÜ
èdev.dev = 
	`makedev
(majÜ, mšÜè
’d
,

56 
__Ãw
 = 
	`funùiÚ
(

, 
majÜ
, 
mšÜ
)

57  
ffi
.
	`Ãw
(

, 
	`makedev
(
majÜ
, 
mšÜ
))

58 
’d
,

59 
	}
}

61 
addty³
(
ty³s
, "deviû", "¡ruù {dev_ˆdev;}", 
mt
.
deviû
)

63 
	gmt
.
	g¡©
 = {

64 
šdex
 = {

65 
dev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_dev
è
’d
,

66 
	gmode
 = 
funùiÚ
(
¡
è st.
¡_mode
 
’d
,

67 
	gšo
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_šo
è
’d
,

68 
	gÆšk
 = 
funùiÚ
(
¡
è st.
¡_Æšk
 
’d
,

69 
	guid
 = 
funùiÚ
(
¡
è st.
¡_uid
 
’d
,

70 
	ggid
 = 
funùiÚ
(
¡
è st.
¡_gid
 
’d
,

71 
	grdev
 = 
funùiÚ
(
¡
è 
t
.
deviû
(¡.
¡_rdev
è
’d
,

72 
	g©ime
 = 
funùiÚ
(
¡
è st.
¡_©im
.
time
 
’d
,

73 
	gùime
 = 
funùiÚ
(
¡
è st.
¡_ùim
.
time
 
’d
,

74 
	gmtime
 = 
funùiÚ
(
¡
è st.
¡_mtim
.
time
 
’d
,

75 
	gbœthtime
 = 
funùiÚ
(
¡
è st.
¡_bœthtim
.
time
 
’d
,

76 
	gsize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_size
è
’d
,

77 
	gblocks
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blocks
è
’d
,

78 
	gblksize
 = 
funùiÚ
(
¡
è 
tÚumb”
(¡.
¡_blksize
è
’d
,

79 
	gæags
 = 
funùiÚ
(
¡
è st.
¡_æags
 
’d
,

80 
	gg’
 = 
funùiÚ
(
¡
è st.
¡_g’
 
’d
,

82 
	gty³
 = 
funùiÚ
(
¡
è 
b™
.
bªd
(¡.
¡_mode
, 
c
.
S_I
.
FMT
è
	g’d
,

83 
	gtodt
 = 
funùiÚ
(
¡
è 
b™
.
rshiá
(¡.
ty³
, 12è
	g’d
,

84 
	gi¤eg
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FREG
 
’d
,

85 
	gisdœ
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FDIR
 
’d
,

86 
	gischr
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FCHR
 
’d
,

87 
	gisblk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FBLK
 
’d
,

88 
	gisfifo
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FIFO
 
’d
,

89 
	gi¦nk
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FLNK
 
’d
,

90 
	gissock
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FSOCK
 
’d
,

91 
	giswht
 = 
funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FWHT
 
’d
,

95 -- 
add
 
some
 
ä›ndl›r
 
Çmes
 
to
 
	g¡©
, 
®so
 
luafesy¡em
 
com·tib™y


96 
	gmt
.
	g¡©
.
	gšdex
.
	gacûss
 = 
mt
.
¡©
.
šdex
.
©ime


97 
mt
.
¡©
.
šdex
.
modifiÿtiÚ
 = mt.¡©.šdex.
mtime


98 
mt
.
¡©
.
šdex
.
chªge
 = mt.¡©.šdex.
ùime


100 
loÿl
 
Çmem­
 = {

101 
fe
 = 
mt
.
¡©
.
šdex
.
i¤eg
,

102 
	gdœeùÜy
 = 
mt
.
¡©
.
šdex
.
isdœ
,

103 
	glšk
 = 
mt
.
¡©
.
šdex
.
i¦nk
,

104 
	gsock‘
 = 
mt
.
¡©
.
šdex
.
issock
,

105 ["ch¬ deviû"] = 
mt
.
¡©
.
šdex
.
ischr
,

106 ["block deviû"] = 
mt
.
¡©
.
šdex
.
isblk
,

107 ["Çmed…e"] = 
mt
.
¡©
.
šdex
.
isfifo
,

110 
	gmt
.
	g¡©
.
	gšdex
.
	gty³Çme
 = 
	$funùiÚ
(
¡
)

111 
k
, 
v
 
š
 
	$·œs
(
Çmem­
èdØ
	$v
(
¡
è
th’
  
k
 
’d
ƒnd

113 
’d


115 
	`addty³
(
ty³s
, "¡©", "¡ruù st", 
mt
.
¡©
)

117 
mt
.
æock
 = {

118 
šdex
 = {

119 
ty³
 = 
	`funùiÚ
(
£lf
è s–f.
l_ty³
 
’d
,

120 
wh’û
 = 
	`funùiÚ
(
£lf
è s–f.
l_wh’û
 
’d
,

121 
¡¬t
 = 
	`funùiÚ
(
£lf
è s–f.
l_¡¬t
 
’d
,

122 
Ën
 = 
	`funùiÚ
(
£lf
è s–f.
l_Ën
 
’d
,

123 
pid
 = 
	`funùiÚ
(
£lf
è s–f.
l_pid
 
’d
,

124 
sysid
 = 
	`funùiÚ
(
£lf
è s–f.
l_sysid
 
’d
,

126 
Ãwšdex
 = {

127 
ty³
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_ty³
 = 
c
.
FCNTL_LOCK
[v] 
’d
,

128 
wh’û
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_wh’û
 = 
c
.
SEEK
[v] 
’d
,

129 
¡¬t
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_¡¬t
 = v 
’d
,

130 
Ën
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_Ën
 = v 
’d
,

131 
pid
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_pid
 = v 
’d
,

132 
sysid
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_sysid
 = v 
’d
,

134 
__Ãw
 = 
Ãwâ
,

135 
	}
}

137 
addty³
(
ty³s
, "æock", "¡ruù flock", 
mt
.
æock
)

139 
	gmt
.
	gdœ’t
 = {

140 
šdex
 = {

141 
f’o
 = 
funùiÚ
(
£lf
è 
tÚumb”
(£lf.
d_f’o
è
’d
,

142 
	g»ş’
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

143 
	gÇmËn
 = 
funùiÚ
(
£lf
è s–f.
d_ÇmËn
 
’d
,

144 
	gty³
 = 
funùiÚ
(
£lf
è s–f.
d_ty³
 
’d
,

145 
	gÇme
 = 
funùiÚ
(
£lf
è 
ffi
.
¡ršg
(£lf.
d_Çme
, s–f.
d_ÇmËn
è
	g’d
,

146 
	gtoif
 = 
funùiÚ
(
£lf
è 
b™
.
lshiá
(£lf.
d_ty³
, 12è
	g’d
, -- 
cÚv”t
 
to
 
¡©
 
	gty³s


148 
	g__Ën
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

151 
	gmt
.
	gdœ’t
.
	gšdex
.
	gšo
 = 
mt
.
dœ’t
.
šdex
.
f’o
 -- 
®‹º©e
 
Çme


153 -- 
TODO
 
´eviou¦y
 
this
 
®lowed
 
low”
 
v®ues
, 
but
hi 
v”siÚ
 
dÛs
 
	gnÙ


154 -- 
could
 
add
 
	gmt
.
	gdœ’t
.
	gšdex
[
tŞow”
(
k
)] = 
mt
.
dœ’t
.
šdex
[k] 
but
 
Ãed
 
to
 dØ
cÚsi¡’y
 
–£wh”e


155 
k
, 
v
 
š
 
	$·œs
(
c
.
DT
) do

156 
mt
.
dœ’t
.
šdex
[
k
] = 
	$funùiÚ
(
£lf
è s–f.
ty³
 =ğ
v
 
’d


157 
’d


159 
	`addty³
(
ty³s
, "dœ’t", "¡ruù dœ’t", 
mt
.
dœ’t
)

161 
mt
.
fd£t
 = {

162 
šdex
 = {

163 
fds_b™s
 = 
	`funùiÚ
(
£lf
è s–f.
__fds_b™s
 
’d
,

165 
	}
}

167 
addty³
(
ty³s
, "fd£t", "fd_£t", 
mt
.
fd£t
)

169 -- 
TODO
 
£e
 
Lšux
 
	gnÙes
. 
Also
 
maybe
 
ÿn
 
be
 
sh¬ed
 
w™h
 
	gBSDs
, 
have
 
nÙ
 
checked
 
	g´İ”ly


170 -- 
TODO
 
®so
 
»move
 
WIF
 
	g´efixes
.

171 
	gmt
.
	gwa™
 = {

172 
__šdex
 = 
funùiÚ
(
w
, 
k
)

173 
loÿl
 
	g_WSTATUS
 = 
b™
.
bªd
(
w
.
¡©us
, 
où®
("0177"))

174 
loÿl
 
	g_WSTOPPED
 = 
où®
("0177")

175 
loÿl
 
WTERMSIG
 = 
_WSTATUS


176 
loÿl
 
EXITSTATUS
 = 
b™
.
bªd
(b™.
rshiá
(
w
.
¡©us
, 8), 0xff)

177 
loÿl
 
	gWIFEXITED
 = (
_WSTATUS
 == 0)

178 
loÿl
 
b
 = {

179 
WIFEXITED
 = WIFEXITED,

180 
	gWIFSTOPPED
 = 
b™
.
bªd
(
w
.
¡©us
, 0xffè=ğ
_WSTOPPED
,

181 
	gWIFSIGNALED
 = 
_WSTATUS
 ~ğ
_WSTOPPED
 
ªd
 _WSTATUS ~= 0

183 
	gb
.
WIFEXITED
 
th’
ab.
	gEXITSTATUS
 = 
EXITSTATUS
 
’d


184 
b
.
WIFSTOPPED
 
th’
ab.
WSTOPSIG
 = 
EXITSTATUS
 
’d


185 
b
.
WIFSIGNALED
 
th’
ab.
WTERMSIG
 = WTERMSIG 
’d


186 
b
[
k
] 
th’
 ab[k] 
’d


187 
loÿl
 
uc
 = 'W' .. 
k
:
uµ”
()

188 
b
[
uc
] 
th’
 ab[uc] 
’d


189 
’d


192 
funùiÚ
 
t
.
	$wa™¡©us
(
¡©us
)

193  
	`£tm‘©abË
({
¡©us
 = 
	}
¡©us}, 
	gmt
.
	gwa™
)

194 
’d


196 
loÿl
 
	gsigÇmes
 = {}

197 
k
, 
v
 
š
 
	$·œs
(
c
.
SIG
) do

198 
sigÇmes
[
v
] = 
k


199 
’d


201 
mt
.
sigšfo
 = {

202 
šdex
 = {

203 
signo
 = 
	`funùiÚ
(
s
è s.
si_signo
 
’d
,

204 
”ºo
 = 
	`funùiÚ
(
s
è s.
si_”ºo
 
’d
,

205 
code
 = 
	`funùiÚ
(
s
è s.
si_code
 
’d
,

206 
pid
 = 
	`funùiÚ
(
s
è s.
si_pid
 
’d
,

207 
uid
 = 
	`funùiÚ
(
s
è s.
si_uid
 
’d
,

208 
¡©us
 = 
	`funùiÚ
(
s
è s.
si_¡©us
 
’d
,

209 
addr
 = 
	`funùiÚ
(
s
è s.
si_addr
 
’d
,

210 
v®ue
 = 
	`funùiÚ
(
s
è s.
si_v®ue
 
’d
,

211 
Œ­no
 = 
	`funùiÚ
(
s
è s.
_çuÉ
.
_Œ­no
 
’d
,

212 
tim”id
 = 
	`funùiÚ
(
s
è s.
_tim”
.
_tim”id
 
’d
,

213 
ov”run
 = 
	`funùiÚ
(
s
è s.
_tim”
.
_ov”run
 
’d
,

214 
mqd
 = 
	`funùiÚ
(
s
è s.
_mesgq
.
_mqd
 
’d
,

215 
bªd
 = 
	`funùiÚ
(
s
è s.
_pŞl
.
_bªd
 
’d
,

216 
sigÇme
 = 
	`funùiÚ
(
s
è 
sigÇmes
[s.
signo
] 
’d
,

218 
Ãwšdex
 = {

219 
signo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_signo
 = v 
’d
,

220 
”ºo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_”ºo
 = v 
’d
,

221 
code
 = 
	`funùiÚ
(
s
, 
v
ès.
si_code
 = v 
’d
,

222 
pid
 = 
	`funùiÚ
(
s
, 
v
ès.
si_pid
 = v 
’d
,

223 
uid
 = 
	`funùiÚ
(
s
, 
v
ès.
si_uid
 = v 
’d
,

224 
¡©us
 = 
	`funùiÚ
(
s
, 
v
ès.
si_¡©us
 = v 
’d
,

225 
addr
 = 
	`funùiÚ
(
s
, 
v
ès.
si_addr
 = v 
’d
,

226 
v®ue
 = 
	`funùiÚ
(
s
, 
v
ès.
si_v®ue
 = v 
’d
,

227 
Œ­no
 = 
	`funùiÚ
(
s
, 
v
ès.
_çuÉ
.
_Œ­no
 = v 
’d
,

228 
tim”id
 = 
	`funùiÚ
(
s
, 
v
ès.
_tim”
.
_tim”id
 = v 
’d
,

229 
ov”run
 = 
	`funùiÚ
(
s
, 
v
ès.
_tim”
.
_ov”run
 = v 
’d
,

230 
mqd
 = 
	`funùiÚ
(
s
, 
v
ès.
_mesgq
.
_mqd
 = v 
’d
,

231 
bªd
 = 
	`funùiÚ
(
s
, 
v
ès.
_pŞl
.
_bªd
 = v 
’d
,

233 
__Ën
 = 
Ënâ
,

234 
	}
}

236 
addty³
(
ty³s
, "sigšfo", "sigšfo_t", 
mt
.
sigšfo
)

238 -- 
	gsigaùiÚ
, 
¡ªd¬d
 
POSIX
 
behaviour
 
w™h
 
of
 
hªdËr
 
ªd
 
sigaùiÚ


239 
addty³_â
(
ty³s
, "sa_sigaction", "void (*)(int, siginfo_t *, void *)")

241 
	gmt
.
	gsigaùiÚ
 = {

242 
šdex
 = {

243 
hªdËr
 = 
funùiÚ
(
§
è sa.
__sigaùiÚ_u
.
__§_hªdËr
 
’d
,

244 
	gsigaùiÚ
 = 
funùiÚ
(
§
è sa.
__sigaùiÚ_u
.
__§_sigaùiÚ
 
’d
,

245 
	gmask
 = 
funùiÚ
(
§
è sa.
§_mask
 
’d
,

246 
	gæags
 = 
funùiÚ
(
§
è 
tÚumb”
(§.
§_æags
è
’d
,

248 
	gÃwšdex
 = {

249 
hªdËr
 = 
funùiÚ
(
§
, 
v
)

250 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


251 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


252 
§
.
__sigaùiÚ_u
.
__§_hªdËr
 = 
v


253 
’d
,

254 
	gsigaùiÚ
 = 
funùiÚ
(
§
, 
v
)

255 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


256 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


257 
§
.
__sigaùiÚ_u
.
__§_sigaùiÚ
 = 
v


258 
’d
,

259 
	gmask
 = 
funùiÚ
(
§
, 
v
)

260 
nÙ
 
	gffi
.
i¡y³
(
t
.
sig£t
, 
v
è
th’
 
	gv
 =.sig£t(vè
’d


261 
§
.
§_mask
 = 
v


262 
’d
,

263 
	gæags
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g§_æags
 = 
c
.
SA
[v] 
’d
,

265 
	g__Ãw
 = 
funùiÚ
(

, 
b
)

266 
loÿl
 
	g§
 = 
ffi
.
Ãw
(

)

267 
b
 
th’
 
k
, 
v
 
š
 
·œs
ÑabèdØ
	g§
[k] = v 
’d
ƒnd

268 
b
 
ªd
ab.
sigaùiÚ
 
th’
 
§
.
§_æags
 = 
b™
.
bÜ
(§.
æags
, 
c
.
SA
.
SIGINFO
è
	g’d
 -- 
this
 
æag
 
mu¡
 
be
 
£t
 sigaction set

269  
§


270 
	g’d
,

273 
addty³
(
ty³s
, "sigaùiÚ", "¡ruù sigaùiÚ", 
mt
.
sigaùiÚ
)

275  
ty³s


277 
’d


279  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/util.lua

1 -- 
O³nBSD
 
uts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
S
)

12 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

13 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

15 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

17 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
où®
 = 
h
.octal

21 
loÿl
 
ut
 = {
	}
}

23 
loÿl
 
mt
 = {}

26  
ut


28 
’d


30  {
š™
 = init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/version.lua

1 -- 
d‘eù
 
İ’bsd
 
v”siÚ


3 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

5 -- 
nÙ
 
Ú
 
O³nBSD
 
ju¡
  
mo¡
 
»ûÁ


6 
abi
.
os
 ~ğ"İ’bsd" 
th’
  {
v”siÚ
 = 201411} 
’d


8 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

10 
»quœe
 "syscall.ffitypes"

12 
ffi
.
cdef
 [[

13 
sysùl
(cÚ¡ *
Çme
, 
Çm–’
, *
Şdp
, 
size_t
 *
ŞdËÅ
, cÚ¡ *
Ãwp
, size_ˆ
ÃwËn
);

16 -- 
NÙe
 
has
 
b“n
 
‹¡ed
 
	gÚ
 5.4, 5.5, 5.6, 5.7

25 
loÿl
 
sc
 = 
ffi
.
Ãw
("št[2]", 1, 3è-- 
	gk”n
.
o¤ev


26 
loÿl
 
	go¤evisiÚ
 = 
ffi
.
Ãw
("int[1]")

27 
loÿl
 
ËÅ
 = 
ffi
.
Ãw
("unsigned†ong[1]", ffi.("int"))

28 
loÿl
 
	gok
, 
	g»s
 = 
ffi
.
C
.
	$sysùl
(
sc
, 2, 
o¤evisiÚ
, 
ËÅ
, 
n
, 0)

29 
nÙ
 
ok
 
Ü
 
»s
 =ğ-1 
th’
 
”rÜ
 "ÿÂÙ d‘”mš©İ’bsd v”siÚ" 
’d


31 
loÿl
 
v”siÚ
 = 
o¤evisiÚ
[0]

33  {
v”siÚ
 = 
	}
version}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/c.lua

1 -- 
This
 
£ts
 
up
 
the
 
bË
 
of
 
C
 
	gfunùiÚs


2 -- 
FÜ
 
OSX
 
we
 
hİe
 wdØ
nÙ
 
Ãed
 
mªy
 
ov”rides


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
voidp
 = 
ffi
.
ty³of
("void *")

17 
loÿl
 
funùiÚ
 (
x
)

18  
ffi
.
	$ÿ¡
(
voidp
, 
x
)

19 
’d


21 -- 
basiÿÎy
 
®l
 
ty³s
 
·s£d
 
to
 
sysÿÎs
 
¬e
 
Ü
 , 
so
 
we
 dØ
nÙ
 
Ãed
Ø
u£
 
niûly
 
Çmed
y³s, sØw
ÿn
 
avoid
 
impÜtšg
 
t
.

22 
loÿl
 , ğ
ffi
.
	`ty³of
("int"), ffi.typeof("long")

23 
loÿl
 
ušt
, 
ulÚg
 = 
ffi
.
	`ty³of
("unsigned int"), ffi.typeof("unsigned†ong")

25 
loÿl
 
funùiÚ
 
	$šlibc_â
(
k
è 
ffi
.
C
[k] 
’d


27 -- 
SysÿÎs
 
th©
 
ju¡
  
ENOSYS
 
but
 
¬e
 
š
 
libc
. 
NÙe
 
the£
 
might
 
v¬y
 
by
 
v”siÚ
 iÀ
futu»


28 
loÿl
 
nosys_ÿÎs
 = {

29 
mlock®l
 = 
Œue
,

30 
	}
}

32 
loÿl
 
	gC
 = 
£tm‘©abË
({}, {

33 
__šdex
 = 
funùiÚ
(
C
, 
k
)

34 
nosys_ÿÎs
[
k
] 
th’
  
n
 
’d


35 
pÿÎ
(
šlibc_â
, 
k
è
th’


36 
C
[
k
] = 
ffi
.C[k] -- 
add
 
to
 
bË
, 
so
 
no
 
Ãed
 
this
 
¦ow
 
·th
 
agaš


37  
C
[
k
]

39  
n


40 
’d


41 
’d


44 -- 
Ãw
 
¡©
 
	g¡ruùu»
, 
g‘
 
Ëgacy
 
	gÚe
; 
could
 
u£
 
sysÿÎs
 
	gš¡—d


45 -- 
dÛs
 
nÙ
 
wÜk
 
f¡©©


46 
	gC
.
	g¡©
 = 
C
.
¡©64


47 
C
.
f¡©
 = C.
f¡©64


48 
C
.
l¡©
 = C.
l¡©64


50 -- 
TODO
 
ü—‹
 
sysÿÎ
 
bË
. 
Exû±
 
I
 
ÿÂÙ
 
fšd
 
how
 
to
 
ÿÎ
 
them
, 
Ã™h”
 
	gC
.sysÿÎ 
nÜ
 C.
_sysÿÎ
 
£ems
Ø
	gexi¡


52 
loÿl
 
g‘dœ’Œ›s
 = 196

53 
loÿl
 
g‘dœ’Œ›s64
 = 344

55 
funùiÚ
 
C
.
	$g‘dœ’Œ›s
(
fd
, 
buf
, 
Ën
, 
ba£p
)

56  
C
.
	`_sysÿÎ
(
g‘dœ’Œ›s64
, (
fd
), (
buf
), (
Ën
), (
ba£p
))

57 
’d


60 -- 
ÿÂÙ
 
fšd
 
the£
 
ªywh”e
! 
Aµ¬’y
 
nÙ
 
th”e
 
sšû
 64 
b™
 
šodes
?

61 --
C
.
g‘dœ’Œ›s
 = 
ffi
.C.
_g‘dœ’Œ›s


62 --
C
.
sigaùiÚ
 = 
ffi
.C.
_sigaùiÚ


64  
C


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/constants.lua

1 -- 
bËs
 
of
 
cÚ¡ªts
 
OSX


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gh
 = 
»quœe
 "syscall.helpers"

12 
loÿl
 
où®
, 
	gmuÉiæags
, 
	gch¬æags
, 
	gsw­æags
, 
	g¡ræag
, 
	g©æag
, 
	gmodeæags


13 ğ
h
.
où®
, 
	gh
.
	gmuÉiæags
, h.
	gch¬æags
, h.
	gsw­æags
, h.
	g¡ræag
, h.
	g©æag
, h.
modeæags


15 
loÿl
 
	gc
 = {}

17 
c
.
”rÜÇmes
 = 
»quœe
 "syscall.osx.errors"

19 
c
.
STD
 = 
¡ræag
 {

20 
IN_FILENO
 = 0,

21 
	gOUT_FILENO
 = 1,

22 
	gERR_FILENO
 = 2,

23 
	gIN
 = 0,

24 
	gOUT
 = 1,

25 
	gERR
 = 2,

28 
	gc
.
	gPATH_MAX
 = 1024

30 
c
.
E
 = 
¡ræag
 {

31 
PERM
 = 1,

32 
	gNOENT
 = 2,

33 
	gSRCH
 = 3,

34 
	gINTR
 = 4,

35 
	gIO
 = 5,

36 
	gNXIO
 = 6,

38 
	gNOEXEC
 = 8,

39 
	gBADF
 = 9,

40 
	gCHILD
 = 10,

41 
	gDEADLK
 = 11,

42 
	gNOMEM
 = 12,

43 
	gACCES
 = 13,

44 
	gFAULT
 = 14,

45 
	gNOTBLK
 = 15,

46 
	gBUSY
 = 16,

47 
	gEXIST
 = 17,

48 
	gXDEV
 = 18,

49 
	gNODEV
 = 19,

50 
	gNOTDIR
 = 20,

51 
	gISDIR
 = 21,

52 
	gINVAL
 = 22,

53 
	gNFILE
 = 23,

54 
	gMFILE
 = 24,

55 
	gNOTTY
 = 25,

56 
	gTXTBSY
 = 26,

57 
	gFBIG
 = 27,

58 
	gNOSPC
 = 28,

59 
	gSPIPE
 = 29,

60 
	gROFS
 = 30,

61 
	gMLINK
 = 31,

62 
	gPIPE
 = 32,

63 
	gDOM
 = 33,

64 
	gRANGE
 = 34,

65 
	gAGAIN
 = 35,

66 
	gINPROGRESS
 = 36,

67 
	gALREADY
 = 37,

68 
	gNOTSOCK
 = 38,

69 
	gDESTADDRREQ
 = 39,

70 
	gMSGSIZE
 = 40,

71 
	gPROTOTYPE
 = 41,

72 
	gNOPROTOOPT
 = 42,

73 
	gPROTONOSUPPORT
= 43,

74 
	gSOCKTNOSUPPORT
= 44,

75 
	gOPNOTSUPP
 = 45,

76 
	gPFNOSUPPORT
 = 46,

77 
	gAFNOSUPPORT
 = 47,

78 
	gADDRINUSE
 = 48,

79 
	gADDRNOTAVAIL
 = 49,

80 
	gNETDOWN
 = 50,

81 
	gNETUNREACH
 = 51,

82 
	gNETRESET
 = 52,

83 
	gCONNABORTED
 = 53,

84 
	gCONNRESET
 = 54,

85 
	gNOBUFS
 = 55,

86 
	gISCONN
 = 56,

87 
	gNOTCONN
 = 57,

88 
	gSHUTDOWN
 = 58,

89 
	gTOOMANYREFS
 = 59,

90 
	gTIMEDOUT
 = 60,

91 
	gCONNREFUSED
 = 61,

92 
	gLOOP
 = 62,

93 
	gNAMETOOLONG
 = 63,

94 
	gHOSTDOWN
 = 64,

95 
	gHOSTUNREACH
 = 65,

96 
	gNOTEMPTY
 = 66,

97 
	gPROCLIM
 = 67,

98 
	gUSERS
 = 68,

99 
	gDQUOT
 = 69,

100 
	gSTALE
 = 70,

101 
	gREMOTE
 = 71,

102 
	gBADRPC
 = 72,

103 
	gRPCMISMATCH
 = 73,

104 
	gPROGUNAVAIL
 = 74,

105 
	gPROGMISMATCH
 = 75,

106 
	gPROCUNAVAIL
 = 76,

107 
	gNOLCK
 = 77,

108 
	gNOSYS
 = 78,

109 
	gFTYPE
 = 79,

110 
	gAUTH
 = 80,

111 
	gNEEDAUTH
 = 81,

112 
	gIDRM
 = 82,

113 
	gNOMSG
 = 83,

114 
	gOVERFLOW
 = 84,

115 
	gBADEXEC
 = 85,

116 
	gBADARCH
 = 86,

117 
	gSHLIBVERS
 = 87,

118 
	gBADMACHO
 = 88,

119 
	gCANCELED
 = 89,

120 
	gIDRM
 = 90,

121 
	gNOMSG
 = 91,

122 
	gILSEQ
 = 92,

123 
	gNOATTR
 = 93,

124 
	gBADMSG
 = 94,

125 
	gMULTIHOP
 = 95,

126 
	gNODATA
 = 96,

127 
	gNOLINK
 = 97,

128 
	gNOSR
 = 98,

129 
	gNOSTR
 = 99,

130 
	gPROTO
 = 100,

131 
	gTIME
 = 101,

132 
	gOPNOTSUPP
 = 102,

133 
	gNOPOLICY
 = 103,

134 
	gNOTRECOVERABLE
= 104,

135 
	gOWNERDEAD
 = 105,

136 
	gQFULL
 = 106,

139 -- 
®‹º©e
 
Çmes


140 
	gc
.
	gEALIAS
 = {

141 
WOULDBLOCK
 = 
c
.
E
.
AGAIN
,

142 
	gDEADLOCK
 = 
c
.
E
.
EDEADLK
,

145 
	gc
.
	gAF
 = 
¡ræag
 {

146 
UNSPEC
 = 0,

147 
	gLOCAL
 = 1,

148 
	gINET
 = 2,

149 
	gIMPLINK
 = 3,

150 
	gPUP
 = 4,

151 
	gCHAOS
 = 5,

152 
	gNS
 = 6,

153 
	gISO
 = 7,

154 
	gECMA
 = 8,

155 
	gDATAKIT
 = 9,

156 
	gCCITT
 = 10,

157 
	gSNA
 = 11,

158 
	gDECNET
 = 12,

159 
	gDLI
 = 13,

160 
	gLAT
 = 14,

161 
	gHYLINK
 = 15,

162 
	gAPPLETALK
 = 16,

163 
	gROUTE
 = 17,

164 
	gLINK
 = 18,

165 
	gCOIP
 = 20,

166 
	gCNT
 = 21,

167 
	gIPX
 = 23,

168 
	gSIP
 = 24,

169 
	gNDRV
 = 27,

170 
	gISDN
 = 28,

171 
	gINET6
 = 30,

172 
	gNATM
 = 31,

173 
	gSYSTEM
 = 32,

174 
	gNETBIOS
 = 33,

175 
	gPPP
 = 34,

178 
	gc
.
	gAF
.
	gUNIX
 = 
c
.
AF
.
LOCAL


179 
c
.
AF
.
OSI
 = c.AF.
ISO


180 
c
.
AF
.
E164
 = c.AF.
ISDN


182 
c
.
O
 = 
muÉiæags
 {

183 
RDONLY
 = 0x0000,

184 
	gWRONLY
 = 0x0001,

185 
	gRDWR
 = 0x0002,

186 
	gACCMODE
 = 0x0003,

187 
	gNONBLOCK
 = 0x0004,

188 
	gAPPEND
 = 0x0008,

189 
	gSHLOCK
 = 0x0010,

190 
	gEXLOCK
 = 0x0020,

191 
	gASYNC
 = 0x0040,

192 
	gSYNC
 = 0x0080,

193 
	gNOFOLLOW
 = 0x0100,

194 
	gCREAT
 = 0x0200,

195 
	gTRUNC
 = 0x0400,

196 
	gEXCL
 = 0x0800,

197 
	gEVTONLY
 = 0x8000,

198 
	gNOCTTY
 = 0x20000,

199 
	gDIRECTORY
 = 0x100000,

200 
	gDSYNC
 = 0x400000,

201 
	gCLOEXEC
 = 0x1000000,

204 -- 
	gsigaùiÚ
, 
nÙe
 
»Çmed
 
SIGACT
 
äom
 
SIG_


205 
	gc
.
	gSIGACT
 = 
¡ræag
 {

206 
ERR
 = -1,

207 
	gDFL
 = 0,

208 
	gIGN
 = 1,

209 
	gHOLD
 = 5,

212 
	gc
.
	gSIG
 = 
¡ræag
 {

213 
HUP
 = 1,

214 
	gINT
 = 2,

215 
	gQUIT
 = 3,

216 
	gILL
 = 4,

217 
	gTRAP
 = 5,

218 
	gABRT
 = 6,

219 
	gEMT
 = 7,

220 
	gFPE
 = 8,

221 
	gKILL
 = 9,

222 
	gBUS
 = 10,

223 
	gSEGV
 = 11,

224 
	gSYS
 = 12,

225 
	gPIPE
 = 13,

226 
	gALRM
 = 14,

227 
	gTERM
 = 15,

228 
	gURG
 = 16,

229 
	gSTOP
 = 17,

230 
	gTSTP
 = 18,

231 
	gCONT
 = 19,

232 
	gCHLD
 = 20,

233 
	gTTIN
 = 21,

234 
	gTTOU
 = 22,

235 
	gIO
 = 23,

236 
	gXCPU
 = 24,

237 
	gXFSZ
 = 25,

238 
	gVTALRM
 = 26,

239 
	gPROF
 = 27,

240 
	gWINCH
 = 28,

241 
	gINFO
 = 29,

242 
	gUSR1
 = 30,

243 
	gUSR2
 = 31,

246 -- 
sig´ocmask
 
nÙe
 
»Çmšg
 
of
 
SIG
 
to
 
SIGPM


247 
	gc
.
	gSIGPM
 = 
¡ræag
 {

248 
BLOCK
 = 1,

249 
	gUNBLOCK
 = 2,

250 
	gSETMASK
 = 3,

253 
	gc
.
	gSA
 = 
muÉiæags
 {

254 
ONSTACK
 = 0x0001,

255 
	gRESTART
 = 0x0002,

256 
	gRESETHAND
 = 0x0004,

257 
	gNOCLDSTOP
 = 0x0008,

258 
	gNODEFER
 = 0x0010,

259 
	gNOCLDWAIT
 = 0x0020,

260 
	gUSERTRAMP
 = 0x0100,

264 
	gc
.
	gEXIT
 = 
¡ræag
 {

265 
SUCCESS
 = 0,

266 
	gFAILURE
 = 1,

269 
	gc
.
	gOK
 = 
ch¬æags
 {

270 
R
 = 4,

271 
	gW
 = 2,

272 
	gX
 = 1,

273 
	gF
 = 0,

276 
	gc
.
	gMODE
 = 
modeæags
 {

277 
SUID
 = 
où®
('04000'),

278 
	gSGID
 = 
où®
('02000'),

279 
	gSTXT
 = 
où®
('01000'),

280 
	gRWXU
 = 
où®
('00700'),

281 
	gRUSR
 = 
où®
('00400'),

282 
	gWUSR
 = 
où®
('00200'),

283 
	gXUSR
 = 
où®
('00100'),

284 
	gRWXG
 = 
où®
('00070'),

285 
	gRGRP
 = 
où®
('00040'),

286 
	gWGRP
 = 
où®
('00020'),

287 
	gXGRP
 = 
où®
('00010'),

288 
	gRWXO
 = 
où®
('00007'),

289 
	gROTH
 = 
où®
('00004'),

290 
	gWOTH
 = 
où®
('00002'),

291 
	gXOTH
 = 
où®
('00001'),

294 
	gc
.
	gSEEK
 = 
¡ræag
 {

295 
SET
 = 0,

296 
	gCUR
 = 1,

297 
	gEND
 = 2,

300 
	gc
.
	gSOCK
 = 
¡ræag
 {

301 
STREAM
 = 1,

302 
	gDGRAM
 = 2,

303 
	gRAW
 = 3,

304 
	gRDM
 = 4,

305 
	gSEQPACKET
 = 5,

308 
	gc
.
	gSOL
 = 
¡ræag
 {

309 
LOCAL
 = 0,

310 
	gSOCKET
 = 0xffff,

313 
	gc
.
	gIPPROTO
 = 
¡ræag
 {

314 
IP
 = 0,

315 
	gHOPOPTS
 = 0,

316 
	gICMP
 = 1,

317 
	gIGMP
 = 2,

318 
	gGGP
 = 3,

319 
	gIPV4
 = 4,

320 
	gIPIP
 = 4,

321 
	gTCP
 = 6,

322 
	gST
 = 7,

323 
	gEGP
 = 8,

324 
	gPIGP
 = 9,

325 
	gRCCMON
 = 10,

326 
	gNVPII
 = 11,

327 
	gPUP
 = 12,

328 
	gARGUS
 = 13,

329 
	gEMCON
 = 14,

330 
	gXNET
 = 15,

331 
	gCHAOS
 = 16,

332 
	gUDP
 = 17,

333 
	gMUX
 = 18,

334 
	gMEAS
 = 19,

335 
	gHMP
 = 20,

336 
	gPRM
 = 21,

337 
	gIDP
 = 22,

338 
	gTRUNK1
 = 23,

339 
	gTRUNK2
 = 24,

340 
	gLEAF1
 = 25,

341 
	gLEAF2
 = 26,

342 
	gRDP
 = 27,

343 
	gIRTP
 = 28,

344 
	gTP
 = 29,

345 
	gBLT
 = 30,

346 
	gNSP
 = 31,

347 
	gINP
 = 32,

348 
	gSEP
 = 33,

350 
	gIDPR
 = 35,

351 
	gXTP
 = 36,

352 
	gDDP
 = 37,

353 
	gCMTP
 = 38,

354 
	gTPXX
 = 39,

355 
	gIL
 = 40,

356 
	gIPV6
 = 41,

357 
	gSDRP
 = 42,

358 
	gROUTING
 = 43,

359 
	gFRAGMENT
 = 44,

360 
	gIDRP
 = 45,

361 
	gRSVP
 = 46,

362 
	gGRE
 = 47,

363 
	gMHRP
 = 48,

364 
	gBHA
 = 49,

365 
	gESP
 = 50,

366 
	gAH
 = 51,

367 
	gINLSP
 = 52,

368 
	gSWIPE
 = 53,

369 
	gNHRP
 = 54,

370 
	gICMPV6
 = 58,

371 
	gNONE
 = 59,

372 
	gDSTOPTS
 = 60,

373 
	gAHIP
 = 61,

374 
	gCFTP
 = 62,

375 
	gHELLO
 = 63,

376 
	gSATEXPAK
 = 64,

377 
	gKRYPTOLAN
 = 65,

378 
	gRVD
 = 66,

379 
	gIPPC
 = 67,

380 
	gADFS
 = 68,

381 
	gSATMON
 = 69,

382 
	gVISA
 = 70,

383 
	gIPCV
 = 71,

384 
	gCPNX
 = 72,

385 
	gCPHB
 = 73,

386 
	gWSN
 = 74,

387 
	gPVP
 = 75,

388 
	gBRSATMON
 = 76,

389 
	gND
 = 77,

390 
	gWBMON
 = 78,

391 
	gWBEXPAK
 = 79,

392 
	gEON
 = 80,

393 
	gVMTP
 = 81,

394 
	gSVMTP
 = 82,

395 
	gVINES
 = 83,

396 
	gTTP
 = 84,

397 
	gIGP
 = 85,

398 
	gDGP
 = 86,

399 
	gTCF
 = 87,

400 
	gIGRP
 = 88,

401 
	gOSPFIGP
 = 89,

402 
	gSRPC
 = 90,

403 
	gLARP
 = 91,

404 
	gMTP
 = 92,

405 
	gAX25
 = 93,

406 
	gIPEIP
 = 94,

407 
	gMICP
 = 95,

408 
	gSCCSP
 = 96,

409 
	gETHERIP
 = 97,

410 
	gENCAP
 = 98,

411 
	gAPES
 = 99,

412 
	gGMTP
 = 100,

413 
	gPIM
 = 103,

414 
	gIPCOMP
 = 108,

415 
	gPGM
 = 113,

416 
	gSCTP
 = 132,

417 
	gDIVERT
 = 254,

418 
	gRAW
 = 255,

421 
	gc
.
	gMSG
 = 
muÉiæags
 {

422 
OOB
 = 0x1,

423 
	gPEEK
 = 0x2,

424 
	gDONTROUTE
 = 0x4,

425 
	gEOR
 = 0x8,

426 
	gTRUNC
 = 0x10,

427 
	gCTRUNC
 = 0x20,

428 
	gWAITALL
 = 0x40,

429 
	gDONTWAIT
 = 0x80,

430 
	gEOF
 = 0x100,

431 
	gWAITSTREAM
 = 0x200,

432 
	gFLUSH
 = 0x400,

433 
	gHOLD
 = 0x800,

434 
	gSEND
 = 0x1000,

435 
	gHAVEMORE
 = 0x2000,

436 
	gRCVMORE
 = 0x4000,

437 
	gNEEDSA
 = 0x10000,

440 
	gc
.
	gF
 = 
¡ræag
 {

441 
DUPFD
 = 0,

442 
	gGETFD
 = 1,

443 
	gSETFD
 = 2,

444 
	gGETFL
 = 3,

445 
	gSETFL
 = 4,

446 
	gGETOWN
 = 5,

447 
	gSETOWN
 = 6,

448 
	gGETLK
 = 7,

449 
	gSETLK
 = 8,

450 
	gSETLKW
 = 9,

451 
	gFLUSH_DATA
 = 40,

452 
	gCHKCLEAN
 = 41,

453 
	gPREALLOCATE
 = 42,

454 
	gSETSIZE
 = 43,

455 
	gRDADVISE
 = 44,

456 
	gRDAHEAD
 = 45,

457 
	gREADBOOTSTRAP
= 46,

458 
	gWRITEBOOTSTRAP
= 47,

459 
	gNOCACHE
 = 48,

460 
	gLOG2PHYS
 = 49,

461 
	gGETPATH
 = 50,

462 
	gFULLFSYNC
 = 51,

463 
	gPATHPKG_CHECK
= 52,

464 
	gFREEZE_FS
 = 53,

465 
	gTHAW_FS
 = 54,

466 
	gGLOBAL_NOCACHE
= 55,

467 
	gADDSIGS
 = 59,

468 
	gMARKDEPENDENCY
= 60,

469 
	gADDFILESIGS
 = 61,

470 
	gNODIRECT
 = 62,

471 
	gGETPROTECTIONCLASS
 = 63,

472 
	gSETPROTECTIONCLASS
 = 64,

473 
	gLOG2PHYS_EXT
= 65,

474 
	gGETLKPID
 = 66,

475 
	gDUPFD_CLOEXEC
 = 67,

476 
	gSETBACKINGSTORE
 = 70,

477 
	gGETPATH_MTMINFO
 = 71,

478 
	gSETNOSIGPIPE
 = 73,

479 
	gGETNOSIGPIPE
 = 74,

480 
	gTRANSCODEKEY
 = 75,

481 
	gSINGLE_WRITER
 = 76,

482 
	gGETPROTECTIONLEVEL
 = 77,

485 
	gc
.
	gFD
 = 
muÉiæags
 {

486 
CLOEXEC
 = 1,

489 -- 
nÙe
 
chªged
 
äom
 
F_
 
to
 
FCNTL_LOCK


490 
	gc
.
	gFCNTL_LOCK
 = 
¡ræag
 {

491 
RDLCK
 = 1,

492 
	gUNLCK
 = 2,

493 
	gWRLCK
 = 3,

496 -- 
	glockf
, 
chªged
 
äom
 
F_
 
to
 
LOCKF_


497 
	gc
.
	gLOCKF
 = 
¡ræag
 {

498 
ULOCK
 = 0,

499 
	gLOCK
 = 1,

500 
	gTLOCK
 = 2,

501 
	gTEST
 = 3,

504 -- 
	$æock
 (2)

505 
c
.
LOCK
 = 
muÉiæags
 {

506 
SH
 = 0x01,

507 
EX
 = 0x02,

508 
NB
 = 0x04,

509 
UN
 = 0x08,

510 
	}
}

512 
	gc
.
	gW
 = 
muÉiæags
 {

513 
NOHANG
 = 0x00000001,

514 
	gUNTRACED
 = 0x00000002,

515 
	gEXITED
 = 0x00000004,

516 
	gSTOPPED
 = 0x00000008,

517 
	gCONTINUED
 = 0x00000010,

518 
	gNOWAIT
 = 0x00000020,

521 
	gc
.
	gS_I
 = 
modeæags
 {

522 
FMT
 = 
où®
('0170000'),

523 
	gFSOCK
 = 
où®
('0140000'),

524 
	gFLNK
 = 
où®
('0120000'),

525 
	gFREG
 = 
où®
('0100000'),

526 
	gFBLK
 = 
où®
('0060000'),

527 
	gFDIR
 = 
où®
('0040000'),

528 
	gFCHR
 = 
où®
('0020000'),

529 
	gFIFO
 = 
où®
('0010000'),

530 
	gSUID
 = 
où®
('0004000'),

531 
	gSGID
 = 
où®
('0002000'),

532 
	gSTXT
 = 
où®
('0001000'),

533 
	gRWXU
 = 
où®
('00700'),

534 
	gRUSR
 = 
où®
('00400'),

535 
	gWUSR
 = 
où®
('00200'),

536 
	gXUSR
 = 
où®
('00100'),

537 
	gRWXG
 = 
où®
('00070'),

538 
	gRGRP
 = 
où®
('00040'),

539 
	gWGRP
 = 
où®
('00020'),

540 
	gXGRP
 = 
où®
('00010'),

541 
	gRWXO
 = 
où®
('00007'),

542 
	gROTH
 = 
où®
('00004'),

543 
	gWOTH
 = 
où®
('00002'),

544 
	gXOTH
 = 
où®
('00001'),

547 
	gc
.
	gSOMAXCONN
 = 128

549 
c
.
SHUT
 = 
¡ræag
 {

550 
RD
 = 0,

551 
	gWR
 = 1,

552 
	gRDWR
 = 2,

555 
	gc
.
	gDT
 = 
¡ræag
 {

556 
UNKNOWN
 = 0,

557 
	gFIFO
 = 1,

558 
	gCHR
 = 2,

559 
	gDIR
 = 4,

560 
	gBLK
 = 6,

561 
	gREG
 = 8,

562 
	gLNK
 = 10,

563 
	gSOCK
 = 12,

564 
	gWHT
 = 14,

567 -- 
pŞl


568 
	gc
.
	gPOLL
 = 
muÉiæags
 {

569 
IN
 = 0x001,

570 
	gPRI
 = 0x002,

571 
	gOUT
 = 0x004,

572 
	gWRNORM
 = 0x004,

573 
	gERR
 = 0x008,

574 
	gHUP
 = 0x010,

575 
	gNVAL
 = 0x020,

576 
	gRDNORM
 = 0x040,

577 
	gRDBAND
 = 0x080,

578 
	gWRBAND
 = 0x100,

579 
	gEXTEND
 = 0x200,

580 
	gATTRIB
 = 0x400,

581 
	gNLINK
 = 0x800,

582 
	gWRITE
 = 0x1000,

585 --
mm­


586 
	gc
.
	gPROT
 = 
muÉiæags
 {

587 
NONE
 = 0x0,

588 
	gREAD
 = 0x1,

589 
	gWRITE
 = 0x2,

590 
	gEXEC
 = 0x4,

593 -- 
Sh¬šg
 
ty³s


594 
	gc
.
	gMAP
 = 
muÉiæags
 {

595 
FILE
 = 0x0000,

596 
	gSHARED
 = 0x0001,

597 
	gPRIVATE
 = 0x0002,

598 
	gFIXED
 = 0x0010,

599 
	gRENAME
 = 0x0020,

600 
	gNORESERVE
 = 0x0040,

601 
	gNOEXTEND
 = 0x0100,

602 
	gHASSEMAPHORE
 = 0x0200,

603 
	gNOCACHE
 = 0x0400,

604 
	gJIT
 = 0x0800,

605 
	gANON
 = 0x1000,

608 
	gc
.
	gMCL
 = 
¡ræag
 {

609 
CURRENT
 = 0x01,

610 
	gFUTURE
 = 0x02,

613 -- 
æags
 
	gto
 `
	gmsync
'. -‚ote was MS_„enamedo MSYNC_

614 
	gc
.
	gMSYNC
 = 
muÉiæags
 {

615 
ASYNC
 = 0x0001,

616 
	gINVALIDATE
 = 0x0002,

617 
	gSYNC
 = 0x0010,

620 
	gc
.
	gMADV
 = 
¡ræag
 {

621 
NORMAL
 = 0,

622 
	gRANDOM
 = 1,

623 
	gSEQUENTIAL
 = 2,

624 
	gWILLNEED
 = 3,

625 
	gDONTNEED
 = 4,

626 
	gFREE
 = 5,

627 
	gZERO_WIRED_PAGES
 = 6,

628 
	gFREE_REUSABLE
 = 7,

629 
	gFREE_REUSE
 = 8,

630 
	gCAN_REUSE
 = 9,

633 -- 
Baud
 
¿‹s
 
ju¡
 
the
 
id’t™y
 
funùiÚ


634 
	gc
.
	gB
 = 
¡ræag
 {}

636 
c
.
CC
 = 
¡ræag
 {

637 
VEOF
 = 0,

638 
	gVEOL
 = 1,

639 
	gVEOL2
 = 2,

640 
	gVERASE
 = 3,

641 
	gVWERASE
 = 4,

642 
	gVKILL
 = 5,

643 
	gVREPRINT
 = 6,

644 
	gVINTR
 = 8,

645 
	gVQUIT
 = 9,

646 
	gVSUSP
 = 10,

647 
	gVDSUSP
 = 11,

648 
	gVSTART
 = 12,

649 
	gVSTOP
 = 13,

650 
	gVLNEXT
 = 14,

651 
	gVDISCARD
 = 15,

652 
	gVMIN
 = 16,

653 
	gVTIME
 = 17,

654 
	gVSTATUS
 = 18,

657 
	gc
.
	gIFLAG
 = 
muÉiæags
 {

658 
IGNBRK
 = 0x00000001,

659 
	gBRKINT
 = 0x00000002,

660 
	gIGNPAR
 = 0x00000004,

661 
	gPARMRK
 = 0x00000008,

662 
	gINPCK
 = 0x00000010,

663 
	gISTRIP
 = 0x00000020,

664 
	gINLCR
 = 0x00000040,

665 
	gIGNCR
 = 0x00000080,

666 
	gICRNL
 = 0x00000100,

667 
	gIXON
 = 0x00000200,

668 
	gIXOFF
 = 0x00000400,

669 
	gIXANY
 = 0x00000800,

670 
	gIMAXBEL
 = 0x00002000,

673 
	gc
.
	gOFLAG
 = 
muÉiæags
 {

674 
OPOST
 = 0x00000001,

675 
	gONLCR
 = 0x00000002,

676 
	gOXTABS
 = 0x00000004,

677 
	gONOEOT
 = 0x00000008,

678 
	gOCRNL
 = 0x00000010,

679 
	gONOCR
 = 0x00000020,

680 
	gONLRET
 = 0x00000040,

683 
	gc
.
	gCFLAG
 = 
muÉiæags
 {

684 
CIGNORE
 = 0x00000001,

685 
	gCSIZE
 = 0x00000300,

686 
	gCS5
 = 0x00000000,

687 
	gCS6
 = 0x00000100,

688 
	gCS7
 = 0x00000200,

689 
	gCS8
 = 0x00000300,

690 
	gCSTOPB
 = 0x00000400,

691 
	gCREAD
 = 0x00000800,

692 
	gPARENB
 = 0x00001000,

693 
	gPARODD
 = 0x00002000,

694 
	gHUPCL
 = 0x00004000,

695 
	gCLOCAL
 = 0x00008000,

696 
	gCCTS_OFLOW
 = 0x00010000,

697 
	gCRTS_IFLOW
 = 0x00020000,

698 
	gCDTR_IFLOW
 = 0x00040000,

699 
	gCDSR_OFLOW
 = 0x00080000,

700 
	gCCAR_OFLOW
 = 0x00100000,

703 
	gc
.
	gCFLAG
.
	gCRTSCTS
 = 
c
.
CFLAG
.
CCTS_OFLOW
 + c.CFLAG.
CRTS_IFLOW


705 
c
.
LFLAG
 = 
muÉiæags
 {

706 
ECHOKE
 = 0x00000001,

707 
	gECHOE
 = 0x00000002,

708 
	gECHOK
 = 0x00000004,

709 
	gECHO
 = 0x00000008,

710 
	gECHONL
 = 0x00000010,

711 
	gECHOPRT
 = 0x00000020,

712 
	gECHOCTL
 = 0x00000040,

713 
	gISIG
 = 0x00000080,

714 
	gICANON
 = 0x00000100,

715 
	gALTWERASE
 = 0x00000200,

716 
	gIEXTEN
 = 0x00000400,

717 
	gEXTPROC
 = 0x00000800,

718 
	gTOSTOP
 = 0x00400000,

719 
	gFLUSHO
 = 0x00800000,

720 
	gNOKERNINFO
 = 0x02000000,

721 
	gPENDIN
 = 0x20000000,

722 
	gNOFLSH
 = 0x80000000,

725 
	gc
.
	gTCSA
 = 
muÉiæags
 { -- 
this
 
is
 
ªÙh”
 
odd
 
Úe
, 
wh”e
 
you
 
ÿn
 
have
 oÃ 
æag
 
¶us
 
SOFT


726 
NOW
 = 0,

727 
	gDRAIN
 = 1,

728 
	gFLUSH
 = 2,

729 
	gSOFT
 = 0x10,

732 -- 
tcæush
(), 
»Çmed
 
äom
 
TC
 
to
 
TCFLUSH


733 
	gc
.
	gTCFLUSH
 = 
¡ræag
 {

734 
IFLUSH
 = 1,

735 
	gOFLUSH
 = 2,

736 
	gIOFLUSH
 = 3,

739 -- 
	g‹rmios
 - 
	$tcæow
(è
ªd
 
TCXONC
 
u£
 
the£
. 
»Çmed
 
äom
 
TC
 
to
 
TCFLOW


740 
c
.
TCFLOW
 = 
¡ræag
 {

741 
OOFF
 = 1,

742 
OON
 = 2,

743 
IOFF
 = 3,

744 
ION
 = 4,

745 
	}
}

747 -- 
wa™pid
 
ªd
 
wa™4
 
pid


748 
	gc
.
	gWAIT
 = 
¡ræag
 {

749 
ANY
 = -1,

750 
	gMYPGRP
 = 0,

753 -- 
	gg‘´iÜ™y
, 
£riÜ™y
 
æags


754 
	gc
.
	gPRIO
 = 
¡ræag
 {

755 
PROCESS
 = 0,

756 
	gPGRP
 = 1,

757 
	gUSER
 = 2,

758 
	gMIN
 = -20, -- 
TODO
 
u£ful
 
to
 
have
 
Ùh”
 
OSs


759 
	gMAX
 = 20,

762 
	gc
.
	gRUSAGE
 = 
¡ræag
 {

763 
SELF
 = 0,

764 
	gCHILDREN
 = -1,

767 
	gc
.
	gPC
 = 
¡ræag
 {

768 
LINK_MAX
 = 1,

769 
	gMAX_CANON
 = 2,

770 
	gMAX_INPUT
 = 3,

771 
	gNAME_MAX
 = 4,

772 
	gPATH_MAX
 = 5,

773 
	gPIPE_BUF
 = 6,

774 
	gCHOWN_RESTRICTED
 = 7,

775 
	gNO_TRUNC
 = 8,

776 
	gVDISABLE
 = 9,

777 
	gNAME_CHARS_MAX
 = 10,

778 
	gCASE_SENSITIVE
 = 11,

779 
	gCASE_PRESERVING
 = 12,

780 
	gEXTENDED_SECURITY_NP
 = 13,

781 
	gAUTH_OPAQUE_NP
 = 14,

783 
	gALLOC_SIZE_MIN
 = 16,

784 
	gASYNC_IO
 = 17,

785 
	gFILESIZEBITS
 = 18,

786 
	gPRIO_IO
 = 19,

787 
	gREC_INCR_XFER_SIZE
= 20,

788 
	gREC_MAX_XFER_SIZE
 = 21,

789 
	gREC_MIN_XFER_SIZE
 = 22,

790 
	gREC_XFER_ALIGN
 = 23,

791 
	gSYMLINK_MAX
 = 24,

792 
	gSYNC_IO
 = 25,

793 
	gXATTR_SIZE_BITS
 = 26,

796 
	gc
.
	gSO
 = 
¡ræag
 {

797 
DEBUG
 = 0x0001,

798 
	gACCEPTCONN
 = 0x0002,

799 
	gREUSEADDR
 = 0x0004,

800 
	gKEEPALIVE
 = 0x0008,

801 
	gDONTROUTE
 = 0x0010,

802 
	gBROADCAST
 = 0x0020,

803 
	gUSELOOPBACK
 = 0x0040,

804 
	gLINGER
 = 0x0080,

805 
	gOOBINLINE
 = 0x0100,

806 
	gREUSEPORT
 = 0x0200,

807 
	gTIMESTAMP
 = 0x0400,

808 
	gTIMESTAMP_MONOTONIC
 = 0x0800,

809 
	gDONTTRUNC
 = 0x2000,

810 
	gWANTMORE
 = 0x4000,

811 
	gWANTOOBFLAG
 = 0x8000,

812 
	gSNDBUF
 = 0x1001,

813 
	gRCVBUF
 = 0x1002,

814 
	gSNDLOWAT
 = 0x1003,

815 
	gRCVLOWAT
 = 0x1004,

816 
	gSNDTIMEO
 = 0x1005,

817 
	gRCVTIMEO
 = 0x1006,

818 
	gERROR
 = 0x1007,

819 
	gTYPE
 = 0x1008,

820 
	gLABEL
 = 0x1010,

821 
	gPEERLABEL
 = 0x1011,

822 
	gNREAD
 = 0x1020,

823 
	gNKE
 = 0x1021,

824 
	gNOSIGPIPE
 = 0x1022,

825 
	gNOADDRERR
 = 0x1023,

826 
	gNWRITE
 = 0x1024,

827 
	gLINGER_SEC
 = 0x1080,

828 
	gRESTRICTIONS
 = 0x1081,

829 
	gRANDOMPORT
 = 0x1082,

830 
	gNP_EXTENSIONS
= 0x1083,

833 
	gc
.
	gSO
.
	gPROTOTYPE
 = 
c
.
SO
.
PROTOCOL


835 
c
.
TCP
 = 
¡ræag
 {

836 
NODELAY
 = 0x01,

837 
	gMAXSEG
 = 0x02,

838 
	gNOPUSH
 = 0x04,

839 
	gNOOPT
 = 0x08,

840 
	gKEEPALIVE
 = 0x10,

841 
	gCONNECTIONTIMEOUT
 = 0x20,

842 --
	gPERSIST_TIMEOUT
 = 0x40, -- 
h—d”
 
defšes
 
nÙ
 
Çme¥aûd
 
as
 
	gTCP
, 
	gbug
?

843 
	gRXT_CONNDROPTIME
 = 0x80,

844 
	gRXT_FINDROP
 = 0x100,

847 -- 
chæags
 
ªd
 
	g¡©
. 
nÙe
 
the£
 
have
 
no
 
´efix


848 
	gc
.
	gCHFLAGS
 = 
muÉiæags
 {

849 
UF_NODUMP
 = 0x00000001,

850 
	gUF_IMMUTABLE
 = 0x00000002,

851 
	gUF_APPEND
 = 0x00000004,

852 
	gUF_OPAQUE
 = 0x00000008,

853 
	gUF_HIDDEN
 = 0x00008000,

855 
	gSF_ARCHIVED
 = 0x00010000,

856 
	gSF_IMMUTABLE
 = 0x00020000,

857 
	gSF_APPEND
 = 0x00040000,

860 
	gc
.
	gCHFLAGS
.
	gIMMUTABLE
 = 
c
.
CHFLAGS
.
UF_IMMUTABLE
 + c.CHFLAGS.
SF_IMMUTABLE


861 
c
.
CHFLAGS
.
APPEND
 = c.CHFLAGS.
UF_APPEND
 + c.CHFLAGS.
SF_APPEND


862 
c
.
CHFLAGS
.
OPAQUE
 = c.CHFLAGS.
UF_OPAQUE


864 -- 
kqueue


865 
c
.
EV
 = 
muÉiæags
 {

866 
ADD
 = 0x0001,

867 
	gDELETE
 = 0x0002,

868 
	gENABLE
 = 0x0004,

869 
	gDISABLE
 = 0x0008,

870 
	gONESHOT
 = 0x0010,

871 
	gCLEAR
 = 0x0020,

872 
	gRECEIPT
 = 0x0040,

873 
	gDISPATCH
 = 0x0080,

874 
	gSYSFLAGS
 = 0xF000,

875 
	gFLAG0
 = 0x1000,

876 
	gFLAG1
 = 0x2000,

877 
	gEOF
 = 0x8000,

878 
	gERROR
 = 0x4000,

881 
	gc
.
	gEVFILT
 = 
¡ræag
 {

882 
READ
 = -1,

883 
	gWRITE
 = -2,

884 
	gAIO
 = -3,

885 
	gVNODE
 = -4,

886 
	gPROC
 = -5,

887 
	gSIGNAL
 = -6,

888 
	gTIMER
 = -7,

889 
	gMACHPORT
 = -8,

890 
	gFS
 = -9,

891 
	gUSER
 = -10,

892 
	gVM
 = -12,

893 
	gSYSCOUNT
 = 13,

896 
	gc
.
	gNOTE
 = 
muÉiæags
 {

897 -- 
u£r


898 
FFNOP
 = 0x00000000,

899 
	gFFAND
 = 0x40000000,

900 
	gFFOR
 = 0x80000000,

901 
	gFFCOPY
 = 0xc0000000,

902 
	gFFCTRLMASK
 = 0xc0000000,

903 
	gFFLAGSMASK
 = 0x00ffffff,

904 
	gTRIGGER
 = 0x01000000,

905 -- 
»ad
 
ªd
 
wr™e


906 
	gLOWAT
 = 0x0001,

907 -- 
vnode


908 
	gDELETE
 = 0x0001,

909 
	gWRITE
 = 0x0002,

910 
	gEXTEND
 = 0x0004,

911 
	gATTRIB
 = 0x0008,

912 
	gLINK
 = 0x0010,

913 
	gRENAME
 = 0x0020,

914 
	gREVOKE
 = 0x0040,

915 -- 
´oc


916 
	gEXIT
 = 0x80000000,

917 
	gFORK
 = 0x40000000,

918 
	gEXEC
 = 0x20000000,

919 
	gREAP
 = 0x10000000,

920 
	gSIGNAL
 = 0x08000000,

921 
	gEXITSTATUS
= 0x04000000,

922 
	gRESOURCEEND
=0x02000000,

923 -- 
­p
 
	g¡©es


925 
APPACTIVE
 = 0x00800000,

926 
APPBACKGROUND
 = 0x00400000,

927 
APPNONUI
 = 0x00200000,

928 
APPINACTIVE
 = 0x00100000,

929 
APPALLSTATES
 = 0x00f00000,

933 
	gc
.
	gITIMER
 = 
¡ræag
 {

934 
REAL
 = 0,

935 
	gVIRTUAL
 = 1,

936 
	gPROF
 = 2,

939 
	gc
.
	gIP
 = 
¡ræag
 {

940 
OPTIONS
 = 1,

941 
	gHDRINCL
 = 2,

942 
	gTOS
 = 3,

943 
	gTTL
 = 4,

944 
	gRECVOPTS
 = 5,

945 
	gRECVRETOPTS
 = 6,

946 
	gRECVDSTADDR
 = 7,

947 
	gRETOPTS
 = 8,

948 
	gMULTICAST_IF
 = 9,

949 
	gMULTICAST_TTL
 = 10,

950 
	gMULTICAST_LOOP
 = 11,

951 
	gADD_MEMBERSHIP
 = 12,

952 
	gDROP_MEMBERSHIP
 = 13,

953 
	gMULTICAST_VIF
 = 14,

954 
	gRSVP_ON
 = 15,

955 
	gRSVP_OFF
 = 16,

956 
	gRSVP_VIF_ON
 = 17,

957 
	gRSVP_VIF_OFF
 = 18,

958 
	gPORTRANGE
 = 19,

959 
	gRECVIF
 = 20,

960 
	gIPSEC_POLICY
 = 21,

961 
	gFAITH
 = 22,

962 
	gSTRIPHDR
 = 23,

963 
	gRECVTTL
 = 24,

964 
	gBOUND_IF
 = 25,

965 
	gPKTINFO
 = 26,

966 
	gFW_ADD
 = 40,

967 
	gFW_DEL
 = 41,

968 
	gFW_FLUSH
 = 42,

969 
	gFW_ZERO
 = 43,

970 
	gFW_GET
 = 44,

971 
	gFW_RESETLOG
 = 45,

974 -- 
v6
 
sockİts


975 
	gc
.
	gIPV6
 = 
¡ræag
 {

976 
SOCKOPT_RESERVED1
 = 3,

977 
	gUNICAST_HOPS
 = 4,

978 
	gMULTICAST_IF
 = 9,

979 
	gMULTICAST_HOPS
 = 10,

980 
	gMULTICAST_LOOP
 = 11,

981 
	gJOIN_GROUP
 = 12,

982 
	gLEAVE_GROUP
 = 13,

983 
	gPORTRANGE
 = 14,

991 
	gCHECKSUM
 = 26,

992 
	gV6ONLY
 = 27,

993 
	gIPSEC_POLICY
 = 28,

994 
	gFAITH
 = 29,

995 
	gRECVTCLASS
 = 35,

996 
	gTCLASS
 = 36,

999 
	gc
.
	gXATTR
 = 
muÉiæags
 {

1000 
NOFOLLOW
 = 0x0001,

1001 
	gCREATE
 = 0x0002,

1002 
	gREPLACE
 = 0x0004,

1003 
	gNOSECURITY
 = 0x0008,

1004 
	gNODEFAULT
 = 0x0010,

1007 -- 
TODO
 
mªy
 
	gmissšg
, 
£e
 
®so
 
ä“bsd


1008 
	gc
.
	gMNT
 = 
¡ræag
 {

1009 
RDONLY
 = 0x00000001,

1010 
	gSYNCHRONOUS
 = 0x00000002,

1011 
	gNOEXEC
 = 0x00000004,

1012 
	gNOSUID
 = 0x00000008,

1013 
	gNODEV
 = 0x00000010,

1014 
	gUNION
 = 0x00000020,

1015 
	gASYNC
 = 0x00000040,

1016 
	gCPROTECT
 = 0x00000080,

1018 
	gFORCE
 = 0x00080000,

1021 
	gc
.
	gCTL
 = 
¡ræag
 {

1022 
UNSPEC
 = 0,

1023 
	gKERN
 = 1,

1024 
	gVM
 = 2,

1025 
	gVFS
 = 3,

1026 
	gNET
 = 4,

1027 
	gDEBUG
 = 5,

1028 
	gHW
 = 6,

1029 
	gMACHDEP
 = 7,

1030 
	gUSER
 = 8,

1033 
	gc
.
	gKERN
 = 
¡ræag
 {

1034 
OSTYPE
 = 1,

1035 
	gOSRELEASE
 = 2,

1036 
	gOSREV
 = 3,

1037 
	gVERSION
 = 4,

1038 
	gMAXVNODES
 = 5,

1039 
	gMAXPROC
 = 6,

1040 
	gMAXFILES
 = 7,

1041 
	gARGMAX
 = 8,

1042 
	gSECURELVL
 = 9,

1043 
	gHOSTNAME
 = 10,

1044 
	gHOSTID
 = 11,

1045 
	gCLOCKRATE
 = 12,

1046 
	gVNODE
 = 13,

1047 
	gPROC
 = 14,

1048 
	gFILE
 = 15,

1049 
	gPROF
 = 16,

1050 
	gPOSIX1
 = 17,

1051 
	gNGROUPS
 = 18,

1052 
	gJOB_CONTROL
 = 19,

1053 
	gSAVED_IDS
 = 20,

1054 
	gBOOTTIME
 = 21,

1055 
	gNISDOMAINNAME
 = 22,

1056 
	gMAXPARTITIONS
 = 23,

1057 
	gKDEBUG
 = 24,

1058 
	gUPDATEINTERVAL
 = 25,

1059 
	gOSRELDATE
 = 26,

1060 
	gNTP_PLL
 = 27,

1061 
	gBOOTFILE
 = 28,

1062 
	gMAXFILESPERPROC
 = 29,

1063 
	gMAXPROCPERUID
 = 30,

1064 
	gDUMPDEV
 = 31,

1065 
	gIPC
 = 32,

1066 
	gDUMMY
 = 33,

1067 
	gPS_STRINGS
 = 34,

1068 
	gUSRSTACK32
 = 35,

1069 
	gLOGSIGEXIT
 = 36,

1070 
	gSYMFILE
 = 37,

1071 
	gPROCARGS
 = 38,

1072 
	gNETBOOT
 = 40,

1073 
	gPANICINFO
 = 41,

1074 
	gSYSV
 = 42,

1075 
	gAFFINITY
 = 43,

1076 
	gTRANSLATE
 = 44,

1077 
	gEXEC
 = 45,

1078 
	gAIOMAX
 = 46,

1079 
	gAIOPROCMAX
 = 47,

1080 
	gAIOTHREADS
 = 48,

1081 
	gCOREFILE
 = 50,

1082 
	gCOREDUMP
 = 51,

1083 
	gSUGID_COREDUMP
 = 52,

1084 
	gPROCDELAYTERM
 = 53,

1085 
	gSHREG_PRIVATIZABLE
= 54,

1086 
	gLOW_PRI_WINDOW
 = 56,

1087 
	gLOW_PRI_DELAY
 = 57,

1088 
	gPOSIX
 = 58,

1089 
	gUSRSTACK64
 = 59,

1090 
	gNX_PROTECTION
 = 60,

1091 
	gTFP
 = 61,

1092 
	gPROCNAME
 = 62,

1093 
	gTHALTSTACK
 = 63,

1094 
	gSPECULATIVE_READS
 = 64,

1095 
	gOSVERSION
 = 65,

1096 
	gSAFEBOOT
 = 66,

1097 
	gLCTX
 = 67,

1098 
	gRAGEVNODE
 = 68,

1099 
	gTTY
 = 69,

1100 
	gCHECKOPENEVT
 = 70,

1101 
	gTHREADNAME
 = 71,

1104 -- 
aùu®ly
 
SYSTEM_CLOCK
 
	g‘c
, 
»Çmed


1105 
	gc
.
	gCLOCKTYPE
 = {

1106 
SYSTEM
 = 0,

1107 
	gCALENDAR
 = 1,

1110 
	gc
.
	gCLOCKTYPE
.
	gREALTIME
 = 
c
.
CLOCKTYPE
.
SYSTEM


1112 -- 
AT
 
cÚ¡ªts
 
Úly
 
š
 
»ûÁ
 
v”siÚs
, 
should
 
check
 
wh’
 
added


1113 
	gc
.
	gAT_FDCWD
 = 
©æag
 {

1114 
FDCWD
 = -2,

1117 
	gc
.
	gAT
 = 
muÉiæags
 {

1118 
EACCESS
 = 0x0010,

1119 
	gSYMLINK_NOFOLLOW
 = 0x0020,

1120 
	gSYMLINK_FOLLOW
 = 0x0040,

1121 
	gREMOVEDIR
 = 0x0080,

1124  
	gc


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/errors.lua

1 -- 
OSX
 
”rÜ
 
mes§ges


4 
	gPERM
 = "Operation‚ot…ermitted",

5 
	gNOENT
 = "No such file or directory",

6 
	gSRCH
 = "No such…rocess",

7 
	gINTR
 = "Interrupted system call",

8 
	gIO
 = "Input/outputƒrror",

9 
	gNXIO
 = "Device‚ot configured",

11 
	gNOEXEC
 = "Exec formatƒrror",

12 
	gBADF
 = "Bad file descriptor",

13 
	gCHILD
 = "No child…rocesses",

14 
	gDEADLK
 = "Resource deadlock‡voided",

15 
	gNOMEM
 = "Cannot‡llocate memory",

16 
	gACCES
 = "Permission denied",

17 
	gFAULT
 = "Bad‡ddress",

18 
	gNOTBLK
 = "Block device„equired",

19 
	gBUSY
 = "Resource busy",

20 
	gEXIST
 = "Fileƒxists",

21 
	gXDEV
 = "Cross-device†ink",

22 
	gNODEV
 = "Operation‚ot supported by device",

23 
	gNOTDIR
 = "Not‡ directory",

24 
	gISDIR
 = "Is‡ directory",

25 
	gINVAL
 = "Invalid‡rgument",

26 
	gNFILE
 = "Too many open files in system",

27 
	gMFILE
 = "Too many open files",

28 
	gNOTTY
 = "Inappropriate ioctl for device",

29 
	gTXTBSY
 = "Text file busy",

30 
	gFBIG
 = "Fileoo†arge",

31 
	gNOSPC
 = "No space†eft on device",

32 
	gSPIPE
 = "Illegal seek",

33 
	gROFS
 = "Read-only file system",

34 
	gMLINK
 = "Too many†inks",

35 
	gPIPE
 = "Broken…ipe",

36 
	gDOM
 = "Numerical‡rgument out of domain",

37 
	gRANGE
 = "Resultoo†arge",

38 
	gAGAIN
 = "Resourceemporarily unavailable",

39 
	gINPROGRESS
 = "Operation‚ow in…rogress",

40 
	gALREADY
 = "Operation‡lready in…rogress",

41 
	gNOTSOCK
 = "Socket operation on‚on-socket",

42 
	gDESTADDRREQ
 = "Destination‡ddress„equired",

43 
	gMSGSIZE
 = "Messageoo†ong",

44 
	gPROTOTYPE
 = "Protocol wrongype for socket",

45 
	gNOPROTOOPT
 = "Protocol‚ot‡vailable",

46 
	gPROTONOSUPPORT
 = "Protocol‚ot supported",

47 
	gSOCKTNOSUPPORT
 = "Socketype‚ot supported",

48 
	gPFNOSUPPORT
 = "Protocol family‚ot supported",

49 
	gAFNOSUPPORT
 = "Address family‚ot supported by…rotocol family",

50 
	gADDRINUSE
 = "Address‡lready in use",

51 
	gADDRNOTAVAIL
 = "Can't‡ssign„equested‡ddress",

52 
	gNETDOWN
 = "Network is down",

53 
	gNETUNREACH
 = "Network is unreachable",

54 
	gNETRESET
 = "Network dropped connection on„eset",

55 
	gCONNABORTED
 = "Software caused connection‡bort",

56 
	gCONNRESET
 = "Connection„eset by…eer",

57 
	gNOBUFS
 = "No buffer space‡vailable",

58 
	gISCONN
 = "Socket is‡lready connected",

59 
	gNOTCONN
 = "Socket is‚ot connected",

60 
	gSHUTDOWN
 = "Can't send‡fter socket shutdown",

61 
	gTOOMANYREFS
 = "Too many„eferences: can't splice",

62 
	gTIMEDOUT
 = "Operationimed out",

63 
	gCONNREFUSED
 = "Connection„efused",

64 
	gLOOP
 = "Too many†evels of symbolic†inks",

65 
	gNAMETOOLONG
 = "File‚ameoo†ong",

66 
	gHOSTDOWN
 = "Host is down",

67 
	gHOSTUNREACH
 = "No„outeo host",

68 
	gNOTEMPTY
 = "Directory‚otƒmpty",

69 
	gPROCLIM
 = "Too many…rocesses",

70 
	gUSERS
 = "Too many users",

71 
	gDQUOT
 = "Disc quotaƒxceeded",

72 
	gSTALE
 = "Stale NFS file handle",

73 
	gREMOTE
 = "Too many†evels of„emote in…ath",

74 
	gBADRPC
 = "RPC struct is bad",

75 
	gRPCMISMATCH
 = "RPC version wrong",

76 
	gPROGUNAVAIL
 = "RPC…rog.‚ot‡vail",

77 
	gPROGMISMATCH
 = "Program version wrong",

78 
	gPROCUNAVAIL
 = "Bad…rocedure for…rogram",

79 
	gNOLCK
 = "No†ocks‡vailable",

80 
	gNOSYS
 = "Function‚ot implemented",

81 
	gFTYPE
 = "Inappropriate fileype or format",

82 
	gAUTH
 = "Authenticationƒrror",

83 
	gNEEDAUTH
 = "Need‡uthenticator",

84 
	gOVERFLOW
 = "Valueoo†argeo be stored in dataype",

85 
	gBADEXEC
 = "Badƒxecutable (or shared†ibrary)",

86 
	gBADARCH
 = "Bad CPUype inƒxecutable",

87 
	gSHLIBVERS
 = "Shared†ibrary version mismatch",

88 
	gBADMACHO
 = "Malformed Mach-o file",

89 
	gCANCELED
 = "Operation canceled",

90 
	gIDRM
 = "Identifier„emoved",

91 
	gNOMSG
 = "No message of desiredype",

92 
	gILSEQ
 = "Illegal byte sequence",

93 
	gNOATTR
 = "Attribute‚ot found",

94 
	gBADMSG
 = "Bad message",

95 
	gMULTIHOP
 = "EMULTIHOP (Reserved)",

96 
	gNODATA
 = "No message‡vailable on STREAM",

97 
	gNOLINK
 = "ENOLINK (Reserved)",

98 
	gNOSR
 = "No STREAM„esources",

99 
	gNOSTR
 = "Not‡ STREAM",

100 
	gPROTO
 = "Protocolƒrror",

101 
	gTIME
 = "STREAM ioctlimeout",

102 
	gOPNOTSUPP
 = "Operation‚ot supported on socket",

103 
	gNOPOLICY
 = "Policy‚ot found",

104 
	gNOTRECOVERABLE
 = "State‚ot„ecoverable",

105 
	gOWNERDEAD
 = "Previous owner died",

106 
	gQFULL
 = "Interface output queue is full",

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/fcntl.lua

1 -- 
OSX
 
	gfú


2 -- 
TODO
 
	gšcom¶‘e
, 
lÙs
 
missšg


4 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

5 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

6 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

7 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

8 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

9 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


11 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

13 
loÿl
 
c
 = 
»quœe
 "syscall.osx.constants"

15 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
ùoboŞ
, 
boŞtoc
 = 
h
.ctobool, h.booltoc

23 
loÿl
 
fú
 = {

24 
commªds
 = {

25 [
c
.
F
.
SETFL
] = 
	`funùiÚ
(
¬g
è c.
O
[¬g] 
’d
,

26 [
c
.
F
.
SETFD
] = 
	`funùiÚ
(
¬g
è c.
FD
[¬g] 
’d
,

27 [
c
.
F
.
GETLK
] = 
t
.
æock
,

28 [
c
.
F
.
SETLK
] = 
t
.
æock
,

29 [
c
.
F
.
SETLKW
] = 
t
.
æock
,

30 [
c
.
F
.
SETNOSIGPIPE
] = 
	`funùiÚ
(
¬g
è 
	`boŞtoc
×rgè
’d
,

32 
»t
 = {

33 [
c
.
F
.
DUPFD
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

34 [
c
.
F
.
DUPFD_CLOEXEC
] = 
	`funùiÚ
(
»t
è 
t
.
	`fd
Ô‘è
’d
,

35 [
c
.
F
.
GETFD
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

36 [
c
.
F
.
GETFL
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

37 [
c
.
F
.
GETOWN
] = 
	`funùiÚ
(
»t
è 
	`tÚumb”
Ô‘è
’d
,

38 [
c
.
F
.
GETLK
] = 
	`funùiÚ
(
»t
, 
¬g
è‡rg 
’d
,

39 [
c
.
F
.
GETNOSIGPIPE
] = 
	`funùiÚ
(
»t
è 
	`ùoboŞ
Ô‘è
’d
,

41 
	}
}

43  
fú


45 
’d


47  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/ffi.lua

1 -- 
ffi
 
defš™iÚs
 
of
 
OSX
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "syscall.ffitypes"

16 -- 
v”siÚ
 
d‘eùiÚ
 - 
nÙ
 
im¶em’‹d
 
y‘


17 
ffi
.
cdef
 [[

18 
sysùl
(cÚ¡ *
Çme
, 
Çm–’
, *
Şdp
, 
size_t
 *
ŞdËÅ
, cÚ¡ *
Ãwp
, size_ˆ
ÃwËn
);

21 
loÿl
 
	gdefs
 = {}

23 
loÿl
 
funùiÚ
 
	$­³nd
(
¡r
è
defs
[#def + 1] = sŒ 
’d


25 
­³nd
 [[

26 
ušt16_t
 
mode_t
;

27 
ušt8_t
 
§_çmy_t
;

28 
ušt32_t
 
dev_t
;

29 
št64_t
 
blkút_t
;

30 
št32_t
 
blksize_t
;

31 
št32_t
 
su£cÚds_t
;

32 
ušt16_t
 
Æšk_t
;

33 
ušt64_t
 
šo64_t
;

34 
ušt32_t
 
šo_t
;

35 
time_t
;

36 
št32_t
 
daddr_t
;

37 
şock_t
;

38 
nfds_t
;

39 
ušt32_t
 
id_t
;

40 
tcæag_t
;

41 
¥“d_t
;

42 
k”n_»tuº_t
;

44 
Çtu¿l_t
;

45 
Çtu¿l_t
 
mach_pÜt_Çme_t
;

46 
mach_pÜt_Çme_t
 *
mach_pÜt_Çme_¬¿y_t
;

47 
mach_pÜt_Çme_t
 
mach_pÜt_t
;

49 
mach_pÜt_t
 
sk_t
;

50 
mach_pÜt_t
 
sk_Çme_t
;

51 
mach_pÜt_t
 
th»ad_t
;

52 
mach_pÜt_t
 
th»ad_aù_t
;

53 
mach_pÜt_t
 
c_¥aû_t
;

54 
mach_pÜt_t
 
ho¡_t
;

55 
mach_pÜt_t
 
ho¡_´iv_t
;

56 
mach_pÜt_t
 
ho¡_£cur™y_t
;

57 
mach_pÜt_t
 
´oûssÜ_t
;

58 
mach_pÜt_t
 
´oûssÜ_£t_t
;

59 
mach_pÜt_t
 
´oûssÜ_£t_cÚŒŞ_t
;

60 
mach_pÜt_t
 
£m­hÜe_t
;

61 
mach_pÜt_t
 
lock_£t_t
;

62 
mach_pÜt_t
 
Ëdg”_t
;

63 
mach_pÜt_t
 
®¬m_t
;

64 
mach_pÜt_t
 
şock_£rv_t
;

65 
mach_pÜt_t
 
şock_ù¾_t
;

67 
®¬m_ty³_t
;

68 
¦“p_ty³_t
;

69 
şock_id_t
;

70 
şock_æavÜ_t
;

71 *
şock_©Œ_t
;

72 
şock_»s_t
;

76 
şockid_t
;

77 
tim”_t
;

82 
ušt32_t
 
sig
[1];

83 } 
	tsig£t_t
;

85 
	sfd_£t
 {

86 
št32_t
 
fds_b™s
[32];

87 } 
	tfd_£t
;

88 
	spŞlfd


90 
fd
;

91 
ev’ts
;

92 
»v’ts
;

94 
	scmsghdr
 {

95 
size_t
 
cmsg_Ën
;

96 
cmsg_Ëv–
;

97 
cmsg_ty³
;

98 
cmsg_d©a
[?];

100 
	smsghdr
 {

101 *
msg_Çme
;

102 
sockËn_t
 
msg_Çm–’
;

103 
iovec
 *
msg_iov
;

104 
msg_iovËn
;

105 *
msg_cÚŒŞ
;

106 
sockËn_t
 
msg_cÚŒŞËn
;

107 
msg_æags
;

109 
	stime¥ec
 {

110 
time_t
 
tv_£c
;

111 
tv_n£c
;

113 
	stimev®
 {

114 
time_t
 
tv_£c
;

115 
su£cÚds_t
 
tv_u£c
;

117 
	s™im”¥ec
 {

118 
time¥ec
 
™_š‹rv®
;

119 
time¥ec
 
™_v®ue
;

121 
	s™im”v®
 {

122 
timev®
 
™_š‹rv®
;

123 
timev®
 
™_v®ue
;

126 
	ssockaddr
 {

127 
ušt8_t
 
§_Ën
;

128 
§_çmy_t
 
§_çmy
;

129 
§_d©a
[14];

131 
	ssockaddr_¡Üage
 {

132 
ušt8_t
 
ss_Ën
;

133 
§_çmy_t
 
ss_çmy
;

134 
__ss_·d1
[6];

135 
št64_t
 
__ss_®ign
;

136 
__ss_·d2
[128 - 2 - 8 - 6];

138 
	ssockaddr_š
 {

139 
ušt8_t
 
sš_Ën
;

140 
§_çmy_t
 
sš_çmy
;

141 
š_pÜt_t
 
sš_pÜt
;

142 
š_addr
 
sš_addr
;

143 
št8_t
 
sš_z”o
[8];

145 
	ssockaddr_š6
 {

146 
ušt8_t
 
sš6_Ën
;

147 
§_çmy_t
 
sš6_çmy
;

148 
š_pÜt_t
 
sš6_pÜt
;

149 
ušt32_t
 
sš6_æowšfo
;

150 
š6_addr
 
sš6_addr
;

151 
ušt32_t
 
sš6_scİe_id
;

153 
	ssockaddr_un
 {

154 
ušt8_t
 
sun_Ën
;

155 
§_çmy_t
 
sun_çmy
;

156 
sun_·th
[104];

158 
	s¡©
 {

159 
dev_t
 
¡_dev
;

160 
mode_t
 
¡_mode
;

161 
Æšk_t
 
¡_Æšk
;

162 
šo64_t
 
¡_šo
;

163 
uid_t
 
¡_uid
;

164 
gid_t
 
¡_gid
;

165 
dev_t
 
¡_rdev
;

166 
time¥ec
 
¡_©ime¥ec
;

167 
time¥ec
 
¡_mtime¥ec
;

168 
time¥ec
 
¡_ùime¥ec
;

169 
time¥ec
 
¡_bœthtime¥ec
;

170 
off_t
 
¡_size
;

171 
blkút_t
 
¡_blocks
;

172 
blksize_t
 
¡_blksize
;

173 
ušt32_t
 
¡_æags
;

174 
ušt32_t
 
¡_g’
;

175 
št32_t
 
¡_l¥¬e
;

176 
št64_t
 
¡_q¥¬e
[2];

178 
	s¡©32
 {

179 
dev_t
 
¡_dev
;

180 
šo_t
 
¡_šo
;

181 
mode_t
 
¡_mode
;

182 
Æšk_t
 
¡_Æšk
;

183 
uid_t
 
¡_uid
;

184 
gid_t
 
¡_gid
;

185 
dev_t
 
¡_rdev
;

186 
time¥ec
 
¡_©ime¥ec
;

187 
time¥ec
 
¡_mtime¥ec
;

188 
time¥ec
 
¡_ùime¥ec
;

189 
off_t
 
¡_size
;

190 
blkút_t
 
¡_blocks
;

191 
blksize_t
 
¡_blksize
;

192 
ušt32_t
 
¡_æags
;

193 
ušt32_t
 
¡_g’
;

194 
št32_t
 
¡_l¥¬e
;

195 
št64_t
 
¡_q¥¬e
[2];

197 
	usigv®
 {

198 
siv®_št
;

199 *
siv®_±r
;

201 
	s__sigšfo
 {

202 
si_signo
;

203 
si_”ºo
;

204 
si_code
;

205 
pid_t
 
si_pid
;

206 
uid_t
 
si_uid
;

207 
si_¡©us
;

208 *
si_addr
;

209 
sigv®
 
si_v®ue
;

210 
si_bªd
;

211 
__·d
[7];

212 } 
	tsigšfo_t
;

213 
	u__sigaùiÚ_u
 {

214 (*
__§_hªdËr
)();

215 (*
__§_sigaùiÚ
)(, 
__sigšfo
 *, *);

217 
	ssigaùiÚ
 {

218 
__sigaùiÚ_u
 __sigaction_u;

219 
sig£t_t
 
§_mask
;

220 
§_æags
;

222 
	ssigev’t
 {

223 
sigev_nÙify
;

224 
sigev_signo
;

225 
sigv®
 
sigev_v®ue
;

226 (*
sigev_nÙify_funùiÚ
)(
sigv®
);

227 *
sigev_nÙify_©Œibu‹s
;

229 
	sdœ’t
 {

230 
ušt64_t
 
d_šo
;

231 
ušt64_t
 
d_£ekoff
;

232 
ušt16_t
 
d_»ş’
;

233 
ušt16_t
 
d_ÇmËn
;

234 
ušt8_t
 
d_ty³
;

235 
d_Çme
[1024];

237 
	sËgacy_dœ’t
 {

238 
ušt32_t
 
d_šo
;

239 
ušt16_t
 
d_»ş’
;

240 
ušt8_t
 
d_ty³
;

241 
ušt8_t
 
d_ÇmËn
;

242 
d_Çme
[256];

244 
	sæock
 {

245 
off_t
 
l_¡¬t
;

246 
off_t
 
l_Ën
;

247 
pid_t
 
l_pid
;

248 
l_ty³
;

249 
l_wh’û
;

251 
	s‹rmios
 {

252 
tcæag_t
 
c_iæag
;

253 
tcæag_t
 
c_oæag
;

254 
tcæag_t
 
c_cæag
;

255 
tcæag_t
 
c_læag
;

256 
cc_t
 
c_cc
[20];

257 
¥“d_t
 
c_i¥“d
;

258 
¥“d_t
 
c_o¥“d
;

260 
	sru§ge
 {

261 
timev®
 
ru_utime
;

262 
timev®
 
ru_¡ime
;

263 
ru_maxrss
;

264 
ru_ixrss
;

265 
ru_idrss
;

266 
ru_i¤ss
;

267 
ru_mšæt
;

268 
ru_majæt
;

269 
ru_nsw­
;

270 
ru_šblock
;

271 
ru_oublock
;

272 
ru_msg¢d
;

273 
ru_msgrcv
;

274 
ru_nsigÇls
;

275 
ru_nvcsw
;

276 
ru_nivcsw
;

278 
	skev’t
 {

279 
ušŒ_t
 
id’t
;

280 
št16_t
 
f‹r
;

281 
ušt16_t
 
æags
;

282 
ušt32_t
 
fæags
;

283 
šŒ_t
 
d©a
;

284 *
ud©a
;

286 
	saiocb
 {

287 
aio_fdes
;

288 
off_t
 
aio_off£t
;

289 vŞ©*
aio_buf
;

290 
size_t
 
aio_nby‹s
;

291 
aio_»q´io
;

292 
sigev’t
 
aio_sigev’t
;

293 
aio_lio_İcode
;

295 
	smach_timeba£_šfo
 {

296 
ušt32_t
 
num”
;

297 
ušt32_t
 
d’om
;

299 
mach_timeba£_šfo
 *
	tmach_timeba£_šfo_t
;

300 
mach_timeba£_šfo
 
	tmach_timeba£_šfo_d©a_t
;

301 
	smach_time¥ec
 {

302 
tv_£c
;

303 
şock_»s_t
 
tv_n£c
;

305 
mach_time¥ec
 
	tmach_time¥ec_t
;

308 
­³nd
 [[

309 
	`ioùl
(
d
, 
»que¡
, *
¬g
);

310 
	`mouÁ
(cÚ¡ *
ty³
, cÚ¡ *
dœ
, 
æags
, *
d©a
);

312 
	`¡©64
(cÚ¡ *
·th
, 
¡©
 *
sb
);

313 
	`l¡©64
(cÚ¡ *
·th
, 
¡©
 *
sb
);

314 
	`f¡©64
(
fd
, 
¡©
 *
sb
);

315 
	`f¡©©
(
dœfd
, cÚ¡ *
·thÇme
, 
¡©32
 *
buf
, 
æags
);

317 
	`_g‘dœ’Œ›s
(
fd
, *
buf
, 
nby‹s
, *
ba£p
);

318 
	`_sigaùiÚ
(
signum
, cÚ¡ 
sigaùiÚ
 *
aù
, sigaùiÚ *
Şdaù
);

321 
ušt64_t
 
	`mach_absŞu‹_time
();

322 
k”n_»tuº_t
 
	`mach_timeba£_šfo
(
mach_timeba£_šfo_t
 
šfo
);

323 
k”n_»tuº_t
 
	`mach_wa™_uÁ
(
ušt64_t
 
d—dlše
);

325 
mach_pÜt_t
 
mach_sk_£lf_
;

326 
mach_pÜt_t
 
	`mach_ho¡_£lf
();

327 
k”n_»tuº_t
 
	`mach_pÜt_d—Îoÿ‹
(
c_¥aû_t
 
sk
, 
mach_pÜt_Çme_t
 
Çme
);

329 
k”n_»tuº_t
 
	`ho¡_g‘_şock_£rviû
(
ho¡_t
 
ho¡
, 
şock_id_t
 
şock_id
, 
şock_£rv_t
 *
şock_£rv
);

330 
k”n_»tuº_t
 
	`şock_g‘_time
(
şock_£rv_t
 
şock_£rv
, 
mach_time¥ec_t
 *
cur_time
);

333 
ffi
.
	`cdef
(
bË
.
	`cÚÿt
(
defs
, ""))

335 
»quœe
 "syscall.bsd.ffi"

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/ioctl.lua

1 -- 
	gioùls
, 
flšg
 
š
 
as
 
Ãeded


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
s
, 
t
 = 
ty³s
.s,ypes.t

14 
loÿl
 
¡ræag
 = 
	`»quœe
("syscall.helpers").strflag

15 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

17 
loÿl
 
bªd
 = 
b™
.band

18 
loÿl
 
funùiÚ
 
	$bÜ
(...)

19 
loÿl
 
r
 = 
b™
.
	$bÜ
(...)

20 
r
 < 0 
th’
„ =„ + 4294967296 
’d
 -- 
TODO
 
£e
 
nÙe
 
š
 
N‘BSD


21  
r


22 
’d


23 
loÿl
 
lshiá
 = 
b™
.lshift

24 
loÿl
 
rshiá
 = 
b™
.rshift

26 
loÿl
 
IOC
 = {

27 
VOID
 = 0x20000000,

28 
OUT
 = 0x40000000,

29 
IN
 = 0x80000000,

30 
PARM_SHIFT
 = 13,

31 
	}
}

33 
	gIOC
.
	gPARM_MASK
 = 
lshiá
(1, 
IOC
.
PARM_SHIFT
) - 1

34 
	gIOC
.
	gINOUT
 = 
IOC
.
IN
 + IOC.
OUT


35 
IOC
.
DIRMASK
 = IOC.
IN
 + IOC.
OUT
 + IOC.
VOID


37 
loÿl
 
funùiÚ
 
	$ioc
(
dœ
, 
ch
, 
Ä
, 
size
)

38  
t
.
	`ulÚg
(
	`bÜ
(
dœ
,

39 
	`lshiá
(
	`bªd
(
size
, 
IOC
.
PARM_MASK
), 16),

40 
	`lshiá
(
ch
, 8),

41 
Ä
))

42 
’d


44 
loÿl
 
sšgËtÚm­
 = {

47 
ušt
 = "uint1",

48 
ušt64
 = "uint64_1",

49 
off
 = "off1",

50 
	}
}

52 
loÿl
 
funùiÚ
 
	$_IOC
(
dœ
, 
ch
, 
Ä
, 

)

53 
	`ty³
(
ch
è=ğ"¡ršg" 
th’
 ch = ch:
	$by‹
(è
’d


54 
	`ty³
(

è=ğ"numb”" 
th’
  
	$ioc
(
dœ
, 
ch
, 
Ä
, 

è
’d


55 
loÿl
 
size
 = 
s
[

]

56 
loÿl
 
sšgËtÚ
 = 
sšgËtÚm­
[

] ~ğ
n


57 

 = 
sšgËtÚm­
[] 
Ü
p

58  {
numb”
 = 
	`ioc
(
dœ
, 
ch
, 
Ä
, 
size
),

59 
»ad
 = 
dœ
 =ğ
IOC
.
OUT
 
Ü
 dœ =ğIOC.
INOUT
, 
wr™e
 = dœ =ğIOC.
IN
 or dir == IOC.INOUT,

60 
ty³
 = 
t
[

], 
sšgËtÚ
 = 
	}
singleton}

61 
’d


63 
loÿl
 
	g_IO
 = 
	$funùiÚ
(
ch
, 
Ä
è 
	$_IOC
(
IOC
.
VOID
, 
ch
, 
Ä
, 0è
’d


64 
loÿl
 
_IOR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
OUT
, 
ch
, 
Ä
, 

è
’d


65 
loÿl
 
_IOW
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
IN
, 
ch
, 
Ä
, 

è
’d


66 
loÿl
 
_IOWR
 = 
	$funùiÚ
(
ch
, 
Ä
, 

è 
	$_IOC
(
IOC
.
INOUT
, 
ch
, 
Ä
, 

è
’d


67 
loÿl
 
_IOWINT
 = 
	$funùiÚ
(
ch
, 
Ä
è 
	`_IOC
(
IOC
.
VOID
, ch,‚r, "št"è
’d


69 
loÿl
 
ioùl
 = 
¡ræag
 {

70 -- 
‰y
 
ioùls


71 
TIOCEXCL
 = 
	`_IO
('t', 13),

72 
TIOCNXCL
 = 
	`_IO
('t', 14),

73 
TIOCFLUSH
 = 
	`_IOW
('t', 16, "int"),

74 
TIOCGETA
 = 
	`_IOR
('t', 19, "termios"),

75 
TIOCSETA
 = 
	`_IOW
('t', 20, "termios"),

76 
TIOCSETAW
 = 
	`_IOW
('t', 21, "termios"),

77 
TIOCSETAF
 = 
	`_IOW
('t', 22, "termios"),

78 
TIOCGETD
 = 
	`_IOR
('t', 26, "int"),

79 
TIOCSETD
 = 
	`_IOW
('t', 27, "int"),

80 
TIOCPTYUNLK
 = 
	`_IO
('t', 82),

81 
TIOCPTYGNAME
 = 
	`_IOC
(
IOC
.
OUT
, 't', 83, 128),

82 
TIOCPTYGRANT
 = 
	`_IO
('t', 84),

83 
TIOCGDRAINWAIT
 = 
	`_IOR
('t', 86, "int"),

84 
TIOCSDRAINWAIT
 = 
	`_IOW
('t', 87, "int"),

85 
TIOCTIMESTAMP
 = 
	`_IOR
('t', 89, "timeval"),

86 
TIOCMGDTRWAIT
 = 
	`_IOR
('t', 90, "int"),

87 
TIOCMSDTRWAIT
 = 
	`_IOW
('t', 91, "int"),

88 
TIOCDRAIN
 = 
	`_IO
('t', 94),

89 
TIOCSIG
 = 
	`_IO
('t', 95),

90 
TIOCEXT
 = 
	`_IOW
('t', 96, "int"),

91 
TIOCSCTTY
 = 
	`_IO
('t', 97),

92 
TIOCCONS
 = 
	`_IOW
('t', 98, "int"),

93 
TIOCGSID
 = 
	`_IOR
('t', 99, "int"),

94 
TIOCSTAT
 = 
	`_IO
('t', 101),

95 
TIOCUCNTL
 = 
	`_IOW
('t', 102, "int"),

96 
TIOCSWINSZ
 = 
	`_IOW
('t', 103, "winsize"),

97 
TIOCGWINSZ
 = 
	`_IOR
('t', 104, "winsize"),

98 
TIOCMGET
 = 
	`_IOR
('t', 106, "int"),

99 
TIOCMBIC
 = 
	`_IOW
('t', 107, "int"),

100 
TIOCMBIS
 = 
	`_IOW
('t', 108, "int"),

101 
TIOCMSET
 = 
	`_IOW
('t', 109, "int"),

102 
TIOCSTART
 = 
	`_IO
('t', 110),

103 
TIOCSTOP
 = 
	`_IO
('t', 111),

104 
TIOCPKT
 = 
	`_IOW
('t', 112, "int"),

105 
TIOCNOTTY
 = 
	`_IO
('t', 113),

106 
TIOCSTI
 = 
	`_IOW
('t', 114, "char"),

107 
TIOCOUTQ
 = 
	`_IOR
('t', 115, "int"),

108 
TIOCSPGRP
 = 
	`_IOW
('t', 118, "int"),

109 
TIOCGPGRP
 = 
	`_IOR
('t', 119, "int"),

110 
TIOCCDTR
 = 
	`_IO
('t', 120),

111 
TIOCSDTR
 = 
	`_IO
('t', 121),

112 
TIOCCBRK
 = 
	`_IO
('t', 122),

113 
TIOCSBRK
 = 
	`_IO
('t', 123),

114 
FIOCLEX
 = 
	`_IO
('f', 1),

115 
FIONCLEX
 = 
	`_IO
('f', 2),

116 
FIONREAD
 = 
	`_IOR
('f', 127, "int"),

117 
FIONBIO
 = 
	`_IOW
('f', 126, "int"),

118 
FIOASYNC
 = 
	`_IOW
('f', 125, "int"),

119 
FIOSETOWN
 = 
	`_IOW
('f', 124, "int"),

120 
FIOGETOWN
 = 
	`_IOR
('f', 123, "int"),

121 
FIODTYPE
 = 
	`_IOR
('f', 122, "int"),

122 
	}
}

124  
ioùl


126 
’d


128  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/syscalls.lua

1 -- 
OSX
 
¥ecific
 
sysÿÎs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12  
	$funùiÚ
(
S
, 
hh
, 
c
, 
C
, 
ty³s
)

14 
loÿl
 
»t64
, 
»Šum
, 
»tfd
, 
»tboŞ
, 
»Œ
 = 
hh
.ret64, hh.retnum, hh.retfd, hh.retbool, hh.retptr

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
”ºo
 = 
ffi
.errno

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
i¡y³
, 
mkty³
, 
g‘fd
 = 
h
.istype, h.mktype, h.getfd

23 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

25 -- 
TODO
 
lutimes
 
is
 
im¶em’‹d
 
usšg
 
	$£‰¾i¡
(2è
š
 
OSX


27 
funùiÚ
 
S
.
	$g¿Á±
(
fd
è 
S
.
	`ioùl
(fd, "TIOCPTYGRANT"è
’d


28 
funùiÚ
 
S
.
	$uÆock±
(
fd
è 
S
.
	`ioùl
(fd, "TIOCPTYUNLK"è
’d


29 
funùiÚ
 
S
.
	$±¢ame
(
fd
)

30 
loÿl
 
buf
 = 
t
.
	$bufãr
(128)

31 
loÿl
 
ok
, 
”r
 = 
S
.
	`ioùl
(
fd
, "TIOCPTYGNAME", 
buf
)

32 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


33  
ffi
.
	$¡ršg
(
buf
)

34 
’d


36 
funùiÚ
 
S
.
	$mach_absŞu‹_time
(è 
C
.
	$mach_absŞu‹_time
(è
’d


37 
funùiÚ
 
S
.
	$mach_sk_£lf
(è 
C
.
mach_sk_£lf_
 
’d


38 
funùiÚ
 
S
.
	$mach_ho¡_£lf
(è 
C
.
	$mach_ho¡_£lf
(è
’d


39 
funùiÚ
 
S
.
	$mach_pÜt_d—Îoÿ‹
(
sk
, 
Çme
è 
	`»tboŞ
(
C
.
	`mach_pÜt_d—Îoÿ‹
Ñask 
Ü
 
S
.
	`mach_sk_£lf
(),‚ame)è
’d


41 
funùiÚ
 
S
.
	$ho¡_g‘_şock_£rviû
(
ho¡
, 
şock_id
, 
şock_£rv
)

42 
şock_£rv
 = clock_£rv 
Ü
 
t
.
	$şock_£rv1
()

43 
loÿl
 
ok
, 
”r
 = 
C
.
	`ho¡_g‘_şock_£rviû
(
ho¡
 
Ü
 
S
.
	`mach_ho¡_£lf
(), 
c
.
CLOCKTYPE
[
şock_id
 o¸"SYSTEM"], 
şock_£rv
)

44 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


45  
şock_£rv
[0]

46 
’d


48 -- 
TODO
 
wh’
 
mach
 
pÜts
 dØ
gc
, 
ÿn
 
add
 'clock_serv or S.host_get_clock_service()'

49 
funùiÚ
 
S
.
	$şock_g‘_time
(
şock_£rv
, 
cur_time
)

50 
cur_time
 = cur_tim
Ü
 
t
.
	$mach_time¥ec
()

51 
loÿl
 
ok
, 
”r
 = 
C
.
	$şock_g‘_time
(
şock_£rv
, 
cur_time
)

52 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


53  
cur_time


54 
’d


56 -- 
ÿÂÙ
 
fšd
 
out
 
how
 
to
 
g‘
 
Ãw
 
¡©
 
ty³
 
äom
 
f¡©©


57 
funùiÚ
 
S
.
	$f¡©©
(
fd
, 
·th
, 
buf
, 
æags
)

58 
nÙ
 
buf
 
th’
 buàğ
t
.
	$¡©32
(è
’d


59 
loÿl
 
»t
, 
”r
 = 
C
.
	$f¡©©
(
c
.
AT_FDCWD
[
fd
], 
·th
, 
buf
, c.
AT
[
æags
])

60 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


61  
buf


62 
’d


64  
S


66 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/sysctl.lua

1 --
ty³s
 
OSX
 
	gsysùl
, 
šcom¶‘e
 
©
 
´e£Á


3 
loÿl
 
	g»quœe
 = 
»quœe


5 
loÿl
 
c
 = 
»quœe
 "syscall.osx.constants"

7 
loÿl
 
ty³s
 = {

8 
k”n
 = {
c
.
CTL
.
KERN
, c.KERN},

22  
	gty³s


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/types.lua

1 -- 
OSX
 
ty³s


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
ty³s
)

12 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

14 
loÿl
 
t
, 
±
, 
s
, 
ùy³s
 = 
ty³s
.t,ypes.pt,ypes.s,ypes.ctypes

16 
loÿl
 
ffi
 = 
»quœe
 "ffi"

17 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

19 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

21 
loÿl
 
addty³
, 
addty³_v¬
, 
addty³_â
, 
add¿w2
 = 
h
.addtype, h.addtype_var, h.addtype_fn, h.addraw2

22 
loÿl
 
±t
, 
»v™”
, 
mkty³
, 
i¡y³
, 
Ënâ
, 
Ënmt
, 
g‘fd
, 
Ãwâ


23 ğ
h
.
±t
, h.
»v™”
, h.
mkty³
, h.
i¡y³
, h.
Ënâ
, h.
Ënmt
, h.
g‘fd
, h.
Ãwâ


24 
loÿl
 
Áohl
,‚tohl, 
Áohs
, 
htÚs
, 
où®
 = 
h
.ntohl, h.ntohl, h.ntohs, h.htons, h.octal

26 
loÿl
 
c
 = 
»quœe
 "syscall.osx.constants"

28 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


30 
loÿl
 
addty³s
 = {

31 
fd£t
 = "fd_set",

32 
	gşock_£rv
 = "clock_serv_t",

35 
loÿl
 
	gadd¡ruùs
 = {

36 
mach_time¥ec
 = "struct mach_timespec",

39 
	gk
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


40 
k
, 
v
 
š
 
	$·œs
(
add¡ruùs
èdØ
	$addty³
(
ty³s
, 
k
, 
v
, 
Ënmt
è
’d


42 
t
.
şock_£rv1
 = 
ffi
.
	`ty³of
("clock_serv_t[1]")

44 -- 32 
b™
 
dev_t
, 24 b™ 
mšÜ
, 8 b™ 
majÜ


45 
loÿl
 
funùiÚ
 
	$makedev
(
majÜ
, 
mšÜ
)

46 
	`ty³
(
majÜ
è=ğ"bË" 
th’
 majÜ, 
mšÜ
 = majÜ[1], majÜ[2] 
’d


47 
loÿl
 
dev
 = 
majÜ
 
Ü
 0

48 
mšÜ
 
th’
 
dev
 = 
b™
.
	`bÜ
(mšÜ, b™.
	$lshiá
(
majÜ
, 24)è
’d


49  
dev


50 
’d


52 
mt
.
deviû
 = {

53 
šdex
 = {

54 
majÜ
 = 
	`funùiÚ
(
dev
è 
b™
.
	`bÜ
(b™.
	`bªd
(b™.
	`rshiá
(dev.dev, 24), 0xff)è
’d
,

55 
mšÜ
 = 
	`funùiÚ
(
dev
è 
b™
.
	`bªd
(dev.dev, 0xffffffè
’d
,

56 
deviû
 = 
	`funùiÚ
(
dev
è 
	`tÚumb”
(dev.devè
’d
,

58 
Ãwšdex
 = {

59 
deviû
 = 
	`funùiÚ
(
dev
, 
majÜ
, 
mšÜ
èdev.dev = 
	`makedev
(majÜ, mšÜè
’d
,

61 
__Ãw
 = 
	`funùiÚ
(

, 
majÜ
, 
mšÜ
)

62  
ffi
.
	`Ãw
(

, 
	`makedev
(
majÜ
, 
mšÜ
))

63 
’d
,

64 
	}
}

66 
addty³
(
ty³s
, "deviû", "¡ruù {dev_ˆdev;}", 
mt
.
deviû
)

68 
funùiÚ
 
	gt
.
	$§
(
addr
, 
add¾’
è‡dd¸
’d
 -- 
nÚ
 
Lšux
 
is
 
ŒivŸl
, Lšux 
has
 
odd
 
unix
 
hªdlšg


70 
mt
.
¡©
 = {

71 
šdex
 = {

72 
dev
 = 
	`funùiÚ
(
¡
è 
t
.
	`deviû
(¡.
¡_dev
è
’d
,

73 
mode
 = 
	`funùiÚ
(
¡
è st.
¡_mode
 
’d
,

74 
šo
 = 
	`funùiÚ
(
¡
è 
	`tÚumb”
(¡.
¡_šo
è
’d
,

75 
Æšk
 = 
	`funùiÚ
(
¡
è st.
¡_Æšk
 
’d
,

76 
uid
 = 
	`funùiÚ
(
¡
è st.
¡_uid
 
’d
,

77 
gid
 = 
	`funùiÚ
(
¡
è st.
¡_gid
 
’d
,

78 
rdev
 = 
	`funùiÚ
(
¡
è 
t
.
	`deviû
(¡.
¡_rdev
è
’d
,

79 
©ime
 = 
	`funùiÚ
(
¡
è st.
¡_©ime¥ec
.
time
 
’d
,

80 
ùime
 = 
	`funùiÚ
(
¡
è st.
¡_ùime¥ec
.
time
 
’d
,

81 
mtime
 = 
	`funùiÚ
(
¡
è st.
¡_mtime¥ec
.
time
 
’d
,

82 
bœthtime
 = 
	`funùiÚ
(
¡
è st.
¡_bœthtime¥ec
.
time
 
’d
,

83 
size
 = 
	`funùiÚ
(
¡
è 
	`tÚumb”
(¡.
¡_size
è
’d
,

84 
blocks
 = 
	`funùiÚ
(
¡
è 
	`tÚumb”
(¡.
¡_blocks
è
’d
,

85 
blksize
 = 
	`funùiÚ
(
¡
è 
	`tÚumb”
(¡.
¡_blksize
è
’d
,

86 
æags
 = 
	`funùiÚ
(
¡
è st.
¡_æags
 
’d
,

87 
g’
 = 
	`funùiÚ
(
¡
è st.
¡_g’
 
’d
,

89 
ty³
 = 
	`funùiÚ
(
¡
è 
b™
.
	`bªd
(¡.
¡_mode
, 
c
.
S_I
.
FMT
è
’d
,

90 
todt
 = 
	`funùiÚ
(
¡
è 
b™
.
	`rshiá
(¡.
ty³
, 12è
’d
,

91 
i¤eg
 = 
	`funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FREG
 
’d
,

92 
isdœ
 = 
	`funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FDIR
 
’d
,

93 
ischr
 = 
	`funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FCHR
 
’d
,

94 
isblk
 = 
	`funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FBLK
 
’d
,

95 
isfifo
 = 
	`funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FIFO
 
’d
,

96 
i¦nk
 = 
	`funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FLNK
 
’d
,

97 
issock
 = 
	`funùiÚ
(
¡
è st.
ty³
 =ğ
c
.
S_I
.
FSOCK
 
’d
,

99 
	}
}

101 -- 
add
 
some
 
ä›ndl›r
 
Çmes
 
to
 
	g¡©
, 
®so
 
luafesy¡em
 
com·tib™y


102 
	gmt
.
	g¡©
.
	gšdex
.
	gacûss
 = 
mt
.
¡©
.
šdex
.
©ime


103 
mt
.
¡©
.
šdex
.
modifiÿtiÚ
 = mt.¡©.šdex.
mtime


104 
mt
.
¡©
.
šdex
.
chªge
 = mt.¡©.šdex.
ùime


106 
loÿl
 
Çmem­
 = {

107 
fe
 = 
mt
.
¡©
.
šdex
.
i¤eg
,

108 
	gdœeùÜy
 = 
mt
.
¡©
.
šdex
.
isdœ
,

109 
	glšk
 = 
mt
.
¡©
.
šdex
.
i¦nk
,

110 
	gsock‘
 = 
mt
.
¡©
.
šdex
.
issock
,

111 ["ch¬ deviû"] = 
mt
.
¡©
.
šdex
.
ischr
,

112 ["block deviû"] = 
mt
.
¡©
.
šdex
.
isblk
,

113 ["Çmed…e"] = 
mt
.
¡©
.
šdex
.
isfifo
,

116 
	gmt
.
	g¡©
.
	gšdex
.
	gty³Çme
 = 
	$funùiÚ
(
¡
)

117 
k
, 
v
 
š
 
	$·œs
(
Çmem­
èdØ
	$v
(
¡
è
th’
  
k
 
’d
ƒnd

119 
’d


121 
	`addty³
(
ty³s
, "¡©", "¡ruù st", 
mt
.
¡©
)

123 -- 
f¡©©
 
wh”e
 
we
 
ÿn
'tseemo get 64 bit version‡t…resent

124 
	`addty³
(
ty³s
, "¡©32", "¡ruù st32", 
mt
.
¡©
)

126 
loÿl
 
sigÇmes
 = {
	}
}

127 
loÿl
 
du¶iÿ‹s
 = {
LWT
 = 
Œue
, 
	gIOT
 =rue, 
	gCLD
 =rue, 
	gPOLL
 =rue}

128 
	gk
, 
v
 
š
 
	$·œs
(
c
.
SIG
) do

129 
nÙ
 
du¶iÿ‹s
[
k
] 
th’
 
sigÇmes
[
v
] = k 
’d


130 
’d


132 
mt
.
sigšfo
 = {

133 
šdex
 = {

134 
signo
 = 
	`funùiÚ
(
s
è s.
si_signo
 
’d
,

135 
”ºo
 = 
	`funùiÚ
(
s
è s.
si_”ºo
 
’d
,

136 
code
 = 
	`funùiÚ
(
s
è s.
si_code
 
’d
,

137 
pid
 = 
	`funùiÚ
(
s
è s.
si_pid
 
’d
,

138 
uid
 = 
	`funùiÚ
(
s
è s.
si_uid
 
’d
,

139 
¡©us
 = 
	`funùiÚ
(
s
è s.
si_¡©us
 
’d
,

140 
addr
 = 
	`funùiÚ
(
s
è s.
si_addr
 
’d
,

141 
v®ue
 = 
	`funùiÚ
(
s
è s.
si_v®ue
 
’d
,

142 
bªd
 = 
	`funùiÚ
(
s
è s.
si_bªd
 
’d
,

143 
sigÇme
 = 
	`funùiÚ
(
s
è 
sigÇmes
[s.
signo
] 
’d
,

145 
Ãwšdex
 = {

146 
signo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_signo
 = v 
’d
,

147 
”ºo
 = 
	`funùiÚ
(
s
, 
v
ès.
si_”ºo
 = v 
’d
,

148 
code
 = 
	`funùiÚ
(
s
, 
v
ès.
si_code
 = v 
’d
,

149 
pid
 = 
	`funùiÚ
(
s
, 
v
ès.
si_pid
 = v 
’d
,

150 
uid
 = 
	`funùiÚ
(
s
, 
v
ès.
si_uid
 = v 
’d
,

151 
¡©us
 = 
	`funùiÚ
(
s
, 
v
ès.
si_¡©us
 = v 
’d
,

152 
addr
 = 
	`funùiÚ
(
s
, 
v
ès.
si_addr
 = v 
’d
,

153 
v®ue
 = 
	`funùiÚ
(
s
, 
v
ès.
si_v®ue
 = v 
’d
,

154 
bªd
 = 
	`funùiÚ
(
s
, 
v
ès.
si_bªd
 = v 
’d
,

156 
__Ën
 = 
Ënâ
,

157 
	}
}

159 
addty³
(
ty³s
, "sigšfo", "sigšfo_t", 
mt
.
sigšfo
)

161 
	gmt
.
	gdœ’t
 = {

162 
šdex
 = {

163 
šo
 = 
funùiÚ
(
£lf
è s–f.
d_šo
 
’d
,

164 --
	g£ekoff
 = 
funùiÚ
(
£lf
è s–f.
d_£ekoff
 
’d
, -- 
nÙ
 
š
 
Ëgacy
 
dœ’t


165 
	g»ş’
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

166 
	gÇmËn
 = 
funùiÚ
(
£lf
è s–f.
d_ÇmËn
 
’d
,

167 
	gty³
 = 
funùiÚ
(
£lf
è s–f.
d_ty³
 
’d
,

168 
	gÇme
 = 
funùiÚ
(
£lf
è 
ffi
.
¡ršg
(£lf.
d_Çme
, s–f.
d_ÇmËn
è
	g’d
,

169 
	gtoif
 = 
funùiÚ
(
£lf
è 
b™
.
lshiá
(£lf.
d_ty³
, 12è
	g’d
, -- 
cÚv”t
 
to
 
¡©
 
	gty³s


171 
	g__Ën
 = 
funùiÚ
(
£lf
è s–f.
d_»ş’
 
’d
,

174 
	gk
, 
v
 
š
 
	$·œs
(
c
.
DT
) do

175 
mt
.
dœ’t
.
šdex
[
k
] = 
	$funùiÚ
(
£lf
è s–f.
ty³
 =ğ
v
 
’d


176 
’d


178 
	`addty³
(
ty³s
, "dœ’t", "¡ruù†egacy_dœ’t", 
mt
.
dœ’t
)

180 
mt
.
æock
 = {

181 
šdex
 = {

182 
ty³
 = 
	`funùiÚ
(
£lf
è s–f.
l_ty³
 
’d
,

183 
wh’û
 = 
	`funùiÚ
(
£lf
è s–f.
l_wh’û
 
’d
,

184 
¡¬t
 = 
	`funùiÚ
(
£lf
è s–f.
l_¡¬t
 
’d
,

185 
Ën
 = 
	`funùiÚ
(
£lf
è s–f.
l_Ën
 
’d
,

186 
pid
 = 
	`funùiÚ
(
£lf
è s–f.
l_pid
 
’d
,

188 
Ãwšdex
 = {

189 
ty³
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_ty³
 = 
c
.
FCNTL_LOCK
[v] 
’d
,

190 
wh’û
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_wh’û
 = 
c
.
SEEK
[v] 
’d
,

191 
¡¬t
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_¡¬t
 = v 
’d
,

192 
Ën
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_Ën
 = v 
’d
,

193 
pid
 = 
	`funùiÚ
(
£lf
, 
v
è£lf.
l_pid
 = v 
’d
,

195 
__Ãw
 = 
Ãwâ
,

196 
	}
}

198 
addty³
(
ty³s
, "æock", "¡ruù flock", 
mt
.
æock
)

200 -- 
TODO
 
£e
 
Lšux
 
	gnÙes
. 
Also
 
maybe
 
ÿn
 
be
 
sh¬ed
 
w™h
 
	gBSDs
, 
have
 
nÙ
 
checked
 
´İ”ly


201 
	gmt
.
	gwa™
 = {

202 
__šdex
 = 
funùiÚ
(
w
, 
k
)

203 
loÿl
 
	g_WSTATUS
 = 
b™
.
bªd
(
w
.
¡©us
, 
où®
("0177"))

204 
loÿl
 
	g_WSTOPPED
 = 
où®
("0177")

205 
loÿl
 
WTERMSIG
 = 
_WSTATUS


206 
loÿl
 
EXITSTATUS
 = 
b™
.
bªd
(b™.
rshiá
(
w
.
¡©us
, 8), 0xff)

207 
loÿl
 
	gWIFEXITED
 = (
_WSTATUS
 == 0)

208 
loÿl
 
b
 = {

209 
WIFEXITED
 = WIFEXITED,

210 
	gWIFSTOPPED
 = 
b™
.
bªd
(
w
.
¡©us
, 0xffè=ğ
_WSTOPPED
,

211 
	gWIFSIGNALED
 = 
_WSTATUS
 ~ğ
_WSTOPPED
 
ªd
 _WSTATUS ~= 0

213 
	gb
.
WIFEXITED
 
th’
ab.
	gEXITSTATUS
 = 
EXITSTATUS
 
’d


214 
b
.
WIFSTOPPED
 
th’
ab.
WSTOPSIG
 = 
EXITSTATUS
 
’d


215 
b
.
WIFSIGNALED
 
th’
ab.
WTERMSIG
 = WTERMSIG 
’d


216 
b
[
k
] 
th’
 ab[k] 
’d


217 
loÿl
 
uc
 = 'W' .. 
k
:
uµ”
()

218 
b
[
uc
] 
th’
 ab[uc] 
’d


219 
’d


222 
funùiÚ
 
t
.
	$wa™¡©us
(
¡©us
)

223  
	`£tm‘©abË
({
¡©us
 = 
	}
¡©us}, 
	gmt
.
	gwa™
)

224 
	g’d


226 -- 
	gsigaùiÚ
, 
¡ªd¬d
 
POSIX
 
behaviour
 
w™h
 
of
 
hªdËr
 
ªd
 
sigaùiÚ


227 
addty³_â
(
ty³s
, "sa_sigaction", "void (*)(int, siginfo_t *, void *)")

229 
	gmt
.
	gsigaùiÚ
 = {

230 
šdex
 = {

231 
hªdËr
 = 
funùiÚ
(
§
è sa.
__sigaùiÚ_u
.
__§_hªdËr
 
’d
,

232 
	gsigaùiÚ
 = 
funùiÚ
(
§
è sa.
__sigaùiÚ_u
.
__§_sigaùiÚ
 
’d
,

233 
	gmask
 = 
funùiÚ
(
§
è sa.
§_mask
 
’d
,

234 
	gæags
 = 
funùiÚ
(
§
è 
tÚumb”
(§.
§_æags
è
’d
,

236 
	gÃwšdex
 = {

237 
hªdËr
 = 
funùiÚ
(
§
, 
v
)

238 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


239 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


240 
§
.
__sigaùiÚ_u
.
__§_hªdËr
 = 
v


241 
’d
,

242 
	gsigaùiÚ
 = 
funùiÚ
(
§
, 
v
)

243 
ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
±
.(
c
.
SIGACT
[v]è
’d


244 
ty³
(
v
è=ğ"numb”" 
th’
 v = 
±
.(vè
’d


245 
§
.
__sigaùiÚ_u
.
__§_sigaùiÚ
 = 
v


246 
’d
,

247 
	gmask
 = 
funùiÚ
(
§
, 
v
)

248 
nÙ
 
	gffi
.
i¡y³
(
t
.
sig£t
, 
v
è
th’
 
	gv
 =.sig£t(vè
’d


249 
§
.
§_mask
 = 
v


250 
’d
,

251 
	gæags
 = 
funùiÚ
(
§
, 
v
è
	g§
.
	g§_æags
 = 
c
.
SA
[v] 
’d
,

253 
	g__Ãw
 = 
funùiÚ
(

, 
b
)

254 
loÿl
 
	g§
 = 
ffi
.
Ãw
(

)

255 
b
 
th’
 
k
, 
v
 
š
 
·œs
ÑabèdØ
	g§
[k] = v 
’d
ƒnd

256 
b
 
ªd
ab.
sigaùiÚ
 
th’
 
§
.
§_æags
 = 
b™
.
bÜ
(§.
æags
, 
c
.
SA
.
SIGINFO
è
	g’d
 -- 
this
 
æag
 
mu¡
 
be
 
£t
 sigaction set

257  
§


258 
	g’d
,

261 
addty³
(
ty³s
, "sigaùiÚ", "¡ruù sigaùiÚ", 
mt
.
sigaùiÚ
)

263  
ty³s


265 
’d


267  {
	gš™
 = 
š™
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/util.lua

1 -- 
osx
 
uts


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
funùiÚ
 
	$š™
(
S
)

12 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

13 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

15 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

17 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
où®
 = 
h
.octal

21 
loÿl
 
ut
 = {
	}
}

23 
loÿl
 
mt
 = {}

26  
ut


28 
’d


30  {
š™
 = init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/rump/c.lua

1 -- 
defše
 
C
 
funùiÚs
 
	grump


3 -- 
TODO
 
m”ge
 
što
 
N‘BSD
 
	gÚes
, 
g’”©e


5 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

6 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

7 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

8 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

9 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

10 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


12 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

14 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

15 
loÿl
 
”r64
 = 
h
.err64

16 
loÿl
 
”½oš‹r
 = 
h
.errpointer

18 
loÿl
 
ffi
 = 
»quœe
 "ffi"

20 
loÿl
 
cdef


22 
abi
.
ty³s
 =ğabi.
ho¡
 
Ü
‡bi.ty³ =ğ"lšux" 
th’
 --y³ 
§me
 
Ú
 ho¡ 
ªd
 
rump
 o¸
usšg
 
Lšux
 
so
 
no
 
»Çmšg


23 
cdef
 = 
	$funùiÚ
(
s
)

24 
s
 = 
¡ršg
.
	`gsub
(s, "_netbsd_", "")

25 
ffi
.
	$cdef
(
s
)

26 
’d


28 
cdef
 = 
ffi
.cdeà-- 
u£
 
as
 
´ovided


29 
’d


31 
cdef
 [[

32 
ssize_t
 
	`rump___sysim¶_»ad
(, *, 
size_t
);

33 
ssize_t
 
	`rump___sysim¶_wr™e
(, cÚ¡ *, 
size_t
);

34 
	`rump___sysim¶_İ’
(cÚ¡ *, , 
_Ãtbsd_mode_t
);

35 
	`rump___sysim¶_şo£
();

36 
	`rump___sysim¶_lšk
(const *, const *);

37 
	`rump___sysim¶_uÆšk
(const *);

38 
	`rump___sysim¶_chdœ
(const *);

39 
	`rump___sysim¶_fchdœ
();

40 
	`rump___sysim¶_mknod50
(cÚ¡ *, 
_Ãtbsd_mode_t
, 
_Ãtbsd_dev_t
);

41 
	`rump___sysim¶_chmod
(cÚ¡ *, 
_Ãtbsd_mode_t
);

42 
	`rump___sysim¶_chown
(cÚ¡ *, 
uid_t
, 
gid_t
);

43 
pid_t
 
	`rump___sysim¶_g‘pid
();

44 
	`rump___sysim¶_unmouÁ
(const *, );

45 
	`rump___sysim¶_£tuid
(
uid_t
);

46 
uid_t
 
	`rump___sysim¶_g‘uid
();

47 
uid_t
 
	`rump___sysim¶_g‘euid
();

48 
ssize_t
 
	`rump___sysim¶_»cvmsg
(, 
_Ãtbsd_msghdr
 *, );

49 
ssize_t
 
	`rump___sysim¶_£ndmsg
(, cÚ¡ 
_Ãtbsd_msghdr
 *, );

50 
ssize_t
 
	`rump___sysim¶_»cväom
(, *, 
size_t
, , 
_Ãtbsd_sockaddr
 *, 
sockËn_t
 *);

51 
	`rump___sysim¶_acû±
(, 
_Ãtbsd_sockaddr
 *, 
sockËn_t
 *);

52 
	`rump___sysim¶_g‘³”Çme
(, 
_Ãtbsd_sockaddr
 *, 
sockËn_t
 *);

53 
	`rump___sysim¶_g‘sockÇme
(, 
_Ãtbsd_sockaddr
 *, 
sockËn_t
 *);

54 
	`rump___sysim¶_acûss
(const *, );

55 
	`rump___sysim¶_chæags
(const *, );

56 
	`rump___sysim¶_fchæags
(, );

57 
	`rump___sysim¶_sync
();

58 
pid_t
 
	`rump___sysim¶_g‘µid
();

59 
	`rump___sysim¶_dup
();

60 
gid_t
 
	`rump___sysim¶_g‘egid
();

61 
gid_t
 
	`rump___sysim¶_g‘gid
();

62 
	`rump___sysim¶___g‘logš
(*, 
size_t
);

63 
	`rump___sysim¶___£ogš
(const *);

64 
	`rump___sysim¶_ioùl
(, , *);

65 
	`rump___sysim¶_»voke
(const *);

66 
	`rump___sysim¶_symlšk
(const *, const *);

67 
ssize_t
 
	`rump___sysim¶_»adlšk
(cÚ¡ *, *, 
size_t
);

68 
_Ãtbsd_mode_t
 
	`rump___sysim¶_umask
(_netbsd_mode_t);

69 
	`rump___sysim¶_chroÙ
(const *);

70 
	`rump___sysim¶_g‘groups
(, 
gid_t
 *);

71 
	`rump___sysim¶_£tgroups
(, cÚ¡ 
gid_t
 *);

72 
	`rump___sysim¶_g‘pg½
();

73 
	`rump___sysim¶_£gid
(
pid_t
,…id_t);

74 
	`rump___sysim¶_dup2
(, );

75 
	`rump___sysim¶_fú
(, , ...);

76 
	`rump___sysim¶_£Ëù50
(, 
_Ãtbsd_fd_£t
 *, _Ãtbsd_fd_£ˆ*, _Ãtbsd_fd_£ˆ*, 
_Ãtbsd_timev®
 *);

77 
	`rump___sysim¶_fsync
();

78 
	`rump___sysim¶_cÚÃù
(, cÚ¡ 
_Ãtbsd_sockaddr
 *, 
sockËn_t
);

79 
	`rump___sysim¶_bšd
(, cÚ¡ 
_Ãtbsd_sockaddr
 *, 
sockËn_t
);

80 
	`rump___sysim¶_£tsockİt
(, , , cÚ¡ *, 
sockËn_t
);

81 
	`rump___sysim¶_li¡’
(, );

82 
	`rump___sysim¶_g‘sockİt
(, , , *, 
sockËn_t
 *);

83 
ssize_t
 
	`rump___sysim¶_»adv
(, cÚ¡ 
iovec
 *, );

84 
ssize_t
 
	`rump___sysim¶_wr™ev
(, cÚ¡ 
iovec
 *, );

85 
	`rump___sysim¶_fchown
(, 
uid_t
, 
gid_t
);

86 
	`rump___sysim¶_fchmod
(, 
_Ãtbsd_mode_t
);

87 
	`rump___sysim¶_£Œeuid
(
uid_t
, uid_t);

88 
	`rump___sysim¶_£Œegid
(
gid_t
, gid_t);

89 
	`rump___sysim¶_»Çme
(const *, const *);

90 
	`rump___sysim¶_æock
(, );

91 
	`rump___sysim¶_mkfifo
(cÚ¡ *, 
_Ãtbsd_mode_t
);

92 
ssize_t
 
	`rump___sysim¶_£ndto
(, cÚ¡ *, 
size_t
, , cÚ¡ 
_Ãtbsd_sockaddr
 *, 
sockËn_t
);

93 
	`rump___sysim¶_shutdown
(, );

94 
	`rump___sysim¶_sock‘·œ
(, , , *);

95 
	`rump___sysim¶_mkdœ
(cÚ¡ *, 
_Ãtbsd_mode_t
);

96 
	`rump___sysim¶_rmdœ
(const *);

97 
	`rump___sysim¶_utimes50
(cÚ¡ *, cÚ¡ 
_Ãtbsd_timev®
 *);

98 
	`rump___sysim¶_£tsid
();

99 
	`rump___sysim¶_nfssvc
(, *);

100 
ssize_t
 
	`rump___sysim¶_´—d
(, *, 
size_t
, 
off_t
);

101 
ssize_t
 
	`rump___sysim¶_pwr™e
(, cÚ¡ *, 
size_t
, 
off_t
);

102 
	`rump___sysim¶_£tgid
(
gid_t
);

103 
	`rump___sysim¶_£‹gid
(
gid_t
);

104 
	`rump___sysim¶_£‹uid
(
uid_t
);

105 
	`rump___sysim¶_·thcÚf
(const *, );

106 
	`rump___sysim¶_å©hcÚf
(, );

107 
	`rump___sysim¶_g‘¾im™
(, 
_Ãtbsd_¾im™
 *);

108 
	`rump___sysim¶_£Œlim™
(, cÚ¡ 
_Ãtbsd_¾im™
 *);

109 
off_t
 
	`rump___sysim¶_l£ek
(, off_t, );

110 
	`rump___sysim¶_Œunÿ‹
(cÚ¡ *, 
off_t
);

111 
	`rump___sysim¶_árunÿ‹
(, 
off_t
);

112 
	`rump___sysim¶_futimes50
(, cÚ¡ 
_Ãtbsd_timev®
 *);

113 
pid_t
 
	`rump___sysim¶_g‘pgid
(pid_t);

114 
	`rump___sysim¶_»boÙ
(, *);

115 
	`rump___sysim¶_pŞl
(
_Ãtbsd_pŞlfd
 *, , );

116 
	`rump___sysim¶_fd©async
();

117 
	`rump___sysim¶_modùl
(, *);

118 
	`rump___sysim¶__k£m_š™
(, 
šŒ_t
 *);

119 
	`rump___sysim¶__k£m_İ’
(cÚ¡ *, , 
_Ãtbsd_mode_t
, , 
šŒ_t
 *);

120 
	`rump___sysim¶__k£m_uÆšk
(const *);

121 
	`rump___sysim¶__k£m_şo£
(
šŒ_t
);

122 
	`rump___sysim¶__k£m_po¡
(
šŒ_t
);

123 
	`rump___sysim¶__k£m_wa™
(
šŒ_t
);

124 
	`rump___sysim¶__k£m_Œywa™
(
šŒ_t
);

125 
	`rump___sysim¶__k£m_g‘v®ue
(
šŒ_t
, *);

126 
	`rump___sysim¶__k£m_de¡roy
(
šŒ_t
);

127 
	`rump___sysim¶__k£m_timedwa™
(
šŒ_t
, cÚ¡ 
_Ãtbsd_time¥ec
 *);

128 
	`rump___sysim¶_lchmod
(cÚ¡ *, 
_Ãtbsd_mode_t
);

129 
	`rump___sysim¶_lchown
(cÚ¡ *, 
uid_t
, 
gid_t
);

130 
	`rump___sysim¶_lutimes50
(cÚ¡ *, cÚ¡ 
_Ãtbsd_timev®
 *);

131 
pid_t
 
	`rump___sysim¶_g‘sid
(pid_t);

132 
ssize_t
 
	`rump___sysim¶_´—dv
(, cÚ¡ 
iovec
 *, , 
off_t
);

133 
ssize_t
 
	`rump___sysim¶_pwr™ev
(, cÚ¡ 
iovec
 *, , 
off_t
);

134 
	`rump___sysim¶___g‘cwd
(*, 
size_t
);

135 
	`rump___sysim¶_fchroÙ
();

136 
	`rump___sysim¶_lchæags
(const *, );

137 
	`rump___sysim¶_is£tugid
();

138 
	`rump___sysim¶_kqueue
();

139 
	`rump___sysim¶_kev’t50
(, cÚ¡ 
_Ãtbsd_kev’t
 *, 
size_t
, _Ãtbsd_kev’ˆ*, size_t, cÚ¡ 
_Ãtbsd_time¥ec
 *);

140 
	`rump___sysim¶_fsync_¿nge
(, , 
off_t
, off_t);

141 
	`rump___sysim¶_g‘vfs¡©
(
_Ãtbsd_¡©vfs
 *, 
size_t
, );

142 
	`rump___sysim¶_¡©vfs1
(cÚ¡ *, 
_Ãtbsd_¡©vfs
 *, );

143 
	`rump___sysim¶_f¡©vfs1
(, 
_Ãtbsd_¡©vfs
 *, );

144 
	`rump___sysim¶_ex‰rùl
(const *, , const *, , const *);

145 
	`rump___sysim¶_ex‰r_£t_fe
(cÚ¡ *, , cÚ¡ *, cÚ¡ *, 
size_t
);

146 
ssize_t
 
	`rump___sysim¶_ex‰r_g‘_fe
(cÚ¡ *, , cÚ¡ *, *, 
size_t
);

147 
	`rump___sysim¶_ex‰r_d–‘e_fe
(const *, , const *);

148 
	`rump___sysim¶_ex‰r_£t_fd
(, , cÚ¡ *, cÚ¡ *, 
size_t
);

149 
ssize_t
 
	`rump___sysim¶_ex‰r_g‘_fd
(, , cÚ¡ *, *, 
size_t
);

150 
	`rump___sysim¶_ex‰r_d–‘e_fd
(, , const *);

151 
	`rump___sysim¶_ex‰r_£t_lšk
(cÚ¡ *, , cÚ¡ *, cÚ¡ *, 
size_t
);

152 
ssize_t
 
	`rump___sysim¶_ex‰r_g‘_lšk
(cÚ¡ *, , cÚ¡ *, *, 
size_t
);

153 
	`rump___sysim¶_ex‰r_d–‘e_lšk
(const *, , const *);

154 
ssize_t
 
	`rump___sysim¶_ex‰r_li¡_fd
(, , *, 
size_t
);

155 
ssize_t
 
	`rump___sysim¶_ex‰r_li¡_fe
(cÚ¡ *, , *, 
size_t
);

156 
ssize_t
 
	`rump___sysim¶_ex‰r_li¡_lšk
(cÚ¡ *, , *, 
size_t
);

157 
	`rump___sysim¶_p£Ëù50
(, 
_Ãtbsd_fd_£t
 *, _Ãtbsd_fd_£ˆ*, _Ãtbsd_fd_£ˆ*, cÚ¡ 
_Ãtbsd_time¥ec
 *, cÚ¡ 
_Ãtbsd_sig£t_t
 *);

158 
	`rump___sysim¶_pŞÉs50
(
_Ãtbsd_pŞlfd
 *, , cÚ¡ 
_Ãtbsd_time¥ec
 *, cÚ¡ 
_Ãtbsd_sig£t_t
 *);

159 
	`rump___sysim¶_£tx©Œ
(cÚ¡ *, cÚ¡ *, cÚ¡ *, 
size_t
, );

160 
	`rump___sysim¶_l£tx©Œ
(cÚ¡ *, cÚ¡ *, cÚ¡ *, 
size_t
, );

161 
	`rump___sysim¶_f£tx©Œ
(, cÚ¡ *, cÚ¡ *, 
size_t
, );

162 
	`rump___sysim¶_g‘x©Œ
(cÚ¡ *, cÚ¡ *, *, 
size_t
);

163 
	`rump___sysim¶_lg‘x©Œ
(cÚ¡ *, cÚ¡ *, *, 
size_t
);

164 
	`rump___sysim¶_fg‘x©Œ
(, cÚ¡ *, *, 
size_t
);

165 
	`rump___sysim¶_li¡x©Œ
(cÚ¡ *, *, 
size_t
);

166 
	`rump___sysim¶_Îi¡x©Œ
(cÚ¡ *, *, 
size_t
);

167 
	`rump___sysim¶_æi¡x©Œ
(, *, 
size_t
);

168 
	`rump___sysim¶_»movex©Œ
(const *, const *);

169 
	`rump___sysim¶_Ìemovex©Œ
(const *, const *);

170 
	`rump___sysim¶_äemovex©Œ
(, const *);

171 
	`rump___sysim¶_¡©50
(cÚ¡ *, 
_Ãtbsd_¡©
 *);

172 
	`rump___sysim¶_f¡©50
(, 
_Ãtbsd_¡©
 *);

173 
	`rump___sysim¶_l¡©50
(cÚ¡ *, 
_Ãtbsd_¡©
 *);

174 
	`rump___sysim¶_g‘d’ts30
(, *, 
size_t
);

175 
	`rump___sysim¶_sock‘30
(, , );

176 
	`rump___sysim¶_g‘fh30
(cÚ¡ *, *, 
size_t
 *);

177 
	`rump___sysim¶_fhİ’40
(cÚ¡ *, 
size_t
, );

178 
	`rump___sysim¶_fh¡©vfs140
(cÚ¡ *, 
size_t
, 
_Ãtbsd_¡©vfs
 *, );

179 
	`rump___sysim¶_fh¡©50
(cÚ¡ *, 
size_t
, 
_Ãtbsd_¡©
 *);

180 
	`rump___sysim¶_mouÁ50
(cÚ¡ *, cÚ¡ *, , *, 
size_t
);

181 
	`rump___sysim¶_posix_çdvi£50
(, 
off_t
, off_t, );

182 
	`rump___sysim¶_pe2
(*, );

183 
	`rump___sysim¶_dup3
(, , );

184 
	`rump___sysim¶_kqueue1
();

185 
	`rump___sysim¶_·cû±
(, 
_Ãtbsd_sockaddr
 *, 
sockËn_t
 *, cÚ¡ 
_Ãtbsd_sig£t_t
 *, );

186 
	`rump___sysim¶_lšk©
(, const *, , const *, );

187 
	`rump___sysim¶_»Çm—t
(, const *, , const *);

188 
	`rump___sysim¶_mkfifßt
(, cÚ¡ *, 
_Ãtbsd_mode_t
);

189 
	`rump___sysim¶_mknod©
(, cÚ¡ *, 
_Ãtbsd_mode_t
, 
_Ãtbsd_dev_t
);

190 
	`rump___sysim¶_mkdœ©
(, cÚ¡ *, 
_Ãtbsd_mode_t
);

191 
	`rump___sysim¶_çcûs§t
(, const *, , );

192 
	`rump___sysim¶_fchmod©
(, cÚ¡ *, 
_Ãtbsd_mode_t
, );

193 
	`rump___sysim¶_fchowÇt
(, cÚ¡ *, 
uid_t
, 
gid_t
, );

194 
	`rump___sysim¶_f¡©©
(, cÚ¡ *, 
_Ãtbsd_¡©
 *, );

195 
	`rump___sysim¶_utim’§t
(, cÚ¡ *, cÚ¡ 
_Ãtbsd_time¥ec
 *, );

196 
	`rump___sysim¶_İ’©
(, const *, , );

197 
	`rump___sysim¶_»adlšk©
(, cÚ¡ *, *, 
size_t
);

198 
	`rump___sysim¶_symlšk©
(const *, , const *);

199 
	`rump___sysim¶_uÆšk©
(, const *, );

200 
	`rump___sysim¶_futim’s
(, cÚ¡ 
_Ãtbsd_time¥ec
 *);

201 
	`rump___sysim¶___quÙaùl
(cÚ¡ *, 
_Ãtbsd_quÙaùl_¬gs
 *);

202 
	`rump___sysim¶_kŒaû
(cÚ¡ *
Œaûfe
, 
İs
, 
Œpošts
, 
pid_t
 
pid
);

203 
	`rump___sysim¶_fkŒaû
(
fd
, 
İs
, 
Œpošts
, 
pid_t
 
pid
);

204 
	`rump___sysim¶_uŒaû
(cÚ¡ *, *, 
size_t
);

205 
	`rump___sysim¶_»cvmmsg
(, 
_Ãtbsd_mmsghdr
 *, , , 
_Ãtbsd_time¥ec
 *);

206 
	`rump___sysim¶_£ndmmsg
(, 
_Ãtbsd_mmsghdr
 *, , );

208 
	`rump___sysim¶_g‘timeofday50
(
_Ãtbsd_timev®
 *, *);

209 
	`rump___sysim¶_£‰imeofday50
(cÚ¡ 
_Ãtbsd_timev®
 *, const *);

210 
	`rump___sysim¶_adjtime50
(cÚ¡ 
_Ãtbsd_timev®
 *, _netbsd_timeval *);

211 
	`rump___sysim¶_£t™im”50
(, cÚ¡ 
_Ãtbsd_™im”v®
 *, _netbsd_itimerval *);

212 
	`rump___sysim¶_g‘™im”50
(, 
_Ãtbsd_™im”v®
 *);

213 
	`rump___sysim¶_şock_g‘time50
(
_Ãtbsd_şockid_t
, 
_Ãtbsd_time¥ec
 *);

214 
	`rump___sysim¶_şock_£‰ime50
(
_Ãtbsd_şockid_t
, cÚ¡ 
_Ãtbsd_time¥ec
 *);

215 
	`rump___sysim¶_şock_g‘»s50
(
_Ãtbsd_şockid_t
, 
_Ãtbsd_time¥ec
 *);

216 
	`rump___sysim¶_Çno¦“p50
(cÚ¡ 
_Ãtbsd_time¥ec
 *, _netbsd_timespec *);

217 
	`rump___sysim¶_tim”_£‰ime50
(
_Ãtbsd_tim”_t
, , cÚ¡ 
_Ãtbsd_™im”¥ec
 *, _netbsd_itimerspec *);

218 
	`rump___sysim¶_tim”_g‘time50
(
_Ãtbsd_tim”_t
, 
_Ãtbsd_™im”¥ec
 *);

219 
	`rump___sysim¶_şock_Çno¦“p
(
_Ãtbsd_şockid_t
, , cÚ¡ 
_Ãtbsd_time¥ec
 *, _netbsd_timespec *);

220 
	`rump___sysim¶_tim”_ü—‹
(
_Ãtbsd_şockid_t
, 
_Ãtbsd_sigev’t
 *, 
_Ãtbsd_tim”_t
 *);

221 
	`rump___sysim¶_tim”_d–‘e
(
_Ãtbsd_tim”_t
);

222 
	`rump___sysim¶_tim”_g‘ov”run
(
_Ãtbsd_tim”_t
);

224 
	`rump___sysim¶_aio_ÿnûl
(, 
aiocb
 *);

225 
	`rump___sysim¶_aio_”rÜ
(cÚ¡ 
aiocb
 *);

226 
	`rump___sysim¶_aio_fsync
(, 
aiocb
 *);

227 
	`rump___sysim¶_aio_»ad
(
aiocb
 *);

228 
	`rump___sysim¶_aio_»tuº
(
aiocb
 *);

229 
	`rump___sysim¶_aio_wr™e
(
aiocb
 *);

230 
	`rump___sysim¶_lio_li¡io
(, 
aiocb
 *cÚ¡ *, , 
sigev’t
 *);

231 
	`rump___sysim¶_aio_su¥’d
(cÚ¡ 
aiocb
 *cÚ¡ *, , cÚ¡ 
time¥ec
 *);

233 
	`rump___sysim¶___sysùl
(cÚ¡ *, , *, 
size_t
 *, const *, size_t);

235 
	`rump_sys_pe
(*);

238 
loÿl
 
şi¡
 = {

239 
acû±
 = "accept",

240 
acûss
 = "access",

241 
bšd
 = "bind",

242 
chdœ
 = "chdir",

243 
chæags
 = "chflags",

244 
chmod
 = "chmod",

245 
chown
 = "chown",

246 
chroÙ
 = "chroot",

247 
şo£
 = "close",

248 
cÚÃù
 = "connect",

249 
dup2
 = "dup2",

250 
dup3
 = "dup3",

251 
dup
 = "dup",

252 
ex‰rùl
 = "extattrctl",

253 
ex‰r_d–‘e_fd
 = "extattr_delete_fd",

254 
ex‰r_d–‘e_fe
 = "extattr_delete_file",

255 
ex‰r_d–‘e_lšk
 = "extattr_delete_link",

256 
ex‰r_g‘_fd
 = "extattr_get_fd",

257 
ex‰r_g‘_fe
 = "extattr_get_file",

258 
ex‰r_g‘_lšk
 = "extattr_get_link",

259 
ex‰r_li¡_fd
 = "extattr_list_fd",

260 
ex‰r_li¡_fe
 = "extattr_list_file",

261 
ex‰r_li¡_lšk
 = "extattr_list_link",

262 
ex‰r_£t_fd
 = "extattr_set_fd",

263 
ex‰r_£t_fe
 = "extattr_set_file",

264 
ex‰r_£t_lšk
 = "extattr_set_link",

265 
çcûs§t
 = "faccessat",

266 
fchdœ
 = "fchdir",

267 
fchæags
 = "fchflags",

268 
fchmod©
 = "fchmodat",

269 
fchmod
 = "fchmod",

270 
fchowÇt
 = "fchownat",

271 
fchown
 = "fchown",

272 
fchroÙ
 = "fchroot",

273 
fú
 = "fcntl",

274 
fd©async
 = "fdatasync",

275 
fg‘x©Œ
 = "fgetxattr",

276 
fkŒaû
 = "fktrace",

277 
æi¡x©Œ
 = "flistxattr",

278 
æock
 = "flock",

279 
å©hcÚf
 = "fpathconf",

280 
äemovex©Œ
 = "fremovexattr",

281 
f£tx©Œ
 = "fsetxattr",

282 
f¡©©
 = "fstatat",

283 
f¡©vfs1
 = "fstatvfs1",

284 
fsync_¿nge
 = "fsync_range",

285 
fsync
 = "fsync",

286 
árunÿ‹
 = "ftruncate",

287 
futim’s
 = "futimens",

288 
g‘cwd
 = "__getcwd",

289 
g‘egid
 = "getegid",

290 
g‘euid
 = "geteuid",

291 
g‘gid
 = "getgid",

292 
g‘groups
 = "getgroups",

293 
__g‘logš
 = "__getlogin",

294 
g‘³”Çme
 = "getpeername",

295 
g‘pgid
 = "getpgid",

296 
g‘pg½
 = "getpgrp",

297 
g‘pid
 = "getpid",

298 
g‘µid
 = "getppid",

299 
g‘¾im™
 = "getrlimit",

300 
g‘sid
 = "getsid",

301 
g‘sockÇme
 = "getsockname",

302 
g‘sockİt
 = "getsockopt",

303 
g‘uid
 = "getuid",

304 
g‘vfs¡©
 = "getvfsstat",

305 
g‘x©Œ
 = "getxattr",

306 
ioùl
 = "ioctl",

307 
is£tugid
 = "issetugid",

308 
kqueue1
 = "kqueue1",

309 
kqueue
 = "kqueue",

310 
_k£m_şo£
 = "_ksem_close",

311 
_k£m_de¡roy
 = "_ksem_destroy",

312 
_k£m_g‘v®ue
 = "_ksem_getvalue",

313 
_k£m_š™
 = "_ksem_init",

314 
_k£m_İ’
 = "_ksem_open",

315 
_k£m_po¡
 = "_ksem_post",

316 
_k£m_timedwa™
 = "_ksem_timedwait",

317 
_k£m_Œywa™
 = "_ksem_trywait",

318 
_k£m_uÆšk
 = "_ksem_unlink",

319 
_k£m_wa™
 = "_ksem_wait",

320 
kŒaû
 = "ktrace",

321 
lchæags
 = "lchflags",

322 
lchmod
 = "lchmod",

323 
lchown
 = "lchown",

324 
lg‘x©Œ
 = "lgetxattr",

325 
lšk©
 = "linkat",

326 
lšk
 = "link",

327 
li¡’
 = "listen",

328 
li¡x©Œ
 = "listxattr",

329 
Îi¡x©Œ
 = "llistxattr",

330 
Ìemovex©Œ
 = "lremovexattr",

331 
l£ek
 = "lseek",

332 
l£tx©Œ
 = "lsetxattr",

333 
mkdœ©
 = "mkdirat",

334 
mkdœ
 = "mkdir",

335 
mkfifßt
 = "mkfifoat",

336 
mkfifo
 = "mkfifo",

337 
mknod©
 = "mknodat",

338 
modùl
 = "modctl",

339 
nfssvc
 = "nfssvc",

340 
İ’©
 = "openat",

341 
İ’
 = "open",

342 
·cû±
 = "paccept",

343 
·thcÚf
 = "pathconf",

344 
pe2
 = "pipe2",

345 
pŞl
 = "poll",

346 
´—d
 = "pread",

347 
´—dv
 = "preadv",

348 
pwr™e
 = "pwrite",

349 
pwr™ev
 = "pwritev",

350 
__quÙaùl
 = "__quotactl",

351 
»adlšk©
 = "readlinkat",

352 
»adlšk
 = "readlink",

353 
»ad
 = "read",

354 
»adv
 = "readv",

355 
»boÙ
 = "reboot",

356 
»cväom
 = "recvfrom",

357 
»cvmsg
 = "recvmsg",

358 
»movex©Œ
 = "removexattr",

359 
»Çm—t
 = "renameat",

360 
»Çme
 = "rename",

361 
»voke
 = "revoke",

362 
rmdœ
 = "rmdir",

363 
£ndmsg
 = "sendmsg",

364 
£ndto
 = "sendto",

365 
£‹gid
 = "setegid",

366 
£‹uid
 = "seteuid",

367 
£tgid
 = "setgid",

368 
£tgroups
 = "setgroups",

369 
__£ogš
 = "__setlogin",

370 
£gid
 = "setpgid",

371 
£Œegid
 = "setregid",

372 
£Œeuid
 = "setreuid",

373 
£Œlim™
 = "setrlimit",

374 
£tsid
 = "setsid",

375 
£tsockİt
 = "setsockopt",

376 
£tuid
 = "setuid",

377 
£tx©Œ
 = "setxattr",

378 
shutdown
 = "shutdown",

379 
sock‘·œ
 = "socketpair",

380 
¡©vfs1
 = "statvfs1",

381 
symlšk©
 = "symlinkat",

382 
symlšk
 = "symlink",

383 
sync
 = "sync",

384 
sysùl
 = "__sysctl",

385 
Œunÿ‹
 = "truncate",

386 
umask
 = "umask",

387 
uÆšk©
 = "unlinkat",

388 
uÆšk
 = "unlink",

389 
unmouÁ
 = "unmount",

390 
utim’§t
 = "utimensat",

391 
uŒaû
 = "utrace",

392 
wr™e
 = "write",

393 
wr™ev
 = "writev",

394 
»cvmmsg
 = "recvmmsg",

395 
£ndmmsg
 = "sendmmsg",

396 -- 
v”siÚ
 
ÿÎs


397 
fhİ’
 = "fhopen40",

398 
fh¡©
 = "fhstat50",

399 
fh¡©vfs
 = "fhstatvfs140",

400 
f¡©
 = "fstat50",

401 
futimes
 = "futimes50",

402 
g‘d’ts
 = "getdents30",

403 
g‘fh
 = "getfh30",

404 
kev’t
 = "kevent50",

405 
l¡©
 = "lstat50",

406 
lutimes
 = "lutimes50",

407 
mknod
 = "mknod50",

408 
mouÁ
 = "mount50",

409 
posix_çdvi£
 = "posix_fadvise50",

410 
p£Ëù
 = "pselect50",

411 
£Ëù
 = "select50",

412 
sock‘
 = "socket30",

413 
¡©
 = "stat50",

414 
utimes
 = "utimes50",

415 
pŞÉs
 = "pollts50",

416 -- 
time
 
funùiÚs


417 
g‘timeofday
 = "gettimeofday50",

418 
£‰imeofday
 = "settimeofday50",

419 
adjtime
 = "adjtime50",

420 
£t™im”
 = "setitimer50",

421 
g‘™im”
 = "getitimer50",

422 
şock_g‘time
 = "clock_gettime50",

423 
şock_£‰ime
 = "clock_settime50",

424 
şock_g‘»s
 = "clock_getres50",

425 
Çno¦“p
 = "nanosleep50",

426 
tim”_£‰ime
 = "timer_settime50",

427 
tim”_g‘time
 = "timer_gettime50",

428 
şock_Çno¦“p
 = "clock_nanosleep",

429 
tim”_ü—‹
 = "timer_create",

430 
tim”_d–‘e
 = "timer_delete",

431 
tim”_g‘ov”run
 = "timer_getoverrun",

432 
	}
}

434 
loÿl
 
	gC
 = {}

436 
k
, 
v
 
š
 
	$·œs
(
şi¡
èdØ
C
[
k
] = 
ffi
.C["rump___sysim¶_" .. 
v
] 
’d


438 -- 
difã»Á
 
Çmšg
 
cÚv’tiÚ
 
due
 
to
  
v®ue


439 
C
.
pe
 = 
ffi
.C.
rump_sys_pe


441  
C


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/rump/ffirump.lua

1 -- 
ffi
 
ty³
 
ªd
 
funùiÚ
 
defš™iÚs
 
rump
 
k”Ãl
 
funùiÚs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gcdef
 = 
»quœe
 "ffi".
cdef


12 
cdef
[[

13 
	smodšfo
 {

14 
mi_v”siÚ
;

15 
mi_şass
;

16 (*
mi_modcmd
)(, *);

17 cÚ¡ *
mi_Çme
;

18 cÚ¡ *
mi_»quœed
;

19 } cÚ¡ 
modšfo_t
;

21 
rump_boÙ_g‘howto
();

22 
rump_boÙ_£thowto
();

23 
rump_boÙ_£tsigmod–
();

24 
rump_scheduË
();

25 
rump_unscheduË
();

26 
rump_´š‹vúts
();

27 
rump_d«mÚize_begš
();

28 
rump_d«mÚize_dÚe
();

29 
rump_š™
();

30 
rump_š™_£rv”
(const *);

32 
rump_pub_g‘v”siÚ
();

33 
rump_pub_moduË_š™
(cÚ¡ 
modšfo
 * cÚ¡ *, 
size_t
);

34 
rump_pub_moduË_fši
(cÚ¡ 
modšfo
 *);

35 
rump_pub_k”Ãlfsym_lßd
(*, 
ušt64_t
, *, uint64_t);

36 
uio
 * 
rump_pub_uio_£tup
(*, 
size_t
, 
off_t
, 
rump_uiÜw
);

37 
size_t
 
rump_pub_uio_g‘»sid
(
uio
 *);

38 
off_t
 
rump_pub_uio_g‘off
(
uio
 *);

39 
size_t
 
rump_pub_uio_ä“
(
uio
 *);

40 
kauth_üed
* 
rump_pub_üed_ü—‹
(
uid_t
, 
gid_t
, 
size_t
, gid_t *);

41 
rump_pub_üed_put
(
kauth_üed
 *);

42 
rump_pub_lw´oc_rfÜk
();

43 
rump_pub_lw´oc_Ãwlwp
(
pid_t
);

44 
rump_pub_lw´oc_sw™ch
(
lwp
 *);

45 
rump_pub_lw´oc_»Ëa£lwp
();

46 
lwp
 * 
rump_pub_lw´oc_cu¾wp
();

47 
rump_pub_lw´oc_sy£Á_u£Çtive
();

48 
rump_pub_®lb‘§»off_£tid
(
pid_t
, );

50 
rump_pub_‘fs_»gi¡”
(cÚ¡ *, cÚ¡ *, 
rump_‘fs_ty³
);

52 
rump_i_know_wh©_i_am_došg_w™h_sy£Ás
;

53 
rump_pub_lw´oc_sy£Á_u£Çtive
();

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/rump/init.lua

1 -- 
This
 
mœrÜs
 
	gsysÿÎ
.
	glua
, 
but
 
some
 
difã»nûs


3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

12 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

14 
abi
.
rump
 = 
Œue


16 
loÿl
 
moduËs
 = {

17 
rump
 = 
ffi
.
lßd
("rump", 
Œue
),

18 
	grumpu£r
 = 
ffi
.
lßd
("rumpu£r", 
Œue
),

21 
	g_G
[{}] = 
moduËs
 -- 
you
 
uÆßd
 
rump
 
k”Ãl
 
üashes
 
¬e
 
lik–y
, 
so
 
hªg
 
Ú
 
to
 
them


23 
loÿl
 
	gunchªged
 = {

24 ğ
Œue
,

25 ğ
Œue
,

26 ğ
Œue
,

27 ğ
Œue
,

28 ["unsigÃd ch¬"] = 
Œue
,

29 ["unsigÃd iÁ"] = 
Œue
,

30 ["unsigÃd†Úg"] = 
Œue
,

31 
	gšt8_t
 = 
Œue
,

32 
	gšt16_t
 = 
Œue
,

33 
	gšt32_t
 = 
Œue
,

34 
	gšt64_t
 = 
Œue
,

35 
	gšŒ_t
 = 
Œue
,

36 
	gušt8_t
 = 
Œue
,

37 
	gušt16_t
 = 
Œue
,

38 
	gušt32_t
 = 
Œue
,

39 
	gušt64_t
 = 
Œue
,

40 
	gušŒ_t
 = 
Œue
,

41 -- 
§me
 
š
 
®l
 
OSs
 
©
 
´e£Á


42 
	gš_pÜt_t
 = 
Œue
,

43 
	guid_t
 = 
Œue
,

44 
	ggid_t
 = 
Œue
,

45 
	gpid_t
 = 
Œue
,

46 
	goff_t
 = 
Œue
,

47 
	gsize_t
 = 
Œue
,

48 
	gssize_t
 = 
Œue
,

49 
	gsockËn_t
 = 
Œue
,

50 ["¡ruù in_addr"] = 
Œue
,

51 ["¡ruù in6_addr"] = 
Œue
,

52 ["¡ruù iovec"] = 
Œue
,

53 ["¡ruù iphdr"] = 
Œue
,

54 ["¡ruù udphdr"] = 
Œue
,

55 ["¡ruùƒthhdr"] = 
Œue
,

56 ["¡ruù wšsize"] = 
Œue
,

57 ["¡ruù {šˆcouÁ; sŒuù ioveøiov[?];}"] = 
Œue
,

60 
loÿl
 
funùiÚ
 
	$rumpâ
(

)

61 
unchªged
[

] 
th’
 °
’d


62 

 =ğ"void (*)(št, sigšfo_ˆ*, void *)" 
th’
  "void (*)(št, _Ãtbsd_sigšfo_ˆ*, void *)" 
’d


63 

 =ğ"¡ruù {dev_ˆdev;}" 
th’
  "¡ruù {_Ãtbsd_dev_ˆdev;}" 
’d


64 

 =ğ"¡ruù {tim”_ˆtim”id[1];}" 
th’
  "¡ruù {_Ãtbsd_tim”_ˆtim”id[1];}" 
’d


65 

 =ğ"uniÚ sigv®" 
th’
  "uniÚ _Ãtbsd_sigv®" 
’d


66 

 =ğ"¡ruù {šˆcouÁ; sŒuù mmsghd¸msg[?];}" 
th’
  "¡ruù {šˆcouÁ; sŒuù _Ãtbsd_mmsghd¸msg[?];}" 
’d


67 
¡ršg
.
	`fšd
(

, "¡ruù"è
th’


68  (
¡ršg
.
	`gsub
(

, "struct (%a)", "struct _netbsd_%1"))

69 
’d


70  "_Ãtbsd_" .. 



71 
’d


73 
loÿl
 
S


75 
abi
.
ty³s
 =ğ"lšux" 
th’
 -- 
lßd
 
Lšux
 
com·t
 
moduË


76 
moduËs
.
rumpvfs
 = 
ffi
.
	`lßd
("rumpvfs", 
Œue
)

77 
moduËs
.
rum²‘
 = 
ffi
.
	`lßd
("rum²‘", 
Œue
)

78 
moduËs
.
rum²‘Ãt
 = 
ffi
.
	`lßd
("rum²‘_Ãt", 
Œue
)

79 
moduËs
.
rumpcom·t
 = 
ffi
.
	`lßd
("rumpk”n_sys_lšux", 
Œue
)

80 
’d


82 
abi
.
rumpâ
 = 
n


84 
abi
.
ho¡
 =ğ"Ãtbsd" 
ªd
‡bi.
ty³s
 =ğ"Ãtbsd" 
th’
 -- 
ruÂšg
 
	$Çtive
 (
N‘BSD
 
Ú
 NetBSD)

85 
loÿl
 
SS
 = 
»quœe
 "syscall"

86 
loÿl
 
C
 = 
»quœe
 "syscall.rump.c"

87 
S
 = 
»quœe
 "sysÿÎ.sysÿÎs".
	$š™
(
C
, 
SS
.
c
, SS.
ty³s
)

88 
S
.
abi
, S.
c
, S.
ty³s
, S.
t
 =‡bi, 
SS
.c, SS.types, SS.types.t

89 
S
 = 
»quœe
 "sysÿÎ.com·t".
	$š™
(
S
)

90 
S
 = 
»quœe
 "sysÿÎ.m‘hods".
	$š™
(
S
)

91 
S
.
ut
 = 
»quœe
 "sysÿÎ.ut".
	$š™
(
S
)

92 
–£if
 
abi
.
ty³s
 =ğ"lšux" 
th’
 -- 
ruÂšg
 
Lšux
y³s, 
ju¡
 
Ãed
 
to
 
u£
 
rump
 
C
 
which
 
™
 
wl
 dØabi.rum°
£t


93 
S
 = 
»quœe
 "syscall"

94 -- 
TODO
 
lÙs
 
of
 
sysÿÎs
 
sim¶y
 
dÚ
'tƒxist, so make some do ENOSYS

95 
loÿl
 
funùiÚ
 
	$nosys
()

96 
ffi
.
	$”ºo
(
S
.
c
.
E
.
NOSYS
)

98 
’d


99 
loÿl
 
C
 = 
»quœe
 "syscall.rump.c"

100 
loÿl
 
nŞi¡
 = {"io_£tup"
	}
} -- 
TODO
 
ÿn
 
add
 
mÜe
 
h”e


101 
_
, 
sys
 
š
 
	$aœs
(
nŞi¡
èdØ
C
[
sys
] = 
nosys
 
’d


103 -- 
add
 
a
 
ãw
 
Ãtbsd
 
ty³s
 
so
 
ÿn
 
u£
 
mouÁ


104 -- 
TODO
 
id—Îy
 
we
 
would
 
»quœe
 
Ãtbsd
.
ff™y³s
 
but
 
this
 
is
 
somewh©
 
com¶ex
 
now


105 
ffi
.
cdef
 [[

106 
ušt32_t
 
_Ãtbsd_mode_t
;

107 
ušt64_t
 
_Ãtbsd_šo_t
;

108 
	s_Ãtbsd_ufs_¬gs
 {

109 *
f¥ec
;

111 
	s_Ãtbsd_tmpfs_¬gs
 {

112 
_v”siÚ
;

113 
_Ãtbsd_šo_t
 
_nodes_max
;

114 
off_t
 
_size_max
;

115 
uid_t
 
_roÙ_uid
;

116 
gid_t
 
_roÙ_gid
;

117 
_Ãtbsd_mode_t
 
_roÙ_mode
;

119 
	s_Ãtbsd_±yfs_¬gs
 {

120 
v”siÚ
;

121 
gid_t
 
gid
;

122 
_Ãtbsd_mode_t
 
mode
;

123 
æags
;

127 
loÿl
 
addty³
 = 
»quœe
 "syscall.helpers".addtype

128 
loÿl
 
add¡ruùs
 = {

129 
ufs_¬gs
 = "struct _netbsd_ufs_args",

130 
tmpfs_¬gs
 = "struct _netbsd_tmpfs_args",

131 
±yfs_¬gs
 = "struct _netbsd_ptyfs_args",

132 
	}
}

133 
	gk
, 
v
 
š
 
	$·œs
(
add¡ruùs
èdØ
	`addty³
(
S
.
ty³s
, 
k
, 
v
, {
	}
}è
’d


134 
–£if
 
	gabi
.
	gty³s
 =ğ"Ãtbsd" 
th’
 -- 
run
 
N‘BSD
 
ty³s
 
Ú
 
ªÙh”
 
OS


135 
abi
.
rumpâ
 =„umpâ -- 
mªgË
 
N‘BSD
 
ty³
 
Çmes
 
to
 
avoid
 
cŞlisiÚs


136 
S
 = 
»quœe
 "syscall"

138 
”rÜ
 "unsupported ABI"

139 
’d


141 
»quœe
 "syscall.rump.ffirump"

143 
loÿl
 
t
, 
	g±
 = 
S
.
ty³s
.t, 
	gS
.
	gty³s
.
±


145 
loÿl
 
	gmodšfo
 = 
ffi
.
ty³of
("struct modinfo")

147 -- 
TODO
 
make
 
this
 
ex¶c™ly
 
»ãr
 
to
 
N‘BSD
 
”rÜ
 
codes


148 
loÿl
 
funùiÚ
 
	$»tboŞ
(
»t
)

149 
»t
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


150  
Œue


151 
’d


153 
loÿl
 
funùiÚ
 
	`»Šum
(
»t
è--  
Lua
 
numb”
 
wh”e
 
´ecisiÚ
 
ok
, 
eg
 
fe
 
İs
 
‘c


154 
»t
 = 
	$tÚumb”
(
»t
)

155 
»t
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


156  
»t


157 
’d


159 
S
.
rump
 = {
	}
}

161 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

162 
loÿl
 
où®
, 
	gmuÉiæags
, 
	gch¬æags
, 
	gsw­æags
, 
	g¡ræag
, 
	g©æag
, 
	gmodeæags


163 ğ
h
.
où®
, 
	gh
.
	gmuÉiæags
, h.
	gch¬æags
, h.
	gsw­æags
, h.
	g¡ræag
, h.
	g©æag
, h.
modeæags


165 
loÿl
 
	gc
 = {}

167 
c
.
ETFS
 = 
¡ræag
 {

168 
REG
 = 0,

169 
	gBLK
 = 1,

170 
	gCHR
 = 2,

171 
	gDIR
 = 3,

172 
	gDIR_SUBDIRS
 = 4,

175 
	gc
.
	gRUMPUIO
 = 
¡ræag
 {

176 
READ
 = 0,

177 
	gWRITE
 = 1,

180 
	gc
.
	gSIGMODEL
 = 
¡ræag
 {

181 
PANIC
 = 0,

182 
	gIGNORE
 = 1,

183 
	gHOST
 = 2,

184 
	gRAISE
 = 3,

185 
	gRECORD
 = 4,

188 
	gc
.
	gRF
 = 
¡ræag
 {

189 
NONE
 = 0x00, -- 
nÙ
 
	gÇmed
, 
£e
 
issue
 
	gh‰ps
:

190 
FDG
 = 0x01,

191 
	gCFDG
 = 0x02,

194 
	gc
.
	gCN_FREECRED
 = 0x02

195 
c
.
ETFS_SIZE_ENDOFF
 = 
h
.
ušt64_max


197 
S
.
rump
.
c
 = c

199 -- 
We
 
could
 
®so
 
u£
 
rump_pub_moduË_š™
 
lßdšg
 
Ï‹r


200 
funùiÚ
 
S
.
rump
.
	$moduË
(
s
)

201 
s
 = "rump" .. 
¡ršg
.
	`gsub
(s, "%.", "_")

202 
loÿl
 
mod
 = 
ffi
.
	$lßd
(
s
, 
Œue
)

203 
moduËs
[
s
] = 
mod


204 
’d


206 
loÿl
 
funùiÚ
 
	$lßdmoduËs
(
ms
)

207 
loÿl
 
Ën
 = #ms

208 
loÿl
 
»mašs
 = #ms

209 
loÿl
 
sucûeded
 = 
Œue


210 
»mašs
 > 0 do

211 
sucûeded
 = 
çl£


212 
i
 = 1, #ms do

213 
loÿl
 
v
 = 
ms
[
i
]

214 
v
 
th’


215 
v
 = "rump" .. 
¡ršg
.
	`gsub
(v, "%.", "_")

216 
loÿl
 
ok
, 
mod
 = 
	$pÿÎ
(
ffi
.
lßd
, 
v
, 
Œue
)

217 
ok
 
th’


218 
moduËs
[
v
] = 
mod


219 
ms
[
i
] = 
n


220 
sucûeded
 = 
Œue


221 
»mašs
 =„emains - 1

222 
’d


223 
’d


224 
’d


225 
nÙ
 
sucûeded
 
th’
  
’d


226 
’d


227 
nÙ
 
sucûeded
 
th’
 
”rÜ
 "ÿÂÙ†ßd„um°moduËs" 
’d


228 
’d


230 
funùiÚ
 
S
.
rump
.
	`š™
(
ms
, ...è-- 
you
 
mu¡
 
lßd
 
the
 
çùiÚs
 
h”e
 
eg
 
dev
, 
vfs
, 
Ãt
, 
¶us
 
moduËs


231 
	`ty³
(
ms
è=ğ"¡ršg" 
th’
 m ğ{ms, ...
	}
} 
’d


232 
ms
 
th’
 
	$lßdmoduËs
(
ms
è
’d


233 
loÿl
 
ok
 = 
ffi
.
C
.
	$rump_š™
()

234 
ok
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


235 
S
.
abi
 =‡bi

236  
S


237 
’d


239 
funùiÚ
 
S
.
rump
.
	$boÙ_g‘howto
(è 
	`»Šum
(
ffi
.
C
.
	$rump_boÙ_g‘howto
()è
’d


240 
funùiÚ
 
S
.
rump
.
	$boÙ_£thowto
(
how
è
ffi
.
C
.
	$rump_boÙ_£thowto
(
how
è
’d


241 
funùiÚ
 
S
.
rump
.
	$boÙ_£tsigmod–
(
mod–
è
ffi
.
C
.
	$rump_boÙ_‘sigmod–
(
mod–
è
’d


242 
funùiÚ
 
S
.
rump
.
	$scheduË
(è
ffi
.
C
.
	$rump_scheduË
(è
’d


243 
funùiÚ
 
S
.
rump
.
	$unscheduË
(è
ffi
.
C
.
	$rump_unscheduË
(è
’d


244 
funùiÚ
 
S
.
rump
.
	$´š‹vúts
(è
ffi
.
C
.
	$rump_´š‹vúts
(è
’d


245 
funùiÚ
 
S
.
rump
.
	$d«mÚize_begš
(è 
	`»tboŞ
(
ffi
.
C
.
	$rump_d«mÚize_begš
()è
’d


246 
funùiÚ
 
S
.
rump
.
	$d«mÚize_dÚe
(
”r
è 
	`»tboŞ
(
ffi
.
C
.
	$rump_d«mÚize_dÚe
(
”r
)è
’d


247 
funùiÚ
 
S
.
rump
.
	$š™_£rv”
(
u¾
è 
	`»tboŞ
(
ffi
.
C
.
	$rump_š™_£rv”
(
u¾
)è
’d


249 
funùiÚ
 
S
.
rump
.
	$i_know_wh©_i_am_došg_sy£Á_u£Çtive
()

250 
ffi
.
C
.
rump_i_know_wh©_i_am_došg_w™h_sy£Ás
 = 1

251 
ffi
.
C
.
	`rump_pub_lw´oc_sy£Á_u£Çtive
();

252 
’d


254 
funùiÚ
 
S
.
rump
.
	$g‘v”siÚ
(è 
ffi
.
C
.
	$rump_pub_g‘v”siÚ
(è
’d


256 -- 
‘fs
 
funùiÚs


257 
funùiÚ
 
S
.
rump
.
	$‘fs_»gi¡”
(
key
, 
ho¡·th
, 
áy³
, 
begš
, 
size
)

258 
loÿl
 
»t


259 
áy³
 = 
S
.
rump
.
c
.
ETFS
[ftype]

260 
begš
 
th’


261 
»t
 = 
ffi
.
C
.
	`rump_pub_‘fs_»gi¡”_w™hsize
(
key
, 
ho¡·th
, 
áy³
, 
begš
, 
size
);

263 
»t
 = 
ffi
.
C
.
	`rump_pub_‘fs_»gi¡”
(
key
, 
ho¡·th
, 
áy³
);

264 
’d


265  
	$»tboŞ
(
»t
)

266 
’d


267 
funùiÚ
 
S
.
rump
.
	$‘fs_»move
(
key
)

268  
	`»tboŞ
(
ffi
.
C
.
	$rump_pub_‘fs_»move
(
key
))

269 
’d


271 -- 
th»adšg


272 
funùiÚ
 
S
.
rump
.
	$rfÜk
(
æags
è 
	`»tboŞ
(
ffi
.
C
.
	$rump_pub_lw´oc_rfÜk
(
S
.
rump
.
c
.
RF
[
æags
])è
’d


273 
funùiÚ
 
S
.
rump
.
	$Ãwlwp
(
pid
è 
	`»tboŞ
(
ffi
.
C
.
	$rump_pub_lw´oc_Ãwlwp
(
pid
)è
’d


274 
funùiÚ
 
S
.
rump
.
	$sw™chlwp
(
lwp
è
ffi
.
C
.
	$rump_pub_lw´oc_sw™ch
(
lwp
è
’d


275 
funùiÚ
 
S
.
rump
.
	$»Ëa£lwp
(è
ffi
.
C
.
	$rump_pub_lw´oc_»Ëa£lwp
(è
’d


276 
funùiÚ
 
S
.
rump
.
	$cu¾wp
(è 
ffi
.
C
.
	$rump_pub_lw´oc_cu¾wp
(è
’d


278 -- 
»v”t
 
so
 
ÿn
 
lßd
 
nÚ
 
rump
 
agaš


279 
abi
.
rump
 = 
çl£


280 
abi
.
os
 =‡bi.
ho¡


282 
S
.
__rump
 = 
Œue


284  
S
.
rump


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/shared/types.lua

1 -- 
this
 
moduË
 
defšes
 
the
 
ty³s
 
w™h
 
m‘©y³s
 
th©
 
¬e
 
®ways
 
	gcommÚ
, 
so
 dØ
nÙ
 
g‘
 
”rÜs
 
»defššg
 metatypes

3 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

6 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


10 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

12 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

14 
loÿl
 
t
, 
	gùy³s
, 
	g±
, 
	gs
 = {}, {}, {}, {}

15 
loÿl
 
	gty³s
 = {
t
 =, 
	g±
 = 
±
, 
	gs
 = 
s
, 
	gùy³s
 = 
ùy³s
}

17 
loÿl
 
	gh
 = 
»quœe
 "syscall.helpers"

19 
loÿl
 
addty³
, 
	gaddty³_v¬
, 
	gaddty³_â
, 
	gadd¿w2
 = 
h
.addty³, 
	gh
.addty³_v¬, h.addty³_â, h.
add¿w2


20 
loÿl
 
	gaddty³1
, 
	gaddty³2
, 
	gadd±¹y³
 = 
h
.
addty³1
, 
	gh
.addty³2, h.
add±¹y³


21 
loÿl
 
	g±t
, 
	g»v™”
, 
	gmkty³
, 
	gi¡y³
, 
	gËnâ
, 
	gËnmt
, 
	gg‘fd
, 
	gÃwâ


22 ğ
h
.
±t
, 
	gh
.
	g»v™”
, h.
	gmkty³
, h.
	gi¡y³
, h.
	gËnâ
, h.
	gËnmt
, h.
	gg‘fd
, h.
Ãwâ


23 
loÿl
 
	gÁohl
,‚tohl, 
	gÁohs
, 
	ghtÚs
, 
	ghtÚl
 = 
h
.
Áohl
, 
	gh
.Áohl, h.Áohs, h.htÚs, h.
htÚl


24 
loÿl
 
	g¥l™
, 
	gŒim
, 
	g¡ræag
 = 
h
.
¥l™
, 
	gh
.Œim, h.
¡ræag


25 
loÿl
 
	g®ign
 = 
h
.
®ign


27 
loÿl
 
addty³s
 = {

29 
	guch¬
 = "unsigned char",

31 
	gušt
 = "unsigned int",

32 
	gšt8
 = "int8_t",

33 
	gušt8
 = "uint8_t",

34 
	gšt16
 = "int16_t",

35 
	gušt16
 = "uint16_t",

36 
	gšt32
 = "int32_t",

37 
	gušt32
 = "uint32_t",

38 
	gšt64
 = "int64_t",

39 
	gušt64
 = "uint64_t",

41 
	gulÚg
 = "unsigned†ong",

44 
	gk
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


46 
loÿl
 
addty³s1
 = {

47 
ch¬1
 = "char",

48 
uch¬1
 = "unsigned char",

49 
št1
 = "int",

50 
ušt1
 = "unsigned int",

51 
št16_1
 = "int16_t",

52 
ušt16_1
 = "uint16_t",

53 
št32_1
 = "int32_t",

54 
ušt32_1
 = "uint32_t",

55 
št64_1
 = "int64_t",

56 
ušt64_1
 = "uint64_t",

57 
lÚg1
 = "long",

58 
ulÚg1
 = "unsigned†ong",

59 
šŒ1
 = "intptr_t",

60 
size1
 = "size_t",

61 
	}
}

63 
	gk
, 
v
 
š
 
	$·œs
(
addty³s1
èdØ
	$addty³1
(
ty³s
, 
k
, 
v
è
’d


65 
loÿl
 
addty³s2
 = {

66 
ch¬2
 = "char",

67 
št2
 = "int",

68 
ušt2
 = "unsigned int",

69 
	}
}

71 
	gk
, 
v
 
š
 
	$·œs
(
addty³s2
èdØ
	$addty³2
(
ty³s
, 
k
, 
v
è
’d


73 
loÿl
 
±¹y³s
 = {

74 
ušŒ
 = "uintptr_t",

75 
šŒ
 = "intptr_t",

76 
	}
}

78 
	gk
, 
v
 
š
 
	$·œs
(
±¹y³s
èdØ
	$add±¹y³
(
ty³s
, 
k
, 
v
è
’d


80 
t
.
šts
 = 
ffi
.
	`ty³of
("int[?]")

81 
t
.
bufãr
 = 
ffi
.
	`ty³of
("ch¬[?]"è-- 
TODO
 
»Çme
 
as
 
ch¬s
?

82 
t
.
¡ršg_¬¿y
 = 
ffi
.
	`ty³of
("const char *[?]")

84 
loÿl
 
mt
 = {
	}
}

86 
mt
.
iovec
 = {

87 
šdex
 = {

88 
ba£
 = 
funùiÚ
(
£lf
è s–f.
iov_ba£
 
’d
,

89 
	gËn
 = 
funùiÚ
(
£lf
è s–f.
iov_Ën
 
’d
,

93 
addty³
(
ty³s
, "iovec", "¡ruù iovec", 
mt
.
iovec
)

95 
	gmt
.
	giovecs
 = {

96 
__Ën
 = 
funùiÚ
(
io
è io.
couÁ
 
’d
,

97 
	g__to¡ršg
 = 
funùiÚ
(
io
)

98 
loÿl
 
s
 = {}

99 
i
 = 0, 
	gio
.
	gcouÁ
 - 1 do

100 
loÿl
 
	giovec
 = 
io
.
iov
[
i
]

101 
s
[
i
 + 1] = 
ffi
.
¡ršg
(
iovec
.
iov_ba£
, iovec.
iov_Ën
)

102 
’d


103  
	gbË
.
cÚÿt
(
s
)

104 
	g’d
;

105 
	g__Ãw
 = 
funùiÚ
(

, 
is
)

106 
ty³
(
is
è=ğ'numb”' 
th’
  
ffi
.
Ãw
(

, is, isè
’d


107 
loÿl
 
	gcouÁ
 = #is

108 
loÿl
 
iov
 = 
ffi
.
Ãw
(

, 
couÁ
, count)

109 
loÿl
 
	gj
 = 0

110 
n
, 
i
 
š
 
aœs
(
is
) do

111 
ty³
(
i
è=ğ'¡ršg' 
th’


112 
loÿl
 
buf
 = 
t
.
bufãr
(#i)

113 
ffi
.
cİy
(
buf
, 
i
, #i)

114 
	giov
.iov[
j
].
	giov_ba£
 = 
buf


115 
iov
.iov[
j
].
iov_Ën
 = #i

116 
–£if
 
ty³
(
i
è=ğ'numb”' 
th’


117 
iov
.iov[
j
].
iov_ba£
 = 
t
.
bufãr
(
i
)

118 
iov
.iov[
j
].
iov_Ën
 = 
i


119 
–£if
 
ffi
.
i¡y³
(
t
.
iovec
, 
i
è
th’


120 
	gffi
.
cİy
(
iov
[
n
], 
i
, 
s
.
iovec
)

121 
–£if
 
ty³
(
i
è=ğ'cd©a' 
Ü
y³(iè=ğ'u£rd©a' 
th’
 -- 
eg
 
bufãr
 o¸
Ùh”
 
¡ruùu»
, 
u£rd©a
 
luaffi


122 
	giov
.iov[
j
].
	giov_ba£
 = 
i


123 
iov
.iov[
j
].
iov_Ën
 = 
ffi
.(
i
)

124 -- 
eg
 
bË


125 
iov
.iov[
j
] = 
i


126 
’d


127 
j
 = j + 1

128 
’d


129  
iov


130 
’d
,

133 
addty³_v¬
(
ty³s
, "iovecs", "¡ruù {šˆcouÁ; sŒuù ioveøiov[?];}", 
mt
.
iovecs
)

135 -- 
cÚv”t
 
¡ršgs
 
to
 
š‘
 
add»s£s
 
ªd
 
the
 
»v”£


136 
loÿl
 
funùiÚ
 
	$š‘4_Áİ
(
¤c
)

137 
loÿl
 
b
 = 
±
.
	$uch¬
(
¤c
)

138  
b
[0] .. "." .. b[1] .. "." .. b[2] .. "." .. b[3]

139 
’d


141 
loÿl
 
funùiÚ
 
	$š‘6_Áİ
(
¤c
)

142 
loÿl
 
a
 = 
¤c
.
s6_addr


143 
loÿl
 
·¹s
 = {256*
a
[0] +‡[1], 256*a[2] +‡[3], 256*a[4] +‡[5], 256*a[6] +‡[7],

144 256*
a
[8] +‡[9], 256*a[10] +‡[11], 256*a[12] +‡[13], 256*a[14] +‡[15]
	}
}

146 
i
 = 1, #·¹ dØ
	g·¹s
[i] = 
¡ršg
.
fÜm©
("%x", 
·¹s
[i]è
’d


148 
loÿl
 
	g¡¬t
, 
	gmax
 = 0, 0

149 
	gi
 = 1, #parts do

150 
	g·¹s
[
i
] =ğ"0" 
th’


151 
loÿl
 
couÁ
 = 0

152 
j
 = 
i
, #parts do

153 
	g·¹s
[
j
] =ğ"0" 
th’
 
couÁ
 = couÁ + 1  
’d


154 
’d


155 
couÁ
 > 
max
 
th’
 max, 
	g¡¬t
 = couÁ, 
i
 
’d


156 
’d


157 
’d


159 
	gmax
 > 2 
th’


160 
	g·¹s
[
¡¬t
] = ""

161 
¡¬t
 =ğ1 
Ü
 s¹ + 
max
 =ğ9 
th’
 
·¹s
[¡¬t] = ":" 
’d


162 
¡¬t
 =ğ1 
ªd
 s¹ + 
max
 =ğ9 
th’
 
·¹s
[¡¬t] = "::" 
’d


163 
i
 = 1, 
	gmax
 - 1 dØ
	gbË
.
»move
(
·¹s
, 
¡¬t
 + 1è
’d


164 
’d


166  
	gbË
.
cÚÿt
(
·¹s
, ":")

167 
’d


169 
loÿl
 
funùiÚ
 
	$š‘4_±Ú
(
¤c
)

170 
loÿl
 
4
 = 
	`¥l™
("%.", 
¤c
)

171 #4 ~ğ4 
th’
 
”rÜ
 "m®fÜmed IP‡dd»ss" 
’d


172  
	`htÚl
(
	`tÚumb”
(
4
[1]è* 0x1000000 +Úumb”(4[2]è* 0x10000 +Úumb”(4[3]è* 0x100 + 
	$tÚumb”
(
4
[4]))

173 
’d


175 
loÿl
 
funùiÚ
 
	$hex
(
¡r
è 
	`tÚumb”
("0x" .. sŒè
’d


177 
loÿl
 
funùiÚ
 
	`š‘6_±Ú
(
¤c
, 
addr
)

178 -- 
TODO
 
®low
 
fÜm
 
w™h
 
decim®s
 
©
 
’d
 
v4
 
add»s£s


179 
loÿl
 
8
 = 
	`¥l™
(":", 
¤c
)

180 #8 > 8 
th’
  
n
 
’d


181 
loÿl
 
befÜe
, 
aá”
 = 
¤c
:
	`fšd
("::")

182 
befÜe
, 
aá”
 = 
¤c
:
	`sub
(1, before - 1), src:sub(after + 1)

183 
befÜe
 
th’


184 #8 =ğ8 
th’
  
n
 
’d
 -- 
mu¡
 
be
 
some
 
missšg


185 
befÜe
 =ğ"" 
th’
 befÜğ"0" 
’d


186 
aá”
 =ğ"" 
th’
‡á” = "0" 
’d


187 
¤c
 = 
befÜe
 .. ":" .. 
¡ršg
.
	`»p
("0:", 8 - #8 + 1è.. 
aá”


188 
8
 = 
	`¥l™
(":", 
¤c
)

189 
’d


190 
i
 = 1, 8 do

191 
addr
.
s6_addr
[
i
 * 2 - 1] = 
b™
.
	`bªd
(
	`hex
(
8
[i]), 0xff)

192 
addr
.
s6_addr
[
i
 * 2 - 2] = 
b™
.
	`rshiá
(
	`hex
(
8
[i]), 8)

193 
’d


194  
addr


195 
’d


197 
loÿl
 
šaddr
 = 
¡ræag
 {

198 
ANY
 = "0.0.0.0",

199 
LOOPBACK
 = "127.0.0.1",

200 
BROADCAST
 = "255.255.255.255",

201 
	}
}

203 
loÿl
 
	gš6addr
 = 
¡ræag
 {

204 
ANY
 = "::",

205 
	gLOOPBACK
 = "::1",

208 -- 
giv’
 
this
 
add»ss
 
ªd
 
a
 
	gmask
, ‡ 
Ãtmask
‡nd 
brßdÿ¡
 
as
 
š_addr


209 
loÿl
 
funùiÚ
 
	$mask_bÿ¡
(
add»ss
, 
Ãtmask
)

210 
loÿl
 
bÿ¡
 = 
t
.
	$š_addr
()

211 
loÿl
 
nmask
 = 
t
.
	`š_addr
(è-- 
TODO


212 
Ãtmask
 > 32 
th’
 
	`”rÜ
("bad‚‘mask " ..‚‘maskè
’d


213 
Ãtmask
 < 32 
th’
 
nmask
.
s_addr
 = 
	`htÚl
(
b™
.
	`rshiá
(-1,‚‘mask)è
’d


214 
bÿ¡
.
s_addr
 = 
b™
.
	`bÜ
(
	`tÚumb”
(
add»ss
.s_addr), 
nmask
.s_addr)

215  {
add»ss
 =‡dd»ss, 
brßdÿ¡
 = 
bÿ¡
, 
Ãtmask
 = 
nmask
}

216 
’d


218 
	gmt
.
	gš_addr
 = {

219 
__šdex
 = {

220 
g‘_mask_bÿ¡
 = 
funùiÚ
(
addr
, 
mask
è 
mask_bÿ¡
×ddr, maskè
	g’d
,

222 
	gÃwšdex
 = {

223 
addr
 = 
funùiÚ
×ddr, 
s
)

224 
	gffi
.
i¡y³
(
t
.
š_addr
, 
s
è
th’


225 
	gaddr
.
	gs_addr
 = 
s
.
s_addr


226 
–£if
 
ty³
(
s
è=ğ"¡ršg" 
th’


227 
šaddr
[
s
] 
th’
 s = iÇddr[s] 
’d


228 
addr
.
s_addr
 = 
š‘4_±Ú
(
s
)

229 -- 
numb”


230 
addr
.
s_addr
 = 
htÚl
(
s
)

231 
’d


232 
’d
,

234 
	g__to¡ršg
 = 
š‘4_Áİ
,

235 
	g__Ãw
 = 
funùiÚ
(

, 
s
)

236 
loÿl
 
	gaddr
 = 
ffi
.
Ãw
(

)

237 
s
 
th’
 
addr
.add¸ğ 
’d


238  
addr


239 
’d
,

240 
	g__Ën
 = 
Ënâ
,

243 
addty³
(
ty³s
, "š_addr", "¡ruù in_addr", 
mt
.
š_addr
)

245 
	gmt
.
	gš6_addr
 = {

246 
__to¡ršg
 = 
š‘6_Áİ
,

247 
	g__Ãw
 = 
funùiÚ
(

, 
s
)

248 
loÿl
 
	gaddr
 = 
ffi
.
Ãw
(

)

249 
s
 
th’


250 
š6addr
[
s
] 
th’
 s = in6addr[s] 
’d


251 
addr
 = 
š‘6_±Ú
(
s
,‡ddr)

252 
’d


253  
addr


254 
	g’d
,

255 
	g__Ën
 = 
Ënâ
,

258 
addty³
(
ty³s
, "š6_addr", "¡ruù in6_addr", 
mt
.
š6_addr
)

260 -- 
	g
, 
udp
 
	gty³s
. 
N“d
 
’dŸn
 
	gcÚv”siÚs
.

261 
loÿl
 
	g±ch¬
 = 
ffi
.
ty³of
("char *")

262 
loÿl
 
ušt16
 = 
ffi
.
ty³of
("uint16_t[1]")

264 
loÿl
 
funùiÚ
 
	$_checksum
(
buf
, 
size
, 
c
, 
nÙfš®
)

265 
c
 = c 
Ü
 0

266 
loÿl
 
b8
 = 
ffi
.
	$ÿ¡
(
±ch¬
, 
buf
)

267 
loÿl
 
i16
 = 
	$ušt16
()

268 
i
 = 0, 
size
 - 1, 2 do

269 
ffi
.
	`cİy
(
i16
, 
b8
 + 
i
, 2)

270 
c
 = c + 
i16
[0]

271 
’d


272 
size
 % 2 =ğ1 
th’


273 
i16
[0] = 0

274 
ffi
.
	`cİy
(
i16
, 
b8
[
size
 - 1], 1)

275 
c
 = c + 
i16
[0]

276 
’d


278 
loÿl
 
v
 = 
b™
.
	$bªd
(
c
, 0xffff)

279 
v
 < 0 
th’
 v = v + 0x10000 
’d
 -- 
pos™ive


280 
c
 = 
b™
.
	`rshiá
(c, 16è+ 
v


281 
c
 = c + 
b™
.
	$rshiá
(
c
, 16)

283 
nÙ
 
nÙfš®
 
th’
 
c
 = 
b™
.
	$bnÙ
(
c
è
’d


284 
c
 < 0 
th’
 c = c + 0x10000 
’d
 -- 
pos™ive


285  
c


286 
’d


288 
mt
.
hdr
 = {

289 
šdex
 = {

290 
checksum
 = 
	`funùiÚ
(
i
)  function(i)

291 
i
.
check
 = 0

292 
i
.
check
 = 
	`_checksum
(i, 
s
.
hdr
)

293  
i
.
check


294 
’d
ƒnd,

296 
	}
}

298 
addty³
(
ty³s
, "hdr", "¡ruù iphdr", 
mt
.
hdr
)

300 
loÿl
 
	gudphdr_size
 = 
ffi
.("struct udphdr")

302 -- 
ugh
, 
Çmšg
 
´obËms
 
as
 
ÿÂÙ
 
»move
 
Çme¥aû
‡ 
	gusu®


303 -- 
	gchecksum
 = 
	$funùiÚ
(
u
, ...è 0 
’d
, -- 
TODO
 
checksum
, 
Ãeds
 
IP
 
·ck‘
 
šfo
 
too
. 
as
 
m‘hod
.

304 
mt
.
udphdr
 = {

305 
šdex
 = {

306 
¤c
 = 
	`funùiÚ
(
u
è 
	`Áohs
(u.
sourû
è
’d
,

307 
d¡
 = 
	`funùiÚ
(
u
è 
	`Áohs
(u.
de¡
è
’d
,

308 
Ëngth
 = 
	`funùiÚ
(
u
è 
	`Áohs
(u.
Ën
è
’d
,

309 
checksum
 = 
	`funùiÚ
(
i
è funùiÚ(i, 

, 
body
)

310 
loÿl
 
b
 = 
±
.(

)

311 
loÿl
 
bup
 = 
±
.(
i
)

312 
loÿl
 
cs
 = 0

313 -- 
checksum
 
p£udo
 
h—d”


314 
cs
 = 
	`_checksum
(
b
 + 
ffi
.
	`off£tof
(

, "§ddr"), 4, cs, 
Œue
)

315 
cs
 = 
	`_checksum
(
b
 + 
ffi
.
	`off£tof
(

, "daddr"), 4, cs, 
Œue
)

316 
loÿl
 
´
 = 
t
.
	`ch¬2
(0, 17è-- 
c
.
IPPROTO
.
UDP


317 
cs
 = 
	`_checksum
(
´
, 2, cs, 
Œue
)

318 
cs
 = 
	`_checksum
(
bup
 + 
ffi
.
	`off£tof
(
i
, "Ën"), 2, cs, 
Œue
)

319 -- 
checksum
 
udp
 
h—d”


320 
i
.
check
 = 0

321 
cs
 = 
	`_checksum
(
i
, 
udphdr_size
, cs, 
Œue
)

322 -- 
checksum
 
body


323 
cs
 = 
	`_checksum
(
body
, 
i
.
Ëngth
 - 
udphdr_size
, cs)

324 
cs
 =ğ0 
th’
 c ğ0xfffà
’d


325 
i
.
check
 = 
cs


326  
cs


327 
’d
ƒnd,

329 
Ãwšdex
 = {

330 
¤c
 = 
	`funùiÚ
(
u
, 
v
èu.
sourû
 = 
	`htÚs
(vè
’d
,

331 
d¡
 = 
	`funùiÚ
(
u
, 
v
èu.
de¡
 = 
	`htÚs
(vè
’d
,

332 
Ëngth
 = 
	`funùiÚ
(
u
, 
v
èu.
Ën
 = 
	`htÚs
(vè
’d
,

334 
	}
}

336 
addty³
(
ty³s
, "udphdr", "¡ruù udphdr", 
mt
.
udphdr
)

338 
	gmt
.
	g‘hhdr
 = {

339 -- 
TODO


342 
addty³
(
ty³s
, "‘hhdr", "¡ruùƒthhdr", 
mt
.
‘hhdr
)

344 
	gmt
.
	gwšsize
 = {

345 
šdex
 = {

346 
row
 = 
funùiÚ
(
ws
è ws.
ws_row
 
’d
,

347 
	gcŞ
 = 
funùiÚ
(
ws
è ws.
ws_cŞ
 
’d
,

348 
	gxpix–
 = 
funùiÚ
(
ws
è ws.
ws_xpix–
 
’d
,

349 
	gypix–
 = 
funùiÚ
(
ws
è ws.
ws_ypix–
 
’d
,

351 
	gÃwšdex
 = {

352 
row
 = 
funùiÚ
(
ws
, 
v
è
	gws
.
	gws_row
 = v 
’d
,

353 
	gcŞ
 = 
funùiÚ
(
ws
, 
v
è
	gws
.
	gws_cŞ
 = v 
’d
,

354 
	gxpix–
 = 
funùiÚ
(
ws
, 
v
è
	gws
.
	gws_xpix–
 = v 
’d
,

355 
	gypix–
 = 
funùiÚ
(
ws
, 
v
è
	gws
.
	gws_ypix–
 = v 
’d
,

357 
	g__Ãw
 = 
Ãwâ
,

360 
addty³
(
ty³s
, "wšsize", "¡ruù wšsize", 
mt
.
wšsize
)

362  
	gty³s


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/syscall.lua

1 -- 
this
 
puts
 
ev”ythšg
 
što
 
Úe
 
bË
 
»ady
 
to
 
u£


3 
loÿl
 
	g»quœe
, 
	g´št
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

4 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

5 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
	gm©h
 =

6 
»quœe
, 
	g´št
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

7 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

8 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
m©h


10 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

12 
abi
.
rump
 
ªd
‡bi.
ty³s
 
th’
‡bi.
os
 =‡bi.ty³ 
’d
 -- 
´‘’d
 
to
 
be
 
N‘BSD
 
nÜm®
„ump, 
Lšux
 
rum¶šux


14 
	gabi
.
	gos
 =ğ"Ãtbsd" 
th’


15 -- 
TODO
 
m”ge


16 
»quœe
("syscall.netbsd.ffitypes")

17 
nÙ
 
abi
.
rump
 
th’


18 
»quœe
("syscall.netbsd.ffifunctions")

19 
’d


21 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".ffi")

22 
’d


24 
loÿl
 
c
 = 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".constants")

26 
loÿl
 
o¡y³s
 = 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".types")

27 
loÿl
 
bsdty³s


28 ià(
abi
.
rump
 
ªd
‡bi.
ty³s
 =ğ"Ãtbsd"è
	$Ü
 (
nÙ
 
abi
.
rump
 
ªd
‡bi.
bsd
è
th’


29 
bsdty³s
 = 
	`»quœe
("syscall.bsd.types")

30 
’d


31 
loÿl
 
ty³s
 = 
»quœe
 "sysÿÎ.ty³s".
	$š™
(
c
, 
o¡y³s
, 
bsdty³s
)

33 
loÿl
 
C


34 
abi
.
rump
 
th’
 -- 
TODO
 
m”ge
 
the£
 
w™h
 
cÚd™iÚ®s


35 
C
 = 
	`»quœe
("syscall.rump.c")

37 
C
 = 
	`»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".c")

38 
’d


40 -- 
ÿÂÙ
 
put
 
š
 
S
, 
Ãeded
 
‹¡s
, cªnÙ 
be
…uˆš 
c
 
—¾›r
 
due
 
to
 
d•s
 
TODO
 
»move
 
£e
 #94

41 
c
.
IOCTL
 = 
	`»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".ioùl").
	$š™
(
ty³s
)

43 
loÿl
 
S
 = 
»quœe
 "sysÿÎ.sysÿÎs".
	$š™
(
C
, 
c
, 
ty³s
)

45 
S
.
abi
, S.
ty³s
, S.
t
, S.
c
 =‡bi,y³s,y³s.t, c -- 
add
 
to
 
maš
 
bË
 
»tuºed


47 -- 
add
 
com·tib™y
 
code


48 
S
 = 
»quœe
 "sysÿÎ.com·t".
	`š™
(S)

50 -- 
add
 
funùiÚs
 
äom
 
libc


51 
S
 = 
»quœe
 "sysÿÎ.libc".
	`š™
(S)

53 -- 
add
 
m‘hods


54 
S
 = 
»quœe
 "sysÿÎ.m‘hods".
	`š™
(S)

56 -- 
add
 
uts


57 
S
.
ut
 = 
»quœe
 "sysÿÎ.ut".
	$š™
(
S
)

59 
abi
.
os
 =ğ"lšux" 
th’


60 
S
.
cgroup
 = 
»quœe
 "sysÿÎ.lšux.cgroup".
	$š™
(
S
)

61 
S
.
Æ
 = 
»quœe
 "sysÿÎ.lšux.Æ".
	`š™
(S)

62 -- 
TODO
 
add
 
the
 
Ùh”
 
Lšux
 
¥ecific
 
moduËs
 
h”e


63 
’d


65 
S
.
_VERSION
 = "v0.11pre"

66 
S
.
_DESCRIPTION
 = "ljsyscall: A Unix system call API for LuaJIT"

67 
S
.
_COPYRIGHT
 = "Copyright (C) 2011-2014 Justin Cormack. MIT†icensed."

69  
S


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/syscalls.lua

1 -- 
choo£
 
cÜ»ù
 
sysÿÎs
 
	gOS
, 
¶us
 
sh¬ed
 
	gÿÎs


2 -- 
nÙe
 
th©
 
wh”e
 
funùiÚs
 
¬e
 
id’tiÿl
 
´e£Á
 
but
 
may
 
be
 
missšg
 
they
 
ÿn
 
®so
 
go
 
	gh”e


3 -- 
nÙe
 
th©
 
OS
 
¥ecific
 
ÿÎs
 
¬e
 
lßded
 
©
 
the
 
’d
 
so
 
they
 
may
 
ov”ride
 
g’”ic
 c®l 
h”e


5 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

6 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

7 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
 =

8 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

9 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

10 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
¡ršg


12 
loÿl
 
	gabi
 = 
»quœe
 "syscall.abi"

13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

16 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

17 
loÿl
 
”r64
 = 
h
.err64

18 
loÿl
 
”½oš‹r
 = 
h
.errpointer

19 
loÿl
 
g‘fd
, 
	gi¡y³
, 
	gmkty³
, 
	g»v™”
 = 
h
.g‘fd, 
	gh
.i¡y³, h.mkty³, h.
»v™”


21 
loÿl
 
funùiÚ
 
š™
(
C
, 
c
, 
ty³s
)

23 -- 
this
 
could
 
be
 
ª
 
	g¬gum’ts
, 
fú
 
sysÿÎ
 
is
 
a
 
funùiÚ
 
of
his

24 
loÿl
 
	gfú
 = 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".fú").
	$š™
(
ty³s
)

26 
loÿl
 
”ºo
 = 
ffi
.errno

28 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

30 
loÿl
 
S
 = {
	}
}

32 
loÿl
 
funùiÚ
 
	$g‘dev
(
dev
)

33 
	`ty³
(
dev
è=ğ"bË" 
th’
  
t
.
	`deviû
(dev).dev 
’d


34 
ffi
.
	$i¡y³
(
t
.
deviû
, 
dev
è
th’
 dev = dev.dev 
’d


35  
dev


36 
’d


38 --  
h–³rs
.

40 -- 64 
b™
  
h–³rs
. 
OÆy
 
u£
 
l£ek
 
š
 
çù
; 
we
 u£ 
tÚumb”
 
but
 
»move
 
you
 
Ãed
 
fes
 
ov”
 56 
b™s
 

41 -- 
TODO
 
Úly
 
luaffi
 
Ãeds
 
the
 
ÿ¡
 
as
 
wÚt
 
com·»
 
to
 
numb”
; 
hİefuÎy
 
fixed
 
š
 
futu»
 
w™h
 5.3 
Ü
 
a
 
Ï‹r
†uaffi.

42 
loÿl
 
funùiÚ
 
	$»t64
(
»t
, 
”r
)

43 
»t
 =ğ
”r64
 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


44  
	$tÚumb”
(
»t
)

45 
’d


47 
loÿl
 
funùiÚ
 
	`»Šum
(
»t
, 
”r
è--  
Lua
 
numb”
 
wh”e
 
´ecisiÚ
 
ok
, 
eg
 
fe
 
İs
 
‘c


48 
»t
 = 
	$tÚumb”
(
»t
)

49 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


50  
»t


51 
’d


53 
loÿl
 
funùiÚ
 
	$»tfd
(
»t
, 
”r
)

54 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


55  
t
.
	$fd
(
»t
)

56 
’d


58 -- 
u£d
 
no
  
v®ue
,  
Œue
 
u£
 
of
 
as£¹


59 
loÿl
 
funùiÚ
 
	$»tboŞ
(
»t
, 
”r
)

60 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


61  
Œue


62 
’d


64 -- 
u£d
 
poš‹r
 
»tuºs
, -1 
is
 
çu»


65 
loÿl
 
funùiÚ
 
	$»Œ
(
»t
, 
”r
)

66 
»t
 =ğ
”½oš‹r
 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


67  
»t


68 
’d


70 -- 
g’”ic
 
™”©Ü
; 
this
 
couÁs
 
down
 
to
 0 
so
 
Ãed
 
no
 
şosu»


71 
loÿl
 
funùiÚ
 
	$»t™”
(
»t
, 
”r
, 
¬¿y
)

72 
»t
 = 
	$tÚumb”
(
»t
)

73 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


74  
»v™”
, 
¬¿y
, 
»t


75 
’d


77 -- 
g’”ic
 
sy¡em
 
ÿÎs


78 
funùiÚ
 
S
.
	$şo£
(
fd
è 
	`»tboŞ
(
C
.
	`şo£
(
	$g‘fd
(
fd
))è
’d


79 
funùiÚ
 
S
.
	$chdœ
(
·th
è 
	`»tboŞ
(
C
.
	$chdœ
(
·th
)è
’d


80 
funùiÚ
 
S
.
	$fchdœ
(
fd
è 
	`»tboŞ
(
C
.
	`fchdœ
(
	$g‘fd
(
fd
))è
’d


81 
funùiÚ
 
S
.
	$fchmod
(
fd
, 
mode
è 
	`»tboŞ
(
C
.
	`fchmod
(
	`g‘fd
(fd), 
c
.
MODE
[mode])è
’d


82 
funùiÚ
 
S
.
	$fchown
(
fd
, 
owÃr
, 
group
è 
	`»tboŞ
(
C
.
	`fchown
(
	`g‘fd
(fd), owÃ¸
Ü
 -1, grou°Ü -1)è
’d


83 
funùiÚ
 
S
.
	$lchown
(
·th
, 
owÃr
, 
group
è 
	`»tboŞ
(
C
.
	`lchown
Õ©h, owÃ¸
Ü
 -1, grou°Ü -1)è
’d


84 
funùiÚ
 
S
.
	$chroÙ
(
·th
è 
	`»tboŞ
(
C
.
	$chroÙ
(
·th
)è
’d


85 
funùiÚ
 
S
.
	$umask
(
mask
è 
C
.
	$umask
(
c
.
MODE
[
mask
]è
’d


86 
funùiÚ
 
S
.
	$sync
(è
C
.
	$sync
(è
’d


87 
funùiÚ
 
S
.
	$æock
(
fd
, 
İ”©iÚ
è 
	`»tboŞ
(
C
.
	`æock
(
	`g‘fd
(fd), 
c
.
LOCK
[İ”©iÚ])è
’d


88 -- 
TODO
 
»ad
 
should
 
have
 
cÚsi¡’t
  
ty³
 
but
 
th’
 
wl
 
difãr
 
äom
 
Ùh”
 
ÿÎs
.

89 
funùiÚ
 
S
.
	$»ad
(
fd
, 
buf
, 
couÁ
)

90 
buf
 
th’
  
	`»Šum
(
C
.
	`»ad
(
	`g‘fd
(
fd
), buf, 
couÁ
 
Ü
 #buàÜ 4096)è
’d
 -- 
u£r
 
suµl›d
 
a
 
bufãr
, 
¡ªd¬d
 
u§ge


91 
couÁ
 = couÁ 
Ü
 4096

92 
buf
 = 
t
.
	$bufãr
(
couÁ
)

93 
loÿl
 
»t
, 
”r
 = 
	`tÚumb”
(
C
.
	`»ad
(
	`g‘fd
(
fd
), 
buf
, 
couÁ
))

94 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


95  
ffi
.
	`¡ršg
(
buf
, 
»t
è-- 
u£r
 
g‘s
 
a
 
¡ršg
 
back
, 
ÿn
 
g‘
 
Ëngth
 
äom
 #string

96 
’d


97 
funùiÚ
 
S
.
	$»adv
(
fd
, 
iov
)

98 
iov
 = 
	$mkty³
(
t
.
iovecs
, 
iov
)

99  
	`»Šum
(
C
.
	`»adv
(
	`g‘fd
(
fd
), 
iov
.iov, #iov))

100 
’d


101 
funùiÚ
 
S
.
	$wr™e
(
fd
, 
buf
, 
couÁ
è 
	`»Šum
(
C
.
	`wr™e
(
	`g‘fd
(fd), buf, couÁ 
Ü
 #buf)è
’d


102 
funùiÚ
 
S
.
	$wr™ev
(
fd
, 
iov
)

103 
iov
 = 
	$mkty³
(
t
.
iovecs
, 
iov
)

104  
	`»Šum
(
C
.
	`wr™ev
(
	`g‘fd
(
fd
), 
iov
.iov, #iov))

105 
’d


106 
funùiÚ
 
S
.
	$´—d
(
fd
, 
buf
, 
couÁ
, 
off£t
è 
	`»Šum
(
C
.
	`´—d
(
	`g‘fd
(fd), buf, couÁ, off£t)è
’d


107 
funùiÚ
 
S
.
	$pwr™e
(
fd
, 
buf
, 
couÁ
, 
off£t
è 
	`»Šum
(
C
.
	`pwr™e
(
	`g‘fd
(fd), buf, couÁ 
Ü
 #buf, off£t)è
’d


108 
C
.
´—dv
 
ªd
 C.
pwr™ev
 
th’
 -- 
the£
 
¬e
 
missšg
 
š
 
eg
 
OSX


109 
funùiÚ
 
S
.
	$´—dv
(
fd
, 
iov
, 
off£t
)

110 
iov
 = 
	$mkty³
(
t
.
iovecs
, 
iov
)

111  
	`»Šum
(
C
.
	`´—dv
(
	`g‘fd
(
fd
), 
iov
.iov, #iov, 
off£t
))

112 
’d


113 
funùiÚ
 
S
.
	$pwr™ev
(
fd
, 
iov
, 
off£t
)

114 
iov
 = 
	$mkty³
(
t
.
iovecs
, 
iov
)

115  
	`»Šum
(
C
.
	`pwr™ev
(
	`g‘fd
(
fd
), 
iov
.iov, #iov, 
off£t
))

116 
’d


117 
’d


118 
funùiÚ
 
S
.
	$l£ek
(
fd
, 
off£t
, 
wh’û
)

119  
	`»t64
(
C
.
	`l£ek
(
	`g‘fd
(
fd
), 
off£t
 
Ü
 0, 
c
.
SEEK
[
wh’û
 o¸c.SEEK.
SET
]))

120 
’d


121 
C
.
»adlšk
 
th’


122 
funùiÚ
 
S
.
	$»adlšk
(
·th
, 
bufãr
, 
size
)

123 
size
 = siz
Ü
 
c
.
PATH_MAX


124 
bufãr
 = bufã¸
Ü
 
t
.
	$bufãr
(
size
)

125 
loÿl
 
»t
, 
”r
 = 
	`tÚumb”
(
C
.
	$»adlšk
(
·th
, 
bufãr
, 
size
))

126 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


127  
ffi
.
	$¡ršg
(
bufãr
, 
»t
)

128 
’d


130 
funùiÚ
 
S
.
	$»adlšk
(
·th
, 
bufãr
, 
size
)

131 
size
 = siz
Ü
 
c
.
PATH_MAX


132 
bufãr
 = bufã¸
Ü
 
t
.
	$bufãr
(
size
)

133 
loÿl
 
»t
, 
”r
 = 
	`tÚumb”
(
C
.
	$»adlšk©
(
c
.
AT_FDCWD
.
FDCWD
, 
·th
, 
bufãr
, 
size
))

134 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


135  
ffi
.
	$¡ršg
(
bufãr
, 
»t
)

136 
’d


137 
’d


138 
funùiÚ
 
S
.
	$fsync
(
fd
è 
	`»tboŞ
(
C
.
	`fsync
(
	$g‘fd
(
fd
))è
’d


139 
C
.
¡©
 
th’


140 
funùiÚ
 
S
.
	$¡©
(
·th
, 
buf
)

141 
nÙ
 
buf
 
th’
 buàğ
t
.
	$¡©
(è
’d


142 
loÿl
 
»t
 = 
C
.
	$¡©
(
·th
, 
buf
)

143 
»t
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


144  
buf


145 
’d


147 
funùiÚ
 
S
.
	$¡©
(
·th
, 
buf
)

148 
nÙ
 
buf
 
th’
 buàğ
t
.
	$¡©
(è
’d


149 
loÿl
 
»t
 = 
C
.
	$f¡©©
(
c
.
AT_FDCWD
.
FDCWD
, 
·th
, 
buf
, 0)

150 
»t
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


151  
buf


152 
’d


153 
’d


154 
C
.
l¡©
 
th’


155 
funùiÚ
 
S
.
	$l¡©
(
·th
, 
buf
)

156 
nÙ
 
buf
 
th’
 buàğ
t
.
	$¡©
(è
’d


157 
loÿl
 
»t
, 
”r
 = 
C
.
	$l¡©
(
·th
, 
buf
)

158 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


159  
buf


160 
’d


162 
funùiÚ
 
S
.
	$l¡©
(
·th
, 
buf
)

163 
nÙ
 
buf
 
th’
 buàğ
t
.
	$¡©
(è
’d


164 
loÿl
 
»t
, 
”r
 = 
C
.
	$f¡©©
(
c
.
AT_FDCWD
.
FDCWD
, 
·th
, 
buf
, c.
AT
.
SYMLINK_NOFOLLOW
)

165 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


166  
buf


167 
’d


168 
’d


169 
funùiÚ
 
S
.
	$f¡©
(
fd
, 
buf
)

170 
nÙ
 
buf
 
th’
 buàğ
t
.
	$¡©
(è
’d


171 
loÿl
 
»t
, 
”r
 = 
C
.
	`f¡©
(
	`g‘fd
(
fd
), 
buf
)

172 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


173  
buf


174 
’d


175 
funùiÚ
 
S
.
	$Œunÿ‹
(
·th
, 
Ëngth
è 
	`»tboŞ
(
C
.
	$Œunÿ‹
(
·th
, 
Ëngth
)è
’d


176 
funùiÚ
 
S
.
	$árunÿ‹
(
fd
, 
Ëngth
è 
	`»tboŞ
(
C
.
	`árunÿ‹
(
	`g‘fd
(fd),†’gth)è
’d


178 -- 
»ûÁ
 
Lšux
 
dÛs
 
nÙ
 
have
 
İ’
, 
rmdœ
, 
uÆšk
 
‘c
 
ªy
 
mÜe
 
as
 
sysÿÎs


179 
C
.
İ’
 
th’


180 
funùiÚ
 
S
.
	$İ’
(
·thÇme
, 
æags
, 
mode
è 
	`»tfd
(
C
.
	$İ’
(
·thÇme
, 
c
.
O
[
æags
], c.
MODE
[
mode
])è
’d


182 
funùiÚ
 
S
.
	$İ’
(
·thÇme
, 
æags
, 
mode
è 
	`»tfd
(
C
.
	$İ’©
(
c
.
AT_FDCWD
.
FDCWD
, 
·thÇme
, c.
O
[
æags
], c.
MODE
[
mode
])è
’d


183 
’d


184 
C
.
rmdœ
 
th’


185 
funùiÚ
 
S
.
	$rmdœ
(
·th
è 
	`»tboŞ
(
C
.
	$rmdœ
(
·th
)è
’d


187 
funùiÚ
 
S
.
	$rmdœ
(
·th
è 
	`»tboŞ
(
C
.
	$uÆšk©
(
c
.
AT_FDCWD
.
FDCWD
, 
·th
, c.
AT
.
REMOVEDIR
)è
’d


188 
’d


189 
C
.
uÆšk
 
th’


190 
funùiÚ
 
S
.
	$uÆšk
(
·thÇme
è 
	`»tboŞ
(
C
.
	$uÆšk
(
·thÇme
)è
’d


192 
funùiÚ
 
S
.
	$uÆšk
(
·th
è 
	`»tboŞ
(
C
.
	$uÆšk©
(
c
.
AT_FDCWD
.
FDCWD
, 
·th
, 0)è
’d


193 
’d


194 
C
.
chmod
 
th’


195 
funùiÚ
 
S
.
	$chmod
(
·th
, 
mode
è 
	`»tboŞ
(
C
.
	$chmod
(
·th
, 
c
.
MODE
[
mode
])è
’d


197 
funùiÚ
 
S
.
	$chmod
(
·th
, 
mode
è 
	`»tboŞ
(
C
.
	$fchmod©
(
c
.
AT_FDCWD
.
FDCWD
, 
·th
, c.
MODE
[
mode
], 0)è
’d


198 
’d


199 
C
.
acûss
 
th’


200 
funùiÚ
 
S
.
	$acûss
(
·thÇme
, 
mode
è 
	`»tboŞ
(
C
.
	$acûss
(
·thÇme
, 
c
.
OK
[
mode
])è
’d


202 
funùiÚ
 
S
.
	$acûss
(
·thÇme
, 
mode
è 
	`»tboŞ
(
C
.
	$çcûs§t
(
c
.
AT_FDCWD
.
FDCWD
, 
·thÇme
, c.
OK
[
mode
], 0)è
’d


203 
’d


204 
C
.
chown
 
th’


205 
funùiÚ
 
S
.
	$chown
(
·th
, 
owÃr
, 
group
è 
	`»tboŞ
(
C
.
	`chown
Õ©h, owÃ¸
Ü
 -1, grou°Ü -1)è
’d


207 
funùiÚ
 
S
.
	$chown
(
·th
, 
owÃr
, 
group
è 
	`»tboŞ
(
C
.
	`fchowÇt
(
c
.
AT_FDCWD
.
FDCWD
,…©h, owÃ¸
Ü
 -1, grou°Ü -1, 0)è
’d


208 
’d


209 
C
.
mkdœ
 
th’


210 
funùiÚ
 
S
.
	$mkdœ
(
·th
, 
mode
è 
	`»tboŞ
(
C
.
	$mkdœ
(
·th
, 
c
.
MODE
[
mode
])è
’d


212 
funùiÚ
 
S
.
	$mkdœ
(
·th
, 
mode
è 
	`»tboŞ
(
C
.
	$mkdœ©
(
c
.
AT_FDCWD
.
FDCWD
, 
·th
, c.
MODE
[
mode
])è
’d


213 
’d


214 
C
.
symlšk
 
th’


215 
funùiÚ
 
S
.
	$symlšk
(
Şd·th
, 
Ãw·th
è 
	`»tboŞ
(
C
.
	$symlšk
(
Şd·th
, 
Ãw·th
)è
’d


217 
funùiÚ
 
S
.
	$symlšk
(
Şd·th
, 
Ãw·th
è 
	`»tboŞ
(
C
.
	$symlšk©
(
Şd·th
, 
c
.
AT_FDCWD
.
FDCWD
, 
Ãw·th
)è
’d


218 
’d


219 
C
.
lšk
 
th’


220 
funùiÚ
 
S
.
	$lšk
(
Şd·th
, 
Ãw·th
è 
	`»tboŞ
(
C
.
	$lšk
(
Şd·th
, 
Ãw·th
)è
’d


222 
funùiÚ
 
S
.
	$lšk
(
Şd·th
, 
Ãw·th
è 
	`»tboŞ
(
C
.
	$lšk©
(
c
.
AT_FDCWD
.
FDCWD
, 
Şd·th
, c.AT_FDCWD.FDCWD, 
Ãw·th
, 0)è
’d


223 
’d


224 
C
.
»Çme
 
th’


225 
funùiÚ
 
S
.
	$»Çme
(
Şd·th
, 
Ãw·th
è 
	`»tboŞ
(
C
.
	$»Çme
(
Şd·th
, 
Ãw·th
)è
’d


227 
funùiÚ
 
S
.
	$»Çme
(
Şd·th
, 
Ãw·th
è 
	`»tboŞ
(
C
.
	$»Çm—t
(
c
.
AT_FDCWD
.
FDCWD
, 
Şd·th
, c.AT_FDCWD.FDCWD, 
Ãw·th
)è
’d


228 
’d


229 
C
.
mknod
 
th’


230 
funùiÚ
 
S
.
	$mknod
(
·thÇme
, 
mode
, 
dev
è 
	`»tboŞ
(
C
.
	`mknod
Õ©hÇme, 
c
.
S_I
[mode], 
	$g‘dev
(
dev
è
Ü
 0)è
’d


232 
funùiÚ
 
S
.
	$mknod
(
·thÇme
, 
mode
, 
dev
è 
	`»tboŞ
(
C
.
	`mknod©
(
c
.
AT_FDCWD
.
FDCWD
,…©hÇme, c.
S_I
[mode], 
	$g‘dev
(
dev
è
Ü
 0)è
’d


233 
’d


235 
loÿl
 
funùiÚ
 
	`¥rÙo
(
domaš
, 
´ÙocŞ
è-- 
h–³r
 funùiÚ 
to
 
lookup
…rÙocŞ 
ty³
 
d•’dšg
 
Ú
 domaš 
TODO
 
bË
?

236 
´ÙocŞ
 =…rÙocŞ 
Ü
 0

237 
domaš
 =ğ
c
.
AF
.
NETLINK
 
th’
  c.NETLINK[
´ÙocŞ
] 
’d


238  
c
.
IPPROTO
[
´ÙocŞ
]

239 
’d


241 
funùiÚ
 
S
.
	$sock‘
(
domaš
, 
¡y³
, 
´ÙocŞ
)

242 
domaš
 = 
c
.
AF
[domain]

243  
	`»tfd
(
C
.
	`sock‘
(
domaš
, 
c
.
SOCK
[
¡y³
], 
	$¥rÙo
(
domaš
, 
´ÙocŞ
)))

244 
’d


245 
funùiÚ
 
S
.
	$sock‘·œ
(
domaš
, 
¡y³
, 
´ÙocŞ
, 
sv2
)

246 
domaš
 = 
c
.
AF
[domain]

247 
sv2
 = sv2 
Ü
 
t
.
	$št2
()

248 
loÿl
 
»t
, 
”r
 = 
C
.
	`sock‘·œ
(
domaš
, 
c
.
SOCK
[
¡y³
], 
	`¥rÙo
(domaš, 
´ÙocŞ
), 
sv2
)

249 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


250  
Œue
, 
n
, 
t
.
	`fd
(
sv2
[0]),.
	$fd
(
sv2
[1])

251 
’d


253 
funùiÚ
 
S
.
	$dup
(
Şdfd
è 
	`»tfd
(
C
.
	`dup
(
	$g‘fd
(
Şdfd
))è
’d


254 
C
.
dup2
 
th’
 
funùiÚ
 
S
.
	$dup2
(
Şdfd
, 
Ãwfd
è 
	`»tfd
(
C
.
	`dup2
(
	`g‘fd
(Şdfd), 
	$g‘fd
(
Ãwfd
))è
’d
ƒnd

255 
C
.
dup3
 
th’
 
funùiÚ
 
S
.
	$dup3
(
Şdfd
, 
Ãwfd
, 
æags
è 
	`»tfd
(
C
.
	`dup3
(
	`g‘fd
(Şdfd), g‘fdÒewfd), fÏg 
Ü
 0)è
’d
ƒnd

257 
funùiÚ
 
S
.
	$£ndto
(
fd
, 
buf
, 
couÁ
, 
æags
, 
addr
, 
add¾’
)

258 
nÙ
 
addr
 
th’
 
add¾’
 = 0 
’d


259 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

260  
	`»Šum
(
C
.
	`£ndto
(
	`g‘fd
(
fd
), 
buf
, 
couÁ
 
Ü
 #buf, 
c
.
MSG
[
æags
], 
§ddr
, 
add¾’
 or #addr))

261 
’d


262 
funùiÚ
 
S
.
	$»cväom
(
fd
, 
buf
, 
couÁ
, 
æags
, 
addr
, 
add¾’
)

263 
loÿl
 
§ddr


264 
addr
 =ğ
çl£
 
th’


265 
addr
 = 
n


266 
add¾’
 = 
n


268 
addr
 
th’


269 
add¾’
 =‡dd¾’ 
Ü
 #addr

271 
addr
 = 
t
.
	$sockaddr_¡Üage
()

272 
add¾’
 =‡dd¾’ 
Ü
 
s
.
sockaddr_¡Üage


273 
’d


274 
	`ty³
(
add¾’
è=ğ"numb”" 
th’
‡dd¾’ = 
t
.
	$sockËn1
(
add¾’
è
’d


275 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

276 
’d


277 
loÿl
 
»t
, 
”r
 = 
C
.
	`»cväom
(
	`g‘fd
(
fd
), 
buf
, 
couÁ
 
Ü
 #buf, 
c
.
MSG
[
æags
], 
§ddr
, 
add¾’
è-- 
TODO
‡dd¾’ 0 
h”e
???

278 
»t
 = 
	$tÚumb”
(
»t
)

279 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


280 
addr
 
th’
  
»t
, 
n
, 
t
.
	$§
(
addr
, 
add¾’
[0]è 
»t
 
’d


281 
’d


282 
funùiÚ
 
S
.
	$£ndmsg
(
fd
, 
msg
, 
æags
)

283 
nÙ
 
msg
 
th’
 -- 
£nd
 
a
 
sšgË
 
by‹
 
mes§ge
, 
eg
 
’ough
 
to
 s’d 
üed’tŸls


284 
loÿl
 
buf1
 = 
t
.
	$bufãr
(1)

285 
loÿl
 
io
 = 
t
.
iovecs
{{
buf1
, 1}
	}
}

286 
msg
 = 
t
.
msghdr
{
msg_iov
 = 
io
.
iov
, 
	gmsg_iovËn
 = #io}

287 
’d


288  
»Šum
(
C
.
£ndmsg
(
g‘fd
(
fd
), 
msg
, 
c
.
MSG
[
æags
]))

289 
’d


290 
funùiÚ
 
	gS
.
	$»cvmsg
(
fd
, 
msg
, 
æags
è 
	`»Šum
(
C
.
	`»cvmsg
(
	`g‘fd
(fd), msg, 
c
.
MSG
[æags])è
’d


292 -- 
TODO
 
b‘‹r
 
hªdlšg
 
of
 
msgvec
, 
ü—‹
 
Úe
 
¡ruùu»
/
bË


293 
C
.
£ndmmsg
 
th’


294 
funùiÚ
 
S
.
	$£ndmmsg
(
fd
, 
msgvec
, 
æags
)

295 
msgvec
 = 
	$mkty³
(
t
.
mmsghdrs
, 
msgvec
)

296  
	`»tboŞ
(
C
.
	`£ndmmsg
(
	`g‘fd
(
fd
), 
msgvec
.
msg
, msgvec.
couÁ
, 
c
.
MSG
[
æags
]))

297 
’d


298 
’d


299 
C
.
»cvmmsg
 
th’


300 
funùiÚ
 
S
.
	$»cvmmsg
(
fd
, 
msgvec
, 
æags
, 
timeout
)

301 
timeout
 
th’
imeouˆğ
	$mkty³
(
t
.
time¥ec
, 
timeout
è
’d


302 
msgvec
 = 
	$mkty³
(
t
.
mmsghdrs
, 
msgvec
)

303  
	`»tboŞ
(
C
.
	`»cvmmsg
(
	`g‘fd
(
fd
), 
msgvec
.
msg
, msgvec.
couÁ
, 
c
.
MSG
[
æags
], 
timeout
))

304 
’d


305 
’d


307 -- 
TODO
 {
g‘
,
£t
}sockİˆmay‚“d b‘‹¸ty³ hªdlšg s“‚ew unfšished sockİˆfe,…lu nÙ‡lway c.SO[]

308 
funùiÚ
 
	gS
.
£tsockİt
(
fd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)

309 -- 
®loÿ‹
 
bufãr
 
	gu£r
, 
äom
 
Lua
 
ty³
 
know
 
	ghow
, 
ªd
 
boŞ
 
so
 
çr


310 
nÙ
 
İ’
 
ªd
 
ty³
(
İtv®
è=ğ'boŞ—n' 
th’
 o±v® = 
h
.
	$boŞtoc
(
İtv®
è
’d


311 
nÙ
 
İ’
 
ªd
 
	`ty³
(
İtv®
è=ğ'numb”' 
th’


312 
İtv®
 = 
t
.
	$št1
(
İtv®
)

313 
İ’
 = 
s
.

314 
’d


315  
	`»tboŞ
(
C
.
	`£tsockİt
(
	`g‘fd
(
fd
), 
c
.
SOL
[
Ëv–
], c.
SO
[
İŠame
], 
İtv®
, 
İ’
))

316 
’d


317 
funùiÚ
 
S
.
	$g‘sockİt
(
fd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)

318 
nÙ
 
İtv®
 
th’
 o±v®, 
İ’
 = 
t
.
	`št1
(), 
s
.
’d


319 
İ’
 = o±ËÀ
Ü
 #optval

320 
loÿl
 
Ën
 = 
t
.
	$sockËn1
(
İ’
)

321 
loÿl
 
»t
, 
”r
 = 
C
.
	`g‘sockİt
(
	`g‘fd
(
fd
), 
c
.
SOL
[
Ëv–
], c.
SO
[
İŠame
], 
İtv®
, 
Ën
)

322 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


323 
Ën
[0] ~ğ
İ’
 
th’
 
	`”rÜ
("šcÜ»ù o±ËÀfÜ g‘sockİt: s‘ " .. o±ËÀ.. " gÙ " ..†’[0]è
’d


324  
İtv®
[0] -- 
TODO
 
wl
 
nÙ
 
wÜk
 , 
eg
 
£e
 
Ãtf‹r


325 
’d


326 
funùiÚ
 
S
.
	$bšd
(
sockfd
, 
addr
, 
add¾’
)

327 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

328  
	`»tboŞ
(
C
.
	`bšd
(
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
 
Ü
 #addr))

329 
’d


330 
funùiÚ
 
S
.
	$li¡’
(
sockfd
, 
backlog
è 
	`»tboŞ
(
C
.
	`li¡’
(
	`g‘fd
(sockfd), backlog 
Ü
 
c
.
SOMAXCONN
)è
’d


331 
funùiÚ
 
S
.
	$cÚÃù
(
sockfd
, 
addr
, 
add¾’
)

332 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

333  
	`»tboŞ
(
C
.
	`cÚÃù
(
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
 
Ü
 #addr))

334 
’d


335 
funùiÚ
 
S
.
	$acû±
(
sockfd
, 
addr
, 
add¾’
)

336 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

337 
addr
 
th’
 
add¾’
 =‡dd¾’ 
Ü
 
t
.
	$sockËn1
(è
’d


338  
	`»tfd
(
C
.
	`acû±
(
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
))

339 
’d


340 
funùiÚ
 
S
.
	$g‘sockÇme
(
sockfd
, 
addr
, 
add¾’
)

341 
addr
 =‡dd¸
Ü
 
t
.
	$sockaddr_¡Üage
()

342 
add¾’
 =‡dd¾’ 
Ü
 
t
.
	`sockËn1
(#addr)

343 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

344 
loÿl
 
»t
, 
”r
 = 
C
.
	`g‘sockÇme
(
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
)

345 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


346  
t
.
	$§
(
addr
, 
add¾’
[0])

347 
’d


348 
funùiÚ
 
S
.
	$g‘³”Çme
(
sockfd
, 
addr
, 
add¾’
)

349 
addr
 =‡dd¸
Ü
 
t
.
	$sockaddr_¡Üage
()

350 
add¾’
 =‡dd¾’ 
Ü
 
t
.
	`sockËn1
(#addr)

351 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

352 
loÿl
 
»t
, 
”r
 = 
C
.
	`g‘³”Çme
(
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
)

353 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


354  
t
.
	$§
(
addr
, 
add¾’
[0])

355 
’d


356 
funùiÚ
 
S
.
	$shutdown
(
sockfd
, 
how
è 
	`»tboŞ
(
C
.
	`shutdown
(
	`g‘fd
(sockfd), 
c
.
SHUT
[how])è
’d


357 
C
.
pŞl
 
th’


358 
funùiÚ
 
S
.
	$pŞl
(
fds
, 
timeout
è 
	`»Šum
(
C
.
	`pŞl
(fds.
pfd
, #fds,imeouˆ
Ü
 -1)è
’d


359 
’d


360 -- 
TODO
 
»wÜk
 
fd£t
 
š‹rçû
, 
£e
 
issue
 #71

361 -- 
fd£t
 
hªdËrs


362 
loÿl
 
funùiÚ
 
	`mkfd£t
(
fds
, 
nfds
è-- 
should
 
´obably
 
check
 
fd
 
is
 
w™hš
 
	`¿nge
 (1024), 
Ü
 
ju¡
 
ex·nd
 
¡ruùu»
 
size


363 
loÿl
 
£t
 = 
t
.
	$fd£t
()

364 
i
, 
v
 
š
 
	$aœs
(
fds
) do

365 
loÿl
 
fd
 = 
	`tÚumb”
(
	$g‘fd
(
v
))

366 
fd
 + 1 > 
nfds
 
th’
‚fd ğfd + 1 
’d


367 
loÿl
 
fd–t
 = 
b™
.
	`rshiá
(
fd
, 5è-- 
®ways
 32 
b™s


368 
£t
.
fds_b™s
[
fd–t
] = 
b™
.
	`bÜ
(£t.fds_b™s[fd–t], b™.
	`lshiá
(1, 
fd
 % 32)è-- 
®ways
 32 b™ 
wÜds


369 
’d


370  
£t
, 
nfds


371 
’d


373 
loÿl
 
funùiÚ
 
	$fdis£t
(
fds
, 
£t
)

374 
loÿl
 
f
 = {
	}
}

375 
i
, 
v
 
š
 
	$aœs
(
fds
) do

376 
loÿl
 
fd
 = 
	`tÚumb”
(
	$g‘fd
(
v
))

377 
loÿl
 
fd–t
 = 
b™
.
	`rshiá
(
fd
, 5è-- 
®ways
 32 
b™s


378 
b™
.
	`bªd
(
£t
.
fds_b™s
[
fd–t
], b™.
	`lshiá
(1, 
fd
 % 32)è~ğ0 
th’
 
bË
.
	$š£¹
(
f
, 
v
è
’d
 -- 
ÿ»ful
 
nÙ
 
to
 
du¶iÿ‹
 
fd
 
objeùs


379 
’d


380  
f


381 
’d


383 -- 
TODO
 
cÚv”t
 
to
 
m‘©y³
. 
ProbËm
 
is
 
how
Ø
d—l
 
w™h
 
nfds


384 
C
.
£Ëù
 
th’


385 
funùiÚ
 
S
.
	`£Ëù
(
£l
, 
timeout
è-- 
nÙe
 
§me
 
¡ruùu»
 
as
 
»tuºed


386 
loÿl
 
r
, 
w
, 
e


387 
loÿl
 
nfds
 = 0

388 
timeout
 
th’
imeouˆğ
	$mkty³
(
t
.
timev®
, 
timeout
è
’d


389 
r
, 
nfds
 = 
	`mkfd£t
(
£l
.
»adfds
 
Ü
 {
	}
},‚fd 
	gÜ
 0)

390 
	gw
, 
	gnfds
 = 
mkfd£t
(
£l
.
wr™efds
 
Ü
 {}, 
nfds
)

391 
	ge
, 
	gnfds
 = 
mkfd£t
(
£l
.
exû±fds
 
Ü
 {}, 
nfds
)

392 
loÿl
 
	g»t
, 
	g”r
 = 
C
.
	$£Ëù
(
nfds
, 
r
, 
w
, 
e
, 
timeout
)

393 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


394  {
»adfds
 = 
	`fdis£t
(
£l
.»adfd 
Ü
 {}, 
r
), 
wr™efds
 = fdis£t(£l.wr™efd Ü {}, 
w
),

395 
exû±fds
 = 
	`fdis£t
(
£l
.exû±fd 
Ü
 {}, 
e
), 
couÁ
 = 
	`tÚumb”
(
»t
)
	}
}

396 
’d


398 
funùiÚ
 
	gS
.
	$£Ëù
(
£l
, 
timeout
)

399 
timeout
 
th’
imeouˆğ
	`mkty³
(
t
.
time¥ec
,imeouˆ/ 1000è
’d


400  
S
.
	$p£Ëù
(
£l
, 
timeout
)

401 
’d


402 
’d


404 -- 
TODO
 
nÙe
 
th©
 
š
 
Lšux
 
sysÿÎ
 
modif›s
 
timeout
, 
which
 
is
 
nÚ
 
¡ªd¬d
, 
like
 
µŞl


405 
funùiÚ
 
S
.
	`p£Ëù
(
£l
, 
timeout
, 
£t
è-- 
nÙe
 
§me
 
¡ruùu»
 
as
 
»tuºed


406 
loÿl
 
r
, 
w
, 
e


407 
loÿl
 
nfds
 = 0

408 
timeout
 
th’
imeouˆğ
	$mkty³
(
t
.
time¥ec
, 
timeout
è
’d


409 
£t
 
th’
 s‘ = 
	$mkty³
(
t
.
sig£t
, 
£t
è
’d


410 
r
, 
nfds
 = 
	`mkfd£t
(
£l
.
»adfds
 
Ü
 {
	}
},‚fd 
	gÜ
 0)

411 
	gw
, 
	gnfds
 = 
mkfd£t
(
£l
.
wr™efds
 
Ü
 {}, 
nfds
)

412 
	ge
, 
	gnfds
 = 
mkfd£t
(
£l
.
exû±fds
 
Ü
 {}, 
nfds
)

413 
loÿl
 
	g»t
, 
	g”r
 = 
C
.
	$p£Ëù
(
nfds
, 
r
, 
w
, 
e
, 
timeout
, 
£t
)

414 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


415  {
»adfds
 = 
	`fdis£t
(
£l
.»adfd 
Ü
 {}, 
r
), 
wr™efds
 = fdis£t(£l.wr™efd Ü {}, 
w
),

416 
exû±fds
 = 
	`fdis£t
(
£l
.exû±fd 
Ü
 {}, 
e
), 
couÁ
 = 
	`tÚumb”
(
»t
)
	}
}

417 
’d


419 
funùiÚ
 
	gS
.
	$g‘uid
(è 
C
.
	$g‘uid
(è
’d


420 
funùiÚ
 
S
.
	$g‘euid
(è 
C
.
	$g‘euid
(è
’d


421 
funùiÚ
 
S
.
	$g‘pid
(è 
C
.
	$g‘pid
(è
’d


422 
funùiÚ
 
S
.
	$g‘µid
(è 
C
.
	$g‘µid
(è
’d


423 
funùiÚ
 
S
.
	$g‘gid
(è 
C
.
	$g‘gid
(è
’d


424 
funùiÚ
 
S
.
	$g‘egid
(è 
C
.
	$g‘egid
(è
’d


425 
funùiÚ
 
S
.
	$£tuid
(
uid
è 
	`»tboŞ
(
C
.
	$£tuid
(
uid
)è
’d


426 
funùiÚ
 
S
.
	$£tgid
(
gid
è 
	`»tboŞ
(
C
.
	$£tgid
(
gid
)è
’d


427 
funùiÚ
 
S
.
	$£‹uid
(
uid
è 
	`»tboŞ
(
C
.
	$£‹uid
(
uid
)è
’d


428 
funùiÚ
 
S
.
	$£‹gid
(
gid
è 
	`»tboŞ
(
C
.
	$£‹gid
(
gid
)è
’d


429 
funùiÚ
 
S
.
	$g‘sid
(
pid
è 
	`»Šum
(
C
.
	$g‘sid
(
pid
 
Ü
 0)è
’d


430 
funùiÚ
 
S
.
	$£tsid
(è 
	`»Šum
(
C
.
	$£tsid
()è
’d


431 
funùiÚ
 
S
.
	$£gid
(
pid
, 
pgid
è 
	`»tboŞ
(
C
.
	$£gid
(
pid
 
Ü
 0, 
pgid
 o¸0)è
’d


432 
funùiÚ
 
S
.
	$g‘pgid
(
pid
è 
	`»Šum
(
C
.
	$g‘pgid
(
pid
 
Ü
 0)è
’d


433 
C
.
g‘pg½
 
th’


434 
funùiÚ
 
S
.
	$g‘pg½
(è 
	`»Šum
(
C
.
	$g‘pg½
()è
’d


436 
funùiÚ
 
S
.
	$g‘pg½
(è 
	`»Šum
(
C
.
	$g‘pgid
(0)è
’d


437 
’d


438 
funùiÚ
 
S
.
	$g‘groups
()

439 
loÿl
 
size
 = 
C
.
	`g‘groups
(0, 
n
è-- 
nÙe
 
BSD
 
could
 
u£
 
NGROUPS_MAX
 
š¡—d


440 
size
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


441 
loÿl
 
groups
 = 
t
.
	$groups
(
size
)

442 
loÿl
 
»t
 = 
C
.
	$g‘groups
(
size
, 
groups
.
li¡
)

443 
»t
 =ğ-1 
th’
  
n
, 
t
.
	$”rÜ
(è
’d


444  
groups


445 
’d


446 
funùiÚ
 
S
.
	$£tgroups
(
groups
)

447 
	`ty³
(
groups
è=ğ"bË" 
th’
 group ğ
t
.
	$groups
(
groups
è
’d


448  
	`»tboŞ
(
C
.
	$£tgroups
(
groups
.
couÁ
, groups.
li¡
))

449 
’d


451 
funùiÚ
 
S
.
	$sig´ocmask
(
how
, 
£t
, 
Şd£t
)

452 
Şd£t
 = old£ˆ
Ü
 
t
.
	$sig£t
()

453 
nÙ
 
£t
 
th’
 
how
 = 
c
.
SIGPM
.
SETMASK
 
’d
 -- 
v®ue
 
dÛs
‚Ù 
m©‹r
 £ˆ
n
, 
ju¡
 
»tuºs
 
Şd
 set

454 
loÿl
 
»t
, 
”r
 = 
C
.
	`sig´ocmask
(
c
.
SIGPM
[
how
], 
t
.
	`sig£t
(
£t
), 
Şd£t
)

455 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


456  
Şd£t


457 
’d


458 
funùiÚ
 
S
.
	$sig³ndšg
()

459 
loÿl
 
£t
 = 
t
.
	$sig£t
()

460 
loÿl
 
»t
, 
”r
 = 
C
.
	$sig³ndšg
(
£t
)

461 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


462  
£t


463 
’d


464 
funùiÚ
 
S
.
	$sigsu¥’d
(
mask
è 
	`»tboŞ
(
C
.
	`sigsu¥’d
(
t
.
	$sig£t
(
mask
))è
’d


465 
funùiÚ
 
S
.
	$kl
(
pid
, 
sig
è 
	`»tboŞ
(
C
.
	$kl
(
pid
, 
c
.
SIG
[
sig
])è
’d


467 -- 
_ex™
 
is
 
the
 
»®
 
ex™
 
sysÿÎ
, 
Ü
 
wh©ev”
 i 
su™abË
 
ov”ridd’
 
š
 
c
.
lua
; 
libc
.lu¨
may
 
ov”ride


468 
funùiÚ
 
S
.
	$ex™
(
¡©us
è
C
.
	$_ex™
(
c
.
EXIT
[
¡©us
 
Ü
 0]è
’d


470 
funùiÚ
 
S
.
	$fú
(
fd
, 
cmd
, 
¬g
)

471 
cmd
 = 
c
.
F
[cmd]

472 
fú
.
commªds
[
cmd
] 
th’
 
¬g
 = fú.commªds[cmd]×rgè
’d


473 
loÿl
 
»t
, 
”r
 = 
C
.
	`fú
(
	`g‘fd
(
fd
), 
cmd
, 
±
.(
¬g
 
Ü
 0))

474 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


475 
fú
.
»t
[
cmd
] 
th’
  fú.»t[cmd]Ô‘, 
¬g
è
’d


476  
Œue


477 
’d


479 -- 
TODO
  
m‘©y³
 
th©
 
has
 
Ëngth
 
ªd
 
ÿn
 
gc
?

480 
funùiÚ
 
S
.
	$mm­
(
addr
, 
Ëngth
, 
´Ù
, 
æags
, 
fd
, 
off£t
)

481  
	`»Œ
(
C
.
	`mm­
(
addr
, 
Ëngth
, 
c
.
PROT
[
´Ù
], c.
MAP
[
æags
], 
	`g‘fd
(
fd
 
Ü
 -1), 
off£t
 or 0))

482 
’d


483 
funùiÚ
 
S
.
	$munm­
(
addr
, 
Ëngth
)

484  
	`»tboŞ
(
C
.
	$munm­
(
addr
, 
Ëngth
))

485 
’d


486 
funùiÚ
 
S
.
	$msync
(
addr
, 
Ëngth
, 
æags
è 
	`»tboŞ
(
C
.
	$msync
(
addr
, 
Ëngth
, 
c
.
MSYNC
[
æags
])è
’d


487 
funùiÚ
 
S
.
	$mlock
(
addr
, 
Ën
è 
	`»tboŞ
(
C
.
	$mlock
(
addr
, 
Ën
)è
’d


488 
funùiÚ
 
S
.
	$muÆock
(
addr
, 
Ën
è 
	`»tboŞ
(
C
.
	$muÆock
(
addr
, 
Ën
)è
’d


489 
funùiÚ
 
S
.
	$muÆock®l
(è 
	`»tboŞ
(
C
.
	$muÆock®l
()è
’d


490 
funùiÚ
 
S
.
	$madvi£
(
addr
, 
Ëngth
, 
adviû
è 
	`»tboŞ
(
C
.
	$madvi£
(
addr
, 
Ëngth
, 
c
.
MADV
[
adviû
])è
’d


492 
funùiÚ
 
S
.
	$ioùl
(
d
, 
»que¡
, 
¬gp
)

493 
loÿl
 
»ad
, 
sšgËtÚ
 = 
çl£
, false

494 
loÿl
 
Çme
 = 
»que¡


495 
	`ty³
(
Çme
è=ğ"¡ršg" 
th’


496 
»que¡
 = 
c
.
IOCTL
[
Çme
]

497 
’d


498 
	`ty³
(
»que¡
è=ğ"bË" 
th’


499 
loÿl
 
wr™e
 = 
»que¡
.write

500 
loÿl
 

 = 
»que¡
.
ty³


501 
»ad
 = 
»que¡
.read

502 
sšgËtÚ
 = 
»que¡
.singleton

503 
»que¡
 =„eque¡.
numb”


504 
	`ty³
(
¬gp
è~ğ"¡ršg" 
ªd
y³×rgpè~ğ"cd©a"‡nd 
ty³
 ~ğ"u£rd©a" 
th’


505 
wr™e
 
th’


506 
nÙ
 
¬gp
 
th’
 
	`”rÜ
("nØ¬gum’ˆsuµl›d fÜ ioùÈ" .. 
Çme
è
’d


507 
¬gp
 = 
	$mkty³
(

, 
¬gp
)

508 
’d


509 
»ad
 
th’


510 
¬gp
 =‡rg°
Ü
 
	$
()

511 
’d


512 
’d


513 -- 
some
 
§Ã
 
deçuÉs
 
no
 
šfo


514 
	`ty³
(
»que¡
è=ğ"bË" 
th’
„eque¡ =„eque¡.
numb”
 
’d


515 
	`ty³
(
¬gp
è=ğ"¡ršg" 
th’
‡rg°ğ
±
.×rgpè
’d


516 
	`ty³
(
¬gp
è=ğ"numb”" 
th’
‡rg°ğ
t
.
	$št1
(
¬gp
è
’d


517 
’d


518 
loÿl
 
»t
, 
”r
 = 
C
.
	`ioùl
(
	`g‘fd
(
d
), 
»que¡
, 
¬gp
)

519 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


520 
»ad
 
ªd
 
sšgËtÚ
 
th’
  
¬gp
[0] 
’d


521 
»ad
 
th’
  
¬gp
 
’d


522  
Œue
 -- 
wl
 
Ãed
 
ov”ride
 
ãw
 
lšux
 
Úes
 
th©
  
numb”s


523 
’d


525 
C
.
pe
 
th’


526 
funùiÚ
 
S
.
	$pe
(
fd2
)

527 
fd2
 = fd2 
Ü
 
t
.
	$št2
()

528 
loÿl
 
»t
, 
”r
 = 
C
.
	$pe
(
fd2
)

529 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


530  
Œue
, 
n
, 
t
.
	`fd
(
fd2
[0]),.
	$fd
(
fd2
[1])

531 
’d


533 
funùiÚ
 
S
.
	$pe
(
fd2
)

534 
fd2
 = fd2 
Ü
 
t
.
	$št2
()

535 
loÿl
 
»t
, 
”r
 = 
C
.
	$pe2
(
fd2
, 0)

536 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


537  
Œue
, 
n
, 
t
.
	`fd
(
fd2
[0]),.
	$fd
(
fd2
[1])

538 
’d


539 
’d


541 
C
.
g‘timeofday
 
th’


542 
funùiÚ
 
S
.
	$g‘timeofday
(
tv
)

543 
tv
 =v 
Ü
 
t
.
	`timev®
(è-- 
nÙe
 
™
 
is
 
ç¡”
 
to
 
·ss
 
your
 
own
v 
you
 
ÿÎ
 
a
 
lÙ


544 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘timeofday
(
tv
, 
n
)

545 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


546  
tv


547 
’d


548 
’d


550 
C
.
£‰imeofday
 
th’


551 
funùiÚ
 
S
.
	$£‰imeofday
(
tv
è 
	`»tboŞ
(
C
.
	$£‰imeofday
(
tv
, 
n
)è
’d


552 
’d


554 
funùiÚ
 
S
.
	$g‘ru§ge
(
who
, 
ru
)

555 
ru
 =„u 
Ü
 
t
.
	$ru§ge
()

556 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘ru§ge
(
c
.
RUSAGE
[
who
], 
ru
)

557 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


558  
ru


559 
’d


561 
C
.
fÜk
 
th’


562 
funùiÚ
 
S
.
	$fÜk
(è 
	`»Šum
(
C
.
	$fÜk
()è
’d


564 
funùiÚ
 
S
.
	$fÜk
(è 
	`»Šum
(
C
.
	$şÚe
(
c
.
SIG
.
CHLD
, 0)è
’d


565 
’d


567 
funùiÚ
 
S
.
	$execve
(
f’ame
, 
¬gv
, 
’vp
)

568 
loÿl
 
ÿrgv
 = 
t
.
	`¡ršg_¬¿y
(#¬gv + 1, 
¬gv
 
Ü
 {
	}
})

569 
	gÿrgv
[#¬gv] = 
n
 -- 
LuaJIT
 
dÛs
 
nÙ
 
z”o
 
»¡
 
of
 
a
 
VLA


570 
loÿl
 
ûnvp
 = 
t
.
¡ršg_¬¿y
(#’v°+ 1, 
’vp
 
Ü
 {})

571 
	gûnvp
[#’vp] = 
n


572  
»tboŞ
(
C
.
	$execve
(
f’ame
, 
ÿrgv
, 
ûnvp
))

573 
’d


575 -- 
mª
 
·ge
 
§ys
 
obsŞ‘e
 
Lšux
, 
but
 
im¶em’‹d
 
ªd
 
u£ful
 
com·tib™y


576 
funùiÚ
 
S
.
	`wa™4
(
pid
, 
İtiÚs
, 
ru
, 
¡©us
è-- 
nÙe
 
Üd”
 
of
 
¬gum’ts
 
chªged
 
as
 
¿»ly
 
suµly
 
	$¡©us
 (
as
 
wa™pid
)

577 
ru
 =ğ
çl£
 
th’
„u = 
n
 ru =„u 
Ü
 
t
.
	$ru§ge
(è
’d
 -- 
çl£
 
m—ns
 
no
 
®loÿtiÚ


578 
¡©us
 = stu 
Ü
 
t
.
	$št1
()

579 
loÿl
 
»t
, 
”r
 = 
C
.
	$wa™4
(
c
.
WAIT
[
pid
], 
¡©us
, c.
W
[
İtiÚs
], 
ru
)

580 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


581  
»t
, 
n
, 
t
.
	`wa™¡©us
(
¡©us
[0]), 
ru


582 
’d


584 
C
.
wa™pid
 
th’


585 
funùiÚ
 
S
.
	`wa™pid
(
pid
, 
İtiÚs
, 
¡©us
è-- 
nÙe
 
Üd”
 
of
 
¬gum’ts
 
chªged
 
as
 
¿»ly
 
suµly
 status

586 
¡©us
 = stu 
Ü
 
t
.
	$št1
()

587 
loÿl
 
»t
, 
”r
 = 
C
.
	$wa™pid
(
c
.
WAIT
[
pid
], 
¡©us
, c.
W
[
İtiÚs
])

588 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


589  
»t
, 
n
, 
t
.
	$wa™¡©us
(
¡©us
[0])

590 
’d


591 
’d


593 
S
.
wa™id
 
th’


594 
funùiÚ
 
S
.
	`wa™id
(
idty³
, 
id
, 
İtiÚs
, 
šfİ
è-- 
nÙe
 
Üd”
 
of
 
¬gs
, 
as
 
usu®ly
 
dÚt
 
suµly
 infop

595 
nÙ
 
šfİ
 
th’
 infİ = 
t
.
	$sigšfo
(è
’d


596 
loÿl
 
»t
, 
”r
 = 
C
.
	$wa™id
(
c
.
P
[
idty³
], 
id
 
Ü
 0, 
šfİ
, c.
W
[
İtiÚs
])

597 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


598  
šfİ


599 
’d


600 
’d


602 
funùiÚ
 
S
.
	$£riÜ™y
(
which
, 
who
, 
´io
è 
	`»tboŞ
(
C
.
	$£riÜ™y
(
c
.
PRIO
[
which
], 
who
 
Ü
 0, 
´io
)è
’d


603 -- 
Lšux
 
ov”rides
 
g‘´iÜ™y
 
as
 
™
 
off£ts
  
v®ues
 
so
 
th©
 
they
 
¬e
 
nÙ
 
Ãg©ive


604 
funùiÚ
 
S
.
	$g‘´iÜ™y
(
which
, 
who
)

605 
	$”ºo
(0)

606 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘´iÜ™y
(
c
.
PRIO
[
which
], 
who
 
Ü
 0)

607 
»t
 =ğ-1 
	`ªd
 (
”r
 
Ü
 
	`”ºo
()è~ğ0 
th’
  
n
, 
t
.
	`”rÜ
Ó¼ o¸
	$”ºo
()è
’d


608  
»t


609 
’d


611 -- 
the£
 
may
 
nÙ
 
®ways
 
exi¡
, 
but
 
wh”e
 
they
 dØthey 
have
 
the
 
§me
 
š‹rçû


612 
C
.
ü—t
 
th’


613 
funùiÚ
 
S
.
	$ü—t
(
·thÇme
, 
mode
è 
	`»tfd
(
C
.
	$ü—t
(
·thÇme
, 
c
.
MODE
[
mode
])è
’d


614 
’d


615 
C
.
pe2
 
th’


616 
funùiÚ
 
S
.
	$pe2
(
æags
, 
fd2
)

617 
fd2
 = fd2 
Ü
 
t
.
	$št2
()

618 
loÿl
 
»t
, 
”r
 = 
C
.
	$pe2
(
fd2
, 
c
.
OPIPE
[
æags
])

619 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


620  
Œue
, 
n
, 
t
.
	`fd
(
fd2
[0]),.
	$fd
(
fd2
[1])

621 
’d


622 
’d


623 
C
.
mlock®l
 
th’


624 
funùiÚ
 
S
.
	$mlock®l
(
æags
è 
	`»tboŞ
(
C
.
	$mlock®l
(
c
.
MCL
[
æags
])è
’d


625 
’d


626 
C
.
lšk©
 
th’


627 
funùiÚ
 
S
.
	$lšk©
(
Şddœfd
, 
Şd·th
, 
Ãwdœfd
, 
Ãw·th
, 
æags
)

628  
	`»tboŞ
(
C
.
	$lšk©
(
c
.
AT_FDCWD
[
Şddœfd
], 
Şd·th
, c.AT_FDCWD[
Ãwdœfd
], 
Ãw·th
, c.
AT
[
æags
]))

629 
’d


630 
’d


631 
C
.
symlšk©
 
th’


632 
funùiÚ
 
S
.
	$symlšk©
(
Şd·th
, 
Ãwdœfd
, 
Ãw·th
è 
	`»tboŞ
(
C
.
	$symlšk©
(
Şd·th
, 
c
.
AT_FDCWD
[
Ãwdœfd
], 
Ãw·th
)è
’d


633 
’d


634 
C
.
uÆšk©
 
th’


635 
funùiÚ
 
S
.
	$uÆšk©
(
dœfd
, 
·th
, 
æags
è 
	`»tboŞ
(
C
.
	$uÆšk©
(
c
.
AT_FDCWD
[
dœfd
], 
·th
, c.
AT
[
æags
])è
’d


636 
’d


637 
C
.
»Çm—t
 
th’


638 
funùiÚ
 
S
.
	$»Çm—t
(
Şddœfd
, 
Şd·th
, 
Ãwdœfd
, 
Ãw·th
)

639  
	`»tboŞ
(
C
.
	$»Çm—t
(
c
.
AT_FDCWD
[
Şddœfd
], 
Şd·th
, c.AT_FDCWD[
Ãwdœfd
], 
Ãw·th
))

640 
’d


641 
’d


642 
C
.
mkdœ©
 
th’


643 
funùiÚ
 
S
.
	$mkdœ©
(
fd
, 
·th
, 
mode
è 
	`»tboŞ
(
C
.
	$mkdœ©
(
c
.
AT_FDCWD
[
fd
], 
·th
, c.
MODE
[
mode
])è
’d


644 
’d


645 
C
.
fchowÇt
 
th’


646 
funùiÚ
 
S
.
	$fchowÇt
(
dœfd
, 
·th
, 
owÃr
, 
group
, 
æags
)

647  
	`»tboŞ
(
C
.
	`fchowÇt
(
c
.
AT_FDCWD
[
dœfd
], 
·th
, 
owÃr
 
Ü
 -1, 
group
 o¸-1, c.
AT
[
æags
]))

648 
’d


649 
’d


650 
C
.
çcûs§t
 
th’


651 
funùiÚ
 
S
.
	$çcûs§t
(
dœfd
, 
·thÇme
, 
mode
, 
æags
)

652  
	`»tboŞ
(
C
.
	$çcûs§t
(
c
.
AT_FDCWD
[
dœfd
], 
·thÇme
, c.
OK
[
mode
], c.
AT
[
æags
]))

653 
’d


654 
’d


655 
C
.
»adlšk©
 
th’


656 
funùiÚ
 
S
.
	$»adlšk©
(
dœfd
, 
·th
, 
bufãr
, 
size
)

657 
size
 = siz
Ü
 
c
.
PATH_MAX


658 
bufãr
 = bufã¸
Ü
 
t
.
	$bufãr
(
size
)

659 
loÿl
 
»t
, 
”r
 = 
C
.
	$»adlšk©
(
c
.
AT_FDCWD
[
dœfd
], 
·th
, 
bufãr
, 
size
)

660 
»t
 = 
	$tÚumb”
(
»t
)

661 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


662  
ffi
.
	$¡ršg
(
bufãr
, 
»t
)

663 
’d


664 
’d


665 
C
.
mknod©
 
th’


666 
funùiÚ
 
S
.
	$mknod©
(
fd
, 
·thÇme
, 
mode
, 
dev
)

667  
	`»tboŞ
(
C
.
	`mknod©
(
c
.
AT_FDCWD
[
fd
], 
·thÇme
, c.
S_I
[
mode
], 
	$g‘dev
(
dev
è
Ü
 0))

668 
’d


669 
’d


670 
C
.
utim’§t
 
th’


671 
funùiÚ
 
S
.
	$utim’§t
(
dœfd
, 
·th
, 
ts
, 
æags
)

672 
ts
 
th’
 ğ
t
.
	$time¥ec2
(
ts
è
’d
 -- 
TODO
 
u£
 
mkty³
?

673  
	`»tboŞ
(
C
.
	$utim’§t
(
c
.
AT_FDCWD
[
dœfd
], 
·th
, 
ts
, c.
AT
[
æags
]))

674 
’d


675 
’d


676 
C
.
f¡©©
 
th’


677 
funùiÚ
 
S
.
	$f¡©©
(
fd
, 
·th
, 
buf
, 
æags
)

678 
nÙ
 
buf
 
th’
 buàğ
t
.
	$¡©
(è
’d


679 
loÿl
 
»t
, 
”r
 = 
C
.
	$f¡©©
(
c
.
AT_FDCWD
[
fd
], 
·th
, 
buf
, c.
AT
[
æags
])

680 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


681  
buf


682 
’d


683 
’d


684 
C
.
fchmod©
 
th’


685 
funùiÚ
 
S
.
	$fchmod©
(
dœfd
, 
·thÇme
, 
mode
, 
æags
)

686  
	`»tboŞ
(
C
.
	$fchmod©
(
c
.
AT_FDCWD
[
dœfd
], 
·thÇme
, c.
MODE
[
mode
], c.
AT
[
æags
]))

687 
’d


688 
’d


689 
C
.
İ’©
 
th’


690 
funùiÚ
 
S
.
	$İ’©
(
dœfd
, 
·thÇme
, 
æags
, 
mode
)

691  
	`»tfd
(
C
.
	$İ’©
(
c
.
AT_FDCWD
[
dœfd
], 
·thÇme
, c.
O
[
æags
], c.
MODE
[
mode
]))

692 
’d


693 
’d


695 
C
.
fchroÙ
 
th’


696 
funùiÚ
 
S
.
	$fchroÙ
(
fd
è 
	`»tboŞ
(
C
.
	`fchroÙ
(
	$g‘fd
(
fd
))è
’d


697 
’d


698 
C
.
lchmod
 
th’


699 
funùiÚ
 
S
.
	$lchmod
(
·th
, 
mode
è 
	`»tboŞ
(
C
.
	$lchmod
(
·th
, 
c
.
MODE
[
mode
])è
’d


700 
’d


702 
C
.
fd©async
 
th’


703 
funùiÚ
 
S
.
	$fd©async
(
fd
è 
	`»tboŞ
(
C
.
	`fd©async
(
	$g‘fd
(
fd
))è
’d


704 
’d


705 -- 
Lšux
 
dÛs
 
nÙ
 
have
 
mkfifo
 
sysÿÎs
, 
emuÏ‹d


706 
C
.
mkfifo
 
th’


707 
funùiÚ
 
S
.
	$mkfifo
(
·thÇme
, 
mode
è 
	`»tboŞ
(
C
.
	$mkfifo
(
·thÇme
, 
c
.
S_I
[
mode
])è
’d


708 
’d


709 
C
.
mkfifßt
 
th’


710 
funùiÚ
 
S
.
	$mkfifßt
(
dœfd
, 
·thÇme
, 
mode
è 
	`»tboŞ
(
C
.
	$mkfifßt
(
c
.
AT_FDCWD
[
dœfd
], 
·thÇme
, c.
S_I
[
mode
])è
’d


711 
’d


712 
C
.
utimes
 
th’


713 
funùiÚ
 
S
.
	$utimes
(
f’ame
, 
ts
)

714 
ts
 
th’
 ğ
t
.
	$timev®2
(
ts
è
’d


715  
	`»tboŞ
(
C
.
	$utimes
(
f’ame
, 
ts
))

716 
’d


717 
’d


718 
C
.
lutimes
 
th’


719 
funùiÚ
 
S
.
	$lutimes
(
f’ame
, 
ts
)

720 
ts
 
th’
 ğ
t
.
	$timev®2
(
ts
è
’d


721  
	`»tboŞ
(
C
.
	$lutimes
(
f’ame
, 
ts
))

722 
’d


723 
’d


724 
C
.
futimes
 
th’


725 
funùiÚ
 
S
.
	$futimes
(
fd
, 
ts
)

726 
ts
 
th’
 ğ
t
.
	$timev®2
(
ts
è
’d


727  
	`»tboŞ
(
C
.
	`futimes
(
	`g‘fd
(
fd
), 
ts
))

728 
’d


729 
’d


731 
C
.
g‘d’ts
 
th’


732 
funùiÚ
 
S
.
	$g‘d’ts
(
fd
, 
buf
, 
size
)

733 
size
 = siz
Ü
 4096 -- 
may
 
have
 
to
 
be
 
equ®
Ø
©
 
Ëa¡
 
block
 siz
of
 
fs


734 
buf
 = buà
Ü
 
t
.
	$bufãr
(
size
)

735 
loÿl
 
»t
, 
”r
 = 
C
.
	`g‘d’ts
(
	`g‘fd
(
fd
), 
buf
, 
size
)

736 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


737  
t
.
	$dœ’ts
(
buf
, 
»t
)

738 
’d


739 
’d


740 
C
.
futim’s
 
th’


741 
funùiÚ
 
S
.
	$futim’s
(
fd
, 
ts
)

742 
ts
 
th’
 ğ
t
.
	$time¥ec2
(
ts
è
’d


743  
	`»tboŞ
(
C
.
	`futim’s
(
	`g‘fd
(
fd
), 
ts
))

744 
’d


745 
’d


746 
C
.
acû±4
 
th’


747 
funùiÚ
 
S
.
	$acû±4
(
sockfd
, 
addr
, 
add¾’
, 
æags
)

748 
loÿl
 
§ddr
 = 
±
.
	$sockaddr
(
addr
)

749 
addr
 
th’
 
add¾’
 =‡dd¾’ 
Ü
 
t
.
	$sockËn1
(è
’d


750  
	`»tfd
(
C
.
	`acû±4
(
	`g‘fd
(
sockfd
), 
§ddr
, 
add¾’
, 
c
.
SOCK
[
æags
]))

751 
’d


752 
’d


753 
C
.
sigaùiÚ
 
th’


754 
funùiÚ
 
S
.
	$sigaùiÚ
(
signum
, 
hªdËr
, 
Şdaù
)

755 
	`ty³
(
hªdËr
è=ğ"¡ršg" 
Ü
y³(hªdËrè=ğ"funùiÚ" 
th’


756 
hªdËr
 = {hªdË¸ğhªdËr, 
mask
 = "", 
æags
 = 0
	}
} -- 
sim¶e
 
like
 
sigÇl


757 
’d


758 
hªdËr
 
th’
 
	ghªdËr
 = 
	$mkty³
(
t
.
sigaùiÚ
, 
hªdËr
è
’d


759  
	`»tboŞ
(
C
.
	$sigaùiÚ
(
c
.
SIG
[
signum
], 
hªdËr
, 
Şdaù
))

760 
’d


761 
’d


762 
C
.
g‘™im”
 
th’


763 
funùiÚ
 
S
.
	$g‘™im”
(
which
, 
v®ue
)

764 
v®ue
 = v®u
Ü
 
t
.
	$™im”v®
()

765 
loÿl
 
»t
, 
”r
 = 
C
.
	$g‘™im”
(
c
.
ITIMER
[
which
], 
v®ue
)

766 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


767  
v®ue


768 
’d


769 
’d


770 
C
.
£t™im”
 
th’


771 
funùiÚ
 
S
.
	$£t™im”
(
which
, 
™
, 
Şdtime
)

772 
Şdtime
 = oldtim
Ü
 
t
.
	$™im”v®
()

773 
loÿl
 
»t
, 
”r
 = 
C
.
	`£t™im”
(
c
.
ITIMER
[
which
], 
	`mkty³
(
t
.
™im”v®
, 
™
), 
Şdtime
)

774 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


775  
Şdtime


776 
’d


777 
’d


778 
C
.
şock_g‘»s
 
th’


779 
funùiÚ
 
S
.
	$şock_g‘»s
(
şk_id
, 
ts
)

780 
ts
 = 
Ü
 
t
.
	$time¥ec
()

781 
loÿl
 
»t
, 
”r
 = 
C
.
	$şock_g‘»s
(
c
.
CLOCK
[
şk_id
], 
ts
)

782 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


783  
ts


784 
’d


785 
’d


786 
C
.
şock_g‘time
 
th’


787 
funùiÚ
 
S
.
	$şock_g‘time
(
şk_id
, 
ts
)

788 
ts
 = 
Ü
 
t
.
	$time¥ec
()

789 
loÿl
 
»t
, 
”r
 = 
C
.
	$şock_g‘time
(
c
.
CLOCK
[
şk_id
], 
ts
)

790 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


791  
ts


792 
’d


793 
’d


794 
C
.
şock_£‰ime
 
th’


795 
funùiÚ
 
S
.
	$şock_£‰ime
(
şk_id
, 
ts
)

796 
ts
 = 
	$mkty³
(
t
.
time¥ec
, 
ts
)

797  
	`»tboŞ
(
C
.
	$şock_£‰ime
(
c
.
CLOCK
[
şk_id
], 
ts
))

798 
’d


799 
’d


800 
C
.
şock_Çno¦“p
 
th’


801 
funùiÚ
 
S
.
	$şock_Çno¦“p
(
şk_id
, 
æags
, 
»q
, 
»m
)

802 
»m
 =„em 
Ü
 
t
.
	$time¥ec
()

803 
loÿl
 
»t
, 
”r
 = 
C
.
	`şock_Çno¦“p
(
c
.
CLOCK
[
şk_id
], c.
TIMER
[
æags
 
Ü
 0], 
	`mkty³
(
t
.
time¥ec
, 
»q
), 
»m
)

804 
»t
 =ğ-1 
th’


805 ià(
”r
 
Ü
 
	`”ºo
()è=ğ
c
.
E
.
INTR
 
th’
  
Œue
, 
n
, 
»m
 ‚, 
t
.
	`”rÜ
Ó¼ o¸
	$”ºo
()è
’d


806 
’d


807  
Œue
 -- 
no
 
time
 
»maššg


808 
’d


809 
’d


811 
C
.
tim”_ü—‹
 
th’


812 
funùiÚ
 
S
.
	$tim”_ü—‹
(
şk_id
, 
sigev
, 
tim”id
)

813 
tim”id
 =im”id 
Ü
 
t
.
	$tim”
()

814 
sigev
 
th’
 sigev = 
	$mkty³
(
t
.
sigev’t
, 
sigev
è
’d


815 
loÿl
 
»t
, 
”r
 = 
C
.
	`tim”_ü—‹
(
c
.
CLOCK
[
şk_id
], 
sigev
, 
tim”id
:
	$g‘tim”p
())

816 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


817  
tim”id


818 
’d


819 
funùiÚ
 
S
.
	$tim”_d–‘e
(
tim”id
è 
	`»tboŞ
(
C
.
	`tim”_d–‘e
Ñim”id:
	$g‘tim”
())è
’d


820 
funùiÚ
 
S
.
	$tim”_£‰ime
(
tim”id
, 
æags
, 
Ãw_v®ue
, 
Şd_v®ue
)

821 
Şd_v®ue
 ~ğ
çl£
 
th’
 old_v®uğŞd_v®u
Ü
 
t
.
	$™im”¥ec
(è
Şd_v®ue
 = 
n
 
’d


822 
Ãw_v®ue
 = 
	$mkty³
(
t
.
™im”¥ec
, 
Ãw_v®ue
)

823 
loÿl
 
»t
, 
”r
 = 
C
.
	`tim”_£‰ime
(
tim”id
:
	`g‘tim”
(), 
c
.
TIMER
[
æags
], 
Ãw_v®ue
, 
Şd_v®ue
)

824 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


825  
Œue
, 
n
, 
Şd_v®ue


826 
’d


827 
funùiÚ
 
S
.
	$tim”_g‘time
(
tim”id
, 
cu¼_v®ue
)

828 
cu¼_v®ue
 = cu¼_v®u
Ü
 
t
.
	$™im”¥ec
()

829 
loÿl
 
»t
, 
”r
 = 
C
.
	`tim”_g‘time
(
tim”id
:
	`g‘tim”
(), 
cu¼_v®ue
)

830 
»t
 =ğ-1 
th’
  
n
, 
t
.
	`”rÜ
(
”r
 
Ü
 
	$”ºo
()è
’d


831  
cu¼_v®ue


832 
’d


833 
funùiÚ
 
S
.
	$tim”_g‘ov”run
(
tim”id
è 
	`»Šum
(
C
.
	`tim”_g‘ov”run
Ñim”id:
	$g‘tim”
())è
’d


834 
’d


836 -- 
Ëgacy
 
š
 
mªy
 
OSs
, 
im¶em’‹d
 
usšg
 
»cväom
, 
£ndto


837 
C
.
£nd
 
th’


838 
funùiÚ
 
S
.
	$£nd
(
fd
, 
buf
, 
couÁ
, 
æags
è 
	`»Šum
(
C
.
	`£nd
(
	`g‘fd
(fd), buf, couÁ, 
c
.
MSG
[æags])è
’d


839 
’d


840 
C
.
»cv
 
th’


841 
funùiÚ
 
S
.
	$»cv
(
fd
, 
buf
, 
couÁ
, 
æags
è 
	`»Šum
(
C
.
	`»cv
(
	`g‘fd
(fd), buf, couÁ, 
c
.
MSG
[æags], 
çl£
)è
’d


842 
’d


844 -- 
TODO
 
nÙ
 
su»
 
about
 
this
 
š‹rçû
, 
maybe
  
»m
 
as
 
exŒa
 
·¿m‘”
 
£e
 #103

845 
C
.
Çno¦“p
 
th’


846 
funùiÚ
 
S
.
	$Çno¦“p
(
»q
, 
»m
)

847 
»m
 =„em 
Ü
 
t
.
	$time¥ec
()

848 
loÿl
 
»t
, 
”r
 = 
C
.
	`Çno¦“p
(
	`mkty³
(
t
.
time¥ec
, 
»q
), 
»m
)

849 
»t
 =ğ-1 
th’


850 ià(
”r
 
Ü
 
	`”ºo
()è=ğ
c
.
E
.
INTR
 
th’
  
Œue
, 
n
, 
»m
 ‚, 
t
.
	`”rÜ
Ó¼ o¸
	$”ºo
()è
’d


851 
’d


852  
Œue
 -- 
no
 
time
 
»maššg


853 
’d


854 
’d


856 -- 
g‘·gesize
 
might
 
be
 
a
 
sysÿÎ
, 
Ü
 
š
 
libc
, o¸
may
 
nÙ
 
exi¡


857 
C
.
g‘·gesize
 
th’


858 
funùiÚ
 
S
.
	$g‘·gesize
(è 
	`»Šum
(
C
.
	$g‘·gesize
()è
’d


859 
’d


861 
C
.
syncfs
 
th’


862 
funùiÚ
 
S
.
	$syncfs
(
fd
è 
	`»tboŞ
(
C
.
	`syncfs
(
	$g‘fd
(
fd
))è
’d


863 
’d


865 -- 
®though
 
the
 
±y
 
funùiÚs
 
¬e
 
nÙ
 
sysÿÎs
, 
we
 
šşude
 
h”e
, 
like
 
eg
 
shm
 funùiÚs, 
as
 
—s›r
 
to
 
´ovide
‡ 
m‘hods
 
Ú
 
fds


866 -- 
F»ebsd
 
has
 
a
 
sysÿÎ
, 
Ùh”
 
OSs
 
u£
 /
dev
/
±mx


867 
C
.
posix_İ’±
 
th’


868 
funùiÚ
 
S
.
	$posix_İ’±
(
æags
è 
	`»tfd
(
C
.
	$posix_İ’±
(
c
.
O
[
æags
])è
’d


870 
funùiÚ
 
S
.
	$posix_İ’±
(
æags
è 
S
.
	`İ’
("/dev/±mx", fÏgsè
’d


871 
’d


872 
S
.
İ’±
 = S.
posix_İ’±


874 
funùiÚ
 
S
.
	$i§‰y
(
fd
)

875 
loÿl
 
tc
, 
”r
 = 
S
.
	$tcg‘©Œ
(
fd
)

876 
tc
 
th’
  
Œue
  
n
, 
”r
 
’d


877 
’d


879 
c
.
IOCTL
.
TIOCGSID
 
th’
 -- 
O³nBSD
 
Úly
 
has
 
š
 
Ëgacy
 
ioùls


880 
funùiÚ
 
S
.
	$tcg‘sid
(
fd
è 
S
.
	`ioùl
(fd, "TIOCGSID"è
’d


881 
’d


883 -- 
now
 
ÿÎ
 
OS
 
¥ecific
 
nÚ
-
g’”ic
 
ÿÎs


884 
loÿl
 
hh
 = {

885 
»t64
 =„‘64, 
»Šum
 =„‘num, 
»tfd
 =„‘fd, 
»tboŞ
 =„‘boŞ, 
»Œ
 =„‘±r, 
»t™”
 =„etiter

886 
	}
}

888 ià(
	gabi
.
rump
 
ªd
‡bi.
	gty³s
 =ğ"Ãtbsd"è
	$Ü
 (
nÙ
 
abi
.
rump
 
ªd
‡bi.
bsd
è
th’


889 
S
 = 
	`»quœe
("sysÿÎ.bsd.sysÿÎs")(S, 
hh
, 
c
, 
C
, 
ty³s
)

890 
’d


891 
S
 = 
	`»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".sysÿÎs")(S, 
hh
, 
c
, 
C
, 
ty³s
)

893  
S


895 
’d


897  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/types.lua

1 -- 
choo£
 
cÜ»ù
 
ty³s
 
	gOS


3 -- 
the£
 
¬e
 
e™h”
 
sim¶e
 
ffi
 
ty³s
 
Ü
 ff˜
m‘©y³s
 
the
 
k”Ãl
 
	gty³s


4 -- 
¶us
 
some
 
Lua
 
m‘©abËs
 
ty³s
 
th©
 
ÿÂÙ
 
be
 
£nsibly
 
dÚe
 
as
 Lu¨ty³ 
eg
 
	g¬¿ys
, 
	gš‹g”s


6 -- 
nÙe
 
th©
 
some
 
ty³s
 
wl
 
be
 
	gov”ridd’
, 
eg
  
fd
 
ty³
 wÈ
have
 
m‘am‘hods
 
added


8 
loÿl
 
	g»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

9 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

10 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
	gm©h
 =

11 
»quœe
, 
	g”rÜ
, 
	gas£¹
, 
	gtÚumb”
, 
	gto¡ršg
,

12 
	g£tm‘©abË
, 
	g·œs
, 
	gaœs
, 
	guÅack
, 
	g¿wg‘
, 
	g¿w£t
,

13 
	gpÿÎ
, 
	gty³
, 
	gbË
, 
	g¡ršg
, 
m©h


15 
loÿl
 
funùiÚ
 
	$š™
(
c
, 
o¡y³s
, 
bsdty³s
)

17 
loÿl
 
abi
 = 
»quœe
 "syscall.abi"

19 
loÿl
 
ffi
 = 
»quœe
 "ffi"

20 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

22 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

24 
loÿl
 
±t
, 
»v™”
, 
mkty³
, 
i¡y³
, 
Ënâ
, 
Ënmt
, 
g‘fd
, 
Ãwâ


25 ğ
h
.
±t
, h.
»v™”
, h.
mkty³
, h.
i¡y³
, h.
Ënâ
, h.
Ënmt
, h.
g‘fd
, h.
Ãwâ


26 
loÿl
 
addty³
, 
addty³_v¬
, 
addty³_â
, 
add¿w2
 = 
h
.addtype, h.addtype_var, h.addtype_fn, h.addraw2

27 
loÿl
 
Áohl
,‚tohl, 
Áohs
, 
htÚs
 = 
h
.ntohl, h.ntohl, h.ntohs, h.htons

28 
loÿl
 
¥l™
, 
Œim
, 
¡ræag
 = 
h
.split, h.trim, h.strflag

29 
loÿl
 
®ign
 = 
h
.align

31 
loÿl
 
ty³s
 = {
t
 = {}, 
±
 = {}, 
s
 = {}, 
ùy³s
 = {}
	}
}

33 
loÿl
 
	gt
, 
	g±
, 
	gs
, 
	gùy³s
 = 
ty³s
.
t
, 
	gty³s
.±,y³s.s,y³s.
ùy³s


35 
loÿl
 
	gsh¬edty³s
 = 
»quœe
 "syscall.shared.types"

37 
k
, 
v
 
š
 
	$·œs
(
sh¬edty³s
.
t
èdØt[
k
] = 
v
 
’d


38 
k
, 
v
 
š
 
	$·œs
(
sh¬edty³s
.
±
èdØ±[
k
] = 
v
 
’d


39 
k
, 
v
 
š
 
	$·œs
(
sh¬edty³s
.
s
èdØs[
k
] = 
v
 
’d


40 
k
, 
v
 
š
 
	$·œs
(
sh¬edty³s
.
ùy³s
èdØùy³s[
k
] = 
v
 
’d


42 
loÿl
 
mt
 = {
	}
} -- 
m‘©abËs


44 -- 
g’”ic
 
ty³s


46 
loÿl
 
voidp
 = 
ffi
.
ty³of
("void *")

48 
funùiÚ
 
±
.(
x
)

49  
ffi
.
	$ÿ¡
(
voidp
, 
x
)

50 
’d


52 
loÿl
 
addty³s
 = {

53 
size
 = "size_t",

54 
ssize
 = "ssize_t",

55 
mode
 = "mode_t",

56 
dev
 = "dev_t",

57 
off
 = "off_t",

58 
uid
 = "uid_t",

59 
gid
 = "gid_t",

60 
pid
 = "pid_t",

61 
š_pÜt
 = "in_port_t",

62 
§_çmy
 = "sa_family_t",

63 
sockËn
 = "socklen_t",

64 
id
 = "id_t",

65 
daddr
 = "daddr_t",

66 
time
 = "time_t",

67 
şock
 = "clock_t",

68 
Æšk
 = "nlink_t",

69 
šo
 = "ino_t",

70 
nfds
 = "nfds_t",

71 
	}
}

73 -- 
nÙe
 
we
 
ÿÂÙ
 
add
 
ªy
 
	gm‘©abË
, 
as
 
may
 
be
 
deş¬ed
 
š
 
os
 
ªd
 
	grump
, 
so
 
nÙ
 
ev’
 
Ënmt
 
added


74 
	gk
, 
v
 
š
 
	$·œs
(
addty³s
èdØ
	$addty³
(
ty³s
, 
k
, 
v
è
’d


76 
t
.
sockËn1
 = 
ffi
.
	`ty³of
("socklen_t[1]")

77 
t
.
off1
 = 
ffi
.
	`ty³of
("off_t[1]")

78 
t
.
uid1
 = 
ffi
.
	`ty³of
("uid_t[1]")

79 
t
.
gid1
 = 
ffi
.
	`ty³of
("gid_t[1]")

81 
loÿl
 
”rsyms
 = {
	}
} -- 
»v”£
 
lookup
 
by
 
numb”


82 
loÿl
 
”ºames
 = {} -- 
lookup
 
”rÜ
 
mes§ge
 
by
 
numb”


83 
k
, 
v
 
š
 
	$·œs
(
c
.
E
) do

84 
”rsyms
[
v
] = 
k


85 
”ºames
[
v
] = 
	`as£¹
(
c
.
”rÜÇmes
[
k
], "missingƒrror‚ame " .. k)

86 
’d


88 
k
, 
v
 
š
 
	`·œs
(
c
.
EALIAS
 
Ü
 {
	}
}) do

89 
	gc
.
	gE
[
k
] = 
v


90 
’d


91 
c
.
EALIAS
 = 
n


93 
mt
.
”rÜ
 = {

94 
__to¡ršg
 = 
funùiÚ
(
e
è 
”ºames
[e.
”ºo
] 
’d
,

95 
	g__šdex
 = 
funùiÚ
(
e
, 
k
)

96 
	gk
 =ğ'sym' 
th’
  
”rsyms
[
e
.
”ºo
] 
’d


97 
k
 =ğ'lsym' 
th’
  
”rsyms
[
e
.
”ºo
]:
low”
(è
’d


98 
c
.
E
[
k
] 
th’
  c.E[k] =ğ
e
.
”ºo
 
’d


99 
”rÜ
("šv®idƒ¼Ü " .. 
k
)

100 
’d
,

101 
	g__Ãw
 = 
funùiÚ
(

, 
”ºo
)

102 
nÙ
 
”ºo
 
th’
 
	g”ºo
 = 
ffi
.”ºo(è
’d


103  
ffi
.
Ãw
(

, 
”ºo
)

104 
	g’d
,

107 
	gt
.
	g”rÜ
 = 
ffi
.
m‘©y³
("¡ruù {šˆ”ºo;}", 
mt
.
”rÜ
)

109 
	gmt
.
	gtimev®
 = {

110 
šdex
 = {

111 
time
 = 
funùiÚ
(
tv
è 
tÚumb”
Ñv.
tv_£c
è+Úumb”Ñv.
tv_u£c
è/ 1000000 
’d
,

112 
	g£c
 = 
funùiÚ
(
tv
è 
tÚumb”
Ñv.
tv_£c
è
’d
,

113 
	gu£c
 = 
funùiÚ
(
tv
è 
tÚumb”
Ñv.
tv_u£c
è
’d
,

115 
	gÃwšdex
 = {

116 
time
 = 
funùiÚ
(
tv
, 
v
)

117 
loÿl
 
	gi
, 
	gf
 = 
m©h
.
modf
(
v
)

118 
tv
.
tv_£c
, 
	gtv
.
	gtv_u£c
 = 
i
, 
	gm©h
.
æoÜ
(
f
 * 1000000)

119 
	g’d
,

120 
	g£c
 = 
funùiÚ
(
tv
, 
v
è
	gtv
.
	gtv_£c
 = v 
’d
,

121 
	gu£c
 = 
funùiÚ
(
tv
, 
v
è
	gtv
.
	gtv_u£c
 = v 
’d
,

123 
	g__Ãw
 = 
funùiÚ
(

, 
v
)

124 
nÙ
 
v
 
th’
 
	gv
 = {0, 0} 
’d


125 
i¡y³
(
t
.
time¥ec
, 
v
è
th’
 
	gv
 = {v.
tv_£c
, 
m©h
.
æoÜ
(v.
tv_n£c
 / 1000)} 
’d


126 
ty³
(
v
è=ğ"bË" 
th’


127 
v
.
tv_n£c
 
th’
 -- 
com·t
 
w™h
 
time¥ec


128 
v
.
tv_u£c
 = 
m©h
.
æoÜ
(v.
tv_n£c
 / 1000)

129 
v
.
tv_n£c
 = 0

130 
’d


131 
’d


132 
ty³
(
v
è~ğ"numb”" 
th’
  
ffi
.
Ãw
(

, vè
’d


133 
loÿl
 
	gts
 = 
ffi
.
Ãw
(

)

134 
ts
.
time
 = 
v


135  
ts


136 
’d
,

137 
	g__to¡ršg
 = 
funùiÚ
(
tv
è 
to¡ršg
Ñv.
time
è
’d
,

140 
addty³
(
ty³s
, "timev®", "¡ruùimev®", 
mt
.
timev®
)

142 
	gmt
.
	gtime¥ec
 = {

143 
šdex
 = {

144 
time
 = 
funùiÚ
(
tv
è 
tÚumb”
Ñv.
tv_£c
è+Úumb”Ñv.
tv_n£c
è/ 1000000000 
’d
,

145 
	g£c
 = 
funùiÚ
(
tv
è 
tÚumb”
Ñv.
tv_£c
è
’d
,

146 
	gn£c
 = 
funùiÚ
(
tv
è 
tÚumb”
Ñv.
tv_n£c
è
’d
,

148 
	gÃwšdex
 = {

149 
time
 = 
funùiÚ
(
tv
, 
v
)

150 
loÿl
 
	gi
, 
	gf
 = 
m©h
.
modf
(
v
)

151 
tv
.
tv_£c
, 
	gtv
.
	gtv_n£c
 = 
i
, 
	gm©h
.
æoÜ
(
f
 * 1000000000)

152 
	g’d
,

153 
	g£c
 = 
funùiÚ
(
tv
, 
v
è
	gtv
.
	gtv_£c
 = v 
’d
,

154 
	gn£c
 = 
funùiÚ
(
tv
, 
v
è
	gtv
.
	gtv_n£c
 = v 
’d
,

156 
	g__Ãw
 = 
funùiÚ
(

, 
v
)

157 
nÙ
 
v
 
th’
 
	gv
 = {0, 0} 
’d


158 
i¡y³
(
t
.
timev®
, 
v
è
th’
 
	gv
 = {v.
tv_£c
, v.
tv_u£c
 * 1000} 
’d


159 
ty³
(
v
è=ğ"bË" 
th’


160 
v
.
tv_u£c
 
th’
 -- 
com·t
 
w™h
 
time¥ec
 
TODO
 
add
 
to
 
m‘hods
, 
ªd
 
u£
 
¡ªd¬d
 
Ãw
 
®loÿtiÚ
 
	gfunùiÚ
?

161 
	gv
.
	gtv_n£c
 = 
v
.
tv_u£c
 * 1000

162 
v
.
tv_u£c
 = 0

163 
’d


164 
’d


165 
ty³
(
v
è~ğ"numb”" 
th’
  
ffi
.
Ãw
(

, vè
’d


166 
loÿl
 
	gts
 = 
ffi
.
Ãw
(

)

167 
ts
.
time
 = 
v


168  
ts


169 
’d
,

170 
	g__to¡ršg
 = 
funùiÚ
(
tv
è 
to¡ršg
Ñv.
time
è
’d
,

173 
addty³
(
ty³s
, "time¥ec", "¡ruùime¥ec", 
mt
.
time¥ec
)

175 -- 
¬¿y
 
so
 
ÿÂÙ
 
ju¡
 
add
 
m‘am‘hods


176 
add¿w2
(
ty³s
, "timeval2_raw", "structimeval")

177 
	gt
.
	gtimev®2
 = 
	$funùiÚ
(
tv1
, 
tv2
)

178 
ffi
.
	$i¡y³
(
t
.
timev®2_¿w
, 
tv1
è
th’
 v1 
’d


179 
	`ty³
(
tv1
è=ğ"bË" 
th’
v1, 
tv2
 =v1[1],v1[2] 
’d


180 
loÿl
 
tv
 = 
t
.
	$timev®2_¿w
()

181 
tv1
 
th’
 
tv
[0] = 
t
.
	$timev®
(
tv1
è
’d


182 
tv2
 
th’
 
tv
[1] = 
t
.
	$timev®
(
tv2
è
’d


183  
tv


184 
’d


186 -- 
¬¿y
 
so
 
ÿÂÙ
 
ju¡
 
add
 
m‘am‘hods


187 
	`add¿w2
(
ty³s
, "timespec2_raw", "structimespec")

188 
t
.
time¥ec2
 = 
	$funùiÚ
(
ts1
, 
ts2
)

189 
ffi
.
	$i¡y³
(
t
.
time¥ec2_¿w
, 
ts1
è
th’
 s1 
’d


190 
	`ty³
(
ts1
è=ğ"bË" 
th’
s1, 
ts2
 =s1[1],s1[2] 
’d


191 
loÿl
 
ts
 = 
t
.
	$time¥ec2_¿w
()

192 
ts1
 
th’
 
	`ty³
Ñs1è=ğ'¡ršg'h’ 
ts
[0].
tv_n£c
 = 
c
.
UTIME
[ts1] ts[0] = 
t
.
	$time¥ec
(
ts1
è
’d
ƒnd

193 
ts2
 
th’
 
	`ty³
Ñs2è=ğ'¡ršg'h’ 
ts
[1].
tv_n£c
 = 
c
.
UTIME
[ts2] ts[1] = 
t
.
	$time¥ec
(
ts2
è
’d
ƒnd

194  
ts


195 
’d


197 
mt
.
groups
 = {

198 
__šdex
 = 
	`funùiÚ
(
g
, 
k
)

199  
g
.
li¡
[
k
 - 1]

200 
’d
,

201 
__Ãwšdex
 = 
	`funùiÚ
(
g
, 
k
, 
v
)

202 
g
.
li¡
[
k
 - 1] = 
v


203 
’d
,

204 
__Ãw
 = 
	`funùiÚ
(

, 
gs
)

205 
	`ty³
(
gs
è=ğ'numb”' 
th’
  
ffi
.
	`Ãw
(

, gs, gsè
’d


206  
ffi
.
	`Ãw
(

, #gs, #gs, 
gs
)

207 
’d
,

208 
__Ën
 = 
	`funùiÚ
(
g
è g.
couÁ
 
’d
,

209 
	}
}

211 
addty³_v¬
(
ty³s
, "groups", "¡ruù {šˆcouÁ; gid_ˆli¡[?];}", 
mt
.
groups
)

213 -- 
sigÇl
 
£t
 
hªdËrs


214 
loÿl
 
funùiÚ
 
	$sigismemb”
(
£t
, 
sig
)

215 
loÿl
 
d
 = 
b™
.
	`rshiá
(
sig
 - 1, 5è-- 
®ways
 32 
b™s


216  
b™
.
	`bªd
(
£t
.
sig
[
d
], b™.
	`lshiá
(1, (sig - 1) % 32)) ~= 0

217 
’d


219 
loÿl
 
funùiÚ
 
	$sigem±y£t
(
£t
)

220 
i
 = 0, 
s
.
sig£t
 / 4 - 1 do

221 
£t
.
sig
[
i
] ~ğ0 
th’
  
çl£
 
’d


222 
’d


223  
Œue


224 
’d


226 
loÿl
 
funùiÚ
 
	$sigadd£t
(
£t
, 
sig
)

227 
£t
 = 
t
.
	$sig£t
(
£t
)

228 
loÿl
 
d
 = 
b™
.
	`rshiá
(
sig
 - 1, 5)

229 
£t
.
sig
[
d
] = 
b™
.
	`bÜ
(£t.sig[d], b™.
	`lshiá
(1, (sig - 1) % 32))

230  
£t


231 
’d


233 
loÿl
 
funùiÚ
 
	$sigd–£t
(
£t
, 
sig
)

234 
£t
 = 
t
.
	$sig£t
(
£t
)

235 
loÿl
 
d
 = 
b™
.
	`rshiá
(
sig
 - 1, 5)

236 
£t
.
sig
[
d
] = 
b™
.
	`bªd
(£t.sig[d], b™.
	`bnÙ
(b™.
	`lshiá
(1, (sig - 1) % 32)))

237  
£t


238 
’d


240 
loÿl
 
funùiÚ
 
	`sigadd£ts
(
£t
, 
sigs
è-- 
®low
 
muÉË


241 
	`ty³
(
sigs
è~ğ"¡ršg" 
th’
  
	$sigadd£t
(
£t
, 
sigs
è
’d


242 
£t
 = 
t
.
	$sig£t
(
£t
)

243 
loÿl
 
a
 = 
	`¥l™
(",", 
sigs
)

244 
i
, 
v
 
š
 
	$aœs
(
a
) do

245 
loÿl
 
s
 = 
	$Œim
(
v
)

246 
loÿl
 
sig
 = 
c
.
SIG
[
s
]

247 
nÙ
 
sig
 
th’
 
	`”rÜ
("šv®id sigÇl: " .. 
v
è
’d
 -- 
dÚ
'ˆu£hi fÜm© iàyou dÚ'
t
 
wªt
 
exû±iÚs
, 
b‘‹r
 
thª
 
s’t
 
ignÜe


248 
	$sigadd£t
(
£t
, 
sig
)

249 
’d


250  
£t


251 
’d


253 
loÿl
 
funùiÚ
 
	`sigd–£ts
(
£t
, 
sigs
è-- 
®low
 
muÉË


254 
	`ty³
(
sigs
è~ğ"¡ršg" 
th’
  
	$sigd–£t
(
£t
, 
sigs
è
’d


255 
£t
 = 
t
.
	$sig£t
(
£t
)

256 
loÿl
 
a
 = 
	`¥l™
(",", 
sigs
)

257 
i
, 
v
 
š
 
	$aœs
(
a
) do

258 
loÿl
 
s
 = 
	$Œim
(
v
)

259 
loÿl
 
sig
 = 
c
.
SIG
[
s
]

260 
nÙ
 
sig
 
th’
 
	`”rÜ
("šv®id sigÇl: " .. 
v
è
’d
 -- 
dÚ
'ˆu£hi fÜm© iàyou dÚ'
t
 
wªt
 
exû±iÚs
, 
b‘‹r
 
thª
 
s’t
 
ignÜe


261 
	$sigd–£t
(
£t
, 
sig
)

262 
’d


263  
£t


264 
’d


266 
mt
.
sig£t
 = {

267 
__šdex
 = 
	`funùiÚ
(
£t
, 
k
)

268 
k
 =ğ'add' 
th’
  
sigadd£ts
 
’d


269 
k
 =ğ'd–' 
th’
  
sigd–£ts
 
’d


270 
k
 =ğ'i£m±y£t' 
th’
  
	`sigem±y£t
(
£t
è
’d


271 
loÿl
 
sig
 = 
c
.
SIG
[
k
]

272 
sig
 
th’
  
	`sigismemb”
(
£t
, sigè
’d


273 
	`”rÜ
("šv®id index " .. 
k
)

274 
’d
,

275 
__Ãw
 = 
	`funùiÚ
(

, 
¡r
)

276 
ffi
.
	`i¡y³
(

, 
¡r
è
th’
  sŒ 
’d


277 
nÙ
 
¡r
 
th’
  
ffi
.
	`Ãw
(

è
’d


278 
loÿl
 
f
 = 
ffi
.
	`Ãw
(

)

279 
loÿl
 
a
 = 
	`¥l™
(",", 
¡r
)

280 
i
, 
v
 
š
 
	`aœs
(
a
) do

281 
loÿl
 
¡
 = 
	`Œim
(
v
)

282 
loÿl
 
sig
 = 
c
.
SIG
[
¡
]

283 
nÙ
 
sig
 
th’
 
	`”rÜ
("šv®id sigÇl: " .. 
v
è
’d
 -- 
dÚ
'ˆu£hi fÜm© iàyou dÚ'
t
 
wªt
 
exû±iÚs
, 
b‘‹r
 
thª
 
s’t
 
ignÜe


284 
loÿl
 
d
 = 
b™
.
	`rshiá
(
sig
 - 1, 5è-- 
®ways
 32 
b™s


285 
f
.
sig
[
d
] = 
b™
.
	`bÜ
(f.sig[d], b™.
	`lshiá
(1, (sig - 1) % 32))

286 
’d


287  
f


288 
’d
,

289 
	}
}

291 
addty³
(
ty³s
, "sig£t", "sig£t_t", 
mt
.
sig£t
)

293 
	gmt
.
	gsigv®
 = {

294 
šdex
 = {

295 ğ
funùiÚ
(
£lf
è s–f.
siv®_št
 
’d
,

296 
	g±r
 = 
funùiÚ
(
£lf
è s–f.
siv®_±r
 
’d
,

298 
	gÃwšdex
 = {

299 ğ
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsiv®_št
 = v 
’d
,

300 
	g±r
 = 
funùiÚ
(
£lf
, 
v
è
	g£lf
.
	gsiv®_±r
 = v 
’d
,

302 
	g__Ãw
 = 
funùiÚ
(

, 
v
)

303 
nÙ
 
v
 
Ü
 
ty³
(vè=ğ"bË" 
th’
  
Ãwâ
(

, vè
’d


304 
loÿl
 
	gsiv
 = 
ffi
.
Ãw
(

)

305 
ty³
(
v
è=ğ"numb”" 
th’
 
siv
.ğv siv.
±r
 = v 
’d


306  
siv


307 
’d
,

310 
addty³
(
ty³s
, "sigv®", "uniÚ sigv®", 
mt
.
sigv®
è-- 
nÙ
 
®ways
 
ÿÎed
 
	gsigv®_t


312 -- 
cmsg
 
	gfunùiÚs
, 
Œy
 
to
 
hide
 
some
 
of
 
this
 
Ç¡y
 
¡uff
 
äom
 
the
 
u£r


313 
loÿl
 
	gcmsgty³
 = "struct cmsghdr"

314 
abi
.
rumpâ
 
th’
 
cmsgty³
 =‡bi.
	$rumpâ
(
cmsgty³
è
’d


315 
loÿl
 
cmsg_hdrsize
 = 
ffi
.(ffi.
	`ty³of
(
cmsgty³
), 0)

316 
loÿl
 
void®ign
 = 
ffi
.
	`®ignof
(ffi.
	`ty³of
("void *"))

317 
loÿl
 
funùiÚ
 
	$cmsg_®ign
(
Ën
è 
	$®ign
(
Ën
, 
void®ign
è
’d
 -- 
TODO
 
check
 
this
 
is
 
cÜ»ù
 
®l
 
OSs


318 
loÿl
 
cmsg_ahdr
 = 
	`cmsg_®ign
(
cmsg_hdrsize
)

319 --
loÿl
 
funùiÚ
 
	$cmsg_¥aû
(
Ën
è 
cmsg_ahdr
 + 
	$cmsg_®ign
(
Ën
è
’d


320 
loÿl
 
funùiÚ
 
	$cmsg_Ën
(
Ën
è 
cmsg_ahdr
 +†’ 
’d


322 -- 
TODO
 
move
 
this
 
to
 
sockİt
 
fe
, 
like
 
£t
/
g‘sockİt
 
as
 
v”y
 
sim¬
 
m­pšg


323 
loÿl
 
ty³m­
 = {

324 [
c
.
SOL
.
SOCKET
] = c.
SCM
,

325 
	}
}

327 -- 
TODO
 
add
 
the
 
Ùhes
 
	gh”e
, 
they
 
difãr
 
by
 
OS


328 
	gc
.
	gSOL
.
IP
 
th’
 
	gty³m­
[
c
.
SOL
.IP] = c.IP 
’d


330 
mt
.
cmsghdr
 = {

331 
__šdex
 = {

332 
Ën
 = 
funùiÚ
(
£lf
è 
tÚumb”
(£lf.
cmsg_Ën
è
’d
,

333 
	gd©a
 = 
funùiÚ
(
£lf
è s–f.
cmsg_d©a
 
’d
,

334 
	gd©®’
 = 
funùiÚ
(
£lf
è s–f:
Ën
(è- 
cmsg_ahdr
 
’d
,

335 
	ghdrsize
 = 
funùiÚ
(
£lf
è 
cmsg_hdrsize
 
’d
, -- 
	gcÚ¡ªt
, 
but
 
b‘‹r
 
to
 
have
 
™
 
h”e


336 
	g®ign
 = 
funùiÚ
(
£lf
è 
cmsg_®ign
(£lf:
Ën
()è
’d
,

337 
	gfds
 = 
funùiÚ
(
£lf
)

338 
£lf
.
cmsg_Ëv–
 =ğ
c
.
SOL
.
SOCKET
 
ªd
 s–f.
cmsg_ty³
 =ğc.
SCM
.
RIGHTS
 
th’


339 
loÿl
 
fda
 = 
±
.(
£lf
:
d©a
())

340 
loÿl
 
fdc
 = 
b™
.
rshiá
(
£lf
:
d©®’
(), 2è-- 
shiá
 
by
 
size


341 
loÿl
 
	gi
 = 0

342  
funùiÚ
()

343 
i
 < 
fdc
 
th’


344 
loÿl
 
fd
 = 
t
.fd(
fda
[
i
])

345 
i
 = i + 1

346  
fd


347 
’d


348 
’d


350  
funùiÚ
(è
’d


351 
’d


352 
’d
,

353 
	güed’tŸls
 = 
funùiÚ
(
£lf
è-- 
TODO
 
Lšux
 
Úly
, 
N‘BSD
 
u£s
 
SCM_CREDS


354 
	g£lf
.
	gcmsg_Ëv–
 =ğ
c
.
SOL
.
SOCKET
 
ªd
 
£lf
.
cmsg_ty³
 =ğc.
SCM
.
CREDENTIALS
 
th’


355 
loÿl
 
üed
 = 
±
.
uüed
(
£lf
:
d©a
())

356  
üed
.
pid
, 
	güed
.
	guid
, c»d.
gid


358  
	gn
, "cmsg does‚ot contain credentials"

359 
’d


360 
	g’d
,

361 
	g£td©a
 = 
funùiÚ
(
£lf
, 
d©a
, 
d©®’
)

362 
	gffi
.
cİy
(
£lf
:
d©a
(), d©a, 
d©®’
 
Ü
 #data)

363 
	g’d
,

364 
	g£tfd
 = 
funùiÚ
(
£lf
, 
fd
è-- 
sšgË
 fd

365 
loÿl
 ğ
±
.(
£lf
:
d©a
())

366 [0] = 
g‘fd
(
fd
)

367 
’d
,

368 
	g£tfds
 = 
funùiÚ
(
£lf
, 
fds
è-- 
g’”®
 , 
nÙe
 
dÛs
 
nÙ
 
check
 
size


369 
ty³
(
fds
è=ğ"numb”" 
Ü
 fds.
g‘fd
 
th’
  
£lf
:
£tfd
(fdsè
’d


370 
loÿl
 ğ
±
.(
£lf
:
d©a
())

371 
loÿl
 
off
 = 0

372 
_
, 
v
 
š
 
aœs
(
fds
) do

373 [
off
] = 
g‘fd
(
v
)

374 
off
 = off + 1

375 
’d


376 
’d
,

378 
	g__Ãw
 = 
funùiÚ
 (

, 
Ëv–
, 
scm
, 
d©a
, 
d©a_size
)

379 
nÙ
 
d©a
 
th’
 
	gd©a_size
 = 
d©a_size
 
Ü
 0 
’d


380 
Ëv–
 = 
c
.
SOL
[level]

381 
ty³m­
[
Ëv–
] 
th’
 
scm
 =y³m­[Ëv–][scm] 
’d


382 
Ëv–
 =ğ
c
.
SOL
.
SOCKET
 
ªd
 
scm
 =ğc.
SCM
.
RIGHTS
 
th’


383 
ty³
(
d©a
è=ğ"numb”" 
th’
 -- 
¦ighy
 
odd
 
but
 
u£ful
 
š‹rçûs
 
fds
 - 
TODO
 
docum’t


384 
d©a_size
 = 
d©a
 * 
s
.

385 
d©a
 = 
n


386 
–£if
 
ty³
(
d©a
è=ğ"bË" 
th’
 
d©a_size
 = #d©¨* 
s
.
’d


387 
’d


388 
d©a_size
 = d©a_siz
Ü
 #data

389 
loÿl
 
£lf
 = 
ffi
.
Ãw
(

, 
d©a_size
, {

390 
cmsg_Ën
 = cmsg_Ën(
d©a_size
),

391 
cmsg_Ëv–
 = 
Ëv–
,

392 
cmsg_ty³
 = 
scm
,

394 
d©a
 
ªd
 (
Ëv–
 =ğ
c
.
SOL
.
SOCKET
‡nd 
scm
 =ğc.
SCM
.
RIGHTS
è
th’


395 
£lf
:
£tfds
(
d©a
)

396 
–£if
 
d©a
 
th’


397 
£lf
:
£td©a
(
d©a
, 
d©a_size
)

398 
’d


399  
£lf


400 
	g’d
,

403 
addty³_v¬
(
ty³s
, "cmsghdr", "¡ruù cmsghdr", 
mt
.
cmsghdr
)

405 -- 
msg_cÚŒŞ
 
is
 
a
 
bunch
 
of
 
cmsg
 
	g¡ruùs
, 
but
 
the£
 
¬e
 
®l
 
difã»Á
 
	gËngths
, 
as
 
they
 
have
 
v¬ŸbË
 
size
 
	g¬¿ys


407 -- 
the£
 
funùiÚs
 
®so
 
ke
 
ªd
  
a
 
¿w
 
poš‹r
 
to
 
	gmsg_cÚŒŞ
,Ø
make
 
liã
 
	g—s›r
, 
as
 
w–l
‡ 
the
 
ÿ¡
 
cmsg


408 
loÿl
 
funùiÚ
 
	$cmsg_fœ¡hdr
(
msg
)

409 
loÿl
 
mc
 = 
msg
.
msg_cÚŒŞ


410 
loÿl
 
cmsg
 = 
±
.
	$cmsghdr
(
mc
)

411 
	`tÚumb”
(
msg
.
msg_cÚŒŞËn
è< 
cmsg
:
	$hdrsize
(è
th’
  
n
 
’d
 -- 
hdrsize
 
is
 
a
 
cÚ¡ªt
, 
so
 
dÛs
 
nÙ
 
m©‹r
 
šv®id
 

412  
mc
, 
cmsg


413 
’d


415 
loÿl
 
funùiÚ
 
	$cmsg_nxthdr
(
msg
, 
buf
, 
cmsg
)

416 
	`tÚumb”
(
cmsg
.
cmsg_Ën
è< cmsg:
	$hdrsize
(è
th’
  
n
 
’d
 -- 
šv®id
 
cmsg


417 
buf
 = 
±
.(buf)

418 
loÿl
 
msg_cÚŒŞ
 = 
±
.(
msg
.msg_control)

419 
buf
 = buà+ 
cmsg
:
	`®ign
(è-- 
fšd
 
Ãxt
 cmsg

420 
buf
 + 
cmsg
:
	`hdrsize
(è> 
msg_cÚŒŞ
 + 
msg
.
msg_cÚŒŞËn
 
th’
  
n
 
’d
 -- 
h—d”
 
would
 
nÙ
 
f™


421 
cmsg
 = 
±
.
	$cmsghdr
(
buf
)

422 
buf
 + 
cmsg
:
	`®ign
(è> 
msg_cÚŒŞ
 + 
msg
.
msg_cÚŒŞËn
 
th’
  
n
 
’d
 -- 
whŞe
 cmsg 
would
 
nÙ
 
f™


423  
buf
, 
cmsg


424 
’d


426 
loÿl
 
funùiÚ
 
	$cmsg_™”
(
msg
, 
Ï¡_msg_cÚŒŞ
)

427 
loÿl
 
msg_cÚŒŞ


428 
Ï¡_msg_cÚŒŞ
 =ğ
n
 
th’
 -- 
Fœ¡
 
™”©iÚ


429 
msg_cÚŒŞ
 = 
±
.(
msg
.msg_control)

431 
loÿl
 
Ï¡_cmsg
 = 
±
.
	$cmsghdr
(
Ï¡_msg_cÚŒŞ
)

432 
msg_cÚŒŞ
 = 
Ï¡_msg_cÚŒŞ
 + 
Ï¡_cmsg
:
	`®ign
(è-- 
fšd
 
Ãxt
 
cmsg


433 
’d


434 
loÿl
 
’d_off£t
 = 
±
.(
msg
.
msg_cÚŒŞ
è+ msg.
msg_cÚŒŞËn


435 
loÿl
 
cmsg
 = 
±
.
	$cmsghdr
(
msg_cÚŒŞ
)

436 
msg_cÚŒŞ
 + 
cmsg
:
	`hdrsize
(è> 
’d_off£t
 
th’
  
n
 
’d
 -- 
h—d”
 
would
 
nÙ
 
f™


437 
msg_cÚŒŞ
 + 
cmsg
:
	`®ign
(è> 
’d_off£t
 
th’
  
n
 
’d
 -- 
whŞe
 cmsg 
would
 
nÙ
 
f™


438  
msg_cÚŒŞ
, 
cmsg


439 
’d


440 
loÿl
 
funùiÚ
 
	$cmsg_h—d”s
(
msg
)

441  
cmsg_™”
, 
msg
, 
n


442 
’d


444 
mt
.
msghdr
 = {

445 
__šdex
 = {

446 
cmsg_fœ¡hdr
 = cmsg_firsthdr,

447 
cmsg_nxthdr
 = cmsg_nxthdr,

448 
cmsgs
 = 
cmsg_h—d”s
,

449 -- 
TODO
 
add
 
iov


451 
Ãwšdex
 = {

452 
Çme
 = 
	`funùiÚ
(
m
, 
n
)

453 
m
.
msg_Çme
, m.
msg_Çm–’
 = 
n
, #n

454 
’d
,

455 
iov
 = 
	`funùiÚ
(
m
, 
io
)

456 
ffi
.
	`i¡y³
(
t
.
iovec
, 
io
è
th’
 -- 
sšgË
 iovec

457 
m
.
msg_iov
, m.
msg_iovËn
 = 
io
, 1

458 -- 
iovecs


459 
m
.
msg_iov
, m.
msg_iovËn
 = 
io
.
iov
, #io

460 
’d


461 
’d
,

462 
cÚŒŞ
 = 
	`funùiÚ
(
m
, 
buf
)

463 
buf
 
th’
 
m
.
msg_cÚŒŞ
, m.
msg_cÚŒŞËn
 = buf, #buàm.msg_cÚŒŞ, m.msg_cÚŒŞËÀğ
n
, 0 
’d


464 
’d
,

466 
__Ãw
 = 
Ãwâ
,

467 
	}
}

469 
addty³
(
ty³s
, "msghdr", "¡ruù msghdr", 
mt
.
msghdr
)

471 
	gmt
.
	gpŞlfd
 = {

472 
šdex
 = {

473 
g‘fd
 = 
funùiÚ
(
pfd
è…fd.
fd
 
’d
,

477 
	gk
, 
v
 
š
 
	$·œs
(
c
.
POLL
èdØ
mt
.
pŞlfd
.
šdex
[
k
] = 
	$funùiÚ
(
pfd
è 
b™
.
	`bªd
Õfd.
»v’ts
, 
v
è~ğ0 
’d
ƒnd

479 
	`addty³
(
ty³s
, "pŞlfd", "¡ruù…Şlfd", 
mt
.
pŞlfd
)

481 
mt
.
pŞlfds
 = {

482 
__Ën
 = 
	`funùiÚ
(
p
è….
couÁ
 
’d
,

483 
__Ãw
 = 
	`funùiÚ
(

, 
ps
)

484 
	`ty³
(
ps
è=ğ'numb”' 
th’
  
ffi
.
	`Ãw
(

,…s,…sè
’d


485 
loÿl
 
couÁ
 = #ps

486 
loÿl
 
fds
 = 
ffi
.
	`Ãw
(

, 
couÁ
, count)

487 
n
 = 1, 
couÁ
 dØ-- 
TODO
 
id—Îy
 
we
 
u£
 
aœs
 
Ú
 
bÙh
 
¬¿ys
/
bËs


488 
fds
.
pfd
[
n
 - 1].
fd
 = 
ps
[n].fd:
	`g‘fd
()

489 
fds
.
pfd
[
n
 - 1].
ev’ts
 = 
c
.
POLL
[
ps
[n].events]

490 
fds
.
pfd
[
n
 - 1].
»v’ts
 = 0

491 
’d


492  
fds


493 
’d
,

494 
__aœs
 = 
	`funùiÚ
(
p
è 
»v™”
,….
pfd
,….
couÁ
 
’d


495 
	}
}

497 
addty³_v¬
(
ty³s
, "pŞlfds", "¡ruù {šˆcouÁ; sŒuù…Şlfd…fd[?];}", 
mt
.
pŞlfds
)

499 
	gmt
.
	gru§ge
 = {

500 
šdex
 = {

501 
utime
 = 
funùiÚ
(
ru
è„u.
ru_utime
 
’d
,

502 
	g¡ime
 = 
funùiÚ
(
ru
è„u.
ru_¡ime
 
’d
,

503 
	gmaxrss
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_maxrss
è
’d
,

504 
	gixrss
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_ixrss
è
’d
,

505 
	gidrss
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_idrss
è
’d
,

506 
	gi¤ss
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_i¤ss
è
’d
,

507 
	gmšæt
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_mšæt
è
’d
,

508 
	gmajæt
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_majæt
è
’d
,

509 
	gnsw­
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_nsw­
è
’d
,

510 
	gšblock
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_šblock
è
’d
,

511 
	goublock
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_oublock
è
’d
,

512 
	gmsg¢d
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_msg¢d
è
’d
,

513 
	gmsgrcv
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_msgrcv
è
’d
,

514 
	gnsigÇls
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_nsigÇls
è
’d
,

515 
	gnvcsw
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_nvcsw
è
’d
,

516 
	gnivcsw
 = 
funùiÚ
(
ru
è 
tÚumb”
Ôu.
ru_nivcsw
è
’d
,

518 
	g´št
 = {"utime", "stime", "maxrss", "ixrss", "idrss", "isrss", "minflt", "majflt", "nswap",

522 
addty³
(
ty³s
, "ru§ge", "¡ruù„u§ge", 
mt
.
ru§ge
)

524 
loÿl
 
funùiÚ
 
	$™nÜm®
(
v
)

525 
nÙ
 
v
 
th’
 v = {{0, 0}, {0, 0}
	}
} 
’d


526 
v
.
š‹rv®
 
th’


527 
v
.
™_š‹rv®
 = v.
š‹rv®


528 
v
.
š‹rv®
 = 
n


529 
’d


530 
v
.
v®ue
 
th’


531 
v
.
™_v®ue
 = v.
v®ue


532 
v
.
v®ue
 = 
n


533 
’d


534 
nÙ
 
v
.
™_š‹rv®
 
th’


535 
v
.
™_š‹rv®
 = v[1]

536 
v
[1] = 
n


537 
’d


538 
nÙ
 
v
.
™_v®ue
 
th’


539 
v
.
™_v®ue
 = v[2]

540 
v
[2] = 
n


541 
’d


542  
v


543 
’d


545 
mt
.
™im”¥ec
 = {

546 
šdex
 = {

547 
š‹rv®
 = 
funùiÚ
(
™
è it.
™_š‹rv®
 
’d
,

548 
	gv®ue
 = 
funùiÚ
(
™
è it.
™_v®ue
 
’d
,

550 
	g__Ãw
 = 
funùiÚ
(

, 
v
)

551 
	gv
 = 
™nÜm®
(
v
)

552 
v
.
™_š‹rv®
 = 
i¡y³
(
t
.
time¥ec
, v.™_š‹rv®è
Ü
 
	gt
.timespec(v.it_interval)

553 
	gv
.
	g™_v®ue
 = 
i¡y³
(
t
.
time¥ec
, 
v
.
™_v®ue
è
Ü
 
	gt
.timespec(v.it_value)

554  
	gffi
.
Ãw
(

, 
v
)

555 
	g’d
,

558 
addty³
(
ty³s
, "™im”¥ec", "¡ruù itim”¥ec", 
mt
.
™im”¥ec
)

560 
	gmt
.
	g™im”v®
 = {

561 
šdex
 = {

562 
š‹rv®
 = 
funùiÚ
(
™
è it.
™_š‹rv®
 
’d
,

563 
	gv®ue
 = 
funùiÚ
(
™
è it.
™_v®ue
 
’d
,

565 
	g__Ãw
 = 
funùiÚ
(

, 
v
)

566 
	gv
 = 
™nÜm®
(
v
)

567 
v
.
™_š‹rv®
 = 
i¡y³
(
t
.
timev®
, v.™_š‹rv®è
Ü
 
	gt
.timeval(v.it_interval)

568 
	gv
.
	g™_v®ue
 = 
i¡y³
(
t
.
timev®
, 
v
.
™_v®ue
è
Ü
 
	gt
.timeval(v.it_value)

569  
	gffi
.
Ãw
(

, 
v
)

570 
	g’d
,

573 
addty³
(
ty³s
, "™im”v®", "¡ruù itim”v®", 
mt
.
™im”v®
)

575 
	gmt
.
	gmaÿddr
 = {

576 
__to¡ršg
 = 
funùiÚ
(
m
)

577 
loÿl
 
hex
 = {}

578 
i
 = 1, 6 do

579 
	ghex
[
i
] = 
¡ršg
.
fÜm©
("%02x", 
m
.
mac_addr
[i - 1])

580 
’d


581  
	gbË
.
cÚÿt
(
hex
, ":")

582 
	g’d
,

583 
	g__Ãw
 = 
funùiÚ
(

, 
¡r
)

584 
loÿl
 
	gmac
 = 
ffi
.
Ãw
(

)

585 
¡r
 
th’


586 
i
 = 1, 6 do

587 
loÿl
 
	gn
 = 
tÚumb”
(
¡r
:
sub
(
i
 * 3 - 2, i * 3 - 1), 16è-- 
TODO
 
mÜe
 
checks
 
Ú
 
syÁax


588 
	gmac
.
	gmac_addr
[
i
 - 1] = 
n


589 
’d


590 
’d


591  
mac


592 
’d
,

595 
addty³
(
ty³s
, "maÿddr", "¡ruù {ušt8_ˆmac_addr[6];}", 
mt
.
maÿddr
)

597 -- 
šşude
 
OS
 
¥ecific
 
ty³s


598 
	gty³s
 = 
o¡y³s
.
	$š™
(
ty³s
)

599 
bsdty³s
 
th’
 
ty³s
 = bsdty³s.
	$š™
(
c
, 
ty³s
è
’d


601 -- 
defše
 
d’ts
 
ty³
 
dœ’t
 
is
 
defšed


602 
t
.
dœ’t
 
th’


603 
t
.
dœ’ts
 = 
	`funùiÚ
(
buf
, 
size
è-- buà
should
 
be
 *

604 
loÿl
 
d
, 
i
 = 
n
, 0

605  
	`funùiÚ
(è-- 
TODO
 
wÜk
 
out
 
possibË
 
to
 
make
 
¡©–ess


606 
size
 > 0 
ªd
 
nÙ
 
d
 
th’


607 
d
 = 
±
.
	$dœ’t
(
buf
)

608 
i
 = i + 
d
.
d_»ş’


609  
d


610 
’d


611 
i
 < 
size
 do

612 
d
 = 
±
.
	`dœ’t
Õt.(dè+ d.
d_»ş’
)

613 
i
 = i + 
d
.
d_»ş’


614 
d
.
šo
 ~ğ0 
th’
  d 
’d
 -- 
some
 
sy¡ems
 
u£
 inØğ0 
d–‘ed
 
fes
 
befÜe
 
»moved
 
eg
 
OSX
; 
™
 
is
 
Ãv”
 
v®id


615 
’d


616  
n


617 
’d


618 
’d


619 
’d


621  
ty³s


623 
’d


625  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/util.lua

1 -- 
g’”ic
 
uts
 
nÙ
 
¥ecific
 
to
 
ªy
 
	gOS


3 -- 
the£
 
¬e
 
g’”®ly
 
equiv®’t
 
to
 
thšgs
 
th©
‡» 
š
 
	$mª
(1è
Ü
 
	`mª
(3)

4 -- 
the£
 
ÿn
 
be
 
made
 
mÜe
 
moduÏr
 
as
 
numb”
 
šü—£s


6 
loÿl
 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

7 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

8 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg
 =

9 
»quœe
, 
”rÜ
, 
as£¹
, 
tÚumb”
, 
to¡ršg
,

10 
£tm‘©abË
, 
·œs
, 
aœs
, 
uÅack
, 
¿wg‘
, 
¿w£t
,

11 
pÿÎ
, 
ty³
, 
bË
, 
¡ršg


13 
loÿl
 
funùiÚ
 
	$š™
(
S
)

15 
loÿl
 
h
 = 
»quœe
 "syscall.helpers"

16 
loÿl
 
htÚl
 = 
h
.htonl

18 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
b™
 = 
»quœe
 "syscall.bit"

21 
loÿl
 
abi
, 
ty³s
, 
c
 = 
S
.abi, S.types, S.c

22 
loÿl
 
t
, 
±
, 
s
 = 
ty³s
.t,ypes.pt,ypes.s

24 
loÿl
 
mt
, 
m‘h
 = {
	}
}, {}

26 
loÿl
 
	gut
 = 
»quœe
("sysÿÎ." .. 
abi
.
os
 .. ".ut").
	$š™
(
S
)

28 
mt
.
dœ
 = {

29 
__to¡ršg
 = 
	`funùiÚ
(
t
)

30 #ˆ=ğ0 
th’
  "" 
’d


31 
bË
.
	`sÜt
(
t
)

32  
bË
.
	`cÚÿt
(
t
, "\n") .. "\n"

33 
’d


34 
	}
}

36 
funùiÚ
 
	gut
.
dœbË
(
Çme
, 
nodÙs
è--  
bË
 
of
 
dœeùÜy
 
	g’Œ›s
, 
	g»move
 . 
	gªd
 .. nodÙ 
Œue


37 
loÿl
 
	gd
 = {}

38 
loÿl
 
size
 = 4096

39 
loÿl
 
buf
 = 
t
.
	$bufãr
(
size
)

40 
loÿl
 
™”
, 
”r
 = 
ut
.
	$ls
(
Çme
, 
buf
, 
size
)

41 
nÙ
 
™”
 
th’
  
n
, 
”r
 
’d


42 
f
 
š
 
™”
 do

43 
	`nÙ
 (
nodÙs
 
	`ªd
 (
f
 =ğ"." 
Ü
 f =ğ"..")è
th’
 
d
[#d + 1] = f 
’d


44 
’d


45  
	$£tm‘©abË
(
d
, 
mt
.
dœ
)

46 
’d


48 -- 
this
 
»tuºs
 
ª
 
™”©Ü
 
ov”
 
muÉË
 
ÿÎs
 
to
 
g‘d’ts
 
TODO
 
add
 
nodÙs
?

49 -- 
nÙe
 
how
 
”rÜs
 
wÜk
, 
g‘d’ts
 
wl
 
throw
 
as
 
ÿÎed
 
muÉË
 
times
, 
but
 
nÜm®ly
 
should
 
nÙ
 
ç
 
İ’
 
sucûeds


50 -- 
g‘d’ts
 
ÿn
 
ç
 
eg
 
Ú
 
nfs
 
though
.

51 
funùiÚ
 
ut
.
	$ls
(
Çme
, 
buf
, 
size
)

52 
size
 = siz
Ü
 4096

53 
buf
 = buà
Ü
 
t
.
	$bufãr
(
size
)

54 
nÙ
 
Çme
 
th’
‚amğ"." 
’d


55 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
Çme
, "directory,„donly")

56 
”r
 
th’
  
n
,ƒ¼ 
’d


57 
loÿl
 
di


58  
	$funùiÚ
()

59 
loÿl
 
d
, 
fœ¡


60 
»³©


61 
nÙ
 
di
 
th’


62 
loÿl
 
”r


63 
di
, 
”r
 = 
fd
:
	$g‘d’ts
(
buf
, 
size
)

64 
nÙ
 
di
 
th’


65 
fd
:
	$şo£
()

66 
	$”rÜ
(
”r
)

67 
’d


68 
fœ¡
 = 
Œue


69 
’d


70 
d
 = 
	$di
()

71 
nÙ
 
d
 
th’
 
di
 = 
n
 
’d


72 
nÙ
 
d
 
ªd
 
fœ¡
 
th’
  
n
 
’d


73 
uÁ
 
d


74  
d
.
Çme
, d

75 
’d


76 
’d


78 -- 
»cursive
 
rm
 
TODO
 
u£
 
ls
 
™”©Ü
, 
which
 
®so
 
»tuºs
 
ty³


79 
loÿl
 
funùiÚ
 
	$rmh–³r
(
fe
, 
´efix
)

80 
loÿl
 
Çme


81 
´efix
 
th’
 
Çme
 =…»fix .. "/" .. 
fe
 Çmğf
’d


82 
loÿl
 
¡
, 
”r
 = 
S
.
	$l¡©
(
Çme
)

83 
nÙ
 
¡
 
th’
  
n
, 
”r
 
’d


84 
¡
.
isdœ
 
th’


85 
loÿl
 
fes
, 
”r
 = 
ut
.
	$dœbË
(
Çme
, 
Œue
)

86 
nÙ
 
fes
 
th’
  
n
, 
”r
 
’d


87 
_
, 
f
 
š
 
	$·œs
(
fes
) do

88 
loÿl
 
ok
, 
”r
 = 
	$rmh–³r
(
f
, 
Çme
)

89 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


90 
’d


91 
loÿl
 
ok
, 
”r
 = 
S
.
	$rmdœ
(
Çme
)

92 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


94 
loÿl
 
ok
, 
”r
 = 
S
.
	$uÆšk
(
Çme
)

95 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


96 
’d


97  
Œue


98 
’d


100 
funùiÚ
 
ut
.
	$rm
(...)

101 
_
, 
f
 
š
 
aœs
{...
	}
} do

102 
loÿl
 
	gok
, 
	g”r
 = 
	$rmh–³r
(
f
)

103 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


104 
’d


105  
Œue


106 
’d


108 -- 
TODO
 
w¬nšg
 
brok’


109 
funùiÚ
 
ut
.
	`ı
(
sourû
, 
de¡
, 
mode
è-- 
TODO
 
make
 
much
 
mÜe
 
funùiÚ®
, 
Ëss
 
brok’
, 
e¥
 
fix
 mode! 
ªd
 
size
 
issue
!!

110 
loÿl
 
cÚ‹Ás
, 
”r
 = 
ut
.
	$»adfe
(
sourû
)

111 
nÙ
 
cÚ‹Ás
 
th’
  
n
, 
”r
 
’d


112 
loÿl
 
ok
, 
”r
 = 
ut
.
	$wr™efe
(
de¡
, 
cÚ‹Ás
, 
mode
)

113 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


114  
Œue


115 
’d


117 
funùiÚ
 
ut
.
	$touch
(
fe
)

118 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
fe
, "wronly,creat,noctty,nonblock", "0666")

119 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


120 
loÿl
 
fd2
, 
”r
 = 
S
.
	$dup
(
fd
)

121 
nÙ
 
fd2
 
th’


122 
fd2
:
	$şo£
()

123  
n
, 
”r


124 
’d


125 
fd
:
	$şo£
()

126 
loÿl
 
ok
, 
”r
 = 
S
.
	$futimes
(
fd2
)

127 
fd2
:
	$şo£
()

128 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


129  
Œue


130 
’d


132 
funùiÚ
 
ut
.
	`ü—‹fe
(
fe
è-- 
touch
 
w™hout
 
time¡amp
 
adju¡m’t


133 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
fe
, "wronly,creat,noctty,nonblock", "0666")

134 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


135 
loÿl
 
ok
, 
”r
 = 
fd
:
	$şo£
()

136 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


137  
Œue


138 
’d


140 
funùiÚ
 
ut
.
	`m­fe
(
Çme
è-- 
g’”®ly
 
b‘‹r
 
to
 
u£
, 
but
 
no
 
good
 
sysfs
 
‘c


141 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
Çme
, "rdonly")

142 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


143 
loÿl
 
¡
, 
”r
 = 
S
.
	$f¡©
(
fd
)

144 
nÙ
 
¡
 
th’
  
n
, 
”r
 
’d


145 
loÿl
 
size
 = 
¡
.size

146 
loÿl
 
m
, 
”r
 = 
S
.
	`mm­
(
n
, 
size
, "»ad", "sh¬ed", 
fd
, 0)

147 
nÙ
 
m
 
th’
  
n
, 
”r
 
’d


148 
loÿl
 
¡r
 = 
ffi
.
	$¡ršg
(
m
, 
size
)

149 
loÿl
 
ok
, 
”r
 = 
S
.
	$munm­
(
m
, 
size
)

150 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


151 
loÿl
 
ok
, 
”r
 = 
fd
:
	$şo£
()

152 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


153  
¡r


154 
’d


156 -- 
TODO
 
fix
 
»ads
, 
but
 
mašly
 
u£d
 
sysfs
, 
´oc


157 
funùiÚ
 
ut
.
	$»adfe
(
Çme
, 
bufãr
, 
Ëngth
)

158 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
Çme
, "rdonly")

159 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


160 
loÿl
 
r
, 
”r
 = 
S
.
	$»ad
(
fd
, 
bufãr
, 
Ëngth
 
Ü
 4096)

161 
nÙ
 
r
 
th’
  
n
, 
”r
 
’d


162 
loÿl
 
ok
, 
”r
 = 
fd
:
	$şo£
()

163 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


164  
r


165 
’d


167 -- 
wr™e
 
¡ršg
 
to
 
Çmed
 
fe
; 
s’y
 
ignÜe
 
wr™es
 
TODO
 
fix


168 
funùiÚ
 
ut
.
	$wr™efe
(
Çme
, 
¡r
, 
mode
, 
æags
)

169 
loÿl
 
fd
, 
”r


170 
mode
 
th’
 
fd
, 
”r
 = 
S
.
	$ü—t
(
Çme
, 
mode
è
fd
, 
”r
 = 
S
.
	`İ’
Òame, 
æags
 
Ü
 "wrÚly"è
’d


171 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


172 
loÿl
 
n
, 
”r
 = 
S
.
	$wr™e
(
fd
, 
¡r
)

173 
nÙ
 
n
 
th’
  
n
, 
”r
 
’d


174 
loÿl
 
ok
, 
”r
 = 
fd
:
	$şo£
()

175 
nÙ
 
ok
 
th’
  
n
, 
”r
 
’d


176  
Œue


177 
’d


179 
mt
.
ps
 = {

180 
__to¡ršg
 = 
	`funùiÚ
(
ps
)

181 
loÿl
 
s
 = {}

182 
i
 = 1, #ps do

183 
s
[# + 1] = 
	`to¡ršg
(
ps
[
i
])

184 
’d


185  
bË
.
	`cÚÿt
(
s
, '\n')

186 
’d


187 
	}
}

189 -- 
nÙe
 
th©
 
Lšux
 
ªd
 
N‘BSD
 
	ghave
 /
´oc
 
but
 
F»eBSD
 
dÛs
 
nÙ
 
usu®ly
 
have
 
™
 
	gmouÁed
, 
®though
 iˆ
is
 
ª
 
İtiÚ


190 
funùiÚ
 
	gut
.
	$ps
()

191 
loÿl
 
ls
, 
”r
 = 
ut
.
	`dœbË
("/proc")

192 
nÙ
 
ls
 
th’
  
n
, 
”r
 
’d


193 
loÿl
 
ps
 = {
	}
}

194 
i
 = 1, #ls do

195 
nÙ
 
	g¡ršg
.
m©ch
(
ls
[
i
], '[^%d]'è
th’


196 
loÿl
 
	gp
 = 
ut
.
´oc
(
	$tÚumb”
(
ls
[
i
]))

197 
p
 
th’
 
ps
[#p + 1] =… 
’d


198 
’d


199 
’d


200 
bË
.
	`sÜt
(
ps
, 
	$funùiÚ
(
a
, 
b
è‡.
pid
 < b.pid 
’d
)

201  
	$£tm‘©abË
(
ps
, 
mt
.ps)

202 
’d


204 
mt
.
´oc
 = {

205 
__šdex
 = 
	`funùiÚ
(
p
, 
k
)

206 
loÿl
 
Çme
 = 
p
.
dœ
 .. 
k


207 
loÿl
 
¡
, 
”r
 = 
S
.
	`l¡©
(
Çme
)

208 
nÙ
 
¡
 
th’
  
n
, 
”r
 
’d


209 
¡
.
i¤eg
 
th’


210 
loÿl
 
fd
, 
”r
 = 
S
.
	`İ’
(
p
.
dœ
 .. 
k
, "rdonly")

211 
nÙ
 
fd
 
th’
  
n
, 
”r
 
’d


212 
loÿl
 
»t
, 
”r
 = 
S
.
	`»ad
(
fd
è-- 
»ad
 
deçuÉs
 
to
 4
k
, 
suffic›Á
?

213 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


214 
S
.
	`şo£
(
fd
)

215  
»t
 -- 
TODO
 
mªy
 
could
 
u£fuÎy
 dØ
w™h
 
some
 
·rsšg


216 
’d


217 
¡
.
i¦nk
 
th’


218 
loÿl
 
»t
, 
”r
 = 
S
.
	`»adlšk
(
Çme
)

219 
nÙ
 
»t
 
th’
  
n
, 
”r
 
’d


220  
»t


221 
’d


222 -- 
TODO
 
dœeùÜ›s


223 
’d
,

224 
__to¡ršg
 = 
	`funùiÚ
(
p
è-- 
TODO
 
decide
 
wh©
 
to
 
´št


225 
loÿl
 
c
 = 
p
.
cmdlše


226 
c
 
th’


227 #ø=ğ0 
th’


228 
loÿl
 
comm
 = 
p
.comm

229 
comm
 
ªd
 #comm > 0 
th’


230 
c
 = '[' .. 
comm
:
	`sub
(1, -2) .. ']'

231 
’d


232 
’d


233  
p
.
pid
 .. ' ' .. 
c


234 
’d


235 
’d


236 
	}
}

238 
funùiÚ
 
	gut
.
	$´oc
(
pid
)

239 
nÙ
 
pid
 
th’
…id = 
S
.
	$g‘pid
(è
’d


240  
	`£tm‘©abË
({
pid
 =…id, 
dœ
 = "/´oc/" ..…id .. "/"
	}
}, 
	gmt
.
	g´oc
)

241 
	g’d


243 -- 
»ûive
 
	gcmsg
, 
ex‹nded
 
h–³r
 
Ú
 
	g»cvmsg
, 
çœly
 
šcom¶‘e
 
©
 
´e£Á


244 
funùiÚ
 
	gut
.
	$»cvcmsg
(
fd
, 
msg
, 
æags
)

245 
nÙ
 
msg
 
th’


246 
loÿl
 
buf1
 = 
t
.
	`bufãr
(1è-- 
assume
 
u£r
 
wªts
 
to
 
»ûive
 
sšgË
 
by‹
Ø
g‘
 
cmsg


247 
loÿl
 
io
 = 
t
.
iovecs
{{
buf1
, 1}
	}
}

248 
loÿl
 
bufsize
 = 1024 -- 
§Ã
 , 
bud
 
your
 
own
 
¡ruùu»
 
Ùh”wi£


249 
loÿl
 
	gbuf
 = 
t
.
	$bufãr
(
bufsize
)

250 
msg
 = 
t
.
msghdr
{
iov
 = 
io
, 
msg_cÚŒŞ
 = 
buf
, 
msg_cÚŒŞËn
 = 
bufsize
}

251 
’d


252 
loÿl
 
	gcouÁ
, 
	g”r
 = 
S
.
	$»cvmsg
(
fd
, 
msg
, 
æags
)

253 
nÙ
 
couÁ
 
th’
  
n
, 
”r
 
’d


254 
loÿl
 
»t
 = {
couÁ
 = couÁ, 
iovec
 = 
msg
.
msg_iov
} --h© thbasiø v®ue,‡ndhiovec

255 
	gmc
, 
cmsg
 
š
 
	gmsg
:
	$cmsgs
() do

256 
loÿl
 
pid
, 
uid
, 
gid
 = 
cmsg
:
	$üed’tŸls
()

257 
pid
 
th’


258 
»t
.
pid
 =…id

259 
»t
.
uid
 = uid

260 
»t
.
gid
 = gid

261 
’d


262 
loÿl
 
fd_¬¿y
 = {
	}
}

263 
fd
 
š
 
cmsg
:
	$fds
() do

264 
fd_¬¿y
[#fd_¬¿y + 1] = 
fd


265 
’d


266 
»t
.
fd
 = 
fd_¬¿y


267 
’d


268  
»t


269 
’d


271 
funùiÚ
 
ut
.
	$£ndfds
(
fd
, ...)

272 
loÿl
 
buf1
 = 
t
.
	`bufãr
(1è-- 
Ãed
 
to
 
£nd
 
Úe
 
by‹


273 
loÿl
 
io
 = 
t
.
iovecs
{{
buf1
, 1}
	}
}

274 
loÿl
 
cmsg
 = 
t
.
cmsghdr
("socket", "rights", {...})

275 
loÿl
 
	gmsg
 = 
t
.
msghdr
{
iov
 = 
io
, 
	gcÚŒŞ
 = 
cmsg
}

276  
	gS
.
	$£ndmsg
(
fd
, 
msg
, 0)

277 
’d


279 -- 
g’”ic
 
š‘
 
Çme
 
to
 

, 
®so
 
w™h
 
Ãtmask
 
suµÜt


280 -- 
TODO
 
cÚv”t
 
to
 
a
 
ty³
? 
e™h”
 
way
 
should
 
nÙ
 
»®ly
 
be
 
š
 
ut
, 
´obably
 
h–³rs


281 -- 
b‘‹r
 
as
 
a
 
ty³
 
th©
 
»tuºs
 
š‘
, 
mask


282 
funùiÚ
 
ut
.
	$š‘_Çme
(
¤c
, 
Ãtmask
)

283 
loÿl
 
addr


284 
nÙ
 
Ãtmask
 
th’


285 
loÿl
 
a
, 
b
 = 
¤c
:
	`fšd
("/", 1, 
Œue
)

286 
a
 
th’


287 
Ãtmask
 = 
	`tÚumb”
(
¤c
:
	`sub
(
b
 + 1))

288 
¤c
 = src:
	`sub
(1, 
a
 - 1)

289 
’d


290 
’d


291 
¤c
:
	`fšd
(":", 1, 
Œue
è
th’
 -- 
v6


292 
addr
 = 
t
.
	$š6_addr
(
¤c
)

293 
nÙ
 
addr
 
th’
  
n
 
’d


294 
nÙ
 
Ãtmask
 
th’
‚‘mask = 128 
’d


296 
addr
 = 
t
.
	$š_addr
(
¤c
)

297 
nÙ
 
addr
 
th’
  
n
 
’d


298 
nÙ
 
Ãtmask
 
th’
‚‘mask = 32 
’d


299 
’d


300  
addr
, 
Ãtmask


301 
’d


303 
loÿl
 
funùiÚ
 
	$Ï¡¦ash
(
Çme
)

304 
loÿl
 
ls


305 
loÿl
 
i
 = 0

306 
Œue
 do

307 
i
 = 
¡ršg
.
	`fšd
(
Çme
, "/", i + 1)

308 
nÙ
 
i
 
th’
  
ls
 
’d


309 
ls
 = 
i


310 
’d


311 
’d


313 
loÿl
 
funùiÚ
 
	$d–Œa¦ash
(
Çme
)

314 
Çme
:
	`sub
(#name) == "/" do

315 
Çme
 = 
¡ršg
.
	`sub
(name, 1, #name - 1)

316 
’d


317  
Çme


318 
’d


320 
funùiÚ
 
ut
.
	$ba£Çme
(
Çme
)

321 
Çme
 =ğ"" 
th’
  "." 
’d


322 
Çme
 = 
	$d–Œa¦ash
(
Çme
)

323 
Çme
 =ğ"" 
th’
  "/" 
’d
 -- 
was
 / 
Ü


324 
loÿl
 
ls
 = 
	$Ï¡¦ash
(
Çme
)

325 
nÙ
 
ls
 
th’
  
Çme
 
’d


326  
¡ršg
.
	`sub
(
Çme
, 
ls
 + 1)

327 
’d


329 
funùiÚ
 
ut
.
	$dœÇme
(
Çme
)

330 
Çme
 =ğ"" 
th’
  "." 
’d


331 
Çme
 = 
	$d–Œa¦ash
(
Çme
)

332 
Çme
 =ğ"" 
th’
  "/" 
’d
 -- 
was
 / 
Ü


333 
loÿl
 
ls
 = 
	$Ï¡¦ash
(
Çme
)

334 
nÙ
 
ls
 
th’
  "." 
’d


335 
Çme
 = 
¡ršg
.
	`sub
Òame, 1, 
ls
 - 1)

336 
Çme
 = 
	$d–Œa¦ash
(
Çme
)

337 
Çme
 =ğ"" 
th’
  "/" 
’d
 -- 
was
 / 
Ü


338  
Çme


339 
’d


341  
ut


343 
’d


345  {
š™
 = 
	}
init}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/chatapp/chatapp.lua

1 --- 
	gTurbo
.
lua
 
Ch©
 
­p
 
usšg
 
	gWebSock‘s
.

3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g_G
.
	gTURBO_SSL
 = 
Œue


18 
loÿl
 
turbo
 = 
»quœe
 "turbo"

20 
loÿl
 
Ch©Room
 = 
şass
("ChatRoom")

22 
funùiÚ
 
Ch©Room
:
	$š™Ÿlize
()

23 
£lf
.
³rsÚs
 = {
	}
}

24 
£lf
.
subsüib”s
 = {}

25 
’d


27 
funùiÚ
 
Ch©Room
:
	$brßdÿ¡
(
·ckage
)

28 
loÿl
 
time
 = 
turbo
.
ut
.
	$g‘timeofday
()

29 
i
 = 1, #£lf.
subsüib”s
 do

30 
loÿl
 
sub
 = 
£lf
.
subsüib”s
[
i
]

31 
sub
.
sock‘
:
	`wr™e_mes§ge
(
turbo
.
esÿ³
.
jsÚ_’code
 {

32 
·ckage
 =…ackage,

33 
time
 =ime

34 
	}
})

35 
’d


36 
’d


38 
funùiÚ
 
	gCh©Room
:
	$add
(
nick
)

39 
i
=1, #£lf.
³rsÚs
 do

40 
£lf
.
³rsÚs
[
i
].
nick
 =ğnick 
th’


41  
çl£


42 
’d


43 
’d


44 
£lf
.
³rsÚs
[#£lf.³rsÚs+1] = {
nick
=
	}
nick}

45  
Œue


46 
’d


48 
funùiÚ
 
	gCh©Room
:
	$is_»gi¡”ed
(
nick
)

49 
i
=1, #£lf.
³rsÚs
 do

50 
£lf
.
³rsÚs
[
i
].
nick
 =ğnick 
th’


51  
Œue


52 
’d


53 
’d


54 
’d


56 
funùiÚ
 
Ch©Room
:
	$subsüibe
(
nick
, 
sock‘
)

57 
bË
.
	`š£¹
(
£lf
.
subsüib”s
, {
nick
òick, 
sock‘
=
	}
socket})

59 -- 
S’d
 
a
 
·¹cªt
 
jošed
 
	gmes§ge
.

60 
	g£lf
:
brßdÿ¡
({

61 
ty³
 = "participant-joined",

62 
d©a
 = 
nick


64 
	g£lf
:
	$upd©e_·¹icªts
()

65 
’d


67 
funùiÚ
 
Ch©Room
:
	`upd©e_·¹icªts
()

68 -- 
S’d
 
a
 
upd©ed
 
·¹icªt
 
li¡
.

69 
loÿl
 
nicks
 = {
	}
}

70 
i
 = 1, #£lf.
subsüib”s
 do

71 
	gnicks
[#nicks+1] = 
£lf
.
subsüib”s
[
i
].
nick


72 
’d


73 
£lf
:
brßdÿ¡
({

74 
ty³
 = "participant-update",

75 
d©a
 = 
nicks


77 
’d


79 
funùiÚ
 
	gCh©Room
:
unsubsüibe
(
nick
, 
sock‘
)

80 -- 
	gNYI
, 
»move
 
nick
 
ªd
 
sock‘
 
	gobjeù
.

81 
	gi
 = 1, #£lf.
subsüib”s
 do

82 
	g£lf
.
	gsubsüib”s
[
i
].
	gnick
 =ğ
nick
 
th’


83 
as£¹
(
£lf
.
subsüib”s
[
i
].
sock‘
 == socket,

85 
	gbË
.
	$»move
(
£lf
.
subsüib”s
, 
i
)

86 
’d


87 
’d


88 
£lf
:
	`brßdÿ¡
({

89 
ty³
 = "participant-left",

90 
d©a
 = 
nick


91 
	}
})

92 
	g£lf
:
	$upd©e_·¹icªts
()

93 
’d


96 --- 
Ch©
 
CommuniÿtiÚ
 
w™h
 
WebSock‘s
.

97 
loÿl
 
Ch©Com
 = 
	`şass
("Ch©Com", 
turbo
.
websock‘
.
WebSock‘HªdËr
)

99 
funùiÚ
 
Ch©Com
:
	`´•¬e
()

100 -- 
P»·»
 
m‘hod
 
is
 
run
 
befÜe
 
you
 
’‹r
 
WebSock‘
 
´ÙocŞ
 
Ïnd
.

101 -- 
You
 
ÿn
 
th’
 
disÿrd
 
»que¡s
 
ba£d
 
Ú
 
e
.
g
 
cook›s
.

102 
£lf
.
nick
 = s–f:
	`g‘_£cu»_cook›
("nick")

103 
nÙ
 
£lf
.
nick
 
th’


104 -- 
U£r
 
has
 
nÙ
 sigÃd 
š
.

105 
	`”rÜ
(
turbo
.
web
.
	$HTTPE¼Ü
(400))

106 
’d


107 
nÙ
 
£lf
.
İtiÚs
.
ch©room
:
	$is_»gi¡”ed
(
£lf
.
nick
è
th’


108 
	`”rÜ
(
turbo
.
web
.
	$HTTPE¼Ü
(400))

109 
’d


110 
’d


112 
funùiÚ
 
Ch©Com
:
	$İ’
()

113 
£lf
.
İtiÚs
.
ch©room
:
	$subsüibe
(
£lf
.
nick
, self)

114 
’d


116 
funùiÚ
 
Ch©Com
:
	$Ú_mes§ge
(
msg
)

117 
loÿl
 
·ck
 = 
turbo
.
esÿ³
.
	`jsÚ_decode
(
msg
).
·ckage


118 
	`as£¹
(
·ck
, "Invalid ChatCom‡pplication…rotocol.")

120 
£lf
.
İtiÚs
.
ch©room
:
	`brßdÿ¡
({

121 
ty³
 = "message",

122 
d©a
 = {

123 
nick
 = 
£lf
.nick,

124 
msg
 = 
·ck
.
d©a
.msg

126 
	}
})

127 
’d


129 
funùiÚ
 
	gCh©Com
:
	$Ú_şo£
()

130 
£lf
.
İtiÚs
.
ch©room
:
	$unsubsüibe
(
£lf
.
nick
, self)

131 
turbo
.
log
.
	`nÙiû
("U£¸discÚÃùed: " .. 
£lf
.
nick
)

132 
’d


134 
loÿl
 
SignInHªdËr
 = 
	`şass
("SignInHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

136 --- 
HªdËr
 
to
 
check
 
u£r
 
is
 
®»ady
 
logged
 
š
.

137 
funùiÚ
 
SignInHªdËr
:
	$g‘
()

138 
loÿl
 
nick
 = 
£lf
:
	`g‘_¬gum’t
("nick")

139 
nÙ
 
£lf
.
İtiÚs
.
ch©room
:
	$is_»gi¡”ed
(
nick
è
th’


140 
£lf
:
	`wr™e
({
ok
 = 
çl£
})

142 
’d


143 
£lf
:
wr™e
({
ok
 = 
Œue
})

144 
’d


146 --- 
HªdËr
 
to
 
nickÇme
 
‘c
.

147 
funùiÚ
 
SignInHªdËr
:
	$po¡
()

148 
loÿl
 
nick
 = 
£lf
:
	`g‘_¬gum’t
("nick")

149 
nÙ
 
£lf
.
İtiÚs
.
ch©room
:
	$add
(
nick
è
th’


150 
£lf
:
	`wr™e
({
ok
 = 
çl£
})

152 
’d


153 
£lf
:
£t_£cu»_cook›
("nick", 
nick
)

154 
	g£lf
:
wr™e
({
ok
 = 
Œue
})

155 
’d


158 
loÿl
 
funùiÚ
 
	$maš
()

159 
loÿl
 
ch©room
 = 
	$Ch©Room
()

160 
loÿl
 
­p
 = 
turbo
.
web
.
	`AµliÿtiÚ
(

162 {"^/ch©com$", 
Ch©Com
, {
ch©room
 = chatroom}},

163 {"^/signš$", 
SignInHªdËr
, {
ch©room
 = chatroom}},

164 {"^/$", 
turbo
.
web
.
SticFeHªdËr
, "assets/index.html"},

165 {"^/as£ts/(.*)$", 
turbo
.
web
.
SticFeHªdËr
, "assets/"}

166 
	}
},

168 
	gcook›_£ü‘
 = "akofdkapokfposakfdsafasdÃ¥pfkadÃ¥pf"

171 
	g­p
:
	$li¡’
(8888)

172 
turbo
.
iŞoİ
.
	$š¡ªû
():
	$¡¬t
()

173 
’d


175 
	`maš
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/chunked.lua

1 --- 
	gTurbo
.
lua
 
SŒ—mšg
 
wr™e
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
ChunkedHªdËr
 = 
şass
("ChunkedHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
funùiÚ
 
	gChunkedHªdËr
:
	$g‘
()

22 
£lf
:
	$£t_chunked_wr™e
()

23 
£lf
:
	`wr™e
("Hello world! ")

24 
£lf
:
	`wr™e
("Another world is coming soon. ")

25 
£lf
:
	`æush
(è-- 
At
 
this
 
pošt
 
the
 
Reque¡HªdËr
 
bufãr
 
is
 
æushed
.

26 
£lf
:
	`wr™e
("H–lØM¬s!"è-- 
Refl
 
bufãr
.

27 -- 
Flush
 
agaš
.

28 -- 
Each
 
æush
 
wl
 
’d
 
up
 
as
 
Úe
 
chunk
 
š
 
the
 
IOSŒ—m
.

29 
£lf
:
	$æush
()

30 
£lf
:
	$fšish
()

31 
’d


33 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
ChunkedHªdËr
}
	}
}):
	$li¡’
(8888)

34 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/cookie.lua

1 --- 
	gTurbo
.
lua
 
Cook›
 
u§ge
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
Cook›HªdËr
 = 
şass
("Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
funùiÚ
 
	gCook›HªdËr
:
	$g‘
()

22 
loÿl
 
couÁ”
 = 
£lf
:
	`g‘_cook›
("counter")

23 
loÿl
 
Ãw_couÁ
 = 
couÁ”
 
ªd
 
	`tÚumb”
(couÁ”è+ 1 
Ü
 0

24 
£lf
:
	`£t_cook›
("couÁ”", 
Ãw_couÁ
)

25 
£lf
:
	`wr™e
("Cook› couÁ” i ©: " .. 
Ãw_couÁ
)

26 
’d


28 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Cook›HªdËr
}
	}
}):
	$li¡’
(8888)

29 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/curl.lua

1 --- 
	gTurbo
.
lua
 
Sim¶e
 
Cu¾
 
şÚe
 
usšg
 
	gHTTPCl›Á
.

2 -- 
A
 
»®ly
 
sim¶e
 
	gÚe
...

4 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


6 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

7 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

8 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


10 -- 
	gh‰p
:

12 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


13 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

14 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

15 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


16 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
	g_G
.
	gTURBO_SSL
 = 
Œue
 -- 
EÇbË
 
SSL


19 
loÿl
 
turbo
 = 
»quœe
 "turbo"

20 
turbo
.
log
.
ÿ‹gÜ›s
.
sucûss
 = 
çl£


22 
loÿl
 
u¾
 = 
¬g
[1] -- 
Fœ¡
‡rg 
should
 
be
 
URL
.

24 
loÿl
 
tio
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

26 
tio
:
	`add_ÿÎback
(
	`funùiÚ
()

27 -- 
Mu¡
 
¶aû
 
ev”ythšg
 
š
 
a
 
IOLoİ
 
ÿÎback
.

28 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(

29 
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(
u¾
,

30 {
®low_»dœeùs
=
Œue
, 
cÚÃù_timeout
=5
	}
}))

31 
	g»s
.
”rÜ
 
Ü
„es.
	gh—d”s
:
g‘_¡©us_code
(è~ğ200 
th’


32 -- 
Check
 
”rÜs
.

33 
´št
("Could‚Ù g‘ URL:", 
»s
.
”rÜ
.
mes§ge
)

35 -- 
Pršt
 
»suÉ
 
to
 
	g¡dout
.

36 
	gio
.
	$wr™e
(
»s
.
body
)

37 
’d


38 
tio
:
	$şo£
()

39 
’d
)

41 
tio
:
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/githubfeed.lua

1 --- 
	gTurbo
.
lua
 
G™hub
 
	gF“d


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 -- 
This
 
im¶em’tiÚ
 
u£s
 
the
 
G™hub
 
REST
 
API
 
to
 
puÎ
 
cu¼’t
 
amouÁ
 
	gof


18 -- 
w©ch”s
 
the
 
	gTurbo
.
lua
 
	g»pos™Üy
.

20 
	gTURBO_SSL
 = 
Œue
 -- 
EÇbË
 
SSL
 
as
 
G™hub
 
API
 
»quœes
 
HTTPS
.

21 
loÿl
 
turbo
 = 
»quœe
 "turbo"

22 
loÿl
 
y›ld
 = 
cÜoutše
.yield

24 
loÿl
 
G™hubF“d
 = 
şass
("G™hubF“d", 
turbo
.
web
.
Reque¡HªdËr
)

26 
funùiÚ
 
	gG™hubF“d
:
	$g‘
(
£¬ch
)

27 
loÿl
 
»s
 = 
	`y›ld
(

28 
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
("https://api.github.com/repos/kernelsauce/turbo"))

30 
»s
.
”rÜ
 
Ü
„es.
h—d”s
:
	`g‘_¡©us_code
(è~ğ200 
th’


31 -- 
Check
 
”rÜs
.

32 -- 
If
 
d©a
 
could
 
nÙ
 
be
 
ãtched
 
a
 500 
”rÜ
 
is
 
£Á
 
as
 
»¥Ú£
.

33 
	`”rÜ
(
turbo
.
web
.
HTTPE¼Ü
:
	$Ãw
(500, 
»s
.
”rÜ
.
mes§ge
))

34 
’d


36 
loÿl
 
jsÚ
 = 
turbo
.
esÿ³
.
	`jsÚ_decode
(
»s
.
body
)

37 -- 
Ugly
 
šlššg
 
of
 
HTML
 
code
. 
You
 
g‘
 
the
 
pošt
!

38 
£lf
:
	`wr™e
([[<
html
><
h—d
></h—d><
body
>]])

39 
£lf
:
	`wr™e
(
¡ršg
.
	`fÜm©
(

41 <
h1
>
Turbo
.
lua
 
G™hub
 
ãed
<h1>

42 <
p
>
Cu¼’t
 
w©ch”s
 %
d
</p>

44 
jsÚ
.
w©ch”s_couÁ


46 
£lf
:
	`wr™e
([[</
body
></
html
>]])

47 
’d


49 
loÿl
 
­¶iÿtiÚ
 = 
turbo
.
web
.
AµliÿtiÚ
:
	`Ãw
({

50 {"^/$", 
G™hubF“d
}

51 
	}
})

53 
­¶iÿtiÚ
:
	$li¡’
(8888)

54 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/helloworld.lua

1 --- 
	gTurbo
.
lua
 
H–lo
 
wÜld
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
Exam¶eHªdËr
 = 
şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
funùiÚ
 
	gExam¶eHªdËr
:
	$g‘
()

22 
£lf
:
	`wr™e
("Hello World!")

23 
’d


25 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
	$li¡’
(8888)

26 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/helloworld6.lua

1 --- 
	gTurbo
.
lua
 
H–lo
 
wÜld
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
Exam¶eHªdËr
 = 
şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
funùiÚ
 
	gExam¶eHªdËr
:
	$g‘
()

22 
£lf
:
	`wr™e
("Hello world!")

23 
’d


25 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
li¡’
(8888, "::1")

26 
	gturbo
.
	giŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/httpserver.lua

1 --- 
	gTurbo
.
lua
 
H–lo
 
wÜld
 
usšg
 
	gHTTPS”v”


3 -- 
Usšg
 
the
 
HTTPS”v”
 
ofãrs
 
mÜe
 
cÚŒŞ
 th
	gu£r
, 
but
 
Ëss
 
	gcÚv’›nû
.

4 -- 
In
 
®mo¡
 
®l
 
ÿ£s
 
you
 
wªt
 
to
 
u£
 
	gturbo
.
	gweb
.
	gReque¡HªdËr
.

6 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


8 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

9 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

10 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


12 -- 
	gh‰p
:

14 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


15 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

16 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

17 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


18 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

20 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

22 
loÿl
 
mes§ge
 = "Hello World!"

23 
loÿl
 
h—d”
 = 
turbo
.
h‰put
.
	$HTTPH—d”s
()

24 
h—d”
:
	`add
("CÚ‹Á-L’gth", 
	`to¡ršg
(
mes§ge
:
	$Ën
()))

25 
h—d”
:
	`add
("Connection", "Keep-Alive")

26 
h—d”
:
	$£t_¡©us_code
(200)

27 
h—d”
:
	`£t_v”siÚ
("HTTP/1.1")

29 
loÿl
 
hdr_msg
 = 
h—d”
:
	$¡ršgify_as_»¥Ú£
()

30 
loÿl
 
buf
 = 
hdr_msg
 .. "\r\n" .. 
mes§ge


32 
loÿl
 
funùiÚ
 
	`hªdË_»que¡
(
»que¡
)

33 -- 
This
 
is
 
the
 
ÿÎback
 
funùiÚ
 
HTTPS”v”
.

34 -- 
It
 
wl
 
be
 
ÿÎed
 
w™h
 
a
 
HTTPReque¡
 
şass
 
š¡ªû
 
ev”y
 
»que¡


35 -- 
issued
 
to
 
the
 
£rv”
.

36 
»que¡
:
	$wr™e
(
buf
)

37 
»que¡
:
	$fšish
()

38 
’d


40 -- 
Assign
 
ÿÎback
 
wh’
 
ü—tšg
 
HTTPS”v”
.

41 
loÿl
 
h‰p_£rv”
 = 
turbo
.
h‰p£rv”
.
	$HTTPS”v”
(
hªdË_»que¡
)

42 
h‰p_£rv”
:
	$li¡’
(8888)

43 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/iosimple.lua

1 --- 
	gTurbo
.
lua
 
Sim¶if›d
 
IO
 
	gexam¶e


3 -- 
	gCİyright
 2016 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`add_ÿÎback
(
	$funùiÚ
()

20 
loÿl
 
¡»am
 = 
turbo
.
iosim¶e
.
	`dŸl
("tcp://turbolua.org:80")

21 
¡»am
:
	`wr™e
("GET / HTTP/1.0\r\n\r\n")

23 
loÿl
 
d©a
 = 
¡»am
:
	$»ad_uÁ_şo£
()

24 
	$´št
(
d©a
)

26 
turbo
.
iŞoİ
.
	$š¡ªû
():
	$şo£
()

27 
’d
):
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/json.lua

1 --- 
	gTurbo
.
lua
 
JSON
 
ouut
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
MyJSONHªdËr
 = 
şass
("MyJSONHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

20 
funùiÚ
 
	gMyJSONHªdËr
:
	$g‘
()

21 
£lf
:
	`wr™e
({ "Úe", "two", "th»e", "—sy", "jsÚ" 
	}
})

22 
’d


24 
	gturbo
.
	gweb
.
	gAµliÿtiÚ
:
Ãw
({

25 {"^/jsÚ$", 
MyJSONHªdËr
}

26 }):
	$li¡’
(8888)

28 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/keepalive.lua

1 --- 
	gTurbo
.
lua
 
	gHTTPCl›Á
.

2 -- 
A
 
»®ly
 
sim¶e
 
	gÚe
...

4 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


6 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

7 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

8 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


10 -- 
	gh‰p
:

12 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


13 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

14 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

15 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


16 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
	g_G
.
	gTURBO_SSL
 = 
Œue
 -- 
EÇbË
 
SSL


19 
loÿl
 
turbo
 = 
»quœe
 "turbo"

21 
loÿl
 
tio
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

23 
tio
:
	`add_ÿÎback
(
	$funùiÚ
()

24 
loÿl
 
şi
 = 
turbo
.
async
.
	$HTTPCl›Á
()

25 
i
=1, 10, 1 do

26 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(

27 
şi
:
	`ãtch
("h‰p://www.vg.no", {
®low_»dœeùs
=
Œue
, 
k“p_®ive
 = 
	}
true}))

28 
	g»s
.
”rÜ
 
Ü
„es.
	gh—d”s
:
g‘_¡©us_code
(è~ğ200 
th’


29 -- 
Check
 
”rÜs
.

30 
tio
:
	$şo£
()

33 -- 
HªdË
 
body
 :)

34 
’d


35 
’d


36 
tio
:
	$şo£
()

37 
’d
)

38 
tio
:
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/mustache.lua

1 --- 
	gTurbo
.
lua
 
Mu¡ache
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
Mu¡acheHªdËr
 = 
şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
funùiÚ
 
	gMu¡acheHªdËr
:
	$g‘
()

22 
£lf
:
	`wr™e
(
turbo
.
web
.
Mu¡ache
.
	`»nd”
Ñurbo.web.Mu¡ache.
	`compe
([[

23 
Logš
={{
logš
}
	}
}

25 
Name
: {{
™em
}} 
logš
={{login}}

26 {{/
™ems
}}

27 ]]), {
	glogš
="u£r", 
	g™ems
={{
™em
="Úe"}, {
	g™em
="two"}}})

29 
’d


31 
	gturbo
.
	gweb
.
AµliÿtiÚ
({{"^/$", 
Mu¡acheHªdËr
}}):
	$li¡’
(8888)

32 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/parameters.lua

1 --- 
	gTurbo
.
lua
 
P¬am‘”s
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
Num”icHªdËr
 = 
şass
("Num”icHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
funùiÚ
 
	gNum”icHªdËr
:
g‘
(
num
)

22 -- 
This
 
hªdËr
 
kes
 
Úe
 
·¿m‘”
 
äom
 
the
 
AµliÿtiÚ
 
şass
.

23 -- 
The
 
¬gum’t
 
mu¡
 
cÚsi¡s
 
of
 
¬b™¿ry
 
Ëngth
 oà
dig™s
.

24 
£lf
:
wr™e
("Num”iø»sourû is: " .. 
num
)

25 
’d


28 
loÿl
 
Argum’tsHªdËr
 = 
şass
("Argum’tsHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

30 
funùiÚ
 
	gArgum’tsHªdËr
:
g‘
()

31 -- 
This
 
hªdËr
 
kes
 
Úe
 
GET
 
¬gum’t
.

32 
£lf
:
wr™e
("Argum’ˆis: " .. s–f:
g‘_¬gum’t
("query"))

33 
’d


35 
funùiÚ
 
Argum’tsHªdËr
:
po¡
()

36 -- 
This
 
hªdËr
 
kes
 
Úe
 
POST
 
¬gum’t
.

37 
£lf
:
wr™e
("Argum’ˆis: " .. s–f:
g‘_¬gum’t
("query"))

38 
’d


40 
turbo
.
web
.
AµliÿtiÚ
({

41 {"^/num/(%d*)$", 
Num”icHªdËr
},

42 {"^/¬gum’t$", 
Argum’tsHªdËr
}

43 }):
	$li¡’
(8888)

44 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/parrot.lua

1 --- 
	gTurbo
.
	glua
 "Th·¼Ù". 
R•—ts
 
ev”ythšg
 
™
 
is
 
	gtŞd
.

3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
P¬rÙ
 = 
şass
("P¬rÙ", 
turbo
.
tı£rv”
.
TCPS”v”
)

21 
funùiÚ
 
	gP¬rÙ
:
	$hªdË_¡»am
(
¡»am
, 
addr
)

22 
¡»am
:
	`»ad_uÁ_şo£
(

23 
	$funùiÚ
()

24 
	`´št
("Socket closed!")

25 
’d
, 
n
,

26 
	`funùiÚ
(
d©a
)

27 -- 
SŒ—mšg
 
ÿÎback


28 
¡»am
:
	$wr™e
(
d©a
)

29 
’d
)

30 
’d


32 
	$P¬rÙ
():
	$li¡’
(8888)

34 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/securecookie.lua

1 --- 
	gTurbo
.
lua
 
Secu»
 
Cook›
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	gTURBO_SSL
 = 
Œue


18 
loÿl
 
turbo
 = 
»quœe
 "turbo"

20 
loÿl
 
Cook›HªdËr
 = 
şass
("Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

22 
funùiÚ
 
	gCook›HªdËr
:
	$g‘
()

23 
loÿl
 
couÁ”
 = 
£lf
:
	`g‘_£cu»_cook›
("counter")

24 
loÿl
 
Ãw_couÁ
 = 
couÁ”
 
ªd
 
	`tÚumb”
(couÁ”è+ 1 
Ü
 0

25 
£lf
:
	`£t_£cu»_cook›
("id", "supersecretrandomid!")

26 
£lf
:
	`wr™e
("Cook› couÁ” i ©: " .. 
Ãw_couÁ
)

27 
£lf
:
	`£t_£cu»_cook›
("couÁ”", 
Ãw_couÁ
)

28 
’d


30 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Cook›HªdËr
}
	}
}, {

31 
	gcook›_£ü‘
 = "kasoidkfsadfsai12#Â¤1234123'Ã¥421Ã¥4l1Ã¥plÃ¥pk<ok<lkcmlk<cxp"

32 }):
	$li¡’
(8888)

33 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/signalfd.lua

1 --- 
	gTurbo
.
lua
 
sigÇlfd
 
	gexam¶e


3 -- 
	gCİyright
 2014 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
loÿl
 
	gturbo
 = 
»quœe
("turbo")

19 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

21 
	`´št
("Press CTRL-C 3imesoƒxit")

23 
io
:
	`add_ÿÎback
(
	$funùiÚ
 ()

24 
loÿl
 
times
 = 0

25 
io
:
	`add_sigÇl_hªdËr
(
turbo
.
sigÇl
.
SIGINT
, 
	$funùiÚ
 (
signum
, 
šfo
)

26 
	`´št
(
¡ršg
.
	`fÜm©
("\nReûived sigÇÈSIGINT (%d)", 
signum
))

27 
times
 =imes + 1

28 
times
 =ğ3 
th’


29 
io
:
	$şo£
()

30 
’d


31 
’d
)

32 
’d
)

33 
io
:
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/sslserver.lua

1 --- 
	gTurbo
.
lua
 
SSL
 
HTTP
 
£rv”
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	gTURBO_SSL
 = 
Œue
 -- 
Always
 
£t
 
me
 
wh’
 
usšg
 
SSL
, 
befÜe
 
lßdšg
 
	gäamewÜk
.

18 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

20 
loÿl
 
SSL_HªdËr
 = 
şass
("SSL_HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
funùiÚ
 
	gSSL_HªdËr
:
	$g‘
()

22 
£lf
:
	`wr™e
("SSL is working!")

23 
’d


25 
loÿl
 
­¶iÿtiÚ
 = 
turbo
.
web
.
AµliÿtiÚ
:
	`Ãw
({

26 {"^/$", 
SSL_HªdËr
}

27 
	}
})

29 
­¶iÿtiÚ
:
li¡’
(8888, 
n
, {

30 
s¦_İtiÚs
 = {

31 
key_fe
 = "./sslkeys/server.key",

32 
û¹_fe
 = "./sslkeys/server.crt"

35 
	gturbo
.
	giŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/static.lua

1 --- 
	gTurbo
.
lua
 
Stic
 
fe
 
£rv”
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g_G
.
	gTURBO_SSL
 = 
Œue


18 
loÿl
 
turbo
 = 
»quœe
 "turbo"

20 
loÿl
 
­p
 = 
turbo
.
web
.
AµliÿtiÚ
:
Ãw
({

21 -- 
S”ve
 
sšgË
 
šdex
.
html
 
fe
 
Ú
 
roÙ
 
»que¡s
.

22 {"^/$", 
turbo
.
web
.
SticFeHªdËr
, "/var/www/index.html"},

23 -- 
S”ve
 
cÚ‹Ás
 
of
 
dœeùÜy
.

24 {"^/(.*)$", 
turbo
.
web
.
SticFeHªdËr
, "/var/www/"}

27 
loÿl
 
¤v
 = 
turbo
.
h‰p£rv”
.
	$HTTPS”v”
(
­p
)

28 
¤v
:
	$bšd
(8888)

29 
¤v
:
	`¡¬t
(1è-- 
Adju¡
 
amouÁ
 
of
 
´oûs£s
 
to
 
fÜk
.

31 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/tablehandler.lua

1 --- 
	gTurbo
.
lua
 
TabË
 
HªdËr
 
	gexam¶e
.

3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
loÿl
 
Exam¶eHªdËr
 = 
şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

21 
	gExam¶eHªdËr
.
	gg‘
 = {

22 
´e
 = {
funùiÚ
(
£lf
)

23 
£lf
:
£t_h—d”
("Server", "Special‡wesomeness V1")

24 
£lf
.
£ssiÚ
 = s–f:
g‘_cook›
("ritz")

25 
nÙ
 
£lf
.
£ssiÚ
 
th’


26 
£lf
.
cook›
 = 
turbo
.
ut
.
¿nd_¡r
(10)

27 
£lf
:
£t_cook›
("r™z", s–f.
cook›
)

28 
’d


29 
	g’d
, 
funùiÚ
(
£lf
)

30 
	gturbo
.
	glog
.
sucûss
("Someone is using my site!")

31 
	g’d
},

32 
	gmaš
 = 
funùiÚ
(
£lf
)

33 
£lf
:
wr™e
(

34 
¡ršg
.
fÜm©
("H–lØYou. You¸uniquID i %s. ", 
£lf
.
£ssiÚ
))

35 
	g’d
,

36 
	gpo¡
 = {
funùiÚ
(
£lf
)

37 
£lf
:
wr™e
("Goodbye")

38 
’d
}

41 
turbo
.
web
.
AµliÿtiÚ
({

42 {"^/$", 
Exam¶eHªdËr
},

43 }):
	$li¡’
(8888)

44 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/thread.lua

1 --- 
	gTurbo
.
lua
 
Exam¶e
 
	gmoduË


3 -- 
	gCİyright
 2016 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

20 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`add_ÿÎback
(
	$funùiÚ
()

22 
loÿl
 
th»ad
 = 
turbo
.th»ad.
	`Th»ad
(
	$funùiÚ
(
th
)

23 
th
:
	`£nd
("Hello World.")

24 
th
:
	$¡İ
()

25 
’d
)

27 
	`´št
(
th»ad
:
	$wa™_fÜ_d©a
())

28 
th»ad
:
	$wa™_fÜ_fšish
()

29 
turbo
.
iŞoİ
.
	$š¡ªû
():
	$şo£
()

31 
’d
):
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/websocket.lua

1 --- 
	gTurbo
.
lua
 
H–lo
 
WebSock‘
 
	gexam¶e


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g_G
.
	gTURBO_SSL
 = 
Œue


18 
loÿl
 
turbo
 = 
»quœe
 "turbo"

20 
loÿl
 
WSExHªdËr
 = 
şass
("WSExHªdËr", 
turbo
.
websock‘
.
WebSock‘HªdËr
)

22 
funùiÚ
 
	gWSExHªdËr
:
	$Ú_mes§ge
(
msg
)

23 
£lf
:
	`wr™e_mes§ge
("Hello World.")

24 
’d


26 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/ws$", 
WSExHªdËr
}
	}
}):
	$li¡’
(8888)

27 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/websocketclient.lua

1 --- 
	gTurbo
.
lua
 
WebSock‘Cl›Á
 
	gexam¶e
.

3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g_G
.
	gTURBO_SSL
 = 
Œue
 -- 
SSL
 
mu¡
 
be
 
’abËd
 
WebSock‘
 
suµÜt
!

18 
loÿl
 
turbo
 = 
»quœe
 "turbo"

20 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`add_ÿÎback
(
	$funùiÚ
()

21 
turbo
.
websock‘
.
	`WebSock‘Cl›Á
("ws://127.0.0.1:8888/ws", {

22 
Ú_h—d”s
 = 
	`funùiÚ
(
£lf
, 
h—d”s
)

23 -- 
Rev›w
 
h—d”s
 
»ûived
 
äom
 
the
 
WebSock‘
 
£rv”
.

24 -- 
You
 
ÿn
 
e
.
g
 
drİ
 
the
 
»que¡
 th
»¥Ú£
 
h—d”s


25 -- 
¬e
 
nÙ
 
§tisçùÜy
 
w™h
 
£lf
:
	`şo£
().

26 
’d
,

27 
modify_h—d”s
 = 
	`funùiÚ
(
£lf
, 
h—d”s
)

28 -- 
Modify
 
outgošg
 
h—d”s
 
befÜe
 
they
 
¬e
 
£Á
.

29 -- 
h—d”s
 
·¿m‘”
 
¬e
 
a
 
š¡ªû
 
of
 
h‰put
.
HTTPH—d”
.

30 
’d
,

31 
Ú_cÚÃù
 = 
	`funùiÚ
(
£lf
)

32 -- 
C®Ëd
 
wh’
 
the
 
ş›Á
 
has
 
sucûssfuÎy
 
İ’ed
 
a
 
WebSock‘


33 -- 
cÚÃùiÚ
 
to
 
the
 
£rv”
.

34 -- 
Wh’
 
the
 
cÚÃùiÚ
 
is
 
e¡ablished
 
you
 
ÿn
 
wr™e
 
a
 
mes§ge
:

35 
£lf
:
	`wr™e_mes§ge
("Hello World!")

36 
’d
,

37 
Ú_mes§ge
 = 
	`funùiÚ
(
£lf
, 
msg
)

38 -- 
Pršt
 
the
 
šcomšg
 
mes§ge
.

39 
	`´št
(
msg
)

40 
£lf
:
	`şo£
()

41 
’d
,

42 
Ú_şo£
 = 
	`funùiÚ
(
£lf
)

43 -- 
I
 
am
 
ÿÎed
 
wh’
 
cÚÃùiÚ
 
is
 
şo£d
. 
BÙh
 
g¿ûfuÎy
 
ªd


44 -- 
nÙ
 
g¿ûfuÎy
.

45 
os
.
	`ex™
(0)

46 
’d
,

47 
Ú_”rÜ
 = 
	`funùiÚ
(
£lf
, 
code
, 
»asÚ
)

48 -- 
I
 
am
 
ÿÎed
 
wh’ev”
 
th”e
 
is
 
a
 
”rÜ
 
w™h
 
the
 
WebSock‘
.

49 -- 
code
 
¬e
 
defšed
 
š
 
turbo
.
websock‘
.
”rÜs
. 
»asÚ
‡re

50 -- 
a
 
¡ršg
 
»´e£Á©iÚ
 
of
 
the
 
§me
 
”rÜ
.

51 
’d


52 
	}
})

53 
	g’d
):
¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/async_spec.lua

1 -- 
Turbo
 
Un™
 
	g‹¡


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g_G
.
	gTURBO_SSL
 = 
Œue


18 
_G
.
__TURBO_USE_LUASOCKET__
 = 
os
.
g‘’v
("TURBO_USE_LUASOCKET"è
ªd
 
Œue
 
Ü
 
çl£


19 
loÿl
 
turbo
 = 
»quœe
 "turbo"

21 
desüibe
("turbo.asynøName¥aû", 
	$funùiÚ
()

22 
	`™
("async.sk", 
	$funùiÚ
()

23 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

25 
loÿl
 
funùiÚ
 
	$typiÿl_cb_func
(
num
, 
cb
, 
cb_¬g
)

26 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

27 
as£¹
.
	$equ®
(
num
, 1234)

28 
	$cb
(
cb_¬g
,1,100,200,300,800)

29 
’d
)

30 
’d


32 -- 
OÆy
 
glob®
 
š¡ªû
 
is
 
suµÜ‹d
 
this
 
cÚvš›nû
 
funùiÚ
.

33 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

34 
loÿl
 
r1
,
r2
,
r3
,
r4
,
r5
 = 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(
typiÿl_cb_func
, 1234))

35 
as£¹
.
	$equ®
(
r1
, 1)

36 
as£¹
.
	$equ®
(
r2
, 100)

37 
as£¹
.
	$equ®
(
r3
, 200)

38 
as£¹
.
	$equ®
(
r4
, 300)

39 
as£¹
.
	$equ®
(
r5
, 800)

40 
io
:
	$şo£
()

41 
’d
)

42 
io
:
	$wa™
(2)

43 
’d
)

45 
	`™
("Cook› suµÜt", 
	$funùiÚ
()

46 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

47 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

48 
loÿl
 
Exam¶eHªdËr
 = 
	`şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

49 
funùiÚ
 
Exam¶eHªdËr
:
	$g‘
()

50 
as£¹
.
	`equ®
("‹¡v®ue", 
£lf
:
	`g‘_cook›
("testcookie"))

51 
as£¹
.
	`equ®
("£cÚdv®ue", 
£lf
:
	`g‘_cook›
("testcookie2"))

52 
£lf
:
	`wr™e
("Hello World!")

53 
’d


54 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
	$li¡’
(
pÜt
)

56 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

57 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

58 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/", {

59 
cook›
 = {

60 
‹¡cook›
="testvalue",

61 
‹¡cook›2
="secondvalue"

62 }
	}
}))

63 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

64 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

65 
io
:
	$şo£
()

66 
’d
)

67 
io
:
	$wa™
(5)

68 
’d
)

70 
	`™
("HEAD„edœeù", 
	$funùiÚ
()

71 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

72 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

74 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

75 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(

76 
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
("h‰p://t.co/rKAeu0zUNV", {
m‘hod
 = "HEAD", 
®low_»dœeùs
 = 
Œue
}))

77 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

78 
	$as£¹
(
»s
.
code
 == 200)

79 
io
:
	$şo£
()

80 
’d
)

81 
io
:
	$wa™
(5)

82 
’d
)

85 
	`™
("HTTPS difã»Á s™es", 
	$funùiÚ
()

86 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

87 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

89 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

90 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(

91 
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
("h‰ps://googË.com/", {
®low_»dœeùs
=
Œue
}))

92 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

93 
	$as£¹
(
»s
.
code
 == 200)

96 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(

97 
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
("h‰ps://miüosoá.com/", {
®low_»dœeùs
=
Œue
}))

98 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

99 
	$as£¹
(
»s
.
code
 == 200)

102 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(

103 
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
("h‰ps://amazÚ.com/", {
®low_»dœeùs
=
Œue
}))

104 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

105 
	$as£¹
(
»s
.
code
 == 200)

107 
io
:
	$şo£
()

108 
’d
)

109 
io
:
	$wa™
(60)

110 
’d
)

112 
’d
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/hash_spec.lua

1 -- 
Turbo
 
Un™
 
	g‹¡


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

18 
pÿÎ
(
ffi
.
lßd
, "s¦"è
th’


19 
	g_G
.
	gTURBO_SSL
 = 
Œue


20 
loÿl
 
turbo
 = 
»quœe
 "turbo"

22 
desüibe
("turbo.hash Name¥aû", 
	$funùiÚ
()

23 
	`™
("SHA1 cÏss", 
	$funùiÚ
()

24 
loÿl
 
hash
 = 
turbo
.hash.
	`SHA1
("lol")

25 
as£¹
.
	`equ®
(
hash
:
	`hex
(), "403926033d001b5279df37cbbe5287b7c7c267fa")

26 
’d
)

27 
	`™
("wÜk w™h‚ in™Ÿliz”", 
	$funùiÚ
()

28 
loÿl
 
hash
 = 
turbo
.hash.
	$SHA1
()

29 
hash
:
	`upd©e
("lol")

30 
hash
:
	$fš®ize
()

31 
as£¹
.
	`equ®
(
hash
:
	`hex
(), "403926033d001b5279df37cbbe5287b7c7c267fa")

32 
’d
)

33 
	`™
("wÜk w™h‚ in™Ÿliz”‡nd muÉË upd©es", 
	$funùiÚ
()

34 
loÿl
 
hash
 = 
turbo
.hash.
	$SHA1
()

35 
hash
:
	`upd©e
("l")

36 
hash
:
	`upd©e
("o")

37 
hash
:
	`upd©e
("l")

38 
hash
:
	$fš®ize
()

39 
as£¹
.
	`equ®
(
hash
:
	`hex
(), "403926033d001b5279df37cbbe5287b7c7c267fa")

40 
’d
)

41 
	`™
("give ”rÜ oÀ®»ady fš®ized cÚ‹xt", 
	$funùiÚ
()

42 
loÿl
 
hash
 = 
turbo
.hash.
	`SHA1
("lol")

43 
as£¹
.
has
.
	`”rÜs
(
	$funùiÚ
(è
hash
:
	`upd©e
("Ş"è
’d
)

44 
’d
)

45 
	`™
("give ”rÜ oÀnÙ y‘ fš®ized cÚ‹xt", 
	$funùiÚ
()

46 
loÿl
 
hash
 = 
turbo
.hash.
	$SHA1
()

47 
hash
:
	`upd©e
("lol")

48 
as£¹
.
has
.
	`”rÜs
(
	$funùiÚ
(è
hash
:
	$hex
(è
’d
)

49 
’d
)

50 
’d
)

51 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/httputil_spec.lua

1 --[[ 
Turbo
 
Un™
 
‹¡


3 
Cİyright
 2013 
John
 
Ab¿ham£n


5 
Liûn£d
 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

6 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

7 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


9 
h‰p
:

11 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


12 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
ª
 "AS IS" 
BASIS
,

13 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

14 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


15 
lim™©iÚs
 
und”
 
the
 
Liûn£
. ]]

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

18 
»quœe
 "turbo.3rdparty.middleclass"

20 
desüibe
("turbo.h‰put Name¥aû", 
	$funùiÚ
()

21 
	`desüibe
("HTTPP¬£¸CÏss", 
	$funùiÚ
()

22 
loÿl
 
¿w_h—d”s
 =

33 
loÿl
 
badh—d”s
 =

44 
loÿl
 
badh—d”s2
 =

55 
	`™
("should…¬£ v®id h—d” cÜ»ùly", 
	$funùiÚ
()

56 
loÿl
 
h—d”s
 = 
turbo
.
h‰put
.
	`HTTPP¬£r
(

57 
¿w_h—d”s
,

58 
turbo
.
h‰put
.
hdr_t
["HTTP_REQUEST"])

59 
as£¹
.
	`Œuthy
(
	$š¡ªûOf
(
turbo
.
h‰put
.
HTTPP¬£r
, 
h—d”s
))

60 
’d
)

62 
	`™
("shouldhrow oÀbad h—d”s", 
	$funùiÚ
()

63 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
()

64 
loÿl
 
h—d”
 = 
turbo
.
h‰put
.
	`HTTPP¬£r
(

65 
badh—d”s
,

66 
turbo
.
h‰put
.
hdr_t
["HTTP_REQUEST"])

67 
’d
)

68 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
()

69 
loÿl
 
h—d”
 = 
turbo
.
h‰put
.
	`HTTPP¬£r
(

70 
badh—d”s2
,

71 
turbo
.
h‰put
.
hdr_t
["HTTP_REQUEST"])

72 
’d
)

73 
’d
)

75 
	`™
("should…¬£„eque¡ h—d” cÜ»ùly", 
	$funùiÚ
()

76 
loÿl
 
h—d”s
 = 
turbo
.
h‰put
.
	`HTTPP¬£r
(

77 
¿w_h—d”s
,

78 
turbo
.
h‰put
.
hdr_t
["HTTP_REQUEST"])

79 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("Host"), "somehost.no")

80 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("Connection"), "keep-alive")

81 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("Cache-Control"), "max-age=0")

82 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("User-Agent"), "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.11 (KHTML,†ike Gecko) Chrome/17.0.963.56 Safari/535.11")

83 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("Accept"), "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8")

84 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("Accept-Encoding"), "gzip,deflate,sdch")

85 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("Accept-Language"), "en-US,en;q=0.8")

86 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘
("Accept-Charset"), "ISO-8859-1,utf-8;q=0.7,*;q=0.3")

87 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘_m‘hod
(), "GET")

88 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘_u¾
(), "/test/test.gif?param1=something&param2=somethingelse&param2=somethingelseelse")

89 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘_u¾_f›ld
(
turbo
.
h‰put
.
UF
.
PATH
), "/test/test.gif")

90 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘_v”siÚ
(), "HTTP/1.1")

91 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘_¬gum’t
("param1")[1], "something")

92 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘_¬gum’t
("param2")[1], "somethingelse")

93 
as£¹
.
	`equ®
(
h—d”s
:
	`g‘_¬gum’t
("param2")[2], "somethingelseelse")

94 
as£¹
.
	`equ®
(
	`ty³
(
h—d”s
:
	`g‘_¬gum’ts
()), "table")

95 
’d
)

97 
	`™
("should…¬£ URL cÜ»ùly", 
	$funùiÚ
()

98 
loÿl
 
h—d”
 = 
turbo
.
h‰put
.
	$HTTPP¬£r
()

99 
h—d”
:
	`·r£_u¾
("https://www.somedomain.org:8888/test/me.html?andmyparams#fragment")

100 
as£¹
.
	`equ®
(
h—d”
:
	`g‘_u¾_f›ld
(
turbo
.
h‰put
.
UF
.
PATH
), "/test/me.html")

101 
as£¹
.
	`equ®
(
h—d”
:
	`g‘_u¾_f›ld
(
turbo
.
h‰put
.
UF
.
SCHEMA
), "https")

102 
as£¹
.
	`equ®
(
h—d”
:
	`g‘_u¾_f›ld
(
turbo
.
h‰put
.
UF
.
HOST
), "www.somedomain.org")

103 
as£¹
.
	`equ®
(
h—d”
:
	`g‘_u¾_f›ld
(
turbo
.
h‰put
.
UF
.
PORT
), "8888")

104 
as£¹
.
	`equ®
(
h—d”
:
	`g‘_u¾_f›ld
(
turbo
.
h‰put
.
UF
.
QUERY
), "andmyparams")

105 
as£¹
.
	`equ®
(
h—d”
:
	`g‘_u¾_f›ld
(
turbo
.
h‰put
.
UF
.
FRAGMENT
), "fragment")

106 
’d
)

108 
’d
)

110 
	`desüibe
("HTTPH—d” şass", 
	$funùiÚ
()

112 
	`™
("should‡s£mbË h—d” cÜ»ùly", 
	$funùiÚ
()

113 
loÿl
 
h—d”s
 = 
turbo
.
h‰put
.
HTTPH—d”s
:
	$Ãw
()

114 
as£¹
.
	`Œuthy
(
	$š¡ªûOf
(
turbo
.
h‰put
.
HTTPH—d”s
, 
h—d”s
))

115 
h—d”s
:
	$£t_¡©us_code
(304)

116 
h—d”s
:
	`£t_v”siÚ
("HTTP/1.1")

117 
h—d”s
:
	`add
("Date", "Wed, 08 May 2013 15:00:22 GMT")

118 
h—d”s
:
	`add
("Server", "Turbo/1.0")

119 
h—d”s
:
	`add
("Accept-Ranges", "bytes")

120 
h—d”s
:
	`add
("Connection", "keep-alive")

121 
h—d”s
:
	`add
("Age", "0")

122 
loÿl
 
ex³ùed
 = "HTTP/1.1 304 Not Modified\r\nDate: Wed, 08 May 2013 15:00:22 GMT\r\nServer: Turbo/1.0\r\nAccept-Ranges: bytes\r\nConnection: keep-alive\r\nAge: 0\r\n"

123 
as£¹
.
	`equ®
(
h—d”s
:
	`__to¡ršg
(), 
ex³ùed
)

124 
as£¹
.
	`equ®
(
h—d”s
:
	$__to¡ršg
():
	`Ën
(), 137)

125 
’d
)

127 
	`™
("should‡Îow s‘tšg ªd g‘tšg oànÙabË v®ues", 
	$funùiÚ
()

128 
loÿl
 
h
 = 
turbo
.
h‰put
.
HTTPH—d”s
:
	$Ãw
()

129 
h
:
	$£t_¡©us_code
(200)

130 
as£¹
.
	`equ®
(
h
:
	`g‘_¡©us_code
(), 200)

131 
h
:
	`£t_m‘hod
("GET")

132 
as£¹
.
	`equ®
(
h
:
	`g‘_m‘hod
(), "GET")

133 
h
:
	`£t_uri
("/someplace/here")

134 
as£¹
.
	`equ®
(
h
:
	`g‘_uri
(), "/someplace/here")

135 
h
:
	`£t_v”siÚ
("HTTP/1.1")

136 
as£¹
.
	`equ®
(
h
:
	`g‘_v”siÚ
(), "HTTP/1.1")

137 
h
:
	`add
("My-Field", "Some value")

138 
as£¹
.
	`equ®
(
h
:
	`g‘
("My-Field"), "Some value")

139 
h
:
	`»move
("My-Field")

140 
as£¹
.
	`equ®
(
h
:
	`g‘
("My-F›ld"), 
n
)

141 
’d
)

143 
	`™
("should fa oÀ£‰šg oàbad v®ues", 
	$funùiÚ
()

144 
loÿl
 
h
 = 
turbo
.
h‰put
.
HTTPH—d”s
:
	$Ãw
()

145 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
(è
h
:
	`£t_¡©us_code
("FAIL"è
’d
)

146 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
(è
h
:
	$£t_m‘hod
(123è
’d
)

147 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
(è
h
:
	$£t_uri
(è
’d
)

148 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
(è
h
:
	`£t_cÚ‹Á_Ëngth
("nis£"è
’d
)

149 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
(è
h
:
	`£t_v”siÚ
({"HI"
	}
}è
’d
)

150 
as£¹
.
has_”rÜ
(
	$funùiÚ
(è
h
:
	`add
("Hacks", "AnÙh”\r\nF›ld: H”e"è
’d
)

151 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
(è
h
:
	`£t
("Hacks", "AnÙh”\r\nF›ld: H”e"è
’d
)

152 
’d
)

154 
	`™
("should…¬£ fÜmd©a", 
	$funùiÚ
()

155 
loÿl
 
d©a
 = "username=user782400&mmm=ddd&arr=1&arr=2"

156 
loÿl
 
tbl
 = 
turbo
.
h‰put
.
	$·r£_po¡_¬gum’ts
(
d©a
)

157 
as£¹
.
	`equ®
(
	`ty³
(
tbl
), "table")

158 
as£¹
.
	`equ®
(
tbl
.
u£ºame
, "user782400")

159 
as£¹
.
	`equ®
(
tbl
.
mmm
, "ddd")

160 
as£¹
.
	`equ®
(
tbl
.
¬r
[1], "1")

161 
as£¹
.
	`equ®
(
tbl
.
¬r
[2], "2")

162 
’d
)

164 
’d
)

165 
’d
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/iosimple_spec.lua

1 --- 
	gTurbo
.
lua
 
Un™
 
	g‹¡


3 -- 
	gCİyright
 2015 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 'turbo'

19 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`add_ÿÎback
(
	$funùiÚ
()

20 
loÿl
 
¡»am
 = 
turbo
.
iosim¶e
.
	`dŸl
("tcp://turbolua.org:80")

22 
¡»am
:
	`wr™e
("GET / HTTP/1.0\r\n\r\n")

23 
loÿl
 
d©a
 = 
¡»am
:
	$»ad_uÁ_şo£
()

25 
turbo
.
iŞoİ
.
	$š¡ªû
():
	$şo£
()

26 
’d
):
	`¡¬t
()

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/iostream_spec.lua

1 --- 
	gTurbo
.
lua
 
Un™
 
	g‹¡


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g_G
.
	g__TURBO_USE_LUASOCKET__
 = 
os
.
g‘’v
("TURBO_USE_LUASOCKET"è
ªd
 
Œue
 
Ü
 
çl£


18 
loÿl
 
turbo
 = 
»quœe
 'turbo'

19 
m©h
.
¿ndom£ed
(
turbo
.
ut
.
	$g‘timeofday
())

21 
	`desüibe
("turbo.io¡»am Name¥aû", 
	`funùiÚ
()

22 -- 
Mªy
 
of
 
the
 
‹¡s
 
»ly
 
Ú
h
çù
 
th©
h
TCPS”v”
 
şass


23 -- 
funùiÚs
 
as
 
ex³ùed
...

25 
	`desüibe
("IOSŒ—m/SSLIOSŒ—m cÏs£s", 
	$funùiÚ
()

27 
	`befÜe_—ch
(
	`funùiÚ
()

28 -- 
Make
 
su»
 
we
 
¡¬t
 
w™h
 
a
 
äesh
 
glob®
 
IOLoİ
 
to


29 -- 
avoid
 
¿ndom
 
»suÉs
.

30 
_G
.
io_loİ_š¡ªû
 = 
n


31 
’d
)

33 
	`™
("IOSŒ—m:cÚÃù,†oÿlho¡", 
	$funùiÚ
()

34 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$IOLoİ
()

35 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

36 
loÿl
 
cÚÃùed
 = 
çl£


37 
loÿl
 
çed
 = 
çl£


39 -- 
S”v”


40 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

41 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

42 
¡»am
:
	$şo£
()

43 
’d


44 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

45 
¤v
:
	$li¡’
(
pÜt
)

47 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

48 -- 
Cl›Á


49 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

50 
turbo
.
sock‘
.
SOCK_STREAM
,

52 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

53 
¡»am
:
	`cÚÃù
("127.0.0.1",

54 
pÜt
,

55 
turbo
.
sock‘
.
AF_INET
,

56 
	$funùiÚ
()

57 
cÚÃùed
 = 
Œue


58 
¡»am
:
	$şo£
()

59 
io
:
	$şo£
()

60 
’d
,

61 
	$funùiÚ
(
”r
)

62 
çed
 = 
Œue


63 
	`”rÜ
("Could‚ot connect.")

64 
’d
)

65 
’d
)

66 
io
:
	$wa™
(2)

67 
¤v
:
	$¡İ
()

68 
as£¹
.
	$Œuthy
(
cÚÃùed
)

69 
as£¹
.
	$çlsy
(
çed
)

70 
’d
)

72 
	`™
("IOSŒ—m:»ad_by‹s", 
	$funùiÚ
()

73 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

74 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

75 
loÿl
 
cÚÃùed
 = 
çl£


76 
loÿl
 
d©a
 = 
çl£


77 
loÿl
 
by‹s
 = 
turbo
.
¡ruùs
.
	$bufãr
()

78 
i
 = 1, 1024*1024 do

79 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

80 
’d


81 
by‹s
 = 
	`to¡ršg
(bytes)

83 -- 
S”v”


84 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

85 
loÿl
 
¤v


86 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

87 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

88 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(
¡»am
.
wr™e
, sŒ—m, 
by‹s
))

89 
¡»am
:
	$şo£
()

90 
¤v
:
	$¡İ
()

91 
’d
)

92 
’d


93 
¤v
 = 
	$S”v”
(
io
)

94 
¤v
:
	$li¡’
(
pÜt
)

97 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

98 -- 
Cl›Á


99 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

100 
turbo
.
sock‘
.
SOCK_STREAM
,

102 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

103 
¡»am
:
	`cÚÃù
("127.0.0.1",

104 
pÜt
,

105 
turbo
.
sock‘
.
AF_INET
,

106 
	$funùiÚ
()

107 
cÚÃùed
 = 
Œue


108 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(

109 
¡»am
.
»ad_by‹s
,stream,1024*1024))

110 
d©a
 = 
Œue


111 
as£¹
.
	$equ®
(
»s
, 
by‹s
)

112 
¡»am
:
	$şo£
()

113 
io
:
	$şo£
()

114 
’d
,

115 
	$funùiÚ
(
”r
)

116 
çed
 = 
Œue


117 
io
:
	$şo£
()

118 
	`”rÜ
("Could‚ot connect.")

119 
’d
)

120 
’d
)

121 
io
:
	$wa™
(2)

122 
¤v
:
	$¡İ
()

123 
as£¹
.
	$Œuthy
(
cÚÃùed
)

124 
as£¹
.
	$Œuthy
(
d©a
)

125 
’d
)

127 
	`™
("IOSŒ—m:»ad_uÁ", 
	$funùiÚ
()

128 
loÿl
 
d–im
 = "CRLF GALLORE\r\n\r\n\r\n\r\n\r"

129 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

130 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

131 
loÿl
 
cÚÃùed
, 
çed
 = 
çl£
, false

132 
loÿl
 
d©a
 = 
çl£


133 
loÿl
 
by‹s
 = 
turbo
.
¡ruùs
.
	$bufãr
()

135 
i
 = 1, 1024*1024 do

136 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

137 
’d


138 
by‹s
:
	$­³nd_lua¡r_right
(
d–im
)

139 
loÿl
 
by‹s2
 = 
	`to¡ršg
(
by‹s
è-- 
U£d
 
to
 
m©ch
 
cÜ»ù
 
d–im™”
 
cut
.

140 
i
 = 1, 1024*1024 do

141 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

142 
’d


143 
by‹s
 = 
	`to¡ršg
(bytes)

145 -- 
S”v”


146 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

147 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

148 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

149 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(
¡»am
.
wr™e
, sŒ—m, 
by‹s
))

150 
¡»am
:
	$şo£
()

151 
’d
)

152 
’d


153 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

154 
¤v
:
	$li¡’
(
pÜt
)

156 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

157 -- 
Cl›Á


158 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

159 
turbo
.
sock‘
.
SOCK_STREAM
,

161 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

162 
as£¹
.
	`equ®
(
¡»am
:
	`cÚÃù
("127.0.0.1",

163 
pÜt
,

164 
turbo
.
sock‘
.
AF_INET
,

165 
	$funùiÚ
()

166 
cÚÃùed
 = 
Œue


167 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(

168 
¡»am
.
»ad_uÁ
,¡»am,
d–im
))

169 
d©a
 = 
Œue


170 
as£¹
.
	$Œuthy
(
»s
 =ğ
by‹s2
)

171 
¡»am
:
	$şo£
()

172 
io
:
	$şo£
()

173 
’d
,

174 
	$funùiÚ
(
”r
)

175 
çed
 = 
Œue


176 
io
:
	$şo£
()

177 
	`”rÜ
("Could‚ot connect.")

178 
’d
), 0)

179 
’d
)

181 
io
:
	$wa™
(30)

182 
¤v
:
	$¡İ
()

183 
as£¹
.
	$çlsy
(
çed
)

184 
as£¹
.
	$Œuthy
(
cÚÃùed
)

185 
as£¹
.
	$Œuthy
(
d©a
)

186 
’d
)

188 
	`™
("IOSŒ—m:»ad_uÁ_·‰”n", 
	$funùiÚ
()

189 
loÿl
 
d–im
 = "CRLF GALLORE\r\n\r\n\r\n\r\n\r"

190 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

191 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

192 
loÿl
 
cÚÃùed
, 
çed
 = 
çl£
, false

193 
loÿl
 
d©a
 = 
çl£


194 
loÿl
 
by‹s
 = 
turbo
.
¡ruùs
.
	$bufãr
()

196 
i
 = 1, 1024*1024 do

197 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

198 
’d


199 
by‹s
:
	$­³nd_lua¡r_right
(
d–im
)

200 
loÿl
 
by‹s2
 = 
	`to¡ršg
(
by‹s
è-- 
U£d
 
to
 
m©ch
 
cÜ»ù
 
d–im™”
 
cut
.

201 
i
 = 1, 1024*1024 do

202 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

203 
’d


204 
by‹s
 = 
	`to¡ršg
(bytes)

206 -- 
S”v”


207 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

208 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

209 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

210 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(
¡»am
.
wr™e
, sŒ—m, 
by‹s
))

211 
¡»am
:
	$şo£
()

212 
’d
)

213 
’d


214 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

215 
¤v
:
	$li¡’
(
pÜt
)

217 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

218 -- 
Cl›Á


219 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

220 
turbo
.
sock‘
.
SOCK_STREAM
,

222 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

223 
as£¹
.
	`equ®
(
¡»am
:
	`cÚÃù
("127.0.0.1",

224 
pÜt
,

225 
turbo
.
sock‘
.
AF_INET
,

226 
	$funùiÚ
()

227 
cÚÃùed
 = 
Œue


228 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(

229 
¡»am
.
»ad_uÁ_·‰”n
,¡»am,
d–im
))

230 
d©a
 = 
Œue


231 
as£¹
.
	$Œuthy
(
»s
 =ğ
by‹s2
)

232 
¡»am
:
	$şo£
()

233 
io
:
	$şo£
()

234 
’d
,

235 
	$funùiÚ
(
”r
)

236 
çed
 = 
Œue


237 
io
:
	$şo£
()

238 
	`”rÜ
("Could‚ot connect.")

239 
’d
), 0)

240 
’d
)

242 
io
:
	$wa™
(60)

243 
¤v
:
	$¡İ
()

244 
as£¹
.
	$çlsy
(
çed
)

245 
as£¹
.
	$Œuthy
(
cÚÃùed
)

246 
as£¹
.
	$Œuthy
(
d©a
)

247 
’d
)

249 
	`™
("IOSŒ—m:»ad_uÁ_şo£", 
	$funùiÚ
()

250 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

251 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

252 
loÿl
 
cÚÃùed
, 
çed
 = 
çl£
, false

253 
loÿl
 
d©a
 = 
çl£


254 
loÿl
 
by‹s
 = 
turbo
.
¡ruùs
.
	$bufãr
()

256 
i
 = 1, 1024*1024 do

257 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

258 
’d


259 
by‹s
 = 
	`to¡ršg
(bytes)

261 -- 
S”v”


262 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

263 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

264 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

265 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(
¡»am
.
wr™e
, sŒ—m, 
by‹s
))

266 
¡»am
:
	$şo£
()

267 
’d
)

268 
’d


269 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

270 
¤v
:
	$li¡’
(
pÜt
)

272 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

273 -- 
Cl›Á


274 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

275 
turbo
.
sock‘
.
SOCK_STREAM
,

277 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

278 
as£¹
.
	`equ®
(
¡»am
:
	`cÚÃù
("127.0.0.1",

279 
pÜt
,

280 
turbo
.
sock‘
.
AF_INET
,

281 
	$funùiÚ
()

282 
cÚÃùed
 = 
Œue


283 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(

284 
¡»am
.
»ad_uÁ_şo£
,stream))

285 
d©a
 = 
Œue


286 
as£¹
.
	`Œuthy
(
¡»am
:
	$şo£d
())

287 
as£¹
.
	$Œuthy
(
»s
 =ğ
by‹s
)

288 
io
:
	$şo£
()

289 
’d
,

290 
	$funùiÚ
(
”r
)

291 
çed
 = 
Œue


292 
io
:
	$şo£
()

293 
	`”rÜ
("Could‚ot connect.")

294 
’d
), 0)

295 
’d
)

297 
io
:
	$wa™
(30)

298 
¤v
:
	$¡İ
()

299 
as£¹
.
	$çlsy
(
çed
)

300 
as£¹
.
	$Œuthy
(
cÚÃùed
)

301 
as£¹
.
	$Œuthy
(
d©a
)

302 
’d
)

304 
turbo
.
¶©fÜm
.
__LINUX__
 
th’


305 
	`™
("IOSŒ—m:£t_şo£_ÿÎback", 
	$funùiÚ
()

306 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$IOLoİ
()

307 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

308 
loÿl
 
cÚÃùed
 = 
çl£


309 
loÿl
 
çed
 = 
çl£


310 
loÿl
 
şo£d
 = 
çl£


312 -- 
S”v”


313 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

314 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

315 
¡»am
:
	$şo£
()

316 
şo£d
 = 
Œue


317 
’d


318 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

319 
¤v
:
	$li¡’
(
pÜt
)

321 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

322 -- 
Cl›Á


323 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

324 
turbo
.
sock‘
.
SOCK_STREAM
,

326 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

327 
¡»am
:
	`cÚÃù
("127.0.0.1",

328 
pÜt
,

329 
turbo
.
sock‘
.
AF_INET
,

330 
	$funùiÚ
()

331 
cÚÃùed
 = 
Œue


332 
¡»am
:
	`£t_şo£_ÿÎback
(
	$funùiÚ
()

333 
as£¹
.
	$Œuthy
(
şo£d
)

334 
io
:
	$şo£
()

335 
’d
)

336 
’d
,

337 
	$funùiÚ
(
”r
)

338 
çed
 = 
Œue


339 
	`”rÜ
("Could‚ot connect.")

340 
’d
)

341 
’d
)

342 
io
:
	$wa™
(10)

343 
¤v
:
	$¡İ
()

344 
as£¹
.
	$Œuthy
(
cÚÃùed
)

345 
as£¹
.
	$çlsy
(
çed
)

346 
as£¹
.
	$Œuthy
(
şo£d
)

347 
’d
)

349 
	`™
("IOSŒ—m:şo£d", 
	$funùiÚ
()

350 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$IOLoİ
()

351 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

352 
loÿl
 
cÚÃùed
 = 
çl£


353 
loÿl
 
çed
 = 
çl£


354 
loÿl
 
şo£d
 = 
çl£


356 -- 
S”v”


357 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

358 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

359 
as£¹
.
	`çlsy
(
¡»am
:
	$şo£d
())

360 
¡»am
:
	$şo£
()

361 
şo£d
 = 
Œue


362 
’d


363 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

364 
¤v
:
	`li¡’
(
pÜt
, "127.0.0.1")

366 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

367 -- 
Cl›Á


368 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

369 
turbo
.
sock‘
.
SOCK_STREAM
,

371 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

372 
¡»am
:
	`cÚÃù
("127.0.0.1",

373 
pÜt
,

374 
turbo
.
sock‘
.
AF_INET
,

375 
	$funùiÚ
()

376 
cÚÃùed
 = 
Œue


377 
as£¹
.
	`çlsy
(
¡»am
:
	$şo£d
())

378 
¡»am
:
	`£t_şo£_ÿÎback
(
	$funùiÚ
()

379 
as£¹
.
	`Œuthy
(
¡»am
:
	$şo£d
())

380 
as£¹
.
	$Œuthy
(
şo£d
)

381 
io
:
	$şo£
()

382 
’d
)

383 
’d
,

384 
	$funùiÚ
(
”r
)

385 
çed
 = 
Œue


386 
	`”rÜ
("Could‚ot connect.")

387 
’d
)

388 
’d
)

389 
io
:
	$wa™
(10)

390 
¤v
:
	$¡İ
()

391 
as£¹
.
	$Œuthy
(
cÚÃùed
)

392 
as£¹
.
	$çlsy
(
çed
)

393 
as£¹
.
	$Œuthy
(
şo£d
)

394 
’d
)

395 
’d


397 
	`™
("IOSŒ—m:wr™šg", 
	$funùiÚ
()

398 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

399 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

400 
loÿl
 
cÚÃùed
, 
çed
 = 
çl£
, false

401 
loÿl
 
d©a
 = 
çl£


402 
loÿl
 
by‹s
 = 
turbo
.
¡ruùs
.
	$bufãr
()

404 
i
 = 1, 1024*1024 do

405 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

406 
’d


407 
by‹s
 = 
	`to¡ršg
(bytes)

409 -- 
S”v”


410 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

411 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

412 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

413 
as£¹
.
	`çlsy
(
¡»am
:
	$wr™šg
())

414 
¡»am
:
	`wr™e
(
by‹s
, 
	$funùiÚ
()

415 
as£¹
.
	`çlsy
(
¡»am
:
	$wr™šg
())

416 
¡»am
:
	$şo£
()

417 
’d
)

418 
as£¹
.
	`Œuthy
(
¡»am
:
	$wr™šg
())

419 
’d
)

420 
’d


421 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

422 
¤v
:
	$li¡’
(
pÜt
)

424 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

425 -- 
Cl›Á


426 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

427 
turbo
.
sock‘
.
SOCK_STREAM
,

429 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

430 
as£¹
.
	`equ®
(
¡»am
:
	`cÚÃù
("127.0.0.1",

431 
pÜt
,

432 
turbo
.
sock‘
.
AF_INET
,

433 
	$funùiÚ
()

434 
cÚÃùed
 = 
Œue


435 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(

436 
¡»am
.
»ad_uÁ_şo£
,stream))

437 
d©a
 = 
Œue


438 
as£¹
.
	`Œuthy
(
¡»am
:
	$şo£d
())

439 
as£¹
.
	$Œuthy
(
»s
 =ğ
by‹s
)

440 
io
:
	$şo£
()

441 
’d
,

442 
	$funùiÚ
(
”r
)

443 
çed
 = 
Œue


444 
io
:
	$şo£
()

445 
	`”rÜ
("Could‚ot connect.")

446 
’d
), 0)

447 
’d
)

448 
’d
)

450 
	`™
("IOSŒ—m:»adšg", 
	$funùiÚ
()

451 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

452 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

453 
loÿl
 
cÚÃùed
, 
çed
 = 
çl£
, false

454 
loÿl
 
d©a
 = 
çl£


455 
loÿl
 
by‹s
 = 
turbo
.
¡ruùs
.
	$bufãr
()

457 
i
 = 1, 1024*1024 do

458 
by‹s
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

459 
’d


460 
by‹s
 = 
	`to¡ršg
(bytes)

462 -- 
S”v”


463 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

464 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

465 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

466 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(
¡»am
.
wr™e
, sŒ—m, 
by‹s
))

467 
¡»am
:
	$şo£
()

468 
’d
)

469 
’d


470 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

471 
¤v
:
	$li¡’
(
pÜt
)

473 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

474 -- 
Cl›Á


475 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

476 
turbo
.
sock‘
.
SOCK_STREAM
,

478 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

479 
as£¹
.
	`equ®
(
¡»am
:
	`cÚÃù
("127.0.0.1",

480 
pÜt
,

481 
turbo
.
sock‘
.
AF_INET
,

482 
	$funùiÚ
()

483 
cÚÃùed
 = 
Œue


484 
as£¹
.
	`çlsy
(
¡»am
:
	$»adšg
())

485 
¡»am
:
	`»ad_uÁ_şo£
(
	$funùiÚ
(
»s
)

486 
as£¹
.
	`çlsy
(
¡»am
:
	$»adšg
())

487 
d©a
 = 
Œue


488 
as£¹
.
	`Œuthy
(
¡»am
:
	$şo£d
())

489 
as£¹
.
	$Œuthy
(
»s
 =ğ
by‹s
)

490 
io
:
	$şo£
()

491 
’d
)

492 
as£¹
.
	`Œuthy
(
¡»am
:
	$»adšg
())

493 
’d
,

494 
	$funùiÚ
(
”r
)

495 
çed
 = 
Œue


496 
io
:
	$şo£
()

497 
	`”rÜ
("Could‚ot connect.")

498 
’d
), 0)

499 
’d
)

501 
io
:
	$wa™
(30)

502 
¤v
:
	$¡İ
()

503 
as£¹
.
	$çlsy
(
çed
)

504 
as£¹
.
	$Œuthy
(
cÚÃùed
)

505 
as£¹
.
	$Œuthy
(
d©a
)

506 
’d
)

508 
	`™
("IOSŒ—m sŒ—mšg c®lbacks", 
	$funùiÚ
()

509 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

510 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

511 
loÿl
 
cÚÃùed
, 
çed
 = 
çl£
, false

512 
loÿl
 
d©a
 = 
çl£


513 
loÿl
 
by‹s
 = 
turbo
.
¡ruùs
.
	$bufãr
()

514 
loÿl
 
comp
 = 
turbo
.
¡ruùs
.
	$bufãr
()

515 
loÿl
 
¡»amed
 = 0

517 -- 
S”v”


518 
loÿl
 
S”v”
 = 
	`şass
("Te¡S”v”", 
turbo
.
tı£rv”
.
TCPS”v”
)

519 
funùiÚ
 
S”v”
:
	$hªdË_¡»am
(
¡»am
)

520 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

521 
i
 = 1, 10 do

522 
loÿl
 
¿nd
 = 
turbo
.
¡ruùs
.
	$bufãr
()

523 
i
 = 1, 1024*1024 do

524 
¿nd
:
	`­³nd_lua¡r_right
(
¡ršg
.(
m©h
.
	$¿ndom
(1, 128)))

525 
’d


526 
by‹s
:
	`­³nd_right
(
¿nd
:
	$g‘
())

527 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	`sk
(
¡»am
.
wr™e
, sŒ—m, 
	$to¡ršg
(
¿nd
)))

528 
’d


529 
¡»am
:
	$şo£
()

530 
’d
)

531 
’d


532 
loÿl
 
¤v
 = 
	$S”v”
(
io
)

533 
¤v
:
	$li¡’
(
pÜt
)

535 
io
:
	`add_ÿÎback
(
	`funùiÚ
()

536 -- 
Cl›Á


537 
loÿl
 
fd
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(
turbo
.
sock‘
.
AF_INET
,

538 
turbo
.
sock‘
.
SOCK_STREAM
,

540 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
	$IOSŒ—m
(
fd
, 
io
)

541 
as£¹
.
	`equ®
(
¡»am
:
	`cÚÃù
("127.0.0.1",

542 
pÜt
,

543 
turbo
.
sock‘
.
AF_INET
,

544 
	$funùiÚ
()

545 
cÚÃùed
 = 
Œue


546 
¡»am
:
	`»ad_uÁ_şo£
(

547 
	`funùiÚ
(
»s
)

548 -- 
Wl
 
be
 
ÿÎed
 
fš®ly
.

549 
d©a
 = 
Œue


550 
comp
:
	`­³nd_lua¡r_right
(
»s
)

551 -- 
On
 
şo£
 
ÿÎback


552 
io
:
	$şo£
()

553 
’d
, 
n
,

554 
	`funùiÚ
(
»s
)

555 -- 
SŒ—mšg
 
ÿÎback


556 
comp
:
	$­³nd_lua¡r_right
(
»s
)

557 
¡»amed
 = streamed + 1

558 
’d
)

559 
’d
,

560 
	$funùiÚ
(
”r
)

561 
çed
 = 
Œue


562 
io
:
	$şo£
()

563 
	`”rÜ
("Could‚ot connect.")

564 
’d
), 0)

565 
’d
)

567 
io
:
	$wa™
(30)

568 
¤v
:
	$¡İ
()

569 
as£¹
.
	$çlsy
(
çed
)

570 
as£¹
.
	$Œuthy
(
cÚÃùed
)

571 
as£¹
.
	$Œuthy
(
d©a
)

572 
as£¹
.
	`Œuthy
(
	`to¡ršg
(
comp
è=ğ
	$to¡ršg
(
by‹s
))

573 
as£¹
.
	`Œuthy
(
¡»amed
 > 1)

574 
’d
)

576 
’d
)

577 
’d
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/mustache_spec.lua

1 --- 
	gTurbo
.
lua
 
Mu¡ache
 
	g‹¡


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
desüibe
("turbo.web.Mu¡achName¥aû", 
	$funùiÚ
()

20 
	`™
("Basiøu§ge", 
	$funùiÚ
()

22 
loÿl
 
sim¶e_‹m¶©e
 = [[

23 <
body
>

24 <
h1
>

25 {{
h—dšg
 }
	}
}

26 </
h1
>

29 
Some
 
comm’t
 
£ùiÚ
 
th©


30 
ev’
 
¥ªs
 
aüoss
 
muÉË
 
lšes
,

31 
th©
 
I
 
ju¡
 
have
 
to
 havtØ
ex¶aš
 
my
 
æawËss
 
code
.

34 <
h2
>

35 {{{
desc
}}} {{! 
No
 
esÿ³
 
w™h
 
ŒË
 
mu¡aches
 
®low
 
HTML
 
gs
! }}

36 {{&
desc
}} {{! 
No
 
esÿ³
 
ÿn
 
®so
 
be
 
accom¶ished
 
by
 & }}

37 </
h2
>

38 <
p
>
I
 
am
 {{
age
}} 
y—rs
 
Şd
. 
Wh©
 
would
 {{
you
}} 
like
 
to
 
buy
 
š
 
my
 
shİ
?</p>

39 {{ #™em }} {{! 
I
 
like
 
¥aûs
 
®Ù
! }}

40 
I‹m
: {{
™em
}}

42 {{! 
OÆy
 
´št
 
™ems
 
avaabË
.}}

43 
Ty³
 
avaabË
: {{
ty³
}}

44 {{/
ty³s
}}

45 {{^
ty³s
}} 
OÆy
 
Úe
 
ty³
 
avaabË
.

46 {{! 
Aµ¬’y
 
Úly
 
Úe
 
ty³
 
is
 
avaabË
 
beÿu£
 
ty³s
 i 
nÙ
 
£t
,

47 
d‘”mšed
 
by
 
the
 
h©
 ^}}

48 {{/
ty³s
}}

49 {{/
™ems
}}

51 {{^
™ems
}}

52 
No
 
™ems
 
avaabË
!

53 {{/
™ems
}}

54 {{{ >
disşaim”
 }}} {{!! 
I
 
like
 
·¹Ÿls
 
®Ù
 
too
. }}

56 </
body
>]]

57 -- 
We
 
basiÿÎy
 
»ly
 
Ú
 
the
 
çù
 
th©
 
compe
 
wl
 
throw
 
”rÜ


58 -- 
the
 
compšg
 
is
 
”rÜšg
 
Ú
 
v®id
 
šput
.

59 
loÿl
 
tm¶
 = 
turbo
.
web
.
Mu¡ache
.
	$compe
(
sim¶e_‹m¶©e
)

60 
loÿl
 
comped_tm¶
 = 
turbo
.
web
.
Mu¡ache
.
	`»nd”
(
tm¶
, {

61 
h—dšg
="My website!",

62 
desc
="<b>Big important website</b>",

63 
age
=27,

64 
™ems
={

65 {
™em
="Bread",

66 
ty³s
={

67 {
ty³
="light"},

68 {
ty³
="fatty"}

71 {
™em
="Milk"},

72 {
™em
="Sugar"}

74 
	}
}, {
disşaim”
=[[
Disşaim”
 {{
h—dšg
}}.]]})

75 
’d
)

77 
™
("SuµÜˆnØwh™e¥aû iÀ·¹ŸÈİ”©Ü.", 
	$funùiÚ
()

78 
as£¹
.
	`equ®
(
turbo
.
web
.
Mu¡ache
.
	`»nd”
(

80 {
h—dšg
="My webs™e"
	}
},

81 {
disşaim”
=[[
Disşaim”
 {{{
h—dšg
}}}.]]}), "Disclaimer for My website.")

82 
’d
)

84 
™
("SuµÜˆwh™e¥aû iÀ·¹ŸÈİ”©Ü.", 
	$funùiÚ
()

85 
as£¹
.
	`equ®
(
turbo
.
web
.
Mu¡ache
.
	`»nd”
(

87 {
h—dšg
="My webs™e"
	}
},

88 {
disşaim”
=[[
Disşaim”
 {{{
h—dšg
}}}.]]}), "Disclaimer for My website.")

89 
’d
)

91 
™
("SuµÜˆwh™e¥aû befÜmiddË‡nd‡á”…¬tŸÈİ”©Ü.", 
	$funùiÚ
()

92 
as£¹
.
	`equ®
(
turbo
.
web
.
Mu¡ache
.
	`»nd”
(

94 {
h—dšg
="My webs™e"
	}
},

95 {
disşaim”
=[[
Disşaim”
 {{{
h—dšg
}}}.]]}), "Disclaimer for My website.")

96 
’d
)

98 
™
("SuµÜˆwh™e¥aû befÜmiddË‡á” key o³¿tÜ.", 
	$funùiÚ
()

99 
as£¹
.
	`equ®
(
turbo
.
web
.
Mu¡ache
.
	`»nd”
(

101 {
wh™e¥aûr
="My webs™e"
	}
}), "My website")

102 
’d
)

104 
™
("SuµÜˆwh™e¥aû befÜmiddË‡á” seùiÚ o³¿tÜ.", 
	$funùiÚ
()

105 
as£¹
.
	`equ®
(
turbo
.
web
.
Mu¡ache
.
	`»nd”
(

107 {
‹¡
="My webs™e"
	}
}), "Klein")

108 
’d
)

109 
’d
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/structs_spec.lua

1 --- 
	gTurbo
.
lua
 
Un™
 
	g‹¡


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

19 
m©h
.
¿ndom£ed
(
turbo
.
ut
.
	$g‘timeofday
())

21 
	`desüibe
("turbo.¡ruù Name¥aû", 
	$funùiÚ
()

23 
	`desüibe
("Bufã¸şass", 
	$funùiÚ
()

24 
	`™
("should bcÚ¡ruùed„ight", 
	$funùiÚ
()

25 
loÿl
 
buf
 = 
turbo
.
¡ruùs
.
	$bufãr
()

26 
as£¹
.
	`Œuthy
(
	$š¡ªûOf
(
turbo
.
¡ruùs
.
bufãr
, 
buf
))

27 
’d
)

28 
	`™
("should‡µ’d cÜ»ùly", 
	$funùiÚ
()

29 
loÿl
 
buf
 = 
turbo
.
¡ruùs
.
	$bufãr
()

30 
buf
:
	`­³nd_lua¡r_right
("Long string")

31 
buf
:
	`­³nd_lua¡r_right
("hat isƒxpectedo")

32 
buf
:
	`­³nd_lua¡r_right
("ƒqual‡ constant")

33 
as£¹
.
	`equ®
(
	`to¡ršg
(
buf
), "Long stringhat isƒxpectedoƒqual‡ constant")

34 
’d
)

35 
	`™
("should…»³nd cÜ»ùly", 
	$funùiÚ
()

36 
loÿl
 
buf
 = 
turbo
.
¡ruùs
.
	$bufãr
()

37 
buf
:
	`­³nd_lua¡r_Ëá
("ƒqual‡ constant")

38 
buf
:
	`­³nd_lua¡r_Ëá
("hat isƒxpectedo")

39 
buf
:
	`­³nd_lua¡r_Ëá
("Long string")

40 
as£¹
.
	`equ®
(
	`to¡ršg
(
buf
), "Long stringhat isƒxpectedoƒqual‡ constant")

41 
’d
)

42 
	`™
("should hªdË mixed‡µ’d/´•’d", 
	$funùiÚ
()

43 
loÿl
 
buf
 = 
turbo
.
¡ruùs
.
	$bufãr
()

44 
loÿl
 
cmp
 = ""

45 
i
 = 0, 300 do

46 
loÿl
 
diû
 = 
m©h
.
	`¿ndom
() * 10

47 
diû
 > 5 
th’


48 
cmp
 = 
	`to¡ršg
(
diû
) .. cmp

49 
buf
:
	`­³nd_lua¡r_Ëá
(
	$to¡ršg
(
diû
))

51 
cmp
 = cm°.. 
	$to¡ršg
(
diû
)

52 
buf
:
	`­³nd_lua¡r_right
(
	$to¡ršg
(
diû
))

53 
’d


54 
’d


55 
as£¹
.
	`equ®
(
cmp
, 
	$to¡ršg
(
buf
))

56 
as£¹
.
	`equ®
(
cmp
:
	`Ën
(), 
buf
:
	$Ën
())

57 
’d
)

58 
	`™
("should suµÜˆ=ğİ”©Ü", 
	$funùiÚ
()

59 
loÿl
 
buf
 = 
turbo
.
¡ruùs
.
	$bufãr
()

60 
buf
:
	`­³nd_lua¡r_right
("twoƒqual string shouldƒqual!")

61 
loÿl
 
buf2
 = 
turbo
.
¡ruùs
.
	$bufãr
()

62 
buf2
:
	`­³nd_lua¡r_right
("twoƒqual string shouldƒqual!")

63 
as£¹
.
	$Œuthy
(
buf
 =ğ
buf2
)

64 
buf2
:
	$ş—r
()

65 
as£¹
.
	`Œuthy
(
buf
 ~ğ
buf2
)

66 
’d
)

67 
	`™
("should…İ cÜ»ùly", 
	$funùiÚ
()

68 
loÿl
 
buf
 = 
turbo
.
¡ruùs
.
	$bufãr
()

69 
i
 = 1, 10000 do

70 
buf
:
	`­³nd_lua¡r_right
("much data in here")

71 
’d


72 
buf
:
	`pİ_right
(
¡ršg
.
	`Ën
("much data in here") * 10000)

73 
as£¹
.
	`equ®
(
buf
:
	`Ën
(), 0)

74 
i
 = 1, 10000 do

75 
buf
:
	`­³nd_lua¡r_Ëá
("much data in here")

76 
’d


77 
as£¹
.
	`has_”rÜ
(
	$funùiÚ
()

78 
buf
:
	`pİ_right
(
¡ršg
.
	`Ën
("much data in here") * 10001)

79 
’d
)

80 
buf
:
	$shršk
()

81 
buf
:
	`Ën
() ~= 0 do

82 
buf
:
	$pİ_Ëá
(1)

83 
’d


84 
as£¹
.
	`equ®
(
	`to¡ršg
(
buf
), "")

85 
buf
:
	$ş—r
()

86 
’d
)

87 
	`™
("should suµÜˆm‘hod chaššg", 
	$funùiÚ
()

88 
loÿl
 
buf
 = 
turbo
.
¡ruùs
.
	$bufãr
()

89 
buf
:
	`­³nd_lua¡r_Ëá
("test"):append_luastr_left("test")

90 
as£¹
.
	`equ®
(
	`to¡ršg
(
buf
), "testtest")

91 
’d
)

92 
’d
)

94 
	`desüibe
("Dequşass", 
	$funùiÚ
()

95 
loÿl
 
d


96 
	`™
("should bcÚ¡ruùed„ight", 
	$funùiÚ
()

97 
d
 = 
turbo
.
¡ruùs
.
deque
:
	$Ãw
()

98 
as£¹
.
	`Œuthy
(
	$š¡ªûOf
(
turbo
.
¡ruùs
.
deque
, 
d
))

99 
’d
)

101 
loÿl
 
­³nd_n_–em’ts
 = 200

102 
loÿl
 
¡ršg1
 = "Some stringhat should be‡ppended"

103 
loÿl
 
¡ršg2
 = "Another stringhat should be‡ppended"

105 
	`™
("should‡µ’d cÜ»ùly", 
	$funùiÚ
()

106 
i
 = 1, 
­³nd_n_–em’ts
, 1 do

107 
d
:
	$­³nd
(
¡ršg1
)

108 
’d


109 
as£¹
.
	`equ®
(
d
:
	`size
(), 
­³nd_n_–em’ts
)

110 
’d
)

112 
	`™
("cÚÿˆshould givcÜ»ù†’gth", 
	$funùiÚ
()

113 
as£¹
.
	`equ®
(
d
:
	$cÚÿt
():
	`Ën
(), 
­³nd_n_–em’ts
 * 
¡ršg1
:
	$Ën
())

114 
’d
)

116 
	`™
("should suµÜˆ­³ndËá", 
	$funùiÚ
()

117 
d
:
	$­³ndËá
(
¡ršg2
)

118 
as£¹
.
	`equ®
(
d
:
	`³ekfœ¡
(), 
¡ršg2
)

119 
’d
)

121 
	`™
("should suµÜˆpİËá", 
	$funùiÚ
()

122 
as£¹
.
	`equ®
(
d
:
	`pİËá
(), 
¡ršg2
)

123 
as£¹
.
	`equ®
(
d
:
	`pİËá
(), 
¡ršg1
)

124 
’d
)

126 
	`™
("should suµÜˆpİ", 
	$funùiÚ
()

127 
d
:
	$­³nd
(
¡ršg1
 .. 
¡ršg2
)

128 
as£¹
.
	`equ®
(
d
:
	`pİ
(), 
¡ršg1
 .. 
¡ršg2
)

129 
as£¹
.
	`equ®
(
d
:
	`pİ
(), 
¡ršg1
)

130 
’d
)

132 
	`™
("mu¡„•ÜˆnÙƒm±y„ight", 
	$funùiÚ
()

133 
as£¹
.
	`Œuthy
(
d
:
	$nÙ_em±y
())

134 
d
:
	`nÙ_em±y
(è=ğ
Œue
 do

135 
d
:
	$pİ
()

136 
’d


137 
as£¹
.
	`çlsy
(
d
:
	$nÙ_em±y
())

138 
’d
)

140 
	`™
("g‘Àshould wÜk cÜ»ùly", 
	$funùiÚ
()

141 
d
:
	`­³ndËá
("pos3")

142 
d
:
	`­³ndËá
("pos2")

143 
d
:
	`­³ndËá
("pos1")

144 
as£¹
.
	`equ®
(
d
:
	`g‘n
(0), "pos1")

145 
as£¹
.
	`equ®
(
d
:
	`g‘n
(1), "pos2")

146 
as£¹
.
	`equ®
(
d
:
	`g‘n
(2), "pos3")

147 
’d
)

149 
	`™
("should behavlogiÿÎy", 
	$funùiÚ
()

150 
loÿl
 
q
 = 
turbo
.
¡ruùs
.
deque
:
	$Ãw
()

151 
loÿl
 
¡r
 = ""

152 
loÿl
 
n
 = 0

154 
i
=0, 1000 do

155 
m©h
.
	`¿ndom£ed
(
os
.
	`time
(è+ 
i
)

156 
loÿl
 
aùiÚ
 = 
m©h
.
	$¿ndom
(0,4)

157 ià(
aùiÚ
 =ğ0è
th’


158 
q
:
	`­³nd
("a dog")

159 
n
 =‚ + 1

160 
	$–£if
 (
aùiÚ
 =ğ1è
th’


161 
q
:
	`­³ndËá
("a cat")

162 
n
 =‚ + 1

163 
	$–£if
 (
aùiÚ
 =ğ2è
th’


164 ià(
q
:
	$nÙ_em±y
()è
th’


165 
q
:
	$pİËá
()

166 
n
 =‚ - 1

168 
as£¹
.
	`equ®
(
n
, 
q
:
	$pİËá
())

169 
’d


170 
	$–£if
 (
aùiÚ
 =ğ3è
th’


171 ià(
q
:
	$nÙ_em±y
()è
th’


172 
q
:
	$pİ
()

173 
n
 =‚ - 1

175 
as£¹
.
	`equ®
(
n
, 
q
:
	$pİ
())

176 
’d


177 
	$–£if
 (
aùiÚ
 =ğ4è
th’


178 
as£¹
.
	`equ®
(
q
:
	`size
(), 
n
)

179 
’d


180 
’d


181 
’d
)

182 
’d
)

184 
’d
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/util_spec.lua

1 --- 
	gTurbo
.
lua
 
Un™
 
	g‹¡


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gturbo
 = 
»quœe
 "turbo"

18 
loÿl
 
ffi
 = 
»quœe
 "ffi"

20 
desüibe
("turbo.ut Name¥aû", 
	$funùiÚ
()

22 
	`desüibe
("ut.¡r_fšd", 
	$funùiÚ
()

23 
loÿl
 
£¬ch_time
 = 1000000

24 
loÿl
 
¢“dË
 = "\r\n\r\n"

25 
loÿl
 
shay¡ack
 = "pkl2''234kokosmv,.-sd,fkwerj234982a9dfj89as9dhrh234"

27 
	`™
("should wÜk", 
	$funùiÚ
()

28 
loÿl
 
hay¡ack
 = 
turbo
.
¡ruùs
.
	$bufãr
()

29 
i
 = 0, 
£¬ch_time
 do

30 
hay¡ack
:
	$­³nd_lua¡r_right
(
shay¡ack
)

31 
’d


32 
hay¡ack
:
	$­³nd_lua¡r_right
(
¢“dË
)

33 
i
 = 0, 
£¬ch_time
 do

34 
hay¡ack
:
	$­³nd_lua¡r_right
(
shay¡ack
)

35 
’d


36 
loÿl
 
ÃedË
 = 
turbo
.
¡ruùs
.
	$bufãr
()

37 
ÃedË
:
	$­³nd_lua¡r_right
(
¢“dË
)

38 
loÿl
 
h_¡r
, 
h_Ën
 = 
hay¡ack
:
	$g‘
()

39 
loÿl
 
n_¡r
, 
n_Ën
 = 
ÃedË
:
	$g‘
()

40 
as£¹
.
	`equ®
(
turbo
.
ut
.
	`¡r_fšd
(
h_¡r
, 
n_¡r
, 
h_Ën
, 
n_Ën
) - h_str, 51000051)

41 
’d
)

42 
’d
)

43 
’d
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/web_spec.lua

1 --- 
	gTurbo
.
lua
 
Un™
 
	g‹¡


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g_G
.
	g__TURBO_USE_LUASOCKET__
 = 
os
.
g‘’v
("TURBO_USE_LUASOCKET"è
ªd
 
Œue
 
Ü
 
çl£


18 
loÿl
 
TEST_WITH_SSL
 = 
os
.
g‘’v
("TURBO_TEST_SSL")

19 
TEST_WITH_SSL
 
th’


20 
_G
.
TURBO_SSL
 = 
Œue


21 
’d


23 
loÿl
 
turbo
 = 
»quœe
 "turbo"

24 
m©h
.
¿ndom£ed
(
turbo
.
ut
.
	$g‘timeofday
())

26 
	`desüibe
("turbo.web Name¥aû", 
	$funùiÚ
()

28 
	`befÜe_—ch
(
	`funùiÚ
()

29 -- 
Make
 
su»
 
we
 
¡¬t
 
w™h
 
a
 
äesh
 
glob®
 
IOLoİ
 
to


30 -- 
avoid
 
¿ndom
 
»suÉs
.

31 
_G
.
io_loİ_š¡ªû
 = 
n


32 
’d
)

34 
	`desüibe
("AµliÿtiÚ‡nd Reque¡HªdË¸şas£s", 
	`funùiÚ
()

35 -- 
Mo¡
 
of
 
‹¡s
 
h”e
 
u£
 
the
 
turbo
.
async
.
HTTPCl›Á
, 
so
 
ªy
 
”rÜs


36 -- 
š
 
th©
 
wl
 
®so
 
show
 iÀ
the£
 
‹¡s
...

37 
	`™
("Acû± h–lØwÜld.", 
	$funùiÚ
()

38 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

39 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

40 
loÿl
 
Exam¶eHªdËr
 = 
	`şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

41 
funùiÚ
 
Exam¶eHªdËr
:
	$g‘
()

42 
£lf
:
	`wr™e
("Hello World!")

43 
’d


44 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
	$li¡’
(
pÜt
)

46 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

47 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

48 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/"))

49 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

50 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

51 
io
:
	$şo£
()

52 
’d
)

54 
io
:
	$wa™
(5)

55 
’d
)

57 
	`™
("Acû± URL…¬am‘”s", 
	$funùiÚ
()

58 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

59 
loÿl
 
·¿m
 = 
m©h
.
	$¿ndom
(1000,10000)

60 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

61 
loÿl
 
Exam¶eHªdËr
 = 
	`şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

62 
funùiÚ
 
Exam¶eHªdËr
:
	$g‘
(, 
¡r
)

63 
as£¹
.
	`equ®
(
	`tÚumb”
(), 
·¿m
)

64 
as£¹
.
	`equ®
("‹¡™em", 
¡r
)

65 
£lf
:
	$wr™e
()

66 
’d


67 
turbo
.
web
.
	`AµliÿtiÚ
({

68 {"^/(%d*)/(%a*)$", 
Exam¶eHªdËr
}

69 
	}
}):
	$li¡’
(
pÜt
)

71 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

72 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

73 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/"..to¡ršg(
·¿m
).."/testitem"))

74 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

75 
as£¹
.
	`equ®
(
·¿m
, 
	$tÚumb”
(
»s
.
body
))

76 
io
:
	$şo£
()

77 
’d
)

79 
io
:
	$wa™
(5)

80 
’d
)

82 
	`™
("Acû± GET…¬am‘”s", 
	$funùiÚ
()

83 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

84 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

85 
loÿl
 
Exam¶eHªdËr
 = 
	`şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

86 
funùiÚ
 
Exam¶eHªdËr
:
	$g‘
()

87 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item1"), "Hello")

88 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item2"), "World")

89 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item3"), "!")

90 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item4"), "StrangeÃ˜Ã†Ã˜Ã…Ã˜LÃ†LÃ˜Ã†L@Â½$@Â£$Â½]@Â£}Â½")

91 
£lf
:
	`wr™e
("Hello World!")

92 
’d


93 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
	$li¡’
(
pÜt
)

95 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

96 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

97 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/",

99 
·¿ms
={

100 
™em1
="Hello",

101 
™em2
="World",

102 
™em3
="!",

103 
™em4
="StrangeÃ˜Ã†Ã˜Ã…Ã˜LÃ†LÃ˜Ã†L@Â½$@Â£$Â½]@Â£}Â½"

105 
	}
}))

106 
	gas£¹
.
	$çlsy
(
»s
.
”rÜ
)

107 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

108 
io
:
	$şo£
()

109 
’d
)

111 
io
:
	$wa™
(5)

112 
’d
)

114 
	`™
("Acû± POST muÉ¬t", 
	$funùiÚ
()

115 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

116 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

117 
loÿl
 
Exam¶eHªdËr
 = 
	`şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

118 
funùiÚ
 
Exam¶eHªdËr
:
	$po¡
()

119 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item1"), "Hello")

120 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item2"), "World")

121 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item3"), "!")

122 
as£¹
.
	`equ®
(
£lf
:
	`g‘_¬gum’t
("item4"), "StrangeÃ˜Ã†Ã˜Ã…Ã˜LÃ†LÃ˜Ã†L@Â½$@Â£$Â½]@Â£}Â½")

123 
£lf
:
	`wr™e
("Hello World!")

124 
’d


125 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
	$li¡’
(
pÜt
)

127 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

128 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

129 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/",

131 
m‘hod
="POST",

132 
·¿ms
={

133 
™em1
="Hello",

134 
™em2
="World",

135 
™em3
="!",

136 
™em4
="StrangeÃ˜Ã†Ã˜Ã…Ã˜LÃ†LÃ˜Ã†L@Â½$@Â£$Â½]@Â£}Â½"

138 
	}
}))

139 
	gas£¹
.
	$çlsy
(
»s
.
”rÜ
)

140 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

141 
io
:
	$şo£
()

142 
’d
)

144 
io
:
	$wa™
(5)

145 
’d
)

147 
	`™
("Acû± JSON d©a", 
	$funùiÚ
()

148 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

149 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

150 
loÿl
 
Exam¶eHªdËr
 = 
	`şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

151 
funùiÚ
 
Exam¶eHªdËr
:
	$po¡
()

152 
jsÚ
 = 
£lf
:
	$g‘_jsÚ
(
Œue
)

153 
as£¹
.
	`equ®
(
jsÚ
.
™em1
, "Hello")

154 
as£¹
.
	`equ®
(
jsÚ
.
™em2
, "StrangeÃ˜Ã†Ã˜Ã…Ã˜LÃ†LÃ˜Ã†L@Â½$@Â£$Â½]@Â£}Â½")

155 
£lf
:
	`wr™e
("Hello World!")

156 
’d


157 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
	$li¡’
(
pÜt
)

159 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

160 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

161 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/",

163 
m‘hod
="POST",

164 
body
="{\"item1\": \"Hello\", \"item2\": \"StrangeÃ˜Ã†Ã˜Ã…Ã˜LÃ†LÃ˜Ã†L@Â½$@Â£$Â½]@Â£}Â½\"}"

165 
	}
}))

166 
	gas£¹
.
	$çlsy
(
»s
.
”rÜ
)

167 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

168 
io
:
	$şo£
()

169 
’d
)

171 
io
:
	$wa™
(5)

172 
’d
)

174 
	`™
("Te¡ ca£ fÜ„•Ü‹d bug.", 
	$funùiÚ
()

175 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

176 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

177 
loÿl
 
şo£d
 = 
çl£


178 
turbo
.
log
.
ÿ‹gÜ›s
.
”rÜ
 = 
çl£


179 
turbo
.
log
.
ÿ‹gÜ›s
.
¡ackŒaû
 = 
çl£


181 
loÿl
 
Exam¶eHªdËr
 = 
	`şass
("Exam¶eHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

182 
funùiÚ
 
Exam¶eHªdËr
:
	$g‘
()

183 
£lf
:
	`wr™e
("Hello World!")

184 
’d


185 
turbo
.
web
.
	`AµliÿtiÚ
({{"^/$", 
Exam¶eHªdËr
}
	}
}):
	$li¡’
(
pÜt
)

187 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

188 
loÿl
 
hdr
 = "CONNECT mx2.mail2000.com.tw:25 HTTP/1.0\r\n\r\n"

189 
loÿl
 
sock
, 
msg
 = 
turbo
.
sock‘
.
	$Ãw_nÚblock_sock‘
(

190 
turbo
.
sock‘
.
AF_INET
,

191 
turbo
.
sock‘
.
SOCK_STREAM
,

193 
sock
 =ğ-1 
th’


194 
	`”rÜ
("Could‚ot create socket.")

195 
’d


196 
loÿl
 
¡»am
 = 
turbo
.
io¡»am
.
IOSŒ—m
:
	$Ãw
(
sock
)

197 
loÿl
 
rc
, 
msg
 = 
¡»am
:
	`cÚÃù
(

199 
pÜt
,

200 
turbo
.
sock‘
.
AF_INET
,

201 
	$funùiÚ
()

202 
¡»am
:
	`£t_şo£_ÿÎback
(
	$funùiÚ
()

203 
şo£d
 = 
Œue


204 
io
:
	$şo£
()

205 
’d
)

206 
cÜoutše
.
	`y›ld
 (
turbo
.
async
.
	$sk
(
¡»am
.
wr™e
, sŒ—m, 
hdr
))

207 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

208 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

209 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/"))

210 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

211 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

212 
io
:
	$şo£
()

213 
’d
)

214 
’d
)

215 
rc
 ~ğ0 
th’


216 
	`”rÜ
("Could‚ot connect")

217 
’d


218 
’d
)

220 
io
:
	$wa™
(5)

221 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


222 
as£¹
.
	$equ®
(
şo£d
, 
Œue
)

223 
’d


224 
turbo
.
log
.
ÿ‹gÜ›s
.
”rÜ
 = 
Œue


225 
turbo
.
log
.
ÿ‹gÜ›s
.
¡ackŒaû
 = 
Œue


226 
’d
)

228 
	`™
("Suµ¹ muÉË cook›s.", 
	$funùiÚ
()

229 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

230 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

232 
loÿl
 
‹¡_v®ue1
 = "fghjrtopy67askdopfkaopsdkfkasodfkopkpp"

233 
loÿl
 
‹¡_v®ue2
 = "@Â£Â¥Â£$Â½Â¥Â£$Â½Â¥Â¼â€°/(%&)&/()"

235 
loÿl
 
S‘Cook›HªdËr
 = 
	`şass
("S‘Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

236 
funùiÚ
 
S‘Cook›HªdËr
:
	$g‘
()

237 
£lf
:
	`£t_cook›
("Te¡V®ue", 
‹¡_v®ue1
)

238 
£lf
:
	`£t_cook›
("Te¡V®ue2", 
‹¡_v®ue2
)

239 
£lf
:
	`wr™e
("Hello World!")

240 
’d


242 
loÿl
 
G‘Cook›HªdËr
 = 
	`şass
("G‘Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

243 
funùiÚ
 
G‘Cook›HªdËr
:
	$g‘
()

244 
as£¹
.
	`equ®
(
£lf
:
	`g‘_cook›
("Te¡V®ue"), 
‹¡_v®ue1
)

245 
as£¹
.
	`equ®
(
£lf
:
	`g‘_cook›
("Te¡V®ue2"), 
‹¡_v®ue2
)

246 
£lf
:
	`wr™e
("Hello World!")

247 
’d


249 
turbo
.
web
.
	`AµliÿtiÚ
({

250 {"^/£t$", 
S‘Cook›HªdËr
},

251 {"^/g‘$", 
G‘Cook›HªdËr
},

252 
	}
}):
	$li¡’
(
pÜt
)

254 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

255 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

256 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/set"))

257 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

258 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

259 
loÿl
 
cook›¡r
 = 
»s
.
h—d”s
:
	`g‘
("Set-Cookie")

261 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

262 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/get", {

263 
Ú_h—d”s
 = 
	`funùiÚ
(
h
)

264 
h
:
	`add
("Cook›", 
cook›¡r
[1])

265 
h
:
	`add
("Cook›", 
cook›¡r
[2])

266 
’d


267 
	}
}))

268 
	gio
:
	$şo£
()

269 
’d
)

270 
io
:
	$wa™
(5)

272 
’d
)

274 
	`™
("SuµÜˆcook›.", 
	$funùiÚ
()

275 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

276 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

278 
loÿl
 
‹¡_v®ue1
 = "fghjrtopy67askdopfkaopsdkfkasodfkopkpp"

280 
loÿl
 
S‘Cook›HªdËr
 = 
	`şass
("S‘Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

281 
funùiÚ
 
S‘Cook›HªdËr
:
	$g‘
()

282 
£lf
:
	`£t_cook›
("Te¡V®ue", 
‹¡_v®ue1
)

283 
£lf
:
	`wr™e
("Hello World!")

284 
’d


286 
loÿl
 
G‘Cook›HªdËr
 = 
	`şass
("G‘Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

287 
funùiÚ
 
G‘Cook›HªdËr
:
	$g‘
()

288 
as£¹
.
	`equ®
(
£lf
:
	`g‘_cook›
("Te¡V®ue"), 
‹¡_v®ue1
)

289 
£lf
:
	`wr™e
("Hello World!")

290 
’d


292 
turbo
.
web
.
	`AµliÿtiÚ
({

293 {"^/£t$", 
S‘Cook›HªdËr
},

294 {"^/g‘$", 
G‘Cook›HªdËr
},

295 
	}
}):
	$li¡’
(
pÜt
)

297 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

298 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

299 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/set"))

300 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

301 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

302 
loÿl
 
cook›¡r
 = 
»s
.
h—d”s
:
	`g‘
("Set-Cookie")

304 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

305 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/get", {

306 
Ú_h—d”s
 = 
	`funùiÚ
(
h
)

307 
h
:
	`add
("Cook›", 
cook›¡r
)

308 
’d


309 
	}
}))

310 
	gio
:
	$şo£
()

311 
’d
)

312 
io
:
	$wa™
(5)

314 
’d
)

316 
TEST_WITH_SSL
 
th’


317 
	`™
("SuµÜˆmuÉË secu» cook›s.", 
	$funùiÚ
()

318 
loÿl
 
pÜt
 = 
m©h
.
	$¿ndom
(10000,40000)

319 
loÿl
 
io
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

321 
loÿl
 
‹¡_v®ue1
 = "fghjrtopy67askdopfkaopsdkfkasodfkopkpp"

322 
loÿl
 
‹¡_v®ue2
 = "@Â£Â¥Â£$Â½Â¥Â£$Â½Â¥Â¼â€°/(%&)&/()"

324 
loÿl
 
S‘Cook›HªdËr
 = 
	`şass
("S‘Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

325 
funùiÚ
 
S‘Cook›HªdËr
:
	$g‘
()

326 
£lf
:
	`£t_£cu»_cook›
("Te¡V®ue", 
‹¡_v®ue1
)

327 
£lf
:
	`£t_£cu»_cook›
("Te¡V®ue2", 
‹¡_v®ue2
)

328 
£lf
:
	`wr™e
("Hello World!")

329 
’d


331 
loÿl
 
G‘Cook›HªdËr
 = 
	`şass
("G‘Cook›HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

332 
funùiÚ
 
G‘Cook›HªdËr
:
	$g‘
()

333 
as£¹
.
	`equ®
(
£lf
:
	`g‘_£cu»_cook›
("Te¡V®ue"), 
‹¡_v®ue1
)

334 
as£¹
.
	`equ®
(
£lf
:
	`g‘_£cu»_cook›
("Te¡V®ue2"), 
‹¡_v®ue2
)

335 
£lf
:
	`wr™e
("Hello World!")

336 
’d


338 
turbo
.
web
.
	`AµliÿtiÚ
({

339 {"^/£t$", 
S‘Cook›HªdËr
},

340 {"^/g‘$", 
G‘Cook›HªdËr
},

341 
	}
}, {
	gcook›_£ü‘
="akpodpo0j§dasjdfoj24234Ã¸Ã¦"}):
	$li¡’
(
pÜt
)

343 
io
:
	`add_ÿÎback
(
	$funùiÚ
()

344 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

345 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/set"))

346 
as£¹
.
	$çlsy
(
»s
.
”rÜ
)

347 
as£¹
.
	`equ®
(
»s
.
body
, "Hello World!")

348 
loÿl
 
cook›¡r
 = 
»s
.
h—d”s
:
	`g‘
("Set-Cookie")

350 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
(

351 "h‰p://127.0.0.1:"..
	`to¡ršg
(
pÜt
).."/get", {

352 
Ú_h—d”s
 = 
	`funùiÚ
(
h
)

353 
h
:
	`add
("Cook›", 
cook›¡r
[1])

354 
h
:
	`add
("Cook›", 
cook›¡r
[2])

355 
’d


356 
	}
}))

357 
	gio
:
	$şo£
()

358 
’d
)

359 
io
:
	$wa™
(5)

360 
’d
)

361 
’d


364 
’d
)

366 
’d
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo.lua

1 --- 
	gTurbo
.
lua
 
AsynchrÚous
 
ev’t
 
ba£d
 
Lua
 
Web
 
	gF¿mewÜk
.

2 -- 
It
 
is
 
difã»Á
 
äom
 
®l
 
the
 
Ùh”
 
Lua
 
HTTP
 
£rv”s
 
out
 
th”e
 
š
 
th©
 
	g™
's

3 -- 
	gmod”n
, 
	gäesh
, 
objeù
 
Ü›Áed
 
ªd
 
—sy
 
to
 
	gmodify
.

4 -- 
It
 
is
 
wr™‹n
 
š
 
pu»
 
	gLua
, 
th”e
 
¬e
 
no
 
Lua
 
C
 
moduËs
 
š¡—d
 
™
 
u£s
 
	gthe


5 -- 
LuaJIT
 
FFI
 
to
 dØ
sock‘
 
ªd
 
ev’t
 
hªdlšg
 (
Úly
 
­¶›s
 
Lšux
).

6 -- 
U£rs
 
of
 
the
 
TÜÇdo
 
web
 
£rv”
 
wl
 
»cognize
h
API
 
ofã»d
 
´‘ty
 
	gquick
.

8 -- 
If
 
you
 dØ
nÙ
 
know
 
Lua
 
th’
 dØnÙ 
ã¬
 
as
 
™s
 
´obably
 
Úe
 
of
 
the
 
	g—s›¡


9 -- 
Ïnguages
 
to
 
Ë¬n
 
you
 
know
 
	gC
, 
PythÚ
 
Ü
 
Javasüt
 
äom
 
	gbefÜe
.

11 -- 
	gTurbo
.
lua
 
is
 
	gnÚ
-
blockšg
 
ªd
 
a
 
ã©u»s
‡ 
exŒem–y
 
ç¡
 
light
 
weight
 
	gweb


12 -- 
	g£rv”
. 
The
 
äamewÜk
 
is
 
good
 
REST
 
	gAPIs
, 
Œad™iÚ®
 
HTTP
 
»que¡s
 
	gªd


13 -- 
İ’
 
cÚÃùiÚs
 
like
 
Websock‘s
 
»quœes
 
b—ÿu£
 
of
 
™s
 
combš©iÚ
 
	gof


14 -- 
the
 
¿w
 
pow”
 
of
 
LuaJIT
 
ªd
 
™s
 
ev’t
 
driv’
 
	gÇtu»
.

16 -- 
Wh©
 
£ts
 
	gTurbo
.
lua
 
­¬t
 
äom
 
the
 
Ùh”
 
ev’‹d
 
driv’
 
£rv”s
 
out
 
	gth”e
,

17 -- 
is
 
th©
 
™
 i 
the
 
	gç¡e¡
, 
mo¡
 
sÿÏbË
 
ªd
 
has
h
sm®Ë¡
 
foÙ´št
 
	gof


18 -- 
them
 
	g®l
. 
This
 
is
 
thªks
 
to
 
the
 
exûÎ’t
 
wÜk
 
dÚe
 
Ú
 
	gLuaJIT
.

20 -- 
PËa£
 
visi¡
 
	gh‰p
:

23 -- 
Maš
 
ã©u»s
 
ªd
 
design
 
´šcËs
:

25 -- * 
Sim¶e
 
ªd
 
štu™ive
 
API
 (
much
 
like
 
TÜÇdo
)

27 -- * 
Good
 
docum’tiÚ


29 -- * 
No
 
d•’d’c›s
, 
exû±
 
LuaJIT
 
the
 
	gJu¡
-
	gIn
-
Time
 
comp”
 
	gLua
.

31 -- * 
Ev’t
 
	gdriv’
, 
asynchrÚous
 
ªd
 
th»adËss
 
	gdesign


33 -- * 
ExŒem–y
 
ç¡
 
w™h
 
	gLuaJIT


35 -- * 
Wr™‹n
 
com¶‘–y
 
š
 
pu»
 
	gLua


37 -- * 
Lšux
 
EpŞl
 
	gsuµÜt


39 -- * 
Sm®l
 
	gfoÙ´št


42 -- 
Cİyright
 
John
 
	gAb¿ham£n
 2011 - 2015

44 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

45 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

46 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


48 -- 
	gh‰p
:

50 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


51 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

52 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

53 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


54 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

56 
loÿl
 
	gturbo
 = {} -- 
turbo
 
maš
 
Çme¥aû
.

58 -- 
The
 
Turbo
 
Web
 
v”siÚ
 
is
 
of
 
the
 
fÜm
 
A
.
B
.
C
, 
wh”e
 A i th
majÜ
 
	gv”siÚ
,

59 -- 
B
 
is
 
the
 
mšÜ
 
	gv”siÚ
, 
ªd
 
C
 i th
miüo
 v”siÚ. 
If
he micro version

60 -- 
is
 
	gz”o
, 
	g™
â€™
s
 
om™‹d
 
äom
 
the
 
v”siÚ
 
	g¡ršg
.

61 -- 
Wh’
 
a
 
Ãw
 
»Ëa£
 
Úly
 
fixes
 
bugs
 
ªd
 
	gdÛ¢
â€™
t
 
add
‚ew 
ã©u»s
 
	gÜ


62 -- 
	gfunùiÚ®™y
, 
the
 
miüo
 
v”siÚ
 
is
 
	gšüem’‹d
. 
Wh’
 
Ãw
 
ã©u»s
 
	g¬e


63 -- 
added
 
š
 
a
 
backw¬ds
 
com·tibË
 
	gway
, 
the
 
mšÜ
 
v”siÚ
 
is
 
šüem’‹d
 
	gªd


64 -- 
the
 
miüo
 
v”siÚ
 
is
 
£t
 
to
 
	gz”o
. 
Wh’
 
th”e
 
¬e
 
backw¬ds
 
	gšcom·tibË


65 -- 
	gchªges
, 
the
 
majÜ
 
v”siÚ
 
is
 
šüem’‹d
 
ªd
 
Ùh”s
 
¬e
 
£t
 
to
 
	gz”o
.

66 
	gturbo
.
	gMAJOR_VERSION
 = 2

67 
turbo
.
MINOR_VERSION
 = 1

68 
turbo
.
MICRO_VERSION
 = 1

69 -- 
A
 3-
by‹
 
hexadecim®
 
»´e£Á©iÚ
 
of
 
the
 
v”siÚ
, 
	ge
.
	gg
. 0x010201 

70 -- 
	gv”siÚ
 1.2.1 
	gªd
 0x010300 version 1.3.

71 
	gturbo
.
	gVERSION_HEX
 = 0x020101

72 
turbo
.
MICRO_VERSION
 
th’


73 
turbo
.
VERSION
 = 
¡ršg
.
fÜm©
("%d.%d.%d",

74 
turbo
.
MAJOR_VERSION
,

75 
turbo
.
MINOR_VERSION
,

76 
turbo
.
MICRO_VERSION
)

78 
	gturbo
.
	gVERSION
 = 
¡ršg
.
fÜm©
("%d.%d",

79 
turbo
.
MAJOR_VERSION
,

80 
turbo
.
MINOR_VERSION
)

81 
’d


83 
nÙ
 
j™
 
th’


84 
	g_G
.
	g__TURBO_NO_JIT__
 = 
Œue


85 
’d


86 
as£¹
(
pÿÎ
(
»quœe
, "ffi"), "No FFI or compatible†ibrary‡vailable.")

87 
as£¹
(
pÿÎ
(
»quœe
, "b™"è
Ü
…call(require, "bit32"),

89 
	gturbo
.
	g¶©fÜm
 = 
»quœe
 "turbo.platform"

90 
turbo
.
log
 = 
»quœe
 "turbo.log"

91 
nÙ
 
turbo
.
¶©fÜm
.
__LINUX__
 
th’


92 
nÙ
 
pÿÎ
(
»quœe
, "sock‘"è
th’


93 
	gturbo
.
	glog
.
”rÜ
("Could‚ot†oad LuaSocket. Aborting.")

94 
’d


95 
	g_G
.
	g__TURBO_USE_LUASOCKET__
 = 
Œue


96 
–£if
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


97 
turbo
.
log
.
w¬nšg
(

100 
’d


101 
turbo
.
iŞoİ
 = 
»quœe
 "turbo.ioloop"

102 
turbo
.
esÿ³
 = 
»quœe
 "turbo.escape"

103 
turbo
.
h‰put
 = 
»quœe
 "turbo.httputil"

104 
turbo
.
tı£rv”
 = 
»quœe
 "turbo.tcpserver"

105 
turbo
.
h‰p£rv”
 = 
»quœe
 "turbo.httpserver"

106 
turbo
.
io¡»am
 = 
»quœe
 "turbo.iostream"

107 
turbo
.
iosim¶e
 = 
»quœe
 "turbo.iosimple"

108 
turbo
.
üy±o
 = 
»quœe
 "turbo.crypto"

109 
turbo
.
async
 = 
»quœe
 "turbo.async"

110 
turbo
.
web
 = 
»quœe
 "turbo.web"

111 
turbo
.
ut
 = 
»quœe
 "turbo.util"

112 
turbo
.
coùx
 = 
»quœe
 "turbo.coctx"

113 
turbo
.
websock‘
 = 
»quœe
 "turbo.websocket"

114 
turbo
.
sock‘
 = 
»quœe
 "turbo.socket_ffi"

115 
turbo
.
sockut
 = 
»quœe
 "turbo.sockutil"

116 
turbo
.
hash
 = 
»quœe
 "turbo.hash"

117 
turbo
.
¶©fÜm
.
__LINUX__
 
th’


118 
turbo
.
šÙify
 = 
»quœe
 "turbo.inotify"

119 
turbo
.
fs
 = 
»quœe
 "turbo.fs"

120 
turbo
.
sigÇl
 = 
»quœe
 "turbo.signal"

121 
turbo
.
sysÿÎ
 = 
»quœe
 "turbo.syscall"

122 
turbo
.
th»ad
 = 
»quœe
 "turbo.thread"

123 
’d


124 
turbo
.
¡ruùs
 = {}

125 
turbo
.
¡ruùs
.
deque
 = 
»quœe
 "turbo.structs.deque"

126 
turbo
.
¡ruùs
.
bufãr
 = 
»quœe
 "turbo.structs.buffer"

128  
turbo


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/3rdparty/JSON.lua

1 -- -*- 
	gcodšg
: 
utf
-8 -*-

3 -- 
Cİyright
 2010-2011 
Jefäey
 
Fr›dl


4 -- 
h‰p
:

6 
loÿl
 
VERSION
 = 20111207.5 -- 
v”siÚ
 
hi¡Üy
 
©
 
’d
 
of
 
fe


7 
loÿl
 
OBJDEF
 = { 
VERSION
 = VERSION }

10 -- 
Sim¶e
 
JSON
 
’codšg
 
ªd
 
decodšg
 
š
 
pu»
 
Lua
.

11 -- 
h‰p
:

14 -- 
JSON
 = 
lßdfe
 "JSON.lua" -- 
Úe
-
time
 
lßd
 
of
 
the
 
routšes


16 -- 
loÿl
 
lua_v®ue
 = 
JSON
:
decode
(
¿w_jsÚ_‹xt
)

18 -- 
loÿl
 
¿w_jsÚ_‹xt
 = 
JSON
:
’code
(
lua_bË_Ü_v®ue
)

19 -- 
loÿl
 
´‘ty_jsÚ_‹xt
 = 
JSON
:
’code_´‘ty
(
lua_bË_Ü_v®ue
è-- "´‘ty…rš‹d" 
v”siÚ
 
humª
 
»adab™y


22 -- 
DECODING


24 -- 
JSON
 = (
lßdfe
 "JSON.lua")(è-- 
Úe
-
time
 
lßd
 
of
 
the
 
routšes


26 -- 
loÿl
 
lua_v®ue
 = 
JSON
:
decode
(
¿w_jsÚ_‹xt
)

28 -- 
If
 
the
 
JSON
 
‹xt
 
is
 
ª
 
objeù
 
Ü
‡À
¬¿y
, 
	ge
.
	gg
.

30 -- 
Ü


33 -- 
the
 
»suÉ
 
is
 
a
 
Lua
 
	gbË
, 
	ge
.
	gg
.

34 -- { 
	gwh©
 = "books", 
	gcouÁ
 = 3 }

35 -- 
	gÜ


39 -- 
The
 
’code
 
ªd
 
decode
 
routšes
 
acû±
 
ª
 
İtiÚ®
 
£cÚd
 
	g¬gum’t
, "‘c", 
which
 
is
 
nÙ
 
	gu£d


40 -- 
duršg
 
’codšg
 
Ü
 
	gdecodšg
, 
but
 
upÚ
 
”rÜ
 
is
 
·s£d
 
®Úg
 
to
ƒ¼Ü 
	ghªdËrs
. 
It
 
ÿn
 
be
 
of
 
	gªy


41 -- 
ty³
 (
šşudšg
 
n
).

43 -- 
W™h
 
mo¡
 
”rÜs
 
duršg
 
	gdecodšg
, 
this
 
code
 
	gÿÎs


45 -- 
	gJSON
:
ÚDecodeE¼Ü
(
mes§ge
, 
‹xt
, 
loÿtiÚ
, 
‘c
)

47 -- 
w™h
 
a
 
mes§ge
 
about
 
the
 
	g”rÜ
, 
ªd
 
	gknown
,h
JSON
 
‹xt
 
bešg
 
·r£d
‡ndh
by‹
 
	gcouÁ


48 -- 
wh”e
 
the
 
´obËm
 
was
 
	gdiscov”ed
. 
You
 
ÿn
 
»¶aû
h 
	gJSON
:
	$ÚDecodeE¼Ü
(è
w™h
 
your


49 -- 
own
 
funùiÚ
.

51 -- 
The
  
	$ÚDecodeE¼Ü
(è
m”–y
 
augm’ts
 
the
 
mes§ge
 
w™h
 
d©a
 
about
h
‹xt
 
ªd
he

52 -- 
loÿtiÚ
 
	`known
 (
ªd
 
a
 
£cÚd
 '‘c' 
¬gum’t
 
had
 
b“n
 
´ovided
 
to
 
	`decode
(), 
™s
 
v®ue
 
is


53 -- 
cked
 
Úto
 
the
 
mes§ge
 
as
 
w–l
), 
ªd
 
th’
 
ÿÎs
 
JSON
.
	`as£¹
(), 
which
 
™£lf
 
deçuÉs
 
to
 
Lua
's

54 -- 
but
-
š
 
	`as£¹
(), 
ªd
 
ÿn
 
®so
 
be
 
ov”ridd’
.

56 -- 
FÜ
 
exam¶e
, 
š
 
ª
 
Adobe
 
LighŒoom
 
¶ugš
, 
you
 
might
 
u£
 
som‘hšg
 
like


58 -- 
funùiÚ
 
JSON
:
	`ÚDecodeE¼Ü
(
mes§ge
, 
‹xt
, 
loÿtiÚ
, 
‘c
)

59 -- 
LrE¼Üs
.
	`throwU£rE¼Ü
("Internal Error: invalid JSON data")

60 -- 
’d


62 -- 
Ü
 
ev’
 
ju¡


64 -- 
funùiÚ
 
JSON
.
	`as£¹
(
mes§ge
)

65 -- 
LrE¼Üs
.
	`throwU£rE¼Ü
("IÁ”ÇÈE¼Ü: " .. 
mes§ge
)

66 -- 
’d


68 -- 
If
 
JSON
:
	$decode
(è
is
 
·s£d
 
a
 
n
, 
this
 i 
ÿÎed
 
š¡—d
:

70 -- 
JSON
:
	`ÚDecodeOfNE¼Ü
(
mes§ge
, 
n
,‚, 
‘c
)

72 -- 
ªd
 
JSON
:
	$decode
(è
is
 
·s£d
 
HTML
 
š¡—d
 
of
 
JSON
, 
this
 i 
ÿÎed
:

74 -- 
JSON
:
	`ÚDecodeOfHTMLE¼Ü
(
mes§ge
, 
‹xt
, 
n
, 
‘c
)

76 -- 
The
 
u£
 
of
 
the
 
fou¹h
 '‘c' 
¬gum’t
 
®lows
 
¡rÚg”
 
coÜdš©iÚ
 
b‘w“n
 
decodšg
 
ªd
 
”rÜ


77 -- 
»pÜtšg
, 
e¥ecŸÎy
 
wh’
 
you
 
´ovide
 
your
 
own
 
”rÜ
-
hªdlšg
 
routšes
. 
CÚtšušg
 
w™h
 
the


78 -- 
the
 
Adobe
 
LighŒoom
 
¶ugš
 
exam¶e
:

80 -- 
funùiÚ
 
JSON
:
	`ÚDecodeE¼Ü
(
mes§ge
, 
‹xt
, 
loÿtiÚ
, 
‘c
)

81 -- 
loÿl
 
nÙe
 = "Internal Error: invalid JSON data"

82 -- 
	`ty³
(
‘c
èğ'bË' 
ªd
ƒtc.
phÙo
 
th’


83 -- 
nÙe
 =‚Ù.. " wh´oûssšg fÜ " .. 
‘c
.
phÙo
:
	`g‘FÜm©‹dM‘ad©a
('fileName')

84 -- 
’d


85 -- 
LrE¼Üs
.
	`throwU£rE¼Ü
(
nÙe
)

86 -- 
’d


91 -- 
i
, 
phÙo
 
š
 
	$aœs
(
phÙosToProûss
) do

94 -- 
loÿl
 
d©a
 = 
JSON
:
	`decode
(
someJsÚText
, { 
phÙo
 =…hÙØ
	}
})

97 -- 
’d


103 -- 
DECODING
 
AND
 
STRICT
 
TYPES


105 -- 
Beÿu£
 
bÙh
 
JSON
 
objeùs
 
ªd
 JSON 
¬¿ys
 
¬e
 
cÚv”‹d
 
to
 
Lua
 
bËs
, 
	g™
's‚ot‚ormally

106 -- 
possibË
 
to
 
‹Î
 
which
 
a
 
Lua
 
bË
 
ÿme
 
	gäom
, 
Ü
 
gu¬ª‹e
 
	gdecode
-
’code
 
	ground
-
	gŒ


107 -- 
	gequiv®’cy
.

109 -- 
	gHowev”
, 
you
 
’abË
 
	g¡riùTy³s
, 
	ge
.
	gg
.

111 -- 
	gJSON
 = (
lßdfe
 "JSON.lua")(è--
lßd
 
the
 
routšes


112 -- 
JSON
.
¡riùTy³s
 = 
Œue


114 -- 
th’
 
the
 
Lua
 
bË
 
»suÉšg
 
äom
h
decodšg
 
of
 
a
 
JSON
 
objeù
 
Ü
 JSON 
¬¿y
 
is
 
m¬ked
 
vŸ
 Lua

115 -- 
m‘©abË
, 
so
 
th©
 
wh’
 
	g»
-
’coded
 
w™h
 
	gJSON
:
	$’code
(è
™
 
’ds
 
up
 
as
 
the
 
­´İrŸ‹
 
JSON
 
ty³
.

117 -- (
This
 
is
 
nÙ
 
the
  
beÿu£
 
Ùh”
 
routšes
 
may
‚Ù 
wÜk
 
w–l
 
w™h
 
bËs
 
th©
 
have
 
a


118 -- 
m‘©abË
 
£t
, 
exam¶e
, 
LighŒoom
 
API
 
ÿÎs
.)

121 -- 
ENCODING


123 -- 
JSON
 = (
lßdfe
 "JSON.lua")(è-- 
Úe
-
time
 
lßd
 
of
 
the
 
routšes


125 -- 
loÿl
 
¿w_jsÚ_‹xt
 = 
JSON
:
	`’code
(
lua_bË_Ü_v®ue
)

126 -- 
loÿl
 
´‘ty_jsÚ_‹xt
 = 
JSON
:
	`’code_´‘ty
(
lua_bË_Ü_v®ue
è-- "´‘ty…rš‹d" 
v”siÚ
 
humª
 
»adab™y


128 -- 
On
 
”rÜ
 
duršg
 
’codšg
, 
this
 
code
 
ÿÎs
:

130 -- 
JSON
:
	`ÚEncodeE¼Ü
(
mes§ge
, 
‘c
)

132 -- 
which
 
you
 
ÿn
 
ov”ride
 
š
 
your
 
loÿl
 
JSON
 
objeù
.

135 -- 
SUMMARY
 
OF
 
METHODS
 
YOU
 
CAN
 
OVERRIDE
 
IN
 
YOUR
 
LOCAL
 
LUA
 
JSON
 
OBJECT


137 -- 
as£¹


138 -- 
ÚDecodeE¼Ü


139 -- 
ÚDecodeOfNE¼Ü


140 -- 
ÚDecodeOfHTMLE¼Ü


141 -- 
ÚEncodeE¼Ü


143 -- 
If
 
you
 
wªt
 
to
 
ü—‹
 
a
 
£·¿‹
 
Lua
 
JSON
 
objeù
 
w™h
 
™s
 
own
 
”rÜ
 
hªdËrs
,

144 -- 
you
 
ÿn
 
»lßd
 
JSON
.
lua
 
Ü
 
u£
 
the
 :
	$Ãw
(è
m‘hod
.

149 
loÿl
 
authÜ
 = "-[ JSON.lu¨·ckagby Jefäey Fr›dÈ(h‰p://»gex.šfo/blog/lua/jsÚ), v”siÚ " .. 
	`to¡ršg
(
VERSION
) .. " ]-"

150 
loÿl
 
isA¼ay
 = { 
__to¡ršg
 = 
	`funùiÚ
(è "JSON‡¼ay" 
’d
 
	}
} isA¼ay.
__šdex
 = isArray

151 
loÿl
 
isObjeù
 = { 
__to¡ršg
 = 
funùiÚ
(è "JSON objeù" 
’d
 } isObjeù.
__šdex
 = isObject

154 
funùiÚ
 
OBJDEF
:
	$ÃwA¼ay
(
tbl
)

155  
	`£tm‘©abË
(
tbl
 
Ü
 {
	}
}, 
	gisA¼ay
)

156 
’d


158 
funùiÚ
 
	gOBJDEF
:
	$ÃwObjeù
(
tbl
)

159  
	`£tm‘©abË
(
tbl
 
Ü
 {
	}
}, 
	gisObjeù
)

160 
’d


162 
loÿl
 
funùiÚ
 
unicode_cod•ošt_as_utf8
(
cod•ošt
)

164 -- 
cod•ošt
 
is
 
a
 
	gnumb”


166 
	gcod•ošt
 <ğ127 
th’


167  
¡ršg
.(
cod•ošt
)

169 
–£if
 
cod•ošt
 <ğ2047 
th’


171 -- 110
yyyxx
 10xxxxxx <-- 
u£ful
 
nÙ©iÚ
 
äom
 
h‰p
:

173 
loÿl
 
high·¹
 = 
m©h
.
	`æoÜ
(
cod•ošt
 / 0x40)

174 
loÿl
 
low·¹
 = 
cod•ošt
 - (0x40 * 
high·¹
)

175  
¡ršg
.(0xC0 + 
high·¹
,

176 0x80 + 
low·¹
)

178 
–£if
 
cod•ošt
 <ğ65535 
th’


180 -- 1110
yyyy
 10
yyyyxx
 10xxxxxx

182 
loÿl
 
high·¹
 = 
m©h
.
	`æoÜ
(
cod•ošt
 / 0x1000)

183 
loÿl
 
»mašd”
 = 
cod•ošt
 - 0x1000 * 
high·¹


184 
loÿl
 
mid·¹
 = 
m©h
.
	`æoÜ
(
»mašd”
 / 0x40)

185 
loÿl
 
low·¹
 = 
»mašd”
 - 0x40 * 
mid·¹


187 
high·¹
 = 0xE0 + highpart

188 
mid·¹
 = 0x80 + midpart

189 
low·¹
 = 0x80 +†owpart

192 -- 
Check
 
ª
 
šv®id
 
	`ch¬aù”
 (
thªks
 
Andy
 
R
. 
©
 
Adobe
).

193 -- 
S“
 
bË
 3.7, 
·ge
 93, 
š
 
h‰p
:

195 iàĞ
high·¹
 =ğ0xE0 
ªd
 
mid·¹
 < 0xA0 ) 
Ü


196 Ğ
high·¹
 =ğ0xED 
ªd
 
mid·¹
 > 0x9F ) 
Ü


197 Ğ
high·¹
 =ğ0xF0 
ªd
 
mid·¹
 < 0x90 ) 
Ü


198 Ğ
high·¹
 =ğ0xF4 
ªd
 
mid·¹
 > 0x8F )

199 
th’


202  
¡ršg
.(
high·¹
,

203 
mid·¹
,

204 
low·¹
)

205 
’d


209 -- 11110
zzz
 10
zzyyyy
 10
yyyyxx
 10xxxxxx

211 
loÿl
 
high·¹
 = 
m©h
.
	`æoÜ
(
cod•ošt
 / 0x40000)

212 
loÿl
 
»mašd”
 = 
cod•ošt
 - 0x40000 * 
high·¹


213 
loÿl
 
midA
 = 
m©h
.
	`æoÜ
(
»mašd”
 / 0x1000)

214 
»mašd”
 =„emašd” - 0x1000 * 
midA


215 
loÿl
 
midB
 = 
m©h
.
	`æoÜ
(
»mašd”
 / 0x40)

216 
loÿl
 
low·¹
 = 
»mašd”
 - 0x40 * 
midB


218  
¡ršg
.(0xF0 + 
high·¹
,

219 0x80 + 
midA
,

220 0x80 + 
midB
,

221 0x80 + 
low·¹
)

222 
’d


223 
’d


225 
funùiÚ
 
OBJDEF
:
	$ÚDecodeE¼Ü
(
mes§ge
, 
‹xt
, 
loÿtiÚ
, 
‘c
)

226 
‹xt
 
th’


227 
loÿtiÚ
 
th’


228 
mes§ge
 = 
¡ršg
.
	`fÜm©
("% © ch¬ %d of: %s", mes§ge, 
loÿtiÚ
, 
‹xt
)

230 
mes§ge
 = 
¡ršg
.
	`fÜm©
("%s: %s", mes§ge, 
‹xt
)

231 
’d


232 
’d


233 
‘c
 ~ğ
n
 
th’


234 
mes§ge
 = mes§g.. " (" .. 
OBJDEF
:
	`’code
(
‘c
) .. ")"

235 
’d


237 
£lf
.
as£¹
 
th’


238 
£lf
.
	$as£¹
(
çl£
, 
mes§ge
)

240 
	$as£¹
(
çl£
, 
mes§ge
)

241 
’d


242 
’d


244 
OBJDEF
.
ÚDecodeOfNE¼Ü
 = OBJDEF.
ÚDecodeE¼Ü


245 
OBJDEF
.
ÚDecodeOfHTMLE¼Ü
 = OBJDEF.
ÚDecodeE¼Ü


247 
funùiÚ
 
OBJDEF
:
	$ÚEncodeE¼Ü
(
mes§ge
, 
‘c
)

248 
‘c
 ~ğ
n
 
th’


249 
mes§ge
 = mes§g.. " (" .. 
OBJDEF
:
	`’code
(
‘c
) .. ")"

250 
’d


252 
£lf
.
as£¹
 
th’


253 
£lf
.
	$as£¹
(
çl£
, 
mes§ge
)

255 
	$as£¹
(
çl£
, 
mes§ge
)

256 
’d


257 
’d


259 
loÿl
 
funùiÚ
 
	`grok_numb”
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

261 -- 
G¿b
 
the
 
š‹g”
 
·¹


263 
loÿl
 
š‹g”_·¹
 = 
‹xt
:
	`m©ch
('^-?[1-9]%d*', 
¡¬t
)

264 
Ü
 
‹xt
:
	`m©ch
("^-?0", 
¡¬t
)

266 
nÙ
 
š‹g”_·¹
 
th’


267 
£lf
:
	`ÚDecodeE¼Ü
("ex³ùed‚umb”", 
‹xt
, 
¡¬t
, 
‘c
)

268 
’d


270 
loÿl
 
i
 = 
¡¬t
 + 
š‹g”_·¹
:
	`Ën
()

273 -- 
G¿b
 
ª
 
İtiÚ®
 
decim®
 
·¹


275 
loÿl
 
decim®_·¹
 = 
‹xt
:
	`m©ch
('^%.%d+', 
i
è
Ü
 ""

277 
i
 = i + 
decim®_·¹
:
	`Ën
()

280 -- 
G¿b
 
ª
 
İtiÚ®
 
expÚ’tŸl
 
·¹


282 
loÿl
 
expÚ’t_·¹
 = 
‹xt
:
	`m©ch
('^[eE][-+]?%d+', 
i
è
Ü
 ""

284 
i
 = i + 
expÚ’t_·¹
:
	$Ën
()

286 
loÿl
 
fuÎ_numb”_‹xt
 = 
š‹g”_·¹
 .. 
decim®_·¹
 .. 
expÚ’t_·¹


287 
loÿl
 
as_numb”
 = 
	$tÚumb”
(
fuÎ_numb”_‹xt
)

289 
nÙ
 
as_numb”
 
th’


290 
£lf
:
	`ÚDecodeE¼Ü
("bad‚umb”", 
‹xt
, 
¡¬t
, 
‘c
)

291 
’d


293  
as_numb”
, 
i


294 
’d


297 
loÿl
 
funùiÚ
 
	$grok_¡ršg
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

299 
‹xt
:
	`sub
(
¡¬t
,¡¬tè~ğ'"' 
th’


300 
£lf
:
	`ÚDecodeE¼Ü
("ex³ùed sŒšg' İ’šg quÙe", 
‹xt
, 
¡¬t
, 
‘c
)

301 
’d


303 
loÿl
 
i
 = 
¡¬t
 + 1 -- +1 
to
 
by·ss
 
the
 
š™Ÿl
 
quÙe


304 
loÿl
 
‹xt_Ën
 = 
‹xt
:
	$Ën
()

305 
loÿl
 
VALUE
 = ""

306 
i
 <ğ
‹xt_Ën
 do

307 
loÿl
 
c
 = 
‹xt
:
	$sub
(
i
,i)

308 
c
 =ğ'"' 
th’


309  
VALUE
, 
i
 + 1

310 
’d


311 
c
 ~ğ'\\' 
th’


312 
VALUE
 = VALUE .. 
c


313 
i
 = i + 1

314 
–£if
 
‹xt
:
	`m©ch
('^\\b', 
i
è
th’


315 
VALUE
 = VALUE .. "\b"

316 
i
 = i + 2

317 
–£if
 
‹xt
:
	`m©ch
('^\\f', 
i
è
th’


318 
VALUE
 = VALUE .. "\f"

319 
i
 = i + 2

320 
–£if
 
‹xt
:
	`m©ch
('^\\n', 
i
è
th’


321 
VALUE
 = VALUE .. "\n"

322 
i
 = i + 2

323 
–£if
 
‹xt
:
	`m©ch
('^\\r', 
i
è
th’


324 
VALUE
 = VALUE .. "\r"

325 
i
 = i + 2

326 
–£if
 
‹xt
:
	`m©ch
('^\\t', 
i
è
th’


327 
VALUE
 = VALUE .. "\t"

328 
i
 = i + 2

330 
loÿl
 
hex
 = 
‹xt
:
	`m©ch
('^\\u([0123456789aAbBcCdDeEfF][0123456789aAbBcCdDeEfF][0123456789aAbBcCdDeEfF][0123456789aAbBcCdDeEfF])', 
i
)

331 
hex
 
th’


332 
i
 = i + 6 -- 
by·ss
 
wh©
 
we
 
ju¡
 
»ad


334 -- 
We
 
have
 
a
 
Unicode
 
cod•ošt
. 
It
 
could
 
be
 
¡ªd®Úe
, 
Ü
 
š
 
the
 
´İ”
 
¿nge
 
ªd


335 -- 
fŞlowed
 
by
 
ªÙh”
 
š
 
a
 
¥ecific
 
¿nge
, 
™
'll be‡wo-code surrogate…air.

336 
loÿl
 
cod•ošt
 = 
	$tÚumb”
(
hex
, 16)

337 
cod•ošt
 >ğ0xD800 
ªd
 cod•ošˆ<ğ0xDBFF 
th’


338 -- 
™
's‡ hi surrogate... see whether we have‡ following†ow

339 
loÿl
 
lo_su¼og©e
 = 
‹xt
:
	`m©ch
('^\\u([dD][cdefCDEF][0123456789aAbBcCdDeEfF][0123456789aAbBcCdDeEfF])', 
i
)

340 
lo_su¼og©e
 
th’


341 
i
 = i + 6 -- 
by·ss
 
the
 
low
 
su¼og©e
 
we
 
ju¡
 
»ad


342 
cod•ošt
 = 0x2400 + (cod•ošˆ- 0xD800è* 0x400 + 
	$tÚumb”
(
lo_su¼og©e
, 16)

344 -- 
nÙ
 
a
 
´İ”
 
low
, 
so
 
we
'll just†eavehe first codepoint‡s is‡nd spit it out.

345 
’d


346 
’d


347 
VALUE
 = VALUE .. 
	$unicode_cod•ošt_as_utf8
(
cod•ošt
)

351 -- 
ju¡
 
·ss
 
through
 
wh©
'sƒscaped

352 
VALUE
 = VALUE .. 
‹xt
:
	`m©ch
('^\\(.)', 
i
)

353 
i
 = i + 2

354 
’d


355 
’d


356 
’d


358 
£lf
:
	`ÚDecodeE¼Ü
("unşo£d sŒšg", 
‹xt
, 
¡¬t
, 
‘c
)

359 
’d


361 
loÿl
 
funùiÚ
 
	$sk_wh™e¥aû
(
‹xt
, 
¡¬t
)

363 
loÿl
 
m©ch_¡¬t
, 
m©ch_’d
 = 
‹xt
:
	`fšd
("^[ \n\r\t]+", 
¡¬t
è-- [
h‰p
:

364 
m©ch_’d
 
th’


365  
m©ch_’d
 + 1

367  
¡¬t


368 
’d


369 
’d


371 
loÿl
 
grok_Úe
 -- 
assigÃd
 
Ï‹r


373 
loÿl
 
funùiÚ
 
	$grok_objeù
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

374 
nÙ
 
‹xt
:
	`sub
(
¡¬t
,¡¬tè=ğ'{' 
th’


375 
£lf
:
	`ÚDecodeE¼Ü
("ex³ùed '{'", 
‹xt
, 
¡¬t
, 
‘c
)

376 
’d


378 
loÿl
 
i
 = 
	`sk_wh™e¥aû
(
‹xt
, 
¡¬t
 + 1è-- +1 
to
 
sk
 
the
 '{'

380 
loÿl
 
VALUE
 = 
£lf
.
¡riùTy³s
 
ªd
 s–f:
ÃwObjeù
 { 
	}
} 
Ü
 { }

382 
‹xt
:
sub
(
i
,iè=ğ'}' 
th’


383  
VALUE
, 
i
 + 1

384 
’d


385 
loÿl
 
‹xt_Ën
 = 
‹xt
:
	$Ën
()

386 
i
 <ğ
‹xt_Ën
 do

387 
loÿl
 
key
, 
Ãw_i
 = 
	$grok_¡ršg
(
£lf
, 
‹xt
, 
i
, 
‘c
)

389 
i
 = 
	$sk_wh™e¥aû
(
‹xt
, 
Ãw_i
)

391 
‹xt
:
	`sub
(
i
, iè~ğ':' 
th’


392 
£lf
:
	`ÚDecodeE¼Ü
("ex³ùed cŞÚ", 
‹xt
, 
i
, 
‘c
)

393 
’d


395 
i
 = 
	`sk_wh™e¥aû
(
‹xt
, i + 1)

397 
loÿl
 
v®
, 
Ãw_i
 = 
	$grok_Úe
(
£lf
, 
‹xt
, 
i
)

399 
VALUE
[
key
] = 
v®


402 -- 
Ex³ù
 
now
 
e™h”
 '}' 
to
 
’d
 
thšgs
, 
Ü
 
a
 ','Ø
®low
 
us
o .

404 
i
 = 
	$sk_wh™e¥aû
(
‹xt
, 
Ãw_i
)

406 
loÿl
 
c
 = 
‹xt
:
	$sub
(
i
,i)

408 
c
 =ğ'}' 
th’


409  
VALUE
, 
i
 + 1

410 
’d


412 
‹xt
:
	`sub
(
i
, iè~ğ',' 
th’


413 
£lf
:
	`ÚDecodeE¼Ü
("ex³ùed comm¨Ü '}'", 
‹xt
, 
i
, 
‘c
)

414 
’d


416 
i
 = 
	`sk_wh™e¥aû
(
‹xt
, i + 1)

417 
’d


419 
£lf
:
	`ÚDecodeE¼Ü
("unşo£d '{'", 
‹xt
, 
¡¬t
, 
‘c
)

420 
’d


422 
loÿl
 
funùiÚ
 
	$grok_¬¿y
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

423 
nÙ
 
‹xt
:
	`sub
(
¡¬t
,¡¬tè=ğ'[' 
th’


424 
£lf
:
	`ÚDecodeE¼Ü
("ex³ùed '['", 
‹xt
, 
¡¬t
, 
‘c
)

425 
’d


427 
loÿl
 
i
 = 
	`sk_wh™e¥aû
(
‹xt
, 
¡¬t
 + 1è-- +1 
to
 
sk
 
the
 '['

428 
loÿl
 
VALUE
 = 
£lf
.
¡riùTy³s
 
ªd
 s–f:
ÃwA¼ay
 { 
	}
} 
Ü
 { }

429 
‹xt
:
sub
(
i
,iè=ğ']' 
th’


430  
VALUE
, 
	gi
 + 1

431 
’d


433 
loÿl
 
	g‹xt_Ën
 = 
‹xt
:
	$Ën
()

434 
i
 <ğ
‹xt_Ën
 do

435 
loÿl
 
v®
, 
Ãw_i
 = 
	$grok_Úe
(
£lf
, 
‹xt
, 
i
)

437 
bË
.
	$š£¹
(
VALUE
, 
v®
)

439 
i
 = 
	`sk_wh™e¥aû
(
‹xt
, 
Ãw_i
)

442 -- 
Ex³ù
 
now
 
e™h”
 ']' 
to
 
’d
 
thšgs
, 
Ü
 
a
 ','Ø
®low
 
us
o .

444 
loÿl
 
c
 = 
‹xt
:
	$sub
(
i
,i)

445 
c
 =ğ']' 
th’


446  
VALUE
, 
i
 + 1

447 
’d


448 
‹xt
:
	`sub
(
i
, iè~ğ',' 
th’


449 
£lf
:
	`ÚDecodeE¼Ü
("ex³ùed comm¨Ü '['", 
‹xt
, 
i
, 
‘c
)

450 
’d


451 
i
 = 
	`sk_wh™e¥aû
(
‹xt
, i + 1)

452 
’d


453 
£lf
:
	`ÚDecodeE¼Ü
("unşo£d '['", 
‹xt
, 
¡¬t
, 
‘c
)

454 
’d


457 
grok_Úe
 = 
	`funùiÚ
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

458 -- 
Sk
 
ªy
 
wh™e¥aû


459 
¡¬t
 = 
	$sk_wh™e¥aû
(
‹xt
, 
¡¬t
)

461 
¡¬t
 > 
‹xt
:
	$Ën
(è
th’


462 
£lf
:
	`ÚDecodeE¼Ü
("uÃx³ùedƒnd oà¡ršg", 
‹xt
, 
n
, 
‘c
)

463 
’d


465 
‹xt
:
	`fšd
('^"', 
¡¬t
è
th’


466  
	$grok_¡ršg
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

468 
–£if
 
‹xt
:
	`fšd
('^[-0123456789 ]', 
¡¬t
è
th’


469  
	$grok_numb”
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

471 
–£if
 
‹xt
:
	`fšd
('^%{', 
¡¬t
è
th’


472  
	$grok_objeù
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

474 
–£if
 
‹xt
:
	`fšd
('^%[', 
¡¬t
è
th’


475  
	$grok_¬¿y
(
£lf
, 
‹xt
, 
¡¬t
, 
‘c
)

477 
–£if
 
‹xt
:
	`fšd
('^Œue', 
¡¬t
è
th’


478  
Œue
, 
¡¬t
 + 4

480 
–£if
 
‹xt
:
	`fšd
('^çl£', 
¡¬t
è
th’


481  
çl£
, 
¡¬t
 + 5

483 
–£if
 
‹xt
:
	`fšd
('^nuÎ', 
¡¬t
è
th’


484  
n
, 
¡¬t
 + 4

487 
£lf
:
	`ÚDecodeE¼Ü
("ÿn'ˆ·r£ JSON", 
‹xt
, 
¡¬t
, 
‘c
)

488 
’d


489 
’d


491 
funùiÚ
 
OBJDEF
:
	$decode
(
‹xt
, 
‘c
)

492 
	`ty³
(
£lf
è~ğ'bË' 
Ü
 s–f.
__šdex
 ~ğ
OBJDEF
 
th’


493 
OBJDEF
:
	`ÚDecodeE¼Ü
("JSON:decodmu¡ bÿÎed iÀm‘hod fÜm©", 
n
,‚, 
‘c
)

494 
’d


496 
‹xt
 =ğ
n
 
th’


497 
£lf
:
	`ÚDecodeOfNE¼Ü
(
¡ršg
.
	`fÜm©
("n…as£dØJSON:decode()"), 
n
,‚, 
‘c
)

498 
–£if
 
	`ty³
(
‹xt
è~ğ'¡ršg' 
th’


499 
£lf
:
	`ÚDecodeE¼Ü
(
¡ršg
.
	`fÜm©
("ex³ùed sŒšg‡rgum’ˆtØJSON:decode(), gÙ %s", 
	`ty³
(
‹xt
)), 
n
,‚, 
‘c
)

500 
’d


502 
‹xt
:
	`m©ch
('^%s*$'è
th’


503  
n


504 
’d


506 
‹xt
:
	`m©ch
('^%s*<'è
th’


507 -- 
Cª
'ˆbJSON... we'
Î
 
assume
 
™
's HTML

508 
£lf
:
	`ÚDecodeOfHTMLE¼Ü
(
¡ršg
.
	`fÜm©
("htmÈ·s£dØJSON:decode()"), 
‹xt
, 
n
, 
‘c
)

509 
’d


512 -- 
Ensu»
 
th©
 
™
's‚ot UTF-32 or UTF-16.

513 -- 
Tho£
 
¬e
 
³rãùly
 
v®id
 
’codšgs
 
	`JSON
 (
as
 
³r
 
RFC
 4627 
£ùiÚ
 3),

514 -- 
but
 
this
 
·ckage
 
ÿn
't handlehem.

516 
‹xt
:
	$sub
(1,1):
	`by‹
(è=ğ0 
	`Ü
 (
‹xt
:
	`Ën
(è>ğ2 
ªd
ext:
	$sub
(2,2):
	`by‹
(è=ğ0è
th’


517 
£lf
:
	`ÚDecodeE¼Ü
("JSON…ackaggrok Úly UTF-8, sÜry", 
‹xt
, 
n
, 
‘c
)

518 
’d


520 
loÿl
 
sucûss
, 
v®ue
 = 
	$pÿÎ
(
grok_Úe
, 
£lf
, 
‹xt
, 1, 
‘c
)

521 
sucûss
 
th’


522  
v®ue


524 -- 
should
 
Ãv”
 
g‘
 
h”e
... 
JSON
 
·r£
 
”rÜs
 should 
have
 
b“n
 
ÿught
 
—¾›r


525 
	$as£¹
(
çl£
, 
v®ue
)

526  
n


527 
’d


528 
’d


530 
loÿl
 
funùiÚ
 
	$back¦ash_»¶aûm’t_funùiÚ
(
c
)

531 
c
 =ğ"\n" 
th’


533 
–£if
 
c
 =ğ"\r" 
th’


535 
–£if
 
c
 =ğ"\t" 
th’


537 
–£if
 
c
 =ğ"\b" 
th’


539 
–£if
 
c
 =ğ"\f" 
th’


541 
–£if
 
c
 =ğ'"' 
th’


543 
–£if
 
c
 =ğ'\\' 
th’


546  
¡ršg
.
	`fÜm©
("\\u%04x", 
c
:
	$by‹
())

547 
’d


548 
’d


550 
loÿl
 
ch¬s_to_be_esÿ³d_š_JSON_¡ršg


552 .. '"' -- 
şass
 
sub
-
·‰”n
 
to
 
m©ch
 
a
 
quÙe


553 .. '%\\' -- 
şass
 
sub
-
·‰”n
 
to
 
m©ch
 
a
 
back¦ash


554 .. '%z' -- 
şass
 
sub
-
·‰”n
 
to
 
m©ch
 
a
 
nuÎ


555 .. '\001' .. '-' .. '\031' -- 
şass
 
sub
-
·‰”n
 
to
 
m©ch
 
cÚŒŞ
 
ch¬aù”s


558 
loÿl
 
funùiÚ
 
	$jsÚ_¡ršg_l™”®
(
v®ue
)

559 
loÿl
 
Ãwv®
 = 
v®ue
:
	$gsub
(
ch¬s_to_be_esÿ³d_š_JSON_¡ršg
, 
back¦ash_»¶aûm’t_funùiÚ
)

560  '"' .. 
Ãwv®
 .. '"'

561 
’d


563 
loÿl
 
funùiÚ
 
	`objeù_Ü_¬¿y
(
£lf
, 
T
, 
‘c
)

565 -- 
We
 
Ãed
 
to
 
š¥eù
 
®l
 
the
 
keys
... 
th”e
 
¬e
 
ªy
 
¡ršgs
, 
we
'll converto‡ JSON

566 -- 
objeù
. 
If
 
th”e
 
¬e
 
Úly
 
numb”s
, 
™
's‡ JSON‡rray.

568 -- 
If
 
we
'Î bcÚv”tšgØ¨JSON objeù, we'
Î
 
wªt
 
to
 
sÜt
 
the
 
keys
 
so
 
th©
he

569 -- 
’d
 
»suÉ
 
is
 
d‘”mši¡ic
.

571 
loÿl
 
¡ršg_keys
 = { 
	}
}

572 
loÿl
 
£’_numb”_key
 = 
çl£


573 
loÿl
 
maximum_numb”_key


575 
key
 
š
 
	$·œs
(
T
) do

576 
	`ty³
(
key
è=ğ'numb”' 
th’


577 
£’_numb”_key
 = 
Œue


578 
nÙ
 
maximum_numb”_key
 
Ü
 maximum_numb”_key < 
key
 
th’


579 
maximum_numb”_key
 = 
key


580 
’d


581 
–£if
 
	`ty³
(
key
è=ğ'¡ršg' 
th’


582 
bË
.
	$š£¹
(
¡ršg_keys
, 
key
)

584 
£lf
:
	`ÚEncodeE¼Ü
("ÿn'ˆ’codbË w™h‡ key oàty³ " .. 
	`ty³
(
key
), 
‘c
)

585 
’d


586 
’d


588 
£’_numb”_key
 
ªd
 #¡ršg_key > 0 
th’


590 -- 
Mixed
 
key
 
ty³s
... 
dÚ
't know whato do, so bail

592 
£lf
:
	`ÚEncodeE¼Ü
("¨bË w™h bÙh‚um”iøªd sŒšg key could bª objeù o¸¬¿y;‡bÜtšg", 
‘c
)

594 
–£if
 #¡ršg_key =ğ0 
th’


596 -- 
An
 
¬¿y


598 
£’_numb”_key
 
th’


599  
n
, 
maximum_numb”_key
 -- 
ª
 
¬¿y


602 -- 
An
 
em±y
 
bË
...

604 
	`to¡ršg
(
T
è=ğ"JSON‡¼ay" 
th’


605  
n


606 
–£if
 
	`to¡ršg
(
T
è=ğ"JSON objeù" 
th’


607  { 
	}
}

609 -- 
have
 
to
 
guess
, 
so
 
	gwe
'll…ick‡rray, sinceƒmpty‡rrays‡re†ikely more commonhanƒmpty objects

610  
n


611 
’d


612 
’d


615 -- 
An
 
	gobjeù
, 
so
  
a
 
li¡
 
of
 
	gkeys


617 
	gbË
.
	$sÜt
(
¡ršg_keys
)

618  
¡ršg_keys


619 
’d


620 
’d


623 -- 
Encode


625 
loÿl
 
’code_v®ue
 -- 
mu¡
 
´edeş¬e
 
beÿu£
 
™
 
ÿÎs
 
™£lf


626 
funùiÚ
 
	$’code_v®ue
(
£lf
, 
v®ue
, 
·»Ás
, 
‘c
)

629 
v®ue
 =ğ
n
 
th’


631 
’d


633 
	`ty³
(
v®ue
è=ğ'¡ršg' 
th’


634  
	$jsÚ_¡ršg_l™”®
(
v®ue
)

635 
–£if
 
	`ty³
(
v®ue
è=ğ'numb”' 
th’


636 
v®ue
 ~ğv®u
th’


638 -- 
	`NaN
 (
NÙ
 
a
 
Numb”
).

639 -- 
JSON
 
has
 
no
 
NaN
, 
so
 
we
 
have
 
to
 
fudge
 
the
 
be¡
 w
ÿn
. 
This
 
should
 
»®ly
 
be
 
a
 
·ckage
 
İtiÚ
.

642 
–£if
 
v®ue
 >ğ
m©h
.
huge
 
th’


644 -- 
Pos™ive
 
šfš™y
. 
JSON
 
has
 
no
 
INF
, 
so
 
we
 
have
 
to
 
fudge
 
the
 
be¡
 w
ÿn
. 
This
 
should


645 -- 
»®ly
 
be
 
a
 
·ckage
 
İtiÚ
. 
NÙe
: 
©
 
Ëa¡
 
w™h
 
some
 
im¶em’tiÚs
, 
pos™ive
 
šfš™y


646 -- 
is
 
bÙh
 ">ğm©h.huge" 
ªd
 "<ğ-m©h.huge", 
which
 
makes
 
no
 
£n£
 
but
 
th©
's how it is.

647 -- 
Neg©ive
 
šfš™y
 
is
 
´İ”ly
 "<ğ-m©h.huge". 
So
, 
we
 
mu¡
 
be
 
su»
 
to
 
check
 
the
 ">="

648 -- 
fœ¡
.

651 
–£if
 
v®ue
 <ğ-
m©h
.
huge
 
th’


653 -- 
Neg©ive
 
šfš™y
.

654 -- 
JSON
 
has
 
no
 
INF
, 
so
 
we
 
have
 
to
 
fudge
 
the
 
be¡
 w
ÿn
. 
This
 
should
 
»®ly
 
be
 
a
 
·ckage
 
İtiÚ
.

658  
	$to¡ršg
(
v®ue
)

659 
’d


660 
–£if
 
	`ty³
(
v®ue
è=ğ'boŞ—n' 
th’


661  
	$to¡ršg
(
v®ue
)

663 
–£if
 
	`ty³
(
v®ue
è~ğ'bË' 
th’


664 
£lf
:
	`ÚEncodeE¼Ü
("ÿn'ˆcÚv”ˆ" .. 
	`ty³
(
v®ue
è.. "ØJSON", 
‘c
)

668 -- 
A
 
bË
 
to
 
be
 
cÚv”‹d
Ø
e™h”
 
a
 
JSON
 
objeù
 
Ü
 
¬¿y
.

670 
loÿl
 
T
 = 
v®ue


672 
·»Ás
[
T
] 
th’


673 
£lf
:
	`ÚEncodeE¼Ü
("bË " .. 
	`to¡ršg
(
T
è.. " i ¨chd oà™£lf", 
‘c
)

675 
·»Ás
[
T
] = 
Œue


676 
’d


678 
loÿl
 
»suÉ_v®ue


680 
loÿl
 
objeù_keys
, 
maximum_numb”_key
 = 
	$objeù_Ü_¬¿y
(
£lf
, 
T
, 
‘c
)

681 
maximum_numb”_key
 
th’


683 -- 
An
 
¬¿y
...

685 
loÿl
 
ITEMS
 = { 
	}
}

686 
i
 = 1, 
maximum_numb”_key
 do

687 
	gbË
.
š£¹
(
ITEMS
, 
	$’code_v®ue
(
£lf
, 
T
[
i
], 
·»Ás
, 
‘c
))

688 
’d


690 
»suÉ_v®ue
 = "[" .. 
bË
.
	`cÚÿt
(
ITEMS
, ",") .. "]"

691 
–£if
 
objeù_keys
 
th’


693 -- 
An
 
objeù


697 -- 
We
'll‡lways sorthe keys, sohat comparisons can be made on

698 -- 
the
 
»suÉs
, 
‘c
. 
The
 
aùu®
 
Üd”
 
is
 
nÙ
 
·¹icuÏ¾y


699 -- 
	`impÜÁ
 (
e
.
g
. 
™
 
dÛ¢
't matter what character set we sort

700 -- 
as
); 
™
's only importanthat it be deterministic...he same

701 -- 
ev”y
 
time
.

703 
loÿl
 
PARTS
 = { 
	}
}

704 
_
, 
key
 
š
 
	$aœs
(
objeù_keys
) do

705 
loÿl
 
’coded_key
 = 
	`’code_v®ue
(
£lf
, 
	`to¡ršg
(
key
), 
·»Ás
, 
‘c
)

706 
loÿl
 
’coded_v®
 = 
	$’code_v®ue
(
£lf
, 
T
[
key
], 
·»Ás
, 
‘c
)

707 
bË
.
	`š£¹
(
PARTS
, 
¡ršg
.
	`fÜm©
("%s:%s", 
’coded_key
, 
’coded_v®
))

708 
’d


709 
»suÉ_v®ue
 = "{" .. 
bË
.
	`cÚÿt
(
PARTS
, ",") .. "}"

712 -- 
An
 
em±y
 
¬¿y
/
objeù
... 
we
'llreat it‡s‡n‡rray,hough it should„eally be‡n option

714 
»suÉ_v®ue
 = "[]"

715 
’d


717 
·»Ás
[
T
] = 
çl£


718  
»suÉ_v®ue


719 
’d


720 
’d


722 
loÿl
 
’code_´‘ty_v®ue
 -- 
mu¡
 
´edeş¬e
 
beÿu£
 
™
 
ÿÎs
 
™£lf


723 
funùiÚ
 
	$’code_´‘ty_v®ue
(
£lf
, 
v®ue
, 
·»Ás
, 
šd’t
, 
‘c
)

725 
	`ty³
(
v®ue
è=ğ'¡ršg' 
th’


726  
	$jsÚ_¡ršg_l™”®
(
v®ue
)

728 
–£if
 
	`ty³
(
v®ue
è=ğ'numb”' 
th’


729  
	$to¡ršg
(
v®ue
)

731 
–£if
 
	`ty³
(
v®ue
è=ğ'boŞ—n' 
th’


732  
	$to¡ršg
(
v®ue
)

734 
–£if
 
	`ty³
(
v®ue
è=ğ'n' 
th’


737 
–£if
 
	`ty³
(
v®ue
è~ğ'bË' 
th’


738 
£lf
:
	`ÚEncodeE¼Ü
("ÿn'ˆcÚv”ˆ" .. 
	`ty³
(
v®ue
è.. "ØJSON", 
‘c
)

742 -- 
A
 
bË
 
to
 
be
 
cÚv”‹d
Ø
e™h”
 
a
 
JSON
 
objeù
 
Ü
 
¬¿y
.

744 
loÿl
 
T
 = 
v®ue


746 
·»Ás
[
T
] 
th’


747 
£lf
:
	`ÚEncodeE¼Ü
("bË " .. 
	`to¡ršg
(
T
è.. " i ¨chd oà™£lf", 
‘c
)

748 
’d


749 
·»Ás
[
T
] = 
Œue


751 
loÿl
 
»suÉ_v®ue


753 
loÿl
 
objeù_keys
 = 
	$objeù_Ü_¬¿y
(
£lf
, 
T
, 
‘c
)

754 
nÙ
 
objeù_keys
 
th’


756 -- 
An
 
¬¿y
...

758 
loÿl
 
ITEMS
 = { 
	}
}

759 
i
 = 1, #T do

760 
	gbË
.
š£¹
(
ITEMS
, 
	$’code_´‘ty_v®ue
(
£lf
, 
T
[
i
], 
·»Ás
, 
šd’t
, 
‘c
))

761 
’d


763 
»suÉ_v®ue
 = "[ " .. 
bË
.
	`cÚÿt
(
ITEMS
, ", ") .. " ]"

768 -- 
An
 
objeù
 -- 
ÿn
 
keys
 
be
 
numb”s
?

771 
loÿl
 
KEYS
 = { 
	}
}

772 
loÿl
 
max_key_Ëngth
 = 0

773 
_
, 
key
 
š
 
	$aœs
(
objeù_keys
) do

774 
loÿl
 
’coded
 = 
	`’code_´‘ty_v®ue
(
£lf
, 
	`to¡ršg
(
key
), 
·»Ás
, "", 
‘c
)

775 
max_key_Ëngth
 = 
m©h
.
	`max
(max_key_length, #encoded)

776 
bË
.
	$š£¹
(
KEYS
, 
’coded
)

777 
’d


778 
loÿl
 
key_šd’t
 = 
šd’t
 .. " "

779 
loÿl
 
subbË_šd’t
 = 
šd’t
 .. 
¡ršg
.
	`»p
(" ", 
max_key_Ëngth
 + 2 + 4)

780 
loÿl
 
FORMAT
 = "%s%" .. 
	`to¡ršg
(
max_key_Ëngth
) .. "s: %s"

782 
loÿl
 
COMBINED_PARTS
 = { 
	}
}

783 
i
, 
key
 
š
 
	$aœs
(
objeù_keys
) do

784 
loÿl
 
’coded_v®
 = 
	$’code_´‘ty_v®ue
(
£lf
, 
T
[
key
], 
·»Ás
, 
subbË_šd’t
, 
‘c
)

785 
bË
.
	`š£¹
(
COMBINED_PARTS
, 
¡ršg
.
	$fÜm©
(
FORMAT
, 
key_šd’t
, 
KEYS
[
i
], 
’coded_v®
))

786 
’d


787 
»suÉ_v®ue
 = "{\n" .. 
bË
.
	`cÚÿt
(
COMBINED_PARTS
, ",\n"è.. "\n" .. 
šd’t
 .. "}"

788 
’d


790 
·»Ás
[
T
] = 
çl£


791  
»suÉ_v®ue


792 
’d


793 
’d


795 
funùiÚ
 
OBJDEF
:
	$’code
(
v®ue
, 
‘c
)

796 
	`ty³
(
£lf
è~ğ'bË' 
Ü
 s–f.
__šdex
 ~ğ
OBJDEF
 
th’


797 
OBJDEF
:
	`ÚEncodeE¼Ü
("JSON:’codmu¡ bÿÎed iÀm‘hod fÜm©", 
‘c
)

798 
’d


800 
loÿl
 
·»Ás
 = {
	}
}

801  
	$’code_v®ue
(
£lf
, 
v®ue
, 
·»Ás
, 
‘c
)

802 
’d


804 
funùiÚ
 
OBJDEF
:
	$’code_´‘ty
(
v®ue
, 
‘c
)

805 
loÿl
 
·»Ás
 = {
	}
}

806 
loÿl
 
subbË_šd’t
 = ""

807  
	$’code_´‘ty_v®ue
(
£lf
, 
v®ue
, 
·»Ás
, 
subbË_šd’t
, 
‘c
)

808 
’d


810 
funùiÚ
 
OBJDEF
.
	$__to¡ršg
()

812 
’d


814 
OBJDEF
.
__šdex
 = OBJDEF

816 
funùiÚ
 
OBJDEF
:
	$Ãw
(
¬gs
)

817 
loÿl
 
Ãw
 = { 
	}
}

819 
¬gs
 
th’


820 
key
, 
v®
 
š
 
	$·œs
(
¬gs
) do

821 
Ãw
[
key
] = 
v®


822 
’d


823 
’d


825  
	$£tm‘©abË
(
Ãw
, 
OBJDEF
)

826 
’d


828  
OBJDEF
:
	`Ãw
()

831 -- 
V”siÚ
 
hi¡Üy
:

833 -- 20111207.5 
Added
 
suµÜt
 
the
 '‘c' 
¬gum’ts
, 
b‘‹r
 
”rÜ
 
»pÜtšg
.

835 -- 20110731.4 
MÜe
 
ãedback
 
äom
 
David
 
KŞf
 
Ú
 
how
 
to
 
make
 
the
 
‹¡s
 
Nª
/
Infš™y
 
sy¡em
 
šd•’d’t
.

837 -- 20110730.3 
IncÜpÜ©ed
 
ãedback
 
äom
 
David
 
KŞf
 
©
 
h‰p
:

839 -- * 
Wh’
 
’codšg
 
lua
 
JSON
, 
S·r£
 
num”ic
 
¬¿ys
 
¬e
 
now
 
hªdËd
 
by


840 -- 
¥™tšg
 
out
 
fuÎ
 
¬¿ys
, 
such
 
th©


841 -- 
JSON
:
	`’code
({"Úe", "two", [10] = "‹n"
	}
})

842 -- 
	g»tuºs


843 -- ["Úe","two",
nuÎ
,null,null,null,null,null,null,"ten"]

845 -- 
	gIn
 20100810.2 
ªd
 
	g—¾›r
, 
Úly
 
up
 
to
 
the
 
fœ¡
 
	gnÚ
-
nuÎ
 
v®ue
 
would
 
have
 
b“n
 
	g»šed
.

847 -- * 
Wh’
 
’codšg
 
lua
 
	gJSON
, 
num”ic
 
v®ue
 
NaN
 
g‘s
 
¥™
 
out
 
as
 
	gnuÎ
, 
ªd
 
šfš™y
 
	gas
 "1+e9999".

848 -- 
	gV”siÚ
 20100810.2 
ªd
 
—¾›r
 
ü—‹d
 
šv®id
 
JSON
 
š
 
bÙh
 
	gÿ£s
.

850 -- * 
Unicode
 
su¼og©e
 
·œs
 
¬e
 
now
 
d‘eùed
 
wh’
 
decodšg
 
	gJSON
.

852 -- 20100810.2 
added
 
some
 
checkšg
 
to
 
’su»
 
th©
 
ª
 
šv®id
 
Unicode
 
ch¬aù”
 
	gcouldn
't†eak inohe UTF-8ƒncoding

854 -- 20100731.1 
š™Ÿl
 
public
 
	g»Ëa£


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/3rdparty/middleclass.lua

1 
	g»quœe
 "turbo.3rdparty.middleclass.middleclass"

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/3rdparty/middleclass/middleclass.lua

1 -- 
	gmiddËşass
.
	glua
 - 
	gv2
.0 (2011-09)

2 -- 
Cİyright
 (
c
è2011 
EÄique
 
	gG¬c
Ã­
a
 
	gCÙa


3 -- 
P”missiÚ
 
is
 
h”eby
 
	gg¿Áed
, 
ä“
 
of
 
	gch¬ge
, 
to
 
ªy
 
³rsÚ
 
obššg
 
a
 
cİy
 oà
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"),Ø
d—l
 
š
h
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
Ø
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
cİ›s
 oàth
	gSoáw¬e
,‡ndØ
³rm™
 
³rsÚs
Ø
whom
hSoáw¬i 
fuºished
ØdØ
	gso
, 
subjeù
Øth
fŞlowšg
 
	gcÚd™iÚs
:

4 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l
 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

5 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
OR
 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 THE 
WARRANTIES
 OF 
	gMERCHANTABILITY
, 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 THE 
AUTHORS
 OR 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 FOR ANY 
	gCLAIM
, 
DAMAGES
 OR 
OTHER
 
	gLIABILITY
, 
WHETHER
 IN 
AN
 
ACTION
 OF 
	gCONTRACT
, 
TORT
 OR 
	gOTHERWISE
, 
ARISING
 
	gFROM
, 
OUT
 OF OR IN 
CONNECTION
 
WITH
 THE SOFTWARE OR THE 
USE
 OR OTHER 
DEALINGS
 IN THE 
	gSOFTWARE
.

6 -- 
Ba£d
 
Ú
 
	gYaciCode
, 
äom
 
Jul›n
 
P©‹
 
ªd
 
	gLuaObjeù
, from 
Seba¡›n
 
	gRocÿ
-
S”¿


8 
loÿl
 
	g_şas£s
 = 
£tm‘©abË
({}, {
__mode
 = "k"})

10 
loÿl
 
funùiÚ
 
	$_£tCÏssDiùiÚ¬›sM‘©abËs
(
kÏss
)

11 
loÿl
 
diù
 = 
kÏss
.
__š¡ªûDiù


12 
diù
.
__šdex
 = dict

14 
loÿl
 
su³r
 = 
kÏss
.super

15 
su³r
 
th’


16 
loÿl
 
su³rStic
 = 
su³r
.

17 
	$£tm‘©abË
(
diù
, 
su³r
.
__š¡ªûDiù
)

18 
	`£tm‘©abË
(
kÏss
., { 
__šdex
 = 
	`funùiÚ
(
_
,
k
è 
diù
[k] 
Ü
 
su³rStic
[k] 
’d
 
	}
})

20 
£tm‘©abË
(
kÏss
., { 
__šdex
 = 
funùiÚ
(
_
,
k
è 
diù
[k] 
’d
 })

21 
’d


22 
’d


24 
loÿl
 
funùiÚ
 
	$_£tCÏssM‘©abË
(
kÏss
)

25 
	`£tm‘©abË
(
kÏss
, {

26 
__to¡ršg
 = 
	`funùiÚ
(è "şas " .. 
kÏss
.
Çme
 
’d
,

27 
__šdex
 = 
kÏss
.,

28 
__Ãwšdex
 = 
kÏss
.
__š¡ªûDiù
,

29 
__ÿÎ
 = 
	`funùiÚ
(
£lf
, ...è s–f:
	`Ãw
(...è
’d


30 
	}
})

31 
’d


33 
loÿl
 
funùiÚ
 
	$_ü—‹CÏss
(
Çme
, 
su³r
)

34 
loÿl
 
kÏss
 = { 
Çme
 =‚ame, 
su³r
 = su³r, ğ{}, 
__mixšs
 = {}, 
__š¡ªûDiù
={} 
	}
}

35 
	gkÏss
.
	gsubşas£s
 = 
£tm‘©abË
({}, {
__mode
 = "k"})

37 
	$_£tCÏssDiùiÚ¬›sM‘©abËs
(
kÏss
)

38 
	$_£tCÏssM‘©abË
(
kÏss
)

39 
_şas£s
[
kÏss
] = 
Œue


41  
kÏss


42 
’d


44 
loÿl
 
funùiÚ
 
	$_ü—‹LookupM‘am‘hod
(
kÏss
, 
Çme
)

45  
	$funùiÚ
(...)

46 
loÿl
 
m‘hod
 = 
kÏss
.
su³r
[
Çme
]

47 
	`as£¹
Ğ
	`ty³
(
m‘hod
)=='funùiÚ', 
	`to¡ršg
(
kÏss
è.. " dÛ¢'ˆim¶em’ˆm‘am‘hod '" .. 
Çme
 .. "'" )

48  
	$m‘hod
(...)

49 
’d


50 
’d


52 
loÿl
 
funùiÚ
 
	$_£tCÏssM‘am‘hods
(
kÏss
)

53 
_
,
m
 
š
 
	$aœs
(
kÏss
.
__m‘am‘hods
) do

54 
kÏss
[
m
]ğ
	$_ü—‹LookupM‘am‘hod
(
kÏss
, 
m
)

55 
’d


56 
’d


58 
loÿl
 
funùiÚ
 
	$_£tDeçuÉIn™ŸlizeM‘hod
(
kÏss
, 
su³r
)

59 
kÏss
.
š™Ÿlize
 = 
	$funùiÚ
(
š¡ªû
, ...)

60  
su³r
.
	$š™Ÿlize
(
š¡ªû
, ...)

61 
’d


62 
’d


64 
loÿl
 
funùiÚ
 
	$_šşudeMixš
(
kÏss
, 
mixš
)

65 
	`as£¹
(
	`ty³
(
mixš
)=='table', "mixin must be‡able")

66 
Çme
,
m‘hod
 
š
 
	$·œs
(
mixš
) do

67 
Çme
 ~ğ"šşuded" 
ªd
‚am~ğ"¡©ic" 
th’
 
kÏss
[Çme] = 
m‘hod
 
’d


68 
’d


69 
mixš
.
th’


70 
Çme
,
m‘hod
 
š
 
	$·œs
(
mixš
.) do

71 
kÏss
.[
Çme
] = 
m‘hod


72 
’d


73 
’d


74 
	`ty³
(
mixš
.
šşuded
)=="funùiÚ" 
th’
 mixš:
	$šşuded
(
kÏss
è
’d


75 
kÏss
.
__mixšs
[
mixš
] = 
Œue


76 
’d


78 
Objeù
 = 
	`_ü—‹CÏss
("Objeù", 
n
)

80 
Objeù
..
__m‘am‘hods
 = { '__add', '__call', '__concat', '__div', '__le', '__lt',

81 '__mod', '__mul', '__pow', '__sub', '__to¡ršg', '__unm' 
	}
}

83 
funùiÚ
 
Objeù
.:
	$®loÿ‹
()

84 
	`as£¹
(
_şas£s
[
£lf
], "Make surehat you‡re using 'Class:allocate' instead of 'Class.allocate'")

85  
	`£tm‘©abË
({ 
şass
 = 
£lf
 
	}
}, 
	g£lf
.
	g__š¡ªûDiù
)

86 
’d


88 
funùiÚ
 
	gObjeù
.:
	$Ãw
(...)

89 
loÿl
 
š¡ªû
 = 
£lf
:
	$®loÿ‹
()

90 
š¡ªû
:
	$š™Ÿlize
(...)

91  
š¡ªû


92 
’d


94 
funùiÚ
 
Objeù
.:
	$subşass
(
Çme
)

95 
	`as£¹
(
_şas£s
[
£lf
], "Make surehat you‡re using 'Class:subclass' instead of 'Class.subclass'")

96 
	`as£¹
(
	`ty³
(
Çme
) == "string", "You must…rovide‡‚ame(string) for your class")

98 
loÿl
 
subşass
 = 
	$_ü—‹CÏss
(
Çme
, 
£lf
)

99 
	$_£tCÏssM‘am‘hods
(
subşass
)

100 
	$_£tDeçuÉIn™ŸlizeM‘hod
(
subşass
, 
£lf
)

101 
£lf
.
subşas£s
[
subşass
] = 
Œue


102 
£lf
:
	$subşas£d
(
subşass
)

104  
subşass


105 
’d


107 
funùiÚ
 
Objeù
.:
	$subşas£d
(
Ùh”
è
’d


109 
funùiÚ
 
Objeù
.:
	$šşude
( ... )

110 
	`as£¹
(
_şas£s
[
£lf
], "Make sure youhat you‡re using 'Class:include' instead of 'Class.include'")

111 
_
,
mixš
 
š
 
	`aœs
({...
	}
}èdØ
	$_šşudeMixš
(
£lf
, 
mixš
è
’d


112  
£lf


113 
’d


115 
funùiÚ
 
Objeù
:
	$š™Ÿlize
(è
’d


117 
funùiÚ
 
Objeù
:
	$__to¡ršg
(è "š¡ªû oà" .. 
	$to¡ršg
(
£lf
.
şass
è
’d


119 
funùiÚ
 
	$şass
(
Çme
, 
su³r
, ...)

120 
su³r
 = su³¸
Ü
 
Objeù


121  
su³r
:
	$subşass
(
Çme
, ...)

122 
’d


124 
funùiÚ
 
	$š¡ªûOf
(
aCÏss
, 
obj
)

125 
nÙ
 
_şas£s
[
aCÏss
] 
Ü
 
	`ty³
(
obj
è~ğ'bË' o¸nÙ _şas£s[obj.
şass
] 
th’
  
çl£
 
’d


126 
obj
.
şass
 =ğ
aCÏss
 
th’
  
Œue
 
’d


127  
	$subşassOf
(
aCÏss
, 
obj
.
şass
)

128 
’d


130 
funùiÚ
 
	$subşassOf
(
Ùh”
, 
aCÏss
)

131 
nÙ
 
_şas£s
[
aCÏss
] 
Ü
‚Ù _şas£s[
Ùh”
] o¸aCÏss.
su³r
 =ğ
n
 
th’
  
çl£
 
’d


132  
aCÏss
.
su³r
 =ğ
Ùh”
 
Ü
 
	$subşassOf
(
Ùh”
, 
aCÏss
.
su³r
)

133 
’d


135 
funùiÚ
 
	$šşudes
(
mixš
, 
aCÏss
)

136 
nÙ
 
_şas£s
[
aCÏss
] 
th’
  
çl£
 
’d


137 
aCÏss
.
__mixšs
[
mixš
] 
th’
  
Œue
 
’d


138  
	$šşudes
(
mixš
, 
aCÏss
.
su³r
)

139 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/async.lua

1 --- 
	gTurbo
.
lua
 
AsynchrÚous
 
butšs
 
	gmoduË


2 -- 
Butš
 
async
 
ã©u»s
 
of
 
	gTurbo
.
	glua
:

3 -- * 
HTTP
 
Cl›Á


5 -- 
Cİyright
 2013 
John
 
Ab¿ham£n


7 -- 
Liûn£d
 
und”
 
the
 
A·che
 
Liûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

8 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

9 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


11 -- 
	gh‰p
:

13 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


14 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

15 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

16 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


17 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

19 
loÿl
 
	gio¡»am
 = 
»quœe
 "turbo.iostream"

20 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

21 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

22 
loÿl
 
h‰put
 = 
»quœe
 "turbo.httputil"

23 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

24 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

25 
loÿl
 
log
 = 
»quœe
 "turbo.log"

26 
loÿl
 
h‰p_»¥Ú£_codes
 = 
»quœe
 "turbo.http_response_codes"

27 
loÿl
 
coùx
 = 
»quœe
 "turbo.coctx"

28 
loÿl
 
deque
 = 
»quœe
 "turbo.structs.deque"

29 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

30 
loÿl
 
esÿ³
 = 
»quœe
 "turbo.escape"

31 
loÿl
 
üy±o
 = 
»quœe
 "turbo.crypto"

32 
»quœe
 "turbo.3rdparty.middleclass"

34 
loÿl
 
uÅack
 = 
ut
.
fuÅack


35 
loÿl
 
AF_INET


36 
¶©fÜm
.
__LINUX__
 
th’


37 
AF_INET
 = 
sock‘
.AF_INET

38 
’d


41 
loÿl
 
async
 = {} --‡synø
Çme¥aû


43 --- 
A
 
w¿µ”
 
funùiÚs
 
th©
 
®ways
 
kes
 
ÿÎback
 
ªd
 callback

44 -- 
¬gum’t
 
as
 
Ï¡
 
¬gum’ts
.

46 -- 
U§ge
:

47 -- 
CÚsid”
 
Úe
 
of
 
the
 
funùiÚs
 oàth
IOSŒ—m
 
şass
 
which
 
u£s
 
a


48 -- 
ÿÎback
 
ba£d
 
API
: 
IOSŒ—m
:
»ad_uÁ
(
d–im™”
, c®lback, 
¬g
)

50 -- 
loÿl
 
	g»s
 = 
cÜoutše
.
y›ld
(
turbo
.
async
.
sk
(

51 -- 
¡»am
.
»ad_uÁ
, stream, "\r\n"))

53 -- 
No
 
ÿÎbacks
 
	g»quœed
, 
the
 
¬gum’ts
 
th©
 
would
 
nÜm®ly
 
be
 
u£d
 
	gto


54 -- 
ÿÎ
 
the
 
ÿÎback
 
is
 
put
 
š
h
	gËá
-
side
 
»suÉ
 ( 
v®ues
).

55 
funùiÚ
 
	gasync
.
	$sk
(
func
, ...)

56 
loÿl
 
io
 = 
iŞoİ
.
	$š¡ªû
()

57 
loÿl
 
coùx
 = coùx.
	$CÜoutšeCÚ‹xt
(
io
)

58 
coùx
:
	$£t_¡©e
(
coùx
.
WORKING
)

59 
loÿl
 
¬gs
 = {...
	}
}

60 
¬gs
[#¬gs+1] = 
async
.
_w¿p_sk


61 
¬gs
[#¬gs+1] = 
coùx


62 
func
(
	$uÅack
(
¬gs
))

63  
coùx


64 
’d


66 
funùiÚ
 
async
.
	$_w¿p_sk
(
coùx
, ...)

67 
coùx
:
	$£t_¡©e
(
coùx
.
DEAD
)

68 
coùx
:
	`£t_¬gum’ts
({...
	}
})

69 
coùx
:
	$fš®ize_cÚ‹xt
()

70 
’d


72 --- 
HTTPCl›Á
 
şass


73 -- 
Ba£d
 
Ú
 
the
 
IOSŒ—m
/
SSLIOSŒ—m
 
ªd
 
IOLoİ
 
şas£s
.

74 -- 
DesigÃd
 
to
 
asynchrÚou¦y
 
communiÿ‹
 
w™h
 
a
 
HTTP
 
£rv”
 
vŸ
 
the
 
Turbo
 
I
/
O


75 -- 
Loİ
. 
The
 
u£r
 
MUST
 
u£
 
Lua
's builtin coroutineso manage yielding,‡fter

76 -- 
došg
 
a
 
»que¡
. 
The
 
aim
 
the
 
ş›Á
 
is
 
to
 
suµÜt
 
as
 
mªy
 
¡ªd¬ds
 
of


77 -- 
HTTP
 
as
 
possibË
. 
Howev”
 
th”e
 
may
 
be
 
some
 
¬tiçùs
‡ th”
usu®ly
 
¬e


78 -- 
mªy
 
com·b™y
 
fixes
 
š
 
equiv®’t
 
soáw¬e
 
such
 
as
 
cu¾
.

79 -- 
Websock‘s
 
¬e
 
nÙ
 
hªdËd
 
by
 
this
 
şass
. 
It
 
is
 
the
 
u£rs
 
»¥Úsib™y
 
to


80 -- 
check
 
the
 
»tuºed
 
v®ues
 
”rÜs
 
befÜe
 
u§ge
.

82 -- 
Wh’
 
usšg
 
this
 
şass
, 
k“p
 
š
 
mšd
 
th©
 
™
 
is
 
nÙ
 
suµÜ‹d
 
to
 
Ïunch


83 -- 
mulË
 :
	`ãtch
()'s withhe same class instance. Ifhe instance is‡lready

84 -- 
š
 
u£
 
th’
 
™
 
wl
  
a
 
”rÜ
.

86 -- 
NÙe
: 
Do
 
nÙ
 
throw
 
”rÜs
 
š
 
this
 
şass
. 
The
 
ÿÎ”
 
wl
‚Ù 
»ûive
 
them
 
as


87 -- 
®l
 
the
 
code
 
is
 
dÚe
 
outside
h
y›ldšg
 
cÜoutšes
 
ÿÎ
 
¡ack
, 
exû±
 

88 -- 
ÿÎs
 
to
 
	`ãtch
(). 
But
 
the
 
§ke
 
of
 
cÚtšu™y
, 
th”e
 
¬e
 
no
 
¿w
 
”rÜs


89 -- 
thrown
 
äom
 
this
 
m‘hod
 
e™h”
.

91 -- 
Sim¶e
 
u§ge
:

92 -- 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(

93 -- 
turbo
.
async
.
	$HTTPCl›Á
():
	`ãtch
("http://search.twitter.com/search.json",

94 -- {
·¿ms
 = {
q
="Turbo.lua", 
»suÉ_ty³
="mixed"}

95 -- 
	}
}))

97 -- 
The
 
»s
 
v¬ŸbË
 
wl
 
cÚš
 
a
 
HTTPRe¥Ú£
 
şass
 
	gš¡ªû
. 
This
 cÏs 
	ghas


98 -- 
a
 
ãw
 
	g©Œibu‹s
.

99 -- 
	g£lf
.
	g»que¡
 = (
HTTPH—d”s
 
şass
 
š¡ªû
è
The
 
»que¡
 
h—d”
 
£Á
 
to


100 -- 
the
 
£rv”
.

101 -- 
£lf
.
code
 = (
Numb”
è
The
 
»¥Ú£
 code

102 -- 
£lf
.
h—d”s
 = (
HTTPH—d”
 
şass
 
š¡ªû
è
Re¥Ú£
 h—d” 
»ûive
 
äom


103 -- 
the
 
£rv”
.

104 -- 
£lf
.
body
 = (
SŒšg
è
Body
 
of
 
»¥Ú£


105 -- 
£lf
.
”rÜ
 = (
TabË
èTabË 
w™h
 
code
 
ªd
 
mes§ge
 
memb”s
. 
PossibË
 
codes
 
is


106 -- 
defšed
 
š
 
async
.
”rÜs
.

107 -- 
£lf
.
»que¡_time
 = (
Numb”
è
m£c
 
u£d
 
to
 
´oûss
 
»que¡
.

109 -- 
It
 
is
 
®lways
 
a
 
good
 
id—
 
to
 
fœ¡
 
check
 
the
 
£lf
.
”rÜ
 
memb”
 i 
£t


110 -- 
befÜe
, 
usšg
 
the
 
	g»¥Ú£
. 
If
 
™
 
is
 
	g£t
, 
this
 
m—ns
 
th©
 
mo¡
 
of
h
	gÙh”


111 -- 
memb”s
 
is
 
nÙ
 
	gavaabË
. 
The
 
»que¡
 
w”e
‚Ù 
	gsucûssfuÎ
.

113 -- 
Also
 
»memb”
 
th©
 
	gHTTPCl›Á
:
ãtch
 
mu¡
 
be
 
ÿÎed
 
äom
 
w™hš
 
the
 
IOLoİ


114 -- 
as
 
a
 
ÿÎback
. 
Usšg
 
™
 
dœeùly
 
š
‡ 
Reque¡HªdËr
 
m‘hod
 
is
 
fše
‡ 
th©


115 -- 
is
 
hªdËd
 
šside
 
the
 
IOLoİ
, 
howev”
 
usšg
h
şass
 
¡ªd®Úe
 
™
 
	gwould


116 -- 
be
 
»quœed
 
th©
 
you
 
u£
 
	gIOLoİ
:
add_ÿÎback
 
to
 
¶aû
 
a
 
funùiÚ
 
Ú
 
the


117 -- 
IOLoİ
 
ªd
 
y›ld
 
äom
 
w™hš
 
th©
 
funùiÚ
.

118 
async
.
HTTPCl›Á
 = 
şass
("HTTPClient")

121 --- 
C»©e
 
a
 
Ãw
 
HTTPCl›Á
 
şass
 
š¡ªû
.

122 -- 
OÃ
 
š¡ªû
 
ÿn
 
£rve
 1 
»que¡
 
©
 
a
 
time
. 
If
 
muÉË
„eque¡ 
should
 
be


123 -- 
£Á
 
th’
 
ü—‹
 
muÉË
 
š¡ªûs
.

124 -- 
s¦_İtiÚs
 
kw¬gs
:

125 -- ``
´iv_fe
`` 
SSL
 / 
HTTPS
 
´iv©e
 
key
 
fe
.

126 -- ``
û¹_fe
`` 
SSL
 / 
HTTPS
 
û¹ifiÿ‹
 
key
 
fe
.

127 -- ``
v”ify_ÿ
`` 
SSL
 / 
HTTPS
 
chaš
 
v”ififiÿtiÚ
 
ªd
 
ho¡Çme
 
m©chšg
.

128 -- 
V”ifiÿtiÚ
 
ªd
 
m©chšg
 
is
 
Ú
 
as
 .

129 -- ``
ÿ_·th
`` 
SSL
 / 
HTTPS
 
CA
 
û¹ifiÿ‹
 
v”ify
 
loÿtiÚ


130 
funùiÚ
 
async
.
HTTPCl›Á
:
	$š™Ÿlize
(
s¦_İtiÚs
, 
io_loİ
, 
max_bufãr_size
)

131 
£lf
.
çmy
 = 
AF_INET


132 
£lf
.
io_loİ
 = io_loİ 
Ü
 
iŞoİ
.
	$š¡ªû
()

133 
£lf
.
max_bufãr_size
 = max_buffer_size

134 
£lf
.
s¦_İtiÚs
 = s¦_İtiÚ 
Ü
 {
	}
}

135 
£lf
.
s¦_İtiÚs
.
v”ify_ÿ
 =ğ
n
 
th’


136 
£lf
.
s¦_İtiÚs
.
v”ify_ÿ
 = 
Œue


137 
’d


138 
’d


140 --- 
E¼Üs
 
th©
 
ÿn
 
be
 
£t
 
š
 
the
  
objeù
 
of
 
ãtch
 (
HTTPRe¥Ú£
 
š¡ªû
).

141 
loÿl
 
”rÜs
 = {

142 
INVALID_URL
 = -1 -- 
URL
 
could
 
nÙ
 
be
 
·r£d
.

143 ,
	gINVALID_SCHEMA
 = -2 -- 
Inv®id
 
URL
 
schema


144 ,
	gCOULD_NOT_CONNECT
 = -3 -- 
Could
 
nÙ
 
cÚÃù
, 
check
 
	gmes§ge
.

145 ,
	gPARSE_ERROR_HEADERS
 = -4 -- 
Could
 
nÙ
 
·r£
 
»¥Ú£
 
h—d”s
.

146 ,
	gCONNECT_TIMEOUT
 = -5 -- 
CÚÃù
 
timed
 
out
.

147 ,
	gREQUEST_TIMEOUT
 = -6 -- 
Reque¡
 
timed
 
out
.

148 ,
	gNO_HEADERS
 = -7 -- 
ShouldÁ
 
h­³n
.

149 ,
	gREQUIRES_BODY
 = -8 -- 
Ex³ùed
 
a
 
HTTP
 
body
, 
but
 
nÚe
 
	g£t
.

150 ,
	gINVALID_BODY
 = -9 -- 
Reque¡
 
body
 
is
 
nÙ
 
a
 
¡ršg
.

151 ,
	gSOCKET_ERROR
 = -10 -- 
Sock‘
 
”rÜ
, 
check
 
	gmes§ge
.

152 ,
	gSSL_ERROR
 = -11 -- 
SSL
 
”rÜ
, 
check
 
	gmes§ge
.

153 ,
	gBUSY
 = -12 -- 
O³¿tiÚ
 
š
 
´og»ss
.

154 ,
	gREDIRECT_MAX
 = -13 -- 
Redœeù
 
maximum
 
»ached
.

156 
	gasync
.
	g”rÜs
 = 
”rÜs


158 --- 
F‘ch
 
a
 
URL
.

159 -- @
·¿m
 
	$u¾
 (
SŒšg
è
URL
 
to
 
ãtch
.

160 -- @
·¿m
 
	$kw¬gs
 (
bË
è
O±iÚ®
 
keywÜd
 
¬gum’ts


161 -- ** 
AvaabË
 
İtiÚs
 **

162 -- ``
m‘hod
`` = 
The
 
HTTP
 m‘hod 
to
 
u£
. 
DeçuÉ
 
is
 ``
GET
``

163 -- ``
·¿ms
`` = 
Provide
 
·¿m‘”s
 
as
 
bË
.

164 -- ``
k“p_®ive
`` = 
Reu£
 
cÚÃùiÚ
 
the
 
sûÇrio
 
suµÜts
 
™
.

165 -- ``
cook›
`` = (
TabË
è
The
 
	$cook›
(
s
è
to
 
u£
.

166 -- ``
h‰p_v”siÚ
`` = 
S‘
 
HTTP
 
v”siÚ
. 
DeçuÉ
 
is
 
HTTP1
.1

167 -- ``
u£_gz
`` = 
U£
 
gz
 
com´essiÚ
. 
DeçuÉ
 
is
 
Œue
.

168 -- ``
®low_»dœeùs
`` = 
AÎow
 
Ü
 
di§Îow
 
»dœeùs
. 
DeçuÉ
 
is
 
Œue
.

169 -- ``
max_»dœeùs
`` = 
Maximum
 
»dœeùiÚs
 
®lowed
. 
DeçuÉ
 
is
 4.

170 -- ``
Ú_h—d”s
`` = 
C®lback
 
to
 
be
 
ÿÎed
 
wh’
 
as£mblšg
 
»que¡
 
h—d”s
. 
C®Ëd


171 -- 
w™h
 
h—d”s
 
as
 
¬gum’t
.-- 
DeçuÉ
 
to
 
pÜt
 80 
nÙ
 
¥ecif›d
 
š
 
URL
.

172 -- ``
body
`` = 
Reque¡
 
HTTP
 body 
š
 
¶aš
 
fÜm
.

173 -- ``
»que¡_timeout
`` = 
TÙ®
 
timeout
 
š
 
	$£cÚds
 (
šşudšg
 
cÚÃù
) 

174 -- 
»que¡
. 
DeçuÉ
 
is
 60 
£cÚds
.

175 -- ``
cÚÃù_timeout
`` = 
Timeout
 
š
 
£cÚds
 
cÚÃù
. 
DeçuÉ
 
is
 20 
£cs
.

176 -- ``
auth_u£ºame
`` = 
Basic
 
Auth
 
u£r
 
Çme
.

177 -- ``
auth_·sswÜd
`` = 
Basic
 
Auth
 
·sswÜd
.

178 -- ``
u£r_ag’t
`` = 
U£r
 
Ag’t
 
¡ršg
 
u£d
 
š
 
»que¡
 
h—d”s
. 
DeçuÉ


179 -- 
is
 ``
Turbo
 
Cl›Á
 
vx
.
x
.x``

180 
funùiÚ
 
async
.
HTTPCl›Á
:
	$ãtch
(
u¾
, 
kw¬gs
)

181 
£lf
.
š_´og»ss
 
th’


182 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
BUSY
, "HTTPClient is busy.")

183 -- 
This
 
ş›Á
 
is
 
busy
 
w™h
 
ªÙh”
 
»que¡
.

184 -- 
Do
 
nÙ
 
ov”wr™e
 
the
 
®»ady
 
exi¡šg
 
co
 
ùx
,  
a
 
‹mp
 
Úe
.

185  
coùx
.
	$CÜoutšeCÚ‹xt
(
£lf
.
io_loİ
):
	$£t_¡©e
(
coùx
.
DEAD
)

186 
’d


187 
£lf
.
coùx
 = coùx.
	$CÜoutšeCÚ‹xt
(
£lf
.
io_loİ
)

188 
£lf
.
coùx
:
	$£t_¡©e
(
coùx
.
¡©es
.
WORKING
)

189 
£lf
.
š_´og»ss
 = 
Œue


190 
£lf
.
¡¬t_time
 = 
ut
.
	$g‘timemÚÙÚic
()

191 
£lf
.
kw¬gs
 = kw¬g 
Ü
 {
	}
}

192 -- 
S‘
 
§Ã
 
deçuÉs
 
kw¬gs
 
nÙ
 
´e£Á
.

193 
£lf
.
»dœeù_max
 = s–f.
kw¬gs
.
max_»dœeùs
 
Ü
 4

194 
£lf
.
®low_»dœeùs
 = s–f.
kw¬gs
.®low_»dœeù 
Ü
 
Œue


195 
£lf
.
kw¬gs
.
m‘hod
 = s–f.kw¬gs.m‘hod 
Ü
 "GET"

196 
£lf
.
kw¬gs
.
u£r_ag’t
 = s–f.kw¬gs.u£r_ag’ˆ
Ü
 "Turbo Client v2.0.0"

197 
£lf
.
kw¬gs
.
cÚÃù_timeout
 = s–f.kw¬gs.cÚÃù_timeouˆ
Ü
 30

198 
£lf
.
kw¬gs
.
»que¡_timeout
 = s–f.kw¬gs.»que¡_timeouˆ
Ü
 60

199 -- 
StÜe
 
away
 
Şd
 
ho¡Çme
 
ªd
 
pÜt
 
k“p
-
®ive
‡nd 
this
 
is
 
a


200 -- 2
nd
 
run
.

201 
loÿl
 
»_u£_cÚÃùiÚ
 = 
çl£


202 
loÿl
 
k•t_®ive
 = 
£lf
:
	$_is_k•t_®ive
()

203 
k•t_®ive
 
ªd
 
£lf
.
ho¡Çme
‡nd s–f.
pÜt
 
th’


204 
£lf
.
´ev_ho¡Çme
 = s–f.
ho¡Çme


205 
£lf
.
´ev_pÜt
 = s–f.
pÜt


206 
£lf
.
´ev_schema
 = s–f.
schema


207 
’d


208 
£lf
:
	`_£t_u¾
(
u¾
è=ğ-1 
th’


209  
£lf
.
coùx


210 
’d


211 
k•t_®ive
 
ªd
 
£lf
.
´ev_ho¡Çme
 =ğ£lf.
ho¡Çme
‡nd

212 (
£lf
.
pÜt
 ~ğ
n
 
ªd
 s–f.
´ev_pÜt
 == self.port)‡nd

213 
£lf
.
´ev_schema
 =ğ£lf.
schema
 
th’


214 
»_u£_cÚÃùiÚ
 = 
Œue


217 
£lf
.
io¡»am
 
th’
 s–f.io¡»am:
	$şo£
(è
’d


219 
loÿl
 
sock
, 
msg
 = 
sock‘
.
	$Ãw_nÚblock_sock‘
(
£lf
.
çmy
,

220 
sock‘
.
SOCK_STREAM
,

222 
sock
 =ğ-1 
th’


223 -- 
Could
 
nÙ
 
ü—‹
 
a
 
Ãw
 
sock‘
. 
Highly
 
uÆik–y
 .

224 
£lf
:
	$_throw_”rÜ
(
”rÜs
.
SOCKET_ERROR
, 
msg
)

225  
£lf
.
coùx


226 
’d


227 
£lf
.
sock
 = sock

228 
’d


229 -- 
Re£t
 
¡©es
 
äom
 
´evious
 
ãtch
.

230 
£lf
.
»dœeù
 = 0

231 
£lf
.
s_cÚÃùšg
 = 
çl£


232 
£lf
.
s_”rÜ
 = 
çl£


233 
£lf
.
”rÜ_¡r
 = ""

234 
£lf
.
”rÜ_code
 = 0

235 
nÙ
 
»_u£_cÚÃùiÚ
 
th’


236 
£lf
:
	`_cÚÃù
(è-- 
No
 
pošt
 
to
 
check
 , 
as
 
this
 
is
 
the
 
Ï¡
 
thšg
Ø
h­³n
.

237 -- 
Assumšg
 
the
 
m‘hod
 
is
 
y›lded
h
»tuºed
 
cÚ‹xt
 i 
¶aûd
 
š
he

238 -- 
IOLoİ
, 
awa™šg
 
fu¹h”
 
wÜk
, 
Ü
 
»tuºšg
 
”rÜ
 
bešg
 
£t
.

239 
£lf
.
coùx
:
	$£t_¡©e
(
coùx
.
¡©es
.
WAIT_COND
)

241 -- 
Reusšg
 
cÚÃùiÚ


242 
£lf
.
h—d”s
 = 
h‰put
.
	$HTTPH—d”s
()

243 
£lf
.
»q
 = 
n


244 
£lf
:
	$_hªdË_cÚÃù
()

245 
’d


246  
£lf
.
coùx


247 
’d


249 
loÿl
 
funùiÚ
 
	$_·r£_u¾_”rÜ_hªdËr
(
”r
)

250 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
("Could‚Ù…¬£ URL. %s", 
”r
))

251 
’d


253 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_is_k•t_®ive
()

254 
£lf
.
kw¬gs
.
k“p_®ive
 
ªd
 s–f.
io¡»am
‡nd

255 
nÙ
 
£lf
.
io¡»am
:
	$şo£d
(è
th’


256  
Œue


258  
çl£


259 
’d


260 
’d


262 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_£t_u¾
(
u¾
)

263 
	`ty³
(
u¾
è~ğ"¡ršg" 
th’


264 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
INVALID_URL
, "URL must be string.")

266 
’d


267 
£lf
.
h—d”s
 = 
h‰put
.
	$HTTPH—d”s
()

268 
loÿl
 
·r£r
 = 
h‰put
.
	$HTTPP¬£r
()

269 
loÿl
 
¡©us
, 
h—d”s
 = 
	$xpÿÎ
(

270 
·r£r
.
·r£_u¾
,

271 
_·r£_u¾_”rÜ_hªdËr
,

272 
·r£r
,

273 
u¾
)

274 
¡©us
 =ğ
çl£
 
th’


275 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
INVALID_URL
, "Invalid URL…rovided.")

277 
’d


278 
£lf
.
ho¡Çme
 = 
·r£r
:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
HOST
)

279 
£lf
.
schema
 = 
·r£r
:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
SCHEMA
)

280 
£lf
.
pÜt
 = 
	`tÚumb”
(
·r£r
:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
PORT
))

281 
nÙ
 
£lf
.
pÜt
 
th’


282 
£lf
.
schema
 =ğ"h‰p" 
th’


283 
£lf
.
pÜt
 = 80

284 
–£if
 
£lf
.
schema
 =ğ"h‰ps" 
th’


285 
£lf
.
pÜt
 = 443

286 
–£if
 
£lf
.
schema
 =ğ"ws" 
th’


287 
£lf
.
pÜt
 = 80

288 
–£if
 
£lf
.
schema
 =ğ"wss" 
th’


289 
£lf
.
pÜt
 = 443

290 
’d


291 
’d


292 
£lf
.
·th
 = 
·r£r
:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
PATH
)

293 
£lf
.
qu”y
 = 
·r£r
:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
QUERY
)

294 
£lf
.
»q
 = s–f:
	$_´•¬e_h‰p_»que¡
()

295 
£lf
.
»q
 =ğ-1 
th’


297 
’d


298 
£lf
.
u¾
 = url

300 
’d


302 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_cÚÃù
()

303 
£lf
.
schema
 =ğ"h‰p" 
th’


304 -- 
Snd¬d
 
HTTP
 
cÚÃù
.

305 
£lf
.
io¡»am
 = io¡»am.
	`IOSŒ—m
(

306 
£lf
.
sock
,

307 
£lf
.
io_loİ
,

308 
£lf
.
max_bufãr_size
,

309 {
dns_timeout
 = 
£lf
.
kw¬gs
.
cÚÃù_timeout
-1
	}
})

310 
	g£lf
.
	gio¡»am
:
	$cÚÃù
(

311 
£lf
.
ho¡Çme
,

312 
£lf
.
pÜt
,

313 
£lf
.
çmy
,

314 
£lf
.
_hªdË_cÚÃù
,

315 
£lf
.
_hªdË_cÚÃù_ç
,

316 
£lf
)

317 
–£if
 
£lf
.
schema
 =ğ"h‰ps" 
th’


318 -- 
HTTPS
 
cÚÃù
.

319 -- 
C»©e
 
cÚ‹xt
 
nÙ
 
®»ady
 
dÚe
.

320 
nÙ
 
£lf
.
s¦_İtiÚs
 
Ü
‚Ù s–f.s¦_İtiÚs.
_s¦_ùx
 
th’


321 -- 
SSL
 
İtiÚs
 
dÛs
 
nÙ
 
have
 
to
 
be
 
£t
 
by
 
the
 
u£r
Ø
u£
 SSL.

322 -- 
It
 
is
 
a
 
avaabË
 
İtimiz©iÚs
 
the
 
u£r
 
wªts
 
to
 
avoid


323 -- 
»ü—tšg
 
Ãw
 
SSL
 
cÚ‹xts
 
ev”y
 
ãtch
.

324 
£lf
.
s¦_İtiÚs
 = s–f.s¦_İtiÚ 
Ü
 {
	}
}

325 
loÿl
 
rc
, 
	gùx_Ü_”r
 = 
üy±o
.
	$s¦_ü—‹_ş›Á_cÚ‹xt
(

326 
£lf
.
s¦_İtiÚs
.
´iv_key
,

327 
£lf
.
s¦_İtiÚs
.
û¹_key
,

328 
£lf
.
s¦_İtiÚs
.
ÿ_·th
,

329 
£lf
.
s¦_İtiÚs
.
v”ify_ÿ
)

330 
rc
 ~ğ0 
th’


331 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
SSL_ERROR
,

332 
¡ršg
.
	`fÜm©
("Could‚ot create SSL context. %s",

333 
ùx_Ü_”r
))

335 
’d


336 -- 
S‘
 
SSL
 
cÚ‹xt
 
to
 
this
 
şass
. 
This
 
m—ns
 
th©
 
we
 
Úly
 
suµÜt


337 -- 
Úe
 
SSL
 
cÚ‹xt
 
³r
 
š¡ªû
! 
The
 
u£r
 
mu¡
 
ü—‹
 
mÜe
 
şass


338 -- 
š¡ªûs
 
he
 
wishes
 
to
 dØ
so
.

339 
£lf
.
s¦_İtiÚs
.
_s¦_ùx
 = 
ùx_Ü_”r


340 
£lf
.
s¦_İtiÚs
.
_ty³
 = 1 -- 
£t
 
ty³
 
as
 
ş›Á
...

341 
’d


342 
£lf
.
io¡»am
 = io¡»am.
	`SSLIOSŒ—m
(

343 
£lf
.
sock
,

344 
£lf
.
s¦_İtiÚs
,

345 
£lf
.
io_loİ
,

346 
£lf
.
max_bufãr_size
,

347 {
dns_timeout
 = 
£lf
.
kw¬gs
.
cÚÃù_timeout
-1
	}
})

348 
	g£lf
.
	gio¡»am
:
	$cÚÃù
(

349 
£lf
.
ho¡Çme
,

350 
£lf
.
pÜt
,

351 
£lf
.
çmy
,

352 
£lf
.
s¦_İtiÚs
.
v”ify_ÿ
,

353 
£lf
.
_hªdË_cÚÃù
,

354 
£lf
.
_hªdË_cÚÃù_ç
,

355 
£lf
)

356 
–£if
 
£lf
.
kw¬gs
.
®low_websock‘_cÚÃù
 =ğ
Œue
 
th’


357 -- 
AÎow
 
a
 
u£r
 
to
 
u£
 
the
 
ş›Á
Ø
cÚÃù
 
w™h
 
WebSock‘
 
schema
.

358 -- 
HTTPCl›Á
 
wl
 
nÙ
 dØ
the
 
aùu®
 
WebSock‘
 
upg¿de
 
´ÙocŞ
 
though
.

359 
£lf
.
schema
 =ğ"ws" 
th’


360 
£lf
.
io¡»am
 = io¡»am.
	`IOSŒ—m
(

361 
£lf
.
sock
,

362 
£lf
.
io_loİ
,

363 
£lf
.
max_bufãr_size
,

364 {
dns_timeout
 = 
£lf
.
kw¬gs
.
cÚÃù_timeout
-1
	}
})

365 
loÿl
 
	grc
, 
	gmsg
 = 
£lf
.
io¡»am
:
	$cÚÃù
(
£lf
.
ho¡Çme
,

366 
£lf
.
pÜt
,

367 
£lf
.
çmy
,

368 
£lf
.
_hªdË_cÚÃù
,

369 
£lf
.
_hªdË_cÚÃù_ç
,

370 
£lf
)

371 
rc
 ~ğ0 
th’


372 
£lf
:
	$_throw_”rÜ
(
”rÜs
.
COULD_NOT_CONNECT
, 
msg
)

374 
’d


375 
–£if
 
£lf
.
schema
 =ğ"wss" 
th’


376 
nÙ
 
£lf
.
s¦_İtiÚs
 
Ü
‚Ù s–f.s¦_İtiÚs.
_s¦_ùx
 
th’


377 
£lf
.
s¦_İtiÚs
 = s–f.s¦_İtiÚ 
Ü
 {
	}
}

378 
üy±o
.
	$s¦_š™
()

379 
loÿl
 
rc
, 
ùx_Ü_”r
 = 
üy±o
.
	$s¦_ü—‹_ş›Á_cÚ‹xt
(

380 
£lf
.
s¦_İtiÚs
.
´iv_key
,

381 
£lf
.
s¦_İtiÚs
.
û¹_key
,

382 
£lf
.
s¦_İtiÚs
.
ÿ_·th
,

383 
£lf
.
s¦_İtiÚs
.
v”ify_ÿ
)

384 
rc
 ~ğ0 
th’


385 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
SSL_ERROR
,

386 
¡ršg
.
	`fÜm©
("Could‚ot create SSL context. %s",

387 
ùx_Ü_”r
))

389 
’d


390 
£lf
.
s¦_İtiÚs
.
_s¦_ùx
 = 
ùx_Ü_”r


391 
£lf
.
s¦_İtiÚs
.
_ty³
 = 1

392 
’d


393 
£lf
.
io¡»am
 = io¡»am.
	`SSLIOSŒ—m
(

394 
£lf
.
sock
,

395 
£lf
.
s¦_İtiÚs
,

396 
£lf
.
io_loİ
,

397 
£lf
.
max_bufãr_size
,

398 {
dns_timeout
 = 
£lf
.
kw¬gs
.
cÚÃù_timeout
-1
	}
})

399 
	g£lf
.
	gio¡»am
:
	$cÚÃù
(

400 
£lf
.
ho¡Çme
,

401 
£lf
.
pÜt
,

402 
£lf
.
çmy
,

403 
£lf
.
s¦_İtiÚs
.
v”ify_ÿ
,

404 
£lf
.
_hªdË_cÚÃù
,

405 
£lf
.
_hªdË_cÚÃù_ç
,

406 
£lf
)

407 
’d


409 -- 
Some
 
Ùh”
 
¡¿nge
 
schema
 
th©
 
nÙ
 
is
 
HTTP
 
Ü
 
suµÜ‹d
 
©
 
®l
.

410 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
INVALID_SCHEMA
,

413 
’d


414 -- 
Add
 
cÚÃù
 
timeout
.

415 
£lf
.
cÚÃù_timeout_»f
 = s–f.
io_loİ
:
	`add_timeout
(

416 
£lf
.
kw¬gs
.
cÚÃù_timeout
 * 1000 + 
ut
.
	`g‘timemÚÙÚic
(),

417 
£lf
.
_hªdË_cÚÃù_timeout
,

418 
£lf
)

420 
’d


422 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_cÚÃù_timeout
()

423 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
(

425 
£lf
.
kw¬gs
.
cÚÃù_timeout
,

426 
£lf
.
kw¬gs
.
m‘hod
,

427 
£lf
.
ho¡Çme
,

428 
£lf
.
·th
))

429 
£lf
.
cÚÃù_timeout_»f
 = 
n


430 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
CONNECT_TIMEOUT
, 
¡ršg
.
	`fÜm©
(

432 
£lf
.
kw¬gs
.
cÚÃù_timeout
))

433 
’d


435 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_cÚÃù_ç
(
¡»¼
)

436 
£lf
.
cÚÃù_timeout_»f
 
th’


437 
£lf
.
io_loİ
:
	$»move_timeout
(
£lf
.
cÚÃù_timeout_»f
)

438 
£lf
.
cÚÃù_timeout_»f
 = 
n


439 
’d


440 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
COULD_NOT_CONNECT
,

441 "Could‚Ù cÚÃù: " .. (
¡»¼
 
Ü
 ""))

442 
’d


444 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_´•¬e_h‰p_»que¡
()

445 
£lf
.
h—d”s
:
	`add
("Ho¡", s–f.
ho¡Çme
)

446 
£lf
.
h—d”s
:
	`add
("U£r-Ag’t", s–f.
kw¬gs
.
u£r_ag’t
)

447 
£lf
.
h—d”s
:
	`£t_m‘hod
(£lf.
kw¬gs
.
m‘hod
:
	$uµ”
())

448 
£lf
.
h—d”s
:
	`£t_v”siÚ
(£lf.
kw¬gs
.
h‰p_v”siÚ
 
Ü
 "HTTP/1.1")

449 
£lf
.
kw¬gs
.
cook›
 
th’


450 
	`ty³
(
£lf
.
kw¬gs
.
cook›
è=ğ"bË" 
th’


451 
loÿl
 
cook›_¡r
 = ""

452 
k
,
v
 
š
 
	$·œs
(
£lf
.
kw¬gs
.
cook›
) do

453 
cook›_¡r
 = cook›_¡¸.. 
¡ršg
.
	`fÜm©
("%s=%s; ", 
k
, 
v
)

454 
’d


455 
£lf
.
h—d”s
:
	`add
("Cook›", 
cook›_¡r
)

456 
’d


457 
’d


458 
	`ty³
(
£lf
.
kw¬gs
.
Ú_h—d”s
è=ğ"funùiÚ" 
th’


459 -- 
C®l
 
Ú
 
h—d”
 
ÿÎback
. 
AÎow
 
the
 
u£r
 
to
 
modify
he

460 -- 
h—d”s
 
şass
 
š¡ªû
 
Ú
 
theœ
 
own
.

461 
£lf
.
kw¬gs
.
	$Ú_h—d”s
(
£lf
.
h—d”s
)

462 
’d


463 
nÙ
 
£lf
.
·th
 
th’


464 
£lf
.
·th
 = "/"

465 
’d


466 
£lf
.
qu”y
 
th’


467 
£lf
.
h—d”s
:
	`£t_uri
(
¡ršg
.
	`fÜm©
("%s?%s", s–f.
·th
, s–f.
qu”y
))

469 
£lf
.
h—d”s
:
	$£t_uri
(
£lf
.
·th
)

470 
’d


471 
loÿl
 
wr™e_buf
 = ""

472 
£lf
.
kw¬gs
.
body
 
th’


473 
	`ty³
(
£lf
.
kw¬gs
.
body
è=ğ"¡ršg" 
th’


474 
loÿl
 
Ën
 = 
£lf
.
kw¬gs
.
body
:
	$Ën
()

475 
£lf
.
h—d”s
:
	`add
("CÚ‹Á-L’gth", 
Ën
)

476 
wr™e_buf
 = wr™e_buà.. 
£lf
.
kw¬gs
.
body
 .. "\r\n\r\n"

478 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
INVALID_BODY
,

481 
’d


482 
–£if
 
	`ty³
(
£lf
.
kw¬gs
.
·¿ms
è=ğ"bË" 
th’


483 
£lf
.
kw¬gs
.
m‘hod
 =ğ"POST" 
Ü
 self.kwargs.method == "PUT" or

484 
£lf
.
kw¬gs
.
m‘hod
 =ğ"DELETE" 
th’


485 
£lf
.
h—d”s
:
	`add
("Content-Type",

487 
loÿl
 
po¡_d©a
 = 
	$deque
()

488 
loÿl
 
n
 = 0

489 
k
, 
v
 
š
 
	$·œs
(
£lf
.
kw¬gs
.
·¿ms
) do

490 ià(
n
 ~ğ0è
th’


491 
po¡_d©a
:
	`­³nd
("&")

492 
’d


493 
n
 =‚ + 1

494 
po¡_d©a
:
	`­³nd
(

495 
¡ršg
.
	`fÜm©
("%s=%s",

496 
esÿ³
.
	`esÿ³
(
k
),

497 
esÿ³
.
	$esÿ³
(
v
)))

498 
’d


499 
wr™e_buf
 = wr™e_buà.. 
po¡_d©a


500 
£lf
.
h—d”s
:
	`add
("CÚ‹Á-L’gth", 
wr™e_buf
:
	$Ën
())

501 
–£if
 
£lf
.
kw¬gs
.
m‘hod
 =ğ"GET" 
ªd
 
nÙ
 s–f.
qu”y
 
th’


502 
loÿl
 
g‘_u¾_·¿ms
 = 
	$deque
()

503 
loÿl
 
n
 = 0

504 
g‘_u¾_·¿ms
:
	`­³nd
("?")

505 
k
, 
v
 
š
 
	$·œs
(
£lf
.
kw¬gs
.
·¿ms
) do

506 ià(
n
 ~ğ0è
th’


507 
g‘_u¾_·¿ms
:
	`­³nd
("&")

508 
’d


509 
n
 =‚ + 1

510 
g‘_u¾_·¿ms
:
	`­³nd
(

511 
¡ršg
.
	`fÜm©
("%s=%s",

512 
esÿ³
.
	`esÿ³
(
k
),

513 
esÿ³
.
	$esÿ³
(
v
)))

514 
’d


515 
£lf
.
h—d”s
:
	`£t_uri
(£lf.h—d”s:
	`g‘_uri
(è.. 
g‘_u¾_·¿ms
)

516 
’d


517 
’d


518 
loÿl
 
¡ršgiãd_h—d”s
 = 
£lf
.
h—d”s
:
	$¡ršgify_as_»que¡
()

519 
wr™e_buf
 = 
¡ršgiãd_h—d”s
 .. write_buf

520  
wr™e_buf


521 
’d


523 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_£nd_h‰p_»que¡
()

524 
loÿl
 
»q
 = 
£lf
.req

525 
nÙ
 
»q
 
th’


526 
»q
 = 
£lf
:
	$_´•¬e_h‰p_»que¡
()

527 
»q
 =ğ-1 
th’


529 
’d


530 
’d


531 
£lf
.
io¡»am
:
	$wr™e
(
»q
, 
£lf
.
_h—d”s_wr™‹n_cb
, self)

532 
’d


534 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_cÚÃù
()

535 
£lf
.
s_cÚÃùšg
 = 
çl£


536 
£lf
.
io_loİ
:
	$»move_timeout
(
£lf
.
cÚÃù_timeout_»f
)

537 
£lf
.
cÚÃù_timeout_»f
 = 
n


538 
£lf
.
»que¡_timeout_»f
 = s–f.
io_loİ
:
	`add_timeout
(

539 
£lf
.
kw¬gs
.
»que¡_timeout
 * 1000 + 
ut
.
	`g‘timemÚÙÚic
(),

540 
£lf
.
_hªdË_»que¡_timeout
,

541 
£lf
)

542 
£lf
:
	$_£nd_h‰p_»que¡
()

543 
’d


545 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_h—d”s_wr™‹n_cb
()

546 
£lf
.
io¡»am
:
	`»ad_uÁ_·‰”n
("\r?\n\r?\n", s–f.
_hªdË_h—d”s
, self)

547 
’d


549 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_»que¡_timeout
()

550 
£lf
.
»que¡_timeout_»f
 = 
n


551 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
(

552 "[async.lua] Reque¡Ø% timed out.", 
£lf
.
ho¡Çme
))

553 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
REQUEST_TIMEOUT
,

554 
¡ršg
.
	`fÜm©
("Requestimed out‡fter %d secs",

555 
£lf
.
kw¬gs
.
»que¡_timeout
))

556 
’d


558 
funùiÚ
 
async
.
HTTPCl›Á
:
	`_hªdË_1xx_code
(
code
)

559 -- 
CÚtšue
 
»adšg
.

560 
£lf
.
io¡»am
:
	`»ad_uÁ_·‰”n
(

562 
£lf
.
_hªdË_h—d”s
,

563 
£lf
)

564 
’d


566 
loÿl
 
funùiÚ
 
	$_Ú_h—d”s_”rÜ_hªdËr
(
”r
)

567 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
("[async.lua] Invalid„esponse HTTP header. %s",

568 
”r
))

569 
’d


571 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_h—d”s
(
d©a
)

572 
nÙ
 
d©a
 
th’


573 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
NO_HEADERS
,

576 
’d


577 
loÿl
 
¡©us
, 
h—d”s
 = 
	`xpÿÎ
(
h‰put
.
HTTPP¬£r
,

578 
_Ú_h—d”s_”rÜ_hªdËr
, 
d©a
, 
h‰put
.
hdr_t
["HTTP_RESPONSE"])

579 
¡©us
 =ğ
çl£
 
th’


580 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
PARSE_ERROR_HEADERS
,

581 "Could‚Ù…¬£ HTTP„e¥Ú£ h—d”: " .. 
”ºodesc
)

583 
’d


584 
£lf
.
»¥Ú£_h—d”s
 = 
h—d”s


585 
loÿl
 
code
 = 
£lf
.
»¥Ú£_h—d”s
:
	$g‘_¡©us_code
()

586 
code
 =ğ101 
th’


587 -- 
Sw™chšg
 
PrÙocŞs
.

588 
£lf
:
	$_fš®ize_»que¡
()

590 
–£if
 100 <ğ
code
 
ªd
 cod< 200 
th’


591 
£lf
:
	$_hªdË_1xx_code
(
code
)

593 
’d


594 
loÿl
 
cÚ‹Á_Ëngth
 = 
£lf
.
»¥Ú£_h—d”s
:
	`g‘
("CÚ‹Á-L’gth", 
Œue
)

595 
nÙ
 
cÚ‹Á_Ëngth
 
Ü
 cÚ‹Á_Ëngth =ğ0 o¸
£lf
.
kw¬gs
.
m‘hod
 =ğ"HEAD" 
th’


596 
£lf
.
»¥Ú£_h—d”s
:
	`g‘
("T¿nsãr-Encodšg", 
Œue
) ==

597 "chunked" 
ªd
 
£lf
.
kw¬gs
.
m‘hod
 ~ğ"HEAD" 
th’


598 -- 
Chunked
 
’codšg
.

599 
£lf
.
_chunked
 = 
Œue


600 
£lf
.
_»ad_bufãr
 = 
	$bufãr
()

601 
£lf
.
io¡»am
:
	`»ad_uÁ
("\r\n", s–f.
_hªdË_chunked_’codšg
,

602 
£lf
)

604 -- 
No
 
cÚ‹Á
 
Ëngth
 
Ü
 
chunked
, 
no
 
body
 
´e£Á
.

605 
£lf
:
	$_fš®ize_»que¡
()

606 
’d


608 
’d


609 
£lf
.
io¡»am
:
	`»ad_by‹s
(
	`tÚumb”
(
cÚ‹Á_Ëngth
),

610 
£lf
.
_hªdË_body
,

611 
£lf
)

612 
’d


614 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_chunked_’codšg
(
d©a
)

615 
loÿl
 
Ãxt_Ën
 = 
	$tÚumb”
(
d©a
, 16)

616 
Ãxt_Ën
 
ªd
‚ext_ËÀ> 0 
th’


617 
£lf
.
io¡»am
:
	`»ad_by‹s
(
Ãxt_Ën
 + 2, s–f.
_chunked_d©a
, self)

619 -- 
Clo£
.

620 
£lf
.
·ylßd
 = 
	$to¡ršg
(
£lf
.
_»ad_bufãr
)

621 
£lf
.
_»ad_bufãr
 = 
n


622 
£lf
:
	$_fš®ize_»que¡
()

623 
’d


624 
’d


626 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_chunked_d©a
(
d©a
)

627 
d©a
 
ªd
 d©a:
	`Ën
(è> 0 
th’


628 -- 
Sk
 
­³ndšg
 
of
 
’dšg
 
CRLF
.

629 
£lf
.
_»ad_bufãr
:
	`­³nd_right
(
d©a
, d©a:
	`Ën
() - 2)

630 
’d


631 
£lf
.
io¡»am
:
	`»ad_uÁ
("\r\n", s–f.
_hªdË_chunked_’codšg
, self)

632 
’d


634 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_body
(
d©a
)

635 
£lf
.
·ylßd
 = 
d©a


636 
£lf
:
	$_fš®ize_»que¡
()

637 
’d


639 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_hªdË_»dœeù
(
loÿtiÚ
)

640 
£lf
.
»dœeù
 = self.redirect + 1

641 
log
.
	`w¬nšg
("[async.lua] RedœeùØ=> " .. 
loÿtiÚ
)

642 
£lf
.
»dœeù_max
 < s–f.
»dœeù
 
th’


643 
£lf
:
	`_throw_”rÜ
(
”rÜs
.
REDIRECT_MAX
, "Redirect maximum„eached")

645 
’d


646 
loÿl
 
Şd_schema
 = 
£lf
.
schema


647 
loÿl
 
Şd_ho¡
 = 
£lf
.
ho¡Çme


648 
£lf
:
	`_£t_u¾
(
loÿtiÚ
)

649 -- 
PÜt
 
may
 
nÙ
 
be
 
£t
 
by
 
_£t_u¾
 
th”e
 
is
 
nÚe
 
defšed
 
š
 
»dœeù


650 -- 
URL
. 
U£
 
deçuÉs
 
known
 
schemas
.

651 
nÙ
 
£lf
.
pÜt
 
th’


652 
£lf
.
schema
 =ğ"h‰p" 
th’


653 
£lf
.
pÜt
 = 80

654 
–£if
 
£lf
.
schema
 =ğ"h‰ps" 
th’


655 
£lf
.
pÜt
 = 443

656 
’d


657 
’d


658 
£lf
.
»¥Ú£_h—d”s
:
	`g‘
("CÚÃùiÚ"è=ğ"şo£" 
Ü


659 
£lf
.
io¡»am
:
	$şo£d
(è
Ü
 
Şd_ho¡
 ~ğ
£lf
.
ho¡Çme
 or

660 
Şd_schema
 ~ğ
£lf
.
schema
 
th’


661 
£lf
.
io¡»am
:
	$şo£
()

662 
loÿl
 
sock
, 
msg
 = 
sock‘
.
	$Ãw_nÚblock_sock‘
(
£lf
.
çmy
,

663 
sock‘
.
SOCK_STREAM
,

665 
sock
 =ğ-1 
th’


666 
£lf
:
	$_throw_”rÜ
(
”rÜs
.
SOCKET_ERROR
, 
msg
)

668 
’d


669 
£lf
.
sock
 = sock

670 
£lf
:
	$_cÚÃù
()

672 
’d


673 
£lf
:
	$_£nd_h‰p_»que¡
()

674 
’d


676 
funùiÚ
 
async
.
HTTPCl›Á
:
	`_throw_”rÜ
(
code
, 
msg
)

677 -- 
Add
 
as
 
ÿÎback
 
to
 
make
 
su»
 
th©
 
”rÜs
 
¬e
 
®ways
 
»tuºed
 
aá”
 
the


678 -- 
CÜoutšeCÚ‹xt
 
has
 
’ded
 
up
 
š
 
the
 
IOLoİ
.

679 
£lf
.
s_”rÜ
 = 
Œue


680 
£lf
.
”rÜ_code
 = 
code


681 
£lf
.
”rÜ_¡r
 = 
msg


682 
£lf
.
io_loİ
:
	$add_ÿÎback
(
£lf
.
_fš®ize_»que¡
, self)

683 
’d


685 
funùiÚ
 
async
.
HTTPCl›Á
:
	$_fš®ize_»que¡
()

686 
£lf
.
š_´og»ss
 = 
çl£


687 
£lf
.
»que¡_timeout_»f
 
th’


688 
£lf
.
io_loİ
:
	$»move_timeout
(
£lf
.
»que¡_timeout_»f
)

689 
’d


690 
£lf
.
cÚÃù_timeout_»f
 
th’


691 
£lf
.
io_loİ
:
	$»move_timeout
(
£lf
.
cÚÃù_timeout_»f
)

692 
’d


693 
nÙ
 
£lf
.
s_”rÜ
 
th’


694 
£lf
.
fšish_time
 = 
ut
.
	$g‘timemÚÙÚic
()

695 
loÿl
 
¡©us_code
 = 
£lf
.
»¥Ú£_h—d”s
:
	$g‘_¡©us_code
()

696 ià(
¡©us_code
 =ğ200è
th’


697 
log
.
	`sucûss
(
¡ršg
.
	`fÜm©
("[async.lua] %s %s:%d%s => %d %s %dms",

698 
£lf
.
kw¬gs
.
m‘hod
,

699 
£lf
.
ho¡Çme
,

700 
£lf
.
pÜt
,

701 
£lf
.
·th
 
Ü
 "",

702 
¡©us_code
,

703 
h‰p_»¥Ú£_codes
[
¡©us_code
],

704 
£lf
.
fšish_time
 - s–f.
¡¬t_time
))

706 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
("[async.lua] %s %s:%d%s => %d %s %dms",

707 
£lf
.
kw¬gs
.
m‘hod
,

708 
£lf
.
ho¡Çme
,

709 
£lf
.
pÜt
,

710 
£lf
.
·th
 
Ü
 "",

711 
¡©us_code
,

712 
h‰p_»¥Ú£_codes
[
¡©us_code
],

713 
£lf
.
fšish_time
 - s–f.
¡¬t_time
))

714 
’d


715 -- 
HªdË
 
»dœeù
.

716 
loÿl
 
»s_code
 = 
£lf
.
»¥Ú£_h—d”s
:
	$g‘_¡©us_code
()

717 ià(
»s_code
 =ğ301 
Ü
„es_cod=ğ302è
ªd
 
£lf
.
kw¬gs
.
®low_»dœeùs
‡nd

718 
£lf
.
»dœeù
 < s–f.
»dœeù_max
 
th’


719 
loÿl
 
»dœeù_loc
 = 
£lf
.
»¥Ú£_h—d”s
:
	`g‘
("LoÿtiÚ", 
Œue
)

720 
»dœeù_loc
:
	`m©ch
("^/.*"è
th’


721 -- 
If
 
LoÿtiÚ
 
h—d”
 
¡¬ts
 
w™h
 /, 
Œ—t
 
™
 
as
 
a
 
»dœeù
 
to


722 -- 
the
 
§me
 
schema
, 
ho¡Çme
 
ªd
 
pÜt
, 
wh”e
 
LoÿtiÚ
 
is
he

723 -- 
·th
.

724 
»dœeù_loc
 = 
¡ršg
.
	`fÜm©
("%s://%s:%d%s",

725 
£lf
.
schema
,

726 
£lf
.
ho¡Çme
,

727 
£lf
.
pÜt
,

728 
»dœeù_loc
)

729 
’d


730 
»dœeù_loc
 
th’


731 
£lf
:
	$_hªdË_»dœeù
(
»dœeù_loc
)

733 
’d


734 
’d


735 
’d


736 
£lf
.
io¡»am
 
ªd
 s–f.
kw¬gs
.
k“p_®ive
 ~ğ
Œue
 
th’


737 
£lf
.
io¡»am
:
	$şo£
()

738 
£lf
.
io¡»am
 = 
n


739 
’d


740 
loÿl
 
»s
 = 
async
.
	$HTTPRe¥Ú£
()

741 
£lf
.
s_”rÜ
 =ğ
Œue
 
th’


742 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
("[async.lua] Error code %d. %s",

743 
£lf
.
”rÜ_code
,

744 
£lf
.
”rÜ_¡r
))

745 
»s
.
”rÜ
 = {

746 
code
 = 
£lf
.
”rÜ_code
,

747 
mes§ge
 = 
£lf
.
”rÜ_¡r


748 
	}
}

750 
	g»s
.
	g”rÜ
 = 
n


751 
»s
.
code
 = 
£lf
.
»¥Ú£_h—d”s
:
	$g‘_¡©us_code
()

752 
»s
.
»asÚ
 = 
h‰p_»¥Ú£_codes
[»s.
code
]

753 
»s
.
body
 = 
£lf
.
·ylßd


754 
»s
.
»que¡_time
 = 
£lf
.
fšish_time
 - s–f.
¡¬t_time


755 
»s
.
h—d”s
 = 
£lf
.
»¥Ú£_h—d”s


756 
»s
.
u¾
 = 
£lf
.url

757 
’d


758 
£lf
.
coùx
:
	$£t_¡©e
(
coùx
.
¡©es
.
DEAD
)

759 
£lf
.
coùx
:
	`£t_¬gum’ts
({
»s
})

760 
£lf
.
coùx
:
	$fš®ize_cÚ‹xt
()

761 
’d


763 
async
.
HTTPRe¥Ú£
 = 
	`şass
("HTTPResponse")

766  
async


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/cdef.lua

1 --- 
	gTurbo
.
lua
 
C
 
funùiÚ
 
	gdeş¬©iÚs


3 -- 
	gCİyright
 2013, 2014 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

18 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

20 
loÿl
 
S
 = 
pÿÎ
(
»quœe
, "syscall")

22 --- ******* 
¡dlib
 
UNIX
 *******

23 
	gffi
.
	gcdef
 [[

24 
pid_t
;

26 *
m®loc
(
size_t
 
sz
);

27 *
»®loc
(*
±r
, 
size_t
 
size
);

28 
ä“
(*
±r
);

29 
¥rštf
(*
¡r
, cÚ¡ *
fÜm©
, ...);

30 
´štf
(cÚ¡ *
fÜm©
, ...);

31 *
memmove
(*
de¡š©iÚ
, cÚ¡ *
sourû
, 
size_t
 
num
);

32 
memcmp
(cÚ¡ *
±r1
, cÚ¡ *
±r2
, 
size_t
 
num
);

33 *
memchr
(*
±r
, 
v®ue
, 
size_t
 
num
);

34 
¡ºÿ£cmp
(cÚ¡ *
s1
, cÚ¡ *
s2
, 
size_t
 
n
);

35 
¡rÿ£cmp
(cÚ¡ *
s1
, cÚ¡ *
s2
);

36 
¢´štf
(*
s
, 
size_t
 
n
, cÚ¡ *
fÜm©
, ...);

37 
size_t
 
¡¾’
(cÚ¡ *
¡r
);

38 
pid_t
 
fÜk
();

39 
pid_t
 
wa™
(*
¡©us
);

40 
pid_t
 
wa™pid
Õid_ˆ
pid
, *
¡©us
, 
İtiÚs
);

41 
pid_t
 
g‘pid
();

42 
execvp
(cÚ¡ *
·th
, *cÚ¡ 
¬gv
[]);

43 
fú
(
fd
, 
cmd
, 
İt
);

44 
¦“p
(
£cÚds
);

46 
	g¶©fÜm
.
__WINDOWS__
 
	gth’


47 -- 
Wšdows
 
v”siÚ
 
of
 
UNIX
 
	g¡ºÿ£cmp
.

48 
	gffi
.
	gcdef
[[

49 
_¡ºicmp
(

50 cÚ¡ *
¡ršg1
,

51 cÚ¡ *
¡ršg2
,

52 
size_t
 
couÁ
);

54 
	g’d


57 --- ******* 
B”k–ey
 
Sock‘
 
UNIX
 *******

59 
nÙ
 
S
 
th’


60 
	gffi
.
	gcdef
 [[

61 
	ssockaddr
{

62 
§_çmy
;

63 
§_d©a
[14];

65 
	ssockaddr_¡Üage
{

66 
	mss_çmy
;

67 
	m__ss_®ign
;

68 
	m__ss_·ddšg
[128 - (2 *())];

70 
	sš_addr
{

71 
	ms_addr
;

73 
	sš6_addr
{

74 
	ms6_addr
[16];

76 
	ssockaddr_š
{

77 
	msš_çmy
;

78 
	msš_pÜt
;

79 
š_addr
 
	msš_addr
;

80 
	msš_z”o
[8];

81 } 
__©Œibu‹__
 ((
__·cked__
));

82 
	ssockaddr_š6
{

83 
	msš6_çmy
;

84 
	msš6_pÜt
;

85 
	msš6_æowšfo
;

86 
š6_addr
 
	msš6_addr
;

87 
	msš6_scİe_id
;

89 
	t§_çmy_t
;

90 
	ssockaddr_un
 {

91 
§_çmy_t
 
	msun_çmy
;

92 
	msun_·th
[108];

95 
’d


97 
	gffi
.
	gcdef
 [[

98 
sockËn_t
;

100 *
¡»¼Ü
(
”ºum
);

101 
sock‘
(
domaš
, 
ty³
, 
´ÙocŞ
);

102 
bšd
(
fd
, cÚ¡ 
sockaddr
 *
addr
, 
sockËn_t
 
Ën
);

103 
li¡’
(
fd
, 
backlog
);

104 
dup
(
Şdfd
);

105 
şo£
(
fd
);

106 
cÚÃù
(
fd
, cÚ¡ 
sockaddr
 *
addr
, 
sockËn_t
 
Ën
);

107 
£tsockİt
(

108 
fd
,

109 
Ëv–
,

110 
İŠame
,

111 cÚ¡ *
İtv®
,

112 
sockËn_t
 
İ’
);

113 
g‘sockİt
(

114 
fd
,

115 
Ëv–
,

116 
İŠame
,

117 *
İtv®
,

118 
sockËn_t
 *
İ’
);

119 
acû±
(
fd
, 
sockaddr
 *
addr
, 
sockËn_t
 *
addr_Ën
);

120 
š_addr_t
;

121 
š_addr_t
 
š‘_addr
(cÚ¡ *
ı
);

122 
Áohl
(
ÃÚg
);

123 
htÚl
(
ho¡lÚg
);

124 
Áohs
(
ÃtshÜt
);

125 
htÚs
(
ho¡shÜt
);

126 
š‘_±Ú
(
af
, cÚ¡ *
ı
, *
buf
);

127 cÚ¡ *
š‘_Áİ
(

128 
af
,

129 cÚ¡ *
ı
,

130 *
buf
,

131 
sockËn_t
 
Ën
);

132 *
š‘_Áß
(
š_addr
 
š
);

135 
	g¶©fÜm
.
__ABI32__
 
th’


136 
	gffi
.
	gcdef
 [[

137 
£nd
(
fd
, cÚ¡ *
buf
, 
size_t
 
n
, 
æags
);

138 
»cv
(
fd
, *
buf
, 
size_t
 
n
, 
æags
);

140 
–£if
 
	g¶©fÜm
.
__ABI64__
 
th’


141 
	gffi
.
	gcdef
 [[

142 
št64_t
 
£nd
(
fd
, cÚ¡ *
buf
, 
size_t
 
n
, 
æags
);

143 
št64_t
 
»cv
(
fd
, *
buf
, 
size_t
 
n
, 
æags
);

145 
	g’d


148 --- ******* 
ResŞv
 *******

149 
	gffi
.
	gcdef
[[

150 
	sho¡’t
{

151 *
h_Çme
;

152 **
h_®Ÿ£s
;

153 
h_add¹y³
;

154 
h_Ëngth
;

155 **
h_addr_li¡
;

157 
	saddršfo
{

158 
ai_æags
;

159 
ai_çmy
;

160 
ai_sockty³
;

161 
ai_´ÙocŞ
;

162 
sockËn_t
 
ai_add¾’
;

163 
sockaddr
 *
ai_addr
;

164 *
ai_ÿnÚÇme
;

165 
addršfo
 *
ai_Ãxt
;

168 
	sgaicb
 {

169 cÚ¡ *
¬_Çme
;

170 cÚ¡ *
¬_£rviû
;

171 cÚ¡ 
addršfo
 *
¬_»que¡
;

172 
addršfo
 *
¬_»suÉ
;

175 
ho¡’t
 *
g‘ho¡byÇme
(cÚ¡ *
Çme
);

176 
g‘addršfo
(

177 cÚ¡ *
nod’ame
,

178 cÚ¡ *
£rvÇme
,

179 cÚ¡ 
addršfo
 *
hšts
,

180 
addršfo
 **
»s
);

181 
ä“addršfo
(
addršfo
 *
ai
);

182 cÚ¡ *
gai_¡»¼Ü
(
ecode
);

183 
__»s_š™
();

187 --- ******* 
SigÇls
 *******

188 
nÙ
 
S
 
th’


189 
	gffi
.
	gcdef
 [[

190 
	ssigÇlfd_sigšfo
{

191 
ssi_signo
;

192 
ssi_”ºo
;

193 
ssi_code
;

194 
ssi_pid
;

195 
ssi_uid
;

196 
ssi_fd
;

197 
ssi_tid
;

198 
ssi_bªd
;

199 
ssi_ov”run
;

200 
ssi_Œ­no
;

201 
ssi_¡©us
;

202 
ssi_št
;

203 
ušt64_t
 
ssi_±r
;

204 
ušt64_t
 
ssi_utime
;

205 
ušt64_t
 
ssi_¡ime
;

206 
ušt64_t
 
ssi_addr
;

207 
__·d
[48];

209 
	usigv®
 {

210 
	msiv®_št
;

211 *
	msiv®_±r
;

213 
	ssigev’t
 {

214 
	msigev_nÙify
;

215 
	msigev_signo
;

216 
sigv®
 
	msigev_v®ue
;

217 (*
	msigev_nÙify_funùiÚ
è(
	msigv®
);

218 *
	msigev_nÙify_©Œibu‹s
;

219 
pid_t
 
	msigev_nÙify_th»ad_id
;

222 
’d


223 
	gffi
.
cdef
(
¡ršg
.
fÜm©
([[

224 (*
sighªdËr_t
)();

225 
sighªdËr_t
 
	`sigÇl
(
signum
, sighªdËr_ˆ
hªdËr
);

226 
	`kl
(
pid_t
 
pid
, 
sig
);

228 
__v®
[%
d
];

229 } 
	t__sig£t_t
;

230 
__sig£t_t
 
	tsig£t_t
;

231 
	`sigem±y£t
(
sig£t_t
 *
£t
);

232 
	`sigfl£t
(
sig£t_t
 *
£t
);

233 
	`sigadd£t
(
sig£t_t
 *
£t
, 
signum
);

234 
	`sigd–£t
(
sig£t_t
 *
£t
, 
signum
);

235 
	`sigismemb”
(cÚ¡ 
sig£t_t
 *
£t
, 
signum
);

236 
	`sig´ocmask
(
how
, cÚ¡ 
sig£t_t
 *
£t
, sig£t_ˆ*
Şd£t
);

237 
	`sigÇlfd
(
fd
, cÚ¡ 
sig£t_t
 *
mask
, 
æags
);

238 ]], (1024 / (8 *
ffi
.("unsigned†ong")))))

241 --- ******* 
Time
 *******

242 
nÙ
 
S
 
th’


243 
ffi
.
cdef
[[

244 
su£cÚds_t
;

245 
time_t
;

246 
	stimev®
{

247 
time_t
 
tv_£c
;

248 
su£cÚds_t
 
tv_u£c
;

250 
	stimezÚe
{

251 
tz_mšu‹swe¡
;

252 
tz_d¡time
;

255 
’d


256 
ffi
.
	`cdef
([[

257 
su£cÚds_t
;

258 
time_t
;

259 
	stm


261 
tm_£c
;

262 
tm_mš
;

263 
tm_hour
;

264 
tm_mday
;

265 
tm_mÚ
;

266 
tm_y—r
;

267 
tm_wday
;

268 
tm_yday
;

269 
tm_isd¡
;

270 
__tm_gmtoff
;

271 cÚ¡ *
__tm_zÚe
;

273 
timezÚe
 *
timezÚe_±r_t
;

275 
size_t
 
	`¡ráime
(

276 *
±r
,

277 
size_t
 
maxsize
,

278 cÚ¡ *
fÜm©
,

279 cÚ¡ 
tm
 *
tim•Œ
);

280 
tm
 *
	`loÿÉime
(cÚ¡ 
time_t
 *
tim”
);

281 
time_t
 
	`time
Ñime_ˆ*
tim”
);

283 
	`åuts
(cÚ¡ *
¡r
, *
¡»am
);

284 
	`¢´štf
(*
s
, 
size_t
 
n
, cÚ¡ *
fÜm©
, ...);

285 
	`¥rštf
 ( *
¡r
, cÚ¡ *
fÜm©
, ... );

286 
tm
 *
	`gmtime
(cÚ¡ 
time_t
 *
tim”
);

287 
	`g‘timeofday
(
timev®
 *
tv
, 
timezÚe_±r_t
 
tz
);

290 
¶©fÜm
.
__UNIX__
 
th’


292 --- ******* 
	`R—lTime
 (
MÚÙÚic
 
time
) *******

293 
nÙ
 
S
 
th’


294 
ffi
.
cdef
[[

295 
	stime¥ec


297 
time_t
 
tv_£c
;

298 
tv_n£c
;

301 
’d


302 
ffi
.
cdef
[[

303 
şockid_t
;

304 
	eşock_ids
{

305 
CLOCK_REALTIME
,

306 
CLOCK_MONOTONIC


309 
	`şock_g‘time
(
şockid_t
 
şk_id
, 
time¥ec
 *

);

311 
’d


314 
¶©fÜm
.
__LINUX__
 
th’


315 --- ******* 
EpŞl
 *******

316 
nÙ
 
S
 
th’


317 
ffi
.
cdef
[[

318 
	u•Şl_d©a
{

319 *
±r
;

320 
fd
;

321 
u32
;

322 
ušt64_t
 
u64
;

323 } 
•Şl_d©a_t
;

325 
¶©fÜm
.
__ABI32__
 
Ü
…ÏtfÜm.
__PPC64__
 
th’


326 
ffi
.
cdef
[[

327 
	s•Şl_ev’t
{

328 
ev’ts
;

329 
•Şl_d©a_t
 
d©a
;

332 
–£if
 
¶©fÜm
.
__ABI64__
 
th’


333 
ffi
.
cdef
[[

334 
	s•Şl_ev’t
{

335 
ev’ts
;

336 
•Şl_d©a_t
 
d©a
;

337 } 
	`__©Œibu‹__
 ((
__·cked__
));

339 
’d


340 
’d


341 
ffi
.
cdef
[[

342 
•Şl_ev’t
ƒpoll_event;

344 
	`•Şl_ü—‹
(
size
);

345 
	`•Şl_ùl
(

346 
•fd
,

347 
İ
,

348 
fd
,

349 
•Şl_ev’t
 *
ev’t
);

350 
	`•Şl_wa™
(

351 
•fd
,

352 
•Şl_ev’t
 *
ev’ts
,

353 
maxev’ts
,

354 
timeout
);

358 --- ******* 
InÙify
 *******

359 
nÙ
 
S
 
th’


360 
ffi
.
cdef
 [[

361 
	sšÙify_ev’t
{

362 
wd
;

363 
mask
;

364 
cook›
;

365 
Ën
;

366 
Çme
 [];

369 
’d


370 
ffi
.
cdef
 [[

371 
	`šÙify_š™
();

372 
	`šÙify_add_w©ch
(
fd
, cÚ¡ *
Çme
, 
mask
);

373 
	`šÙify_rm_w©ch
 (
fd
, 
wd
);

377 --- ******* 
Fe
 
sy¡em
 *******

378 
ffi
.
cdef
[[

379 
__ssize_t
;

380 
__ssize_t
 
ssize_t
;

382 
ssize_t
 
	`»ad
(
fd
, *
buf
, 
size_t
 
nby‹s
) ;

383 
	`sysÿÎ
(
numb”
, ...);

384 *
	`mm­
(

385 *
addr
,

386 
size_t
 
Ëngth
,

387 
´Ù
,

388 
æags
,

389 
fd
,

390 
off£t
);

391 
	`munm­
(*
addr
, 
size_t
 
Ëngth
);

392 
	`İ’
(cÚ¡ *
·thÇme
, 
æags
);

393 
	`şo£
(
fd
);

394 
	`f¡©
(
fd
, 
¡©
 *
buf
);

397 -- 
¡©
 
¡ruùu»
 
is
 
¬ch™eùu»
 
d•’d’t
 
š
 
Lšux


398 
nÙ
 
S
 
th’


399 
¶©fÜm
.
__X86__
 
th’


400 
ffi
.
cdef
[[

401 
	s¡©
 {

402 
¡_dev
;

403 
¡_šo
;

404 
¡_mode
;

405 
¡_Æšk
;

406 
¡_uid
;

407 
¡_gid
;

408 
¡_rdev
;

409 
¡_size
;

410 
¡_blksize
;

411 
¡_blocks
;

412 
¡_©ime
;

413 
¡_©ime_n£c
;

414 
¡_mtime
;

415 
¡_mtime_n£c
;

416 
¡_ùime
;

417 
¡_ùime_n£c
;

418 
__unu£d4
;

419 
__unu£d5
;

422 
–£if
 
¶©fÜm
.
__X64__
 
th’


423 
ffi
.
cdef
 [[

424 
	s¡©
 {

425 
¡_dev
;

426 
¡_šo
;

427 
¡_Æšk
;

428 
¡_mode
;

429 
¡_uid
;

430 
¡_gid
;

431 
__·d0
;

432 
¡_rdev
;

433 
¡_size
;

434 
¡_blksize
;

435 
¡_blocks
;

436 
¡_©ime
;

437 
¡_©ime_n£c
;

438 
¡_mtime
;

439 
¡_mtime_n£c
;

440 
¡_ùime
;

441 
¡_ùime_n£c
;

442 
__unu£d
[3];

445 
–£if
 
¶©fÜm
.
__PPC__
 
th’


446 
ffi
.
cdef
[[

447 
	s¡©
 {

448 
¡_dev
;

449 
¡_šo
;

450 
¡_mode
;

451 
¡_Æšk
;

452 
¡_uid
;

453 
¡_gid
;

454 
¡_rdev
;

455 
¡_size
;

456 
¡_blksize
;

457 
¡_blocks
;

458 
¡_©ime
;

459 
¡_©ime_n£c
;

460 
¡_mtime
;

461 
¡_mtime_n£c
;

462 
¡_ùime
;

463 
¡_ùime_n£c
;

464 
__unu£d4
;

465 
__unu£d5
;

468 
–£if
 
¶©fÜm
.
__PPC64__
 
th’


469 
ffi
.
cdef
 [[

470 
	s¡©
 {

471 
¡_dev
;

472 
¡_šo
;

473 
¡_Æšk
;

474 
¡_mode
;

475 
¡_uid
;

476 
¡_gid
;

477 
__·d0
;

478 
¡_rdev
;

479 
¡_size
;

480 
¡_blksize
;

481 
¡_blocks
;

482 
¡_©ime
;

483 
¡_©ime_n£c
;

484 
¡_mtime
;

485 
¡_mtime_n£c
;

486 
¡_ùime
;

487 
¡_ùime_n£c
;

488 
__unu£d
[3];

491 
–£if
 
¶©fÜm
.
__ARM__
 
th’


492 
ffi
.
cdef
[[

493 
	s¡©
 {

494 
¡_dev
;

495 
¡_šo
;

496 
¡_mode
;

497 
¡_Æšk
;

498 
¡_uid
;

499 
¡_gid
;

500 
¡_rdev
;

501 
¡_size
;

502 
¡_blksize
;

503 
¡_blocks
;

504 
¡_©ime
;

505 
¡_©ime_n£c
;

506 
¡_mtime
;

507 
¡_mtime_n£c
;

508 
¡_ùime
;

509 
¡_ùime_n£c
;

510 
__unu£d4
;

511 
__unu£d5
;

514 
–£if
 
¶©fÜm
.
__MIPSEL__
 
th’


515 
ffi
.
cdef
[[

516 
	s¡©
 {

517 
¡_dev
;

518 
¡_·d1
[2];

519 
¡_šo
;

520 
¡_mode
;

521 
¡_Æšk
;

522 
¡_uid
;

523 
¡_gid
;

524 
¡_rdev
;

525 
¡_·d2
[1];

526 
¡_size
;

527 
¡_·d3
;

528 
¡_©ime
;

529 
¡_mtime
;

530 
¡_ùime
;

531 
¡_blksize
;

532 
¡_blocks
;

533 
¡_·d5
[14];

536 
’d


537 
’d


540 -- ****** 
Glob
 ******

541 
ffi
.
cdef
[[

543 
gl_·thc
;

544 **
gl_·thv
;

545 
gl_offs
;

546 
gl_æags
;

547 (*
gl_şo£dœ
)(*);

548 *(*
gl_»addœ
)(*);

549 *(*
gl_İ’dœ
)(const *);

550 (*
gl_l¡©
)(cÚ¡ *
»¡riù
, *restrict);

551 (*
gl_¡©
)(cÚ¡ *
»¡riù
, *restrict);

552 } 
glob_t
;

553 
	`glob
(

554 cÚ¡ *
·‰”n
,

555 
æag
,

557 
glob_t
 *
pglob
);

558 
	`globä“
(
glob_t
 *
pglob
);

560 
’d


563 
_G
.
TURBO_SSL
 
th’


564 --- *******
O³nSSL
 *******

565 -- 
NÙe
: 
Ty³def
 
SSL
 
¡ruùs
 
to
 
as
 
we
 
Ãv”
 
acûss
 
theœ
 
memb”s
 
ªd


566 -- 
they
 
¬e
 
massive
 
š
 
ifdef
'sƒtc‡nd‡re best†eft‡s blackboxes!

567 
ffi
.
cdef
[[

568 
SSL_METHOD
;

569 
SSL_CTX
;

570 
SSL
;

571 
X509
;

572 
X509_NAME
;

573 
X509_NAME_ENTRY
;

574 
ASN1_STRING
;

575 
SHA_LONG
;

576 
EVP_MD
;

577 
	sSHA¡©e_¡
{

578 
SHA_LONG
 
h0
,
h1
,
h2
,
h3
,
h4
;

579 
SHA_LONG
 
Nl
,
Nh
;

580 
SHA_LONG
 
d©a
[16];

581 
num
;

582 } 
	tSHA_CTX
;

584 cÚ¡ 
SSL_METHOD
 *
	`SSLv3_£rv”_m‘hod
();

585 cÚ¡ 
SSL_METHOD
 *
	`SSLv3_ş›Á_m‘hod
();

586 cÚ¡ 
SSL_METHOD
 *
	`SSLv23_m‘hod
();

587 cÚ¡ 
SSL_METHOD
 *
	`SSLv23_£rv”_m‘hod
();

588 cÚ¡ 
SSL_METHOD
 *
	`SSLv23_ş›Á_m‘hod
();

589 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_m‘hod
();

590 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_£rv”_m‘hod
();

591 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_ş›Á_m‘hod
();

592 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_1_m‘hod
();

593 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_1_£rv”_m‘hod
();

594 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_1_ş›Á_m‘hod
();

595 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_2_m‘hod
();

596 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_2_£rv”_m‘hod
();

597 cÚ¡ 
SSL_METHOD
 *
	`TLSv1_2_ş›Á_m‘hod
();

598 
	`OPENSSL_add_®l_®gÜ™hms_nocÚf
();

599 
	`SSL_lßd_”rÜ_¡ršgs
();

600 
	`ERR_ä“_¡ršgs
();

601 
	`SSL_lib¿ry_š™
();

602 
	`EVP_ş—nup
();

603 
SSL_CTX
 *
	`SSL_CTX_Ãw
(cÚ¡ 
SSL_METHOD
 *
m‘h
);

604 
	`SSL_CTX_ä“
(
SSL_CTX
 *);

605 
	`SSL_CTX_u£_Priv©eKey_fe
(

606 
SSL_CTX
 *
ùx
,

607 cÚ¡ *
fe
,

608 
ty³
);

609 
	`SSL_CTX_u£_û¹ifiÿ‹_fe
(

610 
SSL_CTX
 *
ùx
,

611 cÚ¡ *
fe
,

612 
ty³
);

613 
	`SSL_CTX_u£_û¹ifiÿ‹_chaš_fe
(

614 
SSL_CTX
 *
ùx
,

615 cÚ¡ *
fe
);

616 
	`SSL_CTX_lßd_v”ify_loÿtiÚs
(

617 
SSL_CTX
 *
ùx
,

618 cÚ¡ *
CAfe
,

619 cÚ¡ *
CA·th
);

620 
	`SSL_CTX_check_´iv©e_key
(cÚ¡ 
SSL_CTX
 *
ùx
);

621 
SSL
 *
	`SSL_Ãw
(
SSL_CTX
 *
ùx
);

622 
	`SSL_£t_cÚÃù_¡©e
(
SSL
 *
s
);

623 
	`SSL_£t_acû±_¡©e
(
SSL
 *
s
);

624 
	`SSL_do_hªdshake
(
SSL
 *
s
);

625 
	`SSL_£t_fd
(
SSL
 *
s
, 
fd
);

626 
	`SSL_acû±
(
SSL
 *
s¦
);

627 
	`SSL_ä“
(
SSL
 *
s¦
);

628 
	`SSL_acû±
(
SSL
 *
s¦
);

629 
	`SSL_cÚÃù
(
SSL
 *
s¦
);

630 
	`SSL_»ad
(
SSL
 *
s¦
,*
buf
,
num
);

631 
	`SSL_³ek
(
SSL
 *
s¦
,*
buf
,
num
);

632 
	`SSL_wr™e
(
SSL
 *
s¦
,cÚ¡ *
buf
,
num
);

633 
	`SSL_£t_v”ify
(

634 
SSL
 *
s
,

635 
mode
,

636 (*
ÿÎback
)(
ok
,*
ùx
));

637 
	`SSL_£t_ch”_li¡
(
SSL
 *
s
, cÚ¡ *
¡r
);

638 
	`SSL_g‘_”rÜ
(cÚ¡ 
SSL
 *
s
, 
»t_code
);

639 
	`SSL_CTX_£t_v”ify_d•th
(
SSL_CTX
 *
ùx
, 
d•th
);

640 
	`SSL_CTX_£t_v”ify
(
SSL_CTX
 *
ùx
, 
mode
, *);

641 
X509
 *
	`SSL_g‘_³”_û¹ifiÿ‹
(cÚ¡ 
SSL
 *
s
);

642 
	`SSL_g‘_v”ify_»suÉ
(cÚ¡ 
SSL
 *
s¦
);

643 cÚ¡ *
	`X509_v”ify_û¹_”rÜ_¡ršg
(
n
);

644 
	`ERR_g‘_”rÜ
();

645 
	`ERR_³ek_”rÜ
();

646 
	`ERR_³ek_”rÜ_lše
(cÚ¡ **
fe
,*
lše
);

647 
	`ERR_³ek_”rÜ_lše_d©a
(

648 cÚ¡ **
fe
,

649 *
lše
,

650 cÚ¡ **
d©a
,*
æags
);

651 
	`ERR_³ek_Ï¡_”rÜ
();

652 
	`ERR_³ek_Ï¡_”rÜ_lše
(cÚ¡ **
fe
,*
lše
);

653 
	`ERR_³ek_Ï¡_”rÜ_lše_d©a
(

654 cÚ¡ **
fe
,

655 *
lše
,

656 cÚ¡ **
d©a
,*
æags
);

657 
	`ERR_ş—r_”rÜ
();

658 *
	`ERR_”rÜ_¡ršg
(
e
,*
buf
);

659 
	`ERR_”rÜ_¡ršg_n
(
e
, *
buf
, 
size_t
 
Ën
);

660 cÚ¡ *
	`ERR_lib_”rÜ_¡ršg
(
e
);

661 cÚ¡ *
	`ERR_func_”rÜ_¡ršg
(
e
);

662 cÚ¡ *
	`ERR_»asÚ_”rÜ_¡ršg
(
e
);

663 cÚ¡ 
EVP_MD
 *
	`EVP_sha1
();

664 *
	`SHA1
(

665 cÚ¡ *
d
,

666 
size_t
 
n
,

667 *
md
);

668 
	`SHA1_In™
(
SHA_CTX
 *
c
);

669 
	`SHA1_Upd©e
(
SHA_CTX
 *
c
, cÚ¡ *
d©a
, 
size_t
 
Ën
);

670 
	`SHA1_Fš®
(*
md
, 
SHA_CTX
 *
c
);

671 *
	`MD5
(

672 cÚ¡ *
d
,

673 
size_t
 
n
,

674 *
md
);

675 *
	`HMAC
(

676 cÚ¡ 
EVP_MD
 *
evp_md
,

677 cÚ¡ *
key
,

678 
key_Ën
,

679 cÚ¡ *
d
,

680 
n
,

681 *
md
,

682 *
md_Ën
);

683 
	`v®id©e_ho¡Çme
(cÚ¡ *
ho¡Çme
, cÚ¡ 
SSL
 *
£rv”
);

685 
’d


688 --- ******* 
HTTP
 
·r£r
 
ªd
 
libtffi
 *******

689 
ffi
.
cdef
[[

690 
	eh‰p_·r£r_u¾_f›lds
{

691 
UF_SCHEMA
 = 0,

692 
UF_HOST
 = 1,

693 
UF_PORT
 = 2,

694 
UF_PATH
 = 3,

695 
UF_QUERY
 = 4,

696 
UF_FRAGMENT
 = 5,

697 
UF_USERINFO
 = 6,

698 
UF_MAX
 = 7

700 
	sh‰p_·r£r
{

701 
ty³
 : 2;

702 
æags
 : 6;

703 
¡©e
;

704 
h—d”_¡©e
;

705 
šdex
;

706 
Ä—d
;

707 
ušt64_t
 
cÚ‹Á_Ëngth
;

708 
h‰p_majÜ
;

709 
h‰p_mšÜ
;

710 
¡©us_code
;

711 
m‘hod
;

712 
h‰p_”ºo
 : 7;

713 
upg¿de
 : 1;

714 *
d©a
;

716 
	sh‰p_·r£r_u¾
 {

717 
f›ld_£t
;

718 
pÜt
;

720 
off
;

721 
Ën
;

722 } 
f›ld_d©a
[7];

724 
	sturbo_key_v®ue_f›ld
{

725 
size_t
 
key_sz
;

726 
size_t
 
v®ue_sz
;

727 cÚ¡ *
key
;

728 cÚ¡ *
v®ue
;

730 
	eh—d”_¡©e
{

731 
NOTHING
,

732 
FIELD
,

733 
VALUE


735 
	sturbo_·r£r_w¿µ”
{

736 
u¾_rc
;

737 
size_t
 
·r£d_sz
;

738 
boŞ
 
h—d”s_com¶‘e
;

739 
h—d”_¡©e
 
_¡©e
;

740 cÚ¡ *
u¾_¡r
;

741 
size_t
 
u¾_sz
;

742 
size_t
 
hkv_sz
;

743 
size_t
 
hkv_mem
;

744 
turbo_key_v®ue_f›ld
 **
hkv
;

745 
h‰p_·r£r
 
·r£r
;

746 
h‰p_·r£r_u¾
 
u¾
;

749 
turbo_·r£r_w¿µ”
 *
	`turbo_·r£r_w¿µ”_š™
(

750 cÚ¡ *
d©a
,

751 
size_t
 
Ën
,

752 
ty³
);

753 
	`turbo_·r£r_w¿µ”_ex™
(
turbo_·r£r_w¿µ”
 *
¤c
);

754 
boŞ
 
	`turbo_·r£r_check
(
turbo_·r£r_w¿µ”
 *
s
);

755 
	`h‰p_·r£r_·r£_u¾
(

756 cÚ¡ *
buf
,

757 
size_t
 
buæ’
,

758 
is_cÚÃù
,

759 
h‰p_·r£r_u¾
 *
u
);

760 
boŞ
 
	`u¾_f›ld_is_£t
(

761 cÚ¡ 
h‰p_·r£r_u¾
 *
u¾
,

762 
h‰p_·r£r_u¾_f›lds
 
´İ
);

763 *
	`u¾_f›ld
(cÚ¡ *
u¾_¡r
,

764 cÚ¡ 
h‰p_·r£r_u¾
 *
u¾
,

765 
h‰p_·r£r_u¾_f›lds
 
´İ
);

766 cÚ¡ *
	`h‰p_”ºo_Çme
(
”r
);

767 cÚ¡ *
	`h‰p_”ºo_desütiÚ
(
”r
);

768 * 
	`turbo_websock‘_mask
(

769 cÚ¡ *
mask32
,

770 cÚ¡ *
š
,

771 
size_t
 
sz
);

772 
ušt64_t
 
	`turbo_bsw­_u64
(ušt64_ˆ
sw­
);

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/coctx.lua

1 --- 
	gTurbo
.
lua
 
CÜoutše
 
CÚ‹xt
 
	gmoduË


2 -- 
ToŞs
 
to
 
hªdË
 
y›ldšg
 
of
 
Reque¡HªdËrs
 
ªd
 
asynchrÚous
 
	g»que¡s
.

3 -- 
	gSim¶e
, 
y‘
 
	gefãùive
.

5 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


7 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

8 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

9 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


11 -- 
	gh‰p
:

13 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


14 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

15 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

16 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


17 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

19 
	g»quœe
 "turbo.3rdparty.middleclass"

21 
loÿl
 
	gcoùx
 = {} -- 
coùx
 
Çme¥aû
.

23 --- 
Couroutše
 
cÚ‹xt
 
h–³r
 
şass
.

24 -- 
This
 
şass
 
is
 
u£d
 
to
 
h–p
 
t›
 
y›lds
 
š
 
Turbo
 
Reque¡HªdËrs
 
tog‘h”


25 -- 
w™h
 
wa™šg
 
ev’ts
 
to
 
become
 
avaabË
. 
The
 
şass
 
aù
 
as
 
a
 
»ã»nû


26 -- 
bÙh
 
the
 
u£r
 
ªd
h
IOLoİ
 
to
 
t›
 
su¥’ded
 
cÜoutšes
 
tog‘h”
 
w™h


27 -- 
aùu®
 
async
 
İ”©iÚs
. 
Typiÿl
 
u§ge
 
would
 
be
:

29 -- 
funùiÚ
 
MyHªdËr
:
g‘
()

30 -- 
loÿl
 
»¥Ú£
, 
	g”rÜ
 = 
cÜoutše
.
y›ld
(

31 -- 
turbo
.
async
.
HTTPCl›Á
:
	$Ãw
():
	`ãtch
("http://myjson.org"))

32 -- .... dØ
¡uff
 
w™h
 
»¥Ú£
 
wh’
 
™
 
is
 
»ady
 
w™hout
 
blockšg
 ....

33 -- 
’d


35 -- 
The
 
HTTPCl›Á
 
şass
 
funùiÚ
 
ãtch
 
»tuºs
 
a
 
CÜoutšeCÚ‹xt
 
š¡ªû
.

36 -- 
The
 
cÜoutše
.
y›ld
 
wl
 
h®t
 
executiÚ
 
of
 
the
 
funùiÚ
 
ªd
 he

37 -- 
CÜoutšeCÚ‹xt
 
äom
 'ãtch'. 
The
 
IOLoİ
 
wl
 
k“p
 
a
 
»ã»nû
 
to
 
the


38 -- 
»tuºed
 
CÜoutšeCÚ‹xt
 
tog‘h”
 
w™h
 
the
 
su¥’ded
 
cÜoutše
. 
This
 
li¡


39 -- 
is
 
nÙ
 
™”©ed
 
Ú
 
ev”y
 
IOLoİ
 
™”©iÚ
 
so
 
™
 i 
»Ïtiv–y
 
ch—p
 
to
 
have


40 -- 
thou§nds
 
of
 
y›lded
 
Reque¡HªdËrs
 
©
 
Úû
. 
Wh’
 
the
 
HTTPCl›Á
 
şass


41 -- 
š‹º®s
 
has
 
hªdËd
 
the
 
	`»que¡
 (
Ü
 
çed
 
to
 dØ
so
), 
™
 
wl
 
Œigg”
 
a


42 -- 
cÜoutše
 
»sume
 
w™h
 
the
 
·¿m‘”s
 
¡Üed
 
š
h
CÜoutšeCÚ‹xt
 
vŸ
 
a


43 -- 
ÿÎback
 
¶aûd
 
Ú
 
the
 
IOLoİ
 
by
 
m©chšg
h
CÜutšeCÚ‹xt
 by 
»ã»nû
.

44 -- 
OÆy
 
the
 
IOLoİ
 
wl
 
know
 
ªythšg
 
about
 
su¥’ded
 
cÜoutšes
.

45 -- 
Lua
 
CÜoutšes
 
¬e
 
nÙ
 
OS
 
th»ads
 
ªd
‡» 
pu»ly
 
im¶em’‹d
 
š
 
the
 Lua

46 -- 
š‹½»‹r
, 
ªd
 
as
 
such
 
¬e
 
v”y
 
ch—p
 
to
 
ü—‹
, 
su¥’d
‡nd 
de¡roy
.

47 -- 
Y›ldšg
 
ÿn
 
be
 
dÚe
 
äom
 
ªywh”e
 
th©
 
the
 
IOLoİ
:
	$add_ÿÎback
(è
has
 
b“n


48 -- 
u£d
 
to
 
¶aû
 
a
 
funùiÚ
 
Ú
 
the
 
IOLoİ
. 
Howev”
h
y›ld
 
mu¡
, 
e™h”


49 --  
a
 
CÜoutšeCÚ‹xt
 
Ü
‡ 
funùiÚ
. 
A
 
y›lded
 funùiÚ 
wl
 
sim¶y
 
be


50 -- 
»sumed
 
Ú
 
Ãxt
 
™”©iÚ
 
of
 
the
 
IOLoİ
. 
The
 
y›ld”
 
is
 
ä“
 
to
 
y›ld
 
agaš
.

51 -- 
This
 
şass
 
is
 
NOT
 
EXCEPTION
/
ERROR
 
§ã
, 
ªd
 
should
 
nÙ
 
¿i£
 
ªy
 
”rÜs
 
as


52 -- 
they
 
¬e
 
unhªdËd
, 
ªd
 
wl
 
ÿu£
 
the
 
´og¿m
 
to
 
ex™
!

53 
coùx
.
CÜoutšeCÚ‹xt
 = 
	`şass
("CoroutineContext")

55 
coùx
.
¡©es
 = {

56 
SUSPENDED
 = 0x0

57 ,
DEAD
 = 0x1

58 ,
WORKING
 = 0x2

59 ,
WAIT_COND
 = 0x3

60 ,
SCHED
 = 0x4

61 
	}
}

63 --- 
In™Ÿlize
 
CÜoutšeCÚ‹xt
 
şass
 
	gš¡ªû
.

64 -- @
·¿m
 
	$io_loİ
 (
IOLoİ
 
š¡ªû
)

65 
funùiÚ
 
coùx
.
CÜoutšeCÚ‹xt
:
	$š™Ÿlize
(
io_loİ
)

66 
	`as£¹
(
io_loİ
, "No IOLoop class giveno CoroutineContext.")

67 
£lf
.
co_¬gs
 = {
	}
}

68 
£lf
.
co_¡©e
 = 
coùx
.
¡©es
.
SUSPENDED


69 
£lf
.
co_d©a
 = 
n


70 
£lf
.
io_loİ
 = io_loop

71 
’d


73 --- 
S‘
 
¬gum’ts
 
to
 
»sume
 
y›lded
 
cÚ‹xt
 
w™h
.

74 -- @
·¿m
 
	$¬gs
 (
TabË
 
Ü
 
sšgË
 
ty³
)

75 
funùiÚ
 
coùx
.
CÜoutšeCÚ‹xt
:
	$£t_¬gum’ts
(
¬gs
)

76 ià(
	`ty³
(
¬gs
è=ğ"bË"è
th’


77 
£lf
.
co_¬gs
 = 
¬gs


79 
£lf
.
co_¬gs
[#£lf.co_¬g + 1] = 
¬gs


80 
’d


81  
£lf


82 
’d


84 
funùiÚ
 
coùx
.
CÜoutšeCÚ‹xt
:
	$£t_¡©e
(
¡©e
)

85 
£lf
.
co_¡©e
 = 
¡©e


86  
£lf


87 
’d


88 
funùiÚ
 
coùx
.
CÜoutšeCÚ‹xt
:
	$g‘_¡©e
(
¡©e
)

89  
£lf
.
co_¡©e


90 
’d


92 
funùiÚ
 
coùx
.
CÜoutšeCÚ‹xt
:
	$fš®ize_cÚ‹xt
()

93 
£lf
.
io_loİ
:
	$fš®ize_cÜoutše_cÚ‹xt
(
£lf
)

94 
’d


96 
funùiÚ
 
coùx
.
CÜoutšeCÚ‹xt
:
	$g‘_cÜoutše_¬gum’ts
()

97  
£lf
.
co_¬gs


98 
’d


100  
coùx


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/crypto.lua

1 --- 
Turbo
 
Web
 
Cryto
 
	gmoduË


2 -- 
C
 
defs
 
LuaJIT
 
FFI
 
ªd
 
	gw¿µ”s
.

4 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


6 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

7 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

8 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


10 -- 
	gh‰p
:

12 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


13 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

14 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

15 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


16 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

19 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

20 
»quœe
 "turbo.cdef"

22 
nÙ
 
_G
.
TURBO_SSL
 
th’


23  
£tm‘©abË
({},

25 
__šdex
 = 
funùiÚ
(
t
, 
k
)

26 
”rÜ
("TURBO_SSL is‚ot defined‡nd you‡reryingo use SSL.")

27 
’d
,

28 
__ÿÎ
 = 
funùiÚ
(
t
, 
k
)

29 
”rÜ
("TURBO_SSL is‚ot defined‡nd you‡reryingo use SSL.")

30 
’d


32 
–£if
 
	g¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
	g_G
.
__TURBO_USE_LUASOCKET__
 
th’


33  
	g»quœe
 "turbo.crypto_linux"

35  
	g»quœe
 "turbo.crypto_luasec"

36 
	g’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/crypto_linux.lua

1 --- 
Turbo
 
Web
 
Cryto
 
	gmoduË


2 -- 
C
 
defs
 
LuaJIT
 
FFI
 
ªd
 
	gw¿µ”s
.

4 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


6 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

7 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

8 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


10 -- 
	gh‰p
:

12 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


13 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

14 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

15 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


16 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

19 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

20 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

21 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

22 
»quœe
 "turbo.cdef"

24 
loÿl
 
üy±o
 = {} -- cry±Ø
Çme¥aû


26 
loÿl
 
ls¦
 = 
ffi
.
lßd
(
os
.
g‘’v
("TURBO_LIBSSL"è
Ü
 "ssl")

27 
loÿl
 
libtffi
 = 
ut
.
	$lßd_libtffi
()

29 
üy±o
.
X509_FILETYPE_PEM
 = 1

30 
üy±o
.
X509_FILETYPE_ASN1
 = 2

31 
üy±o
.
X509_FILETYPE_DEFAULT
 = 3

32 
üy±o
.
SSL_FILETYPE_ASN1
 = cry±o.
X509_FILETYPE_ASN1


33 
üy±o
.
SSL_FILETYPE_PEM
 = cry±o.
X509_FILETYPE_PEM


34 
üy±o
.
SSL_ERROR_NONE
 = 0

35 
üy±o
.
SSL_ERROR_SSL
 = 1

36 
üy±o
.
SSL_ERROR_WANT_READ
 = 2

37 
üy±o
.
SSL_ERROR_WANT_WRITE
 = 3

38 
üy±o
.
SSL_ERROR_WANT_X509_LOOKUP
 = 4

39 
üy±o
.
SSL_ERROR_SYSCALL
 = 5

40 
üy±o
.
SSL_ERROR_ZERO_RETURN
 = 6

41 
üy±o
.
SSL_ERROR_WANT_CONNECT
 = 7

42 
üy±o
.
SSL_ERROR_WANT_ACCEPT
 = 8

43 -- 
u£
 
e™h”
 
SSL_VERIFY_NONE
 
Ü
 
SSL_VERIFY_PEER
, 
the
 
Ï¡
 2 
İtiÚs


44 -- 
¬e
 'Üed' 
w™h
 
SSL_VERIFY_PEER
 
they
‡» 
desœed


45 
üy±o
.
SSL_VERIFY_NONE
 = 0x00

46 
üy±o
.
SSL_VERIFY_PEER
 = 0x01

47 
üy±o
.
SSL_VERIFY_FAIL_IF_NO_PEER_CERT
 = 0x02

48 
üy±o
.
SSL_VERIFY_CLIENT_ONCE
 = 0x04

49 
üy±o
.
v®id©e
 =

56 
	}
}

58 
	güy±o
.
	gERR_g‘_”rÜ
 = 
ls¦
.
ERR_g‘_”rÜ


59 
üy±o
.
SSL_g‘_”rÜ
 = 
ls¦
.SSL_get_error

60 
üy±o
.
lib
 = 
ls¦


62 --- 
CÚv”t
 
O³nSSL
 
”rÜ
 
to
 
¡ršg
.

63 -- @
·¿m
 
rc
 
”rÜ
 
äom
 
O³nSSL
 
lib¿ry
.

64 -- @
»tuºs
 
Lua
 
¡ršg
.

65 
funùiÚ
 
üy±o
.
	$ERR_”rÜ_¡ršg
(
rc
)

66 
loÿl
 
buf
 = 
ffi
.
	`Ãw
("char[256]")

67 
ls¦
.
	`ERR_”rÜ_¡ršg_n
(
rc
, 
buf
, 
ffi
.(buf))

68  
ffi
.
	$¡ršg
(
buf
)

69 
’d


71 --- 
In™Ÿlize
 
the
 
SSL
 
lib¿ry
.

72 -- 
Cª
 
be
 
ÿÎed
 
muÉË
 
times
 
w™hout
 
ÿusšg
 
ªy
 
·š
. 
If
 
the
 
lib¿ry
 
is


73 -- 
®»ady
 
lßded
 
™
 
wl
 
·ss
.

74 
funùiÚ
 
üy±o
.
	$s¦_š™
()

75 
nÙ
 
_G
.
_TURBO_SSL_INITED
 
th’


76 
_TURBO_SSL_INITED
 = 
Œue


77 
ls¦
.
	$SSL_lßd_”rÜ_¡ršgs
()

78 
ls¦
.
	$SSL_lib¿ry_š™
()

79 
ls¦
.
	$OPENSSL_add_®l_®gÜ™hms_nocÚf
()

80 
’d


81 
’d


82 
_G
.
TURBO_SSL
 
th’


83 
üy±o
.
	$s¦_š™
()

84 
’d


86 --- 
C»©e
 
a
 
ş›Á
 
ty³
 
SSL
 
cÚ‹xt
.

87 -- @
·¿m
 
	$û¹_fe
 (
İtiÚ®
è
C”tifiÿ‹
 
fe


88 -- @
·¿m
 
	$´v_fe
 (
İtiÚ®
è
Key
 
fe


89 -- @
·¿m
 
	$ÿ_û¹_·th
 (
İtiÚ®
è
P©h
 
to
 
CA
 
û¹ifiÿ‹s
, 
Ü
 
the
 
sy¡em


90 -- 
wide
 
š
 /
‘c
/
s¦
/
û¹s
/
ÿ
-
û¹ifiÿ‹s
.
üt
 
wl
 
be
 
u£d
.

91 -- @
·¿m
 
	$v”ify
 (
İtiÚ®
è
V”ify
 
the
 
ho¡s
 
û¹ifiÿ‹
 
w™h
 
CA
.

92 -- @
·¿m
 
	$s¦v
 (
İtiÚ®
è
SSL
 
v”siÚ
 
to
 
u£
.

93 -- @ 
R‘uº
 
code
. 0 
sucûssfuÎ
, 
a
 
O³nSSL
 
”rÜ
 cod
ªd
‡

94 -- 
SSL
 
”rÜ
 
¡ršg
, 
Ü
 -1 
ªd
 
a
ƒrror string.

95 -- @ 
AÎoÿ‹d
 
SSL_CTX
 *. 
Mu¡
 
nÙ
 
be
 
ä“d
. 
It
 
is
 
g¬bage
 
cŞËùed
.

96 
funùiÚ
 
üy±o
.
	$s¦_ü—‹_ş›Á_cÚ‹xt
(

97 
û¹_fe
,

98 
´v_fe
,

99 
ÿ_û¹_·th
,

100 
v”ify
, 
s¦v
)

101 
loÿl
 
m‘h


102 
loÿl
 
ùx


103 
loÿl
 
”r
 = 0

104 -- 
U£
 
¡ªd¬dish
 
·th
 
to
 
ÿ
-
û¹ifiÿ‹s
 
nÙ
 
¥ecif›d
 
by
 
u£r
.

105 -- 
May
 
nÙ
 
be
 
´e£Á
 
Ú
 
®l
 
Unix
 
sy¡ems
.

106 
ÿ_û¹_·th
 = ca_û¹_·th 
Ü
 "/etc/ssl/certs/ca-certificates.crt"

107 
m‘h
 = 
s¦v
 
Ü
 
ls¦
.
	$SSLv23_ş›Á_m‘hod
()

108 
m‘h
 =ğ
n
 
th’


109 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

110 
ls¦
.
	$ERR_ş—r_”rÜ
()

111  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

112 
’d


113 
ùx
 = 
ls¦
.
	$SSL_CTX_Ãw
(
m‘h
)

114 
ùx
 =ğ
n
 
th’


115 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

116 
ls¦
.
	$ERR_ş—r_”rÜ
()

117  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

119 
ffi
.
	$gc
(
ùx
, 
ls¦
.
SSL_CTX_ä“
)

120 
’d


121 -- 
If
 
ş›Á
 
û¹ifiÿ‹s
 
¬e
 
£t
, 
lßd
 
them
 
ªd
 
v”ify
.

122 
	`ty³
(
û¹_fe
è=ğ"¡ršg" 
ªd
y³(
´v_fe
è=ğ"¡ršg" 
th’


123 
ls¦
.
	`SSL_CTX_u£_û¹ifiÿ‹_fe
(
ùx
, 
û¹_fe
,

124 
üy±o
.
SSL_FILETYPE_PEM
è<ğ0 
th’


125 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

126 
ls¦
.
	$ERR_ş—r_”rÜ
()

127  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

128 
’d


129 
ls¦
.
	`SSL_CTX_u£_Priv©eKey_fe
(
ùx
, 
´v_fe
,

130 
üy±o
.
SSL_FILETYPE_PEM
è<ğ0 
th’


131 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

132 
ls¦
.
	$ERR_ş—r_”rÜ
()

133  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

134 
’d


135 -- 
Check
 
pub
 
ªd
 
´iv
 
key
 
m©ches
 
—ch
 
Ùh”
.

136 
ls¦
.
	`SSL_CTX_check_´iv©e_key
(
ùx
è~ğ1 
th’


138 
’d


139 
’d


140 
v”ify
 =ğ
Œue
 
th’


141 
ls¦
.
	`SSL_CTX_lßd_v”ify_loÿtiÚs
(
ùx
,

142 
ÿ_û¹_·th
, 
n
è~ğ1 
th’


143 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

144 
ls¦
.
	$ERR_ş—r_”rÜ
()

145  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

146 
’d


147 
ls¦
.
	`SSL_CTX_£t_v”ify
(
ùx
, 
üy±o
.
SSL_VERIFY_PEER
, 
n
);

148 
’d


149  
”r
, 
ùx


150 
’d


152 --- 
C»©e
 
a
 
£rv”
 
ty³
 
SSL
 
cÚ‹xt
.

153 -- @
·¿m
 
û¹_fe
 
C”tifiÿ‹
 
	`fe
 (
public
 
key
)

154 -- @
·¿m
 
´v_fe
 
Key
 
	`fe
 (
´iv©e
 
key
)

155 -- @
·¿m
 
	$ÿ_û¹_·th
 (
İtiÚ®
è
P©h
 
to
 
CA
 
û¹ifiÿ‹s
, 
Ü
 
the
 
sy¡em


156 -- 
wide
 
š
 /
‘c
/
s¦
/
û¹s
/
ÿ
-
û¹ifiÿ‹s
.
üt
 
wl
 
be
 
u£d
.

157 -- @
·¿m
 
	$s¦v
 (
İtiÚ®
è
SSL
 
v”siÚ
 
to
 
u£
.

158 -- @ 
R‘uº
 
code
. 0 
sucûssfuÎ
, 
a
 
O³nSSL
 
”rÜ


159 -- 
code
 
ªd
 
a
 
SSL


160 -- 
”rÜ
 
¡ršg
, 
Ü
 -1 
ªd
 
a
ƒrror string.

161 -- @ 
AÎoÿ‹d
 
SSL_CTX
 *. 
Mu¡
 
nÙ
 
be
 
ä“d
. 
It
 
is
 
g¬bage
 
cŞËùed
.

162 
funùiÚ
 
üy±o
.
	$s¦_ü—‹_£rv”_cÚ‹xt
(
û¹_fe
, 
´v_fe
, 
ÿ_û¹_·th
, 
s¦v
)

163 
loÿl
 
m‘h


164 
loÿl
 
ùx


165 
loÿl
 
”r
 = 0

167 
nÙ
 
û¹_fe
 
th’


169 
–£if
 
nÙ
 
´v_fe
 
th’


171 
’d


172 
m‘h
 = 
s¦v
 
Ü
 
ls¦
.
	$SSLv23_£rv”_m‘hod
()

173 
m‘h
 =ğ
n
 
th’


174 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

175 
ls¦
.
	$ERR_ş—r_”rÜ
()

176  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

177 
’d


178 
ùx
 = 
ls¦
.
	$SSL_CTX_Ãw
(
m‘h
)

179 
ùx
 =ğ
n
 
th’


180 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

181 
ls¦
.
	$ERR_ş—r_”rÜ
()

182  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

184 
ffi
.
	$gc
(
ùx
, 
ls¦
.
SSL_CTX_ä“
)

185 
’d


186 
ls¦
.
	`SSL_CTX_u£_û¹ifiÿ‹_fe
(
ùx
, 
û¹_fe
,

187 
üy±o
.
SSL_FILETYPE_PEM
è<ğ0 
th’


188 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

189 
ls¦
.
	$ERR_ş—r_”rÜ
()

190  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

191 
’d


192 
ls¦
.
	`SSL_CTX_u£_û¹ifiÿ‹_chaš_fe
(
ùx
, 
û¹_fe
è<ğ0 
th’


193 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

194 
ls¦
.
	$ERR_ş—r_”rÜ
()

195  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

196 
’d


197 
ls¦
.
	`SSL_CTX_u£_Priv©eKey_fe
(
ùx
, 
´v_fe
,

198 
üy±o
.
SSL_FILETYPE_PEM
è<ğ0 
th’


199 
”r
 = 
ls¦
.
	$ERR_³ek_”rÜ
()

200 
ls¦
.
	$ERR_ş—r_”rÜ
()

201  
”r
, 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)

202 
’d


203  
”r
, 
ùx


204 
’d


206 
funùiÚ
 
üy±o
.
	$s¦_Ãw
(
ùx
, 
fd_sock
, 
ş›Á
)

207 
loÿl
 
s¦


208 
loÿl
 
”r


210 
s¦
 = 
üy±o
.
lib
.
	$SSL_Ãw
(
ùx
)

211 
s¦
 =ğ
n
 
th’


212 
”r
 = 
üy±o
.
lib
.
	$ERR_³ek_”rÜ
()

213 
üy±o
.
lib
.
	$ERR_ş—r_”rÜ
()

214 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

216 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)))

217 
’d


219 
ffi
.
	$gc
(
s¦
, 
üy±o
.
lib
.
SSL_ä“
)

221 
üy±o
.
lib
.
	`SSL_£t_fd
(
s¦
, 
fd_sock
è<ğ0 
th’


222 
”r
 = 
üy±o
.
lib
.
	$ERR_³ek_”rÜ
()

223 
üy±o
.
lib
.
	$ERR_ş—r_”rÜ
()

224 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

227 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)))

228 
’d


230 
ş›Á
 
th’


231 
üy±o
.
lib
.
	$SSL_£t_cÚÃù_¡©e
(
s¦
)

233 
üy±o
.
lib
.
	$SSL_£t_acû±_¡©e
(
s¦
)

234 
’d


235  
s¦


236 
’d


238 
funùiÚ
 
üy±o
.
	$s¦_do_hªdshake
(
SSLIOSŒ—m
)

239 
loÿl
 
”r
 = 0

240 
loÿl
 
”ºo


241 
loÿl
 
rc
 = 0

242 
loÿl
 
s¦
 = 
SSLIOSŒ—m
.
_s¦


243 
loÿl
 
ş›Á
 = 
SSLIOSŒ—m
.
_s¦_İtiÚs
.
_ty³
 == 1

245 -- 
This
 
m‘hod
 
might
 
be
 
ÿÎed
 
muÉË
 
times
 
we
 
»c›ved


246 -- 
EINPROGRESS
 
Ü
 
equaiv®’t
 
Ú
 
´iÜ
 
ÿÎs
. 
The
 
O³nSSL


247 -- 
docum’tiÚ
 
¡©es
 
th©
 
SSL_do_hªdshake
 
should
 
be
 
ÿÎed
 
agaš


248 -- 
wh’
 
™s
 
Ãeds
 
¬e
 
§tisf›d
.

249 
rc
 = 
üy±o
.
lib
.
	$SSL_do_hªdshake
(
s¦
)

250 
rc
 <ğ0 
th’


251 
ş›Á
 
ªd
 
SSLIOSŒ—m
.
_s¦_v”ify
 
th’


252 
loÿl
 
v”ify_”r
 = 
üy±o
.
lib
.
	$SSL_g‘_v”ify_»suÉ
(
s¦
)

253 
v”ify_”r
 ~ğ0 
th’


254 
	`”rÜ
(

255 
¡ršg
.
	`fÜm©
(

257 
ffi
.
	`¡ršg
(

258 
üy±o
.
lib
.
	$X509_v”ify_û¹_”rÜ_¡ršg
(

259 
v”ify_”r
))))

260 
’d


261 
’d


262 
”r
 = 
üy±o
.
lib
.
	`SSL_g‘_”rÜ
(
s¦
, 
rc
)

263 -- 
In
 
the
 
sock‘
 
is
 
O_NONBLOCK
  
out
 
wh’
 
we
 
g‘


264 -- 
SSL_ERROR_WANT_
* 
Ü
 
equ®
 
sysÿÎ
  
code
.

265 
”r
 =ğ
üy±o
.
SSL_ERROR_WANT_READ
 
Ü


266 
”r
 =ğ
üy±o
.
SSL_ERROR_WANT_READ
 
th’


267  
çl£


268 
–£if
 
”r
 =ğ
üy±o
.
SSL_ERROR_SYSCALL
 
th’


269 -- 
E¼Ü
 
Ú
 
sock‘
.

270 
”ºo
 = 
ffi
.
	$”ºo
()

271 
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EINPROGRESS
 
th’


272  
çl£


273 
–£if
 
”ºo
 ~ğ0 
th’


274 
loÿl
 
fd
 = 
SSLIOSŒ—m
.
sock‘


275 
SSLIOSŒ—m
:
	$şo£
()

276 
	`”rÜ
(

277 
¡ršg
.
	`fÜm©
("Error when„eading from fd %d. "..

279 
fd
,

280 
”ºo
,

281 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

283 -- 
PİuÏr
 
b–›f
 
t›s
 
this
 
b¿nch
 
to
 
discÚÃùs
 
befÜe


284 -- 
hªdshake
 
is
 
com¶‘ed
.

285 
loÿl
 
fd
 = 
SSLIOSŒ—m
.
sock‘


286 
SSLIOSŒ—m
:
	$şo£
()

287 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

290 
fd
,

291 
”ºo
,

292 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

293 
’d


294 
–£if
 
”r
 =ğ
üy±o
.
SSL_ERROR_SSL
 
th’


295 
”r
 = 
üy±o
.
lib
.
	$ERR_³ek_”rÜ
()

296 
üy±o
.
lib
.
	$ERR_ş—r_”rÜ
()

297 
	`”rÜ
(

298 
¡ršg
.
	`fÜm©
("Could‚ot do SSL handshake. SSLƒrror. %s",

299 
üy±o
.
	$ERR_”rÜ_¡ršg
(
”r
)))

301 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

303 
”r
))

304 
’d


306 
ş›Á
 
ªd
 
SSLIOSŒ—m
.
_s¦_v”ify
 
th’


307 
rc
 = 
libtffi
.
	$v®id©e_ho¡Çme
(
SSLIOSŒ—m
.
_s¦_ho¡Çme
, 
s¦
)

308 
rc
 ~ğ
üy±o
.
v®id©e
.
M©chFound
 
th’


309 
	`”rÜ
("SSL certficate hostname validation failed,„c " ..

310 
	$tÚumb”
(
rc
))

311 
’d


312 
’d


313 
’d


314  
Œue


315 
’d


317 --- 
Wr™e
 
d©a
 
to
 
a
 
SSL
 
cÚÃùiÚ
.

318 -- @
·¿m
 
	$s¦
 (
SSL
 *è
O³nSSL
 SSL 
±r
.

319 -- @
·¿m
 
	$buf
 (cÚ¡ *è
Bufãr
 
to
 
£nd
.

320 -- @
·¿m
 
	$sz
 (
Numb”
è
By‹s
 
to
 
£nd
 
äom
 
bufãr
.

321 
funùiÚ
 
üy±o
.
	$SSL_wr™e
(
s¦
, 
buf
, 
sz
)

322 
s¦
 =ğ
n
 
Ü
 
buf
 =ğn 
th’


323 
	`”rÜ
("SSL_write…assed‚ull…ointer.")

324 
’d


325  
ls¦
.
	$SSL_wr™e
(
s¦
, 
buf
, 
sz
)

326 
’d


328 --- 
R—d
 
d©a
 
äom
 
a
 
SSL
 
cÚÃùiÚ
.

329 -- @
·¿m
 
	$s¦
 (
SSL
 *è
O³nSSL
 SSL 
±r
.

330 -- @
·¿m
 
	$buf
 (*è
Bufãr
 
to
 
»ad
o.

331 -- @
·¿m
 
	$sz
 (
Numb”
è
By‹s
 
to
 
maximum
 
»ad
 
što
 
bufãr
.

332 
funùiÚ
 
üy±o
.
	$SSL_»ad
(
s¦
, 
buf
, 
sz
)

333 
s¦
 =ğ
n
 
Ü
 
buf
 =ğn 
th’


334 
	`”rÜ
("SSL_read…assed‚ull…ointer.")

335 
’d


336  
ls¦
.
	$SSL_»ad
(
s¦
, 
buf
, 
sz
)

337 
’d


339  
üy±o


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/crypto_luasec.lua

1 --- 
Turbo
 
Web
 
Cryto
 
	gmoduË


2 -- 
C
 
defs
 
LuaJIT
 
FFI
 
ªd
 
	gw¿µ”s
.

4 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


6 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

7 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

8 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


10 -- 
	gh‰p
:

12 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


13 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

14 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

15 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


16 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

19 
loÿl
 
log
 = 
»quœe
 "turbo.log"

20 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

21 
»quœe
 "turbo.cdef"

23 
loÿl
 
üy±o
 = {} -- cry±Ø
Çme¥aû


25 
loÿl
 
ok
, 
	gs¦
 = 
pÿÎ
(
»quœe
, "ssl")

26 
nÙ
 
ok
 
th’


27 
	glog
.
”rÜ
(

30 
	gos
.
	$ex™
(1)

31 
’d


33 
loÿl
 
deçuÉ_ÿ_·th
 = "/etc/ssl/certs/ca-certificates.crt"

34 
loÿl
 
’v_ÿ_·th
 = 
os
.
	`g‘’v
("TURBO_CAPATH")

35 
’v_ÿ_·th
 
th’


36 
deçuÉ_ÿ_·th
 = 
’v_ÿ_·th


37 
’d


39 --- 
C»©e
 
a
 
ş›Á
 
ty³
 
SSL
 
cÚ‹xt
.

40 -- @
·¿m
 
	$û¹_fe
 (
İtiÚ®
è
C”tifiÿ‹
 
fe


41 -- @
·¿m
 
	$´v_fe
 (
İtiÚ®
è
Key
 
fe


42 -- @
·¿m
 
	$ÿ_û¹_·th
 (
İtiÚ®
è
P©h
 
to
 
CA
 
û¹ifiÿ‹s
, 
Ü
 
the
 
sy¡em


43 -- 
wide
 
š
 /
‘c
/
s¦
/
û¹s
/
ÿ
-
û¹ifiÿ‹s
.
üt
 
wl
 
be
 
u£d
.

44 -- @
·¿m
 
	$v”ify
 (
İtiÚ®
è
V”ify
 
the
 
ho¡s
 
û¹ifiÿ‹
 
w™h
 
CA
.

45 -- @
·¿m
 
	$s¦v
 (
İtiÚ®
è
SSL
 
v”siÚ
 
to
 
u£
.

46 -- @ 
R‘uº
 
code
. 0 
sucûssfuÎ
, 
a
 
”rÜ
 cod
ªd
‡

47 -- 
SSL
 
”rÜ
 
¡ršg
, 
Ü
 -1 
ªd
 
a
ƒrror string.

48 -- @ 
AÎoÿ‹d
 
SSL_CTX
 *. 
Mu¡
 
nÙ
 
be
 
ä“d
. 
It
 
is
 
g¬bage
 
cŞËùed
.

49 
funùiÚ
 
üy±o
.
	$s¦_ü—‹_ş›Á_cÚ‹xt
(

50 
û¹_fe
,

51 
´v_fe
,

52 
ÿ_û¹_·th
,

53 
v”ify
, 
s¦v
)

54 
loÿl
 
·¿ms
 = {

55 
mode
 = "client",

56 
´ÙocŞ
 = "sslv23",

57 
key
 = 
´v_fe
,

58 
û¹ifiÿ‹
 = 
û¹_fe
,

59 
ÿfe
 = 
ÿ_û¹_·th
 
Ü
 
deçuÉ_ÿ_·th
,

60 
v”ify
 = v”ify 
ªd
 {"³”", "ç_if_no_³”_û¹"} 
Ü
 
n
,

61 
İtiÚs
 = {"all"},

62 
	}
}

64 
loÿl
 
	gùx
, 
	g”r
 = 
s¦
.
	$ÃwcÚ‹xt
(
·¿ms
)

65 
nÙ
 
ùx
 
th’


66  -1, 
”r


68  0, 
ùx


69 
’d


70 
’d


72 --- 
C»©e
 
a
 
£rv”
 
ty³
 
SSL
 
cÚ‹xt
.

73 -- @
·¿m
 
û¹_fe
 
C”tifiÿ‹
 
	`fe
 (
public
 
key
)

74 -- @
·¿m
 
´v_fe
 
Key
 
	`fe
 (
´iv©e
 
key
)

75 -- @
·¿m
 
	$ÿ_û¹_·th
 (
İtiÚ®
è
P©h
 
to
 
CA
 
û¹ifiÿ‹s
, 
Ü
 
the
 
sy¡em


76 -- 
wide
 
š
 /
‘c
/
s¦
/
û¹s
/
ÿ
-
û¹ifiÿ‹s
.
üt
 
wl
 
be
 
u£d
.

77 -- @
·¿m
 
	$s¦v
 (
İtiÚ®
è
SSL
 
v”siÚ
 
to
 
u£
.

78 -- @ 
R‘uº
 
code
. 0 
sucûssfuÎ
, 
a
 
O³nSSL
 
”rÜ


79 -- 
code
 
ªd
 
a
 
SSL


80 -- 
”rÜ
 
¡ršg
, 
Ü
 -1 
ªd
 
a
ƒrror string.

81 -- @ 
AÎoÿ‹d
 
SSL_CTX
 *. 
Mu¡
 
nÙ
 
be
 
ä“d
. 
It
 
is
 
g¬bage
 
cŞËùed
.

82 
funùiÚ
 
üy±o
.
	$s¦_ü—‹_£rv”_cÚ‹xt
(
û¹_fe
, 
´v_fe
, 
ÿ_û¹_·th
, 
s¦v
)

83 
loÿl
 
·¿ms
 = {

84 
mode
 = "server",

85 
´ÙocŞ
 = "sslv23",

86 
key
 = 
´v_fe
,

87 
û¹ifiÿ‹
 = 
û¹_fe
,

88 
ÿfe
 = 
ÿ_û¹_·th
 
Ü
 
deçuÉ_ÿ_·th
,

89 
İtiÚs
 = {"all"},

90 
	}
}

92 
loÿl
 
	gùx
, 
	g”r
 = 
s¦
.
	$ÃwcÚ‹xt
(
·¿ms
)

93 
nÙ
 
ùx
 
th’


94  -1, 
”r


96  0, 
ùx


97 
’d


98 
’d


100 
funùiÚ
 
üy±o
.
	$s¦_Ãw
(
ùx
, 
fd_sock
, 
ş›Á
)

101 
loÿl
 
³”
 = 
s¦
.
	$w¿p
(
fd_sock
, 
ùx
)

102 
³”
:
	$£‰imeout
(0)

103  
³”


104 
’d


106 
funùiÚ
 
üy±o
.
	$s¦_do_hªdshake
(
SSLIOSŒ—m
)

107 
loÿl
 
sock
 = 
SSLIOSŒ—m
.
_s¦


108 
loÿl
 
»s
, 
”r
 = 
sock
:
	$dohªdshake
()

109  
»s
, 
”r


110 
’d


112  
üy±o


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/epoll_ffi.lua

1 --- 
	gTurbo
.
lua
 
Lšux
 
EpŞl
 
	gmoduË


3 -- 
Cİyright
 
John
 
	gAb¿ham£n
 2011, 2012, 2013 < 
	gJhnAbrhm¢
@
	ggma
.
	gcom
 >

6 -- 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
	gš


7 -- 
the
 
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
	gto


8 -- 
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
	gcİ›s


9 -- 
of
 
the
 
	gSoáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
h
Soáw¬e
 
is
 
fuºished
o do

10 -- 
	gso
, 
subjeù
 
to
 
the
 
fŞlowšg
 
	gcÚd™iÚs
:

12 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


13 -- 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

15 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
	gOR


16 -- 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
	gMERCHANTABILITY
,

17 -- 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
	gTHE


18 -- 
AUTHORS
 
OR
 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gCLAIM
, 
DAMAGES
 OR 
	gOTHER


19 -- 
	gLIABILITY
, 
WHETHER
 
IN
 
AN
 
ACTION
 
OF
 
	gCONTRACT
, 
TORT
 
OR
 
	gOTHERWISE
, 
ARISING
 
	gFROM
,

20 -- 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 OR THE 
USE
 OR 
OTHER
 
DEALINGS
 IN 
	gTHE


21 -- 
	gSOFTWARE
."

23 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

24 
»quœe
 "turbo.cdef"

26 -- 
Defšes
 
•Şl_ùl
.

27 
loÿl
 
•Şl
 = {

28 
EPOLL_CTL_ADD
 = 1,

29 
	gEPOLL_CTL_DEL
 = 2,

30 
	gEPOLL_CTL_MOD
 = 3,

31 
	gEPOLL_EVENTS
 = {

32 
EPOLLIN
 = 0x001,

33 
	gEPOLLPRI
 = 0x002,

34 
	gEPOLLOUT
 = 0x004,

35 
	gEPOLLERR
 = 0x008,

36 
	gEPOLLHUP
 = 0x0010,

40 --- 
C»©e
 
a
 
Ãw
 
•Şl
 
	gfd
. 
R‘uºs
 
the
 
fd
 
of
h
ü—‹d
ƒpŞÈ
š¡ªû
 
	gªd
 -1

41 -- 
ªd
 
”ºo
 
Ú
 
	g”rÜ
.

42 -- @ 
•Şl
 
fd
 
Ú
 
	gsucûss
, -1 
ªd
 
	g”ºo
.

43 
funùiÚ
 
	g•Şl
.
	$•Şl_ü—‹
()

44 
loÿl
 
fd
 = 
ffi
.
C
.
	$•Şl_ü—‹
(124)

46 
fd
 =ğ-1 
th’


47  -1, 
ffi
.
	$”ºo
()

48 
’d


50  
fd


51 
’d


53 --- 
CÚŒŞ
 
a
 
•Şl
 
fd
.

54 -- @
·¿m
 
•fd
 
EpŞl
 
fd
 
to
 
cÚŒŞ


55 -- @
·¿m
 
İ
 
O³¿tiÚ
 
the
 
rg‘
 
fd
:

56 -- 
EPOLL_CTL_ADD


57 -- 
Regi¡”
 
the
 
rg‘
 
fe
 
desütÜ
 
fd
 
Ú
h
•Şl
 
š¡ªû
 
»ã¼ed
 
to


58 -- 
by
 
the
 
fe
 
desütÜ
 
•fd
 
ªd
 
assocŸ‹
h
ev’t
ƒv’ˆ
w™h
h
š‹º®


59 -- 
fe
 
lšked
 
to
 
fd
.

60 -- 
EPOLL_CTL_MOD


61 -- 
Chªge
 
the
 
ev’t
ƒv’ˆ
assocŸ‹d
 
w™h
h
rg‘
 
fe
 
desütÜ
 
fd
.

62 -- 
EPOLL_CTL_DEL


63 -- 
	$Remove
 (
d”egi¡”
è
the
 
rg‘
 
fe
 
desütÜ
 
fd
 
äom
h
•Şl
 
š¡ªû


64 -- 
»ã¼ed
 
to
 
by
 
•fd
. 
The
 
•Şl_ev’ts
 
is
 
ignÜed
 
ªd
 
ÿn
 
be
 
n
.

65 -- @
·¿m
 
	$fd
 (
Numb”
è
The
 
fd
 
to
 
cÚŒŞ
.

66 -- @
·¿m
 
	$•Şl_ev’ts
 (
Numb”
è
The
 
ev’ts
 
b™
 
mask
 
to
 
£t
. 
Defšed
 
š


67 -- 
•Şl
.
EPOLL_EVENTS
.

68 -- @ 0 
Ú
 
sucûss
 
ªd
 -1 oÀ
”rÜ
 
tog‘h”
 
w™h
 
”ºo
.

69 
loÿl
 
_ev’t
 = 
ffi
.
	`Ãw
("epoll_event")

70 
funùiÚ
 
•Şl
.
	$•Şl_ùl
(
•fd
, 
İ
, 
fd
, 
•Şl_ev’ts
)

71 
loÿl
 
rc


73 
ffi
.
	`fl
(
_ev’t
, ffi.(_event), 0)

74 
_ev’t
.
d©a
.
fd
 = fd

75 
_ev’t
.
ev’ts
 = 
•Şl_ev’ts


76 
rc
 = 
ffi
.
C
.
	$•Şl_ùl
(
•fd
, 
İ
, 
fd
, 
_ev’t
)

77 
rc
 =ğ-1 
th’


78  -1, 
ffi
.
	$”ºo
()

79 
’d


80  
rc


81 
’d


83 --- 
Wa™
 
ev’ts
 
Ú
 
a
 
•Şl
 
š¡ªû
.

84 -- @
·¿m
 
	$•fd
 (
Numb”
è
EpŞl
 
fd
 
to
 
wa™
 
Ú
.

85 -- @
·¿m
 
	$timeout
 (
Numb”
è
How
 
to
 
wa™
 
no
 
ev’ts
 
occur
.

86 -- @ 
On
 
sucûss
, 
•Şl_ev’t
 
¬¿y
 
is
 
»tuºed
, 
Ú
 
”rÜ
, -1 
ªd
 
”ºo


87 -- 
¬e
 
»tuºed
.

88 
loÿl
 
_ev’ts
 = 
ffi
.
	`Ãw
("structƒpoll_event[124]")

89 
funùiÚ
 
•Şl
.
	$•Şl_wa™
(
•fd
, 
timeout
)

90 
loÿl
 
num_ev’ts
 = 
ffi
.
C
.
	$•Şl_wa™
(
•fd
, 
_ev’ts
, 124, 
timeout
)

91 
num_ev’ts
 =ğ-1 
th’


92  -1, 
ffi
.
	$”ºo
()

93 
’d


94  0, 
num_ev’ts
, 
_ev’ts


95 
’d


97  
•Şl


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/escape.lua

1 --- 
	gTurbo
.
lua
 
Esÿ³
 
	gmoduË


3 -- 
Cİyright
 
John
 
	gAb¿ham£n
 2011, 2012, 2013 < 
	gJhnAbrhm¢
@
	ggma
.
	gcom
 >

6 -- 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
	gš


7 -- 
the
 
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
	gto


8 -- 
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
	gcİ›s


9 -- 
of
 
the
 
	gSoáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
h
Soáw¬e
 
is
 
fuºished
o do

10 -- 
	gso
, 
subjeù
 
to
 
the
 
fŞlowšg
 
	gcÚd™iÚs
:

12 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


13 -- 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

15 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
	gOR


16 -- 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
	gMERCHANTABILITY
,

17 -- 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
	gTHE


18 -- 
AUTHORS
 
OR
 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gCLAIM
, 
DAMAGES
 OR 
	gOTHER


19 -- 
	gLIABILITY
, 
WHETHER
 
IN
 
AN
 
ACTION
 
OF
 
	gCONTRACT
, 
TORT
 
OR
 
	gOTHERWISE
, 
ARISING
 
	gFROM
,

20 -- 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 OR THE 
USE
 OR 
OTHER
 
DEALINGS
 IN 
	gTHE


21 -- 
	gSOFTWARE
."

23 
loÿl
 
	gjsÚ
 = 
»quœe
('turbo.3rdparty.JSON')

25 
loÿl
 
esÿ³
 = {} --ƒsÿ³ 
Çme¥aû


27 --- 
JSON
 
¡ršgify
 
a
 
bË
.

28 -- @
·¿m
 
t
 
V®ue
 
to
 
JSON
 
’code
.

29 -- @
nÙe
 
May
 
¿i£
 
a
 
”rÜ
 
bË
 
could
 
nÙ
 
be
 
decoded
.

30 
funùiÚ
 
esÿ³
.
	$jsÚ_’code
(
t
)

31  
jsÚ
:
	$’code
(
t
)

32 
’d


34 --- 
Decode
 
a
 
JSON
 
¡ršg
 
to
 
bË
.

35 -- @
·¿m
 
	$s
 (
SŒšg
è
JSON
 
’oded
 
¡ršg
 
to
 
decode
 
što


36 -- 
Lua
 
´im™ives
.

37 -- @ (
TabË
)

38 
funùiÚ
 
esÿ³
.
	$jsÚ_decode
(
s
)

39  
jsÚ
:
	$decode
(
s
)

40 
’d


42 
loÿl
 
funùiÚ
 
	$_unhex
(
hex
è 
¡ršg
.(
	$tÚumb”
(
hex
, 16)è
’d


43 --- 
UÃsÿ³
 
a
 
esÿ³d
 
hexadecim®
 
»´e£Á©iÚ
 
¡ršg
.

44 -- @
·¿m
 
	$s
 (
SŒšg
èSŒšg 
to
 
uÃsÿ³
.

45 
funùiÚ
 
esÿ³
.
	$uÃsÿ³
(
s
)

46  
¡ršg
.
	`gsub
(
s
, "%%(%x%x)", 
_unhex
)

47 
’d


49 
loÿl
 
funùiÚ
 
	$_hex
(
c
)

50  
¡ršg
.
	`fÜm©
("%%%02x", sŒšg.
	$by‹
(
c
))

51 
’d


52 --- 
Encodes
 
a
 
¡ršg
 
što
 
™s
 
esÿ³d
 
hexadecim®
 
»´e£Á©iÚ
.

53 -- @
·¿m
 
	$s
 (
SŒšg
èSŒšg 
to
 
esÿ³
.

54 
funùiÚ
 
esÿ³
.
	$esÿ³
(
s
)

55  
¡ršg
.
	`gsub
(
s
, "([^A-Za-z0-9_])", 
_hex
)

56 
’d


58 --- 
Encodes
 
the
 
HTML
 
’t™›s
 
š
 
a
 
¡ršg
. 
H–pfuÎ
 
to
 
avoid
 
XSS
.

59 -- @
·¿m
 
	$s
 (
SŒšg
èSŒšg 
to
 
esÿ³
.

60 
funùiÚ
 
esÿ³
.
	$html_esÿ³
(
s
)

61 
	`as£¹
("Expected string in‡rgument #1.")

62  (
¡ršg
.
	`gsub
(
s
, "[}{\">/<'&]", {

69 
	}
}))

70 
	g’d


72 -- 
Remove
 
Œašg
 
ªd
 
Ëadšg
 
wh™e¥aû
 
äom
 
	g¡ršg
.

73 -- @
·¿m
 
s
 
SŒšg


74 
funùiÚ
 
	gesÿ³
.
Œim
(
s
)

75 -- 
äom
 
	gPiL2
 20.4

76  (
	gs
:
gsub
("^%s*(.-)%s*$", "%1"))

77 
	g’d


79 -- 
Remove
 
Ëadšg
 
wh™e¥aû
 
äom
 
	g¡ršg
.

80 -- @
·¿m
 
s
 
SŒšg


81 
funùiÚ
 
	gesÿ³
.
	$Érim
(
s
)

82  (
s
:
	`gsub
("^%s*", ""))

83 
’d


85 -- 
Remove
 
Œašg
 
wh™e¥aû
 
äom
 
¡ršg
.

86 -- @
·¿m
 
s
 
SŒšg


87 
funùiÚ
 
esÿ³
.
	$¹rim
(
s
)

88 
loÿl
 
n
 = #s

89 
n
 > 0 
ªd
 
s
:
	`fšd
("^%s",‚èdØÀğÀ- 1 
’d


90  
s
:
	$sub
(1, 
n
)

91 
’d


93 ----- 
V”y
 
Fa¡
 
MIME
 
BASE64
 
Encodšg
 / 
Decodšg
 
Routšes


94 --------------- 
authÜed
 
by
 
Jeff
 
SŞšsky


96 
loÿl
 
ffi
 = 
»quœe
'ffi'

97 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

98 
loÿl
 
rshiá
 = 
b™
.rshift

99 
loÿl
 
lshiá
 = 
b™
.lshift

100 
loÿl
 
bÜ
 = 
b™
.bor

101 
loÿl
 
bªd
 = 
b™
.band

102 
loÿl
 
æoÜ
 = 
m©h
.floor

104 
loÿl
 
mime64ch¬s
 = 
ffi
.
	`Ãw
("uint8_t[64]",

106 
loÿl
 
mime64lookup
 = 
ffi
.
	`Ãw
("uint8_t[256]")

107 
ffi
.
	$fl
(
mime64lookup
, 256, 0xFF)

108 
i
=0,63 do

109 
mime64lookup
[
mime64ch¬s
[
i
]]=i

110 
’d


112 
loÿl
 
u8¬r
ğ
ffi
.
ty³of
'uint8_t[?]'

113 
loÿl
 
u8±r
=
ffi
.
ty³of
'uint8_t*'

115 --- 
Ba£64
 
decode
 
a
 
¡ršg
 
Ü
‡ 
FFI
 *.

116 -- @
·¿m
 
	$¡r
 (
SŒšg
 
Ü
 *è
By‹¬¿y
 
to
 
decode
.

117 -- @
·¿m
 
	$sz
 (
Numb”
è
L’gth
 
of
 
¡ršg
 
to
 
decode
, 
İtiÚ®
 
¡r
 
is
 
a
 
Lua
 string

118 -- @ (
SŒšg
è
Decoded
 
¡ršg
.

119 
funùiÚ
 
esÿ³
.
	$ba£64_decode
(
¡r
, 
sz
)

120 ià(
	`ty³
(
¡r
)=="¡ršg"è
	$ªd
 (
sz
 =ğ
n
è
th’
 sz=#¡¸
’d


121 
loÿl
 
m64
, 
b1
 -- 
v®ue
 0 
to
 63, 
·¹Ÿl
 
by‹


122 
loÿl
 
bš_¬r
=
ffi
.
	`Ãw
(
u8¬r
, 
	`æoÜ
(
b™
.
	$rshiá
(
sz
*3,2)))

123 
loÿl
 
m±r
 = 
ffi
.
	`ÿ¡
(
u8±r
,
bš_¬r
è-- 
pos™iÚ
 
š
 
bš¬y
 
mime64
 
ouut
 
¬¿y


124 
loÿl
 
b±r
 = 
ffi
.
	$ÿ¡
(
u8±r
,
¡r
)

125 
loÿl
 
i
 = 0

126 
Œue
 do

127 
»³©


128 
i
 >ğ
sz
 
th’
 
dÚe
 
’d


129 
m64
 = 
mime64lookup
[
b±r
[
i
]]

130 
i
=i+1

131 
uÁ
 
m64
 ~ğ0xFF -- 
sk
 
nÚ
-
mime
 
ch¬aù”s
 
like
 
Ãwlšes


132 
b1
=
	$lshiá
(
m64
, 2)

133 
»³©


134 
i
 >ğ
sz
 
th’
 
dÚe
 
’d


135 
m64
 = 
mime64lookup
[
b±r
[
i
]]

136 
i
=i+1

137 
uÁ
 
m64
 ~ğ0xFF -- 
sk
 
nÚ
-
mime
 
ch¬aù”s
 
like
 
Ãwlšes


138 
m±r
[0] = 
	`bÜ
(
b1
,
	`rshiá
(
m64
, 4)); mptr=mptr+1

139 
b1
 = 
	$lshiá
(
m64
,4)

140 
»³©


141 
i
 >ğ
sz
 
th’
 
dÚe
 
’d


142 
m64
 = 
mime64lookup
[
b±r
[
i
]]

143 
i
=i+1

144 
uÁ
 
m64
 ~ğ0xFF -- 
sk
 
nÚ
-
mime
 
ch¬aù”s
 
like
 
Ãwlšes


145 
m±r
[0] = 
	`bÜ
(
b1
,
	`rshiá
(
m64
, 2)); mptr=mptr+1

146 
b1
 = 
	$lshiá
(
m64
,6)

147 
»³©


148 
i
 >ğ
sz
 
th’
 
dÚe
 
’d


149 
m64
 = 
mime64lookup
[
b±r
[
i
]]

150 
i
=i+1

151 
uÁ
 
m64
 ~ğ0xFF -- 
sk
 
nÚ
-
mime
 
ch¬aù”s
 
like
 
Ãwlšes


152 
m±r
[0] = 
	`bÜ
(
b1
, 
m64
); mptr=mptr+1

153 
’d


154 ::
dÚe
::

155  
ffi
.
	`¡ršg
(
bš_¬r
, (
m±r
-bin_arr))

156 
’d


159 
loÿl
 
mime64shÜts
=
ffi
.
	`Ãw
('uint16_t[4096]')

160 
i
=0,63 do

161 
j
=0,63 do

162 
loÿl
 
v


163 
ffi
.
	`abi
("Ë"è
th’


164 
v
=
mime64ch¬s
[
j
]*256+mime64ch¬s[
i
]

166 
v
=
mime64ch¬s
[
i
]*256+mime64ch¬s[
j
]

167 
’d


168 
mime64shÜts
[
i
*64+
j
]=
v


169 
’d


170 
’d


172 
loÿl
 
u16¬r
 = 
ffi
.
ty³of
"uint16_t[?]"

173 
loÿl
 
ülf16
 = 
ffi
.
	`Ãw
("uint16_t[1]")

174 
ffi
.
	`abi
("Ë"è
th’


175 
ülf16
[0] = (0x0A*256)+0x0D

177 
ülf16
[0] = (0x0D*256)+0x0A

178 
’d


179 
loÿl
 
eq
=
¡ršg
.
	`by‹
('=')

180 --- 
Ba£64
 
’code
 
bš¬y
 
d©a
 
of
 
a
 
¡ršg
 
Ü
‡ 
FFI
 *.

181 -- @
·¿m
 
	$¡r
 (
SŒšg
 
Ü
 *è
By‹¬¿y
 
to
 
’code
.

182 -- @
·¿m
 
	$sz
 (
Numb”
è
L’gth
 
of
 
¡ršg
 
to
 
’code
, 
İtiÚ®
 
¡r
 
is
 
a
 
Lua
 string

183 -- @
·¿m
 
	$di§bË_b»ak
 (
BoŞ
è
Do
 
nÙ
  
»suÉ
 
w™h
 
Ãwlšes
, 
İtiÚ®


184 -- @ (
SŒšg
è
Encoded
 
ba£64
 
¡ršg
.

185 
funùiÚ
 
esÿ³
.
	$ba£64_’code
(
¡r
, 
sz
, 
di§bË_b»ak
)

186 ià(
	`ty³
(
¡r
)=="¡ršg"è
	$ªd
 (
sz
 =ğ
n
è
th’
 sz=#¡¸
’d


187 
loÿl
 
ou’
 = 
	`æoÜ
(
sz
*2/3)

188 
ou’
 = ou’ + 
	`æoÜ
(outlen/19)+3

189 
loÿl
 
m64¬r
=
ffi
.
	$Ãw
(
u16¬r
,
ou’
)

190 
loÿl
 
l
,
p
,
v
=0,0

191 
loÿl
 
b±r
 = 
ffi
.
	$ÿ¡
(
u8±r
,
¡r
)

192 
loÿl
 
c
 = 
di§bË_b»ak
 
ªd
 -1 
Ü
 38 -- 
put
 
a
 
Ãw
 
lše
 
aá”
 
ev”y
 76 
ch¬aù”s


193 
loÿl
 
i
,
k
=0,0

194 ::
whe_3by‹s
::

195 
i
+3>
sz
 
th’
 
b»ak3
 
’d


196 
v
=
	`bÜ
(
	`lshiá
(
b±r
[
i
],16),lshift(bptr[i+1],8),bptr[i+2])

197 
i
=i+3

198 ::
’code_Ï¡3
::

199 
c
==
k
 
th’


200 
m64¬r
[
k
]=
ülf16
[0]

201 
k
=k+1

202 
c
=
k
+38 -- 76 /2 = 38

203 
’d


204 
m64¬r
[
k
]=
mime64shÜts
[
	`rshiá
(
v
,12)]

205 
m64¬r
[
k
+1]=
mime64shÜts
[
	`bªd
(
v
,4095)]

206 
k
=k+2

207 
whe_3by‹s


208 ::
b»ak3
::

209 
l
>0 
th’


210 -- 
Add
 
Œašg
 
equ®
 
sign
 
·ddšg


211 
l
==1 
th’


212 -- 1 
by‹
 
’coded
 
Ãeds
 
two
 
Œašg
 
equ®
 
signs


213 
m64¬r
[
k
-1]=
	`bÜ
(
	`lshiá
(
eq
,8),eq)

215 -- 2 
by‹s
 
’coded
 
Ãeds
 
Úe
 
Œašg
 
equ®
 
sign


216 (
ffi
.
	`ÿ¡
(
u8±r
,
m64¬r
))[
	`lshiá
(
k
,1)-1]=
eq


217 
’d


219 
l
=
sz
-
i
 -- 
g‘
 
»maššg
 
	$Ën
 (1 
Ü
 2 
by‹s
)

220 
l
>0 
th’


221 
v
=
	$lshiá
(
b±r
[
i
],16)

222 
l
==2 
th’
 
v
=
	`bÜ
(v,
	`lshiá
(
b±r
[
i
+1],8)è
’d


223 
’code_Ï¡3


224 
’d


225 
’d


226  
ffi
.
	`¡ršg
(
m64¬r
,
	$lshiá
(
k
,1))

227 
’d


228 
’d


230  
esÿ³


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/fs.lua

1 --- 
	gTurbo
.
lua
 
fe
 
sy¡em
 
	gModuË


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

18 
loÿl
 
sysÿÎ
 = 
»quœe
 "turbo.syscall"

20 
loÿl
 
fs
 = {}

22 --- 
Fe
 
sy¡em
 
cÚ¡ªts


23 
fs
.
NAME_MAX
 = 255

24 
fs
.
PATH_MAX
 = 4096

27 --- 
R—d
 
out
 
fe
 
m‘ad©a
 
w™h
 
a
 
giv’
 
·th


28 
funùiÚ
 
fs
.
	$¡©
(
·th
, 
buf
)

29 
loÿl
 
¡©_t
 = 
ffi
.
	`ty³of
("struct stat")

30 
nÙ
 
buf
 
th’
 buàğ
	$¡©_t
(è
’d


31 
loÿl
 
»t
 = 
ffi
.
C
.
	$sysÿÎ
(
sysÿÎ
.
SYS_¡©
, 
·th
, 
buf
)

32 
»t
 =ğ-1 
th’


33  -1, 
ffi
.
	`¡ršg
(ffi.
C
.
	`¡»¼Ü
(ffi.
	$”ºo
()))

34 
’d


35  
buf


36 
’d


38 --- 
Check
 
wh‘h”
 
a
 
giv’
 
·th
 
is
 
dœeùÜy


39 
funùiÚ
 
fs
.
	$is_fe
(
·th
)

40 
loÿl
 
buf
, 
”r
 = 
fs
.
	$¡©
(
·th
, 
n
)

41 
buf
 =ğ-1 
th’
  
çl£
, 
”r
 
’d


42 
b™
.
	`bªd
(
buf
.
¡_mode
, 
sysÿÎ
.
S_IFREG
è=ğsysÿÎ.S_IFREG 
th’


43  
Œue


45  
çl£


46 
’d


47 
’d


49 --- 
Check
 
wh‘h”
 
a
 
giv’
 
·th
 
is
 
dœeùÜy


50 
funùiÚ
 
fs
.
	$is_dœ
(
·th
)

51 
loÿl
 
buf
, 
”r
 = 
fs
.
	$¡©
(
·th
, 
n
)

52 
buf
 =ğ-1 
th’
  
çl£
, 
”r
 
’d


53 
b™
.
	`bªd
(
buf
.
¡_mode
, 
sysÿÎ
.
S_IFDIR
è=ğsysÿÎ.S_IFDIR 
th’


54  
Œue


56  
çl£


57 
’d


58 
’d


60 
funùiÚ
 
fs
.
	$glob
(
·‰”n
)

61 
loÿl
 
»
 = -1

62 
glob_t
 = 
ffi
.
	`Ãw
("glob_t[1]")

63 
»
 = 
ffi
.
C
.
	$glob
(
·‰”n
, 0, 
n
, 
glob_t
)

64 
»
 ~ğ0 
th’


65 
ffi
.
C
.
	$globä“
(
glob_t
)

66  
n


67 
’d


69 
loÿl
 
fes
 = {
	}
}

70 
loÿl
 
i
 = 0

71 
i
 < 
glob_t
[0].
gl_·thc
 do

72 
bË
.
š£¹
(
fes
, 
ffi
.
	$¡ršg
(
glob_t
[0].
gl_·thv
[
i
]))

73 
i
 = i + 1

74 
’d


75 
ffi
.
C
.
	$globä“
(
glob_t
)

76  
fes


77 
’d


79  
fs


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/hash.lua

1 --- 
	gTurbo
.
lua
 
Hash
 
	gmoduË


2 -- 
W¿µ”s
 
O³nSSL
 
	güy±o
.

4 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


6 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

7 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

8 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


10 -- 
	gh‰p
:

12 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


13 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

14 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

15 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


16 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
nÙ
 
	g_G
.
TURBO_SSL
 
th’


19  
£tm‘©abË
({},

21 
__šdex
 = 
funùiÚ
(
t
, 
k
)

22 
”rÜ
("TURBO_SSL is‚ot defined‡nd you‡reryingo use hash functions.")

23 
’d
,

24 
__ÿÎ
 = 
funùiÚ
(
t
, 
k
)

25 
”rÜ
("TURBO_SSL is‚ot defined‡nd you‡reryingo use hash functions.")

26 
’d


28 
’d


30 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

31 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

32 
»quœe
 "turbo.cdef"

34 
loÿl
 
ls¦
 = 
ffi
.
lßd
(
os
.
g‘’v
("TURBO_LIBSSL"è
Ü
 "ssl")

36 -- 
Bufãrs


37 
loÿl
 
hex¡r
 = 
	$bufãr
()

39 
loÿl
 
hash
 = {
	}
} -- hash 
Çme¥aû


40 
hash
.
SHA_DIGEST_LENGTH
 = 20

42 
hash
.
SHA1
 = 
şass
("SHA1")

44 --- 
C»©e
 
a
 
SHA1
 
objeù
. 
Pass
‡ 
Lua
 
¡ršg
 
w™h
 
the
 
š™Ÿliz”
 
to
 
dige¡


45 -- 
™
.

46 -- @
·¿m
 
	$¡r
 (
SŒšg
)

47 
funùiÚ
 
hash
.
SHA1
:
	$š™Ÿlize
(
¡r
)

48 
	`ty³
(
¡r
è=ğ"¡ršg" 
th’


49 
£lf
.
md
 = 
ffi
.
	`Ãw
("unsigÃd ch¬[?]", 
hash
.
SHA_DIGEST_LENGTH
)

50 
ls¦
.
	`SHA1
(
¡r
, sŒ:
	`Ën
(), 
£lf
.
md
)

51 
£lf
.
fš®
 = 
Œue


53 
£lf
.
ùx
 = 
ffi
.
	`Ãw
("SHA_CTX")

54 
	`as£¹
(
ls¦
.
	`SHA1_In™
(
£lf
.
ùx
) == 1, "Could‚ot init SHA_CTX.")

55 
’d


56 
’d


58 --- 
Upd©e
 
SHA1
 
cÚ‹xt
 
w™h
 
mÜe
 
d©a
.

59 -- @
·¿m
 
	$¡r
 (
SŒšg
)

60 
funùiÚ
 
hash
.
SHA1
:
	$upd©e
(
¡r
)

61 
	`as£¹
(
£lf
.
ùx
, "No SHA_CTX in object.")

62 
	`as£¹
(
nÙ
 
£lf
.
fš®
,

64 
	`as£¹
(
ls¦
.
	`SHA1_Upd©e
(
£lf
.
ùx
, 
¡r
, sŒ:
	`Ën
()) == 1,

66 
’d


68 --- 
Fš®ize
 
SHA1
 
cÚ‹xt
.

69 -- @ (*è
Mes§ge
 
dige¡
.

70 
funùiÚ
 
hash
.
SHA1
:
	$fš®ize
()

71 
£lf
.
fš®
 =ğ
Œue
 
th’


72  
£lf
.
md


73 
’d


74 
£lf
.
fš®
 = 
Œue


75 
	`as£¹
(
£lf
.
ùx
, "No SHA_CTX in object.")

76 
£lf
.
md
 = 
ffi
.
	`Ãw
("unsigÃd ch¬[?]", 
hash
.
SHA_DIGEST_LENGTH
)

77 
	`as£¹
(
ls¦
.
	`SHA1_Fš®
(
£lf
.
md
, s–f.
ùx
) == 1, "Could‚ot final SHA_CTX.")

78  
£lf
.
md


79 
’d


81 --- 
Keyed
-
hash
 
mes§ge
 
auth’tiÿtiÚ
 
	$code
 (
HMAC
è
is
 
a
 
¥ecific
 
cÚ¡ruùiÚ


82 -- 
ÿlcuÏtšg
 
a
 
mes§ge
 
auth’tiÿtiÚ
 
	$code
 (
MAC
è
švŞvšg
 
a


83 -- 
üy±og¿phic
 
hash
 
funùiÚ
 
š
 
combš©iÚ
 
w™h
 
a
 
£ü‘
 cry±og¿phiø
key
.

84 -- @
·¿m
 
	$key
 (
SŒšg
è
Sequ’û
 
of
 
by‹s
 
u£d
 
as
 
a
 
key
.

85 -- @
·¿m
 
	$dige¡
 (
SŒšg
èSŒšg 
to
 
dige¡
.

86 -- @
·¿m
 
	$¿w
 (
BoŞ—n
è
Indiÿ‹s
 
wh‘h”
 
the
 
ouut
 
should
 
be
 
a
 
dœeù
 
bš¬y


87 -- 
equiv®’t
 
of
 
the
 
mes§ge
 
dige¡
, 
Ü
 
fÜm©‹d
 
as
 
a
 
hexadecim®
 
¡ršg
.

88 -- @ (
SŒšg
è
Hex
 
»´e£Á©iÚ
 
of
 
dige¡ed
 
¡ršg
.

89 
funùiÚ
 
hash
.
	$HMAC
(
key
, 
dige¡
, 
¿w
)

90 
	`as£¹
(
	`ty³
(
key
è=ğ"¡ršg", "Key i šv®idy³: "..
	$ty³
(
key
))

91 
	`as£¹
(
	`ty³
(
dige¡
è=ğ"¡ršg", "Cª‚Ù hash: "..
	$ty³
(
dige¡
))

92 
loÿl
 
dige¡
 =

93 
ls¦
.
	`HMAC
Ös¦.
	`EVP_sha1
(),

94 
key
, key:
	`Ën
(),

95 
dige¡
,

96 
dige¡
:
	`Ën
(),

97 
n
,

98 
n
)

99 
hex¡r
:
	$ş—r
()

100 
i
=0, 
hash
.
SHA_DIGEST_LENGTH
-1 do

101 ià(
¿w
è
th’


102 
hex¡r
:
	$­³nd_ch¬_right
(
dige¡
[
i
])

104 
hex¡r
:
	`­³nd_right
(
¡ršg
.
	`fÜm©
("%02x", 
dige¡
[
i
]), 2)

105 
’d


106 
’d


107 
loÿl
 
¡r
 = 
hex¡r
:
	$__to¡ršg
()

108 
hex¡r
:
	$ş—r
(
Œue
)

109  
¡r


110 
’d


112 --- 
Com·»
 
two
 
SHA1
 
cÚ‹xts
 
w™h
 
the
 
equ®™y
 
İ”©Ü
 ==.

113 -- @ (
BoŞ—n
è
True
 
Ü
 
çl£
.

114 
funùiÚ
 
hash
.
SHA1
:
	$__eq
(
cmp
)

115 
	`as£¹
(
£lf
.
fš®
 
ªd
 
cmp
.final, "Can‚ot compare‚on final SHA_CTX's")

116 
	`as£¹
(
£lf
.
md
 
ªd
 
cmp
.md, "Missing message digest(s).")

117 
ffi
.
C
.
	`memcmp
(
£lf
.
md
, 
cmp
.md, 
hash
.
SHA_DIGEST_LENGTH
è=ğ0 
th’


118  
Œue


120  
çl£


121 
’d


122 
’d


124 --- 
CÚv”t
 
mes§ge
 
dige¡
 
to
 
Lua
 
hex
 
¡ršg
.

125 -- @ (
SŒšg
)

126 
funùiÚ
 
hash
.
SHA1
:
	$hex
()

127 
	`as£¹
(
£lf
.
fš®
, "SHA_CTX‚ot final.")

128 
hex¡r
:
	$ş—r
()

129 
i
=0, 
hash
.
SHA_DIGEST_LENGTH
-1 do

130 
hex¡r
:
	`­³nd_right
(
¡ršg
.
	`fÜm©
("%02x", 
£lf
.
md
[
i
]), 2)

131 
’d


132 
loÿl
 
¡r
 = 
hex¡r
:
	$__to¡ršg
()

133 
hex¡r
:
	$ş—r
(
Œue
)

134  
¡r


135 
’d


137  
hash


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/http_response_codes.lua

1 --- 
	gTurbo
.
lua
 
HTTP
 
Re¥Ú£
 
code
 
	gli¡
.

3 -- 
Cİyright
 
John
 
	gAb¿ham£n
 2011, 2012, 2013 < 
	gJhnAbrhm¢
@
	ggma
.
	gcom
 >

6 -- 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
	gš


7 -- 
the
 
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
	gto


8 -- 
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
	gcİ›s


9 -- 
of
 
the
 
	gSoáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
h
Soáw¬e
 
is
 
fuºished
o do

10 -- 
	gso
, 
subjeù
 
to
 
the
 
fŞlowšg
 
	gcÚd™iÚs
:

12 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


13 -- 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

15 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
	gOR


16 -- 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
	gMERCHANTABILITY
,

17 -- 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
	gTHE


18 -- 
AUTHORS
 
OR
 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gCLAIM
, 
DAMAGES
 OR 
	gOTHER


19 -- 
	gLIABILITY
, 
WHETHER
 
IN
 
AN
 
ACTION
 
OF
 
	gCONTRACT
, 
TORT
 
OR
 
	gOTHERWISE
, 
ARISING
 
	gFROM
,

20 -- 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 OR THE 
USE
 OR 
OTHER
 
DEALINGS
 IN 
	gTHE


21 -- 
	gSOFTWARE
."

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/httpserver.lua

1 --- 
	gTurbo
.
lua
 
HTTP
 
S”v”
 
	gmoduË


2 -- 
A
 
	gnÚ
-
blockšg
 
HTTPS
 
S”v”
 
ba£d
 
Ú
 
the
 
TCPS”v”
 
	gşass
.

3 -- 
SuµÜts
 
	gHTTP
/1.0 
ªd
 HTTP/1.1.

4 -- 
Inşudes
 
SSL
 
	gsuµÜt
.

5 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


7 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

8 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

9 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


11 -- 
	gh‰p
:

13 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


14 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

15 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

16 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


17 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

19 
loÿl
 
	gtı£rv”
 = 
»quœe
 "turbo.tcpserver"

20 
loÿl
 
h‰put
 = 
»quœe
 "turbo.httputil"

21 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

22 
loÿl
 
io¡»am
 = 
»quœe
 "turbo.iostream"

23 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

24 
loÿl
 
log
 = 
»quœe
 "turbo.log"

25 
»quœe
('turbo.3rdparty.middleclass')

27 
loÿl
 
h‰p£rv”
 = {} -- h‰p£rv” 
Çme¥aû


29 -- 
HTTPS”v”
 
ba£d
 
Ú
 
TCPS”v”
, 
IOSŒ—m
 
ªd
 
IOLoİ
 
	gşas£s
.

30 -- 
This
 
şass
 
is
 
u£d
 
by
 
the
 
AµliÿtiÚ
 cÏs 
to
 
£rve
 
™s
 
	gReque¡HªdËrs
.

31 -- 
The
 
£rv”
 
™£lf
 
is
 
Úly
 
»¥ÚsibË
 
hªdlšg
 
šcomšg
 
	g»que¡s
, 
	gno


32 -- 
»¥Ú£
 
to
 
the
 
»que¡
 
is
 
	g´oduûd
, 
th©
 i th
pu½o£
 
of
h
	g»que¡


33 -- 
ÿÎback
 
giv’
 
as
 
¬gum’t
 
Ú
 
	gš™Ÿliz©iÚ
. 
The
 c®lback 
»ûives
 
	gthe


34 -- 
HTTPReque¡
 
şass
 
š¡ªû
 
´oduûd
 
the
 
šcomšg
 
»que¡
 
ªd
 
	gÿn


35 -- 
by
 
d©a
 
´ovided
 
š
 
th©
 
š¡ªû
 
decide
 
Ú
 
how
 
™
 
wªt
 
to
 
»¥Úd
 
	gto


36 -- 
the
 
	gş›Á
. 
The
 
ÿÎback
 
mu¡
 
´oduû
 
a
 
v®id
 
HTTP
 
»¥Ú£
 
h—d”
 
	gªd


37 -- 
İtiÚ®ly
 
a
 
»¥Ú£
 
body
 
ªd
 
u£
 
the
 
	gHTTPReque¡
:
wr™e
 
m‘hod
.

39 -- 
The
 
£rv”
 
suµÜts
 
SSL
, 
	gHTTP
/1.1 
	gK“p
-
Alive
 
ªd
 
İtiÚ®ly
 HTTP/1.0

40 -- 
	gK“p
-
Alive
 
the
 
h—d”
 
f›ld
 
is
 
	g¥ecif›d
.

42 -- 
Exam¶e
 
u§ge
 
of
 
	gHTTPS”v”
:

44 -- 
loÿl
 
h‰p£rv”
 = 
»quœe
('turbo.httpserver')

45 -- 
loÿl
 
iŞoİ
 = 
»quœe
('turbo.ioloop')

46 -- 
loÿl
 
iŞoİ_š¡ªû
 = 
iŞoİ
.
š¡ªû
()

48 -- 
funùiÚ
 
hªdË_»que¡
(
»que¡
)

49 -- 
loÿl
 
mes§ge
 = "You„eque¡ed: " .. 
»que¡
.
·th


50 -- 
»que¡
:
wr™e
("HTTP/1.1 200 OK\r\nCÚ‹Á-L’gth:" .. 
mes§ge
:
Ën
() ..

52 -- 
»que¡
:
wr™e
(
mes§ge
)

53 -- 
»que¡
:
fšish
()

54 -- 
’d


56 -- 
h‰p_£rv”
 = 
h‰p£rv”
.
HTTPS”v”
:
Ãw
(
hªdË_»que¡
)

57 -- 
h‰p_£rv”
:
li¡’
(8888)

58 -- 
iŞoİ_š¡ªû
:
	$¡¬t
()

59 
h‰p£rv”
.
HTTPS”v”
 = 
	`şass
('HTTPS”v”', 
tı£rv”
.
TCPS”v”
)

61 --- 
C»©e
 
a
 
Ãw
 
HTTPS”v”
 
şass
 
š¡ªû
.

62 -- @
·¿m
 
	$»que¡_ÿÎback
 (
FunùiÚ
è
C®lback
 
wh’
 
»que¡s
 
¬e
 
»ûive
 
by


63 -- 
the
 
£rv”
.

64 -- @
·¿m
 
	$no_k“p_®ive
 (
BoŞ—n
è
If
 
ş›Ás
 
»que¡
 
u£
 
K“p
-
Alive
 
™
 
is
 
to
 
be


65 -- 
ignÜed
.

66 -- @
·¿m
 
	$io_loİ
 (
IOLoİ
 
š¡ªû
è
The
 IOLoİ in¡ªû 
you
 
wªt
 
to
 
u£
.

67 -- @
·¿m
 
	$xh—d”s
 (
BoŞ—n
è
C¬e
 
about
 
X
-* 
h—d”
 
f›lds
 
Ü
 
nÙ
.

68 -- @
·¿m
 
	$kw¬gs
 (
TabË
è
Key
 
wÜd
 
¬gum’ts
.

69 -- 
Key
 
wÜd
 
¬gum’ts
 
suµÜ‹d
:

70 -- "»ad_body" = 
Autom©iÿÎy
 
»ad
, 
ªd
 
·r£
 
ªy
 
»que¡
 
body
. 
DeçuÉ
 
is


71 -- 
Œue
. 
If
 
£t
 
to
 
çl£
, 
the
 
u£r
 
mu¡
 
»ad
h
body
 
äom
h
cÚÃùiÚ


72 -- 
him£lf
. 
NÙ
 
»adšg
 
a
 
body
 
š
 
the
 
of
‡ 
k“p
-
®ive
 
»que¡
 
may


73 -- 
Ëad
 
to
 
undefšed
 
behaviour
. 
The
 
body
 
should
 
be
 
»ad
 
Ü
 
cÚÃùiÚ


74 -- 
şo£d
.

75 -- "max_h—d”_size" = 
The
 
maximum
 
amouÁ
 
of
 
by‹s
 
a
 
h—d”
 
ÿn
 
be
.

76 -- 
If
 
exûeded
, 
»que¡
 
is
 
drİ³d
.

77 -- "max_body_size" = 
The
 
maxium
 
amouÁ
 
of
 
by‹s
 
a
 
»que¡
 
body
 
ÿn
 
be
.

78 -- 
If
 
exûeded
, 
»que¡
 
is
 
drİ³d
. 
HAS
 
NO
 
EFFECT
 
IF
 
»ad_body
 
IS
 
FALSE
.

80 -- "key_fe" = 
SSL
 
key
 
fe
 
a
 SSL 
’abËd
 
£rv”
 
is
 
wª‹d
.

81 -- "û¹_fe" = 
C”tifiÿ‹
 
fe
. 
key_fe
 
mu¡
 
®so
 
be
 
£t
.

82 
funùiÚ
 
h‰p£rv”
.
HTTPS”v”
:
	$š™Ÿlize
(
»que¡_ÿÎback
,

83 
no_k“p_®ive
,

84 
io_loİ
,

85 
xh—d”s
,

86 
kw¬gs
)

87 
£lf
.
»que¡_ÿÎback
 =„equest_callback

88 
£lf
.
no_k“p_®ive
 =‚o_keep_alive

89 
£lf
.
xh—d”s
 = xheaders

90 
£lf
.
kw¬gs
 = kwargs

91 
tı£rv”
.
TCPS”v”
.
	$š™Ÿlize
(
£lf
,

92 
io_loİ
,

93 
kw¬gs
 
ªd
 kw¬gs.
s¦_İtiÚs
)

94 
’d


96 --- 
IÁ”Çl
 
hªdË_¡»am
 
m‘hod
 
to
 
be
 
ÿÎed
 
by
 
su³r
 
şass
 
TCPS”v”
 
Ú
 
Ãw


97 -- 
cÚÃùiÚ
.

98 -- @
·¿m
 
	$¡»am
 (
IOSŒ—m
 
š¡ªû
è
SŒ—m
 
the
 
Ãwly
 
cÚÃùed
 
ş›Á
.

99 -- @
·¿m
 
	$add»ss
 (
SŒšg
è
IP
 
add»ss
 
of
 
Ãwly
 
cÚÃùed
 
ş›Á
.

100 
funùiÚ
 
h‰p£rv”
.
HTTPS”v”
:
	$hªdË_¡»am
(
¡»am
, 
add»ss
)

101 
loÿl
 
h‰p_cÚn
 = 
h‰p£rv”
.
	$HTTPCÚÃùiÚ
(

102 
¡»am
,

103 
add»ss
,

104 
£lf
.
»que¡_ÿÎback
,

105 
£lf
.
no_k“p_®ive
,

106 
£lf
.
xh—d”s
,

107 
£lf
.
kw¬gs
)

108 
’d


111 --- 
HTTPCÚÃùiÚ
 
şass
.

112 -- 
R•»£Ás
 
a
 
live
 
cÚÃùiÚ
 
to
 
the
 
£rv”
. 
BasiÿÎy
‡ 
h–³r
 
şass
o

113 -- 
HTTPS”v”
. 
It
 
u£s
 
the
 
IOSŒ—m
 
şass
's callbackso handlehe different

114 -- 
£ùiÚs
 
of
 
a
 
HTTP
 
»que¡
.

115 
h‰p£rv”
.
HTTPCÚÃùiÚ
 = 
	`şass
('HTTPConnection')

117 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$š™Ÿlize
(
¡»am
, 
add»ss
,

118 
»que¡_ÿÎback
, 
no_k“p_®ive
, 
xh—d”s
, 
kw¬gs
)

119 
£lf
.
¡»am
 = stream

120 
£lf
.
add»ss
 =‡ddress

121 
£lf
.
»que¡_ÿÎback
 =„equest_callback

122 
£lf
.
no_k“p_®ive
 =‚o_k“p_®iv
Ü
 
çl£


123 
£lf
.
xh—d”s
 = xh—d” 
Ü
 
çl£


124 
£lf
.
_»que¡_fšished
 = 
çl£


125 
£lf
.
_h—d”_ÿÎback
 = s–f.
_Ú_h—d”s


126 
£lf
.
kw¬gs
 = kw¬g 
Ü
 {
	}
}

127 
£lf
.
¡»am
:
£t_maxed_bufãr_ÿÎback
(£lf.
_Ú_max_bufãr
, self)

128 -- 18
K
 
max
 
h—d”
 
size
 
by
 .

129 
	g£lf
.
	g¡»am
:
	$£t_max_bufãr_size
(
£lf
.
kw¬gs
.
max_h—d”_size
 
Ü
 1024*18)

130 
£lf
.
¡»am
:
	`»ad_uÁ
("\r\n\r\n", s–f.
_h—d”_ÿÎback
, self)

131 
’d


133 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$_£t_wr™e_ÿÎback
(
ÿÎback
, 
¬g
)

134 
£lf
.
_wr™e_ÿÎback
 = 
ÿÎback


135 
£lf
.
_wr™e_ÿÎback_¬g
 = 
¬g


136 
’d


138 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$_ş—r_wr™e_ÿÎback
()

139 
£lf
.
_wr™e_ÿÎback
 = 
n


140 
£lf
.
_wr™e_ÿÎback_¬g
 = 
n


141 
’d


143 --- 
Wr™es
 
a
 
chunk
 
of
 
ouut
 
to
 
the
 
und”lyšg
 
¡»am
.

144 -- @
·¿m
 
	$chunk
 (
SŒšg
è
D©a
 
chunk
 
to
 
wr™e
Ø
und”lyšg
 
IOSŒ—m
.

145 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
funùiÚ
 
ÿÎed
 
wh’
 
bufãr
 
is
 
fuÎy


146 -- 
æushed
.

147 -- @
·¿m
 
¬g
 
O±iÚ®
 
fœ¡
 
¬gum’t
 
ÿÎback
.

148 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$wr™e
(
chunk
, 
ÿÎback
, 
¬g
)

149 
nÙ
 
£lf
.
_»que¡
 
th’


150 
	`”rÜ
("Request closed.")

151 
’d


152 
nÙ
 
£lf
.
¡»am
:
	$şo£d
(è
th’


153 
£lf
:
	$_£t_wr™e_ÿÎback
(
ÿÎback
, 
¬g
)

154 
£lf
.
¡»am
:
	$wr™e
(
chunk
, 
£lf
.
_Ú_wr™e_com¶‘e
, self)

155 
’d


156 
’d


158 --- 
Wr™e
 
the
 
giv’
 ``
turbo
.
¡ruùs
.
bufãr
`` 
to
h
und”lyšg
 
¡»am
.

159 -- @
·¿m
 
	`buf
 (
Bufãr
 
şass
 
š¡ªû
)

160 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
funùiÚ
 
ÿÎed
 
wh’
 
bufãr
 
is
 
fuÎy


161 -- 
æushed
.

162 -- @
·¿m
 
¬g
 
O±iÚ®
 
fœ¡
 
¬gum’t
 
ÿÎback
.

163 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$wr™e_bufãr
(
buf
, 
ÿÎback
, 
¬g
)

164 
nÙ
 
£lf
.
_»que¡
 
th’


165 
	`”rÜ
("Request closed.")

166 
’d


167 
nÙ
 
£lf
.
¡»am
:
	$şo£d
(è
th’


168 
£lf
:
	$_£t_wr™e_ÿÎback
(
ÿÎback
, 
¬g
)

169 
£lf
.
¡»am
:
	$wr™e_bufãr
(
buf
, 
£lf
.
_Ú_wr™e_com¶‘e
, self)

170 
’d


171 
’d


173 --- 
Wr™e
 
a
 
Bufãr
 
şass
 
š¡ªû
 
w™hout
 
cİyšg
 
™
 
što
 
the
 
IOSŒ—m
 
š‹º®


174 -- 
bufãr
. 
Some
 
cÚsid”©iÚs
 
has
 
to
 
be
 
dÚe
 
wh’
 
usšg
 
this
. 
Any
 
´iÜ
 
ÿÎs


175 -- 
to
 
HTTPCÚÃùiÚ
:
wr™e
 
Ü
 HTTPCÚÃùiÚ:
wr™e_bufãr
 
mu¡
 
have
 
com¶‘ed


176 -- 
befÜe
 
this
 
m‘hod
 
ÿn
 
be
 
u£d
. 
The
 
z”o
 
cİy
 
wr™e
 
mu¡
 
com¶‘e
 befÜ
ªy


177 -- 
Ùh”
 
wr™es
 
may
 
be
 
dÚe
. 
Also
 
the
 
bufãr
 
şass
 
should
 
nÙ
 b
modif›d


178 -- 
the
 
wr™e
 
is
 
bešg
 
com¶‘ed
. 
Fau»
 
to
 
fŞlow
 
the£
 
adviû
 
wl
 
Ëad


179 -- 
to
 
undefšed
 
behaviour
.

180 -- @
·¿m
 
	`buf
 (
Bufãr
 
şass
 
š¡ªû
)

181 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
funùiÚ
 
ÿÎed
 
wh’
 
bufãr
 
is
 
fuÎy


182 -- 
æushed
.

183 -- @
·¿m
 
¬g
 
O±iÚ®
 
fœ¡
 
¬gum’t
 
ÿÎback
.

184 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$wr™e_z”o_cİy
(
buf
, 
ÿÎback
, 
¬g
)

185 
nÙ
 
£lf
.
_»que¡
 
th’


186 
	`”rÜ
("Request closed.")

187 
’d


188 
nÙ
 
£lf
.
¡»am
:
	$şo£d
(è
th’


189 
£lf
:
	$_£t_wr™e_ÿÎback
(
ÿÎback
, 
¬g
)

190 
£lf
.
¡»am
:
	$wr™e_z”o_cİy
(
buf
, 
£lf
.
_Ú_wr™e_com¶‘e
, self)

192 
log
.
	`dev–
("[httpserver.lua] Tryingo do zero copy operation on closed stream.")

193 
’d


194 
’d


196 --- 
Fšishes
 
the
 
»que¡
.

197 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$fšish
()

198 
	`as£¹
(
£lf
.
_»que¡
, "Request closed")

199 
£lf
.
_»que¡_fšished
 = 
Œue


200 
nÙ
 
£lf
.
¡»am
:
	$wr™šg
(è
th’


201 
£lf
:
	$_ş—r_wr™e_ÿÎback
()

202 
£lf
:
	$_fšish_»que¡
()

203 
’d


204 
’d


206 
loÿl
 
funùiÚ
 
	$_Ú_h—d”s_”rÜ_hªdËr
(
”r
)

207 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
("[h‰p£rv”.lua] Inv®id„eque¡. %s", 
”r
))

208 
’d


210 --- 
HªdËs
 
šcomšg
 
h—d”s
. 
The
 
HTTPH—d”s
 
şass
 
is
 
u£d
 
to
 
·r£


211 -- 
»que¡
 
h—d”s
.

212 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$_Ú_h—d”s
(
d©a
)

213 
loÿl
 
h—d”s


214 
loÿl
 
¡©us
, 
h—d”s
 = 
	`xpÿÎ
(
h‰put
.
HTTPP¬£r
,

215 
_Ú_h—d”s_”rÜ_hªdËr
, 
d©a
, 
h‰put
.
hdr_t
["HTTP_REQUEST"])

217 
¡©us
 =ğ
çl£
 
th’


218 -- 
Inv®id
 
h—d”s
. 
Clo£
 
¡»am
.

219 -- 
Log
 
lše
 
is
 
´š‹d
 
by
 
”rÜ
 
hªdËr
 
desüibšg
 
the
 
»asÚ
.

220 
£lf
.
¡»am
:
	$şo£
()

222 
’d


223 
£lf
.
_h—d”s_»ad
 = 
Œue


224 
£lf
.
_»que¡
 = 
h‰p£rv”
.
HTTPReque¡
:
	`Ãw
(
h—d”s
:
	`g‘_m‘hod
(),

225 
h—d”s
:
	`g‘_u¾
(), {

226 
v”siÚ
 = 
h—d”s
:
	`g‘_v”siÚ
(),

227 
cÚÃùiÚ
 = 
£lf
,

228 
h—d”s
 = headers,

229 
»mÙe_
 = 
£lf
.
add»ss


230 
	}
})

231 
	g£lf
.
	gkw¬gs
.
	g»ad_body
 ~ğ
çl£
 
th’


232 
loÿl
 
cÚ‹Á_Ëngth
 = 
h—d”s
:
g‘
("Content-Length")

233 
cÚ‹Á_Ëngth
 
th’


234 
cÚ‹Á_Ëngth
 = 
tÚumb”
(content_length)

235 -- 
S‘
 
max
 
bufãr
 
size
 
to
 128
MB
.

236 
£lf
.
¡»am
:
£t_max_bufãr_size
(

237 
£lf
.
kw¬gs
.
max_body_size
 
Ü
 
m©h
.
	$max
(
cÚ‹Á_Ëngth
, 1024*18))

238 
cÚ‹Á_Ëngth
 > 
£lf
.
¡»am
.
max_bufãr_size
 
th’


239 
log
.
	`”rÜ
(

242 
£lf
.
¡»am
:
	$şo£
()

243 
’d


244 
h—d”s
:
	`g‘
("Ex³ù"è=ğ"100-cÚtšue" 
th’


245 
£lf
.
¡»am
:
	`wr™e
("HTTP/1.1 100 (Continue)\r\n\r\n")

246 
’d


247 
£lf
.
¡»am
:
	$»ad_by‹s
(
cÚ‹Á_Ëngth
, 
£lf
.
_Ú_»que¡_body
, self)

249 
’d


250 
’d


251 
£lf
.
	$»que¡_ÿÎback
(
£lf
.
_»que¡
)

252 
’d


254 --- 
HªdËs
 
šcomšg
 
»que¡
 
body
.

255 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$_Ú_»que¡_body
(
d©a
)

256 
£lf
.
_»que¡
.
body
 = 
d©a


257 
loÿl
 
cÚ‹Á_ty³
 = 
£lf
.
_»que¡
.
h—d”s
:
	`g‘
("Content-Type")

258 
cÚ‹Á_ty³
 
th’


259 
cÚ‹Á_ty³
:
	`fšd
("x-www-fÜm-u¾’coded", 1, 
Œue
è
th’


260 
£lf
.
¬gum’ts
 =

261 
h‰put
.
	$·r£_po¡_¬gum’ts
(
£lf
.
_»que¡
.
body
è
Ü
 {
	}
}

262 
–£if
 
cÚ‹Á_ty³
:
fšd
("muÉ¬t/fÜm-d©a", 1, 
Œue
è
	gth’


263 -- 
V®id
 
bound¬y
 
mu¡
 
Úly
 
be
 
	gmax
 70 
ch¬aù”s
 
	gnÙ


264 -- 
’dšg
 
š
 
	g¥aû
.

265 -- 
V®id
 
ch¬aù”s
 
äom
 
RFC2046
 
	g¬e
:

266 -- 
bch¬
 :ğ
DIGIT
 / 
ALPHA
 / "'" / "(" / ")" /

269 -- 
Bound¬y
 
¡ršg
 
is
 
³rm™‹d
 
to
 
be
 
quÙed
.

270 
loÿl
 
bound¬y
 =

271 
cÚ‹Á_ty³
:
m©ch
(

273 
£lf
.
¬gum’ts
 =

274 
h‰put
.
	$·r£_muÉ¬t_d©a
(
£lf
.
_»que¡
.
body
, 
bound¬y
)

275 
Ü
 {
	}
}

276 
’d


277 
’d


278 
	g£lf
.
	$»que¡_ÿÎback
(
£lf
.
_»que¡
)

279 
’d


281 --- 
Fšish
 
»que¡
.

282 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$_fšish_»que¡
()

283 
loÿl
 
discÚÃù
 = 
çl£


285 
£lf
.
no_k“p_®ive
 
th’


286 
discÚÃù
 = 
Œue


288 
loÿl
 
cÚÃùiÚ_h—d”
 = 
£lf
.
_»que¡
.
h—d”s
:
	`g‘
("Connection")

289 
cÚÃùiÚ_h—d”
 
th’


290 
cÚÃùiÚ_h—d”
 = cÚÃùiÚ_h—d”:
	$low”
()

291 
’d


292 
£lf
.
_»que¡
:
	$suµÜts_h‰p_1_1
(è
th’


293 
discÚÃù
 = 
cÚÃùiÚ_h—d”
 == "close"

294 
–£if
 
£lf
.
_»que¡
.
h—d”s
:
	`g‘
("CÚ‹Á-L’gth"è
Ü


295 
£lf
.
_»que¡
.
h—d”s
.
m‘hod
 =ğ"HEAD" 
Ü


296 
£lf
.
_»que¡
.
m‘hod
 =ğ"GET" 
th’


297 
discÚÃù
 = 
cÚÃùiÚ_h—d”
 ~= "keep-alive"

299 
discÚÃù
 = 
Œue


300 
’d


301 
’d


302 
£lf
.
_max_buf
 = 
çl£


303 
£lf
.
_»que¡_fšished
 = 
çl£


304 
discÚÃù
 
th’


305 
£lf
.
¡»am
:
	$şo£
()

307 
’d


308 
£lf
.
¬gum’ts
 = 
n
 -- 
Re£t
 
bË
 
š
 
of
 
k“p
-
®ive
.

309 
nÙ
 
£lf
.
¡»am
:
	$şo£d
(è
th’


310 
£lf
.
¡»am
:
	$£t_max_bufãr_size
(
£lf
.
kw¬gs
.
max_h—d”_size
 
Ü
 1024*18)

311 
£lf
.
¡»am
:
	`»ad_uÁ
("\r\n\r\n", s–f.
_h—d”_ÿÎback
, self)

313 
log
.
	`debug
("[httpserver.lua] Client hang up. End Keep-Alive session.")

314 
£lf
 = 
n


316 
’d


317 
’d


319 --- 
C®lback
 
Ú
 
com¶‘e
 
ev’t
.

320 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$_Ú_wr™e_com¶‘e
()

321 
£lf
.
_wr™e_ÿÎback
 
th’


322 
loÿl
 
ÿÎback
 = 
£lf
.
_wr™e_ÿÎback


323 
loÿl
 
¬gum’t
 = 
£lf
.
_wr™e_ÿÎback_¬g


324 
£lf
:
	$_ş—r_wr™e_ÿÎback
()

325 
	$ÿÎback
(
¬gum’t
)

326 
’d


327 
£lf
.
_»que¡_fšished
 
ªd
 
nÙ
 s–f.
¡»am
:
	$wr™šg
(è
th’


328 
£lf
:
	$_fšish_»que¡
()

329 
’d


330 
’d


332 --- 
C®lback
 
maxed
 
out
 
bufãr
.

333 
funùiÚ
 
h‰p£rv”
.
HTTPCÚÃùiÚ
:
	$_Ú_max_bufãr
()

334 
£lf
.
_max_buf
 
th’


335 -- 
AÎow
 
Úe
 
™”©iÚ
 
of
 
bufãr
 
©
 
max
. 
In
 
h—d”s


336 -- 
ªd
 
body
 
¬rive
 
š
 
Úe
 
chunk
.

337 
nÙ
 
£lf
.
_h—d”s_»ad
 
th’


338 
log
.
	`”rÜ
(

339 
¡ršg
.
	`fÜm©
("[httpserver.lua] Headersoo†arge for†imit %dB.",

340 
£lf
.
kw¬gs
.
max_h—d”_size
 
Ü
 1024*18))

342 
log
.
	`”rÜ
(

343 
¡ršg
.
	`fÜm©
("[httpserver.lua] Request bodyoo†arge for†imit %dB.",

344 
£lf
.
kw¬gs
.
max_h—d”_size
 
Ü
 1024*18))

345 
’d


346 
£lf
.
¡»am
:
	$şo£
()

348 
’d


349 
£lf
.
_max_buf
 = 
Œue


350 
’d


352 --- 
HTTPReque¡
 
şass
.

353 -- 
R•»£Ás
 
a
 
HTTP
 
»que¡
 
to
 
the
 
£rv”
.

354 -- 
HTTP
 
h—d”s
 
¬e
 
·r£d
 
magiÿÎy
 h—d” ¬
suµl›d
 
w™h
 
kw¬gs
 
bË
.

355 
h‰p£rv”
.
HTTPReque¡
 = 
	`şass
('HTTPRequest')

357 --- 
C»©e
 
a
 
Ãw
 
HTTPReque¡
 
şass
 
š¡ªû
.

358 -- @
·¿m
 
	$m‘hod
 (
SŒšg
è
HTTP
 
»que¡
 
m‘hod
, 
e
.
g
 "POST".

359 -- @
·¿m
 
	$uri
 (
SŒšg
è
The
 
URI
 
»que¡ed
.

360 -- @
·¿m
 
	$¬gs
 (
TabË
èTabË 
Ü
 
İtiÚ®
 
¬gum’ts
:

361 -- 
Argum’ts
 
avaabË
:

362 -- 
h—d”s
,

363 -- 
body
,

364 -- 
»mÙe_
,

365 -- 
´ÙocŞ
,

366 -- 
ho¡
,

367 -- 
fes
,

368 -- 
cÚÃùiÚ


369 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$š™Ÿlize
(
m‘hod
, 
uri
, 
¬gs
)

370 
loÿl
 
h—d”s
, 
body
, 
»mÙe_
, 
´ÙocŞ
, 
ho¡
, 
fes
, 
v”siÚ
, 
cÚÃùiÚ


371 ğ
n
,‚il,‚il,‚il,‚il,‚il, "HTTP/1.0",‚il

373 -- 
Fšd
 
¬gum’ts
 
£Á
.

374 
	`ty³
(
¬gs
è=ğ"bË" 
th’


375 
v”siÚ
 = 
¬gs
.v”siÚ 
Ü
 version

376 
h—d”s
 = 
¬gs
.headers

377 
body
 = 
¬gs
.body

378 
»mÙe_
 = 
¬gs
.remote_ip

379 
´ÙocŞ
 = 
¬gs
.protocol

380 
ho¡
 = 
¬gs
.host

381 
fes
 = 
¬gs
.files

382 
cÚÃùiÚ
 = 
¬gs
.connection

383 
’d


384 
£lf
.
m‘hod
 = method

385 
£lf
.
uri
 = uri

386 
£lf
.
v”siÚ
 = 
¬gs
.v”siÚ 
Ü
 version

387 
£lf
.
h—d”s
 = h—d” 
Ü
 
h‰put
.
HTTPH—d”s
:
	$Ãw
()

388 
£lf
.
body
 = body 
Ü
 ""

389 
cÚÃùiÚ
 
ªd
 cÚÃùiÚ.
xh—d”s
 
th’


390 
£lf
.
»mÙe_
 = s–f.
h—d”s
:
	`g‘
("X-R—l-Ip"è
Ü


391 
£lf
.
h—d”s
:
	`g‘
("X-Forwarded-For")

392 
nÙ
 
£lf
:
	$_v®id_
(
£lf
.
»mÙe_
è
th’


393 
£lf
.
»mÙe_
 =„emote_ip

394 
’d


395 
£lf
.
´ÙocŞ
 = s–f.
h—d”s
:
	`g‘
("X-Scheme"è
Ü


396 
£lf
.
h—d”s
:
	`g‘
("X-Forwarded-Proto")

397 
£lf
.
´ÙocŞ
 ~ğ"h‰p" 
Ü
 s–f.´ÙocŞ ~ğ"h‰ps" 
th’


398 
£lf
.
´ÙocŞ
 = "http"

399 
’d


401 
£lf
.
»mÙe_
 =„emote_ip

402 
´ÙocŞ
 
th’


403 
£lf
.
´ÙocŞ
 =…rotocol

404 
–£if
 
cÚÃùiÚ
 
ªd


405 
	$š¡ªûOf
(
io¡»am
.
SSLIOSŒ—m
, 
cÚÃùiÚ
.
¡»am
è
th’


406 
£lf
.
´ÙocŞ
 = "https"

408 
£lf
.
´ÙocŞ
 = "http"

409 
’d


410 
’d


411 
£lf
.
ho¡
 = ho¡ 
Ü
 s–f.
h—d”s
:
	`g‘
("Host") or "127.0.0.1"

412 
£lf
.
fes
 = fe 
Ü
 {
	}
}

413 
£lf
.
cÚÃùiÚ
 = connection

414 
£lf
.
_¡¬t_time
 = 
ut
.
	$g‘timemÚÙÚic
()

415 
£lf
.
_fšish_time
 = 
n


416 
£lf
.
·th
 = s–f.
h—d”s
:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
PATH
)

417 
£lf
.
¬gum’ts
 = s–f.
h—d”s
:
	$g‘_¬gum’ts
()

418 
’d


421 --- 
R‘uºs
 
Œue
 
»que¡”
 
suµÜts
 
HTTP
 1.1.

422 -- @ (
BoŞ—n
)

423 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$suµÜts_h‰p_1_1
()

424  
£lf
.
v”siÚ
 == "HTTP/1.1"

425 
’d


427 --- 
Wr™es
 
a
 
chunk
 
of
 
ouut
 
to
 
the
 
¡»am
.

428 -- @
·¿m
 
	$chunk
 (
SŒšg
è
D©a
 
chunk
 
to
 
wr™e
Ø
und”lyšg
 
IOSŒ—m
.

429 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
ÿÎback
 
ÿÎed
 
wh’
 
sock‘
 
is
 
æushed
.

430 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$wr™e
(
chunk
, 
ÿÎback
, 
¬g
)

431 
£lf
.
cÚÃùiÚ
:
	$wr™e
(
chunk
, 
ÿÎback
, 
¬g
)

432 
’d


435 --- 
Wr™e
 
a
 
Bufãr
 
şass
 
š¡ªû
 
to
 
the
 
¡»am
.

436 -- @
·¿m
 
	`buf
 (
Bufãr
 
şass
 
š¡ªû
)

437 -- @
·¿m
 
ÿÎback
 
O±iÚ®
 c®lback 
wh’
 
sock‘
 
is
 
æushed
.

438 -- @
·¿m
 
¬g
 
O±iÚ®
 
fœ¡
 
¬gum’t
 
ÿÎback
.

439 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$wr™e_bufãr
(
buf
, 
ÿÎback
, 
¬g
)

440 
£lf
.
cÚÃùiÚ
:
	$wr™e_bufãr
(
buf
, 
ÿÎback
, 
¬g
)

441 
’d


443 --- 
Wr™e
 
a
 
Bufãr
 
şass
 
š¡ªû
 
w™hout
 
cİyšg
 
™
 
što
 
the
 
IOSŒ—m
 
š‹º®


444 -- 
bufãr
. 
Some
 
cÚsid”©iÚs
 
has
 
to
 
be
 
dÚe
 
wh’
 
usšg
 
this
. 
Any
 
´iÜ
 
ÿÎs


445 -- 
to
 
HTTPCÚÃùiÚ
:
wr™e
 
Ü
 HTTPCÚÃùiÚ:
wr™e_bufãr
 
mu¡
 
have
 
com¶‘ed


446 -- 
befÜe
 
this
 
m‘hod
 
ÿn
 
be
 
u£d
. 
The
 
z”o
 
cİy
 
wr™e
 
mu¡
 
com¶‘e
 befÜ
ªy


447 -- 
Ùh”
 
wr™es
 
may
 
be
 
dÚe
. 
Also
 
the
 
bufãr
 
şass
 
should
 
nÙ
 b
modif›d


448 -- 
the
 
wr™e
 
is
 
bešg
 
com¶‘ed
. 
Fau»
 
to
 
fŞlow
 
the£
 
adviû
 
wl
 
Ëad


449 -- 
to
 
undefšed
 
behaviour
.

450 -- @
·¿m
 
	`buf
 (
Bufãr
 
şass
 
š¡ªû
)

451 -- @
·¿m
 
ÿÎback
 
O±iÚ®
 c®lback 
wh’
 
sock‘
 
is
 
æushed
.

452 -- @
·¿m
 
¬g
 
O±iÚ®
 
fœ¡
 
¬gum’t
 
ÿÎback
.

453 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$wr™e_z”o_cİy
(
buf
, 
ÿÎback
, 
¬g
)

454 
£lf
.
cÚÃùiÚ
:
	$wr™e_z”o_cİy
(
buf
, 
ÿÎback
, 
¬g
)

455 
’d


457 --- 
Fšish
 
the
 
»que¡
. 
Clo£
 
cÚÃùiÚ
.

458 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$fšish
()

459 
£lf
.
cÚÃùiÚ
:
	$fšish
()

460 
£lf
.
_fšish_time
 = 
ut
.
	$g‘timemÚÙÚic
()

461 
’d


463 --- 
R‘uº
 
the
 
fuÎ
 
URL
 
th©
h
u£r
 
»que¡ed
.

464 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$fuÎ_u¾
()

465  
£lf
.
´ÙocŞ
 .. "://" .. s–f.
ho¡
 .. s–f.
uri


466 
’d


468 --- 
R‘uº
 
the
 
time
 
u£d
 
to
 
hªdË
h
»que¡
 
Ü
he

469 -- 
time
 
up
 
to
 
now
 
»que¡
 
nÙ
 
fšished
.

470 -- @ (
Numb”
è
Ms
 
the
 
»que¡
 
took
 
to
 
fšish
, 
Ü
 
up
 
uÁ
 
now
 
nÙ
 
y‘


471 -- 
com¶‘ed
.

472 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	$»que¡_time
()

473 
nÙ
 
£lf
.
_fšish_time
 
th’


474  
ut
.
	`g‘timemÚÙÚic
(è- 
£lf
.
_¡¬t_time


476  
£lf
.
_fšish_time
 - s–f.
_¡¬t_time


477 
’d


478 
’d


480 
funùiÚ
 
h‰p£rv”
.
HTTPReque¡
:
	`_v®id_
(

)

481 --
FIXME
: 
This
 
IP
 
v®id©iÚ
 
is
 
brok’
!

482 
loÿl
 

 = i°
Ü
 ''

483  

:
	`fšd
("[%d+%.]+"è
Ü
 
n


484 
’d


486  
h‰p£rv”


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/httputil.lua

1 --- 
	gTurbo
.
lua
 
HTTP
 
Ut™›s
 
	gmoduË


2 -- 
CÚšs
 
the
 
HTTPH—d”s
 
ªd
 
HTTPP¬£r
 
	gşas£s
, 
which
 
·r£s
 
»que¡
 
	gªd


3 -- 
»¥Ú£
 
h—d”s
 
ªd
 
®so
 
ofãrs
 
ut™›s
 
to
 
bud
 
»que¡
 
	gh—d”s
.

5 -- 
Also
 
ofãrs
 
a
 
ãw
 
funùiÚs
 
·rsšg
 
GET
 
URL
 
	g·¿m‘”s
, 
ªd
 
	gdifã»Á


6 -- 
POST
 
d©a
 
	gty³s
.

8 -- 
Cİyright
 
John
 
	gAb¿ham£n
 2011, 2012, 2013

11 -- 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
	gš


12 -- 
the
 
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
	gto


13 -- 
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
	gcİ›s


14 -- 
of
 
the
 
	gSoáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
h
Soáw¬e
 
is
 
fuºished
o do

15 -- 
	gso
, 
subjeù
 
to
 
the
 
fŞlowšg
 
	gcÚd™iÚs
:

17 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


18 -- 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

20 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
	gOR


21 -- 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
	gMERCHANTABILITY
,

22 -- 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
	gTHE


23 -- 
AUTHORS
 
OR
 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gCLAIM
, 
DAMAGES
 OR 
	gOTHER


24 -- 
	gLIABILITY
, 
WHETHER
 
IN
 
AN
 
ACTION
 
OF
 
	gCONTRACT
, 
TORT
 
OR
 
	gOTHERWISE
, 
ARISING
 
	gFROM
,

25 -- 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 OR THE 
USE
 OR 
OTHER
 
DEALINGS
 IN 
	gTHE


26 -- 
	gSOFTWARE
."

28 
loÿl
 
	glog
 = 
»quœe
 "turbo.log"

29 
loÿl
 
¡©us_codes
 = 
»quœe
 "turbo.http_response_codes"

30 
loÿl
 
deque
 = 
»quœe
 "turbo.structs.deque"

31 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

32 
loÿl
 
esÿ³
 = 
»quœe
 "turbo.escape"

33 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

34 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

35 
loÿl
 
ffi
 = 
»quœe
 "ffi"

36 
loÿl
 
libturbo_·r£r
 = 
ut
.
	$lßd_libtffi
()

38 
»quœe
 "turbo.cdef"

39 
»quœe
 "turbo.3rdparty.middleclass"

41 
loÿl
 
ç¡_as£¹
 = 
ut
.fast_assert

42 
loÿl
 
b
 = 
¡ršg
.
by‹


44 
loÿl
 
h‰put
 = {
	}
} -- h‰put 
Çme¥aû


46 --- 
Mu¡
 
m©ch
 
the
 
š
 
h‰p
-
·r£r
.
h
!

47 
loÿl
 
m‘hod_m­
 = {

76 
loÿl
 
funùiÚ
 
	$MAX
(
a
,
b
è‡ > b 
ªd
‡ 
Ü
 b 
’d


78 --*************** 
HTTP
 
H—d”
 
·rsšg
 ***************

81 --- 
URL
 
F›ld
 
bË
.

82 
h‰put
.
UF
 = {

83 
SCHEMA
 = 0

84 , 
HOST
 = 1

85 , 
PORT
 = 2

86 , 
PATH
 = 3

87 , 
QUERY
 = 4

88 , 
FRAGMENT
 = 5

89 , 
USERINFO
 = 6

90 
	}
}

92 --- 
HTTP
 
h—d”
 
	gty³
. 
U£
 
Ú
 
HTTPH—d”s
 
	$š™Ÿlize
(è
to
 
¥ecify


93 -- 
h—d”
 
ty³
 
to
 
·r£
.

94 
h‰put
.
hdr_t
 = {

95 
HTTP_REQUEST
 = 0,

96 
HTTP_RESPONSE
 = 1,

97 
HTTP_BOTH
 = 2

98 
	}
}

100 
loÿl
 
	gjavasüt_ty³s
 = {

101 ["­¶iÿtiÚ/javasüt"] = 
Œue
,

102 ["­¶iÿtiÚ/jsÚ"] = 
Œue
,

103 ["­¶iÿtiÚ/x-javasüt"] = 
Œue
,

104 ["‹xt/x-javasüt"] = 
Œue
,

105 ["‹xt/x-jsÚ"] = 
Œue


109 --- 
HTTPP¬£r
 
	gCÏss


110 -- 
CÏss
 
ü—tiÚ
 
ªd
 
·rsšg
 
of
 
HTTP
 
	gh—d”s
.

111 
	gh‰put
.
	gHTTPP¬£r
 = 
şass
("HTTPParser")

113 --- 
Pass
 
»que¡
 
h—d”s
 
as
 
·¿m‘”s
 
to
 
·r£
 
them
 
što


114 -- 
the
 
»tuºed
 
objeù
.

115 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$š™Ÿlize
(
hdr_¡r
, 
hdr_t
)

116 
hdr_¡r
 
ªd
 
hdr_t
 
th’


117 
hdr_t
 =ğ
h‰put
.hdr_t["HTTP_REQUEST"] 
th’


118 
£lf
:
	$·r£_»que¡_h—d”
(
hdr_¡r
)

119 
–£if
 
hdr_t
 =ğ
h‰put
.hdr_t["HTTP_RESPONSE"] 
th’


120 
£lf
:
	$·r£_»¥Ú£_h—d”
(
hdr_¡r
)

121 
’d


122 
’d


123 -- 
Argum’ts
 
¬e
 
Úly
 
·r£d
 
Ú
-
demªd
.

124 
£lf
.
_¬gum’ts_·r£d
 = 
çl£


125 
’d


127 --- 
P¬£
 
¡ªd®Úe
 
URL
 
ªd
 
pİuÏ‹
 
şass
 
š¡ªû
 
w™h
 
v®ues
.

128 -- 
HTTPP¬£r
.
g‘_u¾_f›ld
 
mu¡
 
be
 
u£d
 
to
 
»ad
 
out
 
v®ues
.

129 -- @
·¿m
 
	$u¾
 (
SŒšg
è
URL
 
¡ršg
.

130 -- @
nÙe
 
Wl
 
throw
 
”rÜ
 
URL
 
dÛs
 
nÙ
 
·r£
 
cÜ»ùly
.

131 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$·r£_u¾
(
u¾
)

132 
	`ty³
(
u¾
è~ğ"¡ršg" 
th’


133 
	`”rÜ
("URL…arameter is‚ot‡ string")

134 
’d


135 
loÿl
 
hu¾
 = 
ffi
.
C
.
	`m®loc
(ffi.("struct http_parser_url"))

136 
hu¾
 =ğ
n
 
th’


137 
	`”rÜ
("Could‚ot‡llocate memory")

138 
’d


139 
ffi
.
	$gc
(
hu¾
, 
ffi
.
C
.
ä“
)

140 
£lf
.
h‰p_·r£r_u¾
 = 
ffi
.
	`ÿ¡
("¡ruù h‰p_·r£r_u¾ *", 
hu¾
)

141 
loÿl
 
rc
 = 
libturbo_·r£r
.
	`h‰p_·r£r_·r£_u¾
(

142 
u¾
,

143 
u¾
:
	`Ën
(),

145 
£lf
.
h‰p_·r£r_u¾
)

146 
rc
 ~ğ0 
th’


147 
	`”rÜ
("Could‚ot…arse URL")

148 
’d


149 
nÙ
 
£lf
.
u¾
 
th’


150 
£lf
.
u¾
 = url

151 
’d


152 
’d


154 --- 
G‘
 
a
 
URL
 
f›ld
.

155 -- @
·¿m
 
	$UF_´İ
 (
Numb”
è
AvaabË
 
f›lds
 
desüibed
 
š
 
the
 
h‰put
.
UF
 
bË
.

156 -- @ 
n
 
nÙ
 
found
, 
the
 
¡ršg
 
v®ue
 
is
 
»tuºed
.

157 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$g‘_u¾_f›ld
(
UF_´İ
)

158 
nÙ
 
£lf
.
u¾
 
th’


159 
£lf
:
	$g‘_u¾
()

160 
’d


161 
nÙ
 
£lf
.
h‰p_·r£r_u¾
 
th’


162 
£lf
:
	$·r£_u¾
(
£lf
.
u¾
)

163 
’d


164 
libturbo_·r£r
.
	`u¾_f›ld_is_£t
(

165 
£lf
.
h‰p_·r£r_u¾
, 
UF_´İ
è=ğ
Œue
 
th’


166 
loÿl
 
u¾
 = 
ffi
.
	`ÿ¡
("cÚ¡ ch¬ *", 
£lf
.url)

167 
loÿl
 
f›ld
 = 
ffi
.
	`¡ršg
(

168 
u¾
+
£lf
.
h‰p_·r£r_u¾
.
f›ld_d©a
[
UF_´İ
].
off
,

169 
£lf
.
h‰p_·r£r_u¾
.
f›ld_d©a
[
UF_´İ
].
Ën
)

170  
f›ld


171 
’d


172 -- 
F›ld
 
is
 
nÙ
 
£t
.

173  
n


174 
’d


176 --- 
G‘
 
URL
.

177 -- @ 
Cu¼’y
 
£t
 
URI
 
Ü
 
n
 
nÙ
 set.

178 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$g‘_u¾
()

179 
£lf
.
u¾
 
th’


180  
£lf
.
u¾


182 
nÙ
 
£lf
.
w
 
th’


183 
	`”rÜ
("No URL or header has been…arsed. Can‚ot„eturn URL.")

184 
’d


185 
£lf
.
w
.
u¾_¡r
 =ğ
n
 
th’


186 
	`”rÜ
("No URL‡vailable for„equest headers.")

187 
’d


188 
£lf
.
u¾
 = 
ffi
.
	$¡ršg
(
£lf
.
w
.
u¾_¡r
, s–f.w.
u¾_sz
)

189 
’d


190  
£lf
.
u¾


191 
’d


193 --- 
G‘
 
HTTP
 
m‘hod


194 -- @ 
Cu¼’t
 
m‘hod
 
as
 
¡ršg
 
Ü
 
n
 
nÙ
 
£t
.

195 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$g‘_m‘hod
()

196 
nÙ
 
£lf
.
w
 
th’


197 
	`”rÜ
("No header has been…arsed. Can‚ot„eturn method.")

198 
’d


199  
m‘hod_m­
[
£lf
.
w
.
·r£r
.
m‘hod
]

200 
’d


202 --- 
G‘
 
the
 
HTTP
 
v”siÚ
.

203 -- @ 
Cu¼’y
 
£t
 
v”siÚ
 
as
 
¡ršg
 
Ü
 
n
 
nÙ
 set.

204 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$g‘_v”siÚ
()

205  
¡ršg
.
	`fÜm©
(

207 
£lf
.
w
.
·r£r
.
h‰p_majÜ
,

208 
£lf
.
w
.
·r£r
.
h‰p_mšÜ
)

209 
’d


211 --- 
G‘
 
the
 
¡©us
 
code
.

212 -- @ 
Stus
 
code
 
ªd
 
¡©us
 cod
mes§ge
 
£t
, 
n
.

213 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$g‘_¡©us_code
()

214 
nÙ
 
£lf
.
w
 
th’


215 
	`”rÜ
("No header has been…arsed. Can‚ot„eturn status code.")

216 
–£if
 
£lf
.
hdr_t
 ~ğ
h‰put
.hdr_t["HTTP_RESPONSE"] 
th’


217 
	`”rÜ
("Parsed header‚ot‡ HTTP„esponse header.")

218 
’d


219  
£lf
.
w
.
·r£r
.
¡©us_code
, 
¡©us_codes
[self.status_code]

220 
’d


222 
loÿl
 
funùiÚ
 
	$_uÃsÿ³
(
s
è 
¡ršg
.(
	$tÚumb”
(
s
,16)è
’d


223 --- 
IÁ”Çl
 
funùiÚ
 
to
 
·r£
 ? 
ªd
 & 
£·¿‹d
 
key
 
v®ue
 
f›lds
.

224 -- @
·¿m
 
	$uri
 (
SŒšg
)

225 
loÿl
 
funùiÚ
 
	$_·r£_¬gum’ts
(
uri
)

226 
loÿl
 
¬gum’ts
 = {
	}
}

227 
loÿl
 
–em’ts
 = 0;

229 
	gk
, 
v
 
š
 
	guri
:
gm©ch
("([^&=]+)=([^&]+)") do

230 
–em’ts
 =ƒlements + 1;

231 ià(
	g–em’ts
 > 256è
	gth’


232 -- 
Lim™
 
	gto
 256 
	g–em’ts
, 
	gwhich
 "should beƒnough forƒveryone".

234 
’d


235 
	gv
 = 
v
:
gsub
("+", " "):gsub("%%(%w%w)", 
_uÃsÿ³
);

236 
nÙ
 
	g¬gum’ts
[
k
] 
th’


237 
	g¬gum’ts
[
k
] = 
v
;

239 
ty³
(
¬gum’ts
[
k
]è=ğ"¡ršg" 
th’


240 
loÿl
 
tmp
 = 
¬gum’ts
[
k
];

241 
	g¬gum’ts
[
k
] = {
tmp
};

242 
’d


243 
	gbË
.
š£¹
(
¬gum’ts
[
k
], 
v
);

244 
’d


245 
’d


246  
¬gum’ts


247 
	g’d


249 --- 
G‘
 
URL
 
¬gum’t
 
of
 
the
 
	gh—d”
.

250 -- @
·¿m
 
¬gum’t
 
Key
 
of
‡rgum’ˆ
to
 
g‘
 
v®ue
 
	gof
.

251 -- @ 
If
 
¬gum’t
 
exi¡s
 
th’
 
the
‡rgum’ˆ
is
 
e™h”
 
	g»tuºed


252 -- 
as
 
a
 
bË
 
muÉË
 
v®ues
 
is
 
giv’
 
the
 
§me
 
	gkey
, 
Ü
‡ ¨
¡ršg
 
	gthe


253 -- 
key
 
Úly
 
has
 
Úe
 
	gv®ue
. 
If
 
¬gum’t
 
dÛs
 
nÙ
 
	gexi¡
, 
n
 
is
 
	g»tuºed
.

254 
funùiÚ
 
	gh‰put
.
	gHTTPP¬£r
:
	$g‘_¬gum’t
(
¬gum’t
)

255 
nÙ
 
£lf
.
_¬gum’ts_·r£d
 
th’


256 
£lf
.
_¬gum’ts
 = 
	`_·r£_¬gum’ts
(£lf:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
QUERY
))

257 
£lf
.
_¬gum’ts_·r£d
 = 
Œue


258 
’d


259 
loÿl
 
¬gum’ts
 = 
£lf
:
	$g‘_¬gum’ts
()

260 
¬gum’ts
 
th’


261 
	`ty³
(
¬gum’ts
[
¬gum’t
]è=ğ"bË" 
th’


262  
¬gum’ts
[
¬gum’t
]

263 
–£if
 
	`ty³
(
¬gum’ts
[
¬gum’t
]è=ğ"¡ršg" 
th’


264  { 
¬gum’ts
[
¬gum’t
] 
	}
}

265 
’d


266 
’d


267 
’d


269 --- 
G‘
 
®l
 
¬gum’ts
 
of
 
the
 
h—d”
 
as
 
a
 
bË
.

270 -- @ (
TabË
èTabË 
w™h
 
keys
 
ªd
 
v®ues
.

271 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$g‘_¬gum’ts
()

272 
nÙ
 
£lf
.
_¬gum’ts_·r£d
 
th’


273 
loÿl
 
qu”y
 = 
£lf
:
	$g‘_u¾_f›ld
(
h‰put
.
UF
.
QUERY
)

274 
qu”y
 
th’


275 
£lf
.
_¬gum’ts
 = 
	$_·r£_¬gum’ts
(
qu”y
)

276 
’d


277 
£lf
.
_¬gum’ts_·r£d
 = 
Œue


278 
’d


279  
£lf
.
_¬gum’ts


280 
’d


282 --- 
G‘
 
giv’
 
key
 
äom
 
h—d”
 key 
v®ue
 
£ùiÚ
.

283 -- @
·¿m
 
	$key
 (
SŒšg
è
The
 
key
 
to
 
g‘
.

284 -- @
·¿m
 
	$ÿ£š£ns™ive
 (
BoŞ—n
è
If
 
Œue
 
th’
 
the
 
key
 
wl
 
be
 
m©ched
 
w™hout


285 -- 
»g¬d
 
£ns™iv™y
.

286 -- @ 
The
 
v®ue
 
of
 
the
 
key
, 
Ü
 
n
 
nÙ
 
exi¡šg
. 
May
  
a
 
bË
 

287 -- 
muÉË
 
keys
 
¬e
 
£t
.

288 
loÿl
 
¡ºÿ£cmp


289 
¶©fÜm
.
__LINUX__
 
Ü
…ÏtfÜm.
__UNIX__
 
th’


290 
¡ºÿ£cmp
 = 
ffi
.
C
.strncasecmp

291 
–£if
 
¶©fÜm
.
__WINDOWS__
 
th’


292 -- 
Wšdows
 
dÛs
 
nÙ
 
have
 
¡ºÿ£cmp
, 
but
 
has
 
¡ºicmp
, 
which
 dÛ 
the


293 -- 
thšg
.

294 
¡ºÿ£cmp
 = 
ffi
.
C
.
_¡ºicmp


295 
’d


296 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$g‘
(
key
, 
ÿ£š£ns™ive
)

297 
loÿl
 
v®ue


298 
loÿl
 
c
 = 0

299 
loÿl
 
hdr_sz
 = 
	`tÚumb”
(
£lf
.
w
.
hkv_sz
)

300 -- 
If
 
ÿ£š£ns™ive
 
is
 
n
 
th’
  
to
 
Œue
.

301 
ÿ£š£ns™ive
 =ğ
n
 
th’


302 
ÿ£š£ns™ive
 = 
Œue


303 
’d


305 
hdr_sz
 <ğ0 
th’


306  
n


307 
’d


308 
ÿ£š£ns™ive
 
th’


309 -- 
Ca£
 
š£ns™ive
 
key
.

310 
i
 = 0, 
hdr_sz
-1 do

311 
loÿl
 
f›ld
 = 
£lf
.
w
.
hkv
[
i
]

312 
loÿl
 
key_sz
 = 
key
:
	$Ën
()

313 
f›ld
.
key_sz
 =ğkey_sz 
th’


314 
	`¡ºÿ£cmp
(

315 
f›ld
.
key
,

316 
key
,

317 
f›ld
.
key_sz
è=ğ0 
th’


318 
loÿl
 
¡r
 = 
ffi
.
	$¡ršg
(
f›ld
.
v®ue
, f›ld.
v®ue_sz
)

319 
c
 =ğ0 
th’


320 
v®ue
 = 
¡r


321 
c
 = 1

322 
–£if
 
c
 =ğ1 
th’


323 
v®ue
 = {v®ue, 
¡r
}

324 
c
 = 2

326 
v®ue
[#v®ue+1] = 
¡r


327 
c
 = c + 1

328 
’d


329 
’d


330 
’d


331 
’d


333 -- 
Ca£
 
£ns™ive
 
key
.

334 
i
 = 0, 
	ghdr_sz
-1 do

335 
loÿl
 
	gf›ld
 = 
£lf
.
w
.
hkv
[
i
]

336 
loÿl
 
key_sz
 = 
key
:
	$Ën
()

337 
f›ld
.
key_sz
 =ğkey_sz 
th’


338 
ffi
.
C
.
	`memcmp
(

339 
f›ld
.
key
,

340 
key
,

341 
	`MAX
(
f›ld
.
key_sz
, key_sz)è=ğ0 
th’


342 
loÿl
 
¡r
 = 
ffi
.
	$¡ršg
(
f›ld
.
v®ue
, f›ld.
v®ue_sz
)

343 
c
 =ğ0 
th’


344 
v®ue
 = 
¡r


345 
c
 = 1

346 
–£if
 
c
 =ğ1 
th’


347 
v®ue
 = {v®ue, 
¡r
}

348 
c
 = 2

350 
v®ue
[#v®ue+1] = 
¡r


351 
c
 = c + 1

352 
’d


353 
’d


354 
’d


355 
’d


356 
’d


357  
v®ue
, 
c


358 
	g’d


360 --- 
P¬£
 
HTTP
 
»que¡
 
Ü
 
»¥Ú£
 
	gh—d”s
.

361 -- 
PİuÏ‹s
 
the
 
şass
 
w™h
 
®l
 
d©a
 
š
 
	gh—d”s
.

362 -- @
·¿m
 
	$hdr_¡r
 (
SŒšg
è
HTTP
 
h—d”
 
¡ršg
.

363 -- @
·¿m
 
	$hdr_t
 (
Numb”
è
A
 
numb”
 
defšed
 
š
 
h‰put
.
hdr_t
 
»´e£Ášg
 
h—d”


364 -- 
ty³
.

365 -- @
nÙe
 
Wl
 
throw
 
”rÜ
 
Ú
 
·rsšg
 
çu»
.

366 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	`·r£_h—d”
(
hdr_¡r
, 
hdr_t
)

367 -- 
Ensu»
 
the
 
¡ršg
 
is
 
nÙ
 
GCed
 
we
 
¬e
 
¡l
 
usšg
 
™
 
by
 
k“pšg
 
a


368 -- 
»ã»nû
 
to
 
™
. 
Th”e
 
is
 
no
 
way
 
LuaJIT
Ø
know
 
we
 
¬e
 
¡l


369 -- 
usšg
 
poš‹rs
 
to
 
™
.

370 
£lf
.
hdr_¡r
 = hdr_str

371 
£lf
.
hdr_t
 = hdr_t

372 
loÿl
 
w
 = 
libturbo_·r£r
.
	`turbo_·r£r_w¿µ”_š™
(

373 
hdr_¡r
,

374 
hdr_¡r
:
	`Ën
(),

375 
hdr_t
)

376 
w
 ~ğ
n
 
th’


377 
ffi
.
	$gc
(
w
, 
libturbo_·r£r
.
turbo_·r£r_w¿µ”_ex™
)

379 
	`”rÜ
("libturbo_parser could‚ot‡llocate memory for struct.")

380 
’d


381 
£lf
.
w
 =pw

382 
libturbo_·r£r
.
	`turbo_·r£r_check
(
£lf
.
w
è~ğ
Œue
 
th’


383 
	`”rÜ
(

384 
¡ršg
.
	`fÜm©
(

386 
ffi
.
	`¡ršg
(
libturbo_·r£r
.
	`h‰p_”ºo_Çme
(

387 
£lf
.
w
.
·r£r
.
h‰p_”ºo
)),

388 
ffi
.
	`¡ršg
(
libturbo_·r£r
.
	$h‰p_”ºo_desütiÚ
(

389 
£lf
.
w
.
·r£r
.
h‰p_”ºo
))))

390 
’d


391 
£lf
.
w
.
h—d”s_com¶‘e
 =ğ
çl£
 
th’


392 
	`”rÜ
("libturbo_parser could‚ot…arse header. Unknownƒrror.")

393 
’d


394 
’d


396 --- 
P¬£
 
HTTP
 
»¥Ú£
 
h—d”s
.

397 -- 
PİuÏ‹s
 
the
 
şass
 
w™h
 
®l
 
d©a
 
š
 
h—d”s
.

398 -- @
·¿m
 
	$¿w_h—d”s
 (
SŒšg
è
HTTP
 
h—d”
 
¡ršg
.

399 -- @
nÙe
 
Wl
 
throw
 
”rÜ
 
Ú
 
·rsšg
 
çu»
.

400 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$·r£_»¥Ú£_h—d”
(
¿w_h—d”s
)

401 
£lf
:
	`·r£_h—d”
(
¿w_h—d”s
, 
h‰put
.
hdr_t
["HTTP_RESPONSE"])

402 
’d


404 --- 
P¬£
 
HTTP
 
»que¡
 
h—d”s
.

405 -- 
PİuÏ‹s
 
the
 
şass
 
w™h
 
®l
 
d©a
 
š
 
h—d”s
.

406 -- @
·¿m
 
	$¿w_h—d”s
 (
SŒšg
è
HTTP
 
h—d”
 
¡ršg
.

407 -- @
nÙe
 
Wl
 
throw
 
”rÜ
 
Ú
 
·rsšg
 
çu»
.

408 
funùiÚ
 
h‰put
.
HTTPP¬£r
:
	$·r£_»que¡_h—d”
(
¿w_h—d”s
)

409 
£lf
:
	`·r£_h—d”
(
¿w_h—d”s
, 
h‰put
.
hdr_t
["HTTP_REQUEST"])

410 
’d


412 --- 
P¬£
 
HTTP
 
po¡
 
¬gum’ts
.

413 
funùiÚ
 
h‰put
.
	$·r£_po¡_¬gum’ts
(
d©a
)

414 
	`ty³
(
d©a
è~ğ"¡ršg" 
th’


415 
	`”rÜ
("data‡rgument‚ot‡ string.")

416 
’d


417  
	$_·r£_¬gum’ts
(
d©a
)

418 
’d


420 
loÿl
 
DASH
 = 
¡ršg
.
	`by‹
('-')

421 
loÿl
 
CR
 = 
¡ršg
.
by‹
'\r'

422 
loÿl
 
LF
 = 
¡ršg
.
by‹
'\n'

423 -- 
fšds
 
the
 
¡¬t
 
of
 
a
 
lše


424 
loÿl
 
funùiÚ
 
	$fšd_lše_¡¬t
(
¡r
,
pos
, 
šc
)

425 
nÙ
 
šc
 
th’
 inøğ1 
’d


426 
loÿl
 
sk³d
 = -1

427 -- 
sk
 
ªy
 
nÚ
-
CRLF
 
ch¬s


428 
»³©


429 
b
 = 
¡r
:
	$by‹
(
pos
)

430 
b
 =ğ
n
 
th’
 ‚ 
’d


431 
pos
 =…o + 
šc


432 
sk³d
 = skipped+1

433 
	$uÁ
 (
b
==
CR
è
	$Ü
 (
b
==
LF
)

435 
loÿl
 
b2
 = 
¡r
:
	$by‹
(
pos
)

436 
b2
 =ğ
n
 
th’
 ‚ 
’d


437 ià(
b2
 =ğ
CR
è
	$Ü
 (
b2
 =ğ
LF
è
th’


438 
b
 ~ğ
b2
 
th’


439 
pos
 =…o + 
šc


440 
’d


441 
’d


442  
pos
, 
sk³d


443 
’d


445 -- @ 
’d
 
pos™iÚ
 
of
 
tok’
,ok’ 
¡ršg


446 
loÿl
 
funùiÚ
 
	$g‘RFC822Atom
(
¡r
,
pos
)

447 
loÿl
 
åos
, 
Íos
, 
tok’
 = 
¡r
:
	`fšd
('([^%c%s()<>@,;:\\"/[%]?=]+)', 
pos
)

448  
Íos
, 
tok’


449 
’d


451 --- 
P¬£
 
muÉ¬t
 
fÜm
 
d©a
.

452 
funùiÚ
 
h‰put
.
	$·r£_muÉ¬t_d©a
(
d©a
, 
bound¬y
)

453 
loÿl
 
¬gum’ts
 = {
	}
}

454 
loÿl
 
p1
, 
	gp2
, 
	gb1
, 
b2


456 
	gbound¬y
 = "--" .. 
bound¬y


457 
p1
, 
	gp2
 = 
d©a
:
	$fšd
(
bound¬y
, 1, 
Œue
)

458 
b1
 = 
	`fšd_lše_¡¬t
(
d©a
,
p2
+1)

459 
»³©


460 
p1
, 
p2
 = 
d©a
:
	$fšd
(
bound¬y
, 
p2
, 
Œue
)

461 
p1
 =ğ
n
 
th’
  
’d


462 
b2
 = 
	`fšd_lše_¡¬t
(
d©a
,
p1
-1,-1)

464 
loÿl
 
bound¬y_h—d”s


465 
loÿl
 
h1
, 
h2
, 
v1
, 
sk³d


466 
v1
 = 
b1


467 
»³©


468 
h1
 = 
v1


469 
v1
 = 
	$fšd_lše_¡¬t
(
d©a
,
v1
)

470 
v1
 =ğ
n
 
th’
 
Ãxt_bound¬y
 
’d


471 
uÁ
 
sk³d
 ~= 0

472 
»³©


473 
h2
 = 
v1
-1

474 
v1
, 
sk³d
 = 
	$fšd_lše_¡¬t
(
d©a
,
v1
)

475 
v1
 =ğ
n
 
th’
 
Ãxt_bound¬y
 
’d


476 
uÁ
 
sk³d
 == 0

477 
bound¬y_h—d”s
 = 
d©a
:
	$sub
(
h1
,
h2
)

478 
bound¬y_h—d”s
 = bound¬y_h—d”s:
	`gsub
("([^%c%s:]-):",

479 
	$funùiÚ
(
s
è 
¡ršg
.
	`gsub
(s,"%u", 
	$funùiÚ
(
c
)

480  
¡ršg
.
	$low”
(
c
è
’d
) .. ":"

481 
’d
)

482 
nÙ
 
bound¬y_h—d”s
 
th’


483 
Ãxt_bound¬y


484 
’d


486 
loÿl
 
Çme
, 
ùy³


487 
loÿl
 
¬gum’t
 = { 
	}
}

488 
âame
, 
	gfv®ue
, 
cÚ‹Á_kvs
 
š


489 
	gbound¬y_h—d”s
:
gm©ch
("([^%c%s:]+):%s*([^\r\n;]*);?([^\n\r]*)") do

490 
fv®ue
 =ğ"fÜm-d©a" 
ªd
 
âame
=="cÚ‹Á-di¥os™iÚ" 
th’


491 
¬gum’t
[
âame
] = {}

492 
loÿl
 
p
 = 1

493 
»³©


494 
p
, 
	gkey
 = 
	$g‘RFC822Atom
(
cÚ‹Á_kvs
,
p
)

495 
p
 =ğ
n
 
th’
  
’d


496 
cÚ‹Á_kvs
:
	`by‹
(
p
+1è~ğ
¡ršg
.by‹('='è
th’


498 
’d


499 
p
=p+2

500 
loÿl
 
_
, 
p2
, 
v®
 = 
cÚ‹Á_kvs
:
	`fšd
('^"([^"]+)"',
p
)

501 
nÙ
 
p2
 
th’


502 
p2
, 
v®
 = 
	$g‘RFC822Atom
(
cÚ‹Á_kvs
,
p
)

503 
nÙ
 
p2
 
th’
  
’d


504 
’d


505 
p
 = 
p2
+1

506 
key
=="Çme" 
th’


507 
Çme
=
v®


508 
’d


509 
¬gum’t
[
âame
][
key
] = 
v®


510 
uÁ
 
çl£


512 
âame
=="cÚ‹Á-ty³" 
th’


513 
ùy³
 = 
fv®ue


514 
fv®ue
 = fv®ue:
	$low”
()

515 
–£if
 
âame
=="ch¬£t" 
Ü


516 
âame
=="cÚ‹Á-Œªsãr-’codšg" 
th’


517 
fv®ue
 = fv®ue:
	$low”
()

518 
’d


519 
¬gum’t
[
âame
] = 
fv®ue


520 
’d


521 
’d


522 
nÙ
 
Çme
 
th’


523 
Ãxt_bound¬y


524 
’d


525 
¬gum’t
[1] = 
d©a
:
	$sub
(
v1
, 
b2
)

526 
¬gum’t
["cÚ‹Á-Œªsãr-’codšg"] =ğ"ba£64" 
th’


527 
¬gum’t
[1] = 
esÿ³
.
	$ba£64_decode
(
¬gum’t
[1])

528 
’d


529 
javasüt_ty³s
[
¬gum’t
["cÚ‹Á-ty³"]] 
th’


530 
¬gum’t
[1] = 
esÿ³
.
	$uÃsÿ³
(
¬gum’t
[1])

531 
’d


532 
¬gum’ts
[
Çme
] 
th’


533 
¬gum’ts
[
Çme
][#¬gum’ts[Çme] +1] = 
¬gum’t


535 
¬gum’ts
[
Çme
] = { 
¬gum’t
 
	}
}

536 
’d


537 
’d


538 
’d


539 ::
Ãxt_bound¬y
::

540 
b1
 = 
fšd_lše_¡¬t
(
d©a
,
p2
+1)

541 
uÁ
 (
b1
+1 > #d©aè
	gÜ


542 (
	gd©a
:
by‹
(
p2
+1è=ğ
DASH
 
ªd
 
d©a
:byte(p2+2) == DASH)

543  
¬gum’ts


544 
’d


547 --*************** 
HTTP
 
H—d”
 
g’”©iÚ
 ***************

550 --- 
HTTPH—d”s
 
CÏss


551 -- 
CÏss
 
ü—tšg
 
HTTP
 
h—d”s
 
š
 
a
 
´og¿mm©ic
 
çshiÚ
.

552 
h‰put
.
HTTPH—d”s
 = 
şass
("HTTPHeaders")

554 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$š™Ÿlize
()

555 
£lf
.
_f›lds
 = {
	}
}

556 
’d


558 --- 
S‘
 
URI
.

559 -- @
·¿m
 
	$uri
 (
SŒšg
)

560 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$£t_uri
(
uri
)

561 
	`ty³
(
uri
è~ğ"¡ršg" 
th’


562 
	`”rÜ
("argument #1‚ot‡ string.")

563 
’d


564 
£lf
.
uri
 = uri

565 
’d


567 --- 
G‘
 
cu¼’t
 
URI
.

568 -- @ 
Cu¼’y
 
£t
 
URI
 
Ü
 
n
 
nÙ
 set.

569 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$g‘_uri
(è 
£lf
.
uri
 
’d


571 --- 
S‘
 
HTTP
 
m‘hod
.

572 -- @
·¿m
 
	$m‘hod
 (
SŒšg
è
Mu¡
 
be
 
¡ršg
, 
Ü
 
”rÜ
 
is
 
¿i£d
.

573 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$£t_m‘hod
(
m‘hod
)

574 
	`ty³
(
m‘hod
è~ğ"¡ršg" 
th’


575 
	`”rÜ
("argument #1‚ot‡ string.")

576 
’d


577 
£lf
.
m‘hod
 = method

578 
’d


580 --- 
G‘
 
HTTP
 
m‘hod


581 -- @ 
Cu¼’t
 
m‘hod
 
as
 
¡ršg
 
Ü
 
n
 
nÙ
 
£t
.

582 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$g‘_m‘hod
(è 
£lf
.
m‘hod
 
’d


584 --- 
S‘
 
the
 
HTTP
 
v”siÚ
.

585 -- 
Aµl›s
 
wh’
 
budšg
 
»¥Ú£
 
h—d”s
 
Úly
.

586 -- @
·¿m
 
	$v”siÚ
 (
SŒšg
è
V”siÚ
 
š
 
¡ršg
 
fÜm
, 
e
.
g
 "1.1" 
Ü
 "1.0"

587 -- 
Mu¡
 
be
 
¡ršg
 
Ü
 
”rÜ
 
is
 
¿i£d
.

588 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$£t_v”siÚ
(
v”siÚ
)

589 
	`ty³
(
v”siÚ
è~ğ"¡ršg" 
th’


590 
	`”rÜ
("argument #1‚ot‡ string.")

591 
’d


592 
£lf
.
v”siÚ
 = version

593 
’d


595 --- 
G‘
 
the
 
cu¼’t
 
HTTP
 
v”siÚ
.

596 -- @ 
Cu¼’y
 
£t
 
v”siÚ
 
as
 
¡ršg
 
Ü
 
n
 
nÙ
 set.

597 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$g‘_v”siÚ
(è 
£lf
.
v”siÚ
 
’d


599 --- 
S‘
 
the
 
¡©us
 
code
.

600 -- 
Aµl›s
 
wh’
 
budšg
 
»¥Ú£
 
h—d”s
.

601 -- @
·¿m
 
	$code
 (
Numb”
è
HTTP
 
¡©us
 
code
 
to
 
£t
. 
Mu¡
 
be
 
numb”
 
Ü


602 -- 
”rÜ
 
is
 
¿i£d
.

603 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$£t_¡©us_code
(
code
)

604 
	`ty³
(
code
è~ğ"numb”" 
th’


605 
	`”rÜ
("argument #1‚ot‡‚umber.")

606 
’d


607 
nÙ
 
¡©us_codes
[
code
] 
th’


608 
	`”rÜ
(
¡ršg
.
	`fÜm©
("Inv®id HTTP stu codgiv’: %d", 
code
))

609 
’d


610 
£lf
.
¡©us_code
 = 
code


611 
’d


613 --- 
G‘
 
the
 
cu¼’t
 
¡©us
 
code
.

614 -- @ 
Stus
 
code
 
ªd
 
¡©us
 cod
mes§ge
 
£t
, 
n
.

615 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$g‘_¡©us_code
()

616  
£lf
.
¡©us_code
, 
¡©us_codes
[self.status_code]

617 
’d


619 --- 
G‘
 
giv’
 
key
 
äom
 
h—d”
 key 
v®ue
 
£ùiÚ
.

620 -- @
·¿m
 
	$key
 (
SŒšg
è
The
 
key
 
to
 
g‘
.

621 -- @
·¿m
 
	$ÿ£š£ns™ive
 (
BoŞ—n
è
If
 
Œue
 
th’
 
the
 
key
 
wl
 
be
 
m©ched
 
w™hout


622 -- 
»g¬d
 
£ns™iv™y
.

623 -- @ 
The
 
v®ue
 
of
 
the
 
key
, 
Ü
 
n
 
nÙ
 
exi¡šg
. 
May
  
a
 
bË
 

624 -- 
muÉË
 
keys
 
¬e
 
£t
.

625 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$g‘
(
key
, 
ÿ£š£ns™ive
)

626 
loÿl
 
v®ue


627 
loÿl
 
út
 = 0

628 
ÿ£š£ns™ive
 =ğ
Œue
 
th’


629 
key
 = key:
	$low”
()

630 
i
 = 1, #£lf.
_f›lds
 do

631 
£lf
.
_f›lds
[
i
] 
ªd
 s–f._f›lds[i][1]:
	`low”
(è=ğ
key
 
th’


632 
út
 =ğ0 
th’


633 
v®ue
 = 
£lf
.
_f›lds
[
i
][2]

634 
út
 = 1

635 
–£if
 
út
 =ğ1 
th’


636 
v®ue
 = {v®ue, 
£lf
.
_f›lds
[
i
][2]
	}
}

637 
út
 = 2

639 
v®ue
[#v®u+ 1] = 
£lf
.
_f›lds
[
i
][2]

640 
út
 = cnt + 1

641 
’d


642 
’d


643 
’d


645 
i
 = 1, #£lf.
_f›lds
 do

646 
	g£lf
.
	g_f›lds
[
i
] 
ªd
 s–f._f›lds[i][1] =ğ
key
 
th’


647 
út
 =ğ0 
th’


648 
v®ue
 = 
£lf
.
_f›lds
[
i
][2]

649 
út
 = 1

650 
–£if
 
út
 =ğ1 
th’


651 
v®ue
 = {v®ue, 
£lf
.
_f›lds
[
i
][2]}

652 
út
 = 2

654 
v®ue
[#v®u+ 1] = 
£lf
.
_f›lds
[
i
][2]

655 
út
 = cnt + 1

656 
’d


657 
’d


658 
’d


659 
’d


660  
v®ue
, 
út


661 
	g’d


663 --- 
Add
 
a
 
key
 
w™h
 
v®ue
 
to
 
the
 
	gh—d”s
. 
SuµÜts
 
addšg
 
muÉË
 
v®ues
 
	gto


664 -- 
Úe
 
	gkey
. 
	gE
.
g
 
	gmutË
 "S‘-Cook›" 
h—d”
 
	gf›lds
.

665 -- @
·¿m
 
	$key
 (
SŒšg
è
Key
 
to
 
add
Ø
h—d”s
. 
Mu¡
 
be
 
¡ršg
 
Ü
 
”rÜ
 
is
 
¿i£d
.

666 -- @
·¿m
 
	$v®ue
 (
SŒšg
 
Ü
 
Numb”
è
V®ue
 
to
 
assocŸ‹
 
w™h
 
the
 
key
.

667 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$add
(
key
, 
v®ue
)

668 
	`ty³
(
key
è~ğ"¡ršg" 
th’


669 
	`”rÜ
("Key…arameter must be‡ string.")

670 
’d


671 
loÿl
 
t
 = 
	$ty³
(
v®ue
)

672 
t
 =ğ"¡ršg" 
th’


673 
v®ue
:
	`fšd
("\r\n", 1, 
Œue
è
th’


674 
	`”rÜ
("String value contain <CR><LF>,‚ot‡llowed.")

675 
’d


676 
–£if
 
t
 ~ğ"numb”" 
th’


677 
	`”rÜ
("Value…arameter must be‡ string or‚umber.")

678 
’d


679 
£lf
.
_f›lds
[#£lf._f›ld + 1] = {
key
, 
v®ue
}

680 
’d


683 --- 
S‘
 
a
 
key
 
w™h
 
v®ue
 
to
 
the
 
h—d”s
. 
Ov”w™šg
 
exi¡šg
 key.

684 -- @
·¿m
 
	$key
 (
SŒšg
è
Key
 
to
 
£t
Ø
h—d”s
. 
Mu¡
 
be
 
¡ršg
 
Ü
 
”rÜ
 
is
 
¿i£d
.

685 -- @
·¿m
 
	$v®ue
 (
SŒšg
è
V®ue
 
to
 
assocŸ‹
 
w™h
 
the
 
key
.

686 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$£t
(
key
, 
v®ue
, 
ÿ£š£ns™ive
)

687 
	`ty³
(
key
è~ğ"¡ršg" 
th’


688 
	`”rÜ
("Key…arameter must be‡ string.")

689 
’d


690 
loÿl
 
t
 = 
	$ty³
(
v®ue
)

691 
t
 =ğ"¡ršg" 
th’


692 
v®ue
:
	`fšd
("\r\n", 1, 
Œue
è
th’


693 
	`”rÜ
("String value contain <CR><LF>,‚ot‡llowed.")

694 
’d


695 
–£if
 
t
 ~ğ"numb”" 
th’


696 
	`”rÜ
("Value…arameter must be‡ string or‚umber.")

697 
’d


698 
£lf
:
	$»move
(
key
, 
ÿ£š£ns™ive
)

699 
£lf
:
	$add
(
key
, 
v®ue
)

700 
’d


702 --- 
Remove
 
key
 
äom
 
h—d”s
.

703 -- @
·¿m
 
	$key
 (
SŒšg
è
Key
 
to
 
»move
 
äom
 
h—d”s
. 
Mu¡
 
be
 
¡ršg
 
Ü
 
”rÜ
 
is
 
¿i£d
.

704 -- @
·¿m
 
	$ÿ£š£ns™ive
 (
BoŞ—n
è
If
 
Œue
 
th’
 
the
 
key
 
wl
 
be
 
m©ched
 
w™hout


705 -- 
»g¬d
 
£ns™iv™y
.

706 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$»move
(
key
, 
ÿ£š£ns™ive
)

707 
	`ty³
(
key
è~ğ"¡ršg" 
th’


708 
	`”rÜ
("Key…arameter must be‡ string.")

709 
’d


710 
ÿ£š£ns™ive
 =ğ
çl£
 
th’


711 
i
 = 1, #£lf.
_f›lds
 do

712 
£lf
.
_f›lds
[
i
] 
ªd
 s–f._f›lds[i][1] =ğ
key
 
th’


713 
£lf
.
_f›lds
[
i
] = 
n


714 
’d


715 
’d


717 
key
 = key:
	$low”
()

718 
i
 = 1, #£lf.
_f›lds
 do

719 
£lf
.
_f›lds
[
i
] 
ªd
 s–f._f›lds[i][1]:
	`low”
(è=ğ
key
 
th’


720 
£lf
.
_f›lds
[
i
] = 
n


721 
’d


722 
’d


723 
’d


724 
’d


726 --- 
SŒšgify
 
d©a
 
£t
 
š
 
şass
 
as
 
a
 
HTTP
 
»que¡
 
h—d”
.

727 -- @ (
SŒšg
è
HTTP
 
h—d”
 
¡ršg
 
exşudšg
 
fš®
 
d–im™”
.

728 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$¡ršgify_as_»que¡
()

729 
loÿl
 
bufãr
 = bufãr:
	$Ãw
()

730 
i
 = 1, #£lf.
_f›lds
 do

731 
£lf
.
_f›lds
[
i
] 
th’


732 
bufãr
:
	`­³nd_lua¡r_right
(
¡ršg
.
	`fÜm©
("%s: %s\r\n",

733 
£lf
.
_f›lds
[
i
][1], self._fields[i][2]));

734 
’d


735 
’d


736  
¡ršg
.
	`fÜm©
("%s %s %s\r\n%s\r\n",

737 
£lf
.
m‘hod
,

738 
£lf
.
uri
,

739 
£lf
.
v”siÚ
,

740 
	$to¡ršg
(
bufãr
))

741 
’d


743 --- 
SŒšgify
 
d©a
 
£t
 
š
 
şass
 
as
 
a
 
HTTP
 
»¥Ú£
 
h—d”
.

744 -- 
If
 
nÙ
 "D©e" 
f›ld
 
is
 
£t
, 
™
 
wl
 
be
 
g’”©ed
 
autom©iÿÎy
.

745 -- @ (
SŒšg
è
HTTP
 
h—d”
 
¡ršg
 
exşudšg
 
fš®
 
d–im™”
.

746 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$¡ršgify_as_»¥Ú£
()

747 
loÿl
 
buf
 = 
bufãr
:
	$Ãw
()

748 
nÙ
 
£lf
:
	`g‘
("D©e"è
th’


749 -- 
Add
 
cu¼’t
 
time
 
as
 
D©e
 
h—d”
 
nÙ
 
£t
 
®»ady
.

750 
£lf
:
	`add
("D©e", 
ut
.
	`time_fÜm©_h‰p_h—d”
(ut.
	$g‘timeofday
()))

751 
’d


752 
i
 = 1 , #£lf.
_f›lds
 do

753 
£lf
.
_f›lds
[
i
] 
th’


754 -- 
¡ršg
.
fÜm©
 
ÿu£s
 
Œaû
 
abÜt
 
h”e
.

755 -- 
Ju¡
 
bud
 
keywÜd
 
v®ues
 
by
 
abu£
.

756 
buf
:
	$­³nd_lua¡r_right
(
£lf
.
_f›lds
[
i
][1])

757 
buf
:
	`­³nd_lua¡r_right
(": ")

758 
buf
:
	`­³nd_lua¡r_right
(
	$to¡ršg
(
£lf
.
_f›lds
[
i
][2]))

759 
buf
:
	`­³nd_lua¡r_right
("\r\n")

760 
’d


761 
’d


762  
¡ršg
.
	`fÜm©
("%s %d %s\r\n%s",

763 
£lf
.
v”siÚ
,

764 
£lf
.
¡©us_code
,

765 
¡©us_codes
[
£lf
.
¡©us_code
],

766 
	$to¡ršg
(
buf
))

767 
’d


769 --- 
CÚvš›nû
 
m‘hod
 
to
  
HTTPH—d”s
:
¡ršgify_as_»¥Ú£
 
Ú
 
¡ršg


770 -- 
cÚv”siÚ
.

771 
funùiÚ
 
h‰put
.
HTTPH—d”s
:
	$__to¡ršg
()

772  
£lf
:
	$¡ršgify_as_»¥Ú£
()

773 
’d


775  
h‰put


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/inotify.lua

1 --- 
	gTurbo
.
lua
 
šÙify
 
	gModuË


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

18 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

19 
loÿl
 
fs
 = 
»quœe
 "turbo.fs"

20 
loÿl
 
log
 = 
»quœe
 "turbo.log"

21 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

22 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

23 --
loÿl
 
sysÿÎ
 = 
»quœe
 "turbo.syscall"

25 
loÿl
 
šÙify
 = {}

27 -- 
šÙify
 
ÿÎ
 
is
 
avaabË
 
through
 
ffi
.
C
.šÙify 
vŸ
 
cdef
.
lua
.

29 --- 
SuµÜ‹d
 
ev’ts
 
su™abË
 
MASK
 
·¿m‘”
 
of
 
INOTIFY_ADD_WATCH
.

30 
šÙify
.
IN_ACCESS
 = 0x00000001 -- 
Fe
 
was
 
acûs£d
.

31 
šÙify
.
IN_MODIFY
 = 0x00000002 -- 
Fe
 
was
 
modif›d
.

32 
šÙify
.
IN_ATTRIB
 = 0x00000004 -- 
M‘ad©a
 
chªged
.

33 
šÙify
.
IN_CLOSE_WRITE
 = 0x00000008 -- 
Wr™bË
 
fe
 
was
 
şo£d
.

34 
šÙify
.
IN_CLOSE_NOWRITE
 = 0x00000010 -- 
Unwr™bË
 
fe
 
şo£d
.

35 
šÙify
.
IN_CLOSE
 = 
b™
.
bÜ
 (šÙify.
IN_CLOSE_WRITE
,

36 
šÙify
.
IN_CLOSE_NOWRITE
è-- 
	gClo£
.

37 
	gšÙify
.
	gIN_OPEN
 = 0x00000020 -- 
Fe
 
was
 
İ’ed
.

38 
šÙify
.
IN_MOVED_FROM
 = 0x00000040 -- 
Fe
 
was
 
moved
 
äom
 
X
.

39 
šÙify
.
IN_MOVED_TO
 = 0x00000080 -- 
Fe
 
was
 
moved
 
to
 
Y
.

40 
šÙify
.
IN_MOVE
 = 
b™
.
bÜ
 (šÙify.
IN_MOVED_FROM
,

41 
šÙify
.
IN_MOVED_TO
è-- 
	gMoves
.

42 
	gšÙify
.
	gIN_CREATE
 = 0x00000100 -- 
Subfe
 
was
 
ü—‹d
.

43 
šÙify
.
IN_DELETE
 = 0x00000200 -- 
Subfe
 
was
 
d–‘ed
.

44 
šÙify
.
IN_DELETE_SELF
 = 0x00000400 -- 
S–f
 
was
 
d–‘ed
.

45 
šÙify
.
IN_MOVE_SELF
 = 0x00000800 -- 
S–f
 
was
 
moved
.

47 --- 
The
 
fŞlowšg
 
b™s
 
may
 
be
 
£t
 
š
 
the
 
mask
 
f›ld
 
»tuºed
 
by
 
	$»ad
(2)

48 
šÙify
.
IN_IGNORED
 = 0x00008000 -- 
W©ch
 
was
 
»moved


50 --- 
Provide
 
humª
 
»adabË
 
”rÜ
 
desütiÚ
 
š
 
of
 
çu»


51 
loÿl
 
funùiÚ
 
	$check_”rÜ
(
»t
, 
·th
)

52 
»t
 =ğ-1 
th’


53 
loÿl
 
”n
 = 
ffi
.
	$”ºo
()

54 
loÿl
 
”r
 = 
ffi
.
	`¡ršg
(ffi.
C
.
	$¡»¼Ü
(
”n
))

55 
	`”rÜ
(
¡ršg
.
	`fÜm©
("% (%dèÚ %s", 
”r
, 
”n
, 
·th
))

56 
’d


57 
’d


59 --- 
C»©e
 
a
 
Ãw
 
šÙify
 
š¡ªû


60 
funùiÚ
 
šÙify
:
	$Ãw
()

61 
£lf
.
fd
 = 
ffi
.
C
.
	$šÙify_š™
()

62 
£lf
.
wd2Çme
 = {
	}
}

63 
£lf
.
fd
 =ğ-1 
th’


64 
”rÜ
(
ffi
.
¡ršg
(ffi.
C
.
¡»¼Ü
(ffi.
	$”ºo
())))

65 
’d


66  
£lf
.
fd


67 
’d


69 --- 
W©ch
 
Ú
 
a
 
giv’
 
fe


70 -- @
·¿m
 
fe_·th
 
mu¡
 
be
 
a
 
v®id
 
»Ïtive
 
·th
 
Ü
 
absŞu‹
…ath

71 -- @ 
Œue
 
w©ch
 
sucûssfuÎy
, 
çl£
 
Ùh”wi£


72 
funùiÚ
 
šÙify
:
	$w©ch_fe
(
fe_·th
)

73 
fs
.
	$is_fe
(
fe_·th
è
th’


74 
loÿl
 
wd
 = 
ffi
.
C
.
	$šÙify_add_w©ch
(
£lf
.
fd
, 
fe_·th
, s–f.
IN_MODIFY
)

75 
	$check_”rÜ
(
wd
, 
fe_·th
)

76 
£lf
.
wd2Çme
[
wd
] = 
fe_·th


77  
Œue


79  
çl£


80 
’d


81 
’d


83 --- 
W©ch
 
Ú
 
a
 
giv’
 
dœeùÜy
, 
nÙ
 
™s
 
sub
-
dœeùÜ›s


84 -- @
·¿m
 
dœ_·th
 
mu¡
 
be
 
a
 
v®id
 
»Ïtive
 
·th
 
Ü
 
absŞu‹
…ath

85 -- @ 
Œue
 
w©ch
 
sucûssfuÎy
, 
çl£
 
Ùh”wi£


86 
funùiÚ
 
šÙify
:
	$w©ch_dœ
(
dœ_·th
)

87 
fs
.
	$is_dœ
(
dœ_·th
è
th’


88 
loÿl
 
wd
 = 
ffi
.
C
.
	$šÙify_add_w©ch
(
£lf
.
fd
, 
dœ_·th
, s–f.
IN_MODIFY
)

89 
	$check_”rÜ
(
wd
, 
dœ_·th
)

90 
£lf
.
wd2Çme
[
wd
] = 
dœ_·th


91  
Œue


93  
çl£


94 
’d


95 
’d


97 --- 
W©ch
 
giv’
 
dœeùÜy
 
as
 
w–l
‡ 
®l
 
™s
 
sub
-
dœeùÜ›s
.

98 -- @
·¿m
 
·th
 
mu¡
 
be
 
a
 
v®id
 
»Ïtive
…©h 
Ü
 
absŞu‹
…ath

99 -- @
·¿m
 
ignÜe
 
ª
 
İtiÚ®
 
bË
 
of
 
dœeùÜ›s
 
to
 ignore

100 
funùiÚ
 
šÙify
:
	`w©ch_®l
(
·th
, 
ignÜe
)

101 -- 
Take
 
ÿ»
 
of
 
ignÜed
 
fes


102 
nÙ
 
ignÜe
 
Ü
‚Ù 
ut
.
	$is_š
(
·th
, 
ignÜe
è
th’


103 
fs
.
	$is_dœ
(
·th
è
th’


104 
loÿl
 
wd
 = 
ffi
.
C
.
	$šÙify_add_w©ch
(
£lf
.
fd
, 
·th
, s–f.
IN_MODIFY
)

105 
	$check_”rÜ
(
wd
, 
·th
)

106 
£lf
.
wd2Çme
[
wd
] = 
·th


107 
’d


108 
loÿl
 
ls
 = 
io
.
	`pİ’
('l "' .. 
·th
 .. '"')

109 
f’ame
 
š
 
ls
:
	$lšes
() do

110 
loÿl
 
fuÎ_·th
 = 
·th
 .. '/' .. 
f’ame


111 
·th
 =ğ'.' 
th’
 
fuÎ_·th
 = 
f’ame
 
’d
 -- 
·ss
 './'

112 
fs
.
	$is_dœ
(
fuÎ_·th
è
th’


113 
£lf
:
	$w©ch_®l
(
fuÎ_·th
, 
ignÜe
)

114 
’d


115 
’d


116 
ls
:
	$şo£
()

117 
’d


118 
’d


120 --- 
Remove
 
w©ch
 
´eviou¦y
 
added
 
usšg
 
w©ch_
* 
funùiÚs
.

121 -- @
·¿m
 
·th_Ü_wd
 
v®id
 
»Ïtive
 
·th
, 
absŞu‹
…©h 
Ü
 
	$wd
 (
w©ch
 
desütÜ
)

122 
funùiÚ
 
šÙify
:
	$w©ch_»move
(
·th_Ü_wd
)

123 
loÿl
 
typ
 = 
	$ty³
(
·th_Ü_wd
)

124 
typ
 =ğ'numb”' 
th’


125 
ffi
.
C
.
	$šÙify_rm_w©ch
(
£lf
.
fd
, 
·th_Ü_wd
)

126 
£lf
.
wd2Çme
[
·th_Ü_wd
] = 
n


127 
–£if
 
typ
 =ğ'¡ršg' 
th’


128 
wd
, 
Çme
 
š
 
	$·œs
(
£lf
.
wd2Çme
) do

129 
Çme
 =ğ
·th_Ü_wd
 
th’


130 
ffi
.
C
.
	$šÙify_rm_w©ch
(
£lf
.
fd
, 
wd
)

131 
£lf
.
wd2Çme
[
wd
] = 
n


132 
’d


133 
’d


134 
’d


135 
’d


137 --- 
This
 
h–³r
 
funùiÚ
 
should
 
add
 
·th
 
to
 
w©ch
 
li¡
 
agaš
 
š
 
k”Ãl


138 -- 
¡¬ts
 
ignÜšg
 
™
.

139 -- @
·¿m
 
ev’t
 
šÙify_ev’t
*

140 -- @
·¿m
 
·th
 
mu¡
 
be
 
a
 
v®id
 
»Ïtive
…©h 
Ü
 
absŞu‹
…ath

141 
funùiÚ
 
šÙify
:
	$»w©ch_if_ignÜed
(
ev’t
, 
·th
)

142 
b™
.
	`bªd
(
ev’t
.
mask
, 
šÙify
.
IN_IGNORED
è=ğšÙify.IN_IGNORED 
th’


143 
šÙify
:
	$w©ch_»move
(
ev’t
.
wd
)

144 
šÙify
:
	$w©ch_fe
(
·th
)

145 
’d


146 
’d


148 --- 
R‘uº
 
fe
 
Çme
 
äom
 
cÜ»¥Údšg
 f
desütÜ
, 

149 -- 
cu¼’y
 
w©ched
 
fe


150 -- @
·¿m
 
wd
 
fe
 
desütÜ


151 
funùiÚ
 
šÙify
:
	$g‘_w©ched_fe
(
wd
)

152  
£lf
.
wd2Çme
[
wd
]

153 
’d


155 --- 
R‘uº
 
®l
 
fe
 
Çmes
 
of
 
cu¼’y
 
w©ched
 
fes


156 
funùiÚ
 
šÙify
:
	$g‘_w©ched_fes
()

157  
£lf
.
wd2Çme


158 
’d


160 --- 
Clo£
 
šÙify


161 
funùiÚ
 
šÙify
:
	$şo£
()

162 
ffi
.
C
.
	$şo£
(
£lf
.
fd
)

163 
’d


165  
šÙify


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/ioloop.lua

1 --- 
	gTurbo
.
lua
 
	gI
/
O
 
Loİ
 
	gmoduË


2 -- 
SšgË
 
th»aded
 
	gI
/
O
 
ev’t
 
loİ
 
	gim¶em’tiÚ
. 
The
 
moduË
 
hªdËs
 
	gsock‘


3 -- 
ev’ts
 
ªd
 
timeouts
‡nd 
scheduËd
 
š‹rv®s
 
w™h
 
mli£cÚd
 
	g´ecisiÚ
.

5 -- 
SuµÜts
 
the
 
fŞlowšg
 
	gim¶em’tiÚs
:

6 -- * 
•Şl


7 -- 
The
 
IOLoİ
 
şass
 
is
 
wr™‹n
 
š
 
such
 
a
 
way
 
th©
 
addšg
 
Ãw
 
pŞl


8 -- 
im¶em’tiÚs
 
is
 
—sy
.

10 -- 
Cİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


12 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

13 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

14 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


16 -- 
	gh‰p
:

18 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


19 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

20 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

21 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


22 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

24 
loÿl
 
	glog
 = 
»quœe
 "turbo.log"

25 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

26 
loÿl
 
sigÇl
 = 
»quœe
 "turbo.signal"

27 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

28 
loÿl
 
coùx
 = 
»quœe
 "turbo.coctx"

29 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

30 
loÿl
 
ffi
 = 
»quœe
 "ffi"

31 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

32 
»quœe
 "turbo.3rdparty.middleclass"

34 
loÿl
 
uÅack
 = 
ut
.
fuÅack


35 
loÿl
 
iŞoİ
 = {} -- iŞoİ 
Çme¥aû


37 
loÿl
 
•Şl_ffi
, 
	g_pŞl_im¶em’tiÚ


38 -- 
BackŒaû
 
	gfÜm©‹rs
.

39 
loÿl
 
	g_¡r_bÜd”s_down
 = 
¡ršg
.
»p
("â–¼", 80)

40 
loÿl
 
	g_¡r_bÜd”s_up
 = 
¡ršg
.
»p
("â–²", 80)

42 
	g¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
	g_G
.
__TURBO_USE_LUASOCKET__
 
	gth’


43 -- 
EpŞl
 
FFI
 
moduË
 
found
 
ªd
 
	glßded
.

44 
	g_pŞl_im¶em’tiÚ
 = "epoll_ffi"

45 
•Şl_ffi
 = 
»quœe
 "turbo.epoll_ffi"

46 
iŞoİ
.
READ
 = 
•Şl_ffi
.
EPOLL_EVENTS
.
EPOLLIN


47 
iŞoİ
.
WRITE
 = 
•Şl_ffi
.
EPOLL_EVENTS
.
EPOLLOUT


48 
iŞoİ
.
PRI
 = 
•Şl_ffi
.
EPOLL_EVENTS
.
EPOLLPRI


49 
iŞoİ
.
ERROR
 = 
b™
.
	$bÜ
(
•Şl_ffi
.
EPOLL_EVENTS
.
EPOLLERR
,

50 
•Şl_ffi
.
EPOLL_EVENTS
.
EPOLLHUP
)

51 
–£if
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


52 -- 
Lßd
 
luasock‘
 
as
 
a
 
İtiÚ
.

53 
luasock‘
 = 
»quœe
 "socket"

54 
_pŞl_im¶em’tiÚ
 = "luasocket"

55 
iŞoİ
.
READ
 = 0x001

56 
iŞoİ
.
WRITE
 = 0x004

57 
iŞoİ
.
ERROR
 = 
b™
.
	$bÜ
(0x008, 0x0010)

58 
’d


60 --- 
C»©e
 
Ü
 
g‘
 
the
 
glob®
 
IOLoİ
 
š¡ªû
.

61 -- 
MuÉË
 
ÿÎs
 
to
 
this
 
funùiÚ
 
»tuºs
 
the
 
§me
 
IOLoİ
.

62 -- @ 
IOLoİ
 
şass
 
š¡ªû
.

63 
funùiÚ
 
iŞoİ
.
	$š¡ªû
(
func
)

64 
loÿl
 
iŞ


65 
_G
.
io_loİ_š¡ªû
 
th’


66 
iŞ
 = 
_G
.
io_loİ_š¡ªû


68 
iŞ
 = 
iŞoİ
.
	$IOLoİ
()

69 
_G
.
io_loİ_š¡ªû
 = 
iŞ


70 
’d


71 
func
 
th’


72 
iŞ
:
	$add_ÿÎback
(
func
, 
iŞ
)

73 
’d


74  
iŞ


75 
’d


77 --- 
IOLoİ
 
is
 
a
 
Ëv–
 
Œigg”ed
 
I
/
O
 
loİ
, 
w™h
 
add™iÚ®
 
suµÜt
 
timeout


78 -- 
ªd
 
time
 
š‹rv®
 
ÿÎbacks
.

79 -- 
H—vy
 
šæu’ûd
 
by
 
iŞoİ
.
py
 
š
 
the
 
TÜÇdo
 
web
 
äamewÜk
.

80 -- @
nÙe
 
OÆy
 
Úe
 
š¡ªû
 
of
 
IOLoİ
 
ÿn
 
ev”
 
run
 
©
 
the
 
§me
 
time
!

81 
iŞoİ
.
IOLoİ
 = 
	`şass
('IOLoop')

83 --- 
C»©e
 
a
 
Ãw
 
IOLoİ
 
şass
 
š¡ªû
.

84 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$š™Ÿlize
()

85 
£lf
.
_co_cbs
 = {
	}
}

86 
£lf
.
_co_ùxs
 = {}

87 
£lf
.
_hªdËrs
 = {}

88 
£lf
.
_timeouts
 = {}

89 
£lf
.
_š‹rv®s
 = {}

90 
£lf
.
_ÿÎbacks
 = {}

91 
£lf
.
_sigÇlfds
 = {}

92 
£lf
.
_timeouts_sz
 = 0

93 
£lf
.
_š‹rv®s_sz
 = 0

94 
£lf
.
_ruÂšg
 = 
çl£


95 
£lf
.
_¡İ³d
 = 
çl£


96 -- 
S‘
 
the
 
mo¡
 
f™tšg
 
pŞl
 
im¶em’tiÚ
. 
The
 
API
's‡re‡ll unified.

97 
_pŞl_im¶em’tiÚ
 =ğ"•Şl_ffi" 
th’


98 
£lf
.
_pŞl
 = 
	$_EPŞl_FFI
()

99 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGPIPE
, sigÇl.
SIG_IGN
)

100 
–£if
 
_pŞl_im¶em’tiÚ
 =ğ"luasock‘" 
th’


101 
£lf
.
_pŞl
 = 
	`_LuaSock‘PŞl
()

102 -- dØ
nÙhšg


103 
’d


104 
’d


106 --- 
Add
 
hªdËr
 
funùiÚ
 
giv’
 
ev’t
 
mask
 
Ú
 
fd
.

107 -- @
·¿m
 
	$fd
 (
Numb”
è
Fe
 
desütÜ
 
to
 
bšd
 
hªdËr
 .

108 -- @
·¿m
 
	$ev’ts
 (
Numb”
è
Ev’ts
 
b™
 
mask
. 
Defšed
 
š
 
iŞoİ
 
Çme¥aû
. 
E
.
g


109 -- 
iŞoİ
.
READ
 
ªd
 iŞoİ.
WRITE
. 
MuÉË
 
b™s
 
ÿn
 
be
 
AND
'edogether.

110 -- @
·¿m
 
	$hªdËr
 (
FunùiÚ
è
HªdËr
 
funùiÚ
.

111 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
funùiÚ
 
hªdËr
. 
HªdËr
 
is
 
ÿÎed
 
w™h


112 -- 
this
 
as
 
fœ¡
 
¬gum’t
 
£t
.

113 -- @ (
BoŞ—n
è
Œue
 
sucûssfuÎ
 
çl£
.

114 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$add_hªdËr
(
fd
, 
ev’ts
, 
hªdËr
, 
¬g
)

115 
loÿl
 
rc
, 
”ºo
 = 
£lf
.
_pŞl
:(
fd
, 
b™
.
	$bÜ
(
ev’ts
, 
iŞoİ
.
ERROR
))

116 
rc
 ~ğ0 
th’


117 
log
.
	`nÙiû
(

118 
¡ršg
.
	`fÜm©
(

120 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

121  
çl£


122 
’d


123 
£lf
.
_hªdËrs
[
fd
] = {
hªdËr
, 
¬g
}

124  
Œue


125 
’d


127 --- 
Upd©e
 
exi¡šg
 
hªdËr
 
funùiÚ
'sriggerƒvents.

128 -- @
·¿m
 
	$fd
 (
Numb”
è
Fe
 
desütÜ
 
to
 
upd©e
 
ev’ts
 .

129 -- @
·¿m
 
	$ev’ts
 (
Numb”
è
Ev’ts
 
b™
 
mask
. 
Defšed
 
š
 
iŞoİ
 
Çme¥aû
. 
E
.
g


130 -- 
iŞoİ
.
READ
 
ªd
 iŞoİ.
WRITE
. 
MuÉË
 
b™s
 
ÿn
 
be
 
AND
'edogether.

131 -- @ (
BoŞ—n
è
Œue
 
sucûssfuÎ
 
çl£
.

132 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$upd©e_hªdËr
(
fd
, 
ev’ts
)

133 
loÿl
 
rc
, 
”ºo
 = 
£lf
.
_pŞl
:
	`modify
(
fd
, 
b™
.
	$bÜ
(
ev’ts
, 
iŞoİ
.
ERROR
))

134 
rc
 ~ğ0 
th’


135 
log
.
	`nÙiû
(

136 
¡ršg
.
	`fÜm©
(

138 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

139  
çl£


140 
’d


141  
Œue


142 
’d


144 --- 
Remove
 
a
 
exi¡šg
 
hªdËr
 
äom
 
the
 
IO
 
Loİ
.

145 -- @
·¿m
 
	$fd
 (
Numb”
è
Fe
 
desütÜ
 
to
 
»move
 
hªdËr
 
äom
.

146 -- @ (
BoŞ—n
è
Œue
 
sucûssfuÎ
 
çl£
.

147 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$»move_hªdËr
(
fd
)

148 
nÙ
 
£lf
.
_hªdËrs
[
fd
] 
th’


150 
’d


151 
loÿl
 
rc
, 
”ºo
 = 
£lf
.
_pŞl
:
	$uÄegi¡”
(
fd
)

152 
rc
 ~ğ0 
th’


153 
log
.
	`nÙiû
(

154 
¡ršg
.
	`fÜm©
(

156 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

157  
çl£


158 
’d


159 
£lf
.
_hªdËrs
[
fd
] = 
n


160  
Œue


161 
’d


163 --- 
Check
 
IOLoİ
 
is
 
cu¼’y
 
š
 
a
 
ruÂšg
 
¡©e
.

164 -- @ (
BoŞ—n
è
Œue
 
Ü
 
çl£
.

165 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$ruÂšg
(è 
£lf
.
_ruÂšg
 
’d


167 --- 
Add
 
a
 
ÿÎback
 
to
 
be
 
run
 
Ú
 
Ãxt
 
™”©iÚ
 
of
 
the
 
IOLoİ
.

168 -- @
·¿m
 
	`ÿÎback
 (
FunùiÚ
)

169 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
to
 
ÿÎ
 
ÿÎback
 
w™h
 
as
 
fœ¡
‡rgument.

170 -- @ (
IOLoİ
 
şass
è
R‘uº
 
£lf
 
cÚvš›nû
.

171 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$add_ÿÎback
(
ÿÎback
, 
¬g
)

172 
£lf
.
_ÿÎbacks
[#£lf._ÿÎback + 1] = {
ÿÎback
, 
¬g
}

173  
£lf


174 
’d


176 --- 
Fš®ize
 
a
 
cÜoutše
 
cÚ‹xt
.

177 -- @
·¿m
 
coùx
 
A
 
Cou¹šeCÚ‹xt
 
š¡ªû
.

178 -- @ 
True
 
susûssfuÎ
 
çl£
.

179 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$fš®ize_cÜoutše_cÚ‹xt
(
coùx
)

180 
loÿl
 
cÜoutše
 = 
£lf
.
_co_ùxs
[
coùx
]

181 
nÙ
 
cÜoutše
 
th’


182 
log
.
	`w¬nšg
("[ioloop.lua] Tryingo finalize‡ coroutine context \
here‡re‚o„eferenceo.")

184  
çl£


185 
’d


186 
£lf
.
_co_ùxs
[
coùx
] = 
n


187 
£lf
:
	`_»sume_cÜoutše
(
cÜoutše
, 
coùx
:
	$g‘_cÜoutše_¬gum’ts
())

188  
Œue


189 
’d


191 --- 
Add
 
a
 
timeout
 
w™h
 
funùiÚ
 
to
 
be
 
ÿÎed
 
š
 
futu»
.

192 -- @
·¿m
 
	$time¡amp
 (
Numb”
è
Time¡amp
 
wh’
 
to
 
ÿÎ
 
funùiÚ
. 
Ba£d
 
Ú


193 -- 
Unix
 
CLOCK_MONOTONIC
 
time
 
š
 
mli£cÚds
 
´ecisiÚ
.

194 -- 
E
.
g
 
ut
.
g‘timemÚÙÚic
 + 3000 
wl
 
timeout
 
š
 3 
£cÚds
.

195 -- @
·¿m
 
	`func
 (
FunùiÚ
)

196 -- @
·¿m
 
O±iÚ®
 
¬gum’t
 
func
.

197 -- @ (
Numb”
è
Reã»nû
 
to
 
timeout
.

198 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$add_timeout
(
time¡amp
, 
func
, 
¬g
)

199 
loÿl
 
i
 = 1

201 
£lf
.
_timeouts
[
i
] ~ğ
n
 do

202 -- 
Fšd
 
hŞe
 
š
 
Lua
 
bË
...

203 
i
 = i + 1

204 
’d


205 
£lf
.
_timeouts_sz
 = self._timeouts_sz + 1

206 
£lf
.
_timeouts
[
i
] = 
	$_Timeout
(
time¡amp
, 
func
, 
¬g
)

207  
i


208 
’d


210 --- 
Remove
 
timeout
.

211 -- @
·¿m
 
	$»f
 (
Numb”
è
The
 
»ã»nû
 
»tuºed
 
by
 
IOLoİ
:
add_timeout
.

212 -- @ (
BoŞ—n
è
True
 
Ú
 
sucûss
, 
çl£
.

213 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$»move_timeout
(
»f
)

214 
£lf
.
_timeouts
[
»f
] 
th’


215 
£lf
.
_timeouts
[
»f
] = 
n


216 
£lf
.
_timeouts_sz
 = self._timeouts_sz - 1

217  
Œue


219  
çl£


220 
’d


221 
’d


223 --- 
S‘
 
funùiÚ
 
to
 
be
 
ÿÎed
 
Ú
 
giv’
 
š‹rv®
.

224 -- @
·¿m
 
	$m£c
 (
Numb”
è
C®l
 
func
 
ev”y
 
m£c
.

225 -- @
·¿m
 
	`func
 (
FunùiÚ
)

226 -- @
·¿m
 
O±iÚ®
 
¬gum’t
 
func
.

227 -- @ (
Numb”
è
Reã»nû
 
to
 
š‹rv®
.

228 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$£t_š‹rv®
(
m£c
, 
func
, 
¬g
)

229 
loÿl
 
i
 = 1

231 
£lf
.
_š‹rv®s
[
i
] ~ğ
n
 do

232 -- 
Fšd
 
hŞe
 
š
 
Lua
 
bË
...

233 
i
 = i + 1

234 
’d


235 
£lf
.
_š‹rv®s
[
i
] = 
	$_IÁ”v®
(
m£c
, 
func
, 
¬g
)

236 
£lf
.
_š‹rv®s_sz
 = self._intervals_sz + 1

237  
i


238 
’d


240 --- 
CË¬
 
š‹rv®
.

241 -- @
·¿m
 
	$»f
 (
Numb”
è
The
 
»ã»nû
 
»tuºed
 
by
 
IOLoİ
:
£t_š‹rv®
.

242 -- @ (
BoŞ—n
è
True
 
Ú
 
sucûss
, 
çl£
.

243 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$ş—r_š‹rv®
(
»f
)

244 
£lf
.
_š‹rv®s
[
»f
] 
th’


245 
£lf
.
_š‹rv®s
[
»f
] = 
n


246 
£lf
.
_š‹rv®s_sz
 = self._intervals_sz - 1

247  
Œue


249  
çl£


250 
’d


251 
’d


253 -- 
HªdË
 
ev’t
 
Ú
 
a
 
sigÇlfd
.

254 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$_hªdË_sigÇlfd_ev’t
(
fd
, 
ev’ts
)

255 
loÿl
 
sigfdsi
 = 
ffi
.
	`Ãw
("struct signalfd_siginfo[1]")

256 
loÿl
 
sigfdsi_size
 = 
ffi
.("struct signalfd_siginfo")

257 
ffi
.
	$fl
(
sigfdsi
, 
sigfdsi_size
)

258 
loÿl
 
r
 = 
ffi
.
C
.
	$»ad
(
fd
, 
sigfdsi
, 
sigfdsi_size
)

259 
r
 ~ğ
sigfdsi_size
 
th’


260 
log
.
	`nÙiû
(
¡ršg
.
	`fÜm©
(

262 
sock‘
.
	`¡»¼Ü
(
ffi
.
	$”ºo
())))

264 
’d


265 
loÿl
 
fdsi
 = 
sigfdsi
[0]

266 
loÿl
 
sigšfo
 = {

267 
signo
=
fdsi
.
ssi_signo
, -- 
SigÇl
 
numb”


268 
”ºo
=
fdsi
.
ssi_”ºo
, -- 
E¼Ü
 
	`numb”
 (
cu¼’y
 
unu£d
)

269 
code
=
fdsi
.
ssi_code
, -- 
SigÇl
 code

270 
pid
=
fdsi
.
ssi_pid
, --…id 
of
 
£nd”


271 
uid
=
fdsi
.
ssi_uid
, -- uid 
of
 
£nd”


272 
fd
=
fdsi
.
ssi_fd
, -- 
Fe
 
	`desütÜ
 (
SIGIO
)

273 
tid
=
fdsi
.
ssi_tid
, -- 
K”Ãl
 
tim”
 
	`ID
 (
POSIX
 
tim”s
)

274 
bªd
=
fdsi
.
ssi_bªd
, -- 
Bªd
 
	`ev’t
 (
SIGIO
)

275 
ov”run
=
fdsi
.
ssi_ov”run
, -- 
POSIX
 
time
 ov”ruÀ
couÁ


276 
Œ­no
=
fdsi
.
ssi_Œ­no
, -- 
T¿p
 
numb”
 
th©
 
ÿu£d
 
sigÇl


277 
¡©us
=
fdsi
.
ssi_¡©us
, -- 
Ex™
 stu 
Ü
 
	`sigÇl
 (
SIGCHLD
)

278 =
fdsi
.
ssi_št
, -- 
IÁeg”
 
£Á
 
by
 
	`sigqueue
(3)

279 
±r
=
fdsi
.
ssi_±r
, -- 
Poš‹r
 
£Á
 
by
 
	`sigqueue
(3)

280 
utime
=
fdsi
.
ssi_utime
, -- 
U£r
 
CPU
 
time
 
	`cÚsumed
 (
SIGCHLD
)

281 
¡ime
=
fdsi
.
ssi_¡ime
, -- 
Sy¡em
 
CPU
 
time
 
	`cÚsumed
 (
SIGCHLD
)

282 
addr
=
fdsi
.
ssi_addr
 -- 
Add»ss
 
th©
 
g’”©ed
 
sigÇl


283 -- (
h¬dw¬e
 
sigÇls
)

284 
	}
}

285 
loÿl
 
	gsigno
, 
	ghªdËr
, 
	g¬g
 = 
	$uÅack
(
£lf
.
_sigÇlfds
[
fd
])

286 
¬g
 
th’


287 
	$hªdËr
(
¬g
, 
sigšfo
.
signo
, sigšfo, 
fd
)

289 
	$hªdËr
(
sigšfo
.
signo
, sigšfo, 
fd
)

290 
’d


291 
’d


293 --- 
Add
 
sigÇl
 
hªdËr
.

294 -- @
·¿m
 
	$signos
 (
Numb”
è
the
 
sigÇl
 
	$numb”
(
s
è
to
 
hªdË


295 -- @
·¿m
 
	$hªdËr
 (
FunùiÚ
è
HªdËr
 
funùiÚ
.

296 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
hªdËr
. 
HªdËr
 
is
 
ÿÎed
 
w™h


297 -- 
this
 
as
 
fœ¡
 
¬gum’t
 
£t
.

298 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$add_sigÇl_hªdËr
(
signo
, 
hªdËr
, 
¬g
)

299 
	`as£¹
(
signo
 ~ğ
sigÇl
.
SIGPIPE
,

301 
loÿl
 
mask
 = 
ffi
.
	`Ãw
("sigset_t[1]")

302 
ffi
.
C
.
	$sigem±y£t
(
mask
)

303 
ffi
.
C
.
	$sigadd£t
(
mask
, 
signo
)

304 
ffi
.
C
.
	$sig´ocmask
(
sigÇl
.
SIG_BLOCK
, 
mask
, 
n
)

305 
loÿl
 
sfd
 = 
ffi
.
C
.
	`sigÇlfd
(-1, 
mask
, 0)

306 
sfd
 =ğ-1 
th’


307 
log
.
	`nÙiû
(
¡ršg
.
	`fÜm©
(

309 
sock‘
.
	`¡»¼Ü
(
ffi
.
	$”ºo
())))

310  
çl£


311 
’d


312 
loÿl
 
r
 = 
£lf
:
	$add_hªdËr
(
sfd
, 
iŞoİ
.
READ
,

313 
£lf
.
_hªdË_sigÇlfd_ev’t
, self)

314 
nÙ
 
r
 
th’


315 
log
.
	`nÙiû
("[ioloop.lua]‡dd_handler() in‡dd_signal_handler() failed.")

316  
çl£


317 
’d


318 
£lf
:
	`»move_sigÇl_hªdËr
(
signo
è-- 
»move
 
š
 
we
 
®»ady
 
have
 
Úe
.

319 
£lf
.
_sigÇlfds
[
sfd
] = {
signo
, 
hªdËr
, 
¬g
}

320 
’d


322 --- 
Remove
 
sigÇl
 
hªdËr
.

323 -- @
·¿m
 
	$signo
 (
Numb”
è
the
 
sigÇl
 
numb”
 
to
 
»move
 
hªdËr
 .

324 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$»move_sigÇl_hªdËr
(
signo
)

325 
k
, 
v
 
š
 
	$·œs
(
£lf
.
_sigÇlfds
) do

326 
v
 
th’


327 
v
[1] =ğ
signo
 
th’


328 
£lf
.
_sigÇlfds
[
k
] = 
n


329 
£lf
:
	$»move_hªdËr
(
k
)

331 
’d


332 
’d


333 
’d


334 
’d


336 --- 
S¹
 
the
 
I
/
O
 
Loİ
.

337 -- 
The
 
loİ
 
wl
  
ruÂšg
 
uÁ
 
IOLoİ
.
şo£
 
is
 
ÿÎed
 
vŸ
 
a
 
ÿÎback


338 -- 
added
.

339 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$¡¬t
()

340 
£lf
.
_ruÂšg
 = 
Œue


341 
Œue
 do

342 
loÿl
 
pŞl_timeout
 = 3600

343 
loÿl
 
co_cbs_sz
 = #£lf.
_co_cbs


344 
co_cbs_sz
 > 0 
th’


345 
loÿl
 
co_cbs
 = 
£lf
.
_co_cbs


346 
£lf
.
_co_cbs
 = {
	}
}

347 
i
 = 1, 
co_cbs_sz
 do

348 
	gco_cbs
[
i
] ~ğ
n
 
th’


349 -- 
co_cbs
[
i
][1] = 
cÜoutše
 (
Lua
 
th»ad
).

350 -- 
co_cbs
[
i
][2] = 
y›lded
 
funùiÚ
.

351 
£lf
:
_»sume_cÜoutše
(

352 
co_cbs
[
i
][1],

353 
co_cbs
[
i
][2]è~ğ0 
th’


354 -- 
Resumed
 
courÙše
 
y›lded
. 
Adju¡
 
timeout
.

355 
pŞl_timeout
 = 0

356 
’d


357 
’d


358 
’d


359 
’d


360 
loÿl
 
ÿÎbacks
 = 
£lf
.
_ÿÎbacks


361 
£lf
.
_ÿÎbacks
 = {}

362 
i
 = 1, #callbacks, 1 do

363 
	g£lf
:
_run_ÿÎback
(
ÿÎbacks
[
i
]è~ğ0 
th’


364 -- 
FunùiÚ
 
y›lded
 
ªd
 
has
 
b“n
 
scheduËd
 
Ãxt
 
™”©iÚ
.

365 -- 
Drİ
 
timeout
.

366 
pŞl_timeout
 = 0

367 
’d


368 
’d


369 
loÿl
 
timeout_sz
 = 
£lf
.
_timeouts_sz


370 
timeout_sz
 ~ğ0 
th’


371 
loÿl
 
cu¼’t_time
 = 
ut
.
	$g‘timemÚÙÚic
()

372 
loÿl
 
timeouts_run
 = 0

373 
loÿl
 
i
 = 0

374 
timeouts_run
 ~ğ
timeout_sz
 do

375 
£lf
.
_timeouts
[
i
] ~ğ
n
 
th’


376 
timeouts_run
 =imeouts_run + 1

377 
loÿl
 
time_uÁ_timeout
 =

378 
£lf
.
_timeouts
[
i
]:
	$timed_out
(
cu¼’t_time
)

379 
time_uÁ_timeout
 =ğ0 
th’


380 
£lf
:
	`_run_ÿÎback
({£lf.
_timeouts
[
i
]:
	`ÿÎback
()
	}
})

381 
£lf
.
_timeouts
[
i
] = 
n


382 
£lf
.
_timeouts_sz
 = self._timeouts_sz - 1

383 -- 
FunùiÚ
 
may
 
have
 
scheduËd
 
wÜk
 
Ãxt
 
™”©iÚ


384 -- 
mu¡
 
Drİ
 
timeout
, 
w™hout
 
	gthis
, 
y›ldšg
 
äom
 
a
 
	g»que¡


385 -- 
hªdËr
 
th©
 
adds
 
a
 
timeout
 
couroutše
 
sk
 
wl
 
nÙ
 
	gwake


386 -- 
up
 
the
 
»que¡
 
hªdËr
 
©
h
’d
 
of
h
timeout
 
uÁ
 
	gthe


387 -- 
Ãxt
 
pŞl_timeout
 
occurs
 
which
 
may
 
be
 
as
 a 
the
 

388 -- 
timeout
 
	gof
 3.6 
	g£cÚds
.

389 
	gpŞl_timeout
 = 0

391 
pŞl_timeout
 > 
time_uÁ_timeout
 
th’


392 
pŞl_timeout
 = 
time_uÁ_timeout


393 
’d


394 
’d


395 
’d


396 
i
 = i + 1

397 
’d


398 
’d


399 
loÿl
 
š‹rv®s_sz
 = 
£lf
.
_š‹rv®s_sz


400 
š‹rv®s_sz
 ~ğ0 
th’


401 
loÿl
 
time_now
 = 
ut
.
	$g‘timemÚÙÚic
()

402 
loÿl
 
š‹rv®s_run
 = 0

403 
loÿl
 
i
 = 0

404 
š‹rv®s_run
 ~ğ
š‹rv®s_sz
 do

405 
loÿl
 
š‹rv®
 = 
£lf
.
_š‹rv®s
[
i
]

406 
š‹rv®
 ~ğ
n
 
th’


407 
š‹rv®s_run
 = intervals_run + 1

408 
loÿl
 
timed_out
 = 
š‹rv®
:
	$timed_out
(
time_now
)

409 
timed_out
 =ğ0 
th’


410 
£lf
:
	`_run_ÿÎback
({

411 
š‹rv®
.
ÿÎback
,

412 
š‹rv®
.
¬g


413 
	}
})

414 -- 
G‘
 
cu¼’t
 
time
 
to
 
´Ùeù
 
agaš¡
 
budšg


415 -- 
dimšishšg
 
š‹rv®
 
time
 
Ú
 
h—vy
 
funùiÚs
.

416 -- 
It
 
is
 
deb©abË
 
w‘h”
 
this
 
ã©u»
 i 
wª‹d
 
Ü
 
nÙ
.

417 
time_now
 = 
ut
.
	$g‘timemÚÙÚic
()

418 
loÿl
 
Ãxt_ÿÎ
 = 
š‹rv®
:
	$£t_Ï¡_ÿÎ
(

419 
time_now
)

420 
Ãxt_ÿÎ
 < 
pŞl_timeout
 
th’


421 
pŞl_timeout
 = 
Ãxt_ÿÎ


422 
’d


424 
timed_out
 < 
pŞl_timeout
 
th’


425 -- 
Adju¡
 
timeout
 
to
 
nÙ
 
miss
 
time
 
out
.

426 
pŞl_timeout
 = 
timed_out


427 
’d


428 
’d


429 
’d


430 
i
 = i + 1

431 
’d


432 
’d


433 
£lf
.
_¡İ³d
 =ğ
Œue
 
th’


434 
£lf
.
_ruÂšg
 = 
çl£


435 
£lf
.
_¡İ³d
 = 
çl£


437 
’d


438 #£lf.
_ÿÎbacks
 > 0 
th’


439 -- 
New
 
ÿÎback
 
has
 
b“n
 
scheduËd
 
Ãxt
 
™”©iÚ
. 
Drİ


440 -- 
timeout
.

441 
pŞl_timeout
 = 0

442 
’d


443 
£lf
:
	$_ev’t_pŞl
(
pŞl_timeout
)

444 
’d


445 
’d


447 
_pŞl_im¶em’tiÚ
 =ğ"•Şl_ffi" 
th’


448 -- 
Lšux
 
v”siÚ
.

449 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$_ev’t_pŞl
(
pŞl_timeout
)

450 
loÿl
 
rc
, 
num
, 
ev’ts
 = 
£lf
.
_pŞl
:
	$pŞl
(
pŞl_timeout
)

451 
rc
 =ğ0 
th’


452 
num
 =‚um - 1 -- 
Ba£
 0 
loİ


453 
i
 = 0, 
num
 do

454 
£lf
:
	$_run_hªdËr
(
ev’ts
[
i
].
d©a
.
fd
,ƒvents[i].events)

455 
’d


456 
–£if
 
rc
 =ğ-1 
th’


457 
log
.
	`nÙiû
(
¡ršg
.
	`fÜm©
("[ioloop.lua]…oll()„eturnedƒrrno %d",

458 
ffi
.
	$”ºo
()))

459 
’d


460 
’d


461 
–£if
 
_pŞl_im¶em’tiÚ
 =ğ"luasock‘" 
th’


462 -- 
Ev”yÚe
 
v”siÚ
, 
ba£d
 
Ú
 
LuaSock‘
 
which
 
ev”yÚe
 
has
.

463 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$_ev’t_pŞl
(
pŞl_timeout
)

464 
loÿl
 
»cvt
, 
£ndt
, 
”r
 = 
£lf
.
_pŞl
:
	`pŞl
(
pŞl_timeout
/1000)

465 
”r
 
ªd
ƒ¼ ~ğ"timeout" 
th’


466 
log
.
	`”rÜ
("[iŞoİ.lua] LuaSock‘ s–eù(è»tuºed: " .. 
”r
)

467 
’d


468 
_
, 
r
 
š
 
	$aœs
(
»cvt
) do

469 
loÿl
 
hªdËr_run
 = 
çl£


470 
i
=1, #sendt, 1 do

471 -- 
Run
 
through
 
£nd
 
bË
 
too
 
so
 
th©
 
we
 
combše
 
muÉË


472 -- 
ev’ts
 
što
 
š¡—d
 
of
 
ruÂšg
 
hªdËr
 
muÉË
 
times
.

473 
s
 = 
£ndt
[
i
]

474 
s
 =ğ
r
 
th’


475 
hªdËr_run
 = 
Œue


476 
£lf
:
	`_run_hªdËr
(
r
, 
b™
.
	$bªd
(
iŞoİ
.
READ
, iŞoİ.
WRITE
))

477 
bË
.
	$»move
(
£ndt
, 
i
)

479 
’d


480 
’d


481 
£lf
:
	$_run_hªdËr
(
r
, 
iŞoİ
.
READ
)

482 
’d


483 
_
, 
v
 
š
 
	$aœs
(
£ndt
) do

484 
£lf
:
	$_run_hªdËr
(
v
, 
iŞoİ
.
WRITE
)

485 
’d


486 
’d


487 
’d


489 --- 
Clo£
 
the
 
I
/
O
 
loİ
.

490 -- 
This
 
ÿÎ
 
mu¡
 
be
 
made
 
äom
 
w™hš
 
the
 
ruÂšg
 
I
/
O
 
loİ
 
vŸ
 
a


491 -- 
ÿÎback
, 
timeout
, 
Ü
 
š‹rv®
. 
NÙiû
: 
AÎ
 
³ndšg
 
ÿÎbacks
 
ªd
 
hªdËrs


492 -- 
¬e
 
ş—»d
 
upÚ
 
şo£
.

493 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$şo£
()

494 
£lf
.
_ruÂšg
 = 
çl£


495 
£lf
.
_¡İ³d
 = 
Œue


496 
’d


498 --- 
Run
 
IOLoİ
 
¥ecif›d
 
amouÁ
 
of
 
time
. 
U£d
 
š
 
Turbo
.
lua
 
‹¡s
.

499 -- @
·¿m
 
timeout
 
In
 
£cÚds
.

500 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$wa™
(
timeout
)

501 
	`as£¹
(
£lf
:
	`ruÂšg
(è=ğ
çl£
, "Can‚ot wait,‡lready started")

502 
loÿl
 
timedout


503 
loÿl
 
»f


504 
timeout
 
th’


505 
loÿl
 
_iŞoİ
 = 
£lf


506 
»f
 = 
£lf
:
	`add_timeout
(
ut
.
	`g‘timemÚÙÚic
(è+ (
timeout
*1000), 
	$funùiÚ
()

507 
timedout
 = 
Œue


508 
_iŞoİ
:
	$şo£
()

509 
’d
)

510 
’d


511 
£lf
:
	$¡¬t
()

512 
	`as£¹
(
£lf
:
	`ruÂšg
(è=ğ
çl£
, "IO Loop stopped unexpectedly")

513 
	`as£¹
(
nÙ
 
timedout
, "Sync wait operationimed out.")

514 
£lf
:
	$»move_timeout
(
»f
)

515  
Œue


516 
’d


518 --- 
E¼Ü
 
hªdËr
 
IOLoİ
:
_run_hªdËr
.

519 
loÿl
 
funùiÚ
 
	$_run_hªdËr_”rÜ_hªdËr
(
”r
)

520 
log
.
	`”rÜ
(

521 
¡ršg
.
	`fÜm©
(

523 
_¡r_bÜd”s_down
,

524 
debug
.
	`Œaûback
(
”r
, 2),

525 
_¡r_bÜd”s_up
))

526 
’d


528 --- 
Run
 
ÿÎbacks
 
´Ùeùed
 
w™h
 
”rÜ
 
hªdËrs
. 
Beÿu£
 
”rÜs
 
ÿn
 
®ways


529 -- 
h­³n
! 
If
 
a
 
hªdËr
 
”rÜs
, 
the
 hªdË¸
is
 
»moved
 
äom
h
IOLoİ
, 
ªd


530 -- 
Ãv”
 
ÿÎed
 
agaš
.

531 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$_run_hªdËr
(
fd
, 
ev’ts
)

532 
loÿl
 
ok


533 
loÿl
 
hªdËr
 = 
£lf
.
_hªdËrs
[
fd
]

534 
nÙ
 
hªdËr
 
th’


535 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
("Cr™iÿÈ”rÜ,‚ØhªdË¸fÜ fd: %d.", 
fd
))

537 
’d


538 -- 
hªdËr
[1] = 
funùiÚ
.

539 -- 
hªdËr
[2] = 
İtiÚ®
 
fœ¡
 
¬gum’t
 
funùiÚ
.

540 -- 
If
 
th”e
 
is
 
no
 
İtiÚ®
 
¬gum’t
, dØ
nÙ
 
add
 
™
 
as
 
·¿m‘”
 
to
 
the


541 -- 
funùiÚ
 
as
 
th©
 
ü—‹s
 
a
 
big
 
nui§nû
 
cÚsum”s
 
of
 
the
 
API
.

542 
loÿl
 
func
 = 
hªdËr
[1]

543 
loÿl
 
¬g
 = 
hªdËr
[2]

545 
¬g
 
th’


546 
ok
 = 
	$xpÿÎ
(

547 
func
,

548 
_run_hªdËr_”rÜ_hªdËr
,

549 
¬g
,

550 
fd
,

551 
ev’ts
)

553 
ok
 = 
	$xpÿÎ
(

554 
func
,

555 
_run_hªdËr_”rÜ_hªdËr
,

556 
fd
,

557 
ev’ts
)

558 
’d


559 
ok
 =ğ
çl£
 
th’


560 -- 
E¼Ü
 
š
 
hªdËr
 
ÿught
 
by
 
_run_hªdËr_”rÜ_hªdËr
.

561 -- 
Remove
 
the
 
hªdËr
 th
fd
 
as
 
™s
 
mo¡
 
lik–y
 
brok’
.

562 
£lf
:
	$»move_hªdËr
(
fd
)

563 
’d


564 
’d


566 
loÿl
 
funùiÚ
 
	$_run_ÿÎback_”rÜ_hªdËr
(
”r
)

567 
loÿl
 
th»ad
 = 
cÜoutše
.
	$ruÂšg
()

568 
log
.
	`”rÜ
(

569 
¡ršg
.
	`fÜm©
(

571 
th»ad
,

572 
_¡r_bÜd”s_down
,

573 
debug
.
	`Œaûback
(
cÜoutše
.
	`ruÂšg
(), 
”r
, 2),

574 
_¡r_bÜd”s_up
))

575 
’d


577 
loÿl
 
funùiÚ
 
	$_run_ÿÎback_´Ùeùed
(
func
, 
¬g
)

578 
	$xpÿÎ
(
func
, 
_run_ÿÎback_”rÜ_hªdËr
, 
¬g
)

579 
’d


581 
funùiÚ
 
iŞoİ
.
IOLoİ
:
	$_run_ÿÎback
(
ÿÎback
)

582 
loÿl
 
co
 = 
cÜoutše
.
	`ü—‹
(
_run_ÿÎback_´Ùeùed
)

583 -- 
ÿÎback
 
šdex
 1 = 
funùiÚ


584 -- 
ÿÎback
 
šdex
 2 = 
¬g


585 
loÿl
 
func
 = 
ÿÎback
[1]

586 
loÿl
 
¬g
 = 
ÿÎback
[2]

588 
loÿl
 
rc
 = 
£lf
:
	`_»sume_cÜoutše
(
co
, {
func
, 
¬g
})

589  
rc


590 
’d


592 
funùiÚ
 
	giŞoİ
.
	gIOLoİ
:
	$_»sume_cÜoutše
(
co
, 
¬g
)

593 
loÿl
 
”r
, 
y›lded
, 
¡


594 
loÿl
 
¬g_t
 = 
	$ty³
(
¬g
)

595 
¬g_t
 =ğ"funùiÚ" 
th’


596 -- 
FunùiÚ
 
as
 
¬gum’t
. 
C®l
.

597 
”r
, 
y›lded
 = 
cÜoutše
.
	`»sume
(
co
, 
	$¬g
())

598 
–£if
 
¬g_t
 =ğ"bË" 
th’


599 -- 
C®lback
 
bË
.

600 
”r
, 
y›lded
 = 
cÜoutše
.
	`»sume
(
co
, 
	$uÅack
(
¬g
))

602 -- 
PÏš
 
»sume
.

603 
”r
, 
y›lded
 = 
cÜoutše
.
	$»sume
(
co
, 
¬g
)

604 
’d


605 
¡
 = 
cÜoutše
.
	$¡©us
(
co
)

606 
¡
 =ğ"su¥’ded" 
th’


607 
loÿl
 
y›ld_t
 = 
	$ty³
(
y›lded
)

608 
	$š¡ªûOf
(
coùx
.
CÜoutšeCÚ‹xt
, 
y›lded
è
th’


609 -- 
Advªûd
 
y›ld
 
sûÇrio
.

610 -- 
U£
 
CouroutšeCÚ‹xt
 
as
 
key
 
š
 
CÜoutše
 
m­
.

611 
£lf
.
_co_ùxs
[
y›lded
] = 
co


613 
–£if
 
y›ld_t
 =ğ"funùiÚ" 
th’


614 -- 
ScheduË
 
cÜoutše
 
to
 
be
 
run
 
Ú
 
Ãxt
 
™”©iÚ
 
w™h
 
funùiÚ


615 -- 
as
 
»suÉ
 
of
 
y›ld
.

616 
£lf
.
_co_cbs
[#£lf._co_cb + 1] = {
co
, 
y›lded
}

618 
–£if
 
y›ld_t
 =ğ"n" 
th’


619 -- 
Em±y
 
y›ld
. 
ScheduË
 
»sume
 
Ú
 
Ãxt
 
™”©iÚ
.

620 
£lf
.
_co_cbs
[#£lf._co_cb + 1] = {
co
, 0}

623 -- 
Inv®id
 
y›lded
 
v®ue
. 
ScheduË
 
»sume
 
of
 
cÜoutše
 
Ú
 
Ãxt


624 -- 
™”©iÚ
 
w™h
 -1 
as
 
»suÉ
 
of
 
y›ld
 (
to
 
»´e£Á
 
”rÜ
).

625 
£lf
.
_co_cbs
[#£lf._co_cb + 1] = {
co
, 
funùiÚ
(è -1 
’d
}

626 
log
.
w¬nšg
(
¡ršg
.
fÜm©
(

628 
y›ld_t
))

630 
’d


631 
’d


633 
’d


635 
	g_IÁ”v®
 = 
şass
("_Interval")

636 
funùiÚ
 
_IÁ”v®
:
	$š™Ÿlize
(
m£c
, 
ÿÎback
, 
¬g
)

637 
£lf
.
š‹rv®_m£c
 = 
m£c


638 
£lf
.
ÿÎback
 = callback

639 
£lf
.
¬g
 =‡rg

640 
£lf
.
Ãxt_ÿÎ
 = 
ut
.
	`g‘timemÚÙÚic
(è+ s–f.
š‹rv®_m£c


641 
’d


643 
funùiÚ
 
_IÁ”v®
:
	$timed_out
(
time_now
)

644 
time_now
 >ğ
£lf
.
Ãxt_ÿÎ
 
th’


647  
£lf
.
Ãxt_ÿÎ
 - 
time_now


648 
’d


649 
’d


651 
funùiÚ
 
_IÁ”v®
:
	$£t_Ï¡_ÿÎ
(
time_now
)

652 
£lf
.
Ï¡_š‹rv®
 = 
time_now


653 
£lf
.
Ãxt_ÿÎ
 = 
time_now
 + s–f.
š‹rv®_m£c


654  
£lf
.
Ãxt_ÿÎ
 - 
time_now


655 
’d


658 
_Timeout
 = 
	`şass
('_Timeout')

659 
funùiÚ
 
_Timeout
:
	$š™Ÿlize
(
time¡amp
, 
ÿÎback
, 
¬g
)

660 
£lf
.
_time¡amp
 = 
time¡amp
 
Ü


661 
	`”rÜ
('Noimestamp giveno _Timeout class')

662 
£lf
.
_ÿÎback
 = 
ÿÎback
 
Ü


663 
	`”rÜ
('No callback giveno _Timeout class')

664 
£lf
.
_¬g
 = 
¬g


665 
’d


667 
funùiÚ
 
_Timeout
:
	$timed_out
(
time
)

668 
£lf
.
_time¡amp
 - 
time
 <ğ0 
th’


671  
£lf
.
_time¡amp
 - 
time


672 
’d


673 
’d


675 
funùiÚ
 
_Timeout
:
	$ÿÎback
()

676  
£lf
.
_ÿÎback
, s–f.
_¬g


677 
’d


680 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


681 
_EPŞl_FFI
 = 
	`şass
('_EPoll_FFI')

683 --- 
IÁ”Çl
 
şass
 
•Şl
-
ba£d
 
ev’t
 
loİ
 
usšg
 
the
 
•Şl_ffi
 
moduË
.

684 
funùiÚ
 
_EPŞl_FFI
:
	$š™Ÿlize
()

685 
loÿl
 
”ºo


686 
£lf
.
_•Şl_fd
, 
”ºo
 = 
•Şl_ffi
.
	$•Şl_ü—‹
()

687 
£lf
.
_•Şl_fd
 =ğ-1 
th’


688 
	`”rÜ
("•Şl_ü—‹ faed w™hƒ¼nØğ" .. 
”ºo
)

689 
’d


690 
’d


692 
funùiÚ
 
_EPŞl_FFI
:(
fd
, 
ev’ts
)

693  
•Şl_ffi
.
	$•Şl_ùl
(
£lf
.
_•Şl_fd
, 
•Şl_ffi
.
EPOLL_CTL_ADD
,

694 
fd
, 
ev’ts
)

695 
’d


697 
funùiÚ
 
_EPŞl_FFI
:
	$modify
(
fd
, 
ev’ts
)

698  
•Şl_ffi
.
	$•Şl_ùl
(
£lf
.
_•Şl_fd
, 
•Şl_ffi
.
EPOLL_CTL_MOD
,

699 
fd
, 
ev’ts
)

700 
’d


702 
funùiÚ
 
_EPŞl_FFI
:
	$uÄegi¡”
(
fd
)

703  
•Şl_ffi
.
	$•Şl_ùl
(
£lf
.
_•Şl_fd
, 
•Şl_ffi
.
EPOLL_CTL_DEL
,

704 
fd
, 0)

705 
’d


707 
funùiÚ
 
_EPŞl_FFI
:
	$pŞl
(
timeout
)

708  
•Şl_ffi
.
	$•Şl_wa™
(
£lf
.
_•Şl_fd
, 
timeout
)

709 
’d


710 
’d


712 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


713 
_LuaSock‘PŞl
 = 
	`şass
("_LuaSocketPoll")

715 
funùiÚ
 
_LuaSock‘PŞl
:
	$š™Ÿlize
()

716 
£lf
.
£ndt
 = {
	}
}

717 
£lf
.
»cvt
 = {}

718 
’d


720 
funùiÚ
 
_LuaSock‘PŞl
:(
fd
, 
ev’ts
)

721 
b™
.
	`bªd
(
ev’ts
, 
iŞoİ
.
WRITE
è~ğ0 
th’


722 #£lf.
£ndt
 >ğ64 
th’


725 
’d


726 
bË
.
	$š£¹
(
£lf
.
£ndt
, 
fd
)

727 
’d


728 
b™
.
	`bªd
(
ev’ts
, 
iŞoİ
.
READ
è~ğ0 
th’


729 #£lf.
»cvt
 >ğ64 
th’


732 
’d


733 
bË
.
	$š£¹
(
£lf
.
»cvt
, 
fd
)

734 
’d


735  0, 
n


736 
’d


738 
funùiÚ
 
_LuaSock‘PŞl
:
	$uÄegi¡”
(
fd
)

739 
i
=1, #£lf.
£ndt
, 1 do

740 
£lf
.
£ndt
[
i
] =ğ
fd
 
th’


741 
bË
.
	$»move
(
£lf
.
£ndt
, 
i
)

742 
’d


743 
’d


744 
i
=1, #£lf.
»cvt
, 1 do

745 
£lf
.
»cvt
[
i
] =ğ
fd
 
th’


746 
bË
.
	$»move
(
£lf
.
»cvt
, 
i
)

747 
’d


748 
’d


749  0, 
n


750 
’d


752 
funùiÚ
 
_LuaSock‘PŞl
:
	$modify
(
fd
, 
ev’ts
)

753 
i
=1, #£lf.
£ndt
, 1 do

754 
£lf
.
£ndt
[
i
] =ğ
fd
 
th’


755 
bË
.
	$»move
(
£lf
.
£ndt
, 
i
)

756 
’d


757 
’d


758 
i
=1, #£lf.
»cvt
, 1 do

759 
£lf
.
»cvt
[
i
] =ğ
fd
 
th’


760 
bË
.
	$»move
(
£lf
.
»cvt
, 
i
)

761 
’d


762 
’d


763 
b™
.
	`bªd
(
ev’ts
, 
iŞoİ
.
WRITE
è~ğ0 
th’


764 #£lf.
£ndt
 >ğ64 
th’


767 
’d


768 
bË
.
	$š£¹
(
£lf
.
£ndt
, 
fd
)

769 
’d


770 
b™
.
	`bªd
(
ev’ts
, 
iŞoİ
.
READ
è~ğ0 
th’


771 #£lf.
»cvt
 >ğ64 
th’


774 
’d


775 
bË
.
	$š£¹
(
£lf
.
»cvt
, 
fd
)

776 
’d


777  0, 
n


778 
’d


780 
funùiÚ
 
_LuaSock‘PŞl
:
	$pŞl
(
timeout
)

781  
luasock‘
.
	$£Ëù
(
£lf
.
»cvt
, s–f.
£ndt
, 
timeout
)

782 
’d


783 
’d


785  
iŞoİ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/iosimple.lua

1 --- 
	gTurbo
.
lua
 
IO
 
SŒ—m
 
	gmoduË
.

2 -- 
V”y
 
	gHigh
-
Ëv–
 
w¿µ”s
 
asynchrÚous
 
sock‘
 
	gcommuniÿtiÚ
.

4 -- 
	gCİyright
 2015 
John
 
	gAb¿ham£n


6 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

7 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

8 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


10 -- 
	gh‰p
:

12 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


13 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

14 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

15 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


16 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

19 -- 
A
 
š‹rçû
 
	gturbo
.
io¡»am
 
w™hout
 
the
 
ÿÎback
 
	g¥agh‘ti
, 
but
 
	g¡l


20 -- 
the
 
async
 
	$back’d
 (
the
 
y›ld
 
is
 
dÚe
 
š‹º®ly
):

21 -- 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`add_ÿÎback
(
	`funùiÚ
()

22 -- 
loÿl
 
¡»am
 = 
turbo
.
iosim¶e
.
	`dŸl
("tcp://turbolua.org:80")

23 -- 
¡»am
:
	`wr™e
("GET / HTTP/1.0\r\n\r\n")

25 -- 
loÿl
 
d©a
 = 
¡»am
:
	`»ad_uÁ_şo£
()

26 -- 
	`´št
(
d©a
)

28 -- 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`şo£
()

29 -- 
’d
):
	`¡¬t
()

33 
loÿl
 
log
 = 
»quœe
 "turbo.log"

34 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

35 
loÿl
 
coùx
 = 
»quœe
 "turbo.coctx"

36 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

37 
loÿl
 
sockuts
 = 
»quœe
 "turbo.sockutil"

38 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

39 
loÿl
 
io¡»am
 = 
»quœe
 "turbo.iostream"

40 
loÿl
 
üy±o
 = 
»quœe
 "turbo.crypto"

42 
loÿl
 
iosim¶e
 = {
	}
} -- iosim¶
Çme¥aû


44 --- 
CÚÃù
 
to
 
a
 
ho¡
 
usšg
‡ 
sim¶e
 
URI
 
·‰”n
.

45 -- @
·¿m
 
	$add»ss
 (
SŒšg
è
E
.
g
 
tı
:

46 -- @
·¿m
 
	$io
 (
IOLoİ
 
objeù
èIOLoİ 
şass
 
š¡ªû
 
to
 
u£
 
ev’t


47 -- 
´oûssšg
. 
If
 
nÚe
 
is
 
£t
 
th’
 
the
 
glob®
 
š¡ªû
 i 
u£d
, 
£e
he

48 -- 
iŞoİ
.
	$š¡ªû
(è
funùiÚ
.

49 -- @ (
IOSim¶e
 
şass
 
š¡ªû
è
Ü
 
¿i£
 
”rÜ
.

50 
funùiÚ
 
iosim¶e
.
	$dŸl
(
add»ss
, 
s¦
, 
io
)

51 
	`as£¹
(
	`ty³
(
add»ss
) == "string", "No‡ddress in callo dial.")

52 
loÿl
 
´ÙocŞ
, 
ho¡
, 
pÜt
 = 
add»ss
:
	`m©ch
("^(%a+)://(.+):(%d+)")

53 
pÜt
 = 
	$tÚumb”
(
pÜt
)

54 
	`as£¹
(

55 
´ÙocŞ
 
ªd
 
ho¡
,

58 
io
 = iØ
Ü
 
iŞoİ
.
	$š¡ªû
()

59 
loÿl
 
sock_t


60 
loÿl
 
add»ss_çmy


61 
´ÙocŞ
 =ğ"tı" 
th’


62 
sock_t
 = 
sock‘
.
SOCK_STREAM


63 
add»ss_çmy
 = 
sock‘
.
AF_INET


64 
–£if
 
´ÙocŞ
 =ğ"udp" 
th’


65 
sock_t
 = 
sock‘
.
SOCK_DGRAM


66 
add»ss_çmy
 = 
sock‘
.
AF_INET


67 
–£if
 
´ÙocŞ
 =ğ"unix" 
th’


68 
sock_t
 = 
sock‘
.
SOCK_STREAM


69 
add»ss_çmy
 = 
sock‘
.
AF_UNIX


71 
	`”rÜ
("UnknowÀschema: " .. 
´ÙocŞ
)

72 
’d


74 
loÿl
 
”r
, 
s¦_cÚ‹xt


75 
s¦
 
th’


76 
s¦
 =ğ
Œue
 
th’


77 
s¦
 = {
v”ify
=
Œue
}

78 
’d


79 
	g”r
, 
	g»s
 = 
üy±o
.
	$s¦_ü—‹_ş›Á_cÚ‹xt
(

80 
s¦
.
û¹_fe
,

81 
s¦
.
key_fe
,

82 
s¦
.
ÿ_û¹_fe
,

83 
s¦
.
v”ify
)

84 
”r
 ~ğ0 
th’


85 
	$”rÜ
(
»s
)

86 
’d


87 
s¦_cÚ‹xt
 = 
»s


88 
’d


90 
loÿl
 
sock
, 
msg
 = 
sock‘
.
	$Ãw_nÚblock_sock‘
(

91 
add»ss_çmy
,

92 
sock_t
,

94 
sock
 =ğ-1 
th’


95 
	`”rÜ
("Could‚ot create socket.")

96 
’d


98 
loÿl
 
ùx
 = 
coùx
.
	$CÜoutšeCÚ‹xt
(
io
)

99 
loÿl
 
¡»am


100 
s¦
 
ªd
 
s¦_cÚ‹xt
 
th’


101 
¡»am
 = 
io¡»am
.
	`SSLIOSŒ—m
(
sock
, {
_s¦_ùx
=
s¦_cÚ‹xt
,

102 
_ty³
=1
	}
})

103 
	g¡»am
:
cÚÃù
(
ho¡
, 
pÜt
, 
add»ss_çmy
, 
s¦
.
v”ify
 
Ü
 
çl£
,

104 
	$funùiÚ
()

105 
ùx
:
	`£t_¬gum’ts
({
Œue
})

106 
ùx
:
	$fš®ize_cÚ‹xt
()

107 
’d
,

108 
	$funùiÚ
(
rc
, 
¡»¼
, 
”rdesc
)

109 
ùx
:
	`£t_¬gum’ts
({
çl£
, 
rc
, 
¡»¼
, 
”rdesc
})

110 
ùx
:
	$fš®ize_cÚ‹xt
()

111 
’d


114 
¡»am
 = 
io¡»am
.
	$IOSŒ—m
(
sock
)

115 
¡»am
:
	`cÚÃù
(
ho¡
, 
pÜt
, 
add»ss_çmy
,

116 
	$funùiÚ
()

117 
ùx
:
	`£t_¬gum’ts
({
Œue
})

118 
ùx
:
	$fš®ize_cÚ‹xt
()

119 
’d
,

120 
	$funùiÚ
(
rc
, 
¡»¼
, 
”rdesc
)

121 
ùx
:
	`£t_¬gum’ts
({
çl£
, 
rc
, 
¡»¼
, 
”rdesc
})

122 
	gùx
:
	$fš®ize_cÚ‹xt
()

123 
’d


125 
’d


126 
loÿl
 
rc
, 
sock”r
, 
¡»¼
, 
”rdesc
 = 
cÜoutše
.
	$y›ld
(
ùx
)

127 
rc
 ~ğ
Œue
 
th’


128 
	$”rÜ
(
”rdesc
)

129 
’d


130  
iosim¶e
.
	$IOSim¶e
(
¡»am
, 
io
)

131 
’d


133 
iosim¶e
.
IOSim¶e
 = 
	`şass
("IOSimple")

135 --- 
W¿p
 
a
 
IOSŒ—m
 
şass
 
š¡ªû
 
w™h
‡ 
sim¶”
 
IO
.

136 -- @
·¿m
 
¡»am
 
IOSŒ—m
 
şass
 
š¡ªû
, 
®»ady
 
cÚÃùed
. 
If
 
nÙ
 
cÚsid”


137 -- 
usšg
 
iosim¶e
.
dŸl
.

138 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$š™Ÿlize
(
¡»am
)

139 
£lf
.
¡»am
 = stream

140 
£lf
.
io
 = s–f.
¡»am
.
io_loİ


141 
£lf
.
¡»am
:
	$£t_şo£_ÿÎback
(
£lf
.
_wake_y›ld_şo£
, self)

142 
’d


144 --- 
Clo£
 
this
 
¡»am
 
ªd
 
ş—n
 
up
.

145 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$şo£
()

146 
£lf
.
¡»am
:
	$şo£
()

147 
’d


149 --- 
R‘uºs
 
the
 
IOSŒ—m
 
š¡ªû
 
backed
 
by
h
cu¼’t
 
IOSim¶e
 instance.

150 -- @ (
IOSŒ—m
 
şass
 
š¡ªû
)

151 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$g‘_io¡»am
()

152  
£lf
.
¡»am


153 
’d


155 --- 
Wr™e
 
the
 
giv’
 
d©a
 
to
h
¡»am
. 
R‘uº
 
wh’
 d©¨
has
 
b“n
 
wr™‹n
.

156 -- @
·¿m
 
	$d©a
 (
SŒšg
è
D©a
 
to
 
wr™e
Ø
¡»am
.

157 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$wr™e
(
d©a
)

158 
	`as£¹
(
nÙ
 
£lf
.
coùx
, "IOSimple is‡lready working.")

159 
£lf
.
coùx
 = coùx.
	$CÜoutšeCÚ‹xt
(
£lf
.
io
)

160 
£lf
.
¡»am
:
	$wr™e
(
d©a
, 
£lf
.
_wake_y›ld
, self)

161 
loÿl
 
»s
, 
”r
 = 
cÜoutše
.
	$y›ld
(
£lf
.
coùx
)

162 
nÙ
 
»s
 
ªd
 
”r
 
th’


163 
	$”rÜ
(
”r
)

164 
’d


165  
»s


166 
’d


168 --- 
R—d
 
uÁ
 
d–im™”
.

169 -- 
D–im™”
 
is
 
¶aš
 
‹xt
, 
ªd
 
dÛs
 
nÙ
 
suµÜt
 
Lua
 
·‰”ns
.

170 -- 
S“
 
»ad_uÁ_·‰”n
 
Lua
 
·‰”ns
.

171 -- 
»ad_uÁ
 
should
 
be
 
u£d
 
š¡—d
 
of
 
»ad_uÁ_·‰”n
 
wh”ev”
 
possibË


172 -- 
beÿu£
 
of
 
the
 
ov”h—d
 oà
došg
 
·‰”n
 
m©chšg
.

173 -- @
·¿m
 
	$d–im™”
 (
SŒšg
è
D–im™”
 
£qu’û
, 
‹xt
 
Ü
 
bš¬y
.

174 -- @ (
SŒšg
è
D©a
 
»ûive
 
uÁ
 
d–im™”
.

175 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$»ad_uÁ
(
d–im™”
)

176 
	`as£¹
(
nÙ
 
£lf
.
coùx
, "IOSimple is‡lready working.")

177 
£lf
.
coùx
 = coùx.
	$CÜoutšeCÚ‹xt
(
£lf
.
io
)

178 
£lf
.
¡»am
:
	$»ad_uÁ
(
d–im™”
, 
£lf
.
_wake_y›ld
, self)

179 
loÿl
 
»s
, 
”r
 = 
cÜoutše
.
	$y›ld
(
£lf
.
coùx
)

180 
nÙ
 
»s
 
ªd
 
”r
 
th’


181 
	$”rÜ
(
”r
)

182 
’d


183  
»s


184 
’d


186 --- 
R—d
 
giv’
 
amouÁ
 
of
 
by‹s
 
äom
 
cÚÃùiÚ
.

187 -- @
·¿m
 
	$by‹s
 (
Numb”
è
The
 
amouÁ
 
of
 
by‹s
 
to
 
»ad
.

188 -- @ (
SŒšg
è
D©a
 
»ûive
.

189 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$»ad_by‹s
(
by‹s
)

190 
	`as£¹
(
nÙ
 
£lf
.
coùx
, "IOSimple is‡lready working.")

191 
£lf
.
coùx
 = coùx.
	$CÜoutšeCÚ‹xt
(
£lf
.
io
)

192 
£lf
.
¡»am
:
	$»ad_by‹s
(
by‹s
, 
£lf
.
_wake_y›ld
, self)

193 
loÿl
 
»s
, 
”r
 = 
cÜoutše
.
	$y›ld
(
£lf
.
coùx
)

194 
nÙ
 
»s
 
ªd
 
”r
 
th’


195 
	$”rÜ
(
”r
)

196 
’d


197  
»s


198 
’d


200 --- 
R—d
 
uÁ
 
·‰”n
 
is
 
m©ched
, 
th’
 
»tuºs
 
»ûive
 
d©a
.

201 -- 
If
 
you
 
Úly
 
¬e
 
došg
 
¶aš
 
‹xt
 
m©chšg
 
th’
 
usšg
 
»ad_uÁ


202 -- 
is
 
»comm’ded
 
Ëss
 
ov”h—d
.

203 -- @
·¿m
 
	$·‰”n
 (
SŒšg
è
The
 
·‰”n
 
to
 
m©ch
.

204 -- @ (
SŒšg
è
D©a
 
»ûive
.

205 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$»ad_uÁ_·‰”n
(
·‰”n
)

206 
	`as£¹
(
nÙ
 
£lf
.
coùx
, "IOSimple is‡lready working.")

207 
£lf
.
coùx
 = coùx.
	$CÜoutšeCÚ‹xt
(
£lf
.
io
)

208 
£lf
.
¡»am
:
	$»ad_uÁ_·‰”n
(
·‰”n
, 
£lf
.
_wake_y›ld
, self)

209 
loÿl
 
»s
, 
”r
 = 
cÜoutše
.
	$y›ld
(
£lf
.
coùx
)

210 
nÙ
 
»s
 
ªd
 
”r
 
th’


211 
	$”rÜ
(
”r
)

212 
’d


213  
»s


214 
’d


216 --- 
R—ds
 
®l
 
d©a
 
äom
 
the
 
sock‘
 
uÁ
 
™
 
is
 
şo£d
.

217 -- @ (
SŒšg
è
D©a
 
»ûive
.

218 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$»ad_uÁ_şo£
()

219 
	`as£¹
(
nÙ
 
£lf
.
coùx
, "IOSimple is‡lready working.")

220 
£lf
.
coùx
 = coùx.
	$CÜoutšeCÚ‹xt
(
£lf
.
io
)

221 
£lf
.
¡»am
:
	$»ad_uÁ_şo£
(
£lf
.
_wake_y›ld
, self)

222 
loÿl
 
»s
, 
”r
 = 
cÜoutše
.
	$y›ld
(
£lf
.
coùx
)

223 
nÙ
 
»s
 
ªd
 
”r
 
th’


224 
	$”rÜ
(
”r
)

225 
’d


226  
»s


227 
’d


229 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$_wake_y›ld_şo£
(...)

230 
£lf
.
coùx
 
th’


231 
£lf
.
coùx
:
	`£t_¬gum’ts
({
n
, "discÚÃùed"
	}
})

232 
£lf
.
coùx
:
	$fš®ize_cÚ‹xt
()

233 
£lf
.
coùx
 = 
n


234 
’d


235 
’d


237 
funùiÚ
 
iosim¶e
.
IOSim¶e
:
	$_wake_y›ld
(...)

238 
loÿl
 
ùx
 = 
£lf
.
coùx


239 
£lf
.
coùx
 = 
n


240 
ùx
:
	`£t_¬gum’ts
({...
	}
})

241 
ùx
:
	$fš®ize_cÚ‹xt
()

242 
’d


244  
iosim¶e


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/iostream.lua

1 --- 
	gTurbo
.
lua
 
IO
 
SŒ—m
 
	gmoduË
.

2 -- 
	gHigh
-
Ëv–
 
w¿µ”s
 
asynchrÚous
 
sock‘
 
	gcommuniÿtiÚ
.

3 -- 
AÎ
 
	gAPI
's‡re callback based‡nd depend onhe __Turbo IOLoop module__.

5 -- 
Im¶em’tiÚs
 
	gavaabË
:

7 -- * 
IOSŒ—m
, 
	gnÚ
-
blockšg
 
	gsock‘s
.

8 -- * 
	gSSLIOSŒ—m
, 
	gnÚ
-
blockšg
 
SSL
 
sock‘s
 
usšg
 
	gO³nSSL
.

10 -- 
	gCİyright
 2011 - 2015 
John
 
	gAb¿ham£n


12 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

13 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

14 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


16 -- 
	gh‰p
:

18 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


19 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

20 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

21 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


22 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

25 
loÿl
 
	glog
 = 
»quœe
 "turbo.log"

26 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

27 
loÿl
 
deque
 = 
»quœe
 "turbo.structs.deque"

28 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

29 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

30 
loÿl
 
sockuts
 = 
»quœe
 "turbo.sockutil"

31 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

32 
loÿl
 
sigÇl
 = 
»quœe
 "turbo.signal"

33 -- 
__Glob®
 
v®ue__
 
_G
.
TURBO_SSL
 
®lows
 
the
 
u£r
 
to
 
’abË
h
SSL
 
moduË
.

34 
loÿl
 
üy±o
 = 
»quœe
 "turbo.crypto"

35 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

36 
loÿl
 
sockut
 = 
»quœe
 "turbo.sockutil"

37 
loÿl
 
coùx
 = 
»quœe
 "turbo.coctx"

38 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

39 
loÿl
 
ffi
 = 
»quœe
 "ffi"

40 
loÿl
 
s¦


41 ià(
nÙ
 
¶©fÜm
.
__LINUX__
 
Ü
 
_G
.
__TURBO_USE_LUASOCKET__
è
ªd
 _G.
TURBO_SSL
 
th’


42 -- 
NÚ
 
Lšux
 
OS
 
u£s
 
LuaSec
 
š¡—d
 
of
 
O³nSSL
 
lib¿ry
 
dœeùly
.

43 -- 
As
 
th©
 
is
 
made
 
to
 
wÜk
 
w™h
 
the
 
LuaSock‘
 
moduË
.

44 -- 
h‰ps
:

45 
s¦
 = 
»quœe
 "ssl"

46 
’d


47 
»quœe
 "turbo.cdef"

48 
»quœe
 "turbo.3rdparty.middleclass"

50 
loÿl
 
SOCK_STREAM
, 
	gAF_UNSPEC
, 
	gEWOULDBLOCK
, 
	gEINPROGRESS
, 
	gECONNRESET
, 
	gEPIPE
,

51 
	gEAGAIN
, 
EAI_AGAIN


53 
	g¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
	g_G
.
__TURBO_USE_LUASOCKET__
 
th’


54 
	gSOCK_STREAM
 = 
sock‘
.
SOCK_STREAM


55 
AF_UNSPEC
 = 
sock‘
.AF_UNSPEC

56 
EWOULDBLOCK
 = 
sock‘
.EWOULDBLOCK

57 
EINPROGRESS
 = 
sock‘
.EINPROGRESS

58 
ECONNRESET
 = 
sock‘
.ECONNRESET

59 
EPIPE
 = 
sock‘
.EPIPE

60 
EAGAIN
 = 
sock‘
.EAGAIN

61 
EAI_AGAIN
 = 
sock‘
.EAI_AGAIN

62 
’d


64 
loÿl
 
b™Ü
, 
	gb™ªd
, 
	gmš
, 
	gmax
 = 
b™
.
bÜ
, 
	gb™
.
	gbªd
, 
	gm©h
.mš, m©h.
max


65 
loÿl
 
	gC
 = 
ffi
.
C


67 -- 
__Glob®
 
v®ue__
 
_G
.
TURBO_SOCKET_BUFFER_SZ
 
®lows
 
the
 
u£r
 
to
 
£t


68 -- 
his
 
own
 
sock‘
 
bufãr
 
size
 
to
 
be
 
u£d
 
by
 
the
 
moduË
. 
DeçuÉs
o

69 -- (16384+1024è
by‹s
, 
which
 
is
 
the
  
max
 
u£d
 
by
 
	gaxTLS
.

70 
	g_G
.
	gTURBO_SOCKET_BUFFER_SZ
 = 
_G
.
TURBO_SOCKET_BUFFER_SZ
 
Ü
 (16384+1024)

71 
loÿl
 
TURBO_SOCKET_BUFFER_SZ
 = 
_G
.TURBO_SOCKET_BUFFER_SZ

72 
loÿl
 
buf


73 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


74 
buf
 = 
ffi
.
Ãw
("ch¬[?]", 
TURBO_SOCKET_BUFFER_SZ
)

75 
’d


77 
loÿl
 
	gio¡»am
 = {} -- 
io¡»am
 
Çme¥aû


79 --- 
The
 
IOSŒ—m
 
şass
 
is
 
im¶em’‹d
 
through
 
the
 
u£
 
of
h
IOLoİ
 class,

80 -- 
ªd
 
¬e
 
utized
 
	ge
.
g
 
š
 
the
 
Reque¡HªdËr
 
şass
‡nd 
™s
 
	gsubşas£s
.

81 -- 
They
 
´ovide
 
a
 
	gnÚ
-
blockšg
 
š‹rçû
 
ªd
 
suµÜt
 
ÿÎbacks
 
mo¡
 
	gof


82 -- 
™s
 
	gİ”©iÚs
. 
FÜ
 
»ad
 
İ”©iÚs
 
the
 
şass
 
suµÜts
 
m‘hods
 
suchs
 
	gas


83 -- 
»ad
 
uÁ
 
	gd–im™”
,„—d 
n
 
by‹s
 
ªd
„—d uÁ 
	gşo£
. 
The
 
şass
 
	ghas


84 -- 
™s
 
own
 
wr™e
 
bufãr
 
ªd
 
th”e
 
is
 
no
 
Ãed
 
to
 bufã¸
d©a
 
©
 
ªy
 
Ùh”
 
	gËv–
.

85 -- 
The
  
maximum
 
wr™e
 
bufãr
 
is
 
defšed
 
	gto
 100 
	gMB
. 
This
 
ÿn
 
	gbe


86 -- 
defšed
 
Ú
 
şass
 
	gš™Ÿliz©iÚ
.

87 
	gio¡»am
.
	gIOSŒ—m
 = 
şass
('IOStream')

89 --- 
C»©e
 
a
 
Ãw
 
IOSŒ—m
 
š¡ªû
.

90 -- @
·¿m
 
	$fd
 (
Numb”
è
Fe
 
desütÜ
, 
e™h”
 
İ’
 
Ü
 
şo£d
. 
If
 clo£d 
th’
,

91 -- 
the
 
IOSŒ—m
:
	$cÚÃù
(è
m‘hod
 
ÿn
 
be
 
u£d
 
to
 
cÚÃù
.

92 -- @
·¿m
 
	$io_loİ
 (
IOLoİ
 
objeù
èIOLoİ 
şass
 
š¡ªû
 
to
 
u£
 
ev’t


93 -- 
´oûssšg
. 
If
 
nÚe
 
is
 
£t
 
th’
 
the
 
glob®
 
š¡ªû
 i 
u£d
, 
£e
he

94 -- 
iŞoİ
.
	$š¡ªû
(è
funùiÚ
.

95 -- @
·¿m
 
	$max_bufãr_size
 (
Numb”
è
The
 
maximum
 
numb”
 
of
 
by‹s
 
th©
 
ÿn
 
be


96 -- 
h–d
 
š
 
š‹º®
 
bufãr
 
befÜe
 
æushšg
 
mu¡
 
occur
.

97 -- 
If
 
nÚe
 
is
 
£t
, 104857600 
¬e
 
u£d
 
as
 .

98 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$š™Ÿlize
(
fd
, 
io_loİ
, 
max_bufãr_size
, 
¬gs
)

99 
£lf
.
sock‘
 = 
	`as£¹
(
fd
, "Fd is‚ot‡‚umber.")

100 
£lf
.
io_loİ
 = io_loİ 
Ü
 
iŞoİ
.
	$š¡ªû
()

101 
£lf
.
max_bufãr_size
 = max_bufãr_siz
Ü
 1024*1024*128

102 
£lf
.
¬gs
 =‡rg 
Ü
 {
	}
}

103 
£lf
.
_»ad_bufãr
 = 
	$bufãr
(1024)

104 
£lf
.
_»ad_bufãr_size
 = 0

105 
£lf
.
_»ad_bufãr_off£t
 = 0

106 
£lf
.
_»ad_sÿn_off£t
 = 0

107 
£lf
.
_wr™e_bufãr
 = 
	$bufãr
(1024)

108 
£lf
.
_wr™e_bufãr_size
 = 0

109 
£lf
.
_wr™e_bufãr_off£t
 = 0

110 
£lf
.
_³ndšg_ÿÎbacks
 = 0

111 
£lf
.
_»ad_uÁ_şo£
 = 
çl£


112 
£lf
.
_cÚÃùšg
 = 
çl£


113 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


114 
loÿl
 
rc
, 
msg
 = 
sock‘
.
	$£t_nÚblock_æag
(
£lf
.
sock‘
)

115 
rc
 =ğ-1 
th’


116 
	`”rÜ
("[io¡»am.lua] " .. 
msg
)

117 
’d


118 
’d


119 
’d


121 --- 
CÚÃù
 
to
 
a
 
add»ss
 
w™hout
 
blockšg
.

122 -- @
·¿m
 
	$add»ss
 (
SŒšg
è
The
 
ho¡
 
to
 
cÚÃù
o. 
E™h”
 
ho¡Çme
 
Ü
 
IP
.

123 -- @
·¿m
 
	$pÜt
 (
Numb”
è
The
 
pÜt
 
to
 
cÚÃù
o. 
E
.
g
 80.

124 -- @
·¿m
 
	$çmy
 (
Numb”
è
Sock‘
 
çmy
. 
O±iÚ®
. 
Pass
 
n
 
to
 
guess
.

125 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
ÿÎback
 "on successfull connect".

126 -- @
·¿m
 
	$ç_ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
ÿÎback
 "onƒrror".

127 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
.

128 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


129 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$cÚÃù
(
add»ss
, 
pÜt
, 
çmy
,

130 
ÿÎback
, 
ç_ÿÎback
, 
¬g
)

131 
	`as£¹
(
	`ty³
(
add»ss
) == "string",

133 
	`as£¹
(
	`ty³
(
pÜt
) == "number",

135 
	`as£¹
((
nÙ
 
çmy
 
Ü
 
	`ty³
(family) == "number"),

137 
£lf
.
_cÚÃù_ç_ÿÎback
 = 
ç_ÿÎback


138 
£lf
.
_cÚÃùšg
 = 
Œue


139 
£lf
.
_cÚÃù_ÿÎback
 = 
ÿÎback


140 
£lf
.
_cÚÃù_ÿÎback_¬g
 = 
¬g


141 
loÿl
 
£rvšfo
, 
sockaddr


142 
loÿl
 
¡©us
, 
”r
 = 
	`pÿÎ
(
	$funùiÚ
()

143 
loÿl
 
dns
 = 
io¡»am
.
	$DNSResŞv
(
£lf
.
io_loİ
, s–f.
¬gs
)

144 
£rvšfo
, 
sockaddr
 = 
dns
:
	$»sŞv
(
add»ss
, 
pÜt
, 
çmy
)

145 
’d
)

146 
nÙ
 
¡©us
 
th’


147 
£lf
:
	`_hªdË_cÚÃù_ç
(
”r
 
Ü
 "DNS„esolvƒrror")

149 
’d


150 
loÿl
 
ai
, 
”r
 = 
sockuts
.
	$cÚÃù_addršfo
(

151 
£lf
.
sock‘
, 
£rvšfo
)

152 
nÙ
 
ai
 
th’


153 
£lf
:
	`_hªdË_cÚÃù_ç
(

154 "Could‚Ù cÚÃùØ»mÙ£rv”. " .. (
”r
 
Ü
 ""))

156 
’d


157 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
WRITE
)

158  0 -- 
Too
 
avoid
 
b»akšg
 
backw¬ds
 
com·b™y
.

159 
’d


161 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$cÚÃù
(
add»ss
, 
pÜt
, 
çmy
,

162 
ÿÎback
, 
ç_ÿÎback
, 
¬g
)

163 
	`as£¹
(
	`ty³
(
add»ss
) == "string",

165 
	`as£¹
(
	`ty³
(
pÜt
) == "number",

167 
	`as£¹
((
nÙ
 
çmy
 
Ü
 
	`ty³
(family) == "number"),

169 
£lf
.
_cÚÃù_ç_ÿÎback
 = 
ç_ÿÎback


170 
£lf
.
_cÚÃù_ÿÎback
 = 
ÿÎback


171 
£lf
.
_cÚÃù_ÿÎback_¬g
 = 
¬g


172 
£lf
.
_cÚÃùšg
 = 
Œue


173 
loÿl
 
_
, 
”r
 = 
£lf
.
sock‘
:
	$cÚÃù
(
add»ss
, 
pÜt
)

174 
”r
 ~ğ"O³¿tiÚ‡Ì—dy iÀ´og»ss" 
ªd
ƒ¼ ~ğ"timeout" 
th’


175 
£lf
.
	$_hªdË_cÚÃù_ç
(
”r
)

177 
’d


178 
£lf
.
add»ss
 =‡ddress

179 
£lf
.
pÜt
 =…ort

180 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
WRITE
)

181  0 -- 
Too
 
avoid
 
b»akšg
 
backw¬ds
 
com·b™y
.

182 
’d


183 
’d


185 --- 
R—d
 
uÁ
 
d–im™”
, 
th’
 
ÿÎ
 
ÿÎback
 
w™h
 
»ûive
 
d©a
. 
The
 callback

186 -- 
»ûives
 
the
 
d©a
 
»ad
 
as
 
a
 
·¿m‘”
. 
D–im™”
 
is
 
¶aš
 
‹xt
, 
ªd
 
dÛs


187 -- 
nÙ
 
suµÜt
 
Lua
 
·‰”ns
. 
S“
 
»ad_uÁ_·‰”n
 
th©
 
funùiÚ®™y
.

188 -- 
»ad_uÁ
 
should
 
be
 
u£d
 
š¡—d
 
of
 
»ad_uÁ_·‰”n
 
wh”ev”
 
possibË


189 -- 
beÿu£
 
of
 
the
 
ov”h—d
 oà
došg
 
·‰”n
 
m©chšg
.

190 -- @
·¿m
 
	$d–im™”
 (
SŒšg
è
D–im™”
 
£qu’û
, 
‹xt
 
Ü
 
bš¬y
.

191 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
funùiÚ
.

192 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
. 
If
‡rg 
is
 
giv’
 
th’
 
™
 
wl


193 -- 
be
 
the
 
fœ¡
 
¬gum’t
 th
ÿÎback
 
ªd
h
d©a
 
wl
 bth
£cÚd
.

194 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$»ad_uÁ
(
d–im™”
, 
ÿÎback
, 
¬g
)

195 
	`as£¹
((
nÙ
 
£lf
.
_»ad_ÿÎback
), "Already„eading.")

196 
£lf
.
_»ad_d–im™”
 = 
d–im™”


197 
£lf
.
_»ad_ÿÎback
 = 
ÿÎback


198 
£lf
.
_»ad_ÿÎback_¬g
 = 
¬g


199 
£lf
.
_»ad_sÿn_off£t
 = 0

200 
£lf
:
	$_š™Ÿl_»ad
()

201 
’d


203 --- 
R—d
 
uÁ
 
·‰”n
 
is
 
m©ched
, 
th’
 
ÿÎ
 
ÿÎback
 
w™h
 
»ûive
 
d©a
.

204 -- 
The
 
ÿÎback
 
»ûives
 
the
 
d©a
 
»ad
 
as
 
a
 
·¿m‘”
. 
If
 
you
 
Úly
 
¬e


205 -- 
došg
 
¶aš
 
‹xt
 
m©chšg
 
th’
 
usšg
 
»ad_uÁ
 
is
 
»comm’ded
 

206 -- 
Ëss
 
ov”h—d
.

207 -- @
·¿m
 
	$·‰”n
 (
SŒšg
è
Lua
 
·‰”n
 
¡ršg
.

208 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
funùiÚ
.

209 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
. 
If
‡rg 
is
 
giv’
 
th’
 
™
 
wl


210 -- 
be
 
the
 
fœ¡
 
¬gum’t
 th
ÿÎback
 
ªd
h
d©a
 
wl
 bth
£cÚd
.

211 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$»ad_uÁ_·‰”n
(
·‰”n
, 
ÿÎback
, 
¬g
)

212 
	`as£¹
(
	`ty³
(
·‰”n
) == "string", "Pattern, is‚ot‡ string.")

213 
£lf
.
_»ad_ÿÎback
 = 
ÿÎback


214 
£lf
.
_»ad_ÿÎback_¬g
 = 
¬g


215 
£lf
.
_»ad_·‰”n
 = 
·‰”n


216 
£lf
.
_»ad_sÿn_off£t
 = 0

217 
£lf
:
	$_š™Ÿl_»ad
()

218 
’d


220 --- 
C®l
 
ÿÎback
 
wh’
 
we
 
»ad
 
the
 
giv’
 
numb”
 
of
 
by‹s
.

221 -- 
If
 
a
 
¡»amšg_ÿÎback
 
¬gum’t
 
is
 
giv’
, 
™
 
wl
 
be
 
ÿÎed
 
w™h
 
chunks


222 -- 
of
 
d©a
 
as
 
they
 
become
 
avaabË
, 
ªd
 
the
 
¬gum’t
 
to
h
fš®
 
ÿÎ
o

223 -- 
ÿÎback
 
wl
 
be
 
em±y
.

224 -- @
·¿m
 
	$num_by‹s
 (
Numb”
è
The
 
amouÁ
 
of
 
by‹s
 
to
 
»ad
.

225 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
funùiÚ
.

226 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
. 
If
‡rg 
is
 
giv’
 
th’
 
™
 
wl


227 -- 
be
 
the
 
fœ¡
 
¬gum’t
 th
ÿÎback
 
ªd
h
d©a
 
wl
 bth
£cÚd
.

228 -- @
·¿m
 
	$¡»amšg_ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
ÿÎback
 
to
 
be
 
ÿÎed
 
as


229 -- 
chunks
 
become
 
avaabË
.

230 -- @
·¿m
 
¡»amšg_¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
. 
If
 
¬g
 
is
 
giv’
 
th’


231 -- 
™
 
wl
 
be
 
the
 
fœ¡
 
¬gum’t
 th
ÿÎback
 
ªd
h
d©a
 will behe

232 -- 
£cÚd
.

233 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$»ad_by‹s
(
num_by‹s
, 
ÿÎback
, 
¬g
,

234 
¡»amšg_ÿÎback
, 
¡»amšg_¬g
)

235 
	`as£¹
((
nÙ
 
£lf
.
_»ad_ÿÎback
), "Already„eading.")

236 
	`as£¹
(
	`ty³
(
num_by‹s
) == 'number',

238 
£lf
.
_»ad_by‹s
 = 
num_by‹s


239 
£lf
.
_»ad_ÿÎback
 = 
ÿÎback


240 
£lf
.
_»ad_ÿÎback_¬g
 = 
¬g


241 
£lf
.
_¡»amšg_ÿÎback
 = 
¡»amšg_ÿÎback


242 
£lf
.
_¡»amšg_ÿÎback_¬g
 = 
¡»amšg_¬g


243 
£lf
:
	$_š™Ÿl_»ad
()

244 
’d


247 --- 
R—ds
 
®l
 
d©a
 
äom
 
the
 
sock‘
 
uÁ
 
™
 
is
 
şo£d
.

248 -- 
If
 
a
 
¡»amšg_ÿÎback
 
¬gum’t
 
is
 
giv’
, 
™
 
wl
 
be
 
ÿÎed
 
w™h
 
chunks
 
of


249 -- 
d©a
 
as
 
they
 
become
 
avaabË
, 
ªd
 
the
 
¬gum’t
 
to
h
fš®
 
ÿÎ
o

250 -- 
ÿÎback
 
wl
 
cÚš
 
the
 
fš®
 
chunk
. 
This
 
m‘hod
 
»¥eùs
he

251 -- 
max_bufãr_size
 
£t
 
š
 
the
 
IOSŒ—m
 
š¡ªû
.

252 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
funùiÚ
.

253 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
. 
If
‡rg 
is
 
giv’
 
th’
 
™
 
wl


254 -- 
be
 
the
 
fœ¡
 
¬gum’t
 th
ÿÎback
 
ªd
h
d©a
 
wl
 bth
£cÚd
.

255 -- @
·¿m
 
	$¡»amšg_ÿÎback
 (
FunciÚ
è
O±iÚ®
 
ÿÎback
 
to
 
be
 
ÿÎed
 
as


256 -- 
chunks
 
become
 
avaabË
.

257 -- @
·¿m
 
¡»amšg_¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
. 
If
 
¬g
 
is
 
giv’
 
th’


258 -- 
™
 
wl
 
be
 
the
 
fœ¡
 
¬gum’t
 th
ÿÎback
 
ªd
h
d©a
 will behe

259 -- 
£cÚd
.

260 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$»ad_uÁ_şo£
(
ÿÎback
, 
¬g
, 
¡»amšg_ÿÎback
,

261 
¡»amšg_¬g
)

262 
£lf
.
_»ad_ÿÎback
 
th’


263 
	`”rÜ
("Already„eading.")

264 
’d


265 
£lf
:
	$şo£d
(è
th’


266 
£lf
:
	`_run_ÿÎback
(
ÿÎback
, 
¬g
,

267 
£lf
:
	$_cÚsume
(
£lf
.
_»ad_bufãr_size
))

269 
’d


270 
£lf
.
_»ad_uÁ_şo£
 = 
Œue


271 
£lf
.
_»ad_ÿÎback
 = 
ÿÎback


272 
£lf
.
_»ad_ÿÎback_¬g
 = 
¬g


273 
£lf
.
_¡»amšg_ÿÎback
 = 
¡»amšg_ÿÎback


274 
£lf
.
_¡»amšg_ÿÎback_¬g
 = 
¡»amšg_¬g


275 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
READ
)

276 
’d


278 --- 
Wr™e
 
the
 
giv’
 
d©a
 
to
h
¡»am
.

279 -- 
If
 
ÿÎback
 
is
 
giv’
, 
we
 
ÿÎ
 
™
 
wh’
 
®l
 
of
 
the
 
bufã»d
 
wr™e
 
d©a
 
has


280 -- 
b“n
 
sucûssfuÎy
 
wr™‹n
 
to
 
the
 
¡»am
. 
If
 
th”e
 
was
 
´eviou¦y
 
bufã»d


281 -- 
wr™e
 
d©a
 
ªd
 
ª
 
Şd
 wr™
ÿÎback
, 
th©
 c®lback 
is
 
sim¶y
 
ov”wr™‹n


282 -- 
w™h
 
this
 
Ãw
 
ÿÎback
.

283 -- @
·¿m
 
	$d©a
 (
SŒšg
è
D©a
 
to
 
wr™e
Ø
¡»am
.

284 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
ÿÎback
 
to
 
ÿÎ
 
wh’
 
chunk
 
is
 
æushed
.

285 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
.

286 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$wr™e
(
d©a
, 
ÿÎback
, 
¬g
)

287 
£lf
.
_cÚ¡_wr™e_bufãr
 
th’


288 
	`”rÜ
(
¡ršg
.
	`fÜm©
("\
‚ot…erform write whenhere is‡ ongoing \
 copy write operation. At offset %d of %d bytes",

291 
	`tÚumb”
(
£lf
.
_wr™e_bufãr_off£t
),

292 
	`tÚumb”
(
£lf
.
_cÚ¡_wr™e_bufãr
:
	$Ën
())))

293 
’d


294 
£lf
:
	$_check_şo£d
()

295 
£lf
.
_wr™e_bufãr
:
	$­³nd_lua¡r_right
(
d©a
)

296 
£lf
.
_wr™e_bufãr_size
 = s–f._wr™e_bufãr_siz+ 
d©a
:
	$Ën
()

297 
£lf
.
_wr™e_ÿÎback
 = 
ÿÎback


298 
£lf
.
_wr™e_ÿÎback_¬g
 = 
¬g


299 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
WRITE
)

300 
£lf
:
	$_maybe_add_”rÜ_li¡’”
()

301 
’d


303 --- 
Wr™e
 
the
 
giv’
 
bufãr
 
şass
 
š¡ªû
 
to
h
¡»am
.

304 -- @
·¿m
 
	`buf
 (
Bufãr
 
şass
 
š¡ªû
).

305 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
ÿÎback
 
to
 
ÿÎ
 
wh’
 
chunk
 
is
 
æushed
.

306 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
.

307 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$wr™e_bufãr
(
buf
, 
ÿÎback
, 
¬g
)

308 
£lf
.
_cÚ¡_wr™e_bufãr
 
th’


309 
	`”rÜ
(
¡ršg
.
	`fÜm©
("\
‚ot…erform write whenhere is‡ ongoing \
 copy write operation. At offset %d of %d bytes",

312 
	`tÚumb”
(
£lf
.
_wr™e_bufãr_off£t
),

313 
	`tÚumb”
(
£lf
.
_cÚ¡_wr™e_bufãr
:
	$Ën
())))

314 
’d


315 
£lf
:
	$_check_şo£d
()

316 
loÿl
 
±r
, 
sz
 = 
buf
:
	$g‘
()

317 
£lf
.
_wr™e_bufãr
:
	$­³nd_right
(
±r
, 
sz
)

318 
£lf
.
_wr™e_bufãr_size
 = s–f._wr™e_bufãr_siz+ 
sz


319 
£lf
.
_wr™e_ÿÎback
 = 
ÿÎback


320 
£lf
.
_wr™e_ÿÎback_¬g
 = 
¬g


321 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
WRITE
)

322 
£lf
:
	$_maybe_add_”rÜ_li¡’”
()

323 
’d


325 --- 
Wr™e
 
the
 
giv’
 
bufãr
 
şass
 
š¡ªû
 
to
h
¡»am
 
w™hout


326 -- 
cİyšg
. 
This
 
m—ns
 
th©
 
this
 
wr™e
 
MUST
 
com¶‘e
 
befÜe
 
ªy
 
Ùh”


327 -- 
wr™es
 
ÿn
 
be
 
³rfÜmed
. 
Th”e
 
is
 
a
 
b¬r›r
 
š
 
¶aû
 
to
 
¡İ
 
this
 
äom


328 -- 
h­³nšg
. 
A
 
”rÜ
 
is
 
¿i£d
 
this
 
h­³ns
. 
This
 
m‘hod
 i 
»comm’ded


329 -- 
wh’
 
you
 
¬e
 
£rvšg
 
d©a
, 
™
 
»äašs
 
äom
 
cİyšg
 
the
 
cÚ‹Ás
 
of


330 -- 
the
 
bufãr
 
što
 
™s
 
š‹º®
 bufãr, 
©
h
co¡
 
of
 
nÙ
 
®lowšg


331 -- 
mÜe
 
d©a
 
bešg
 
added
 
to
 
the
 
š‹º®
 
bufãr
 
befÜe
 
this
 
wr™e
 
is
 
fšished
.

332 -- @
·¿m
 
	$buf
 (
Bufãr
 
şass
 
š¡ªû
è
Wl
 
nÙ
 
be
 
modif›d
.

333 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
O±iÚ®
 
ÿÎback
 
to
 
ÿÎ
 
wh’
 
chunk
 
is
 
æushed
.

334 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
.

335 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


336 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$wr™e_z”o_cİy
(
buf
, 
ÿÎback
, 
¬g
)

337 
£lf
.
_wr™e_bufãr_size
 ~ğ0 
th’


338 
	`”rÜ
(
¡ršg
.
	`fÜm©
("\
‚ot…erform zero copy write whenhere‡re \
 writes in stream. At offset %d of %d bytes. \
 buffer size: %d",

342 
	`tÚumb”
(
£lf
.
_wr™e_bufãr_off£t
),

343 
	`tÚumb”
(
£lf
.
_wr™e_bufãr
:
	`Ën
()),

344 
£lf
.
_wr™e_bufãr_size
))

345 
’d


346 
£lf
:
	$_check_şo£d
()

347 
£lf
.
_cÚ¡_wr™e_bufãr
 = 
buf


348 
£lf
.
_wr™e_bufãr_off£t
 = 0

349 
£lf
.
_wr™e_ÿÎback
 = 
ÿÎback


350 
£lf
.
_wr™e_ÿÎback_¬g
 = 
¬g


351 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
WRITE
)

352 
£lf
:
	$_maybe_add_”rÜ_li¡’”
()

353 
’d


355 -- 
wr™e_z”o_cİy
 
is
 
nÙ
 
suµÜ‹d
 
Ú
 
LuaSock‘
. 
It
 
gives
 
no


356 -- 
b’ef™
 
as
 
LuaSock‘
 
Úly
 
d—ls
 
š
 
Lua
 
¡ršgs
...

357 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$wr™e_z”o_cİy
(
buf
, 
ÿÎback
, 
¬g
)

358 
£lf
.
_wr™e_bufãr_size
 ~ğ0 
th’


359 
	`”rÜ
(
¡ršg
.
	`fÜm©
("\
‚ot…erform zero copy write whenhere‡re \
 writes in stream. At offset %d of %d bytes. \
 buffer size: %d",

363 
	`tÚumb”
(
£lf
.
_wr™e_bufãr_off£t
),

364 
	`tÚumb”
(
£lf
.
_wr™e_bufãr
:
	`Ën
()),

365 
£lf
.
_wr™e_bufãr_size
))

366 
’d


367 
loÿl
 
±r
, 
sz
 = 
buf
:
	$g‘
()

368 
loÿl
 
¡r
 = 
ffi
.
	$¡ršg
(
±r
, 
sz
)

369 
£lf
:
	$wr™e
(
¡r
, 
ÿÎback
, 
¬g
)

370 
’d


371 
’d


373 --- 
A»
 
the
 
¡»am
 
cu¼’y
 
bešg
 
»ad
 
äom
?

374 -- @ (
BoŞ—n
è
Œue
 
Ü
 
çl£


375 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$»adšg
()

376  
£lf
.
_»ad_ÿÎback
 
ªd
 
Œue
 
Ü
 
çl£


377 
’d


379 --- 
A»
 
the
 
¡»am
 
cu¼’y
 
bešg
 
wr™‹n
 
too
.

380 -- @ (
BoŞ—n
è
Œue
 
Ü
 
çl£


381 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$wr™šg
()

382  
£lf
.
_wr™e_bufãr_size
 ~ğ0 
Ü
 s–f.
_cÚ¡_wr™e_bufãr


383 
’d


385 --- 
S‘
 
ÿÎback
 
to
 
be
 
ÿÎed
 
wh’
 
cÚÃùiÚ
 
is
 
şo£d
.

386 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
funùiÚ
.

387 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
.

388 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$£t_şo£_ÿÎback
(
ÿÎback
, 
¬g
)

389 
£lf
.
_şo£_ÿÎback
 = 
ÿÎback


390 
£lf
.
_şo£_ÿÎback_¬g
 = 
¬g


391 
’d


393 --- 
S‘s
 
the
 
giv’
 
ÿÎback
 
to
 
be
 
ÿÎed
 
wh’
h
bufãr
 
has
 
b“n
 
exûeded


394 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
funùiÚ
.

395 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
.

396 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$£t_maxed_bufãr_ÿÎback
(
ÿÎback
, 
¬g
)

397 
£lf
.
_maxb_ÿÎback
 = 
ÿÎback


398 
£lf
.
_maxb_ÿÎback_¬g
 = 
¬g


399 
’d


401 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$£t_max_bufãr_size
(
sz
)

402 
	`ty³
(
sz
è~ğ"numb”" 
th’


404 
’d


405 
sz
 < 
TURBO_SOCKET_BUFFER_SZ
 
th’


406 
log
.
	`w¬nšg
(

407 
¡ršg
.
	`fÜm©
("Max buffer size could‚ot be seto†ower value "..

409 
TURBO_SOCKET_BUFFER_SZ
 + 8))

410 
sz
 = 
TURBO_SOCKET_BUFFER_SZ
 + 8

411 
’d


412 
£lf
.
max_bufãr_size
 = 
sz


413 
’d


415 --- 
Clo£
 
this
 
¡»am
 
ªd
 
ş—n
 
up
.

416 -- 
C®l
 
şo£
 
ÿÎback
 
£t
.

417 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$şo£
()

418 
£lf
.
sock‘
 
th’


419 --
log
.
	`dev–
("[io¡»am.lua] Closšg sock‘ " .. 
	$to¡ršg
(
£lf
.
sock‘
))

420 
£lf
.
_»ad_uÁ_şo£
 
th’


421 
loÿl
 
ÿÎback
 = 
£lf
.
_»ad_ÿÎback


422 
loÿl
 
¬g
 = 
£lf
.
_»ad_ÿÎback_¬g


423 
£lf
.
_»ad_ÿÎback
 = 
n


424 
£lf
.
_»ad_ÿÎback_¬g
 = 
n


425 
£lf
.
_»ad_uÁ_şo£
 = 
çl£


426 
£lf
:
	`_run_ÿÎback
(
ÿÎback
, 
¬g
,

427 
£lf
:
	$_cÚsume
(
£lf
.
_»ad_bufãr_size
))

428 
’d


429 
£lf
.
_¡©e
 
th’


430 
£lf
.
io_loİ
:
	$»move_hªdËr
(
£lf
.
sock‘
)

431 
£lf
.
_¡©e
 = 
n


432 
’d


433 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


434 
C
.
	$şo£
(
£lf
.
sock‘
)

436 
£lf
.
sock‘
:
	$şo£
()

437 
’d


438 
£lf
.
sock‘
 = 
n


439 
£lf
.
_şo£_ÿÎback
 
ªd
 s–f.
_³ndšg_ÿÎbacks
 =ğ0 
th’


440 
loÿl
 
ÿÎback
 = 
£lf
.
_şo£_ÿÎback


441 
loÿl
 
¬g
 = 
£lf
.
_şo£_ÿÎback_¬g


442 
£lf
.
_şo£_ÿÎback
 = 
n


443 
£lf
.
_şo£_ÿÎback_¬g
 = 
n


444 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

445 
’d


446 
’d


447 
’d


449 --- 
Is
 
the
 
¡»am
 
şo£d
?

450 -- @ (
BoŞ—n
è
Œue
 
Ü
 
çl£


451 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$şo£d
()

452 
£lf
.
sock‘
 
th’


453  
çl£


455  
Œue


456 
’d


457 
’d


459 --- 
In™Ÿl
 
šlše
 
»ad
 »ad 
m‘hods
.

460 -- 
If
 
»ad
 
is
 
nÙ
 
possibË
 
©
 
this
 
time
, 
™
 i 
added
 
to
 
IOLoİ
.

461 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_š™Ÿl_»ad
()

462 
Œue
 do

463 
£lf
:
	`_»ad_äom_bufãr
(è=ğ
Œue
 
th’


465 
’d


466 
£lf
:
	$_check_şo£d
()

467 
£lf
:
	`_»ad_to_bufãr
(è=ğ0 
th’


469 
’d


470 
’d


471 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
READ
)

472 
’d


474 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_cÚÃù_ç
(
”r
)

475 
loÿl
 
cb
 = 
£lf
.
_cÚÃù_ç_ÿÎback


476 
loÿl
 
¬g
 = 
£lf
.
_cÚÃù_ÿÎback_¬g


477 
£lf
.
_cÚÃù_ç_ÿÎback
 = 
n


478 
£lf
.
_cÚÃù_ÿÎback
 = 
n


479 
£lf
.
_cÚÃù_ÿÎback_¬g
 = 
n


480 
£lf
.
_cÚÃùšg
 = 
çl£


481 
¬g
 
th’


482 
	$cb
(
¬g
, 
”r
)

484 
	$cb
(
”r
)

485 
’d


486 
’d


488 --- 
Maš
 
ev’t
 
hªdËr
 
the
 
IOSŒ—m
.

489 -- @
·¿m
 
	$fd
 (
Numb”
è
Fe
 
desütÜ
.

490 -- @
·¿m
 
	$ev’ts
 (
Numb”
è
B™
 
mask
 
of
 
avaabË
 
ev’ts
 
giv’
 
fd
.

491 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_ev’ts
(
fd
, 
ev’ts
)

492 
nÙ
 
£lf
.
sock‘
 
th’


493 -- 
CÚÃùiÚ
 
has
 
b“n
 
şo£d
. 
Cª
 
nÙ
 
hªdË
 
ev’ts
...

494 
log
.
	`w¬nšg
(

495 
¡ršg
.
	`fÜm©
("GÙƒv’t fÜ clo£d sŒ—m oÀfd %d.", 
fd
))

497 
’d


498 -- 
HªdË
 
difã»Á
 
ev’ts
.

499 
	`b™ªd
(
ev’ts
, 
iŞoİ
.
READ
è~ğ0 
th’


500 
£lf
:
	$_hªdË_»ad
()

501 
’d


502 -- 
We
 
mu¡
 
check
 
the
 
sock‘
 
has
 
b“n
 
şo£d
 
aá”
 
hªdlšg


503 -- 
the
 
»ad
!

504 
nÙ
 
£lf
.
sock‘
 
th’


506 
’d


507 
	`b™ªd
(
ev’ts
, 
iŞoİ
.
WRITE
è~ğ0 
th’


508 
£lf
.
_cÚÃùšg
 
th’


509 
£lf
:
	$_hªdË_cÚÃù
()

510 
’d


511 
£lf
:
	$_hªdË_wr™e
()

512 
’d


513 
nÙ
 
£lf
.
sock‘
 
th’


515 
’d


516 
	`b™ªd
(
ev’ts
, 
iŞoİ
.
ERROR
è~ğ0 
th’


517 
loÿl
 
rc
, 
”r
 = 
sock‘
.
	$g‘_sock‘_”rÜ
(
£lf
.
sock‘
)

518 
rc
 =ğ0 
th’


519 
£lf
.
”rÜ
 = 
”r


520 
’d


521 -- 
We
 
may
 
have
 
queued
 
up
 
a
 
u£r
 
ÿÎback
 
š
 
_hªdË_»ad
 
Ü


522 -- 
_hªdË_wr™e
, 
so
 
dÚ
't closehe IOStream untilhose

523 -- 
ÿÎbacks
 
have
 
had
 
a
 
chªû
 
to
 
run
.

524 
£lf
.
io_loİ
:
	$add_ÿÎback
(
£lf
.
şo£
, self)

526 
’d


527 
loÿl
 
¡©e
 = 
iŞoİ
.
ERROR


528 
£lf
:
	$»adšg
(è
th’


529 
¡©e
 = 
	$b™Ü
(
¡©e
, 
iŞoİ
.
READ
)

530 
’d


531 
£lf
:
	$wr™šg
(è
th’


532 
¡©e
 = 
	$b™Ü
(
¡©e
, 
iŞoİ
.
WRITE
)

533 
’d


534 
¡©e
 =ğ
iŞoİ
.
ERROR
 
th’


535 
¡©e
 = 
	$b™Ü
(
¡©e
, 
iŞoİ
.
READ
)

536 
’d


537 
¡©e
 ~ğ
£lf
.
_¡©e
 
th’


538 
	`as£¹
(
£lf
.
_¡©e
, "no self._state set")

539 
£lf
.
_¡©e
 = 
¡©e


540 
£lf
.
io_loİ
:
	$upd©e_hªdËr
(
£lf
.
sock‘
, s–f.
_¡©e
)

541 
’d


542 
’d


544 --- 
E¼Ü
 
hªdËr
 
IOSŒ—m
 
ÿÎbacks
.

545 
loÿl
 
funùiÚ
 
	$_run_ÿÎback_”rÜ_hªdËr
(
”r
)

546 
loÿl
 
th»ad
 = 
cÜoutše
.
	$ruÂšg
()

547 
loÿl
 
Œaû
 = 
debug
.
	`Œaûback
(
cÜoutše
.
	`ruÂšg
(), 
”r
, 2)

548 
loÿl
 
_¡r_bÜd”s_down
 = 
¡ršg
.
	`»p
("â–¼", 80)

549 
loÿl
 
_¡r_bÜd”s_up
 = 
¡ršg
.
	`»p
("â–²", 80)

551 
log
.
	`”rÜ
(

552 
¡ršg
.
	`fÜm©
(

554 
th»ad
,

555 
_¡r_bÜd”s_down
,

556 
Œaû
,

557 
_¡r_bÜd”s_up
))

558 
’d


560 
loÿl
 
funùiÚ
 
	$_run_ÿÎback_´Ùeùed
(
ÿÎ
)

561 
loÿl
 
¡»am
, 
ÿÎback
, 
»s
, 
¬g
 = 
ÿÎ
[1], call[2], call[3], call[4]

562 
loÿl
 
sucûss
 = 
çl£


563 -- 
Remove
 1 
³ndšg
 
ÿÎback
 
äom
 
IOSŒ—m
 
š¡ªû
.

564 
¡»am
.
_³ndšg_ÿÎbacks
 = stream._pending_callbacks - 1

566 
¬g
 
th’


567 -- 
C®lback
 
¬gum’t
. 
Fœ¡
‡rgum’ˆ
should
 
be
 
this
 
to
 
®low
 
£lf


568 -- 
»ã»nûs
 
to
 
be
 
u£d
 
as
 
¬gum’t
.

569 
sucûss
 = 
	$xpÿÎ
(

570 
ÿÎback
,

571 
_run_ÿÎback_”rÜ_hªdËr
,

572 
¬g
,

573 
»s
)

575 
sucûss
 = 
	$xpÿÎ
(

576 
ÿÎback
,

577 
_run_ÿÎback_”rÜ_hªdËr
,

578 
»s
)

579 
’d


580 
sucûss
 =ğ
çl£
 
th’


581 
¡»am
:
	$şo£
()

582 
’d


583 
’d


585 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
, 
d©a
)

586 
£lf
:
	$_maybe_add_”rÜ_li¡’”
()

587 
£lf
.
_³ndšg_ÿÎbacks
 = self._pending_callbacks + 1

588 -- 
Add
 
ÿÎback
 
to
 
IOLoİ
 
š¡—d
 
of
 
ÿÎšg
 
™
 
¡¿ight
 
away
.

589 -- 
This
 
is
 
to
 
´ovide
 
a
 
cÚsi¡’t
 
¡ack
 
growth
, 
®so


590 -- 
y›ldšg
 
to
 
hªdË
 
Ùh”
 
sks
 
š
 
the
 
IOLoİ
.

591 
£lf
.
io_loİ
:
	`add_ÿÎback
(
_run_ÿÎback_´Ùeùed
,

592 {
£lf
, 
ÿÎback
, 
d©a
, 
¬g
})

593 
’d


595 
funùiÚ
 
	gio¡»am
.
	gIOSŒ—m
:
	$_maybe_run_şo£_ÿÎback
()

596 
£lf
:
	`şo£d
(è=ğ
Œue
 
ªd
 s–f.
_şo£_ÿÎback
‡nd

597 
£lf
.
_³ndšg_ÿÎbacks
 =ğ0 
th’


598 
loÿl
 
cb
 = 
£lf
.
_şo£_ÿÎback


599 
loÿl
 
¬g
 = 
£lf
.
_şo£_ÿÎback_¬g


600 
£lf
.
_şo£_ÿÎback
 = 
n


601 
£lf
.
_şo£_ÿÎback_¬g
 = 
n


602 
£lf
:
	$_run_ÿÎback
(
cb
, 
¬g
)

603 
£lf
.
_»ad_ÿÎback
 = 
n


604 
£lf
.
_»ad_ÿÎback_¬g
 = 
n


605 
£lf
.
_wr™e_ÿÎback
 = 
n


606 
£lf
.
_wr™e_ÿÎback_¬g
 = 
n


607 
’d


608 
’d


610 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_»ad
()

611 
£lf
.
_³ndšg_ÿÎbacks
 = self._pending_callbacks + 1

612 
nÙ
 
£lf
:
	$şo£d
() do

613 -- 
R—d
 
äom
 
sock‘
 
uÁ
 
we
 
g‘
 
EWOULDBLOCK
 
Ü
 
equiv®›Á
.

614 
£lf
:
	`_»ad_to_bufãr
(è=ğ0 
th’


616 
’d


617 
’d


618 
£lf
.
_³ndšg_ÿÎbacks
 = self._pending_callbacks - 1

619 
£lf
:
	`_»ad_äom_bufãr
(è=ğ
Œue
 
th’


622 
£lf
:
	$_maybe_run_şo£_ÿÎback
()

623 
’d


624 
’d


626 --- 
R—ds
 
äom
 
the
 
sock‘
. 
R‘uº
h
d©a
 
chunk
 
Ü
 
n
 
th”es
 
nÙhšg
 
to


627 -- 
»ad
, 
š
 
the
 
of
 
EWOULDBLOCK
 
Ü
 
equiv®’t
.

628 -- @ 
Chunk
 
of
 
d©a
.

629 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


630 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_»ad_äom_sock‘
()

631 
loÿl
 
”ºo


632 
loÿl
 
bufãr_Ëá
 = 
£lf
.
max_bufãr_size
 - s–f.
_»ad_bufãr_size


633 
bufãr_Ëá
 =ğ0 
th’


634 
log
.
	`dev–
("Maximum„ead buffer size„eached. Throttling„ead.")

635 
£lf
.
_maxb_ÿÎback
 
th’


636 
£lf
:
	$_run_ÿÎback
(
£lf
.
_maxb_ÿÎback
,

637 
£lf
.
_maxb_ÿÎback_¬g
,

638 
£lf
.
_»ad_bufãr_size
)

639 
’d


641 
’d


642 
loÿl
 
sz
 = 
	`tÚumb”
(
C
.
	`»cv
(
£lf
.
sock‘
,

643 
buf
,

644 
TURBO_SOCKET_BUFFER_SZ
 < 
bufãr_Ëá
 
ªd


645 
TURBO_SOCKET_BUFFER_SZ
 
Ü
 
bufãr_Ëá
,

647 
sz
 =ğ-1 
th’


648 
”ºo
 = 
ffi
.
	$”ºo
()

649 
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EAGAIN
 
th’


652 
loÿl
 
fd
 = 
£lf
.
sock‘


653 
£lf
:
	$şo£
()

654 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

656 
fd
,

657 
”ºo
,

658 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

660 
’d


661 
’d


662 
sz
 =ğ0 
th’


663 
£lf
:
	$şo£
()

664  
n


665 
’d


666  
buf
, 
sz


667 
’d


669 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_»ad_äom_sock‘
()

670 
loÿl
 
”ºo
, 
şo£d


671 
loÿl
 
bufãr_Ëá
 = 
£lf
.
max_bufãr_size
 - s–f.
_»ad_bufãr_size


672 
bufãr_Ëá
 =ğ0 
th’


673 
log
.
	`dev–
("Maximum„ead buffer size„eached. Throttling„ead.")

674 
£lf
.
_maxb_ÿÎback
 
th’


675 
£lf
:
	$_run_ÿÎback
(
£lf
.
_maxb_ÿÎback
,

676 
£lf
.
_maxb_ÿÎback_¬g
,

677 
£lf
.
_»ad_bufãr_size
)

678 
’d


680 
’d


681 -- 
Put
 
buf
 
š
 
£lf
, 
to
 
k“p
 
»ã»nû
 
±r
 
aá”
 
’d
 
of
 
funùiÚ
.

682 
£lf
.
_luasock‘_buf
 = 
	`bufãr
(

683 
m©h
.
	`mš
(
TURBO_SOCKET_BUFFER_SZ
, 
	$tÚumb”
(
bufãr_Ëá
)))

684 
Œue
 do

685 -- 
Ok
, 
so
 
LuaSock‘
 
is
 
nÙ
 
»®ly
 
su™ed
 
this
 
¡uff
,

686 -- dØ
cÚ£cutive
 
ÿÎs
 
to
 
exhau¡
 
sock‘
 
ªd
 
fl
 
up
 
a
 
bufãr
...

687 -- 
TODO
: 
Make
 
su»
 
th©
 
max
 
bufãr
 
size
 
is
 
nÙ
 
exûeded
.

688 
loÿl
 
d©a
, 
”r
, 
·¹Ÿl
 = 
£lf
.
sock‘
:
	`»ûive
(

689 
m©h
.
	`mš
(
TURBO_SOCKET_BUFFER_SZ
, 
	$tÚumb”
(
bufãr_Ëá
)))

690 
d©a
 
th’


691 
£lf
.
_luasock‘_buf
:
	$­³nd_lua¡r_right
(
d©a
)

692 
–£if
 
”r
 =ğ"timeout" 
Ü
ƒ¼ =ğ"wªŒ—d" 
th’


693 
·¹Ÿl
:
	`Ën
(è=ğ0 
th’


696 
£lf
.
_luasock‘_buf
:
	$­³nd_lua¡r_right
(
·¹Ÿl
)

697 
’d


698 
–£if
 
”r
 =ğ"şo£d" 
th’


699 -- 
So
 
this
 
deãrs
 
somewh©
 
äom
 
the
 
FFI
 
v”siÚ
 
wh”e


700 -- 
a
 
discÚÃù
 
would
 
be
 
d‘eùed
 
by
 
pŞlšg
 
š¡—d
 
of


701 -- 
Ú
 
a
 
»ad
 
ev’t
, 
so
 
we
 
should
 
run
 
the
 
ÿÎback
 
as
 
usu®


702 -- 
w™hout
 
»pÜtšg
 
”rÜ
, 
but
 
¿th”
 
nÙ
 
acû±
 
fu¹h”


703 -- 
»ads
 
Ü
 
wr™es


704 
£lf
.
_luasock‘_buf
:
	$­³nd_lua¡r_right
(
·¹Ÿl
)

705 
şo£d
 = 
Œue


707 
–£if
 
”r
 
th’


708 
loÿl
 
fd
 = 
£lf
.
sock‘


709 
£lf
:
	$şo£
()

710 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

712 
fd
,

713 
”r
))

714 
’d


716 
’d


717 
£lf
.
_luasock‘_buf
:
	`Ën
(è> 0 
th’


718 
loÿl
 
±r
, 
sz
 = 
£lf
.
_luasock‘_buf
:
	$g‘
()

719  
±r
, 
sz
, 
şo£d


721  
n
,‚, 
şo£d


722 
’d


723 
’d


724 
’d


726 --- 
R—d
 
äom
 
the
 
sock‘
 
ªd
 
­³nd
 
to
h
»ad
 
bufãr
.

727 -- @ 
AmouÁ
 
of
 
by‹s
 
­³nded
 
to
 
£lf
.
_»ad_bufãr
.

728 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_»ad_to_bufãr
()

729 
loÿl
 
±r
, 
sz
, 
şo£d
 = 
£lf
:
	$_»ad_äom_sock‘
()

730 
nÙ
 
±r
 
th’


731 
şo£d
 
th’


732 
£lf
:
	$şo£
()

734 
’d


736 
’d


737 
£lf
.
_»ad_bufãr
:
	$­³nd_right
(
±r
, 
sz
)

738 
£lf
.
_»ad_bufãr_size
 = s–f._»ad_bufãr_siz+ 
sz


739 
şo£d
 
th’


740 
£lf
:
	$şo£
()

741 
’d


742 
£lf
.
_»ad_bufãr_size
 > s–f.
max_bufãr_size
 
th’


743 
log
.
	`”rÜ
('Reached maximum„ead buffer size')

744 
£lf
:
	$şo£
()

746 
’d


747  
sz


748 
’d


750 --- 
G‘
 
the
 
cu¼’t
 
»ad
 
bufãr
 
poš‹r
 
ªd
 
size
.

751 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_g‘_bufãr_±r
()

752 
loÿl
 
±r
, 
sz
 = 
£lf
.
_»ad_bufãr
:
	$g‘
()

753 
±r
 =…Œ + 
£lf
.
_»ad_bufãr_off£t


754 
sz
 = sz - 
£lf
.
_»ad_bufãr_off£t


755  
±r
, 
sz


756 
’d


758 --- 
A‰em±s
 
to
 
com¶‘e
 
the
 
cu¼’y
 
³ndšg
 
»ad
 
äom
h
bufãr
.

759 -- @ (
BoŞ—n
è
R‘uºs
 
Œue
 
the
 
’qued
 
»ad
 
was
 
com¶‘ed
, 
çl£
.

760 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	`_»ad_äom_bufãr
()

761 -- 
HªdË
 
¡»amšg
 
ÿÎbacks
 
fœ¡
.

762 
£lf
.
_¡»amšg_ÿÎback
 ~ğ
n
 
ªd
 s–f.
_»ad_bufãr_size
 ~ğ0 
th’


763 
loÿl
 
by‹s_to_cÚsume
 = 
£lf
.
_»ad_bufãr_size


764 
£lf
.
_»ad_by‹s
 ~ğ
n
 
th’


765 
by‹s_to_cÚsume
 = 
	$mš
(
£lf
.
_»ad_by‹s
, 
by‹s_to_cÚsume
)

766 
£lf
.
_»ad_by‹s
 = s–f._»ad_by‹ - 
by‹s_to_cÚsume


767 
£lf
:
	`_run_ÿÎback
(£lf.
_¡»amšg_ÿÎback
,

768 
£lf
.
_¡»amšg_ÿÎback_¬g
,

769 
£lf
:
	$_cÚsume
(
by‹s_to_cÚsume
))

771 
£lf
:
	`_run_ÿÎback
(£lf.
_¡»amšg_ÿÎback
,

772 
£lf
.
_¡»amšg_ÿÎback_¬g
,

773 
£lf
:
	$_cÚsume
(
by‹s_to_cÚsume
))

774 
’d


775 
’d


776 -- 
HªdË
 
»ad_by‹s
.

777 
£lf
.
_»ad_by‹s
 ~ğ
n
 
ªd


778 
£lf
.
_»ad_bufãr_size
 >ğ£lf.
_»ad_by‹s
 
th’


779 
loÿl
 
num_by‹s
 = 
£lf
.
_»ad_by‹s


780 
loÿl
 
ÿÎback
 = 
£lf
.
_»ad_ÿÎback


781 
loÿl
 
¬g
 = 
£lf
.
_»ad_ÿÎback_¬g


782 
£lf
.
_»ad_ÿÎback
 = 
n


783 
£lf
.
_»ad_ÿÎback_¬g
 = 
n


784 
£lf
.
_¡»amšg_ÿÎback
 = 
n


785 
£lf
.
_¡»amšg_ÿÎback_¬g
 = 
n


786 
£lf
.
_»ad_by‹s
 = 
n


787 
£lf
:
	`_run_ÿÎback
(
ÿÎback
, 
¬g
, s–f:
	$_cÚsume
(
num_by‹s
))

788  
Œue


789 -- 
HªdË
 
»ad_uÁ
.

790 
–£if
 
£lf
.
_»ad_d–im™”
 ~ğ
n
 
th’


791 
£lf
.
_»ad_bufãr_size
 ~ğ0 
th’


792 
loÿl
 
±r
, 
sz
 = 
£lf
:
	$_g‘_bufãr_±r
()

793 
loÿl
 
d–im™”_sz
 = 
£lf
.
_»ad_d–im™”
:
	$Ën
()

794 
loÿl
 
sÿn_±r
 = 
±r
 + 
£lf
.
_»ad_sÿn_off£t


795 
sz
 = sz - 
£lf
.
_»ad_sÿn_off£t


796 
loÿl
 
loc
 = 
ut
.
	`¡r_fšd
(

797 
sÿn_±r
,

798 
ffi
.
	`ÿ¡
("ch¬ *", 
£lf
.
_»ad_d–im™”
),

799 
sz
,

800 
d–im™”_sz
)

801 
loc
 
th’


802 
loc
 =†oø- 
±r


803 
loÿl
 
d–im™”_’d
 = 
loc
 + 
d–im™”_sz


804 
loÿl
 
ÿÎback
 = 
£lf
.
_»ad_ÿÎback


805 
loÿl
 
¬g
 = 
£lf
.
_»ad_ÿÎback_¬g


806 
£lf
.
_»ad_ÿÎback
 = 
n


807 
£lf
.
_»ad_ÿÎback_¬g
 = 
n


808 
£lf
.
_¡»amšg_ÿÎback
 = 
n


809 
£lf
.
_¡»amšg_ÿÎback_¬g
 = 
n


810 
£lf
.
_»ad_d–im™”
 = 
n


811 
£lf
.
_»ad_sÿn_off£t
 = 
d–im™”_’d


812 
¬g
 
th’


813 
£lf
:
	`_run_ÿÎback
(
ÿÎback
,

814 
¬g
,

815 
£lf
:
	$_cÚsume
(
d–im™”_’d
))

817 
£lf
:
	`_run_ÿÎback
(
ÿÎback
, s–f:
	$_cÚsume
(
d–im™”_’d
))

818 
’d


819  
Œue


820 
’d


821 
£lf
.
_»ad_sÿn_off£t
 = 
sz


822 
’d


823 -- 
HªdË
 
»ad_uÁ_·‰”n
.

824 
–£if
 
£lf
.
_»ad_·‰”n
 ~ğ
n
 
th’


825 
£lf
.
_»ad_bufãr_size
 ~ğ0 
th’


826 -- 
Slow
 
bufãr
 
to
 
Lua
 
¡ršg
 
cÚv”siÚ
Ø
suµÜt
 Lu¨
·‰”ns
.

827 -- 
Made
 
ev’
 
wÜ£
 
by
 
a
 
Ãw
 
®loÿtiÚ
 
š
 
£lf
:
_cÚsume
 
of
‡

828 -- 
difã»Á
 
size
.

829 
loÿl
 
±r
, 
sz
 = 
£lf
:
	$_g‘_bufãr_±r
()

830 
±r
 =…Œ + 
£lf
.
_»ad_sÿn_off£t


831 
sz
 = sz - 
£lf
.
_»ad_sÿn_off£t


832 
loÿl
 
chunk
 = 
ffi
.
	$¡ršg
(
±r
, 
sz
)

833 
loÿl
 
s_¡¬t
, 
s_’d
 = 
chunk
:
	$fšd
(
£lf
.
_»ad_·‰”n
, 1, 
çl£
)

834 
s_¡¬t
 
th’


835 
loÿl
 
ÿÎback
 = 
£lf
.
_»ad_ÿÎback


836 
loÿl
 
¬g
 = 
£lf
.
_»ad_ÿÎback_¬g


837 
£lf
.
_»ad_ÿÎback
 = 
n


838 
£lf
.
_»ad_ÿÎback_¬g
 = 
n


839 
£lf
.
_¡»amšg_ÿÎback
 = 
n


840 
£lf
.
_¡»amšg_ÿÎback_¬g
 = 
n


841 
£lf
.
_»ad_·‰”n
 = 
n


842 
£lf
:
	`_run_ÿÎback
(
ÿÎback
, 
¬g
, s–f:
	`_cÚsume
(

843 
s_’d
 + 
£lf
.
_»ad_sÿn_off£t
))

844 
£lf
.
_»ad_sÿn_off£t
 = 
s_’d


845  
Œue


846 
’d


847 
£lf
.
_»ad_sÿn_off£t
 = 
sz


848 
’d


849 
’d


850  
çl£


851 
’d


853 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


854 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_wr™e_nÚcÚ¡
()

855 
loÿl
 
”ºo
, 
fd


856 
loÿl
 
±r
, 
sz
 = 
£lf
.
_wr™e_bufãr
:
	$g‘
()

857 
loÿl
 
buf
 = 
±r
 + 
£lf
.
_wr™e_bufãr_off£t


858 
loÿl
 
num_by‹s
 = 
	`tÚumb”
(
C
.
	$£nd
(

859 
£lf
.
sock‘
,

860 
buf
,

861 
£lf
.
_wr™e_bufãr_size
,

863 
num_by‹s
 =ğ-1 
th’


864 
”ºo
 = 
ffi
.
	$”ºo
()

865 
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EAGAIN
 
th’


867 
–£if
 
”ºo
 =ğ
EPIPE
 
Ü
ƒ¼nØ=ğ
ECONNRESET
 
th’


868 -- 
CÚÃùiÚ
 
»£t
. 
Clo£
 
the
 
sock‘
.

869 
fd
 = 
£lf
.
sock‘


870 
£lf
:
	$şo£
()

871 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
(

873 
fd
))

875 
’d


876 
fd
 = 
£lf
.
sock‘


877 
£lf
:
	$şo£
()

878 
	`”rÜ
(
¡ršg
.
	`fÜm©
("Error when writingo fd %d, %s",

879 
fd
,

880 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

881 
’d


882 
num_by‹s
 =ğ0 
th’


884 
’d


885 
£lf
.
_wr™e_bufãr_off£t
 = s–f._wr™e_bufãr_off£ˆ+ 
num_by‹s


886 
£lf
.
_wr™e_bufãr_size
 = s–f._wr™e_bufãr_siz- 
num_by‹s


887 
£lf
.
_wr™e_bufãr_size
 =ğ0 
th’


888 -- 
Bufãr
 
»ached
 
’d
. 
Re£t
 
off£t
 
ªd
 
size
.

889 
£lf
.
_wr™e_bufãr
:
	$ş—r
()

890 
£lf
.
_wr™e_bufãr_off£t
 = 0

891 
£lf
.
_wr™e_ÿÎback
 
th’


892 -- 
Cu¼’t
 
bufãr
 
com¶‘–y
 
æushed
.

893 
loÿl
 
ÿÎback
 = 
£lf
.
_wr™e_ÿÎback


894 
loÿl
 
¬g
 = 
£lf
.
_wr™e_ÿÎback_¬g


895 
£lf
.
_wr™e_ÿÎback
 = 
n


896 
£lf
.
_wr™e_ÿÎback_¬g
 = 
n


897 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

898 
’d


899 
’d


900 
’d


902 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_wr™e_cÚ¡
()

903 
loÿl
 
”ºo
, 
fd


904 -- 
The
 
»ã»nû
 
is
 
»moved
 
Úû
 
the
 
wr™e
 i 
com¶‘e
.

905 
loÿl
 
buf
, 
sz
 = 
£lf
.
_cÚ¡_wr™e_bufãr
:
	$g‘
()

906 
loÿl
 
±r
 = 
buf
 + 
£lf
.
_wr™e_bufãr_off£t


907 
loÿl
 
_sz
 = 
sz
 - 
£lf
.
_wr™e_bufãr_off£t


908 
loÿl
 
num_by‹s
 = 
C
.
	$£nd
(

909 
£lf
.
sock‘
,

910 
±r
,

911 
_sz
,

913 
num_by‹s
 =ğ-1 
th’


914 
”ºo
 = 
ffi
.
	$”ºo
()

915 
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EAGAIN
 
th’


917 
–£if
 
”ºo
 =ğ
EPIPE
 
Ü
ƒ¼nØ=ğ
ECONNRESET
 
th’


918 -- 
CÚÃùiÚ
 
»£t
. 
Clo£
 
the
 
sock‘
.

919 
fd
 = 
£lf
.
sock‘


920 
£lf
:
	$şo£
()

921 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
(

923 
fd
))

925 
’d


926 
fd
 = 
£lf
.
sock‘


927 
£lf
:
	$şo£
()

928 
	`”rÜ
(
¡ršg
.
	`fÜm©
("Error when writingo fd %d, %s",

929 
fd
,

930 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

931 
’d


932 
num_by‹s
 =ğ0 
th’


934 
’d


935 
£lf
.
_wr™e_bufãr_off£t
 = s–f._wr™e_bufãr_off£ˆ+ 
num_by‹s


936 
sz
 =ğ
£lf
.
_wr™e_bufãr_off£t
 
th’


937 -- 
Bufãr
 
»ached
 
’d
. 
Remove
 
»ã»nû
 
to
 cÚ¡ 
wr™e
 
bufãr
.

938 
£lf
.
_wr™e_bufãr_off£t
 = 0

939 
£lf
.
_cÚ¡_wr™e_bufãr
 = 
n


940 
£lf
.
_wr™e_ÿÎback
 
th’


941 -- 
Cu¼’t
 
bufãr
 
com¶‘–y
 
æushed
.

942 
loÿl
 
ÿÎback
 = 
£lf
.
_wr™e_ÿÎback


943 
loÿl
 
¬g
 = 
£lf
.
_wr™e_ÿÎback_¬g


944 
£lf
.
_wr™e_ÿÎback
 = 
n


945 
£lf
.
_wr™e_ÿÎback_¬g
 = 
n


946 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

947 
’d


948 
’d


949 
’d


951 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_wr™e_nÚcÚ¡
()

952 
loÿl
 
”ºo
, 
fd


953 
loÿl
 
±r
, 
sz
 = 
£lf
.
_wr™e_bufãr
:
	$g‘
()

954 
loÿl
 
buf
 = 
±r
 + 
£lf
.
_wr™e_bufãr_off£t


955 -- 
NÙ
 
v”y
 
İtim®
 
to
 
ü—‹
 
a
 
Ãw
 
¡ršg
 
LuaSock‘
.

956 
loÿl
 
num_by‹s
, 
”r
 = 
£lf
.
sock‘
:
	`£nd
(

957 
ffi
.
	`¡ršg
(
buf
, 
m©h
.
	$mš
(
£lf
.
_wr™e_bufãr_size
, 1024*128)))

958 
”r
 
th’


959 
”r
 =ğ"şo£d" 
th’


960 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
(

962 
fd
))

964 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
(

966 
fd
,

967 
”r
))

968 
’d


969 
fd
 = 
£lf
.
sock‘


970 
£lf
:
	$şo£
()

972 
’d


973 
£lf
.
_wr™e_bufãr_off£t
 = s–f._wr™e_bufãr_off£ˆ+ 
num_by‹s


974 
£lf
.
_wr™e_bufãr_size
 = s–f._wr™e_bufãr_siz- 
num_by‹s


975 
£lf
.
_wr™e_bufãr_size
 =ğ0 
th’


976 -- 
Bufãr
 
»ached
 
’d
. 
Re£t
 
off£t
 
ªd
 
size
.

977 
£lf
.
_wr™e_bufãr
:
	$ş—r
()

978 
£lf
.
_wr™e_bufãr_off£t
 = 0

979 
£lf
.
_wr™e_ÿÎback
 
th’


980 -- 
Cu¼’t
 
bufãr
 
com¶‘–y
 
æushed
.

981 
loÿl
 
ÿÎback
 = 
£lf
.
_wr™e_ÿÎback


982 
loÿl
 
¬g
 = 
£lf
.
_wr™e_ÿÎback_¬g


983 
£lf
.
_wr™e_ÿÎback
 = 
n


984 
£lf
.
_wr™e_ÿÎback_¬g
 = 
n


985 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

986 
’d


987 
’d


988 
’d


990 -- 
_hªdË_wr™e_cÚ¡
 
is
 
nÙ
 
im¶em’‹d
 
LuaSock‘
 
as
 
™
 
gives
 
no
 
»®


991 -- 
b’ef™
. 
FunùiÚ
 
ÿÎs
 
to
 cÚ¡ 
wr™es
 
¬e
 
»wr™‹n
Ø
nÚcÚ¡
.

992 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_wr™e_cÚ¡
()

993 
	`”rÜ
("Not implemented for LuaSocket Turbo.")

994 
’d


996 
’d


998 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_wr™e
()

999 
nÙ
 
£lf
.
sock‘
 
th’


1001 
’d


1002 
£lf
.
_cÚ¡_wr™e_bufãr
 
th’


1003 
£lf
:
	$_hªdË_wr™e_cÚ¡
()

1005 
£lf
:
	$_hªdË_wr™e_nÚcÚ¡
()

1006 
’d


1007 
’d


1009 --- 
Add
 
IO
 
¡©e
 
to
 
IOLoİ
.

1010 -- @
·¿m
 
	$¡©e
 (
Numb”
è
IOLoİ
 
¡©e
 
to
 
£t
.

1011 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_add_io_¡©e
(
¡©e
)

1012 
nÙ
 
£lf
.
sock‘
 
th’


1013 -- 
CÚÃùiÚ
 
has
 
b“n
 
şo£d
, 
ignÜe
 
»que¡
.

1015 
’d


1016 
nÙ
 
£lf
.
_¡©e
 
th’


1017 
£lf
.
_¡©e
 = 
	$b™Ü
(
iŞoİ
.
ERROR
, 
¡©e
)

1018 
£lf
.
io_loİ
:
	$add_hªdËr
(
£lf
.
sock‘
,

1019 
£lf
.
_¡©e
,

1020 
£lf
.
_hªdË_ev’ts
,

1021 
£lf
)

1022 
–£if
 
	`b™ªd
(
£lf
.
_¡©e
, 
¡©e
è=ğ0 
th’


1023 
£lf
.
_¡©e
 = 
	$b™Ü
(
£lf
.
_¡©e
, 
¡©e
)

1024 
£lf
.
io_loİ
:
	$upd©e_hªdËr
(
£lf
.
sock‘
, s–f.
_¡©e
)

1025 
’d


1026 
’d


1028 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_cÚsume
(
loc
)

1029 
loc
 =ğ0 
th’


1031 
’d


1032 
£lf
.
_»ad_bufãr_size
 = s–f._»ad_bufãr_siz- 
loc


1033 
loÿl
 
±r
, 
sz
 = 
£lf
.
_»ad_bufãr
:
	$g‘
()

1034 
loÿl
 
chunk
 = 
ffi
.
	`¡ršg
(
±r
 + 
£lf
.
_»ad_bufãr_off£t
, 
loc
)

1035 
£lf
.
_»ad_bufãr_off£t
 = s–f._»ad_bufãr_off£ˆ+ 
loc


1036 
£lf
.
_»ad_bufãr_off£t
 =ğ
sz
 
th’


1037 -- 
Bufãr
 
»ached
 
’d
. 
Re£t
 
off£t
 
ªd
 
size
.

1038 -- 
We
 
could
 
š
 
theÜy
 
shršk
 
bufãr
 
h”e
 
but
, 
™
 
is
 
ç¡”


1039 -- 
to
 
Ët
 
™
 
¡ay
 
as
 
is
.

1040 
£lf
.
_»ad_bufãr
:
	$ş—r
()

1041 
£lf
.
_»ad_bufãr_off£t
 = 0

1042 
’d


1043  
chunk


1044 
’d


1046 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_check_şo£d
()

1047 
nÙ
 
£lf
.
sock‘
 
th’


1048 
	`”rÜ
("Socket operation on closed stream.")

1049 
’d


1050 
’d


1052 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_maybe_add_”rÜ_li¡’”
()

1053 
£lf
.
_¡©e
 =ğ
n
 
ªd
 s–f.
_³ndšg_ÿÎbacks
 =ğ0 
th’


1054 
£lf
.
sock‘
 =ğ
n
 
th’


1055 
loÿl
 
ÿÎback
 = 
£lf
.
_şo£_ÿÎback


1056 
loÿl
 
¬g
 = 
£lf
.
_şo£_ÿÎback_¬g


1057 
ÿÎback
 ~ğ
n
 
th’


1058 
£lf
.
_şo£_ÿÎback
 = 
n


1059 
£lf
.
_şo£_ÿÎback_¬g
 = 
n


1060 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

1061 
’d


1063 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
READ
)

1064 
’d


1065 
’d


1066 
’d


1068 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


1069 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_cÚÃù
()

1070 
loÿl
 
rc
, 
sock”r
 = 
sock‘
.
	$g‘_sock‘_”rÜ
(
£lf
.
sock‘
)

1071 
rc
 =ğ-1 
th’


1072 
	`”rÜ
("[iostream.lua] Could‚ot get socketƒrrors, for fd " ..

1073 
£lf
.
sock‘
)

1075 
sock”r
 ~ğ0 
th’


1076 
loÿl
 
fd
 = 
£lf
.
sock‘


1077 
£lf
:
	$şo£
()

1078 
loÿl
 
¡»¼Ü
 = 
sock‘
.
	$¡»¼Ü
(
sock”r
)

1079 
£lf
.
_cÚÃù_ç_ÿÎback
 
th’


1080 
£lf
.
_cÚÃù_ÿÎback_¬g
 
th’


1081 
£lf
.
	$_cÚÃù_ç_ÿÎback
(

1082 
£lf
.
_cÚÃù_ÿÎback_¬g
,

1083 
sock”r
,

1084 
¡»¼Ü
)

1086 
£lf
.
	$_cÚÃù_ç_ÿÎback
(
sock”r
, 
¡»¼Ü
)

1087 
’d


1089 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1091 
sock‘
.
	`¡»¼Ü
(
sock”r
), 
fd
))

1092 
’d


1094 
’d


1095 
’d


1096 
£lf
.
_cÚÃù_ÿÎback
 
th’


1097 
loÿl
 
ÿÎback
 = 
£lf
.
_cÚÃù_ÿÎback


1098 
loÿl
 
¬g
 = 
£lf
.
_cÚÃù_ÿÎback_¬g


1099 
£lf
.
_cÚÃù_ÿÎback
 = 
n


1100 
£lf
.
_cÚÃù_ÿÎback_¬g
 = 
n


1101 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

1102 
’d


1103 
£lf
.
_cÚÃùšg
 = 
çl£


1104 
’d


1106 
funùiÚ
 
io¡»am
.
IOSŒ—m
:
	$_hªdË_cÚÃù
()

1107 
loÿl
 
_
, 
”r
 = 
£lf
.
sock‘
:
	`cÚÃù
(£lf.
add»ss
, s–f.
pÜt
)

1108 -- 
It
 
£ems
 
the
 "LuaSock‘ way" 
is
 
to
 
nÙ
 
run
 
g‘_sock‘_”rÜ
, 
but


1109 -- 
ÿÎ
 
cÚÃù
 
Úû
 
agaš
 
ªd
 
check
 "already connected" .

1110 -- 
If
 
»tuºs
 
a
 
difã»Á
 
”rÜ
 
thª
 
this
 
¡ršg
 
th’
 
™
 
has
 
çed
,

1111 -- 
to
 
cÚÃù
.

1112 
”r
 
ªd
ƒ¼ ~ğ"®»ady cÚÃùed" 
th’


1113 
loÿl
 
fd
 = 
£lf
.
sock‘


1114 
£lf
:
	$şo£
()

1115 
£lf
.
_cÚÃù_ç_ÿÎback
 
th’


1116 
£lf
.
_cÚÃù_ÿÎback_¬g
 
th’


1117 
£lf
.
	`_cÚÃù_ç_ÿÎback
(

1118 
£lf
.
_cÚÃù_ÿÎback_¬g
,

1119 -1, -- 
Kšd
 
of
 
bad
 
rc
. 
Wh©
 
to
 do?

1120 
”r
)

1122 
£lf
.
	$_cÚÃù_ç_ÿÎback
(
sock”r
, 
¡»¼Ü
)

1123 
’d


1125 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1127 
”r
, 
fd
))

1128 
’d


1130 
’d


1131 
£lf
.
_cÚÃù_ÿÎback
 
th’


1132 
loÿl
 
ÿÎback
 = 
£lf
.
_cÚÃù_ÿÎback


1133 
loÿl
 
¬g
 = 
£lf
.
_cÚÃù_ÿÎback_¬g


1134 
£lf
.
_cÚÃù_ÿÎback
 = 
n


1135 
£lf
.
_cÚÃù_ÿÎback_¬g
 = 
n


1136 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

1137 
’d


1138 
£lf
.
_cÚÃùšg
 = 
çl£


1139 
’d


1140 
’d


1142 
_G
.
TURBO_SSL
 
ªd
 
¶©fÜm
.
__LINUX__
‡nd 
nÙ
 _G.
__TURBO_USE_LUASOCKET__
 
th’


1143 --- 
SSLIOSŒ—m
, 
nÚ
-
blockšg
 
SSL
 
sock‘s
 
usšg
 
O³nSSL


1144 -- 
The
 
şass
 
is
 
a
 
ex‹ÁiÚ
 
of
 
the
 
IOSŒ—m
 cÏs 
ªd
 
u£s


1145 -- 
O³nSSL
 
™s
 
im¶em’tiÚ
. 
Obviou¦y
 
a
 
SSL
 
tuÂ–


1146 -- 
soáw¬e
 
is
 
a
 
mÜe
 
İtim®
 
­´ßch
 
thª
 
this
, 
as
 
th”e


1147 -- 
is
 
qu™e
 
a
 
b™
 
of
 
ov”h—d
 
š
 
hªdlšg
 
SSL
 
cÚÃùiÚs
.

1148 -- 
FÜ
 
this
 
şass
 
to
 
be
 
avaabË
, 
the
 
glob®
 
_G
.
TURBO_SSL


1149 -- 
mu¡
 
be
 
£t
.

1150 
io¡»am
.
SSLIOSŒ—m
 = 
	`şass
('SSLIOSŒ—m', io¡»am.
IOSŒ—m
)

1152 --- 
In™Ÿlize
 
a
 
Ãw
 
SSLIOSŒ—m
 
şass
 
š¡ªû
.

1153 -- @
·¿m
 
	$fd
 (
Numb”
è
Fe
 
desütÜ
, 
e™h”
 
İ’
 
Ü
 
şo£d
. 
If
 clo£d 
th’
,

1154 -- 
the
 
IOSŒ—m
:
	$cÚÃù
(è
m‘hod
 
ÿn
 
be
 
u£d
 
to
 
cÚÃù
.

1155 -- @
·¿m
 
	$s¦_İtiÚs
 (
TabË
è
SSL
 
İtiÚs
 
bË
 
cÚšs
, 
public
 
ªd
 
´iv©e


1156 -- 
keys
 
ªd
 
a
 
SSL_cÚ‹xt
 
poš‹r
.

1157 -- @
·¿m
 
	$io_loİ
 (
IOLoİ
 
objeù
èIOLoİ 
şass
 
š¡ªû
 
to
 
u£
 
ev’t


1158 -- 
´oûssšg
. 
If
 
nÚe
 
is
 
£t
 
th’
 
the
 
glob®
 
š¡ªû
 i 
u£d
, 
£e
he

1159 -- 
iŞoİ
.
	$š¡ªû
(è
funùiÚ
.

1160 -- @
·¿m
 
	$max_bufãr_size
 (
Numb”
è
The
 
maximum
 
numb”
 
of
 
by‹s
 
th©
 
ÿn
 
be


1161 -- 
h–d
 
š
 
š‹º®
 
bufãr
 
befÜe
 
æushšg
 
mu¡
 
occur
.

1162 -- 
If
 
nÚe
 
is
 
£t
, 104857600 
¬e
 
u£d
 
as
 .

1163 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$š™Ÿlize
(
fd
, 
s¦_İtiÚs
, 
io_loİ
,

1164 
max_bufãr_size
, 
¬gs
)

1165 
£lf
.
_s¦_İtiÚs
 = 
s¦_İtiÚs


1166 -- 
s¦_İtiÚs
 
should
 
cÚš
 
keys
 
w™h
 
v®ues
:

1167 -- "_s¦_ùx" = 
SSL_CTX
 
poš‹r
 
ü—‹d
 
w™h
 
cÚ‹xt
 
funùiÚs
 
š


1168 -- 
üy±o
.
lua
.

1169 -- "_ty³" = 
O±iÚ®
 
numb”
, 0 
Ü
 1. 0 
šdiÿ‹s
 
th©
 
the
 
cÚ‹xt


1170 -- 
is
 
a
 
£rv”
 
cÚ‹xt
, 
ªd
 1 
šdiÿ‹s
‡ 
ş›Á
 context.

1171 -- 
Oth”
 
keys
 
may
 
be
 
¡Üed
 
š
 
the
 
bË
, 
but
 
¬e
 
sim¶y
 
ignÜed
.

1172 
£lf
.
_s¦
 = 
n


1173 
io¡»am
.
IOSŒ—m
.
	$š™Ÿlize
(
£lf
, 
fd
, 
io_loİ
, 
max_bufãr_size
, 
¬gs
)

1174 
£lf
.
_s¦_acû±šg
 = 
Œue


1175 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1176 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
¬g


1177 
£lf
.
_£rv”_ho¡Çme
 = 
n


1178 
’d


1180 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	`cÚÃù
(
add»ss
, 
pÜt
, 
çmy
, 
v”ify
, 
ÿÎback
,

1181 
”rhªdËr
, 
¬g
)

1182 -- 
We
 
¡—l
 
the
 
Ú_cÚÃù
 
ÿÎback
 
äom
h
ÿÎ”
. 
And
 
make
 
su»
 
th©
 
we


1183 -- dØ
hªdshakšg
 
befÜe
 
ªythšg
 .

1184 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
ÿÎback


1185 
£lf
.
_s¦_cÚÃù_”rhªdËr
 = 
”rhªdËr


1186 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
¬g


1187 
£lf
.
_s¦_ho¡Çme
 = 
add»ss


1188 
£lf
.
_s¦_v”ify
 = 
v”ify
 =ğ
n
 
ªd
 
Œue
 
Ü
 verify

1189  
io¡»am
.
IOSŒ—m
.
	$cÚÃù
(
£lf
,

1190 
add»ss
,

1191 
pÜt
,

1192 
çmy
,

1193 
£lf
.
_hªdË_cÚÃù
,

1194 
£lf
.
_cÚÃù_”rhªdËr
,

1195 
£lf
)

1196 
’d


1198 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_cÚÃù_”rhªdËr
()

1199 
£lf
.
_s¦_cÚÃù_”rhªdËr
 
th’


1200 
loÿl
 
”rhªdËr
 = 
£lf
.
_s¦_cÚÃù_”rhªdËr


1201 
loÿl
 
¬g
 = 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g


1202 
£lf
.
_s¦_cÚÃù_”rhªdËr
 = 
n


1203 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
n


1204 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1205 
	$”rhªdËr
(
¬g
)

1206 
’d


1207 
’d


1209 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_do_s¦_hªdshake
()

1210 
loÿl
 
s¦
 = 
£lf
.
_s¦


1211 
loÿl
 
ş›Á
 = 
£lf
.
_s¦_İtiÚs
.
_ty³
 == 1

1213 -- 
ü—‹
 
Ãw
 
SSL
 
cÚÃùiÚ
 
Úly
 
Úû


1214 
nÙ
 
s¦
 
th’


1215 
s¦
 = 
üy±o
.
	$s¦_Ãw
(
£lf
.
_s¦_İtiÚs
.
_s¦_ùx
, s–f.
sock‘
, 
ş›Á
)

1216 
£lf
.
_s¦
 = 
s¦


1217 
’d


1218 -- dØ
the
 
SSL
 
hªdshakšg
, 
»tuºs
 
Œue
 
wh’
 
cÚÃùed
, 
Ùh”wi£
 
çl£


1219 
üy±o
.
	$s¦_do_hªdshake
(
£lf
è
th’


1220 -- 
CÚÃùiÚ
 
e¡ablished
. 
S‘
 
acû±šg
 
æag
 
to
 
çl£
 
ªd
 
th”eby


1221 -- 
®low
 
wr™es
 
ªd
 
»ads
 
ov”
 
the
 
sock‘
.

1222 
£lf
.
_s¦_acû±šg
 = 
çl£


1223 
£lf
.
_s¦_cÚÃù_ÿÎback
 
th’


1224 
loÿl
 
_s¦_cÚÃù_ÿÎback
 = 
£lf
._ssl_connect_callback

1225 
loÿl
 
_s¦_cÚÃù_ÿÎback_¬g
 = 
£lf
._ssl_connect_callback_arg

1226 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1227 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
n


1228 
	$_s¦_cÚÃù_ÿÎback
(
_s¦_cÚÃù_ÿÎback_¬g
)

1229 
’d


1230 
’d


1231 
’d


1233 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_»ad
()

1234 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1235 
£lf
:
	$_do_s¦_hªdshake
()

1237 
’d


1238 
io¡»am
.
IOSŒ—m
.
	$_hªdË_»ad
(
£lf
)

1239 
’d


1241 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_cÚÃù
()

1242 
£lf
.
_cÚÃùšg
 =ğ
Œue
 
th’


1243 
loÿl
 
rc
, 
sock”r
 = 
sock‘
.
	$g‘_sock‘_”rÜ
(
£lf
.
sock‘
)

1244 
rc
 =ğ-1 
th’


1245 
	`”rÜ
("[iostream.lua] Could‚ot get socketƒrrors, for fd " ..

1246 
£lf
.
sock‘
)

1248 
sock”r
 ~ğ0 
th’


1249 
loÿl
 
fd
 = 
£lf
.
sock‘


1250 
£lf
:
	$şo£
()

1251 
loÿl
 
¡»¼Ü
 = 
sock‘
.
	$¡»¼Ü
(
sock”r
)

1252 
£lf
.
_s¦_cÚÃù_”rhªdËr
 
th’


1253 
loÿl
 
”rhªdËr
 = 
£lf
.
_s¦_cÚÃù_”rhªdËr


1254 
loÿl
 
¬g
 = 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g


1255 
£lf
.
_s¦_cÚÃù_”rhªdËr
 = 
n


1256 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
n


1257 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1258 
	$”rhªdËr
(
¬g
, 
sock”r
, 
¡»¼Ü
)

1260 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1262 
sock‘
.
	`¡»¼Ü
(
sock”r
),

1263 
fd
))

1264 
’d


1266 
’d


1267 
’d


1268 
£lf
.
_cÚÃùšg
 = 
çl£


1269 
’d


1270 
£lf
:
	$_do_s¦_hªdshake
()

1271 
’d


1273 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_»ad_äom_sock‘
()

1274 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1275 -- 
If
 
the
 
hªdshake
 
has
 
nÙ
 
b“n
 
com¶‘ed
 dØnÙ 
®low


1276 -- 
ªy
 
»ads
 
to
 
be
 
dÚe
...

1278 
’d


1279 
loÿl
 
”ºo


1280 
loÿl
 
”r


1282 
loÿl
 
sz
 = 
üy±o
.
	$SSL_»ad
(
£lf
.
_s¦
, 
buf
, 
_G
.
TURBO_SOCKET_BUFFER_SZ
)

1283 
sz
 =ğ-1 
th’


1284 
”r
 = 
üy±o
.
	$SSL_g‘_”rÜ
(
£lf
.
_s¦
, 
sz
)

1285 
”r
 =ğ
üy±o
.
SSL_ERROR_SYSCALL
 
th’


1286 
”ºo
 = 
ffi
.
	$”ºo
()

1287 
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EAGAIN
 
th’


1290 
loÿl
 
fd
 = 
£lf
.
sock‘


1291 
£lf
:
	$şo£
()

1292 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1294 
fd
,

1295 
”ºo
,

1296 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

1297 
’d


1298 
–£if
 
”r
 =ğ
üy±o
.
SSL_ERROR_WANT_READ
 
th’


1301 -- 
loÿl
 
fd
 = 
£lf
.
sock‘


1302 
loÿl
 
s¦_”r
 = 
üy±o
.
	$ERR_g‘_”rÜ
()

1303 
loÿl
 
s¦_¡r_”r
 = 
üy±o
.
	$ERR_”rÜ_¡ršg
(
s¦_”r
)

1304 
£lf
:
	$şo£
()

1305 
	`”rÜ
(
¡ršg
.
	`fÜm©
("SSLƒrror. %s",

1306 
s¦_¡r_”r
))

1307 
’d


1308 
’d


1309 
sz
 =ğ0 
th’


1310 
£lf
:
	$şo£
()

1312 
’d


1313  
buf
, 
sz


1314 
’d


1316 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_wr™e_nÚcÚ¡
()

1317 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1318 -- 
If
 
the
 
hªdshake
 
has
 
nÙ
 
b“n
 
com¶‘ed
 dØnÙ 
®low
 
ªy
 
wr™es
 
to


1319 -- 
be
 
dÚe
.

1320  
n


1321 
’d


1323 
loÿl
 
±r
 = 
£lf
.
_wr™e_bufãr
:
	$g‘
()

1324 
±r
 =…Œ + 
£lf
.
_wr™e_bufãr_off£t


1325 
loÿl
 
n
 = 
üy±o
.
	$SSL_wr™e
(
£lf
.
_s¦
, 
±r
, s–f.
_wr™e_bufãr_size
)

1326 
n
 =ğ-1 
th’


1327 
loÿl
 
”r
 = 
üy±o
.
	$SSL_g‘_”rÜ
(
£lf
.
_s¦
, 
n
)

1328 
”r
 =ğ
üy±o
.
SSL_ERROR_SYSCALL
 
th’


1329 
loÿl
 
”ºo
 = 
ffi
.
	$”ºo
()

1330 
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EAGAIN
 
th’


1333 
loÿl
 
fd
 = 
£lf
.
sock‘


1334 
£lf
:
	$şo£
()

1335 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1337 
fd
,

1338 
”ºo
,

1339 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

1340 
’d


1341 
–£if
 
”r
 =ğ
üy±o
.
SSL_ERROR_WANT_WRITE
 
th’


1344 -- 
loÿl
 
fd
 = 
£lf
.
sock‘


1345 
loÿl
 
s¦_”r
 = 
üy±o
.
	$ERR_g‘_”rÜ
()

1346 
loÿl
 
s¦_¡r_”r
 = 
üy±o
.
	$ERR_”rÜ_¡ršg
(
s¦_”r
)

1347 
£lf
:
	$şo£
()

1348 
	`”rÜ
(
¡ršg
.
	`fÜm©
("SSLƒrror. %s",

1349 
s¦_¡r_”r
))

1350 
’d


1351 
’d


1352 
n
 =ğ0 
th’


1354 
’d


1355 
£lf
.
_wr™e_bufãr_off£t
 = s–f._wr™e_bufãr_off£ˆ+ 
n


1356 
£lf
.
_wr™e_bufãr_size
 = s–f._wr™e_bufãr_siz- 
n


1357 
£lf
.
_wr™e_bufãr_size
 =ğ0 
th’


1358 -- 
Bufãr
 
»ached
 
’d
. 
Re£t
 
off£t
 
ªd
 
size
.

1359 
£lf
.
_wr™e_bufãr
:
	$ş—r
()

1360 
£lf
.
_wr™e_bufãr_off£t
 = 0

1361 
£lf
.
_wr™e_ÿÎback
 
th’


1362 -- 
Cu¼’t
 
bufãr
 
com¶‘–y
 
æushed
.

1363 
loÿl
 
ÿÎback
 = 
£lf
.
_wr™e_ÿÎback


1364 
loÿl
 
¬g
 = 
£lf
.
_wr™e_ÿÎback_¬g


1365 
£lf
.
_wr™e_ÿÎback
 = 
n


1366 
£lf
.
_wr™e_ÿÎback_¬g
 = 
n


1367 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

1368 
’d


1369 
’d


1370 
’d


1372 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_wr™e_cÚ¡
()

1373 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1374 -- 
If
 
the
 
hªdshake
 
has
 
nÙ
 
b“n
 
com¶‘ed
 dØnÙ 
®low
 
ªy
 
wr™es
 
to


1375 -- 
be
 
dÚe
.

1376  
n


1377 
’d


1379 
loÿl
 
buf
, 
sz
 = 
£lf
.
_cÚ¡_wr™e_bufãr
:
	$g‘
()

1380 
buf
 = buà+ 
£lf
.
_wr™e_bufãr_off£t


1381 
sz
 = sz - 
£lf
.
_wr™e_bufãr_off£t


1382 
loÿl
 
n
 = 
üy±o
.
	$SSL_wr™e
(
£lf
.
_s¦
, 
buf
, 
sz
)

1383 
n
 =ğ-1 
th’


1384 
loÿl
 
”r
 = 
üy±o
.
	$SSL_g‘_”rÜ
(
£lf
.
_s¦
, 
n
)

1385 
”r
 =ğ
üy±o
.
SSL_ERROR_SYSCALL
 
th’


1386 
loÿl
 
”ºo
 = 
ffi
.
	$”ºo
()

1387 
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EAGAIN
 
th’


1390 
loÿl
 
fd
 = 
£lf
.
sock‘


1391 
£lf
:
	$şo£
()

1392 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1394 
fd
,

1395 
”ºo
,

1396 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

1397 
’d


1398 
–£if
 
”r
 =ğ
üy±o
.
SSL_ERROR_WANT_WRITE
 
th’


1401 -- 
loÿl
 
fd
 = 
£lf
.
sock‘


1402 
loÿl
 
s¦_”r
 = 
üy±o
.
	$ERR_g‘_”rÜ
()

1403 
loÿl
 
s¦_¡r_”r
 = 
üy±o
.
	$ERR_”rÜ_¡ršg
(
s¦_”r
)

1404 
£lf
:
	$şo£
()

1405 
	`”rÜ
(
¡ršg
.
	`fÜm©
("SSLƒrror. %s",

1406 
s¦_¡r_”r
))

1407 
’d


1408 
’d


1409 
n
 =ğ0 
th’


1411 
’d


1412 
£lf
.
_wr™e_bufãr_off£t
 = s–f._wr™e_bufãr_off£ˆ+ 
n


1413 
sz
 =ğ
£lf
.
_wr™e_bufãr_off£t
 
th’


1414 -- 
Bufãr
 
»ached
 
’d
. 
Remove
 
»ã»nû
 
to
 cÚ¡ 
wr™e
 
bufãr
.

1415 
£lf
.
_wr™e_bufãr_off£t
 = 0

1416 
£lf
.
_cÚ¡_wr™e_bufãr
 = 
n


1417 
£lf
.
_wr™e_ÿÎback
 
th’


1418 -- 
Cu¼’t
 
bufãr
 
com¶‘–y
 
æushed
.

1419 
loÿl
 
ÿÎback
 = 
£lf
.
_wr™e_ÿÎback


1420 
loÿl
 
¬g
 = 
£lf
.
_wr™e_ÿÎback_¬g


1421 
£lf
.
_wr™e_ÿÎback
 = 
n


1422 
£lf
.
_wr™e_ÿÎback_¬g
 = 
n


1423 
£lf
:
	$_run_ÿÎback
(
ÿÎback
, 
¬g
)

1424 
’d


1425 
’d


1426 
’d


1427 
–£if
 
_G
.
TURBO_SSL
 
th’


1428 
io¡»am
.
SSLIOSŒ—m
 = 
	`şass
('SSLIOSŒ—m', io¡»am.
IOSŒ—m
)

1430 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$š™Ÿlize
(
fd
, 
s¦_İtiÚs
, 
io_loİ
,

1431 
max_bufãr_size
)

1432 
£lf
.
_s¦_İtiÚs
 = 
s¦_İtiÚs


1433 -- 
s¦_İtiÚs
 
should
 
cÚš
 
keys
 
w™h
 
v®ues
:

1434 -- "_s¦_ùx" = 
SSL_CTX
 
poš‹r
 
ü—‹d
 
w™h
 
cÚ‹xt
 
funùiÚs
 
š


1435 -- 
üy±o
.
lua
.

1436 -- "_ty³" = 
O±iÚ®
 
numb”
, 0 
Ü
 1. 0 
šdiÿ‹s
 
th©
 
the
 
cÚ‹xt


1437 -- 
is
 
a
 
£rv”
 
cÚ‹xt
, 
ªd
 1 
šdiÿ‹s
‡ 
ş›Á
 context.

1438 -- 
Oth”
 
keys
 
may
 
be
 
¡Üed
 
š
 
the
 
bË
, 
but
 
¬e
 
sim¶y
 
ignÜed
.

1439 
£lf
.
_s¦
 = 
n


1440 
io¡»am
.
IOSŒ—m
.
	$š™Ÿlize
(
£lf
, 
fd
, 
io_loİ
, 
max_bufãr_size
)

1441 
£lf
.
_s¦_acû±šg
 = 
Œue


1442 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1443 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
¬g


1444 
£lf
.
_£rv”_ho¡Çme
 = 
n


1445 
’d


1447 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	`cÚÃù
(
add»ss
, 
pÜt
, 
çmy
, 
v”ify
, 
ÿÎback
,

1448 
”rhªdËr
, 
¬g
)

1449 -- 
We
 
¡—l
 
the
 
Ú_cÚÃù
 
ÿÎback
 
äom
h
ÿÎ”
. 
And
 
make
 
su»
 
th©
 
we


1450 -- dØ
hªdshakšg
 
befÜe
 
ªythšg
 .

1451 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
ÿÎback


1452 
£lf
.
_s¦_cÚÃù_”rhªdËr
 = 
”rhªdËr


1453 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
¬g


1454 
£lf
.
_s¦_ho¡Çme
 = 
add»ss


1455 
£lf
.
_s¦_v”ify
 = 
v”ify
 =ğ
n
 
ªd
 
Œue
 
Ü
 verify

1456  
io¡»am
.
IOSŒ—m
.
	$cÚÃù
(
£lf
,

1457 
add»ss
,

1458 
pÜt
,

1459 
çmy
,

1460 
£lf
.
_hªdË_cÚÃù
,

1461 
£lf
.
_cÚÃù_”rhªdËr
,

1462 
£lf
)

1463 
’d


1465 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_cÚÃù_”rhªdËr
()

1466 
£lf
.
_s¦_cÚÃù_”rhªdËr
 
th’


1467 
loÿl
 
”rhªdËr
 = 
£lf
.
_s¦_cÚÃù_”rhªdËr


1468 
loÿl
 
¬g
 = 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g


1469 
£lf
.
_s¦_cÚÃù_”rhªdËr
 = 
n


1470 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
n


1471 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1472 
	$”rhªdËr
(
¬g
)

1473 
’d


1474 
’d


1476 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_do_s¦_hªdshake
()

1477 
loÿl
 
s¦
 = 
£lf
.
_s¦


1478 
loÿl
 
ş›Á
 = 
£lf
.
_s¦_İtiÚs
.
_ty³
 == 1

1479 -- 
ü—‹
 
Ãw
 
SSL
 
cÚÃùiÚ
 
Úly
 
Úû


1480 
nÙ
 
s¦
 
th’


1481 
s¦
 = 
üy±o
.
	$s¦_Ãw
(
£lf
.
_s¦_İtiÚs
.
_s¦_ùx
, s–f.
sock‘
, 
ş›Á
)

1482 
£lf
.
_s¦
 = 
s¦


1483 -- 
R•Ïû
 
LuaSock‘
 
objeù
 
w™h
 
w¿µed
 
Úe
...

1484 
£lf
.
io_loİ
:
	$»move_hªdËr
(
£lf
.
sock‘
)

1485 
£lf
.
sock‘
 = 
s¦


1486 
£lf
.
io_loİ
:
	$add_hªdËr
(
£lf
.
sock‘
, 
iŞoİ
.
READ
, s–f.
_hªdË_ev’ts
, self)

1487 
’d


1488 -- dØ
the
 
SSL
 
hªdshakšg
, 
»tuºs
 
Œue
 
wh’
 
cÚÃùed
, 
Ùh”wi£
 
çl£


1489 
loÿl
 
»s
, 
”r
 = 
üy±o
.
	$s¦_do_hªdshake
(
£lf
)

1490 
»s
 
th’


1491 -- 
CÚÃùiÚ
 
e¡ablished
. 
S‘
 
acû±šg
 
æag
 
to
 
çl£
 
ªd
 
th”eby


1492 -- 
®low
 
wr™es
 
ªd
 
»ads
 
ov”
 
the
 
sock‘
.

1493 
£lf
.
_s¦_acû±šg
 = 
çl£


1494 
£lf
.
_s¦_cÚÃù_ÿÎback
 
th’


1495 
loÿl
 
_s¦_cÚÃù_ÿÎback
 = 
£lf
._ssl_connect_callback

1496 
loÿl
 
_s¦_cÚÃù_ÿÎback_¬g
 = 
£lf
._ssl_connect_callback_arg

1497 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1498 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
n


1499 
	$_s¦_cÚÃù_ÿÎback
(
_s¦_cÚÃù_ÿÎback_¬g
)

1500 
’d


1501 
–£if
 
”r
 =ğ"wªŒ—d" 
th’


1502 
£lf
:
	$_add_io_¡©e
(
iŞoİ
.
READ
)

1504 
£lf
:
	$şo£
()

1505 
’d


1506 
’d


1508 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_»ad
()

1509 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1510 
£lf
:
	$_do_s¦_hªdshake
()

1512 
’d


1513  
io¡»am
.
IOSŒ—m
.
	$_hªdË_»ad
(
£lf
)

1514 
’d


1516 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_»ad_äom_sock‘
()

1517 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1518 -- 
If
 
the
 
hªdshake
 
has
 
nÙ
 
b“n
 
com¶‘ed
 dØnÙ 
®low


1519 -- 
ªy
 
»ads
 
to
 
be
 
dÚe
...

1521 
’d


1522  
io¡»am
.
IOSŒ—m
.
	$_»ad_äom_sock‘
(
£lf
)

1523 
’d


1525 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_wr™e_nÚcÚ¡
()

1526 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1527 -- 
If
 
the
 
hªdshake
 
has
 
nÙ
 
b“n
 
com¶‘ed
 dØnÙ 
®low
 
ªy
 
wr™es
 
to


1528 -- 
be
 
dÚe
.

1529  
n


1530 
’d


1531  
io¡»am
.
IOSŒ—m
.
	$_hªdË_wr™e_nÚcÚ¡
(
£lf
)

1532 
’d


1534 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_wr™e_cÚ¡
()

1535 
£lf
.
_s¦_acû±šg
 =ğ
Œue
 
th’


1536 -- 
If
 
the
 
hªdshake
 
has
 
nÙ
 
b“n
 
com¶‘ed
 dØnÙ 
®low
 
ªy
 
wr™es
 
to


1537 -- 
be
 
dÚe
.

1538  
n


1539 
’d


1540  
io¡»am
.
IOSŒ—m
.
	$_hªdË_wr™e_cÚ¡
(
£lf
)

1541 
’d


1543 
funùiÚ
 
io¡»am
.
SSLIOSŒ—m
:
	$_hªdË_cÚÃù
()

1544 
£lf
.
_cÚÃùšg
 =ğ
Œue
 
th’


1545 
loÿl
 
_
, 
”r
 = 
£lf
.
sock‘
:
	$cÚÃù
(
£lf
.
add»ss
, s–f.
pÜt
)

1546 
”r
 
ªd
ƒ¼ ~ğ"®»ady cÚÃùed" 
th’


1547 
loÿl
 
fd
 = 
£lf
.
sock‘


1548 
£lf
:
	$şo£
()

1549 
£lf
.
_s¦_cÚÃù_”rhªdËr
 
th’


1550 
loÿl
 
”rhªdËr
 = 
£lf
.
_s¦_cÚÃù_”rhªdËr


1551 
loÿl
 
¬g
 = 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g


1552 
£lf
.
_s¦_cÚÃù_”rhªdËr
 = 
n


1553 
£lf
.
_s¦_cÚÃù_ÿÎback_¬g
 = 
n


1554 
£lf
.
_s¦_cÚÃù_ÿÎback
 = 
n


1555 
	`”rhªdËr
(
¬g
, -1, 
”r
)

1557 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1559 
”r
,

1560 
fd
))

1561 
’d


1563 
’d


1564 
£lf
.
_cÚÃùšg
 = 
çl£


1565 
’d


1566 
£lf
:
	$_do_s¦_hªdshake
()

1567 
’d


1569 
’d


1571 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


1572 
funùiÚ
 
io¡»am
.
	$DNSCache
()

1573  
	`£tm‘©abË
({
	}
},

1576 
’d


1577 
	gio¡»am
.
	g_dns_ÿche
 = 
io¡»am
.
DNSCache
(è-- 
Stic
 
objeù
 
ÿche
 :)

1578 
io¡»am
.
DNSResŞv
 = 
şass
("DNSResolv")

1580 
funùiÚ
 
io¡»am
.
DNSResŞv
:
	$š™Ÿlize
(
io_loİ
, 
¬gs
)

1581 
£lf
.
io_loİ
 = io_loİ 
Ü
 
iŞoİ
.
	$š¡ªû
()

1582 
£lf
.
¬gs
 =‡rg 
Ü
 {
	}
}

1583 
’d


1585 
funùiÚ
 
io¡»am
.
DNSResŞv
:
	$»sŞv
(
add»ss
, 
pÜt
, 
çmy
)

1586 
£lf
.
ÿche_id
 = 
add»ss
..(
pÜt
 
Ü
 "0")..(
çmy
 or "0")

1587 
loÿl
 
addr
 = 
io¡»am
.
_dns_ÿche
[
£lf
.
ÿche_id
]

1588 
addr
 
th’


1589  
	$uÅack
(
addr
)

1590 
’d


1591 -- 
S‘
 
max
 
time
 
DNS
 
to
 
»sŞve
.

1592 
£lf
.
com_pÜt
 = "/tmp/turbo-dns-"..
	`to¡ršg
(
m©h
.
	$¿ndom
(0,0xffffff))

1593 
£lf
:
	$_lookup_Çme
(
add»ss
, 
pÜt
, 
çmy
)

1594 
£lf
.
ùx
 = 
coùx
.
	$CÜoutšeCÚ‹xt
(
£lf
.
io_loİ
)

1595 
loÿl
 
_£lf
 = 
£lf


1596 
£lf
.
_dns_timeout
 = s–f.
io_loİ
:
	`add_timeout
(

1597 
ut
.
	`g‘timemÚÙÚic
(è+ ((
£lf
.
¬gs
.
dns_timeout
 
Ü


1598 30)*1000), 
	$funùiÚ
()

1599 
_£lf
.
pid
 
th’


1600 
ffi
.
C
.
	$kl
(
_£lf
.
pid
, 
sigÇl
.
SIGKILL
)

1601 
ffi
.
C
.
	$wa™
(
n
)

1602 
_£lf
.
pid
 = 
n


1603 
’d


1604 
ffi
.
C
.
	$şo£
(
_£lf
.
£rv”_sockfd
)

1605 
os
.
	$»move
(
_£lf
.
com_pÜt
)

1606 
_£lf
.
ùx
:
	`£t_¬gum’ts
("DNS„esolvimeout.")

1607 
_£lf
.
ùx
:
	$fš®ize_cÚ‹xt
()

1608 
’d


1610 
loÿl
 
”r
, 
£rvšfo
, 
sockaddr
 = 
cÜoutše
.
	$y›ld
(
£lf
.
ùx
)

1611 
”r
 
th’


1612 
	$”rÜ
(
”r
)

1613 
’d


1614  
£rvšfo
, 
sockaddr


1615 
’d


1617 
funùiÚ
 
io¡»am
.
DNSResŞv
:
	$ş—n
()

1618 
io¡»am
.
_dns_ÿche
 = io¡»am.
	$DNSCache
()

1619 
’d


1621 
ffi
.
cdef
 [[

1622 
	s__·cked_addršfo
{

1623 
ai_æags
;

1624 
ai_çmy
;

1625 
ai_sockty³
;

1626 
ai_´ÙocŞ
;

1627 
sockËn_t
 
ai_add¾’
;

1628 
sockaddr
 
ai_addr
;

1632 
loÿl
 
funùiÚ
 
	$_·ck_addršfo
(
addršfo
)

1633 
loÿl
 
·cked
 = 
ffi
.
	`Ãw
("struct __packed_addrinfo")

1634 
·cked
.
ai_æags
 = 
addršfo
.ai_flags

1635 
·cked
.
ai_çmy
 = 
addršfo
.ai_family

1636 
·cked
.
ai_sockty³
 = 
addršfo
.ai_socktype

1637 
·cked
.
ai_´ÙocŞ
 = 
addršfo
.ai_protocol

1638 
·cked
.
ai_add¾’
 = 
addršfo
.ai_addrlen

1639 
·cked
.
ai_addr
.
§_çmy
 = 
addršfo
.ai_addr.sa_family

1640 
ffi
.
	`cİy
(
·cked
.
ai_addr
.
§_d©a
,

1641 
addršfo
.
ai_addr
.
§_d©a
,

1642 
ffi
.(
addršfo
.
ai_addr
.
§_d©a
))

1643  
ffi
.
	`¡ršg
(ffi.
	`ÿ¡
("unsigÃd ch¬*", 
·cked
),

1644 
ffi
.(
·cked
))

1645 
’d


1647 
loÿl
 
funùiÚ
 
	$_uÅack_addršfo
(
·cked
)

1648 
loÿl
 
addršfo
 = 
ffi
.
	`Ãw
("struct‡ddrinfo")

1649 
loÿl
 
sockaddr
 = 
ffi
.
	`Ãw
("struct sockaddr")

1650 
addršfo
.
ai_addr
 = 
sockaddr


1651 
loÿl
 
_·cked
 = 
ffi
.
	`Ãw
("struct __packed_addrinfo")

1652 
ffi
.
	`cİy
(
_·cked
,

1653 
ffi
.
	`ÿ¡
("unsigÃd ch¬*", 
·cked
),

1654 
ffi
.(
_·cked
))

1655 
addršfo
.
ai_æags
 = 
_·cked
.ai_flags

1656 
addršfo
.
ai_çmy
 = 
_·cked
.ai_family

1657 
addršfo
.
ai_sockty³
 = 
_·cked
.ai_socktype

1658 
addršfo
.
ai_´ÙocŞ
 = 
_·cked
.ai_protocol

1659 
addršfo
.
ai_add¾’
 = 
_·cked
.ai_addrlen

1660 
addršfo
.
ai_addr
.
§_çmy
 = 
_·cked
.ai_addr.sa_family

1661 
ffi
.
	`cİy
(
addršfo
.
ai_addr
.
§_d©a
, 
_·cked
.ai_addr.sa_data,

1662 
ffi
.(
addršfo
.
ai_addr
.
§_d©a
))

1663 
addršfo
.
ai_ÿnÚÇme
 = 
n


1664 
addršfo
.
ai_Ãxt
 = 
n


1665 -- 
R‘uº
 
®l
 
to
 
avoid
 
losšg
 
»ã»nû
 
ªd
 
gc
 
ş—nšg
 
up
 
the
 
poš‹rs
.

1666  
addršfo
, 
sockaddr


1667 
’d


1669 
funùiÚ
 
io¡»am
.
DNSResŞv
:
	$_£nd_»sŞv_»suÉ
(
£rvpÜt
,

1670 
sucûss
,

1671 
”rdesc
,

1672 
addršfo
)

1673 
loÿl
 
”ºo
, 
rc


1674 
loÿl
 
ş›Á_add»ss
 = 
ffi
.
	`Ãw
("struct sockaddr_un");

1676 
ş›Á_add»ss
.
sun_çmy
 = 
sock‘
.
AF_UNIX
;

1677 
ffi
.
	`cİy
(
ş›Á_add»ss
.
sun_·th
,

1678 
ffi
.
	`ÿ¡
("cÚ¡ ch¬*", 
£lf
.
com_pÜt
),

1679 
m©h
.
	`mš
(
£lf
.
com_pÜt
:
	`Ën
(), 
ffi
.(
ş›Á_add»ss
.
sun_·th
)))

1680 
£lf
.
ş›Á_sockfd
 = 
ffi
.
C
.
	`sock‘
(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
, 0);

1681 
£lf
.
ş›Á_sockfd
 < 0 
th’


1682 
”ºo
 = 
ffi
.
	$”ºo
()

1683 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1685 
”ºo
,

1686 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

1687 
os
.
	$ex™
(1)

1688 
’d


1689 
rc
 = 
ffi
.
C
.
	`cÚÃù
(
£lf
.
ş›Á_sockfd
,

1690 
ffi
.
	`ÿ¡
("cÚ¡ sŒuù sockadd¸*", 
ş›Á_add»ss
),

1691 
ffi
.(
ş›Á_add»ss
))

1692 
rc
 ~ğ0 
th’


1693 -- 
Maš
 
th»ad
 
´obably
 
has
 
nÙ
 
ü—‹d
 
sock‘
 
y‘
. 
Wa™
.

1694 -- 
Should
 
be
 
dÚe
 
mÜe
 
–egªy
...

1695 
ffi
.
C
.
	$¦“p
(1)

1696 
rc
 = 
ffi
.
C
.
	`cÚÃù
(
£lf
.
ş›Á_sockfd
,

1697 
ffi
.
	`ÿ¡
("cÚ¡ sŒuù sockadd¸*", 
ş›Á_add»ss
),

1698 
ffi
.(
ş›Á_add»ss
))

1699 
’d


1700 
rc
 ~ğ0 
th’


1701 
”ºo
 = 
ffi
.
	$”ºo
()

1702 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1704 
”ºo
,

1705 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

1706 
ffi
.
C
.
	$şo£
(
£lf
.
ş›Á_sockfd
)

1707 
os
.
	$ex™
(1)

1708 
’d


1709 
loÿl
 
»s
 = (
sucûss
 
ªd
 "0" 
Ü
 "1")..

1711 
”rdesc
..

1713 (
addršfo
 
ªd
 
	$_·ck_addršfo
(
addršfo
[0]è
Ü
 "")..

1715 
rc
 = 
ffi
.
C
.
	`£nd
(
£lf
.
ş›Á_sockfd
, ffi.
	`ÿ¡
("cÚ¡ ch¬*", 
»s
),„es:
	`Ën
(), 0)

1716 
ffi
.
C
.
	$şo£
(
£lf
.
ş›Á_sockfd
)

1717 
rc
 =ğ-1 
th’


1718 
log
.
	`”rÜ
(

1720 
’d


1721 
os
.
	$ex™
(1)

1722 
’d


1724 
funùiÚ
 
io¡»am
.
DNSResŞv
:
	`_lookup_Çme
(
add»ss
, 
pÜt
, 
çmy
)

1725 -- 
Async
 
DNS
.

1726 
loÿl
 
£rvpÜt
 = 
m©h
.
	$¿ndom
(10000,20000)

1727 
loÿl
 
pid
 = 
ffi
.
C
.
	$fÜk
()

1728 
pid
 < 0 
th’


1729 
	`”rÜ
("Could‚ot createhread for DNS„esolver.")

1730 
’d


1731 
pid
 ~ğ0 
th’


1732 
loÿl
 
”ºo
, 
rc
, 
msg


1733 
£lf
.
pid
 =…id

1734 
loÿl
 
£rv”_add»ss
 = 
ffi
.
	`Ãw
("struct sockaddr_un");

1735 
£rv”_add»ss
.
sun_çmy
 = 
sock‘
.
AF_UNIX
;

1736 
ffi
.
	`cİy
(
£rv”_add»ss
.
sun_·th
,

1737 
ffi
.
	`ÿ¡
("cÚ¡ ch¬*", 
£lf
.
com_pÜt
),

1738 
m©h
.
	`mš
(
£lf
.
com_pÜt
:
	`Ën
(), 
ffi
.(
£rv”_add»ss
.
sun_·th
)))

1739 
£lf
.
£rv”_sockfd
 = 
ffi
.
C
.
	`sock‘
(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
, 0);

1740 
£lf
.
£rv”_sockfd
 < 0 
th’


1741 
	`”rÜ
("Could‚ot create Unix socket FD")

1742 
’d


1743 
rc
, 
msg
 = 
sock‘
.
	$£t_nÚblock_æag
(
£lf
.
£rv”_sockfd
)

1744 
rc
 ~ğ0 
th’


1745 
	$”rÜ
(
msg
)

1746 
’d


1748 
ffi
.
C
.
	`bšd
(
£lf
.
£rv”_sockfd
,

1749 
ffi
.
	`ÿ¡
("¡ruù sockaddr*", 
£rv”_add»ss
),

1750 
ffi
.(
£rv”_add»ss
)è~ğ0 
th’


1751 
”ºo
 = 
ffi
.
	$”ºo
()

1752 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1754 
”ºo
,

1755 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

1756 
’d


1757 
ffi
.
C
.
	`li¡’
(
£lf
.
£rv”_sockfd
, 1è~ğ0 
th’


1758 
”ºo
 = 
ffi
.
	$”ºo
()

1759 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

1761 
”ºo
,

1762 
fd
,

1763 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

1764 
’d


1765 
sockut
.
	$add_acû±_hªdËr
(
£lf
.
£rv”_sockfd
,

1766 
io¡»am
.
DNSResŞv
.
_dns_»sŞved_ÿÎback
,

1767 
£lf
.
io_loİ
,

1768 
£lf
)

1770 
’d


1771 -- 
FÜk
 
wl
  
h”e
.

1772 
loÿl
 
hšts
 = 
ffi
.
	`Ãw
("struct‡ddrinfo[1]")

1773 
loÿl
 
£rvšfo
 = 
ffi
.
	`Ãw
("struct‡ddrinfo *[1]")

1774 
loÿl
 
rc


1776 
£lf
.
add»ss
 =‡ddress

1777 
£lf
.
pÜt
 =…ort

1778 
ffi
.
	`fl
(
hšts
[0], ffi.(hints[0]))

1779 
hšts
[0].
ai_sockty³
 = 
SOCK_STREAM


1780 
hšts
[0].
ai_çmy
 = 
çmy
 
Ü
 
AF_UNSPEC


1781 
hšts
[0].
ai_´ÙocŞ
 = 0

1782 
rc
 = 
ffi
.
C
.
	`g‘addršfo
(
add»ss
, 
	`to¡ršg
(
pÜt
), 
hšts
, 
£rvšfo
)

1783 
rc
 ~ğ0 
th’


1784 
rc
 =ğ-
EAI_AGAIN
 
th’


1785 
ffi
.
C
.
	$__»s_š™
()

1786 
’d


1787 
loÿl
 
¡»¼
 = 
ffi
.
	`¡ršg
(
C
.
	$gai_¡»¼Ü
(
rc
))

1788 
loÿl
 
”rdesc
 = 
¡ršg
.
	`fÜm©
(

1790 
add»ss
, 
ffi
.
	`¡ršg
(
C
.
	$gai_¡»¼Ü
(
rc
)))

1791 
£lf
:
	$_£nd_»sŞv_»suÉ
(
£rvpÜt
, 
çl£
, 
”rdesc
, 
n
)

1792 
os
.
	$ex™
(0)

1793 
’d


1794 
£lf
:
	`_£nd_»sŞv_»suÉ
(
£rvpÜt
, 
Œue
, "OK", 
£rvšfo
)

1795 
os
.
	$ex™
(0)

1796 
’d


1798 
funùiÚ
 
io¡»am
.
DNSResŞv
:
	$_dns_»sŞved_ÿÎback
(
fd
, 
³”Çme
)

1799 
loÿl
 
_£lf
 = 
£lf


1800 
loÿl
 
pe
 = 
io¡»am
.
	$IOSŒ—m
(
fd
, 
£lf
.
io_loİ
)

1801 
pe
:
	`»ad_uÁ_·‰”n
("\r\n\r\n", 
	$funùiÚ
(
rc
)

1802 
pe
:
	`»ad_uÁ_·‰”n
("\r\n\r\n", 
	$funùiÚ
(
”rmsg
)

1803 
	`tÚumb”
(
rc
è~ğ0 
th’


1804 
pe
:
	$şo£
()

1805 
ffi
.
C
.
	`wa™
(
n
è-- 
Još
.

1806 
ffi
.
C
.
	$şo£
(
£lf
.
£rv”_sockfd
)

1807 
_£lf
.
£rv”_sockfd
 = 
n


1808 
_£lf
.
io_loİ
:
	$»move_timeout
(
£lf
.
_dns_timeout
)

1809 
os
.
	$»move
(
£lf
.
com_pÜt
)

1811 
_£lf
.
ùx
:
	$£t_¬gum’ts
(
”rmsg
)

1812 
_£lf
.
ùx
:
	$fš®ize_cÚ‹xt
()

1814 
’d


1815 
pe
:
	`»ad_uÁ_·‰”n
("\r\n\r\n", 
	$funùiÚ
(
·cked_£rvšfo
)

1816 
pe
:
	$şo£
()

1817 
ffi
.
C
.
	`wa™
(
n
è-- 
Još
.

1818 
ffi
.
C
.
	$şo£
(
£lf
.
£rv”_sockfd
)

1819 
£lf
.
£rv”_sockfd
 = 
n


1820 
£lf
.
io_loİ
:
	$»move_timeout
(
£lf
.
_dns_timeout
)

1821 
os
.
	$»move
(
£lf
.
com_pÜt
)

1822 
loÿl
 
£rvšfo
, 
sockaddr
 =

1823 
	$_uÅack_addršfo
(
·cked_£rvšfo
)

1824 
io¡»am
.
_dns_ÿche
[
£lf
.
ÿche_id
] = {
£rvšfo
, 
sockaddr
}

1825 
_£lf
.
ùx
:
£t_¬gum’ts
({
çl£
, 
£rvšfo
, 
sockaddr
})

1826 
_£lf
.
ùx
:
	$fš®ize_cÚ‹xt
()

1827 
’d
)

1828 
’d
)

1829 
’d
)

1830 
’d


1831 
’d


1833  
io¡»am


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/log.lua

1 --- 
	gTurbo
.
lua
 
Log
 
	gmoduË


2 -- 
A
 
sim¶e
 
log
 
wr™”
 
im¶em’tiÚ
 
w™h
 
difã»Á
 
Ëv–s
 
ªd
 
	g¡ªd¬d


3 -- 
	gfÜm©tšg
. 
Mes§ges
 
wr™‹n
 
is
 
­³nded
 
to
 
Ëv–
 
ªd
 
	gtime¡amp
. 
	gYou


4 -- 
ÿn
 
tuº
 
off
 
unwª‹d
 
ÿ‹gÜ›s
 
by
 
modifiyšg
 
the
 
bË
 
©
 
	glog
.
	gÿ‹gÜ›s
.

6 -- 
FÜ
 
mes§ges
 
shÜ‹r
 
	gthª
 4096 
by‹s
 
a
 
bufãr
 
is
 
u£d
 
	gto


7 -- 
im´ove
 
	g³rfÜmªû
. 
C
 
	gtime
.
h
 
funùiÚs
 
¬e
 
u£d
 
as
 
Lua
 
	gbutš
's is

8 -- 
nÙ
 
comped
 
by
 
	gLuaJIT
. 
This
 
¡©em’t
 
­¶›s
 
to
 
®l
 
log
 
	gfunùiÚs
, 
	gexû±


9 -- 
	glog
.
	gdump
.

11 -- 
Exam¶e
 
	gouut
:

12 -- [
S
 2013/07/15 18:58:03] [
web
.
lua
] 200 
OK
 
GET
 / (127.0.0.1è0
ms


14 -- 
Cİyright
 
John
 
Ab¿ham£n
 2011, 2012, 2013 < 
	gJhnAbrhm¢
@
	ggma
.
	gcom
 >

17 -- 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
	gš


18 -- 
the
 
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
	gto


19 -- 
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
	gcİ›s


20 -- 
of
 
the
 
	gSoáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
h
Soáw¬e
 
is
 
fuºished
o do

21 -- 
	gso
, 
subjeù
 
to
 
the
 
fŞlowšg
 
	gcÚd™iÚs
:

23 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


24 -- 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

26 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
	gOR


27 -- 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
	gMERCHANTABILITY
,

28 -- 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
	gTHE


29 -- 
AUTHORS
 
OR
 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gCLAIM
, 
DAMAGES
 OR 
	gOTHER


30 -- 
	gLIABILITY
, 
WHETHER
 
IN
 
AN
 
ACTION
 
OF
 
	gCONTRACT
, 
TORT
 
OR
 
	gOTHERWISE
, 
ARISING
 
	gFROM
,

31 -- 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 OR THE 
USE
 OR 
OTHER
 
DEALINGS
 IN 
	gTHE


32 -- 
	gSOFTWARE
."

34 
loÿl
 
	gut
 = 
»quœe
 "turbo.util"

35 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

36 
loÿl
 
ffi
 = 
»quœe
 "ffi"

38 
loÿl
 
log
 = {

40 -- 
EÇbË
 
Ü
 
di§bË
 
glob®
 
log
 
ÿ‹gÜ›s
.

41 -- 
The
 
ÿ‹gÜ›s
 
ÿn
 
be
 
modif›d
 
©
 
ªy
 
time
.

42 ["sucûss"] = 
Œue
,

43 ["nÙiû"] = 
Œue
,

44 ["w¬nšg"] = 
Œue
,

45 ["”rÜ"] = 
Œue
,

46 ["debug"] = 
Œue
,

47 ["dev–İm’t"] = 
Œue
,

48 ["¡ackŒaû"] = 
Œue


50 } -- 
log
 
	gÇme¥aû
.

52 
loÿl
 
	gbuf
 = 
ffi
.
Ãw
("ch¬[4096]"è-- 
Bufãr
 
log
 
lšes
.

53 
loÿl
 
time_t
 = 
ffi
.
Ãw
("time_t[1]")

56 --- 
Di§bË
 
®l
 
logš
 
ã©u»s
.

57 
funùiÚ
 
log
.
	$di§bË_®l
()

58 
log
.
ÿ‹gÜ›s
 = {

59 ["sucûss"] = 
çl£
,

60 ["nÙiû"] = 
çl£
,

61 ["w¬nšg"] = 
çl£
,

62 ["”rÜ"] = 
çl£
,

63 ["debug"] = 
çl£
,

64 ["dev–İm’t"] = 
çl£


65 
	}
}

66 
’d


68 
	g¶©fÜm
.
__UNIX__
 
	gth’


69 --- 
Log
 
to
 
	g¡dout
. 
Sucûss
 
	gÿ‹gÜy
.

70 -- 
U£
 
sucûssfuÎ
 
ev’ts
 
	g‘c
.

71 -- @
nÙe
 
Mes§ges
 
¬e
 
´š‹d
 
w™h
 
g»’
 
	gcŞÜ
.

72 -- @
·¿m
 
	$¡r
 (
SŒšg
è
Mes§ge
 
to
 
ouut
.

73 
funùiÚ
 
log
.
	$sucûss
(
¡r
)

74 
log
.
ÿ‹gÜ›s
.
sucûss
 =ğ
çl£
 
th’


76 
’d


77 
ffi
.
C
.
	$time
(
time_t
)

78 
loÿl
 
tm
 = 
ffi
.
C
.
	$loÿÉime
(
time_t
)

79 
loÿl
 
sz
 = 
ffi
.
C
.
	`¡ráime
(
buf
, 4096, "\x1b[32m[S %Y/%m/%d %H:%M:%S] ", 
tm
)

80 
loÿl
 
off£t


81 
sz
 + 
¡r
:
	`Ën
(è< 4094 
th’


82 -- 
U£
 
bufãr
.

83 
ffi
.
C
.
	`¥rštf
(
buf
 + 
sz
, "%s\x1b[0m\n", ffi.
	`ÿ¡
("cÚ¡ ch¬*", 
¡r
))

84 
ffi
.
C
.
	$åuts
(
buf
, 
io
.
¡dout
)

86 -- 
U£
 
Lua
 
¡ršg
.

87 
io
.
¡dout
:
	`wr™e
(
ffi
.
	`¡ršg
(
buf
, 
sz
è.. 
¡r
 .. "\x1b[0m\n")

88 
’d


89 
’d


91 
funùiÚ
 
log
.
	$sucûss
(
¡r
)

92 
log
.
ÿ‹gÜ›s
.
w¬nšg
 =ğ
çl£
 
th’


94 
’d


95 
io
.
¡dout
:
	`wr™e
(

96 
¡ršg
.
	`fÜm©
("%s %s \r\n",

97 
os
.
	`d©e
("[S %Y/%m/%d %H:%M:%S]", os.
	`time
()),

98 
¡r
))

99 
’d


100 
’d


102 
¶©fÜm
.
__UNIX__
 
th’


103 --- 
Log
 
to
 
¡dout
. 
NÙiû
 
ÿ‹gÜy
.

104 -- 
U£
 
nÙiûs
, 
typiÿÎy
 
nÚ
-
ü™iÿl
 
mes§ges
 
to
 
give
 
a
 
hšt
.

105 -- @
nÙe
 
Mes§ges
 
¬e
 
´š‹d
 
w™h
 
wh™e
 
cŞÜ
.

106 -- @
·¿m
 
	$¡r
 (
SŒšg
è
Mes§ge
 
to
 
ouut
.

107 
funùiÚ
 
log
.
	$nÙiû
(
¡r
)

108 
log
.
ÿ‹gÜ›s
.
nÙiû
 =ğ
çl£
 
th’


110 
’d


111 
ffi
.
C
.
	$time
(
time_t
)

112 
loÿl
 
tm
 = 
ffi
.
C
.
	$loÿÉime
(
time_t
)

113 
loÿl
 
sz
 = 
ffi
.
C
.
	`¡ráime
(
buf
, 4096, "[I %Y/%m/%d %H:%M:%S] ", 
tm
)

114 
loÿl
 
off£t


115 
sz
 + 
¡r
:
	`Ën
(è< 4094 
th’


116 -- 
U£
 
bufãr
.

117 
ffi
.
C
.
	`¥rštf
(
buf
 + 
sz
, "%s\n", ffi.
	`ÿ¡
("cÚ¡ ch¬*", 
¡r
))

118 
ffi
.
C
.
	$åuts
(
buf
, 
io
.
¡dout
)

120 -- 
U£
 
Lua
 
¡ršg
.

121 
io
.
¡dout
:
	`wr™e
(
ffi
.
	`¡ršg
(
buf
, 
sz
è.. 
¡r
 .. "\n")

122 
’d


123 
’d


125 
funùiÚ
 
log
.
	$nÙiû
(
¡r
)

126 
log
.
ÿ‹gÜ›s
.
w¬nšg
 =ğ
çl£
 
th’


128 
’d


129 
io
.
¡dout
:
	`wr™e
(

130 
¡ršg
.
	`fÜm©
("%s %s \r\n",

131 
os
.
	`d©e
("[I %Y/%m/%d %H:%M:%S]", os.
	`time
()),

132 
¡r
))

133 
’d


134 
’d


136 --- 
Log
 
to
 
¡d”r
. 
W¬nšg
 
ÿ‹gÜy
.

137 -- 
U£
 
w¬nšgs
.

138 -- @
nÙe
 
Mes§ges
 
¬e
 
´š‹d
 
w™h
 
y–low
 
cŞÜ
.

139 -- @
·¿m
 
	$¡r
 (
SŒšg
è
Mes§ge
 
to
 
ouut
.

140 
¶©fÜm
.
__UNIX__
 
th’


141 
funùiÚ
 
log
.
	$w¬nšg
(
¡r
)

142 
log
.
ÿ‹gÜ›s
.
w¬nšg
 =ğ
çl£
 
th’


144 
’d


145 
ffi
.
C
.
	$time
(
time_t
)

146 
loÿl
 
tm
 = 
ffi
.
C
.
	$loÿÉime
(
time_t
)

147 
loÿl
 
sz
 = 
ffi
.
C
.
	`¡ráime
(

148 
buf
,

151 
tm
)

152 
loÿl
 
off£t


153 
sz
 + 
¡r
:
	`Ën
(è< 4094 
th’


154 -- 
U£
 
bufãr
.

155 
ffi
.
C
.
	`¥rštf
(
buf
 + 
sz
, "%s\x1b[0m\n", ffi.
	`ÿ¡
("cÚ¡ ch¬*", 
¡r
))

156 
ffi
.
C
.
	$åuts
(
buf
, 
io
.
¡d”r
)

158 -- 
U£
 
Lua
 
¡ršg
.

159 
io
.
¡dout
:
	`wr™e
(
ffi
.
	`¡ršg
(
buf
, 
sz
è.. 
¡r
 .. "\x1b[0m\n")

160 
’d


161 
’d


163 
funùiÚ
 
log
.
	$w¬nšg
(
¡r
)

164 
log
.
ÿ‹gÜ›s
.
w¬nšg
 =ğ
çl£
 
th’


166 
’d


167 
io
.
¡dout
:
	`wr™e
(

168 
¡ršg
.
	`fÜm©
("%s %s \r\n",

169 
os
.
	`d©e
("[W %Y/%m/%d %H:%M:%S]", os.
	`time
()),

170 
¡r
))

171 
’d


172 
’d


174 --- 
Log
 
to
 
¡d”r
. 
E¼Ü
 
ÿ‹gÜy
.

175 -- 
U£
 
ü™iÿl
 
”rÜs
, 
wh’
 
som‘hšg
 
is
 
ş—¾y
 
wrÚg
.

176 -- @
nÙe
 
Mes§ges
 
¬e
 
´š‹d
 
w™h
 
»d
 
cŞÜ
.

177 -- @
·¿m
 
	$¡r
 (
SŒšg
è
Mes§ge
 
to
 
ouut
.

178 
¶©fÜm
.
__UNIX__
 
th’


179 
funùiÚ
 
log
.
	$”rÜ
(
¡r
)

180 
log
.
ÿ‹gÜ›s
.
”rÜ
 =ğ
çl£
 
th’


182 
’d


183 
ffi
.
C
.
	$time
(
time_t
)

184 
loÿl
 
tm
 = 
ffi
.
C
.
	$loÿÉime
(
time_t
)

185 
loÿl
 
sz
 = 
ffi
.
C
.
	`¡ráime
(
buf
, 4096, "\x1b[31m[E %Y/%m/%d %H:%M:%S] ", 
tm
)

186 
loÿl
 
off£t


187 
sz
 + 
¡r
:
	`Ën
(è< 4094 
th’


188 -- 
U£
 
bufãr
.

189 
ffi
.
C
.
	`¥rštf
(
buf
 + 
sz
, "%s\x1b[0m\n", ffi.
	`ÿ¡
("cÚ¡ ch¬*", 
¡r
))

190 
ffi
.
C
.
	$åuts
(
buf
, 
io
.
¡d”r
)

192 -- 
U£
 
Lua
 
¡ršg
.

193 
io
.
¡dout
:
	`wr™e
(
ffi
.
	`¡ršg
(
buf
, 
sz
è.. 
¡r
 .. "\x1b[0m\n")

194 
’d


195 
’d


197 
funùiÚ
 
log
.
	$”rÜ
(
¡r
)

198 
log
.
ÿ‹gÜ›s
.
w¬nšg
 =ğ
çl£
 
th’


200 
’d


201 
io
.
¡dout
:
	`wr™e
(

202 
¡ršg
.
	`fÜm©
("%s %s \r\n",

203 
os
.
	`d©e
("[E %Y/%m/%d %H:%M:%S]", os.
	`time
()),

204 
¡r
))

205 
’d


206 
’d


208 
¶©fÜm
.
__UNIX__
 
th’


209 --- 
Log
 
to
 
¡dout
. 
Debug
 
ÿ‹gÜy
.

210 -- 
U£
 
debug
 
mes§ges
 
nÙ
 
ü™iÿl
 
»Ëa£s
.

211 -- @
nÙe
 
Mes§ges
 
¬e
 
´š‹d
 
w™h
 
wh™e
 
cŞÜ
.

212 -- @
·¿m
 
	$¡r
 (
SŒšg
è
Mes§ge
 
to
 
ouut
.

213 
funùiÚ
 
log
.
	$debug
(
¡r
)

214 
log
.
ÿ‹gÜ›s
.
debug
 =ğ
çl£
 
th’


216 
’d


217 
ffi
.
C
.
	$time
(
time_t
)

218 
loÿl
 
tm
 = 
ffi
.
C
.
	$loÿÉime
(
time_t
)

219 
loÿl
 
sz
 = 
ffi
.
C
.
	`¡ráime
(
buf
, 4096, "[D %Y/%m/%d %H:%M:%S] ", 
tm
)

220 
loÿl
 
off£t


221 
sz
 + 
¡r
:
	`Ën
(è< 4094 
th’


222 -- 
U£
 
bufãr
.

223 
ffi
.
C
.
	`¥rštf
(
buf
 + 
sz
, "%s\n", ffi.
	`ÿ¡
("cÚ¡ ch¬*", 
¡r
))

224 
ffi
.
C
.
	$åuts
(
buf
, 
io
.
¡dout
)

226 -- 
U£
 
Lua
 
¡ršg
.

227 
io
.
¡dout
:
	`wr™e
(
ffi
.
	`¡ršg
(
buf
, 
sz
è.. 
¡r
 .. "\n")

228 
’d


229 
’d


231 
funùiÚ
 
log
.
	$debug
(
¡r
)

232 
log
.
ÿ‹gÜ›s
.
w¬nšg
 =ğ
çl£
 
th’


234 
’d


235 
io
.
¡dout
:
	`wr™e
(

236 
¡ršg
.
	`fÜm©
("%s %s \r\n",

237 
os
.
	`d©e
("[D %Y/%m/%d %H:%M:%S]", os.
	`time
()),

238 
¡r
))

239 
’d


240 
’d


242 
¶©fÜm
.
__UNIX__
 
th’


243 --- 
Log
 
to
 
¡dout
. 
Dev–İm’t
 
ÿ‹gÜy
.

244 -- 
U£
 
dev–İm’t
 
pu½o£
 
mes§ges
.

245 -- @
nÙe
 
Mes§ges
 
¬e
 
´š‹d
 
w™h
 
cyª
 
cŞÜ
.

246 -- @
·¿m
 
	$¡r
 (
SŒšg
è
Mes§ge
 
to
 
ouut
.

247 
funùiÚ
 
log
.
	$dev–
(
¡r
)

248 
log
.
ÿ‹gÜ›s
.
dev–İm’t
 =ğ
çl£
 
th’


250 
’d


251 
ffi
.
C
.
	$time
(
time_t
)

252 
loÿl
 
tm
 = 
ffi
.
C
.
	$loÿÉime
(
time_t
)

253 
loÿl
 
sz
 = 
ffi
.
C
.
	`¡ráime
(
buf
, 4096, "\x1b[36m[d %Y/%m/%d %H:%M:%S] ", 
tm
)

254 
loÿl
 
off£t


255 
sz
 + 
¡r
:
	`Ën
(è< 4094 
th’


256 -- 
U£
 
bufãr
.

257 
ffi
.
C
.
	`¥rštf
(
buf
 + 
sz
, "%s\x1b[0m\n", ffi.
	`ÿ¡
("cÚ¡ ch¬*", 
¡r
))

258 
ffi
.
C
.
	$åuts
(
buf
, 
io
.
¡dout
)

260 -- 
U£
 
Lua
 
¡ršg
.

261 
io
.
¡dout
:
	`wr™e
(
ffi
.
	`¡ršg
(
buf
, 
sz
è.. 
¡r
 .. "\x1b[0m\n")

262 
’d


263 
’d


265 
funùiÚ
 
log
.
	$dev–
(
¡r
)

266 
log
.
ÿ‹gÜ›s
.
w¬nšg
 =ğ
çl£
 
th’


268 
’d


269 
io
.
¡dout
:
	`wr™e
(

270 
¡ršg
.
	`fÜm©
("%s %s \r\n",

271 
os
.
	`d©e
("[d %Y/%m/%d %H:%M:%S]", os.
	`time
()),

272 
¡r
))

273 
’d


274 
’d


276 --- 
SŒšgify
 
Lua
 
bË
.

277 
funùiÚ
 
log
.
	$¡ršgify
(
t
, 
Çme
, 
šd’t
)

278 
loÿl
 
ÿ¹
 -- 
a
 
cÚš”


279 
loÿl
 
autÜef
 -- 
£lf
 
»ã»nûs


280 
loÿl
 
funùiÚ
 
	$i£m±ybË
(
t
è 
	`Ãxt
Ñè=ğ
n
 
’d


281 
loÿl
 
funùiÚ
 
	$basicS”Ÿlize
 (
o
)

282 
loÿl
 
so
 = 
	$to¡ršg
(
o
)

283 
	`ty³
(
o
è=ğ"funùiÚ" 
th’


284 
loÿl
 
šfo
 = 
debug
.
	`g‘šfo
(
o
, "S")

285 -- 
šfo
.
Çme
 
is
 
n
 
beÿu£
 
o
 i 
nÙ
 
a
 
ÿÎšg
 
Ëv–


286 
šfo
.
wh©
 =ğ"C" 
th’


287  
¡ršg
.
	`fÜm©
("%q", 
so
 .. ", C function")

289 -- 
the
 
šfÜm©iÚ
 
is
 
defšed
 
through
 
lšes


290  
¡ršg
.
	`fÜm©
("%q", 
so
 .. ", defined in (" ..

291 
šfo
.
lšedefšed
 .. "-" .. info.
Ï¡lšedefšed
 ..

292 ")" .. 
šfo
.
sourû
)

293 
’d


294 
–£if
 
	`ty³
(
o
è=ğ"numb”" 
Ü
y³(oè=ğ"boŞ—n" 
th’


295  
so


297  
¡ršg
.
	`fÜm©
("%q", 
so
)

298 
’d


299 
’d


300 
loÿl
 
funùiÚ
 
	$addtoÿ¹
 (
v®ue
, 
Çme
, 
šd’t
, 
§ved
, 
f›ld
)

301 
šd’t
 = ind’ˆ
Ü
 ""

302 
§ved
 = saved 
Ü
 {
	}
}

303 
f›ld
 = f›ld 
Ü
 
Çme


304 
ÿ¹
 = c¬ˆ.. 
šd’t
 .. 
f›ld


305 
ty³
(
v®ue
è~ğ"bË" 
th’


306 
ÿ¹
 = c¬ˆ.. " = " .. 
basicS”Ÿlize
(
v®ue
) .. ";\n"

308 
§ved
[
v®ue
] 
th’


309 
ÿ¹
 = c¬ˆ.. " = {}; -- " .. 
§ved
[
v®ue
]

311 
autÜef
 =‡utÜeà.. 
Çme
 .. " = " .. 
§ved
[
v®ue
] .. ";\n"

313 
§ved
[
v®ue
] = 
Çme


314 --
bËcouÁ
(
v®ue
è=ğ0 
th’


315 
	$i£m±ybË
(
v®ue
è
th’


316 
ÿ¹
 = cart .. " = {};\n"

318 
ÿ¹
 = cart .. " = {\n"

319 
k
, 
v
 
š
 
	$·œs
(
v®ue
) do

320 
k
 = 
	$basicS”Ÿlize
(
k
)

321 
loÿl
 
âame
 = 
¡ršg
.
	`fÜm©
("%s[%s]", 
Çme
, 
k
)

322 
f›ld
 = 
¡ršg
.
	`fÜm©
("[%s]", 
k
)

323 -- 
th»e
 
¥aûs
 
b‘w“n
 
Ëv–s


324 
	`addtoÿ¹
(
v
, 
âame
, 
šd’t
 .. " ", 
§ved
, 
f›ld
)

325 
’d


326 
ÿ¹
 = c¬ˆ.. 
šd’t
 .. "};\n"

327 
’d


328 
’d


329 
’d


330 
’d


331 
Çme
 =‚am
Ü
 "__unnamed__"

332 
	`ty³
(
t
è~ğ"bË" 
th’


333  
Çme
 .. " = " .. 
	$basicS”Ÿlize
(
t
)

334 
’d


335 
ÿ¹
, 
autÜef
 = "", ""

336 
	$addtoÿ¹
(
t
, 
Çme
, 
šd’t
)

337  
ÿ¹
 .. 
autÜef


338 
’d


340 --- 
U£fuÎ
 
´‘ty
 
´š‹r
 
debug
 
pu½o£s
.

341 -- @
·¿m
 
¡uff
 
V®ue
 
to
 
´št
. 
AÎ
 
suµÜ‹d
.

342 -- @
·¿m
 
	$desütiÚ
 (
SŒšg
è
O±iÚ®
 
desütiÚ
 
of
 
the
 
v®ue
 
dum³d
.

343 
funùiÚ
 
log
.
	$dump
(
¡uff
, 
desütiÚ
)

344 
io
.
¡dout
:
	`wr™e
(
log
.
	`¡ršgify
(
¡uff
, 
desütiÚ
) .. "\n")

345 
’d


347 --- 
Log
 
¡ackŒaû
 
to
 
¡d”r
.

348 -- 
U£
 
w¬nšgs
.

349 -- @
nÙe
 
Mes§ges
 
¬e
 
´š‹d
 
w™h
 
wh™e
 
cŞÜ
.

350 -- @
·¿m
 
	$¡r
 (
SŒšg
è
Mes§ge
 
to
 
ouut
.

351 
funùiÚ
 
log
.
	$¡ackŒaû
(
¡r
)

352 
log
.
ÿ‹gÜ›s
.
¡ackŒaû
 =ğ
çl£
 
th’


354 
’d


355 
io
.
¡d”r
:
	`wr™e
(
¡r
 .. "\n")

356 
’d


358  
log


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/mime_types.lua

1 --- 
	gTurbo
.
lua
 
fe
 
ty³
 
to
 
MIME
 
	gm­pšgs


3 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 -- 
ExŒaùed
 
äom
 
	gA·che
's mime.types

18 -- 
This
 
fe
 
cÚŒŞs
 
wh©
 
IÁ”Ãt
 
medŸ
 
ty³s
 
¬e
 
£Á
 
to
 
the
 
ş›Á
 

19 -- 
giv’
 
fe
 
ex‹nsiÚ
(
s
). 
S’dšg
 
the
 
cÜ»ù
 
medŸ
 
ty³
 
to
h
	gş›Á


20 -- 
is
 
impÜÁ
 
so
 
they
 
know
 
how
 
to
 
hªdË
 
the
 
cÚ‹Á
 
of
h
	gfe
.

21 -- 
ExŒa
 
ty³s
 
ÿn
 
e™h”
 
be
 
added
 
h”e
 
Ü
 
by
 
usšg
 
ª
 
AddTy³
 
	gdœeùive


22 -- 
š
 
your
 
cÚfig
 
	gfes
. 
FÜ
 
mÜe
 
šfÜm©iÚ
 
about
 
IÁ”Ãt
 
medŸ
 
	gty³s
,

23 -- 
¶—£
 
»ad
 
	gRFC
 2045, 2046, 2047, 2048, 
	gªd
 2077. 
The
 
IÁ”Ãt
 
medŸ
 
	gty³


24 -- 
»gi¡ry
 
is
 
	g©
 <
	gh‰p
:

28 
ez
 = "application/andrew-inset",

29 
	g©om
 = "application/atom+xml",

30 
	ghqx
 = "application/mac-binhex40",

31 
	gıt
 = "application/mac-compactpro",

32 
	gm©hml
 = "application/mathml+xml",

33 
	gdoc
 = "application/msword",

34 
	gbš
 = "application/octet-stream",

35 
	gdms
 = "application/octet-stream",

36 
	glha
 = "application/octet-stream",

37 
	glzh
 = "application/octet-stream",

38 
	gexe
 = "application/octet-stream",

39 
	gşass
 = "application/octet-stream",

40 
	gso
 = "application/octet-stream",

41 
	gdÎ
 = "application/octet-stream",

42 
	gdmg
 = "application/octet-stream",

43 
	goda
 = "application/oda",

44 
	gogg
 = "application/ogg",

45 
	gpdf
 = "application/pdf",

46 
	gai
 = "application/postscript",

47 
	g•s
 = "application/postscript",

48 
	gps
 = "application/postscript",

49 
	grdf
 = "application/rdf+xml",

50 
	gsmi
 = "application/smil",

51 
	gsm
 = "application/smil",

52 
	gg¿m
 = "application/srgs",

53 
	ggrxml
 = "application/srgs+xml",

54 
	gmif
 = "application/vnd.mif",

55 
	gxul
 = "application/vnd.mozilla.xul+xml",

56 
	gxls
 = "application/vnd.ms-excel",

57 
	gµt
 = "application/vnd.ms-powerpoint",

58 
	grm
 = "application/vnd.rn-realmedia",

59 
	gwbxml
 = "application/vnd.wap.wbxml",

60 
	gwmlc
 = "application/vnd.wap.wmlc",

61 
	gwmlsc
 = "application/vnd.wap.wmlscriptc",

62 
	gvxml
 = "application/voicexml+xml",

63 
	gbıio
 = "application/x-bcpio",

64 
	gvcd
 = "application/x-cdlink",

65 
	gpgn
 = "application/x-chess-pgn",

66 
	gıio
 = "application/x-cpio",

67 
	gcsh
 = "application/x-csh",

68 
	gdü
 = "application/x-director",

69 
	gdœ
 = "application/x-director",

70 
	gdxr
 = "application/x-director",

71 
	gdvi
 = "application/x-dvi",

72 
	g¥l
 = "application/x-futuresplash",

73 
	ggr
 = "application/x-gtar",

74 
	ghdf
 = "application/x-hdf",

75 
	gxhtml
 = "application/xhtml+xml",

76 
	gxht
 = "application/xhtml+xml",

77 
	gjs
 = "application/x-javascript",

78 
	gskp
 = "application/x-koan",

79 
	gskd
 = "application/x-koan",

80 
	gskt
 = "application/x-koan",

81 
	gskm
 = "application/x-koan",

82 
	gÏ‹x
 = "application/x-latex",

83 
	gxml
 = "application/xml",

84 
	gx¦
 = "application/xml",

85 
	gdtd
 = "application/xml-dtd",

86 
	gnc
 = "application/x-netcdf",

87 
	gcdf
 = "application/x-netcdf",

88 
	gsh
 = "application/x-sh",

89 
	gsh¬
 = "application/x-shar",

90 
	gswf
 = "application/x-shockwave-flash",

91 
	gx¦t
 = "application/xslt+xml",

92 
	gs™
 = "application/x-stuffit",

93 
	gsv4ıio
 = "application/x-sv4cpio",

94 
	gsv4üc
 = "application/x-sv4crc",

95 
	gr
 = "application/x-tar",

96 
	gtş
 = "application/x-tcl",

97 
	g‹x
 = "application/x-tex",

98 
	g‹xšfo
 = "application/x-texinfo",

99 
	g‹xi
 = "application/x-texinfo",

100 
	gt
 = "application/x-troff",

101 
	gŒ
 = "application/x-troff",

102 
	groff
 = "application/x-troff",

103 
	gmª
 = "application/x-troff-man",

104 
	gme
 = "application/x-troff-me",

105 
	gms
 = "application/x-troff-ms",

106 
	gu¡¬
 = "application/x-ustar",

107 
	g¤c
 = "application/x-wais-source",

108 
	gz
 = "application/zip",

109 
	gau
 = "audio/basic",

110 
	g¢d
 = "audio/basic",

111 
	gmid
 = "audio/midi",

112 
	gmidi
 = "audio/midi",

113 
	gk¬
 = "audio/midi",

114 
	gmpga
 = "audio/mpeg",

115 
	gmp2
 = "audio/mpeg",

116 
	gmp3
 = "audio/mpeg",

117 
	gaif
 = "audio/x-aiff",

118 
	gaiff
 = "audio/x-aiff",

119 
	gaifc
 = "audio/x-aiff",

120 
	gm3u
 = "audio/x-mpegurl",

121 
	g¿m
 = "audio/x-pn-realaudio",

122 
	g¿
 = "audio/x-pn-realaudio",

123 
	gwav
 = "audio/x-wav",

124 
	gpdb
 = "chemical/x-pdb",

125 
	gxyz
 = "chemical/x-xyz",

126 
	gbmp
 = "image/bmp",

127 
	gcgm
 = "image/cgm",

128 
	ggif
 = "image/gif",

129 
	g›f
 = "image/ief",

130 
	gj³g
 = "image/jpeg",

131 
	gjpg
 = "image/jpeg",

132 
	gj³
 = "image/jpeg",

133 
	g²g
 = "image/png",

134 
	gsvg
 = "image/svg+xml",

135 
	gsvgz
 = "image/svg+xml",

136 
	gtiff
 = "image/tiff",

137 
	gtif
 = "image/tiff",

138 
	gdjvu
 = "image/vnd.djvu",

139 
	gdjv
 = "image/vnd.djvu",

140 
	gwbmp
 = "image/vnd.wap.wbmp",

141 
	g¿s
 = "image/x-cmu-raster",

142 
	gico
 = "image/x-icon",

143 
	g²m
 = "image/x-portable-anymap",

144 
	gpbm
 = "image/x-portable-bitmap",

145 
	gpgm
 = "image/x-portable-graymap",

146 
	gµm
 = "image/x-portable-pixmap",

147 
	grgb
 = "image/x-rgb",

148 
	gxbm
 = "image/x-xbitmap",

149 
	gxpm
 = "image/x-xpixmap",

150 
	gxwd
 = "image/x-xwindowdump",

151 
	gigs
 = "model/iges",

152 
	giges
 = "model/iges",

153 
	gmsh
 = "model/mesh",

154 
	gmesh
 = "model/mesh",

155 
	gso
 = "model/mesh",

156 
	gw¾
 = "model/vrml",

157 
	gvrml
 = "model/vrml",

158 
	gics
 = "text/calendar",

159 
	gifb
 = "text/calendar",

160 
	gcss
 = "text/css",

161 
	ghtml
 = "text/html",

162 
	ghtm
 = "text/html",

163 
	gasc
 = "text/plain",

164 
	gtxt
 = "text/plain",

165 
	g¹x
 = "text/richtext",

166 
	g¹f
 = "text/rtf",

167 
	gsgml
 = "text/sgml",

168 
	gsgm
 = "text/sgml",

169 
	gtsv
 = "text/tab-separated-values",

170 
	gwml
 = "text/vnd.wap.wml",

171 
	gwmls
 = "text/vnd.wap.wmlscript",

172 
	g‘x
 = "text/x-setext",

173 
	gm³g
 = "video/mpeg",

174 
	gmpg
 = "video/mpeg",

175 
	gm³
 = "video/mpeg",

176 
	gqt
 = "video/quicktime",

177 
	gmov
 = "video/quicktime",

178 
	gmxu
 = "video/vnd.mpegurl",

179 
	gavi
 = "video/x-msvideo",

180 
	gmov›
 = "video/x-sgi-movie",

181 
	giû
 = "x-conference/x-cooltalk",

182 
	gwoff
 = "font/woff"

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/mustache.lua

1 --- 
	gTurbo
.
lua
 
	gMu¡ache
.
js
 
ç¡
 
	gcomp”
.

2 -- 
	gLogic
-
Ëss
 
‹m¶©es
 
	gw™h
 {{ }}, 
	gh‰p
:

3 -- 
Turbo
.
lua
 
has
 
a
 
sm®l
 
ªd
 
v”y
 
ç¡
 
Mu¡ache
 
·r£r
 
but
-
š
. Mustache

4 -- 
‹m¶©es
 
¬e
 
logic
-
Ëss
em¶©es, 
which
‡» 
suµo£d
 
to
 
h–p
 
you
 
	gk“p


5 -- 
your
 
busšess
 
logic
 
outside
 
of
 
‹m¶©es
 
ªd
 
	gšside
 "controllers".

7 -- 
FÜ
 
mÜe
 
šfÜm©iÚ
 
Ú
 
	gMu¡ache
, 
¶—£
 
£e
 
	gthis
:

8 -- 
h‰p
:

10 -- 
Cİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


12 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

13 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

14 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


16 -- 
	gh‰p
:

18 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


19 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

20 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

21 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


22 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

24 
loÿl
 
	gut
 = 
»quœe
 "turbo.util"

25 
loÿl
 
esÿ³
 = 
»quœe
 "turbo.escape"

26 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

27 
loÿl
 
log
 = 
»quœe
 "turbo.log"

28 
loÿl
 
ffi
 = 
»quœe
 "ffi"

29 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

30 
»quœe
 "turbo.3rdparty.middleclass"

32 
loÿl
 
b
 = 
¡ršg
.
by‹


34 
loÿl
 
START
 = "{{"

35 
loÿl
 
START_NO_ESC
 = "{{{"

36 
loÿl
 
END
 = "}}"

37 
loÿl
 
END_NO_ESC
 = "}}}"

38 
loÿl
 
START_SEC
 = '#'

39 
loÿl
 
END_SEC
 = '/'

40 
loÿl
 
START_INV_SEC
 = '^'

41 
loÿl
 
COMMENT
 = '!'

42 
loÿl
 
ESCAPE
 = '&'

43 
loÿl
 
PARTIAL
 = '>'

45 --- 
Mu¡ache
 
·r£r
 
¡©es
.

46 
loÿl
 
PNONE
 = 0x00

47 
loÿl
 
PSTART
 = 0x01

48 
loÿl
 
PSTARTNOESC
 = 0x02

49 
loÿl
 
PSTARTSEC
 = 0x03

50 
loÿl
 
PSTARTSECINV
 = 0x04

51 
loÿl
 
PTABLEKEY
 = 0x05

52 
loÿl
 
PTABLEKEYNOESC
 = 0x06

53 
loÿl
 
PEND
 = 0x07

54 
loÿl
 
PCOMMENT
 = 0x08

55 
loÿl
 
PPARTIAL
 = 0x09

57 --- 
Tem¶©e
 
š¡ruùiÚ
 
£t


58 
loÿl
 
MSTR
 = 0x01 -- 
CÚ¡ªt
 
¡ršg


59 
loÿl
 
TKEY
 = 0x02 -- 
TabË
 
key


60 
loÿl
 
TKEE
 = 0x22 -- 
TabË
 
key
 
esÿ³


61 
loÿl
 
SECS
 = 0x03 -- 
SeùiÚ
 
¡¿ight


62 
loÿl
 
SECI
 = 0x33 -- 
SeùiÚ
 
šv”‹d


63 
loÿl
 
SECE
 = 0x05 -- 
SeùiÚ
 
’d


64 
loÿl
 
PART
 = 0x06 -- 
P¬tŸl


66 
loÿl
 
Mu¡ache
 = {}

68 
loÿl
 
funùiÚ
 
	$IS_WHITESPACE
()

69 =ğ
b
 ' ' 
Ü
 =ğb '\t' 
th’


70  
Œue


71 
’d


72 
’d


74 
loÿl
 
funùiÚ
 
	$PLAIN_STRING
(
tbl
, 
±r
, 
sz
)

75 
tbl
[#tbl+1]ğ{
	}
}

76 
tbl
[#tbl][1] = 
MSTR


77 
tbl
[#tbl][2] = 
ffi
.
	$¡ršg
(
±r
, 
sz
)

78 
’d


80 
loÿl
 
funùiÚ
 
	$TABLE_KEY
(
tbl
, 
key
, 
sz
)

81 
tbl
[#tbl+1] = {
	}
}

82 
tbl
[#tbl][1] = 
TKEE


83 
tbl
[#tbl][2] = 
ffi
.
	$¡ršg
(
key
, 
sz
)

84 
’d


86 
loÿl
 
funùiÚ
 
	$TABLE_KEY_NO_ESC
(
tbl
, 
key
, 
sz
)

87 
tbl
[#tbl+1] = {
	}
}

88 
tbl
[#tbl][1] = 
TKEY


89 
tbl
[#tbl][2] = 
ffi
.
	$¡ršg
(
key
, 
sz
)

90 
’d


93 
loÿl
 
funùiÚ
 
	$SECTION
(
tbl
, 
key
, 
sz
)

94 
tbl
[#tbl+1] = {
	}
}

95 
tbl
[#tbl][1] = 
SECS


96 
tbl
[#tbl][2] = 
ffi
.
	$¡ršg
(
key
, 
sz
)

97 
’d


99 
loÿl
 
funùiÚ
 
	$SECTION_INVERTED
(
tbl
, 
key
, 
sz
)

100 
tbl
[#tbl+1] = {
	}
}

101 
tbl
[#tbl][1] = 
SECI


102 
tbl
[#tbl][2] = 
ffi
.
	$¡ršg
(
key
, 
sz
)

103 
’d


105 
loÿl
 
funùiÚ
 
	$SECTION_END
(
tbl
, 
key
, 
sz
)

106 
tbl
[#tbl+1] = {
	}
}

107 
tbl
[#tbl][1] = 
SECE


108 
tbl
[#tbl][2] = 
ffi
.
	$¡ršg
(
key
, 
sz
)

109 
’d


111 
loÿl
 
funùiÚ
 
	$SEARCH
(
h
, 
hËn
, 
n
)

112  
ut
.
	`¡r_fšd
(
h
, 
ffi
.
	`ÿ¡
("ch¬ *", 
n
), 
hËn
,‚:
	$Ën
())

113 
’d


115 
loÿl
 
funùiÚ
 
	$PARTIAL_NAME
(
tbl
, 
key
, 
sz
)

116 
tbl
[#tbl+1] = {
	}
}

117 
tbl
[#tbl][1] = 
PART


118 
tbl
[#tbl][2] = 
ffi
.
	$¡ršg
(
key
, 
sz
)

119 
’d


121 
loÿl
 
funùiÚ
 
	$CHECK_TABLE_SEC
(
tbl
, 
key
, 
sz
)

122 
loÿl
 
Çme
 = 
ffi
.
	$¡ršg
(
key
, 
sz
)

123 
i
 = #tbl, 1, -1 do

124 ià(
tbl
[
i
][1] =ğ
SECS
 
Ü
bl[i][1] =ğ
SECI
è
ªd


125 
tbl
[
i
][2] =ğ
Çme
 
th’


126  
Œue


127 
’d


128 
’d


129 
’d


131 --- 
Compe
 
a
 
Mu¡ache
 
highligh‹d
 
¡ršg
 
što
 
™s
 
š‹rmedŸ‹
 
¡©e
 
befÜe


132 -- 
»nd”šg
. 
This
 
funùiÚ
 
dÛs
 
some
 
v®id©iÚ
 
Ú
 
the
 
‹m¶©e
. 
If
 
™
 
fšds


133 -- 
syÁax
 
”rÜs
 
a
 
”rÜ
 
w™h
‡ 
mes§ge
 
is
 
¿i£d
. 
It
 i 
®ways
‡ 
good
 
id—
 
to


134 -- 
ÿche
 
´e
-
comped
 
äequ’y
 
u£d
 
‹m¶©es
 
befÜe
 
»nd”šg
 
them
. 
AÉhough


135 -- 
compšg
 
—ch
 
time
 
is
 
u§Îy
 
nÙ
 
a
 
big
 
ov”h—d
.

136 -- @
·¿m
 
	$‹m¶©e
 (
SŒšg
è
Tem¶©e
 
š
 
¡ršg
 
fÜm
.

137 -- @ (
TabË
è
P¬£
 
bË
 
th©
 
ÿn
 
be
 
u£d
 
Mu¡ache
.
»nd”
.

138 
funùiÚ
 
Mu¡ache
.
	$compe
(
‹m¶©e
)

139 
loÿl
 
vmtbl
 = {
	}
}

140 
loÿl
 
‹mp
 = 
ffi
.
ÿ¡
("ch¬*", 
‹m¶©e
)

141 
loÿl
 
	gtsz
 = 
‹m¶©e
:
	$Ën
()

142 
loÿl
 
cÚsumed
 = 0

143 
loÿl
 
¡©e
 = 
PNONE


144 
loÿl
 
m¬k


146 -- 
Fa¡
 
fÜw¬d
 
uÁ
 
mu¡aches
 
is
 
found
.

147 ::
£¬ch
::

148 
loÿl
 
loc
 = 
	`SEARCH
(
‹mp
, 
tsz
 - 
cÚsumed
, 
START
)

149 
loc
 ~ğ
n
 
th’


150 
loc
[2] ~ğ
b
 '{' 
th’


151 -- 
No
 
esÿ³
 
mu¡ache
 {{

152 
	`PLAIN_STRING
(
vmtbl
, 
‹mp
, 
loc
 -emp)

153 
¡©e
 = 
PSTART


154 
cÚsumed
 = cÚsumed + (
loc
 - 
‹mp
è+ 
START
:
	`Ën
()

155 
‹mp
 = 
loc
 + 
START
:
	`Ën
()

157 -- 
Esÿ³
 
mu¡ache
 {{{

158 
	`PLAIN_STRING
(
vmtbl
, 
‹mp
, (
loc
 -emp))

159 
¡©e
 = 
PSTARTNOESC


160 
cÚsumed
 = cÚsumed + (
loc
 - 
‹mp
è+ 
START_NO_ESC
:
	`Ën
()

161 
‹mp
 = 
loc
 + 
START_NO_ESC
:
	`Ën
()

162 
’d


164 -- 
No
 
mu¡aches
 
Ü
 
’d
 
of
 
fe
 
»ached
.

165 -- 
Add
 
wh©
 
is
 
Ëá
.

166 
	`PLAIN_STRING
(
vmtbl
, 
‹mp
, 
tsz
 - 
cÚsumed
)

167 
¡©e
 ~ğ
PNONE
 
th’


168 
	`”rÜ
("Unclosed mustaches inemplate.")

169 
’d


170 
»t


171 
’d


172 
cÚsumed
 < 
tsz
 do

173 
	`IS_WHITESPACE
(
‹mp
[0]è
th’


174 
¡©e
 =ğ
PTABLEKEY
 
th’


175 -- 
End
 
of
 
bË
 
key
 
wh™e¥aû
 
dœeùly
 
aá”
 
bËkey
.

176 
	`TABLE_KEY
(
vmtbl
, 
m¬k
, (
‹mp
 - mark))

177 
¡©e
 = 
PNONE


178 
–£if
 
¡©e
 =ğ
PTABLEKEYNOESC
 
th’


179 
	`TABLE_KEY_NO_ESC
(
vmtbl
, 
m¬k
, (
‹mp
 - mark))

180 
¡©e
 = 
PNONE


181 
–£if
 
¡©e
 =ğ
PEND
 
th’


182 -- 
Check
 
£ùiÚ
 
’d
 
is
 
aùu®ly
 
İ’ed
 
somewh”e
.

183 
nÙ
 
	`CHECK_TABLE_SEC
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - m¬k - 1)è
th’


184 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

186 
ffi
.
	`¡ršg
(
m¬k
 + 1, (
‹mp
 - mark - 1))))

187 
’d


188 
	`SECTION_END
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

189 
¡©e
 = 
PNONE


190 
–£if
 
¡©e
 =ğ
PSTARTSEC
 
th’


191 
	`SECTION
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

192 
¡©e
 = 
PNONE


193 
–£if
 
¡©e
 =ğ
PSTARTSECINV
 
th’


194 
	`SECTION_INVERTED
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

195 
¡©e
 = 
PNONE


196 
–£if
 
¡©e
 =ğ
PPARTIAL
 
th’


197 
m¬k
 + 1 =ğ
‹mp
 
th’


198 
m¬k
 = mark + 1

200 
	`PARTIAL_NAME
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

201 
¡©e
 = 
PNONE


202 
’d


203 
–£if
 
¡©e
 =ğ
PCOMMENT
 
th’


204 
¡©e
 = 
PNONE


205 
’d


206 -- 
Wh™e¥aû
 
is
 
®lowed
 
¡©e
 i 
nÙ
 
above
, 
ju¡
 
sk
.

207 -- 
Mo¡
 
´obably
 
™
 
is
 
som‘hšg
 
like
 {{ 
Çme
 }}

208 
–£if
 
‹mp
[0] =ğ
b
 '}' 
ªd
emp[1] =ğb '}' 
th’


209 -- 
End
 
of
 
mu¡ache
 
highlight
.

210 -- 
D‘”mše
 
esÿ³Ãss
.

211 
‹mp
[2] =ğ
b
 '}' 
th’


212 
¡©e
 =ğ
PTABLEKEYNOESC
 
th’


213 -- 
No
 
esÿ³
 
th»e
 
mu¡ache
 "}}}".

214 
	`TABLE_KEY_NO_ESC
(
vmtbl
, 
m¬k
, (
‹mp
 - mark))

215 
¡©e
 = 
PNONE


216 
–£if
 
¡©e
 =ğ
PSTARTSEC
 
th’


217 -- 
BasiÿÎy
 
we
 dØ
no
 
Œ—t
 
uÃsÿ³d
 
li¡
 {{{#li¡}}} 
ªy


218 -- 
Ùh”
 
way
 
thª
 {{#list}}

219 
	`SECTION
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

220 -- 
Sk
 
magic
 
ch¬aù”
 '#' 
äom
 
Çme
.

221 
¡©e
 = 
PNONE


222 
–£if
 
¡©e
 =ğ
PEND
 
th’


223 -- 
Check
 
£ùiÚ
 
’d
 
is
 
aùu®ly
 
İ’ed
 
somewh”e
.

224 
nÙ
 
	`CHECK_TABLE_SEC
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - m¬k - 1)è
th’


225 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

227 
ffi
.
	`¡ršg
(
m¬k
 + 1, (
‹mp
 - mark - 1)))

228 
’d


229 
	`SECTION_END
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

230 
¡©e
 = 
PNONE


231 
–£if
 
¡©e
 =ğ
PSTARTSECINV
 
th’


232 
	`SECTION_INVERTED
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

233 
¡©e
 = 
PNONE


234 
–£if
 
¡©e
 =ğ
PPARTIAL
 
th’


235 
	`PARTIAL_NAME
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

236 
¡©e
 = 
PNONE


237 
–£if
 
¡©e
 =ğ
PCOMMENT
 
th’


238 -- 
IgnÜe
 
comm’ts
.

239 
¡©e
 = 
PNONE


240 
’d


241 
‹mp
 =emp + 3

242 
cÚsumed
 = consumed + 3

244 
¡©e
 =ğ
PTABLEKEY
 
th’


245 
	`TABLE_KEY
(
vmtbl
, 
m¬k
, (
‹mp
 - mark))

246 
¡©e
 = 
PNONE


247 
–£if
 
¡©e
 =ğ
PTABLEKEYNOESC
 
th’


248 -- {{ &
key
Â }}Â .

249 
	`TABLE_KEY_NO_ESC
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

250 
¡©e
 = 
PNONE


251 
–£if
 
¡©e
 =ğ
PSTARTSEC
 
th’


252 
	`SECTION
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

253 
¡©e
 = 
PNONE


254 
–£if
 
¡©e
 =ğ
PEND
 
th’


255 
nÙ
 
	`CHECK_TABLE_SEC
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - m¬k - 1)è
th’


256 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

258 
ffi
.
	`¡ršg
(
m¬k
 + 1, (
‹mp
 - mark - 1))))

259 
’d


260 
	`SECTION_END
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

261 
¡©e
 = 
PNONE


262 
–£if
 
¡©e
 =ğ
PSTARTSECINV
 
th’


263 
	`SECTION_INVERTED
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

264 
¡©e
 = 
PNONE


265 
–£if
 
¡©e
 =ğ
PPARTIAL
 
th’


266 
	`PARTIAL_NAME
(
vmtbl
, 
m¬k
 + 1, (
‹mp
 - mark - 1))

267 
¡©e
 = 
PNONE


268 
–£if
 
¡©e
 =ğ
PCOMMENT
 
th’


269 
¡©e
 = 
PNONE


270 
’d


271 
‹mp
 =emp + 2

272 
cÚsumed
 = consumed + 2

273 
’d


274 
£¬ch


275 
–£if
 
¡©e
 =ğ
PSTART
 
Ü
 s‹ =ğ
PSTARTNOESC
 
th’


276 -- 
Es£ÁŸÎy
 
Ãxt
 
is
 
e™h”
 
fœ¡
 
of
 
key
 
Ü
 
™
 is

277 -- 
a
 
£ùiÚ
 "#". 
If
‡ 
m©ch
 
is
 
found
‡ 
m¬k
 i 
¶aûd
.

278 
‹mp
[0] =ğ
	`b
(
START_SEC
è
th’


279 
m¬k
 = 
‹mp


280 
¡©e
 = 
PSTARTSEC


281 
–£if
 
‹mp
[0] =ğ
	`b
(
START_INV_SEC
è
th’


282 
m¬k
 = 
‹mp


283 
¡©e
 = 
PSTARTSECINV


284 
–£if
 
‹mp
[0] =ğ
	`b
(
END_SEC
è
th’


285 
m¬k
 = 
‹mp


286 
¡©e
 = 
PEND


287 
–£if
 
‹mp
[0] =ğ
	`b
(
ESCAPE
è
th’


288 
m¬k
 = 
‹mp


289 
¡©e
 = 
PTABLEKEYNOESC


290 
–£if
 
‹mp
[0] =ğ
	`b
(
COMMENT
è
th’


291 -- 
Comm’t
 
¡©em’t
, 
ignÜe
.

292 
¡©e
 = 
PCOMMENT


293 
–£if
 
‹mp
[0] =ğ
	`b
(
PARTIAL
è
th’


294 
m¬k
 = 
‹mp


295 
¡©e
 = 
PPARTIAL


297 -- 
No
 
´efix
, 
mu¡
 
be
 
a
 
bË
 
key
.

298 
m¬k
 = 
‹mp


299 
¡©e
 =ğ
PSTART
 
th’


300 
¡©e
 = 
PTABLEKEY


302 
¡©e
 = 
PTABLEKEYNOESC


303 
’d


304 
’d


305 
’d


306 
cÚsumed
 = consumed + 1

307 
‹mp
 =emp + 1

308 
’d


309 ::
»t
::

310  
vmtbl


311 
’d


313 
funùiÚ
 
Mu¡ache
.
	`_fšd_š_obj_·»Ás
(
¬g
, 
obj_·»Ás
)

314 
i
 = 1, #obj_parents do

315 
obj_·»Ás
[
i
][
¬g
] 
th’


316  
obj_·»Ás
[
i
][
¬g
]

317 
’d


318 
’d


319 
’d


321 
funùiÚ
 
Mu¡ache
.
	`_»nd”_£ùiÚ
(
vmtbl
, 
obj
, 
i
, 
§ã
, 
·¹Ÿls
, 
obj_·»Ás
)

322 
loÿl
 
buf
 = 
	`bufãr
(1024)

323 
loÿl
 
£úame
 = 
vmtbl
[
i
][2]

324 
loÿl
 
šv”£d
 = 
vmtbl
[
i
][1] =ğ
SECI


325 
loÿl
 
ba£_i
 = 
i


326 
y
 = 1, #obj, 1 do

327 -- 
Re£t
 
to
 
ba£
.

328 
i
 = 
ba£_i
 + 1

330 
loÿl
 
š¡r
 = 
vmtbl
[
i
][1]

331 
loÿl
 
¬g
 = 
vmtbl
[
i
][2]

332 
š¡r
 =ğ
SECE
 
ªd
 
¬g
 =ğ
£úame
 
th’


333 -- 
End
 
of
 
cu¼’t
 
£ùiÚ
.

335 
–£if
 
š¡r
 =ğ
MSTR
 
th’


336 
buf
:
	`­³nd_lua¡r_right
(
¬g
)

337 
–£if
 
š¡r
 =ğ
TKEY
 
th’


338 
	`ty³
(
obj
[
y
]è=ğ"bË" 
ªd
 obj[y][
¬g
] 
th’


339 
	`ty³
(
obj
[
y
][
¬g
]è=ğ"¡ršg" 
th’


340 
buf
:
	`­³nd_lua¡r_right
(
obj
[
y
][
¬g
])

341 
–£if
 
	`ty³
(
obj
[
y
][
¬g
]è=ğ"numb”" 
th’


342 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
obj
[
y
][
¬g
]))

343 
–£if
 
	`ty³
(
obj
[
y
][
¬g
]è=ğ"funùiÚ" 
th’


344 -- 
May
 
®so
 
be
 
a
 
funùiÚ
.

345 
buf
:
	`­³nd_lua¡r_right
(
obj
[
y
][
¬g
]×rgè
Ü
 "")

346 
’d


348 
loÿl
 
š_·»Á
 = 
Mu¡ache
.
	`_fšd_š_obj_·»Ás
(
¬g
, 
obj_·»Ás
)

349 
š_·»Á
 
th’


350 
	`ty³
(
š_·»Á
è=ğ"¡ršg" 
th’


351 
buf
:
	`­³nd_lua¡r_right
(
š_·»Á
)

352 
–£if
 
	`ty³
(
š_·»Á
è=ğ"numb”" 
th’


353 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
š_·»Á
))

354 
–£if
 
	`ty³
(
š_·»Á
è=ğ"funùiÚ" 
th’


355 -- 
May
 
®so
 
be
 
a
 
funùiÚ
.

356 
buf
:
	`­³nd_lua¡r_right
(
	`š_·»Á
(
¬g
è
Ü
 "")

357 
’d


358 
–£if
 
§ã
 =ğ
Œue
 
th’


359 
	`”rÜ
(

360 
¡ršg
.
	`fÜm©
(

363 
	`ty³
(
obj
[
y
]),

364 
y
,

365 
Mu¡ache
.
	`_‹m¶©e_dump
(
vmtbl
, 
i
)))

366 
’d


367 
’d


368 
–£if
 
š¡r
 =ğ
TKEE
 
th’


369 
	`ty³
(
obj
[
y
]è=ğ"bË" 
ªd
 obj[y][
¬g
] 
th’


370 
	`ty³
(
obj
[
y
][
¬g
]è=ğ"¡ršg" 
th’


371 
buf
:
	`­³nd_lua¡r_right
(
esÿ³
.
	`html_esÿ³
(
obj
[
y
][
¬g
]))

372 
–£if
 
	`ty³
(
obj
[
y
][
¬g
]è=ğ"numb”" 
th’


373 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
obj
[
y
][
¬g
]))

374 
–£if
 
	`ty³
(
obj
[
y
][
¬g
]è=ğ"funùiÚ" 
th’


375 -- 
May
 
®so
 
be
 
a
 
funùiÚ
.

376 
buf
:
	`­³nd_lua¡r_right
(

377 
esÿ³
.
	`html_esÿ³
(
obj
[
y
][
¬g
]×rgè
Ü
 ""))

378 
’d


380 
loÿl
 
š_·»Á
 = 
Mu¡ache
.
	`_fšd_š_obj_·»Ás
(
¬g
, 
obj_·»Ás
)

381 
š_·»Á
 
th’


382 
	`ty³
(
š_·»Á
è=ğ"¡ršg" 
th’


383 
buf
:
	`­³nd_lua¡r_right
(
esÿ³
.
	`html_esÿ³
(
š_·»Á
))

384 
–£if
 
	`ty³
(
š_·»Á
è=ğ"numb”" 
th’


385 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
š_·»Á
))

386 
–£if
 
	`ty³
(
š_·»Á
è=ğ"funùiÚ" 
th’


387 -- 
May
 
®so
 
be
 
a
 
funùiÚ
.

388 
buf
:
	`­³nd_lua¡r_right
(

389 
esÿ³
.
	`html_esÿ³
(
	`š_·»Á
(
¬g
)è
Ü
 "")

390 
’d


391 
–£if
 
§ã
 =ğ
Œue
 
th’


392 
	`”rÜ
(

393 
¡ršg
.
	`fÜm©
(

396 
	`ty³
(
obj
[
y
]),

397 
y
,

398 
Mu¡ache
.
	`_‹m¶©e_dump
(
vmtbl
, 
i
)))

399 
’d


400 
’d


401 
–£if
 
š¡r
 =ğ
SECS
 
th’


402 
obj
[
y
][
¬g
] 
th’


403 
	`ty³
(
obj
[
y
][
¬g
]è=ğ"bË" 
ªd
 #obj[y][¬g] ~ğ0 
th’


404 -- 
Ne¡ed
 
£ùiÚ


405 
obj_·»Ás
[#obj_·»Ás+1] = 
obj
[
y
]

406 
loÿl
 
£cbuf
, 
Ãw_i
 =

407 
Mu¡ache
.
	`_»nd”_£ùiÚ
(
vmtbl
,

408 
obj
[
y
][
¬g
],

409 
i
,

410 
§ã
,

411 
·¹Ÿls
,

412 
obj_·»Ás
)

413 
i
 = 
Ãw_i


414 
buf
:
	`­³nd_right
(
£cbuf
:
	`g‘
())

416 -- 
SeùiÚ
 
u£d
 
as
 
cÚd™iÚ®
.

417 -- 
TabË
 
key
 
has
 
ev®u©ed
 
as
 
Œuthy
.

418 -- 
BasiÿÎy
 
nÙhšg
 
Ãeds
 
to
 
be
 
dÚe
.

419 
’d


421 -- 
SeùiÚ
 
is
 
pu»ly
 
u£d
 
as
 
a
 
cÚd™iÚ®
 
thšg
,

422 -- 
ªd
 
no
 
key
 
is
 
found
 
š
 
bË
.

423 -- 
Ju¡
 
ç¡
-
fÜw¬d
 
uÁ
 
SECE
 
is
 
found
.

425 
i
 = i + 1

426 
vmtbl
[
i
][1] =ğ
SECE
 
ªd
 vmtbl[i][2] =ğ
¬g
 
th’


428 
’d


429 
’d


430 
’d


431 
–£if
 
š¡r
 =ğ
SECI
 
th’


432 
obj
[
y
][
¬g
] 
th’


433 -- 
Objeù
 
exi¡s
 
š
 
a
 "iànÙ" 
cÚd™iÚ
.

434 -- 
Fa¡
-
fÜw¬d
 
tow¬ds
 
SECE
.

436 
i
 = i + 1

437 
vmtbl
[
i
][1] =ğ
SECE
 
ªd
 vmtbl[i][2] =ğ
¬g
 
th’


439 
’d


440 
’d


441 
’d


442 
–£if
 
š¡r
 =ğ
PART
 
th’


443 -- 
The
 
·¹Ÿl
 
g‘s
 
the
 
§me
 
objeù
 
cÚ‹xt
 
as
 
we
 
have
.

444 -- 
E™h”
 
a
 
‹m¶©e
 
¡ršg
 
Ü
‡ 
´e
-
comped
 
·r£
 
bË
 
ÿn
 
be


445 -- 
u£d
 
as
 
·¹Ÿl
.

446 
·¹Ÿls
[
¬g
] 
th’


447 
loÿl
 
·¹Ÿl
 = 
Mu¡ache
.
	`_»nd”_·¹Ÿl
(

448 
	`ty³
(
·¹Ÿls
[
¬g
]è=ğ"¡ršg" 
ªd


449 
Mu¡ache
.
	`compe
(
·¹Ÿls
[
¬g
]è
Ü
…artials[arg],

450 
obj
[
y
],

451 
obj_·»Ás
,

452 
·¹Ÿls
,

453 
§ã
)

454 
buf
:
	`­³nd_lua¡r_right
(
·¹Ÿl
)

455 
’d


456 
’d


457 
i
 = i + 1

458 
’d


459 
’d


460  
buf
, 
i


461 
’d


464 
funùiÚ
 
Mu¡ache
.
	`_»nd”_·¹Ÿl
(
vmtbl
, 
obj
, 
obj_·»Ás
, 
·¹Ÿls
, 
§ã
)

465 
loÿl
 
buf
 = 
	`bufãr
(1024*2)

466 
loÿl
 
i
 = 1

467 
loÿl
 
vmtbl_sz
 = #vmtbl

469 ::
¡¬t
::

470 
i
 =ğ
vmtbl_sz
 + 1 
th’


472 
’d


473 
loÿl
 
š¡r
 = 
vmtbl
[
i
][1]

474 
loÿl
 
¬g
 = 
vmtbl
[
i
][2]

475 
loÿl
 
£c


476 
š¡r
 =ğ
MSTR
 
th’


477 
buf
:
	`­³nd_lua¡r_right
(
¬g
)

478 
–£if
 
š¡r
 =ğ
TKEE
 
th’


479 
obj
[
¬g
] 
th’


480 
	`ty³
(
obj
[
¬g
]è=ğ"¡ršg" 
th’


481 
loÿl
 
esc
 = 
esÿ³
.
	`html_esÿ³
(
obj
[
¬g
])

482 
buf
:
	`­³nd_lua¡r_right
(
esc
)

483 
–£if
 
	`ty³
(
obj
[
¬g
]è=ğ"numb”" 
th’


484 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
obj
[
¬g
]))

485 
’d


487 
loÿl
 
š_·»Á
 = 
Mu¡ache
.
	`_fšd_š_obj_·»Ás
(
¬g
, 
obj_·»Ás
)

488 
š_·»Á
 
th’


489 
	`ty³
(
š_·»Á
è=ğ"¡ršg" 
th’


490 
buf
:
	`­³nd_lua¡r_right
(
š_·»Á
)

491 
–£if
 
	`ty³
(
š_·»Á
è=ğ"numb”" 
th’


492 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
š_·»Á
))

493 
–£if
 
	`ty³
(
š_·»Á
è=ğ"funùiÚ" 
th’


494 -- 
May
 
®so
 
be
 
a
 
funùiÚ
.

495 
buf
:
	`­³nd_lua¡r_right
(
	`š_·»Á
(
¬g
è
Ü
 "")

496 
’d


498 
–£if
 
§ã
 =ğ
Œue
 
th’


499 
	`”rÜ
(

500 
¡ršg
.
	`fÜm©
(

502 
Mu¡ache
.
	`_‹m¶©e_dump
(
vmtbl
, 
i
)))

503 
’d


504 
’d


505 
–£if
 
š¡r
 =ğ
TKEY
 
th’


506 
obj
[
¬g
] 
th’


507 
	`ty³
(
obj
[
¬g
]è=ğ"¡ršg" 
th’


508 
buf
:
	`­³nd_lua¡r_right
(
obj
[
¬g
])

509 
’d


511 
loÿl
 
š_·»Á
 = 
Mu¡ache
.
	`_fšd_š_obj_·»Ás
(
¬g
, 
obj_·»Ás
)

512 
š_·»Á
 
th’


513 
	`ty³
(
š_·»Á
è=ğ"¡ršg" 
th’


514 
buf
:
	`­³nd_lua¡r_right
(
š_·»Á
)

515 
–£if
 
	`ty³
(
š_·»Á
è=ğ"numb”" 
th’


516 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
š_·»Á
))

517 
–£if
 
	`ty³
(
š_·»Á
è=ğ"funùiÚ" 
th’


518 -- 
May
 
®so
 
be
 
a
 
funùiÚ
.

519 
buf
:
	`­³nd_lua¡r_right
(
	`š_·»Á
(
¬g
è
Ü
 "")

520 
’d


521 
–£if
 
§ã
 =ğ
Œue
 
th’


522 
	`”rÜ
(

523 
¡ršg
.
	`fÜm©
(

525 
Mu¡ache
.
	`_‹m¶©e_dump
(
vmtbl
, 
i
)))

526 
’d


527 
’d


528 
–£if
 
š¡r
 =ğ
SECS
 
th’


529 
obj
[
¬g
] 
th’


530 
	`ty³
(
obj
[
¬g
]è=ğ"bË" 
ªd
 #obj[¬g] ~ğ0 
th’


531 
loÿl
 
£cbuf
, 
Ãw_i
 = 
Mu¡ache
.
	`_»nd”_£ùiÚ
(
vmtbl
,

532 
obj
[
¬g
],

533 
i
,

534 
§ã
,

535 
·¹Ÿls
,

536 {
obj
})

537 
i
 = 
Ãw_i


538 
buf
:
	`­³nd_right
(
£cbuf
:
	`g‘
())

540 -- 
SeùiÚ
 
u£d
 
as
 
cÚd™iÚ®
.

541 -- 
TabË
 
key
 
has
 
ev®u©ed
 
as
 
Œuthy
.

542 -- 
BasiÿÎy
 
nÙhšg
 
Ãeds
 
to
 
be
 
dÚe
, 
exû±
 
hªdË
 
the


543 -- 
SECE
.

544 
’d


546 -- 
SeùiÚ
 
is
 
pu»ly
 
u£d
 
as
 
a
 
cÚd™iÚ®
 
thšg
, 
ªd
 
no
 
key
 is

547 -- 
found
 
š
 
bË
.

548 -- 
Ju¡
 
ç¡
-
fÜw¬d
 
uÁ
 
SECE
 
is
 
found
.

550 
i
 = i + 1

551 
vmtbl
[
i
][1] =ğ
SECE
 
th’


552 
¡¬t


553 
’d


554 
’d


555 
’d


556 
–£if
 
š¡r
 =ğ
SECI
 
th’


557 
obj
[
¬g
] 
th’


558 -- 
Objeù
 
exi¡s
 
š
 
a
 "iànÙ" 
cÚd™iÚ
.

559 -- 
Fa¡
-
fÜw¬d
 
tow¬ds
 
SECE
.

561 
i
 = i + 1

562 
vmtbl
[
i
][1] =ğ
SECE
 
th’


563 
¡¬t


564 
’d


565 
’d


567 -- 
Do
 
nÙhšg
 
ªd
  
run
.

568 
’d


569 
–£if
 
š¡r
 =ğ
PART
 
th’


570 
·¹Ÿls
[
¬g
] 
th’


571 
loÿl
 
·¹Ÿl
 = 
Mu¡ache
.
	`_»nd”_·¹Ÿl
(

572 
	`ty³
(
·¹Ÿls
[
¬g
]è=ğ"¡ršg" 
ªd


573 
Mu¡ache
.
	`compe
(
·¹Ÿls
[
¬g
]è
Ü
…artials[arg],

574 
obj
,

575 
obj_·»Ás
,

576 
·¹Ÿls
,

577 
®low_bÏnk
)

578 
buf
:
	`­³nd_lua¡r_right
(
·¹Ÿl
)

579 
’d


580 
’d


581 
i
 = i + 1

582 
’d


583  
	`to¡ršg
(
buf
)

584 
’d


586 
funùiÚ
 
Mu¡ache
.
	`_»nd”_‹m¶©e
(
vmtbl
, 
obj
, 
·¹Ÿls
, 
§ã
)

587 
loÿl
 
buf
 = 
	`bufãr
(1024*2)

588 
loÿl
 
i
 = 1

589 
loÿl
 
vmtbl_sz
 = #vmtbl

591 ::
¡¬t
::

592 
i
 =ğ
vmtbl_sz
 + 1 
th’


594 
’d


595 
loÿl
 
š¡r
 = 
vmtbl
[
i
][1]

596 
loÿl
 
¬g
 = 
vmtbl
[
i
][2]

597 
loÿl
 
£c


598 
š¡r
 =ğ
MSTR
 
th’


599 
buf
:
	`­³nd_lua¡r_right
(
¬g
)

600 
–£if
 
š¡r
 =ğ
TKEE
 
th’


601 
obj
[
¬g
] 
th’


602 
	`ty³
(
obj
[
¬g
]è=ğ"¡ršg" 
th’


603 
loÿl
 
esc
 = 
esÿ³
.
	`html_esÿ³
(
obj
[
¬g
])

604 
buf
:
	`­³nd_lua¡r_right
(
esc
)

605 
–£if
 
	`ty³
(
obj
[
¬g
]è=ğ"numb”" 
th’


606 
buf
:
	`­³nd_lua¡r_right
(
	`to¡ršg
(
obj
[
¬g
]))

607 
’d


608 
–£if
 
§ã
 =ğ
Œue
 
th’


609 
	`”rÜ
(

610 
¡ršg
.
	`fÜm©
(

612 
Mu¡ache
.
	`_‹m¶©e_dump
(
vmtbl
, 
i
)))

613 
’d


614 
–£if
 
š¡r
 =ğ
TKEY
 
th’


615 
obj
[
¬g
] 
th’


616 
	`ty³
(
obj
[
¬g
]è=ğ"¡ršg" 
th’


617 
buf
:
	`­³nd_lua¡r_right
(
obj
[
¬g
])

618 
’d


619 
–£if
 
§ã
 =ğ
Œue
 
th’


620 
	`”rÜ
(

621 
¡ršg
.
	`fÜm©
(

623 
Mu¡ache
.
	`_‹m¶©e_dump
(
vmtbl
, 
i
)))

624 
’d


625 
–£if
 
š¡r
 =ğ
SECS
 
th’


626 
obj
[
¬g
] 
th’


627 
	`ty³
(
obj
[
¬g
]è=ğ"bË" 
ªd
 #obj[¬g] ~ğ0 
th’


628 
loÿl
 
£cbuf
, 
Ãw_i
 = 
Mu¡ache
.
	`_»nd”_£ùiÚ
(
vmtbl
,

629 
obj
[
¬g
],

630 
i
,

631 
§ã
,

632 
·¹Ÿls
,

633 {
obj
})

634 
i
 = 
Ãw_i


635 
buf
:
	`­³nd_right
(
£cbuf
:
	`g‘
())

637 -- 
SeùiÚ
 
u£d
 
as
 
cÚd™iÚ®
.

638 -- 
TabË
 
key
 
has
 
ev®u©ed
 
as
 
Œuthy
.

639 -- 
BasiÿÎy
 
nÙhšg
 
Ãeds
 
to
 
be
 
dÚe
, 
exû±
 
hªdË
 
the


640 -- 
SECE
.

641 
’d


643 -- 
SeùiÚ
 
is
 
pu»ly
 
u£d
 
as
 
a
 
cÚd™iÚ®
 
thšg
, 
ªd
 
no
 
key
 is

644 -- 
found
 
š
 
bË
.

645 -- 
Ju¡
 
ç¡
-
fÜw¬d
 
uÁ
 
SECE
 
is
 
found
.

647 
i
 = i + 1

648 
vmtbl
[
i
][1] =ğ
SECE
 
ªd
 vmtbl[i][2] =ğ
¬g
 
th’


649 
¡¬t


650 
’d


651 
’d


652 
’d


653 
–£if
 
š¡r
 =ğ
SECI
 
th’


654 
obj
[
¬g
] 
th’


655 -- 
Objeù
 
exi¡s
 
š
 
a
 "iànÙ" 
cÚd™iÚ
.

656 -- 
Fa¡
-
fÜw¬d
 
tow¬ds
 
SECE
.

658 
i
 = i + 1

659 
vmtbl
[
i
][1] =ğ
SECE
 
ªd
 vmtbl[i][2] =ğ
¬g
 
th’


660 
¡¬t


661 
’d


662 
’d


664 -- 
Do
 
nÙhšg
 
ªd
  
run
.

665 
’d


666 
–£if
 
š¡r
 =ğ
PART
 
th’


667 -- 
The
 
·¹Ÿl
 
g‘s
 
the
 
§me
 
objeù
 
cÚ‹xt
 
as
 
we
 
have
.

668 -- 
E™h”
 
a
 
‹m¶©e
 
¡ršg
 
Ü
‡ 
´e
-
comped
 
·r£
 
bË
 
ÿn
 
be


669 -- 
u£d
 
as
 
·¹Ÿl
.

670 
·¹Ÿls
[
¬g
] 
th’


671 
loÿl
 
·¹Ÿl
 = 
Mu¡ache
.
	`»nd”
(
·¹Ÿls
[
¬g
],

672 
obj
,

673 
·¹Ÿls
,

674 
®low_bÏnk
)

676 
buf
:
	`­³nd_lua¡r_right
(
·¹Ÿl
)

677 
’d


678 
’d


679 
i
 = i + 1

680 
’d


681  
	`to¡ršg
(
buf
)

682 
’d


684 --- 
R’d”
 
a
 
‹m¶©e
. 
Acû±s
‡ 
·r£
 
bË
 
comped
 
by
 
Mu¡ache
.
compe


685 -- 
Ü
 
a
 
uncomped
 
¡ršg
. 
Obj
 
is
 
the
 
bË
 
w™h
 
keys
.

686 -- @
·¿m
 
®low_bÏnk
 
H®t
 
w™h
 
”rÜ
 
key
 
dÛs
 
nÙ
 
exi¡
 
š
 
objeù
 
bË
.

687 
funùiÚ
 
Mu¡ache
.
	`»nd”
(
‹m¶©e
, 
obj
, 
·¹Ÿls
, 
®low_bÏnk
)

688 
nÙ
 
‹m¶©e
 
th’


689 
	`”rÜ
("No…recompiledemplate oremplate string…assedo Mustache.render.")

690 
’d


691 
	`ty³
(
‹m¶©e
è=ğ"¡ršg" 
th’


692 
‹m¶©e
 = 
Mu¡ache
.
	`compe
(template)

693 
–£if
 
	`ty³
(
‹m¶©e
è~ğ"bË" 
th’


694 
	`”rÜ
("Invalidemplate…assedo Mustache.render")

695 
’d


696 
	`ty³
(
obj
è~ğ"bË" 
th’


697 
	`”rÜ
("Noable…assedo Mustache.render")

698 
’d


699  
Mu¡ache
.
	`_»nd”_‹m¶©e
(
‹m¶©e
, 
obj
, 
·¹Ÿls
, 
®low_bÏnk
)

700 
’d


702 
funùiÚ
 
Mu¡ache
.
	`_‹m¶©e_dump
(
tbl
, 
m¬k
)

703 
loÿl
 
dmp
 = ""

704 
loÿl
 
vmcode
 = {

714 
dmp
 = dmp.."\
====================================\n"

716 
i
 = 1, #tbl do

717 
tbl
[
i
][1] =ğ
SECS
 
Ü
bl[i][1] =ğ
SECI
 or

718 
tbl
[
i
][1] =ğ
SECE
 
th’


719 
dmp
 = dmp ..

720 
¡ršg
.
	`fÜm©
(" 0x%s \x1b[32m %s => \x1b[37m %s\n",

721 
b™
.
	`tohex
(
i
),

722 
vmcode
[
tbl
[
i
][1]],

723 
tbl
[
i
][2]:
	`gsub
("[\n\t]+", ""))

724 
–£if
 
tbl
[
i
][1] =ğ
TKEY
 
Ü
bl[i][1] =ğ
TKEE
 
th’


725 
dmp
 = dmp ..

726 
¡ršg
.
	`fÜm©
(" 0x%s \x1b[32m %s => \x1b[37m %s\n",

727 
b™
.
	`tohex
(
i
),

728 
vmcode
[
tbl
[
i
][1]],

729 
tbl
[
i
][2]:
	`gsub
("[\n\t]+", ""))

730 
–£if
 
tbl
[
i
][1] =ğ
PART
 
th’


731 
dmp
 = dmp ..

732 
¡ršg
.
	`fÜm©
(" 0x%s \x1b[35m %s => \x1b[37m %s\n",

733 
b™
.
	`tohex
(
i
),

734 
vmcode
[
tbl
[
i
][1]],

735 
tbl
[
i
][2]:
	`gsub
("[\n\t]+", ""))

737 
dmp
 = dmp ..

738 
¡ršg
.
	`fÜm©
(" 0x%s \x1b[36m %s => \x1b[37m '%s'\n",

739 
b™
.
	`tohex
(
i
),

740 
vmcode
[
tbl
[
i
][1]],

741 
tbl
[
i
][2]:
	`gsub
("[\n\t]+", ""))

742 
’d


743 
i
 =ğ
m¬k
 
th’


744 
dmp
 = dmp ..

746  
dmp


747 
’d


748 
’d


749 
dmp
 = dmp .. " ====================================\n"

750  
dmp


751 
’d


753 
Mu¡ache
.
Tem¶©eH–³r
 = 
	`şass
("TemplateHelper")

755 
funùiÚ
 
Mu¡ache
.
Tem¶©eH–³r
:
	`š™Ÿlize
(
·th
)

756 
£lf
.
‹m¶©es
 = {}

757 
£lf
:
	`£t_ba£_dœeùÜy
(
·th
)

758 
’d


760 
funùiÚ
 
Mu¡ache
.
Tem¶©eH–³r
:
	`£t_ba£_dœeùÜy
(
fe
)

761 
	`ty³
(
fe
è~ğ"¡ršg" 
th’


762 
	`”rÜ
("argument #1 is‚ot‡ string.")

763 
–£if
 #f=ğ0 
th’


764 
	`”rÜ
("argument #1ƒmpty string.")

765 
–£if
 
fe
:
	`sub
(#feè~ğ"/" 
th’


766 
fe
 = file .. "/"

767 
’d


768 
£lf
.
ba£_dœ
 = 
fe


769 
’d


771 
funùiÚ
 
Mu¡ache
.
Tem¶©eH–³r
:
	`lßd
(
‹m¶©e
)

772 
nÙ
 
‹m¶©e
 
th’


773 
	`”rÜ
("Noemplate‚ame specified.")

774 
–£if
 
nÙ
 
£lf
.
ba£_dœ
 
th’


775 
	`”rÜ
("Please call set_base_directory first.")

776 
’d


777 
£lf
.
‹m¶©es
[
‹m¶©e
] 
th’


778  
£lf
.
‹m¶©es
[
‹m¶©e
]

780 
loÿl
 
d©a
 = 
ut
.
	`»ad_®l
(
£lf
.
ba£_dœ
 .. 
‹m¶©e
)

781 
loÿl
 
tbl
 = 
Mu¡ache
.
	`compe
(
d©a
)

782 
£lf
.
‹m¶©es
[
‹m¶©e
] = 
tbl


783  
tbl


784 
’d


785 
’d


787 
funùiÚ
 
Mu¡ache
.
Tem¶©eH–³r
:
	`»nd”
(
‹m¶©e
, 
bË
, 
·¹Ÿls
, 
®low_bÏnk
)

788 
	`ty³
(
‹m¶©e
è=ğ"¡ršg" 
th’


789 
loÿl
 
comped_tm¶
 = 
£lf
:
	`lßd
(
‹m¶©e
)

790 
nÙ
 
comped_tm¶
 
th’


791 
	`”rÜ
("Could‚Ù†ßdem¶©" .. 
‹m¶©e
)

792 
’d


793  
Mu¡ache
.
	`»nd”
(
comped_tm¶
,

794 
bË
 
Ü
 {},

795 
·¹Ÿls
,

796 
®low_bÏnk
)

797 
’d


798  
Mu¡ache
.
	`»nd”
(
‹m¶©e
, 
bË
 
Ü
 {}, 
·¹Ÿls
, 
®low_bÏnk
)

799 
’d


801  
Mu¡ache


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/platform.lua

1 --- 
	gTurbo
.
lua
 
C
 
	gPÏtfÜm
 / 
OS
 
	gv¬ŸbËs
.

3 -- 
	gCİyright
 2014 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

19 
loÿl
 
uÇme
 = ""

20 
nÙ
 
ffi
.
abi
("wš"è
th’


21 
uÇme
 = (
	$funùiÚ
()

22 
loÿl
 
f
 = 
io
.
	`pİ’
("uname")

23 
loÿl
 
l
 = 
f
:
	`»ad
("*a")

24 
f
:
	$şo£
()

25  
l


26 
’d
)()

27 
’d


30 
__WINDOWS__
 = 
ffi
.
	`abi
("win"),

31 
__UNIX__
 = 
uÇme
:
	`m©ch
("Unix"è
Ü
 uname:match("Linux") or

32 
uÇme
:
	`m©ch
("D¬wš"è
ªd
 
Œue
 
Ü
 
çl£
,

33 
__LINUX__
 = 
uÇme
:
	`m©ch
("Lšux"è
ªd
 
Œue
 
Ü
 
çl£
,

34 
__DARWIN__
 = 
uÇme
:
	`m©ch
("D¬wš"è
ªd
 
Œue
 
Ü
 
çl£
,

35 
__ABI32__
 = 
ffi
.
	`abi
("32bit"),

36 
__ABI64__
 = 
ffi
.
	`abi
("64bit"),

37 
__X86__
 = 
ffi
.
¬ch
 == "x86",

38 
__X64__
 = 
ffi
.
¬ch
 == "x64",

39 
__PPC__
 = 
ffi
.
¬ch
 == "ppc",

40 
__PPC64__
 = 
ffi
.
¬ch
 == "ppc64le",

41 
__ARM__
 = 
ffi
.
¬ch
 == "arm",

42 
__MIPSEL__
 = 
ffi
.
¬ch
 == "mipsel",

43 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/signal.lua

1 --- 
	gTurbo
.
lua
 
SigÇl
 
	gModuË


3 -- 
Cİyright
 
John
 
	gAb¿ham£n
 2011, 2012, 2013 < 
	gJhnAbrhm¢
@
	ggma
.
	gcom
 >

6 -- 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
	gš


7 -- 
the
 
Soáw¬e
 
w™hout
 
	g»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
	gto


8 -- 
	gu£
, 
	gcİy
, 
	gmodify
, 
	gm”ge
, 
	gpublish
, 
	gdi¡ribu‹
, 
	gsubliûn£
, 
	gªd
/
Ü
 
£Î
 
	gcİ›s


9 -- 
of
 
the
 
	gSoáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
h
Soáw¬e
 
is
 
fuºished
o do

10 -- 
	gso
, 
subjeù
 
to
 
the
 
fŞlowšg
 
	gcÚd™iÚs
:

12 -- 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


13 -- 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

15 -- 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
	gKIND
, 
EXPRESS
 
	gOR


16 -- 
	gIMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
	gMERCHANTABILITY
,

17 -- 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
	gNONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
	gTHE


18 -- 
AUTHORS
 
OR
 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gCLAIM
, 
DAMAGES
 OR 
	gOTHER


19 -- 
	gLIABILITY
, 
WHETHER
 
IN
 
AN
 
ACTION
 
OF
 
	gCONTRACT
, 
TORT
 
OR
 
	gOTHERWISE
, 
ARISING
 
	gFROM
,

20 -- 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 OR THE 
USE
 OR 
OTHER
 
DEALINGS
 IN 
	gTHE


21 -- 
	gSOFTWARE
."

23 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

24 
»quœe
 "turbo.cdef"

25 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

27 
ffi
.
¬ch
 =ğ"m£l" 
th’


29 
sigÇl
 = 
ffi
.
C
.signal

30 -- 
FÜ
 
sig´ocmask
(2)

31 , 
	gSIG_BLOCK
 = 1

32 , 
	gSIG_UNBLOCK
 = 2

33 , 
	gSIG_SETMASK
 = 3

34 -- 
Fake
 
sigÇl
 
funùiÚs
.

35 , 
	gSIG_ERR
 = 
ffi
.
ÿ¡
("sighªdËr_t", -1è--[[ 
E¼Ü
 . ]]

36 , 
	gSIG_DFL
 = 
ffi
.
ÿ¡
("sighªdËr_t", 0è--[[ 
DeçuÉ
 
aùiÚ
. ]]

37 , 
	gSIG_IGN
 = 
ffi
.
ÿ¡
("sighªdËr_t", 1è--[[ 
IgnÜe
 
sigÇl
. ]]

38 -- 
	gSigÇls
.

39 , 
	gSIGHUP
 = 1 --[[ 
Hªgup
 (
POSIX
). ]]

40 , 
	gSIGINT
 = 2 --[[ 
IÁ”ru±
 (
ANSI
). ]]

41 , 
	gSIGQUIT
 = 3 --[[ 
Qu™
 (
POSIX
). ]]

42 , 
	gSIGILL
 = 4 --[[ 
IÎeg®
 
š¡ruùiÚ
 (
ANSI
). ]]

43 , 
	gSIGTRAP
 = 5 --[[ 
T¿û
 
Œ­
 (
POSIX
). ]]

44 , 
	gSIGIOT
 = 6 --[[ 
IOT
 
Œ­
 (4.2 
BSD
). ]]

45 , 
	gSIGABRT
 = 
SIGIOT
 --[[ 
AbÜt
 (
ANSI
). ]]

46 , 
	gSIGBUS
 = 10 --[[ 
BUS
 
”rÜ
 (4.2 
BSD
). ]]

47 , 
	gSIGFPE
 = 8 --[[ 
Flßtšg
-
pošt
 
exû±iÚ
 (
ANSI
). ]]

48 , 
	gSIGKILL
 = 9 --[[ 
Kl
, 
unblockabË
 (
POSIX
). ]]

49 , 
	gSIGUSR1
 = 16 --[[ 
U£r
-
defšed
 
sigÇl
 1 (
POSIX
). ]]

50 , 
	gSIGSEGV
 = 11 --[[ 
Segm’tiÚ
 
viŞ©iÚ
 (
ANSI
). ]]

51 , 
	gSIGUSR2
 = 17 --[[ 
U£r
-
defšed
 
sigÇl
 2 (
POSIX
). ]]

52 , 
	gSIGPIPE
 = 13 --[[ 
Brok’
 
pe
 (
POSIX
). ]]

53 , 
	gSIGALRM
 = 14 --[[ 
AÏrm
 
şock
 (
POSIX
). ]]

54 , 
	gSIGTERM
 = 15 --[[ 
T”mš©iÚ
 (
ANSI
). ]]

55 , 
	gSIGSTKFLT
 = 16 --[[ 
Sck
 
çuÉ
. ]]

56 , 
	gSIGCLD
 = 18 --[[ 
Same
 
as
 
SIGCHLD
 (
Sy¡em
 
V
). ]]

57 , 
	gSIGCHLD
 = 18 --[[ 
Chd
 
¡©us
 
has
 
chªged
 (
POSIX
). ]]

58 , 
	gSIGCONT
 = 25 --[[ 
CÚtšue
 (
POSIX
). ]]

59 , 
	gSIGSTOP
 = 23 --[[ 
Stİ
, 
unblockabË
 (
POSIX
). ]]

60 , 
	gSIGTSTP
 = 24 --[[ 
Keybßrd
 
¡İ
 (
POSIX
). ]]

61 , 
	gSIGTTIN
 = 26 --[[ 
Background
 
»ad
 
äom
 
‰y
 (
POSIX
). ]]

62 , 
	gSIGTTOU
 = 27 --[[ 
Background
 
wr™e
 
to
 
‰y
 (
POSIX
). ]]

63 , 
	gSIGURG
 = 21 --[[ 
Urg’t
 
cÚd™iÚ
 
Ú
 
sock‘
 (4.2 
BSD
). ]]

64 , 
	gSIGXCPU
 = 30 --[[ 
CPU
 
lim™
 
exûeded
 (4.2 
BSD
). ]]

65 , 
	gSIGXFSZ
 = 31 --[[ 
Fe
 
size
 
lim™
 
exûeded
 (4.2 
BSD
). ]]

66 , 
	gSIGVTALRM
 = 28 --[[ 
Vœtu®
 
®¬m
 
şock
 (4.2 
BSD
). ]]

67 , 
	gSIGPROF
 = 29 --[[ 
Profšg
 
®¬m
 
şock
 (4.2 
BSD
). ]]

68 , 
	gSIGWINCH
 = 20 --[[ 
Wšdow
 
size
 
chªge
 (4.3 
BSD
, 
Sun
). ]]

69 , 
	gSIGIO
 = 22 --[[ 
I
/
O
 
now
 
possibË
 (4.2 
BSD
). ]]

70 , 
	gSIGPOLL
 = 
SIGIO
 --[[ 
PŞÏbË
 
ev’t
 
occu¼ed
 (
Sy¡em
 
V
). ]]

71 , 
	gSIGPWR
 = 19 --[[ 
Pow”
 
çu»
 
»¡¬t
 (
Sy¡em
 
V
). ]]

72 , 
	gSIGSYS
 = 12 --[[ 
Bad
 
sy¡em
 
ÿÎ
. ]]

73 -- , 
	gSIGUNUSED
 = 31 --[[ 
NÙ
 
defšed
 
š
 
MIPSEL
 ]]

74 , 
	g_NSIG
 = 128 --[[ 
Bigge¡
 
sigÇl
 
numb”
 + 1 (
šşudšg
 
»®
-
time
 
sigÇls
). ]]

78 
	gsigÇl
 = 
ffi
.
C
.
sigÇl


79 -- 
FÜ
 
sig´ocmask
(2)

80 , 
	gSIG_BLOCK
 = 0

81 , 
	gSIG_UNBLOCK
 = 1

82 , 
	gSIG_SETMASK
 = 2

83 -- 
Fake
 
sigÇl
 
funùiÚs
.

84 , 
	gSIG_ERR
 = 
ffi
.
ÿ¡
("sighªdËr_t", -1è--[[ 
E¼Ü
 . ]]

85 , 
	gSIG_DFL
 = 
ffi
.
ÿ¡
("sighªdËr_t", 0è--[[ 
DeçuÉ
 
aùiÚ
. ]]

86 , 
	gSIG_IGN
 = 
ffi
.
ÿ¡
("sighªdËr_t", 1è--[[ 
IgnÜe
 
sigÇl
. ]]

87 -- 
	gSigÇls
.

88 , 
	gSIGHUP
 = 1 --[[ 
Hªgup
 (
POSIX
). ]]

89 , 
	gSIGINT
 = 2 --[[ 
IÁ”ru±
 (
ANSI
). ]]

90 , 
	gSIGQUIT
 = 3 --[[ 
Qu™
 (
POSIX
). ]]

91 , 
	gSIGILL
 = 4 --[[ 
IÎeg®
 
š¡ruùiÚ
 (
ANSI
). ]]

92 , 
	gSIGTRAP
 = 5 --[[ 
T¿û
 
Œ­
 (
POSIX
). ]]

93 , 
	gSIGABRT
 = 6 --[[ 
AbÜt
 (
ANSI
). ]]

94 , 
	gSIGIOT
 = 6 --[[ 
IOT
 
Œ­
 (4.2 
BSD
). ]]

95 , 
	gSIGBUS
 = 7 --[[ 
BUS
 
”rÜ
 (4.2 
BSD
). ]]

96 , 
	gSIGFPE
 = 8 --[[ 
Flßtšg
-
pošt
 
exû±iÚ
 (
ANSI
). ]]

97 , 
	gSIGKILL
 = 9 --[[ 
Kl
, 
unblockabË
 (
POSIX
). ]]

98 , 
	gSIGUSR1
 = 10 --[[ 
U£r
-
defšed
 
sigÇl
 1 (
POSIX
). ]]

99 , 
	gSIGSEGV
 = 11 --[[ 
Segm’tiÚ
 
viŞ©iÚ
 (
ANSI
). ]]

100 , 
	gSIGUSR2
 = 12 --[[ 
U£r
-
defšed
 
sigÇl
 2 (
POSIX
). ]]

101 , 
	gSIGPIPE
 = 13 --[[ 
Brok’
 
pe
 (
POSIX
). ]]

102 , 
	gSIGALRM
 = 14 --[[ 
AÏrm
 
şock
 (
POSIX
). ]]

103 , 
	gSIGTERM
 = 15 --[[ 
T”mš©iÚ
 (
ANSI
). ]]

104 , 
	gSIGSTKFLT
 = 16 --[[ 
Sck
 
çuÉ
. ]]

105 , 
	gSIGCLD
 = 17 --[[ 
Same
 
as
 
SIGCHLD
 (
Sy¡em
 
V
). ]]

106 , 
	gSIGCHLD
 = 17 --[[ 
Chd
 
¡©us
 
has
 
chªged
 (
POSIX
). ]]

107 , 
	gSIGCONT
 = 18 --[[ 
CÚtšue
 (
POSIX
). ]]

108 , 
	gSIGSTOP
 = 19 --[[ 
Stİ
, 
unblockabË
 (
POSIX
). ]]

109 , 
	gSIGTSTP
 = 20 --[[ 
Keybßrd
 
¡İ
 (
POSIX
). ]]

110 , 
	gSIGTTIN
 = 21 --[[ 
Background
 
»ad
 
äom
 
‰y
 (
POSIX
). ]]

111 , 
	gSIGTTOU
 = 22 --[[ 
Background
 
wr™e
 
to
 
‰y
 (
POSIX
). ]]

112 , 
	gSIGURG
 = 23 --[[ 
Urg’t
 
cÚd™iÚ
 
Ú
 
sock‘
 (4.2 
BSD
). ]]

113 , 
	gSIGXCPU
 = 24 --[[ 
CPU
 
lim™
 
exûeded
 (4.2 
BSD
). ]]

114 , 
	gSIGXFSZ
 = 25 --[[ 
Fe
 
size
 
lim™
 
exûeded
 (4.2 
BSD
). ]]

115 , 
	gSIGVTALRM
 = 26 --[[ 
Vœtu®
 
®¬m
 
şock
 (4.2 
BSD
). ]]

116 , 
	gSIGPROF
 = 27 --[[ 
Profšg
 
®¬m
 
şock
 (4.2 
BSD
). ]]

117 , 
	gSIGWINCH
 = 28 --[[ 
Wšdow
 
size
 
chªge
 (4.3 
BSD
, 
Sun
). ]]

118 , 
	gSIGPOLL
 = 29 --[[ 
PŞÏbË
 
ev’t
 
occu¼ed
 (
Sy¡em
 
V
). ]]

119 , 
	gSIGIO
 = 29 --[[ 
I
/
O
 
now
 
possibË
 (4.2 
BSD
). ]]

120 , 
	gSIGPWR
 = 30 --[[ 
Pow”
 
çu»
 
»¡¬t
 (
Sy¡em
 
V
). ]]

121 , 
	gSIGSYS
 = 31 --[[ 
Bad
 
sy¡em
 
ÿÎ
. ]]

122 , 
	gSIGUNUSED
 = 31

123 , 
	g_NSIG
 = 65 --[[ 
Bigge¡
 
sigÇl
 
numb”
 + 1 (
šşudšg
 
»®
-
time
 
sigÇls
). ]]

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/socket_ffi.lua

1 --- 
	gTurbo
.
lua
 
Sock‘
 
	gModuË


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	glog
 = 
»quœe
 "turbo.log"

18 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

19 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

20 
loÿl
 
ffi
 = 
»quœe
 "ffi"

21 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

22 
»quœe
 "turbo.cdef"

24 
loÿl
 
où®
 = 
	$funùiÚ
 (
s
è 
	$tÚumb”
(
s
, 8è
’d


25 
loÿl
 
hex
 = 
	$funùiÚ
 (
s
è 
	$tÚumb”
(
s
, 16è
’d


27 
loÿl
 
F
 = {
	}
}

28 
F
.
F_DUPFD
 = 0

29 
F
.
F_GETFD
 = 1

30 
F
.
F_SETFD
 = 2

31 
F
.
F_GETFL
 = 3

32 
F
.
F_SETFL
 = 4

34 
loÿl
 
O
 = {}

35 
ffi
.
¬ch
 =ğ"m£l" 
th’


36 
O
.
O_ACCMODE
 = 
où®
("0003")

37 
O
.
O_RDONLY
 = 
où®
("00")

38 
O
.
O_WRONLY
 = 
où®
("01")

39 
O
.
O_RDWR
 = 
où®
("02")

40 
O
.
O_CREAT
 = 
où®
("0400")

41 
O
.
O_EXCL
 = 
où®
("2000")

42 
O
.
O_NOCTTY
 = 
où®
("4000")

43 
O
.
O_TRUNC
 = 
où®
("1000")

44 
O
.
O_APPEND
 = 
où®
("0010")

45 
O
.
O_NONBLOCK
 = 
où®
("0200")

46 
O
.
O_NDELAY
 = O.
O_NONBLOCK


47 
O
.
O_SYNC
 = 
où®
("0020")

48 
O
.
O_FSYNC
 = O.
O_SYNC


49 
O
.
O_ASYNC
 = 
où®
("10000")

51 
O
.
O_ACCMODE
 = 
où®
("0003")

52 
O
.
O_RDONLY
 = 
où®
("00")

53 
O
.
O_WRONLY
 = 
où®
("01")

54 
O
.
O_RDWR
 = 
où®
("02")

55 
O
.
O_CREAT
 = 
où®
("0100")

56 
O
.
O_EXCL
 = 
où®
("0200")

57 
O
.
O_NOCTTY
 = 
où®
("0400")

58 
O
.
O_TRUNC
 = 
où®
("01000")

59 
O
.
O_APPEND
 = 
où®
("02000")

60 
O
.
O_NONBLOCK
 = 
où®
("04000")

61 
O
.
O_NDELAY
 = O.
O_NONBLOCK


62 
O
.
O_SYNC
 = 
où®
("04010000")

63 
O
.
O_FSYNC
 = O.
O_SYNC


64 
O
.
O_ASYNC
 = 
où®
("020000")

65 
’d


67 
loÿl
 
SOCK
 = {}

68 
ffi
.
¬ch
 =ğ"m£l" 
th’


69 
SOCK
.
SOCK_STREAM
 = 2

70 
SOCK
.
SOCK_DGRAM
 = 1

71 
SOCK
.
SOCK_RAW
 = 3

72 
SOCK
.
SOCK_RDM
 = 4

73 
SOCK
.
SOCK_SEQPACKET
 = 5

74 
SOCK
.
SOCK_DCCP
 = 6

75 
SOCK
.
SOCK_PACKET
 = 10

76 
SOCK
.
SOCK_CLOEXEC
 = 
où®
("02000000")

77 
SOCK
.
SOCK_NONBLOCK
 = 
où®
("0200")

79 
SOCK
.
SOCK_STREAM
 = 1

80 
SOCK
.
SOCK_DGRAM
 = 2

81 
SOCK
.
SOCK_RAW
 = 3

82 
SOCK
.
SOCK_RDM
 = 4

83 
SOCK
.
SOCK_SEQPACKET
 = 5

84 
SOCK
.
SOCK_DCCP
 = 6

85 
SOCK
.
SOCK_PACKET
 = 10

86 
SOCK
.
SOCK_CLOEXEC
 = 
où®
("02000000")

87 
SOCK
.
SOCK_NONBLOCK
 = 
où®
("040009")

88 
’d


90 --[[ 
PrÙocŞ
 
çm›s
. ]]

91 
loÿl
 
PF
 = {}

92 
PF
.
PF_UNSPEC
 = 0 --[[ 
Un¥ecif›d
. ]]

93 
PF
.
PF_LOCAL
 = 1 --[[ 
Loÿl
 
to
 
ho¡
 (
pes
 
ªd
 
fe
-
domaš
). ]]

94 
PF
.
PF_UNIX
 = PF.
PF_LOCAL
 --[[ 
POSIX
 
Çme
 PF.PF_LOCAL. ]]

95 
PF
.
PF_FILE
 = PF.
PF_LOCAL
 --[[ 
AnÙh”
 
nÚ
-
¡ªd¬d
 
Çme
 PF.PF_LOCAL. ]]

96 
PF
.
PF_INET
 = 2 --[[ 
IP
 
´ÙocŞ
 
çmy
. ]]

97 
PF
.
PF_AX25
 = 3 --[[ 
Am©eur
 
Radio
 
AX
.25. ]]

98 
PF
.
PF_IPX
 = 4 --[[ 
Nov–l
 
IÁ”Ãt
 
PrÙocŞ
. ]]

99 
PF
.
PF_APPLETALK
 = 5 --[[ 
AµËlk
 
DDP
. ]]

100 
PF
.
PF_NETROM
 = 6 --[[ 
Am©eur
 
¿dio
 
N‘ROM
. ]]

101 
PF
.
PF_BRIDGE
 = 7 --[[ 
MuÉrÙocŞ
 
bridge
. ]]

102 
PF
.
PF_ATMPVC
 = 8 --[[ 
ATM
 
PVCs
. ]]

103 
PF
.
PF_X25
 = 9 --[[ 
Re£rved
 
X
.25 
´ojeù
. ]]

104 
PF
.
PF_INET6
 = 10 --[[ 
IP
 
v”siÚ
 6. ]]

105 
PF
.
PF_ROSE
 = 11 --[[ 
Am©eur
 
Radio
 
X
.25 
PLP
. ]]

106 
PF
.
PF_DECÃt
 = 12 --[[ 
Re£rved
 
DECÃt
 
´ojeù
. ]]

107 
PF
.
PF_NETBEUI
 = 13 --[[ 
Re£rved
 802.2LLC 
´ojeù
. ]]

108 
PF
.
PF_SECURITY
 = 14 --[[ 
Secur™y
 
ÿÎback
 
p£udo
 
AF
. ]]

109 
PF
.
PF_KEY
 = 15 --[[ PF.PF_KEY 
key
 
mªagem’t
 
API
. ]]

110 
PF
.
PF_NETLINK
 = 16

111 
PF
.
PF_ROUTE
 = PF.
PF_NETLINK
 --[[ 
AlŸs
 
to
 
emuÏ‹
 4.4B
SD
. ]]

112 
PF
.
PF_PACKET
 = 17 --[[ 
Pack‘
 
çmy
. ]]

113 
PF
.
PF_ASH
 = 18 --[[ 
Ash
. ]]

114 
PF
.
PF_ECONET
 = 19 --[[ 
AcÜn
 
EcÚ‘
. ]]

115 
PF
.
PF_ATMSVC
 = 20 --[[ 
ATM
 
SVCs
. ]]

116 
PF
.
PF_RDS
 = 21 --[[ 
RDS
 
sock‘s
. ]]

117 
PF
.
PF_SNA
 = 22 --[[ 
Lšux
 
SNA
 
Projeù
 ]]

118 
PF
.
PF_IRDA
 = 23 --[[ 
IRDA
 
sock‘s
. ]]

119 
PF
.
PF_PPPOX
 = 24 --[[ 
PPPoX
 
sock‘s
. ]]

120 
PF
.
PF_WANPIPE
 = 25 --[[ 
Wªpe
 
API
 
sock‘s
. ]]

121 
PF
.
PF_LLC
 = 26 --[[ 
Lšux
 
LLC
. ]]

122 
PF
.
PF_CAN
 = 29 --[[ 
CÚŒŞËr
 
A»a
 
N‘wÜk
. ]]

123 
PF
.
PF_TIPC
 = 30 --[[ 
TIPC
 
sock‘s
. ]]

124 
PF
.
PF_BLUETOOTH
 = 31 --[[ 
Blu‘oÙh
 
sock‘s
. ]]

125 
PF
.
PF_IUCV
 = 32 --[[ 
IUCV
 
sock‘s
. ]]

126 
PF
.
PF_RXRPC
 = 33 --[[ 
RxRPC
 
sock‘s
. ]]

127 
PF
.
PF_ISDN
 = 34 --[[ 
mISDN
 
sock‘s
. ]]

128 
PF
.
PF_PHONET
 = 35 --[[ 
PhÚ‘
 
sock‘s
. ]]

129 
PF
.
PF_IEEE802154
 = 36 --[[ 
IEEE
 802.15.4 
sock‘s
. ]]

130 
PF
.
PF_CAIF
 = 37 --[[ 
CAIF
 
sock‘s
. ]]

131 
PF
.
PF_ALG
 = 38 --[[ 
AlgÜ™hm
 
sock‘s
. ]]

132 
PF
.
PF_NFC
 = 39 --[[ 
NFC
 
sock‘s
. ]]

133 
PF
.
PF_MAX
 = 40 --[[ 
FÜ
 
now
.. ]]

136 --[[ 
Add»ss
 
çm›s
. ]]

137 
loÿl
 
AF
 = {}

138 
AF
.
AF_UNSPEC
 = 
PF
.
PF_UNSPEC


139 
AF
.
AF_LOCAL
 = 
PF
.
PF_LOCAL


140 
AF
.
AF_UNIX
 = 
PF
.
PF_UNIX


141 
AF
.
AF_FILE
 = 
PF
.
PF_FILE


142 
AF
.
AF_INET
 = 
PF
.
PF_INET


143 
AF
.
AF_AX25
 = 
PF
.
PF_AX25


144 
AF
.
AF_IPX
 = 
PF
.
PF_IPX


145 
AF
.
AF_APPLETALK
 = 
PF
.
PF_APPLETALK


146 
AF
.
AF_NETROM
 = 
PF
.
PF_NETROM


147 
AF
.
AF_BRIDGE
 = 
PF
.
PF_BRIDGE


148 
AF
.
AF_ATMPVC
 = 
PF
.
PF_ATMPVC


149 
AF
.
AF_X25
 = 
PF
.
PF_X25


150 
AF
.
AF_INET6
 = 
PF
.
PF_INET6


151 
AF
.
AF_ROSE
 = 
PF
.
PF_ROSE


152 
AF
.
AF_DECÃt
 = 
PF
.
PF_DECÃt


153 
AF
.
AF_NETBEUI
 = 
PF
.
PF_NETBEUI


154 
AF
.
AF_SECURITY
 = 
PF
.
PF_SECURITY


155 
AF
.
AF_KEY
 = 
PF
.
PF_KEY


156 
AF
.
AF_NETLINK
 = 
PF
.
PF_NETLINK


157 
AF
.
AF_ROUTE
 = 
PF
.
PF_ROUTE


158 
AF
.
AF_PACKET
 = 
PF
.
PF_PACKET


159 
AF
.
AF_ASH
 = 
PF
.
PF_ASH


160 
AF
.
AF_ECONET
 = 
PF
.
PF_ECONET


161 
AF
.
AF_ATMSVC
 = 
PF
.
PF_ATMSVC


162 
AF
.
AF_RDS
 = 
PF
.
PF_RDS


163 
AF
.
AF_SNA
 = 
PF
.
PF_SNA


164 
AF
.
AF_IRDA
 = 
PF
.
PF_IRDA


165 
AF
.
AF_PPPOX
 = 
PF
.
PF_PPPOX


166 
AF
.
AF_WANPIPE
 = 
PF
.
PF_WANPIPE


167 
AF
.
AF_LLC
 = 
PF
.
PF_LLC


168 
AF
.
AF_CAN
 = 
PF
.
PF_CAN


169 
AF
.
AF_TIPC
 = 
PF
.
PF_TIPC


170 
AF
.
AF_BLUETOOTH
 = 
PF
.
PF_BLUETOOTH


171 
AF
.
AF_IUCV
 = 
PF
.
PF_IUCV


172 
AF
.
AF_RXRPC
 = 
PF
.
PF_RXRPC


173 
AF
.
AF_ISDN
 = 
PF
.
PF_ISDN


174 
AF
.
AF_PHONET
 = 
PF
.
PF_PHONET


175 
AF
.
AF_IEEE802154
 = 
PF
.
PF_IEEE802154


176 
AF
.
AF_CAIF
 = 
PF
.
PF_CAIF


177 
AF
.
AF_ALG
 = 
PF
.
PF_ALG


178 
AF
.
AF_NFC
 = 
PF
.
PF_NFC


179 
AF
.
AF_MAX
 = 
PF
.
PF_MAX


181 
loÿl
 
SOL
 = {}

182 
ffi
.
¬ch
 =ğ"m£l" 
th’


183 
SOL
.
SOL_SOCKET
 = 
où®
("177777") -- 0xFFFF

185 
SOL
.
SOL_SOCKET
 = 1

186 
’d


188 
loÿl
 
SO
 = {}

189 
ffi
.
¬ch
 =ğ"m£l" 
th’


190 
SO
.
SO_DEBUG
 = 1

191 
SO
.
SO_REUSEADDR
 = 4

192 
SO
.
SO_TYPE
 = 
hex
("1008")

193 
SO
.
SO_ERROR
 = 
hex
("1007")

194 
SO
.
SO_DONTROUTE
 = 
hex
("0010")

195 
SO
.
SO_BROADCAST
 = 
hex
("0020")

196 
SO
.
SO_SNDBUF
 = 
hex
("1001")

197 
SO
.
SO_RCVBUF
 = 
hex
("1002")

198 
SO
.
SO_SNDBUFFORCE
 = 31

199 
SO
.
SO_RCVBUFFORCE
 = 33

200 
SO
.
SO_KEEPALIVE
 = 8

201 
SO
.
SO_OOBINLINE
 = 
hex
("0100")

202 
SO
.
SO_NO_CHECK
 = 11

203 
SO
.
SO_PRIORITY
 = 12

204 
SO
.
SO_LINGER
 = 
hex
("0080")

205 
SO
.
SO_BSDCOMPAT
 = 14

206 
SO
.
SO_PASSCRED
 = 17

207 
SO
.
SO_PEERCRED
 = 18

208 
SO
.
SO_RCVLOWAT
 = 
hex
("1004")

209 
SO
.
SO_SNDLOWAT
 = 
hex
("1003")

210 
SO
.
SO_RCVTIMEO
 = 
hex
("1006")

211 
SO
.
SO_SNDTIMEO
 = 
hex
("1005")

212 
SO
.
SO_SECURITY_AUTHENTICATION
 = 22

213 
SO
.
SO_SECURITY_ENCRYPTION_TRANSPORT
 = 23

214 
SO
.
SO_SECURITY_ENCRYPTION_NETWORK
 = 24

215 
SO
.
SO_BINDTODEVICE
 = 25

216 
SO
.
SO_ATTACH_FILTER
 = 26

217 
SO
.
SO_DETACH_FILTER
 = 27

218 
SO
.
SO_PEERNAME
 = 28

219 
SO
.
SO_TIMESTAMP
 = 29

220 
SO
.
SCM_TIMESTAMP
 = SO.
SO_TIMESTAMP


221 
SO
.
SO_ACCEPTCONN
 = 
hex
("1009")

222 
SO
.
SO_PEERSEC
 = 30

223 
SO
.
SO_PASSSEC
 = 34

224 
SO
.
SO_TIMESTAMPNS
 = 35

225 
SCM_TIMESTAMPNS
 = 
SO
.
SO_TIMESTAMPNS


226 
SO
.
SO_MARK
 = 36

227 
SO
.
SO_TIMESTAMPING
 = 37

228 
SO
.
SCM_TIMESTAMPING
ğSO.
SO_TIMESTAMPING


229 
SO
.
SO_PROTOCOL
 = 
hex
("1028")

230 
SO
.
SO_DOMAIN
 = 
hex
("1029")

231 
SO
.
SO_RXQ_OVFL
 = 40

232 --
SO
.
SO_WIFI_STATUS
 = 41

233 --
SO
.
SCM_WIFI_STATUS
 = SO.
SO_WIFI_STATUS


234 --
SO
.
SO_PEEK_OFF
 = 42

235 --
SO
.
SO_NOFCS
 = 43

237 
SO
.
SO_DEBUG
 = 1

238 
SO
.
SO_REUSEADDR
 = 2

239 
SO
.
SO_TYPE
 = 3

240 
SO
.
SO_ERROR
 = 4

241 
SO
.
SO_DONTROUTE
 = 5

242 
SO
.
SO_BROADCAST
 = 6

243 
SO
.
SO_SNDBUF
 = 7

244 
SO
.
SO_RCVBUF
 = 8

245 
SO
.
SO_SNDBUFFORCE
 = 32

246 
SO
.
SO_RCVBUFFORCE
 = 33

247 
SO
.
SO_KEEPALIVE
 = 9

248 
SO
.
SO_OOBINLINE
 = 10

249 
SO
.
SO_NO_CHECK
 = 11

250 
SO
.
SO_PRIORITY
 = 12

251 
SO
.
SO_LINGER
 = 13

252 
SO
.
SO_BSDCOMPAT
 = 14

253 
SO
.
SO_PASSCRED
 = 16

254 
SO
.
SO_PEERCRED
 = 17

255 
SO
.
SO_RCVLOWAT
 = 18

256 
SO
.
SO_SNDLOWAT
 = 19

257 
SO
.
SO_RCVTIMEO
 = 20

258 
SO
.
SO_SNDTIMEO
 = 21

259 
SO
.
SO_SECURITY_AUTHENTICATION
 = 22

260 
SO
.
SO_SECURITY_ENCRYPTION_TRANSPORT
 = 23

261 
SO
.
SO_SECURITY_ENCRYPTION_NETWORK
 = 24

262 
SO
.
SO_BINDTODEVICE
 = 25

263 
SO
.
SO_ATTACH_FILTER
 = 26

264 
SO
.
SO_DETACH_FILTER
 = 27

265 
SO
.
SO_PEERNAME
 = 28

266 
SO
.
SO_TIMESTAMP
 = 29

267 
SO
.
SCM_TIMESTAMP
 = SO.
SO_TIMESTAMP


268 
SO
.
SO_ACCEPTCONN
 = 30

269 
SO
.
SO_PEERSEC
 = 31

270 
SO
.
SO_PASSSEC
 = 34

271 
SO
.
SO_TIMESTAMPNS
 = 35

272 
SCM_TIMESTAMPNS
 = 
SO
.
SO_TIMESTAMPNS


273 
SO
.
SO_MARK
 = 36

274 
SO
.
SO_TIMESTAMPING
 = 37

275 
SO
.
SCM_TIMESTAMPING
ğSO.
SO_TIMESTAMPING


276 
SO
.
SO_PROTOCOL
 = 38

277 
SO
.
SO_DOMAIN
 = 39

278 
SO
.
SO_RXQ_OVFL
 = 40

279 
SO
.
SO_WIFI_STATUS
 = 41

280 
SO
.
SCM_WIFI_STATUS
 = SO.
SO_WIFI_STATUS


281 
SO
.
SO_PEEK_OFF
 = 42

282 
SO
.
SO_NOFCS
 = 43

283 
’d


285 
loÿl
 
E


286 
ffi
.
¬ch
 =ğ"m£l" 
th’


287 
E
 = {

288 
EAGAIN
 = 11,

289 
	gEWOULDBLOCK
 = 11,

290 
	gEINPROGRESS
 = 150,

291 
	gECONNRESET
 = 131,

292 
	gEPIPE
 = 32,

293 
	gEAI_AGAIN
 = 3

296 
	gE
 = {

297 
EAGAIN
 = 11,

298 
	gEWOULDBLOCK
 = 11,

299 
	gEINPROGRESS
 = 115,

300 
	gECONNRESET
 = 104,

301 
	gEPIPE
 = 32,

302 
	gEAI_AGAIN
 = 3

304 
’d


307 
	g¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
	g_G
.
__TURBO_USE_LUASOCKET__
 
	gth’


308 -- 
Lšux
 
FFI
 
	gfunùiÚs
.

310 
loÿl
 
funùiÚ
 
	$¡»¼Ü
(
”ºo
)

311 
loÿl
 
c¡r
 = 
ffi
.
C
.
	`¡»¼Ü
(
”ºo
);

312  
ffi
.
	`¡ršg
(
c¡r
);

313 
’d


315 
loÿl
 
funùiÚ
 
	$»sŞv_ho¡Çme
(
¡r
)

316 
loÿl
 
š_addr_¬r
 = {
	}
}

317 
loÿl
 
ho¡’t
 = 
ffi
.
C
.
	$g‘ho¡byÇme
(
¡r
)

318 
ho¡’t
 =ğ
n
 
th’


320 
’d


321 
loÿl
 
šaddr
 = 
ffi
.
	`ÿ¡
("¡ruù in_add¸**", 
ho¡’t
.
h_addr_li¡
)

322 
loÿl
 
i
 = 0

323 
šaddr
[
i
] ~ğ
n
 do

324 
š_addr_¬r
[#š_addr_¬¸+ 1] = 
šaddr
[
i
][0]

325 
i
 = i + 1

326 
’d


328 
š_addr
 = 
š_addr_¬r
,

329 
add¹y³
 = 
	`tÚumb”
(
ho¡’t
.
h_add¹y³
),

330 
Çme
 = 
ffi
.
	`¡ršg
(
ho¡’t
.
h_Çme
)

331 
	}
}

333 
’d


335 
loÿl
 
funùiÚ
 
	$£t_nÚblock_æag
(
fd
)

336 
loÿl
 
æags
 = 
ffi
.
C
.
	`fú
(
fd
, 
F
.
F_GETFL
, 0);

337 
æags
 =ğ-1 
th’


339 
’d


340 ià(
b™
.
	`bªd
(
æags
, 
O
.
O_NONBLOCK
è~ğ0è
th’


342 
’d


343 
æags
 = 
b™
.
	$bÜ
(
æags
, 
O
.
O_NONBLOCK
)

344 
loÿl
 
rc
 = 
ffi
.
C
.
	$fú
(
fd
, 
F
.
F_SETFL
, 
æags
)

345 
rc
 =ğ-1 
th’


347 
’d


349 
’d


351 
loÿl
 
£tİt
 = 
ffi
.
	`Ãw
("int32_t[1]")

352 
loÿl
 
funùiÚ
 
	$£t_»u£addr_İt
(
fd
)

353 
£tİt
[0] = 1

354 
loÿl
 
rc
 = 
ffi
.
C
.
	`£tsockİt
(
fd
,

355 
SOL
.
SOL_SOCKET
,

356 
SO
.
SO_REUSEADDR
,

357 
£tİt
,

358 
ffi
.("int32_t"))

359 
rc
 ~ğ0 
th’


360 
”ºo
 = 
ffi
.
	$”ºo
()

361  -1, 
¡ršg
.
	`fÜm©
("setsockopt SO_REUSEADDR failed. %s",

362 
	$¡»¼Ü
(
”ºo
))

363 
’d


365 
’d


367 --- 
C»©e
 
Ãw
 
nÚ
 
blockšg
 
sock‘
 
u£
 
š
 
IOSŒ—m
.

368 -- 
If
 
çmy
 
Ü
 
¡»am
 
ty³
 
is
 
nÙ
 
£t
 
AF_INET
 
ªd
 
SOCK_STREAM
 i 
u£d
.

369 
loÿl
 
funùiÚ
 
	$Ãw_nÚblock_sock‘
(
çmy
, 
¡y³
, 
´ÙocŞ
)

370 
loÿl
 
fd
 = 
ffi
.
C
.
	$sock‘
(
çmy
 
Ü
 
AF
.
AF_INET
,

371 
¡y³
 
Ü
 
SOCK
.
SOCK_STREAM
,

372 
´ÙocŞ
 
Ü
 0)

374 
fd
 =ğ-1 
th’


375 
”ºo
 = 
ffi
.
	$”ºo
()

376  -1, 
¡ršg
.
	`fÜm©
("Could‚Ù c»©sock‘. %s", 
	$¡»¼Ü
(
”ºo
))

377 
’d


378 
loÿl
 
rc
, 
msg
 = 
	$£t_nÚblock_æag
(
fd
)

379 ià(
rc
 ~ğ0è
th’


380  
rc
, 
msg


381 
’d


382  
fd


383 
’d


385 
loÿl
 
v®ue
 = 
ffi
.
	`Ãw
("int32_t[1]")

386 
loÿl
 
sockËn
 = 
ffi
.
	`Ãw
("socklen_t[1]", ffi.("int32_t"))

387 
loÿl
 
funùiÚ
 
	$g‘_sock‘_”rÜ
(
fd
)

388 
loÿl
 
rc
 = 
ffi
.
C
.
	`g‘sockİt
(
fd
,

389 
SOL
.
SOL_SOCKET
,

390 
SO
.
SO_ERROR
,

391 
ffi
.
	`ÿ¡
("void *", 
v®ue
),

392 
sockËn
)

393 
rc
 ~ğ0 
th’


396  0, 
	$tÚumb”
(
v®ue
[0])

397 
’d


398 
’d


400 
loÿl
 
expÜt
 = 
ut
.
	`bËm”ge
(
SOCK
,

401 
ut
.
	`bËm”ge
(
F
,

402 
ut
.
	`bËm”ge
(
O
,

403 
ut
.
	`bËm”ge
(
AF
,

404 
ut
.
	`bËm”ge
(
PF
,

405 
ut
.
	`bËm”ge
(
SOL
,

406 
ut
.
	$bËm”ge
(
SO
, 
E
)))))))

408  
ut
.
	`bËm”ge
({

409 
¡»¼Ü
 = strerror,

410 
»sŞv_ho¡Çme
 =„esolv_hostname,

411 
g‘addršfo
 = 
ffi
.
C
.getaddrinfo,

412 
£t_nÚblock_æag
 = set_nonblock_flag,

413 
£t_»u£addr_İt
 = set_reuseaddr_opt,

414 
Ãw_nÚblock_sock‘
 =‚ew_nonblock_socket,

415 
g‘_sock‘_”rÜ
 = get_socket_error,

416 
INADDR_ANY
 = 0x00000000,

417 
INADDR_BROADCAST
 = 0xffffffff,

418 
INADDR_NONE
 = 0xffffffff,

419 
	}
}, 
	gexpÜt
)

422 -- 
LuaSock‘
 
	gv”siÚ
.

424 
loÿl
 
	gluasock‘
 = 
»quœe
 "socket"

426 --- 
C»©e
 
Ãw
 
nÚ
 
blockšg
 
sock‘
 
u£
 
š
 
IOSŒ—m
.

427 -- 
If
 
çmy
 
Ü
 
¡»am
 
ty³
 
is
 
nÙ
 
£t
 
AF_INET
 
ªd
 
SOCK_STREAM
 i 
u£d
.

428 
loÿl
 
funùiÚ
 
	$Ãw_nÚblock_sock‘
(
çmy
, 
¡y³
, 
´ÙocŞ
)

429 
çmy
 = famy 
Ü
 
AF
.
AF_INET


430 
¡y³
 = sty³ 
Ü
 
SOCK
.
SOCK_STREAM


431 
	`as£¹
(
çmy
 =ğ
AF
.
AF_INET
 
Ü
 AF.
AF_INET6
,

433 
	`as£¹
(
¡y³
 =ğ
SOCK
.
SOCK_DGRAM
 
Ü
 SOCK.
SOCK_STREAM
,

435 
loÿl
 
sock


436 
¡y³
 =ğ
SOCK
.
SOCK_DGRAM
 
th’


437 
sock
 = 
sock‘
.
	$udp
()

438 
–£if
 
¡y³
 =ğ
SOCK
.
SOCK_STREAM
 
th’


439 
sock
 = 
sock‘
.
	$tı
()

440 
’d


441 
sock
:
	$£‰imeout
(0)

442 
sock
:
	`£tİtiÚ
("k“·live", 
Œue
)

443  
sock


444 
’d


446 
loÿl
 
expÜt
 = 
ut
.
	`bËm”ge
(
SOCK
,

447 
ut
.
	`bËm”ge
(
F
,

448 
ut
.
	`bËm”ge
(
O
,

449 
ut
.
	`bËm”ge
(
AF
,

450 
ut
.
	`bËm”ge
(
PF
,

451 
ut
.
	`bËm”ge
(
SOL
,

452 
ut
.
	$bËm”ge
(
SO
, 
E
)))))))

453  
ut
.
	`bËm”ge
({

454 
Ãw_nÚblock_sock‘
 =‚ew_nonblock_socket,

455 
INADDR_ANY
 = 0x00000000,

456 
INADDR_BROADCAST
 = 0xffffffff,

457 
INADDR_NONE
 = 0xffffffff,

458 
	}
}, 
	gexpÜt
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/sockutil.lua

1 --- 
	gTurbo
.
lua
 
Sock‘
 
	gUts


3 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gsock‘
 = 
»quœe
 "turbo.socket_ffi"

18 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

19 
loÿl
 
log
 = 
»quœe
 "turbo.log"

20 
loÿl
 
ffi
 = 
»quœe
 "ffi"

21 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

22 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

23 
loÿl
 
luasock‘


24 
nÙ
 
¶©fÜm
.
__LINUX__
 
Ü
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


25 
luasock‘
 = 
»quœe
 "socket"

26 
’d


28 
loÿl
 
C
 = 
ffi
.C

30 
loÿl
 
sockuts
 = {} -- sockut 
Çme¥aû


31 
loÿl
 
_add_acû±_hªd”_cb


33 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


34 
loÿl
 
SOL_SOCKET
 = 
sock‘
.SOL_SOCKET

35 
loÿl
 
SO_RESUSEADDR
 = 
sock‘
.
SO_REUSEADDR


36 
loÿl
 
O_NONBLOCK
 = 
sock‘
.O_NONBLOCK

37 
loÿl
 
F_SETFL
 = 
sock‘
.F_SETFL

38 
loÿl
 
F_GETFL
 = 
sock‘
.F_GETFL

39 
loÿl
 
SOCK_STREAM
 = 
sock‘
.SOCK_STREAM

40 
loÿl
 
INADDRY_ANY
 = 
sock‘
.
INADDR_ANY


41 
loÿl
 
AF_INET
 = 
sock‘
.AF_INET

42 
loÿl
 
AF_INET6
 = 
sock‘
.AF_INET6

43 
loÿl
 
EINPROGRESS
 = 
sock‘
.EINPROGRESS

44 
loÿl
 
EWOULDBLOCK
 = 
sock‘
.EWOULDBLOCK

45 
loÿl
 
EAGAIN
 = 
sock‘
.EAGAIN

46 
loÿl
 
INET_ADDRSTRLEN
 = 16

47 
loÿl
 
INET6_ADDRSTRLEN
 = 46

49 --- 
C»©es
 
the
 
sockaddr_š
 
Ü
 
sockaddr_š6
 

50 -- 
If
 
nÙ
 
add»ss
 
is
 
defšed
 '0.0.0.0'/'::' 
wl
 
be
 
u£d
.

51 -- 
If
 
nÙ
 
çmy
 
is
 
defšed
 
th’
 
	$AF_INET
(
v4
è
wl
 
be
 
u£d


52 -- @
·¿m
 
	$add»ss
 (
Numb”
 
Ü
 
SŒšg
è
The
 
add»ss
 
to
 
bšd
Ø
š
 

53 -- 
š‹g”
 
ho¡lÚg
 
Ü
 
a
 
¡ršg
 
like
 "127.0.0.1".

54 -- 
If
 
nÙ
 
add»ss
 
is
 
giv’
, 
INADDR_ANY
 
	`Ü
 ("::" 
v6
è
wl
 
be
 
u£d
,

55 -- 
bšdšg
 
to
 
®l
 
add»s£s
.

56 -- @
·¿m
 
	$pÜt
 (
Numb”
è
The
 
pÜt
 
numb”
 
to
 
bšd
o.

57 -- @
·¿m
 
	$çmy
 (
Numb”
è
O±iÚ®
 
sock‘
 
çmy
. 
Defšed
 
š
 
Sock‘
 
moduË
. 
If


58 -- 
nÙ
 
defšed
 
AF_INET
 
is
 
u£d
 
as
 .

59 
funùiÚ
 
sockuts
.
	$ü—‹_£rv”_add»ss
(
pÜt
, 
add»ss
, 
çmy
)

60 
loÿl
 
£rv_addr


61 
loÿl
 
rc


62 
loÿl
 
”ºo


64 
çmy
 = famy 
Ü
 
AF_INET


66 
çmy
 ~ğ
AF_INET
 
ªd
 famy ~ğ
AF_INET6
 
th’


67 
	`”rÜ
("[sockutil.lua] Only AF_INET‡nd AF_INET6 is supported")

68 
’d


70 
çmy
 =ğ
AF_INET
 
th’


71 
add»ss
 =‡dd»s 
Ü
 "0.0.0.0"

72 
£rv_addr
 = 
ffi
.
	`Ãw
("struct sockaddr_in")

73 
£rv_addr
.
sš_çmy
 = 
AF_INET


74 
£rv_addr
.
sš_pÜt
 = 
C
.
	$htÚs
(
pÜt
)

76 
add»ss
 =‡dd»s 
Ü
 "::"

77 
£rv_addr
 = 
ffi
.
	`Ãw
("struct sockaddr_in6")

78 
£rv_addr
.
sš6_çmy
 = 
çmy


79 
£rv_addr
.
sš6_pÜt
 = 
C
.
	$htÚs
(
pÜt
)

80 
’d


82 
	`ty³
(
add»ss
è=ğ"¡ršg" 
th’


83 
rc
 = 
ffi
.
C
.
	$š‘_±Ú
(
çmy
, 
add»ss
,

84 
çmy
 =ğ
AF_INET
 
ªd
 
£rv_addr
.
sš_addr
 
Ü
 s”v_addr.
sš6_addr
)

85 
rc
 =ğ0 
th’


86 
	`”rÜ
(
¡ršg
.
	`fÜm©
("[sockutil.lua] Invalid‡ddress %s",

87 
add»ss
))

88 
–£if
 
rc
 =ğ-1 
th’


89 
”ºo
 = 
ffi
.
	$”ºo
()

90 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

92 
”ºo
,

93 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

94 
’d


95 
–£if
 
	`ty³
(
add»ss
è=ğ"numb”" 
ªd
 
çmy
 =ğ
AF_INET
 
th’


96 
çmy
 =ğ
AF_INET
 
th’


97 
£rv_addr
.
sš_addr
.
s_addr
 = 
C
.
	`htÚl
(
add»ss
);

98 
’d


100 
	`”rÜ
("[sockutil.lua] Invalid input‡ddress must be‡ valid \
4(string/int) or ipv6(string)‡ddress.")

102 
’d


104  
£rv_addr


105 
’d


107 --- 
CÚÃù
 
to
 
a
 
»mÙe
 
ho¡
 
usšg
 
ª
 
addršfo
 

108 -- 
R‘uºs
 
the
 
addršfo
 
th©
 
was
 
u£d
 
Ú
 
sucûss
, 
Ü
 
n
 
ªd


109 -- 
ª
 
”rÜ
 
mes§ge
 
Ú
 
çu»
.

110 -- @
·¿m
 
sock
 
A
 
sock‘
 
desütÜ


111 -- @
·¿m
 
ai
 
a
 
addršfo


112 
funùiÚ
 
sockuts
.
	$cÚÃù_addršfo
(
sock
, 
p
)

113 
loÿl
 
r
 = 0

114 
loÿl
 
”ºo
 = 0

115 
p
 =ğ
n
 
th’


116  
n
, "Could‚ot connect,‡ddrinfo is NULL."

117 
’d


118 
r
 = 
C
.
	$cÚÃù
(
sock
, 
p
.
ai_addr
,….
ai_add¾’
)

119 
r
 ~ğ0 
th’


120 
”ºo
 = 
ffi
.
	$”ºo
()

121 
”ºo
 =ğ
EINPROGRESS
 
th’


122  
p


123 
’d


124  
n
,

125 
¡ršg
.
	`fÜm©
("Could‚ot connect. Errno %d: %s",

126 
”ºo
, 
sock‘
.
	$¡»¼Ü
(
”ºo
è
Ü
 "")

127 
’d


128  
p


129 
’d


132 --- 
Bšds
 
sock‘s
 
to
 
pÜt
 
ªd
 
add»ss
.

133 -- 
If
 
nÙ
 
add»ss
 
is
 
defšed
 
th’
 * 
wl
 
be
 
u£d
.

134 -- 
If
 
no
 
backlog
 
size
 
is
 
giv’
 
th’
 128 
cÚÃùiÚs
 
wl
 
be
 
u£d
.

135 -- @
·¿m
 
	$add»ss
 (
Numb”
 
Ü
 
SŒšg
è
The
 
add»ss
 
to
 
bšd
Ø
š
 

136 -- 
š‹g”
 
ho¡lÚg
 
Ü
 
a
 
¡ršg
 
like
 "127.0.0.1".

137 -- 
If
 
nÙ
 
add»ss
 
is
 
giv’
, 
INADDR_ANY
 
	`Ü
 ("::" 
v6
è
wl
 
be
 
u£d
,

138 -- 
bšdšg
 
to
 
®l
 
add»s£s
.

139 -- @
·¿m
 
	$pÜt
 (
Numb”
è
The
 
pÜt
 
numb”
 
to
 
bšd
o.

140 -- @
·¿m
 
	$backlog
 (
Numb”
è
Maximum
 
backlogged
 
ş›Á
 
cÚÃùs
 
to
 
®low
. 
If
 
nÙ


141 -- 
defšed
 
th’
 128 
is
 
u£d
 
as
 .

142 -- @
·¿m
 
	$çmy
 (
Numb”
è
O±iÚ®
 
sock‘
 
çmy
. 
Defšed
 
š
 
Sock‘
 
moduË
. 
If


143 -- 
nÙ
 
defšed
 
AF_INET
 
is
 
u£d
 
as
 .

144 
funùiÚ
 
sockuts
.
	$bšd_sock‘s
(
pÜt
, 
add»ss
, 
backlog
, 
çmy
)

145 
loÿl
 
£rv_addr


146 
loÿl
 
”ºo


147 
loÿl
 
rc
, 
msg


149 
backlog
 = backlog 
Ü
 128

151 
nÙ
 
çmy
 
th’


152 
	`ty³
(
add»ss
è=ğ"¡ršg" 
th’


153 
add»ss
:
	`fšd
(":"è
th’


154 
çmy
 = 
AF_INET6


156 
çmy
 = 
AF_INET


157 
’d


159 
çmy
 = 
AF_INET


160 
’d


161 
’d


163 
£rv_addr
 = 
sockuts
.
	$ü—‹_£rv”_add»ss
(
pÜt
, 
add»ss
, 
çmy
)

165 
loÿl
 
fd
 = 
C
.
	$sock‘
(
çmy
, 
SOCK_STREAM
, 0)

166 
fd
 =ğ-1 
th’


167 
”ºo
 = 
ffi
.
	$”ºo
()

168 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

170 
”ºo
,

171 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

172 
’d


173 
rc
, 
msg
 = 
sock‘
.
	$£t_nÚblock_æag
(
fd
)

174 
rc
 ~ğ0 
th’


175 
	`”rÜ
("[tı£rv”.lua] " .. 
msg
)

176 
’d


177 
rc
, 
msg
 = 
sock‘
.
	$£t_»u£addr_İt
(
fd
)

178 
rc
 ~ğ0 
th’


179 
	`”rÜ
("[tı£rv”.lua] " .. 
msg
)

180 
’d


181 
C
.
	`bšd
(
fd
, 
ffi
.
	`ÿ¡
("¡ruù sockadd¸*", 
£rv_addr
),

182 
ffi
.(
£rv_addr
)è~ğ0 
th’


183 
”ºo
 = 
ffi
.
	$”ºo
()

184 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

186 
”ºo
,

187 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

188 
’d


189 
C
.
	`li¡’
(
fd
, 
backlog
è~ğ0 
th’


190 
”ºo
 = 
ffi
.
	$”ºo
()

191 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

193 
”ºo
,

194 
fd
,

195 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

196 
’d


197 --
log
.
	`dev–
(
¡ršg
.
	`fÜm©
("[tı£rv”.lua] Li¡’šgØsock‘ fd %d", 
fd
))

198  
fd


199 
’d


201 
loÿl
 
ş›Á_addr
 = 
ffi
.
	`Ãw
("struct sockaddr_storage")

202 
loÿl
 
ş›Á_addr_sz
 = 
ffi
.
	`Ãw
("št32_t[1]", ffi.(
ş›Á_addr
))

204 
_add_acû±_hªd”_cb
 = 
	$funùiÚ
(
¬g
, 
fd
, 
ev’ts
)

205 
Œue
 do

206 
loÿl
 
”ºo


207 
loÿl
 
add»ss


208 --
log
.
	`dev–
(
¡ršg
.
	`fÜm©
(

209 --"[tı£rv”.lua] Acû±šg cÚÃùiÚ oÀsock‘ fd %d", 
fd
))

211 
loÿl
 
ş›Á_fd
 =

212 
C
.
	`acû±
(
fd
, 
ffi
.
	`ÿ¡
("¡ruù sockadd¸*", 
ş›Á_addr
),

213 
ş›Á_addr_sz
)

214 
loÿl
 
çmy
 = 
ş›Á_addr
.
ss_çmy


215 
ş›Á_fd
 =ğ-1 
th’


216 
”ºo
 = 
ffi
.
	$”ºo
()

217 ià(
”ºo
 =ğ
EWOULDBLOCK
 
Ü
ƒ¼nØ=ğ
EAGAIN
è
th’


220 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

222 
”ºo
,

223 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

225 
’d


226 
’d


228 
çmy
 =ğ
AF_INET
 
th’


229 
loÿl
 
sockaddr_š
 = 
ffi
.
	`ÿ¡
("¡ruù sockaddr_š *", 
ş›Á_addr
)

230 
loÿl
 
s_addr_±r
 = 
ffi
.
	`ÿ¡
("unsigÃd ch¬ *", 
sockaddr_š
.
sš_addr
)

231 
add»ss
 = 
¡ršg
.
	`fÜm©
("%d.%d.%d.%d",

232 
s_addr_±r
[0],

233 
s_addr_±r
[1],

234 
s_addr_±r
[2],

235 
s_addr_±r
[3])

237 
loÿl
 
ş›Á_§
 = 
ffi
.
	`ÿ¡
("¡ruù sockaddr_š6 *", 
ş›Á_addr
)

238 
loÿl
 
addrbuf
 = 
ffi
.
	`Ãw
("ch¬[?]", 
INET6_ADDRSTRLEN
)

239 
C
.
	$š‘_Áİ
(
AF_INET6
, 
ş›Á_§
.
sš6_addr
, 
addrbuf
, 
INET6_ADDRSTRLEN
)

240 
add»ss
 = 
ffi
.
	$¡ršg
(
addrbuf
, 
INET6_ADDRSTRLEN
)

241 
’d


243 
¬g
[2] 
th’


244 
¬g
[1]×rg[2], 
ş›Á_fd
, 
add»ss
)

246 
¬g
[1](
ş›Á_fd
, 
add»ss
)

247 
’d


248 
’d


249 
’d


251 -- 
LuaSock‘
 
v”siÚ
.

252 
funùiÚ
 
sockuts
.
	$bšd_sock‘s
(
pÜt
, 
add»ss
, 
backlog
, 
çmy
)

253 
loÿl
 
sock
 = 
luasock‘
.
	`bšd
(
add»ss
 
Ü
 "127.0.0.1", 
pÜt
, 
backlog
)

254 
sock
:
	$£‰imeout
(0)

255  
sock


256 
’d


258 
_add_acû±_hªd”_cb
 = 
	$funùiÚ
(
¬g
, 
fd
, 
ev’ts
)

259 
Œue
 do

260 
loÿl
 
ş›Á_fd
 = 
fd
:
	$acû±
()

261 
nÙ
 
ş›Á_fd
 
th’


263 
’d


264 
ş›Á_fd
:
	$£‰imeout
(0)

265 
ş›Á_fd
:
	`£tİtiÚ
("k“·live", 
Œue
)

266 
¬g
[2] 
th’


267 
¬g
[1]×rg[2], 
ş›Á_fd
, cl›Á_fd:
	$g‘³”Çme
())

269 
¬g
[1](
ş›Á_fd
, cl›Á_fd:
	$g‘³”Çme
())

270 
’d


271 
’d


272 
’d


273 
’d


276 --- 
Add
 
acû±
 
hªdËr
 
sock‘
 
w™h
 
giv’
 
ÿÎback
.

277 -- 
E™h”
 
suµly
 
a
 
IOLoİ
 
objeù
, 
Ü
 
the
 
glob®
 
š¡ªû
 
wl
 
be
 
u£d
...

278 -- @
·¿m
 
	$sock
 (
Numb”
è
Sock‘
 
fe
 
desütÜ
 
to
 
add
 
hªdËr
 .

279 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
to
 
hªdË
 
cÚÃùs
. FunùiÚ 
»ûives


280 -- 
sock‘
 
	$fd
 (
Numb”
è
ªd
 
	$add»ss
 (
SŒšg
è
of
 
ş›Á
 
as
 
·¿m‘”s
.

281 -- @
·¿m
 
	$io_loİ
 (
IOLoİ
 
š¡ªû
è
If
 
nÙ
 
£t
 
the
 
glob®
 
is
 
u£d
.

282 -- @
·¿m
 
¬g
 
O±iÚ®
 
¬gum’t
 
ÿÎback
.

283 
funùiÚ
 
sockuts
.
	$add_acû±_hªdËr
(
sock
, 
ÿÎback
, 
io_loİ
, 
¬g
)

284 
loÿl
 
io_loİ
 = io_loİ 
Ü
 
iŞoİ
.
	$š¡ªû
()

285 
io_loİ
:
	`add_hªdËr
(

286 
sock
,

287 
iŞoİ
.
READ
,

288 
_add_acû±_hªd”_cb
,

289 {
ÿÎback
, 
¬g
})

290 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/structs/buffer.lua

1 -- 
	gTurbo
.
lua
 
	gLow
-
Ëv–
 
bufãr
 
	gim¶em’tiÚ


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g»quœe
 "turbo.cdef"

18 
	g»quœe
 'turbo.3rdparty.middleclass'

19 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

21 
ffi
.
cdef
([[

22 
	stbufãr
{

23 *
d©a
;

24 
size_t
 
mem
;

25 
size_t
 
sz
;

26 
size_t
 
sz_hšt
;

30 --- 
	gLow
-
Ëv–
 
Bufãr
 
	gşass
.

31 -- 
Usšg
 
C
 
	gbufãrs
. 
This
 
şass
 
suµÜts
 
¡Üšg
 
above
 
the
 
LuaJIT
 
memÜy
 
	glim™
.

32 -- 
It
 
is
 
¡l
 
g¬bage
 
	gcŞËùed
.

33 
loÿl
 
	gBufãr
 = 
şass
('Buffer')

35 
loÿl
 
funùiÚ
 
	$_tbufãr_ä“
(
±r
)

36 
±r
 = 
ffi
.
	`ÿ¡
("structbuffer *",…tr)

37 
ffi
.
C
.
	$ä“
(
±r
.
d©a
)

38 
ffi
.
C
.
	$ä“
(
±r
)

39 
’d


41 --- 
C»©e
 
a
 
Ãw
 
bufãr
.

42 -- @
·¿m
 
size_hšt
 
The
 
bufãr
 
is
 
´—Îoÿ‹d
 
w™h
 
this
 
amouÁ
 
of
 
¡Üage
.

43 -- @ 
Bufãr
 
š¡ªû
.

44 
funùiÚ
 
Bufãr
:
	$š™Ÿlize
(
size_hšt
)

45 
size_hšt
 = size_hšˆ
Ü
 1024

46 
loÿl
 
±r
 = 
ffi
.
C
.
	`m®loc
(ffi.("structbuffer"))

47 
±r
 =ğ
n
 
th’


48 
	`”rÜ
("No memory.")

49 
’d


50 
£lf
.
tbufãr
 = 
ffi
.
	`ÿ¡
("¡ruùbufã¸*", 
±r
)

51 
ffi
.
	$gc
(
£lf
.
tbufãr
, 
_tbufãr_ä“
)

52 
±r
 = 
ffi
.
C
.
	$m®loc
(
size_hšt
)

53 
±r
 =ğ
n
 
th’


54 
	`”rÜ
("No memory.")

55 
’d


56 
£lf
.
tbufãr
.
mem
 = 
size_hšt


57 
£lf
.
tbufãr
.
sz
 = 0

58 
£lf
.
tbufãr
.
d©a
 = 
±r


59 
£lf
.
tbufãr
.
sz_hšt
 = 
size_hšt


60 
’d


62 --- 
Aµ’d
 
d©a
 
to
 
bufãr
.

63 -- @
·¿m
 
d©a
 
The
 d©¨
to
 
­³nd
 
š
 * 
fÜm
.

64 -- @
·¿m
 
Ën
 
The
 
Ëngth
 
of
 
the
 
d©a
 
š
 
by‹s
.

65 
funùiÚ
 
Bufãr
:
	$­³nd_right
(
d©a
, 
Ën
)

66 
£lf
.
tbufãr
.
mem
 - s–f.tbufãr.
sz
 >ğ
Ën
 
th’


67 
ffi
.
	`cİy
(
£lf
.
tbufãr
.
d©a
 + s–f.tbufãr.
sz
, d©a, 
Ën
)

68 
£lf
.
tbufãr
.
sz
 = s–f.tbufãr.sz + 
Ën


70 -- 
R—Îoc
 
ªd
 
»quœed
 
memÜy
 
size
.

71 
loÿl
 
Ãw_sz
 = 
£lf
.
tbufãr
.
sz
 + 
Ën


72 
loÿl
 
Ãw_mem
 = 
Ãw_sz
 * 2

73 
loÿl
 
±r
 = 
ffi
.
C
.
	$»®loc
(
£lf
.
tbufãr
.
d©a
, 
Ãw_mem
)

74 
±r
 =ğ
n
 
th’


75 
	`”rÜ
("No memory.")

76 
’d


77 
£lf
.
tbufãr
.
d©a
 = 
±r


78 
ffi
.
	`cİy
(
£lf
.
tbufãr
.
d©a
 + s–f.tbufãr.
sz
, d©a, 
Ën
)

79 
£lf
.
tbufãr
.
mem
 = 
Ãw_mem


80 
£lf
.
tbufãr
.
sz
 = 
Ãw_sz


81 
’d


82  
£lf


83 
’d


85 
funùiÚ
 
Bufãr
:
	$­³nd_ch¬_right
()

86 
£lf
.
tbufãr
.
mem
 - s–f.tbufãr.
sz
 >ğ1 
th’


87 
£lf
.
tbufãr
.
d©a
[£lf.tbufãr.
sz
] = 

88 
£lf
.
tbufãr
.
sz
 = self.tbuffer.sz + 1

90 -- 
R—Îoc
 
ªd
 
»quœed
 
memÜy
 
size
.

91 
loÿl
 
Ãw_sz
 = 
£lf
.
tbufãr
.
sz
 + 1

92 
loÿl
 
Ãw_mem
 = 
Ãw_sz
 * 2

93 
loÿl
 
±r
 = 
ffi
.
C
.
	$»®loc
(
£lf
.
tbufãr
.
d©a
, 
Ãw_mem
)

94 
±r
 =ğ
n
 
th’


95 
	`”rÜ
("No memory.")

96 
’d


97 
£lf
.
tbufãr
.
d©a
 = 
±r


98 
£lf
.
tbufãr
.
d©a
[£lf.tbufãr.
sz
] = 

99 
£lf
.
tbufãr
.
mem
 = 
Ãw_mem


100 
£lf
.
tbufãr
.
sz
 = 
Ãw_sz


101 
’d


102  
£lf


103 
’d


105 --- 
Aµ’d
 
Lua
 
¡ršg
 
to
 
right
 
side
 
of
 
bufãr
.

106 -- @
·¿m
 
¡r
 
Lua
 
¡ršg


107 
funùiÚ
 
Bufãr
:
	$­³nd_lua¡r_right
(
¡r
)

108 
nÙ
 
¡r
 
th’


109 
	`”rÜ
("Appending‡‚il value,‚ot…ossible.")

110 
’d


111 
£lf
:
	`­³nd_right
(
¡r
, sŒ:
	$Ën
())

112  
£lf


113 
’d


115 --- 
P»³nd
 
d©a
 
to
 
bufãr
.

116 -- @
·¿m
 
d©a
 
The
 d©¨
to
 
´•’d
 
š
 * 
fÜm
.

117 -- @
·¿m
 
Ën
 
The
 
Ëngth
 
of
 
the
 
d©a
 
š
 
by‹s
.

118 
funùiÚ
 
Bufãr
:
	$­³nd_Ëá
(
d©a
, 
Ën
)

119 
£lf
.
tbufãr
.
mem
 - s–f.tbufãr.
sz
 >ğ
Ën
 
th’


120 -- 
Do
 
nÙ
 
u£
 
ffi
.
cİy
, 
but
 
memmove
 
as
 
the
 
memÜy
 
¬e
 
ov”Ïµšg
.

121 
£lf
.
tbufãr
.
sz
 ~ğ0 
th’


122 
ffi
.
C
.
	`memmove
(

123 
£lf
.
tbufãr
.
d©a
 + 
Ën
,

124 
£lf
.
tbufãr
.
d©a
,

125 
£lf
.
tbufãr
.
sz
)

126 
’d


127 
ffi
.
	$cİy
(
£lf
.
tbufãr
.
d©a
, d©a, 
Ën
)

128 
£lf
.
tbufãr
.
sz
 = s–f.tbufãr.sz + 
Ën


130 -- 
R—Îoc
 
ªd
 
»quœed
 
memÜy
 
size
.

131 
loÿl
 
Ãw_sz
 = 
£lf
.
tbufãr
.
sz
 + 
Ën


132 
loÿl
 
Ãw_mem
 = 
Ãw_sz
 * 2

133 
loÿl
 
±r
 = 
ffi
.
C
.
	$»®loc
(
£lf
.
tbufãr
.
d©a
, 
Ãw_mem
)

134 
±r
 =ğ
n
 
th’


135 
	`”rÜ
("No memory.")

136 
’d


137 
£lf
.
tbufãr
.
d©a
 = 
±r


138 
£lf
.
tbufãr
.
sz
 ~ğ0 
th’


139 
ffi
.
C
.
	`memmove
(
£lf
.
tbufãr
.
d©a
 + 
Ën
, s–f.tbufãr.d©a, s–f.tbufãr.
sz
)

140 
’d


141 
ffi
.
	$cİy
(
£lf
.
tbufãr
.
d©a
, d©a, 
Ën
)

142 
£lf
.
tbufãr
.
mem
 = 
Ãw_mem


143 
£lf
.
tbufãr
.
sz
 = 
Ãw_sz


144 
’d


145  
£lf


146 
’d


148 --- 
P»³nd
 
Lua
 
¡ršg
 
to
 
the
 
bufãr


149 -- @
·¿m
 
¡r
 
Lua
 
¡ršg


150 
funùiÚ
 
Bufãr
:
	$­³nd_lua¡r_Ëá
(
¡r
)

151 
nÙ
 
¡r
 
th’


152 
	`”rÜ
("Appending‡‚il value,‚ot…ossible.")

153 
’d


154  
£lf
:
	`­³nd_Ëá
(
¡r
, sŒ:
	$Ën
())

155 
’d


157 --- 
Pİ
 
by‹s
 
äom
 
Ëá
 
side
 
of
 
bufãr
. 
If
 
sz
 
exûeds
 
size
 oàbufã¸
th’
 
a


158 -- 
”rÜ
 
is
 
¿i£d
. 
NÙe
: 
dÛs
 
nÙ
 
»Ëa£
 
memÜy
 
®loÿ‹d
.

159 
funùiÚ
 
Bufãr
:
	$pİ_Ëá
(
sz
)

160 
£lf
.
tbufãr
.
sz
 < sz 
th’


161 
	`”rÜ
("Tryingo…op_left side greaterhanotal size of buffer")

163 
loÿl
 
move
 = 
£lf
.
tbufãr
.
sz
 - sz

164 
ffi
.
C
.
	`memmove
(
£lf
.
tbufãr
.
d©a
, s–f.tbufãr.d©¨+ 
sz
, 
move
)

165 
£lf
.
tbufãr
.
sz
 = 
move


166 
’d


167  
£lf


168 
’d


170 --- 
Pİ
 
by‹s
 
äom
 
right
 
side
 
of
 
the
 
bufãr
. 
If
 
sz
 
exûeds
 
size
 oàbufã¸
th’


171 -- 
a
 
”rÜ
 
is
 
¿i£d
. 
NÙe
: 
dÛs
 
nÙ
 
»Ëa£
 
memÜy
 
®loÿ‹d
.

172 
funùiÚ
 
Bufãr
:
	$pİ_right
(
sz
)

173 
£lf
.
tbufãr
.
sz
 < sz 
th’


174 
	`”rÜ
("Tryingo…op_right side greaterhanotal size of buffer")

176 
£lf
.
tbufãr
.
sz
 = self.tbuffer.sz - sz

177 
’d


178  
£lf


179 
’d


181 --- 
C»©e
 
a
 "d“p" 
cİy
 
of
 
the
 
bufãr
.

182 
funùiÚ
 
Bufãr
:
	$cİy
()

183 
loÿl
 
Ãw
 = 
	$Bufãr
(
£lf
.
tbufãr
.
sz
)

184 
Ãw
:
	`­³nd_right
(
£lf
:
	$g‘
())

185  
Ãw


186 
’d


188 --- 
Shršk
 
bufãr
 
memÜy
 
u§ge
 
to
 
™s
 
mšimum
.

189 
funùiÚ
 
Bufãr
:
	$shršk
()

190 
£lf
.
tbufãr
.
sz_hšt
 > s–f.tbufãr.
sz
 
Ü


191 
£lf
.
tbufãr
.
sz
 =ğ£lf.tbufãr.
mem
 
th’


192 -- 
Cu¼’t
 
size
 
is
 
sm®Ër
 
thª
 siz
hšt
 
Ü
 
cu¼’t
 siz
equ®s
 
memÜy


193 -- 
®loÿ‹d
. 
Ba
.

194  
£lf


195 
’d


196 
loÿl
 
±r
 = 
ffi
.
C
.
	$»®loc
(
£lf
.
tbufãr
.
d©a
, s–f.tbufãr.
sz
)

197 
±r
 =ğ
n
 
th’


198 
	`”rÜ
("No memory.")

199 
’d


200 
£lf
.
tbufãr
.
d©a
 = 
±r


201  
£lf


202 
’d


204 --- 
CË¬
 
bufãr
. 
NÙe
: 
dÛs
 
nÙ
 
»Ëa£
 
memÜy
 
®loÿ‹d
.

205 -- @
·¿m
 
we
 
Z”o
 
fl
 
®loÿ‹d
 
memÜy
 
¿nge
.

206 
funùiÚ
 
Bufãr
:
	$ş—r
(
we
)

207 
we
 
th’


208 
ffi
.
	$fl
(
£lf
.
tbufãr
.
d©a
, s–f.tbufãr.
mem
, 0)

209 
’d


210 
£lf
.
tbufãr
.
sz
 = 0

211  
£lf


212 
’d


214 --- 
G‘
 
cu¼’t
 
size
 
of
 
the
 
bufãr
.

215 -- @ 
size
 
of
 
bufãr
 
š
 
by‹s
.

216 
funùiÚ
 
Bufãr
:
	$Ën
(è 
£lf
.
tbufãr
.
sz
 
’d


218 --- 
G‘
 
the
 
tÙ®
 
numb”
 
of
 
by‹s
 
cu¼’y
 
®loÿ‹d
 
to
 
this
 
š¡ªû
.

219 -- @ 
numb”
 
of
 
by‹s
 
®loÿ‹d
.

220 
funùiÚ
 
Bufãr
:
	$mem
(è 
£lf
.
tbufãr
.
mem
 
’d


222 --- 
G‘
 
š‹º®
 
bufãr
 
poš‹r
. 
Mu¡
 
be
 
Œ—‹d
 
as
 
a
 cÚ¡ 
v®ue
.

223 -- @ * 
to
 
d©a
.

224 -- @ 
cu¼’t
 
size
 
of
 
bufãr
, 
š
 
by‹s
.

225 
funùiÚ
 
Bufãr
:
	$g‘
(è 
£lf
.
tbufãr
.
d©a
, s–f.tbufãr.
sz
 
’d


227 --- 
CÚv”t
 
to
 
Lua
 
ty³
 
¡ršg
 
usšg
 
the
 
	$to¡ršg
(è
butš
 
Ü
 
im¶ic™


228 -- 
cÚv”siÚs
.

229 
funùiÚ
 
Bufãr
:
	$__to¡ršg
()

230  
ffi
.
	$¡ršg
(
£lf
.
tbufãr
.
d©a
, s–f.tbufãr.
sz
)

231 
’d


233 --- 
Com·»
 
two
 
bufãrs
 
by
 
usšg
 
the
 =ğ
İ”©Ü
.

234 
funùiÚ
 
Bufãr
:
	$__eq
(
cmp
)

235 
	`š¡ªûOf
(
Bufãr
, 
cmp
è=ğ
Œue
 
th’


236 
cmp
.
tbufãr
.
sz
 =ğ
£lf
.tbufãr.sz 
th’


237 
ffi
.
C
.
	`memcmp
(
cmp
.
tbufãr
.
d©a
,

238 
£lf
.
tbufãr
.
d©a
,

239 
£lf
.
tbufãr
.
sz
è=ğ0 
th’


240  
Œue


241 
’d


242 
’d


244 
	`”rÜ
("TryšgØcom·» Bufã¸w™h " .. 
	$ty³
(
cmp
))

245 
’d


246  
çl£


247 
’d


249 --- 
CÚÿt
 
by
 
usšg
 
the
 .. 
İ”©Ü
, 
Lua
 
ty³
 
¡ršgs
 
ÿn
 
be
 
cÚÿ‹d
 
®so
.

250 -- 
PËa£
 
nÙe
 
th©
 
this
 
švŞves
 
d“p
 
cİyšg
 
ªd
 
is
 
¦ow”
 
thª
 
mªu®ly


251 -- 
budšg
 
a
 
bufãr
 
w™h
 
	`­³nd_right
().

252 
funùiÚ
 
Bufãr
:
	$__cÚÿt
(
¤c
)

253 
	`ty³
(
£lf
è=ğ"¡ršg" 
th’


254 
	$š¡ªûOf
(
Bufãr
, 
¤c
è
th’


255  
£lf
 .. 
	$to¡ršg
(
¤c
)

256 
’d


257 
–£if
 
	`š¡ªûOf
(
Bufãr
, 
£lf
è=ğ
Œue
 
th’


258 
	`š¡ªûOf
(
Bufãr
, 
¤c
è=ğ
Œue
 
th’


259 
loÿl
 
Ãw
 = 
	`Bufãr
(
¤c
.
tbufãr
.
sz
 + 
£lf
.tbuffer.sz)

260 
Ãw
:
	`­³nd_right
(
£lf
:
	$g‘
())

261 
Ãw
:
	`­³nd_right
(
¤c
:
	$g‘
())

262  
Ãw


263 
–£if
 
	`ty³
(
¤c
è=ğ"¡ršg" 
th’


264 
loÿl
 
¡¾’
 = 
¤c
:
	$Ën
()

265 
loÿl
 
Ãw
 = 
	`Bufãr
(
¡¾’
 + 
£lf
.
tbufãr
.
sz
)

266 
Ãw
:
	`­³nd_right
(
£lf
:
	$g‘
())

267 
Ãw
:
	$­³nd_right
(
¤c
, 
¡¾’
)

268  
Ãw


269 
’d


270 
’d


271 
	`”rÜ
("TryšgØcÚÿˆBufã¸w™h " .. 
	$ty³
(
cmp
))

272 
’d


274  
Bufãr


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/structs/bufferptr.lua

1 -- 
	gTurbo
.
lua
 
Bufãr
 
poš‹r
 
	gim¶em’tiÚ


3 -- 
	gCİyright
 2014 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
	g»quœe
 'turbo.3rdparty.middleclass'

18 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

20 
loÿl
 
BufãrPŒ
 = 
şass
('BufferPtr')

22 
funùiÚ
 
BufãrPŒ
:
	$š™Ÿlize
(
±r
, 
size
)

23 
	`as£¹
(
±r
 ~ğ
n
, "Null…tr given.")

24 
£lf
.
±r
 =…tr

25 
£lf
.
size
 = size

26 
’d


28 
funùiÚ
 
BufãrPŒ
:
	$Ën
(è 
£lf
.
size
 
’d


30 
funùiÚ
 
BufãrPŒ
:
	$g‘
(è 
£lf
.
±r
, s–f.
size
 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/structs/deque.lua

1 -- 
	gTurbo
.
lua
 
DoubË
 
’ded
 
queue
 
	gim¶em’tiÚ


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

18 
	g»quœe
 'turbo.3rdparty.middleclass'

19 
loÿl
 
	glog
 = 
»quœe
 "turbo.log"

20 
loÿl
 
ffi
 = 
»quœe
 "ffi"

22 --- 
DoubË
 
’ded
 
queue
 
şass
.

23 
loÿl
 
deque
 = 
şass
('Deque')

25 
funùiÚ
 
deque
:
	$š™Ÿlize
()

26 
£lf
.
h—d
 = 
n


27 
£lf
.

 = 
n


28 
£lf
.
sz
 = 0

29 
’d


31 --- 
Aµ’d
 
–em’ts
 
to
 

.

32 
funùiÚ
 
deque
:
	$­³nd
(
™em
)

33 
nÙ
 
£lf
.

 
th’


34 
£lf
.

 = {
Ãxt
 = 
n
, 
´ev
 =‚, 
v®ue
 = 
™em
}

35 
	g£lf
.
	gh—d
 = 
£lf
.



37 
loÿl
 
Ãw_
 = {
Ãxt
 = 
n
, 
	g´ev
 = 
£lf
.

, 
	gv®ue
 = 
™em
}

38 
	g£lf
.
	g
.
	gÃxt
 = 
Ãw_


39 
£lf
.

 = 
Ãw_


40 
’d


41 
£lf
.
sz
 = self.sz + 1

42 
’d


44 --- 
Aµ’d
 
–em’t
 
to
 
h—d
.

45 
funùiÚ
 
deque
:
	$­³ndËá
(
™em
)

46 
nÙ
 
£lf
.
h—d
 
th’


47 
£lf
.
h—d
 = {
Ãxt
 = 
n
, 
´ev
 =‚, 
v®ue
 = 
™em
}

48 
	g£lf
.
	g
 = 
£lf
.
h—d


50 
loÿl
 
Ãw_h—d
 = {
Ãxt
 = 
£lf
.
h—d
, 
	g´ev
 = 
n
, 
	gv®ue
 = 
™em
}

51 
	g£lf
.
	gh—d
.
	g´ev
 = 
Ãw_h—d


52 
£lf
.
h—d
 = 
Ãw_h—d


53 
’d


54 
£lf
.
sz
 = self.sz + 1

55 
’d


57 --- 
Removes
 
–em’t
 
©
 

 
ªd
 
»tuºs
 
™
.

58 
funùiÚ
 
deque
:
	$pİ
()

59 
nÙ
 
£lf
.

 
th’


60  
n


61 
’d


62 
loÿl
 
v®ue
 = 
£lf
.

.value

63 
loÿl
 
Ãw_
 = 
£lf
.

.
´ev


64 
nÙ
 
Ãw_
 
th’


65 
£lf
.

 = 
n


66 
£lf
.
h—d
 = 
n


68 
£lf
.

 = 
Ãw_


69 
£lf
.

.
Ãxt
 = 
n


70 
’d


71 
£lf
.
sz
 = self.sz - 1

72  
v®ue


73 
’d


75 --- 
Removes
 
–em’t
 
©
 
h—d
 
ªd
 
»tuºs
 
™
.

76 
funùiÚ
 
deque
:
	$pİËá
()

77 
nÙ
 
£lf
.
h—d
 
th’


78  
n


79 
’d


80 
loÿl
 
v®ue
 = 
£lf
.
h—d
.value

81 
loÿl
 
Ãw_h—d
 = 
£lf
.
h—d
.
Ãxt


82 
nÙ
 
Ãw_h—d
 
th’


83 
£lf
.
h—d
 = 
n


84 
£lf
.

 = 
n


86 
Ãw_h—d
.
´ev
 = 
n


87 
£lf
.
h—d
 = 
Ãw_h—d


88 
’d


89 
£lf
.
sz
 = self.sz - 1

90  
v®ue


91 
’d


93 
funùiÚ
 
deque
:
	$size
(è 
£lf
.
sz
 
’d


95 --- 
Fšd
 
Ëngth
 
of
 
®l
 
–em’ts
 
š
 
deque
 
combšed
. 
Slow
.

96 
funùiÚ
 
deque
:
	$¡¾’
()

97 
loÿl
 
l
 = 
£lf
.
h—d


98 
nÙ
 
l
 
th’


101 
loÿl
 
sz
 = 0

102 
l
 do

103 
sz
 = 
l
.
v®ue
:
	`Ën
() + sz

104 
l
 =†.
Ãxt


105 
’d


106  
sz


107 
’d


108 
’d


110 --- 
CÚÿt
 
®l
 
–em’ts
 
š
 
deque
. 
Slow
.

111 
funùiÚ
 
deque
:
	$cÚÿt
()

112 
loÿl
 
l
 = 
£lf
.
h—d


113 
nÙ
 
l
 
th’


116 
loÿl
 
sz
 = 0

117 
l
 do

118 
sz
 = 
l
.
v®ue
:
	`Ën
() + sz

119 
l
 =†.
Ãxt


120 
’d


121 
loÿl
 
buf
 = 
ffi
.
	`Ãw
("ch¬[?]", 
sz
)

122 
l
 = 
£lf
.
h—d


123 
loÿl
 
i
 = 0

124 
l
 do

125 
loÿl
 
Ën
 = 
l
.
v®ue
:
	$Ën
()

126 
ffi
.
	`cİy
(
buf
 + 
i
, 
l
.
v®ue
, 
Ën
)

127 
i
 = i + 
Ën


128 
l
 =†.
Ãxt


129 
’d


130  
ffi
.
	$¡ršg
(
buf
, 
sz
)

131 
’d


132 
’d


134 
funùiÚ
 
deque
:
	$g‘n
(
pos
)

135 
loÿl
 
l
 = 
£lf
.
h—d


136 
nÙ
 
l
 
th’


137  
n


138 
’d


139 
pos
 ~= 0 do

140 
l
 =†.
Ãxt


141 
nÙ
 
l
 
th’


142  
n


143 
’d


144 
pos
 =…os - 1

145 
’d


146  
l
.
v®ue


147 
’d


149 
funùiÚ
 
deque
:
	$__cÚÿt
(
sourû
)

150 
	`ty³
(
£lf
è=ğ"¡ršg" 
th’


151 
£lf
 = s–à.. 
sourû
:
	$cÚÿt
()

152 
’d


153  
£lf


154 
’d


156 --- 
To
 
¡ršg
 
m‘am‘hod
.

157 
funùiÚ
 
deque
:
	$__to¡ršg
(è 
£lf
:
	$cÚÿt
(è
’d


158 --- 
R‘uºs
 
–em’t
 
©
 

.

159 
funùiÚ
 
deque
:
	$³ekÏ¡
(è 
£lf
.

.
v®ue
 
’d


160 --- 
R‘uºs
 
–em’t
 
©
 
h—d
.

161 
funùiÚ
 
deque
:
	$³ekfœ¡
(è 
£lf
.
h—d
.
v®ue
 
’d


163 
funùiÚ
 
deque
:
	$nÙ_em±y
()

164  
£lf
.
h—d
 ~ğ
n


165 
’d


167  
deque


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/syscall.lua

1 --- 
	gTurbo
.
lua
 
sysÿÎ
 
	gModuË


3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

16 -- 
modes


18 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

19 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

20 
loÿl
 
tm
 = 
ut
.
bËm”ge


21 
loÿl
 
où®
 = 
	$funùiÚ
 (
s
è 
	$tÚumb”
(
s
, 8è
’d


23 
loÿl
 
æags
 = {

24 
O_DIRECTORY
 = 
	`où®
('0200000'),

25 
O_NOFOLLOW
 = 
	`où®
('0400000'),

26 
O_DIRECT
 = 
	`où®
('040000'),

27 
S_IFMT
 = 
	`où®
('0170000'),

28 
S_IFSOCK
 = 
	`où®
('0140000'),

29 
S_IFLNK
 = 
	`où®
('0120000'),

30 
S_IFREG
 = 
	`où®
('0100000'),

31 
S_IFBLK
 = 
	`où®
('0060000'),

32 
S_IFDIR
 = 
	`où®
('0040000'),

33 
S_IFCHR
 = 
	`où®
('0020000'),

34 
S_IFIFO
 = 
	`où®
('0010000'),

35 
S_ISUID
 = 
	`où®
('0004000'),

36 
S_ISGID
 = 
	`où®
('0002000'),

37 
S_ISVTX
 = 
	`où®
('0001000'),

38 
S_IRWXU
 = 
	`où®
('00700'),

39 
S_IRUSR
 = 
	`où®
('00400'),

40 
S_IWUSR
 = 
	`où®
('00200'),

41 
S_IXUSR
 = 
	`où®
('00100'),

42 
S_IRWXG
 = 
	`où®
('00070'),

43 
S_IRGRP
 = 
	`où®
('00040'),

44 
S_IWGRP
 = 
	`où®
('00020'),

45 
S_IXGRP
 = 
	`où®
('00010'),

46 
S_IRWXO
 = 
	`où®
('00007'),

47 
S_IROTH
 = 
	`où®
('00004'),

48 
S_IWOTH
 = 
	`où®
('00002'),

49 
S_IXOTH
 = 
	`où®
('00001')

50 
	}
}

52 
loÿl
 
	gcmds


53 --- ******* 
sysÿÎs
 *******

54 
	gffi
.
	g¬ch
 =ğ"x86" 
th’


55 
cmds
 = {

56 
SYS_¡©
 = 106,

57 
	gSYS_f¡©
 = 108,

58 
	gSYS_l¡©
 = 107,

59 
	gSYS_g‘d’ts
 = 141,

60 
	gSYS_io_£tup
 = 245,

61 
	gSYS_io_de¡roy
 = 246,

62 
	gSYS_io_g‘ev’ts
 = 247,

63 
	gSYS_io_subm™
 = 248,

64 
	gSYS_io_ÿnûl
 = 249,

65 
	gSYS_şock_£‰ime
 = 264,

66 
	gSYS_şock_g‘time
 = 265,

67 
	gSYS_şock_g‘»s
 = 266,

68 
	gSYS_şock_Çno¦“p
 = 267

70 
–£if
 
	gffi
.
	g¬ch
 =ğ"x64" 
th’


71 
cmds
 = {

72 
SYS_¡©
 = 4,

73 
	gSYS_f¡©
 = 5,

74 
	gSYS_l¡©
 = 6,

75 
	gSYS_g‘d’ts
 = 78,

76 
	gSYS_io_£tup
 = 206,

77 
	gSYS_io_de¡roy
 = 207,

78 
	gSYS_io_g‘ev’ts
 = 208,

79 
	gSYS_io_subm™
 = 209,

80 
	gSYS_io_ÿnûl
 = 210,

81 
	gSYS_şock_£‰ime
 = 227,

82 
	gSYS_şock_g‘time
 = 228,

83 
	gSYS_şock_g‘»s
 = 229,

84 
	gSYS_şock_Çno¦“p
 = 230

86 
–£if
 
	gffi
.
	g¬ch
 =ğ"µc" 
Ü
 
ffi
.
¬ch
 =ğ"µc64Ë" 
th’


87 
cmds
 = {

88 
SYS_¡©
 = 106,

89 
	gSYS_f¡©
 = 108,

90 
	gSYS_l¡©
 = 107,

91 
	gSYS_g‘d’ts
 = 141,

92 
	gSYS_io_£tup
 = 227,

93 
	gSYS_io_de¡roy
 = 228,

94 
	gSYS_io_g‘ev’ts
 = 229,

95 
	gSYS_io_subm™
 = 230,

96 
	gSYS_io_ÿnûl
 = 231,

97 
	gSYS_şock_£‰ime
 = 245,

98 
	gSYS_şock_g‘time
 = 246,

99 
	gSYS_şock_g‘»s
 = 247,

100 
	gSYS_şock_Çno¦“p
 = 248

102 
–£if
 
	gffi
.
	g¬ch
 =ğ"¬m" 
th’


103 
cmds
 = {

104 
SYS_¡©
 = 106,

105 
	gSYS_f¡©
 = 108,

106 
	gSYS_l¡©
 = 107,

107 
	gSYS_g‘d’ts
 = 141,

108 
	gSYS_io_£tup
 = 243,

109 
	gSYS_io_de¡roy
 = 244,

110 
	gSYS_io_g‘ev’ts
 = 245,

111 
	gSYS_io_subm™
 = 246,

112 
	gSYS_io_ÿnûl
 = 247,

113 
	gSYS_şock_£‰ime
 = 262,

114 
	gSYS_şock_g‘time
 = 263,

115 
	gSYS_şock_g‘»s
 = 264,

116 
	gSYS_şock_Çno¦“p
 = 265

118 
–£if
 
	gffi
.
	g¬ch
 =ğ"m£l" 
th’


119 
cmds
 = {

120 
SYS_¡©
 = 4106,

121 
	gSYS_f¡©
 = 4108,

122 
	gSYS_l¡©
 = 4107,

123 
	gSYS_g‘d’ts
 = 4141,

124 
	gSYS_io_£tup
 = 4241,

125 
	gSYS_io_de¡roy
 = 4242,

126 
	gSYS_io_g‘ev’ts
 = 4244,

127 
	gSYS_io_subm™
 = 4246,

128 
	gSYS_io_ÿnûl
 = 4245,

129 
	gSYS_şock_£‰ime
 = 4262,

130 
	gSYS_şock_g‘time
 = 4263,

131 
	gSYS_şock_g‘»s
 = 4264,

132 
	gSYS_şock_Çno¦“p
 = 4265

134 
’d


136  
tm
(
æags
, 
cmds
)

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/tcpserver.lua

1 --- 
	gTurbo
.
lua
 
TCP
 
S”v”
 
	gmoduË


2 -- 
A
 
sim¶e
 
	gnÚ
-
blockšg
 
ex‹nsibË
 
TCP
 
S”v”
 
ba£d
 
Ú
 
the
 
IOSŒ—m
 
	gşass
.

3 -- 
Inşudes
 
SSL
 
	gsuµÜt
. 
U£d
 
as
 
ba£
 
the
 
Turbo
 
HTTP
 
	gS”v”
.

5 -- 
	gCİyright
 2011, 2012, 2013 
John
 
	gAb¿ham£n


7 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

8 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

9 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


11 -- 
	gh‰p
:

13 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


14 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

15 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

16 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


17 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

19 
loÿl
 
	glog
 = 
»quœe
 "turbo.log"

20 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

21 
loÿl
 
io¡»am
 = 
»quœe
 "turbo.iostream"

22 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

23 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

24 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

25 
loÿl
 
sockut
 = 
»quœe
 "turbo.sockutil"

26 
loÿl
 
üy±o
 = 
»quœe
 "turbo.crypto"

27 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

28 
loÿl
 
ffi
 = 
»quœe
 "ffi"

29 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

30 
»quœe
 "turbo.cdef"

31 
»quœe
 "turbo.3rdparty.middleclass"

33 
loÿl
 
C
 = 
ffi
.C

35 
loÿl
 
tı£rv”
 = {} --ı£rv” 
Çme¥aû


37 --- 
A
 
nÚ
-
blockšg
 
TCP
 
£rv”
 
şass
.

38 -- 
U£rs
 
which
 
wªt
 
to
 
ü—‹
 
a
 
TCP
 
£rv”
 
should
 
šh”™
 
äom
 
this
 
şass
 
ªd


39 -- 
im¶em’t
 
the
 
TCPS”v”
:
	$hªdË_¡»am
(è
m‘hod
.

40 -- 
SSL
 
is
 
suµÜ‹d
 
by
 
´ovidšg
 
the
 
s¦_İtiÚs
 
bË
 
Ú
 
şass
 
š™Ÿliz©iÚ
.

41 
tı£rv”
.
TCPS”v”
 = 
	`şass
('TCPServer')

43 --- 
C»©e
 
a
 
Ãw
 
TCPS”v”
 
şass
 
š¡ªû
.

44 -- @
·¿m
 
	`io_loİ
 (
IOLoİ
 
š¡ªû
)

45 -- @
·¿m
 
	$s¦_İtiÚs
 (
TabË
è
O±iÚ®
 
SSL
 
·¿m‘”s
.

46 -- @
·¿m
 
	$max_bufãr_size
 (
Numb”
è
The
 
maximum
 
bufãr
 
size
 
of
 
the
 
£rv”
. 
If


47 -- 
the
 
lim™
 
is
 
h™
,h
cÚÃùiÚ
 i 
şo£d
.

48 -- @
nÙe
 
If
 
the
 
SSL
 
û¹ifiÿ‹s
 
ÿn
 
nÙ
 
be
 
lßded
, 
a
 
”rÜ
 
is
 
¿i£d
.

49 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$š™Ÿlize
(
io_loİ
, 
s¦_İtiÚs
, 
max_bufãr_size
)

50 
£lf
.
io_loİ
 = io_loop

51 
£lf
.
s¦_İtiÚs
 = ssl_options

52 
£lf
.
max_bufãr_size
 = max_buffer_size

53 
£lf
.
_sock‘s
 = {
	}
}

54 
£lf
.
_³ndšg_sock‘s
 = {}

55 
£lf
.
_¡¬‹d
 = 
çl£


56 -- 
V®id©e
 
SSL
 
İtiÚs
 
£t
.

57 
£lf
.
s¦_İtiÚs
 
th’


58 
nÙ
 
ty³
(
s¦_İtiÚs
.
û¹_fe
è=ğ"¡ršg" 
th’


59 
”rÜ
("ssl_options‡rgument is set, but cert_file‡rgument is \
 or‚ot‡ string.")

61 
’d


62 
nÙ
 
ty³
(
s¦_İtiÚs
.
key_fe
è=ğ"¡ršg" 
th’


63 
”rÜ
("ssl_options‡rgument is set, but key_file‡rguments is \
 or‚ot‡ string.")

65 
’d


66 -- 
So
 
the
 
Úly
 
check
 
th©
 
is
 
dÚe
 i th©h
û¹
 
ªd
 
key
 
fe
 
¬e


67 -- 
»adabË
. 
Howev”
 
the
 
v®id™y
 
of
h
keys
 
¬e
 
nÙ
 
checked
 
uÁ


68 -- 
we
 
ü—‹
 
the
 
SSL
 
cÚ‹xt
.

69 
nÙ
 
ut
.
	$fe_exi¡s
(
s¦_İtiÚs
.
û¹_fe
è
th’


70 
	`”rÜ
(
¡ršg
.
	`fÜm©
("SSL cert_file, %s, does‚otƒxist.",

71 
s¦_İtiÚs
.
û¹_fe
))

72 
’d


73 
nÙ
 
ut
.
	$fe_exi¡s
(
s¦_İtiÚs
.
key_fe
è
th’


74 
	`”rÜ
(
¡ršg
.
	`fÜm©
("SSL key_file, %s, does‚otƒxist.",

75 
s¦_İtiÚs
.
key_fe
))

76 
’d


77 -- 
The
 
s¦_ü—‹_cÚ‹xt
 
funùiÚ
 
wl
 
¿i£
 
”rÜ
 
ªd
 
ex™
 
by
 
™s


78 -- 
own
, 
so
 
th”e
 
is
 
no
 
Ãed
 
to
 
ÿtch
 
”rÜs
.

79 
loÿl
 
rc
, 
ùx_Ü_”r
 = 
üy±o
.
	$s¦_ü—‹_£rv”_cÚ‹xt
(

80 
£lf
.
s¦_İtiÚs
.
û¹_fe
, s–f.s¦_İtiÚs.
key_fe
, s–f.s¦_İtiÚs.
ÿ_·th
)

81 
rc
 ~ğ0 
th’


82 
	`”rÜ
(
¡ršg
.
	`fÜm©
("Could‚ot create SSL context. %s",

83 
ùx_Ü_”r
))

84 
’d


85 
£lf
.
_s¦_ùx
 = 
ùx_Ü_”r


86 
£lf
.
s¦_İtiÚs
.
_s¦_ùx
 = self._ssl_ctx

87 
’d


88 
’d


90 --- 
Im¶em’t
 
this
 
m‘hod
 
to
 
hªdË
 
Ãw
 
cÚÃùiÚs
.

91 -- @
·¿m
 
	$¡»am
 (
IOSŒ—m
 
š¡ªû
è
SŒ—m
 
the
 
Ãwly
 
cÚÃùed
 
ş›Á
.

92 -- @
·¿m
 
	$add»ss
 (
SŒšg
è
IP
 
add»ss
 
of
 
Ãwly
 
cÚÃùed
 
ş›Á
.

93 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$hªdË_¡»am
(
¡»am
, 
add»ss
)

94 
	`”rÜ
('handle_stream method‚ot implemented inhis object')

95 
’d


97 --- 
S¹
 
li¡’šg
 
Ú
 
pÜt
 
ªd
 
add»ss
.

98 -- 
Wh’
 
usšg
 
this
 
m‘hod
, 
as
 
İo£d
 
to
 
TCPS”v”
:
bšd
 
you
 
should
 
nÙ
 
ÿÎ


99 -- 
TCPS”v”
:
¡¬t
. 
You
 
ÿn
 
ÿÎ
 
this
 
m‘hod
 
muÉË
 
times
 
w™h
 
difã»Á


100 -- 
·¿m‘”s
 
to
 
bšd
 
muÉË
 
sock‘s
Ø
the
 
§me
 
TCPS”v”
.

101 -- @
·¿m
 
	$pÜt
 (
Numb”
è
The
 
pÜt
 
numb”
 
to
 
bšd
o.

102 -- @
·¿m
 
	$add»ss
 (
Numb”
è
The
 
add»ss
 
to
 
bšd
Ø
š
 
š‹g”
 
ho¡lÚg


103 -- 
fÜm©
. 
If
 
nÙ
 
add»ss
 
is
 
giv’
, 
INADDR_ANY
 
wl
 
be
 
u£d
, 
bšdšg
 
to
 
®l


104 -- 
add»s£s
.

105 -- @
·¿m
 
	$backlog
 (
Numb”
è
Maximum
 
backlogged
 
ş›Á
 
cÚÃùs
 
to
 
®low
. 
If
 
nÙ


106 -- 
defšed
 
th’
 128 
is
 
u£d
 
as
 .

107 -- @
·¿m
 
	$çmy
 (
Numb”
è
O±iÚ®
 
sock‘
 
çmy
. 
Defšed
 
š
 
Sock‘
 
moduË
. 
If


108 -- 
nÙ
 
defšed
 
AF_INET
 
is
 
u£d
 
as
 .

109 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$li¡’
(
pÜt
, 
add»ss
, 
backlog
, 
çmy
)

110 
	`as£¹
(
pÜt
, [[
PËa£
 
¥ecify
…Üˆ
	$li¡’
(è
m‘hod
]])

111 
loÿl
 
sock
 = 
sockut
.
	$bšd_sock‘s
(
pÜt
, 
add»ss
, 
backlog
, 
çmy
)

112 
£lf
:
	`add_sock‘s
({
sock
})

113 
’d


115 --- 
Add
 
muÉË
 
sock‘s
 
š
 
a
 
bË
 
th©
 
should
 
be
 
bound
 
Ú
 
ÿÎšg
 
¡¬t
.

116 -- @
·¿m
 
sock‘s
 (
TabË
è1 
Ü
 
mÜe
 
sock‘
 
fd
's.

117 -- @
nÙe
 
U£
 
the
 
sockut
.
bšd_sock‘s
 
funùiÚ
 
to
 
ü—‹
 
sock‘s
 
—sy
 
ªd


118 -- 
add
 
them
 
to
 
the
 
sock‘s
 
bË
.

119 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$add_sock‘s
(
sock‘s
)

120 
nÙ
 
£lf
.
io_loİ
 
th’


121 
£lf
.
io_loİ
 = 
iŞoİ
.
	$š¡ªû
()

122 
’d


123 
_
, 
sock
 
š
 
	$aœs
(
sock‘s
) do

124 
£lf
.
_sock‘s
[#£lf._sock‘ + 1] = 
sock


125 
sockut
.
	$add_acû±_hªdËr
(
sock
,

126 
£lf
.
_hªdË_cÚÃùiÚ
,

127 
£lf
.
io_loİ
,

128 
£lf
)

129 
’d


130 
’d


132 --- 
Add
 
a
 
sšgË
 
sock‘
 
th©
 
should
 
be
 
bound
 
Ú
 
ÿÎšg
 
¡¬t
.

133 -- @
·¿m
 
	$sock‘
 (
Numb”
è
Sock‘
 
fd
.

134 -- @
nÙe
 
U£
 
the
 
sockut
.
bšd_sock‘s
 
to
 
ü—‹
 
sock‘s
 
—sy
 
ªd
 
add
 
them
o

135 -- 
the
 
sock‘s
 
bË
.

136 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$add_sock‘
(
sock‘
è
£lf
:
	`add_sock‘s
({
	}
sock‘}è
’d


138 --- 
Bšd
 
this
 
£rv”
 
to
 
pÜt
 
ªd
 
add»ss
.

139 -- @
nÙe
 
No
 
sock‘s
 
¬e
 
bound
 
uÁ
 
TCPS”v”
:
¡¬t
 
is
 
ÿÎed
.

140 -- @
·¿m
 
	$pÜt
 (
Numb”
è
The
 
pÜt
 
numb”
 
to
 
bšd
o.

141 -- @
·¿m
 
	$add»ss
 (
Numb”
è
The
 
add»ss
 
to
 
bšd
Ø
š
 
š‹g”
 
ho¡lÚg


142 -- 
fÜm©
. 
If
 
nÙ
 
add»ss
 
is
 
giv’
, 
INADDR_ANY
 
wl
 
be
 
u£d
, 
bšdšg
 
to
 
®l


143 -- 
add»s£s
.

144 -- @
·¿m
 
	$backlog
 (
Numb”
è
Maximum
 
backlogged
 
ş›Á
 
cÚÃùs
 
to
 
®low
. 
If
 
nÙ


145 -- 
defšed
 
th’
 128 
is
 
u£d
 
as
 .

146 -- @
·¿m
 
	$çmy
 (
Numb”
è
O±iÚ®
 
sock‘
 
çmy
. 
Defšed
 
š
 
Sock‘
 
moduË
. 
If


147 -- 
nÙ
 
defšed
 
AF_INET
 
is
 
u£d
 
as
 .

148 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$bšd
(
pÜt
, 
add»ss
, 
backlog
, 
çmy
)

149 
loÿl
 
sock‘s
 = 
sockut
.
	$bšd_sock‘s
(
pÜt
, 
add»ss
, 
backlog
, 
çmy
)

150 
£lf
.
_¡¬‹d
 
th’


151 
£lf
:
	$add_sock‘s
(
sock‘s
)

153 
£lf
.
_³ndšg_sock‘s
[#£lf._³ndšg_sock‘ + 1] = 
sock‘s


154 
’d


155 
’d


157 --- 
S¹
 
the
 
TCPS”v”
.

158 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$¡¬t
(
´ocs
)

159 
	`as£¹
((
nÙ
 
£lf
.
_¡¬‹d
), "Already started TCPServer.")

160 
£lf
.
_¡¬‹d
 = 
Œue


161 
´ocs
 
ªd
…roc > 1‡nd 
¶©fÜm
.
__LINUX__
 
th’


162 
_
 = 1, 
´ocs
 - 1 do

163 
loÿl
 
pid
 = 
ffi
.
C
.
	$fÜk
()

164 
pid
 ~ğ0 
th’


165 
log
.
	`dev–
(
¡ršg
.
	`fÜm©
(

167 
	$tÚumb”
(
pid
)))

169 
’d


170 
’d


171 
’d


172 
loÿl
 
sock‘s
 = 
£lf
.
_³ndšg_sock‘s


173 
£lf
.
_³ndšg_sock‘s
 = {
	}
}

174 
£lf
:
	$add_sock‘s
(
sock‘s
)

175 
’d


177 --- 
Stİ
 
the
 
TCPS”v”
.

178 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$¡İ
()

179 
_
, 
fd
 
š
 
	$aœs
(
£lf
.
_sock‘s
) do

180 
£lf
.
io_loİ
:
	$»move_hªdËr
(
fd
)

181 
£lf
:
	$_şo£
(
fd
)

182 
’d


183 
£lf
.
_sock‘s
 = {
	}
}

184 
’d


186 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


187 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$_şo£
(
fd
)

188 
	`as£¹
(
C
.
	`şo£
(
fd
) == 0, "Failedo close socket.")

189 
’d


191 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$_şo£
(
fd
)

192 
	`as£¹
(
fd
:
	$şo£
())

193 
’d


194 
’d


197 --- 
IÁ”Çl
 
funùiÚ
 
w¿µšg
 
Ãw
 
¿w
 
sock‘s
 
š
 
a
 
IOSŒ—m
 
şass
 
š¡ªû
.

198 -- @
·¿m
 
	$cÚÃùiÚ
 (
Numb”
è
Cl›Á
 
sock‘
 
fd
.

199 -- @
·¿m
 
	$add»ss
 (
SŒšg
è
IP
 
add»ss
 
of
 
Ãwly
 
cÚÃùed
 
ş›Á
.

200 
funùiÚ
 
tı£rv”
.
TCPS”v”
:
	$_hªdË_cÚÃùiÚ
(
cÚÃùiÚ
, 
add»ss
)

201 
£lf
.
s¦_İtiÚs
 ~ğ
n
 
th’


202 
loÿl
 
¡»am
 = 
io¡»am
.
	$SSLIOSŒ—m
(

203 
cÚÃùiÚ
,

204 
£lf
.
s¦_İtiÚs
,

205 
£lf
.
io_loİ
,

206 
£lf
.
max_bufãr_size
)

207 
£lf
:
	$hªdË_¡»am
(
¡»am
, 
add»ss
)

209 
loÿl
 
¡»am
 = 
io¡»am
.
	$IOSŒ—m
(

210 
cÚÃùiÚ
,

211 
£lf
.
io_loİ
,

212 
£lf
.
max_bufãr_size
)

213 
£lf
:
	$hªdË_¡»am
(
¡»am
, 
add»ss
)

214 
’d


215 
’d


217  
tı£rv”


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/thread.lua

1 --- 
	gTurbo
.
lua
 
Th»ad
 
	gmoduË


3 -- 
	gCİyright
 2016 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

18 
loÿl
 
iŞoİ
 = 
»quœe
 "turbo.ioloop"

19 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

20 
loÿl
 
log
 = 
»quœe
 "turbo.log"

21 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

22 
loÿl
 
sockut
 = 
»quœe
 "turbo.sockutil"

23 
loÿl
 
io¡»am
 = 
»quœe
 "turbo.iostream"

24 
loÿl
 
coùx
 = 
»quœe
 "turbo.coctx"

25 
»quœe
 "turbo.cdef"

27 
loÿl
 
th»ad
 = {}

29 
th»ad
.
Th»ad
 = 
şass
("Thread")

31 --- 
The
 
Th»ad
 
şass
 
is
 
im¶em’‹d
 
w™h
 
C
 
fÜk
, 
ªd
 
®lows
 
the
 
u£r
 
to
 
	gü—‹


32 -- 
a
 
£³¿‹
 
th»ad
 
th©
 
runs
 
šd•’d’y
 
of
 
the
 
maš
 
	gth»ad
, 
but
 
	gÿn


33 -- 
communiÿ‹
 
w™h
 
—ch
 
Ùh”
 
ov”
 
a
 
AF_UNIX
 
	gsock‘
. 
U£ful
 
ªd
 
	gh—vy


34 -- 
sks
 
th©
 
ÿn
 
nÙ
 
be
 
	gy›lded
. 
Also
 
u£ful
 
ruÂšg
 
sh–l
 
commªds
 
	g‘c
.

35 -- 
	gU§ge
:

36 -- 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`add_ÿÎback
(
	`funùiÚ
()

37 -- 
loÿl
 
th»ad
 = 
turbo
.th»ad.
	`Th»ad
(
	`funùiÚ
(
th
)

38 -- 
th
:
	`£nd
("Hello World.")

39 -- 
th
:
	`¡İ
()

40 -- 
’d
)

42 -- 
	`´št
(
th»ad
:
	`wa™_fÜ_d©a
())

43 -- 
th»ad
:
	`wa™_fÜ_fšish
()

44 -- 
turbo
.
iŞoİ
.
	$š¡ªû
():
	`şo£
()

45 -- 
’d
):
	`¡¬t
()

46 -- 
AÎ
 
funùiÚs
 
¬e
 
y›lded
 
to
 
the
 
IOLoİ
 
š‹º®ly
.

47 -- @
·¿m
 
func
 
FunùiÚ
 
to
 
ÿÎ
 
wh’
 
th»ad
 
has
 
b“n
 
ü—‹d
. FunùiÚ 
is
 
ÿÎed


48 -- 
w™h
 
the
 
chds
 
Th»ad
 
objeù
, 
which
 
cÚšs
 
™s
 
own
 
IOLoİ


49 -- 
e
.
g
: "th.io_loop".

50 
funùiÚ
 
th»ad
.
Th»ad
:
	`š™Ÿlize
(
func
, 
¬gs
)

51 --
£lf
.
¬gs
 =‡rg 
Ü
 {
	}
}

52 
£lf
.
io_loİ
 = io_loİ 
Ü
 
iŞoİ
.
	$š¡ªû
()

53 
£lf
.
ruÂšg
 = 
Œue


54 
£lf
.
_chd_func
 = 
func


55  
£lf
:
	$_run_th»ad
()

56 
’d


58 -- 
Stİ
 
th»ad
 
ªd
 
ş—nup
 
pe
.

59 
funùiÚ
 
th»ad
.
Th»ad
:
	$¡İ
()

60 
£lf
.
maš_th»ad
 
th’


61 -- 
S’d
 
¡İ
 
mes§ge
 
ov”
 
wœe
.

62 
£lf
.
pe
:
	`wr™e
("STOP\r\n\r\n", 
	$funùiÚ
()

63 
ffi
.
C
.
	$wa™
(
n
)

64 
’d
)

66 -- 
Stİ
 
th»ad
 
as
 
chd
.

67 
loÿl
 
_£lf
 = 
£lf


68 
£lf
.
pe
:
	`wr™e
("STOP\r\n\r\n", 
	$funùiÚ
()

69 
_£lf
.
pe
:
	$şo£
()

70 
_£lf
.
io_loİ
:
	$şo£
()

71 
os
.
	$»move
(
£lf
.
com_pÜt
)

72 
os
.
	$ex™
(0)

73 
’d


75 
’d


76 
’d


78 --- 
C®Ëd
 
by
 
e™h”
 
maš
 
Ü
 
chd
 
th»ad
 
to
 
£nd
 
d©a
Ø
—ch
 
Ùh”
.

79 -- @
·¿m
 
	$d©a
 (
SŒšg
èSŒšg 
to
 
be
 
£Á
.

80 
funùiÚ
 
th»ad
.
Th»ad
:
	$£nd
(
d©a
)

81 
£lf
.
pe
:
	`wr™e
("DATA\r\n\r\n"..
d©a
:
	`Ën
().."\r\n\r\n"..data)

82 
’d


84 --- 
Wa™
 
d©a
 
to
 
become
 
avaabË
 
Ú
 
communiÿtiÚ
 
sock‘
.

85 
funùiÚ
 
th»ad
.
Th»ad
:
	$wa™_fÜ_d©a
()

86 
£lf
.
d©a_ùx
 = 
coùx
.
	$CÜoutšeCÚ‹xt
(
£lf
.
io_loİ
)

87 
£lf
.
_wa™šg_d©a
 
th’


88 -- 
D©a
 
is
 
®»ady
 
avaabË
.

89 
loÿl
 
d©a
 = 
£lf
.
_wa™šg_d©a


90 
£lf
.
_wa™šg_d©a
 = 
n


91  
d©a


92 
’d


93 
loÿl
 
”r
, 
d©a
 = 
cÜoutše
.
	$y›ld
(
£lf
.
d©a_ùx
)

94 
”r
 
th’


95 
	$”rÜ
(
”r
)

96 
’d


97  
d©a


98 
’d


100 --- 
Wa™
 
th»ad
 
to
 
¡İ
 
ruÂšg
.

101 -- 
OÆy
 
ÿÎabË
 
äom
 
maš
 
th»ad
.

102 
funùiÚ
 
th»ad
.
Th»ad
:
	$wa™_fÜ_fšish
()

103 
nÙ
 
£lf
.
maš_th»ad
 
th’


104 
	`”rÜ
("Childhread can‚ot wait for childhread.")

105 
’d


106 
nÙ
 
£lf
.
ruÂšg
 
th’


108 
’d


109 
£lf
.
fš_ùx
 = 
coùx
.
	$CÜoutšeCÚ‹xt
(
£lf
.
io_loİ
)

110 
loÿl
 
”r
 = 
cÜoutše
.
	$y›ld
(
£lf
.
fš_ùx
)

111 
”r
 
th’


112 
	$”rÜ
(
”r
)

113 
’d


114 
’d


116 --- 
Wa™
 
th»ad
 
pe
 
to
 
be
 
cÚÃùed
. 
Mu¡
 b
u£d
 
by
 
maš
hread

117 -- 
befÜe
 
©‹m±šg
 
to
 
£nd
 
d©a
Ø
chd
.

118 -- 
OÆy
 
ÿÎabË
 
äom
 
maš
 
th»ad
.

119 
funùiÚ
 
th»ad
.
Th»ad
:
	$wa™_fÜ_pe
()

120 
nÙ
 
£lf
.
maš_th»ad
 
th’


121 
	`”rÜ
(

123 
’d


124 
£lf
.
cÚÃùed
 
th’


126 
’d


127 
£lf
.
cÚÃù_ùx
 = 
coùx
.
	$CÜoutšeCÚ‹xt
(
£lf
.
io_loİ
)

128 
loÿl
 
”r
 = 
cÜoutše
.
	$y›ld
(
£lf
.
cÚÃù_ùx
)

129 
”r
 
th’


130 
	$”rÜ
(
”r
)

131 
’d


132 
’d


134 --- 
G‘
 
PID
 
of
 
chd
.

135 -- @ (
Numb”
è
PID


136 
funùiÚ
 
th»ad
.
Th»ad
:
	$g‘_pid
()

137 
nÙ
 
£lf
.
maš_th»ad
 
th’


138  
	`tÚumb”
(
ffi
.
C
.
	$g‘pid
())

139 
’d


140  
£lf
.
ruÂšg_pid


141 
’d


143 
funùiÚ
 
th»ad
.
Th»ad
:
	$_run_th»ad
()

144 
£lf
.
com_pÜt
 = "/tmp/turbo-com" .. 
	`to¡ršg
(
m©h
.
	$¿ndom
(1, 9999999))

145 
loÿl
 
pid
 = 
ffi
.
C
.
	$fÜk
()

146 
pid
 < 0 
th’


147 
	`”rÜ
("Could‚ot create childhread.")

148 
’d


149 
pid
 ~ğ0 
th’


150 -- 
Maš
 
th»ad
 .

151 
£lf
.
maš_th»ad
 = 
Œue


152 
£lf
.
ruÂšg
 = 
Œue


153 
£lf
.
ruÂšg_pid
 = 
pid


154 
£lf
:
	$_ü—‹_unix_sock
()

156 
’d


157 -- 
New
 
th»ad
.

158 
£lf
.
io_loİ
 = 
iŞoİ
.
	$IOLoİ
()

159 
_G
.
io_loİ_š¡ªû
 = 
£lf
.
io_loİ


160 
£lf
.
maš_th»ad
 = 
çl£


161 
£lf
:
	$_cÚÃù_to_maš_th»ad
()

162 
’d


164 
funùiÚ
 
th»ad
.
Th»ad
:
	$_»¡Üe_coùx_w™h_”rÜ
(
”r
)

165 
£lf
.
d©a_ùx
 
th’


166 
loÿl
 
ùx
 = 
£lf
.
d©a_ùx


167 
£lf
.
d©a_ùx
 = 
n


168 
ùx
:
	$£t_¬gum’ts
(
”r
)

169 
ùx
:
	$fš®ize_cÚ‹xt
()

171 
’d


172 
£lf
.
pe_ùx
 
th’


173 
loÿl
 
ùx
 = 
£lf
.
pe_ùx


174 
£lf
.
pe_ùx
 = 
n


175 
ùx
:
	$£t_¬gum’ts
(
”r
)

176 
ùx
:
	$fš®ize_cÚ‹xt
()

178 
’d


179 
£lf
.
fš_ùx
 
th’


180 
loÿl
 
ùx
 = 
£lf
.
fš_ùx


181 
£lf
.
fš_ùx
 = 
n


182 
ùx
:
	$£t_¬gum’ts
(
”r
)

183 
ùx
:
	$fš®ize_cÚ‹xt
()

185 
’d


186 
’d


188 
funùiÚ
 
th»ad
.
Th»ad
:
	$_execu‹_th»ad_func
()

189 
loÿl
 
_£lf
 = 
£lf


190 
	`xpÿÎ
(
£lf
.
_chd_func
, 
	`funùiÚ
(
”r
)

191 -- 
Chd
 
th»ad
 
’couÁ”ed
 
”rÜ
.

192 -- 
CËªup
 
ev”ythšg
 
ªd
 
ex™
 
th»ad
.

193 
loÿl
 
th»ad
 = 
	`tÚumb”
(
ffi
.
C
.
	$g‘pid
())

194 
loÿl
 
Œaû
 = 
debug
.
	`Œaûback
(
cÜoutše
.
	`ruÂšg
(), 
”r
, 2):
	`gsub
(

196 
loÿl
 
_¡r_bÜd”s_down
 = 
¡ršg
.
	`»p
("/", 80)

197 
loÿl
 
_¡r_bÜd”s_up
 = 
¡ršg
.
	`»p
("\\", 80)

198 
loÿl
 
”r
 =

199 
¡ršg
.
	`fÜm©
(

201 
th»ad
,

202 
_¡r_bÜd”s_down
,

203 
Œaû
,

204 
_¡r_bÜd”s_up
)

206 
_£lf
.
pe
:
	`wr™e
("ERRO\r\n\r\n"..
”r
:
	`Ën
().."\r\n\r\n"..”r, 
	$funùiÚ
()

207 
_£lf
:
	$¡İ
()

208 
’d
)

209 
’d
,

210 
£lf
)

211 
’d


213 
funùiÚ
 
th»ad
.
Th»ad
:
	$_cÚÃù_to_maš_th»ad
()

214 
loÿl
 
”ºo
, 
rc


215 
loÿl
 
ş›Á_add»ss
 = 
ffi
.
	`Ãw
("struct sockaddr_un");

217 
ş›Á_add»ss
.
sun_çmy
 = 
sock‘
.
AF_UNIX
;

218 
ffi
.
	`cİy
(
ş›Á_add»ss
.
sun_·th
,

219 
ffi
.
	`ÿ¡
("cÚ¡ ch¬*", 
£lf
.
com_pÜt
),

220 
m©h
.
	`mš
(
£lf
.
com_pÜt
:
	`Ën
(), 
ffi
.(
ş›Á_add»ss
.
sun_·th
)))

221 
£lf
.
ş›Á_sockfd
 = 
ffi
.
C
.
	`sock‘
(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
, 0);

222 
£lf
.
ş›Á_sockfd
 < 0 
th’


223 
”ºo
 = 
ffi
.
	$”ºo
()

224 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

226 
”ºo
,

227 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

228 
os
.
	$ex™
(1)

229 
’d


230 
rc
 = 
ffi
.
C
.
	`cÚÃù
(
£lf
.
ş›Á_sockfd
,

231 
ffi
.
	`ÿ¡
("cÚ¡ sŒuù sockadd¸*", 
ş›Á_add»ss
),

232 
ffi
.(
ş›Á_add»ss
))

233 
rc
 ~ğ0 
th’


234 -- 
Maš
 
th»ad
 
´obably
 
has
 
nÙ
 
ü—‹d
 
sock‘
 
y‘
. 
Wa™
.

235 -- 
Should
 
be
 
dÚe
 
mÜe
 
–egªy
...

236 
ffi
.
C
.
	$¦“p
(1)

237 
rc
 = 
ffi
.
C
.
	`cÚÃù
(
£lf
.
ş›Á_sockfd
,

238 
ffi
.
	`ÿ¡
("cÚ¡ sŒuù sockadd¸*", 
ş›Á_add»ss
),

239 
ffi
.(
ş›Á_add»ss
))

240 
’d


241 
rc
 ~ğ0 
th’


242 
”ºo
 = 
ffi
.
	$”ºo
()

243 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

245 
”ºo
,

246 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

247 
ffi
.
C
.
	$şo£
(
£lf
.
ş›Á_sockfd
)

248 
os
.
	$ex™
(1)

249 
’d


250 
£lf
.
pe
 = 
io¡»am
.
	$IOSŒ—m
(
£lf
.
ş›Á_sockfd
, s–f.
io_loİ
)

251 
£lf
.
pe
:
	`»ad_uÁ
("\r\n\r\n",

252 
th»ad
.
Th»ad
.
_maš_commªd_£Á
,

253 
£lf
)

254 
£lf
.
»ady_to_£nd
 = 
Œue


255 
£lf
.
io_loİ
:
	`add_ÿÎback
(
th»ad
.
Th»ad
.
_execu‹_th»ad_func
, self)

256 -- 
Chd
 
th»ad
 
wl
 
block
 
h”e
 
ªd
 
´ev’t
 
™
 
äom
 
usšg
 
the
 
Ùh”


257 -- 
IOLoİ
 
th©
 
is
 
š
 
sh¬ed
 
memÜy
.

258 
£lf
.
io_loİ
:
	$¡¬t
()

259 
’d


261 
funùiÚ
 
th»ad
.
Th»ad
:
	$_ü—‹_unix_sock
()

262 
loÿl
 
”ºo
, 
rc
, 
msg


264 
nÙ
 
£lf
.
maš_th»ad
 
th’


265 
	`”rÜ
("Can‚ot open Unix socket on child.")

266 
’d


267 
loÿl
 
£rv”_add»ss
 = 
ffi
.
	`Ãw
("struct sockaddr_un");

268 
£rv”_add»ss
.
sun_çmy
 = 
sock‘
.
AF_UNIX
;

269 
ffi
.
	`cİy
(
£rv”_add»ss
.
sun_·th
,

270 
ffi
.
	`ÿ¡
("cÚ¡ ch¬*", 
£lf
.
com_pÜt
),

271 
m©h
.
	`mš
(
£lf
.
com_pÜt
:
	`Ën
(), 
ffi
.(
£rv”_add»ss
.
sun_·th
)))

272 
£lf
.
£rv”_sockfd
 = 
ffi
.
C
.
	`sock‘
(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
, 0);

273 
£lf
.
£rv”_sockfd
 < 0 
th’


274 
	`”rÜ
("Could‚ot create Unix socket FD")

275 
’d


276 
rc
, 
msg
 = 
sock‘
.
	$£t_nÚblock_æag
(
£lf
.
£rv”_sockfd
)

277 
rc
 ~ğ0 
th’


278 
	$”rÜ
(
msg
)

279 
’d


281 
ffi
.
C
.
	`bšd
(
£lf
.
£rv”_sockfd
,

282 
ffi
.
	`ÿ¡
("¡ruù sockaddr*", 
£rv”_add»ss
),

283 
ffi
.(
£rv”_add»ss
)è~ğ0 
th’


284 
”ºo
 = 
ffi
.
	$”ºo
()

285 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

287 
”ºo
,

288 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

289 
’d


290 
ffi
.
C
.
	`li¡’
(
£lf
.
£rv”_sockfd
, 1è~ğ0 
th’


291 
”ºo
 = 
ffi
.
	$”ºo
()

292 
	`”rÜ
(
¡ršg
.
	`fÜm©
(

294 
”ºo
,

295 
fd
,

296 
sock‘
.
	$¡»¼Ü
(
”ºo
)))

297 
’d


298 
sockut
.
	$add_acû±_hªdËr
(
£lf
.
£rv”_sockfd
,

299 
th»ad
.
Th»ad
.
_chd_cÚÃùs
,

300 
£lf
.
io_loİ
,

301 
£lf
)

302 
£lf
.
»ady_to_£nd
 = 
Œue


303 
’d


305 --- 
C®Ëd
 
wh’
 
chd
 
th»ad
 
cÚÃùs
 
to
 
maš
hread.

306 
funùiÚ
 
th»ad
.
Th»ad
:
	$_chd_cÚÃùs
(
fd
)

307 
loÿl
 
pe
 = 
io¡»am
.
	$IOSŒ—m
(
fd
, 
£lf
.
io_loİ
)

308 
loÿl
 
_£lf
 = 
£lf


309 
£lf
.
pe
 =…ipe

310 
£lf
.
cÚÃùed
 = 
Œue


311 
pe
:
	`»ad_uÁ
("\r\n\r\n",

312 
th»ad
.
Th»ad
.
_chd_commªd_£Á
,

313 
£lf
)

314 
£lf
.
cÚÃù_ùx
 
th’


315 
loÿl
 
ùx
 = 
£lf
.
cÚÃù_ùx


316 
£lf
.
cÚÃù_ùx
 = 
n


317 
ùx
:
	$fš®ize_cÚ‹xt
()

318 
’d


319 
’d


321 --- 
C®Ëd
 
wh’
 
chd
 
th»ad
 
is
 
£ndšg
 
d©a
 
ov”
 
pe
.

322 
funùiÚ
 
th»ad
.
Th»ad
:
	`_d©a_£Á
(
d©a
)

323 -- 
CÚtšue
 
li¡’šg
 
Ãxt
 
commªd
.

324 
£lf
.
pe
:
	`»ad_uÁ
("\r\n\r\n",

325 
th»ad
.
Th»ad
.
_chd_commªd_£Á
,

326 
£lf
)

327 
£lf
.
d©a_ùx
 
th’


328 
loÿl
 
ùx
 = 
£lf
.
d©a_ùx


329 
£lf
.
d©a_ùx
 = 
n


330 
ùx
:
	`£t_¬gum’ts
({
çl£
, 
d©a
})

331 
ùx
:
	$fš®ize_cÚ‹xt
()

333 -- 
No
 
Úe
 
is
 
wa™šg
 
d©a
... 
StÜe
 
»c›ved
 d©¨
uÁ


334 -- 
™
 
ÿn
 
be
 
cÚsumed
 
Ü
 
disÿrded
.

335 
£lf
.
_wa™šg_d©a
 = 
d©a


336 
’d


337 
’d


339 --- 
C®Ëd
 
wh’
 
chd
 
th»ad
 
is
 
£ndšg
 
d©a
 
ov”
 
pe
.

340 
funùiÚ
 
th»ad
.
Th»ad
:
	$_chd_commªd_£Á
(
cmd
)

341 
loÿl
 
_£lf
 = 
£lf


342 
cmd
 = cmd:
	`sub
(1,4è-- 
Shave
 
off
 
CRLF


343 
cmd
 =ğ"DATA" 
th’


344 
£lf
.
pe
:
	`»ad_uÁ
("\r\n\r\n", 
	$funùiÚ
(
num_by‹s
)

345 
_£lf
.
pe
:
	`»ad_by‹s
(
	`tÚumb”
(
num_by‹s
),

346 
th»ad
.
Th»ad
.
_d©a_£Á
,

347 
_£lf
)

348 
’d
)

349 
–£if
 
cmd
 =ğ"STOP" 
th’


350 
_£lf
.
pe
:
	$şo£
()

351 
ffi
.
C
.
	$şo£
(
_£lf
.
£rv”_sockfd
)

352 
£lf
.
ruÂšg
 = 
çl£


353 -- 
CŞËù
 
th»ad
.

354 
ffi
.
C
.
	$wa™
(
n
)

355 
£lf
.
fš_ùx
 
th’


356 
loÿl
 
ùx
 = 
£lf
.
fš_ùx


357 
£lf
.
fš_ùx
 = 
n


358 
ùx
:
	$fš®ize_cÚ‹xt
()

359 
’d


360 
–£if
 
cmd
 =ğ"ERRO" 
th’


361 
£lf
.
pe
:
	`»ad_uÁ
("\r\n\r\n", 
	$funùiÚ
(
num_by‹s
)

362 
_£lf
.
pe
:
	`»ad_by‹s
(
	`tÚumb”
(
num_by‹s
),

363 
th»ad
.
Th»ad
.
_»¡Üe_coùx_w™h_”rÜ
,

364 
_£lf
)

365 
’d
)

366 
’d


367 
’d


369 --- 
C®Ëd
 
wh’
 
maš
 
th»ad
 
is
 
£ndšg
 
d©a
 
ov”
 
pe
.

370 
funùiÚ
 
th»ad
.
Th»ad
:
	$_maš_commªd_£Á
(
cmd
)

371 
loÿl
 
_£lf
 = 
£lf


372 
cmd
 = cmd:
	`sub
(1,4è-- 
Shave
 
off
 
CRLF


373 
cmd
 =ğ"DATA" 
th’


374 
£lf
.
pe
:
	`»ad_uÁ
("\r\n\r\n", 
	$funùiÚ
(
num_by‹s
)

375 
_£lf
.
pe
:
	`»ad_by‹s
(
	`tÚumb”
(
num_by‹s
),

376 
th»ad
.
Th»ad
.
_d©a_£Á
,

377 
_£lf
)

378 
’d
)

379 
–£if
 
cmd
 =ğ"STOP" 
th’


380 
£lf
.
pe
:
	$şo£
()

381 
£lf
.
io_loİ
:
	$şo£
()

382 
os
.
	$ex™
(0)

383 
’d


384 
’d


386  
th»ad


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/util.lua

1 -- 
	gTurbo
.
lua
 
Ut™›s
 
	gmoduË
.

3 -- 
	gCİyright
 2011, 2012, 2013, 2014 
John
 
	gAb¿ham£n


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

18 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

19 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

20 
loÿl
 
luasock‘


21 
nÙ
 
¶©fÜm
.
__LINUX__
 
Ü
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


22 
luasock‘
 = 
»quœe
 "socket"

23 
’d


24 
»quœe
 "turbo.cdef"

25 
loÿl
 
C
 = 
ffi
.C

27 
loÿl
 
g_time_¡r_buf
, 
	gg_time_t
, 
g_timev®


28 
	g¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
	g_G
.
__TURBO_USE_LUASOCKET__
 
th’


29 
	gg_time_¡r_buf
 = 
ffi
.
Ãw
("char[1024]")

30 
g_time_t
 = 
ffi
.
Ãw
("time_t[1]")

31 
g_timev®
 = 
ffi
.
Ãw
("structimeval")

32 
’d


34 
loÿl
 
ut
 = {}

37 --- 
S¶™
 
¡ršg
 
što
 
bË
.

38 
funùiÚ
 
ut
.
	$¡r¥l™
(
¡r
, 
£p
, 
max
, 
·‰”n
)

39 
	`as£¹
(
£p
 ~= '', "Separator is‚ot‡ string or‡ƒmpty string.")

40 
	`as£¹
(
max
 =ğ
n
 
Ü
 max >= 1, "Max is 0 or‡‚egative‚umber.")

42 
loÿl
 
»cÜd
 = {
	}
}

43 
¡r
:
Ën
(è> 0 
th’


44 
loÿl
 
¶aš
 = 
nÙ
 
·‰”n


45 
max
 = max 
Ü
 -1

46 
loÿl
 
f›ld
=1 
¡¬t
=1

47 
loÿl
 
fœ¡
, 
	gÏ¡
 = 
¡r
:
	$fšd
(
£p
, 
¡¬t
, 
¶aš
)

48 
fœ¡
 
ªd
 
max
 ~= 0 do

49 
»cÜd
[
f›ld
] = 
¡r
:
	`sub
(
¡¬t
, 
fœ¡
-1)

50 
f›ld
 = field+1

51 
¡¬t
 = 
Ï¡
+1

52 
fœ¡
, 
Ï¡
 = 
¡r
:
	$fšd
(
£p
, 
¡¬t
, 
¶aš
)

53 
max
 = max-1

54 
’d


55 
»cÜd
[
f›ld
] = 
¡r
:
	$sub
(
¡¬t
)

56 
’d


57  
»cÜd


58 
’d


60 -- 
SŒ
 
wh™e
 
¥aû
 
äom
 
sides
 
of
 
a
 
¡ršg


61 
funùiÚ
 
ut
.
	$¡r¡r
(
¡r
)

62  
¡r
:
	`m©ch
("^%s*(.-)%s*$")

63 
’d


65 --- 
C»©e
 
sub¡ršg
 
äom
.

66 -- 
Bew¬e
 
th©
 
šdex
 
¡¬ts
 
©
 0.

67 -- @
·¿m
 
äom
 
From
 
šdex
, 
ÿn
 
be
 
n
 
to
 
šdiÿ‹
 
¡¬t
.

68 -- @
·¿m
 
to
 
To
 
šdex
, 
ÿn
 
be
 
n
Ø
šdiÿ‹
 
’d
.

69 -- @ 
¡ršg


70 
funùiÚ
 
ut
.
	$¡rsub¡r
(
¡r
, 
äom
, 
to
)

71 
loÿl
 
Ën
 = 
¡r
:
	$Ën
()

72 
äom
 = from 
Ü
 0

73 
to
 =Ø
Ü
 
Ën


74 
	`as£¹
(
äom
 < 
Ën
, "From out of„ange.")

75 
	`as£¹
(
to
 <ğ
Ën
, "To out of„ange.")

76 
	`as£¹
(
äom
 < 
to
, "From greaterhano.")

77 
loÿl
 
±r
 = 
ffi
.
	`ÿ¡
("ch¬ *", 
¡r
)

78  
ffi
.
	`¡ršg
(
±r
 + 
äom
, 
to
 - from)

79 
’d


81 --- 
C»©e
 
a
 
¿ndom
 
¡ršg
.

82 
funùiÚ
 
ut
.
	$¿nd_¡r
(
Ën
)

83 
m©h
.
	`¿ndom£ed
(
ut
.
	`g‘timeofday
()+m©h.
	$¿ndom
(0x0,0xffffffff))

84 
Ën
 =†’ 
Ü
 64

85 
loÿl
 
by‹s
 = 
	$bufãr
(
Ën
)

86 
i
 = 1, 
Ën
 do

87 
by‹s
:
	`­³nd_ch¬_right
(
ffi
.
	`ÿ¡
("ch¬", 
m©h
.
	$¿ndom
(0x0, 0x80)))

88 
’d


89 
by‹s
 = 
	$to¡ršg
(
by‹s
)

90  
by‹s


91 
’d


94 --*************** 
TabË
 
ut™es
 ***************

96 --- 
M”ge
 
two
 
bËs
 
to
 
Úe
.

97 
funùiÚ
 
ut
.
	$bËm”ge
(
t1
, 
t2
)

98 
k
, 
v
 
š
 
	$·œs
(
t2
) do

99 ià(
	`ty³
(
v
è=ğ"bË"è
	`ªd
 (ty³(
t1
[
k
] 
Ü
 
çl£
è=ğ"bË"è
th’


100 
ut
.
	$bËm”ge
(
t1
[
k
], 
t2
[k])

102 
t1
[
k
] = 
v


103 
’d


104 
’d


105  
t1


106 
’d


108 --- 
Još
 
a
 
li¡
 
što
‡ 
¡ršg
 
w™h
 
giv’
 
d–im™”
.

109 
funùiÚ
 
ut
.
	$još
(
d–im™”
, 
li¡
)

110 
loÿl
 
Ën
 = #list

111 
Ën
 =ğ0 
th’


113 
’d


114 
loÿl
 
¡ršg
 = 
li¡
[1]

115 
i
 = 2, 
Ën
 do

116 
¡ršg
 = sŒšg .. 
d–im™”
 .. 
li¡
[
i
]

117 
’d


118  
¡ršg


119 
’d


121 --- 
R‘uºs
 
Œue
 
v®ue
 
exi¡s
 
š
 
bË
.

122 
funùiÚ
 
ut
.
	$is_š
(
ÃedË
, 
hay¡ack
)

123 
nÙ
 
ÃedË
 
Ü
‚Ù 
hay¡ack
 
th’


124  
n


125 
’d


126 
loÿl
 
i


127 
i
 = 1, #haystack, 1 do

128 
ÃedË
 =ğ
hay¡ack
[
i
] 
th’


129  
Œue


130 
’d


131 
’d


133 
’d


135 --- 
uÅack
 
th©
 
dÛs
 
nÙ
 
ÿu£
 
Œaû
 
abÜt
.

136 -- 
May
 
nÙ
 
be
 
v”y
 
ç¡
 
Ïrge
 
bËs
 
¬e
 
uÅacked
.

137 
funùiÚ
 
ut
.
	$fuÅack
(
t
, 
i
)

138 
i
 = i 
Ü
 1

139 
t
[
i
] ~ğ
n
 
th’


140  
t
[
i
], 
ut
.
	`fuÅack
(t, i + 1)

141 
’d


142 
’d


145 --*************** 
Time
 
ªd
 
d©e
 ***************

147 --- 
Cu¼’t
 
m£cs
 
sšû
 
•och
. 
B‘‹r
 
g¿nuÏr™y
 
thª
 
Lua
 
butš
.

148 -- @ 
Numb”


149 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


150 
funùiÚ
 
ut
.
	$g‘timeofday
()

151 
C
.
	$g‘timeofday
(
g_timev®
, 
n
)

152  (
	`tÚumb”
((
g_timev®
.
tv_£c
 * 1000)+

153 (
g_timev®
.
tv_u£c
 / 1000)))

154 
’d


156 
funùiÚ
 
ut
.
	$g‘timeofday
()

157  
m©h
.
	`û
(
luasock‘
.
	`g‘time
() * 1000)

158 
’d


159 
’d


161 
loÿl
 
¹_suµÜt
, 
¹
 = 
	`pÿÎ
(
ffi
.
lßd
, "rt")

162 
nÙ
 
¹_suµÜt
 
Ü
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


163 
ut
.
g‘timemÚÙÚic
 = ut.
g‘timeofday


165 
loÿl
 
ts
 = 
ffi
.
	`Ãw
("structimespec")

166 -- 
Cu¼’t
 
m£cs
 
sšû
 
¬b™¿ry
 
¡¬t
 
pošt
, 
dÛ¢
't jump dueo

167 -- 
time
 
chªges


168 -- @ 
Numb”


169 
funùiÚ
 
ut
.
	$g‘timemÚÙÚic
()

170 
¹
.
	$şock_g‘time
(
¹
.
CLOCK_MONOTONIC
, 
ts
)

171  (
	`tÚumb”
((
ts
.
tv_£c
*1000)+Ñs.
tv_n£c
/1000000)))

172 
’d


173 
’d


174 
’d


176 --- 
C»©e
 
a
 
time
 
¡ršg
 
u£d
 
š
 
HTTP
 
cook›s
.

178 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


179 
funùiÚ
 
ut
.
	$time_fÜm©_cook›
(
•och
)

180 
g_time_t
[0] = 
•och


181 
loÿl
 
tm
 = 
C
.
	$gmtime
(
g_time_t
)

182 
loÿl
 
sz
 = 
C
.
	`¡ráime
(

183 
g_time_¡r_buf
,

186 
tm
)

187  
ffi
.
	$¡ršg
(
g_time_¡r_buf
, 
sz
)

188 
’d


190 
funùiÚ
 
ut
.
	$time_fÜm©_cook›
(
time
)

191  
os
.
	`d©e
(

193 
time
)

194 
’d


195 
’d


197 
¶©fÜm
.
__LINUX__
 
ªd
 
nÙ
 
_G
.
__TURBO_USE_LUASOCKET__
 
th’


198 --- 
C»©e
 
a
 
time
 
¡ršg
 
u£d
 
š
 
HTTP
 
h—d”
 
f›lds
.

200 
funùiÚ
 
ut
.
	$time_fÜm©_h‰p_h—d”
(
time_t
)

201 
g_time_t
[0] = 
time_t
 / 1000

202 
loÿl
 
tm
 = 
C
.
	$gmtime
(
g_time_t
)

203 
loÿl
 
sz
 = 
C
.
	`¡ráime
(

204 
g_time_¡r_buf
,

207 
tm
)

208  
ffi
.
	$¡ršg
(
g_time_¡r_buf
, 
sz
)

209 
’d


211 
funùiÚ
 
ut
.
	$time_fÜm©_h‰p_h—d”
(
time
)

212  
os
.
	`d©e
(

214 
time
 / 1000)

215 
’d


216 
’d


218 --*************** 
Fe
 ***************

220 --- 
Check
 
fe
 
exi¡s
 
Ú
 
loÿl
 
fesy¡em
.

221 -- @
·¿m
 
·th
 
FuÎ
…©h 
to
 
fe


222 -- @ 
True
 
Ü
 
çl£
.

223 
funùiÚ
 
ut
.
	$fe_exi¡s
(
·th
)

224 
loÿl
 
f
 = 
io
.
	`İ’
(
·th
, "r")

225 
f
 ~ğ
n
 
th’


226 
io
.
	$şo£
(
f
)

227  
Œue


229  
çl£


230 
’d


231 
’d


233 
funùiÚ
 
ut
.
	$»ad_®l
(
fe
)

234 
loÿl
 
f
 = 
io
.
	`İ’
(
fe
, "rb")

235 
	`as£¹
(
f
, "Could‚Ù o³Àf" .. 
fe
 .. " for„eading.")

236 
loÿl
 
cÚ‹Á
 = 
f
:
	`»ad
("*all")

237 
f
:
	$şo£
()

238  
cÚ‹Á


239 
’d


242 --******** 
Low
-
Ëv–
 
bufãr
 
£¬ch
 *********

244 -- 
Fa¡
 
¡ršg
 
agno¡ic
 
com·risÚ


245 
funùiÚ
 
ut
.
	$¡rÿ£cmp
(
¡r1
, 
¡r2
)

246  
	`tÚumb”
(
ffi
.
C
.
	$¡rÿ£cmp
(
¡r1
, 
¡r2
))

247 
’d


249 --- 
Fšd
 
sub¡ršg
 
š
 
memÜy
 
¡ršg
.

250 -- 
Ba£d
 
Ú
 
lj_¡r_fšd
 
š
 
lj_¡r
.
c
 iÀ
LuaJIT
 
by
 
Mike
 
P®l
.

251 
funùiÚ
 
ut
.
	$¡r_fšd
(
s
, 
p
, 
¦’
, 
¶’
)

252 
¶’
 <ğ
¦’
 
th’


253 
¶’
 =ğ0 
th’


254  
s


256 
loÿl
 
c
 = 
ffi
.
	`ÿ¡
("št", 
p
[0])

257 
p
 =… + 1

258 
¶’
 =…len - 1

259 
¦’
 = sËÀ- 
¶’


260 
loÿl
 
q


261 
¦’
 > 0 do

262 
q
 = 
ffi
.
	`ÿ¡
("ch¬*", 
C
.
	$memchr
(
s
, 
c
, 
¦’
))

263 
q
 =ğ
n
 
th’


265 
’d


266 
C
.
	`memcmp
(
q
 + 1, 
p
, 
¶’
è=ğ0 
th’


267  
q


268 
’d


269 
q
 = q + 1

270 
¦’
 = sËÀ- (
q
 - 
s
)

271 
s
 = 
q


272 
’d


273 
’d


274 
’d


275 
’d


277 --- 
Turbo
 
Booy”
-
MoÜe
 
memÜy
 
£¬ch
 
®gÜ™hm
.

278 -- 
DEPRECATED
 
as
 
of
 
v
.1.1.

279 -- @
·¿m
 
x
 * 
N“dË
 
memÜy
 
poš‹r


280 -- @
·¿m
 
m
 
N“dË
 
size


281 -- @
·¿m
 
y
 * 
Hay¡ack
 
memÜy
 
poš‹r


282 -- @
·¿m
 
n
 
Hay¡ack
 
size
.

283 
funùiÚ
 
ut
.
	$TBM
(
x
, 
m
, 
y
, 
n
)

284 
log
.
	`w¬nšg
("turbo.util.TBM is deprecated.")

285  
ut
.
	$¡r_fšd
(
y
, 
x
, 
n
, 
m
)

286 
’d


288 --- 
CÚv”t
 
numb”
 
v®ue
 
to
 
hexadecim®
 
¡ršg
 
fÜm©
.

289 -- @
·¿m
 
num
 
The
 
numb”
 
to
 
cÚv”t
.

290 -- @ 
SŒšg


291 
funùiÚ
 
ut
.
	$hex
(
num
)

292 
loÿl
 
hex¡r
 = '0123456789abcdef'

293 
loÿl
 
s
 = ''

294 
num
 > 0 do

295 
loÿl
 
mod
 = 
m©h
.
	$fmod
(
num
, 16)

296 
s
 = 
¡ršg
.
	`sub
(
hex¡r
, 
mod
+1, mod+1) .. s

297 
num
 = 
m©h
.
	`æoÜ
(num / 16)

298 
’d


299 
s
 =ğ'' 
th’


300 
s
 = '0'

301 
’d


302  
s


303 
’d


304 
loÿl
 
hex
 = 
ut
.hex

306 --- 
Dump
 
memÜy
 
»giÚ
 
to
 
¡dout
, 
äom
 
±r
Ø
giv’
 
size
. 
U£fuÎ
 

307 -- 
debuggšg
 
Luaj™
 
FFI
. 
NÙiû
! 
This
 
ÿn
 
ªd
 
wl
 
ÿu£
 
a
 
SIGSEGV
 

308 -- 
nÙ
 
bešg
 
u£d
 
Ú
 
v®id
 
poš‹rs
.

309 -- @
·¿m
 
±r
 
A
 
cd©a
 
	`poš‹r
 (
äom
 
FFI
)

310 -- @
·¿m
 
	$sz
 (
Numb”
è
L’gth
 
to
 
dump
 
cÚ‹Ás
 .

311 
funùiÚ
 
ut
.
	$mem_dump
(
±r
, 
sz
)

312 
loÿl
 
void±r
 = 
ffi
.
	`ÿ¡
("unsigÃd ch¬ *", 
±r
)

313 
nÙ
 
void±r
 
th’


314 
	`”rÜ
("Tryingo dump‚ull…tr")

315 
’d


317 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
("Pointerype: %s\
 memory†ocation: 0x%s dumping %d bytes\n",

319 
ffi
.
	`ty³of
(
±r
),

320 
	`hex
(
	`tÚumb”
(
ffi
.
	`ÿ¡
("šŒ_t", 
void±r
))),

321 
sz
))

322 
loÿl
 
p
 = 0;

323 
loÿl
 
sz_ba£_1
 = 
sz
 - 1

324 
i
 = 0, 
sz_ba£_1
 do

325 ià(
p
 =ğ10è
th’


326 
p
 = 0

327 
io
.
	`wr™e
("\n")

328 
’d


329 
loÿl
 
hex_¡ršg


330 ià(
void±r
[
i
] < 0xfè
th’


331 
hex_¡ršg
 = 
¡ršg
.
	`fÜm©
("0x0% ", 
	$hex
(
void±r
[
i
]))

333 
hex_¡ršg
 = 
¡ršg
.
	`fÜm©
("0x% ", 
	$hex
(
void±r
[
i
]))

334 
’d


335 
io
.
	$wr™e
(
hex_¡ršg
)

336 
p
 =… + 1

337 
’d


338 
io
.
	`wr™e
("\n")

339 
’d


341 --- 
Lßds
 
dyÇmic
 
lib¿ry
 
w™h
 
h–³r
 
funùiÚs
 
Ü
 
bas
 
out
 w™h 
”rÜ
.

342 -- @
·¿m
 
Çme
 
Cu¡om
 
lib¿ry
‚am
Ü
 
·th


343 
funùiÚ
 
ut
.
	$lßd_libtffi
(
Çme
)

344 
loÿl
 
have_Çme
 = 
Çme
 
ªd
 
Œue
 
Ü
 
çl£


345 
Çme
 =‚am
Ü
 
os
.
	`g‘’v
("TURBO_LIBTFFI") or "libtffi_wrap"

346 
loÿl
 
ok
, 
lib
 = 
	$pÿÎ
(
ffi
.
lßd
, 
Çme
)

347 
nÙ
 
ok
 
th’


348 -- 
Try
 
the
 
Şd
 
lßdšg
 
m‘hod
 
which
 
wÜks
 
some
 
Lšux
 
di¡ros
.

349 -- 
But
 
Úly
 
Çme
 
is
 
nÙ
 
giv’
 
as
 
¬gum’t
.

350 
nÙ
 
have_Çme
 
th’


351 
ok
, 
lib
 = 
	`pÿÎ
(
ffi
.
lßd
, "/usr/local/lib/libtffi_wrap.so")

352 
’d


353 
nÙ
 
ok
 
th’


354 -- 
Stl
 
nÙ
 
OK
...

355 
	`”rÜ
("Could‚Ù†ßd " .. 
Çme
 .. " \
„un makefile‡ndƒnsurehat installation is done correct.")

357 
’d


358 
’d


359  
lib


360 
’d


362  
ut


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/web.lua

1 --- 
	gTurbo
.
lua
 
Web
 
F¿mewÜk
 
	gmoduË
.

2 -- 
API
 
asynchrÚous
 
web
 
	g£rviûs
.

4 -- 
The
 
	gTurbo
.
lua
 
Web
 
äamewÜk
 
is
 
mod–ed
 
aá”
 
the
 f¿mewÜk 
ofã»d
 
	gby


5 -- 
	gTÜÇdo
, 
which
 
agaš
 
is
 
ba£d
 
Ú
 
	gweb
.
py
 (
h‰p
:

6 -- 
GoogË
's webapp (http://code.google.com/appengine/docs/python/tools/webapp/)

7 -- 
Some
 
modifiÿtiÚs
 
has
 
b“n
 
made
 
to
 
make
 
™
 
f™
 
b‘‹r
 
što
 
the
 
Lua


8 -- 
eco
 
sy¡em
.

10 -- 
Cİyright
 2011, 2012, 2013 
John
 
Ab¿ham£n


12 -- 
Liûn£d
 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

13 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

14 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


16 -- 
h‰p
:

18 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


19 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
ª
 "AS IS" 
BASIS
,

20 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

21 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


22 -- 
lim™©iÚs
 
und”
 
the
 
Liûn£
.

24 
loÿl
 
ffi
 = 
»quœe
 "ffi"

25 
loÿl
 
log
 = 
»quœe
 "turbo.log"

26 
loÿl
 
h‰put
 = 
»quœe
 "turbo.httputil"

27 
loÿl
 
h‰p£rv”
 = 
»quœe
 "turbo.httpserver"

28 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

29 
loÿl
 
bufã½Œ
 = 
»quœe
 "turbo.structs.bufferptr"

30 
loÿl
 
esÿ³
 = 
»quœe
 "turbo.escape"

31 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

32 
loÿl
 
»¥Ú£_codes
 = 
»quœe
 "turbo.http_response_codes"

33 
loÿl
 
mime_ty³s
 = 
»quœe
 "turbo.mime_types"

34 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

35 
loÿl
 
hash
 = 
»quœe
 "turbo.hash"

36 
loÿl
 
sock‘
 = 
»quœe
 "turbo.socket_ffi"

37 
loÿl
 
sysÿÎ
 = 
»quœe
 "turbo.syscall"

38 
loÿl
 
fs


39 
¶©fÜm
.
__WINDOWS__
 
th’


40 -- 
SuµÜt
 
¡©
'ing in StaticFileHandler on Windows OS.

41 
fs
 = 
»quœe
 "lfs"

43 
fs
 = 
»quœe
 "turbo.fs"

44 
’d


45 
»quœe
 "turbo.3rdparty.middleclass"

46 
»quœe
 "turbo.cdef"

48 -- 
U£
 
fuÅack
 
š¡—d
 
of
 
Çtive
 
as
 
the
‚©iv
is
 
nÙ
 
im¶em’‹d
 
š
he

49 -- 
LuaJIT
 
comp”
. 
T¿ûs
 
abÜt
 
š
 
a
 
bad
 
¥Ù
 
nÙ
 
u£d
.

50 
loÿl
 
uÅack
 = 
ut
.
fuÅack


51 
loÿl
 
is_š
 = 
ut
.is_in

52 
loÿl
 
_¡d_suµÜ‹d_m‘
 = {"GET", "HEAD", "POST", "DELETE", "PUT", "OPTIONS"}

53 
loÿl
 
_s¦_’abËd
 = 
_G
.
TURBO_SSL


55 
loÿl
 
web
 = {} -- web 
Çme¥aû


56 
web
.
Mu¡ache
 = 
»quœe
 "turbo.mu¡ache" -- 
šşude
 
the
 Mu¡ach
‹m¶©”
.

58 --- 
Ba£
 
Reque¡HªdËr
 
şass
. 
The
 
h—¹
 
of
 
Turbo
.
lua
.

59 -- 
The
 
usu®
 
æow
 
of
 
usšg
 
Turbo
.
lua
 
is
 
sub
-
şassšg
 
the
 
Reque¡HªdËr


60 -- 
şass
 
ªd
 
im¶em’tšg
 
the
 
HTTP
 
»que¡
 
m‘hods
 
desüibed
 
š


61 -- 
£lf
.
SUPPORTED_METHODS
. 
The
 
maš
 
gßl
 
of
 
this
 
şass
 
is
 
to
 
w¿p
 
a
 
HTTP


62 -- 
»que¡
 
ªd
 
ofãr
 
ut™›s
 
to
 
»¥Úd
Ø
the
„eque¡. 
Reque¡s
 
¬e


63 -- 
d–ig©ed
 
to
 
Reque¡HªdËr
's byhe Application class.

64 
web
.
Reque¡HªdËr
 = 
şass
("RequestHandler")

66 --- 
In™Ÿlize
 
a
 
Ãw
 
Reque¡HªdËr
 
şass
 
š¡ªû
.

67 -- 
NÜm®ly
 
a
 
u£r
 
is
 
nÙ
 
the
 
Úe
 
to
 
š™Ÿlize
 
this
, 
but
 
¿th”
‡ 
AµliÿtiÚ


68 -- 
şass
 
š¡ªû
 
which
 
has
 
»ûive
 
a
 
HTTP
 
»que¡
. 
NÜm®
 
th”e
 
should
 
nÙ
 
be


69 -- 
a
 
Ãed
 
you
 
to
 
»defše
 
this
 
š™Ÿliz”
, 
š¡—d
 
look
 
©
 
the
 
difã»Á


70 -- 
’Œy
 
pošts
 
giv’
 
lÚg”
 
down
.

71 -- @
·¿m
 
	$­¶iÿtiÚ
 (
AµliÿtiÚ
 
š¡ªû
è
The
 
ÿÎšg
 
­¶iÿtiÚ
 
should


72 -- 
Ëave
 
a
 
£lf
 
»ã»nû
.

73 -- @
·¿m
 
	$»que¡
 (
HTTPReque¡
 
š¡ªû
è
The
 
»que¡
.

74 -- @
·¿m
 
	$u¾_¬gs
 (
TabË
èTabË 
of
 
¬gum’ts
 
to
 
ÿÎ
 
m©chšg
 
m‘hod
 
w™h
.

75 -- 
The£
 
¬gum’ts
 
¬e
 
nÜm®ly
 
ÿ±u»d
 
by
 
the
 
·‰”n
 
giv’
 
Ú
 
š™Ÿlizšg


76 -- 
of
 
a
 
AµliÿtiÚ
 
şass
.

77 -- @
·¿m
 
	`İtiÚs
 (
TabË
è3
rd
 
¬gum’t
 
giv’
 
š
 
AµliÿtiÚ
 
şass
 
rou‹
 
bË
.

78 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$š™Ÿlize
(
­¶iÿtiÚ
, 
»que¡
, 
u¾_¬gs
, 
İtiÚs
)

79 
£lf
.
SUPPORTED_METHODS
 = 
_¡d_suµÜ‹d_m‘


80 
£lf
.
­¶iÿtiÚ
 =‡pplication

81 
£lf
.
»que¡
 =„equest

82 
£lf
.
_h—d”s_wr™‹n
 = 
çl£


83 
£lf
.
_fšished
 = 
çl£


84 
£lf
.
_auto_fšish
 = 
Œue


85 
£lf
.
_u¾_¬gs
 = 
u¾_¬gs


86 
£lf
.
_£t_cook›
 = {
	}
}

87 -- 
S‘
 
¡ªd¬d
 
h—d”s
 
by
 
ÿÎšg
 
the
 
ş—r
 
m‘hod
.

88 
£lf
:
	$ş—r
()

89 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("CÚÃùiÚ"è
th’


90 
£lf
.
»que¡
.
cÚÃùiÚ
.
¡»am
:
	$£t_şo£_ÿÎback
(

91 
£lf
.
Ú_cÚÃùiÚ_şo£
,

92 
£lf
)

93 
’d


94 
£lf
.
İtiÚs
 = options

95 
£lf
:
	$Ú_ü—‹
(
£lf
.
İtiÚs
)

96 
’d


98 --- 
G‘
 
the
 
­¶iÿtiÚs
 
£‰šgs
.

99 -- @ 
AµliÿtiÚs
 
£‰šgs
.

100 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£‰šgs
(è 
£lf
.
­¶iÿtiÚ
.
£‰šgs
 
’d


102 --*************** 
EÁry
 
pošts
 ***************

104 --- 
Redefše
 
this
 
m‘hod
 
you
 
wªt
 
to
 dØ
som‘hšg
 
aá”
 
the
 
şass
 
has
 
b“n


105 -- 
š™Ÿlized
. 
This
 
m‘hod
 
uÆike
 
Ú_ü—‹
, 
is
 
Úly
 
ÿÎed
 
the
 m‘hod 
has


106 -- 
b“n
 
found
 
to
 
be
 
suµÜ‹d
.

107 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$´•¬e
(è
’d


109 --- 
Redefše
 
this
 
m‘hod
 
you
 
wªt
 
to
 dØ
som‘hšg
 
¡¿ight
 
aá”
 
the
 
şass


110 -- 
has
 
b“n
 
š™Ÿlized
. 
This
 
is
 
ÿÎed
 
aá”
 
a
 
»que¡
 has been

111 -- 
»ûive
, 
ªd
 
befÜe
 
the
 
HTTP
 
m‘hod
 
has
 
b“n
 
v”if›d
 
agaš¡
 
suµÜ‹d


112 -- 
m‘hods
. 
So
 
a
 
nÙ
 
suµÜ‹d
 
m‘hod
 
is
 
»que¡ed
, 
this
 m‘hod i 
¡l


113 -- 
ÿÎed
.

114 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$Ú_ü—‹
(
kw¬gs
è
’d


116 --- 
Redefše
 
this
 
m‘hod
 
aá”
 
your
 
likšgs
. 
C®Ëd
‡á” 
the
 
’d
 
of
 
a
 
»que¡
.

117 -- 
U§ge
 
of
 
this
 
m‘hod
 
could
 
be
 
som‘hšg
 
like
 
a
 
ş—n
 
up
 
‘c
.

118 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$Ú_fšish
(è
’d


120 --- 
Redefše
 
this
 
m‘hod
 
to
 
£t
 
HTTP
 
h—d”s
 
©
 
the
 
begšnšg
 
of
 
®l
he

121 -- 
»que¡
 
»ûive
 
by
 
the
 
Reque¡HªdËr
. 
FÜ
 
exam¶e
 
£‰šg
 
some
 
kšd


122 -- 
of
 
cook›
 
Ü
 
adju¡šg
 
the
 
S”v”
 
key
 
š
h
h—d”s
 
would
 
be
 
£nsibË


123 -- 
to
 dØ
š
 
this
 
m‘hod
.

124 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£t_deçuÉ_h—d”s
(è
’d


126 --- 
Snd¬d
 
m‘hods
 
Reque¡HªdËr
 
şass
.

127 -- 
Subşass
 
Reque¡HªdËr
 
ªd
 
im¶em’t
 
ªy
 
of
 
the
 
fŞlowšg
 
m‘hods
 
to
 
hªdË


128 -- 
the
 
cÜ»¥Údšg
 
HTTP
 
»que¡
.

129 -- 
If
 
nÙ
 
im¶em’‹d
 
they
 
wl
 
´ovide
 
a
 405 (
M‘hod
 
NÙ
 
AÎowed
).

130 -- 
The£
 
m‘hods
 
»ûive
 
v¬ŸbË
 
¬gum’ts
, 
d•’dšg
 
Ú
 
wh©
 
the
 
AµliÿtiÚ


131 -- 
š¡ªû
 
ÿÎšg
 
them
 
has
 
ÿ±u»d
 
äom
 
the
 
·‰”n
 
m©chšg
 
of
h
»que¡


132 -- 
URL
. 
The
 
m‘hods
 
¬e
 
run
 
´Ùeùed
, 
so
 
they
‡» 
”rÜ
 
§ã
. 
Wh’
 
a
ƒrror

133 -- 
occurs
 
š
 
the
 
executiÚ
 
of
 
the£
 
m‘hods
h
»que¡
 
is
 
giv’
 
a


134 -- 500 
IÁ”Çl
 
S”v”
 
E¼Ü
 
»¥Ú£
. 
In
 
debug
 
mode
, 
the
 
¡ack
 
Œaû
 
Ëadšg


135 -- 
to
 
the
 
üash
 
is
 
®so
 
a
 
·¹
 
of
h
»¥Ú£
. 
If
 
nÙ
 
debug
 
mode
 i 
£t
, 
th’


136 -- 
Úly
 
the
 
¡©us
 
code
 
is
 
£t
.

137 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$h—d
(...è
	`”rÜ
(
web
.
HTTPE¼Ü
:
	$Ãw
(405)è
’d


138 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘
(...è
	`”rÜ
(
web
.
HTTPE¼Ü
:
	$Ãw
(405)è
’d


139 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$po¡
(...è
	`”rÜ
(
web
.
HTTPE¼Ü
:
	$Ãw
(405)è
’d


140 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$d–‘e
(...è
	`”rÜ
(
web
.
HTTPE¼Ü
:
	$Ãw
(405)è
’d


141 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$put
(...è
	`”rÜ
(
web
.
HTTPE¼Ü
:
	$Ãw
(405)è
’d


142 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$İtiÚs
(...è
	`”rÜ
(
web
.
HTTPE¼Ü
:
	$Ãw
(405)è
’d


144 --*************** 
IÅut
 ***************

146 --- 
R‘uºs
 
the
 
v®ue
 
of
h
¬gum’t
 
w™h
h
giv’
 
Çme
.

147 -- 
If
 
muÉË
 
v®ues
 
¬e
 
£t
 
w™h
 
the
 
§me
 
Çme
, 
th’
 
Úly
 
Úe
 
is
 
»tuºed
.

148 -- 
FÜ
 
muÉË
 
¬gum’ts
, 
u£
 
	$g‘_¬gum’ts
(è
š¡—d
.

149 -- 
If
  
v®ue
 
is
 
nÙ
 
giv’
 
the
 
¬gum’t
 i 
cÚsid”ed
 
to
 
be
 
»quœed
 
ªd


150 -- 
wl
 
»suÉ
 
š
 
a
 
¿i£
 
of
‡ 
HTTPE¼Ü
 400 
Bad
 
Reque¡
 
the
 
¬gum’t
 
dÛs


151 -- 
nÙ
 
exi¡
.

152 -- @
·¿m
 
	$Çme
 (
SŒšg
è
Name
 
of
 
the
 
¬gum’t
 
to
 
g‘
.

153 -- @
·¿m
  (
SŒšg
è
O±iÚ®
 
çÎback
 
v®ue
 
š
 
¬gum’t
 
is
 
nÙ
 
£t
.

154 -- @
·¿m
 
	$¡r
 (
BoŞ—n
è
Remove
 
wh™e¥aû
 
äom
 
h—d
 
ªd
 

 
of
 
¡ršg
.

155 -- @ 
V®ue
 
of
 
¬gum’t
 
£t
.

156 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘_¬gum’t
(
Çme
, , 
¡r
)

157 
loÿl
 
¬gs
 = 
£lf
:
	$g‘_¬gum’ts
(
Çme
, 
¡r
)

158 
loÿl
 
t
 = 
	$ty³
(
¬gs
)

159 
t
 =ğ"¡ršg" 
th’


160  
¬gs


161 
–£if
 
t
 =ğ"bË" 
th’


162 -- 
fÜm
-
d©a
 
¬gum’ts
 
¬e
 
w¿µed
 
š
 
ª
 
add™iÚ®
 
bË


163 -- 
š
 
Üd”
 
to
 
assocŸ‹
 
theœ
 
f›lds
 
ªd
 
cÚ‹Á
-
di¥os™iÚ


164 -- 
·¿m‘”s
 
w™h
 
the
 
¬gum’t


165 
	`ty³
(
¬gs
[1]è=ğ"bË" 
th’


166  
¬gs
[1][1]

167 
’d


168  
¬gs
[1]

169 
–£if
  ~ğ
n
 
th’


172 
	`”rÜ
(
web
.
HTTPE¼Ü
:
	`Ãw
(400, "Missing„equired‡rgument."))

173 
’d


174 
’d


176 --- 
R‘uºs
 
the
 
v®ues
 
of
h
¬gum’t
 
w™h
h
giv’
 
Çme
.

177 -- 
Wl
  
a
 
em±y
 
bË
 
¬gum’t
 
dÛs
 
nÙ
 
exi¡
.

178 -- @
·¿m
 
	$Çme
 (
SŒšg
è
Name
 
of
 
the
 
¬gum’t
 
to
 
g‘
.

179 -- @
·¿m
 
	$¡r
 (
BoŞ—n
è
Remove
 
wh™e¥aû
 
äom
 
h—d
 
ªd
 

 
of
 
¡ršg
.

180 -- @ (
TabË
è
Argum’t
 
v®ues
.

181 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘_¬gum’ts
(
Çme
, 
¡r
)

182 
loÿl
 
v®ues


183 
loÿl
 
n
 = 0

184 
loÿl
 
u¾_¬gs
 = 
£lf
.
»que¡
.
¬gum’ts


185 
loÿl
 
fÜm_¬gs
 = 
£lf
.
»que¡
.
cÚÃùiÚ
.
¬gum’ts


187 -- 
Combše
 
¬gum’t
 
li¡s
 
äom
 
HTTPCÚÃùiÚ
 
ªd
 
HTTPReque¡
.

188 
nÙ
 
u¾_¬gs
 
ªd
‚Ù 
fÜm_¬gs
 
th’


190 
’d


191 
u¾_¬gs
 
ªd
 u¾_¬gs[
Çme
] 
th’


192 
v®ues
 = 
u¾_¬gs
[
Çme
]

193 
	`ty³
(
v®ues
è=ğ"bË" 
th’


194 
n
 = #values

196 
n
 = 1

197 
’d


198 
’d


199 
fÜm_¬gs
 
ªd
 fÜm_¬gs[
Çme
] 
th’


200 
n
 =ğ0 
th’


201 
v®ues
 = 
fÜm_¬gs
[
Çme
]

202 
–£if
 
n
 > 0 
th’


203 
n
 =ğ1 
th’


204 
v®ues
 = {
	}
values}

205 
’d


206 
i
 = 1, #fÜm_¬gs[
Çme
] do

207 
v®ues
[#v®ues+1] = 
fÜm_¬gs
[
Çme
][
i
]

208 
’d


209 
’d


210 
’d


211 
¡r
 
th’


212 
ty³
(
v®ues
è=ğ"¡ršg" 
th’


213 
v®ues
 = 
esÿ³
.
	$Œim
(
v®ues
)

214 
–£if
 
	`ty³
(
v®ues
è=ğ"bË" 
ªd
 
nÙ
y³(v®ues[
i
]è=ğ"bË" 
th’


215 
i
 = 1, #values do

216 
v®ues
[
i
] = 
esÿ³
.
	$Œim
(
v®ues
[
i
])

217 
’d


218 
’d


219 
’d


220  
v®ues


221 
’d


223 --- 
R‘uºs
 
JSON
 
»que¡
 
d©a
 
as
 
a
 
bË
. 
By
 , 
™
 
Úly
 
·r£s
 
jsÚ


224 -- 
mim‘y³
. 
It
 
wl
  
ª
 
em±y
 
bË
 
»que¡
 
d©a
 
is
ƒmpty.

225 -- @
·¿m
 
	$fÜû
 (
BoŞ—n
è
£t
 
to
 
Œue
, 
mim‘y³
 
wl
 
be
 
ignÜed
.

226 -- @ (
TabË
è
·r£d
 
äom
 
»que¡
 
d©a
,  
n
 
mim‘y³
 
is
 
nÙ


227 -- 
jsÚ
 
ªd
 
fÜû
 
İtiÚ
 
is
 
nÙ
 
£t
.

228 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘_jsÚ
(
fÜû
)

229 
loÿl
 
cÚ‹Á_ty³
 = 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("cÚ‹Á-ty³", 
Œue
)

230 
nÙ
 
cÚ‹Á_ty³
 
th’


231 
cÚ‹Á_ty³
 = ""

232 
’d


233 
fÜû
 ~ğ
Œue
 
ªd
 
nÙ
 
cÚ‹Á_ty³
:
	`fšd
("­¶iÿtiÚ/jsÚ", 1,rueè
th’


234  
n


235 
’d


236  
esÿ³
.
	$jsÚ_decode
(
£lf
.
»que¡
.
body
)

237 
’d


239 --*************** 
Ouut
 ***************

241 --- 
Re£t
 
®l
 
h—d”s
 
ªd
 
cÚ‹Á
 
this
 
»que¡
. 
Run
 
Ú
 
şass
 
š™Ÿliz©iÚ
.

242 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$ş—r
()

243 
£lf
.
h—d”s
 = 
h‰put
.
HTTPH—d”s
:
	$Ãw
()

244 
£lf
:
	$£t_deçuÉ_h—d”s
()

245 
£lf
:
	`add_h—d”
("S”v”", s–f.
­¶iÿtiÚ
.
­¶iÿtiÚ_Çme
)

246 
nÙ
 
£lf
.
»que¡
:
	$suµÜts_h‰p_1_1
(è
th’


247 
loÿl
 
cÚ
 = 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("Connection")

248 
cÚ
 =ğ"K“p-Alive" 
Ü
 cÚ =ğ"k“p-®ive" 
th’


249 
£lf
:
	`add_h—d”
("Connection", "Keep-Alive")

250 
’d


251 
’d


252 
£lf
.
_wr™e_bufãr
 = 
bufãr
:
	$Ãw
()

253 
£lf
.
_¡©us_code
 = 200

254 
’d


256 --- 
Add
 
the
 
giv’
 
Çme
 
ªd
 
v®ue
 
·œ
 
to
h
HTTP
 
»¥Ú£
 
h—d”s
.

257 -- 
To
 
ov”w™e
 
u£
 
the
 
£t_h—d”
 
m‘hod
 
š¡—d
.

258 -- @
·¿m
 
	$Çme
 (
SŒšg
è
Key
 
¡ršg
 
h—d”
 
f›ld
.

259 -- @
·¿m
 
	$v®ue
 (
SŒšg
 
Ü
 
numb”
è
V®ue
 
h—d”
 
f›ld
.

260 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$add_h—d”
(
Çme
, 
v®ue
)

261 
£lf
.
h—d”s
:
	$add
(
Çme
, 
v®ue
)

262 
’d


264 --- 
S‘
 
the
 
giv’
 
Çme
 
ªd
 
v®ue
 
·œ
 
to
h
HTTP
 
»¥Ú£
 
h—d”s
.

265 -- 
Difã»nû
 
äom
 
add_h—d”
 
th©
 
£t_h—d”
 
wl
 
ov”wr™e
 
exi¡šg
 
h—d”


266 -- 
key
.

267 -- @
·¿m
 
	$Çme
 (
SŒšg
è
Key
 
¡ršg
 
h—d”
 
f›ld
.

268 -- @
·¿m
 
	$v®ue
 (
SŒšg
 
Ü
 
numb”
è
V®ue
 
h—d”
 
f›ld
.

269 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£t_h—d”
(
Çme
, 
v®ue
)

270 
£lf
.
h—d”s
:
	$£t
(
Çme
, 
v®ue
)

271 
’d


273 --- 
R‘uºs
 
the
 
cu¼’t
 
v®ue
 
£t
 
to
 
giv’
 
key
.

274 -- @
·¿m
 
	$Çme
 (
SŒšg
è
Key
 
¡ršg
 
h—d”
 
f›ld
.

275 -- @ 
V®ue
 
of
 
h—d”
 
f›ld
 
Ü
 
n
 
nÙ
 
£t
, 
may
  
a
 
bË


276 -- 
muÉË
 
v®ues
 
w™h
 
§me
 
key
 
exi¡s
.

277 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘_h—d”
(
key
)

278  
£lf
.
h—d”s
:
	$g‘
(
key
)

279 
’d


281 --- 
S‘s
 
the
 
HTTP
 
¡©us
 
code
 
our
 
»¥Ú£
.

282 -- @
·¿m
 
¡©us_code
 
The
 
¡©us
 
code
 
to
 
£t
. 
Mu¡
 
be
 
numb”
 
Ü
 
a
 
”rÜ
 
is


283 -- 
¿i£d
.

284 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£t_¡©us
(
¡©us_code
)

285 
	`ty³
(
¡©us_code
è~ğ"numb”" 
th’


286 
	`”rÜ
("set_status method„equires‚umber.")

287 
’d


288 
£lf
.
_¡©us_code
 = 
¡©us_code


289 
’d


291 --- 
G‘
 
the
 
cu»Á
 
¡©us
 
code
 
of
h
HTTP
 
»¥Ú£
 
h—d”s
.

292 -- @ (
Numb”
è
Cu¼’t
 
HTTP
 
¡©us
 
code
.

293 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘_¡©us
(è 
£lf
.
_¡©us_code
 
’d


295 --- 
Redœeù
 
ş›Á
 
to
 
ªÙh”
 
URL
. 
S‘s
 
h—d”s
 
ªd
 
fšish
 
»que¡
.

296 -- 
U£r
 
ÿn
 
nÙ
 
£nd
 
d©a
 
aá”
 
this
.

297 -- @
nÙe
 
Fšishes
 
»que¡
, 
no
 
fu¹h”
 
İ”©iÚs
 
ÿn
 
be
 
dÚe


298 -- @
·¿m
 
	$u¾
 (
SŒšg
è
The
 
URL
 
to
 
»dœeù
o.

299 -- @
·¿m
 
	$³rmª’t
 (
BoŞ—n
è
Brow£r
 
hšt
 
th©
 
§ys
 
the
 
»dœeù
 
is


300 -- 
³rmª’t
.

301 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$»dœeù
(
u¾
, 
³rmª’t
)

302 
£lf
.
_h—d”s_wr™‹n
 
th’


303 
	`”rÜ
("Cannot„edirect‡fter headers have been written")

304 
’d


305 
loÿl
 
¡©us
 = 
³rmª’t
 
ªd
 301 
Ü
 302

306 
£lf
:
	$£t_¡©us
(
¡©us
)

307 
£lf
:
	`add_h—d”
("LoÿtiÚ", 
u¾
)

308 
£lf
:
	$fšish
()

309 
’d


311 --- 
Rai£s
 
ª
 
HTTPE¼Ü
 
w™h
 
the
 
´ovided
 
¡©us
 
code
 
ªd
 
İtiÚ®
 
mes§ge
.

312 -- @
·¿m
 
¡©us_code
 
The
 
¡©us
 
code
 
to
 
£t
. 
Mu¡
 
be
 
numb”
 
Ü
 
a
 
”rÜ
 
is


313 -- 
¿i£d
.

314 -- @
·¿m
 
msg
 
An
 
İtiÚ®
 
cu¡om
 
mes§ge
 
the
 
”rÜ
.

315 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£nd_”rÜ
(
¡©us_code
, 
msg
)

316 
	`ty³
(
¡©us_code
è~ğ"numb”" 
th’


317 
	`”rÜ
("status code must be‡‚umber")

318 
’d


319 
msg
 
th’


320 
	`”rÜ
(
web
.
	$HTTPE¼Ü
(
¡©us_code
, 
msg
))

322 
	`”rÜ
(
web
.
	$HTTPE¼Ü
(
¡©us_code
))

323 
’d


324 
’d


326 --- 
Check
 
¡©us
 
of
 
»que¡
 
bešg
 
hªdËd
. 
If
 
fšished
 
the
 
»¥Ú£
 
is
 
£Á
.

327 -- @ (
BoŞ—n
è
Œue
 
Ü
 
çl£
.

328 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$fšished
()

329  
£lf
.
_fšished
 =ğ
Œue


330 
’d


333 --- 
G‘
 
cook›
 
v®ue
 
äom
 
šcomšg
 
»que¡
.

334 -- @
·¿m
 
Çme
 
The
‚am
of
 
the
 
cook›
 
to
 
g‘
.

335 -- @
·¿m
  
A
  
v®ue
 
no
 
cook›
 
is
 
found
.

336 -- @ 
Cook›
 
Ü
 
the
  
v®ue
.

337 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘_cook›
(
Çme
, )

338 
nÙ
 
£lf
.
_cook›s_·r£d
 
th’


339 
£lf
:
	$_·r£_cook›s
()

340 
’d


341 
nÙ
 
£lf
.
_cook›s
[
Çme
] 
th’


344  
£lf
.
_cook›s
[
Çme
]

345 
’d


346 
’d


348 --- 
G‘
 
a
 sigÃd 
cook›
 
v®ue
 
äom
 
šcomšg
 
»que¡
.

349 -- 
If
 
the
 
cook›
 
ÿn
 
nÙ
 
be
 
v®id©ed
, 
th’
 
ª
 
”rÜ
 
w™h
 
a
 
¡ršg
ƒrror

350 -- 
is
 
¿i£d
.

351 -- 
Hash
-
ba£d
 
mes§ge
 
auth’tiÿtiÚ
 
	$code
 (
HMAC
è
is
 
u£d
 
to
 
be
 
abË
Ø
v”ify


352 -- 
th©
 
the
 
cook›
 
has
 
b“n
 
ü—‹d
 
w™h
h"cook›_£ü‘" 
£t
 
š
he

353 -- 
AµliÿtiÚ
 
şass
 
kw¬gs
. 
This
 
is
 
sim¶y
 
v”ifšg
 
th©
 
the
 
cook›
 
has
 
b“n


354 -- sigÃd 
by
 
your
 
key
, 
IT
 
IS
 
NOT
 
ENCRYPTING
 
DATA
.

355 -- @
·¿m
 
Çme
 
The
‚am
of
 
the
 
cook›
 
to
 
g‘
.

356 -- @
·¿m
  
A
  
v®ue
 
no
 
cook›
 
is
 
found
.

357 -- @
·¿m
 
max_age
 
Time¡amp
 
u£d
 
to
 
sign
 
cook›
 
mu¡
 
be
 
nÙ
 b
Şd”
 
thª
 
this


358 -- 
v®ue
 
š
 
£cÚds
.

359 -- @ 
Cook›
 
Ü
 
the
  
v®ue
.

360 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$g‘_£cu»_cook›
(
Çme
, , 
max_age
)

361 
loÿl
 
cook›
 = 
£lf
:
	$g‘_cook›
(
Çme
)

362 
nÙ
 
cook›
 
th’


364 
’d


365 
loÿl
 
hmac
, 
Ën
, 
time¡amp
, 
v®ue
 = 
cook›
:
	`m©ch
("(%w*)|(%d*)|(%d*)|(.*)")

366 
	`as£¹
(
	`tÚumb”
(
Ën
è=ğ
v®ue
:
	`Ën
(), "Cookie value†ength has changed!")

367 
	`as£¹
(
hmac
:
	`Ën
() == 40, "Could‚ot get secure cookie. Hasho short.")

368 
max_age
 
th’


369 
max_age
 = max_ag* 1000 -- 
G‘
 
mli£cÚds
.

370 
loÿl
 
cook›time
 = 
	$tÚumb”
(
time¡amp
)

371 
	`as£¹
(
ut
.
	`g‘timeofday
(è- 
time¡amp
 < 
max_age
, "Cookie hasƒxpired.")

372 
’d


373 
loÿl
 
hmac_cmp
 = 
hash
.
	`HMAC
(
£lf
.
­¶iÿtiÚ
.
kw¬gs
.
cook›_£ü‘
,

374 
¡ršg
.
	`fÜm©
("%d|%s|%s",

375 
Ën
,

376 
	`to¡ršg
(
time¡amp
),

377 
v®ue
))

378 
	`as£¹
(
hmac
 =ğ
hmac_cmp
, "Secure cookie does‚ot match hash. \
he cookie is forged orhe cookie secret \
 been changed")

381  
v®ue


382 
’d


384 --- 
S‘
 
a
 
cook›
 
w™h
 
v®ue
 
to
 
»¥Ú£
.

385 -- @
·¿m
 
Çme
 
The
‚am
of
 
the
 
cook›
 
to
 
£t
.

386 -- @
·¿m
 
v®ue
 
The
 v®u
of
 
the
 
cook›
.

387 -- @
·¿m
 
domaš
 
The
 domaš 
to
 
­¶y
 
cook›
 .

388 -- @
·¿m
 
expœe_hours
 
S‘
 
cook›
 
to
 
expœe
 
š
 
giv’
 
amouÁ
 
of
 
hours
.

389 -- @
nÙe
 
Expœšg
 
»l›s
 
Ú
 
the
 
»que¡šg
 
brow£r
 
ªd
 
may
 
Ü
 may 
nÙ
 
be


390 -- 
»¥eùed
. 
Also
 
k“p
 
š
 
mšd
 
th©
 
the
 
£rv”s
 
time
 
is
 
u£d
 
to
 
ÿlcuÏ‹


391 -- 
expœy
 
d©e
, 
so
 
the
 
£rv”
 
should
 
id—Îy
 
be
 
£t
 
up
 
w™h
 
NTP
 server.

392 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£t_cook›
(
Çme
, 
v®ue
, 
domaš
, 
expœe_hours
)

393 
£lf
.
_£t_cook›
[#self._set_cookie+1] = {

394 
Çme
 =‚ame,

395 
v®ue
 = value,

396 
domaš
 = domain,

397 
expœe_hours
 =ƒxpœe_hour 
Ü
 1

398 
	}
}

399 
’d


401 --- 
S‘
 
a
 sigÃd 
cook›
 
v®ue
 
to
 
»¥Ú£
.

402 -- 
Hash
-
ba£d
 
mes§ge
 
auth’tiÿtiÚ
 
	$code
 (
HMAC
è
is
 
u£d
 
to
 
be
 
abË
Ø
v”ify


403 -- 
th©
 
the
 
cook›
 
has
 
b“n
 
ü—‹d
 
w™h
h"cook›_£ü‘" 
£t
 
š
he

404 -- 
AµliÿtiÚ
 
şass
 
kw¬gs
. 
This
 
is
 
sim¶y
 
v”ifšg
 
th©
 
the
 
cook›
 
has
 
b“n


405 -- sigÃd 
by
 
your
 
key
, 
IT
 
IS
 
NOT
 
ENCRYPTING
 
DATA
.

406 -- @
·¿m
 
Çme
 
The
‚am
of
 
the
 
cook›
 
to
 
£t
.

407 -- @
·¿m
 
v®ue
 
The
 v®u
of
 
the
 
cook›
.

408 -- @
·¿m
 
domaš
 
The
 domaš 
to
 
­¶y
 
cook›
 .

409 -- @
·¿m
 
expœe_hours
 
S‘
 
cook›
 
to
 
expœe
 
š
 
giv’
 
amouÁ
 
of
 
hours
.

410 -- @
nÙe
 
Expœšg
 
»l›s
 
Ú
 
the
 
»que¡šg
 
brow£r
 
ªd
 
may
 
Ü
 may 
nÙ
 
be


411 -- 
»¥eùed
. 
Also
 
k“p
 
š
 
mšd
 
th©
 
the
 
£rv”s
 
time
 
is
 
u£d
 
to
 
ÿlcuÏ‹


412 -- 
expœy
 
d©e
, 
so
 
the
 
£rv”
 
should
 
id—Îy
 
be
 
£t
 
up
 
w™h
 
NTP
 server.

413 
funùiÚ
 
web
.
Reque¡HªdËr
:
	`£t_£cu»_cook›
(
Çme
, 
v®ue
, 
domaš
, 
expœe_hours
)

414 -- 
The
 
£cu»
 
cook›
 
fÜm©
 
is
 
as
 
fŞlows
:

415 -- 
Each
 
cŞumn
 
is
 
£·¿‹d
 
by
 
a
 
pe
.

416 -- 
v®ue
 
Ëngth
 | 
HMAC
 
hash
 | 
time¡amp
 | value

417 -- 
time¡amp
 
ªd
 
v®ue
 
£·¿‹d
 
by
 
a
 
pe
 
is
 
wh©
 i 
bešg
 
hashed
.

418 
	`as£¹
(
	`ty³
(
£lf
.
­¶iÿtiÚ
.
kw¬gs
.
cook›_£ü‘
) == "string",

420 
	`ty³
(
v®ue
è~ğ"¡ršg" 
th’


421 
v®ue
 = 
	$to¡ršg
(
v®ue
)

422 
’d


423 
loÿl
 
to_hash
 = 
¡ršg
.
	`fÜm©
("%d|%s|%s",

424 
v®ue
:
	`Ën
(),

425 
	`to¡ršg
(
ut
.
	`g‘timeofday
()),

426 
v®ue
)

427 
loÿl
 
cook›
 = 
¡ršg
.
	`fÜm©
("%s|%s",

428 
hash
.
	`HMAC
(

429 
£lf
.
­¶iÿtiÚ
.
kw¬gs
.
cook›_£ü‘
,

430 
to_hash
),

431 
to_hash
)

432  
£lf
:
	$£t_cook›
(
Çme
, 
cook›
, 
domaš
, 
expœe_hours
)

433 
’d


435 --- 
CË¬
 
a
 
cook›
.

436 -- @
·¿m
 
Çme
 
The
‚am
of
 
the
 
cook›
 
to
 
ş—r
.

437 -- @
nÙe
 
Expœšg
 
»l›s
 
Ú
 
the
 
»que¡šg
 
brow£r
 
ªd
 
may
 
Ü
 may 
nÙ
 
be


438 -- 
»¥eùed
.

439 
funùiÚ
 
web
.
Reque¡HªdËr
:
	`ş—r_cook›
(
Çme
)

440 -- 
CË¬
 
cook›
 
by
 
£‰šg
 
expœy
 
d©e
 
to
 0 
ªd


441 -- 
em±y
 
v®ues
...

442 
£lf
:
	`£t_cook›
(
Çme
, "", 
n
, 0)

443 
’d


445 --- 
S‘
 
hªdËr
 
to
 
nÙ
 
ÿÎ
 
	$fšish
(è
wh’
 
»que¡
 
m‘hod
 
has
 
b“n
 
ÿÎed
 
ªd


446 -- 
»tuºed
. 
DeçuÉ
 
is
 
çl£
. 
Wh’
 
£t
 
to
 
Œue
, 
the
 
u£r
 
mu¡
 
ex¶ic™ly
 
ÿÎ


447 -- 
fšish
.

448 -- @
·¿m
 
	$boŞ
 (
BoŞ—n
)

449 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£t_async
(
boŞ
)

450 
	`ty³
(
boŞ
è~ğ"boŞ—n" 
th’


451 
	`”rÜ
("bool must be boolean!")

452 
’d


453 
£lf
.
_auto_fšish
 = 
boŞ
 =ğ
çl£


454 
’d


456 --- 
U£
 
chunked
 
’codšg
 
Ú
 
wr™es
. 
Mu¡
 
be
 
wr™‹n
 
befÜe
 :
	$æush
(è
is
 
ÿÎed
.

457 -- 
Onû
 
£t
, 
the
 
mode
 
is
 
œ»v”sibË
. 
Modifyšg
h
æag
 
mªu®ly
 
wl
 
ÿu£


458 -- 
undefšed
 
behaviour
. 
C®l
 :
	$wr™e
(è
as
 
usu®
, 
ªd
 
wh’
 
»ady
 
to
 
£nd
 
Úe


459 -- 
chunk
 
ÿÎ
 :
	`æush
(). 
	$fšish
(è
mu¡
 
be
 
ÿÎed
 
to
 
sigÇl
 
the
 
’d
 
of
h
¡»am
.

460 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$£t_chunked_wr™e
()

461 
£lf
.
_h—d”s_wr™‹n
 =ğ
Œue
 
th’


462 
	`”rÜ
("Headers‡lready written, can‚ot switcho chunked write.")

463 
–£if
 
£lf
.
»que¡
.
h—d”s
.
m‘hod
 =ğ"HEAD" 
th’


464 
	`”rÜ
("Chunked write gives‚o meaning for HEAD„equests.")

465 
’d


466 
£lf
.
chunked
 = 
Œue


467 
£lf
:
	`add_h—d”
("Transfer-Encoding", "chunked")

468 
’d


470 --- 
Wr™es
 
the
 
giv’
 
chunk
 
to
h
ouut
 
bufãr
.

471 -- 
To
 
wr™e
 
the
 
ouut
 
to
h
ÃtwÜk
, 
u£
h
	$æush
(è
m‘hod
.

472 -- 
If
 
the
 
giv’
 
chunk
 
is
 
a
 
Lua
 
bË
, 
™
 
wl
 
be
 
autom©iÿÎy


473 -- 
¡ršgiãd
 
to
 
JSON
.

474 -- @
·¿m
 
	$chunk
 (
SŒšg
è
D©a
 
chunk
 
to
 
wr™e
Ø
und”lyšg
 
cÚÃùiÚ
.

475 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$wr™e
(
chunk
)

476 
£lf
.
_fšished
 
th’


477 
	`”rÜ
("write() method was called‡fter finish().")

478 
’d


479 
loÿl
 
t
 = 
	$ty³
(
chunk
)

480 
t
 =ğ"n" 
th’


481 -- 
Acû±
 
wr™šg
 
em±y
 
blocks
.

483 
–£if
 
t
 =ğ"¡ršg" 
ªd
 
chunk
:
	`Ën
(è=ğ0 
th’


485 
–£if
 
t
 =ğ"bË" 
th’


486 
£lf
:
	`add_h—d”
("Content-Type", "application/json; charset=UTF-8")

487 
chunk
 = 
esÿ³
.
	$jsÚ_’code
(
chunk
)

488 
–£if
 
t
 ~ğ"¡ršg" 
ªd
 ~ğ"bË" 
th’


489 
	`”rÜ
("UnsuµÜ‹dy³ wr™‹Àa »¥Ú£; "..
t
)

490 
’d


491 
£lf
.
_wr™e_bufãr
:
	$­³nd_lua¡r_right
(
chunk
)

492 
’d


494 --- 
Flushes
 
the
 
cu¼’t
 
ouut
 
bufãr
 
to
h
IO
 
¡»am
.

495 -- 
If
 
ÿÎback
 
is
 
giv’
 
™
 
wl
 
be
 
run
 
wh’
 
the
 
bufãr
 
has
 
b“n
 
wr™‹n
 
to
he

496 -- 
sock‘
. 
NÙe
 
th©
 
Úly
 
Úe
 
ÿÎback
 
æush
 c®lback 
ÿn
 
be
 
´e£Á
 
³r


497 -- 
»que¡
. 
Givšg
 
a
 
Ãw
 
ÿÎback
 
befÜe
 
the
 
³ndšg
 
has
 
b“n
 
run
 
Ëads
 
to


498 -- 
disÿrdšg
 
of
 
the
 
cu¼’t
 
³ndšg
 
ÿÎback
. 
FÜ
 
HEAD
 
m‘hod
 
»que¡
he

499 -- 
chunk
 
is
 
ignÜed
 
ªd
 
Úly
 
h—d”s
 
¬e
 
wr™‹n
 
to
 
the
 
sock‘
.

500 -- @
·¿m
 
	$ÿÎback
 (
FunùiÚ
è
C®lback
 
funùiÚ
.

501 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$æush
(
ÿÎback
, 
¬g
)

502 
loÿl
 
h—d”s


503 
nÙ
 
£lf
.
_h—d”s_wr™‹n
 
th’


504 
£lf
.
_h—d”s_wr™‹n
 = 
Œue


505 
h—d”s
 = 
£lf
:
	$_g’_h—d”s
()

506 
’d


507 
loÿl
 
chunk
 = 
	$to¡ršg
(
£lf
.
_wr™e_bufãr
)

508 
£lf
.
_wr™e_bufãr
:
	`ş—r
()

509 -- 
Lšes
 
b–ow
 
u£s
 
muÉË
 
ÿÎs
 
to
 
wr™e
Ø
avoid
 
ü—tšg
 
Ãw


510 -- 
‹mpÜ¬y
 
¡ršgs
. 
The
 
wr™e
 
wl
 
es£ÁŸÎy
 
ju¡
 
be
 
­³nded


511 -- 
to
 
the
 
IOSŒ—m
 
şass
, 
which
 
wl
 
aùu®ly
 
nÙ
 
³rfÜm
 
ªy
 
wr™es


512 -- 
uÁ
 
the
 
ÿÎšg
 
funùiÚ
 
»tuºs
 
to
 
IOLoİ
.

513 
£lf
.
chunked
 
th’


514 -- 
T¿nsãr
-
Encodšg
: 
chunked
 
suµÜt
.

515 
h—d”s
 
th’


516 
chunk
:
	`Ën
(è~ğ0 
th’


517 
£lf
.
»que¡
:
	$wr™e
(
h—d”s
)

518 
£lf
.
»que¡
:
	`wr™e
("\r\n")

519 
£lf
.
»que¡
:
	`wr™e
(
ut
.
	`hex
(
chunk
:
	$Ën
()))

520 
£lf
.
»que¡
:
	`wr™e
("\r\n")

521 
£lf
.
»que¡
:
	$wr™e
(
chunk
)

522 
£lf
.
»que¡
:
	`wr™e
("\r\n", 
ÿÎback
, 
¬g
)

524 
£lf
.
»que¡
:
	$wr™e
(
h—d”s
)

525 
£lf
.
»que¡
:
	`wr™e
("\r\n", 
ÿÎback
, 
¬g
)

526 
’d


527 
–£if
 
chunk
:
	`Ën
(è~ğ0 
th’


528 
£lf
.
»que¡
:
	`wr™e
(
ut
.
	`hex
(
chunk
:
	$Ën
()))

529 
£lf
.
»que¡
:
	`wr™e
("\r\n")

530 
£lf
.
»que¡
:
	$wr™e
(
chunk
)

531 
£lf
.
»que¡
:
	`wr™e
("\r\n")

532 
’d


534 -- 
NÙ
 
chunked
 
w™h
 
CÚ‹Á
-
L’gth
 
£t
.

535 
h—d”s
 
th’


536 
£lf
.
»que¡
.
h—d”s
.
m‘hod
 =ğ"HEAD" 
th’


537 
£lf
.
»que¡
:
	$wr™e
(
h—d”s
, 
ÿÎback
, 
¬g
)

538 
–£if
 
chunk
:
	`Ën
(è~ğ0 
th’


539 
£lf
.
»que¡
:
	$wr™e
(
h—d”s
)

540 
£lf
.
»que¡
:
	`wr™e
("\r\n")

541 
£lf
.
»que¡
:
	$wr™e
(
chunk
, 
ÿÎback
, 
¬g
)

543 
£lf
.
»que¡
:
	$wr™e
(
h—d”s
)

544 
£lf
.
»que¡
:
	`wr™e
("\r\n", 
ÿÎback
, 
¬g
)

545 
’d


546 
–£if
 
chunk
:
	`Ën
(è~ğ0 
th’


547 
£lf
.
»que¡
:
	$wr™e
(
chunk
, 
ÿÎback
, 
¬g
)

548 
’d


549 
’d


550 
’d


552 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$_g’_h—d”s
()

553 
£lf
:
	`g‘_¡©us
(è~ğ204 
th’


554 
nÙ
 
£lf
:
	`g‘_h—d”
("CÚ‹Á-Ty³"è
th’


555 -- 
No
 
cÚ‹Á
 
ty³
 
is
 
£t
, 
assume
 
th©
 
™
 i 
‹xt
/
html
.

556 -- 
This
 
might
 
nÙ
 
be
 
´eã¿bË
 
š
 
®l
 
ÿ£s
.

557 
£lf
:
	`add_h—d”
("Content-Type", "text/html; charset=UTF-8")

558 
’d


559 
nÙ
 
£lf
:
	`g‘_h—d”
("CÚ‹Á-L’gth"è
ªd
‚Ù s–f.
chunked
 
th’


560 -- 
No
 
Ëngth
 
is
 
£t
, 
add
 
cu¼’t
 
wr™e
 
bufãr
 
size
.

561 
£lf
:
	`add_h—d”
("Content-Length",

562 
	`tÚumb”
(
£lf
.
_wr™e_bufãr
:
	$Ën
()))

563 
’d


564 
’d


565 
£lf
.
h—d”s
:
	$£t_¡©us_code
(
£lf
.
_¡©us_code
)

566 
£lf
.
h—d”s
:
	`£t_v”siÚ
("HTTP/1.1")

567 #£lf.
_£t_cook›
 ~ğ0 
th’


568 
loÿl
 
c
 = 
£lf
.
_£t_cook›


569 
i
 = 1, #c do

570 
loÿl
 
expœe_time


571 
c
[
i
].
expœe_hours
 =ğ0 
th’


572 
expœe_time
 = 0

574 
expœe_time
 = 
os
.
	`time
(è+ (
c
[
i
].
expœe_hours
*60*60)

575 
’d


576 
loÿl
 
expœe_¡r
 = 
ut
.
	$time_fÜm©_cook›
(
expœe_time
)

577 
loÿl
 
cook›
 = 
¡ršg
.
	`fÜm©
("%s=%s;…ath=%s;ƒxpires=%s",

578 
esÿ³
.
	`esÿ³
(
c
[
i
].
Çme
),

579 
esÿ³
.
	`esÿ³
(
c
[
i
].
v®ue
 
Ü
 ""),

580 
c
[
i
].
domaš
 
Ü
 "/",

581 
expœe_¡r
)

582 
£lf
:
	`add_h—d”
("S‘-Cook›", 
cook›
)

583 
’d


584 
’d


585  
£lf
.
h—d”s
:
	$¡ršgify_as_»¥Ú£
()

586 
’d


588 --- 
Fšishes
 
the
 
HTTP
 
»que¡
. 
This
 
m‘hod
 
ÿn
 
Úly
 
be
 
ÿÎed
 
Úû
 
—ch


589 -- 
»que¡
. 
This
 
m‘hod
 
æushes
 
®l
 
d©a
 
š
 
the
 
wr™e
 
bufãr
.

590 -- @
·¿m
 
	$chunk
 (
SŒšg
è
Fš®
 
d©a
 
to
 
wr™e
Ø
¡»am
 
befÜe
 
fšishšg
.

591 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$fšish
(
chunk
)

592 
£lf
.
_fšished
 
th’


593 
	`”rÜ
("finish() calledwice. Somethingerrible has happened")

594 
’d


595 
£lf
.
_fšished
 = 
Œue


596 
chunk
 
th’


597 
£lf
:
	$wr™e
(
chunk
)

598 
’d


599 
£lf
:
	`æush
(è-- 
Make
 
su»
 
ev”ythšg
 
š
 
bufãrs
 
¬e
 
æushed
 
to
 
IOSŒ—m
.

600 
£lf
.
chunked
 
th’


601 
£lf
.
»que¡
:
	`wr™e
("0\r\n\r\n", s–f.
_fšish
, self)

603 
’d


604 
£lf
:
	$_fšish
()

605 
’d


607 --- 
P¬£
 
cook›s
 
accÜdšg
 
to
 
the
 
RFC
 6265 
docum’t
.

608 -- 
V®id
 
cook›
 
fÜm©
 
is
:

609 -- 
cook›
-
·œ
 = cook›-
Çme
 "=" cook›-
v®ue


610 -- 
cook›
-
Çme
 = 
tok’


611 -- 
cook›
-
v®ue
 = *cook›-
où‘
 / ( 
DQUOTE
 *cookie-octet DQUOTE )

612 -- 
cook›
-
où‘
 = %
x21
 / %
x23
-2B / %
x2D
-3A / %
x3C
-5B / %
x5D
-7E

613 -- ; 
US
-
ASCII
 
ch¬aù”s
 
exşudšg
 
CTLs
,

614 -- ; 
wh™e¥aû
 
DQUOTE
, 
comma
, 
£micŞÚ
,

615 -- ; 
ªd
 
back¦ash


617 
loÿl
 
EQUAL
 = 
¡ršg
.
	`by‹
("=")

618 
loÿl
 
SEMICOLON
 = 
¡ršg
.
	`by‹
(";")

619 
loÿl
 
SPACE
 = 
¡ršg
.
	`by‹
(" ")

620 
loÿl
 
HTAB
 = 
¡ršg
.
	`by‹
("\t")

622 
loÿl
 
funùiÚ
 
	$g‘_cook›_bË
(
‹xt_cook›
)

623 
	`ty³
(
‹xt_cook›
è~ğ"¡ršg" 
th’


624 
	`”rÜ
(
¡ršg
.
	`fÜm©
("Expectext_cookieo be \"string\" but found %s",

625 
	$ty³
(
‹xt_cook›
)))

626 
’d


628 
loÿl
 
EXPECT_KEY
 = 1

629 
loÿl
 
EXPECT_VALUE
 = 2

630 
loÿl
 
EXPECT_SP
 = 3

632 
loÿl
 
n
 = 0

633 
loÿl
 
Ën
 = #text_cookie

635 
i
 = 1, 
Ën
 do

636 
¡ršg
.
	`by‹
(
‹xt_cook›
, 
i
è=ğ
SEMICOLON
 
th’


637 
n
 =‚ + 1

638 
’d


639 
’d


641 
loÿl
 
cook›_bË
 = {
	}
}

643 
loÿl
 
¡©e
 = 
EXPECT_SP


644 
loÿl
 
i
 = 1

645 
loÿl
 
j
 = 1

646 
loÿl
 
key
, 
v®ue


648 
j
 <ğ
Ën
 do

649 
¡©e
 =ğ
EXPECT_KEY
 
th’


650 
¡ršg
.
by‹
(
‹xt_cook›
, 
j
è=ğ
EQUAL
 
th’


651 
key
 = 
¡ršg
.
sub
(
‹xt_cook›
, 
i
, 
j
 - 1)

652 
¡©e
 = 
EXPECT_VALUE


653 
i
 = 
j
 + 1

654 
’d


655 
–£if
 
¡©e
 =ğ
EXPECT_VALUE
 
th’


656 
¡ršg
.
by‹
(
‹xt_cook›
, 
j
è=ğ
SEMICOLON


657 
Ü
 
¡ršg
.
by‹
(
‹xt_cook›
, 
j
è=ğ
SPACE


658 
Ü
 
¡ršg
.
by‹
(
‹xt_cook›
, 
j
è=ğ
HTAB


659 
th’


660 
v®ue
 = 
¡ršg
.
sub
(
‹xt_cook›
, 
i
, 
j
 - 1)

661 
cook›_bË
[
esÿ³
.
uÃsÿ³
(
key
)] =ƒsÿ³.
	$uÃsÿ³
(
v®ue
)

663 
key
, 
v®ue
 = 
n
,‚il

664 
¡©e
 = 
EXPECT_SP


665 
i
 = 
j
 + 1

666 
’d


667 
–£if
 
¡©e
 =ğ
EXPECT_SP
 
th’


668 
¡ršg
.
	`by‹
(
‹xt_cook›
, 
j
è~ğ
SPACE


669 
ªd
 
¡ršg
.
	`by‹
(
‹xt_cook›
, 
j
è~ğ
HTAB


670 
th’


671 
¡©e
 = 
EXPECT_KEY


672 
i
 = 
j


673 
j
 = j - 1

674 
’d


675 
’d


676 
j
 = j + 1

677 
’d


679 
key
 ~ğ
n
 
ªd
 
v®ue
 =ğn 
th’


680 
cook›_bË
[
esÿ³
.
	`uÃsÿ³
(
key
)] =ƒscape.unescape(

681 
¡ršg
.
	$sub
(
‹xt_cook›
, 
i
))

682 
’d


684  
cook›_bË


685 
’d


687 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$_·r£_cook›s
()

688 
loÿl
 
cook›_¡r
, 
út
 = 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("Cookie")

690 
£lf
.
_cook›s_·r£d
 = 
Œue


691 
út
 =ğ0 
th’


692 
£lf
.
_cook›s
 = {
	}
}

694 
–£if
 
út
 =ğ1 
th’


695 
£lf
.
_cook›s
 = 
	$g‘_cook›_bË
(
cook›_¡r
)

696 
–£if
 
út
 > 1 
th’


697 
£lf
.
_cook›s
 = {
	}
}

698 
i
 = 1, 
út
 do

699 
£lf
.
_cook›s
 = 
ut
.
bËm”ge
(

700 
£lf
.
_cook›s
,

701 
	$g‘_cook›_bË
(
cook›_¡r
[
i
])

703 
’d


704 
’d


705 
’d


707 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$_fšish
()

708 
£lf
.
_¡©us_code
 =ğ200 
Ü
 s–f._¡©us_cod=ğ304 
th’


709 
log
.
	`sucûss
(
¡ršg
.
	`fÜm©
([[[
web
.
lua
] %
d
 %
s
 % %
	`s
 (%sè%
dms
]],

710 
£lf
.
_¡©us_code
,

711 
»¥Ú£_codes
[
£lf
.
_¡©us_code
],

712 
£lf
.
»que¡
.
h—d”s
:
	`g‘_m‘hod
(),

713 
£lf
.
»que¡
.
h—d”s
:
	`g‘_u¾
(),

714 
£lf
.
»que¡
.
»mÙe_
,

715 
£lf
.
»que¡
:
	$»que¡_time
()))

717 
log
.
	`w¬nšg
(
¡ršg
.
	`fÜm©
([[[
web
.
lua
] %
d
 %
s
 % %
	`s
 (%sè%
dms
]],

718 
£lf
.
_¡©us_code
,

719 
»¥Ú£_codes
[
£lf
.
_¡©us_code
],

720 
£lf
.
»que¡
.
h—d”s
:
	`g‘_m‘hod
(),

721 
£lf
.
»que¡
.
h—d”s
:
	`g‘_u¾
(),

722 
£lf
.
»que¡
.
»mÙe_
,

723 
£lf
.
»que¡
:
	$»que¡_time
()))

724 
’d


725 
£lf
.
»que¡
:
	$fšish
()

726 
£lf
:
	$Ú_fšish
()

727 
’d


729 --- 
C®Ëd
 
š
 
asynchrÚous
 
hªdËrs
 
wh’
 
the
 
cÚÃùiÚ
 
is
 
şo£d
.

730 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$Ú_cÚÃùiÚ_şo£
(è
’d


732 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$_execu‹_func_bË_uÅack
(
func
)

733 
	`ty³
(
func
è=ğ"bË" 
th’


734 
i
 = 1, #func, 1 do

735 
func
[
i
](
£lf
, 
	$uÅack
(
£lf
.
_u¾_¬gs
))

736 
’d


738 
	`func
(
£lf
, 
	$uÅack
(
£lf
.
_u¾_¬gs
))

739 
’d


740 
’d


742 
funùiÚ
 
web
.
Reque¡HªdËr
:
	$_execu‹_func_bË
(
func
)

743 
	`ty³
(
func
è=ğ"bË" 
th’


744 
i
 = 1, #func, 1 do

745 
func
[
i
](
£lf
)

746 
’d


748 
	$func
(
£lf
)

749 
’d


750 
’d


752 --- 
Maš
 
’Œy
 
pošt
 
the
 
AµliÿtiÚ
 
şass
.

753 
funùiÚ
 
web
.
Reque¡HªdËr
:
	`_execu‹
()

754 -- 
SuµÜ‹d
 
m‘hods
 
ÿn
 
be
 
ex‹nded
 
š
 
šh”™šg
 
şas£s
 
by
 
£‰šg
 
the


755 -- 
£lf
.
SUPPORT_METHODS
 
bË
.

756 
nÙ
 
	$is_š
(
£lf
.
»que¡
.
m‘hod
, s–f.
SUPPORTED_METHODS
è
th’


757 
	`”rÜ
(
web
.
HTTPE¼Ü
:
	$Ãw
(405))

758 
’d


759 
£lf
:
	$´•¬e
()

760 
nÙ
 
£lf
.
_fšished
 
th’


761 -- 
If
 
th”e
 
is
 
no
 
URL
 
¬gs
 
th’
 dØ
nÙ
 
uÅack
 
as
 
this
 
has
 
a
 
signifiÿÁ


762 -- 
co¡
.

763 
loÿl
 
m‘hod
 = 
£lf
[£lf.
»que¡
.m‘hod:
	`low”
()]

764 
£lf
.
_u¾_¬gs
 
ªd
 #£lf._u¾_¬g > 0 
th’


765 
	`ty³
(
m‘hod
è=ğ"bË" 
th’


766 -- 
TabË
 
ba£d
 
»que¡
 
m‘hod
.

767 
m‘hod
.
´e
 
th’


768 
£lf
:
	$_execu‹_func_bË_uÅack
(
m‘hod
.
´e
)

769 
’d


770 
m‘hod
.
maš
 
th’


771 
£lf
:
	$_execu‹_func_bË_uÅack
(
m‘hod
.
maš
)

772 
’d


773 
m‘hod
.
po¡
 
th’


774 
£lf
:
	$_execu‹_func_bË_uÅack
(
m‘hod
.
po¡
)

775 
’d


777 
	`m‘hod
(
£lf
, 
	$uÅack
(
£lf
.
_u¾_¬gs
))

778 
’d


780 
	`ty³
(
m‘hod
è=ğ"bË" 
th’


781 -- 
TabË
 
ba£d
 
»que¡
 
m‘hod
.

782 
m‘hod
.
´e
 
th’


783 
£lf
:
	$_execu‹_func_bË
(
m‘hod
.
´e
)

784 
’d


785 
m‘hod
.
maš
 
th’


786 
£lf
:
	$_execu‹_func_bË
(
m‘hod
.
maš
)

787 
’d


788 
m‘hod
.
po¡
 
th’


789 
£lf
:
	$_execu‹_func_bË
(
m‘hod
.
po¡
)

790 
’d


792 -- 
Is
 
funùiÚ
 
ba£d
 
m‘hod
.

793 
	$m‘hod
(
£lf
)

794 
’d


795 
’d


796 
£lf
.
_auto_fšish
 
ªd
 
nÙ
 s–f.
_fšished
 
th’


797 
£lf
:
	$fšish
()

798 
’d


799 
’d


800 
’d


802 
loÿl
 
STATICWEBCACHE_MAX
 = 
_G
.
TURBO_STATIC_MAX
 
Ü
 1024*1024*1

803 
loÿl
 
SWCRC_CACHE
 = 0

804 
loÿl
 
SWCRC_TOO_BIG
 = 1

805 
loÿl
 
SWCRC_NOT_FOUND
 = -1

806 
loÿl
 
SWCT_CACHE
 = 0

807 
loÿl
 
SWCT_FILE
 = 1

808 
loÿl
 
SWCT_NOFILE
 = -1

809 --- 
Stic
 
fes
 
ÿche
 
şass
.

810 -- 
Fes
 
th©
 
dÛs
 
nÙ
 
exi¡
 
š
 
ÿche
 
¬e
 
added
 
to
 cach
Ú
 
fœ¡
 
»ad
.

811 
web
.
_SticWebCache
 = 
	`şass
("_StaticWebCache")

812 
funùiÚ
 
web
.
_SticWebCache
:
	$š™Ÿlize
()

813 
£lf
.
fes
 = {
	}
}

814 
’d


816 --- 
R—d
 
com¶‘e
 
fe
.

817 -- @
·¿m
 
	$·th
 (
SŒšg
è
P©h
 
to
 
fe
.

818 -- @ 0 + 
	$bufãr
 (
SŒšg
è
Ú
 
sucûss
, -1.

819 
funùiÚ
 
web
.
_SticWebCache
:
	$»ad_fe
(
·th
)

820 
loÿl
 
fd
, 
”r
 = 
io
.
	`İ’
(
·th
, "rb")

821 
nÙ
 
fd
 
th’


822  -1, 
”r


823 
’d


824 
loÿl
 
fe
 = 
fd
:
	`»ad
("*all")

825 
nÙ
 
fe
 
th’


826  -1, 
”r


827 
’d


828 
loÿl
 
sz
 = 
fe
:
	$Ën
()

829 
loÿl
 
buf
 = 
	$bufãr
(
sz
)

830 
buf
:
	$­³nd_right
(
fe
, 
sz
)

831 
loÿl
 
sha1sum
 = 
n


832 
_s¦_’abËd
 
th’


833 
loÿl
 
dige¡
 = 
hash
.
	$SHA1
(
fe
)

834 
dige¡
:
	$fš®ize
()

835 
sha1sum
 = 
dige¡
:
	$hex
()

836 
’d


837  0, 
buf
, 
sha1sum


838 
’d


840 --- 
G‘
 
fe
. 
If
 
nÙ
 
š
 
ÿche
, 
™
 
is
 
»ad
 
ªd
 
put
 iÀ
the
 
glob®
 
_SticWebCache


841 -- 
şass
.

842 -- @
	$·th
 (
SŒšg
è
P©h
 
to
 
fe
.

843 -- @ 0 + 
	$bufãr
 (
SŒšg
è
Ú
 
sucûss
, -1.

844 
funùiÚ
 
web
.
_SticWebCache
:
	$g‘_fe
(
·th
)

845 
loÿl
 
cf
 = 
£lf
.
fes
[
·th
]

847 -- 
FuÎ
 
·th
 
hash
 
lookup
.

848 
cf
 
ªd
 
STATICWEBCACHE_MAX
 ~ğ-1 
th’


849 -- 
šdex
 1 = 
ty³


850 -- 
šdex
 2 = 
¡©_t


851 -- 
šdex
 3 = 
buf
 
Ü
 
fe


852 -- 
šdex
 4 = 
mime
 
	`¡ršg
 (
İtiÚ®
)

853 -- 
šdex
 5 = 
sha1
 
checksum


854 
cf
[1] =ğ
SWCT_CACHE
 
th’


855  
SWCRC_CACHE
, 
cf
[2], cf[3], cf[4], cf[5]

856 
–£if
 
cf
[1] =ğ
SWCT_FILE
 
th’


857 
loÿl
 
fe
 = 
io
.
	`İ’
(
·th
, "rb")

858 
nÙ
 
fe
 
th’


859 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

861 
”r
))

862  
SWCRC_NOT_FOUND


863 
’d


864  
SWCRC_TOO_BIG
, 
cf
[2], 
fe
, cf[4]

865 
–£if
 
cf
[1] =ğ
SWCT_NOFILE
 
th’


866  
SWCRC_NOT_FOUND


867 
’d


868 
’d


870 -- 
NÙ
 
š
 
ÿche
, 
Ü
 
İ’ed
 
befÜe
.

871 
loÿl
 
¡©
, 
”r


872 
nÙ
 
¶©fÜm
.
__WINDOWS__
 
th’


873 
¡©
, 
”r
 = 
fs
.
	$¡©
(
·th
)

874 
¡©
 =ğ-1 
th’


875 
£lf
.
fes
[
·th
] = {
SWCT_NOFILE
}

876  
SWCRC_NOT_FOUND
 -- 
Fe
 
nÙ
 
found
.

877 
’d


879 
¡©
, 
”r
 = 
fs
.
	$©Œibu‹s
(
·th
)

880 
¡©
 =ğ
n
 
th’


881 
£lf
.
fes
[
·th
] = {
SWCT_NOFILE
}

882  
SWCRC_NOT_FOUND
 -- 
Fe
 
nÙ
 
found
.

883 
’d


884 -- 
Sm®l
 
»wr™e
 
of
 
bË
 
to
 
make
 
™
 
com·tibË
 
w™h
 
Lšux
 
¡©
.

885 
¡©
.
¡_size
 = st.
size


886 
’d


888 
¡©
.
¡_size
 > 
STATICWEBCACHE_MAX
 
th’


889 -- 
Fe
 
wl
 
nÙ
 
be
 
ÿched
 
beÿu£
 
of
 
size
.

890 -- 
O³n
 
fe
 
±r
 
š¡—d
.

891 
loÿl
 
rc
, 
mime
 = 
£lf
:
	$g‘_mime
(
·th
)

892 
rc
 =ğ0 
th’


893 
£lf
.
fes
[
·th
] = {
SWCT_FILE
, 
¡©
, 
n
, 
mime
}

895 
£lf
.
fes
[
·th
] = {
SWCT_FILE
, 
¡©
}

896 
’d


897 
loÿl
 
fe
, 
”r
 = 
io
.
İ’
(
·th
, "rb")

898 
nÙ
 
fe
 
th’


899 
log
.
”rÜ
(
¡ršg
.
fÜm©
(

901 
”r
))

902  
SWCRC_NOT_FOUND


903 
’d


904  
SWCRC_TOO_BIG
, 
¡©
, 
fe
, 
mime


905 
’d


906 -- 
Sm®l
 
size
, 
»Ïtive
 
to
 
STATICWEBCACHE_MAX
, 
lßd
 
fe
o

907 -- 
a
 
bufãr
.

908 
loÿl
 
rc
, 
buf
, 
sha1sum
 = 
£lf
:
	$»ad_fe
(
·th
)

909 
rc
 =ğ0 
th’


910 
loÿl
 
rc
, 
mime
 = 
£lf
:
	$g‘_mime
(
·th
)

911 
rc
 =ğ0 
th’


912 
£lf
.
fes
[
·th
] = {
SWCT_CACHE
, 
¡©
, 
buf
, 
mime
, 
sha1sum
}

914 
£lf
.
fes
[
·th
] = {
SWCT_CACHE
, 
¡©
, 
buf
, 
n
, 
sha1sum
}

915 
’d


916 
log
.
nÙiû
(
¡ršg
.
fÜm©
(

918 
·th
,

919 
tÚumb”
(
buf
:
	$Ën
())))

920  
SWCRC_CACHE
, 
¡©
, 
buf
, 
mime
, 
sha1sum


922 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

924 
buf
))

925  
SWCRC_NOT_FOUND


926 
’d


928 
’d


930 --- 
D‘”mše
 
MIME
 
ty³
 
accÜdšg
 
to
 
fe
 
ex¡’siÚ
.

931 -- @
”rÜ
 
If
 
no
 
f’ame
 
is
 
£t
, 
a
ƒ¼Ü i 
¿i£d
.

932 -- @ 0 + 
	$MIME
 (
SŒšg
è
Ú
 
sucûss
, -1.

933 
funùiÚ
 
web
.
_SticWebCache
:
	$g‘_mime
(
·th
)

934 
nÙ
 
·th
 
th’


935 
	`”rÜ
("No filename supliedo get_mime()")

936 
’d


937 
loÿl
 
·¹s
 = 
ut
.
	`¡r¥l™
(
·th
, ".")

938 #·¹ =ğ0 
th’


940 
’d


941 
loÿl
 
fe_’dšg
 = 
·¹s
[#parts]

942 
loÿl
 
mime_ty³
 = 
mime_ty³s
[
fe_’dšg
]

943 
mime_ty³
 
th’


944  0, 
mime_ty³


947 
’d


948 
’d


950 
STATIC_CACHE
 = 
web
.
_SticWebCache
:
	`Ãw
(è-- 
Glob®
 
ÿche
.

951 
web
.
STATIC_CACHE
 = STATIC_CACHE

953 --- 
Sim¶e
 
fe
 
hªdËr
 
şass
.

954 -- 
Fe
 
sy¡em
 
·th
 
is
 
´ovided
 
š
 
the
 
AµliÿtiÚ
 
şass
.

955 -- 
If
 
you
 
¬e
 
¶ªnšg
 
to
 
£rve
 
big
 
fes
, 
th’
 
™
 
is
 
»comm’ded
Ø
u£
 
a


956 -- 
´İ”
 
fe
 
web
 
£rv”
 
š¡—d
. 
FÜ
 
sm®l
 
fes
 
th©
 
ÿn
 
be
 
k•t


957 -- 
š
 
memÜy
 
™
 
is
 
ok
.

958 
web
.
SticFeHªdËr
 = 
	`şass
("SticFeHªdËr", web.
Reque¡HªdËr
)

959 
funùiÚ
 
web
.
SticFeHªdËr
:
	$´•¬e
()

960 
nÙ
 
£lf
.
İtiÚs
 
Ü
 
	`ty³
(£lf.İtiÚsè~ğ"¡ršg" 
th’


961 
	`”rÜ
("StaticFileHandler‚ot initialized with correct…arameters.")

962 
’d


963 
£lf
.
·th
 = s–f.
İtiÚs


964 -- 
Check
 
this
 
is
 
a
 
sšgË
 
fe
 
Ü
 
dœeùÜy
.

965 
loÿl
 
Ï¡_ch¬
 = 
£lf
.
·th
:
	`sub
(£lf.·th:
	$Ën
())

966 
Ï¡_ch¬
 ~ğ"/" 
th’


967 
£lf
.
fe
 = 
Œue


968 
’d


969 
’d


971 
funùiÚ
 
web
.
SticFeHªdËr
:
	$_h—d”s_æushed_cb
()

972 
£lf
.
»que¡
:
	$wr™e_z”o_cİy
(

973 
£lf
.
_¡©ic_bufãr
,

974 
£lf
.
fšish
,

975 
£lf
)

976 
’d


978 
funùiÚ
 
web
.
SticFeHªdËr
:
	$_£nd_Ãxt_chunk
()

979 
£lf
.
_fe_off£t
 =ğ£lf.
_fe_¡©
.
¡_size
 
th’


980 
£lf
.
_fe
:
	$şo£
()

981 
£lf
:
	$fšish
()

983 
’d


984 
loÿl
 
sz
 = 
m©h
.
	`mš
(1024*32, -- 32
KB
 
chunks
 
£ems
 
like
 
a
 
good
 
v®ue
?

985 
	`tÚumb”
(
£lf
.
_fe_¡©
.
¡_size
 - s–f.
_fe_off£t
))

986 
£lf
.
_fe_off£t
 = s–f._fe_off£ˆ+ 
sz


987 
loÿl
 
d©a
, 
”r
 = 
£lf
.
_fe
:
	$»ad
(
sz
)

988 
nÙ
 
d©a
 
th’


989 
log
.
	`”rÜ
(
¡ršg
.
	`fÜm©
(

991 
”r
))

992 
£lf
:
	$fšish
()

994 
’d


995 
nÙ
 
d©a
:
	`Ën
(è=ğ
sz
 
th’


996 
log
.
	`”rÜ
("[web.lua] Read size mismatch.")

997 
£lf
:
	$fšish
()

999 
’d


1000 
£lf
.
__fe_d©a_»f
 = 
d©a
 -- 
Make
 
su»
 
a
 
»ã»nû
 
to
 
¡ršg
 
is
 
k•t
.

1001 
£lf
.
»que¡
:
	`wr™e_z”o_cİy
(

1002 
	`bufã½Œ
(
ffi
.
	`ÿ¡
("cÚ¡ ch¬ *", 
d©a
), d©a:
	`Ën
()),

1003 
£lf
.
_£nd_Ãxt_chunk
,

1004 
£lf
)

1005 
’d


1007 
funùiÚ
 
web
.
SticFeHªdËr
:
	$_£nd_äom_fe
(
¡©
, 
fe
)

1008 
fe
:
	`£ek
("set")

1009 
£lf
.
_fe
 = 
fe


1010 
£lf
.
_fe_off£t
 = 0

1011 
£lf
.
_fe_¡©
 = 
¡©


1012 
£lf
:
	$æush
(
£lf
.
_£nd_Ãxt_chunk
, self)

1013 
’d


1015 --- 
GET
 
m‘hod
 
fe
 
hªdlšg
.

1016 -- @
·¿m
 
·th
 
The
…©h 
ÿ±u»d
 
äom
 
»que¡
.

1017 
funùiÚ
 
web
.
SticFeHªdËr
:
	$g‘
(
·th
)

1018 
loÿl
 
fuÎ_·th


1020 
£lf
:
	$£t_async
(
Œue
)

1021 
nÙ
 
£lf
.
fe
 
th’


1022 #£lf.
_u¾_¬gs
 =ğ0 
Ü
 
£lf
._u¾_¬gs[1]:
	`Ën
(è=ğ0 
th’


1023 
	`”rÜ
(
web
.
	$HTTPE¼Ü
(404))

1024 
’d


1025 
loÿl
 
f’ame
 = 
esÿ³
.
	$uÃsÿ³
(
£lf
.
_u¾_¬gs
[1])

1026 
f’ame
:
	`m©ch
("%.%.", 0, 
Œue
è
th’
 -- 
P»v’t
 
dœ
 
Œav”sšg
.

1027 
	`”rÜ
(
web
.
	$HTTPE¼Ü
(401))

1028 
’d


1029 
fuÎ_·th
 = 
¡ršg
.
	`fÜm©
("%s%s", 
£lf
.
·th
, 
f’ame
)

1031 
fuÎ_·th
 = 
£lf
.
·th


1032 
’d


1034 
loÿl
 
rc
, 
¡©
, 
buf
, 
mime
, 
sha1
 = 
STATIC_CACHE
:
	$g‘_fe
(
fuÎ_·th
)

1035 
mime
 
th’


1036 
£lf
:
	`add_h—d”
("CÚ‹Á-Ty³", 
mime
)

1037 
’d


1038 
sha1
 
th’


1039 -- 
Eg
 
check
.

1040 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("If-NÚe-M©ch"è=ğ
sha1
 
th’


1041 -- 
Cl›Á
 
has
 
the
 
mo¡
 
»ûÁ
 
fe
. 
Do
 
nÙ
 
£nd
 :).

1042 
£lf
:
	$£t_¡©us
(304)

1043 
£lf
:
	`add_h—d”
("Eg", 
sha1
)

1044 
£lf
:
	$fšish
()

1046 
’d


1047 
’d


1048 
rc
 =ğ
SWCRC_CACHE
 
th’


1049 
£lf
.
_¡©ic_bufãr
 = 
buf


1050 
£lf
.
h—d”s
:
	$£t_¡©us_code
(200)

1051 
£lf
.
h—d”s
:
	`£t_v”siÚ
("HTTP/1.1")

1052 
£lf
:
	`add_h—d”
("CÚ‹Á-L’gth", 
	`tÚumb”
(
buf
:
	$Ën
()))

1053 
sha1
 
th’


1054 
£lf
:
	`add_h—d”
("Eg", 
sha1
)

1055 
’d


1056 
£lf
:
	$æush
(
web
.
SticFeHªdËr
.
_h—d”s_æushed_cb
, 
£lf
)

1057 
–£if
 
rc
 =ğ
SWCRC_TOO_BIG
 
th’


1058 
£lf
.
h—d”s
:
	$£t_¡©us_code
(200)

1059 
£lf
.
h—d”s
:
	`£t_v”siÚ
("HTTP/1.1")

1060 
£lf
:
	`add_h—d”
("CÚ‹Á-L’gth", 
	$tÚumb”
(
¡©
.
¡_size
))

1061 
£lf
:
	$_£nd_äom_fe
(
¡©
, 
buf
)

1062 
–£if
 
rc
 =ğ
SWCRC_NOT_FOUND
 
th’


1063 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(404)è-- 
NÙ
 
found


1064 
’d


1065 
’d


1067 --- 
HEAD
 
m‘hod
 
fe
 
hªdlšg
.

1068 -- @
·¿m
 
·th
 
The
…©h 
ÿ±u»d
 
äom
 
»que¡
.

1069 
funùiÚ
 
web
.
SticFeHªdËr
:
	$h—d
(
·th
)

1070 #£lf.
_u¾_¬gs
 =ğ0 
Ü
 
£lf
._u¾_¬gs[1]:
	`Ën
(è=ğ0 
th’


1071 
	`”rÜ
(
web
.
	$HTTPE¼Ü
(404))

1072 
’d


1073 
loÿl
 
f’ame
 = 
£lf
.
_u¾_¬gs
[1]

1074 
f’ame
:
	`m©ch
("%.%.", 0, 
Œue
è
th’
 -- 
P»v’t
 
dœ
 
Œav”sšg
.

1075 
	`”rÜ
(
web
.
	$HTTPE¼Ü
(401))

1076 
’d


1077 
loÿl
 
fuÎ_·th
 = 
¡ršg
.
	`fÜm©
("%s%s", 
£lf
.
·th
,

1078 
esÿ³
.
	$uÃsÿ³
(
f’ame
))

1079 
loÿl
 
rc
, 
buf
, 
mime
 = 
STATIC_CACHE
:
	$g‘_fe
(
fuÎ_·th
)

1080 
rc
 =ğ0 
th’


1081 
mime
 
th’


1082 
£lf
:
	`add_h—d”
("CÚ‹Á-Ty³", 
mime_ty³
)

1083 
’d


1084 
£lf
:
	`add_h—d”
("CÚ‹Á-L’gth", 
	`tÚumb”
(
buf
:
	$Ën
()))

1086 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(404)è-- 
NÙ
 
found


1087 
’d


1088 
’d


1090 --- 
HTTPE¼Ü
 
şass
.

1091 -- 
This
 
”rÜ
 
is
 
¿i§bË
 
äom
 
Reque¡HªdËr
 
š¡ªûs
. 
It
 
´ovides
 
a


1092 -- 
cÚvš’t
 
ªd
 
§ã
 
way
 
to
 
hªdË
 
”rÜs
 
š
 
hªdËrs
. 
E
.
g
 
™
 
is
 
®lowed
o

1093 -- dØ
this
:

1094 -- 
funùiÚ
 
MyHªdËr
:
	`g‘
()

1095 -- 
loÿl
 
™em
 = 
£lf
:
	`g‘_¬gum’t
("item")

1096 -- 
nÙ
 
	$fšd_š_¡Üe
(
™em
è
th’


1097 -- 
	`”rÜ
(
turbo
.
web
.
	`HTTPE¼Ü
(400, "Could‚ot find item in store"))

1098 -- 
’d


1100 -- 
’d


1101 -- 
The
 
»suÉ
 
is
 
th©
 
the
 
¡©us
 
code
 i 
£t
 
to
 400 
ªd
h
mes§ge
 i 
£Á
 
as


1102 -- 
the
 
body
 
of
h
»que¡
. 
The
„eque¡ 
is
 
®ways
 
fšished
 
Ú
 
”rÜ
.

1103 
web
.
HTTPE¼Ü
 = 
	`şass
("HTTPError")

1104 
funùiÚ
 
web
.
HTTPE¼Ü
:
	$š™Ÿlize
(
code
, 
mes§ge
)

1105 
	`ty³
(
code
è~ğ"numb”" 
th’


1106 
	`”rÜ
("HTTPError code‡rgument must be‚umber.")

1107 
’d


1108 
£lf
.
code
 = code

1109 
£lf
.
mes§ge
 = mes§g
ªd
 mes§g
Ü
 
»¥Ú£_codes
[
code
]

1110 
’d


1112 --- 
CÏss
 
to
 
hªdout
 
HTTP
 
”rÜs
.

1113 -- 
IÁ”Çl
 
şass
 
to
 
´oduû
 
£nsibË
 
”rÜ
 
ouut
.

1114 
web
.
E¼ÜHªdËr
 = 
	`şass
("E¼ÜHªdËr", web.
Reque¡HªdËr
)

1116 
funùiÚ
 
web
.
E¼ÜHªdËr
:
	$š™Ÿlize
(
­p
, 
»que¡
, 
code
, 
mes§ge
)

1117 
web
.
Reque¡HªdËr
.
	$š™Ÿlize
(
£lf
, 
­p
, 
»que¡
)

1118 ià(
mes§ge
è
th’


1119 
£lf
:
	$wr™e
(
mes§ge
)

1121 
£lf
:
	$wr™e
(
»¥Ú£_codes
[
code
])

1122 
’d


1123 
£lf
:
	$£t_¡©us
(
code
)

1124 
£lf
:
	$fšish
()

1125 
’d


1127 --- 
Stic
 
»dœeù
 
hªdËr
 
th©
 
sim¶e
„edœeù 
the
 
ş›Á
 
to
h
giv’


1128 -- 
URL
 
š
 3
rd
 
¬gum’t
 
of
 
a
 
’Œy
 iÀ
the
 
AµliÿtiÚ
 
şass
's„outingable.

1129 -- 
Exam¶e
:

1130 -- 
loÿl
 
­¶iÿtiÚ
 = 
turbo
.
web
.
	`AµliÿtiÚ
({

1131 -- {"^/»dœeùÜ$", 
turbo
.
web
.
RedœeùHªdËr
, "http://turbolua.org"}

1132 -- 
	}
})

1133 
web
.
RedœeùHªdËr
 = 
şass
("RedœeùHªdËr", web.
Reque¡HªdËr
)

1134 
funùiÚ
 
	gweb
.
	gRedœeùHªdËr
:
	$´•¬e
()

1135 
nÙ
 
£lf
.
İtiÚs
 
Ü
 
	`ty³
(£lf.İtiÚsè~ğ"¡ršg" 
th’


1136 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(500,

1138 
’d


1139 
£lf
:
	$»dœeù
(
£lf
.
İtiÚs
, 
Œue
)

1140 
’d


1142 --- 
The
 
AµliÿtiÚ
 
şass
 
is
 
a
 
cŞËùiÚ
 
of
 
»que¡
 
hªdËr
 
şas£s
 
th©


1143 -- 
tog‘h”
 
make
 
up
 
a
 
web
 
­¶iÿtiÚ
. 
Exam¶e
:

1144 -- 
loÿl
 
­¶iÿtiÚ
 = 
turbo
.
web
.
	`AµliÿtiÚ
({

1145 -- {"^/¡©ic/(.*)$", 
turbo
.
web
.
SticFeHªdËr
, "/var/www/"},

1146 -- {"^/$", 
Exam¶eHªdËr
},

1147 -- {"^/™em/(%d*)", 
I‹mHªdËr
}

1148 -- 
	}
})

1149 -- 
The
 
cÚ¡ruùÜ
 
of
 
this
 
şass
 
kes
 
a
 â€œ
m­
â€ oà
URL
 
·‰”ns
 
ªd
 
theœ


1150 -- 
»¥eùive
 
hªdËrs
. 
The
 
thœd
 
–em’t
 
š
 
the
 
bË
 
¬e
 
İtiÚ®
 
·¿m‘”s


1151 -- 
the
 
hªdËr
 
şass
 
might
 
have
. 
This
 
could
 
be
 
a
 
sšgË
 
v®ue
 
Ü
‡ 
bË
.

1152 -- 
E
.
g
 
the
 
turbo
.
web
.
SticFeHªdËr
 
şass
 
kes
h
roÙ
 
·th
 
your


1153 -- 
hªdËr
.

1154 -- 
The
 
fœ¡
 
–em’t
 
š
 
the
 
bË
 
is
h
URL
 
th©
h
­¶iÿtiÚ
 
şass
 
m©ches


1155 -- 
šcomšg
 
»que¡
 
w™h
 
to
 
d‘”mše
 
which
 
hªdËr
 
™
 
should
 
be
 
£Á
o. 
The£


1156 -- 
URLs
 
sim¶y
 
be
 
a
 
URL
 
Ü
‡ 
ªy
 
kšd
 
of
 
Lua
 
·‰”n
. 
The
 
I‹mHªdËr
 URL

1157 -- 
·‰”n
 
is
 
ª
 
exam¶e
 
Ú
 
how
 
to
 
m­
 
numb”s
 
äom
 
URL
Ø
your
 
hªdËrs
.

1158 -- 
P©‹º
 
’ÿ£d
 
š
 
·¿Áhe£s
 
¬e
 
u£d
 
as
 
·¿m‘”s
 
wh’
 
ÿÎšg
 
the


1159 -- 
»que¡
 
m‘hods
 
š
 
Reque¡
 
hªdËrs
.

1160 
web
.
AµliÿtiÚ
 = 
şass
("Application")

1162 --- 
In™Ÿlize
 
a
 
Ãw
 
AµliÿtiÚ
 
şass
 
š¡ªû
.

1163 -- @
·¿m
 
	$hªdËrs
 (
TabË
è
As
 
desüibed
 
above
.

1165 -- @
·¿m
 
	$kw¬gs
 (
TabË
è
Key
 
wÜd
 
¬gum’ts
.

1166 -- 
Key
 
wÜd
 
¬gum’ts
 
suµÜ‹d
:

1167 -- "deçuÉ_ho¡" = 
Redœeù
 
to
 
this
 
URL
 
no
 
m©chšg
 
hªdËr
 
is
 
found
.

1168 -- "cook›_£ü‘" = 
Sequ’û
 
of
 
by‹s
 
u£d
 
to
 
sign
 
cook›s
.

1169 -- "£‰šgs" = 
Glob®
 
u£r
 
£‰šgs
 
th©
 
ÿn
 
be
 
acûs£d
 
š


1170 -- 
Reque¡HªdËr
'shrough self.application.settings

1171 
funùiÚ
 
web
.
AµliÿtiÚ
:
	$š™Ÿlize
(
hªdËrs
, 
kw¬gs
)

1172 
£lf
.
hªdËrs
 = hªdËr 
Ü
 {
	}
}

1173 
£lf
.
kw¬gs
 = kw¬g 
Ü
 {}

1174 
£lf
.
£‰šgs
 = s–f.
kw¬gs
.settings

1175 
£lf
.
deçuÉ_ho¡
 = s–f.
kw¬gs
.default_host

1176 
£lf
.
­¶iÿtiÚ_Çme
 = s–f.
kw¬gs
.­¶iÿtiÚ_Çm
Ü
 "Turbo.lua v2"

1177 
’d


1179 --- 
S‘s
 
the
 
£rv”
 
Çme
.

1180 -- @
·¿m
 
	$Çme
 (
SŒšg
è
S‘
 
the
 
£rv”
 
Çme
 
of
h
AµliÿtiÚ
.

1181 
funùiÚ
 
web
.
AµliÿtiÚ
:
	$£t_£rv”_Çme
(
Çme
)

1182 
£lf
.
­¶iÿtiÚ_Çme
 = 
Çme


1183 
’d


1185 --- 
R‘uºs
 
the
 
£rv”
 
Çme
.

1186 -- @ (
SŒšg
è
S”v”
 
Çme
.

1187 
funùiÚ
 
web
.
AµliÿtiÚ
:
	$g‘_£rv”_Çme
(è 
£lf
.
­¶iÿtiÚ_Çme
 
’d


1189 --- 
Add
 
hªdËr
 
to
 
AµliÿtiÚ
.

1190 -- @
·¿m
 
	$·‰”n
 (
SŒšg
è
Lua
 
·‰”n
 
¡ršg
.

1191 -- @
·¿m
 
	`hªdËr
 (
Reque¡HªdËr
 
şass
)

1192 -- @
·¿m
 
¬g
 
Argum’t
 
hªdËr
.

1193 
funùiÚ
 
web
.
AµliÿtiÚ
:
	$add_hªdËr
(
·‰”n
, 
hªdËr
, 
¬g
)

1194 
£lf
.
hªdËrs
[#£lf.hªdËr + 1] = {
·‰”n
, 
hªdËr
, 
¬g
}

1195 
’d


1197 --- 
S¹s
 
ª
 
HTTP
 
£rv”
 
this
 
­¶iÿtiÚ
 
Ú
 
the
 
giv’
 
pÜt
.

1198 -- 
This
 
is
 
»®ly
 
ju¡
 
a
 
cÚvš’û
 
m‘hod
. 
The
 
§me
 
efãù
 
ÿn
 
be
 
ach›ved


1199 -- 
by
 
ü—tšg
 
a
 
HTTPS”v”
 
şass
 
š¡ªû
 
ªd
 
assignšg
 
the
 
AµliÿtiÚ
 
to


1200 -- 
š¡ªû
 
to
 
™s
 
»que¡_ÿÎback
 
·¿m‘”
 
ªd
 
ÿÎšg
 it 
li¡’
()

1201 -- 
m‘hod
.

1202 -- @
·¿m
 
	$pÜt
 (
Numb”
è
PÜt
 
to
 
bšd
 
£rv”
o.

1203 -- @
·¿m
 
	$add»ss
 (
SŒšg
è
Add»ss
 
to
 
bšd
 
£rv”
o. 
E
.
g
 "127.0.0.1".

1204 -- @
·¿m
 
	$kw¬gs
 (
TabË
è
KeywÜd
 
¬gum’ts
 
·s£d
 
Ú
 
to


1205 -- ``
turbo
.
h‰p£rv”
.
HTTPS”v”
``. 
S“
 
docum’tiÚ
 
th©
 
şass
 

1206 -- 
avaabË
 
İtiÚs
.

1207 
funùiÚ
 
web
.
AµliÿtiÚ
:
	`li¡’
(
pÜt
, 
add»ss
, 
kw¬gs
)

1208 -- 
Key
 
wÜd
 
¬gum’ts
 
suµÜ‹d
:

1209 -- ** 
SSL
 
O±iÚs
 **

1210 -- 
To
 
’abË
 
SSL
 
»memb”
 
to
 
£t
 
the
 
_G
.
TURBO_SSL
 
glob®
.

1211 -- ``
key_fe
`` = 
SSL
 
key
 
fe
 
a
 SSL 
’abËd
 
£rv”
 
is
 
wª‹d
.

1212 -- ``
û¹_fe
`` = 
C”tifiÿ‹
 
fe
. 
key_fe
 
mu¡
 
®so
 
be
 
£t
.

1213 
loÿl
 
£rv”
 = 
h‰p£rv”
.
HTTPS”v”
:
	$Ãw
(
£lf
, 
n
,‚,‚, 
kw¬gs
)

1214 
£rv”
:
	$li¡’
(
pÜt
, 
add»ss
)

1215 
’d


1217 --- 
Fšd
 
a
 
m©chšg
 
»que¡
 
hªdËr
 
the
„eque¡ 
objeù
.

1218 -- 
Sim¶y
 
m©ch
 
the
 
URI
 
agaš¡
h
·‰”n
 
m©ches
 
suµl›d
 
to
h
AµliÿtiÚ


1219 -- 
şass
.

1220 -- @
·¿m
 
	$»que¡
 (
HTTPReque¡
 
š¡ªû
)

1221 
funùiÚ
 
web
.
AµliÿtiÚ
:
	$_g‘_»que¡_hªdËrs
(
»que¡
)

1222 
loÿl
 
·th
 = 
»que¡
.path

1223 
nÙ
 
·th
 
th’


1224 
·th
 = "/"

1225 
’d


1226 
loÿl
 
hªdËrs_sz
 = #£lf.
hªdËrs


1227 
i
 = 1, 
hªdËrs_sz
 do

1228 
loÿl
 
hªdËr
 = 
£lf
.
hªdËrs
[
i
]

1229 
loÿl
 
·‰”n
 = 
hªdËr
[1]

1230 
loÿl
 
m©ch
 = {
·th
:
	`m©ch
(
·‰”n
)
	}
}

1231 #m©ch > 0 
th’


1232  
hªdËr
[2], 
	gm©ch
, 
	ghªdËr
[3]

1233 
’d


1234 
’d


1235 
’d


1237 
loÿl
 
	g_¡r_bÜd”s_down
 = 
¡ršg
.
»p
("â–¼", 80)

1238 
loÿl
 
	g_¡r_bÜd”s_up
 = 
¡ršg
.
»p
("â–²", 80)

1239 --- 
EÁry
 
pošt
 
»que¡s
 
»ûive
 
by
 
	gHTTPS”v”
.

1240 -- @
·¿m
 
	$»que¡
 (
HTTPReque¡
 
š¡ªû
)

1241 
funùiÚ
 
web
.
AµliÿtiÚ
:
	$__ÿÎ
(
»que¡
)

1242 
loÿl
 
hªdËr
 = 
n


1243 
loÿl
 
hªdËrs
, 
¬gs
, 
İtiÚs
 = 
£lf
:
	$_g‘_»que¡_hªdËrs
(
»que¡
)

1244 
hªdËrs
 
th’


1245 
hªdËr
 = 
	$hªdËrs
(
£lf
, 
»que¡
, 
¬gs
, 
İtiÚs
)

1246 
loÿl
 
¡©us
, 
”r
 = 
	$pÿÎ
(
hªdËr
.
_execu‹
, handler)

1247 
”r
 
th’


1248 
	$š¡ªûOf
(
web
.
HTTPE¼Ü
, 
”r
è
th’


1249 
web
.
	$E¼ÜHªdËr
(
£lf
,

1250 
»que¡
,

1251 
”r
.
code
,

1252 
”r
.
mes§ge
)

1253 
–£if
 
	`ty³
(
”r
è=ğ"¡ršg" 
th’


1254 
loÿl
 
th»ad
 = 
cÜoutše
.
	$ruÂšg
()

1255 
loÿl
 
Œaû
 = 
debug
.
	`Œaûback
(
cÜoutše
.
	`ruÂšg
(), 
”r
, 2)

1257 
log
.
	`”rÜ
(

1258 
¡ršg
.
	`fÜm©
(

1260 
th»ad
,

1261 
_¡r_bÜd”s_down
,

1262 
Œaû
,

1263 
_¡r_bÜd”s_up
))

1264 
web
.
	`E¼ÜHªdËr
(

1265 
£lf
,

1266 
»que¡
,

1268 
¡ršg
.
	`fÜm©
('<pre style="font-size:12px; font-family:monospace; color:#8B0000;">[web.lua] Error in RequestHandler, %s is dead.\r\n%s\r\n%s\r\n%s</pre>',

1269 
th»ad
, 
_¡r_bÜd”s_down
, 
esÿ³
.
	`html_esÿ³
(
Œaû
), 
_¡r_bÜd”s_up
))

1271 
loÿl
 
th»ad
 = 
cÜoutše
.
	$ruÂšg
()

1272 
loÿl
 
Œaû
 = 
debug
.
	`Œaûback
(
cÜoutše
.
	`ruÂšg
(),

1273 
log
.
	`¡ršgify
(
”r
), 2)

1275 
log
.
	`”rÜ
(

1276 
¡ršg
.
	`fÜm©
(

1278 
th»ad
,

1279 
_¡r_bÜd”s_down
,

1280 
Œaû
,

1281 
_¡r_bÜd”s_up
))

1282 
web
.
	`E¼ÜHªdËr
(

1283 
£lf
,

1284 
»que¡
,

1286 
¡ršg
.
	`fÜm©
('<pre style="font-size:12px; font-family:monospace; color:#8B0000;">[web.lua] Unknownƒrror in RequestHandler, %s is dead.\r\n%s\r\n%s\r\n%s</pre>',

1287 
th»ad
, 
_¡r_bÜd”s_down
, 
esÿ³
.
	`html_esÿ³
(
Œaû
), 
_¡r_bÜd”s_up
))

1288 
’d


1289 
’d


1290 
–£if
 
nÙ
 
hªdËrs
 
ªd
 
£lf
.
deçuÉ_ho¡
 
th’


1291 
hªdËr
 = 
web
.
	$RedœeùHªdËr
(
£lf
, 
»que¡
, 
n
, s–f.
deçuÉ_ho¡
):
	$_execu‹
()

1293 
hªdËr
 = 
web
.
	$E¼ÜHªdËr
(
£lf
, 
»que¡
, 404)

1294 
’d


1295 
’d


1297  
web


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/websocket.lua

1 --- 
	gTurbo
.
lua
 
Websock‘
 
	gmoduË
.

3 -- 
Websock‘s
 
accÜdšg
 
to
 
the
 
	gRFC
 6455. 
	gh‰p
:

5 -- 
The
 
moduË
 
ofãrs
 
two
 
şas£s
:

6 -- * 
WebSock‘HªdËr
 - 
WebSock‘
 
suµÜt
 
turbo
.
web
.
AµliÿtiÚ
.

7 -- * 
WebSock‘Cl›Á
 - 
C®lback
 
ba£d
 
WebSock‘
 
ş›Á
.

8 -- 
BÙh
 
şas£s
 
u£s
 
the
 
mixš
 
şass
 
WebSock‘SŒ—m
, 
which
 
š
 
tuº
 
	g´ovides


9 -- 
®mo¡
 
id’tiÿl
 
	gAPI
's forhewo classes once connected. Both classes

10 -- 
suµÜt
 
SSL
 (
wss
:

12 -- 
NOTICE
: 
_G
.
TURBO_SSL
 
MUST
 
be
 
£t
 
to
 
Œue
 
ªd
 
O³nSSL
 
Ü
 
axTLS
 MUST be

13 -- 
š¡®Ëd
 
to
 
u£
 
this
 
moduË
.

15 -- 
Cİyright
 2013 
John
 
Ab¿ham£n


17 -- 
Liûn£d
 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

18 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

19 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


21 -- 
h‰p
:

23 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


24 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
ª
 "AS IS" 
BASIS
,

25 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

26 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


27 -- 
lim™©iÚs
 
und”
 
the
 
Liûn£
.

29 
loÿl
 
m©h
 = 
»quœe
 "math"

30 
loÿl
 
b™
 = 
j™
 
ªd
 
»quœe
 "b™" 
Ü
„equire "bit32"

31 
loÿl
 
ffi
 = 
»quœe
 "ffi"

32 
loÿl
 
log
 = 
»quœe
 "turbo.log"

33 
loÿl
 
h‰put
 = 
»quœe
 "turbo.httputil"

34 
loÿl
 
h‰p£rv”
 = 
»quœe
 "turbo.httpserver"

35 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

36 
loÿl
 
esÿ³
 = 
»quœe
 "turbo.escape"

37 
loÿl
 
ut
 = 
»quœe
 "turbo.util"

38 
loÿl
 
hash
 = 
»quœe
 "turbo.hash"

39 
loÿl
 
¶©fÜm
 = 
»quœe
 "turbo.platform"

40 
loÿl
 
web
 = 
»quœe
 "turbo.web"

41 
loÿl
 
async
 = 
»quœe
 "turbo.async"

42 
loÿl
 
bufãr
 = 
»quœe
 "turbo.structs.buffer"

43 
»quœe
('turbo.3rdparty.middleclass')

44 
loÿl
 
libturbo_·r£r
 = 
ut
.
	$lßd_libtffi
()

45 
loÿl
 
Ë
 = 
ffi
.
	`abi
("le")

46 
loÿl
 
be
 = 
nÙ
 
Ë


47 
loÿl
 
¡rf
 = 
¡ršg
.
fÜm©


48 
loÿl
 
bÜ
 = 
b™
.bor

49 
m©h
.
	`¿ndom£ed
(
ut
.
	$g‘timeofday
())

51 
loÿl
 
ENDIAN_SWAP_U64


52 
j™
 
ªd
 j™.
v”siÚ_num
 >ğ20100 
th’


53 
ENDIAN_SWAP_U64
 = 
	$funùiÚ
(
v®
)

54  
b™
.
	$bsw­
(
v®
)

55 
’d


57 -- 
OÆy
 
LuaJIT
 
v2
.1 
suµÜt
 64b
™
 
b™
 
sw­
.

58 -- 
U£
 
a
 
Çtive
 
C
 
funùiÚ
 
š¡—d
 
v2
.0.

59 
ENDIAN_SWAP_U64
 = 
	$funùiÚ
(
v®
)

60  
libturbo_·r£r
.
	$turbo_bsw­_u64
(
v®
)

61 
’d


62 
’d


64 
ffi
.
cdef
 [[

65 
	sws_h—d”
 {

66 
ušt8_t
 
æags
;

67 
ušt8_t
 
Ën
;

69 
ušt16_t
 
sh
;

70 
ušt64_t
 
Î
;

71 } 
ext_Ën
;

72 } 
	`__©Œibu‹__
 ((
__·cked__
));

75 
loÿl
 
_ws_h—d”
 = 
ffi
.
	`Ãw
("struct ws_header")

76 
loÿl
 
_ws_mask
 = 
ffi
.
	`Ãw
("int32_t[1]")

78 
loÿl
 
_unmask_·ylßd


79 
¶©fÜm
.
__WINDOWS__
 
th’


80 
_unmask_·ylßd
 = 
	$funùiÚ
(
mask32
, 
d©a
)

81 
loÿl
 
i
 = 
ffi
.
	`Ãw
("size_t", 0)

82 
loÿl
 
sz
 = 
d©a
:
	$Ën
()

83 
loÿl
 
buf
 = 
ffi
.
	`ÿ¡
("ch¬*", ffi.
C
.
	`m®loc
(
d©a
:
	$Ën
()))

84 
buf
 =ğ
n
 
th’


85 
	`”rÜ
("Could‚ot‡llocate memory for WebSocket frame masking.\
 failure.")

87 
’d


88 
d©a
 = 
ffi
.
	`ÿ¡
("char*", data)

89 
loÿl
 
mask
 = 
ffi
.
	`ÿ¡
("ch¬*", 
mask32
)

90 
i
 < 
sz
 do

91 
buf
[
i
] = 
b™
.
	`bxÜ
(
d©a
[i], 
mask
[i % 4])

92 
i
 = i + 1

93 
’d


94 
loÿl
 
¡r
 = 
ffi
.
	$¡ršg
(
buf
, 
sz
)

95 
ffi
.
C
.
	$ä“
(
buf
)

96  
¡r


97 
’d


99 
_unmask_·ylßd
 = 
	$funùiÚ
(
mask
, 
d©a
)

100 
loÿl
 
±r
 = 
libturbo_·r£r
.
	`turbo_websock‘_mask
(
mask
, 
d©a
, d©a:
	$Ën
())

101 
±r
 ~ğ
n
 
th’


102 
loÿl
 
¡r
 = 
ffi
.
	`¡ršg
(
±r
, 
d©a
:
	$Ën
())

103 
ffi
.
C
.
	$ä“
(
±r
)

104  
¡r


106 
	`”rÜ
("Could‚ot‡llocate memory for WebSocket frame masking.\
 failure.")

108 
’d


109 
’d


110 
’d


112 
loÿl
 
websock‘
 = {
	}
}

114 
websock‘
.
MAGIC
 = "258EAFA5-E914-47DA-95CA-C5AB0DC85B11"

116 --- 
Websock‘
 
İcodes
.

117 
websock‘
.
İcode
 = {

118 
CONTINUE
 = 0x0,

119 
TEXT
 = 0x1,

120 
BINARY
 = 0x2,

121 -- 0x3-7 
Re£rved


122 
CLOSE
 = 0x8,

123 
PING
 = 0x9,

124 
PONG
 = 0xA,

125 -- 0xB-
F
 
Re£rved


128 
websock‘
.
”rÜs
 = {

129 
INVALID_URL
 = -1 -- 
URL
 
could
 
nÙ
 
be
 
·r£d
.

130 ,
INVALID_SCHEMA
 = -2 -- 
Inv®id
 
URL
 
schema


131 ,
COULD_NOT_CONNECT
 = -3 -- 
Could
 
nÙ
 
cÚÃù
, 
check
 
mes§ge
.

132 ,
PARSE_ERROR_HEADERS
 = -4 -- 
Could
 
nÙ
 
·r£
 
»¥Ú£
 
h—d”s
.

133 ,
CONNECT_TIMEOUT
 = -5 -- 
CÚÃù
 
timed
 
out
.

134 ,
REQUEST_TIMEOUT
 = -6 -- 
Reque¡
 
timed
 
out
.

135 ,
NO_HEADERS
 = -7 -- 
ShouldÁ
 
h­³n
.

136 ,
REQUIRES_BODY
 = -8 -- 
Ex³ùed
 
a
 
HTTP
 
body
, 
but
 
nÚe
 
£t
.

137 ,
INVALID_BODY
 = -9 -- 
Reque¡
 
body
 
is
 
nÙ
 
a
 
¡ršg
.

138 ,
SOCKET_ERROR
 = -10 -- 
Sock‘
 
”rÜ
, 
check
 
mes§ge
.

139 ,
SSL_ERROR
 = -11 -- 
SSL
 
”rÜ
, 
check
 
mes§ge
.

140 ,
BUSY
 = -12 -- 
O³¿tiÚ
 
š
 
´og»ss
.

141 ,
REDIRECT_MAX
 = -13 -- 
Redœeù
 
maximum
 
»ached
.

142 ,
CALLBACK_ERROR
 = -14 -- 
E¼Ü
 
š
 
ÿÎback
.

143 ,
BAD_HTTP_STATUS
 = -15

144 ,
WEBSOCKET_PROTOCOL_ERROR
 = -16

147 --- 
WebSock‘SŒ—m
 
is
 
a
 
ab¡¿ùiÚ
 ¨
WebSock‘
 
cÚÃùiÚ
,

148 -- 
u£d
 
as
 
şass
 
mixš
 
š
 
WebSock‘HªdËr
 
ªd
 
WebSock‘Cl›Á
.

149 
websock‘
.
WebSock‘SŒ—m
 = {}

151 --- 
S’d
 
a
 
mes§ge
 
to
 
the
 
ş›Á
 
of
h
aùive
 
Websock‘
.

152 -- @
·¿m
 
msg
 
The
 
mes§ge
 
to
 
£nd
. 
This
 
may
 
be
 
e™h”
 
a
 
JSON
-
£rŸlizabË
 
bË


153 -- 
Ü
 
a
 
¡ršg
.

154 -- @
·¿m
 
	$bš¬y
 (
BoŞ—n
è
T»©
 
the
 
mes§ge
 
as
 
bš¬y
 
	`d©a
 (
u£
 
WebSock‘
 binary

155 -- 
İcode
).

156 -- 
If
 
the
 
cÚÃùiÚ
 
has
 
b“n
 
şo£d
 
a
 
”rÜ
 
is
 
¿i£d
.

157 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$wr™e_mes§ge
(
msg
, 
bš¬y
)

158 
£lf
.
_şo£d
 =ğ
Œue
 
th’


159 
	`”rÜ
("WebSocket connection has been closed. Can‚ot write message.")

160 
’d


161 
	`ty³
(
msg
è=ğ"bË" 
th’


162 
msg
 = 
esÿ³
.
	$jsÚ_’code
(
msg
)

163 
’d


164 
£lf
:
	$_£nd_äame
(
Œue
,

165 
bš¬y
 
ªd


166 
websock‘
.
İcode
.
BINARY
 
Ü
 websock‘.İcode.
TEXT
,

167 
msg
)

168 
’d


170 --- 
S’d
 
a
 
pÚg
 
»¶y
 
to
 
the
 
£rv”
.

171 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$pÚg
(
d©a
)

172 
£lf
:
	$_£nd_äame
(
Œue
, 
websock‘
.
İcode
.
PONG
, 
d©a
)

173 
’d


175 --- 
S’d
 
a
 
pšg
 
to
 
the
 
cÚÃùed
 
ş›Á
.

176 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$pšg
(
d©a
, 
ÿÎback
, 
ÿÎback_¬g
)

177 
£lf
.
_pšg_ÿÎback
 = 
ÿÎback


178 
£lf
.
_pšg_ÿÎback_¬g
 = 
ÿÎback_¬g


179 
£lf
:
	$_£nd_äame
(
Œue
, 
websock‘
.
İcode
.
PING
, 
d©a
)

180 
’d


182 --- 
Clo£
 
the
 
cÚÃùiÚ
.

183 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$şo£
()

184 
£lf
.
_şo£d
 = 
Œue


185 
loÿl
 
_£lf
 = 
£lf


186 
£lf
:
	`_£nd_äame
(
Œue
, 
websock‘
.
İcode
.
CLOSE
, "", 
	$funùiÚ
()

187 
_£lf
.
¡»am
:
	$şo£
()

188 
’d
)

189 
’d


191 --- 
Is
 
the
 
WebSock‘SŒ—m
 
şo£d
?

192 -- @ 
Œue
 
şo£d
, 
Ùh”wi£
 
n
.

193 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$şo£d
()

194  
£lf
.
_şo£d


195 
’d


197 --- 
Acû±
 
a
 
Ãw
 
WebSock‘
 
äame
.

198 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$_acû±_äame
(
h—d”
)

199 
loÿl
 
ws_h—d”
 = 
ffi
.
	`ÿ¡
("¡ruù ws_h—d” *", 
h—d”
)

200 
£lf
.
_fš®_b™
 = 
b™
.
	`bªd
(
ws_h—d”
.
æags
, 0x80) ~= 0

201 
£lf
.
_rsv1_b™
 = 
b™
.
	`bªd
(
ws_h—d”
.
æags
, 0x40) ~= 0

202 
£lf
.
_rsv2_b™
 = 
b™
.
	`bªd
(
ws_h—d”
.
æags
, 0x20) ~= 0

203 
£lf
.
_rsv3_b™
 = 
b™
.
	`bªd
(
ws_h—d”
.
æags
, 0x10) ~= 0

204 
£lf
.
_İcode
 = 
b™
.
	$bªd
(
ws_h—d”
.
æags
, 0xf)

205 
£lf
.
_mask_b™
 = 
b™
.
	`bªd
(
ws_h—d”
.
Ën
, 0x80) ~= 0

206 
loÿl
 
·ylßd_Ën
 = 
b™
.
	$bªd
(
ws_h—d”
.
Ën
, 0x7f)

207 
£lf
.
_İcode
 =ğ
websock‘
.
İcode
.
CLOSE
 
ªd
 
·ylßd_Ën
 >ğ126 
th’


208 
£lf
:
	`_”rÜ
(

212 
’d


213 
·ylßd_Ën
 < 126 
th’


214 
£lf
.
_·ylßd_Ën
 = 
·ylßd_Ën


215 
£lf
.
_mask_b™
 
th’


216 
£lf
.
¡»am
:
	$»ad_by‹s
(4, 
£lf
.
_äame_mask_key
, self)

218 
£lf
.
¡»am
:
	$»ad_by‹s
(
£lf
.
_·ylßd_Ën
,

219 
£lf
.
_äame_·ylßd
,

220 
£lf
)

221 
’d


222 
–£if
 
·ylßd_Ën
 =ğ126 
th’


223 -- 16 
b™
 
Ëngth
.

224 
£lf
.
¡»am
:
	$»ad_by‹s
(2, 
£lf
.
_äame_Ën_16
, self)

225 
–£if
 
·ylßd_Ën
 =ğ127 
th’


226 -- 64 
b™
 
Ëngth
.

227 
£lf
.
¡»am
:
	$»ad_by‹s
(8, 
£lf
.
_äame_Ën_64
, self)

228 
’d


229 
’d


231 
Ë
 
th’


232 
loÿl
 
_tmp_cÚv”t_16
 = 
ffi
.
	`Ãw
("uint16_t[1]")

233 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	`_äame_Ën_16
(
d©a
)

234 -- 
N‘wÜk
 
by‹
 
Üd”
 
muÉi
-by‹ 
Ëngth
 
v®ues
.

235 -- 
Wh©
 
w”e
 
they
 
thškšg
!

236 
ffi
.
	$cİy
(
_tmp_cÚv”t_16
, 
d©a
, 2)

237 
£lf
.
_·ylßd_Ën
 = 
	`tÚumb”
(
ffi
.
C
.
	$Áohs
(
_tmp_cÚv”t_16
[0]))

238 
£lf
.
_mask_b™
 
th’


239 
£lf
.
¡»am
:
	$»ad_by‹s
(4, 
£lf
.
_äame_mask_key
, self)

241 
£lf
.
¡»am
:
	$»ad_by‹s
(
£lf
.
_·ylßd_Ën
,

242 
£lf
.
_äame_·ylßd
,

243 
£lf
)

244 
’d


245 
’d


247 
loÿl
 
_tmp_cÚv”t_64
 = 
ffi
.
	`Ãw
("uint64_t[1]")

248 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$_äame_Ën_64
(
d©a
)

249 
ffi
.
	$cİy
(
_tmp_cÚv”t_64
, 
d©a
, 8)

250 
£lf
.
_·ylßd_Ën
 = 
	`tÚumb”
(

251 
	$ENDIAN_SWAP_U64
(
_tmp_cÚv”t_64
[0]))

252 
£lf
.
_mask_b™
 
th’


253 
£lf
.
¡»am
:
	$»ad_by‹s
(4, 
£lf
.
_äame_mask_key
, self)

255 
£lf
.
¡»am
:
	$»ad_by‹s
(
£lf
.
_·ylßd_Ën
,

256 
£lf
.
_äame_·ylßd
,

257 
£lf
)

258 
’d


259 
’d


260 
–£if
 
be
 
th’


261 -- 
FIXME
: 
C»©e
 
funcs
 
BE
.

262 
’d


264 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$_äame_mask_key
(
d©a
)

265 
£lf
.
_äame_mask
 = 
d©a


266 
£lf
.
¡»am
:
	$»ad_by‹s
(
£lf
.
_·ylßd_Ën
, s–f.
_masked_äame_·ylßd
, self)

267 
’d


269 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$_masked_äame_·ylßd
(
d©a
)

270 
loÿl
 
unmasked
 = 
	$_unmask_·ylßd
(
£lf
.
_äame_mask
, 
d©a
)

271 
£lf
:
	$_äame_·ylßd
(
unmasked
)

272 
’d


274 
Ë
 
th’


275 -- 
MuÉi
-
by‹
 
Ëngths
 
mu¡
 
be
 
£Á
 
š
 
ÃtwÜk
 by‹ 
Üd”
, 
aka


276 -- 
big
-
’dŸn
. 
Ugh
...

277 
funùiÚ
 
websock‘
.
WebSock‘SŒ—m
:
	$_£nd_äame
(
fšæag
, 
İcode
, 
d©a
,

278 
ÿÎback
, 
ÿÎback_¬g
)

279 
£lf
.
¡»am
:
	$şo£d
(è
th’


281 
’d


283 
loÿl
 
d©a_sz
 = 
d©a
:
	$Ën
()

284 
_ws_h—d”
.
æags
 = 
b™
.
	`bÜ
(
fšæag
 
ªd
 0x80 
Ü
 0x0, 
İcode
)

286 -- 7 
b™
.

287 
d©a_sz
 < 0x7
th’


288 
_ws_h—d”
.
Ën
 = 
b™
.
	$bÜ
(
d©a_sz
,

289 
£lf
.
mask_outgošg
 
ªd
 0x80 
Ü
 0x0)

290 
£lf
.
¡»am
:
	`wr™e
(
ffi
.
	`¡ršg
(
_ws_h—d”
, 2))

292 -- 16 
b™


293 
–£if
 
d©a_sz
 <ğ0xfffà
th’


294 
_ws_h—d”
.
Ën
 = 
b™
.
	$bÜ
(126, 
£lf
.
mask_outgošg
 
ªd
 0x80 
Ü
 0x0)

295 
_ws_h—d”
.
ext_Ën
.
sh
 = 
d©a_sz


296 
_ws_h—d”
.
ext_Ën
.
sh
 = 
ffi
.
C
.
	$htÚs
(
_ws_h—d”
.
ext_Ën
.
sh
)

297 
£lf
.
¡»am
:
	`wr™e
(
ffi
.
	`¡ršg
(
_ws_h—d”
, 4))

299 -- 64 
b™


301 
_ws_h—d”
.
Ën
 = 
b™
.
	$bÜ
(127, 
£lf
.
mask_outgošg
 
ªd
 0x80 
Ü
 0x0)

302 
_ws_h—d”
.
ext_Ën
.
Î
 = 
d©a_sz


303 
_ws_h—d”
.
ext_Ën
.
Î
 = 
	$ENDIAN_SWAP_U64
(
_ws_h—d”
.
ext_Ën
.
Î
)

304 
£lf
.
¡»am
:
	`wr™e
(
ffi
.
	$¡ršg
(
_ws_h—d”
, 10))

305 
’d


307 
£lf
.
mask_outgošg
 =ğ
Œue
 
th’


308 -- 
C»©e
 
a
 
¿ndom
 
mask
.

309 
loÿl
 
ws_mask
 = 
ffi
.
	`Ãw
("unsigned char[4]")

310 
ws_mask
[0] = 
m©h
.
	$¿ndom
(0x0, 0xff)

311 
ws_mask
[1] = 
m©h
.
	$¿ndom
(0x0, 0xff)

312 
ws_mask
[2] = 
m©h
.
	$¿ndom
(0x0, 0xff)

313 
ws_mask
[3] = 
m©h
.
	$¿ndom
(0x0, 0xff)

314 
£lf
.
¡»am
:
	`wr™e
(
ffi
.
	$¡ršg
(
ws_mask
, 4))

315 
£lf
.
¡»am
:
	`wr™e
(
	`_unmask_·ylßd
(
ws_mask
, 
d©a
), 
ÿÎback
, 
ÿÎback_¬g
)

317 
’d


319 -- 
Do
 
nÙ
  
uÁ
 
wr™e
 
is
 
æushed
 
to
 
io¡»am
 :).

320 
£lf
.
¡»am
:
	$wr™e
(
d©a
, 
ÿÎback
, 
ÿÎback_¬g
)

321 
’d


322 
–£if
 
be
 
th’


323 -- 
TODO
: 
ü—‹
 
websock‘
.
WebSock‘SŒ—m
:
_£nd_äame
 
BE
.

324 
’d


327 --- 
WebSock‘
 
S”v”


328 -- 
Mu¡
 
be
 
u£d
 
š
 
turbo
.
web
.
AµliÿtiÚ
.

329 
websock‘
.
WebSock‘HªdËr
 = 
	`şass
("WebSock‘HªdËr", 
web
.
Reque¡HªdËr
)

330 
websock‘
.
WebSock‘HªdËr
:
	$šşude
(
websock‘
.
WebSock‘SŒ—m
)

332 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$š™Ÿlize
(
­¶iÿtiÚ
,

333 
»que¡
,

334 
u¾_¬gs
,

335 
İtiÚs
)

336 
web
.
Reque¡HªdËr
.
	$š™Ÿlize
(
£lf
, 
­¶iÿtiÚ
, 
»que¡
, 
u¾_¬gs
, 
İtiÚs
)

337 
£lf
.
¡»am
 = 
»que¡
.
cÚÃùiÚ
.stream

338 
’d


340 --- 
C®Ëd
 
wh’
 
a
 
Ãw
 
websock‘
 
»que¡
 
is
 
İ’ed
.

341 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$İ’
(è
’d


343 --- 
C®Ëd
 
wh’
 
a
 
mes§ge
 
is
 
»ûive
.

344 -- @
·¿m
 
	$msg
 (
SŒšg
è
The
 
»ûive
 
mes§ge
.

345 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$Ú_mes§ge
(
msg
è
’d


347 --- 
C®Ëd
 
wh’
 
the
 
cÚÃùiÚ
 
is
 
şo£d
.

348 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$Ú_şo£
(è
’d


350 --- 
C®Ëd
 
wh’
 
a
 
”rÜ
 
is
 
¿i£d
.

351 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$Ú_”rÜ
(
msg
è
’d


353 --- 
C®Ëd
 
wh’
 
the
 
h—d”s
 
has
 
b“n
 
·r£d
 
ªd
h
£rv”
 
is
 
about
 
to
 
š™Ÿ‹


354 -- 
the
 
WebSock‘
 
¥ecific
 
hªdshake
. 
U£
 
this
 
to
 
e
.
g
 
check
 th
h—d”s


355 -- 
Origš
 
f›ld
 
m©ches
 
wh©
 
you
 
ex³ù
.

356 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$´•¬e
(è
’d


358 --- 
C®Ëd
 
the
 
ş›Á
 
have
 
šşuded
 
a
 
Sec
-
WebSock‘
-
PrÙocŞ
 
f›ld


359 -- 
š
 
h—d”
. 
This
 
m‘hod
 
wl
 
th’
 
»ûive
 
a
 
bË
 
of
 
´ÙocŞs
 
th©


360 -- 
the
 
ş›Ás
 
wªts
 
to
 
u£
. 
If
 
this
 
f›ld
 
is
 
nÙ
 
£t
,hi 
m‘hod
 
wl


361 -- 
Ãv”
 
be
 
ÿÎed
. 
The
  
v®ue
 
of
 
this
 
m‘hod
 
should
 b
a
 
¡ršg


362 -- 
which
 
m©ches
 
Úe
 
of
 
the
 
sugge¡ed
 
´ÙcŞs
 
š
 
™s
 
·¿m‘”
.

363 -- 
If
 
®l
 
of
 
the
 
sugge¡ed
 
´ÙocŞs
 
¬e
 
uÇcû±abË
 
th’
 
dismissšg
 of

364 -- 
the
 
»que¡
 
is
 
dÚe
 
by
 
e™h”
 
¿isšg
 
”rÜ
 
Ü
 
»tuºšg
 
n
.

365 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$sub´ÙocŞ
(
´ÙocŞs
è
’d


367 --- 
Maš
 
’Œy
 
pošt
 
the
 
AµliÿtiÚ
 
şass
.

368 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_execu‹
()

369 
£lf
.
»que¡
.
m‘hod
 ~ğ"GET" 
th’


370 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(

373 
’d


374 
loÿl
 
upg¿de
 = 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("Upgrade")

375 
nÙ
 
upg¿de
 
Ü
 upg¿de:
	`low”
(è~ğ"websock‘" 
th’


376 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(

379 
’d


380 
£lf
.
£c_websock‘_key
 = s–f.
»que¡
.
h—d”s
:
	`g‘
("Sec-WebSocket-Key")

381 
nÙ
 
£lf
.
£c_websock‘_key
 
th’


382 
log
.
	`”rÜ
("Client did‚ot send‡ Sec-WebSocket-Key field. \
‚ot‡ Websocket„equets, can‚ot upgrade.")

384 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(400, "Invalid…rotocol."))

385 
’d


386 
£lf
.
£c_websock‘_v”siÚ
 =

387 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("Sec-WebSocket-Version")

388 
nÙ
 
£lf
.
£c_websock‘_v”siÚ
 
th’


389 
log
.
	`”rÜ
("Client did‚ot send‡ Sec-WebSocket-Version field. \
‚ot‡ Websocket„equest, can‚ot upgrade.")

391 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(400,"Invalid…rotocol."))

392 
’d


393 
£lf
.
£c_websock‘_v”siÚ
 ~ğ"13" 
th’


394 
log
.
	`”rÜ
(
	`¡rf
(

395 "Cl›Á wªt tØu£‚Ù im¶em’‹d Websock‘ V”siÚ %s.\
‚Ù upg¿de.", 
£lf
.
£c_websock‘_v”siÚ
))

397 -- 
Prİo£
 
a
 
¥ecific
 
v”siÚ
 
the
 
ş›Á
...

398 
£lf
:
	`add_h—d”
("Sec-WebSocket-Version", "13")

399 
£lf
:
	$£t_¡©us_code
(426)

400 
£lf
:
	$fšish
()

402 
’d


403 
loÿl
 
´Ù
 = 
£lf
.
»que¡
.
h—d”s
:
	`g‘
("Sec-WebSocket-Protocol")

404 
´Ù
 
th’


405 
´Ù
 = 
ut
.
	`¡r¥l™
(prot, ",")

406 
i
=1, #prot do

407 
´Ù
[
i
] = 
esÿ³
.
	$Œim
(
´Ù
[
i
])

408 
’d


409 #´Ù ~ğ0 
th’


410 
loÿl
 
£Ëùed_´ÙocŞ
 = 
£lf
:
	$sub´ÙocŞ
(
´Ù
)

411 
nÙ
 
£Ëùed_´ÙocŞ
 
th’


412 
log
.
	`w¬nšg
(

414 
	`”rÜ
(
web
.
	`HTTPE¼Ü
(400, "Invalid subprotocol."))

415 
’d


416 
£lf
.
sub´ÙocŞ
 = 
£Ëùed_´ÙocŞ


417 
’d


418 
’d


419 -- 
Origš
 
ÿn
 
be
 
u£d
 
by
 
ş›Á
 
­¶iÿtiÚs
 
to
 
e™h”
 
acû±
 
Ü
 
d’y


420 -- 
a
 
»que¡
. 
This
 
»¥Úsib™y
 
is
 
Ëá
 
up
 
to
 
—ch
 
dev–İ”
Ø
hªdË


421 -- 
š
 
e
.
g
 
the
 
	$´•¬e
(è
m‘hod
.

422 
£lf
.
Üigš
 = s–f.
»que¡
.
h—d”s
:
	`g‘
("Origin")

423 
£lf
:
	$´•¬e
()

424 
loÿl
 
»¥Ú£_h—d”
 = 
£lf
:
	$_ü—‹_»¥Ú£_h—d”
()

425 
£lf
.
¡»am
:
	`wr™e
(
»¥Ú£_h—d”
.."\r\n")

426 -- 
HTTP
 
h—d”s
 
»ad
, 
chªge
 
to
 
WebSock‘
 
´ÙocŞ
.

427 -- 
S‘
 
max
 
bufãr
 
size
 
to
 64
MB
 
as
 
™
 
is
 16
KB
 
©
 
this
 
pošt
...

428 
£lf
.
¡»am
:
	$£t_max_bufãr_size
(1024*1024*64)

429 
log
.
	`sucûss
(
¡ršg
.
	`fÜm©
([[[
websock‘
.
lua
] 
WebSock‘
 
İ’ed
 %
	`s
 (%
s
)]],

430 
£lf
.
»que¡
.
h—d”s
:
	`g‘_u¾
(),

431 
£lf
.
»que¡
.
»mÙe_
))

432 
£lf
:
	$_cÚtšue_ws
()

433 
’d


435 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_ÿlcuÏ‹_ws_acû±
()

436 
	`as£¹
(
esÿ³
.
	$ba£64_decode
(
£lf
.
£c_websock‘_key
):
	`Ën
() == 16,

438 
loÿl
 
hash
 = hash.
	$SHA1
(
£lf
.
£c_websock‘_key
..
websock‘
.
MAGIC
)

439  
esÿ³
.
	`ba£64_’code
(
hash
:
	`fš®ize
(), 20)

440 
’d


442 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_ü—‹_»¥Ú£_h—d”
()

443 
loÿl
 
h—d”
 = 
h‰put
.
	$HTTPH—d”s
()

444 
h—d”
:
	$£t_¡©us_code
(101)

445 
h—d”
:
	`£t_v”siÚ
("HTTP/1.1")

446 
h—d”
:
	`add
("Server", "Turbo v1.1")

447 
h—d”
:
	`add
("Upgrade", "websocket")

448 
h—d”
:
	`add
("Connection", "Upgrade")

449 
h—d”
:
	`add
("Sec-WebSock‘-Acû±", 
£lf
:
	$_ÿlcuÏ‹_ws_acû±
())

450 
	`ty³
(
£lf
.
sub´ÙocŞ
è=ğ"¡ršg" 
th’


451 -- 
S‘
 
u£r
 
£Ëùed
 
sub´ÙocŞ
 
¡ršg
.

452 
h—d”
:
	`add
("Sec-WebSock‘-PrÙocŞ", 
£lf
.
sub´ÙocŞ
)

453 
’d


454  
h—d”
:
	$¡ršgify_as_»¥Ú£
()

455 
’d


457 --- 
E¼Ü
 
hªdËr
.

458 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_”rÜ
(
msg
)

459 
log
.
	`”rÜ
("[websock‘.lua] "..
msg
)

460 
nÙ
 
£lf
.
_şo£d
 =ğ
Œue
 
ªd
‚Ù s–f.
¡»am
:
	$şo£d
(è
th’


461 
£lf
:
	$şo£
()

462 
’d


463 
£lf
:
	$Ú_”rÜ
(
msg
)

464 
’d


466 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_sock‘_şo£d
()

467 
log
.
	`sucûss
(
¡ršg
.
	`fÜm©
([[[
websock‘
.
lua
] 
WebSock‘
 
şo£d
 %
	`s
 (%
s
è%
dms
]],

468 
£lf
.
»que¡
.
h—d”s
:
	`g‘_u¾
(),

469 
£lf
.
»que¡
.
»mÙe_
,

470 
£lf
.
»que¡
:
	$»que¡_time
()))

471 
£lf
:
	$Ú_şo£
()

472 
’d


474 --- 
C®Ëd
 
aá”
 
HTTP
 
hªdshake
 
has
 
·s£d
 
ªd
 
cÚÃùiÚ
 ha 
b“n
 
upg¿ded


475 -- 
to
 
WebSock‘
.

476 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_cÚtšue_ws
()

477 
£lf
.
¡»am
:
	$£t_şo£_ÿÎback
(
£lf
.
_sock‘_şo£d
, self)

478 
£lf
.
_äagm’‹d_mes§ge_bufãr
 = 
	$bufãr
(1024)

479 
£lf
.
¡»am
:
	$»ad_by‹s
(2, 
£lf
.
_acû±_äame
, self)

480 
£lf
:
	$İ’
()

481 
’d


483 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_äame_·ylßd
(
d©a
)

484 
loÿl
 
İcode


485 
£lf
.
_İcode
 =ğ
websock‘
.
İcode
.
CLOSE
 
th’


486 
nÙ
 
£lf
.
_fš®_b™
 
th’


487 
£lf
:
	`_”rÜ
(

491 
’d


492 
İcode
 = 
£lf
.
_İcode


493 
–£if
 
£lf
.
_İcode
 =ğ
websock‘
.
İcode
.
CONTINUE
 
th’


494 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	`Ën
(è=ğ0 
th’


495 
£lf
:
	`_”rÜ
(

499 
’d


500 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$­³nd_lua¡r_right
(
d©a
)

501 
£lf
.
_fš®_b™
 =ğ
Œue
 
th’


502 
İcode
 = 
£lf
.
_äagm’‹d_mes§ge_İcode


503 
d©a
 = 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$__to¡ršg
()

504 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$ş—r
()

505 
£lf
.
_äagm’‹d_mes§ge_İcode
 = 
n


506 
’d


508 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	`Ën
(è~ğ0 
th’


509 
£lf
:
	`_”rÜ
(

513 
’d


514 
£lf
.
_fš®_b™
 =ğ
Œue
 
th’


515 
İcode
 = 
£lf
.
_İcode


517 
£lf
.
_äagm’‹d_mes§ge_İcode
 = s–f.
_İcode


518 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$­³nd_lua¡r_right
(
d©a
)

519 
d©a
:
	`Ën
(è=ğ0 
th’


520 
log
.
	`debug
("Zero†ength data on WebSocket.")

521 
’d


522 
’d


523 
’d


524 
£lf
.
_fš®_b™
 =ğ
Œue
 
th’


525 
£lf
:
	$_hªdË_İcode
(
İcode
, 
d©a
)

526 
’d


527 
£lf
.
_şo£d
 ~ğ
Œue
 
th’


528 
£lf
.
¡»am
:
	$»ad_by‹s
(2, 
£lf
.
_acû±_äame
, self)

529 
’d


530 
’d


532 
funùiÚ
 
websock‘
.
WebSock‘HªdËr
:
	$_hªdË_İcode
(
İcode
, 
d©a
)

533 
£lf
.
_şo£d
 =ğ
Œue
 
th’


535 
’d


536 
İcode
 =ğ
websock‘
.İcode.
TEXT
 
Ü


537 
İcode
 =ğ
websock‘
.İcode.
BINARY
 
th’


538 
£lf
:
	$Ú_mes§ge
(
d©a
)

539 
–£if
 
İcode
 =ğ
websock‘
.İcode.
CLOSE
 
th’


540 
£lf
:
	$şo£
()

541 
–£if
 
İcode
 =ğ
websock‘
.İcode.
PING
 
th’


542 
£lf
:
	$_£nd_äame
(
Œue
, 
websock‘
.
İcode
.
PONG
, 
d©a
)

543 
–£if
 
İcode
 =ğ
websock‘
.İcode.
PONG
 
th’


544 
£lf
.
_pšg_ÿÎback
 
th’


545 
loÿl
 
ÿÎback
 = 
£lf
.
_pšg_ÿÎback


546 
loÿl
 
¬g
 = 
£lf
.
_pšg_ÿÎback_¬g


547 
£lf
.
_pšg_ÿÎback
 = 
n


548 
£lf
.
_pšg_ÿÎback_¬g
 = 
n


549 
¬g
 
th’


550 
	$ÿÎback
(
¬g
, 
d©a
)

552 
	$ÿÎback
(
d©a
)

553 
’d


554 
’d


556 
£lf
:
	`_”rÜ
(

557 "WebSock‘…rÙocŞƒ¼Ü: \
 opcod".. 
	$to¡ršg
(
İcode
))

560 
’d


561 
’d


564 --- 
WebSock‘
 
Cl›Á
.

565 -- 
U§ge
:

566 -- 
websock‘
.
	`WebSock‘Cl›Á
("ws://websockethost.com/app", {

567 -- 
Ú_mes§ge
 = 
	`funùiÚ
(
£lf
, 
msg
è
’d
,

568 -- 
Ú_”rÜ
 = 
	`funùiÚ
(
£lf
, 
code
, 
msg
è
’d
,

569 -- 
Ú_h—d”s
 = 
	`funùiÚ
(
£lf
, 
h—d”
è
’d
,

570 -- 
Ú_cÚÃù
 = 
	`funùiÚ
(
£lf
è
’d
,

571 -- 
Ú_şo£
 = 
	`funùiÚ
(
£lf
è
’d
,

572 -- 
Ú_pšg
 = 
	`funùiÚ
(
£lf
, 
d©a
è
’d
,

573 -- 
modify_h—d”s
 = 
	`funùiÚ
(
h—d”
è
’d
,

574 -- 
»que¡_timeout
 = 10,

575 -- 
cÚÃù_timeout
 = 10,

576 -- 
u£r_ag’t
 = "Turbo WS Client v1.1",

577 -- 
cook›
 = "Bla",

578 -- 
websock‘_´ÙocŞ
 = "meh"

579 -- 
	}
})

580 
	gwebsock‘
.
	gWebSock‘Cl›Á
 = 
şass
("WebSocketClient")

581 
websock‘
.
WebSock‘Cl›Á
:
	$šşude
(
websock‘
.
WebSock‘SŒ—m
)

583 
funùiÚ
 
websock‘
.
WebSock‘Cl›Á
:
	$š™Ÿlize
(
add»ss
, 
kw¬gs
)

584 
£lf
.
mask_outgošg
 = 
Œue


585 
£lf
.
add»ss
 =‡ddress

586 
£lf
.
kw¬gs
 = kw¬g 
Ü
 {
	}
}

587 
£lf
.
_cÚÃù_time
 = 
ut
.
	$g‘timemÚÙÚic
()

588 
£lf
.
h‰p_şi
 = 
async
.
	$HTTPCl›Á
(
£lf
.
kw¬gs
.
s¦_İtiÚs
,

589 
£lf
.
kw¬gs
.
iŞoİ
,

590 
£lf
.
kw¬gs
.
max_bufãr_size
)

591 
loÿl
 
websock‘_key
 = 
esÿ³
.
	`ba£64_’code
(
ut
.
	`¿nd_¡r
(16))

592 -- 
Reusšg
 
async
.
HTTPCl›Á
.

593 
loÿl
 
_modify_h—d”s_sucûss
 = 
Œue


594 
loÿl
 
»s
 = 
cÜoutše
.
	`y›ld
(
£lf
.
h‰p_şi
:
	`ãtch
(
add»ss
, {

595 
k“p_®ive
 = 
Œue
,

596 
®low_websock‘_cÚÃù
 = 
Œue
,

597 
»que¡_timeout
 = 
£lf
.
kw¬gs
.request_timeout,

598 
cÚÃù_timeout
 = 
£lf
.
kw¬gs
.connect_timeout,

599 
cook›
 = 
£lf
.
kw¬gs
.cookie,

600 
u£r_ag’t
 = 
£lf
.
kw¬gs
.user_agent,

601 
®low_»dœeùs
 = 
£lf
.
kw¬gs
.allow_redirects,

602 
max_»dœeùs
 = 
£lf
.
kw¬gs
.max_redirects,

603 
Ú_h—d”s
 = 
	`funùiÚ
(
h‰p_h—d”
)

604 
h‰p_h—d”
:
	`add
("Upgrade", "Websocket")

605 
h‰p_h—d”
:
	`add
("Connection", "Upgrade")

606 
h‰p_h—d”
:
	`add
("Sec-WebSock‘-Key", 
websock‘_key
)

607 
h‰p_h—d”
:
	`add
("Sec-WebSocket-Version", "13")

608 -- 
WebSock‘
 
Sub
-
PrÙocŞ
 
hªdlšg
...

609 
	`ty³
(
£lf
.
kw¬gs
.
websock‘_´ÙocŞ
è=ğ"¡ršg" 
th’


610 
h‰p_h—d”
:
	`add
("Sec-WebSocket-Protocol",

611 
£lf
.
kw¬gs
.
websock‘_´ÙocŞ
)

612 
–£if
 
£lf
.
kw¬gs
.
websock‘_´ÙocŞ
 
th’


613 
	`”rÜ
("Invalidype of \"websocket_protocol\" value")

614 
’d


615 
	`ty³
(
£lf
.
kw¬gs
.
modify_h—d”s
è=ğ"funùiÚ" 
th’


616 -- 
U£r
 
ÿn
 
modify
 
h—d”
 
š
 
ÿÎback
.

617 
_modify_h—d”s_sucûss
 = 
£lf
:
	`_´Ùeùed_ÿÎ
(

619 
£lf
.
kw¬gs
.
modify_h—d”s
,

620 
£lf
,

621 
h‰p_h—d”
)

622 
’d


623 
’d


624 
	}
}))

625 
	g_modify_h—d”s_sucûss
 =ğ
çl£
 
th’


626 -- 
Mu¡
 dØ
this
 
outside
 
ÿÎback
 
to
 
HTTPCl›Á
Ø
g‘
 
desœed
 
efãù
.

627 -- 
In
 
the
 
ev’t
 
of
 
”rÜ
 
š
 "modify_h—d”s" 
ÿÎback
 
_”rÜ
 
is
 
®»ady


628 -- 
ÿÎed
.

630 
’d


631 
»s
.
”rÜ
 
th’


632 -- 
HTTPCl›Á
 
”rÜ
 
codes
 
¬e
 
com·tibË
 
w™h
 
WebSock‘
 
”rÜs
.

633 -- 
Cİy
 
the
 
”rÜ
 
äom
 
HTTPCl›Á
 
ªd
 
»u£
 
_”rÜ
.

634 
£lf
:
	$_”rÜ
(
»s
.
”rÜ
.
code
,„es.”rÜ.
mes§ge
)

636 
’d


637 
»s
.
code
 =ğ101 
th’


638 -- 
Check
 
acû±
 
key
.

639 
loÿl
 
acû±_key
 = 
»s
.
h—d”s
:
	`g‘
("Sec-WebSocket-Accept")

640 
	`as£¹
(
acû±_key
,

642 
loÿl
 
m©ch
 = 
esÿ³
.
	`ba£64_’code
(

643 
hash
.
	$SHA1
(
websock‘_key
..
websock‘
.
MAGIC
):
	`fš®ize
(), 20)

644 
	`as£¹
(
acû±_key
 =ğ
m©ch
,

646 
	`ty³
(
£lf
.
kw¬gs
.
Ú_h—d”s
è=ğ"funùiÚ" 
th’


647 
nÙ
 
£lf
:
	`_´Ùeùed_ÿÎ
("on_headers",

648 
£lf
.
kw¬gs
.
Ú_h—d”s
,

649 
£lf
,

650 
»s
.
h—d”s
è
th’


652 
’d


653 
£lf
:
	$şo£d
(è
th’


654 -- 
U£r
 
şo£d
 
the
 
cÚÃùiÚ
 
š
 
Ú_h—d”s
 
ÿÎback
. 
Ju¡


655 --  
as
 
the
 
cÚÃùiÚ
 
is
 
®»ady
 
şo£d
 
off
.

657 
’d


658 
’d


660 -- 
HªdË
 
”rÜ
.

661 
£lf
:
	`_”rÜ
(
websock‘
.
”rÜs
.
BAD_HTTP_STATUS
,

662 
	`¡rf
("Exıeùed 101, wa %d, cª‚Ù upg¿de.", 
»s
.
code
))

664 
’d


665 -- 
StÜe
 
»f
. 
IOSŒ—m
 
š
 
the
 
HTTPCl›Á
.

666 
£lf
.
¡»am
 = s–f.
h‰p_şi
.
io¡»am


667 
	`as£¹
(
£lf
.
¡»am
:
	`şo£d
(è=ğ
çl£
, "Connection were closed.")

668 
log
.
	`sucûss
(
¡ršg
.
	`fÜm©
(

669 [[[
websock‘
.
lua
] 
WebSock‘Cl›Á
 
cÚÃùiÚ
 
İ’
 %
s
]],

670 
£lf
.
add»ss
))

671 
£lf
:
	$_cÚtšue_ws
()

672 
’d


674 
funùiÚ
 
websock‘
.
WebSock‘Cl›Á
:
	$_´Ùeùed_ÿÎ
(
Çme
, 
func
, 
¬g
, 
d©a
)

675 
loÿl
 
¡©us
, 
”r
 = 
	$pÿÎ
(
func
, 
¬g
, 
d©a
)

676 
¡©us
 ~ğ
Œue
 
th’


677 
loÿl
 
”r_msg
 = 
	`¡rf
(

679 
£lf
,

680 
Çme
)

681 
£lf
:
	$_”rÜ
(
websock‘
.
”rÜs
.
CALLBACK_ERROR
,

682 
”r
 
ªd
 
”r_msg
 ..ƒ¼ 
Ü
ƒrr_msg)

683  
çl£


684 
’d


685  
Œue


686 
’d


688 --- 
C®Ëd
 
aá”
 
HTTP
 
hªdshake
 
has
 
·s£d
 
ªd
 
cÚÃùiÚ
 ha 
b“n
 
upg¿ded


689 -- 
to
 
WebSock‘
.

690 
funùiÚ
 
websock‘
.
WebSock‘Cl›Á
:
	$_cÚtšue_ws
()

691 
£lf
.
¡»am
:
	$£t_şo£_ÿÎback
(
£lf
.
_sock‘_şo£d
, self)

692 
£lf
.
_äagm’‹d_mes§ge_bufãr
 = 
	$bufãr
(1024)

693 
£lf
.
¡»am
:
	$»ad_by‹s
(2, 
£lf
.
_acû±_äame
, self)

694 
	`ty³
(
£lf
.
kw¬gs
.
Ú_cÚÃù
è=ğ"funùiÚ" 
th’


695 
£lf
:
	`_´Ùeùed_ÿÎ
("Ú_cÚÃù", s–f.
kw¬gs
.
Ú_cÚÃù
, self)

696 
’d


697 
’d


699 
funùiÚ
 
websock‘
.
WebSock‘Cl›Á
:
	$_”rÜ
(
code
, 
msg
)

700 
£lf
.
¡»am
 
th’


701 
£lf
.
¡»am
:
	$şo£
()

702 
’d


703 
	`ty³
(
msg
è=ğ"¡ršg" 
th’


704 
log
.
	$”rÜ
(
msg
)

705 
’d


706 
	`ty³
(
£lf
.
kw¬gs
.
Ú_”rÜ
è=ğ"funùiÚ" 
th’


707 
£lf
.
kw¬gs
.
	$Ú_”rÜ
(
£lf
, 
code
, 
msg
)

708 
’d


709 
’d


711 
funùiÚ
 
websock‘
.
WebSock‘Cl›Á
:
	$_äame_·ylßd
(
d©a
)

712 
loÿl
 
İcode


713 
£lf
.
_İcode
 =ğ
websock‘
.
İcode
.
CLOSE
 
th’


714 
nÙ
 
£lf
.
_fš®_b™
 
th’


715 
£lf
:
	`_”rÜ
(
websock‘
.
”rÜs
.
WEBSOCKET_PROTOCOL_ERROR
,

719 
’d


720 
İcode
 = 
£lf
.
_İcode


721 
–£if
 
£lf
.
_İcode
 =ğ
websock‘
.
İcode
.
CONTINUE
 
th’


722 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	`Ën
(è=ğ0 
th’


723 
£lf
:
	`_”rÜ
(
websock‘
.
”rÜs
.
WEBSOCKET_PROTOCOL_ERROR
,

727 
’d


728 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$­³nd_lua¡r_right
(
d©a
)

729 
£lf
.
_fš®_b™
 =ğ
Œue
 
th’


730 
İcode
 = 
£lf
.
_äagm’‹d_mes§ge_İcode


731 
d©a
 = 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$__to¡ršg
()

732 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$ş—r
()

733 
£lf
.
_äagm’‹d_mes§ge_İcode
 = 
n


734 
’d


736 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	`Ën
(è~ğ0 
th’


737 
£lf
:
	`_”rÜ
(
websock‘
.
”rÜs
.
WEBSOCKET_PROTOCOL_ERROR
,

741 
’d


742 
£lf
.
_fš®_b™
 =ğ
Œue
 
th’


743 
İcode
 = 
£lf
.
_İcode


745 
£lf
.
_äagm’‹d_mes§ge_İcode
 = s–f.
_İcode


746 
£lf
.
_äagm’‹d_mes§ge_bufãr
:
	$­³nd_lua¡r_right
(
d©a
)

747 
d©a
:
	`Ën
(è=ğ0 
th’


748 
log
.
	`debug
("Zero†ength data on WebSocket.")

749 
’d


750 
’d


751 
’d


752 
£lf
.
_fš®_b™
 =ğ
Œue
 
th’


753 
£lf
:
	$_hªdË_İcode
(
İcode
, 
d©a
)

754 
’d


755 
£lf
.
_şo£d
 ~ğ
Œue
 
th’


756 
£lf
.
¡»am
:
	$»ad_by‹s
(2, 
£lf
.
_acû±_äame
, self)

757 
’d


758 
’d


760 
funùiÚ
 
websock‘
.
WebSock‘Cl›Á
:
	$_hªdË_İcode
(
İcode
, 
d©a
)

761 
£lf
.
_şo£d
 =ğ
Œue
 
th’


763 
’d


764 
İcode
 =ğ
websock‘
.İcode.
TEXT
 
Ü


765 
İcode
 =ğ
websock‘
.İcode.
BINARY
 
th’


766 
£lf
.
kw¬gs
.
Ú_mes§ge
 
th’


767 
£lf
:
	`_´Ùeùed_ÿÎ
("on_message",

768 
£lf
.
kw¬gs
.
Ú_mes§ge
,

769 
£lf
,

770 
d©a
)

771 
’d


772 
–£if
 
İcode
 =ğ
websock‘
.İcode.
CLOSE
 
th’


773 
£lf
:
	$şo£
()

774 
–£if
 
İcode
 =ğ
websock‘
.İcode.
PING
 
th’


775 
£lf
.
kw¬gs
.
Ú_pšg
 
th’


776 
£lf
:
	`_´Ùeùed_ÿÎ
("on_ping",

777 
£lf
.
kw¬gs
.
Ú_pšg
,

778 
£lf
,

779 
d©a
)

781 
£lf
:
	$pÚg
(
d©a
)

782 
’d


783 
–£if
 
İcode
 =ğ
websock‘
.İcode.
PONG
 
th’


784 
£lf
.
_pšg_ÿÎback
 
th’


785 
loÿl
 
ÿÎback
 = 
£lf
.
_pšg_ÿÎback


786 
loÿl
 
¬g
 = 
£lf
.
_pšg_ÿÎback_¬g


787 
£lf
.
_pšg_ÿÎback
 = 
n


788 
£lf
.
_pšg_ÿÎback_¬g
 = 
n


789 
¬g
 
th’


790 
	$ÿÎback
(
¬g
, 
d©a
)

792 
	$ÿÎback
(
d©a
)

793 
’d


794 
’d


796 
£lf
:
	`_”rÜ
(
websock‘
.
”rÜs
.
WEBSOCKET_PROTOCOL_ERROR
,

797 "WebSock‘…rÙocŞƒ¼Ü: \
 opcod".. 
	$to¡ršg
(
İcode
))

800 
’d


801 
’d


803 
funùiÚ
 
websock‘
.
WebSock‘Cl›Á
:
	$_sock‘_şo£d
()

804 
log
.
	`sucûss
(
¡ršg
.
	`fÜm©
(

805 [[[
websock‘
.
lua
] 
WebSock‘Cl›Á
 
şo£d
 %
s
 %
dms
]],

806 
£lf
.
add»ss
,

807 
ut
.
	`g‘timemÚÙÚic
(è- 
£lf
.
_cÚÃù_time
))

808 
	`ty³
(
£lf
.
kw¬gs
.
Ú_şo£
è=ğ"funùiÚ" 
th’


809 
£lf
:
	`_´Ùeùed_ÿÎ
("Ú_şo£", s–f.
kw¬gs
.
Ú_şo£
, self)

810 
’d


811 
’d


813  
websock‘


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbovisor.lua

1 --- 
	gTurbo
.
lua
 
	gTurbovisÜ
,‡uto-
»lßd
 
of
 
­¶iÿtiÚ
 
Ú
 
fe
 
	gchªges
.

3 -- 
	gCİyright
 2013 
John
 
	gAb¿ham£n
, 
Deyuª
 
	gD’g


5 -- 
Liûn£d
 
und”
 
the
 
A·che
 
	gLiûn£
, 
	gV”siÚ
 2.0 (
	gthe
 "License");

6 -- 
you
 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
	gLiûn£
.

7 -- 
You
 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
	g©


9 -- 
	gh‰p
:

11 -- 
UÆess
 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
	gsoáw¬e


12 -- 
di¡ribu‹d
 
und”
 
the
 
Liûn£
 
is
 di¡ribu‹d 
Ú
 
	gª
 "AS IS" 
	gBASIS
,

13 -- 
WITHOUT
 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
	gKIND
, 
e™h”
 
ex´ess
 
Ü
 
	gim¶›d
.

14 -- 
S“
 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
	gªd


15 -- 
lim™©iÚs
 
und”
 
the
 
	gLiûn£
.

17 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

18 
loÿl
 
b™
 = 
»quœe
 "bit"

19 
loÿl
 
turbo
 = 
»quœe
 "turbo"

20 
loÿl
 
fs
 = 
»quœe
 "turbo.fs"

22 
nÙ
 
turbo
.
¶©fÜm
.
__LINUX__
 
th’


23 
”rÜ
("Turbovisor is only supported on Linux.")

24 
’d


26 --- 
P¬sšg
 
¬gum’ts
 
turbovisÜ


27 -- @
·¿m
 
¬g
 
AÎ
 
commªd
 
lše
 
šput
. 
NÙe
‡rg[0] 
is
 'turbovisÜ', 
	g¬g
[1] 
	gis


28 -- 
­¶iÿtiÚ
 
	gÇme
; 
so
 
	gu£r
-
defšed
 
¬gum’t
 
¡¬ts
 
äom
 
	g¬g
[2]

29 -- @ 
a
 
bË
 
cÚššg
 
	gİtiÚ
/
v®ue
 
	g·œ
, 
İtiÚs
 
	gšşudšg
:

30 -- 'w©ch': 
£t
 
of
 
fes
 
Ü
 
dœeùÜ›s
 
to
 
w©ch


31 -- 'ignÜe': 
£t
 
of
 
fes
 
Ü
 
dœeùÜ›s
 
th©
 
turbovisÜ
 
shouldn
't watch

32 
loÿl
 
funùiÚ
 
	$g‘_·¿m
(
¬g
)

33 
loÿl
 
¬g_İt


34 
loÿl
 
¬g_tbl
 = {
	}
}

35 
i
 = 2, #arg, 1 do

36 
	g¬g
[
i
] =ğ'--w©ch' 
Ü
 
¬g
[i] =ğ'-w' 
th’


37 
¬g_tbl
.
w©ch
 =‡rg_tbl.w©ch 
Ü
 {}

38 
¬g_İt
 = 'watch'

39 
–£if
 
¬g
[
i
] =ğ'--ignÜe' 
Ü
‡rg[i] =ğ'-i' 
th’


40 
¬g_tbl
.
ignÜe
 =‡rg_tbl.ignÜ
Ü
 {}

41 
¬g_İt
 = 'ignore'

43 
¡ršg
.
sub
(
¬g
[
i
], 1, 2è=ğ"./" 
th’


44 
¬g
[
i
] = 
¡ršg
.
sub
×rg[i], 3è-- 
	g·ss
 './'

45 
’d


46 
loÿl
 
	gfes
 = 
fs
.
glob
(
¬g
[
i
])

47 -- 
š£¹
 
glob
 
ex·nded
 
»suÉ
 
što
 
bË


48 
fes
 
th’


49 
_
,
v
 
š
 
	$aœs
(
fes
) do

50 
bË
.
	$š£¹
(
¬g_tbl
[
¬g_İt
], 
v
)

51 
’d


52 
’d


53 
’d


54 
’d


55 -- 
D—l
 
w™h
  
·¿m‘”s


56 
¬g_tbl
.
w©ch
 =ğ
n
 
th’
‡rg_tbl.w©ch = {'.'
	}
} 
’d


57  
¬g_tbl
;

58 
	g’d


61 --- 
Kl
 
®l
 
desûndªts
 
a
 
giv’
 
pid


62 
loÿl
 
funùiÚ
 
	$kl_Œ“
(
pid
)

63 
loÿl
 
fe_hªdË
 = 
io
.
	`pİ’
('pkÈ-P ' .. 
pid
)

64 
fe_hªdË
:
	$şo£
()

65 
’d


68 --- 
The
 
turbovisÜ
 
şass
 
is
 
a
 
su³rvisÜ
 
d‘eùšg
 
fe
 
chªges


69 -- 
ªd
 
»¡¬t
 
su³rvi£d
 
­¶iÿtiÚ
.

70 
loÿl
 
turbovisÜ
 = 
	`şass
("turbovisÜ", 
turbo
.
iŞoİ
.
IOLoİ
)

72 --- 
S¹
 
su³rvisšg
.

73 
funùiÚ
 
turbovisÜ
:
	`su³rvi£
()

74 -- 
G‘
 
commªd
 
lše
 
·¿m‘”s


75 
£lf
.
¬g_tbl
 = 
	`g‘_·¿m
(
¬g
)

76 -- 
C»©e
 
a
 
Ãw
 
šÙify


77 
£lf
.
i_fd
 = 
turbo
.
šÙify
:
	`Ãw
()

78 -- 
C»©e
 
a
 
bufãr
 
»adšg
 
ev’t
 
š
 
ÿÎback
 
hªdËr


79 
£lf
.
buf
 = 
ffi
.
	`gc
(ffi.
C
.
	`m®loc
(
turbo
.
fs
.
PATH_MAX
), ffi.C.
ä“
)

80 -- 
In™Ÿlize
 
iŞoİ
, 
add
 
šÙify
 
hªdËr


81 
£lf
:
	$š™Ÿlize
()

82 
£lf
:
	`add_hªdËr
(£lf.
i_fd
, 
turbo
.
iŞoİ
.
READ
, s–f.
»¡¬t
, self)

83 -- 
S‘
 
w©ch
 
Ú
 
rg‘
 
fe
 
Ü
 
dœeùÜy


84 
i
, 
rg‘
 
š
 
	$·œs
(
£lf
.
¬g_tbl
.
w©ch
) do

85 
turbo
.
fs
.
	$is_dœ
(
rg‘
è
th’


86 
turbo
.
šÙify
:
	$w©ch_®l
(
rg‘
, 
£lf
.
¬g_tbl
.
ignÜe
)

88 
turbo
.
šÙify
:
	$w©ch_fe
(
rg‘
)

89 
’d


90 
’d


91 -- 
P¬am‘”s
 
¡¬tšg
 
­¶iÿtiÚ


92 
loÿl
 
·¿
 = 
ffi
.
	`Ãw
("const char *[?]", 3)

93 
·¿
[0] = "luajit"

94 
·¿
[1] = 
¬g
[1]

95 
·¿
[2] = 
n


96 
£lf
.
·¿
 = 
ffi
.
	`ÿ¡
("char *const*",…ara)

97 -- 
Run
 
­¶iÿtiÚ
 
ªd
 
su³rvisÜ


98 
loÿl
 
ıid
 = 
ffi
.
C
.
	$fÜk
()

99 
ıid
 =ğ0 
th’


100 
turbo
.
šÙify
:
	$şo£
()

101 
ffi
.
C
.
	`execvp
("luaj™", 
£lf
.
·¿
)

102 
	`”rÜ
(
ffi
.
	`¡ršg
(ffi.
C
.
	`¡»¼Ü
(ffi.
	$”ºo
())))

104 
£lf
:
	$¡¬t
()

105 
’d


106 
’d


108 --- 
C®lback
 
hªdËr
 
wh’
 
fes
 
chªged


109 -- 
FÜ
 
now
, 
ju¡
 
»¡¬t
 
the
 
Úly
 
Úe
 
­¶iÿtiÚ


110 
funùiÚ
 
turbovisÜ
.
	`»¡¬t
(
£lf
, 
fd
, 
ev’ts
)

111 -- 
R—d
 
out
 
ev’t


112 
ffi
.
C
.
	`»ad
(
fd
, 
£lf
.
buf
, 
turbo
.
fs
.
PATH_MAX
);

113 
£lf
.
buf
 = 
ffi
.
	`ÿ¡
("struct inotify_event*", self.buf)

114 
loÿl
 
fuÎ_·th


115 
£lf
.
buf
.
Ën
 =ğ0 
th’
 -- 'ËÀğ0' 
we
 
w©ch
 
Ú
 
fe
 
dœeùly


116 
fuÎ_·th
 = 
turbo
.
šÙify
:
	$g‘_w©ched_fe
(
£lf
.
buf
.
wd
)

118 
loÿl
 
·th
 = 
turbo
.
šÙify
:
	$g‘_w©ched_fe
(
£lf
.
buf
.
wd
)

119 
fuÎ_·th
 = 
·th
 .. '/' .. 
ffi
.
	$¡ršg
(
£lf
.
buf
.
Çme
)

120 
·th
 =ğ'.' 
th’
 
fuÎ_·th
 = 
ffi
.
	$¡ršg
(
£lf
.
buf
.
Çme
è
’d


121 
’d


123 
turbo
.
šÙify
:
	`»w©ch_if_ignÜed
(
£lf
.
buf
, 
fuÎ_·th
)

125 -- 
Sim¶y
  
we
 
Ãed
 
to
 
ignÜe
 
the
 
fe


126 
turbo
.
ut
.
	$is_š
(
fuÎ_·th
, 
£lf
.
¬g_tbl
.
ignÜe
è
th’


128 
’d


129 
turbo
.
log
.
	`nÙiû
("[turbovisÜ.lua] F'" .. 
fuÎ_·th
 ..

131 -- 
Re¡¬t
 
­¶iÿtiÚ


132 
	`kl_Œ“
(
ffi
.
C
.
	$g‘pid
())

133 
loÿl
 
ıid
 = 
ffi
.
C
.
	$fÜk
()

134 
ıid
 =ğ0 
th’


135 
turbo
.
šÙify
:
	$şo£
()

136 
ffi
.
C
.
	`execvp
("luaj™", 
£lf
.
·¿
)

137 
	`”rÜ
(
ffi
.
	`¡ršg
(ffi.
C
.
	`¡»¼Ü
(ffi.
	$”ºo
())))

138 
’d


139 
’d


141  
turbovisÜ


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/libmoon.lua

1 
loÿl
 
	gmod
 = {}

3 
loÿl
 
log
 = 
»quœe
 "log"

4 
loÿl
 
Çme¥aûs
 = 
»quœe
 "namespaces"

5 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

6 
loÿl
 
ffi
 = 
»quœe
 "ffi"

7 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

9 
mod
.
cÚfig
 = 
Çme¥aûs
:
	$g‘
()

10 
mod
.
cÚfig
.
­pName
 = "libmoon"

12 
loÿl
 
funùiÚ
 
	$checkCÜe
()

13 
LIBMOON_TASK_NAME
 ~ğ"ma¡”" 
th’


14 
log
:
	`çl
("This function is only‡vailable onhe masterask.", 2)

15 
’d


16 
’d


18 
funùiÚ
 
mod
.
	`£tupP©hs
()

19 -- 
looks
 
like
 
this
: ;
$BASE
/
lua
/
lib
/?/
š™
.lua, 
£e
 
sk
.
ıp


20 
nÙ
 
mod
.
cÚfig
.
ba£P©h
 
th’


21 
loÿl
 
·th


22 -- 
u£
 
the
 
Ï¡
 
m©ch
 
this
 
·‰”n
 
as
 
we
 
Ãed
h
ba£
 
·th
 
of
 
libmoÚ


23 -- 
­¶iÿtiÚs
 
budšg
 
™
 
as
 
lib¿ry
 
might
 
´•’d
 
theœ
 
own
 
·th
 
befÜe
 
this


24 
m©ch
 
š
 
·ckage
.
·th
:
	`gm©ch
(";([^;]+)/lua/lib/%?/init.lua;") do

25 
·th
 = 
m©ch
 .. "/"

26 
’d


27 
mod
.
cÚfig
.
ba£P©h
 = 
·th


28 
’d


29 
loÿl
 
ba£
 = 
mod
.
cÚfig
.
ba£P©h


30 
loÿl
 
u£rsütP©h
 = 
mod
.
cÚfig
.
u£rsüt
:
	`m©ch
("(.-)/([^/]+)$")

31 
u£rsütP©h
 
th’


32 
·ckage
.
·th
 =…ackage.·th .. ";" .. 
u£rsütP©h
 .. "/?.lua"

33 
’d
 -- : 
süt
 
is
 ./ 
which
 i 
®»ady
 
š
 
the
 
·th


34 
loÿl
 
ffiP©h
 = ""

35 
·th
 
š
 
·ckage
.·th:
	`gm©ch
("([^;]+)") do

36 
nÙ
 
·th
:
	`m©ch
("š™.lua$"è
th’


37 
ffiP©h
 = ffiP©h .. ";" .. 
·th
:
	`gsub
("%?%.lua", "?")

38 
’d


39 
’d


40 
·ckage
.
ff©h
 = 
ffiP©h


41 
loÿl
 
lßd
 = 
ffi
.load

42 
ffi
.
lßd
 = 
	$funùiÚ
(
Çme
)

43 
loÿl
 
ok
, 
»sLßd
 = 
	$pÿÎ
(
lßd
, 
Çme
)

44 
ok
 
th’


45  
»sLßd


46 
’d


47 -- 
hªdË
 
·ths
, 
·ckage
.
£¬ch·th
 
ÿn
't dohat for us because ofhe…esky†ib…refix

48 
Çme
:
	`m©ch
("/"è
th’


49 
loÿl
 
fœ¡
, 
£cÚd
 = 
Çme
:
	`m©ch
("(.+)/([^/]+)$")

50 
£cÚd
 = secÚd:
	`gsub
("^lib", "")

51 
Çme
 = 
fœ¡
 .. "/lib" .. 
£cÚd


52 
–£if
 
nÙ
 
Çme
:
	`m©ch
("^lib"è
th’


53 
Çme
 = "lib" ..‚ame

54 
’d


55 
loÿl
 
·th
, 
”r
 = 
·ckage
.
	`£¬ch·th
(
Çme
 .. ".so",…ackage.
ff©h
, "/")

56 
·th
 
th’


57  
	$lßd
(
·th
)

59 
	`”rÜ
(("%s\nTr›d sy¡em†oÿtiÚ ªdhfŞlowšg…©h %s"):
	`fÜm©
(
»sLßd
, 
”r
), 2)

60 
’d


61 
’d


62 
’d


64 
ffi
.
cdef
[[

65 
	`Ïunch_lua_cÜe
(
cÜe
, cÚ¡ * 
¬g
);

66 
	`ä“
(* 
±r
);

67 
ušt64_t
 
	`sk_g’”©e_id
();

68 
	`sk_¡Üe_»suÉ
(
ušt64_t
 
sk_id
, * 
»suÉ
);

69 * 
	`sk_g‘_»suÉ
(
ušt64_t
 
sk_id
);

73 
loÿl
 
sk
 = {
	}
}

74 
sk
.
__šdex
 =ask

76 
loÿl
 
sks
 = {}

78 
funùiÚ
 
sk
:
	$Ãw
(
cÜe
)

79 
	$checkCÜe
()

80 
loÿl
 
obj
 = 
	`£tm‘©abË
({

81 -- 
š¡—d
 
of
 
ušt64_t
 
is
 
—s›r
 
h”e
 
ªd
 
	`okay
 (
uÆess
 
you
 
wªt
 
to
 
¡¬t
 
mÜe
 
thª
 2^53 
sks
)

82 
id
 = 
	`tÚumb”
(
ffi
.
C
.
	`sk_g’”©e_id
()),

83 
cÜe
 = core

84 
	}
}, 
	gsk
)

85 
	gsks
[
cÜe
] = 
obj


86  
obj


87 
’d


89 --- 
Wa™
 
a
 
sk
 
ªd
  
ªy
 
¬gum’ts
 
»tuºed
 
by
 
the
ask

90 
funùiÚ
 
sk
:
	$wa™
()

91 
	$checkCÜe
()

92 
Œue
 do

93 
dpdkc
.
	`¹e_—l_g‘_lcÜe_¡©e
(
£lf
.
cÜe
è~ğdpdkc.
RUNNING
 
th’


94 -- 
sk
 
is
 
fšished


95 
loÿl
 
»suÉ
 = 
ffi
.
C
.
	$sk_g‘_»suÉ
(
£lf
.
id
)

96 
»suÉ
 =ğ
n
 
th’


97 -- 
th»ad
 
üashed
 :(

99 
’d


100 
loÿl
 
»suÉSŒšg
 = 
ffi
.
	$¡ršg
(
»suÉ
)

101 
ffi
.
C
.
	$ä“
(
»suÉ
)

102  
	`uÅackAÎ
(
	$lßd¡ršg
(
»suÉSŒšg
)())

103 
’d


104 
mod
.
	$¦“pMlisIdË
(1)

105 
’d


106 
’d


108 
funùiÚ
 
sk
:
	$isRuÂšg
()

109 
	$checkCÜe
()

110 
nÙ
 
sks
[
£lf
.
cÜe
] 
Ü
asks[£lf.cÜe].
id
 ~ğ£lf.id 
th’


111 -- 
som‘hšg
 
Ü
 
nÙhšg
 
is
 
ruÂšg
 
Ú
 
this
 
cÜe


112  
çl£


113 
’d


114 -- 
this
 
sk
 
is
 
¡l
 
Ú
hi 
cÜe
, 
but
 i 
™
 stÈ
ruÂšg
?

115  
dpdkc
.
	`¹e_—l_g‘_lcÜe_¡©e
(
£lf
.
cÜe
è=ğdpdkc.
RUNNING


116 
’d


118 
loÿl
 
funùiÚ
 
	$fšdDeviûs
(
»suÉ
, ...)

119 
	`£Ëù
("#", ...è<ğ1 
th’


120 
loÿl
 
¬g
 = ...

121 
	`ty³
(
¬g
è=ğ"bË" 
th’


122 
¬g
.
__ty³
 =ğ"deviû" 
ªd
 
	`ty³
×rg.
g‘Sock‘
è=ğ"funùiÚ" 
th’


123 
bË
.
	$š£¹
(
»suÉ
, 
¬g
)

125 
k
, 
v
 
š
 
	$·œs
(
¬g
) do

126 
	$fšdDeviûs
(
»suÉ
, 
v
)

127 
’d


128 
’d


129 
’d


131 
i
 = 1, 
	`£Ëù
("#", ...) do

132 
	`fšdDeviûs
(
»suÉ
, (
	$£Ëù
(
i
, ...)))

133 
’d


134 
’d


135 
’d


137 
loÿl
 
funùiÚ
 
	$g‘Be¡Sock‘
(
deviûs
)

138 
loÿl
 
sock‘s
 = {
	}
}

139 
i
, 
dev
 
š
 
	$aœs
(
deviûs
) do

140 
sock‘s
[
dev
:
	`g‘Sock‘
()] = (sock‘s[dev:g‘Sock‘()] 
Ü
 0) + 1

141 
’d


142 
loÿl
 
sÜ‹d
 = {
	}
}

143 
i
, 
v
 
š
 
	$·œs
(
sock‘s
) do

144 
bË
.
	`š£¹
(
sÜ‹d
, {
couÁ
 = 
v
, 
sock‘
 = 
i
})

145 
’d


146 
	gbË
.
sÜt
(
sÜ‹d
, 
	$funùiÚ
(
v1
, 
v2
è v1.
couÁ
 > v2.couÁ 
’d
)

147  
sÜ‹d
[1] 
ªd
 sÜ‹d[1].
sock‘
 
Ü
 -1

148 
’d


150 
loÿl
 
funùiÚ
 
	$g‘CÜeOnSock‘
(
sock‘
)

151 
i
 = 2, #mod.
cÚfig
.
cÜes
 dØ-- 
sk
 
ma¡”


152 
loÿl
 
cÜe
 = 
mod
.
cÚfig
.
cÜes
[
i
]

153 
loÿl
 
¡©us
 = 
dpdkc
.
	$¹e_—l_g‘_lcÜe_¡©e
(
cÜe
)

154 ià(
¡©us
 =ğ
dpdkc
.
FINISHED
 
Ü
 stu =ğdpdkc.
WAIT
)

155 
	`ªd
 (
sock‘
 =ğ-1 
Ü
 
dpdkc
.
	`¹e_lcÜe_to_sock‘_id_expÜt
(
cÜe
è=ğsock‘è
th’


156  
cÜe


157 
’d


158 
’d


159 
’d


161 --- 
S¹
 
a
 
Ãw
 
sk
 
Ú
 
the
 
fœ¡
 
ä“
 
nÚ
-
sh¬ed
 
cÜe


162 
funùiÚ
 
mod
.
	$¡¬tTask
(...)

163 
	$checkCÜe
()

164 
loÿl
 
deviûs
 = {
	}
}

165 
	$fšdDeviûs
(
deviûs
, ...)

166 
loÿl
 
sock‘
 = 
	$g‘Be¡Sock‘
(
deviûs
)

167 
loÿl
 
cÜe
 = 
	$g‘CÜeOnSock‘
(
sock‘
)

168 
nÙ
 
cÜe
 
th’


169 
cÜe
 = 
	$g‘CÜeOnSock‘
()

170 
cÜe
 
th’


171 
log
:
	`w¬n
("Tr›dØm­askØsock‘ %d, buˆ®ÈcÜe ¬š u£. Usšg difã»Á sock‘.", 
sock‘
)

172 
’d


173 
’d


174 
nÙ
 
cÜe
 
th’


175 
log
:
	`çl
("Notƒnough coreso starthisask")

176 
’d


177  
mod
.
	$¡¬tTaskOnCÜe
(
cÜe
, ...)

178 
’d


180 
funùiÚ
 
mod
.
	$¡¬tSh¬edTask
(...)

181 
	$checkCÜe
()

182 
loÿl
 
maxCÜe
 = 
mod
.
cÚfig
.
cÜes
[#mod.config.cores]

183 
cÜe
 = 
maxCÜe
 + 1, maxCÜ+ 
mod
.
cÚfig
.
numSh¬edCÜes
 do

184 
loÿl
 
¡©us
 = 
dpdkc
.
	$¹e_—l_g‘_lcÜe_¡©e
(
cÜe
)

185 
¡©us
 =ğ
dpdkc
.
FINISHED
 
Ü
 stu =ğdpdkc.
WAIT
 
th’


186  
mod
.
	$¡¬tTaskOnCÜe
(
cÜe
, ...)

187 
’d


188 
’d


189 
log
:
	`çl
("Notƒnough sharedask IDs‡vailableo starthisask,his†imit can be increased in dpdk-conf.lua")

190 
’d


192 --- 
Launch
 
a
 
LuaJIT
 
VM
 
Ú
‡ 
cÜe
 
w™h
 
the
 
giv’
 
¬gum’ts
.

193 
funùiÚ
 
mod
.
	$¡¬tTaskOnCÜe
(
cÜe
, ...)

194 
	$checkCÜe
()

195 
loÿl
 
¡©us
 = 
dpdkc
.
	$¹e_—l_g‘_lcÜe_¡©e
(
cÜe
)

196 
¡©us
 =ğ
dpdkc
.
FINISHED
 
th’


197 
dpdkc
.
	`¹e_—l_wa™_lcÜe
(
cÜe
)

198 -- 
should
 
be
 
gu¬ª‹ed
 
to
 b
š
 
WAIT
 
¡©e
 
now
 
accÜdšg
Ø
DPDK
 
docum’tiÚ


199 
¡©us
 = 
dpdkc
.
	$¹e_—l_g‘_lcÜe_¡©e
(
cÜe
)

200 
’d


201 
¡©us
 ~ğ
dpdkc
.
WAIT
 
th’
 -- 
cÜe
 
is
 
š
 WAIT 
¡©e


202 
log
:
	`çl
("requested core is‡lready in use")

203 
’d


204 
loÿl
 
sk
 =ask:
	$Ãw
(
cÜe
)

205 
loÿl
 
¬gs
 = 
£½’t
.
	`dump
({ 
sk
.
id
, ... 
	}
})

206 
loÿl
 
buf
 = 
ffi
.
Ãw
("char[?]", #args + 1)

207 
	gffi
.
	$cİy
(
buf
, 
¬gs
)

208 
dpdkc
.
	$Ïunch_lua_cÜe
(
cÜe
, 
buf
)

209  
sk


210 
’d


212 
ffi
.
cdef
 [[

213 
	`u¦“p
(
u£cs
);

216 --- 
wa™s
 
uÁ
 
®l
 
	$sks
 (
šşudšg
 
sh¬ed
 
cÜes
è
have
 
fšished
 
theœ
 
jobs


217 
funùiÚ
 
mod
.
	$wa™FÜTasks
()

218 
Œue
 do

219 
loÿl
 
®lCÜesFšished
 = 
Œue


220 
i
 = 2, #mod.
cÚfig
.
cÜes
 dØ-- 
sk
 
ma¡”


221 
loÿl
 
cÜe
 = 
mod
.
cÚfig
.
cÜes
[
i
]

222 
dpdkc
.
	`¹e_—l_g‘_lcÜe_¡©e
(
cÜe
è=ğdpdkc.
RUNNING
 
th’


223 
®lCÜesFšished
 = 
çl£


225 
’d


226 
’d


227 
loÿl
 
maxCÜe
 = 
mod
.
cÚfig
.
cÜes
[#mod.config.cores]

228 
cÜe
 = 
maxCÜe
 + 1, maxCÜ+ 
mod
.
cÚfig
.
numSh¬edCÜes
 do

229 
dpdkc
.
	`¹e_—l_g‘_lcÜe_¡©e
(
cÜe
è=ğdpdkc.
RUNNING
 
th’


230 
®lCÜesFšished
 = 
çl£


232 
’d


233 
’d


234 
®lCÜesFšished
 
th’


236 
’d


237 
ffi
.
C
.
	$u¦“p
(1000)

238 
’d


239 
’d


241 --- 
g‘
 
the
 
CPU
's TSC

242 
funùiÚ
 
mod
.
	$g‘Cyşes
()

243  
dpdkc
.
	$¹e_rdtsc
()

244 
’d


246 --- 
g‘
 
the
 
TSC
 
äequ’cy


247 
funùiÚ
 
mod
.
	$g‘CyşesF»qu’cy
()

248  
	`tÚumb”
(
dpdkc
.
	$¹e_g‘_tsc_hz
())

249 
’d


251 
loÿl
 
tscF»q


253 --- 
g‘s
 
the
 
TSC
 
	$time
 (
sy¡em
 
u±ime
è
š
 
£cÚds


254 
funùiÚ
 
mod
.
	$g‘Time
()

255 
nÙ
 
tscF»q
 
th’


256 
tscF»q
 = 
	`tÚumb”
(
mod
.
	$g‘CyşesF»qu’cy
())

257 
’d


258  
	`tÚumb”
(
mod
.
	`g‘Cyşes
()è/ 
tscF»q


259 
’d


261 --- 
lim™
 
the
 
tÙ®
 
run
 
	$time
 (
to
 
be
 
ÿÎed
 
äom
 
ma¡”
 
cÜe
 
Ú
 
¡¬tup
, 
sh¬ed
 
b‘w“n
 
®l
 
cÜes
)

262 
funùiÚ
 
mod
.
	$£tRuÁime
(
time
)

263 
dpdkc
.
	$£t_ruÁime
(
time
 * 1000)

264 
’d


266 --- 
R‘uºs
 
çl£
 
Úû
 
the
 
­p
 
»ûives
 
SIGTERM
 
Ü
 
SIGINT
,h
time
 
£t
 
vŸ
 
£tRuÁime
 
expœes
, o¸
wh’
 
a
 
th»ad
 
ÿÎs
 
libmoÚ
.
	`¡İ
().

267 -- @
·¿m
 
exŒaTime
 
add™iÚ®
 
time
 
š
 
mli£cÚds
 
befÜe
 
çl£
 
wl
 
be
 
	$»tuºed
 (
e
.
g
. 
to
 
k“p
 
ª
 
rx
 
sk
 
ruÂšg
 
lÚg”
 
thª
 
a
 
tx
ask 
š
‡ 
loİback
 
‹¡
)

268 
funùiÚ
 
mod
.
	$ruÂšg
(
exŒaTime
)

269  
dpdkc
.
	`is_ruÂšg
(
exŒaTime
 
Ü
 0è=ğ1 -- 
luaj™
-2.0.3 
dÛs
 
nÙ
 
like
 
boŞ
  
	$ty³s
 (
TRACE
 
NYI
: 
unsuµÜ‹d
 
C
 
funùiÚ
 
ty³
)

270 
’d


272 --- 
»que¡
 
®l
 
sks
 
to
 
ex™


273 
funùiÚ
 
mod
.
	$¡İ
()

274 
dpdkc
.
	$£t_ruÁime
(0)

275 
’d


277 --- 
D–ay
 
by
 
t
 
mli£cÚds
. 
NÙe
 
th©
 
this
 
dÛs
 
nÙ
 
¦“p
 
the
 
aùu®
 
th»ad
;

278 --- 
the
 
time
 
is
 
¥’t
 
š
 
a
 
busy
 
wa™
 
loİ
 
by
 
DPDK
.

279 
funùiÚ
 
mod
.
	$¦“pMlis
(
t
)

280 
dpdkc
.
	$¹e_d–ay_ms_expÜt
(
t
)

281 
’d


283 --- 
D–ay
 
by
 
t
 
miüo£cÚds
. 
NÙe
 
th©
 
this
 
dÛs
 
nÙ
 
¦“p
 
the
 
aùu®
 
th»ad
;

284 --- 
the
 
time
 
is
 
¥’t
 
š
 
a
 
busy
 
wa™
 
loİ
 
by
 
DPDK
. 
This
 
m—ns
 
th©
 
this
 
¦“p


285 --- 
is
 
somewh©
 
mÜe
 
accu¿‹
 
thª
 
»lyšg
 
Ú
 
the
 
OS
.

286 
funùiÚ
 
mod
.
	$¦“pMiüos
(
t
)

287 
dpdkc
.
	$¹e_d–ay_us_expÜt
(
t
)

288 
’d


290 --- 
SË•
 
by
 
t
 
mli£cÚds
 by 
ÿÎšg
 
	`u¦“p
().

291 
funùiÚ
 
mod
.
	$¦“pMlisIdË
(
t
)

292 
ffi
.
C
.
	$u¦“p
(
t
 * 1000)

293 
’d


295 --- 
SË•
 
by
 
t
 
miüo£cÚds
 by 
ÿÎšg
 
	`u¦“p
().

296 
funùiÚ
 
mod
.
	$¦“pMiüosIdË
(
t
)

297 
ffi
.
C
.
	$u¦“p
(
t
)

298 
’d


300 --- 
G‘
 
the
 
cÜe
 
ªd
 
sock‘
 
id
 th
cu¼’t
 
th»ad


301 
funùiÚ
 
mod
.
	$g‘CÜe
()

302  
dpdkc
.
	`g‘_cu¼’t_cÜe
(), dpdkc.
	$g‘_cu¼’t_sock‘
()

303 
’d


305 
funùiÚ
 
mod
.
	$di§bËBadSock‘W¬nšg
()

306 
LIBMOON_IGNORE_BAD_NUMA_MAPPING
 = 
Œue


307 
’d


309 -- 
·tch
 
¬g·r£
 
to
 
u£
 
the
 
süt
 
as
  
Çme


310 
loÿl
 
·r£r
 = 
»quœe
 "argparse"

311 
loÿl
 
Şd
 = 
·ckage
.
lßded
.
¬g·r£


312 
·ckage
.
lßded
.
¬g·r£
 = 
	$funùiÚ
(...)

313  
	$Şd
(...):
	`Çme
(
mod
.
cÚfig
.
­pName
 .. " " .. mod.cÚfig.
u£rsüt
)

314 
’d


316  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lock.lua

1 --- 
Locks


2 
loÿl
 
	gmod
 = {}

4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

5 
loÿl
 
¡p
 = 
»quœe
 "StackTracePlus"

6 
loÿl
 
log
 = 
»quœe
 "log"

8 
ffi
.
cdef
 [[

9 
	slock
 { };

11 
lock
* 
make_lock
();

12 
lock_lock
(
lock
*†ock);

13 
lock_uÆock
(
lock
*†ock);

14 
ušt32_t
 
lock_Œy_lock
(
lock
*†ock);

15 
ušt32_t
 
lock_Œy_lock_fÜ
(
lock
*†ock, ušt32_ˆ
us
);

18 
loÿl
 
	gC
 = 
ffi
.
C


20 
loÿl
 
lock
 = {}

21 
lock
.
__šdex
 =†ock

23 
funùiÚ
 
mod
:
	$Ãw
()

24  
C
.
	$make_lock
()

25 
’d


27 --- 
Acquœe
 
the
 
lock


28 
funùiÚ
 
lock
:
	$lock
()

29 
C
.
	$lock_lock
(
£lf
)

30 
’d


32 --- 
R–—£
 
the
 
lock


33 
funùiÚ
 
lock
:
	$uÆock
()

34 
C
.
	$lock_uÆock
(
£lf
)

35 
’d


37 --- 
Try
 
to
 
acquœe
 
the
 
lock
, 
blockšg
 
max
 <
timeout
> 
miüo£cÚds
.

38 --- 
This
 
funùiÚ
 
dÛs
 
nÙ
 
block
 
timeout
 
is
 <= 0.

39 --- 
This
 
funùiÚ
 
may
 
ç
 
¥uriou¦y
, 
i
.
e
.  
—¾y
 
Ü
 fa 
to
 
acquœe
 
the
 
lock
.

40 --- @
·¿m
 
timeout
 
max
 
time
 
to
 
wa™
 
š
 
us


41 --- @
»tuºs
 
Œue
 
the
 
lock
 
was
 
acquœed
, 
çl£
 
Ùh”wi£


42 
funùiÚ
 
lock
:
	$ŒyLock
(
timeout
)

43  
C
.
	`lock_Œy_lock_fÜ
(
£lf
, 
timeout
) == 1

44 
’d


46 --- 
W¿p
 
a
 
funùiÚ
 
ÿÎ
 
š
 
lock
/
uÆock
 
ÿÎs
.

47 --- 
C®lšg
 
this
 
is
 
equiv®’t
 
to
 
the
 
fŞlowšg
 
p£udo
-
code
:

48 --- @
code


49 --- 
lock
:
	`lock
()

50 --- 
Œy
 {

51 --- 
	`func
(...)

52 --- 
	}
} 
fš®ly
 {

53 --- 
lock
:
uÆock
()

55 --- @
’dcode


56 --- @
·¿m
 
func
 
the
 
funùiÚ
 
to
 
ÿÎ


57 --- @
·¿m
 ... 
¬gum’ts
 
·s£d
 
to
 
the
 
funùiÚ


58 
funùiÚ
 
lock
:
	$__ÿÎ
(
func
, ...)

59 
£lf
:
	$lock
()

60 
loÿl
 
ok
, 
”r
 = 
	`xpÿÎ
(
func
, 
	$funùiÚ
(
”r
)

61  
¡p
.
	$¡ackŒaû
(
”r
)

62 
’d
, ...)

63 
£lf
:
	$uÆock
()

64 
nÙ
 
ok
 
th’


65 -- 
FIXME
: 
this
 
ouut
 
is
 
gošg
 
to
 
be
 
ugly
 
beÿu£
 
™
 
wl
 ouuˆ
the
 
loÿl
 
”r
 
as
 
w–l
 :>

66 
log
:
	`çl
("Caughˆ”rÜ iÀlock-w¿µed c®l, iÂ”ƒ¼Ü: " .. 
”r
, 2)

67 
’d


68 
’d


70 
ffi
.
	`m‘©y³
("¡ruù†ock", 
lock
)

72  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/log.lua

2 --- @
fe
 
	glog
.
	glua


3 --- @
br›f
 
Loggšg
 
	gmoduË
.

4 --- @
todo
 
	gDocu


6 
	g»quœe
 "utils"

8 
loÿl
 
	glog
 = {}

11 ---- 
Log
 
Lev–s


14 -- 
‹rmš©es
 
by
 
ÿÎšg
 
	$”rÜ
()

15 
log
.
FATAL
 = 4

17 -- 
mo¡
 
lik–y
 
‹rmš©es


18 
log
.
ERROR
 = 3

20 -- 
som‘hšg
 
uÃx³ùed
 
but
 
nÙ
 
ü™iÿl


21 
log
.
WARN
 = 2

23 -- 
šfÜm©iÚ
 
u£r


24 
log
.
INFO
 = 1

26 -- 
debuggšg


27 
log
.
DEBUG
 = 0

31 ---- 
¡dout
 
Loggšg


34 -- 
cu¼’t
 
log
 
Ëv–


35 
log
.
Ëv–
 =†og.
INFO


37 --- 
S‘
 
the
 
log
 
Ëv–


38 --- @
·¿m
 
Ëv–
 
S‘
 
log
†ev– 
to
†ev–. 
DeçuÉ
: 
INFO


39 
funùiÚ
 
log
:
	$£tLev–
(
Ëv–
)

40 
loÿl
 
´evLev–
 = 
£lf
.
Ëv–


41 
£lf
.
Ëv–
 = s–f[Ëv–] 
Ü
 s–f.
INFO


42 
nÙ
 
´evLev–
 =ğ
£lf
.
Ëv–
 
th’


43 
£lf
:
	`šfo
("Chªged†og†ev–Ø%s.", s–f[
Ëv–
] 
ªd
†ev– 
Ü
 "INFO")

44 
’d


45 
’d


48 ---- 
Fe
 
Loggšg


51 -- 
’
- 
Ü
 
di§bË
 
fe
 
loggšg


52 
log
.
feEÇbËd
 = 
çl£


54 --- 
EÇbË
 
loggšg
 
to
 
fe


55 
funùiÚ
 
log
:
	$feEÇbË
()

56 
£lf
.
feEÇbËd
 = 
Œue


57 
£lf
:
	`šfo
("EÇbËd†oggšgØ'" .. 
log
.
fe
 .. "'")

58 
’d


60 --- 
Di§bË
 
loggšg
 
to
 
fe


61 
funùiÚ
 
log
:
	$feDi§bË
()

62 
£lf
.
feEÇbËd
 = 
çl£


63 
£lf
:
	`šfo
("Di§bËd†oggšgØ" .. 
log
.
fe
 .. "'")

64 
’d


66 -- 
cu¼’t
 
fe
 
log
 
Ëv–


67 
log
.
feLev–
 =†og.
DEBUG


69 --- 
S‘
 
the
 
fe
 
log
 
Ëv–
.

70 --- @
·¿m
 
Ëv–
 
S‘
 
fe
 
log
†ev– 
to
†ev–. 
DeçuÉ
: 
DEBUG


71 
funùiÚ
 
log
:
	$£tFeLev–
(
Ëv–
)

72 
£lf
.
feLev–
 = s–f.
Ëv–
 
Ü
 s–f.
DEBUG


73 
’d


75 --- 
·th
 
to
 
log
 
fe


76 
log
.
fe
 = 
n


78 
log
.
loÿtiÚs
 = {

81 
	}
}

84 
loÿl
 
funùiÚ
 
	$feExi¡s
(
f
)

85 
loÿl
 
fe
 = 
io
.
	`İ’
(
f
, "r")

86 
fe
 
th’


87 
fe
:
	$şo£
()

88 
’d


89  
nÙ
‚Ù 
fe


90 
’d


91 -- 
fšd
 
log
/ 
·th


92 
_
, 
f
 
š
 
	$aœs
(
log
.
loÿtiÚs
) do

93 
	$feExi¡s
(
f
è
th’


94 
log
.
fe
 = 
f
 .. "debug.log"

95 
’d


96 
’d


97 
nÙ
 
log
.
fe
 
th’


98 
log
.
fe
 = "debug.log"

99 -- 
	`´št
("Unableo†ocate†og directory. Loggingo debug.log in working directory.")

100 
’d


101 -- 
	`´št
("LoggšgØ" .. 
log
.
fe
)

102 
’d


104 --- 
Wr™e
 
a
 
mes§ge
 
to
 
the
 
log
 
fe
 
¥ecif›d
 
š
†og.file

105 --- @
·¿m
 
¡r
 
Log
 
mes§ge
.

106 
funùiÚ
 
log
:
	$wr™eToLog
(
¡r
)

107 
loÿl
 
f
 = 
	`as£¹
(
io
.
	`İ’
(
£lf
.
fe
, "a"))

108 
f
:
	`wr™e
(
	`g‘TimeMiüos
(è.. " " .. 
¡r
 .. "\n")

109 
f
:
	$şo£
()

110 
’d


114 ---- 
Loggšg
 
FunùiÚs


117 --- 
Log
 
a
 
mes§ge
, 
Ëv–
 
FATAL
.

118 --- 
This
 
mes§ge
 
is
 
wr™‹n
 
w™h
 
	`”rÜ
(), 
h’û
, 
‹rmš©es
 
the
 
­¶iÿtiÚ
.

119 --- 
FATAL
 
log
 
mes§ges
 
to
 
¡dout
 
ÿÂÙ
 
be
 
di§bËd
.

120 --- @
·¿m
 
¡r
 
Log
 
mes§ge


121 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
·¿m‘”s


122 
funùiÚ
 
log
:
	$çl
(
¡r
, ...)

123 
¡r
 = sŒ:
	$fÜm©
(...)

125 
£lf
.
feEÇbËd
 
th’


126 
£lf
:
	`wr™eToLog
("[FATAL] " .. 
¡r
)

127 
’d


129 
	`”rÜ
(
	`»d
(
¡r
), 2)

130 
’d


132 --- 
Log
 
a
 
mes§ge
, 
Ëv–
 
ERROR
.

133 --- @
·¿m
 
¡r
 
Log
 
mes§ge


134 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
·¿m‘”s


135 
funùiÚ
 
log
:
	$”rÜ
(
¡r
, ...)

136 
¡r
 = "[ERROR] " .. sŒ:
	$fÜm©
(...)

138 
£lf
.
ERROR
 >ğ£lf.
Ëv–
 
th’


139 
	`´št
(
	`b»d
("%s", 
¡r
))

140 
’d


142 
£lf
.
feEÇbËd
 
ªd
 s–f.
ERROR
 >ğ£lf.
feLev–
 
th’


143 
£lf
:
	$wr™eToLog
(
¡r
)

144 
’d


145 
’d


147 --- 
Log
 
a
 
mes§ge
, 
Ëv–
 
WARN
.

148 --- @
·¿m
 
¡r
 
Log
 
mes§ge


149 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
·¿m‘”s


150 
funùiÚ
 
log
:
	$w¬n
(
¡r
, ...)

151 
¡r
 = "[WARN] " .. sŒ:
	$fÜm©
(...)

153 
£lf
.
WARN
 >ğ£lf.
Ëv–
 
th’


154 
	`´št
(
	`y–low
("%s", 
¡r
))

155 
’d


157 
£lf
.
feEÇbËd
 
ªd
 s–f.
WARN
 >ğ£lf.
feLev–
 
th’


158 
£lf
:
	$wr™eToLog
(
¡r
)

159 
’d


160 
’d


162 --- 
Log
 
a
 
mes§ge
, 
Ëv–
 
INFO
.

163 --- @
·¿m
 
¡r
 
Log
 
mes§ge


164 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
·¿m‘”s


165 
funùiÚ
 
log
:
	$šfo
(
¡r
, ...)

166 
¡r
 = "[INFO] " .. sŒ:
	$fÜm©
(...)

168 
£lf
.
INFO
 >ğ£lf.
Ëv–
 
th’


169 
	`´št
(
	`wh™e
("%s", 
¡r
))

170 
’d


172 
£lf
.
feEÇbËd
 
ªd
 s–f.
INFO
 >ğ£lf.
feLev–
 
th’


173 
£lf
:
	$wr™eToLog
(
¡r
)

174 
’d


175 
’d


177 --- 
Log
 
a
 
mes§ge
, 
Ëv–
 
DEBUG
.

178 --- @
·¿m
 
¡r
 
Log
 
mes§ge


179 --- @
·¿m
 
¬gs
 
FÜm©tšg
 
·¿m‘”s


180 
funùiÚ
 
log
:
	$debug
(
¡r
, ...)

181 
¡r
 = "[DEBUG] " .. sŒ:
	$fÜm©
(...)

183 
£lf
.
DEBUG
 >ğ£lf.
Ëv–
 
th’


184 
	`´št
(
	`g»’
("%s", 
¡r
))

185 
’d


187 
£lf
.
feEÇbËd
 
ªd
 s–f.
DEBUG
 >ğ£lf.
feLev–
 
th’


188 
£lf
:
	$wr™eToLog
(
¡r
)

189 
’d


190 
’d


192  
log


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lpm.lua

2 --- @
fe
 
	gÍm
.
	glua


3 --- @
br›f
 
LÚge¡
 
P»fix
 
	gM©chšg
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

9 --
»quœe
 "utils"

10 
loÿl
 
bªd
, 
	glshiá
, 
	grshiá
 = 
b™
.bªd, 
	gb™
.lshiá, b™.
rshiá


11 
loÿl
 
	gdpdkc
 = 
»quœe
 "dpdkc"

12 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

13 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

14 
loÿl
 
log
 = 
»quœe
 "log"

15 
»quœe
 "memory"

16 --
loÿl
 
bur¡
 = 
»quœe
 "burst"

18 
ffi
.
cdef
 [[

20 
	s¹e_bË_Ím_·¿ms
 {

21 
ušt32_t
 
n_ruËs
;

22 
ušt32_t
 
’Œy_unique_size
;

23 
ušt32_t
 
off£t
;

25 * 
mg_bË_Ím_ü—‹
(*
·¿ms
, 
sock‘_id
, 
ušt32_t
 
’Œy_size
);

26 
mg_bË_Ím_ä“
(*
bË
);

27 
mg_bË_’Œy_add_sim¶e
(

28 *
bË
,

29 
ušt32_t
 

,

30 
ušt8_t
 
d•th
,

31 *
’Œy
);

32 
mg_bË_Ím_’Œy_add
(

33 *
bË
,

34 
ušt32_t
 

,

35 
ušt8_t
 
d•th
,

36 *
’Œy
,

37 *
key_found
,

38 **
’Œy_±r
);

39 
mg_bË_Ím_lookup
(

40 *
bË
,

41 
¹e_mbuf
 **
pkts
,

42 
ušt64_t
 
pkts_mask
,

43 
ušt64_t
 *
lookup_h™_mask
,

44 **
’Œ›s
);

45 
mg_bË_Ím_lookup_big_bur¡
(

46 *
bË
,

47 
¹e_mbuf
 **
pkts
,

48 
mg_b™mask
* 
pkts_mask
,

49 
mg_b™mask
* 
lookup_h™_mask
,

50 **
’Œ›s
);

51 
mg_bË_Ím_’Œy_d–‘e
(

52 *
bË
,

53 
ušt32_t
 

,

54 
ušt8_t
 
d•th
,

55 *
key_found
,

56 *
’Œy
);

57 ** 
mg_Ím_bË_®loÿ‹_’Œy_´ts
(
ušt16_t
 
n_’Œ›s
);

58 
´štf
(cÚ¡ *
fmt
, ...);

60 
mg_bË_Ím_­¶y_rou‹
(

61 
¹e_mbuf
 **
pkts
,

62 
mg_b™mask
* 
pkts_mask
,

63 **
’Œ›s
,

64 
ušt16_t
 
off£t_’Œy
,

65 
ušt16_t
 
off£t_pkt
,

66 
ušt16_t
 
size
);

71 
loÿl
 
	gmod
 = {}

73 
loÿl
 
mg_Ím4TabË
 = {}

74 
mod
.
mg_Ím4TabË
 = mg_lpm4Table

75 
mg_Ím4TabË
.
__šdex
 = mg_lpm4Table

77 --- 
C»©e
 
a
 
Ãw
 
LPM
 
lookup
 
bË
.

78 --- @
·¿m
 
sock‘
 
İtiÚ®
 ( = sock‘ 
of
 
the
 
ÿÎšg
 
th»ad
), 
CPU
 
	gsock‘
, 
wh”e
 
memÜy
 th
bË
 
should
 
be
 
	g®loÿ‹d
.

79 --- @ 
the
 
bË
 
hªdËr


80 
funùiÚ
 
	gmod
.
	$ü—‹Lpm4TabË
(
sock‘
, 
bË
, 
’Œy_ùy³
)

81 
sock‘
 = sock‘ 
Ü
 
	`£Ëù
(2, 
dpdk
.
	`g‘CÜe
())

82 -- 
cÚfigu»
 
·¿m‘”s
 
the
 
LPM
 
bË


83 
loÿl
 
·¿ms
 = 
ffi
.
	`Ãw
("struct„te_table_lpm_params")

84 
·¿ms
.
n_ruËs
 = 1000

85 
·¿ms
.
’Œy_unique_size
 = 5

86 --
·¿ms
.
off£t
 = 128 + 27+4

87 
·¿ms
.
off£t
 = 128+ 14 + 12+4

88  
	`£tm‘©abË
({

89 
bË
 =abË 
Ü
 
ffi
.
	`gc
(ffi.
C
.
	`mg_bË_Ím_ü—‹
(
·¿ms
, 
sock‘
, ffi.(
’Œy_ùy³
)), 
	`funùiÚ
(
£lf
)

90 -- 
FIXME
: 
why
 
is
 
de¡ruùÜ
 
Ãv”
 
ÿÎed
?

91 
log
:
	`debug
("lpm garbage")

92 
ffi
.
C
.
	`mg_bË_Ím_ä“
(
£lf
)

93 
’d
),

94 
’Œy_ùy³
 =ƒntry_ctype

95 
	}
}, 
	gmg_Ím4TabË
)

96 
	g’d


98 -- --- 
F»e
 
the
 
LPM
 
	gTabË


99 -- --- @ 0 
Ú
 
	gsucûss
, 
”rÜ
 
code
 
	gÙh”wi£


100 -- 
funùiÚ
 
	gmg_Ím4TabË
:
de¡ruù
()

101 --  
ffi
.
C
.
mg_bË_Ím_ä“
(
£lf
.
bË
)

102 -- 
’d


104 --- 
Add
 
ª
 
’Œy
 
to
 
a
 
TabË


105 --- @
·¿m
 
addr
 
IPv4
 
ÃtwÜk
 
add»ss
 
of
 
the
 
de¡š©iÚ
‚etwork.

106 --- @
·¿m
 
d•th
 
numb”
 
of
 
signifiÿÁ
 
b™s
 oà
the
 
de¡š©iÚ
 
ÃtwÜk
 
add»ss


107 --- @
·¿m
 
’Œy
 
routšg
 
bË
ƒÁry (
wl
 
be
 
cİ›d
)

108 --- @ 
Œue
 
’Œy
 
was
 
added
 
w™hout
 
”rÜ


109 
funùiÚ
 
mg_Ím4TabË
:
	$addEÁry
(
addr
, 
d•th
, 
’Œy
)

110  0 =ğ
ffi
.
C
.
	$mg_bË_’Œy_add_sim¶e
(
£lf
.
bË
, 
addr
, 
d•th
, 
’Œy
)

111 
’d


113 --- 
P”fÜm
 
IPv4
 
rou‹
 
lookup
 
a
 
bur¡
 
of
 
·ck‘s


114 --- 
This
 
should
 
nÙ
 
be
 
u£d
 
sšgË
 
·ck‘
 
lookup
, 
as
 
i¡
 
bršgs


115 --- 
a
 
signifiÿÁ
 
³ÇÉy
 
bur¡s
 <<64

116 --- @
·¿m
 
·ck‘s
 
A¼ay
 
of
 
	`mbufs
 (
bufA¼ay
), 
which
 
the
 
lookup
 
wl
 
be
 
³rfÜmed


117 --- @
·¿m
 
mask
 
	`İtiÚ®
 ( = 
®l
 
·ck‘s
), 
b™mask
, 
which
…ack‘ 
the
 
lookup
 
should
 
be
 
³rfÜmed


118 --- @
·¿m
 
h™Mask
 
B™mask
, 
wh”e
 
the
 
rou‹d
 
·ck‘s
 
¬e
 
æagged


119 --- 
w™h
 
Úe
. 
This
 
may
 
be
 
the
 
§me
 
B™mask
 
as
 
·s£d
 
š
h
mask


120 --- 
·¿m‘”
, 
š
 
this
 
nÙ
 
rou‹d
 
·ck‘s
 
wl
 
be
 
ş—»d
 in

121 --- 
the
 
b™mask
.

122 --- @
·¿m
 
’Œ›s
 
P»®loÿ‹d
 
routšg
 
’Œy
 
Poš‹rs


123 
funùiÚ
 
mg_Ím4TabË
:
	`lookupBur¡
(
·ck‘s
, 
mask
, 
h™Mask
, 
’Œ›s
)

124 -- 
FIXME
: 
I
 
ã–
 
uÃasy
 
about
 
this
 
ÿ¡
, 
should
hi ÿ¡ 
nÙ
 
be


125 -- 
dÚe
 
im¶ic™ly
?

126  
ffi
.
C
.
	`mg_bË_Ím_lookup_big_bur¡
(
£lf
.
bË
, 
·ck‘s
.
¬¿y
, 
mask
.
b™mask
, 
h™Mask
.b™mask, ffi.
	`ÿ¡
("void **",
’Œ›s
.array))

127 
’d


129 
funùiÚ
 
mg_Ím4TabË
:
	$__£rŸlize
()

130  "»quœ'Ím';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('Ím').mg_Ím4TabË"), 
Œue


131 
’d


133 --- 
AÎoÿ‹s
 
ª
 
LPM
 
bË
 
’Œy


134 --- @ 
The
 
Ãwly
 
®loÿ‹d
 
’Œy


135 
funùiÚ
 
mg_Ím4TabË
:
	$®loÿ‹EÁry
()

136  
ffi
.
	$Ãw
(
£lf
.
’Œy_ùy³
)

137 
’d


139 
loÿl
 
mg_Ím4EÁryPŒs
 = {
	}
}

141 --- 
AÎoÿ‹s
 
ª
 
¬¿y
 
of
 
poš‹rs
 
to
 
routšg
 
bË
 
’Œ›s


142 --- 
This
 
is
 
u£d
 
duršg
 
bur¡
 
lookup
, 
to
 
¡Üe
 
»ã»nûs
Ø
	gthe


143 --- 
»suÉ
 
	g’Œ›s
.

144 --- @
·¿m
 
n
 
Numb”
 
of
 
’Œy
 
	gpoš‹rs


145 --- @ 
W¿µ”
 
bË
 
¬ound
 
the
 
®loÿ‹d
 
¬¿y


146 
funùiÚ
 
	gmg_Ím4TabË
:
®loÿ‹EÁryPŒs
(
n
)

147 --  
ffi
.
C
.
	$mg_Ím_bË_®loÿ‹_’Œy_´ts
(
n
)

148  
	`£tm‘©abË
({

149 
¬¿y
 = 
ffi
.
	`Ãw
(
£lf
.
’Œy_ùy³
 .. "*[?]", 
n
)

150 
	}
}, 
	gmg_Ím4EÁryPŒs
)

151 
’d


153 
funùiÚ
 
	gmg_Ím4EÁryPŒs
:
	$__šdex
(
k
)

154 
	`ty³
(
k
è=ğ"numb”" 
th’


155  
£lf
.
¬¿y
[
k
 - 1]

157  
mg_Ím4EÁryPŒs
[
k
]

158 
’d


159 
’d


161 
funùiÚ
 
mod
.
	$­¶yRou‹
(
pkts
, 
mask
, 
’Œ›s
, 
’ŒyOff£t
)

162 
’ŒyOff£t
 =ƒÁryOff£ˆ
Ü
 1

163  
ffi
.
C
.
	`mg_bË_Ím_­¶y_rou‹
(
pkts
.
¬¿y
, 
mask
.
b™mask
, ffi.
	`ÿ¡
("void **", 
’Œ›s
.¬¿y), 
’ŒyOff£t
, 128, 6)

164 
’d


166 --- 
FIXME
: 
this
 
should
 
nÙ
 
be
 
š
 
LPM
 
moduË
. 
but
 
wh”e
?

167 --- 
Deüem’ts
 
the
 
IP
 
TTL
 
f›ld
 
of
 
®l
 
masked
 
·ck‘s
 
by
 
Úe
.

168 --- 
out_mask
 
masks
 
the
 
sucûssfuÎy
 
deüem’‹d
 
	`·ck‘s
 (
TTL
 
did
 
nÙ
 
»ach
 
z”o
).

169 
funùiÚ
 
mod
.
	$deüem’tTTL
(
pkts
, 
š_mask
, 
out_mask
, 
v4
)

170 
v4
 = ipv4 =ğ
n
 
Ü
 ipv4

171 
v4
 
th’


172 -- 
TODO
: 
C
 
im¶em’tiÚ
 
might
 
be
 
ç¡”
...

173 
i
, 
pkt
 
š
 
	$aœs
(
pkts
) do

174 
š_mask
[
i
] 
th’


175 
loÿl
 
kt
 = 
pkt
:
	$g‘IPPack‘
()

176 
loÿl
 
‰l
 = 
kt
.
4
:
	$g‘TTL
()

177 
‰l
 =tl - 1;

178 
kt
.
4
:
	$£tTTL
(
‰l
)

179 if(
‰l
 ~ğ0)
th’


180 
out_mask
[
i
] = 1

182 
out_mask
[
i
] = 0

183 
’d


185 
out_mask
[
i
] = 0

186 
’d


187 
’d


189 
log
:
	`çl
("TTL decrement for ipv6‚ot yet implemented")

190 
’d


191 
’d


193  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/main.lua

1 --- 
Maš
 
fe
 
ÿÎed
 
by
 
®l
 
sks
 
Ú
 
	g¡¬tup


3 -- 
£t
 
up
 
logg”
 
befÜe
 
došg
 
ªythšg
 

4 
loÿl
 
	glog
 = 
»quœe
 "log"

5 -- 
£t
 
log
 
Ëv–


6 
log
:
£tLev–
("INFO")

7 -- 
’abË
 
loggšg
 
to
 
fe


8 --
log
:
feEÇbË
()

10 -- 
glob®ly
 
avaabË
 
ut™y
 
funùiÚs


11 
»quœe
 "utils"

13 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

14 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

15 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

16 
loÿl
 
deviû
 = 
»quœe
 "device"

17 
loÿl
 
¡p
 = 
»quœe
 "StackTracePlus"

18 
loÿl
 
ffi
 = 
»quœe
 "ffi"

19 
loÿl
 
memÜy
 = 
»quœe
 "memory"

20 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

21 
loÿl
 
¬g·r£
 = 
»quœe
 "argparse"

23 -- 
lßds
 
®l
 
h—d”s
 
of
 
the
 
´ÙocŞ
 
¡ack


24 
»quœe
 "packet"

26 -- 
TODO
: 
add
 
commªd
 
lše
 
sw™ches
 
this
 
ªd
 
Ùh”
 
luaj™
-
debuggšg
 
ã©u»s


27 --
»quœe
("j™.v").
	$Ú
()

29 
loÿl
 
funùiÚ
 
	$g‘SckT¿û
(
”r
)

30 
	`´št
(
	`»d
("[FATAL] Lu¨”rÜ iÀsk %s", 
LIBMOON_TASK_NAME
))

31 
	`´št
(
¡p
.
	$¡ackŒaû
(
”r
, 2))

32 
’d


34 
loÿl
 
funùiÚ
 
	$run
(
fe
, ...)

35 
loÿl
 
süt
, 
”r
 = 
	$lßdfe
(
fe
)

36 
nÙ
 
süt
 
th’


37 
	$”rÜ
(
”r
)

38 
’d


39  
	$xpÿÎ
(
süt
, 
g‘SckT¿û
, ...)

40 
’d


42 
loÿl
 
funùiÚ
 
	$·r£CommªdLšeArgs
(...)

43 
loÿl
 
¬gs
 = { ... 
	}
}

44 
loÿl
 
dpdkCfg


45 
i
 = #args, 1, -1 do

46 
loÿl
 
	gv
 = 
¬gs
[
i
]

47 -- 
fšd
 --
dpdk
-
cÚfig
=
foo
 
·¿m‘”


48 
loÿl
 
cfg
, 
	gcouÁ
 = 
¡ršg
.
gsub
(
v
, "%-%-dpdk%-config%=", "")

49 
	gcouÁ
 =ğ1 
th’


50 
dpdkCfg
 = 
cfg


51 
bË
.
	$»move
(
¬gs
, 
i
)

53 -- 
is
 
™
 
ju¡
 
a
 
sim¶e
 
numb”
?

54 
	$tÚumb”
(
v
è
th’


55 
v
 = 
	$tÚumb”
(
v
)

56 
’d


57 
¬gs
[
i
] = 
v


58 
’d


59 
’d


60  
¬gs
, 
dpdkCfg


61 
’d


63 
loÿl
 
funùiÚ
 
	$ma¡”
(
_
, 
fe
, ...)

64 
memÜy
.
	$‹¡AÎoÿtiÚS·û
()

65 
LIBMOON_TASK_NAME
 = "master"

66 
loÿl
 
¬gs
, 
cfgFe
 = 
	$·r£CommªdLšeArgs
(...)

67 
libmoÚ
.
cÚfig
.
dpdkCÚfig
 = 
cfgFe


68 
libmoÚ
.
cÚfig
.
u£rsüt
 = 
fe


69 
libmoÚ
.
	`£tupP©hs
(è-- 
Ãed
 
the
 
u£rsüt
 
fœ¡
 
beÿu£
 
we
 
wªt
 
to
 
u£
h
·th


70 -- 
run
 
the
 
u£rsüt


71 
loÿl
 
ok
 = 
	$run
(
fe
)

72 
nÙ
 
ok
 
th’


74 
’d


75 
loÿl
 
·r£dArgs
 = {
	}
}

76 
_G
.
cÚfigu»
 
th’


77 
loÿl
 
·r£r
 = 
	$¬g·r£
()

78 
·r£r
:
	`¬gs
(
	$uÅack
(
¬gs
))

79 
·r£dArgs
 = {
	`xpÿÎ
(
_G
.
cÚfigu»
, 
g‘SckT¿û
, 
·r£r
, 
	`uÅack
(
¬gs
))
	}
}

80 
nÙ
 
·r£dArgs
[1] 
th’


82 
’d


83 
bË
.
»move
(
·r£dArgs
, 1)

84 -- 
nÙhšg
 
»tuºed
 
but
 
the
 
·r£r
 
was
 
	gu£d


85 -- 
ju¡
 
Œy
 
to
 
ÿÎ
 
the
 
·r£r
 
our£lves
 
h”e


87 
ªd
 (#·r£r.
_¬gum’ts
 ~ğ0 
Ü
 #·r£r.
_İtiÚs
 ~ğ0 o¸#·r£r.
_commªds
 ~ğ0è
th’


88 
·r£dArgs
 = {
·r£r
:
·r£
()}

89 
’d


90 
’d


91 
nÙ
 
libmoÚ
.
cÚfig
.
skIn™
 
th’


92 
nÙ
 
dpdk
.
	$š™
(è
th’


93 
log
:
	`çl
("Could‚ot initialize DPDK")

94 
’d


95 
’d


96 
loÿl
 
»suÉ
 = 
	`xpÿÎ
(
_G
.
ma¡”
, 
g‘SckT¿û
, 
	`uÅack
(
	`cÚÿtA¼ays
(
·r£dArgs
, 
¬gs
)))

97 -- 
¡İ
 
deviûs
 
	`Ãûs§ry
 (
£ems
 
to
 
be
 
a
 
´obËm
 
w™h
 
vœtio
 
©ched
 
vŸ
 
vho¡
 
u£r


98 
deviû
.
	`ş—nupDeviûs
()

99 -- 
ex™
 
´og¿m
 
Úû
 
the
 
ma¡”
 
sk
 
fšishes


100 
nÙ
 
»suÉ
 
th’


101 
os
.
	$ex™
(
»suÉ
)

102 
’d


103 -- 
™
 
is
 
up
 
to
 
the
 
u£r
 
´og¿m
Ø
wa™
 
¦aves
Ø
fšish
, 
e
.
g
. 
by
 
ÿÎšg
 
dpdk
.
	$wa™FÜSÏves
()

104 
’d


106 
loÿl
 
funùiÚ
 
	$¦ave
(
¬gs
)

107 
libmoÚ
.
	`£tupP©hs
()

108 -- 
mu¡
 
be
 
dÚe
 
befÜe
 
·rsšg
 
the
 
¬gs
 
as
 
they
 
might
 
»ly
 
Ú
 
de£rŸliz”s
 
lßded
 
by
h
süt


109 
loÿl
 
ok
 = 
	$run
(
libmoÚ
.
cÚfig
.
u£rsüt
)

110 
nÙ
 
ok
 
th’


112 
’d


113 -- 
cÜe
 > 
max
 cÜ
m—ns
 
this
 
is
 
a
 
sh¬ed
 
sk


114 
libmoÚ
.
	`g‘CÜe
(è>†ibmoÚ.
cÚfig
.
cÜes
[#libmoÚ.cÚfig.cÜes] 
th’


115 -- 
di§blšg
 
this
 
w¬nšg
 
mu¡
 
be
 
dÚe
 
befÜe
 
de£rŸlizšg
 
the
 
¬gum’ts


116 
libmoÚ
.
	$di§bËBadSock‘W¬nšg
()

117 
’d


118 
¬gs
 = 
	$lßd¡ršg
(
¬gs
)()

119 
loÿl
 
skId
 = 
¬gs
[1]

120 
loÿl
 
func
 = 
¬gs
[2]

121 
nÙ
 
_G
[
func
] 
th’


122 
log
:
	`çl
("¦avfunùiÚ % nÙ found", 
func
)

123 
’d


124 --
	`»quœe
("j™.p").
	`¡¬t
("l")

125 --
	`»quœe
("j™.dump").
	$Ú
()

126 
LIBMOON_TASK_NAME
 = 
func


127 
LIBMOON_TASK_ID
 = 
skId


128 
loÿl
 
»suÉs
 = { 
	`£Ëù
(2, 
	`xpÿÎ
(
_G
[
func
], 
g‘SckT¿û
, s–eù(3, 
	`uÅackAÎ
(
¬gs
)))è
	}
}

129 
loÿl
 
v®s
 = 
£½’t
.
	$dump
(
»suÉs
)

130 
loÿl
 
buf
 = 
ffi
.
	`Ãw
("char[?]", #vals + 1)

131 
ffi
.
	$cİy
(
buf
, 
v®s
)

132 
ffi
.
C
.
	$sk_¡Üe_»suÉ
(
skId
, 
buf
)

133 
libmoÚ
.
	$ruÂšg
(è
th’


134 
loÿl
 
ok
, 
”r
 = 
	$pÿÎ
(
deviû
.
»şaimTxBufãrs
)

135 
ok
 
th’


136 
memÜy
.
	$ä“MemPoŞs
()

138 
log
:
	`w¬n
("Could‚Ù„eşaimx memÜy: %s", 
”r
)

139 
’d


140 
’d


141 --
	`»quœe
("j™.p").
	$¡İ
()

142 
’d


144 
funùiÚ
 
	$maš
(
sk
, ...)

145 
sk
 =ğ"ma¡”" 
th’


146 
	$ma¡”
(...)

147 
–£if
 
sk
 =ğ"¦ave" 
th’


148 
	$¦ave
(...)

150 
log
:
	`çl
("šv®idasky³ %s", 
sk
)

151 
’d


152 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/memory.lua

1 --- 
MemÜy
 
mªagem’t
 
ªd
 
DPDK
 
mempoŞs


2 
loÿl
 
	gmod
 = {}

4 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

5 
loÿl
 
ffi
 = 
»quœe
 "ffi"

6 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

7 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

8 
loÿl
 
ns
 = 
»quœe
 "namespaces"

9 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

10 
loÿl
 
log
 = 
»quœe
 "log"

11 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

13 
loÿl
 
funùiÚ
 
	$lßdAÎoÿtÜ
()

14 
loÿl
 
ok
, 
jem®loc
 = 
	`pÿÎ
(
ffi
.
lßd
, "libjemalloc.so")

15 
ok
 
th’


16  
jem®loc
, "jemalloc"

17 
’d


18 
loÿl
 
ok
, 
jem®loc
 = 
	`pÿÎ
(
ffi
.
lßd
, "libjemalloc.so.1")

19 
ok
 
th’


20  
jem®loc
, "jemalloc"

21 
’d


22 
loÿl
 
ok
, 
jem®loc
 = 
	`pÿÎ
(
ffi
.
lßd
, "libjemalloc.so.2")

23 
ok
 
th’


24  
jem®loc
, "jemalloc"

25 
’d


26  
ffi
.
C
, "system malloc"

27 
’d


29 
loÿl
 
®loÿtÜ
, 
®loÿtÜName
 = 
	$lßdAÎoÿtÜ
()

31 
ffi
.
cdef
 [[

32 * 
	`m®loc
(
size_t
 
size
);

33 
	`ä“
(* 
buf
);

34 * 
	`®loc_huge
(
size_t
 
size
);

35 
	`ä“_huge
(* 
±r
, 
size_t
 
size
);

38 
loÿl
 
C
 = 
ffi
.C

39 
loÿl
 
ÿ¡
 = 
ffi
.cast

41 
loÿl
 
w¬nšgShown
 = 
çl£


42 
loÿl
 
funùiÚ
 
	$‹¡M®loc
(
size
)

43 
loÿl
 
mem
 = 
®loÿtÜ
.
	$m®loc
(
size
)

44 
loÿl
 
±r
 = 
ffi
.
	`ÿ¡
("ušŒ_t", 
mem
)

45 
±r
 < 2^32 
ªd
 
nÙ
 
w¬nšgShown
 
th’


46 
size
 < 2^20 
th’


47 
log
:
	`šfo
("malloc()‡llocates small objects < 1 MiB from LuaJIT memory space, install†ibjemalloc if youƒncounter out of memoryƒrrors.")

49 
log
:
	`w¬n
("malloc()‡llocates objects >= 1 MiB from LuaJIT memory space.")

50 
log
:
	`w¬n
("Install†ibjemalloc if youƒncounter out of memoryƒrrors.")

51 
’d


52 
w¬nšgShown
 = 
Œue


53 
®loÿtÜName
 =ğ"jem®loc" 
th’


54 
log
:
	`w¬n
("Already using jemalloc,…lease file‡ bug with your system details on github")

55 
’d


56 
’d


57 
®loÿtÜ
.
	$ä“
(
mem
)

58 
’d


60 --- 
Te¡s
 
the
 
und”lyšg
 
m®loc
 
im¶em’tiÚ
 
¶ays
 
niû
 
w™h
 
LuaJIT
.

61 
funùiÚ
 
mod
.
	$‹¡AÎoÿtiÚS·û
()

62 
log
:
	`debug
("Cu¼’ˆ®loÿtÜ i %s", 
®loÿtÜName
)

63 
n
 = 26, 6, -2 do

64 
	`‹¡M®loc
(2^
n
)

65 
’d


66 
’d


68 --- 
Off
-
h—p
 
®loÿtiÚ
, 
nÙ
 
g¬bage
-
cŞËùed
.

69 --- @
·¿m
 
ùy³
 
a
 
ffi
 
ty³
, 
mu¡
 
be
‡ 
poš‹r
 
Ü
 
¬¿y
ype

70 --- @
·¿m
 
size
 
the
 
amouÁ
 
of
 
memÜy
 
to
 
®loÿ‹


71 
funùiÚ
 
mod
.
	$®loc
(
ùy³
, 
size
)

72  
	`ÿ¡
(
ùy³
, 
®loÿtÜ
.
	$m®loc
(
size
))

73 
’d


75 --- 
F»e
 
off
-
h—p
 
®loÿ‹d
 
objeù
.

76 
funùiÚ
 
mod
.
	$ä“
(
buf
)

77 
®loÿtÜ
.
	$ä“
(
buf
)

78 
’d


81 --- 
Off
-
h—p
 
®loÿtiÚ
 
Ú
 
huge
 
·ges
, 
nÙ
 
g¬bage
-
cŞËùed
.

82 --- 
S“
 
memÜy
.
®loc
.

83 
funùiÚ
 
mod
.
	$®locHuge
(
ùy³
, 
size
)

84 
loÿl
 
mem
 = 
C
.
	$®loc_huge
(
size
)

85 
loÿl
 
addr
 = 
ffi
.
	`ÿ¡
("ušt64_t", 
mem
)

86 
addr
 =ğ0xFFFFFFFFFFFFFFFFULL 
th’


87 
log
:
	`çl
("failedo‡llocate memory")

88 
’d


89  
	$ÿ¡
(
ùy³
, 
mem
)

90 
’d


92 
funùiÚ
 
mod
.
	$ä“Huge
(
±r
, 
size
)

93 
loÿl
 
”r
 = 
C
.
	$ä“_huge
(
±r
, 
size
)

94 
”r
 ~ğ0 
th’


95 
log
:
	`çl
("munm­ faed: %s", 
	$¡rE¼Ü
(
”r
))

96 
’d


97 
’d


99 
ffi
.
cdef
[[

100 
	`ãnû
();

103 
funùiÚ
 
mod
.
	$ãnû
()

104 
ffi
.
C
.
	$ãnû
()

105 
’d


107 
loÿl
 
mempoŞs
 = {
	}
}

108 
loÿl
 
mempoŞCache
 = 
ns
:
	$g‘
()

110 
loÿl
 
ÿcheEÇbËd
 = 
çl£


112 --- 
EÇbË
 
mempoŞ
 
»cyşšg
.

113 --- 
C®lšg
 
this
 
funùiÚ
 
’abËs
 
the
 
mempoŞ
 
ÿche
. 
This
 
´ev’ts
 
memÜy
 
Ëaks


114 --- 
as
 
DPDK
 
ÿÂÙ
 
d–‘e
 
mempoŞs
.

115 --- 
MempoŞs
 
w™h
 
the
 
§me
 
·¿m‘”s
 
ü—‹d
 
Ú
h§m
cÜe
 
wl
 
be
 
»cyşed
.

116 --- 
This
 
is
 
nÙ
 
y‘
 
’abËd
 
by
  
beÿu£
 
I
'm‚ot 100% confidenthat it works

117 --- 
´İ”ly
 
š
 
®l
 
ÿ£s
.

118 --- 
FÜ
 
exam¶e
, 
mempoŞs
 
·s£d
 
to
 
Ùh”
 
sks
 
wl
 
´obably
  
¡uff
.

119 
funùiÚ
 
mod
.
	$’abËCache
()

120 
log
:
	`w¬n
("mempool cache is currently broken,his will…robably crash")

121 
ÿcheEÇbËd
 = 
Œue


122 
’d


124 
loÿl
 
funùiÚ
 
	$g‘PoŞFromCache
(
sock‘
, 
n
, 
bufSize
)

125 
nÙ
 
ÿcheEÇbËd
 
th’


127 
’d


128 
loÿl
 
poŞ


129 
mempoŞCache
.
	`lock
(
	`funùiÚ
()

130 -- 
TODO
: 
·ss
 
ª
 
™”©Ü
 
cÚ‹xt
 
to
 
the
 
ÿÎback


131 -- 
the
 
cÚ‹xt
 
could
 
th’
 
run
 
funùiÚs
 
like
 
	$abÜt
(è
Ü
 
	$»moveCu¼’t
()

132 
loÿl
 
»suÉ


133 
mempoŞCache
:
	`fÜEach
(
	$funùiÚ
(
key
, 
poŞ
)

134 
»suÉ
 
th’


136 
’d


137 
poŞ
.
sock‘
 == socket

138 
ªd
 
poŞ
.
n
 ==‚

139 
ªd
 
poŞ
.
bufSize
 == bufSize

140 
ªd
 
poŞ
.
cÜe
 =ğ
libmoÚ
.
	$g‘CÜe
(è
th’


141 
»suÉ
 = 
key


142 
’d


143 
’d
)

144 
»suÉ
 
th’


145 
poŞ
 = 
mempoŞCache
[
»suÉ
].pool

146 
mempoŞCache
[
»suÉ
] = 
n


147 
’d


148 
’d
)

149 
poŞ
 
th’


150 
loÿl
 
bufs
 = {
	}
}

151 
i
 = 1, 
n
 do

152 
loÿl
 
	gbuf
 = 
poŞ
:
	$®loc
(
bufSize
)

153 
ffi
.
	$fl
(
buf
.
buf_addr
, buf.
buf_Ën
, 0)

154 
bufs
[#buf + 1] = 
buf


155 
’d


156 
_
, 
v
 
š
 
	$aœs
(
bufs
) do

157 
dpdkc
.
	$¹e_pktmbuf_ä“_expÜt
(
v
)

158 
’d


159 
’d


160  
poŞ


161 
’d


163 --- 
C»©e
 
a
 
Ãw
 
memÜy
 
poŞ
.

164 --- 
MemÜy
 
poŞs
 
¬e
 
»cyşed
 
Úû
 
the
 
ownšg
 
sk
 
‹rmš©es
.

165 --- 
C®l
 :
	$»š
(è
mempoŞs
 
th©
 
¬e
 
·s£d
 
to
 
Ùh”
 
sks
.

166 --- 
A
 
bË
 
w™h
 
Çmed
 
¬gum’ts
 
should
 
be
 
u£d
.

167 --- @
·¿m
 
¬gs
 
A
 
bË
 
cÚššg
 
the
 
fŞlowšg
 
Çmed
 
¬gum’ts


168 --- @
·¿m
 
n
 
	`İtiÚ®
 ( = 2047), 
size
 
of
 
the
 
mempoŞ


169 --- @
·¿m
 
func
 
İtiÚ®
, 
š™
 func, 
ÿÎed
 
—ch
 
¬gum’t


170 --- @
·¿m
 
sock‘
 
	`İtiÚ®
 ( = sock‘ 
of
 
the
 
ÿÎšg
 
th»ad
), 
NUMA
 
assocŸtiÚ
. 
This
 
ÿÂÙ
 
be
h
Úly
 
¬gum’t
 
š
h
ÿÎ
.

171 --- @
·¿m
 
bufSize
 
İtiÚ®
 
the
 
size
 
of
 
—ch
 
bufãr
, 
ÿn
 
Úly
 
be
 
u£d
 
®l
 
Ùh”
 
¬gs
 
¬e
 
·s£d
 
as
 
w–l


172 
funùiÚ
 
mod
.
	$ü—‹MemPoŞ
(...)

173 
loÿl
 
¬gs
 = {...
	}
}

174 
ty³
(
¬gs
[1]è=ğ"bË" 
th’


175 
¬gs
 =‡rgs[1]

177 
ty³
(
¬gs
[1]è=ğ"funùiÚ" 
th’


178 -- (
func
[, 
sock‘
])

179 
	g¬gs
.
	gsock‘
 = 
¬gs
[2]

180 
¬gs
.
func
 =‡rgs[1]

181 
–£if
 
ty³
(
¬gs
[2]è=ğ"numb”" 
th’


182 -- (
n
[, 
sock‘
])

183 
	g¬gs
.
	gsock‘
 = 
¬gs
[2]

184 
–£if
 
ty³
(
¬gs
[1]è=ğ"numb”" 
th’


185 -- (
n
[, 
func
])

186 
	g¬gs
.
	gn
 = 
¬gs
[1]

187 
¬gs
.
func
 =‡rgs[2]

188 
¬gs
.
sock‘
 =‡rgs[3]

189 
’d


190 
’d


191 -- 
DPDK
 
»comm’ds
 
to
 
u£
 
a
 
v®ue
 
of
 
n
=2^
k
 - 1 
h”e


192 
¬gs
.
n
 =‡rgs.À
Ü
 2047

193 
¬gs
.
sock‘
 =‡rgs.sock‘ 
Ü
 
£Ëù
(2, 
libmoÚ
.
	$g‘CÜe
())

194 
¬gs
.
bufSize
 =‡rgs.bufSiz
Ü
 2048

195 -- 
TODO
: 
g‘
 
ÿched
 
mempoŞ
 
äom
 
the
 mempoŞ 
poŞ
 
possibË
 
ªd
 
u£
 
th©
 
š¡—d


196 -- 
FIXME
: 
the
 
todo
 
£ems
 
to
 
be
 
®»ady
 
im¶em’‹d
 
h”e
.

197 
loÿl
 
mem
 = 
	$g‘PoŞFromCache
(
¬gs
.
sock‘
,‡rgs.
n
,‡rgs.
bufSize
è
Ü
 
dpdkc
.
	$š™_mem
(
¬gs
.
n
,‡rgs.
sock‘
,‡rgs.
bufSize
)

198 
¬gs
.
func
 
th’


199 
loÿl
 
bufs
 = {
	}
}

200 
i
 = 1, 
	g¬gs
.
n
 do

201 -- 
	gTODO
: 
make
 
this
 
d•’d’t
 
Ú
 
bufSize


202 
loÿl
 
buf
 = 
mem
:
	$®loc
(1522)

203 
¬gs
.
	$func
(
buf
)

204 
bufs
[#buf + 1] = 
buf


205 
’d


206 
i
, 
v
 
š
 
	$aœs
(
bufs
) do

207 
dpdkc
.
	$¹e_pktmbuf_ä“_expÜt
(
v
)

208 
’d


209 
’d


210 
mempoŞs
[#mempools + 1] = {

211 
poŞ
 = 
mem
,

212 
sock‘
 = 
¬gs
.socket,

213 
n
 = 
¬gs
.n,

214 
bufSize
 = 
¬gs
.bufSize,

215 
cÜe
 = 
libmoÚ
.
	`g‘CÜe
()

216 
	}
}

217  
mem


218 
	g’d


220 --- 
F»e
 
®l
 
memÜy
 
poŞs
 
owÃd
 
by
 
this
 
	gsk
.

221 --- 
AÎ
 
queues
 
usšg
 
the£
 
poŞs
 
mu¡
 
be
 
¡İ³d
 
befÜe
 
ÿÎšg
 
	gthis
.

222 
funùiÚ
 
	gmod
.
	$ä“MemPoŞs
()

223 
nÙ
 
ÿcheEÇbËd
 
th’


225 
’d


226 
_
, 
mem
 
š
 
	$aœs
(
mempoŞs
) do

227 
mempoŞCache
[
	`to¡ršg
(
mem
.
poŞ
)] = mem

228 
’d


229 
mempoŞs
 = {
	}
}

230 
’d


232 
loÿl
 
mempoŞ
 = {}

233 
mempoŞ
.
__šdex
 = mempool

235 --- 
R‘aš
 
a
 
memÜy
 
poŞ
.

236 --- 
This
 
wl
 
´ev’t
 
the
 
poŞ
 
äom
 
bešg
 
»tuºed
 
to
 
a
…oŞ 
of
 
poŞs
 
Úû
h
sk
 
’ds
.

237 
funùiÚ
 
mempoŞ
:
	$»š
()

238 
i
, 
v
 
š
 
	$aœs
(
mempoŞs
) do

239 
v
.
poŞ
 =ğ
£lf
 
th’


240 
bË
.
	$»move
(
mempoŞs
, 
i
)

242 
’d


243 
’d


244 
’d


246 
funùiÚ
 
mempoŞ
:
	$®loc
(
l
)

247 
loÿl
 
r
 = 
dpdkc
.
	$®loc_mbuf
(
£lf
)

248 
r
.
pkt_Ën
 = 
l


249 
r
.
d©a_Ën
 = 
l


250  
r


251 
’d


253 
loÿl
 
bufA¼ay
 = {
	}
}

255 --- 
C»©e
 
a
 
Ãw
 
¬¿y
 
of
 
memÜy
 
bufãrs
 (
š™Ÿlized
 
to
 
n
).

256 
funùiÚ
 
mempoŞ
:
	$bufA¼ay
(
n
)

257 
n
 =‚ 
Ü
 63

258  
	`£tm‘©abË
({

259 
size
 = 
n
,

260 
maxSize
 = 
n
,

261 
¬¿y
 = 
ffi
.
	`Ãw
("¡ruù„‹_mbuf*[?]", 
n
),

262 
mem
 = 
£lf
,

263 
	}
}, 
	gbufA¼ay
)

264 
’d


267 
loÿl
 
funùiÚ
 
	$®loc
()

268 
log
:
	`çl
("buf‡rray‚ot‡ssociated with‡ memory…ool", 2)

269 
’d


271 --- 
C»©e
 
a
 
Ãw
 
¬¿y
 
of
 
memÜy
 
	`bufãrs
 (
š™Ÿlized
 
to
 
n
).

272 -- 
This
 
buf
 
¬¿y
 
is
 
nÙ
 
assocŸ‹d
 
w™h
 
a
 
memÜy
 
poŞ
.

273 
funùiÚ
 
mod
.
	`ü—‹BufA¼ay
(
n
)

274 -- 
®low
 
£lf
-
ÿÎs


275 
£lf
 =ğ
mod
 
th’


276 
n
 = 
£lf


277 
’d


278 
n
 =‚ 
Ü
 63

279  
	`£tm‘©abË
({

280 
size
 = 
n
,

281 
maxSize
 = 
n
,

282 
¬¿y
 = 
ffi
.
	`Ãw
("¡ruù„‹_mbuf*[?]", 
n
),

283 
®loc
 =‡lloc

284 
	}
}, 
	gbufA¼ay
)

285 
’d


287 
	gmod
.
	gbufA¼ay
 = 
mod
.
ü—‹BufA¼ay


288 
’d


290 --- 
Resize
 
the
 
bufA¼ay


291 --- @
·¿m
 
size
 
New
 siz
of
 
the
 
bufA¼ay


292 --- @
nÙe
 
EÆ¬gšg
 
the
 
bufA¼ay
 (
size
 > 
£lf
.
maxSize
è
is
 
nÙ
 
y‘
 
suµÜ‹t


293 
funùiÚ
 
bufA¼ay
:
	$»size
(
size
)

294 
size
 > 
£lf
.
maxSize
 
th’


295 -- 
TODO
: 
cÚsid”
 
»®locšg
 
the
 
h”e


296 
log
:
	`çl
("enlarging‡ bufArray is currently‚ot supported")

297 
’d


298 
£lf
.
size
 = size

299 
’d


301 
funùiÚ
 
bufA¼ay
:
	$ofæßdUdpChecksums
(
v4
, 
l2L’
, 
l3L’
)

302 
v4
 = ipv4 =ğ
n
 
Ü
 ipv4

303 
l2L’
 =†2L’ 
Ü
 14

304 
v4
 
th’


305 
l3L’
 =†3L’ 
Ü
 20

306 
i
 = 0, 
£lf
.
size
 - 1 do

307 
£lf
.
¬¿y
[
i
].
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
¬¿y
[
i
].
Ş_æags
, 
dpdk
.
PKT_TX_IPV4
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_UDP_CKSUM
)

308 
£lf
.
¬¿y
[
i
].
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

309 
’d


310 
dpdkc
.
	$ÿlc_v4_p£udo_h—d”_checksums
(
£lf
.
¬¿y
, s–f.
size
, 20)

312 
l3L’
 =†3L’ 
Ü
 40

313 
i
 = 0, 
£lf
.
size
 - 1 do

314 
£lf
.
¬¿y
[
i
].
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
¬¿y
[
i
].
Ş_æags
, 
dpdk
.
PKT_TX_IPV6
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_UDP_CKSUM
)

315 
£lf
.
¬¿y
[
i
].
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

316 
’d


317 
dpdkc
.
	$ÿlc_v6_p£udo_h—d”_checksums
(
£lf
.
¬¿y
, s–f.
size
, 30)

318 
’d


319 
’d


321 
funùiÚ
 
bufA¼ay
:
	$ofæßdIPSec
(
idx
, 
mode
, 
£c_ty³
)

322 
i
 = 0, 
£lf
.
size
 - 1 do

323 
loÿl
 
buf
 = 
£lf
.
¬¿y
[
i
]

324 
buf
:
	$ofæßdIPSec
(
idx
, 
mode
, 
£c_ty³
)

325 
’d


326 
’d


328 --- 
If
 
ÿÎed
, 
IP
 
chksum
 
ofæßdšg
 
wl
 
be
 
dÚe
 
the
 
fœ¡
 
n
 
·ck‘s


329 -- 
š
 
the
 
bufA¼ay
.

330 -- @
·¿m
 
v4
 
	$İtiÚ®
 ( = 
Œue
è
¥ecif›s
, 
the
 
bufãrs
 
cÚš
 
v4
 
·ck‘s


331 -- @
·¿m
 
l2L’
 
	`İtiÚ®
 ( = 14)

332 -- @
·¿m
 
l3L’
 
	`İtiÚ®
 ( = 20)

333 -- @
·¿m
 
n
 
	$İtiÚ®
 ( = 
bufA¼ay
.
size
è
how
 
mªy
 
·ck‘s
 
š
 
the
 
¬¿y
,h
İ”©iÚ


334 -- 
should
 
be
 
­¶›d


335 
funùiÚ
 
bufA¼ay
:
	`ofæßdIPChecksums
(
v4
, 
l2L’
, 
l3L’
, 
n
)

336 -- 
¶—£
 dØ
nÙ
 
touch
 
this
 
funùiÚ
 
w™hout
 
ÿ»fuÎy
 
m—suršg
 
the
 
³rfÜmªû
 
im·ù


337 -- 
FIXME
: 
touched
 
this
.

338 -- 
added
 
·¿m‘”
 
n


339 
v4
 = ipv4 =ğ
n
 
Ü
 ipv4

340 
l2L’
 =†2L’ 
Ü
 14

341 
n
 =‚ 
Ü
 
£lf
.
size


342 
v4
 
th’


343 
l3L’
 =†3L’ 
Ü
 20

344 
i
 = 0, 
n
 - 1 do

345 
£lf
.
¬¿y
[
i
].
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
¬¿y
[
i
].
Ş_æags
, 
dpdk
.
PKT_TX_IPV4
, dpdk.
PKT_TX_IP_CKSUM
)

346 
£lf
.
¬¿y
[
i
].
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

347 
’d


349 
l3L’
 =†3L’ 
Ü
 40

350 
i
 = 0, 
n
 - 1 do

351 
£lf
.
¬¿y
[
i
].
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
¬¿y
[
i
].
Ş_æags
, 
dpdk
.
PKT_TX_IPV6
, dpdk.
PKT_TX_IP_CKSUM
)

352 
£lf
.
¬¿y
[
i
].
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

353 
’d


354 
’d


355 
’d


357 
funùiÚ
 
bufA¼ay
:
	$ofæßdTıChecksums
(
v4
, 
l2L’
, 
l3L’
, 
n
)

358 
v4
 = ipv4 =ğ
n
 
Ü
 ipv4

359 
l2L’
 =†2L’ 
Ü
 14

360 
n
 =‚ 
Ü
 
£lf
.
size


361 
v4
 
th’


362 
l3L’
 =†3L’ 
Ü
 20

363 
i
 = 0, 
n
 - 1 do

364 
£lf
.
¬¿y
[
i
].
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
¬¿y
[
i
].
Ş_æags
, 
dpdk
.
PKT_TX_IPV4
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_TCP_CKSUM
)

365 
£lf
.
¬¿y
[
i
].
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

366 
’d


367 
dpdkc
.
	$ÿlc_v4_p£udo_h—d”_checksums
(
£lf
.
¬¿y
, 
n
, 25)

369 
l3L’
 =†3L’ 
Ü
 40

370 
i
 = 0, 
n
 - 1 do

371 
£lf
.
¬¿y
[
i
].
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
¬¿y
[
i
].
Ş_æags
, 
dpdk
.
PKT_TX_IPV6
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_TCP_CKSUM
)

372 
£lf
.
¬¿y
[
i
].
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

373 
’d


374 
dpdkc
.
	$ÿlc_v6_p£udo_h—d”_checksums
(
£lf
.
¬¿y
, 
n
, 35)

375 
’d


376 
’d


378 --- 
Ofæßds
 
VLAN
 
gs
 
Ú
 
®l
 
·ck‘s
.

379 -- 
Equiv®’t
 
to
 
ÿÎšg
 
pkt
:
	$£tVÏn
(
vÏn
, 
pı
, 
cfi
è
Ú
 
®l
 
·ck‘s
.

380 
funùiÚ
 
bufA¼ay
:
	$£tVÏns
(
vÏn
, 
pı
, 
cfi
)

381 
loÿl
 
tci
 = 
vÏn
 + 
b™
.
	`lshiá
(
pı
 
Ü
 0, 13è+ b™.
	$lshiá
(
cfi
 
Ü
 0, 12)

382 
i
 = 0, 
£lf
.
size
 - 1 do

383 
£lf
.
¬¿y
[
i
].
vÏn_tci
 = 
tci


384 
£lf
.
¬¿y
[
i
].
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
¬¿y
[
i
].
Ş_æags
, 
dpdk
.
PKT_TX_VLAN_PKT
)

385 
’d


386 
’d


388 --- 
AÎoÿ‹s
 
bufãrs
 
äom
 
the
 
memÜy
 
poŞ
 
ªd
 
fls
h
¬¿y


389 --- 
AÎoÿ‹s
 
as
 
mªy
 
bufãrs
‡ 
this
 
¬¿y
 
is
 
Ïrge


390 --- @
·¿m
 
size
 
Size
 
of
 
ev”y
 
bufãr


391 
funùiÚ
 
bufA¼ay
:
	$®loc
(
size
)

392 
dpdkc
.
	$®loc_mbufs
(
£lf
.
mem
, s–f.
¬¿y
, s–f.
size
, size)

393 
’d


395 --- 
AÎoÿ‹s
 
bufãrs
 
äom
 
the
 
memÜy
 
poŞ
 
ªd
 
fls
h
¬¿y
.

396 --- 
AÎoÿ‹s
 
Úly
 
a
 
maximum
 
of
 
num
 
bufãrs
 
by
 
»sizšg
 
the
 
size
 oàth
bufA¼ay
.

397 --- @
·¿m
 
size
 
Size
 
of
 
ev”y
 
bufãr


398 --- @
·¿m
 
num
 
Numb”
 
of
 
bufãrs
 
to
 
®loÿ‹
.

399 
funùiÚ
 
bufA¼ay
:
	$®locN
(
size
, 
num
)

400 
£lf
:
	$»size
(
num
)

401 
dpdkc
.
	$®loc_mbufs
(
£lf
.
mem
, s–f.
¬¿y
, s–f.
size
, size)

402 
’d


404 --- 
F»e
 
®l
 
bufãrs
 
š
 
the
 
¬¿y
. 
Stİs
 
wh’
 
™
 
’couÁ”s
h
fœ¡
 
Úe
 
th©
 
is
 
nuÎ
.

405 
funùiÚ
 
bufA¼ay
:
	$ä“AÎ
()

406 
i
 = 0, 
£lf
.
size
 - 1 do

407 
£lf
.
¬¿y
[
i
] =ğ
n
 
th’


409 
’d


410 
dpdkc
.
	$¹e_pktmbuf_ä“_expÜt
(
£lf
.
¬¿y
[
i
])

411 
£lf
.
¬¿y
[
i
] = 
n


412 
’d


413 
’d


415 --- 
F»e
 
the
 
fœ¡
 
n
 
bufãrs
.

416 
funùiÚ
 
bufA¼ay
:
	$ä“
(
n
)

417 
i
 = 0, 
n
 - 1 do

418 
£lf
.
¬¿y
[
i
] ~ğ
n
 
th’


419 
dpdkc
.
	$¹e_pktmbuf_ä“_expÜt
(
£lf
.
¬¿y
[
i
])

420 
’d


421 
’d


422 
’d


424 --- 
F»e
 
the
 
®l
 
bufãrs
 
aá”
 
šdex
 
n
.

425 
funùiÚ
 
bufA¼ay
:
	$ä“Aá”
(
n
)

426 
i
 = 
n
, 
£lf
.
size
 - 1 do

427 
£lf
.
¬¿y
[
i
] ~ğ
n
 
th’


428 
dpdkc
.
	$¹e_pktmbuf_ä“_expÜt
(
£lf
.
¬¿y
[
i
])

429 
’d


430 
’d


431 
’d


433 
funùiÚ
 
bufA¼ay
.
	`__šdex
(
£lf
, 
k
)

434 -- 
TODO
: 
is
 
this
 
as
 
ç¡
‡ 
I
 
hİe
 
™
 
to
 
be
?

435  
	`ty³
(
k
è=ğ"numb”" 
ªd
 
£lf
.
¬¿y
[k - 1] 
Ü
 
bufA¼ay
[k]

436 
’d


438 
funùiÚ
 
bufA¼ay
.
	$__Ãwšdex
(
£lf
, 
i
, 
v
)

439 
£lf
.
¬¿y
[
i
 - 1] = 
v


440 
’d


442 
funùiÚ
 
bufA¼ay
.
	$__Ën
(
£lf
)

443  
£lf
.
size


444 
’d


447 
loÿl
 
funùiÚ
 
	$™
(
£lf
, 
i
)

448 
i
 >ğ
£lf
.
size
 
th’


449  
n


450 
’d


451  
i
 + 1, 
£lf
.
¬¿y
[i]

452 
’d


454 
funùiÚ
 
bufA¼ay
.
	$__aœs
(
£lf
)

455  
™
, 
£lf
, 0

456 
’d


457 
’d


460 
ffi
.
	`m‘©y³
("¡ruù mempoŞ", 
mempoŞ
)

462  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/namespaces.lua

2 --- @
fe
 
	gÇme¥aûs
.
	glua


3 --- @
br›f
 
	gName¥aûs
 ...

4 --- @
todo
 
TODO
 
	gdocu


7 
loÿl
 
	gmod
 = {}

9 
loÿl
 
ffi
 = 
»quœe
 "ffi"

10 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

11 
loÿl
 
¡p
 = 
»quœe
 "StackTracePlus"

12 
loÿl
 
lock
 = 
»quœe
 "lock"

13 
loÿl
 
log
 = 
»quœe
 "log"

15 
ffi
.
cdef
 [[

16 
	sÇme¥aû
 { };

17 
Çme¥aû
* 
ü—‹_Ü_g‘_Çme¥aû
(cÚ¡ * 
Çme
);

18 
Çme¥aû_¡Üe
(
Çme¥aû
* 
ns
, cÚ¡ * 
key
, cÚ¡ * 
v®ue
);

19 
Çme¥aû_d–‘e
(
Çme¥aû
* 
ns
, cÚ¡ * 
key
);

20 cÚ¡ * 
Çme¥aû_»Œ›ve
(
Çme¥aû
* 
ns
, cÚ¡ * 
key
);

21 
Çme¥aû_™”©e
(
Çme¥aû
* 
ns
, (*
func
)(cÚ¡ * 
key
, cÚ¡ * 
v®
));

22 
lock
* 
	`Çme¥aû_g‘_lock
(
Çme¥aû
* 
ns
);

24 
loÿl
 
cbTy³
 = 
ffi
.
	`ty³of
("void (*)(const char* key, const char* val)")

26 
loÿl
 
C
 = 
ffi
.C

28 
loÿl
 
Çme¥aû
 = {
	}
}

29 
Çme¥aû
.
__šdex
 =‚amespace

31 
loÿl
 
funùiÚ
 
	$g‘NameFromT¿û
()

32  
debug
.
	$Œaûback
():
	`m©ch
("\n.-\n.-\n(.-)\n")

33 
’d


35 --- 
G‘
 
a
 
Çme¥aû
 
by
 
™s
 
Çme
 
ü—tšg
 
™
 
Ãûs§ry
.

36 --- @
·¿m
 
Çme
 
the
‚ame, 
deçuÉs
 
to
 
ª
‡uto-
g’”©ed
 
¡ršg
 
cÚsi¡šg
 
of
h
ÿÎ”
's filename‡nd†ine‚umber

37 
funùiÚ
 
mod
:
	$g‘
(
Çme
)

38 
Çme
 =‚am
Ü
 
	$g‘NameFromT¿û
()

39  
C
.
	$ü—‹_Ü_g‘_Çme¥aû
(
Çme
)

40 
’d


42 --- 
R‘r›ve
 
a
 *
cİy
* 
of
‡ 
v®ue
 
š
 
the
 
Çme¥aû
.

43 --- @
·¿m
 
key
 
the
 key, 
mu¡
 
be
 
a
 
¡ršg


44 
funùiÚ
 
Çme¥aû
:
	$__šdex
(
key
)

45 
	`ty³
(
key
è~ğ"¡ršg" 
th’


46 
log
:
	`çl
("Table index must be‡ string")

47 
’d


48 
key
 =ğ"fÜEach" 
th’


49  
Çme¥aû
.
fÜEach


50 
–£if
 
key
 =ğ"lock" 
th’


51  
C
.
	$Çme¥aû_g‘_lock
(
£lf
)

52 
’d


53 
loÿl
 
v®
 = 
C
.
	$Çme¥aû_»Œ›ve
(
£lf
, 
key
)

54  
v®
 ~ğ
n
 
ªd
 
	`lßd¡ršg
(
ffi
.
	$¡ršg
(
v®
))(è
Ü
 
n


55 
’d


57 --- 
StÜe
 
a
 
v®ue
 
š
 
the
 
Çme¥aû
.

58 --- @
·¿m
 
key
 
the
 key, 
mu¡
 
be
 
a
 
¡ršg


59 --- @
·¿m
 
v®
 
the
 
v®ue
 
to
 
¡Üe
, 
wl
 
be
 
£rŸlized


60 
funùiÚ
 
Çme¥aû
:
	$__Ãwšdex
(
key
, 
v®
)

61 
	`ty³
(
key
è~ğ"¡ršg" 
th’


62 
log
:
	`çl
("Table index must be‡ string")

63 
’d


64 
key
 =ğ"fÜEach" 
Ü
 key =ğ"lock" 
th’


65 
log
:
	`çl
(
key
 .. " is„eserved", 2)

66 
’d


67 
v®
 =ğ
n
 
th’


68 
C
.
	$Çme¥aû_d–‘e
(
£lf
, 
key
)

70 
C
.
	`Çme¥aû_¡Üe
(
£lf
, 
key
, 
£½’t
.
	$dump
(
v®
))

71 
’d


72 
’d


75 --- 
I‹¿‹
 
ov”
 
®l
 
keys
/
v®ues
 
š
 
a
 
Çme¥aû


76 --- 
NÙe
: 
Çme¥aûs
 dØ
nÙ
 
ofãr
 
a
 'nÜm®' 
	$™”©Ü
 (
e
.
g
. 
through
 
a
 
__·œ
 
m‘am‘hod
è
due
 
to
 
lockšg
.

77 --- 
I‹¿tšg
 
ov”
 
a
 
bË
 
»quœes
‡ 
lock
 
Ú
 
the
 
whŞe
abË; 
’suršg
 
th©
hlock 
is
 
»Ëa£d
 is

78 --- 
—s›r
 
w™h
 
a
 
fÜEach
 
m‘hod
 
thª
 w™h‡ 
»guÏr
 
™”©Ü
.

79 --- @
·¿m
 
func
 
funùiÚ
 
to
 
ÿÎ
, 
	$»ûives
 (
key
, 
v®ue
è
as
 
¬gum’ts


80 
funùiÚ
 
Çme¥aû
:
	$fÜEach
(
func
)

81 
loÿl
 
ÿughtE¼Ü


82 
loÿl
 
cb
 = 
ffi
.
	`ÿ¡
(
cbTy³
, 
	$funùiÚ
(
key
, 
v®
)

83 
ÿughtE¼Ü
 
th’


85 
’d


86 -- 
avoid
 
throwšg
 
ª
 
”rÜ
 
aüoss
 
the
 
C
++ 
äame
 
uÂeûs§ry


87 -- 
nÙ
 
su»
 
this
 
would
 
wÜk
 
´İ”ly
 
wh’
 
comped
 
w™h
 
şªg
 
š¡—d
 
of
 
gcc


88 
loÿl
 
ok
, 
”r
 = 
	`xpÿÎ
(
func
, 
	$funùiÚ
(
”r
)

89  
¡p
.
	$¡ackŒaû
(
”r
)

90 
’d
, 
ffi
.
	`¡ršg
(
key
), 
	`lßd¡ršg
(ffi.
	$¡ršg
(
v®
))())

91 
nÙ
 
ok
 
th’


92 
ÿughtE¼Ü
 = 
”r


93 
’d


94 
’d
)

95 
C
.
	$Çme¥aû_™”©e
(
£lf
, 
cb
)

96 
cb
:
	$ä“
()

97 
ÿughtE¼Ü
 
th’


98 -- 
this
 
is
 
gÚÇ
 
be
 
ª
 
ugly
 
”rÜ
 
mes§ge
, 
but
 
©
 
Ëa¡
 
we
 
g‘
 
the
 
fuÎ
 
ÿÎ
 
¡ack


99 
log
:
	`çl
("E¼Ü whÿÎšg c®lback, iÂ”ƒ¼Ü: " .. 
ÿughtE¼Ü
)

100 
’d


101 
’d


103 
ffi
.
	`m‘©y³
("¡ruù‚ame¥aû", 
Çme¥aû
)

105  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/packet.lua

2 --- @
fe
 
	g·ck‘
.
	glua


3 --- @
br›f
 
Ut™y
 
funùiÚs
 
·ck‘s
 (
¹e_mbuf
).

4 --- 
	gInşudes
:

5 --- - 
G’”®
 
funùiÚs
 (
time¡ampšg
, 
¿‹
 
cÚŒŞ
, ...)

6 --- - 
	gOfæßdšg


7 --- - 
C»©e
 
·ck‘
 
	gty³s


10 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

12 
»quœe
 "utils"

13 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

14 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

15 
loÿl
 
log
 = 
»quœe
 "log"

16 
loÿl
 
cŞÜs
 = 
»quœe
 "colors"

18 
loÿl
 
bÜ
, 
	gbªd
, 
	gbnÙ
, 
	grshiá
, 
	glshiá
ğ
b™
.bÜ, 
	gb™
.bªd, b™.bnÙ, b™.rshiá, b™.
lshiá


19 
loÿl
 
	gi¡y³
 = 
ffi
.
i¡y³


20 
loÿl
 
wr™e
 = 
io
.write

21 
loÿl
 
¡rS¶™
 = strSplit

23 --- 
Paylßd
 
ty³
, 
»quœed
 
by
 
some
 
	g´ÙocŞs
, 
defšed
 
befÜe
 
lßdšg
 
them


24 
	gffi
.
	gcdef
[[

25 
	u·ylßd_t
 {

26 
ušt8_t
 
ušt8
[0];

27 
ušt16_t
 
	mušt16
[0];

28 
ušt32_t
 
	mušt32
[0];

29 
ušt64_t
 
	mušt64
[0];

33 
loÿl
 
	g´Ùo
 = 
»quœe
 "proto.proto"

36 ---- 
G’”®
 
funùiÚs


39 --- 
ModuË
 
	$·ck‘s
 (
¹e_mbuf
)

40 
loÿl
 
pkt
 = {
	}
}

41 
pkt
.
__šdex
 =…kt

44 --- 
G‘
 
a
 * 
poš‹r
 
to
 
the
 
·ck‘
 
d©a
.

45 
funùiÚ
 
pkt
:
	$g‘D©a
()

46  
ffi
.
	`ÿ¡
("void*", ffi.ÿ¡("ušt8_t*", 
£lf
.
buf_addr
è+ s–f.
d©a_off
)

47 
’d


49 
funùiÚ
 
pkt
:
	$g‘By‹s
()

50  
ffi
.
	`ÿ¡
("ušt8_t*", 
£lf
.
buf_addr
è+ s–f.
d©a_off


51 
’d


53 
funùiÚ
 
pkt
:
	$g‘Timesync
()

54  
£lf
.
timesync


55 
’d


57 
funùiÚ
 
pkt
:
	$dumpFÏgs
()

58 
log
:
	`debug
(
	`to¡ršg
(
£lf
.
Ş_æags
è.. " " .. 
	$to¡ršg
(
£lf
.
tx_ofæßd
))

59 
’d


61 --- 
R‘r›ve
 
the
 
time
 
¡amp
 
šfÜm©iÚ
.

62 --- @ 
The
 
time¡amp
 
Ü
 
n
 
the
 
·ck‘
 
was
 
nÙ
 
time
 
¡am³d
.

63 
funùiÚ
 
pkt
:
	$g‘Time¡amp
(
dev
)

64 
b™
.
	`bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_RX_IEEE1588_TMST
è~ğ0 
th’


65 
loÿl
 
d©a
 = 
ffi
.
	`ÿ¡
("ušt32_t* ", 
£lf
:
	$g‘D©a
())

66 
loÿl
 
low
, 
high


67 
dev
 
ªd
 dev.
embeddedTime¡ampAtEndOfBufãr
 
th’


68 -- 
ixgbe
-
¡yË
 
nics
 
th©
 
suµÜt
 
	$this
 (
i
.
e
. 
x550
)

69 
loÿl
 
time¡amp
 = 
ffi
.
	`ÿ¡
("ušt32_t*", ffi.ÿ¡("ušt8_t*", 
£lf
:
	`g‘D©a
()è+ s–f:
	`g‘Size
() - 8)

70 
low
 = 
time¡amp
[0]

71 
high
 = 
time¡amp
[1]

72  
high
 * 10^9 + 
low


74 -- 
TODO
: 
this
 
is
 
Úly
 
‹¡ed
 
w™h
 
the
 
IÁ–
 82580 
NIC
 
©
h
mom’t


75 -- 
the
 
d©ash“t
 
şaims
 
th©
 
low
 
ªd
 
high
 
¬e
 
sw­³d
, 
but
 
this
 
dÛ¢
't seemo behe case

76 -- 
TODO
: 
check
 
Ùh”
 
NICs


77 
low
 = 
d©a
[2]

78 
high
 = 
d©a
[3]

79  
high
 * 2^32 + 
low


80 
’d


81 
’d


82 
’d


84 --- 
Check
 
the
 
PKT_RX_IEEE1588_TMST
 
æag
 
is
 
£t
.

85 --- 
Tuºs
 
out
 
th©
 
this
 
æag
 
is
 
´‘ty
 
pošess
, 
™
 
dÛs
 
nÙ
 
šdiÿ‹


86 --- 
the
 
·ck‘
 
was
 
aùu®ly
 
time¡am³d
, 
ju¡
 
th©
 
™
 
ÿme
 
äom
 
a


87 --- 
queue
/
f‹r
 
w™h
 
time¡ampšg
 
’abËd
.

88 --- 
You
 
´obably
 
wªt
 
to
 
u£
 
deviû
:
	$hasTime¡amp
(è
ªd
 
check
 
the
 
£qu’û
 
numb”
.

89 
funùiÚ
 
pkt
:
	$hasTime¡amp
()

90  
b™
.
	`bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_RX_IEEE1588_TMST
) ~= 0

91 
’d


93 
funùiÚ
 
pkt
:
	$g‘SecFÏgs
()

94 
loÿl
 
£ı
 = 
b™
.
	`rshiá
(b™.
	`bªd
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_RX_IPSEC_SECP
), 11)

95 
loÿl
 
£û¼
 = 
b™
.
	`rshiá
(b™.
	`bªd
(
£lf
.
Ş_æags
, b™.
	`bÜ
(
dpdk
.
PKT_RX_SECERR_MSB
, dpdk.
PKT_RX_SECERR_LSB
)), 12)

96  
£ı
, 
£û¼


97 
’d


99 --- 
Ofæßd
 
VLAN
 
ggšg
 
to
 
the
 
NIC
 
this
 
·ck‘
.

100 
funùiÚ
 
pkt
:
	$£tVÏn
(
vÏn
, 
pı
, 
cfi
)

101 
loÿl
 
tci
 = 
vÏn
 + 
b™
.
	`lshiá
(
pı
 
Ü
 0, 13è+ b™.
	$lshiá
(
cfi
 
Ü
 0, 12)

102 
£lf
.
vÏn_tci
 = 
tci


103 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_VLAN_PKT
)

104 
’d


106 
loÿl
 
VLAN_VALID_MASK
 = 
b™
.
	`bÜ
(
dpdk
.
PKT_RX_VLAN_PKT
, dpdk.
PKT_TX_VLAN_PKT
)

108 --- 
G‘
 
the
 
VLAN
 
assocŸ‹d
 
w™h
 
a
 
»ûived
 
·ck‘
.

109 
funùiÚ
 
pkt
:
	$g‘VÏn
()

110 
b™
.
	`bÜ
(
£lf
.
Ş_æags
, 
VLAN_VALID_MASK
è=ğ0 
th’


111  
n


112 
’d


113 
loÿl
 
tci
 = 
£lf
.
vÏn_tci


114  
b™
.
	`bªd
(
tci
, 0xFFF), b™.
	`rshiá
(tci, 13), bit.band(bit.rshift(tci, 12), 1)

115 
’d


118 --- @
todo
 
TODO
 
dÛs


119 
funùiÚ
 
pkt
:
	$£tSize
(
size
)

120 
£lf
.
pkt_Ën
 = 
size


121 
£lf
.
d©a_Ën
 = 
size


122 
’d


124 
funùiÚ
 
pkt
:
	$g‘Size
()

125  
£lf
.
pkt_Ën


126 
’d


128 --- 
R‘uºs
 
the
 
·ck‘
 
d©a
 
ÿ¡
 
to
h
be¡
 
f™tšg
…acket .

129 --- 
S¹šg
 
w™h
 
‘h”Ãt
 
h—d”
.

130 --- @ 
·ck‘
 
d©a
 
as
 
cd©a
 
of
 
be¡
 
f™tšg
…acket

131 
funùiÚ
 
pkt
:
	$g‘
()

132  
£lf
:
	$g‘Eth”ÃtPack‘
():
	$»sŞveLa¡H—d”
()

133 
’d


135 --- 
Dumps
 
the
 
·ck‘
 
d©a
 
ÿ¡
 
to
h
be¡
 
f™tšg
…acket .

136 --- @
·¿m
 
by‹s
 
numb”
 
of
 by‹ 
to
 
dump
, 
	`İtiÚ®
 ( = 
·ck‘
 
size
)

137 --- @
·¿m
 
¡»am
 
the
 sŒ—m 
to
 
wr™e
o, 
	`İtiÚ®
 ( = 
io
.
¡dout
)

138 --- @
·¿m
 
cŞÜized
 
Pršt
 
the
 
dump
 
w™h
 
difã»Á
 
cŞÜs
 
—ch
 
	`´ÙocŞ
 ( = 
Œue
)

139 --- @
·¿m
 
wœesh¬k
 
Dump
 
š
 wœesh¬k 
com·tibË
 
	`fÜm©
 (
Wœesh¬k
 -> 
ImpÜt
 
äom
 
Hex
 Dump)

140 
funùiÚ
 
pkt
:
	$dump
(
by‹s
, 
¡»am
, 
cŞÜized
, 
wœesh¬k
)

141 
	`ty³
(
by‹s
è=ğ"u£rd©a" 
th’


142 
¡»am
 = 
by‹s


143 
cŞÜized
 = 
¡»am


144 
by‹s
 = 
n


145 
’d


146 
cŞÜized
 = cŞÜized =ğ
n
 
Ü
 colorized

147 
£lf
:
	$g‘
():
	$dump
(
by‹s
 
Ü
 
£lf
.
pkt_Ën
, 
¡»am
 o¸
io
.
¡dout
, 
cŞÜized
, 
wœesh¬k
)

148 
’d


150 
funùiÚ
 
pkt
:
	$ä“
()

151 
dpdkc
.
	$¹e_pktmbuf_ä“_expÜt
(
£lf
)

152 
’d


155 ---- 
IPSec
 
ofæßdšg


158 --- 
U£
 
IP£c
 
ofæßdšg
.

159 --- @
·¿m
 
idx
 
SA_IDX
 
to
 
u£


160 --- @
·¿m
 
£c_ty³
 
IPSec
 
ty³
 
to
 
	`u£
 ("esp"/"ah")

161 --- @
·¿m
 
e¥_mode
 
ESP
 
mode
 
to
 
u£
 
	$’üy±
(1è
Ü
 
	$auth’tiÿ‹
(0)

162 
funùiÚ
 
pkt
:
	$ofæßdIPSec
(
idx
, 
£c_ty³
, 
e¥_mode
)

163 
loÿl
 
mode
 = 
e¥_mode
 
Ü
 0

164 
loÿl
 
t
 = 
n


165 
£c_ty³
 =ğ"e¥" 
th’


166 
t
 = 1

167 
–£if
 
£c_ty³
 =ğ"ah" 
th’


168 
t
 = 0

170 
log
:
	`çl
("Wrong IPSecype (esp/ah)")

171 
’d


173 -- 
S‘
 
IPSec
 
ofæßd
 
æag
 
š
 
advªûd
 
d©a
 
Œªsm™
 
desütÜ
.

174 
£lf
.
Ş_æags
 = 
b™
.
	`bÜ
(£lf.Ş_æags, 
dpdk
.
PKT_TX_IPSEC
)

176 -- 
S‘
 10 
b™
 
SA_IDX


177 --
idx
 < 0 
Ü
 idx > 1023 
th’


178 -- 
	`”rÜ
("SA_IDX haso be in„ange 0-2013")

179 --
’d


180 --
£lf
.
Ş_£c
.
£c
.
§_idx
 = 
idx


181 
£lf
.
Ş_£c
.
d©a
 = 
b™
.
	`bÜ
(£lf.Ş_£c.d©a, b™.
	`lshiá
(b™.
	`bªd
(
idx
, 0x3FF), 0))

183 -- 
S‘
 
ESP
 
’c
/
auth
 
mode


184 --
mode
 ~ğ0 
ªd
 mod~ğ1 
th’


185 -- 
	`”rÜ
("Wrong IPSec mode")

186 --
’d


187 --
£lf
.
Ş_£c
.
£c
.
mode
 = mode

188 
£lf
.
Ş_£c
.
d©a
 = 
b™
.
	`bÜ
(£lf.Ş_£c.d©a, b™.
	`lshiá
(b™.
	`bªd
(
mode
, 0x1), 20))

190 -- 
S‘
 
IPSec
 
ESP
/
AH
 
ty³


191 --
£c_ty³
 =ğ"e¥" 
th’


192 -- 
£lf
.
Ş_£c
.
£c
.
ty³
 = 1

193 --
–£if
 
£c_ty³
 =ğ"ah" 
th’


194 -- 
£lf
.
Ş_£c
.
£c
.
ty³
 = 0

196 -- 
	`”rÜ
("Wrong IPSecype (esp/ah)")

197 --
’d


198 
£lf
.
Ş_£c
.
d©a
 = 
b™
.
	`bÜ
(£lf.Ş_£c.d©a, b™.
	`lshiá
(b™.
	`bªd
(
t
, 0x1), 19))

199 
’d


201 --- 
S‘
 
the
 
ESP
 
Œa”
 
Ëngth


202 --- @
·¿m
 
Ën
 
ESP
 
T¿”
 
Ëngth
 
š
 
by‹s


203 
funùiÚ
 
pkt
:
	`£tESPT¿”L’gth
(
Ën
)

204 --
Di§bË
 
¿nge
 
check
 
³rfÜmªû
 
»asÚs


205 --
Ën
 < 0 
Ü
†’ > 511 
th’


206 -- 
	`”rÜ
("ESPrailer†ength haso be in„ange 0-511")

207 --
’d


208 --
£lf
.
Ş_£c
.
£c
.
e¥_Ën
 = 
Ën
 -- 
dÚt
 
u£
 
b™f›lds


209 
£lf
.
Ş_£c
.
d©a
 = 
b™
.
	`bÜ
(£lf.Ş_£c.d©a, b™.
	`lshiá
(b™.
	`bªd
(
Ën
, 0x1FF), 10))

210 
’d


213 ---- 
Checksum
 
ofæßdšg


216 --- 
In¡ruù
 
the
 
NIC
 
to
 
ÿlcuÏ‹
h
IP
 
checksum
 
this
 
·ck‘
.

217 --- @
·¿m
 
v4
 
BoŞ—n
 
to
 
decide
 
wh‘h”
 
the
 
·ck‘
 
u£s
 
	`IPv4
 (
£t
Ø
n
/
Œue
è
Ü
 
	`IPv6
 (£ˆtØ
ªythšg
 ).

218 --- 
In
 
™
 
is
 
ª
 
IPv6
 
·ck‘
, dØ
	`nÙhšg
 (
the
 
h—d”
 
has
 
no
 
checksum
).

219 --- @
·¿m
 
l2L’
 
L’gth
 
of
 
the
 
Ïy”
 2 
h—d”
 
š
 
	`by‹s
 ( 14 
by‹s
 
‘h”Ãt
).

220 --- @
·¿m
 
l3L’
 
L’gth
 
of
 
the
 
Ïy”
 3 
h—d”
 
š
 
	`by‹s
 ( 20 
by‹s
 
IPv4
).

221 
funùiÚ
 
pkt
:
	$ofæßdIPChecksum
(
v4
, 
l2L’
, 
l3L’
)

222 
v4
 = ipv4 =ğ
n
 
Ü
 ipv4

223 
l2L’
 =†2L’ 
Ü
 14

224 
v4
 
th’


225 
l3L’
 =†3L’ 
Ü
 20

226 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_IPV4
, dpdk.
PKT_TX_IP_CKSUM
)

228 
l3L’
 =†3L’ 
Ü
 40

229 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_IPV4
, dpdk.
PKT_TX_IP_CKSUM
)

230 
’d


231 
£lf
.
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

232 
’d


234 --- 
In¡ruù
 
the
 
NIC
 
to
 
ÿlcuÏ‹
h
IP
 
ªd
 
UDP
 
checksum
 
this
 
·ck‘
.

235 --- @
·¿m
 
v4
 
BoŞ—n
 
to
 
decide
 
wh‘h”
 
the
 
·ck‘
 
u£s
 
	`IPv4
 (
£t
Ø
n
/
Œue
è
Ü
 
	`IPv6
 (£ˆtØ
ªythšg
 ).

236 --- @
·¿m
 
l2L’
 
L’gth
 
of
 
the
 
Ïy”
 2 
h—d”
 
š
 
	`by‹s
 ( 14 
by‹s
 
‘h”Ãt
).

237 --- @
·¿m
 
l3L’
 
L’gth
 
of
 
the
 
Ïy”
 3 
h—d”
 
š
 
	`by‹s
 ( 20 
by‹s
 
IPv4
, 40 by‹ 
IPv6
).

238 
funùiÚ
 
pkt
:
	`ofæßdUdpChecksum
(
v4
, 
l2L’
, 
l3L’
)

239 -- 
NOTE
: 
this
 
m‘hod
 
ÿÂÙ
 
be
 
moved
 
to
 
the
 
udpPack‘
 
şass
 
beÿu£
 
™
 
dÛ¢
'ˆ×nd cª'
t
è
know
h
pktbuf
 iˆ
b–Úgs
o

240 
v4
 = ipv4 =ğ
n
 
Ü
 ipv4

241 
l2L’
 =†2L’ 
Ü
 14

242 
v4
 
th’


243 
l3L’
 =†3L’ 
Ü
 20

244 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_IPV4
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_UDP_CKSUM
)

245 
£lf
.
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

246 -- 
ÿlcuÏ‹
 
p£udo
 
h—d”
 
checksum
 
beÿu£
 
the
 
NIC
 
dÛ¢
't dohis...

247 
dpdkc
.
	`ÿlc_v4_p£udo_h—d”_checksum
(
£lf
:
	`g‘D©a
(), 20)

249 
l3L’
 =†3L’ 
Ü
 40

250 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_IPV6
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_UDP_CKSUM
)

251 
£lf
.
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

252 -- 
ÿlcuÏ‹
 
p£udo
 
h—d”
 
checksum
 
beÿu£
 
the
 
NIC
 
dÛ¢
't dohis...

253 
dpdkc
.
	`ÿlc_v6_p£udo_h—d”_checksum
(
£lf
:
	`g‘D©a
(), 30)

254 
’d


255 
’d


257 --- 
In¡ruù
 
the
 
NIC
 
to
 
ÿlcuÏ‹
h
IP
 
ªd
 
TCP
 
checksum
 
this
 
·ck‘
.

258 --- @
·¿m
 
v4
 
BoŞ—n
 
to
 
decide
 
wh‘h”
 
the
 
·ck‘
 
u£s
 
	`IPv4
 (
£t
Ø
n
/
Œue
è
Ü
 
	`IPv6
 (£ˆtØ
ªythšg
 ).

259 --- @
·¿m
 
l2L’
 
L’gth
 
of
 
the
 
Ïy”
 2 
h—d”
 
š
 
	`by‹s
 ( 14 
by‹s
 
‘h”Ãt
).

260 --- @
·¿m
 
l3L’
 
L’gth
 
of
 
the
 
Ïy”
 3 
h—d”
 
š
 
	`by‹s
 ( 20 
by‹s
 
IPv4
, 40 by‹ 
IPv6
).

261 
funùiÚ
 
pkt
:
	`ofæßdTıChecksum
(
v4
, 
l2L’
, 
l3L’
)

262 -- 
NOTE
: 
this
 
m‘hod
 
ÿÂÙ
 
be
 
moved
 
to
 
the
 
udpPack‘
 
şass
 
beÿu£
 
™
 
dÛ¢
'ˆ×nd cª'
t
è
know
h
pktbuf
 iˆ
b–Úgs
o

263 
v4
 = ipv4 =ğ
n
 
Ü
 ipv4

264 
l2L’
 =†2L’ 
Ü
 14

265 
v4
 
th’


266 
l3L’
 =†3L’ 
Ü
 20

267 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_IPV4
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_TCP_CKSUM
)

268 
£lf
.
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

269 -- 
ÿlcuÏ‹
 
p£udo
 
h—d”
 
checksum
 
beÿu£
 
the
 
NIC
 
dÛ¢
't dohis...

270 
dpdkc
.
	`ÿlc_v4_p£udo_h—d”_checksum
(
£lf
:
	`g‘D©a
(), 25)

272 
l3L’
 =†3L’ 
Ü
 40

273 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_IPV6
, dpdk.
PKT_TX_IP_CKSUM
, dpdk.
PKT_TX_TCP_CKSUM
)

274 
£lf
.
tx_ofæßd
 = 
l2L’
 + 
l3L’
 * 128

275 -- 
ÿlcuÏ‹
 
p£udo
 
h—d”
 
checksum
 
beÿu£
 
the
 
NIC
 
dÛ¢
't dohis...

276 
dpdkc
.
	`ÿlc_v6_p£udo_h—d”_checksum
(
£lf
:
	`g‘D©a
(), 35)

277 
’d


278 
’d


280 --- @
todo
 
TODO
 
docu


281 
funùiÚ
 
pkt
:
	$’abËTime¡amps
()

282 
£lf
.
Ş_æags
 = 
b™
.
	$bÜ
(
£lf
.
Ş_æags
, 
dpdk
.
PKT_TX_IEEE1588_TMST
)

283 
’d


287 ---- 
C»©e
 
Ãw
 
·ck‘
 
ty³


290 -- 
funùiÚs
 
of
 
the
 
·ck‘


291 
loÿl
 
·ck‘G‘H—d”s


292 
loÿl
 
·ck‘G‘H—d”


293 
loÿl
 
·ck‘Dump


294 
loÿl
 
·ck‘Fl


295 
loÿl
 
·ck‘G‘


296 
loÿl
 
·ck‘ResŞveLa¡H—d”


297 
loÿl
 
·ck‘C®cuÏ‹Checksums


298 
loÿl
 
·ck‘MakeSŒuù


300 --- 
C»©e
 
ªd
 
funùiÚs
 
a
 
Ãw
 
·ck‘
.

301 --- 
FÜ
 
im¶em’‹d
 
	`h—d”s
 (
£e
 
´Ùo
/è
the£
 
·ck‘s
 
¬e
 
defšed
 
š
 
the
 
£ùiÚ
 'Pack‘ sŒuù' 
of
 
—ch
 
´ÙocŞ
 
fe


302 --- @
·¿m
 
¬gs
 
li¡
 
of
 
	`keywÜds
 (
£e
 
makeSŒuù
)

303 --- @ 
»tuºs
 
the
 
cÚ¡ruùÜ
/
ÿ¡
 
funùiÚ
 
this
 
·ck‘


304 --- @
£e
 
·ck‘MakeSŒuù


305 
funùiÚ
 
	$ü—‹Sck
(...)

306 
loÿl
 
¬gs
 = { ... 
	}
}

308 
loÿl
 
·ck‘
 = {}

309 
·ck‘
.
__šdex
 =…acket

310 
loÿl
 
noPaylßd
 = 
¬gs
[#args] == "noPayload"

311 
noPaylßd
 
th’


312 
¬gs
[#¬gs] = 
n


313 
’d


314 -- 
ü—‹
 

315 
loÿl
 
·ck‘Name
, 
	gùy³
 = 
	$·ck‘MakeSŒuù
(
¬gs
, 
noPaylßd
)

316 
nÙ
 
·ck‘Name
 
th’


317 
log
:
	`w¬n
("Failedo create‚ew…acketype.")

319 
’d


321 -- 
funùiÚs
 
of
 
the
 
·ck‘


322 
·ck‘
.
g‘Args
 = 
	$funùiÚ
(è 
¬gs
 
’d


324 
·ck‘
.
g‘Name
 = 
	$funùiÚ
(è 
·ck‘Name
 
’d


326 
·ck‘
.
g‘H—d”s
 = 
·ck‘G‘H—d”s


328 
·ck‘
.
g‘H—d”
 = 
·ck‘G‘H—d”


330 
·ck‘
.
dump
 = 
·ck‘Dump


332 
·ck‘
.
fl
 = 
·ck‘Fl


334 
·ck‘
.
g‘
 = 
·ck‘G‘


336 
·ck‘
.
»sŞveLa¡H—d”
 = 
·ck‘ResŞveLa¡H—d”


338 -- 
ruÁime
 
ü™iÿl
 
funùiÚ
, 
lßd
 
¥ecific
 
code
 
duršg
„untime

339 
·ck‘
.
£tL’gth
 = 
	`·ck‘S‘L’gth
(
¬gs
)

341 -- 
funùiÚs
 
	$mªu®
 (
nÙ
 
ofæßded
è
checksum
 
ÿlcuÏtiÚs


342 -- 
ruÁime
 
ü™iÿl
 
funùiÚ
, 
lßd
 
¥ecific
 
code
 
duršg
„untime

343 
·ck‘
.
ÿlcuÏ‹Checksums
 = 
	$·ck‘C®cuÏ‹Checksums
(
¬gs
)

345 
_
, 
v
 
š
 
	$aœs
(
¬gs
) do

346 
loÿl
 
d©a
 = 
	$g‘H—d”D©a
(
v
)

347 
h—d”
 = 
d©a
['proto']

348 
memb”
 = 
d©a
['name']

349 -- 
the
 
h—d”
 
has
 
a
 
checksum
, 
add
‡ 
funùiÚ
 
to
 
ÿlcuÏ‹
 
™


350 
h—d”
 =ğ"4" 
Ü
 h—d” =ğ"icmp" 
th’
 -- 
FIXME
 
NYI
 or header == "udp" or header == "tcp"hen

351 
loÿl
 
key
 = 'ÿlcuÏ‹' .. 
memb”
:
	`gsub
("^.", 
¡ršg
.
uµ”
) .. 'Checksum'

352 
·ck‘
[
key
] = 
	$funùiÚ
(
£lf
è£lf:
	$g‘H—d”
(
v
):
	$ÿlcuÏ‹Checksum
(è
’d


353 
’d


354 
’d


357 -- 
add
 
funùiÚs
 
to
 
·ck‘


358 
ffi
.
	`m‘©y³
(
·ck‘Name
, 
·ck‘
)

360 --  'g‘'/'ÿ¡' 
this
 
kšd
 
of
 
·ck‘


361  
	$funùiÚ
(
£lf
è 
	`ùy³
(£lf:
	$g‘D©a
()è
’d


362 
’d


364 
funùiÚ
 
	$·ck‘C»©e
(...)

365 
log
:
	`w¬n
('This function is deprecated‡nd will be„emoved inhe future.')

366 
log
:
	`w¬n
('Renamedo createStack(...)')

367  
	$ü—‹Sck
(...)

368 
’d


370 --- 
G‘
 
the
 
Çme
 
of
h
h—d”
,hÇmoàth
»¥eùive
 
memb”
 
ªd
h
Ëngth
 oàth
v¬ŸbË
 member

371 --- @
·¿m
 
v
 
E™h”
 
the
 
Çme
 
of
h
	`h—d”
 (
th’
h
memb”
 
has
h
§me
‚ame), 
Ü
 
a
 
bË
 { 
h—d”
,‚amğmemb”, 
Ëngth
 =†’gth, 
subTy³
 = 
ty³
 
	}
}

372 --- @ 
TabË
 
w™h
 
®l
 
	gd©a
: { 
´Ùo
 = 
h—d”
, 
	gÇme
 = 
memb”
, 
	gËngth
 = 
Ëngth
, 
	gsubTy³
 = 
ty³
 }

373 
funùiÚ
 
	$g‘H—d”D©a
(
v
)

374 
nÙ
 
v
 
th’


376 
–£if
 
	`ty³
(
v
è=ğ"bË" 
th’


377 
loÿl
 
h—d”
 = 
v
[1]

378 
loÿl
 
memb”
 = 
v
['name']

379 
loÿl
 
subTy³


380 -- 
¥ecŸl
 
®Ÿs
 
‘h”Ãt


381 
v
[1] =ğ"‘h" 
Ü
 v[1] =ğ"‘h”Ãt" 
th’


382 
h—d”
 = "ethernet"

383 
memb”
 = memb” 
Ü
 "eth"

384 
’d


385 
memb”
 = memb” 
Ü
 
h—d”


386 
´Ùo
[
h—d”
].
deçuÉTy³
 
th’


387 
subTy³
 = subTy³ 
Ü
 
´Ùo
[
h—d”
].
deçuÉTy³


388 
’d


389  { 
´Ùo
 = 
h—d”
, 
Çme
 = 
memb”
, 
Ëngth
 = 
v
['Ëngth'], 
subTy³
 = v['subTy³'] 
Ü
 subTy³ 
	}
}

391 -- 
Úly
 
the
 
h—d”
 
Çme
 
is
 
	ggiv’
 -> 
memb”
 
has
 
§me
 
	gÇme
, 
no
 
v¬ŸbË
 
	gËngth


392 -- 
¥ecŸl
 
®Ÿs
 
‘h”Ãt


393 
	gv
 =ğ"‘h”Ãt" 
Ü
 
v
 =ğ"‘h" 
th’


394  { 
´Ùo
 = "‘h”Ãt", 
	gÇme
 = "‘h", 
	gËngth
 = 
n
, 
	gsubTy³
 = "default" }

395 
	g’d


396 -- 
£t
  
subty³
 
avaabË


397 
loÿl
 
subTy³


398 
	g´Ùo
[
v
].
deçuÉTy³
 
th’


399 
	gsubTy³
 = 
subTy³
 
Ü
 
´Ùo
[
v
].
deçuÉTy³


400 
’d


401 -- 
Ùh”wi£
 
h—d”
 
Çme
 = 
memb”
‚ame

402  { 
´Ùo
 = 
v
, 
	gÇme
 = v, 
	gËngth
 = 
n
, 
	gsubTy³
 = 
subTy³
 }

403 
’d


404 
	g’d


406 --- 
G‘
 
®l
 
h—d”s
 
of
 
a
 
·ck‘
 
as
 
	gli¡
.

407 --- @
·¿m
 
£lf
 
The
 
	g·ck‘


408 --- @ 
TabË
 
of
 
memb”s
 oà
the
 
·ck‘


409 
funùiÚ
 
	$·ck‘G‘H—d”s
(
£lf
)

410 
loÿl
 
h—d”s
 = {
	}
}

411 
i
, 
v
 
š
 
aœs
(
£lf
:
	$g‘Args
()) do

412 
h—d”s
[
i
] = 
	$·ck‘G‘H—d”
(
£lf
, 
v
)

413 
’d


414  
h—d”s


415 
’d


417 --- 
G‘
 
the
 
¥ecif›d
 
h—d”
 
of
 
a
 
	`·ck‘
 (
e
.
g
. 
£lf
.
‘h
).

418 --- @
·¿m
 
£lf
 
the
 
	`·ck‘
 (
cd©a
)

419 --- @
·¿m
 
h
 
h—d”
 
to
 
be
 
»tuºed


420 --- @ 
The
 
memb”
 
of
 
the
 
·ck‘


421 
funùiÚ
 
	$·ck‘G‘H—d”
(
£lf
, 
h
)

422 
loÿl
 
memb”
 = 
	`g‘H—d”D©a
(
h
)['name']

423  
£lf
[
memb”
]

424 
’d


426 --- 
Pršt
 
a
 
hex
 
dump
 
of
‡ 
·ck‘
.

427 --- @
·¿m
 
£lf
 
the
 
·ck‘


428 --- @
·¿m
 
by‹s
 
Numb”
 
of
 by‹ 
to
 
dump
. 
If
 
no
 
size
 
is
 
¥ecif›d
 
the
 
·ylßd
 i 
Œunÿ‹d
.

429 --- @
·¿m
 
¡»am
 
the
 
IO
 sŒ—m 
to
 
wr™e
o, 
	`İtiÚ®
 ( = 
io
.
¡dout
)

430 --- @
·¿m
 
cŞÜized
 
Dump
 
the
 
·ck‘
 cŞÜized, 
ev”y
 
´ÙocŞ
 
š
 
a
 
difã»Á
 
	`cŞÜ
 ( = 
Œue
)

431 --- @
·¿m
 
wœesh¬k
 
Dump
 
š
 wœesh¬k 
com·tibË
 
	`fÜm©
 (
Wœesh¬k
 -> 
ImpÜt
 
äom
 
Hex
 Dump)

432 
funùiÚ
 
	$·ck‘Dump
(
£lf
, 
by‹s
, 
¡»am
, 
cŞÜized
, 
wœesh¬k
)

433 
	`ty³
(
by‹s
è=ğ"u£rd©a" 
th’


434 -- 
someÚe
 
ÿÎs
 
this
 
dœeùly
 
Ú
 
a
 
·ck‘


435 
¡»am
 = 
by‹s


436 
by‹s
 = 
n


437 
’d


438 
by‹s
 = by‹ 
Ü
 
ffi
.(
£lf
:
	$g‘Name
())

439 
¡»am
 = sŒ—m 
Ü
 
io
.
¡dout


440 
cŞÜized
 = cŞÜized =ğ
n
 
Ü
 colorized

441 
wœesh¬k
 = wœesh¬k 
Ü
 
çl£


443 -- 
	$£·¿tÜs
 (
´ÙocŞ
 
off£ts
è
cŞÜized
 
hex
 
dump


444 
loÿl
 
£ps
 = { 
	}
}

445 
loÿl
 
cŞÜCode
 = ''

447 
nÙ
 
wœesh¬k
 
th’


448 -- 
´št
 
time¡amp


449 
¡»am
:
wr™e
(
cŞÜized
 
ªd
 
wh™e
(
	$g‘TimeMiüos
()è
Ü
 
	`g‘TimeMiüos
())

451 -- 
h—d”s
 
š
 
ş—¹ext


452 
i
, 
v
 
š
 
	`aœs
(
£lf
:
	$g‘H—d”s
()) do

453 
cŞÜized
 
th’


454 
cŞÜCode
 = 
	$g‘CŞÜCode
(
i
)

455 
’d


457 
loÿl
 
¡r
 = 
v
:
	$g‘SŒšg
()

458 
i
 =ğ1 
th’


459 
¡»am
:
	`wr™e
(
cŞÜCode
 .. " " .. 
¡r
 .. "\n")

461 
¡»am
:
	`wr™e
(
cŞÜCode
 .. 
¡r
 .. "\n")

462 
’d


463 
£ps
[#£p + 1] = (£ps[#£ps] 
Ü
 0 ) + 
ffi
.(
v
)

464 
’d


465 
’d


467 -- 
hex
 
dump


468 
	$dumpHex
(
£lf
, 
by‹s
, 
¡»am
, 
cŞÜized
 
ªd
 
£ps
 
Ü
 
n
, 
wœesh¬k
)

469 
’d


471 --- 
S‘
 
®l
 
memb”s
 
of
‡Î 
h—d”s
.

472 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

473 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

474 --- 
The
 
¬gum’t
 'pktL’gth' 
ÿn
 
be
 
u£d
 
to
 
autom©iÿÎy
 
ÿlcuÏ‹
 
ªd
 
£t
 
the
 
Ëngth
 
memb”
 
of
 
	`h—d”s
 (
e
.
g
. 

 
h—d”
).

475 --- @
code


476 --- 
	`fl
(è--- 
Úly
  
v®ues


477 --- 
fl
{ 
‘hSrc
="12:23:34:45:56:67", 
TTL
=100 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
ƒthSrø
ªd
 
	gTTL


478 --- 
	gfl
{ 
	gpktL’gth
=64 } --- 
Úly
  
	gv®ues
, 
Ëngth
 
memb”s
 
of
 
the
 
h—d”s
 
¬e
 
	gadju¡ed


479 --- @
	g’dcode


480 --- @
·¿m
 
£lf
 
The
 
	g·ck‘


481 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
	g¬gum’ts
. 
FÜ
 
a
 
li¡
 oà
avaabË
 
¬gum’ts
 
	g£e
 "See‡lso"

482 --- @
nÙe
 
This
 
funùiÚ
 
is
 
	g¦ow
. 
If
 
you
 
wªt
 
to
 
modify
 
memb”s
 
of
 
a
 
h—d”
 
duršg
‡ 
time
 
ü™iÿl
 
£ùiÚ
 oà
your
 
süt
 
u£
 
the
 
»¥eùive
 
	g£‰”s
.

483 
funùiÚ
 
	$·ck‘Fl
(
£lf
, 
ÇmedArgs
)

484 
ÇmedArgs
 =‚amedArg 
Ü
 {
	}
}

485 
loÿl
 
h—d”s
 = 
£lf
:
	$g‘H—d”s
()

486 
loÿl
 
¬gs
 = 
£lf
:
	$g‘Args
()

487 
loÿl
 
accumuÏ‹dL’gth
 = 0

488 
i
, 
v
 
š
 
	$aœs
(
h—d”s
) do

489 
loÿl
 
curMemb”
 = 
	`g‘H—d”D©a
(
¬gs
[
i
])['name']

490 
loÿl
 
ÃxtH—d”
 = 
	`g‘H—d”D©a
(
¬gs
[
i
 + 1])

491 
ÃxtH—d”
 =‚extH—d” 
ªd
‚extHeader['proto']

493 
ÇmedArgs
 = 
v
:
	`£tDeçuÉNamedArgs
(
curMemb”
,‚amedArgs, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
, 
ffi
.(v))

494 
v
:
	$fl
(
ÇmedArgs
, 
curMemb”
)

496 
accumuÏ‹dL’gth
 =‡ccumuÏ‹dL’gth + 
ffi
.(
v
)

497 
’d


498 
’d


500 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
 
as
 
li¡
 oà
Çmed
 
¬gum’ts
.

501 --- @
·¿m
 
£lf
 
The
 
·ck‘


502 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

503 --- @
£e
 
·ck‘Fl


504 
funùiÚ
 
	$·ck‘G‘
(
£lf
)

505 
loÿl
 
ÇmedArgs
 = {
	}
}

506 
loÿl
 
¬gs
 = 
£lf
:
	$g‘Args
()

507 
i
, 
v
 
š
 
	`aœs
(
£lf
:
	$g‘H—d”s
()) do

508 
loÿl
 
memb”
 = 
	`g‘H—d”D©a
(
¬gs
[
i
])['name']

509 
ÇmedArgs
 = 
	`m”geTabËs
ÒamedArgs, 
v
:
	$g‘
(
memb”
))

510 
’d


511  
ÇmedArgs


512 
’d


514 --- 
Try
 
to
 
fšd
 
out
 
wh©
 
the
 
Ãxt
 
h—d”
 
š
h
·ylßd
 
of
 
this
 
·ck‘
 
is
.

515 --- 
This
 
funùiÚ
 
is
 
Úly
 
u£d
 
buf
:
g‘
/buf:
dump


516 --- @
·¿m
 
£lf
 
The
 
·ck‘


517 
funùiÚ
 
	$·ck‘ResŞveLa¡H—d”
(
£lf
)

518 
loÿl
 
Çme
 = 
£lf
:
	$g‘Name
()

519 
loÿl
 
h—d”s
 = 
£lf
:
	`g‘H—d”s
()

521 -- dØ
we
 
have
 
w™h
 
cÜ»ù
 
sub
-
ty³
?

522 
loÿl
 
subTy³
 = 
h—d”s
[#h—d”s]:
	$g‘SubTy³
()

523 
subTy³
 
th’


524 
loÿl
 
sub
 = 
	`¡rS¶™
(
Çme
, "_")

525 
sub
[#sub] ~ğ
subTy³
 
th’


526 
sub
[#sub] = 
subTy³


528 
loÿl
 
ÃwName
 = 
bË
.
	`cÚÿt
(
sub
, "_")

529  
ffi
.
	`ÿ¡
(
ÃwName
 .. "*", 
£lf
):
	$»sŞveLa¡H—d”
()

530 
’d


531 
’d


533 -- dØ
we
 
have
 
w™h
 
cÜ»ù
 
h—d”
 
Ëngth
?

534 
loÿl
 
Ën
 = 
h—d”s
[#h—d”s]:
	$g‘V¬ŸbËL’gth
()

535 
Ën
 
ªd
†’ > 0 
th’


536 
loÿl
 
sub
 = 
	`¡rS¶™
(
Çme
, "_")

537 
loÿl
 
l
 = 
sub
[#sub - 1]

538 
Ën
 ~ğ
l
 
th’


539 
loÿl
 
ÃwArgs
 = 
£lf
:
	$g‘Args
()

540 
loÿl
 
Ï¡
 = 
ÃwArgs
[#newArgs]

541 
	`ty³
(
Ï¡
è=ğ"¡ršg" 
th’


542 
ÃwArgs
[#ÃwArgs] = { 
Ï¡
,†a¡, 
Ëngth
 = 
Ën
}

544 
	gÃwArgs
[#ÃwArgs]["Ëngth"] = 
Ën


545 
’d


546 -- 
bud
 
Çme
 
w™h
 
Ën
 
adju¡ed


547 
sub
[#sub - 1] = 
Ën


548 
loÿl
 
ÃwName
 = 
bË
.
cÚÿt
(
sub
, "_")

549 -- 
ü—‹
 
¡ack
 
Ãûs§ry


550 
nÙ
 
	gpkt
.
	g·ck‘SŒuùs
[
ÃwName
] 
th’


551 
	gpkt
.
	gTMP_PACKET
 = 
ü—‹Sck
(
	$uÅack
(
ÃwArgs
))

552 
’d


553 
Çme
 ~ğ
ÃwName
 
th’


554  
ffi
.
	`ÿ¡
(
ÃwName
 .. "*", 
£lf
):
	$»sŞveLa¡H—d”
()

555 
’d


556 
’d


557 
’d


558 
loÿl
 
ÃxtH—d”
 = 
h—d”s
[#h—d”s]:
	`»sŞveNextH—d”
()

560 -- 
uÇbË
 
to
 
»sŞve
: 
e™h”
 
th”e
 
is
 
no
 
Ãxt
 
h—d”
, 
Ü
 
libmoÚ
 
dÛs
 
nÙ
 
suµÜt
 
™
 
y‘


561 -- 
e™h”
 , 
we
 
¡İ
 
ªd
  
cu¼’t
 
ty³
 
of
 
·ck‘


562 
nÙ
 
ÃxtH—d”
 
th’


563  
£lf


565 
loÿl
 
ÃwName
, 
ÃxtMemb”


566 
loÿl
 
Ãxt
 = 
	$g‘H—d”D©a
(
ÃxtH—d”
)

567 
ÃxtH—d”
 = 
Ãxt
['proto']

568 
ÃxtMemb”
 = 
Ãxt
['name']

569 
ÃxtSubTy³
 = 
Ãxt
['subType']

570 
ÃxtL’gth
 = 
Ãxt
['length']

571 -- 
we
 
know
 
the
 
Ãxt
 
h—d”
, 
­³nd
 
™


572 
Çme
 =‚am.. "__" .. 
ÃxtH—d”


574 -- 
sim¶e
 (
h—d”Çme
 = 
memb”Çme
è
®»ady
 
exi¡s
 
we
 
ÿn
 
dœeùly
 
ÿ¡


575 --
ÃxtMemb”
 = 
ÃxtH—d”


576 
ÃwName
 = 
Çme
 .. "_" .. 
ÃxtMemb”
 .. "_x_" .. (
ÃxtSubTy³
 
Ü
 "x")

578 
nÙ
 
pkt
.
·ck‘SŒuùs
[
ÃwName
] 
th’


579 -- 
check
 
a
 
sim¬
 
w™h
 
this
 
h—d”
 
Üd”
 
exi¡s


580 
ÃwName
 = 
Çme


581 
loÿl
 
found
 = 
n


582 
k
, 
v
 
š
 
	$·œs
(
pkt
.
·ck‘SŒuùs
) do

583 
¡ršg
.
	$fšd
(
k
, 
ÃwName
è
ªd
 
nÙ
 
¡ršg
.
	`fšd
(¡ršg.
	`gsub
(k,‚ewName, ""), "__"è
th’


584 -- 
the
 
ty³
 
m©ches
 
ªd
 
th”e
 
¬e
 
no
 
fu¹h”
 
h—d”s
 
	`fŞlowšg
 (
which
 
would
 
have
 
b“n
 
šdiÿ‹d
 
by
 
ªÙh”
 "__")

585 
found
 = 
k


587 
’d


588 
’d


589 
found
 
th’


590 
ÃwName
 = 
found


592 -- 
Ï¡
 
»sÜt
: 
bud
 
Ãw
 
·ck‘
 
ty³
. 
Howev”
, 
Úe
 
has
 
to
 
cÚsid”
 
th©
 oÃ 
h—d”


593 -- 
might
 
occur
 
muÉË
 
times
! 
In
 
this
 
the
 
memb”
 
mu¡
 
g‘
 
a
 
	`Ãw
 (
unique
!è
Çme
.

594 
loÿl
 
¬gs
 = 
£lf
:
	$g‘Args
()

595 
loÿl
 
ÃwArgs
 = {
	}
}

596 
loÿl
 
couÁ”
 = 1

597 
loÿl
 
ÃwMemb”
 = 
ÃxtMemb”


598 -- 
bud
 
Ãw
 
¬gs
 
šfÜm©iÚ
 
ªd
 
š
 
the
 
m—Áime
 
check
 
du¶iÿ‹s


599 
i
, 
v
 
š
 
	$aœs
(
¬gs
) do

600 
d©a
 = 
	$g‘H—d”D©a
(
v
)

601 
h—d”
 = 
d©a
['proto']

602 
memb”
 = 
d©a
['name']

603 
memb”
 =ğ
ÃwMemb”
 
th’


604 -- 
found
 
du¶iÿ‹
, 
šü—£
 
couÁ”
 
ÃwMemb”
 
ªd
 
k“p
 
checkšg
 
this
 
Úe
 
now


605 
couÁ”
 = counter + 1

606 
ÃwMemb”
 = 
ÃxtMemb”
 .. "" .. 
couÁ”


607 
’d


608 
ÃwArgs
[
i
] = 
v


609 
’d


611 -- 
add
 
Ãw
 
h—d”
 
ªd
 
memb”


612 
ÃwArgs
[#ÃwArg + 1] = { 
ÃxtH—d”
, 
Çme
 = 
ÃwMemb”
, 
subTy³
 = 
ÃxtSubTy³
, 
Ëngth
 = 
ÃxtL’gth
 
	}
}

614 -- 
ü—‹
 
Ãw
 
	g·ck‘
. 
It
 
is
 
uÆik–y
 
th©
 
exaùly
 
this
 
·ck‘
 
ty³
 
w™h
hi 
made
 
up
 
Çmšg
 
scheme
 
wl
 
be
 
	gu£d


615 -- 
	gTh”efÜe
, 
we
 
	gdÚ
't„eally wanto "safe"he cast function

616 
	gpkt
.
	gTMP_PACKET
 = 
ü—‹Sck
(
uÅack
(
ÃwArgs
))

618 -- 
Çme
 
of
 
the
 
Ãw
 
·ck‘
 
ty³


619 
ÃwName
 =‚ewNam.. '_' .. 
ÃwMemb”
 .. '_x_' .. (
ÃxtSubTy³
 
Ü
 'x')

620 
’d


621 
’d


623 -- 
fš®ly
, 
ÿ¡
 
the
 
·ck‘
 
to
h
Ãxt
 
b‘‹r
 
f™tšg
…ack‘ 
ty³
 
ªd
  
»sŞvšg


624  
	gffi
.
ÿ¡
(
ÃwName
 .. "*", 
£lf
):
	$»sŞveLa¡H—d”
()

625 
’d


626 
’d


628 --- 
S‘
 
Ëngth
 
®l
 
h—d”s
.

629 --- 
Neûs§ry
 
wh’
 
£ndšg
 
v¬ŸbË
 
sized
 
·ck‘s
.

630 --- @
·¿m
 
£lf
 
The
 
·ck‘


631 --- @
·¿m
 
Ëngth
 
L’gth
 
of
 
the
 
·ck‘
. 
V®ue
 
»¥eùive
†’gth 
memb”
 oà
h—d”s
 
g‘
 
ÿlcuÏ‹d
 
usšg
 
this
 
v®ue
.

632 
funùiÚ
 
	$·ck‘S‘L’gth
(
¬gs
)

633 
loÿl
 
¡r
 = ""

634 -- 
bud
 
the
 
£tL’gth
 
funùiÚs
 
®l
h
h—d”s
 
š
 
this
 
·ck‘
 
ty³


635 
loÿl
 
accumuÏ‹dL’gth
 = 0

636 
_
, 
v
 
š
 
	$aœs
(
¬gs
) do

637 
loÿl
 
d©a
 = 
	$g‘H—d”D©a
(
v
)

638 
h—d”
 = 
d©a
['proto']

639 
memb”
 = 
d©a
['name']

640 
subTy³
 = 
d©a
['subType']

641 
h—d”
 = 
subTy³
 
ªd
 h—d” .. "_" .. subTy³ 
Ü
 header

642 
h—d”
 =ğ"4" 
Ü
 h—d” =ğ"udp" o¸h—d” =ğ"±p" o¸h—d” =ğ"fix" 
th’


643 
¡r
 = str .. [[

644 
£lf
.]] .. 
memb”
 .. [[:
	`£tL’gth
(
Ëngth
 - ]] .. 
accumuÏ‹dL’gth
 .. [[)

646 
–£if
 
h—d”
 =ğ"6" 
th’


647 
¡r
 = str .. [[

648 
£lf
.]] .. 
memb”
 .. [[:
	`£tL’gth
(
Ëngth
 - ]] .. 
accumuÏ‹dL’gth
 + 40 .. [[)

650 
’d


651 
accumuÏ‹dL’gth
 =‡ccumuÏ‹dL’gth + 
ffi
.("¡ruù " .. 
h—d”
 .. "_header")

652 
’d


654 -- 
bud
 
com¶‘e
 
funùiÚ


655 
¡r
 = [[

656  
	`funùiÚ
(
£lf
, 
Ëngth
)]]

657 .. 
¡r
 .. [[

658 
’d
]]

660 -- 
lßd
 
Ãw
 
funùiÚ
 
ªd
  
™


661 
loÿl
 
func
 = 
	`as£¹
(
	$lßd¡ršg
(
¡r
))()

663  
func


664 
’d


666 --- 
C®cuÏ‹
 
®l
 
checksums
 
	`mªu®ly
 (
nÙ
 
ofæßdšg
 
them
).

667 --- 
Th”e
 
®so
 
exi¡
 
funùiÚs
 
to
 
ÿlcuÏ‹
 
the
 
checksum
 
of
 
Úly
 
Úe
 
h—d”
.

668 --- 
Namšg
 
cÚv’tiÚ
: 
pkt
:
ÿlcuÏ‹
<
memb”
>
	$Checksum
(è(
®l
 
exi¡šg
 
·ck‘s
 
memb”
 = {
Ip
, 
Tı
, 
Udp
, 
Icmp
})

669 --- @
nÙe
 
C®cuÏtšg
 
checksums
 
mªu®ly
 
is
 
exŒem–y
 
¦ow
 
com·»d
 
to
 
ofæßdšg
 
this
 
sk
Ø
the
 
NIC
 (~65% 
³rfÜmªû
 
loss
 
©
h
mom’t
)

670 --- @
todo
 
Mªu®
 
ÿlcuÏtiÚ
 
of
 
udp
 
ªd
 
tı
 
checksums
 
NYI


671 
funùiÚ
 
	$·ck‘C®cuÏ‹Checksums
(
¬gs
)

672 
loÿl
 
¡r
 = ""

673 
_
, 
v
 
š
 
	$aœs
(
¬gs
) do

674 
loÿl
 
d©a
 = 
	$g‘H—d”D©a
(
v
)

675 
h—d”
 = 
d©a
['proto']

676 
memb”
 = 
d©a
['name']

678 -- 
the
 
h—d”
 
has
 
a
 
checksum
, 
ÿÎ
h
funùiÚ


679 
h—d”
 =ğ"4" 
Ü
 h—d” =ğ"icmp" 
th’
 -- 
FIXME
 
NYI
 or header == "udp"

680 
¡r
 = str .. [[

681 
£lf
.]] .. 
memb”
 .. [[:
	`ÿlcuÏ‹Checksum
()

683 
–£if
 
h—d”
 =ğ"tı" 
th’


684 
¡r
 = str .. [[

685 
£lf
.]] .. 
memb”
 .. [[:
	`ÿlcuÏ‹Checksum
(
d©a
, 
Ën
, 
v4
)

687 
’d


688 
’d


690 -- 
bud
 
com¶‘e
 
funùiÚ


691 
¡r
 = [[

692  
	`funùiÚ
(
£lf
, 
d©a
, 
Ën
, 
v4
)]]

693 .. 
¡r
 .. [[

694 
’d
]]

696 -- 
lßd
 
Ãw
 
funùiÚ
 
ªd
  
™


697 
loÿl
 
func
 = 
	`as£¹
(
	$lßd¡ršg
(
¡r
))()

699  
func


700 
’d


702 
loÿl
 
ü—‹dH—d”SŒuùs
 = {
	}
}

704 
loÿl
 
h—d”SŒuùTem¶©e
 = [[

705 
__©Œibu‹__
((
__·cked__
)è
NAME
 {

706 
MEMBER
};]]

708 
loÿl
 
funùiÚ
 
	$defšeH—d”SŒuù
(
p
, 
subTy³
, 
size
)

709 
loÿl
 
Çme
 = 
p
 .. (
subTy³
 
ªd
 "_" .. subTy³ 
Ü
 ""è.. "_h—d”" .. (
size
‡nd "_" .. size or "")

711 -- 
check
 
wh‘h”
 
™
 
®»ady
 
eci¡s


712 
ü—‹dH—d”SŒuùs
[
Çme
] 
th’


713 
log
:
	`debug
("H—d” sŒuù " .. 
Çme
 .. "‡lreadyƒxists, skipping.")

714  
Çme


715 
’d


717 -- 
bud
 
äom
 
‹m¶©e
 
ªd
 
´Ùo
 
h—d”
 
fÜm©


718 
loÿl
 
¡r
 = 
h—d”SŒuùTem¶©e


719 
´Ùo
[
p
].
deçuÉTy³
 
th’


720 
subTy³
 = subTy³ 
Ü
 
´Ùo
[
p
].
deçuÉTy³


721 
’d


722 
¡r
 = 
¡ršg
.
	`gsub
(¡r, "MEMBER", (
subTy³
 
ªd
 
´Ùo
[
p
][subTy³].
h—d”FÜm©
 
Ü
…roto[p].headerFormat))

724 -- 
£t
 
size
 
of
 
v¬ŸbË
 
sized
 
memb”


725 
´Ùo
[
p
].
h—d”V¬ŸbËMemb”
 
th’


726 
loÿl
 
memb”
 = (
subTy³
 
ªd
 
´Ùo
[
p
][subTy³].
h—d”V¬ŸbËMemb”
 
Ü
…roto[p].headerVariableMember) .. "%["

727 
¡r
 = 
¡ršg
.
	`gsub
(¡r, 
memb”
, memb” .. (
size
 
Ü
 0))

728 
’d


730 -- 
bud
 
the
 
Çme


731 
¡r
 = 
¡ršg
.
	`gsub
(¡r, "NAME", 
Çme
)

733 -- 
defše
 
ªd
 
add
 
h—d”
 
»Ï‹d
 
funùiÚs


734 
ffi
.
	$cdef
(
¡r
)

735 
ffi
.
	`m‘©y³
("¡ruù " .. 
Çme
, (
subTy³
 
ªd
 
´Ùo
[
p
][subTy³].
m‘©y³
 
Ü
…roto[p].metatype))

736 
log
:
	`debug
("C»©ed " .. 
Çme
 .. 
¡r
)

738 -- 
add
 
to
 
li¡
 
of
 
®»ady
 
ü—‹d
 
h—d”
 
¡ruùs


739 
ü—‹dH—d”SŒuùs
[
Çme
] = 
Œue


741 --  
Çme
 
u£d
 
to
 
g’”©e
 
¡ack


742  
Çme


743 
’d


745 --- 
TabË
 
th©
 
cÚšs
 
the
 
Çmes
 
ªd
 
¬gs
 
of
 
®l
 
ü—‹d
 
·ck‘
 
¡ruùs


746 
pkt
.
·ck‘SŒuùs
 = {
	}
}

748 -- 
Li¡
 
®l
 
ü—‹d
 
·ck‘
 
¡ruùs
 
’li¡ed
 
š
 
·ck‘SŒuùs


749 -- 
Debuggšg
 
funùiÚ


750 
funùiÚ
 
	$li¡Pack‘SŒuùs
()

751 
	`´štf
("All‡vailable…acket structs:")

752 
k
, 
v
 
š
 
	$·œs
(
pkt
.
·ck‘SŒuùs
) do

753 
	$´štf
(
k
)

754 
’d


755 
’d


757 --- 
C»©es
 
a
 
·ck‘
 (
cd©a
è
cÚsi¡šg
 
of
 
difã»Á
 
h—d”s
.

758 --- 
Sim¶y
 
li¡
 
the
 
h—d”s
 
š
h
Üd”
 
you
 
wªt
 
them
 
to
 
be
 iÀ
a
 
·ck‘
.

759 --- 
If
 
you
 
wªt
 
the
 
memb”
 
to
 
be
 
Çmed
 
difã»Ály
, 
u£
h
fŞlowšg
 
syÁax
:

760 --- 
nÜm®
: <
h—d”
> ; 
difã»Á
 
memb”Çme
: { <h—d”>, <
memb”
> 
	}
}.

761 --- 
SuµÜ‹d
 
	gkeywÜds
: 
‘h
, 
	g¬p
, 
	g±p
, 
	g
, 
	g6
, 
	gudp
, 
	gtı
, 
	gicmp


762 --- @
	gcode


763 --- 
makeSŒuù
('‘h', { '4', '' }, 'udp'è--- 
ü—‹s
 
ª
 
UDP
 
·ck‘
 

764 --- --- 
the
 
4
 
memb”
 
of
h
·ck‘
 
is
 
	gÇmed
 'ip'

765 --- @
	g’dcode


766 --- 
The
 
Çme
 
of
 
the
 
	$ü—‹d
 (
š‹º®
è
looks
 
as
 
fŞlows
:

767 --- 
__HEADER1_MEMBER1__HEADER2_MEMBER2
 ...

768 --- 
OÆy
 
the
 "__" (
und”scÜe
è
has
h
¥ecŸl
 
m—nšg
 
of
 "a‚ew header starts with‚ame

769 --- <
ev”ythšg
 
uÁ
 "_" (
sšgË
 
und”scÜe
)>, 
fŞlowed
 
by
 
the
 
memb”
 
Çme
 <ev”ythšg 
aá”
 "_"

770 --- 
uÁ
 
Ãxt
 
h—d”
 
	`¡¬ts
 (
šdiÿ‹d
 
by
‚exˆ
__
)>"

771 --- @
·¿m
 
¬gs
 
li¡
 
of
 
keywÜds
/
bËs
 oà
keywÜd
-
memb”
 
·œs


772 --- @
·¿m
 
noPaylßd
 dØ
nÙ
 
­³nd
 
·ylßd
 
VLA


773 --- @ 
Çme
‚am
of
 
the
 

774 --- @ 
ùy³
 cty³ 
of
 
the
 

775 
funùiÚ
 
	$·ck‘MakeSŒuù
(
¬gs
, 
noPaylßd
)

776 
loÿl
 
Çme
 = ""

777 
loÿl
 
¡r
 = ""

779 
loÿl
 
memb”s
 = {
	}
}

781 -- 
add
 
the
 
¥ecif›d
 
h—d”s
 
ªd
 
bud
h
Çme


782 
_
, 
v
 
š
 
	$aœs
(
¬gs
) do

783 
loÿl
 
d©a
 = 
	$g‘H—d”D©a
(
v
)

784 
h—d”
 = 
d©a
['proto']

785 
memb”
 = 
d©a
['name']

786 
Ëngth
 = 
d©a
['length']

787 
subTy³
 = 
d©a
['subType']

789 -- 
check
 
du¶iÿ‹
 
memb”
 
Çmes
 
as
 
ffi
 
dÛs
 
nÙ
 
	$üash
 (
™
 
is
 
mo¡ly
 
ignÜed
)

790 
memb”s
[
memb”
] 
th’


791 
log
:
	`çl
("Memb” w™hšhi ¡ruù ha §mÇme: % \n%s", 
memb”
, 
¡r
)

792 
’d


793 
memb”s
[
memb”
] = 
Œue


795 
loÿl
 
h—d”SŒuù
 = 
	`defšeH—d”SŒuù
(
h—d”
, 
subTy³
, 
Ëngth
)

797 -- 
add
 
h—d”


798 
¡r
 = str .. [[

799 ]] .. 
h—d”SŒuù
 .. ' ' .. 
memb”
 .. [[;

802 -- 
bud
 
Çme


803 
Çme
 =‚am.. "__" .. 
h—d”
 .. "_" .. 
memb”
 .. "_" .. (
Ëngth
 
Ü
 "x"è.. "_" .. (
subTy³
 or "x")

804 
’d


806 -- 
hªdË
 
¿w
 
·ck‘


807 
Çme
 =ğ"" 
th’


808 
Çme
 = "raw"

809 
’d


811 -- 
add
 
»¡
 
of
 
the
 

812 
¡r
 = [[

813 
	`__©Œibu‹__
((
__·cked__
)) ]]

814 .. 
Çme


817 .. 
¡r


818 .. (
nÙ
 
noPaylßd
 
ªd
 [[

819 
·ylßd_t
 
·ylßd
;

820 ]] 
Ü
 "")

823 
Çme
 = "struct " ..‚ame

825 -- 
check
 
uniqu’ess
 
of
 
·ck‘
 
	`ty³
 (
Çme
 of )

826 
pkt
.
·ck‘SŒuùs
[
Çme
] 
th’


827 
log
:
	`w¬n
("SŒuù w™h‚am\"" .. 
Çme
 .. "\"‡lreadyƒxists. Skipping.")

831 -- 
add
 
to
 
li¡
 
of
 
exi¡šg
 
¡ruùs


832 
pkt
.
·ck‘SŒuùs
[
Çme
] = {
¬gs
}

834 
log
:
	`debug
("C»©ed sŒuù %s", 
Çme
)

835 
log
:
	`debug
("%s", 
¡r
)

837 -- 
add
 
defš™iÚ


838 
ffi
.
	`cdef
(
¡r
)

840 --  
fuÎ
 
Çme
 
ªd
 
ty³of


841  
Çme
, 
ffi
.
	`ty³of
(name .. "*")

842 
’d


843 
’d


845 --! 
S‘‹r
 
¿w
 
·ck‘s


846 --! @
·¿m
 
d©a
: 
¿w
 
·ck‘
 data

847 
funùiÚ
 
pkt
:
	`£tRawPack‘
(
d©a
)

848 
£lf
:
	`£tSize
(#data)

849 
ffi
.
	`cİy
(
£lf
:
	`g‘D©a
(), 
d©a
)

850 
’d


853 ---- 
M‘©y³s


856 
ffi
.
	`m‘©y³
("¡ruù„‹_mbuf", 
pkt
)

860 ---- 
PrÙocŞ
 
Scks


863 
pkt
.
g‘RawPack‘
 = 
	`ü—‹Sck
()

865 
pkt
.
g‘Eth”ÃtPack‘
 = 
	`ü—‹Sck
("eth")

866 
pkt
.
g‘EthPack‘
 =…kt.
g‘Eth”ÃtPack‘


867 
pkt
.
g‘Eth”ÃtVÏnPack‘
 = 
	`ü—‹Sck
({"‘h", 
subTy³
 = "vlan"})

868 
pkt
.
g‘EthVÏnPack‘
 =…kt.
g‘Eth”ÃtVÏnPack‘


869 
pkt
.
g‘Eth”ÃtQšQPack‘
 = 
	`ü—‹Sck
({"‘h", 
subTy³
 = "qinq"})

870 
pkt
.
g‘EthQšQPack‘
 =…kt.
g‘Eth”ÃtQšQPack‘


872 
pkt
.
g‘IP4Pack‘
 = 
	`ü—‹Sck
("eth", "ip4")

873 
pkt
.
g‘IP6Pack‘
 = 
	`ü—‹Sck
("eth", "ip6")

874 
pkt
.
g‘IPPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

875 
4
 = ip4 =ğ
n
 
Ü
 ip4

876 
4
 
th’


877  
pkt
.
	`g‘IP4Pack‘
(
£lf
)

879  
pkt
.
	`g‘IP6Pack‘
(
£lf
)

880 
’d


881 
’d


883 
pkt
.
g‘A½Pack‘
 = 
	`ü—‹Sck
("eth", "arp")

885 
pkt
.
g‘Icmp4Pack‘
 = 
	`ü—‹Sck
("eth", "ip4", "icmp")

886 
pkt
.
g‘Icmp6Pack‘
 = 
	`ü—‹Sck
("eth", "ip6", "icmp")

887 
pkt
.
g‘IcmpPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

888 
4
 = ip4 =ğ
n
 
Ü
 ip4

889 
4
 
th’


890  
pkt
.
	`g‘Icmp4Pack‘
(
£lf
)

892  
pkt
.
	`g‘Icmp6Pack‘
(
£lf
)

893 
’d


894 
’d


896 
pkt
.
g‘Udp4Pack‘
 = 
	`ü—‹Sck
("eth", "ip4", "udp")

897 
pkt
.
g‘Udp6Pack‘
 = 
	`ü—‹Sck
("eth", "ip6", "udp")

898 
pkt
.
g‘UdpPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

899 
4
 = ip4 =ğ
n
 
Ü
 ip4

900 
4
 
th’


901  
pkt
.
	`g‘Udp4Pack‘
(
£lf
)

903  
pkt
.
	`g‘Udp6Pack‘
(
£lf
)

904 
’d


905 
’d


907 
pkt
.
g‘Tı4Pack‘
 = 
	`ü—‹Sck
("eth", "ip4", "tcp")

908 
pkt
.
g‘Tı6Pack‘
 = 
	`ü—‹Sck
("eth", "ip6", "tcp")

909 
pkt
.
g‘TıPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

910 
4
 = ip4 =ğ
n
 
Ü
 ip4

911 
4
 
th’


912  
pkt
.
	`g‘Tı4Pack‘
(
£lf
)

914  
pkt
.
	`g‘Tı6Pack‘
(
£lf
)

915 
’d


916 
’d


918 
pkt
.
g‘PPack‘
 = 
	`ü—‹Sck
("eth", "ptp")

919 
pkt
.
g‘UdpPPack‘
 = 
	`ü—‹Sck
("eth", "ip4", "udp", "ptp")

921 
pkt
.
g‘VxÏnPack‘
 = 
	`ü—‹Sck
("eth", "ip4", "udp", "vxlan")

922 
pkt
.
g‘VxÏnEth”ÃtPack‘
 = 
	`ü—‹Sck
("‘h", "4", "udp", "vxÏn", { "‘h", 
Çme
 = "innerEth" })

924 
pkt
.
g‘E¥4Pack‘
 = 
	`ü—‹Sck
("eth", "ip4", "esp")

925 
pkt
.
g‘E¥6Pack‘
 = 
	`ü—‹Sck
("eth", "ip6", "esp")

926 
pkt
.
g‘E¥Pack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

927 
4
 = ip4 =ğ
n
 
Ü
 ip4

928 
4
 
th’


929  
pkt
.
	`g‘E¥4Pack‘
(
£lf
)

931  
pkt
.
	`g‘E¥6Pack‘
(
£lf
)

932 
’d


933 
’d


935 
pkt
.
g‘AH4Pack‘
 = 
	`ü—‹Sck
("eth", "ip4", "ah")

936 
pkt
.
g‘AH6Pack‘
 = 
n
 --
	`ü—‹Sck
("‘h", "6", "ah6"è--
TODO
: 
AH6
 
Ãeds
 
to
 
be
 
im¶em’‹d


937 
pkt
.
g‘AHPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

938 
4
 = ip4 =ğ
n
 
Ü
 ip4

939 
4
 
th’


940  
pkt
.
	`g‘AH4Pack‘
(
£lf
)

942  
pkt
.
	`g‘AH6Pack‘
(
£lf
)

943 
’d


944 
’d


946 
pkt
.
g‘Dns4Pack‘
 = 
	`ü—‹Sck
('eth', 'ip4', 'udp', 'dns')

947 
pkt
.
g‘Dns6Pack‘
 = 
	`ü—‹Sck
('eth', 'ip6', 'udp', 'dns')

948 
pkt
.
g‘DnsPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

949 
4
 = ip4 =ğ
n
 
Ü
 ip4

950 
4
 
th’


951  
pkt
.
	`g‘Dns4Pack‘
(
£lf
)

953  
pkt
.
	`g‘Dns6Pack‘
(
£lf
)

954 
’d


955 
’d


957 
pkt
.
g‘SFlowPack‘
 = 
	`ü—‹Sck
("‘h", "4", "udp", {"sæow", 
subTy³
 = "ip4"}, "noPayload")

959 
pkt
.
g‘IpfixPack‘
 = 
	`ü—‹Sck
("eth", "ip4", "udp", "ipfix")

961 
pkt
.
g‘LaıPack‘
 = 
	`ü—‹Sck
('eth', 'lacp')

963 
pkt
.
g‘G»4Pack‘
 = 
	`ü—‹Sck
("eth", "ip4", "gre")

964 
pkt
.
g‘G»6Pack‘
 = 
	`ü—‹Sck
("eth", "ip6", "gre")

965 
pkt
.
g‘G»Pack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

966 
4
 = ip4 =ğ
n
 
Ü
 ip4

967 
4
 
th’


968  
pkt
.
	`g‘G»4Pack‘
(
£lf
)

970  
pkt
.
	`g‘G»6Pack‘
(
£lf
)

971 
’d


972 
’d


974 
pkt
.
g‘G»4QšQPack‘
 = 
	`ü—‹Sck
("‘h", "4", "g»", {"‘h", 
subTy³
 = "qšq", 
Çme
 = "etherQinQ"}, {"ip4",‚ame = "nestedIp4"})

975 
pkt
.
g‘G»6QšQPack‘
 = 
	`ü—‹Sck
("‘h", "6", "g»", {"‘h", 
subTy³
 = "qšq", 
Çme
 = "etherQinQ"}, {"ip6",‚ame = "nestedIp6"})

976 
pkt
.
g‘G»QšQPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

977 
4
 = ip4 =ğ
n
 
Ü
 ip4

978 
4
 
th’


979  
pkt
.
	`g‘G»4QšQPack‘
(
£lf
)

981  
pkt
.
	`g‘G»6QšQPack‘
(
£lf
)

982 
’d


983 
’d


985 
pkt
.
g‘G»QšQA½Pack‘
 = 
	`ü—‹Sck
("‘h", "4", "g»", {"‘h", 
subTy³
 = "qšq", 
Çme
 = "etherQinQ"}, "arp")

987 
pkt
.
g‘G»4QšQUdpPack‘
 = 
	`ü—‹Sck
("‘h", "4", "g»", {"‘h", 
subTy³
 = "qšq", 
Çme
 = "etherQinQ"}, {"ip4",‚ame = "nestedIp4"}, "udp")

988 
pkt
.
g‘G»6QšQUdpPack‘
 = 
	`ü—‹Sck
("‘h", "6", "g»", {"‘h", 
subTy³
 = "qšq", 
Çme
 = "etherQinQ"}, {"ip6",‚ame = "nestedIp6"}, "udp")

989 
pkt
.
g‘G»QšQUdpPack‘
 = 
	`funùiÚ
(
£lf
, 
4
)

990 
4
 = ip4 =ğ
n
 
Ü
 ip4

991 
4
 
th’


992  
pkt
.
	`g‘G»4QšQUdpPack‘
(
£lf
)

994  
pkt
.
	`g‘G»6QšQUdpPack‘
(
£lf
)

995 
’d


996 
’d


998  
pkt


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/pcap.lua

1 --- 
Fa¡
 
pÿp
 
	gIO
, 
ÿn
 
	gwr™e
 > 40 
	gGb™
/
	$s
 (
to
 
fs
 
ÿche
è
ªd
 
»ad
 > 30 
	`Mµs
 (
äom
 fs cache).

2 --- 
R—d
/
wr™e
 
³rfÜmªû
 
ÿn
 
§tu¿‹
 
£v”®
 
NVMe
 
SSDs
 
äom
 
a
 
sšgË
 
cÜe
.

4 
loÿl
 
mod
 = {
	}
}

6 
loÿl
 
S
 = 
»quœe
 "syscall"

7 
loÿl
 
ffi
 = 
»quœe
 "ffi"

8 
loÿl
 
log
 = 
»quœe
 "log"

9 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

11 
loÿl
 
ÿ¡
 = 
ffi
.cast

12 
loÿl
 
memcİy
 = 
ffi
.
cİy


13 
loÿl
 
C
 = 
ffi
.C

14 
loÿl
 
mš
 = 
m©h
.min

16 -- 
h‰p
:

17 
ffi
.
cdef
[[

19 
ušt32_t
 
magic_numb”
;

20 
ušt16_t
 
v”siÚ_majÜ
;

21 
ušt16_t
 
v”siÚ_mšÜ
;

22 
št32_t
 
thiszÚe
;

23 
ušt32_t
 
sigfigs
;

24 
ušt32_t
 
¢­Ën
;

25 
ušt32_t
 
ÃtwÜk
;

26 } 
pÿp_hdr_t
;

29 
ušt32_t
 
ts_£c
;

30 
ušt32_t
 
ts_u£c
;

31 
ušt32_t
 
šş_Ën
;

32 
ušt32_t
 
Üig_Ën
;

33 
ušt8_t
 
d©a
[];

34 } 
	tpÿ´ec_hdr_t
;

37 
loÿl
 
	gh—d”Ty³
 = 
ffi
.
ty³of
("pcap_hdr_t")

38 
loÿl
 
h—d”Poš‹r
 = 
ffi
.
ty³of
("pcap_hdr_t*")

39 
loÿl
 
·ck‘Ty³
 = 
ffi
.
ty³of
("pcaprec_hdr_t")

40 
loÿl
 
·ck‘Poš‹r
 = 
ffi
.
ty³of
("pcaprec_hdr_t*")

41 
loÿl
 
voidPoš‹r
 = 
ffi
.
ty³of
("void*")

43 
loÿl
 
INITIAL_FILE_SIZE
 = 512 * 1024 * 1024

45 --- 
S‘
 
the
 
fe
 
size
 
Ãw
 
pÿp
 
wr™”s


46 --- @
·¿m
 
ÃwSizeInBy‹s
 
Ãw
 
fe
 
size
 
š
 
by‹s


47 
funùiÚ
 
mod
:
	$£tIn™ŸlFesize
(
ÃwSizeInBy‹s
)

48 
INITIAL_FILE_SIZE
 = 
ÃwSizeInBy‹s


49 
’d


51 
loÿl
 
wr™”
 = {
	}
}

52 
wr™”
.
__šdex
 = writer

54 
loÿl
 
funùiÚ
 
	$wr™eH—d”
(
±r
)

55 
loÿl
 
hdr
 = 
	$h—d”Poš‹r
(
±r
)

56 
hdr
.
magic_numb”
 = 0xa1b2c3d4

57 
hdr
.
v”siÚ_majÜ
 = 2

58 
hdr
.
v”siÚ_mšÜ
 = 4

59 
hdr
.
thiszÚe
 = 0

60 
hdr
.
sigfigs
 = 0

61 
hdr
.
¢­Ën
 = 0x40000

62 
hdr
.
ÃtwÜk
 = 1

63  
ffi
.(
h—d”Ty³
)

64 
’d


66 --- 
C»©e
 
a
 
Ãw
 
ç¡
 
pÿp
 
wr™”
 
w™h
 
the
 
giv’
 
fe
 
Çme
.

67 --- 
C®l
 :
	$şo£
(è
Ú
 
the
 
wr™”
 
wh’
 
you
 
¬e
 
dÚe
.

68 --- @
·¿m
 
¡¬tTime
 
posix
 
time¡amp
, 
®l
 
time¡amps
 
of
 
š£¹ed
 
·ck‘s
 
wl
 
be
 
»Ïtive
 
to
 
this
imestamp

69 --- : 
»Ïtive
 
to
 
libmoÚ
.
	`g‘Time
() == 0

70 
funùiÚ
 
mod
:
	$ÃwWr™”
(
f’ame
, 
¡¬tTime
)

71 
¡¬tTime
 = s¹Tim
Ü
 
	`w®lTime
(è- 
libmoÚ
.
	$g‘Time
()

72 
loÿl
 
fd
 = 
S
.
	`İ’
(
f’ame
, "creat,„dwr,runc", "0666")

73 
nÙ
 
fd
 
th’


74 
log
:
	`çl
("could‚Ù c»©pÿ°fe: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

75 
’d


76 
fd
:
	$nogc
()

77 
loÿl
 
size
 = 
INITIAL_FILE_SIZE


78 
nÙ
 
S
.
	$çÎoÿ‹
(
fd
, 0, 0, 
size
è
th’


79 
log
:
	`çl
("çÎoÿ‹ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

80 
’d


81 
loÿl
 
±r
 = 
S
.
	`mm­
(
n
, 
size
, "wr™e", "sh¬ed,‚Üe£rve", 
fd
, 0)

82 
nÙ
 
±r
 
th’


83 
log
:
	`çl
("mm­ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

84 
’d


85 
loÿl
 
off£t
 = 
	$wr™eH—d”
(
±r
)

86 
±r
 = 
	`ÿ¡
("uint8_t*",…tr)

87  
	`£tm‘©abË
({
fd
 = fd, 
±r
 =…Œ, 
size
 = size, 
off£t
 = off£t, 
¡¬tTime
 = 
	}
¡¬tTime}, 
	gwr™”
)

88 
’d


90 
funùiÚ
 
	gwr™”
:
	$»size
(
size
)

91 
nÙ
 
S
.
	$çÎoÿ‹
(
£lf
.
fd
, 0, 0, 
size
è
th’


92 
log
:
	`çl
("çÎoÿ‹ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

93 
’d


94 -- 
two
 
ways
 
to
 
´ev’t
 
MAP_MAYMOVE
 
h”e
 
someÚe
 
wªts
Ø
im¶em’t
 
this
:

95 -- 1è
mm­
 
a
 
Ïrge
 
vœtu®
 
add»ss
 
	`block
 (
ªd
 
u£
 
MAP_FIXED
 
to
 
nÙ
 
have
‡ 
huge
 
fe
)

96 -- 2è
unm­
 
the
 
whŞe
 
Şd
 
¬—
, 
mm­
 
Úly
h
Ãwly
 
®loÿ‹d
 
fe
 
	`¥aû
 (
ªd
h
Ï¡
 
·ge
 
of
hŞd 
¥aû
)

97 -- 
´obËm
 
w™h
 1 
is
: 
wa¡es
 
a
 
lÙ
 
of
 
vœtu®
 
add»ss
 
¥aû
, 
´obËm©ic
 
we
 
have
 
muÉË
 
wr™”s
 
©
 
the
 
§me
 
time


98 -- 
so
 
im¶em’t
 2è
you
 
ã–
 
like
 
	`™
 (
howev”
, 
I
 
hav’
't‚oticed big…roblems withhe current MAP_MAYMOVE implementation)

99 
loÿl
 
±r
 = 
S
.
	`m»m­
(
£lf
.±r, s–f.
size
, size, "maymove")

100 
nÙ
 
±r
 
th’


101 
log
:
	`çl
("m»m­ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

102 
’d


103 
£lf
.
±r
 = 
	`ÿ¡
("uint8_t*",…tr)

104 
£lf
.
size
 = size

105 
’d


107 --- 
Clo£
 
ªd
 
Œunÿ‹
 
the
 
fe
.

108 
funùiÚ
 
wr™”
:
	$şo£
()

109 
S
.
	$munm­
(
£lf
.
±r
, s–f.
size
)

110 
S
.
	$árunÿ‹
(
£lf
.
fd
, s–f.
off£t
)

111 
S
.
	$fsync
(
£lf
.
fd
)

112 
S
.
	$şo£
(
£lf
.
fd
)

113 
£lf
.
fd
 = 
n


114 
£lf
.
±r
 = 
n


115 
’d


117 
ffi
.
cdef
[[

118 
	`libmoÚ_wr™e_pÿp
(* 
d¡
, cÚ¡ * 
·ck‘
, 
ušt32_t
 
Ën
, ušt32_ˆ
Üig_Ën
, ušt32_ˆ
ts_£c
, ušt32_ˆ
ts_u£c
);

121 --- 
Wr™e
 
a
 
·ck‘
 
to
 
the
 
pÿp
 
fe


122 --- @
·¿m
 
time¡amp
 
»Ïtive
 
to
 
the
ime¡am°
¥ecif›d
 
wh’
 
ü—tšg
h
fe


123 
funùiÚ
 
wr™”
:
	$wr™e
(
time¡amp
, 
d©a
, 
Ën
, 
ÜigL’
)

124 
£lf
.
off£t
 + 
Ën
 + 16 >ğ£lf.
size
 
th’


125 
£lf
:
	$»size
(
£lf
.
size
 * 2)

126 
’d


127 
loÿl
 
time
 = 
£lf
.
¡¬tTime
 + 
time¡amp


128 
loÿl
 
timeSec
 = 
m©h
.
	$æoÜ
(
time
)

129 
loÿl
 
timeMiüos
 = (
time
 - 
timeSec
) * 1000000

130 
C
.
	`libmoÚ_wr™e_pÿp
(
£lf
.
±r
 + s–f.
off£t
, 
d©a
, 
Ën
, 
ÜigL’
 
Ü
†’, 
time
, 
timeMiüos
)

131 
£lf
.
off£t
 = s–f.off£ˆ+ 
Ën
 + 16

132 
’d


134 --- 
Wr™e
 
a
 
mbuf
 
to
 
the
 
pÿp
 
fe


135 --- @
·¿m
 
time¡amp
 
»Ïtive
 
to
 
the
ime¡am°
¥ecif›d
 
wh’
 
ü—tšg
h
fe


136 --- @
·¿m
 
¢­L’
 
Œunÿ‹
 
the
 
·ck‘
 
to
 
this
 
size


137 
funùiÚ
 
wr™”
:
	$wr™eBuf
(
time¡amp
, 
buf
, 
¢­L’
)

138 
loÿl
 
size
 = 
buf
:
	$g‘Size
()

139 
¢­L’
 = sÇpL’ 
Ü
 
size


140 
£lf
:
	`wr™e
(
time¡amp
, 
buf
:
	`g‘D©a
(), 
	`mš
(
size
, 
¢­L’
), size)

141 
’d


143 
loÿl
 
»ad”
 = {
	}
}

144 
»ad”
.
__šdex
 =„eader

146 
loÿl
 
funùiÚ
 
	$»adH—d”
(
±r
)

147 
loÿl
 
hdr
 = 
	$h—d”Poš‹r
(
±r
)

148 
hdr
.
magic_numb”
 =ğ0xd4c3b2a1 
th’


149 
log
:
	`çl
("bigƒndian…caps‡re‚ot supported")

150 
–£if
 
hdr
.
magic_numb”
 ~ğ0xa1b2c3d4 
th’


151 
log
:
	`çl
("not‡…cap file")

152 
’d


153 
hdr
.
v”siÚ_majÜ
 ~ğ2 
Ü
 hdr.
v”siÚ_mšÜ
 ~ğ4 
th’


154 
log
:
	`çl
("unsupported…cap version")

155 
’d


156 
hdr
.
thiszÚe
 ~ğ0 
th’


157 
log
:
	`w¬n
("timezone information in…cap header ignored")

158 
’d


159 
hdr
.
ÃtwÜk
 ~ğ1 
th’


160 
log
:
	`çl
("unsupported†ink†ayerype")

161 
’d


162  
ffi
.(
h—d”Ty³
)

163 
’d


165 --- 
C»©e
 
a
 
Ãw
 
ç¡
 
pÿp
 
»ad”
 
the
 
giv’
 
fe
 
Çme
.

166 --- 
C®l
 :
	$şo£
(è
Ú
 
the
 
»ad”
 
wh’
 
you
 
¬e
 
dÚe
 
to
 
avoid
 
fd
 
Ëakage
.

167 
funùiÚ
 
mod
:
	$ÃwR—d”
(
f’ame
)

168 
loÿl
 
fd
 = 
S
.
	`İ’
(
f’ame
, "rdonly")

169 
nÙ
 
fd
 
th’


170 
log
:
	`çl
("could‚Ù o³Àpÿ°fe: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

171 
’d


172 
loÿl
 
size
 = 
fd
:
	`¡©
().size

173 
fd
:
	$nogc
()

174 
loÿl
 
±r
 = 
S
.
	`mm­
(
n
, 
size
, "»ad", "´iv©e", 
fd
, 0)

175 
nÙ
 
±r
 
th’


176 
log
:
	`çl
("mm­ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

177 
’d


178 
loÿl
 
off£t
 = 
	$»adH—d”
(
±r
)

179 
±r
 = 
	`ÿ¡
("uint8_t*",…tr)

180  
	`£tm‘©abË
({
fd
 = fd, 
±r
 =…Œ, 
size
 = size, 
off£t
 = 
	}
off£t}, 
	g»ad”
)

181 
’d


183 
	gffi
.
	gcdef
[[

184 
¹e_mbuf
* 
libmoÚ_»ad_pÿp
(
mempoŞ
* 
mp
, cÚ¡ * 
pÿp
, 
ušt64_t
 
»maššg
, 
ušt32_t
 
mempoŞ_buf_size
);

185 
ušt32_t
 
libmoÚ_»ad_pÿp_b©ch
(
mempoŞ
* 
mp
, 
¹e_mbuf
** 
bufs
, ušt32_ˆ
num_bufs
, cÚ¡ * 
pÿp
, 
ušt64_t
 
»maššg
, ušt32_ˆ
mempoŞ_buf_size
);

188 --- 
R—d
 
the
 
Ãxt
 
·ck‘
 
što
 
a
 
	gbuf
,h
time¡amp
 
is
 
¡Üed
 
š
h
ud©a64
 
f›ld
 
as
 
	gmiüo£cÚds
.

189 --- 
The
 
	gbufãr
's…acket size correspondsohe original…acket size, cut off bytes‡re zero-filled.

190 
funùiÚ
 
	g»ad”
:
	$»adSšgË
(
mempoŞ
, 
mempoŞBufSize
)

191 
mempoŞBufSize
 = mempoŞBufSiz
Ü
 2048

192 
loÿl
 
feRemaššg
 = 
£lf
.
size
 - s–f.
off£t


193 
feRemaššg
 < 32 
th’
 -- 
h—d”
 
size


194  
n


195 
’d


196 
loÿl
 
buf
 = 
C
.
	`libmoÚ_»ad_pÿp
(
mempoŞ
, 
£lf
.
±r
 + s–f.
off£t
, 
feRemaššg
, 
mempoŞBufSize
)

197 
buf
 
th’


198 
£lf
.
off£t
 = s–f.off£ˆ+ 
buf
.
pkt_Ën
 + 16

199 -- 
chašed
 
mbufs
 
nÙ
 
suµÜ‹d
 
now


200 
buf
.
pkt_Ën
 = buf.
d©a_Ën


201 
’d


202  
buf


203 
’d


205 --- 
R—d
 
a
 
b©ch
 
of
 
·ck‘s
 
što
‡ 
bufA¼ay
, 
the
 
time¡amp
 
is
 
¡Üed
 
š
h
ud©a64
 
f›ld
 
as
 
miüo£cÚds
.

206 --- 
The
 
bufãr
's…acket size correspondsohe original…acket size, cut off bytes‡re zero-filled.

207 --- @ 
the
 
numb”
 
of
 
·ck‘s
 
»ad


208 
funùiÚ
 
»ad”
:
	$»ad
(
bufs
, 
mempoŞBufSize
)

209 
mempoŞBufSize
 = mempoŞBufSiz
Ü
 2048

210 
loÿl
 
feRemaššg
 = 
£lf
.
size
 - s–f.
off£t


211 
feRemaššg
 < 32 
th’
 -- 
h—d”
 
size


213 
’d


214 
loÿl
 
numR—d
 = 
C
.
	`libmoÚ_»ad_pÿp_b©ch
(
bufs
.
mem
, bufs.
¬¿y
, bufs.
size
, 
£lf
.
±r
 + s–f.
off£t
, 
feRemaššg
, 
mempoŞBufSize
)

215 
i
 = 0, 
numR—d
 - 1 do

216 
£lf
.
off£t
 = s–f.off£ˆ+ 
bufs
.
¬¿y
[
i
].
pkt_Ën
 + 16

217 -- 
chašed
 
mbufs
 
nÙ
 
suµÜ‹d
 
now


218 
bufs
.
¬¿y
[
i
].
pkt_Ën
 = bufs.¬¿y[i].
d©a_Ën


219 
’d


220  
numR—d


221 
’d


223 
funùiÚ
 
»ad”
:
	$şo£
()

224 
S
.
	$munm­
(
£lf
.
±r
, s–f.
size
)

225 
S
.
	$şo£
(
£lf
.
fd
)

226 
£lf
.
fd
 = 
n


227 
£lf
.
±r
 = 
n


228 
’d


230 
funùiÚ
 
»ad”
:
	$»£t
()

231 
£lf
.
off£t
 = 
ffi
.(
h—d”Ty³
)

232 
’d


235  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/pci-ids.lua

1 
loÿl
 
	gmod
 = {}

3 
loÿl
 
log
 = 
»quœe
 "log"

4 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

8 
loÿl
 
funùiÚ
 
	$g‘Fe
()

9 
loÿl
 
feLoÿtiÚs
 = {

10 
libmoÚ
.
cÚfig
.
ba£P©h
 .. "deps/pciids/pci.ids",

12 
	}
}

13 
loÿl
 
fe


14 
i
, 
v
 
š
 
	$aœs
(
feLoÿtiÚs
) do

15 
fe
 = 
io
.
	$İ’
(
v
)

16 
fe
 
th’


18 
’d


19 
’d


20 
nÙ
 
fe
 
th’


21 
log
:
	`çl
("could‚ot find…ci.ids, check git submodules")

22 
’d


23  
fe


24 
’d


26 
loÿl
 
ÿche
 = {
	}
}

27 
funùiÚ
 
mod
.
	$g‘Name
(
id
)

28 
ÿche
[
id
] 
th’


29  
ÿche
[
id
]

30 
’d


31 
loÿl
 
v’dÜ
 = 
b™
.
	$rshiá
(
id
, 16)

32 
loÿl
 
deviû
 = 
b™
.
	$bªd
(
id
, 0xFFFF)

33 
loÿl
 
v’dÜId
, 
v’dÜName


34 
loÿl
 
Çme


35 
loÿl
 
fe
 = 
	$g‘Fe
()

36 
lše
 
š
 
fe
:
	$lšes
() do

37 
loÿl
 
c1
 = 
lše
:
	$sub
(1, 1)

38 
loÿl
 
c2
 = 
lše
:
	$sub
(2, 2)

39 
c1
 ~ğ"" 
ªd
 c1 ~ğ"#"‡nd c1 ~ğ"\t"‡nd c1 ~ğ"C" 
th’


40 -- 
v’dÜ
 
lše


41 
v’dÜId
, 
v’dÜName
 = 
lše
:
	`m©ch
("(%x+) (.+)")

42 
v’dÜId
 = 
	$tÚumb”
(
v’dÜId
, 16)

43 
–£if
 
v’dÜId
 =ğ
v’dÜ
 
ªd
 
c1
 =ğ"\t"‡nd 
c2
 ~ğ"\t" 
th’


44 -- 
deviû
 
lše


45 
loÿl
 
deviûId
, 
deviûName
 = 
lše
:
	`m©ch
("\t(%x+) (.+)")

46 
deviûId
 = 
	$tÚumb”
(
deviûId
, 16)

47 
deviûId
 =ğ
deviû
 
th’


48 
Çme
 = 
v’dÜName
 .. " " .. 
deviûName


49 
ÿche
[
id
] = 
Çme


51 
’d


52 
’d


53 
’d


54 
fe
:
	$şo£
()

55  
Çme
 
	`Ü
 ("unknowÀNIC (PCI ID %x:%x)"):
	$fÜm©
(
v’dÜ
, 
deviû
)

56 
’d


58  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/phobos.lua

1 
	g´št
[[
¶—£
 
u£
 
»quœe
 "libmoÚ" 
š¡—d
 
of
„equire "phobos"

2 
this
 
moduË
 
is
 
d•»ÿ‹d
 
ªd
 
wl
 
be
 
»moved
]]

3  
	g»quœe
 "libmoon"

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/pipe.lua

1 --- 
	gIÁ”
-
sk
 
communiÿtiÚ
 
vŸ
 
pes


2 
loÿl
 
	gmod
 = {}

4 
loÿl
 
memÜy
 = 
»quœe
 "memory"

5 
loÿl
 
ffi
 = 
»quœe
 "ffi"

6 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

7 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

8 
loÿl
 
log
 = 
»quœe
 "log"

9 
loÿl
 
S
 = 
»quœe
 "syscall"

11 
ffi
.
cdef
 [[

13 
	s¥sc_±r_queue
 { };

14 
	smpmc_±r_queue
 { };

16 
¥sc_±r_queue
* 
pe_¥sc_Ãw
(
size
);

17 
pe_¥sc_d–‘e
(
¥sc_±r_queue
* 
queue
);

18 
pe_¥sc_’queue
(
¥sc_±r_queue
* 
queue
, * 
d©a
);

19 
ušt8_t
 
pe_¥sc_Œy_’queue
(
¥sc_±r_queue
* 
queue
, * 
d©a
);

20 * 
pe_¥sc_Œy_dequeue
(
¥sc_±r_queue
* 
queue
);

21 
size_t
 
pe_¥sc_couÁ
(
¥sc_±r_queue
* 
queue
);

23 
mpmc_±r_queue
* 
pe_mpmc_Ãw
(
size
);

24 
pe_mpmc_d–‘e
(
mpmc_±r_queue
* 
queue
);

25 
pe_mpmc_’queue
(
mpmc_±r_queue
* 
queue
, * 
d©a
);

26 
ušt8_t
 
pe_mpmc_Œy_’queue
(
mpmc_±r_queue
* 
queue
, * 
d©a
);

27 * 
pe_mpmc_Œy_dequeue
(
mpmc_±r_queue
* 
queue
);

28 
size_t
 
pe_mpmc_couÁ
(
mpmc_±r_queue
* 
queue
);

31 
	s¹e_ršg
 { };

32 
¹e_ršg
* 
ü—‹_ršg
(
ušt32_t
 
couÁ
, 
št32_t
 
sock‘
);

33 
ä“_ršg
(
¹e_ršg
* 
r
);

34 
ršg_’queue
(
¹e_ršg
* 
r
, 
¹e_mbuf
** 
obj
, 
n
);

35 
ršg_dequeue
(
¹e_ršg
* 
r
, 
¹e_mbuf
** 
obj
, 
n
);

36 
ršg_couÁ
(
¹e_ršg
* 
r
);

37 
ršg_ä“_couÁ
(
¹e_ršg
* 
r
);

38 
boŞ
 
ršg_em±y
(
¹e_ršg
* 
r
);

39 
boŞ
 
ršg_fuÎ
(
¹e_ršg
* 
r
);

42 
loÿl
 
	gC
 = 
ffi
.
C


44 
mod
.
·ck‘Ršg
 = {}

45 
loÿl
 
·ck‘Ršg
 = 
mod
.packetRing

46 
·ck‘Ršg
.
__šdex
 =…acketRing

48 
funùiÚ
 
mod
:
	$ÃwPack‘Ršg
(
size
, 
sock‘
)

49 
size
 = siz
Ü
 512

50 
sock‘
 = sock‘ 
Ü
 -1

51  
	`£tm‘©abË
({

52 
ršg
 = 
C
.
	`ü—‹_ršg
(
size
, 
sock‘
)

53 
	}
}, 
	g·ck‘Ršg
)

54 
’d


56 
funùiÚ
 
	gmod
:
	$ÃwPack‘RšgFromRšg
(
ršg
)

57  
	`£tm‘©abË
({

58 
ršg
 =„ing

59 
	}
}, 
	g·ck‘Ršg
)

60 
’d


62 
loÿl
 
	gENOBUFS
 = 
S
.
c
.
E
.
NOBUFS


64 -- 
FIXME
: 
this
 
is
 
wÜk
-
¬ound
 
some
 
bug
 
w™h
 
the
 
£rŸliz©iÚ
 
of
 
Ã¡ed
 
objeùs


65 
funùiÚ
 
mod
:
	$£ndToPack‘Ršg
(
ršg
, 
bufs
, 
n
)

66  
C
.
	`ršg_’queue
(
ršg
, 
bufs
.
¬¿y
, 
n
 
Ü
 bufs.
size
) > 0

67 
’d


69 
funùiÚ
 
·ck‘Ršg
:
	$ä“
()

70  
C
.
	$ä“_ršg
(
£lf
.
ršg
)

71 
’d


73 -- 
Œy
 
to
 
’queue
 
·ck‘s
 
š
 
a
 
ršg
, 
»tuºs
 
Œue
 
Ú
 
sucûss


74 
funùiÚ
 
·ck‘Ršg
:
	$£nd
(
bufs
)

75  
C
.
	`ršg_’queue
(
£lf
.
ršg
, 
bufs
.
¬¿y
, bufs.
size
) > 0

76 
’d


78 -- 
Œy
 
to
 
’queue
 
·ck‘s
 
š
 
a
 
ršg
, 
»tuºs
 
Œue
 
Ú
 
sucûss


79 
funùiÚ
 
·ck‘Ršg
:
	$£ndN
(
bufs
, 
n
)

80  
C
.
	`ršg_’queue
(
£lf
.
ršg
, 
bufs
.
¬¿y
, 
n
) > 0

81 
’d


83 -- 
»tuºs
 
numb”
 
of
 
·ck‘s
 
»ûived


84 
funùiÚ
 
·ck‘Ršg
:
	$»cv
(
bufs
)

85  
C
.
	$ršg_dequeue
(
£lf
.
ršg
, 
bufs
.
¬¿y
, bufs.
size
)

86 
’d


88 -- 
»tuºs
 
numb”
 
of
 
·ck‘s
 
»ûived


89 
funùiÚ
 
·ck‘Ršg
:
	$»cvN
(
bufs
, 
n
)

90  
C
.
	$ršg_dequeue
(
£lf
.
ršg
, 
bufs
.
¬¿y
, 
n
)

91 
’d


93 
funùiÚ
 
·ck‘Ršg
:
	$couÁ
()

94  
C
.
	$ršg_couÁ
(
£lf
.
ršg
)

95 
’d


97 
funùiÚ
 
·ck‘Ršg
:
	$ä“CouÁ
()

98  
C
.
	$ršg_ä“_couÁ
(
£lf
.
ršg
)

99 
’d


101 
funùiÚ
 
·ck‘Ršg
:
	$em±y
()

102  
C
.
	$ršg_em±y
(
£lf
.
ršg
)

103 
’d


105 
funùiÚ
 
·ck‘Ršg
:
	$fuÎ
()

106  
C
.
	$ršg_fuÎ
(
£lf
.
ršg
)

107 
’d


109 
funùiÚ
 
·ck‘Ršg
:
	$__£rŸlize
()

110  "»quœe'pe';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('pe').·ck‘Ršg"), 
Œue


111 
’d


113 
mod
.
¦owPe
 = {
	}
}

114 
loÿl
 
¦owPe
 = 
mod
.slowPipe

115 
¦owPe
.
__šdex
 = slowPipe

117 --- 
C»©e
 
a
 
Ãw
 
¦ow
 
pe
.

118 --- 
Slow
 
pes
 
¬e
 
ÿÎed
 
¦ow
 
pe
 
beÿu£
 
they
‡» slow (
duh
).

119 --- 
Any
 
objeùs
 
·s£d
 
to
 
™
 
wl
 
be
 *
£rŸlized
* 
as
 
¡ršgs
.

120 --- 
This
 
m—ns
 
th©
 
™
 
suµÜts
 
¬b™¿ry
 
Lua
 
objeùs
 
fŞlowšg
 
libmoÚ
's usual serialization„ules.

121 --- 
U£
 
a
 'ç¡…e' 
you
 
Ãed
 
ç¡
 
š‹r
-
sk
 
communiÿtiÚ
. 
Fa¡
 
pes
 
¬e
 
»¡riùed
 
to
 
LuaJIT
 
FFI
 
objeùs
.

122 --- 
RuË
 
of
 
thumb
: 
u£
 
a
 
¦ow
 
pe
 
you
 
dÚ
't‚eed morehan‡ fewhousand messages…er second,

123 --- 
e
.
g
. 
to
 
·ss
 
agg»g©ed
 
d©a
 
Ü
 
¡©i¡ics
 
b‘w“n
 
sks
. 
U£
 
ç¡
 
pes
 
you
 
š‹nd
ØdØ
som‘hšg
 

124 --- 
	$ev”y
 (
Ü
 
®mo¡
 
ev”y
è
·ck‘
 
you
 
´oûss
.

125 
funùiÚ
 
mod
:
	$ÃwSlowPe
()

126  
	`£tm‘©abË
({

127 
pe
 = 
C
.
	`pe_mpmc_Ãw
(512)

128 
	}
}, 
	g¦owPe
)

129 
	g’d


131 -- 
This
 
is
 
	gwÜk
-
¬ound
 
some
 
bug
 
w™h
 
the
 
£rŸliz©iÚ
 
of
 
Ã¡ed
 
objeùs


132 
funùiÚ
 
	gmod
:
	$£ndToSlowPe
(
¦owPe
, ...)

133 
loÿl
 
v®s
 = 
£½’t
.
	`dump
({...
	}
})

134 
loÿl
 
buf
 = 
memÜy
.
®loc
("char*", #vals + 1)

135 
	gffi
.
	$cİy
(
buf
, 
v®s
)

136 
C
.
	$pe_mpmc_’queue
(
¦owPe
.
pe
, 
buf
)

137 
’d


139 
funùiÚ
 
¦owPe
:
	$£nd
(...)

140 
loÿl
 
v®s
 = 
£½’t
.
	`dump
({ ... 
	}
})

141 
loÿl
 
buf
 = 
memÜy
.
®loc
("char*", #vals + 1)

142 
	gffi
.
	$cİy
(
buf
, 
v®s
)

143 
C
.
	$pe_mpmc_’queue
(
£lf
.
pe
, 
buf
)

144 
’d


146 
funùiÚ
 
¦owPe
:
	$ŒyRecv
(
wa™
)

147 
wa™
 = wa™ 
Ü
 0

148 
wa™
 >= 0 do

149 
loÿl
 
buf
 = 
C
.
	$pe_mpmc_Œy_dequeue
(
£lf
.
pe
)

150 
buf
 ~ğ
n
 
th’


151 
loÿl
 
»suÉ
 = 
	`lßd¡ršg
(
ffi
.
	$¡ršg
(
buf
))()

152 
memÜy
.
	$ä“
(
buf
)

153  
	$uÅackAÎ
(
»suÉ
)

154 
’d


155 
wa™
 = wait - 10

156 
wa™
 < 0 
th’


158 
’d


159 
libmoÚ
.
	$¦“pMiüosIdË
(10)

160 
’d


161 
’d


163 
funùiÚ
 
¦owPe
:
	$»cv
()

164 
loÿl
 
funùiÚ
 
	$loİ
(...)

165 
nÙ
 ... 
th’


166  
	`loİ
(
£lf
:
	$ŒyRecv
(10))

169 
’d


170 
’d


171  
	$loİ
()

172 
’d


174 
funùiÚ
 
¦owPe
:
	$couÁ
()

175  
	`tÚumb”
(
C
.
	$pe_mpmc_couÁ
(
£lf
.
pe
))

176 
’d


178 -- 
Dequeue
 
ªd
 
disÿrd
 
®l
 
objeùs
 
äom
 
pe


179 
funùiÚ
 
¦owPe
:
	$em±y
()

180 
£lf
:
	`couÁ
() > 0 do

181 
£lf
:
	$»cv
()

182 
’d


183 
’d


185 
funùiÚ
 
¦owPe
:
	$d–‘e
()

186 
C
.
	$pe_mpmc_d–‘e
(
£lf
.
pe
)

187 
’d


189 
funùiÚ
 
¦owPe
:
	$__£rŸlize
()

190  "»quœe'pe';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('pe').¦owPe"), 
Œue


191 
’d


194 
mod
.
ç¡Pe
 = {
	}
}

195 
loÿl
 
ç¡Pe
 = 
mod
.fastPipe

196 
ç¡Pe
.
__šdex
 = fastPipe

198 --- 
C»©e
 
a
 
Ãw
 
ç¡
 
pe
.

199 --- 
A
 
pe
 
ÿn
 
Úly
 
be
 
u£d
 
by
 
exaùly
 
two
 
sks
: 
a
 
sšgË
 
»ad”
 
ªd
‡ sšgË 
wr™”
.

200 --- 
Fa¡
 
pes
 
¬e
 
ç¡
, 
but
 
Úly
 
acû±
 
FFI
 
cd©a
 
poš‹rs
 
ªd
 
nÙhšg
 .

201 --- 
U£
 
a
 
¦ow
 
pe
 
to
 
·ss
 
¬b™¿ry
 
	gobjeùs
.

202 --- 
	gTODO
: 
add
 
a
 
MPMC
 
	$v¬ŸÁ
 (
puÎ
 
»que¡s
 
w–come
)

203 
funùiÚ
 
mod
:
	$ÃwFa¡Pe
(
size
)

204  
	`£tm‘©abË
({

205 
pe
 = 
C
.
	`pe_¥sc_Ãw
(
size
 
Ü
 512)

206 
	}
}, 
	gç¡Pe
)

207 
’d


209 
funùiÚ
 
	gç¡Pe
:
	$£nd
(
obj
)

210 
C
.
	$pe_¥sc_’queue
(
£lf
.
pe
, 
obj
)

211 
’d


213 
funùiÚ
 
ç¡Pe
:
	$ŒyS’d
(
obj
)

214  
C
.
	`pe_¥sc_Œy_’queue
(
£lf
.
pe
, 
obj
) ~= 0

215 
’d


217 -- 
FIXME
: 
this
 
is
 
wÜk
-
¬ound
 
some
 
bug
 
w™h
 
the
 
£rŸliz©iÚ
 
of
 
Ã¡ed
 
objeùs


218 
funùiÚ
 
mod
:
	$£ndToFa¡Pe
(
pe
, 
obj
)

219  
C
.
	`pe_¥sc_Œy_’queue
(
pe
, 
obj
) ~= 0

220 
’d


222 
funùiÚ
 
ç¡Pe
:
	$ŒyRecv
(
wa™
)

223 
wa™
 >= 0 do

224 
loÿl
 
buf
 = 
C
.
	$pe_¥sc_Œy_dequeue
(
£lf
.
pe
)

225 
buf
 ~ğ
n
 
th’


226  
buf


227 
’d


228 
wa™
 = wait - 10

229 
wa™
 < 0 
th’


231 
’d


232 
libmoÚ
.
	$¦“pMiüosIdË
(10)

233 
’d


234 
’d


236 
funùiÚ
 
ç¡Pe
:
	$»cv
()

237 
loÿl
 
funùiÚ
 
	$loİ
(...)

238 
nÙ
 ... 
th’


239  
	`loİ
(
£lf
:
	$ŒyRecv
(10))

242 
’d


243 
’d


244  
	$loİ
()

245 
’d


247 
funùiÚ
 
ç¡Pe
:
	$couÁ
()

248  
	`tÚumb”
(
C
.
	$pe_¥sc_couÁ
(
£lf
.
pe
))

249 
’d


251 
funùiÚ
 
ç¡Pe
:
	$d–‘e
()

252 
C
.
	$pe_¥sc_d–‘e
(
£lf
.
pe
)

253 
’d


255 
funùiÚ
 
ç¡Pe
:
	$__£rŸlize
()

256  "»quœe'pe';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('pe').ç¡Pe"), 
Œue


257 
’d


259  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ah.lua

2 --- @
fe
 
	gah
.
	glua


3 --- @
br›f
 
AH
 
	gut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
ah_h—d”
 
	g¡ruùs


5 --- 
	gInşudes
:

6 --- - 
AH
 
cÚ¡ªts


7 --- - 
IP£c
 
ICV


8 --- - 
AH
 
h—d”
 
ut™y


9 --- - 
Defš™iÚ
 
of
 
AH
 
·ck‘s


12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

13 
»quœe
 "proto.template"

14 
loÿl
 
š™H—d”
 = initHeader

17 ---- 
ah
 
cÚ¡ªts


20 
loÿl
 
ah
 = {}

23 ---- 
IP£c
 
IV
 -> 
£e
 
´Ùo
/
e¥
.
lua


27 ---- 
IP£c
 
ICV


30 
ffi
.
cdef
[[

31 
	u£c_icv
 {

32 
ušt32_t
 
ušt32
[4];

36 
loÿl
 
	g£cICV
 = {}

37 
£cICV
.
__šdex
 = ipsecICV

38 
loÿl
 
£cICVTy³
 = 
ffi
.
ty³of
("union ipsec_icv")

40 --- 
S‘
 
the
 
IP£c
 
ICV
.

41 --- @
·¿m
 
iv
 
IP£c
 
ICV
 
š
 'uniÚ ip£c_icv' 
fÜm©
.

42 
funùiÚ
 
£cICV
:
£t
(
icv
)

43 -- 
FÜ
 
AH
 
hw
 
ofæßd
 
the
 
ICV
 
has
 
to
 
be
 
z”o


44 
loÿl
 
ofæßd_icv
 = 
ffi
.
Ãw
("union ipsec_icv")

45 
ofæßd_icv
.
ušt32
[0] = 0x0

46 
ofæßd_icv
.
ušt32
[1] = 0x0

47 
ofæßd_icv
.
ušt32
[2] = 0x0

48 
ofæßd_icv
.
ušt32
[3] = 0x0

50 
icv
 = icv 
Ü
 
ofæßd_icv


51 
£lf
.
ušt32
[0] = 
	$htÚ
(
icv
.
ušt32
[3])

52 
£lf
.
ušt32
[1] = 
	$htÚ
(
icv
.
ušt32
[2])

53 
£lf
.
ušt32
[2] = 
	$htÚ
(
icv
.
ušt32
[1])

54 
£lf
.
ušt32
[3] = 
	$htÚ
(
icv
.
ušt32
[0])

55 
’d


57 --- 
R‘r›ve
 
the
 
IP£c
 
ICV


58 --- @ 
ICV
 
š
 'uniÚ ip£c_icv' 
fÜm©
.

59 
funùiÚ
 
£cICV
:
	$g‘
()

60 
loÿl
 
icv
 = 
	$£cICVTy³
()

61 
icv
.
ušt32
[0] = 
	$htÚ
(
£lf
.
ušt32
[3])

62 
icv
.
ušt32
[1] = 
	$htÚ
(
£lf
.
ušt32
[2])

63 
icv
.
ušt32
[2] = 
	$htÚ
(
£lf
.
ušt32
[1])

64 
icv
.
ušt32
[3] = 
	$htÚ
(
£lf
.
ušt32
[0])

65  
icv


66 
’d


68 --- 
G‘
 
the
 
IP£c
 
¡ršg
.

69 --- @
·¿m
 
icv
 
IP£c
 
ICV
 
š
 
¡ršg
 
fÜm©
.

70 
funùiÚ
 
£cICV
:
	$g‘SŒšg
(
doBy‹Sw­
)

71 
doBy‹Sw­
 = doBy‹Sw­ 
Ü
 
çl£


72 
doBy‹Sw­
 
th’


73 
£lf
 = s–f:
	$g‘
()

74 
’d


76  ("0x%08x%08x%08x%08x"):
	$fÜm©
(
£lf
.
ušt32
[3], self.uint32[2], self.uint32[1], self.uint32[0])

77 
’d


80 ---- 
ah
 
h—d”


83 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


84 
ah
.
h—d”FÜm©
 = [[

85 
ušt8_t
 
ÃxtH—d”
;

86 
ušt8_t
 
Ën
;

87 
ušt16_t
 
»£rved
;

88 
ušt32_t
 
¥i
;

89 
ušt32_t
 
sqn
;

90 
£c_iv
 
iv
;

91 
£c_icv
 
icv
;

94 --- 
V¬ŸbË
 
sized
 
memb”


95 
ah
.
h—d”V¬ŸbËMemb”
 = 
n


97 
loÿl
 
ahH—d”
 = 
	$š™H—d”
()

98 
ahH—d”
.
__šdex
 =‡hHeader

100 --- 
S‘
 
the
 
SPI
.

101 --- @
·¿m
 
SPI
 
of
 
the
 
ah
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

102 
funùiÚ
 
ahH—d”
:
	$£tSPI
()

103 ğ
Ü
 0

104 
£lf
.
¥i
 = 
	$htÚ
()

105 
’d


107 --- 
R‘r›ve
 
the
 
SPI
.

108 --- @ 
SPI
 
as
 
A
 
b™
 
š‹g”
.

109 
funùiÚ
 
ahH—d”
:
	$g‘SPI
()

110  
	$htÚ
(
£lf
.
¥i
)

111 
’d


113 --- 
R‘r›ve
 
the
 
SPI
 
as
 
¡ršg
.

114 --- @ 
SPI
 
as
 
¡ršg
.

115 
funùiÚ
 
ahH—d”
:
	$g‘SPISŒšg
()

116  
£lf
:
	$g‘SPI
()

117 
’d


119 --- 
S‘
 
the
 
SQN
.

120 --- @
·¿m
 
SQN
 
of
 
the
 
ah
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

121 
funùiÚ
 
ahH—d”
:
	$£tSQN
()

122 ğ
Ü
 0

123 
£lf
.
sqn
 = 
	$htÚ
()

124 
’d


126 --- 
R‘r›ve
 
the
 
SQN
.

127 --- @ 
SQN
 
as
 
A
 
b™
 
š‹g”
.

128 
funùiÚ
 
ahH—d”
:
	$g‘SQN
()

129  
	$htÚ
(
£lf
.
sqn
)

130 
’d


132 --- 
R‘r›ve
 
the
 
SQN
 
as
 
¡ršg
.

133 --- @ 
SQN
 
as
 
¡ršg
.

134 
funùiÚ
 
ahH—d”
:
	$g‘SQNSŒšg
()

135  
£lf
:
	$g‘SQN
()

136 
’d


138 --- 
S‘
 
the
 
IV
.

139 --- @
·¿m
 
IV
 
of
 
the
 
ah
 
h—d”
 
as
 'union ipsec_iv'.

140 
funùiÚ
 
ahH—d”
:
	$£tIV
(
iv
)

141 
£lf
.
iv
:
	$£t
(
iv
)

142 
’d


144 --- 
R‘r›ve
 
the
 
IV
.

145 --- @ 
SPI
 
as
 'union ipsec_iv'.

146 
funùiÚ
 
ahH—d”
:
	$g‘IV
()

147  
£lf
.
iv
:
	$g‘
()

148 
’d


150 --- 
R‘r›ve
 
the
 
IV
 
as
 
¡ršg
.

151 --- @ 
IV
 
as
 
¡ršg
.

152 
funùiÚ
 
ahH—d”
:
	$g‘IVSŒšg
()

153  
£lf
.
iv
:
	$g‘SŒšg
(
Œue
)

154 
’d


156 --- 
S‘
 
the
 
ICV
.

157 --- @
·¿m
 
ICV
 
of
 
the
 
ah
 
h—d”
 
as
...

158 
funùiÚ
 
ahH—d”
:
	$£tICV
(
icv
)

159 
£lf
.
icv
:
	$£t
(
icv
)

160 
’d


162 --- 
R‘r›ve
 
the
 
ICV
.

163 --- @ 
SPI
 
as
...

164 
funùiÚ
 
ahH—d”
:
	$g‘ICV
()

165  
£lf
.
icv
:
	$g‘
()

166 
’d


168 --- 
R‘r›ve
 
the
 
ICV
 
as
 
¡ršg
.

169 --- @ 
ICV
 
as
 
¡ršg
.

170 
funùiÚ
 
ahH—d”
:
	$g‘ICVSŒšg
()

171  
£lf
.
icv
:
	$g‘SŒšg
(
Œue
)

172 
’d


174 --- 
S‘
 
the
 
Next
 
H—d”
.

175 --- @
·¿m
 
Next
 
H—d”
 
of
 
the
 
ah
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

176 
funùiÚ
 
ahH—d”
:
	$£tNextH—d”
()

177 ğ
Ü
 0

178 
£lf
.
ÃxtH—d”
 = 

179 
’d


181 --- 
R‘r›ve
 
the
 
Next
 
H—d”
.

182 --- @ 
Next
 
H—d”
 
as
 
A
 
b™
 
š‹g”
.

183 
funùiÚ
 
ahH—d”
:
	$g‘NextH—d”
()

184  
£lf
.
ÃxtH—d”


185 
’d


187 --- 
R‘r›ve
 
the
 
Next
 
H—d”
 
as
 
¡ršg
.

188 --- @ 
Next
 
H—d”
 
as
 
¡ršg
.

189 
funùiÚ
 
ahH—d”
:
	$g‘NextH—d”SŒšg
()

190  
£lf
:
	$g‘NextH—d”
()

191 
’d


193 --- 
S‘
 
the
 
L’gth
.

194 --- @
·¿m
 
L’gth
 
of
 
the
 
ah
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

195 
funùiÚ
 
ahH—d”
:
	`£tL’gth
()

196 -- 
The
 
AH
 
h—d”
 
has
 
a
 
fixed
 
Ëngth
 
AES
-
GMAC


197 -- (
cf
. 
ch­‹r
 16.5.1 "AH FÜm©s" 
of
 
X540
 
D©ash“t
)

198 -- 
Auth’tiÿtiÚ
 
h—d”
 
Ëngth
 
š
 32-
b™
 
DwÜds
 
un™s
, 
mšus
 2,

199 -- 
such
 
as
 
AES
-128 
™s
 
v®ue
 
is
 7 
IPv4
 
ªd
 8 
IPv6
.

200 ğ
Ü
 7 -- 
IPv4
: 7 = (9-2)

201 
£lf
.
Ën
 = 

202 
’d


204 --- 
R‘r›ve
 
the
 
L’gth
.

205 --- @ 
L’gth
 
as
 
A
 
b™
 
š‹g”
.

206 
funùiÚ
 
ahH—d”
:
	$g‘L’gth
()

207  
£lf
.
Ën


208 
’d


210 --- 
R‘r›ve
 
the
 
L’gth
 
as
 
¡ršg
.

211 --- @ 
L’gth
 
as
 
¡ršg
.

212 
funùiÚ
 
ahH—d”
:
	$g‘L’gthSŒšg
()

213  
£lf
:
	$g‘L’gth
()

214 
’d


216 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
ah
 
h—d”
.

217 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

218 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

219 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
ahSPI
, 
ahSQN
, 
ahIV
, 
ahICV


220 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ah'.

221 --- @
u§ge
 
	`fl
(è-- 
Úly
  
v®ues


222 --- @
u§ge
 
fl
{ 
ahXYZ
=1 
	}
} -- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	gahXYZ
, ...

223 
funùiÚ
 
	gahH—d”
:
	$fl
(
¬gs
, 
´e
)

224 
¬gs
 =‡rg 
Ü
 {
	}
}

225 
´e
 =…» 
Ü
 "ah"

227 
£lf
:
£tSPI
(
¬gs
[
´e
 .. "SPI"])

228 
£lf
:
£tSQN
(
¬gs
[
´e
 .. "SQN"])

229 
£lf
:
£tIV
(
¬gs
[
´e
 .. "IV"])

230 
£lf
:
£tICV
(
¬gs
[
´e
 .. "ICV"])

231 
£lf
:
£tNextH—d”
(
¬gs
[
´e
 .. "NextHeader"])

232 
£lf
:
£tL’gth
(
¬gs
[
´e
 .. "Length"])

233 
’d


235 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

236 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ah'.

237 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

238 --- @
£e
 
ahH—d”
:
fl


239 
funùiÚ
 
ahH—d”
:
	$g‘
(
´e
)

240 
´e
 =…» 
Ü
 "ah"

242 
loÿl
 
¬gs
 = {
	}
}

243 
¬gs
[
´e
 .. "SPI"] = 
£lf
:
	$g‘SPI
()

244 
¬gs
[
´e
 .. "SQN"] = 
£lf
:
	$g‘SQN
()

245 
¬gs
[
´e
 .. "IV"] = 
£lf
:
	$g‘IV
()

246 
¬gs
[
´e
 .. "ICV"] = 
£lf
:
	$g‘ICV
()

247 
¬gs
[
´e
 .. "NextH—d”"] = 
£lf
:
	$g‘NextH—d”
()

248 
¬gs
[
´e
 .. "L’gth"] = 
£lf
:
	$g‘L’gth
()

250  
¬gs


251 
’d


253 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

254 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

255 
funùiÚ
 
ahH—d”
:
	$g‘SŒšg
()

256  "AH sp˜" .. 
£lf
:
	`g‘SPISŒšg
(è.. " sqÀ" .. s–f:
	`g‘SQNSŒšg
(è.. " iv " .. s–f:
	`g‘IVSŒšg
(è.. " icv " .. s–f:
	`g‘ICVSŒšg
(è.. "‚ext_hd¸" .. s–f:
	`g‘NextH—d”
(è.. "†’ " .. s–f:
	$g‘L’gth
()

257 
’d


259 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
	`Úe
 (
š
 
a
 
·ck‘
)

260 --- 
FÜ
 
š¡ªû
: 
š
 
tı
/
udp
 
ba£d
 
Ú
 
the
 
pÜts


261 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


262 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

263 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. '‘h', '4', 
n
)

264 
funùiÚ
 
ahH—d”
:
	$»sŞveNextH—d”
()

265  
n


266 --
TODO
:  
£lf
:
	$g‘NextH—d”
()

267 
’d


271 ---- 
M‘©y³s


274 
ffi
.
	`m‘©y³
("uniÚ ip£c_icv", 
£cICV
)

275 
ah
.
m‘©y³
 = 
ahH—d”


277  
ah


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/arp.lua

2 --- @
fe
 
	g¬p
.
	glua


3 --- @
br›f
 
Add»ss
 
»sŞutiÚ
 
	$´ÙocŞ
 (
ARP
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
¬p_h—d”
 

5 --- 
Inşudes
:

6 --- - 
A½
 
cÚ¡ªts


7 --- - 
A½
 
add»ss
 
ut™y


8 --- - 
A½
 
h—d”
 
ut™y


9 --- - 
Defš™iÚ
 
of
 
A½
 
·ck‘s


10 --- - 
A½
 
hªdËr
 
sk


13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "proto.template"

15 
loÿl
 
š™H—d”
 = initHeader

17 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

18 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

19 
loÿl
 
memÜy
 = 
»quœe
 "memory"

20 
loÿl
 
f‹r
 = 
»quœe
 "filter"

21 
loÿl
 
ns
 = 
»quœe
 "namespaces"

22 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

23 
loÿl
 
pe
 = 
»quœe
 "pipe"

24 
loÿl
 
log
 = 
»quœe
 "log"

25 
loÿl
 
tim”
 = 
»quœe
 "timer"

27 
loÿl
 
‘h
 = 
»quœe
 "proto.ethernet"

29 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

30 
loÿl
 
Áoh16
, 
htÚ16
 =‚toh16, hton16

31 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
ğ
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

32 
loÿl
 
fÜm©
 = 
¡ršg
.format

33 
loÿl
 
i¡y³
 = 
ffi
.istype

37 ---- 
ARP
 
	`cÚ¡ªts
 (
c
.
f
. 
h‰p
:

40 --- 
A½
 
´ÙocŞ
 
cÚ¡ªts


41 
loÿl
 
¬p
 = {
	}
}

43 --- 
H¬dw¬e
 
add»ss
 
ty³
 
‘h”Ãt


44 
¬p
.
HARDWARE_ADDRESS_TYPE_ETHERNET
 = 1

46 --- 
PrÙo
 
add»ss
 
ty³
 
IP
 (
‘h”Ãt
 
ba£d
 
´ÙocŞs
 
u£s
 
‘h”Ty³
 
numb”s
 \
»f
ƒth”Ãt.
lua
)

47 
¬p
.
PROTO_ADDRESS_TYPE_IP
 = 0x0800

49 --- 
O³¿tiÚ
: 
»que¡


50 
¬p
.
OP_REQUEST
 = 1

51 --- 
O³¿tiÚ
: 
»¶y


52 
¬p
.
OP_REPLY
 = 2

56 ---- 
ARP
 
h—d”


59 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


60 
¬p
.
h—d”FÜm©
 = [[

61 
ušt16_t
 
hrd
;

62 
ušt16_t
 
´o
;

63 
ušt8_t
 
hÊ
;

64 
ušt8_t
 
¶n
;

65 
ušt16_t
 
İ
;

66 
mac_add»ss
 
sha
;

67 
4_add»ss
 
¥a
;

68 
mac_add»ss
 
tha
;

69 
4_add»ss
 
a
;

72 --- 
V¬ŸbË
 
sized
 
memb”


73 
	g¬p
.
	gh—d”V¬ŸbËMemb”
 = 
n


75 --- 
ModuË
 
¬p_h—d”
 

76 
loÿl
 
¬pH—d”
 = 
	$š™H—d”
()

77 
¬pH—d”
.
__šdex
 =‡rpHeader

79 --- 
S‘
 
the
 
h¬dw¬e
 
add»ss
 
ty³
.

80 --- @
·¿m
 
Ty³
 
as
 16 
b™
 
š‹g”
.

81 
funùiÚ
 
¬pH—d”
:
	$£tH¬dw¬eAdd»ssTy³
()

82 ğ
Ü
 
¬p
.
HARDWARE_ADDRESS_TYPE_ETHERNET


83 
£lf
.
hrd
 = 
	$htÚ16
()

84 
’d


86 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
add»ss
 
ty³
.

87 --- @ 
Ty³
 
as
 16 
b™
 
š‹g”
.

88 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eAdd»ssTy³
()

89  
	$htÚ16
(
£lf
.
hrd
)

90 
’d


92 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
add»ss
 
ty³
.

93 --- @ 
Ty³
 
š
 
¡ršg
 
fÜm©
.

94 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eAdd»ssTy³SŒšg
()

95 
loÿl
 
ty³
 = 
£lf
:
	$g‘H¬dw¬eAdd»ssTy³
()

96 
ty³
 =ğ
¬p
.
HARDWARE_ADDRESS_TYPE_ETHERNET
 
th’


99  
	`fÜm©
("0x%04x", 
ty³
)

100 
’d


101 
’d


103 --- 
S‘
 
the
 
´ÙocŞ
 
add»ss
 
ty³
.

104 --- @
·¿m
 
Ty³
 
as
 16 
b™
 
š‹g”
.

105 
funùiÚ
 
¬pH—d”
:
	$£tPrÙoAdd»ssTy³
()

106 ğ
Ü
 
¬p
.
PROTO_ADDRESS_TYPE_IP


107 
£lf
.
´o
 = 
	$htÚ16
()

108 
’d


110 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
add»ss
 
ty³
.

111 --- @ 
Ty³
 
as
 16 
b™
 
š‹g”
.

112 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoAdd»ssTy³
()

113  
	$htÚ16
(
£lf
.
´o
)

114 
’d


116 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
add»ss
 
ty³
.

117 --- @ 
Ty³
 
š
 
¡ršg
 
fÜm©
.

118 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoAdd»ssTy³SŒšg
()

119 
loÿl
 
ty³
 = 
£lf
:
	$g‘PrÙoAdd»ssTy³
()

120 
ty³
 =ğ
¬p
.
PROTO_ADDR_TYPE_IP
 
th’


123  
	`fÜm©
("0x%04x", 
ty³
)

124 
’d


125 
’d


127 --- 
S‘
 
the
 
h¬dw¬e
 
add»ss
 
Ëngth
.

128 --- @
·¿m
 
L’gth
 
as
 8 
b™
 
š‹g”
.

129 
funùiÚ
 
¬pH—d”
:
	$£tH¬dw¬eAdd»ssL’gth
()

130 ğ
Ü
 6

131 
£lf
.
hÊ
 = 

132 
’d


134 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
add»ss
 
Ëngth
.

135 --- @ 
L’gth
 
as
 8 
b™
 
š‹g”
.

136 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eAdd»ssL’gth
()

137  
£lf
.
hÊ


138 
’d


140 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
add»ss
 
Ëngth
.

141 --- @ 
L’gth
 
š
 
¡ršg
 
fÜm©
.

142 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eAdd»ssL’gthSŒšg
()

143  
£lf
:
	$g‘H¬dw¬eAdd»ssL’gth
()

144 
’d


146 --- 
S‘
 
the
 
´ÙocŞ
 
add»ss
 
Ëngth
.

147 --- @
·¿m
 
L’gth
 
as
 8 
b™
 
š‹g”
.

148 
funùiÚ
 
¬pH—d”
:
	$£tPrÙoAdd»ssL’gth
()

149 ğ
Ü
 4

150 
£lf
.
¶n
 = 

151 
’d


153 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
add»ss
 
Ëngth
.

154 --- @ 
L’gth
 
as
 8 
b™
 
š‹g”
.

155 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoAdd»ssL’gth
()

156  
£lf
.
¶n


157 
’d


159 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
add»ss
 
Ëngth
.

160 --- @ 
L’gth
 
š
 
¡ršg
 
fÜm©
.

161 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoAdd»ssL’gthSŒšg
()

162  
£lf
:
	$g‘PrÙoAdd»ssL’gth
()

163 
’d


165 --- 
S‘
 
the
 
İ”©iÚ
.

166 --- @
·¿m
 
O³¿tiÚ
 
as
 16 
b™
 
š‹g”
.

167 
funùiÚ
 
¬pH—d”
:
	$£tO³¿tiÚ
()

168 ğ
Ü
 
¬p
.
OP_REQUEST


169 
£lf
.
İ
 = 
	$htÚ16
()

170 
’d


172 --- 
R‘r›ve
 
the
 
İ”©iÚ
.

173 --- @ 
O³¿tiÚ
 
as
 16 
b™
 
š‹g”
.

174 
funùiÚ
 
¬pH—d”
:
	$g‘O³¿tiÚ
()

175  
	$htÚ16
(
£lf
.
İ
)

176 
’d


178 --- 
R‘r›ve
 
the
 
İ”©iÚ
.

179 --- @ 
O³¿tiÚ
 
š
 
¡ršg
 
fÜm©
.

180 
funùiÚ
 
¬pH—d”
:
	$g‘O³¿tiÚSŒšg
()

181 
loÿl
 
İ
 = 
£lf
:
	$g‘O³¿tiÚ
()

182 
İ
 =ğ
¬p
.
OP_REQUEST
 
th’


184 
–£if
 
İ
 =ğ
¬p
.
OP_REPLY
 
th’


187  
İ


188 
’d


189 
’d


191 --- 
S‘
 
the
 
h¬dw¬e
 
sourû
 
add»ss
.

192 --- @
·¿m
 
addr
 
Add»ss
 
š
 'uniÚ mac_add»ss' 
fÜm©
.

193 
funùiÚ
 
¬pH—d”
:
	$£tH¬dw¬eSrc
(
addr
)

194 
£lf
.
sha
:
	$£t
(
addr
)

195 
’d


197 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
sourû
 
add»ss
.

198 --- @ 
Add»ss
 
š
 'uniÚ mac_add»ss' 
fÜm©
.

199 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eSrc
()

200  
£lf
.
sha
:
	$g‘
()

201 
’d


203 --- 
S‘
 
the
 
h¬dw¬e
 
sourû
 
add»ss
.

204 --- @
·¿m
 
addr
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

205 
funùiÚ
 
¬pH—d”
:
	$£tH¬dw¬eSrcSŒšg
(
addr
)

206 
£lf
.
sha
:
	$£tSŒšg
(
addr
)

207 
’d


209 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
sourû
 
add»ss
.

210 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

211 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eSrcSŒšg
()

212  
£lf
.
sha
:
	$g‘SŒšg
()

213 
’d


215 --- 
S‘
 
the
 
h¬dw¬e
 
de¡š©iÚ
 
add»ss
.

216 --- @
·¿m
 
addr
 
Add»ss
 
š
 'uniÚ mac_add»ss' 
fÜm©
.

217 
funùiÚ
 
¬pH—d”
:
	$£tH¬dw¬eD¡
(
addr
)

218 
£lf
.
tha
:
	$£t
(
addr
)

219 
’d


221 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
de¡š©iÚ
 
add»ss
.

222 --- @ 
Add»ss
 
š
 'uniÚ mac_add»ss' 
fÜm©
.

223 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eD¡
()

224  
£lf
.
tha
:
	$g‘
()

225 
’d


227 --- 
S‘
 
the
 
h¬dw¬e
 
de¡š©iÚ
 
add»ss
.

228 --- @
·¿m
 
addr
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

229 
funùiÚ
 
¬pH—d”
:
	$£tH¬dw¬eD¡SŒšg
(
addr
)

230 
£lf
.
tha
:
	$£tSŒšg
(
addr
)

231 
’d


233 --- 
R‘r›ve
 
the
 
h¬dw¬e
 
de¡š©iÚ
 
add»ss
.

234 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

235 
funùiÚ
 
¬pH—d”
:
	$g‘H¬dw¬eD¡SŒšg
()

236  
£lf
.
tha
:
	$g‘SŒšg
()

237 
’d


239 --- 
S‘
 
the
 
´ÙocŞ
 
sourû
 
add»ss
.

240 --- @
·¿m
 
addr
 
Add»ss
 
š
 '¡ruù ip4_add»ss' 
fÜm©
.

241 
funùiÚ
 
¬pH—d”
:
	$£tPrÙoSrc
(
addr
)

242 
£lf
.
¥a
:
	$£t
(
addr
)

243 
’d


245 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
sourû
 
add»ss
.

246 --- @ 
Add»ss
 
š
 '¡ruù ip4_add»ss' 
fÜm©
.

247 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoSrc
()

248  
£lf
.
¥a
:
	$g‘
()

249 
’d


251 --- 
S‘
 
the
 
´ÙocŞ
 
sourû
 
add»ss
.

252 --- @
·¿m
 
addr
 
Add»ss
 
š
 
sourû
 
fÜm©
.

253 
funùiÚ
 
¬pH—d”
:
	$£tPrÙoSrcSŒšg
(
addr
)

254 
£lf
.
¥a
:
	$£tSŒšg
(
addr
)

255 
’d


257 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
sourû
 
add»ss
.

258 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

259 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoSrcSŒšg
()

260  
£lf
.
¥a
:
	$g‘SŒšg
()

261 
’d


263 --- 
S‘
 
the
 
´ÙocŞ
 
de¡š©iÚ
 
add»ss
.

264 --- @
·¿m
 
addr
 
Add»ss
 
š
 '¡ruù ip4_add»ss' 
fÜm©
.

265 
funùiÚ
 
¬pH—d”
:
	$£tPrÙoD¡
(
addr
)

266 
£lf
.
a
:
	$£t
(
addr
)

267 
’d


269 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
de¡š©iÚ
 
add»ss
.

270 --- @ 
Add»ss
 
š
 '¡ruù ip4_add»ss' 
fÜm©
.

271 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoD¡
()

272  
£lf
.
a
:
	$g‘
()

273 
’d


275 --- 
S‘
 
the
 
´ÙocŞ
 
de¡š©iÚ
 
add»ss
.

276 --- @
·¿m
 
addr
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

277 
funùiÚ
 
¬pH—d”
:
	$£tPrÙoD¡SŒšg
(
addr
)

278 
£lf
.
a
:
	$£tSŒšg
(
addr
)

279 
’d


281 --- 
R‘r›ve
 
the
 
´ÙocŞ
 
de¡š©iÚ
 
add»ss
.

282 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

283 
funùiÚ
 
¬pH—d”
:
	$g‘PrÙoD¡SŒšg
()

284  
£lf
.
a
:
	$g‘SŒšg
()

285 
’d


287 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 

 
h—d”
.

288 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

289 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

290 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
H¬dw¬eAdd»ssTy³
, 
PrÙoAdd»ssTy³
, 
H¬dw¬eAdd»ssL’gth
, 
PrÙoAdd»ssL’gth
, 
O³¿tiÚ
, 
H¬dw¬eSrc
, 
H¬dw¬eD¡
, 
PrÙoSrc
, 
PrÙoD¡


291 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'arp'.

292 --- @
code


293 --- 
	`fl
(è--- 
Úly
  
v®ues


294 --- 
fl
{ 
¬pO³¿tiÚ
=2, 
TTL
=100 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	g¬pO³¿tiÚ


295 --- @
’dcode


296 
funùiÚ
 
	g¬pH—d”
:
	$fl
(
¬gs
, 
´e
)

297 
¬gs
 =‡rg 
Ü
 {
	}
}

298 
´e
 =…» 
Ü
 "arp"

300 
£lf
:
£tH¬dw¬eAdd»ssTy³
(
¬gs
[
´e
 .. "HardwareAddressType"])

301 
£lf
:
£tPrÙoAdd»ssTy³
(
¬gs
[
´e
 .. "ProtoAddressType"])

302 
£lf
:
£tH¬dw¬eAdd»ssL’gth
(
¬gs
[
´e
 .. "HardwareAddressLength"])

303 
£lf
:
£tPrÙoAdd»ssL’gth
(
¬gs
[
´e
 .. "ProtoAddressLength"])

304 
£lf
:
£tO³¿tiÚ
(
¬gs
[
´e
 .. "Operation"])

306 
loÿl
 
hwSrc
 = 
´e
 .. "HardwareSrc"

307 
loÿl
 
hwD¡
 = 
´e
 .. "HardwareDst"

308 
loÿl
 
´Src
 = 
´e
 .. "ProtoSrc"

309 
loÿl
 
´D¡
 = 
´e
 .. "ProtoDst"

310 
¬gs
[
hwSrc
] =‡rgs[hwSrc] 
Ü
 "01:02:03:04:05:06"

311 
¬gs
[
hwD¡
] =‡rgs[hwD¡] 
Ü
 "07:08:09:0a:0b:0c"

312 
¬gs
[
´Src
] =‡rgs[´Src] 
Ü
 "0.1.2.3"

313 
¬gs
[
´D¡
] =‡rgs[´D¡] 
Ü
 "4.5.6.7"

315 -- 
some
 
»asÚ
 
the
 
add»ss
 
is
 
š
 'uniÚ mac_add»ss'/'uniÚ ipv4_add»ss' 
fÜm©
, 
cİe
 
w™h
 
™


316 
ty³
(
¬gs
[
hwSrc
]è=ğ"¡ršg" 
th’


317 
£lf
:
	$£tH¬dw¬eSrcSŒšg
(
¬gs
[
hwSrc
])

319 
£lf
:
	$£tH¬dw¬eSrc
(
¬gs
[
hwSrc
])

320 
’d


321 
	`ty³
(
¬gs
[
hwD¡
]è=ğ"¡ršg" 
th’


322 
£lf
:
	$£tH¬dw¬eD¡SŒšg
(
¬gs
[
hwD¡
])

324 
£lf
:
	$£tH¬dw¬eD¡
(
¬gs
[
hwD¡
])

325 
’d


327 
	`ty³
(
¬gs
[
´Src
]è=ğ"¡ršg" 
th’


328 
£lf
:
	$£tPrÙoSrcSŒšg
(
¬gs
[
´Src
])

330 
£lf
:
	$£tPrÙoSrc
(
¬gs
[
´Src
])

331 
’d


332 
	`ty³
(
¬gs
[
´D¡
]è=ğ"¡ršg" 
th’


333 
£lf
:
	$£tPrÙoD¡SŒšg
(
¬gs
[
´D¡
])

335 
£lf
:
	$£tPrÙoD¡
(
¬gs
[
´D¡
])

336 
’d


337 
’d


339 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

340 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'arp'.

341 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

342 --- @
£e
 
¬pH—d”
:
fl


343 
funùiÚ
 
¬pH—d”
:
	$g‘
(
´e
)

344 
´e
 =…» 
Ü
 "arp"

346 
loÿl
 
¬gs
 = {
	}
}

347 
¬gs
[
´e
 .. "H¬dw¬eAdd»ssTy³"] = 
£lf
:
	$g‘H¬dw¬eAdd»ssTy³
()

348 
¬gs
[
´e
 .. "PrÙoAdd»ssTy³"] = 
£lf
:
	$g‘PrÙoAdd»ssTy³
()

349 
¬gs
[
´e
 .. "H¬dw¬eAdd»ssL’gth"] = 
£lf
:
	$g‘H¬dw¬eAdd»ssL’gth
()

350 
¬gs
[
´e
 .. "PrÙoAdd»ssL’gth"] = 
£lf
:
	$g‘PrÙoAdd»ssL’gth
()

351 
¬gs
[
´e
 .. "O³¿tiÚ"] = 
£lf
:
	$g‘O³¿tiÚ
()

352 
¬gs
[
´e
 .. "H¬dw¬eSrc"] = 
£lf
:
	$g‘H¬dw¬eSrc
()

353 
¬gs
[
´e
 .. "H¬dw¬eD¡"] = 
£lf
:
	$g‘H¬dw¬eD¡
()

354 
¬gs
[
´e
 .. "PrÙoSrc"] = 
£lf
:
	$g‘PrÙoSrc
()

355 
¬gs
[
´e
 .. "PrÙoD¡"] = 
£lf
:
	$g‘PrÙoD¡
()

357  
¬gs


358 
’d


360 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

361 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

362 
funùiÚ
 
¬pH—d”
:
	$g‘SŒšg
()

363 
loÿl
 
¡r
 = "ARP hrd " .. 
£lf
:
	`g‘H¬dw¬eAdd»ssTy³SŒšg
()

364 .. " (hÊ " .. 
£lf
:
	`g‘H¬dw¬eAdd»ssL’gthSŒšg
()

365 .. "è´Ø" .. 
£lf
:
	`g‘PrÙoAdd»ssTy³SŒšg
()

366 .. " (¶À" .. 
£lf
:
	`g‘PrÙoAdd»ssL’gth
(
SŒšg
)

367 .. "èİ " .. 
£lf
:
	$g‘O³¿tiÚSŒšg
()

369 
loÿl
 
İ
 = 
£lf
:
	$g‘O³¿tiÚ
()

370 
İ
 =ğ
¬p
.
OP_REQUEST
 
th’


371 
¡r
 = sŒ .. " who-ha " .. 
£lf
:
	`g‘PrÙoD¡SŒšg
()

372 .. " (" .. 
£lf
:
	`g‘H¬dw¬eD¡SŒšg
()

373 .. "è‹Î " .. 
£lf
:
	`g‘PrÙoSrcSŒšg
()

374 .. " (" .. 
£lf
:
	`g‘H¬dw¬eSrcSŒšg
()

376 
–£if
 
İ
 =ğ
¬p
.
OP_REPLY
 
th’


377 
¡r
 = sŒ .. " " .. 
£lf
:
	`g‘PrÙoSrcSŒšg
()

378 .. " is-© " .. 
£lf
:
	`g‘H¬dw¬eSrcSŒšg
()

379 .. " (fÜ " .. 
£lf
:
	`g‘PrÙoD¡SŒšg
()

380 .. " @ " .. 
£lf
:
	`g‘H¬dw¬eD¡SŒšg
()

383 
¡r
 = sŒ .. " " .. 
£lf
:
	`g‘H¬dw¬eSrcSŒšg
()

384 .. " > " .. 
£lf
:
	`g‘H¬dw¬eD¡SŒšg
()

385 .. " " .. 
£lf
:
	`g‘PrÙoSrcSŒšg
()

386 .. " > " .. 
£lf
:
	$g‘PrÙoD¡SŒšg
()

387 
’d


389  
¡r


390 
’d


394 ---- 
ARP
 
HªdËr
 
Task


397 --- 
ARP
 
bË
 
timeout
 
š
 
£cÚds


398 
loÿl
 
ARP_AGING_TIME
 = 30

400 --- 
A½
 
hªdËr
 
sk
, 
»¥Úds
 
to
 
ARP
 
qu”›s
 
giv’
 
IPs
 
ªd
 
³rfÜms
 
¬p
 
lookups


401 --- @
todo
 
TODO
 
im¶em’t
 
g¬bage
 
cŞËùiÚ
/
»äeshšg
 
’Œ›s
 \
n


402 --- 
the
 
cu¼’t
 
im¶em’tiÚ
 
dÛs
 
nÙ
 
hªdË
 
Ïrge
 
bËs
 
effic›Ály
 \
n


403 
¬p
.
¬pTask
 = "__MG_ARP_TASK"

405 -- 
A½
 
bË


406 
loÿl
 
¬pTabË
 = 
ns
:
	$g‘
()

407 
loÿl
 
pes
 = 
ns
:
	`g‘
()

409 --- 
S¹
 
the
 
ARP
 
sk
 
Ú
 
a
 
sh¬ed
 
cÜe


410 --- @
·¿m
 
queues
 
¬¿y
 
of
 
queue
 
·œs
 
ªd
 
İtiÚs
, 
—ch
‡¼ay 
’Œy
 
has
 
the
 
fŞlowšg
 
fÜm©


411 --- {
rxQueue
 =„xQueue, 
txQueue
 =xQueue, 
s
 = "" | {"", ...}
	}
}

412 --- 
rxQueue
 
is
 
	gİtiÚ®
, 
·ck‘s
 
ÿn
 
®‹º©iv–y
 
be
 
´ovided
 
through
 
the
 
pe
 
	gAPI
, 
£e
 
	g¬p
.
hªdËPack‘
()

413 --- 
	gO±iÚs
:

414 --- 
g¿tA½IÁ”v®
, 
š‹rv®
 
š
 
£cÚds
 iÀ
which
 
the
 
g¿tu™ous
 
is
 
	g»³©ed
.

415 --- 
this
 
ÿn
 
be
 
u£ful
 
š
 
poÜly
 
cÚfigu»d
 
	$ÃtwÜks
 (
MAC
 
timeout
 
vs
 
rou‹r
 
ARP
imeoutè
Ú
 
pÜts
 
th©
 
Ãv”
 
£nd
 
out
 
·ck‘s
 
exû±
 ARP

416 
funùiÚ
 
¬p
.
	$¡¬tA½Task
(
queues
)

417 
¬pTabË
.
¡İTask
 = 
n


418 
libmoÚ
.
	$¡¬tSh¬edTask
(
¬p
.
¬pTask
, 
queues
)

419 
’d


421 
funùiÚ
 
¬p
.
	$¡İA½Task
()

422 
¬pTabË
.
¡İTask
 = 
Œue


423 
’d


425 
loÿl
 
funùiÚ
 
	$hªdËA½Pack‘
(
rxBufs
, 
txBufs
, 
nic
, 
ToMac
)

426 
loÿl
 
rxPkt
 = 
rxBufs
[1]:
	$g‘A½Pack‘
()

427 
rxPkt
.
‘h
:
	`g‘Ty³
(è=ğ‘h.
TYPE_ARP
 
th’


428 
rxPkt
.
¬p
:
	`g‘O³¿tiÚ
(è=ğ¬p.
OP_REQUEST
 
th’


429 
loÿl
 

 = 
rxPkt
.
¬p
:
	$g‘PrÙoD¡
()

430 
loÿl
 
mac
 = 
ToMac
[

]

431 
mac
 
th’


432 
txBufs
:
	`®loc
(60)

433 -- 
TODO
: 
a
 
sšgË
-
·ck‘
 
API
 
would
 
be
 
niû
 
thšgs
 
like
 
this


434 
loÿl
 
pkt
 = 
txBufs
[1]:
	$g‘A½Pack‘
()

435 
pkt
.
‘h
:
	$£tSrcSŒšg
(
mac
)

436 
pkt
.
‘h
:
	`£tD¡
(
rxPkt
.‘h:
	$g‘Src
())

437 
pkt
.
¬p
:
	$£tO³¿tiÚ
(
¬p
.
OP_REPLY
)

438 
pkt
.
¬p
:
	`£tH¬dw¬eD¡
(
rxPkt
.¬p:
	$g‘H¬dw¬eSrc
())

439 
pkt
.
¬p
:
	$£tH¬dw¬eSrcSŒšg
(
mac
)

440 
pkt
.
¬p
:
	`£tPrÙoD¡
(
rxPkt
.¬p:
	$g‘PrÙoSrc
())

441 
pkt
.
¬p
:
	$£tPrÙoSrc
(

)

442 
nic
.
txQueue
:
	$£nd
(
txBufs
)

443 
’d


444 
–£if
 
rxPkt
.
¬p
:
	`g‘O³¿tiÚ
(è=ğ¬p.
OP_REPLY
 
th’


445 -- 
Ë¬n
 
äom
 
®l
 
¬p
 
»¶›s
 
we
 
	$£e
 (
yes
, 
th©
 
makes
 
¬p
 
ÿche
 
poisÚšg
 
—sy
)

446 
loÿl
 
mac
 = 
rxPkt
.
¬p
:
	$g‘H¬dw¬eSrcSŒšg
()

447 
loÿl
 

 = 
rxPkt
.
¬p
:
	$g‘PrÙoSrcSŒšg
()

448 
¬pTabË
[
	`to¡ršg
(
	`·r£IPAdd»ss
(

))] = {

449 
¡©e
 = "current",

450 
mac
 = mac,

451 
time¡amp
 = 
	`time
(),

452 
upd©eTime
 = 
	`time
()

453 
	}
}

454 
’d


455 
’d


456 
	grxBufs
:
	$ä“AÎ
()

457 
’d


459 
loÿl
 
funùiÚ
 
	`¬pTask
(
qs
)

460 -- 
two
 
ways
 
to
 
ÿÎ
 
this
: 
sšgË
 
nic
 
Ü
 
¬¿y
 
of
 
nics


461 
qs
[1] =ğ
n
 
ªd
 qs.
txQueue
 
th’


462  
	`¬pTask
({ 
qs
 
	}
})

463 
’d


465 
loÿl
 
ToMac
 = {}

466 -- 
loİ
 
ov”
 
NICs
/
Queues


467 
i
, 
nic
 
š
 
	$aœs
(
qs
) do

468 
nic
.
rxQueue
 
ªd
‚ic.
txQueue
.
id
 ~ğnic.rxQueue.id 
th’


469 
	`”rÜ
("both queues must belongohe same device")

470 
’d


472 
	`ty³
(
nic
.
s
è=ğ"¡ršg" 
th’


473 
nic
.
s
 = {‚ic. 
	}
}

474 
’d


476 
ToMac
[
to¡ršg
(
i
)] = {}

477 
_
, 

 
š
 
	$·œs
(
nic
.
s
) do

478 
ToMac
[
	`to¡ršg
(
i
)][
	`·r£IPAdd»ss
(

)] = 
nic
.
txQueue
.
dev
:
	$g‘MacSŒšg
()

479 
’d


480 
nic
.
rxQueue
 
th’


481 
nic
.
txQueue
.
dev
:
	$l2F‹r
(
‘h
.
TYPE_ARP
, 
nic
.
rxQueue
)

482 
’d


483 
loÿl
 
pe
 =…e:
	$ÃwFa¡Pe
()

484 
nic
.
pe
 =…ipe

485 
pes
[
	`to¡ršg
(
i
)] = 
pe


486 
’d


488 
loÿl
 
rxBufs
 = 
memÜy
.
	$ü—‹BufA¼ay
(1)

489 
loÿl
 
txMem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

490 
buf
:
	$g‘A½Pack‘
():
fl
{

491 
¬pO³¿tiÚ
 = 
¬p
.
OP_REPLY
,

492 
pktL’gth
 = 60

493 
	}
}

494 
	g’d
)

495 
loÿl
 
	gtxBufs
 = 
txMem
:
	$bufA¼ay
(1)

497 
¬pTabË
.
skRuÂšg
 = 
Œue


499 
loÿl
 
g¿tA½Tim”
 = 
tim”
:
	$Ãw
(0)

500 
libmoÚ
.
	$ruÂšg
(è
ªd
 
nÙ
 
¬pTabË
.
¡İTask
 do

501 -- 
£nd
 
out
 
g¿tu™ous
 
¬p


502 
g¿tA½Tim”
:
	$expœed
(è
th’


503 
g¿tA½Tim”
:
	$»£t
(
qs
.
g¿tA½IÁ”v®
 
Ü
 
m©h
.
huge
)

504 
_
, 
nic
 
š
 
	$aœs
(
qs
) do

505 
txBufs
:
	$®loc
(60)

506 
loÿl
 
pkt
 = 
txBufs
[1]:
	$g‘A½Pack‘
()

507 
pkt
.
‘h
:
	$£tD¡SŒšg
(
‘h
.
BROADCAST
)

508 
loÿl
 
mac
 = 
nic
.
txQueue
.
dev
:
	$g‘MacSŒšg
()

509 
pkt
.
‘h
:
	$£tSrcSŒšg
(
mac
)

510 
pkt
.
¬p
:
	$£tO³¿tiÚ
(
¬p
.
OP_REQUEST
)

511 
pkt
.
¬p
:
	$£tH¬dw¬eD¡SŒšg
(
‘h
.
BROADCAST
)

512 
pkt
.
¬p
:
	`£tPrÙoD¡
(
	$·r£IPAdd»ss
(
nic
.
s
[1]))

513 
pkt
.
¬p
:
	`£tPrÙoSrc
(
	$·r£IPAdd»ss
(
nic
.
s
[1]))

514 
pkt
.
¬p
:
	$£tH¬dw¬eSrcSŒšg
(
mac
)

515 
nic
.
txQueue
:
	$£nd
(
txBufs
)

516 
’d


517 
’d


518 
i
, 
nic
 
š
 
	$aœs
(
qs
) do

519 
nic
.
rxQueue
 
th’


520 
rx
 = 
nic
.
rxQueue
:
	$ŒyRecvIdË
(
rxBufs
, 1000)

521 
	`as£¹
(
rx
 <= 1)

522 
rx
 > 0 
th’


523 
	`hªdËA½Pack‘
(
rxBufs
, 
txBufs
, 
nic
, 
ToMac
[
	`to¡ršg
(
i
)])

524 
’d


525 
’d


526 
loÿl
 
pkt
 = 
nic
.
pe
:
	$ŒyRecv
(100)

527 
pkt
 
th’


528 
rxBufs
[1] = 
pkt


529 
	`hªdËA½Pack‘
(
rxBufs
, 
txBufs
, 
nic
, 
ToMac
[
	`to¡ršg
(
i
)])

530 
’d


531 
’d


533 
loÿl
 
timedOutEÁr›s
 = {
	}
}

534 -- 
£nd
 
»que¡s


535 
¬pTabË
:
fÜEach
(
	$funùiÚ
(

, 
v®ue
)

536 
loÿl
 
ts
 = 
	$time
()

537 
	`ty³
(
v®ue
è~ğ"bË" 
th’


539 
’d


540 -- 
cu¼’t
 
ªd
 
upd©ed
 
Ëss
 
thª
 
ARP_AGING_TIME
 
ago


541 
v®ue
.
¡©e
 =ğ"cu¼’t" 
ªd
 v®ue.
time¡amp
 + 
ARP_AGING_TIME
 > 
ts
 
th’


543 
’d


544 -- 
»que¡ed
 
Ëss
 
thª
 
a
 
£cÚd
 
ago


545 ià(
v®ue
.
¡©e
 =ğ"»que¡ed" 
Ü
 v®ue.¡©=ğ"»äeshšg"è
ªd
 v®ue.
time¡amp
 + 1 > 
ts
 
th’


547 
’d


548 -- 
didn
't get‡„esponse while„efreshing

549 
v®ue
.
¡©e
 =ğ"»äeshšg" 
ªd
 v®ue.
lookupTime
 + 
ARP_AGING_TIME
 < 
ts
 
th’


550 
bË
.
	$š£¹
(
timedOutEÁr›s
, 

)

552 
’d


553 -- 
didn
't get‡„eponse,ƒver

554 
v®ue
.
¡©e
 =ğ"»que¡ed" 
ªd
 v®ue.
lookupTime
 + 
ARP_AGING_TIME
 < 
ts
 
th’


555 
bË
.
	$š£¹
(
timedOutEÁr›s
, 

)

557 
’d


558 
v®ue
.
¡©e
 =ğ"cu¼’t" 
th’


559 
v®ue
.
¡©e
 = "refreshing"

560 
v®ue
.
lookupTime
 = 
ts


561 
’d


562 
v®ue
.
¡©e
 =ğ"³ndšg" 
th’


563 
v®ue
.
¡©e
 = "requested"

564 
v®ue
.
lookupTime
 = 
ts


565 
’d


566 
v®ue
.
time¡amp
 = 
ts


567 
¬pTabË
[

] = 
v®ue


568 

 = 
	$tÚumb”
(

)

569 
_
, 
nic
 
š
 
	$aœs
(
qs
) do

570 -- 
TODO
: dØ
nÙ
 
£nd
 
»que¡s
 
Ú
 
®l
 
deviûs
, 
but
 
Úly
 
the
 
»Ëvªt


571 
txBufs
:
	$®loc
(60)

572 
loÿl
 
pkt
 = 
txBufs
[1]:
	$g‘A½Pack‘
()

573 
pkt
.
‘h
:
	$£tD¡SŒšg
(
‘h
.
BROADCAST
)

574 
pkt
.
¬p
:
	$£tO³¿tiÚ
(
¬p
.
OP_REQUEST
)

575 
pkt
.
¬p
:
	$£tH¬dw¬eD¡SŒšg
(
‘h
.
BROADCAST
)

576 
pkt
.
¬p
:
	$£tPrÙoD¡
(

)

577 
loÿl
 
mac
 = 
nic
.
txQueue
.
dev
:
	$g‘MacSŒšg
()

578 
pkt
.
‘h
:
	$£tSrcSŒšg
(
mac
)

579 
pkt
.
¬p
:
	`£tPrÙoSrc
(
	$·r£IPAdd»ss
(
nic
.
s
[1]))

580 
pkt
.
¬p
:
	$£tH¬dw¬eSrcSŒšg
(
mac
)

581 
nic
.
txQueue
:
	$£nd
(
txBufs
)

582 
’d


583 
’d
)

584 
_
, 

 
š
 
	$aœs
(
timedOutEÁr›s
) do

585 
¬pTabË
[

] = 
n


586 
’d


587 
libmoÚ
.
	$¦“pMlisIdË
(1)

588 
’d


589 
¬pTabË
.
skRuÂšg
 = 
n


590 
’d


592 --- 
S’d
 
a
 
buf
 
cÚššg
 
ª
 
ARP
 
·ck‘
 
to
 
the
 ARP 
sk
.

593 --- 
The
 
buf
 
is
 
ä“
'd byhe ARPask, do‚ot freehis (or increase„ef count if you still‚eedhe buf).

594 --- @
·¿m
 
buf
 
the
 
¬p
 
·ck‘


595 --- @
·¿m
 
nic
 
the
 
ID
 
of
h
NIC
 
äom
 
which
h
·ckt
 
was
 
»ûived
, 
deçuÉs
 
to
 1

596 --- 
cÜ»¥Úds
 
to
 
the
 
šdex
 
š
h
queue
 
¬¿y
 
·s£d
Øth
¬p
 
sk


597 
funùiÚ
 
¬p
.
	$hªdËPack‘
(
buf
, 
nic
)

598 
nic
 =‚iø
Ü
 1

599 
loÿl
 
pe
 = 
pes
[
	`to¡ršg
(
nic
)]

600 
nÙ
 
pe
 
th’


601 
log
:
	`çl
("NIC % nÙ found", 
nic
)

602 
’d


603 
pe
:
	$£nd
(
buf
)

604 
’d


606 --- 
P”fÜm
 
a
 
nÚ
-
blockšg
 
lookup
 
š
 
the
 
ARP
 
bË
.

607 --- 
Lookup
 
the
 
MAC
 
add»ss
 
a
 
giv’
 
IP
.

608 --- 
Blocks
 
up
 
to
 1 
£cÚd
 
the
 
¬p
 
sk
 
is
 
nÙ
 
y‘
 
ruÂšg


609 --- 
CautiÚ
: 
this
 
funùiÚ
 
u£s
 
locks
 
ªd
 
Çme¥aûs
, 
mu¡
 
nÙ
 
be
 
u£d
 
š
 
the
 
ç¡
 
·th


610 --- @
·¿m
 

 
The
 i°
add»ss
 
š
 
¡ršg
 
Ü
 
cd©a
 
fÜm©
 
to
 
look
 
up
.

611 
funùiÚ
 
¬p
.
	$lookup
(

)

612 
	`ty³
(

è=ğ"¡ršg" 
th’


613 

 = 
	$·r£IPAdd»ss
(

)

614 
–£if
 
	`ty³
(

è=ğ"cd©a" 
th’


615 

 = ip:
	$g‘
()

616 
’d


617 
nÙ
 
¬pTabË
.
skRuÂšg
 
th’


618 
loÿl
 
wa™FÜA½Task
 = 0

619 
nÙ
 
¬pTabË
.
skRuÂšg
 
ªd
 
wa™FÜA½Task
 < 10 do

620 
libmoÚ
.
	$¦“pMlis
(100)

621 
wa™FÜA½Task
 = waitForArpTask + 1

622 
’d


623 
nÙ
 
¬pTabË
.
skRuÂšg
 
th’


624 
	`”rÜ
("ARPask is‚ot„unning")

625 
’d


626 
’d


627 
loÿl
 
mac
 = 
¬pTabË
[
	`to¡ršg
(

)]

628 
	`ty³
(
mac
è=ğ"bË" 
th’


629  
mac
.mac, mac.
upd©eTime


630 
’d


631 
¬pTabË
.
	`lock
(
	$funùiÚ
()

632 
nÙ
 
¬pTabË
[
	`to¡ršg
(

)] 
th’


633 
¬pTabË
[
	`to¡ršg
(

)] = {
¡©e
 = "³ndšg", 
time¡amp
 = 
	`time
()
	}
}

634 
’d


635 
	g’d
)

636  
n


637 
	g’d


639 --- 
P”fÜm
 
a
 
blockšg
 
lookup
 
š
 
the
 
ARP
 
	gbË
.

640 --- @
·¿m
 

 
The
 i°
add»ss
 
š
 
¡ršg
 
Ü
 
cd©a
 
fÜm©
 
to
 
look
 
	gup
.

641 --- @
·¿m
 
timeout
imeouˆ
š
 
£cÚds


642 
funùiÚ
 
	g¬p
.
	$blockšgLookup
(

, 
timeout
)

643 
loÿl
 
timeout
 = 
libmoÚ
.
	`g‘Time
() +imeout

644 
»³©


645 
loÿl
 
mac
, 
ts
 = 
¬p
.
	$lookup
(

)

646 
mac
 
th’


647  
mac
, 
ts


648 
’d


649 
libmoÚ
.
	$¦“pMlisIdË
(1000)

650 
uÁ
 
libmoÚ
.
	`g‘Time
(è>ğ
timeout
 
Ü
 
nÙ
†ibmoÚ.
	$ruÂšg
()

651 
’d


653 
funùiÚ
 
¬p
.
	$wa™FÜS¹up
()

654 
nÙ
 
¬pTabË
.
skRuÂšg
 
ªd
 
libmoÚ
.
	$ruÂšg
() do

655 
libmoÚ
.
	$¦“pMlisIdË
(1)

656 
’d


657 
’d


659 
__MG_ARP_TASK
 = 
¬pTask


663 ---- 
M‘©y³s


666 
¬p
.
m‘©y³
 = 
¬pH—d”


668  
¬p


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/dns.lua

2 --- @
fe
 
	gdns
.
	glua


3 --- @
	$br›f
 (
dns
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
dns_h—d”
 
¡ruùs


5 --- - 
dns
 
cÚ¡ªts


6 --- - 
dns
 
h—d”
 
ut™y


7 --- - 
Defš™iÚ
 
of
 
dns
 
·ck‘s


9 --- 
	$Cİyright
 (
c
è
SªtŸgo
 
R
.R. <
§ÁŸgo
.
ruªo
-
ršcÚ
@
‹Ëcom
-
b»gÃ
.
eu
>

13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "proto.template"

15 
loÿl
 
š™H—d”
 = initHeader

17 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

18 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
ğ
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

20 
»quœe
 "math"

23 ---- 
dns
 
cÚ¡ªts


26 --- 
dns
 
´ÙocŞ
 
cÚ¡ªts


27 
loÿl
 
dns
 = {
	}
}

31 ---- 
dns
 
h—d”


35 --[[ 
From
 
the
 
RFC
 1035, 
h‰ps
:

37 
The
 
h—d”
 
cÚšs
 
the
 
fŞlowšg
 
f›lds
:

42 | 
ID
 |

44 |
QR
| 
Opcode
 |
AA
|
TC
|
RD
|
RA
| 
Z
 | 
RCODE
 |

46 | 
QDCOUNT
 |

48 | 
ANCOUNT
 |

50 | 
NSCOUNT
 |

52 | 
ARCOUNT
 |

55 
wh”e
:

57 
ID
 
A
 16 
b™
 
id’tif›r
 
assigÃd
 
by
 
the
 
´og¿m
 
th©


58 
g’”©es
 
ªy
 
kšd
 
of
 
qu”y
. 
This
 
id’tif›r
 
is
 
cİ›d


59 
the
 
cÜ»¥Údšg
 
»¶y
 
ªd
 
ÿn
 
be
 
u£d
 
by
h
»que¡”


60 
to
 
m©ch
 
up
 
»¶›s
Ø
out¡ªdšg
 
qu”›s
.

62 
QR
 
A
 
Úe
 
b™
 
f›ld
 
th©
 
¥ecif›s
 
wh‘h”
 
this
 
mes§ge
 
is
 
a


63 
qu”y
 (0), 
Ü
 
a
 
»¥Ú£
 (1).

65 
OPCODE
 
A
 
four
 
b™
 
f›ld
 
th©
 
¥ecif›s
 
kšd
 
of
 
qu”y
 
š
 
this


66 
mes§ge
. 
This
 
v®ue
 
is
 
£t
 
by
 
the
 
Üigš©Ü
 
of
 
a
 
qu”y


67 
ªd
 
cİ›d
 
što
 
the
 
»¥Ú£
. 
The
 
v®ues
 
¬e
:

69 0 
a
 
¡ªd¬d
 
qu”y
 (
QUERY
)

71 1 
ª
 
šv”£
 
qu”y
 (
IQUERY
)

73 2 
a
 
£rv”
 
¡©us
 
»que¡
 (
STATUS
)

75 3-15 
»£rved
 
futu»
 
u£


77 
AA
 
AuthÜ™©ive
 
Answ”
 - 
this
 
b™
 
is
 
v®id
 
š
 
»¥Ú£s
,

78 
ªd
 
¥ecif›s
 
th©
 
the
 
»¥Údšg
 
Çme
 
£rv”
 
is
 
ª


79 
authÜ™y
 
the
 
domaš
 
Çme
 
š
 
que¡iÚ
 
£ùiÚ
.

81 
NÙe
 
th©
 
the
 
cÚ‹Ás
 
of
h
ªsw”
 
£ùiÚ
 
may
 
have


82 
muÉË
 
owÃr
 
Çmes
 
beÿu£
 
of
 
®Ÿ£s
. 
The
 
AA
 
b™


83 
cÜ»¥Úds
 
to
 
the
 
Çme
 
which
 
m©ches
h
qu”y
‚ame, 
Ü


84 
the
 
fœ¡
 
owÃr
 
Çme
 
š
h
ªsw”
 
£ùiÚ
.

86 
TC
 
TrunC©iÚ
 - 
¥ecif›s
 
th©
 
this
 
mes§ge
 
was
 
Œunÿ‹d


87 
due
 
to
 
Ëngth
 
g»©”
 
thª
 
th©
 
³rm™‹d
 
Ú
 
the


88 
ŒªsmissiÚ
 
chªÃl
.

90 
RD
 
RecursiÚ
 
Desœed
 - 
this
 
b™
 
may
 
be
 
£t
 
š
 
a
 
qu”y
 
ªd


91 
is
 
cİ›d
 
što
 
the
 
»¥Ú£
. 
If
 
RD
 i 
£t
, 
™
 
dœeùs


92 
the
 
Çme
 
£rv”
 
to
 
pursue
h
qu”y
 
»cursiv–y
.

93 
Recursive
 
qu”y
 
suµÜt
 
is
 
İtiÚ®
.

95 
RA
 
RecursiÚ
 
AvaabË
 - 
this
 
be
 
is
 
£t
 
Ü
 
ş—»d
 
š
 
a


96 
»¥Ú£
, 
ªd
 
d’Ùes
 
wh‘h”
 
»cursive
 
qu”y
 
suµÜt
 
is


97 
avaabË
 
š
 
the
 
Çme
 
£rv”
.

99 
Z
 
Re£rved
 
futu»
 
u£
. 
Mu¡
 
be
 
z”o
 
š
 
®l
 
qu”›s


100 
ªd
 
»¥Ú£s
.

102 
RCODE
 
Re¥Ú£
 
code
 - 
this
 4 
b™
 
f›ld
 
is
 
£t
 
as
 
·¹
 
of


103 
»¥Ú£s
. 
The
 
v®ues
 
have
 
the
 
fŞlowšg


104 
š‹½»tiÚ
:

106 0 
No
 
”rÜ
 
cÚd™iÚ


108 1 
FÜm©
 
”rÜ
 - 
The
 
Çme
 
£rv”
 
was


109 
uÇbË
 
to
 
š‹½»t
 
the
 
qu”y
.

111 2 
S”v”
 
çu»
 - 
The
 
Çme
 
£rv”
 
was


112 
uÇbË
 
to
 
´oûss
 
this
 
qu”y
 
due
Ø
a


113 
´obËm
 
w™h
 
the
 
Çme
 
£rv”
.

115 3 
Name
 
E¼Ü
 - 
M—nšgful
 
Úly
 

116 
»¥Ú£s
 
äom
 
ª
 
authÜ™©ive
 
Çme


117 
£rv”
, 
this
 
code
 
signif›s
 
th©
 
the


118 
domaš
 
Çme
 
»ã»nûd
 
š
 
the
 
qu”y
 
dÛs


119 
nÙ
 
exi¡
.

121 4 
NÙ
 
Im¶em’‹d
 - 
The
 
Çme
 
£rv”
 
dÛs


122 
nÙ
 
suµÜt
 
the
 
»que¡ed
 
kšd
 
of
 
qu”y
.

124 5 
Refu£d
 - 
The
 
Çme
 
£rv”
 
»fu£s
 
to


125 
³rfÜm
 
the
 
¥ecif›d
 
İ”©iÚ
 

126 
pŞicy
 
»asÚs
. 
FÜ
 
exam¶e
, 
a
 
Çme


127 
£rv”
 
may
 
nÙ
 
wish
 
to
 
´ovide
 
the


128 
šfÜm©iÚ
 
to
 
the
 
·¹icuÏr
 
»que¡”
,

129 
Ü
 
a
 
Çme
 
£rv”
 
may
 
nÙ
 
wish
 
to
 
³rfÜm


130 
a
 
·¹icuÏr
 
	$İ”©iÚ
 (
e
.
g
., 
zÚe


131 
Œªsãr
è
·¹icuÏr
 
d©a
.

133 6-15 
Re£rved
 
futu»
 
u£
.

135 
QDCOUNT
 
ª
 16 
b™
 
š‹g”
 
¥ecifyšg
 
the
 
numb”
 
of


136 
’Œ›s
 
š
 
the
 
que¡iÚ
 
£ùiÚ
.

138 
ANCOUNT
 
ª
 16 
b™
 
š‹g”
 
¥ecifyšg
 
the
 
numb”
 
of


139 
»sourû
 
»cÜds
 
š
 
the
 
ªsw”
 
£ùiÚ
.

141 
NSCOUNT
 
ª
 16 
b™
 
š‹g”
 
¥ecifyšg
 
the
 
numb”
 
of
 
Çme


142 
£rv”
 
»sourû
 
»cÜds
 
š
 
the
 
authÜ™y
„ecords

143 
£ùiÚ
.

145 
ARCOUNT
 
ª
 16 
b™
 
š‹g”
 
¥ecifyšg
 
the
 
numb”
 
of


146 
»sourû
 
»cÜds
 
š
 
the
 
add™iÚ®
„ecÜd 
£ùiÚ
.

149 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


150 
dns
.
h—d”FÜm©
 = [[

151 
ušt16_t
 
id
;

152 
ušt16_t
 
hdræags
;

153 
ušt16_t
 
qdcouÁ
;

154 
ušt16_t
 
ªcouÁ
;

155 
ušt16_t
 
nscouÁ
;

156 
ušt16_t
 
¬couÁ
;

157 
ušt8_t
 
body
[];

160 --- 
V¬ŸbË
 
sized
 
memb”


161 
dns
.
h—d”V¬ŸbËMemb”
 = 
body


163 
loÿl
 
dnsH—d”
 = 
	$š™H—d”
()

164 
dnsH—d”
.
__šdex
 = dnsHeader

166 --- 
S‘
 
the
 
qu”y
 
id
.

167 --- @
·¿m
 
Id
 
of
 
the
 
dns
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

168 
funùiÚ
 
dnsH—d”
:
	$£tId
()

169 ğ
Ü
 
m©h
.
	$¿ndom
(10000,65335)

170 
£lf
.
id
 = 
	$htÚ16
()

171 
’d


173 --- 
R‘r›ve
 
the
 
id
.

174 --- @ 
the
 
qu»y
 
id
 
as
 
a
 
b™
 
š‹g”
.

175 
funùiÚ
 
dnsH—d”
:
	$g‘Id
()

176  
	$htÚ16
(
£lf
.
id
)

177 
’d


179 --- 
R‘r›ve
 
the
 
id
 
as
 
¡ršg
.

180 --- @ 
the
 
qu»y
 
id
 
as
 
¡ršg
.

181 
funùiÚ
 
dnsH—d”
:
	$g‘IdSŒšg
()

182  
£lf
:
	$g‘Id
()

183 
’d


185 --- 
S‘
 
Que¡iÚ
/
Re¥Ú£
 
b™
:

186 --- 0 
Que¡iÚ
, 1 = 
Answ”
.

187 
funùiÚ
 
dnsH—d”
:
	$£tQR
()

188 
£lf
.
hdræags
 = 
	$bÜ
(
£lf
.
hdræags
, 0x8000)

189 
’d


191 --- 
Un£t
 
Que¡iÚ
/
Re¥Ú£
 
b™
:

192 --- 0 
Que¡iÚ
, 1 = 
Answ”
.

193 
funùiÚ
 
dnsH—d”
:
	$un£tQR
()

194 
£lf
.
hdræags
 = 
	$bªd
(
£lf
.
hdræags
, 0x7FFF)

195 
’d


197 --- 
R‘r›ve
 
the
 
QR
.

198 --- @ 
QR
 
as
 1 
b™
 
š‹g”
.

199 
funùiÚ
 
dnsH—d”
:
	$g‘QR
()

200  
	`rshiá
(
	`bªd
(
£lf
.
hdræags
, 0x8000), 1)

201 
’d


203 --- 
R‘r›ve
 
the
 
QR
 
as
 
¡ršg
.

204 --- @ 
QR
 
as
 
¡ršg
.

205 
funùiÚ
 
dnsH—d”
:
	$g‘QRSŒšg
()

206 
£lf
:
	`g‘QR
(è=ğ1 
th’


210 
’d


211 
’d


213 --- 
S‘
 
the
 
OPCode
: 
Kšd
 
of
 
qu”y
.

214 --- 0 
a
 
¡ªd¬d
 
	`qu”y
 (
QUERY
)

215 --- 1 
ª
 
šv”£
 
	`qu”y
 (
IQUERY
)

216 --- 2 
a
 
£rv”
 
¡©us
 
	`»que¡
 (
STATUS
)

217 --- 3-15 
»£rved
 
futu»
 
u£


218 --- @
·¿m
 
OPCode
 
of
 
the
 
dns
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

219 
funùiÚ
 
dnsH—d”
:
	$£tOPCode
()

220 ğ
Ü
 0

221 >ğ0 
ªd
 <ğ15 
th’


222 
İcode
 = 

224 --- 
X0000XXX
 
XXXXXXXX


225 
İcode
 = 
	$lshiá
(
İcode
,11)

226 
£lf
.
hdræags
 = 
	$bÜ
(
£lf
.
hdræags
, 
İcode
)

227 
’d


228 -- 
TODO
: 
hªdË
 
šv®id
 
¬gs


229 
’d


231 --- 
R‘r›ve
 
the
 
OPCode
.

232 --- @ 
OPCode
 
as
 
A
 
b™
 
š‹g”
.

233 
funùiÚ
 
dnsH—d”
:
	$g‘OPCode
()

234 
»s
 = 
	`rshiá
(
	`bªd
(
£lf
.
hdræags
, 0x7800), 11)

235  
»s


236 
’d


238 --- 
R‘r›ve
 
the
 
OPCode
 
as
 
¡ršg
.

239 --- @ 
OPCode
 
as
 
¡ršg
.

240 
funùiÚ
 
dnsH—d”
:
	$g‘OPCodeSŒšg
()

241 
İcode
 = 
£lf
.
g‘OPCode


242 
İcode
 =ğ0 
th’


244 
–£if
 
İcode
 =ğ1 
th’


246 
–£if
 
İcode
 =ğ2 
th’


250 
’d


251 
’d


253 --- 
S‘
 
AuthÜ™©ive
 
ªsw”
 
b™
:

254 
funùiÚ
 
dnsH—d”
:
	$£tAA
()

255 
£lf
.
hdræags
 = 
	$bÜ
(
£lf
.
hdræags
, 0x0400)

256 
’d


258 --- 
Un£t
 
AuthÜ™©ive
 
ªsw”
 
b™
:

259 
funùiÚ
 
dnsH—d”
:
	$un£tAA
()

260 
£lf
.
hdræags
 = 
	$bªd
(
£lf
.
hdræags
, 0xFBFF)

261 
’d


263 --- 
R‘r›ve
 
the
 
AA
.

264 --- @ 
AA
 
as
 1 
b™
 
š‹g”
.

265 
funùiÚ
 
dnsH—d”
:
	$g‘AA
()

266  
	`rshiá
(
	`bªd
(
£lf
.
hdræags
, 0x0400), 1)

267 
’d


269 --- 
R‘r›ve
 
the
 
AA
 
as
 
¡ršg
.

270 --- @ 
AA
 
as
 
¡ršg
.

271 
funùiÚ
 
dnsH—d”
:
	$g‘AASŒšg
()

272 
£lf
:
	`g‘AA
(è=ğ1 
th’


276 
’d


277 
’d


279 --- 
S‘
 
Trunÿ‹d
 
mes§ge


280 
funùiÚ
 
dnsH—d”
:
	$£tTC
()

281 
£lf
.
hdræags
 = 
	$bÜ
(
£lf
.
hdræags
, 0x0200)

282 
’d


284 --- 
Un£t
 
Trunÿ‹d
 
mes§ge
 
b™
:

285 
funùiÚ
 
dnsH—d”
:
	$un£tTC
()

286 
£lf
.
hdræags
 = 
	$bªd
(
£lf
.
hdræags
, 0xFDFF)

287 
’d


289 --- 
R‘r›ve
 
the
 
TA
.

290 --- @ 
TA
 
as
 1 
b™
 
š‹g”
.

291 
funùiÚ
 
dnsH—d”
:
	$g‘TC
()

292  
	`rshiá
(
	`bªd
(
£lf
.
hdræags
, 0x0200), 1)

293 
’d


295 --- 
R‘r›ve
 
the
 
TA
 
as
 
¡ršg
.

296 --- @ 
TA
 
as
 
¡ršg
.

297 
funùiÚ
 
dnsH—d”
:
	$g‘TCSŒšg
()

298 
£lf
:
	`g‘TC
(è=ğ1 
th’


302 
’d


303 
’d


305 --- 
S‘
 
RecursiÚ
 
Desœed


306 
funùiÚ
 
dnsH—d”
:
	$£tRD
()

307 
£lf
.
hdræags
 = 
	$bÜ
(
£lf
.
hdræags
, 0x0100)

308 
’d


310 --- 
Un£t
 
RecursiÚ
 
Desœed
 
b™
:

311 
funùiÚ
 
dnsH—d”
:
	$un£tRD
()

312 
£lf
.
hdræags
 = 
	$bªd
(
£lf
.
hdræags
, 0xFEFF)

313 
’d


315 --- 
R‘r›ve
 
the
 
RD
.

316 --- @ 
RD
 
as
 1 
b™
 
š‹g”
.

317 
funùiÚ
 
dnsH—d”
:
	$g‘RD
()

318  
	`rshiá
(
	`bªd
(
£lf
.
hdræags
, 0x0100), 1)

319 
’d


321 --- 
R‘r›ve
 
the
 
RD
 
as
 
¡ršg
.

322 --- @ 
RD
 
as
 
¡ršg
.

323 
funùiÚ
 
dnsH—d”
:
	$g‘RDSŒšg
()

324 
£lf
:
	`g‘RD
(è=ğ1 
th’


328 
’d


329 
’d


331 --- 
S‘
 
RecursiÚ
 
AvaabË


332 
funùiÚ
 
dnsH—d”
:
	$£tRA
()

333 
£lf
.
hdræags
 = 
	$bÜ
(
£lf
.
hdræags
, 0x0080)

334 
’d


336 --- 
Un£t
 
RecursiÚ
 
AvaabË
 
b™
:

337 
funùiÚ
 
dnsH—d”
:
	$un£tRA
()

338 
£lf
.
hdræags
 = 
	$bªd
(
£lf
.
hdræags
, 0xFF7F)

339 
’d


341 --- 
R‘r›ve
 
the
 
RA
.

342 --- @ 
RA
 
as
 1 
b™
 
š‹g”
.

343 
funùiÚ
 
dnsH—d”
:
	$g‘RA
()

344  
	`rshiá
(
	`bªd
(
£lf
.
hdræags
, 0x0080), 1)

345 
’d


347 --- 
R‘r›ve
 
the
 
RA
 
as
 
¡ršg
.

348 --- @ 
RA
 
as
 
¡ršg
.

349 
funùiÚ
 
dnsH—d”
:
	$g‘RASŒšg
()

350 
£lf
:
	`g‘RA
(è=ğ1 
th’


354 
’d


355 
’d


357 --- 
S‘
 
the
 4-
b™
 
Re¥Ú£
 
code


358 --- 0 
No
 
”rÜ
 
cÚd™iÚ


359 --- 1 
FÜm©
 
”rÜ


360 --- 2 
S”v”
 
çu»


361 --- 3 
Name
 
E¼Ü


362 --- 4 
NÙ
 
Im¶em’‹d


363 --- 5 
Refu£d


364 --- 6-15 
Re£rved
 
futu»
 
u£
.

365 --- @
·¿m
 
RCode
 
of
 
the
 
dns
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

366 
funùiÚ
 
dnsH—d”
:
	$£tRCode
()

367 ğ
Ü
 0

368 >ğ0 
ªd
 <ğ15 
th’


369 
rcode
 = 

371 --- 
XXXXXXXX
 
XXXX0000


372 
£lf
.
hdræags
 = 
	$bÜ
(
£lf
.
hdræags
, 
rcode
)

373 
’d


374 -- 
TODO
: 
hªdË
 
šv®id
 
¬gs


375 
’d


377 --- 
R‘r›ve
 
the
 
RCode
.

378 --- @ 
RCode
 
as
 
A
 
b™
 
š‹g”
.

379 
funùiÚ
 
dnsH—d”
:
	$g‘RCode
()

380 
»s
 = 
	$bªd
(
£lf
.
hdræags
, 0x000F)

381  
»s


382 
’d


384 --- 
R‘r›ve
 
the
 
RCode
 
as
 
¡ršg
.

385 --- @ 
RCode
 
as
 
¡ršg
.

386 
funùiÚ
 
dnsH—d”
:
	$g‘RCodeSŒšg
()

387 
rcode
 = 
£lf
.
g‘RCode


388 
rcode
 =ğ0 
th’


390 
–£if
 
rcode
 =ğ1 
th’


392 
–£if
 
rcode
 =ğ2 
th’


394 
–£if
 
rcode
 =ğ3 
th’


396 
–£if
 
rcode
 =ğ4 
th’


398 
–£if
 
rcode
 =ğ5 
th’


402 
’d


403 
’d


406 --- 
S‘
 
the
 
QDCouÁ
.

407 --- @
·¿m
 
QDCouÁ
 
of
 
the
 
dns
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

408 
funùiÚ
 
dnsH—d”
:
	$£tQDCouÁ
()

409 ğ
Ü
 0

410 
£lf
.
qdcouÁ
 = 
	$htÚ16
()

411 
’d


413 --- 
R‘r›ve
 
the
 
QDCouÁ
.

414 --- @ 
QDCouÁ
 
as
 
A
 
b™
 
š‹g”
.

415 
funùiÚ
 
dnsH—d”
:
	$g‘QDCouÁ
()

416  
	$htÚ16
(
£lf
.
qdcouÁ
)

417 
’d


419 --- 
R‘r›ve
 
the
 
QDCouÁ
 
as
 
¡ršg
.

420 --- @ 
QDCouÁ
 
as
 
¡ršg
.

421 
funùiÚ
 
dnsH—d”
:
	$g‘QDCouÁSŒšg
()

422  
£lf
:
	$g‘QDCouÁ
()

423 
’d


425 --- 
S‘
 
the
 
ANCouÁ
.

426 --- @
·¿m
 
ANCouÁ
 
of
 
the
 
dns
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

427 
funùiÚ
 
dnsH—d”
:
	$£tANCouÁ
()

428 ğ
Ü
 0

429 
£lf
.
ªcouÁ
 = 
	$htÚ16
()

430 
’d


432 --- 
R‘r›ve
 
the
 
ANCouÁ
.

433 --- @ 
ANCouÁ
 
as
 
A
 
b™
 
š‹g”
.

434 
funùiÚ
 
dnsH—d”
:
	$g‘ANCouÁ
()

435  
	$htÚ16
(
£lf
.
ªcouÁ
)

436 
’d


438 --- 
R‘r›ve
 
the
 
ANCouÁ
 
as
 
¡ršg
.

439 --- @ 
ANCouÁ
 
as
 
¡ršg
.

440 
funùiÚ
 
dnsH—d”
:
	$g‘ANCouÁSŒšg
()

441  
£lf
:
	$g‘ANCouÁ
()

442 
’d


445 --- 
S‘
 
the
 
NSCouÁ
.

446 --- @
·¿m
 
NSCouÁ
 
of
 
the
 
dns
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

447 
funùiÚ
 
dnsH—d”
:
	$£tNSCouÁ
()

448 ğ
Ü
 0

449 
£lf
.
nscouÁ
 = 
	$htÚ16
()

450 
’d


452 --- 
R‘r›ve
 
the
 
NSCouÁ
.

453 --- @ 
NSCouÁ
 
as
 
A
 
b™
 
š‹g”
.

454 
funùiÚ
 
dnsH—d”
:
	$g‘NSCouÁ
()

455  
	$htÚ16
(
£lf
.
nscouÁ
)

456 
’d


458 --- 
R‘r›ve
 
the
 
NSCouÁ
 
as
 
¡ršg
.

459 --- @ 
NSCouÁ
 
as
 
¡ršg
.

460 
funùiÚ
 
dnsH—d”
:
	$g‘NSCouÁSŒšg
()

461  
£lf
:
	$g‘NSCouÁ
()

462 
’d


465 --- 
S‘
 
the
 
ARCouÁ
.

466 --- @
·¿m
 
ARCouÁ
 
of
 
the
 
dns
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

467 
funùiÚ
 
dnsH—d”
:
	$£tARCouÁ
()

468 ğ
Ü
 0

469 
£lf
.
¬couÁ
 = 
	$htÚ16
()

470 
’d


472 --- 
R‘r›ve
 
the
 
ARCouÁ
.

473 --- @ 
ARCouÁ
 
as
 
A
 
b™
 
š‹g”
.

474 
funùiÚ
 
dnsH—d”
:
	$g‘ARCouÁ
()

475  
	$htÚ16
(
£lf
.
¬couÁ
)

476 
’d


478 --- 
R‘r›ve
 
the
 
ARCouÁ
 
as
 
¡ršg
.

479 --- @ 
ARCouÁ
 
as
 
¡ršg
.

480 
funùiÚ
 
dnsH—d”
:
	$g‘ARCouÁSŒšg
()

481  
£lf
:
	$g‘ARCouÁ
()

482 
’d


484 --- 
S‘
 
the
 
D©a
 th
»maššg
 
£ùiÚs
 
š
h
DNS
 
Mes§ge
.

485 --
funùiÚ
 
dnsH—d”
:
	$£tMes§geCÚ‹Á
(...)

486 
funùiÚ
 
dnsH—d”
:
	$£tMes§geCÚ‹Á
(...)

487 
loÿl
 
¬gs
 = {...
	}
}

488 
ty³
(
¬gs
[1]è=ğ"bË" 
th’


489 
£lf
.
body
 = 
¬gs
[1]

490 
–£if
 
ty³
(
¬gs
[1]è=ğ"funùiÚ" 
th’


491 
func
 = 
¬gs
[1]

492 
£lf
.
body
 = 
	$func
()

493 
’d


494 
’d


496 --- 
R‘r›ve
 
the
 
Qu”yBody
.

497 --- @ 
Qu”yBody
 
as
 
b™
 
š‹g”
 
¬¿y
?.

498 
funùiÚ
 
dnsH—d”
:
	`g‘Mes§geCÚ‹Á
()

499 -- 
TODO
 
im¶em’t
!

500  
£lf
.
body


501 
’d


503 --- 
R‘r›ve
 
the
 
Qu”yBody
 
as
 
¡ršg
.

504 --- @ 
Qu”yBody
 
as
 
¡ršg
.

505 
funùiÚ
 
dnsH—d”
:
	$g‘Mes§geCÚ‹ÁSŒšg
()

506  
£lf
:
	$g‘Mes§geCÚ‹Á
()

507 
’d


510 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
dns
 
h—d”
.

511 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

512 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

513 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
dnsXYZ


514 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'dns'.

515 --- @
code


516 --- 
	`fl
(è-- 
Úly
  
v®ues


517 --- 
fl
{ 
dnsXYZ
=1 
	}
} -- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 dnsXYZ, ...

518 --- @
’dcode


519 
funùiÚ
 
	gdnsH—d”
:
	$fl
(
¬gs
, 
´e
)

520 
¬gs
 =‡rg 
Ü
 {
	}
}

521 
´e
 =…» 
Ü
 "dns"

523 
£lf
:
£tId
(
¬gs
[
´e
 .. "Id"])

524 
¬gs
[
´e
 .. "Re¥"] 
ªd
‡rgs[´.. "Re¥"] ~ğ0 
th’


525 
£lf
:
	$£tQR
()

526 
’d


527 
£lf
:
	`£tOPCode
(
¬gs
[
´e
 .. "QueryType"])

528 
¬gs
[
´e
 .. "AuthAnsw”"] 
ªd
‡rgs[´.. "AuthAnsw”"] ~ğ0 
th’


529 
£lf
:
	$£tAA
()

530 
’d


531 
¬gs
[
´e
 .. "Trunÿ‹d"] 
ªd
‡rgs[´.. "Trunÿ‹d"] ~ğ0 
th’


532 
£lf
:
	$£tTC
()

533 
’d


534 
¬gs
[
´e
 .. "RecDesœed"] 
ªd
‡rgs[´.. "RecDesœed"] ~ğ0 
th’


535 
£lf
:
	$£tRD
()

536 
’d


537 
¬gs
[
´e
 .. "RecAvaabË"] 
ªd
‡rgs[´.. "RecAvaabË"] ~ğ0 
th’


538 
£lf
:
	$£tRA
()

539 
’d


540 
£lf
:
	`£tRCode
(
¬gs
[
´e
 .. "RCode"])

541 
£lf
.
hdræags
 = 
	$htÚ16
(
£lf
.
hdræags
)

542 
£lf
:
	`£tQDCouÁ
(
¬gs
[
´e
 .. "QDCount"])

543 
£lf
:
	`£tANCouÁ
(
¬gs
[
´e
 .. "ANCount"])

544 
£lf
:
	`£tNSCouÁ
(
¬gs
[
´e
 .. "NSCount"])

545 
£lf
:
	`£tARCouÁ
(
¬gs
[
´e
 .. "ARCount"])

546 
£lf
:
	`£tMes§geCÚ‹Á
(
¬gs
[
´e
 .."MessageContent"])

547 
’d


549 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

550 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'dns'.

551 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

552 --- @
£e
 
dnsH—d”
:
fl


553 
funùiÚ
 
dnsH—d”
:
	$g‘
(
´e
)

554 
´e
 =…» 
Ü
 "dns"

556 
¬gs
[
´e
 .. "Id"] = 
£lf
:
	$g‘Id
()

557 
¬gs
[
´e
 .. "Re¥"] = 
£lf
:
	$g‘QR
()

558 
¬gs
[
´e
 .. "Qu”yTy³"] = 
£lf
:
	$g‘OPCode
()

559 
¬gs
[
´e
 .. "AuthÜ™©iveAnsw”"] = 
£lf
:
	$g‘AA
()

560 
¬gs
[
´e
 .. "TrunÿtiÚ"] = 
£lf
:
	$g‘TC
()

561 
¬gs
[
´e
 .. "RecursiÚDesœed"] = 
£lf
:
	$g‘RD
()

562 
¬gs
[
´e
 .. "RecursiÚAvaabË"] = 
£lf
:
	$g‘RA
()

563 
¬gs
[
´e
 .. "RCode"] = 
£lf
:
	$g‘RCode
()

564 
¬gs
[
´e
 .. "QDCouÁ"] = 
£lf
:
	$g‘QDCouÁ
()

565 
¬gs
[
´e
 .. "ANCouÁ"] = 
£lf
:
	$g‘ANCouÁ
()

566 
¬gs
[
´e
 .. "NSCouÁ"] = 
£lf
:
	$g‘NSCouÁ
()

567 
¬gs
[
´e
 .. "ARCouÁ"] = 
£lf
:
	$g‘ARCouÁ
()

568 
¬gs
[
´e
 .. "Mes§geCÚ‹Á"] = 
£lf
:
	`g‘Mes§geCÚ‹Á
()

571 -- 
TODO
: 
™
 
would
 
be
 
niû
 
to
 
im¶’‘
 
funùiÚ
Ø
dœeùly
 
g‘


572 -- 
cÚ‹Á
 
som‘hšg
 
like
:

573 
¬gs
[
´e
 .. "Qu”ySeùiÚ" ] = 
£lf
:
	$g‘Qu”ySeùiÚ
()

574 
¬gs
[
´e
 .. "Answ”SeùiÚ" ] = 
£lf
:
	$g‘Answ”SeùiÚ
()

575 
¬gs
[
´e
 .. "AuthÜ™©iveNSSeùiÚ" ] = 
£lf
:
	$g‘NSSeùiÚ
()

576 
¬gs
[
´e
 .. "Add™iÚ®RRSeùiÚ" ] = 
£lf
:
	`g‘ARSeùiÚ
()

578  
¬gs


579 
’d


581 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

582 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

583 
funùiÚ
 
dnsH—d”
:
	$g‘SŒšg
()

585 .. " T¿n§tiÚ ID: " .. 
£lf
:
	`g‘IdSŒšg
()

586 .. " Re¥Ú£/Qu”y: " .. 
£lf
:
	`g‘QRSŒšg
()

587 .. " Kšd oàqu”y: " .. 
£lf
:
	`g‘OPCodeSŒšg
()

588 .. " AuthÜ™©ivAnsw”: " .. 
£lf
:
	`g‘AASŒšg
()

589 .. " Trunÿ‹d mes§ge: " .. 
£lf
:
	`g‘TCSŒšg
()

590 .. " RecursiÚ desœed: " .. 
£lf
:
	`g‘RDSŒšg
()

591 .. " RecursiÚ‡vaabË: " .. 
£lf
:
	`g‘RASŒšg
()

592 .. " Re¥Ú£ Code: " .. 
£lf
:
	`g‘RCodeSŒšg
()

593 .. " QDCouÁ: " .. 
£lf
:
	`g‘QDCouÁSŒšg
()

594 .. " ANCouÁ: " .. 
£lf
:
	`g‘ANCouÁSŒšg
()

595 .. " NSCouÁ: " .. 
£lf
:
	`g‘NSCouÁSŒšg
()

596 .. " ARCouÁ: " .. 
£lf
:
	`g‘ARCouÁSŒšg
()

597 .. " Mes§geCÚ‹Á: " .. 
£lf
:
	$g‘Mes§geCÚ‹ÁSŒšg
()

598 
’d


602 ---- 
M‘©y³s


605 
dns
.
m‘©y³
 = 
dnsH—d”


607  
dns


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/esp.lua

2 --- @
fe
 
	ge¥
.
	glua


3 --- @
br›f
 
ESP
 
	gut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
e¥_h—d”
 
	g¡ruùs


5 --- 
	gInşudes
:

6 --- - 
ESP
 
cÚ¡ªts


7 --- - 
IP£c
 
IV


8 --- - 
ESP
 
h—d”
 
ut™y


9 --- - 
Defš™iÚ
 
of
 
e¥
 
·ck‘s


12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

13 
»quœe
 "proto.template"

14 
loÿl
 
š™H—d”
 = initHeader

15 
loÿl
 
m©h
 = 
»quœe
 "math"

19 ---- 
e¥
 
cÚ¡ªts


22 
loÿl
 
e¥
 = {}

25 ---- 
IP£c
 
IV


29 
ffi
.
cdef
[[

30 
	u£c_iv
 {

31 
ušt32_t
 
ušt32
[2];

35 
loÿl
 
	g£cIV
 = {}

36 
£cIV
.
__šdex
 = ipsecIV

37 
loÿl
 
£cIVTy³
 = 
ffi
.
ty³of
("union ipsec_iv")

39 --- 
S‘
 
the
 
IP£c
 
IV
.

40 --- @
·¿m
 
iv
 
IP£c
 
IV
 
š
 'uniÚ ip£c_iv' 
fÜm©
.

41 
funùiÚ
 
£cIV
:
	$£t
(
iv
)

42 
loÿl
 
¿ndom_iv
 = 
ffi
.
	`Ãw
("union ipsec_iv")

43 
¿ndom_iv
.
ušt32
[0] = 
m©h
.
	`¿ndom
(0, 2^32-1)

44 
¿ndom_iv
.
ušt32
[1] = 
m©h
.
	`¿ndom
(0, 2^32-1)

46 
loÿl
 
iv
 = iv 
Ü
 
¿ndom_iv


47 
£lf
.
ušt32
[0] = 
	$htÚ
(
iv
.
ušt32
[1])

48 
£lf
.
ušt32
[1] = 
	$htÚ
(
iv
.
ušt32
[0])

49 
’d


51 --- 
R‘r›ve
 
the
 
IP£c
 
IV
.

52 --- @ 
IV
 
š
 'uniÚ ip£c_iv' 
fÜm©
.

53 
funùiÚ
 
£cIV
:
	$g‘
()

54 
loÿl
 
iv
 = 
	$£cIVTy³
()

55 
iv
.
ušt32
[0] = 
	$htÚ
(
£lf
.
ušt32
[1])

56 
iv
.
ušt32
[1] = 
	$htÚ
(
£lf
.
ušt32
[0])

57  
iv


58 
’d


60 --- 
G‘
 
the
 
IP£c
 
IV
 
as
 
¡ršg
.

61 --- @
·¿m
 
iv
 
IP£c
 
IV
 
š
 
¡ršg
 
fÜm©
.

62 
funùiÚ
 
£cIV
:
	$g‘SŒšg
(
doBy‹Sw­
)

63 
doBy‹Sw­
 = doBy‹Sw­ 
Ü
 
çl£


64 
doBy‹Sw­
 
th’


65 
£lf
 = s–f:
	$g‘
()

66 
’d


68  ("0x%08x%08x"):
	$fÜm©
(
£lf
.
ušt32
[1], self.uint32[0])

69 
’d


72 ---- 
e¥
 
h—d”


75 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


76 
e¥
.
h—d”FÜm©
 = [[

77 
ušt32_t
 
¥i
;

78 
ušt32_t
 
sqn
;

79 
£c_iv
 
iv
;

82 --- 
V¬ŸbË
 
sized
 
memb”


83 
e¥
.
h—d”V¬ŸbËMemb”
 = 
n


85 
loÿl
 
e¥H—d”
 = 
	$š™H—d”
()

86 
e¥H—d”
.
__šdex
 =ƒspHeader

88 --- 
S‘
 
the
 
SPI
.

89 --- @
·¿m
 
SPI
 
of
 
the
 
e¥
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

90 
funùiÚ
 
e¥H—d”
:
	$£tSPI
()

91 ğ
Ü
 0

92 
£lf
.
¥i
 = 
	$htÚ
()

93 
’d


95 --- 
R‘r›ve
 
the
 
SPI
.

96 --- @ 
SPI
 
as
 
A
 
b™
 
š‹g”
.

97 
funùiÚ
 
e¥H—d”
:
	$g‘SPI
()

98  
	$htÚ
(
£lf
.
¥i
)

99 
’d


101 --- 
R‘r›ve
 
the
 
SPI
 
as
 
¡ršg
.

102 --- @ 
SPI
 
as
 
¡ršg
.

103 
funùiÚ
 
e¥H—d”
:
	$g‘SPISŒšg
()

104  ("0x%08x"):
	$fÜm©
(
£lf
.
¥i
)

105 
’d


107 --- 
S‘
 
the
 
SQN
.

108 --- @
·¿m
 
SQN
 
of
 
the
 
e¥
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

109 
funùiÚ
 
e¥H—d”
:
	$£tSQN
()

110 ğ
Ü
 0

111 
£lf
.
sqn
 = 
	$htÚ
()

112 
’d


114 --- 
R‘r›ve
 
the
 
SQN
.

115 --- @ 
SQN
 
as
 
A
 
b™
 
š‹g”
.

116 
funùiÚ
 
e¥H—d”
:
	$g‘SQN
()

117  
	$htÚ
(
£lf
.
sqn
)

118 
’d


120 --- 
R‘r›ve
 
the
 
SQN
 
as
 
¡ršg
.

121 --- @ 
SQN
 
as
 
¡ršg
.

122 
funùiÚ
 
e¥H—d”
:
	$g‘SQNSŒšg
()

123  
£lf
:
	$g‘SQN
()

124 
’d


126 --- 
S‘
 
the
 
IV
.

127 --- @
·¿m
 
IV
 
of
 
the
 
e¥
 
h—d”
 
as
 'union ipsec_iv'.

128 
funùiÚ
 
e¥H—d”
:
	$£tIV
(
iv
)

129 
£lf
.
iv
:
	$£t
(
iv
)

130 
’d


132 --- 
R‘r›ve
 
the
 
IV
.

133 --- @ 
SPI
 
as
 'union ipsec_iv'.

134 
funùiÚ
 
e¥H—d”
:
	$g‘IV
()

135  
£lf
.
iv
:
	$g‘
()

136 
’d


138 --- 
R‘r›ve
 
the
 
IV
 
as
 
¡ršg
.

139 --- @ 
IV
 
as
 
¡ršg
.

140 
funùiÚ
 
e¥H—d”
:
	$g‘IVSŒšg
()

141  
£lf
.
iv
:
	$g‘SŒšg
(
Œue
)

142 
’d


144 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
e¥
 
h—d”
.

145 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

146 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

147 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
e¥SPI
, 
e¥SQN


148 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'esp'.

149 --- @
u§ge
 
	`fl
(è-- 
Úly
  
v®ues


150 --- @
u§ge
 
fl
{ 
e¥XYZ
=1 
	}
} -- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	ge¥XYZ
, ...

151 
funùiÚ
 
	ge¥H—d”
:
	$fl
(
¬gs
, 
´e
)

152 
¬gs
 =‡rg 
Ü
 {
	}
}

153 
´e
 =…» 
Ü
 "esp"

155 
£lf
:
£tSPI
(
¬gs
[
´e
 .. "SPI"])

156 
£lf
:
£tSQN
(
¬gs
[
´e
 .. "SQN"])

157 
£lf
:
£tIV
(
¬gs
[
´e
 .. "IV"])

158 
’d


160 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

161 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'esp'.

162 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

163 --- @
£e
 
e¥H—d”
:
fl


164 
funùiÚ
 
e¥H—d”
:
	$g‘
(
´e
)

165 
´e
 =…» 
Ü
 "esp"

167 
loÿl
 
¬gs
 = {
	}
}

168 
¬gs
[
´e
 .. "SPI"] = 
£lf
:
	$g‘SPI
()

169 
¬gs
[
´e
 .. "SQN"] = 
£lf
:
	$g‘SQN
()

170 
¬gs
[
´e
 .. "IV"] = 
£lf
:
	$g‘IV
()

172  
¬gs


173 
’d


175 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

176 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

177 
funùiÚ
 
e¥H—d”
:
	`g‘SŒšg
()

178 --
TODO
: 
add
 
d©a
 
äom
 
ESP
 
Œa”


179  "ESP sp˜" .. 
£lf
:
	`g‘SPISŒšg
(è.. " sqÀ" .. s–f:
	`g‘SQNSŒšg
(è.. " iv " .. s–f:
	$g‘IVSŒšg
()

180 
’d


184 ---- 
M‘©y³s


187 
ffi
.
	`m‘©y³
("uniÚ ip£c_iv", 
£cIV
)

188 
e¥
.
m‘©y³
 = 
e¥H—d”


191  
e¥


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ethernet.lua

2 --- @
fe
 
	g‘h”Ãt
.
	glua


3 --- @
br›f
 
Eth”Ãt
 
´ÙocŞ
 
	gut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
mac_add»ss
 
ªd
 
‘h”Ãt_h—d”
 
	g¡ruùs


5 --- 
	gInşudes
:

6 --- - 
Eth”Ãt
 
cÚ¡ªts


7 --- - 
Mac
 
add»ss
 
ut™y


8 --- - 
Eth”Ãt
 
h—d”
 
ut™y


9 --- - 
Defš™iÚ
 
of
 
‘h”Ãt
 
·ck‘s


12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "utils"

15 
»quœe
 "proto.template"

16 
loÿl
 
š™H—d”
 = initHeader

18 
loÿl
 
Áoh
, 
	ghtÚ
 =‚toh, 
htÚ


19 
loÿl
 
	gÁoh16
, 
	ghtÚ16
 = 
Áoh16
, 
htÚ16


20 
loÿl
 
	gbÜ
, 
	gbªd
, 
	gbnÙ
, 
	grshiá
, 
	glshiá
ğ
b™
.
bÜ
, 
	gb™
.bªd, b™.bnÙ, b™.rshiá, b™.
lshiá


21 
loÿl
 
	gi¡y³
 = 
ffi
.
i¡y³


22 
loÿl
 
fÜm©
 = 
¡ršg
.format

25 ---- 
Eth”Ãt
 
cÚ¡ªts


28 --- 
Eth”Ãt
 
´ÙocŞ
 
cÚ¡ªts


29 
loÿl
 
‘h
 = {}

31 --- 
Eth”Ty³
 
IP4


32 
‘h
.
TYPE_IP
 = 0x0800

33 --- 
Eth”Ty³
 
A½


34 
‘h
.
TYPE_ARP
 = 0x0806

35 --- 
Eth”Ty³
 
IP6


36 
‘h
.
TYPE_IP6
 = 0x86dd

37 --- 
Eth”Ty³
 
P


38 
‘h
.
TYPE_PTP
 = 0x88f7

40 
‘h
.
TYPE_8021Q
 = 0x8100

42 --- 
Eth”Ty³
 
LACP
 (
Aùu®ly
, 'Slow Protocols')

43 
	g‘h
.
	gTYPE_LACP
 = 0x8809

45 --- 
S³cŸl
 
add»s£s


46 --- 
Eth”Ãt
 
brßdÿ¡
 
add»ss


47 
‘h
.
BROADCAST
 = "ff:ff:ff:ff:ff:ff"

48 --- 
Inv®id
 
nuÎ
 
add»ss


49 
‘h
.
NULL
 = "00:00:00:00:00:00"

53 ---- 
Mac
 
add»s£s


57 
ffi
.
cdef
[[

58 
__©Œibu‹__
((
__·cked__
)è
mac_add»ss
 {

59 
ušt8_t
 
ušt8
[6];

60 
ušt64_t
 
	gušt64
[0];

64 --- 
ModuË
 
mac_add»ss
 

65 
loÿl
 
	gmacAddr
 = {}

66 
macAddr
.
__šdex
 = macAddr

67 
loÿl
 
macAddrTy³
 = 
ffi
.
ty³of
("union mac_address")

69 --- 
R‘r›ve
 
the
 
MAC
 
add»ss
.

70 --- @ 
Add»ss
 
as
 
numb”


71 
funùiÚ
 
macAddr
:
	$g‘
()

72  
	`tÚumb”
(
b™
.
	$bªd
(
£lf
.
ušt64
[0], 0xFFFFFFFFFFFFULL))

73 
’d


75 --- 
S‘
 
the
 
MAC
 
add»ss
.

76 --- @
·¿m
 
addr
 
Add»ss
 
as
 
numb”


77 
funùiÚ
 
macAddr
:
	$£t
(
addr
)

78 
addr
 =‡dd¸
Ü
 0

79 
£lf
.
ušt8
[0] = 
b™
.
	$bªd
(
addr
, 0xFF)

80 
£lf
.
ušt8
[1] = 
b™
.
	`bªd
(b™.
	`rshiá
(
addr
, 8), 0xFF)

81 
£lf
.
ušt8
[2] = 
b™
.
	`bªd
(b™.
	`rshiá
(
addr
, 16), 0xFF)

82 
£lf
.
ušt8
[3] = 
b™
.
	`bªd
(b™.
	`rshiá
(
addr
, 24), 0xFF)

83 
£lf
.
ušt8
[4] = 
b™
.
	`bªd
(b™.
	`rshiá
(
addr
 + 0ULL, 32ULL), 0xFF)

84 
£lf
.
ušt8
[5] = 
b™
.
	`bªd
(b™.
	`rshiá
(
addr
 + 0ULL, 40ULL), 0xFF)

85 
’d


87 --- 
S‘
 
the
 
MAC
 
add»ss
.

88 --- @
·¿m
 
mac
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

89 
funùiÚ
 
macAddr
:
	$£tSŒšg
(
mac
)

90 
£lf
:
	`£t
(
	$·r£MacAdd»ss
(
mac
, 
Œue
))

91 
’d


93 --- 
Te¡
 
equ®™y
 
of
 
two
 
MAC
 
add»s£s
.

94 --- @
·¿m
 
lhs
 
Add»ss
 
š
 'uniÚ mac_add»ss' 
fÜm©
.

95 --- @
·¿m
 
rhs
 
Add»ss
 
š
 'uniÚ mac_add»ss' 
fÜm©
.

96 --- @ 
Œue
 
equ®
, 
çl£
 
Ùh”wi£
.

97 
funùiÚ
 
macAddr
.
	$__eq
(
lhs
, 
rhs
)

98 
loÿl
 
isMAC
 = 
	$i¡y³
(
macAddrTy³
, 
lhs
è
ªd
 
	$i¡y³
(
macAddrTy³
, 
rhs
)

99 
i
 = 0, 5 do

100 
isMAC
 = isMAC 
ªd
 
lhs
.
ušt8
[
i
] =ğ
rhs
.uint8[i]

101 
’d


102  
isMAC


103 
’d


105 --- 
R‘r›ve
 
the
 
¡ršg
 
»´e£Á©iÚ
 
of
 
a
 
MAC
 
add»ss
.

106 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

107 
funùiÚ
 
macAddr
:
	$g‘SŒšg
()

108  ("%02x:%02x:%02x:%02x:%02x:%02x"):
	$fÜm©
(

109 
£lf
.
ušt8
[0], self.uint8[1], self.uint8[2],

110 
£lf
.
ušt8
[3], self.uint8[4], self.uint8[5]

112 
’d


116 ---- 
Eth”Ãt
 
h—d”


119 
‘h
. = {
	}
}

120 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


121 
‘h
..
h—d”FÜm©
 = [[

122 
mac_add»ss
 
d¡
;

123 
mac_add»ss
 
¤c
;

124 
ušt16_t
 
ty³
;

127 --- 
V¬ŸbË
 
sized
 
memb”


128 
	g‘h
..
	gh—d”V¬ŸbËMemb”
 = 
n


130 
‘h
.
vÏn
 = {}

131 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


132 
‘h
.
vÏn
.
h—d”FÜm©
 = [[

133 
mac_add»ss
 
d¡
;

134 
mac_add»ss
 
¤c
;

135 
ušt16_t
 
vÏn_id
;

136 
ušt16_t
 
vÏn_g
;

137 
ušt16_t
 
ty³
;

140 --- 
V¬ŸbË
 
sized
 
memb”


141 
	g‘h
.
	gvÏn
.
	gh—d”V¬ŸbËMemb”
 = 
n


143 
‘h
.
qšq
 = {}

144 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


145 
‘h
.
qšq
.
h—d”FÜm©
 = [[

146 
mac_add»ss
 
d¡
;

147 
mac_add»ss
 
¤c
;

148 
ušt16_t
 
ou‹r_vÏn_id
;

149 
ušt16_t
 
ou‹r_vÏn_g
;

150 
ušt16_t
 
šÃr_vÏn_id
;

151 
ušt16_t
 
šÃr_vÏn_g
;

152 
ušt16_t
 
ty³
;

155 --- 
V¬ŸbË
 
sized
 
memb”


156 
	g‘h
.
	gqšq
.
	gh—d”V¬ŸbËMemb”
 = 
n


158 
‘h
.
deçuÉTy³
 = "default"

160 --- 
ModuË
 
‘h”Ãt_h—d”
 

161 
loÿl
 
‘h”H—d”
 = 
	$š™H—d”
()

162 
loÿl
 
‘h”VÏnH—d”
 = 
	$š™H—d”
()

163 
loÿl
 
‘h”QšQH—d”
 = 
	$š™H—d”
()

164 
‘h”H—d”
.
__šdex
 =ƒtherHeader

165 
‘h”VÏnH—d”
.
__šdex
 =ƒtherVlanHeader

166 
‘h”QšQH—d”
.
__šdex
 =ƒtherQinQHeader

168 --- 
S‘
 
the
 
de¡š©iÚ
 
MAC
 
add»ss
.

169 --- @
·¿m
 
addr
 
Add»ss
 
as
 
numb”


170 
funùiÚ
 
‘h”H—d”
:
	$£tD¡
(
addr
)

171 
£lf
.
d¡
:
	$£t
(
addr
)

172 
’d


174 
‘h”VÏnH—d”
.
£tD¡
 = 
‘h”H—d”
.setDst

175 
‘h”QšQH—d”
.
£tD¡
 = 
‘h”H—d”
.setDst

177 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
MAC
 
add»ss
.

178 --- @ 
Add»ss
 
as
 
numb”


179 
funùiÚ
 
‘h”H—d”
:
	$g‘D¡
(
addr
)

180  
£lf
.
d¡
:
	$g‘
()

181 
’d


183 
‘h”VÏnH—d”
.
g‘D¡
 = 
‘h”H—d”
.getDst

184 
‘h”QšQH—d”
.
g‘D¡
 = 
‘h”H—d”
.getDst

186 --- 
S‘
 
the
 
sourû
 
MAC
 
add»ss
.

187 --- @
·¿m
 
addr
 
Add»ss
 
as
 
numb”


188 
funùiÚ
 
‘h”H—d”
:
	$£tSrc
(
addr
)

189 
£lf
.
¤c
:
	$£t
(
addr
)

190 
’d


192 
‘h”VÏnH—d”
.
£tSrc
 = 
‘h”H—d”
.setSrc

193 
‘h”QšQH—d”
.
£tSrc
 = 
‘h”H—d”
.setSrc

195 --- 
R‘r›ve
 
the
 
sourû
 
MAC
 
add»ss
.

196 --- @ 
Add»ss
 
as
 
numb”


197 
funùiÚ
 
‘h”H—d”
:
	$g‘Src
(
addr
)

198  
£lf
.
¤c
:
	$g‘
()

199 
’d


201 
‘h”VÏnH—d”
.
g‘Src
 = 
‘h”H—d”
.getSrc

202 
‘h”QšQH—d”
.
g‘Src
 = 
‘h”H—d”
.getSrc

204 --- 
S‘
 
the
 
de¡š©iÚ
 
MAC
 
add»ss
.

205 --- @
·¿m
 
¡r
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

206 
funùiÚ
 
‘h”H—d”
:
	$£tD¡SŒšg
(
¡r
)

207 
£lf
.
d¡
:
	$£tSŒšg
(
¡r
)

208 
’d


210 
‘h”VÏnH—d”
.
£tD¡SŒšg
 = 
‘h”H—d”
.setDstString

211 
‘h”QšQH—d”
.
£tD¡SŒšg
 = 
‘h”H—d”
.setDstString

213 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
MAC
 
add»ss
.

214 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

215 
funùiÚ
 
‘h”H—d”
:
	$g‘D¡SŒšg
()

216  
£lf
.
d¡
:
	$g‘SŒšg
()

217 
’d


219 
‘h”VÏnH—d”
.
g‘D¡SŒšg
 = 
‘h”H—d”
.getDstString

220 
‘h”QšQH—d”
.
g‘D¡SŒšg
 = 
‘h”H—d”
.getDstString

222 --- 
S‘
 
the
 
sourû
 
MAC
 
add»ss
.

223 --- @
·¿m
 
¡r
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

224 
funùiÚ
 
‘h”H—d”
:
	$£tSrcSŒšg
(
¡r
)

225 
£lf
.
¤c
:
	$£tSŒšg
(
¡r
)

226 
’d


228 
‘h”VÏnH—d”
.
£tSrcSŒšg
 = 
‘h”H—d”
.setSrcString

229 
‘h”QšQH—d”
.
£tSrcSŒšg
 = 
‘h”H—d”
.setSrcString

231 --- 
R‘r›ve
 
the
 
sourû
 
MAC
 
add»ss
.

232 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

233 
funùiÚ
 
‘h”H—d”
:
	$g‘SrcSŒšg
()

234  
£lf
.
¤c
:
	$g‘SŒšg
()

235 
’d


237 
‘h”VÏnH—d”
.
g‘SrcSŒšg
 = 
‘h”H—d”
.getSrcString

238 
‘h”QšQH—d”
.
g‘SrcSŒšg
 = 
‘h”H—d”
.getSrcString

240 --- 
S‘
 
the
 
Eth”Ty³
.

241 --- @
·¿m
 
Eth”Ty³
 
as
 16 
b™
 
š‹g”
.

242 
funùiÚ
 
‘h”H—d”
:
	$£tTy³
()

243 ğ
Ü
 
‘h
.
TYPE_IP


244 
£lf
.
ty³
 = 
	$htÚ16
()

245 
’d


247 
‘h”VÏnH—d”
.
£tTy³
 = 
‘h”H—d”
.setType

248 
‘h”QšQH—d”
.
£tTy³
 = 
‘h”H—d”
.setType

250 --- 
R‘r›ve
 
the
 
Eth”Ty³
.

251 --- @ 
Eth”Ty³
 
as
 16 
b™
 
š‹g”
.

252 
funùiÚ
 
‘h”H—d”
:
	$g‘Ty³
()

253  
	$htÚ16
(
£lf
.
ty³
)

254 
’d


256 
‘h”VÏnH—d”
.
g‘Ty³
 = 
‘h”H—d”
.getType

257 
‘h”QšQH—d”
.
g‘Ty³
 = 
‘h”H—d”
.getType

259 
funùiÚ
 
‘h”VÏnH—d”
:
	$g‘VÏnTag
()

260  
b™
.
	`bªd
(
	`htÚ16
(
£lf
.
vÏn_g
), 0xFFF)

261 
’d


263 --- 
S‘
 
the
 
fuÎ
 
vÏn
 
g
, 
šşudšg
h
PCP
 
ªd
 
DEI
 
	$b™s
 (
uµ”
 4 
b™s
)

264 
funùiÚ
 
‘h”VÏnH—d”
:
	$£tVÏnTag
()

265 
£lf
.
vÏn_g
 = 
	$htÚ16
()

266 
’d


268 
funùiÚ
 
‘h”QšQH—d”
:
	$g‘IÂ”VÏnTag
()

269  
b™
.
	`bªd
(
	`htÚ16
(
£lf
.
šÃr_vÏn_g
), 0xFFF)

270 
’d


272 --- 
S‘
 
the
 
fuÎ
 
šÃr
 
vÏn
 
g
, 
šşudšg
h
PCP
 
ªd
 
DEI
 
	$b™s
 (
uµ”
 4 
b™s
)

273 
funùiÚ
 
‘h”QšQH—d”
:
	$£tIÂ”VÏnTag
()

274 ğ
Ü
 0

275 
£lf
.
šÃr_vÏn_g
 = 
	$htÚ16
()

276 
’d


278 
funùiÚ
 
‘h”QšQH—d”
:
	$g‘Ou‹rVÏnTag
()

279  
b™
.
	`bªd
(
	`htÚ16
(
£lf
.
ou‹r_vÏn_g
), 0xFFF)

280 
’d


282 --- 
S‘
 
the
 
fuÎ
 
ou‹r
 
vÏn
 
g
, 
šşudšg
h
PCP
 
ªd
 
DEI
 
	$b™s
 (
uµ”
 4 
b™s
)

283 
funùiÚ
 
‘h”QšQH—d”
:
	$£tOu‹rVÏnTag
()

284 ğ
Ü
 0

285 
£lf
.
ou‹r_vÏn_g
 = 
	$htÚ16
()

286 
’d


288 
funùiÚ
 
‘h”QšQH—d”
:
	$g‘Ou‹rVÏnId
()

289  
	$htÚ16
(
£lf
.
ou‹r_vÏn_g
)

290 
’d


292 --- 
S‘
 
the
 
ou‹r
 
vÏn
 
id


293 
funùiÚ
 
‘h”QšQH—d”
:
	$£tOu‹rVÏnId
()

294 ğ
Ü
 0x8100

295 
£lf
.
ou‹r_vÏn_id
 = 
	$htÚ16
()

296 
’d


298 --- 
R‘r›ve
 
the
 
‘h”
 
ty³
.

299 --- @ 
Eth”Ty³
 
as
 
¡ršg
.

300 
funùiÚ
 
‘h”H—d”
:
	$g‘Ty³SŒšg
()

301 
loÿl
 
ty³
 = 
£lf
:
	$g‘Ty³
()

302 
loÿl
 
ş—¹ext
 = ""

304 
ty³
 =ğ
‘h
.
TYPE_IP
 
th’


305 
ş—¹ext
 = "(IP4)"

306 
–£if
 
ty³
 =ğ
‘h
.
TYPE_IP6
 
th’


307 
ş—¹ext
 = "(IP6)"

308 
–£if
 
ty³
 =ğ
‘h
.
TYPE_ARP
 
th’


309 
ş—¹ext
 = "(ARP)"

310 
–£if
 
ty³
 =ğ
‘h
.
TYPE_PTP
 
th’


311 
ş—¹ext
 = "(PTP)"

312 
–£if
 
ty³
 =ğ
‘h
.
TYPE_LACP
 
th’


313 
ş—¹ext
 = "(LACP)"

314 
–£if
 
ty³
 =ğ
‘h
.
TYPE_8021Q
 
th’


315 
ş—¹ext
 = "(VLAN)"

317 
ş—¹ext
 = "(unknown)"

318 
’d


320  
	`fÜm©
("0x%04x %s", 
ty³
, 
ş—¹ext
)

321 
’d


323 
‘h”VÏnH—d”
.
g‘Ty³SŒšg
 = 
‘h”H—d”
.getTypeString

324 
‘h”QšQH—d”
.
g‘Ty³SŒšg
 = 
‘h”H—d”
.getTypeString

326 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
‘h”Ãt
 
h—d”
.

327 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

328 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
. \
n


329 --- 
Exem¶¬y
 
švoÿtiÚs
:

330 --- @
code


331 --- 
	`fl
(è--- 
Úly
  
v®ues


332 --- 
fl
{ 
‘hSrc
="12:23:34:45:56:67", 
‘hTy³
=0x137 
	}
} ---  
v®ue
 
	g‘hD¡
;ƒthSrø
ªd
ƒthTy³ 
	gu£r
-
	g¥ecif›d


333 --- @
	g’dcode


334 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
	g¬gum’ts
. 
AvaabË
‡rgum’ts: 
Src
, 
	gD¡
, 
	gTy³


335 --- @
·¿m
 
´e
 
P»fix
 
	gÇmedArgs
. 
	gDeçuÉ
 'eth'.

336 
funùiÚ
 
	g‘h”H—d”
:
	$fl
(
¬gs
, 
´e
)

337 
¬gs
 =‡rg 
Ü
 {
	}
}

338 
´e
 =…» 
Ü
 "eth"

340 
loÿl
 
¤c
 = 
´e
 .. "Src"

341 
loÿl
 
d¡
 = 
´e
 .. "Dst"

342 
¬gs
[
¤c
] =‡rgs[¤c] 
Ü
 "01:02:03:04:05:06"

343 
¬gs
[
d¡
] =‡rgs[d¡] 
Ü
 "07:08:09:0a:0b:0c"

345 -- 
add»s£s
 
ÿn
 
be
 
e™h”
 
a
 
¡ršg
,‡ 
mac_add»ss
 
ùy³
 
Ü
‡ 
	gdeviû
/
queue
 
objeù


346 
ty³
(
¬gs
[
¤c
]è=ğ"¡ršg" 
th’


347 
£lf
:
	$£tSrcSŒšg
(
¬gs
[
¤c
])

348 
–£if
 
	$i¡y³
(
macAddrTy³
, 
¬gs
[
¤c
]è
th’


349 
£lf
.
¤c
 = 
¬gs
[src]

350 
–£if
 
	`ty³
(
¬gs
[
¤c
]è=ğ'numb”' 
th’


351 
£lf
:
	$£tSrc
(
¬gs
[
¤c
])

352 
–£if
 
	`ty³
(
¬gs
[
¤c
]è=ğ"bË" 
ªd
‡rgs[¤c].
id
 
th’


353 
£lf
:
	`£tSrcSŒšg
((
¬gs
[
¤c
].
dev
 
Ü
‡rgs[¤c]):
	$g‘MacSŒšg
())

354 
’d


355 
	`ty³
(
¬gs
[
d¡
]è=ğ"¡ršg" 
th’


356 
£lf
:
	$£tD¡SŒšg
(
¬gs
[
d¡
])

357 
–£if
 
	$i¡y³
(
macAddrTy³
, 
¬gs
[
d¡
]è
th’


358 
£lf
.
d¡
 = 
¬gs
[dst]

359 
–£if
 
	`ty³
(
¬gs
[
d¡
]è=ğ'numb”' 
th’


360 
£lf
:
	$£tD¡
(
¬gs
[
d¡
])

361 
–£if
 
	`ty³
(
¬gs
[
d¡
]è=ğ"bË" 
ªd
‡rgs[d¡].
id
 
th’


362 
£lf
:
	`£tD¡SŒšg
((
¬gs
[
d¡
].
dev
 
Ü
‡rgs[d¡]):
	$g‘MacSŒšg
())

363 
’d


364 
£lf
:
	`£tTy³
(
¬gs
[
´e
 .. "Type"])

365 
’d


367 
funùiÚ
 
‘h”VÏnH—d”
:
	$fl
(
¬gs
, 
´e
)

368 
£lf
.
vÏn_id
 = 0x0081

369 
loÿl
 
vÏnTag
 = 
¬gs
[
´e
 .. "VÏn"] 
Ü
 1

370 
£lf
:
	$£tVÏnTag
(
vÏnTag
)

371 
‘h”H—d”
.
	$fl
(
£lf
, 
¬gs
, 
´e
)

372 
’d


374 
funùiÚ
 
‘h”QšQH—d”
:
	$fl
(
¬gs
, 
´e
)

375 
loÿl
 
šÃrVÏnTag
 = 
¬gs
[
´e
 .. "šÃrVÏnTag"] 
Ü
 0

376 
loÿl
 
ou‹rVÏnId
 = 
¬gs
[
´e
 .. "ou‹rVÏnId"] 
Ü
 0x8100

377 
loÿl
 
ou‹rVÏnTag
 = 
¬gs
[
´e
 .. "ou‹rVÏnTag"] 
Ü
 0

378 
£lf
.
šÃr_vÏn_id
 = 
	$htÚ16
(0x8100)

379 
£lf
:
	$£tIÂ”VÏnTag
(
šÃrVÏnTag
)

380 
£lf
:
	$£tOu‹rVÏnId
(
ou‹rVÏnId
)

381 
£lf
:
	$£tOu‹rVÏnTag
(
ou‹rVÏnTag
)

382 
‘h”H—d”
.
	$fl
(
£lf
, 
¬gs
, 
´e
)

383 
’d


385 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

386 --- @
·¿m
 
´e
 
P»fix
 
ÇmedArgs
. 
DeçuÉ
 'eth'.

387 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See Also".

388 --- @
£e
 
‘h”H—d”
:
fl


389 
funùiÚ
 
‘h”H—d”
:
	$g‘
(
´e
)

390 
´e
 =…» 
Ü
 "eth"

392 
loÿl
 
¬gs
 = {
	}
}

393 
¬gs
[
´e
 .. "Src"] = 
£lf
:
	$g‘SrcSŒšg
()

394 
¬gs
[
´e
 .. "D¡"] = 
£lf
:
	$g‘D¡SŒšg
()

395 
¬gs
[
´e
 .. "Ty³"] = 
£lf
:
	$g‘Ty³
()

397  
¬gs


398 
’d


400 
funùiÚ
 
‘h”VÏnH—d”
:
	$g‘
(
´e
)

401 
´e
 =…» 
Ü
 "eth"

402 
loÿl
 
¬gs
 = 
‘h”H—d”
.
	$g‘
(
£lf
, 
´e
)

403 
¬gs
[
´e
 .. "VÏn"] = 
£lf
:
	$g‘VÏnTag
()

404  
¬gs


405 
’d


407 
funùiÚ
 
‘h”QšQH—d”
:
	$g‘
(
´e
)

408 
´e
 =…» 
Ü
 "eth"

409 
loÿl
 
¬gs
 = 
‘h”H—d”
.
	$g‘
(
£lf
, 
´e
)

410 
¬gs
[
´e
 .. "ou‹rVÏnId"] = 
£lf
:
	$g‘Ou‹rVÏnId
()

411 
¬gs
[
´e
 .. "ou‹rVÏnTag"] = 
£lf
:
	$g‘Ou‹rVÏnTag
()

412 
¬gs
[
´e
 .. "šÃrVÏnTag"] = 
£lf
:
	$g‘IÂ”VÏnTag
()

413  
¬gs


414 
’d


416 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

417 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

418 
funùiÚ
 
‘h”H—d”
:
	$g‘SŒšg
()

419  "ETH " .. 
£lf
:
	`g‘SrcSŒšg
(è.. " > " .. s–f:
	`g‘D¡SŒšg
(è.. "y³ " .. s–f:
	$g‘Ty³SŒšg
()

420 
’d


422 
funùiÚ
 
‘h”VÏnH—d”
:
	$g‘SŒšg
()

423  "ETH " .. 
£lf
:
	`g‘SrcSŒšg
(è.. " > " .. s–f:
	`g‘D¡SŒšg
(è.. " vÏÀ" .. s–f:
	`g‘VÏnTag
(è.. "y³ " .. s–f:
	$g‘Ty³SŒšg
()

424 
’d


426 
funùiÚ
 
‘h”QšQH—d”
:
	$g‘SŒšg
()

427  "ETH " .. 
£lf
:
	`g‘SrcSŒšg
(è.. " > " .. s–f:
	`g‘D¡SŒšg
(è.. " ou‹rVÏÀ" .. s–f:
	`g‘Ou‹rVÏnTag
(è.. " iÂ”VÏÀ" .. s–f:
	`g‘IÂ”VÏnTag
(è.. "y³ " .. s–f:
	$g‘Ty³SŒšg
()

428 
’d


430 -- 
M­s
 
h—d”s
 
to
 
»¥eùive
 
ty³s
.

431 -- 
This
 
li¡
 
should
 
be
 
ex‹nded
 
wh’ev”
 
a
 
Ãw
 
ty³
 
is
 
added
 
to
 'Ethernet constants'.

432 
loÿl
 
m­NameTy³
 = {

433 
4
 = 
‘h
.
TYPE_IP
,

434 
6
 = 
‘h
.
TYPE_IP6
,

435 
¬p
 = 
‘h
.
TYPE_ARP
,

436 
±p
 = 
‘h
.
TYPE_PTP
,

437 
Ïı
 = 
‘h
.
TYPE_LACP
,

438 
	}
}

440 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
Úe
 (
š
 
a
 
·ck‘
).

441 --- 
FÜ
 
	gš¡ªû
: 
š
 
tı
/
udp
 
ba£d
 
Ú
 
the
 
pÜts
.

442 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


443 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

444 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. '‘h', '4', 
n
)

445 
funùiÚ
 
‘h”H—d”
:
	$»sŞveNextH—d”
()

446 
loÿl
 
ty³
 = 
£lf
:
	$g‘Ty³
()

447 
Çme
, 
_ty³
 
š
 
	$·œs
(
m­NameTy³
) do

448 
ty³
 =ğ
_ty³
 
th’


449  
Çme


450 
’d


451 
’d


452  
n


453 
’d


455 
‘h”VÏnH—d”
.
»sŞveNextH—d”
 = 
‘h”H—d”
.resolveNextHeader

456 
‘h”QšQH—d”
.
»sŞveNextH—d”
 = 
‘h”H—d”
.resolveNextHeader

458 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
).

459 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength.

460 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e
.

461 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl
.

462 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'eth'

463 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
Also
)

464 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


465 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


466 --- @ 
TabË
 
of
 
ÇmedArgs


467 --- @
£e
 
‘h”H—d”
:
fl


468 
funùiÚ
 
‘h”H—d”
:
	`£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
)

469 -- 
Úly
 
£t
 
Ty³


470 
nÙ
 
ÇmedArgs
[
´e
 .. "Ty³"] 
th’


471 
Çme
, 
ty³
 
š
 
	$·œs
(
m­NameTy³
) do

472 
ÃxtH—d”
 =ğ
Çme
 
th’


473 
ÇmedArgs
[
´e
 .. "Ty³"] = 
ty³


475 
’d


476 
’d


477 
’d


478 
ÃxtH—d”
 =ğ"Ïı" 
th’


479 
ÇmedArgs
[
´e
 .. "Dst"] = "01:80:c2:00:00:02"

480 
’d


481  
ÇmedArgs


482 
’d


484 
‘h”VÏnH—d”
.
£tDeçuÉNamedArgs
 = 
‘h”H—d”
.setDefaultNamedArgs

485 
‘h”QšQH—d”
.
£tDeçuÉNamedArgs
 = 
‘h”H—d”
.setDefaultNamedArgs

487 
funùiÚ
 
‘h”H—d”
:
	$g‘SubTy³
()

488 
£lf
:
	`g‘Ty³
(è=ğ
‘h
.
TYPE_8021Q
 
th’


492 
’d


493 
’d


495 
funùiÚ
 
‘h”VÏnH—d”
:
	$g‘SubTy³
()

497 
’d


499 
funùiÚ
 
‘h”QšQH—d”
:
	$g‘SubTy³
()

501 
’d


504 ---- 
M‘©y³s


507 
ffi
.
	`m‘©y³
("uniÚ mac_add»ss", 
macAddr
)

508 
‘h
..
m‘©y³
 = 
‘h”H—d”


509 
‘h
.
vÏn
.
m‘©y³
 = 
‘h”VÏnH—d”


510 
‘h
.
qšq
.
m‘©y³
 = 
‘h”QšQH—d”


512  
‘h


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/gre.lua

2 --- @
fe
 
	gg»
.
	glua


3 --- @
br›f
 
G’”ic
 
Routšg
 
EnÿpsuÏtiÚ
 
	$´ÙocŞ
 (
GRE
è
ut™y
.

4 --- 
This
 
im¶em’tiÚ
 
šşudes
 
Úly
 
the
 
basic
 
GRE
 
h—d”
 
f›lds
, 
nÚe


5 --- 
of
 
the
 
İtiÚ®
 
f›lds


6 --- 
Ut™y
 
funùiÚs
 
g»_h—d”
 

7 --- 
Inşudes
:

8 --- - 
G»
 
cÚ¡ªts


9 --- - 
G»
 
h—d”
 
ut™y


10 --- - 
Defš™iÚ
 
of
 
G»
 
·ck‘s


13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
»quœe
 "utils"

16 
»quœe
 "proto.template"

17 
loÿl
 
š™H—d”
 = initHeader

19 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

20 
loÿl
 
Áoh16
, 
htÚ16
 =‚toh16, hton16

21 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
 = 
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

22 
loÿl
 
i¡y³
 = 
ffi
.istype

23 
loÿl
 
fÜm©
 = 
¡ršg
.format

27 ---- 
GRE
 
cÚ¡ªts


30 --- 
G»
 
´ÙocŞ
 
cÚ¡ªts


31 
loÿl
 
g»
 = {
	}
}

33 
g»
.
PROTO_TEB
 = 0x6558

36 ---- 
GRE
 
h—d”


39 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


40 
g»
.
h—d”FÜm©
 = [[

41 
ušt16_t
 
æags_ªd_v”siÚ
;

42 
ušt16_t
 
´ÙocŞ_ty³
;

45 --- 
V¬ŸbË
 
sized
 
memb”


46 
	gg»
.
	gh—d”V¬ŸbËMemb”
 = 
n


48 --- 
ModuË
 
g»_h—d”
 (
£e
 \
»f
 
h—d”s
.
lua
).

49 
loÿl
 
g»H—d”
 = 
	$š™H—d”
()

50 
g»H—d”
.
__šdex
 = greHeader

52 --- 
S‘
 
the
 
’ÿpsuÏ‹d
 
‘h”
 
´ÙocŞ
 
ty³
.

53 --- @
·¿m
 
´ÙocŞ
 
ty³
 
as
 16 
b™
 
š‹g”
.

54 
funùiÚ
 
g»H—d”
:
	$£tPrÙoTy³
()

55 ğ
Ü
 
g»
.
PROTO_TEB


56 
£lf
.
´ÙocŞ_ty³
 = 
	$htÚ16
()

57 
’d


59 --- 
R‘r›ve
 
the
 
’ÿpsuÏ‹d
 
‘h”
 
´ÙocŞ
 
ty³
.

60 --- @ 
PrÙocŞ
 
ty³
 
as
 
a
 16 
b™
 
š‹g”
.

61 
funùiÚ
 
g»H—d”
:
	$g‘PrÙoTy³
()

62  
	$Áoh16
(
£lf
.
´ÙocŞ_ty³
)

63 
’d


65 --- 
S‘
 
the
 
g»
 
h—d”
 
æag
 
ªd
 
v”siÚ
 
f›lds
.

66 --- @
·¿m
 
´ÙocŞ
 
ty³
 
as
 16 
b™
 
š‹g”
.

67 
funùiÚ
 
g»H—d”
:
	$£tFÏgsAndV”siÚ
()

68 ğ
Ü
 0x0000

69 
£lf
.
æags_ªd_v”siÚ
 = 
	$htÚ16
()

70 
’d


72 --- 
R‘r›ve
 
the
 
g»
 
h—d”
 
æag
 
ªd
 
v”siÚ
 
f›lds
.

73 --- @ 
PrÙocŞ
 
ty³
 
as
 
a
 16 
b™
 
š‹g”
.

74 
funùiÚ
 
g»H—d”
:
	$g‘FÏgsAndV”siÚ
()

75  
	$Áoh16
(
£lf
.
æags_ªd_v”siÚ
)

76 
’d


78 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
g»
 
h—d”
.

79 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

80 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

81 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rguments:

82 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'gre'.

83 --- @
code


84 --- 
	`fl
(è--- 
Úly
  
v®ues


85 --- 
fl
{
g»PrÙo
 = 10
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues


86 --- @
’dcode


87 
funùiÚ
 
g»H—d”
:
	$fl
(
¬gs
, 
´e
)

88 
¬gs
 =‡rg 
Ü
 {
	}
}

89 
´e
 =…» 
Ü
 "gre"

90 
£lf
:
£tPrÙoTy³
(
¬gs
[
´e
 .. "Proto"])

91 
£lf
:
£tFÏgsAndV”siÚ
(
¬gs
[
´e
 .. "Flags"])

92 
’d


94 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

95 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'gre'.

96 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

97 --- @
£e
 
g»H—d”
:
fl


98 
funùiÚ
 
g»H—d”
:
	$g‘
(
´e
)

99 
´e
 =…» 
Ü
 "gre"

101 
loÿl
 
¬gs
 = {
	}
}

102 
¬gs
[
´e
 .. "PrÙo"] = 
£lf
:
	$g‘PrÙoTy³
()

103 
¬gs
[
´e
 .. "FÏgs"] = 
£lf
:
	$g‘FÏgsAndV”siÚ
()

105  
¬gs


106 
’d


108 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

109 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

110 
funùiÚ
 
g»H—d”
:
	$g‘SŒšg
()

111 
loÿl
 
»tSŒ
 = "GRE "

112 
»tSŒ
 =„‘SŒ .. "FÏg " .. 
£lf
:
	$g‘FÏgsAndV”siÚSŒšg
()

113 
»tSŒ
 =„‘SŒ .. "PrÙØ" .. 
£lf
:
	$g‘PrÙoTy³SŒšg
()

115  
»tSŒ


116 
’d


118 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
	`Úe
 (
š
 
a
 
·ck‘
).

119 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


120 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

121 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. 'udp', 'icmp', 
n
)

122 
funùiÚ
 
g»H—d”
:
	$»sŞveNextH—d”
()

123 
loÿl
 
´Ùo
 = 
£lf
:
	$g‘NextH—d”
()

124 
Çme
, 
_´Ùo
 
š
 
	$·œs
(
m­NamePrÙo
) do

125 
´Ùo
 =ğ
_´Ùo
 
th’


126  
Çme


127 
’d


128 
’d


129  
n


130 
’d


132 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
)

133 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength

134 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e


135 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl


136 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'PROTO'

137 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
mÜe
)

138 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


139 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


140 --- @ 
TabË
 
of
 
ÇmedArgs


141 --- @
£e
 
g»H—d”
:
fl


142 
funùiÚ
 
g»H—d”
:
	$£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
)

143  
ÇmedArgs


144 
’d


148 ---- 
M‘©y³s


151 
g»
.
m‘©y³
 = 
g»H—d”


154  
g»


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/icmp.lua

2 --- @
fe
 
	gicmp
.
	glua


3 --- @
br›f
 
IÁ”Ãt
 
cÚŒŞ
 
mes§ge
 
´ÙocŞ
 
	gut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
icmp_h—d”
 

5 --- 
	gInşudes
:

6 --- - 
Icmp4
 
cÚ¡ªts


7 --- - 
Icmp6
 
cÚ¡ªts


8 --- - 
Icmp
 
h—d”
 
ut™y


9 --- - 
Defš™iÚ
 
of
 
Icmp
 
·ck‘s


12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

13 
loÿl
 
ns
 = 
»quœe
 "namespaces"

14 
loÿl
 
pe
 = 
»quœe
 "pipe"

15 
loÿl
 
memÜy
 = 
»quœe
 "memory"

16 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

17 
loÿl
 
log
 = 
»quœe
 "log"

18 
loÿl
 
‘h
 = 
»quœe
 "proto.ethernet"

19 
loÿl
 

 = 
»quœe
 "proto.ip4"

21 
»quœe
 "utils"

22 
»quœe
 "proto.template"

23 
loÿl
 
š™H—d”
 = initHeader

25 
loÿl
 
Áoh
, 
	ghtÚ
 =‚toh, 
htÚ


26 
loÿl
 
	gÁoh16
, 
	ghtÚ16
 = 
Áoh16
, 
htÚ16


27 
loÿl
 
	gbÜ
, 
	gbªd
, 
	gbnÙ
, 
	grshiá
, 
	glshiá
ğ
b™
.
bÜ
, 
	gb™
.bªd, b™.bnÙ, b™.rshiá, b™.
lshiá


28 
loÿl
 
	gi¡y³
 = 
ffi
.
i¡y³


29 
loÿl
 
fÜm©
 = 
¡ršg
.format

31 -- 
FIXME


32 -- 
ICMPv6
 
ªd
 
ICMPv4
 
u£
 
difã»Á
 
v®ues
 
the
 
§me
 
ty³s
/
codes
 
which
 
ÿu£s
 
some
 
com¶iÿtiÚs
 
wh’
 
hªdlšg
 
this
 
w™h
 
Úly
 
Úe
 
h—d”
:

33 -- - 
	$g‘SŒšg
(è
dÛs
 
nÙ
 
wÜk
 
ICMPv6
 
cÜ»ùly
 
w™hout
 
some
 
ugly
 
	`wÜk¬ounds
 (
basiÿÎy
 
addšg
 'v4' 
æags
 
to
 
	`g‘SŒšg
()'s ofype/code‡nd header)

34 -- 
cu¼’y
 
	$g‘SŒšg
(è
sim¶y
 
dÛs
 
nÙ
 
»cogni£
 
ICMPv6


35 -- - 
Fu¹h”mÜe
, 
·ck‘Dump
 
would
 
Ãed
 
a
 
chªge
 
to
 
·ss
 
this
 
æag
 
wh’
 
ÿÎšg
 
	`g‘SŒšg
()

39 ---- 
ICMPv4
 
cÚ¡ªts


42 --- 
Icmp4
 
´ÙocŞ
 
cÚ¡ªts


43 
loÿl
 
icmp
 = {
	}
}

45 --- 
Icmp4
 
ty³
-
code
 
·œ
: 
echo
 
»¶y


46 
icmp
.
ECHO_REPLY
 = { 
ty³
 = 0, 
	gcode
 = 0 }

47 --- 
Icmp4
 
	gty³
-
code
 
	g·œ
: 
echo
 
»que¡


48 
icmp
.
ECHO_REQUEST
 = { 
ty³
 = 8, 
	gcode
 = 0 }

50 --- 
Icmp4
 
	gty³
-
code
 
	g·œ
: 
de¡š©iÚ
 
uÄ—chabË
 - 
pÜt
 unreachable

51 
icmp
.
DST_UNR_PORT_UNR
 = { 
ty³
 = 3, 
	gcode
 = 3 }

53 --- 
Icmp4
 
	gty³
-
code
 
	g·œ
: 
time
 
exûeded
 - 
TTL
ƒxceeded

54 
icmp
.
TIME_EXCEEDED_TTL_EXPIRED
 = { 
ty³
 = 11, 
	gcode
 = 0 }

58 ---- 
ICMPv6
 
	gcÚ¡ªts


61 --- 
Icmp6
 
´ÙocŞ
 
cÚ¡ªts


62 
loÿl
 
	gicmp6
 = {}

64 --- 
Icmp6
 
ty³
-
code
 
·œ
: 
echo
 
»que¡


65 
icmp6
.
ECHO_REQUEST
 = { 
ty³
 = 128, 
	gcode
 = 0 }

66 --- 
Icmp6
 
	gty³
-
code
 
	g·œ
: 
echo
 
»¶y


67 
icmp6
.
ECHO_REPLY
 = { 
ty³
 = 129, 
	gcode
 = 0 }

71 ---- 
ICMP
 
	gh—d”


74 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


75 
	gicmp
.
	gh—d”FÜm©
 = [[

76 
ušt8_t
 
ty³
;

77 
ušt8_t
 
code
;

78 
ušt16_t
 
cs
;

79 
ušt8_t
 
body
[];

82 --- 
V¬ŸbË
 
sized
 
memb”


83 
	gicmp
.
	gh—d”V¬ŸbËMemb”
 = "body"

85 --- 
ModuË
 
icmp_h—d”
 

86 
loÿl
 
icmpH—d”
 = 
	$š™H—d”
()

87 
icmpH—d”
.
__šdex
 = icmpHeader

89 --- 
S‘
 
the
 
ty³
.

90 --- @
·¿m
 
Ty³
 
of
 
the
 
icmp
 
h—d”
 
as
 8 
b™
 
š‹g”
.

91 
funùiÚ
 
icmpH—d”
:
	$£tTy³
()

92 ğ
Ü
 
icmp
.
ECHO_REQUEST
.
ty³


93 
£lf
.
ty³
 = 

94 
’d


96 --- 
R‘r›ve
 
the
 
ty³
.

97 --- @ 
Ty³
 
as
 8 
b™
 
š‹g”
.

98 
funùiÚ
 
icmpH—d”
:
	$g‘Ty³
()

99  
£lf
.
ty³


100 
’d


102 --- 
R‘r›ve
 
the
 
ty³
.

103 --- 
dÛs
 
nÙ
 
wÜk
 
	`ICMPv6
 (
ICMPv6
 
u£s
 
difã»Á
 
v®ues
)

104 --- @ 
Ty³
 
as
 
¡ršg
.

105 
funùiÚ
 
icmpH—d”
:
	$g‘Ty³SŒšg
()

106 
loÿl
 
ty³
 = 
£lf
:
	$g‘Ty³
()

107 
loÿl
 
ş—¹ext
 = "unknown"

109 
ty³
 =ğ
icmp
.
ECHO_REPLY
.ty³ 
th’


110 
ş—¹ext
 = "echo„eply"

111 
–£if
 
ty³
 =ğ
icmp
.
ECHO_REQUEST
.ty³ 
th’


112 
ş—¹ext
 = "echo„equest"

113 
–£if
 
ty³
 =ğ
icmp
.
DST_UNR_PORT_UNR
.ty³ 
th’


114 
ş—¹ext
 = "dst. unr."

115 
–£if
 
ty³
 =ğ
icmp
.
TIME_EXCEEDED_TTL_EXPIRED
.ty³ 
th’


116 
ş—¹ext
 = "timeƒxceeded"

117 
’d


119  
	`fÜm©
("% (%s)", 
ty³
, 
ş—¹ext
)

120 
’d


122 --- 
S‘
 
the
 
code
.

123 --- @
·¿m
 
Code
 
of
 
the
 
icmp
 
h—d”
 
as
 8 
b™
 
š‹g”
.

124 
funùiÚ
 
icmpH—d”
:
	$£tCode
()

125 ğ
Ü
 
icmp
.
ECHO_REQUEST
.
code


126 
£lf
.
code
 = 

127 
’d


129 --- 
R‘r›ve
 
the
 
code
.

130 --- @ 
Code
 
as
 8 
b™
 
š‹g”
.

131 
funùiÚ
 
icmpH—d”
:
	$g‘Code
()

132  
£lf
.
code


133 
’d


135 --- 
R‘r›ve
 
the
 
code
.

136 --- 
dÛs
 
nÙ
 
wÜk
 
ICMPv6


137 --- @ 
Code
 
as
 
¡ršg
.

138 
funùiÚ
 
icmpH—d”
:
	$g‘CodeSŒšg
()

139 
loÿl
 
ty³
 = 
£lf
:
	$g‘Ty³
()

140 
loÿl
 
code
 = 
£lf
:
	$g‘Code
()

141 
loÿl
 
ş—¹ext
 = "unknown"

143 
ty³
 =ğ
icmp
.
ECHO_REPLY
.ty³ 
th’


144 
ş—¹ext
 = 
code
 =ğ
icmp
.
ECHO_REPLY
.cod
ªd
 "cÜ»ù" 
Ü
 "wrong"

146 
–£if
 
ty³
 =ğ
icmp
.
ECHO_REQUEST
.ty³ 
th’


147 
ş—¹ext
 = 
code
 =ğ
icmp
.
ECHO_REQUEST
.cod
ªd
 "cÜ»ù" 
Ü
 "wrong"

149 
–£if
 
ty³
 =ğ
icmp
.
DST_UNR_PORT_UNR
.ty³ 
th’


150 
code
 =ğ
icmp
.
DST_UNR_PORT_UNR
.cod
th’


151 
ş—¹ext
 = "port unr."

152 
’d


154 
–£if
 
ty³
 =ğ
icmp
.
TIME_EXCEEDED_TTL_EXPIRED
.ty³ 
th’


155 
code
 =ğ
icmp
.
TIME_EXCEEDED_TTL_EXPIRED
.cod
th’


156 
ş—¹ext
 = "ttlƒxpired"

157 
’d


158 
’d


160  
	`fÜm©
("% (%s)", 
code
, 
ş—¹ext
)

161 
’d


164 --- 
S‘
 
the
 
checksum
.

165 --- @
·¿m
 
Checksum
 
of
 
the
 
icmp
 
h—d”
 
as
 16 
b™
 
š‹g”
.

166 
funùiÚ
 
icmpH—d”
:
	$£tChecksum
()

167 ğ
Ü
 0

168 
£lf
.
cs
 = 
	$htÚ16
()

169 
’d


171 --- 
C®cuÏ‹
 
the
 
checksum


172 --- @
·¿m
 
Ën
 
Numb”
 
of
 
by‹s
 
th©
 
the
 
checksum
 
wl
 
be
 
compu‹d
 
ov”


173 
funùiÚ
 
icmpH—d”
:
	$ÿlcuÏ‹Checksum
(
Ën
)

174 
Ën
 =†’ 
Ü
 
ffi
.(
£lf
)

175 
£lf
:
	$£tChecksum
(0)

176 
£lf
:
	`£tChecksum
(
	`htÚ16
(
	$checksum
(
£lf
, 
Ën
)))

177 
’d


179 --- 
R‘r›ve
 
the
 
checksum
.

180 --- @ 
Checksum
 
as
 16 
b™
 
š‹g”
.

181 
funùiÚ
 
icmpH—d”
:
	$g‘Checksum
()

182  
	$htÚ16
(
£lf
.
cs
)

183 
’d


185 --- 
R‘r›ve
 
the
 
checksum
.

186 --- @ 
Checksum
 
as
 
¡ršg
.

187 
funùiÚ
 
icmpH—d”
:
	$g‘ChecksumSŒšg
()

188  
	`fÜm©
("0x%04x", 
£lf
:
	$g‘Checksum
())

189 
’d


191 --- 
S‘
 
the
 
mes§ge
 
body
.

192 --- @
·¿m
 
Mes§ge
 
body
 
of
 
the
 
icmp
 
h—d”
 
as
 
TODO
.

193 
funùiÚ
 
icmpH—d”
:
	$£tMes§geBody
(
body
)

194 
body
 = body 
Ü
 0

195 --
£lf
.
body
.
ušt8_t
 = body

196 
’d


198 --- 
R‘r›ve
 
the
 
mes§ge
 
body
.

199 --- @ 
Mes§ge
 
body
 
as
 
TODO
.

200 
funùiÚ
 
icmpH—d”
:
	$g‘Mes§geBody
()

201  0 --
£lf
.
body


202 
’d


204 --- 
R‘r›ve
 
the
 
mes§ge
 
body
.

205 --- @ 
Mes§ge
 
body
 
as
 
¡ršg
 
TODO
.

206 
funùiÚ
 
icmpH—d”
:
	$g‘Mes§geBodySŒšg
()

208 
’d


210 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
icmp
 
h—d”
.

211 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

212 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

213 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
Ty³
, 
Code
, 
Checksum
, 
Mes§geBody


214 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'icmp'.

215 --- @
code


216 --- 
	`fl
(è--- 
Úly
  
v®ues


217 --- 
fl
{ 
icmpCode
=3 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	gicmpCode


218 --- @
’dcode


219 
funùiÚ
 
	gicmpH—d”
:
	$fl
(
¬gs
, 
´e
)

220 
¬gs
 =‡rg 
Ü
 {
	}
}

221 
´e
 =…» 
Ü
 "icmp"

223 
£lf
:
£tTy³
(
¬gs
[
´e
 .. "Type"])

224 
£lf
:
£tCode
(
¬gs
[
´e
 .. "Code"])

225 
£lf
:
£tChecksum
(
¬gs
[
´e
 .. "Checksum"])

226 
£lf
:
£tMes§geBody
(
¬gs
[
´e
 .. "MessageBody"])

227 
’d


229 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

230 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'icmp'.

231 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

232 --- @
£e
 
icmpH—d”
:
fl


233 
funùiÚ
 
icmpH—d”
:
	$g‘
(
´e
)

234 
´e
 =…» 
Ü
 "icmp"

236 
loÿl
 
¬gs
 = {
	}
}

237 
¬gs
[
´e
 .. "Ty³"] = 
£lf
:
	$g‘Ty³
()

238 
¬gs
[
´e
 .. "Code"] = 
£lf
:
	$g‘Code
()

239 
¬gs
[
´e
 .. "Checksum"] = 
£lf
:
	$g‘Checksum
()

240 
¬gs
[
´e
 .. "Mes§geBody"] = 
£lf
:
	$g‘Mes§geBody
()

242  
¬gs


243 
’d


245 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

246 --- 
DÛs
 
nÙ
 
wÜk
 
cÜ»ùly
 
ICMPv6
 
·ck‘s


247 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

248 
funùiÚ
 
icmpH—d”
:
	$g‘SŒšg
()

249  "ICMPy³ " .. 
£lf
:
	`g‘Ty³SŒšg
()

250 .. " cod" .. 
£lf
:
	`g‘CodeSŒšg
()

251 .. " cksum " .. 
£lf
:
	`g‘ChecksumSŒšg
()

252 .. " body " .. 
£lf
:
	`g‘Mes§geBodySŒšg
() .. " "

253 
’d


257 ---- 
ICMP
 
»¥Úd”
, 
IPv4
 
Úly
 
now


258 ---- 
PuÎ
 
»que¡s
 
IPv6
 
¬e
 
w–come
 :)

262 --- 
S¹s
 
a
 
sim¶e
 
ICMPv4
 
pšg
 
»¥Úd”
 
Ú
‡ 
sh¬ed
 
cÜe
.

263 --- 
This
 
is
 *
nÙ
 
İtimized
 
Ï‹ncy
* 
pšg
 
»l›s
 
wl
 
be
 
	`¦ow
 (> 1
ms
)

264 --- 
The
 
maš
 
u£ÿ£
 
of
 
this
 
is
 
Ë‰šg
 
Ùh”s
 
Ú
 
the
 
ÃtwÜk
 
know
 
th©
 
ª
 
IP
 i 
bešg
 
u£d
.

265 --- 
This
 
wl
 
Œy
 
to
 
£tup
 
a
 
f‹r
 
Ú
 
the
 
rx
 
queue
Ø
m©ch
 
ICMP
 
·ck‘s
 
add»s£d
Øth
giv’
 
IP
.

266 --- @
·¿m
 
queues
 
¬¿y
 
of
 
queue
 
·œs
 
to
 
u£
, 
—ch
 
’Œy
 
has
 
the
 
fŞlowšg
 
fÜm©


267 --- {
rxQueue
 =„xQueue, 
txQueue
 =xQueue, 
s
 = "" | {"", ...}
	}
}

268 --- 
rxQueue
 
is
 
	gİtiÚ®
, 
·ck‘s
 
ÿn
 
®‹º©iv–y
 
be
 
´ovided
 
through
 
the
 
pe
 
	gAPI
, 
£e
 
	gicmp
.
	$hªdËPack‘
()

269 
funùiÚ
 
icmp
.
	$¡¬tIcmpTask
(
queues
)

270 
libmoÚ
.
	`¡¬tSh¬edTask
("__LM_ICMP_TASK", 
queues
)

271 
’d


273 
loÿl
 
pes
 = 
ns
:
	$g‘
()

275 
loÿl
 
funùiÚ
 
	`hªdËIcmpPack‘
(
rxBufs
, 
nic
)

276 -- 
FIXME
: 
suµÜt
 
nÚ
-
ofæßded
 
vÏn
 
gs


277 
loÿl
 
pkt
 = 
rxBufs
[1]:
	$g‘IcmpPack‘
()

278 
pkt
.
‘h
:
	`g‘Ty³
(è~ğ‘h.
TYPE_IP


279 
Ü
 
pkt
.
4
:
	`g‘PrÙocŞ
(è~ğ

.
PROTO_ICMP
 
th’


280 
rxBufs
:
	$ä“AÎ
()

282 
’d


283 
loÿl
 
d¡Ip
 = 
pkt
.
4
.
d¡
:
	$g‘SŒšg
()

284 
loÿl
 
Ok
 = 
çl£


285 
i
, 
v
 
š
 
	$aœs
(
nic
.
s
) do

286 
v
 =ğ
d¡Ip
 
th’


287 
Ok
 = 
Œue


289 
’d


290 
’d


291 
nÙ
 
Ok
 
th’


292 
rxBufs
:
	$ä“AÎ
()

294 
’d


295 -- 
yes
, 
we
 
assume
 
th©
 
the
 
·th
 
is
 
symm‘ric
 
ªd
h©h
sourû
 
MAC
 i 
cÜ»ù


296 -- 
could
 
be
 
im´oved
 
by
 
usšg
 
the
 
ARP
 
sk
 
h”e
, 
puÎ
 
»que¡s
 
w–come


297 
pkt
.
‘h
.
d¡
:
	`£t
Õkt.‘h.
¤c
:
	$g‘
())

298 
pkt
.
‘h
.
¤c
:
	`£t
(
nic
.
txQueue
.
dev
:
	$g‘Mac
(
Œue
))

299 
loÿl
 
tmp
 = 
pkt
.
4
.
¤c
:
	$g‘
()

300 
pkt
.
4
.
¤c
:
	`£t
Õkt.4.
d¡
:
	$g‘
())

301 
pkt
.
4
.
d¡
:
	$£t
(
tmp
)

302 
pkt
.
4
.
‰l
 = 64

303 
pkt
.
icmp
:
	$£tTy³
(
icmp
.
ECHO_REPLY
.
ty³
)

304 
pkt
.
4
:
	`ÿlcuÏ‹Checksum
(è-- 
avoid
 
ofæßdšg
 
d•’d’cy


305 
pkt
.
icmp
:
	`ÿlcuÏ‹Checksum
Õkt.
4
:
	`g‘L’gth
(è-…kt.4:
	`g‘H—d”L’gth
() * 4)

306 
nic
.
txQueue
:
	$£nd
(
rxBufs
)

307 
’d


309 
loÿl
 
funùiÚ
 
	`icmpTask
(
queues
)

310 -- 
two
 
ways
 
to
 
ÿÎ
 
this
: 
sšgË
 
nic
 
Ü
 
¬¿y
 
of
 
nics


311 
queues
[1] =ğ
n
 
ªd
 queues.
txQueue
 
th’


312  
	`icmpTask
({
queues
})

313 
’d


315 
i
, 
nic
 
š
 
	$aœs
(
queues
) do

316 
nic
.
rxQueue
 
ªd
‚ic.
txQueue
.
id
 ~ğnic.rxQueue.id 
th’


317 
	`”rÜ
("both queues must belongohe same device")

318 
’d


319 
	`ty³
(
nic
.
s
è=ğ"¡ršg" 
th’


320 
nic
.
s
 = {‚ic. 
	}
}

321 
’d


322 
nic
.
rxQueue
 
th’


323 
i
, 
v
 
š
 
	$aœs
(
nic
.
s
) do

324 
loÿl
 
ok
 = 
nic
.
rxQueue
.
dev
:
	`fiveTu¶eF‹r
({

325 
d¡Ip
 = 
v
,

326 
´Ùo
 = 

.
PROTO_ICMP


327 
	}
}, 
	gnic
.
	grxQueue
)

328 
nÙ
 
ok
 
th’


330 
’d


331 
’d


332 
’d


333 
loÿl
 
	gpe
 = 
pe
:
	$ÃwFa¡Pe
()

334 
nic
.
pe
 =…ipe

335 
pes
[
	`to¡ršg
(
i
)] = 
pe


336 
’d


338 
loÿl
 
rxBufs
 = 
memÜy
.
	$ü—‹BufA¼ay
(1)

339 
libmoÚ
.
	$ruÂšg
() do

340 
_
, 
nic
 
š
 
	$·œs
(
queues
) do

341 
nic
.
rxQueue
 
th’


342 
rx
 = 
nic
.
rxQueue
:
	$ŒyRecvIdË
(
rxBufs
, 1000)

343 
	`as£¹
(
rx
 <= 1)

344 
rx
 > 0 
th’


345 
	$hªdËIcmpPack‘
(
rxBufs
, 
nic
)

346 
’d


347 
’d


348 -- 
Úly
 
we
 
had
 
som‘hšg
 
like
 
pŞl
 :/

349 -- 
maybe
 
wr™e
 
some
 
w¿µ”
 
th©
 
kes
 
muÉË
 
ŒyRecv
-
abË
 
thšgs
?

350 
loÿl
 
pkt
 = 
nic
.
pe
:
	$ŒyRecv
(1000)

351 
pkt
 
th’


352 
rxBufs
[1] = 
pkt


353 
	$hªdËIcmpPack‘
(
rxBufs
, 
nic
)

354 
’d


355 
’d


356 
’d


357 
’d


359 --- 
S’d
 
a
 
buf
 
cÚššg
 
ª
 
ICMP
 
·ck‘
 
to
 
the
 ICMP 
»£pÚd”
.

360 --- 
The
 
buf
 
is
 
ä“
'd byhe ICMPask, do‚ot freehis (or increase„ef count if you still‚eedhe buf).

361 --- @
·¿m
 
buf
 
the
 
ICMP
 
·ck‘


362 --- @
·¿m
 
nic
 
the
 
ID
 
of
h
NIC
 
äom
 
which
h
·ckt
 
was
 
»ûived
, 
deçuÉs
 
to
 1

363 --- 
cÜ»¥Úds
 
to
 
the
 
šdex
 
š
h
queue
 
¬¿y
 
·s£d
Øth
ICMP
 
sk


364 
funùiÚ
 
icmp
.
	$hªdËPack‘
(
buf
, 
nic
)

365 
nic
 =‚iø
Ü
 1

366 
loÿl
 
pe
 = 
pes
[
	`to¡ršg
(
nic
)]

367 
nÙ
 
pe
 
th’


368 
log
:
	`çl
("NIC % nÙ found", 
nic
)

369 
’d


370 
pe
:
	$£nd
(
buf
)

371 
’d


373 
__LM_ICMP_TASK
 = 
icmpTask


377 ---- 
M‘©y³s


380 
icmp
.
m‘©y³
 = 
icmpH—d”


382  
icmp
, 
icmp6


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ip4.lua

2 --- @
fe
 
	g4
.
	glua


3 --- @
br›f
 
IÁ”Ãt
 
	$´ÙocŞ
 (
v4
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
4_add»ss
 
ªd
 
4_h—d”
 
¡ruùs


5 --- 
Inşudes
:

6 --- - 
IP4
 
cÚ¡ªts


7 --- - 
IP4
 
add»ss
 
ut™y


8 --- - 
IP4
 
h—d”
 
ut™y


9 --- - 
Defš™iÚ
 
of
 
IP4
 
·ck‘s


12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "utils"

15 
»quœe
 "proto.template"

16 
loÿl
 
š™H—d”
 = initHeader

18 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

19 
loÿl
 
Áoh16
, 
htÚ16
 =‚toh16, hton16

20 
loÿl
 
bsw­
 = bswap

21 
loÿl
 
bsw­16
 = bswap16

22 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
ğ
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

23 
loÿl
 
i¡y³
 = 
ffi
.istype

24 
loÿl
 
fÜm©
 = 
¡ršg
.format

27 ---- 
IPv4
 
cÚ¡ªts


30 --- 
IP4
 
´ÙocŞ
 
cÚ¡ªts


31 
loÿl
 

 = {
	}
}

33 

.
PROTO_ICMP
 = 0x01

34 

.
PROTO_TCP
 = 0x06

35 

.
PROTO_UDP
 = 0x11

36 

.
PROTO_GRE
 = 0x2f

37 

.
PROTO_ESP
 = 0x32

38 

.
PROTO_AH
 = 0x33

39 

.
PROTO_SCTP
 = 0x84

41 --- 
S³cŸl
 
add»s£s


42 --- 
NuÎ
 
add»ss


43 

.
NULL
 = "0.0.0.0"

46 ---- 
IPv4
 
add»s£s


50 
ffi
.
cdef
[[

51 
	u4_add»ss
 {

52 
ušt8_t
 
ušt8
[4];

53 
ušt32_t
 
	mušt32
;

57 --- 
ModuË
 
4_add»ss
 

58 
loÿl
 
	g4Addr
 = {}

59 
4Addr
.
__šdex
 = ip4Addr

60 
loÿl
 
4AddrTy³
 = 
ffi
.
ty³of
("union ip4_address")

62 --- 
R‘r›ve
 
the
 
IPv4
 
add»ss
.

63 --- @ 
Add»ss
 
š
 
ušt32
 
fÜm©
.

64 
funùiÚ
 
4Addr
:
	$g‘
()

65  
	$bsw­
(
£lf
.
ušt32
)

66 
’d


68 --- 
S‘
 
the
 
IPv4
 
add»ss
.

69 --- @
·¿m
 

 
Add»ss
 
š
 
ušt32
 
fÜm©
.

70 
funùiÚ
 
4Addr
:
	$£t
(

)

71 
£lf
.
ušt32
 = 
	$bsw­
(

)

72 
’d


74 --- 
S‘
 
the
 
IPv4
 
add»ss
.

75 --- @
·¿m
 

 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

76 
funùiÚ
 
4Addr
:
	$£tSŒšg
(

)

77 
£lf
:
	`£t
(
	$·r£IPAdd»ss
(

))

78 
’d


80 --- 
R‘r›ve
 
the
 
¡ršg
 
»´e£Á©iÚ
 
of
h
IPv4
 
add»ss
.

81 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

82 
funùiÚ
 
4Addr
:
	$g‘SŒšg
()

83  ("%d.%d.%d.%d"):
	$fÜm©
(
£lf
.
ušt8
[0], self.uint8[1], self.uint8[2], self.uint8[3])

84 
’d


87 --- 
Te¡
 
equ®™y
 
of
 
two
 
IPv4
 
add»s£s
.

88 --- @
·¿m
 
lhs
 
Add»ss
 
š
 'uniÚ ip4_add»ss' 
fÜm©
.

89 --- @
·¿m
 
rhs
 
Add»ss
 
š
 'uniÚ ip4_add»ss' 
fÜm©
.

90 --- @ 
Œue
 
equ®
, 
çl£
 
Ùh”wi£
.

91 
funùiÚ
 
4Addr
.
	$__eq
(
lhs
, 
rhs
)

92  
	$i¡y³
(
4AddrTy³
, 
lhs
è
ªd
 
	$i¡y³
(
4AddrTy³
, 
rhs
è
ªd
 
lhs
.
ušt32
 ==„hs.uint32

93 
’d


95 --- 
Add
 
a
 
numb”
 
to
 
ª
 
IPv4
 
add»ss
.

96 --- 
Max
. 32 
b™
, 
commutive
.

97 --- @
·¿m
 
lhs
 
Add»ss
 
š
 'uniÚ ip4_add»ss' 
fÜm©
.

98 --- @
·¿m
 
rhs
 
Numb”
 
to
 
	`add
 (32 
b™
 
š‹g”
).

99 --- @ 
ResuÉšg
 
add»ss
 
š
 
ušt32
 
fÜm©
.

100 
funùiÚ
 
4Addr
.
	`__add
(
lhs
, 
rhs
)

101 -- 
ÿlc
 
	`
 (
£lf
è+ 
	$numb”
 (
v®
)

102 
loÿl
 
£lf
, 
v®


103 
	$i¡y³
(
4AddrTy³
, 
lhs
è
th’


104 
£lf
 = 
lhs


105 
v®
 = 
rhs


107 -- 
commutive
 
numb”
 + 



108 
£lf
 = 
rhs


109 
v®
 = 
lhs


110 
’d
 -- 
TODO
: 

 + ip?

112  
£lf
:
	`g‘
(è+ 
v®


113 
’d


115 --- 
Add
 
a
 
numb”
 
to
 
ª
 
IPv4
 
add»ss
 
š
-
¶aû
.

116 --- 
Max
. 32 
b™
.

117 --- @
·¿m
 
v®
 
Numb”
 
to
 
	`add
 (32 
b™
 
š‹g”
).

118 
funùiÚ
 
4Addr
:
	$add
(
v®
)

119 
£lf
:
	`£t
(£lf:
	`g‘
(è+ 
v®
)

120 
’d


122 --- 
SubŒaù
 
a
 
numb”
 
äom
 
ª
 
IPv4
 
add»ss
.

123 --- 
Max
. 32 
b™
.

124 --- @
·¿m
 
v®
 
Numb”
 
to
 
	`sub¡¿ù
 (32 
b™
 
š‹g”
)

125 --- @ 
ResuÉšg
 
add»ss
 
š
 
ušt32
 
fÜm©
.

126 
funùiÚ
 
4Addr
:
	$__sub
(
v®
)

127  
£lf
 + -
v®


128 
’d


132 ---- 
IPv4
 
h—d”


135 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


136 

.
h—d”FÜm©
 = [[

137 
ušt8_t
 
v”ihl
;

138 
ušt8_t
 
tos
;

139 
ušt16_t
 
Ën
;

140 
ušt16_t
 
id
;

141 
ušt16_t
 
äag
;

142 
ušt8_t
 
‰l
;

143 
ušt8_t
 
´ÙocŞ
;

144 
ušt16_t
 
cs
;

145 
4_add»ss
 
¤c
;

146 
4_add»ss
 
d¡
;

147 
ušt8_t
 
İtiÚs
[];

150 --- 
V¬ŸbË
 
sized
 
memb”


151 

.
h—d”V¬ŸbËMemb”
 = "options"

153 --- 
ModuË
 
4_h—d”
 

154 
loÿl
 
4H—d”
 = 
	$š™H—d”
()

156 
4H—d”
.
__šdex
 = ip4Header

158 --- 
S‘
 
the
 
v”siÚ
.

159 --- @
·¿m
 
IP
 
h—d”
 
v”siÚ
 
as
 4 
b™
 
š‹g”
. 
Should
 
®ways
 
be
 '4'.

160 
funùiÚ
 
4H—d”
:
	$£tV”siÚ
()

161 ğ
Ü
 4

162 ğ
	`bªd
(
	`lshiá
(, 4), 0xf0è-- 
fl
 
to
 8 
b™s


164 
Şd
 = 
£lf
.
v”ihl


165 
Şd
 = 
	`bªd
(Şd, 0x0fè-- 
»move
 old 
v®ue


167 
£lf
.
v”ihl
 = 
	$bÜ
(
Şd
, )

168 
’d


170 --- 
R‘r›ve
 
the
 
v”siÚ
.

171 --- @ 
V”siÚ
 
as
 4 
b™
 
š‹g”
.

172 
funùiÚ
 
4H—d”
:
	$g‘V”siÚ
()

173  
	`bªd
(
	`rshiá
(
£lf
.
v”ihl
, 4), 0x0f)

174 
’d


176 --- 
R‘r›ve
 
the
 
v”siÚ
.

177 --- @ 
V”siÚ
 
as
 
¡ršg
.

178 
funùiÚ
 
4H—d”
:
	$g‘V”siÚSŒšg
()

179  
£lf
:
	$g‘V”siÚ
()

180 
’d


182 --- 
S‘
 
the
 
h—d”
 
Ëngth
.

183 --- @
·¿m
 
L’gth
 
of
 
the
 

 
	$h—d”
 (
š
 
muÉË
 
of
 32 
b™s
è
as
 4 
b™
 
š‹g”
. 
Should
 
®ways
 
be
 '5'.

184 
funùiÚ
 
4H—d”
:
	$£tH—d”L’gth
()

185 ğ
Ü
 5

186 ğ
	$bªd
(, 0x0f)

188 
Şd
 = 
£lf
.
v”ihl


189 
Şd
 = 
	$bªd
(
Şd
, 0xf0)

191 
£lf
.
v”ihl
 = 
	$bÜ
(
Şd
, )

192 
’d


194 --- 
R‘r›ve
 
the
 
h—d”
 
Ëngth
.

195 --- @ 
H—d”
 
Ëngth
 
as
 4 
b™
 
š‹g”
.

196 
funùiÚ
 
4H—d”
:
	$g‘H—d”L’gth
()

197  
	$bªd
(
£lf
.
v”ihl
, 0x0f)

198 
’d


200 --- 
R‘r›ve
 
the
 
h—d”
 
Ëngth
.

201 --- @ 
H—d”
 
Ëngth
 
as
 
¡ršg
.

202 
funùiÚ
 
4H—d”
:
	$g‘H—d”L’gthSŒšg
()

203  
£lf
:
	$g‘H—d”L’gth
()

204 
’d


206 --- 
S‘
 
the
 
ty³
 
of
 
	`£rviû
 (
TOS
).

207 --- @
·¿m
 
TOS
 
of
 
the
 

 
h—d”
 
as
 8 
b™
 
š‹g”
.

208 
funùiÚ
 
4H—d”
:
	$£tTOS
()

209 ğ
Ü
 0

210 
£lf
.
tos
 = 

211 
’d


213 --- 
R‘r›ve
 
the
 
ty³
 
of
 
£rviû
.

214 --- @ 
TOS
 
as
 8 
b™
 
š‹g”
.

215 
funùiÚ
 
4H—d”
:
	$g‘TOS
()

216  
£lf
.
tos


217 
’d


219 --- 
R‘r›ve
 
the
 
ty³
 
of
 
£rviû
.

220 --- @ 
TOS
 
as
 
¡ršg
.

221 
funùiÚ
 
4H—d”
:
	$g‘TOSSŒšg
()

222  
£lf
:
	$g‘TOS
()

223 
’d


225 --- 
S‘
 
the
 
tÙ®
 
Ëngth
.

226 --- @
·¿m
 
L’gth
 
of
 
the
 
·ck‘
 
exşudšg
 
Ïy”
 2. 16 
b™
 
š‹g”
.

227 
funùiÚ
 
4H—d”
:
	$£tL’gth
()

228 ğ
Ü
 48 -- 
w™h
 
‘h
 + 
UDP
 -> 
mšimum
 64

229 
£lf
.
Ën
 = 
	$htÚ16
()

230 
’d


232 --- 
R‘r›ve
 
the
 
Ëngth
.

233 --- @ 
L’gth
 
as
 16 
b™
 
š‹g”
.

234 
funùiÚ
 
4H—d”
:
	$g‘L’gth
()

235  
	$htÚ16
(
£lf
.
Ën
)

236 
’d


238 --- 
R‘r›ve
 
the
 
Ëngth
.

239 --- @ 
L’gth
 
as
 
¡ršg
.

240 
funùiÚ
 
4H—d”
:
	$g‘L’gthSŒšg
()

241  
£lf
:
	$g‘L’gth
()

242 
’d


244 --- 
S‘
 
the
 
id’tifiÿtiÚ
.

245 --- @
·¿m
 
ID
 
of
 
the
 

 
h—d”
 
as
 16 
b™
 
š‹g”
.

246 
funùiÚ
 
4H—d”
:
	$£tID
()

247 ğ
Ü
 0

248 
£lf
.
id
 = 
	$htÚ16
()

249 
’d


251 --- 
R‘r›ve
 
the
 
id’tifiÿtiÚ
.

252 --- @ 
ID
 
as
 16 
b™
 
š‹g”
.

253 
funùiÚ
 
4H—d”
:
	$g‘ID
()

254  
	$htÚ16
(
£lf
.
id
)

255 
’d


257 --- 
R‘r›ve
 
the
 
id’tifiÿtiÚ
.

258 --- @ 
ID
 
as
 
¡ršg
.

259 
funùiÚ
 
4H—d”
:
	$g‘IDSŒšg
()

260  
£lf
:
	$g‘ID
()

261 
’d


263 --- 
S‘
 
the
 
æags
.

264 --- 
B™s
: [ 
	`»£rved
 (
mu¡
 
be
 0è| 
dÚ
't fragment | more fragments ]

265 --- @
·¿m
 
FÏgs
 
of
 
the
 

 
h—d”
 
as
 3 
b™
 
š‹g”


266 
funùiÚ
 
4H—d”
:
	$£tFÏgs
()

267 ğ
Ü
 0

268 ğ
	`bªd
(
	`lshiá
(, 13), 0xe000è-- 
fl
 
to
 16 
b™s


270 
Şd
 = 
	$htÚ16
(
£lf
.
äag
)

271 
Şd
 = 
	`bªd
(Şd, 0x1fffè-- 
»move
 old 
v®ue


273 
£lf
.
äag
 = 
	`htÚ16
(
	$bÜ
(
Şd
, ))

274 
’d


276 --- 
R‘r›ve
 
the
 
æags
.

277 --- @ 
FÏgs
 
as
 3 
b™
 
š‹g”
.

278 
funùiÚ
 
4H—d”
:
	$g‘FÏgs
()

279  
	`bªd
(
	`rshiá
(
	`htÚ16
(
£lf
.
äag
), 13), 0x0007)

280 
’d


282 --- 
R‘r›ve
 
the
 
æags
.

283 --- @ 
FÏgs
 
as
 
¡ršg
.

284 
funùiÚ
 
4H—d”
:
	$g‘FÏgsSŒšg
()

285 
æags
 = 
£lf
:
	`g‘FÏgs
()

286 --
TODO
 
show
 
æags
 
š
 
a
 
mÜe
 
şev”
 
mªÃr
: 1|1|1 
Ü
 
»£rved
|
DF
|
MF


287  
æags


288 
’d


290 --- 
S‘
 
the
 
äagm’t
.

291 --- @
·¿m
 
F¿gm’t
 
of
 
the
 

 
h—d”
 
as
 13 
b™
 
š‹g”
.

292 
funùiÚ
 
4H—d”
:
	$£tF¿gm’t
()

293 ğ
Ü
 0

294 ğ
	$bªd
(, 0x1fff)

296 
Şd
 = 
	$htÚ16
(
£lf
.
äag
)

297 
Şd
 = 
	$bªd
(
Şd
, 0xe000)

299 
£lf
.
äag
 = 
	`htÚ16
(
	$bÜ
(
Şd
, ))

300 
’d


302 --- 
R‘r›ve
 
the
 
äagm’t
.

303 --- @ 
F¿gm’t
 
as
 13 
b™
 
š‹g”
.

304 
funùiÚ
 
4H—d”
:
	$g‘F¿gm’t
()

305  
	`bªd
(
	`htÚ16
(
£lf
.
äag
), 0x1fff)

306 
’d


308 --- 
R‘r›ve
 
the
 
äagemt
.

309 --- @ 
F¿gm’t
 
as
 
¡ršg
.

310 
funùiÚ
 
4H—d”
:
	$g‘F¿gm’tSŒšg
()

311  
£lf
:
	$g‘F¿gm’t
()

312 
’d


314 --- 
S‘
 
the
 
time
-
to
-
	`live
 (
TTL
).

315 --- @
·¿m
 
TTL
 
of
 
the
 

 
h—d”
 
as
 8 
b™
 
š‹g”
.

316 
funùiÚ
 
4H—d”
:
	$£tTTL
()

317 ğ
Ü
 64

318 
£lf
.
‰l
 = 

319 
’d


321 --- 
R‘r›ve
 
the
 
time
-
to
-
live
.

322 --- @ 
TTL
 
as
 8 
b™
 
š‹g”
.

323 
funùiÚ
 
4H—d”
:
	$g‘TTL
()

324  
£lf
.
‰l


325 
’d


327 --- 
R‘r›ve
 
the
 
time
-
to
-
live
.

328 --- @ 
TTL
 
as
 
¡ršg
.

329 
funùiÚ
 
4H—d”
:
	$g‘TTLSŒšg
()

330  
£lf
:
	$g‘TTL
()

331 
’d


333 --- 
S‘
 
the
 
Ãxt
 
Ïy”
 
´ÙocŞ
.

334 --- @
·¿m
 
Next
 
Ïy”
 
´ÙocŞ
 
of
 
the
 

 
h—d”
 
as
 8 
b™
 
š‹g”
.

335 
funùiÚ
 
4H—d”
:
	$£tPrÙocŞ
()

336 ğ
Ü
 

.
PROTO_UDP


337 
£lf
.
´ÙocŞ
 = 

338 
’d


340 --- 
R‘r›ve
 
the
 
Ãxt
 
Ïy”
 
´ÙocŞ
.

341 --- @ 
Next
 
Ïy”
 
´ÙocŞ
 
as
 8 
b™
 
š‹g”
.

342 
funùiÚ
 
4H—d”
:
	$g‘PrÙocŞ
()

343  
£lf
.
´ÙocŞ


344 
’d


346 --- 
R‘r›ve
 
the
 
Ãxt
 
Ïy”
 
´ÙocŞ
.

347 --- @ 
Next
 
Ïy”
 
´ÙocŞ
 
as
 
¡ršg
.

348 
funùiÚ
 
4H—d”
:
	$g‘PrÙocŞSŒšg
()

349 
loÿl
 
´Ùo
 = 
£lf
:
	$g‘PrÙocŞ
()

350 
loÿl
 
ş—¹ext
 = ""

352 
´Ùo
 =ğ

.
PROTO_ICMP
 
th’


353 
ş—¹ext
 = "(ICMP)"

354 
–£if
 
´Ùo
 =ğ

.
PROTO_UDP
 
th’


355 
ş—¹ext
 = "(UDP)"

356 
–£if
 
´Ùo
 =ğ

.
PROTO_TCP
 
th’


357 
ş—¹ext
 = "(TCP)"

358 
–£if
 
´Ùo
 =ğ

.
PROTO_ESP
 
th’


359 
ş—¹ext
 = "(ESP)"

360 
–£if
 
´Ùo
 =ğ

.
PROTO_AH
 
th’


361 
ş—¹ext
 = "(AH)"

362 
–£if
 
´Ùo
 =ğ

.
PROTO_GRE
 
th’


363 
ş—¹ext
 = "(GRE)"

365 
ş—¹ext
 = "(unknown)"

366 
’d


368  
	`fÜm©
("0x%02x %s", 
´Ùo
, 
ş—¹ext
)

369 
’d


371 --- 
S‘
 
the
 
checksum
.

372 --- @
·¿m
 
Checksum
 
of
 
the
 

 
h—d”
 
as
 16 
b™
 
š‹g”
.

373 --- @
£e
 
4H—d”
:
ÿlcuÏ‹Checksum


374 --- @
£e
 
pkt
:
ofæßdUdpChecksum


375 
funùiÚ
 
4H—d”
:
	$£tChecksum
()

376 ğ
Ü
 0

377 
£lf
.
cs
 = 
	$htÚ16
()

378 
’d


380 --- 
R‘r›ve
 
the
 
checksum
.

381 --- @ 
Checksum
 
as
 16 
b™
 
š‹g”
.

382 
funùiÚ
 
4H—d”
:
	$g‘Checksum
()

383  
	$htÚ16
(
£lf
.
cs
)

384 
’d


386 --- 
R‘r›ve
 
the
 
checksum
.

387 --- @ 
Checksum
 
as
 
¡ršg
.

388 
funùiÚ
 
4H—d”
:
	$g‘ChecksumSŒšg
()

389  
	`fÜm©
("0x%04x", 
£lf
:
	$g‘Checksum
())

390 
’d


392 --- 
C®cuÏ‹
 
ªd
 
£t
 
the
 
checksum
.

393 --- 
If
 
possibË
 
u£
 
checksum
 
ofæßdšg
 
š¡—d
.

394 --- @
£e
 
pkt
:
ofæßdUdpChecksum


395 
funùiÚ
 
4H—d”
:
	$ÿlcuÏ‹Checksum
()

396 
£lf
:
	`£tChecksum
(è-- 
ju¡
 
to
 
be
 
	`su»
 (
·ck‘
 
may
 b
»u£d
); 
mu¡
 be 0

397 
£lf
:
	`£tChecksum
(
	`htÚ16
(
	$checksum
(
£lf
, 20)))

398 
’d


400 --- 
S‘
 
the
 
de¡š©iÚ
 
add»ss
.

401 --- @
·¿m
 
Add»ss
 
š
 'uniÚ ip4_add»ss' 
fÜm©
.

402 
funùiÚ
 
4H—d”
:
	$£tD¡
()

403 
£lf
.
d¡
:
	$£t
()

404 
’d


406 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
IP
 
add»ss
.

407 --- @ 
Add»ss
 
š
 'uniÚ ip4_add»ss' 
fÜm©
.

408 
funùiÚ
 
4H—d”
:
	$g‘D¡
()

409  
£lf
.
d¡
:
	$g‘
()

410 
’d


412 --- 
S‘
 
the
 
sourû
 
add»ss
.

413 --- @
·¿m
 
Add»ss
 
š
 'uniÚ ip4_add»ss' 
fÜm©
.

414 
funùiÚ
 
4H—d”
:
	$£tSrc
()

415 
£lf
.
¤c
:
	$£t
()

416 
’d


418 --- 
R‘r›ve
 
the
 
sourû
 
IP
 
add»ss
.

419 --- @ 
Add»ss
 
š
 'uniÚ ip4_add»ss' 
fÜm©
.

420 
funùiÚ
 
4H—d”
:
	$g‘Src
()

421  
£lf
.
¤c
:
	$g‘
()

422 
’d


424 --- 
S‘
 
the
 
de¡š©iÚ
 
add»ss
.

425 --- @
·¿m
 
¡r
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

426 
funùiÚ
 
4H—d”
:
	$£tD¡SŒšg
(
¡r
)

427 
£lf
.
d¡
:
	$£tSŒšg
(
¡r
)

428 
’d


430 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
IP
 
add»ss
.

431 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

432 
funùiÚ
 
4H—d”
:
	$g‘D¡SŒšg
()

433  
£lf
.
d¡
:
	$g‘SŒšg
()

434 
’d


436 --- 
S‘
 
the
 
sourû
 
add»ss
.

437 --- @
·¿m
 
¡r
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

438 
funùiÚ
 
4H—d”
:
	$£tSrcSŒšg
(
¡r
)

439 
£lf
.
¤c
:
	$£tSŒšg
(
¡r
)

440 
’d


442 --- 
R‘r›ve
 
the
 
sourû
 
IP
 
add»ss
.

443 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

444 
funùiÚ
 
4H—d”
:
	$g‘SrcSŒšg
()

445  
£lf
.
¤c
:
	$g‘SŒšg
()

446 
’d


448 
funùiÚ
 
4H—d”
:
	$g‘O±iÚsSŒšg
()

449 
loÿl
 
by‹s
 = 
£lf
:
	$g‘V¬ŸbËL’gth
()

450 
by‹s
 <ğ0 
th’


452 
’d


453 
loÿl
 
İtiÚs
 = 
ffi
.
	`ÿ¡
("ušt8_t*", 
£lf
.options)

454 
loÿl
 
¡r
 = "0x"

455 
i
 = 0, 
by‹s
 - 1 do

456 
¡r
 = sŒ .. 
¡ršg
.
	`fÜm©
("%02x", 
İtiÚs
[
i
])

457 
’d


458  
¡r


459 
’d


461 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 

 
h—d”
.

462 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

463 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

464 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
V”siÚ
, 
H—d”L’gth
, 
TOS
, 
L’gth
, 
ID
, 
FÏgs
, 
F¿gm’t
, 
TTL
, 
PrÙocŞ
, 
Checksum
, 
Src
, 
D¡


465 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ip4'.

466 --- @
code


467 --- 
	`fl
(è--- 
Úly
  
v®ues


468 --- 
fl
{ 
Src
="1.1.1.1", 
TTL
=100 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 ipSrø
ªd
 
	gTTL


469 --- @
’dcode


470 
funùiÚ
 
	g4H—d”
:
	$fl
(
¬gs
, 
´e
)

471 
¬gs
 =‡rg 
Ü
 {
	}
}

472 
´e
 =…» 
Ü
 "ip4"

474 
£lf
:
£tV”siÚ
(
¬gs
[
´e
 .. "Version"])

475 
£lf
:
£tH—d”L’gth
(
¬gs
[
´e
 .. "HeaderLength"])

476 
£lf
:
£tTOS
(
¬gs
[
´e
 .. "TOS"])

477 
£lf
:
£tL’gth
(
¬gs
[
´e
 .. "Length"])

478 
£lf
:
£tID
(
¬gs
[
´e
 .. "ID"])

479 
£lf
:
£tFÏgs
(
¬gs
[
´e
 .. "Flags"])

480 
£lf
:
£tF¿gm’t
(
¬gs
[
´e
 .. "Fragment"])

481 
£lf
:
£tTTL
(
¬gs
[
´e
 .. "TTL"])

482 
£lf
:
£tPrÙocŞ
(
¬gs
[
´e
 .. "Protocol"])

483 
£lf
:
£tChecksum
(
¬gs
[
´e
 .. "Checksum"])

485 
loÿl
 
¤c
 = 
´e
 .. "Src"

486 
loÿl
 
d¡
 = 
´e
 .. "Dst"

487 
¬gs
[
¤c
] =‡rgs[¤c] 
Ü
 "192.168.1.1"

488 
¬gs
[
d¡
] =‡rgs[d¡] 
Ü
 "192.168.1.2"

490 -- 
some
 
»asÚ
 
the
 
add»ss
 
is
 
š
 'uniÚ ip4_add»ss' 
fÜm©
, 
cİe
 
w™h
 
™


491 
ty³
(
¬gs
[
¤c
]è=ğ"¡ršg" 
th’


492 
£lf
:
	$£tSrcSŒšg
(
¬gs
[
¤c
])

494 
£lf
:
	$£tSrc
(
¬gs
[
¤c
])

495 
’d


496 
	`ty³
(
¬gs
[
d¡
]è=ğ"¡ršg" 
th’


497 
£lf
:
	$£tD¡SŒšg
(
¬gs
[
d¡
])

499 
£lf
:
	$£tD¡
(
¬gs
[
d¡
])

500 
’d


501 
’d


503 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

504 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ip4'.

505 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

506 --- @
£e
 
4H—d”
:
fl


507 
funùiÚ
 
4H—d”
:
	$g‘
(
´e
)

508 
´e
 =…» 
Ü
 "ip4"

510 
loÿl
 
¬gs
 = {
	}
}

511 
¬gs
[
´e
 .. "Src"] = 
£lf
:
	$g‘SrcSŒšg
()

512 
¬gs
[
´e
 .. "D¡"] = 
£lf
:
	$g‘D¡SŒšg
()

513 
¬gs
[
´e
 .. "V”siÚ"] = 
£lf
:
	$g‘V”siÚ
()

514 
¬gs
[
´e
 .. "H—d”L’gth"] = 
£lf
:
	$g‘H—d”L’gth
()

515 
¬gs
[
´e
 .. "TOS"] = 
£lf
:
	$g‘TOS
()

516 
¬gs
[
´e
 .. "L’gth"] = 
£lf
:
	$g‘L’gth
()

517 
¬gs
[
´e
 .. "ID"] = 
£lf
:
	$g‘ID
()

518 
¬gs
[
´e
 .. "FÏgs"] = 
£lf
:
	$g‘FÏgs
()

519 
¬gs
[
´e
 .. "F¿gm’t"] = 
£lf
:
	$g‘F¿gm’t
()

520 
¬gs
[
´e
 .. "TTL"] = 
£lf
:
	$g‘TTL
()

521 
¬gs
[
´e
 .. "PrÙocŞ"] = 
£lf
:
	$g‘PrÙocŞ
()

522 
¬gs
[
´e
 .. "Checksum"] = 
£lf
:
	$g‘Checksum
()

524  
¬gs


525 
’d


527 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

528 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

529 
funùiÚ
 
4H—d”
:
	$g‘SŒšg
()

530  "IP4 " .. 
£lf
:
	`g‘SrcSŒšg
(è.. " > " .. s–f:
	`g‘D¡SŒšg
(è.. " v” " .. s–f:
	`g‘V”siÚSŒšg
()

531 .. " ihÈ" .. 
£lf
:
	`g‘H—d”L’gthSŒšg
(è.. "o " .. s–f:
	`g‘TOSSŒšg
(è.. "†’ " .. s–f:
	`g‘L’gthSŒšg
()

532 .. " id " .. 
£lf
:
	`g‘IDSŒšg
(è.. " fÏg " .. s–f:
	`g‘FÏgsSŒšg
(è.. " f¿g " .. s–f:
	`g‘F¿gm’tSŒšg
()

533 .. " " .. 
£lf
:
	`g‘TTLSŒšg
(è.. "…rÙØ" .. s–f:
	`g‘PrÙocŞSŒšg
(è.. " cksum " .. s–f:
	`g‘ChecksumSŒšg
()

534 .. " [" .. 
£lf
:
	`g‘O±iÚsSŒšg
() .. "]"

535 
’d


537 -- 
M­s
 
h—d”s
 
to
 
»¥eùive
 
´ÙocŞ
 
v®ue
.

538 -- 
This
 
li¡
 
should
 
be
 
ex‹nded
 
wh’ev”
 
a
 
Ãw
 
´ÙocŞ
 
is
 
added
 
to
 'IPv4 constants'.

539 
loÿl
 
m­NamePrÙo
 = {

540 
icmp
 = 

.
PROTO_ICMP
,

541 
udp
 = 

.
PROTO_UDP
,

542 
tı
 = 

.
PROTO_TCP
,

543 
e¥
 = 

.
PROTO_ESP
,

544 
ah
 = 

.
PROTO_AH
,

545 
g»
 = 

.
PROTO_GRE
,

546 
	}
}

548 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
Úe
 (
š
 
a
 
·ck‘
).

549 --- 
FÜ
 
	gš¡ªû
: 
š
 
tı
/
udp
 
ba£d
 
Ú
 
the
 
pÜts
.

550 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


551 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

552 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. 'udp', 'icmp', 
n
)

553 
funùiÚ
 
4H—d”
:
	$»sŞveNextH—d”
()

554 
loÿl
 
´Ùo
 = 
£lf
:
	$g‘PrÙocŞ
()

555 
Çme
, 
_´Ùo
 
š
 
	$·œs
(
m­NamePrÙo
) do

556 
´Ùo
 =ğ
_´Ùo
 
th’


557  
Çme


558 
’d


559 
’d


560  
n


561 
’d


563 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
).

564 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength.

565 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e
.

566 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl
.

567 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'ip4'

568 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
Also
)

569 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


570 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


571 --- @ 
TabË
 
of
 
ÇmedArgs


572 --- @
£e
 
4H—d”
:
fl


573 
funùiÚ
 
4H—d”
:
	`£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
, 
h—d”L’gth
)

574 -- 
£t
 
Ëngth


575 
nÙ
 
ÇmedArgs
[
´e
 .. "L’gth"] 
ªd
‚amedArgs["pktL’gth"] 
th’


576 
ÇmedArgs
[
´e
 .. "L’gth"] =‚amedArgs["pktL’gth"] - 
accumuÏ‹dL’gth


577 
’d


579 -- 
£t
 
´ÙocŞ


580 
nÙ
 
ÇmedArgs
[
´e
 .. "PrÙocŞ"] 
th’


581 
Çme
, 
ty³
 
š
 
	$·œs
(
m­NamePrÙo
) do

582 
ÃxtH—d”
 =ğ
Çme
 
th’


583 
ÇmedArgs
[
´e
 .. "PrÙocŞ"] = 
ty³


585 
’d


586 
’d


587 
’d


589 -- 
£t
 
IHL


590 
nÙ
 
ÇmedArgs
[
´e
 .. "H—d”L’gth"] 
th’


591 
ÇmedArgs
[
´e
 .. "H—d”L’gth"] = 
h—d”L’gth
 / 4

592 
’d


594  
ÇmedArgs


595 
’d


597 
funùiÚ
 
4H—d”
:
	$g‘V¬ŸbËL’gth
()

598  (
£lf
:
	`g‘H—d”L’gth
() - 5) * 4

599 
’d


602 ---- 
M‘©y³s


605 
ffi
.
	`m‘©y³
("uniÚ ip4_add»ss", 
4Addr
)

606 

.
m‘©y³
 = 
4H—d”


608  



	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ip6.lua

2 --- @
fe
 
	g6
.
	glua


3 --- @
br›f
 
IÁ”Ãt
 
	$´ÙocŞ
 (
v6
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
6_add»ss
 
ªd
 
6_h—d”
 
¡ruùs


5 --- 
Inşudes
:

6 --- - 
IP6
 
cÚ¡ªts


7 --- - 
IP6
 
add»ss
 
ut™y


8 --- - 
IP6
 
h—d”
 
ut™y


9 --- - 
Defš™iÚ
 
of
 
IP6
 
·ck‘s


12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "utils"

15 
»quœe
 "proto.template"

16 
loÿl
 
š™H—d”
 = initHeader

18 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

19 
loÿl
 
Áoh16
, 
htÚ16
 =‚toh16, hton16

20 
loÿl
 
bsw­
 = bswap

21 
loÿl
 
bsw­16
 = bswap16

22 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
ğ
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

23 
loÿl
 
i¡y³
 = 
ffi
.istype

24 
loÿl
 
fÜm©
 = 
¡ršg
.format

27 ---- 
IP6
 
cÚ¡ªts


30 --- 
IP6
 
´ÙocŞ
 
cÚ¡ªts


31 
loÿl
 
6
 = {
	}
}

33 --- 
NextH—d”
 
f›ld
 
v®ue
 
Tı


34 
6
.
PROTO_TCP
 = 0x06

35 --- 
NextH—d”
 
f›ld
 
v®ue
 
Udp


36 
6
.
PROTO_UDP
 = 0x11

37 
6
.
PROTO_GRE
 = 0x2f

38 --- 
NextH—d”
 
f›ld
 
v®ue
 
Icmp


39 
6
.
PROTO_ICMP
 = 0x3a -- 58

40 
6
.
PROTO_ESP
 = 0x32

41 
6
.
PROTO_AH
 = 0x33

45 ---- 
IPv6
 
add»s£s


48 
ffi
.
cdef
[[

49 
	u6_add»ss
 {

50 
ušt8_t
 
ušt8
[16];

51 
ušt32_t
 
	mušt32
[4];

52 
ušt64_t
 
	mušt64
[2];

56 --- 
ModuË
 
6_add»ss
 

57 
loÿl
 
	g6Addr
 = {}

58 
6Addr
.
__šdex
 = ip6Addr

59 
loÿl
 
6AddrTy³
 = 
ffi
.
ty³of
("union ip6_address")

61 --- 
R‘r›ve
 
the
 
IPv6
 
add»ss
.

62 --- @ 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

63 
funùiÚ
 
6Addr
:
	$g‘
()

64 
loÿl
 
addr
 = 
	$6AddrTy³
()

65 
addr
.
ušt32
[0] = 
	$bsw­
(
£lf
.
ušt32
[3])

66 
addr
.
ušt32
[1] = 
	$bsw­
(
£lf
.
ušt32
[2])

67 
addr
.
ušt32
[2] = 
	$bsw­
(
£lf
.
ušt32
[1])

68 
addr
.
ušt32
[3] = 
	$bsw­
(
£lf
.
ušt32
[0])

69  
addr


70 
’d


72 --- 
S‘
 
the
 
IPv6
 
add»ss
.

73 --- @
·¿m
 
addr
 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

74 
funùiÚ
 
6Addr
:
	$£t
(
addr
)

75 
£lf
.
ušt32
[0] = 
	$bsw­
(
addr
.
ušt32
[3])

76 
£lf
.
ušt32
[1] = 
	$bsw­
(
addr
.
ušt32
[2])

77 
£lf
.
ušt32
[2] = 
	$bsw­
(
addr
.
ušt32
[1])

78 
£lf
.
ušt32
[3] = 
	$bsw­
(
addr
.
ušt32
[0])

79 
’d


81 --- 
S‘
 
the
 
IPv6
 
add»ss
.

82 --- @
·¿m
 

 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

83 
funùiÚ
 
6Addr
:
	$£tSŒšg
(

)

84 
£lf
:
	`£t
(
	$·r£IP6Add»ss
(

))

85 
’d


87 --- 
Te¡
 
equ®™y
 
of
 
two
 
IPv6
 
add»s£s
.

88 --- @
·¿m
 
lhs
 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

89 --- @
·¿m
 
rhs
 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

90 --- @ 
Œue
 
equ®
, 
çl£
 
Ùh”wi£
.

91 
funùiÚ
 
6Addr
.
	$__eq
(
lhs
, 
rhs
)

92  
	$i¡y³
(
6AddrTy³
, 
lhs
è
ªd
 
	$i¡y³
(
6AddrTy³
, 
rhs
è
ªd
 
lhs
.
ušt64
[0] ==„hs.uint64[0]‡nd†hs.uint64[1] ==„hs.uint64[1]

93 
’d


95 --- 
Add
 
a
 
numb”
 
to
 
ª
 
IPv6
 
add»ss
.

96 --- 
Max
. 64b
™
, 
commutive
.

97 --- @
·¿m
 
lhs
 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

98 --- @
·¿m
 
rhs
 
Numb”
 
to
 
	`add
 (64 
b™
 
š‹g”
).

99 --- @ 
ResuÉšg
 
add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

100 
funùiÚ
 
6Addr
.
	`__add
(
lhs
, 
rhs
)

101 -- 
ÿlc
 
	`
 (
£lf
è+ 
	$numb”
 (
v®
)

102 
loÿl
 
£lf
, 
v®


103 
	$i¡y³
(
6AddrTy³
, 
lhs
è
th’


104 
£lf
 = 
lhs


105 
v®
 = 
rhs


107 -- 
commutive
 
numb”
 + 



108 
£lf
 = 
rhs


109 
v®
 = 
lhs


110 
’d
 -- 
TODO
: 

 + ip?

111 
loÿl
 
addr
 = 
	$6AddrTy³
()

112 
loÿl
 
low
, 
high
 = 
£lf
.
ušt64
[0], self.uint64[1]

113 
low
 =†ow + 
v®


114 -- 
hªdË
 
ov”æow


115 
low
 < 
v®
 
ªd
 v® > 0 
th’


116 
high
 = high + 1

117 -- 
hªdË
 
und”æow


118 
–£if
 
low
 > -
v®
 
ªd
 v® < 0 
th’


119 
high
 = high - 1

120 
’d


121 
addr
.
ušt64
[0] = 
low


122 
addr
.
ušt64
[1] = 
high


123  
addr


124 
’d


126 --- 
Add
 
a
 
numb”
 
to
 
ª
 
IPv6
 
add»ss
 
š
-
¶aû
.

127 --- 
Max
 64 
b™
.

128 --- @
·¿m
 
v®
 
Numb”
 
to
 
	`add
 (64 
b™
 
š‹g”
).

129 
funùiÚ
 
6Addr
:
	`add
(
v®
)

130 -- 
ÿlc
 
	`
 (
£lf
è+ 
	$numb”
 (
v®
)

131 
loÿl
 
low
, 
high
 = 
	`bsw­
(
£lf
.
ušt64
[1]), 
	$bsw­
(
£lf
.
ušt64
[0])

132 
low
 =†ow + 
v®


133 -- 
hªdË
 
ov”æow


134 
low
 < 
v®
 
ªd
 v® > 0 
th’


135 
high
 = high + 1

136 -- 
hªdË
 
und”æow


137 
–£if
 
low
 > -
v®
 
ªd
 v® < 0 
th’


138 
high
 = high - 1

139 
’d


140 
£lf
.
ušt64
[1] = 
	$bsw­
(
low
)

141 
£lf
.
ušt64
[0] = 
	$bsw­
(
high
)

142 
’d


144 --- 
SubŒaù
 
a
 
numb”
 
äom
 
ª
 
IPv6
 
add»ss
.

145 --- 
Max
. 64 
b™
.

146 --- @
·¿m
 
v®
 
Numb”
 
to
 
	`sub¡¿ù
 (64 
b™
 
š‹g”
).

147 --- @ 
ResuÉšg
 
add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

148 
funùiÚ
 
6Addr
:
	$__sub
(
v®
)

149  
£lf
 + -
v®


150 
’d


152 
funùiÚ
 
6Addr
:
	$__É
(
Ùh”
)

153 
loÿl
 
£lfLow
, 
£lfHigh
 = 
	`bsw­
(
£lf
.
ušt64
[1]), 
	$bsw­
(
£lf
.
ušt64
[0])

154 
loÿl
 
Ùh”Low
, 
Ùh”High
 = 
	`bsw­
(
Ùh”
.
ušt64
[1]), 
	$bsw­
(
Ùh”
.
ušt64
[0])

155 
Ùh”High
 =ğ
£lfHigh
 
th’


156  
£lfLow
 < 
Ùh”Low


158  
£lfHigh
 < 
Ùh”High


159 
’d


160 
’d


162 --- 
R‘r›ve
 
the
 
¡ršg
 
»´e£Á©iÚ
 
of
 
ª
 
IPv6
 
add»ss
.

163 --- 
Assumes
 'uniÚ ip6_add»ss' 
is
 
š
 
ÃtwÜk
 
by‹Üd”
.

164 --- @
·¿m
 
doBy‹Sw­
 
O±iÚ®
 
chªge
 
the
 
by‹Üd”
 
of
h
6
 
add»ss
 
befÜe
 
»tuºšg
h
¡ršg
 
»´e£Á©iÚ
.

165 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

166 
funùiÚ
 
6Addr
:
	$g‘SŒšg
(
doBy‹Sw­
)

167 
doBy‹Sw­
 = doBy‹Sw­ 
Ü
 
çl£


168 
doBy‹Sw­
 
th’


169 
£lf
 = s–f:
	$g‘
()

170 
’d


172  ("%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x"):
	$fÜm©
(

173 
£lf
.
ušt8
[0], self.uint8[1], self.uint8[2], self.uint8[3],

174 
£lf
.
ušt8
[4], self.uint8[5], self.uint8[6], self.uint8[7],

175 
£lf
.
ušt8
[8], self.uint8[9], self.uint8[10], self.uint8[11],

176 
£lf
.
ušt8
[12], self.uint8[13], self.uint8[14], self.uint8[15]

178 
’d


182 ---- 
IPv6
 
h—d”


185 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


186 
6
.
h—d”FÜm©
 = [[

187 
ušt32_t
 
vtf
;

188 
ušt16_t
 
Ën
;

189 
ušt8_t
 
ÃxtH—d”
;

190 
ušt8_t
 
‰l
;

191 
6_add»ss
 
¤c
;

192 
6_add»ss
 
d¡
;

195 --- 
V¬ŸbË
 
sized
 
memb”


196 
6
.
h—d”V¬ŸbËMemb”
 = 
n


198 --- 
ModuË
 
6_h—d”
 

199 
loÿl
 
6H—d”
 = 
	$š™H—d”
()

200 
6H—d”
.
__šdex
 = ip6Header

202 --- 
S‘
 
the
 
v”siÚ
.

203 --- @
·¿m
 
IP6
 
h—d”
 
v”siÚ
 
as
 4 
b™
 
š‹g”
. 
Should
 
®ways
 
be
 '6'.

204 
funùiÚ
 
6H—d”
:
	$£tV”siÚ
()

205 ğ
Ü
 6

206 ğ
	`bªd
(
	`lshiá
(, 28), 0xf0000000è-- 
fl
 
to
 32 
b™s


208 
Şd
 = 
	$bsw­
(
£lf
.
vtf
)

209 
Şd
 = 
	`bªd
(Şd, 0x0fffffffè-- 
»move
 old 
v®ue


211 
£lf
.
vtf
 = 
	`bsw­
(
	$bÜ
(
Şd
, ))

212 
’d


214 --- 
R‘r›ve
 
the
 
v”siÚ
.

215 --- @ 
V”siÚ
 
as
 4 
b™
 
š‹g”
.

216 
funùiÚ
 
6H—d”
:
	$g‘V”siÚ
()

217  
	`bªd
(
	`rshiá
(
	`bsw­
(
£lf
.
vtf
), 28), 0x0000000f)

218 
’d


220 --- 
R‘r›ve
 
the
 
v”siÚ
.

221 --- @ 
V”siÚ
 
as
 
¡ršg
.

222 
funùiÚ
 
6H—d”
:
	$g‘V”siÚSŒšg
()

223  
£lf
:
	$g‘V”siÚ
()

224 
’d


226 --- 
S‘
 
the
 
Œaffic
 
şass
.

227 --- @
·¿m
 
T¿ffic
 
şass
 
of
 
the
 
6
 
h—d”
 
as
 8 
b™
 
š‹g”
.

228 
funùiÚ
 
6H—d”
:
	$£tT¿fficCÏss
()

229 ğ
Ü
 0

230 ğ
	`bªd
(
	`lshiá
(, 20), 0x0ff00000)

232 
Şd
 = 
	$bsw­
(
£lf
.
vtf
)

233 
Şd
 = 
	$bªd
(
Şd
, 0xf00fffff)

235 
£lf
.
vtf
 = 
	`bsw­
(
	$bÜ
(
Şd
, ))

236 
’d


238 --- 
R‘r›ve
 
the
 
Œaffic
 
şass
.

239 --- @ 
T¿ffic
 
şass
 
as
 8 
b™
 
š‹g”
.

240 
funùiÚ
 
6H—d”
:
	$g‘T¿fficCÏss
()

241  
	`bªd
(
	`rshiá
(
	`bsw­
(
£lf
.
vtf
), 20), 0x000000ff)

242 
’d


244 --- 
R‘r›ve
 
the
 
Œaffic
 
şass
.

245 --- @ 
T¿ffic
 
şass
 
as
 
¡ršg
.

246 
funùiÚ
 
6H—d”
:
	$g‘T¿fficCÏssSŒšg
()

247  
£lf
:
	$g‘T¿fficCÏss
()

248 
’d


250 --- 
S‘
 
the
 
æow
 
Ïb–
.

251 --- @
·¿m
 
Flow
 
Ïb–
 
of
 
the
 
6
 
h—d”
 
as
 20 
b™
 
š‹g”
.

252 
funùiÚ
 
6H—d”
:
	$£tFlowLab–
()

253 ğ
Ü
 0

254 ğ
	$bªd
(, 0x000fffff)

256 
Şd
 = 
	$bsw­
(
£lf
.
vtf
)

257 
Şd
 = 
	$bªd
(
Şd
, 0xfff00000)

259 
£lf
.
vtf
 = 
	`bsw­
(
	$bÜ
(
Şd
, ))

260 
’d


262 --- 
R‘r›ve
 
the
 
æow
 
Ïb–
.

263 --- @ 
Flow
 
Ïb–
 
as
 20 
b™
 
š‹g”
.

264 
funùiÚ
 
6H—d”
:
	$g‘FlowLab–
()

265  
	`bªd
(
	`bsw­
(
£lf
.
vtf
), 0x000fffff)

266 
’d


268 --- 
R‘r›ve
 
the
 
æow
 
Ïb–
.

269 --- @ 
Flow
 
Ïb–
 
as
 
¡ršg
.

270 
funùiÚ
 
6H—d”
:
	$g‘FlowLab–SŒšg
()

271  
£lf
:
	$g‘FlowLab–
()

272 
’d


274 --- 
S‘
 
the
 
·ylßd
 
Ëngth
.

275 --- @
·¿m
 
L’gth
 
of
 
the
 
6
 
h—d”
 
	`·ylßd
 (
h’û
, 
exşudšg
 
l2
 
ªd
 
l3
 
h—d”s
). 16 
b™
 
š‹g”
.

276 
funùiÚ
 
6H—d”
:
	$£tL’gth
()

277 ğ
Ü
 8 -- 
w™h
 
‘h
 + 
UDP
 -> 
mšimum
 66

278 
£lf
.
Ën
 = 
	$htÚ16
()

279 
’d


281 --- 
R‘r›ve
 
the
 
Ëngth
.

282 --- @ 
L’gth
 
as
 16 
b™
 
š‹g”
.

283 
funùiÚ
 
6H—d”
:
	$g‘L’gth
()

284  
	$htÚ16
(
£lf
.
Ën
)

285 
’d


287 --- 
R‘r›ve
 
the
 
Ëngth
.

288 --- @ 
L’gth
 
as
 
¡ršg
.

289 
funùiÚ
 
6H—d”
:
	$g‘L’gthSŒšg
()

290  
£lf
:
	$g‘L’gth
()

291 
’d


293 --- 
S‘
 
the
 
Ãxt
 
h—d”
.

294 --- @
·¿m
 
Next
 
h—d”
 
of
 
the
 
6
 h—d” 
as
 8 
b™
 
š‹g”
.

295 
funùiÚ
 
6H—d”
:
	$£tNextH—d”
()

296 ğ
Ü
 
6
.
PROTO_UDP


297 
£lf
.
ÃxtH—d”
 = 

298 
’d


300 --- 
R‘r›ve
 
the
 
Ãxt
 
h—d”
.

301 --- @ 
Next
 
h—d”
 
as
 8 
b™
 
š‹g”
.

302 
funùiÚ
 
6H—d”
:
	$g‘NextH—d”
()

303  
£lf
.
ÃxtH—d”


304 
’d


306 --- 
R‘r›ve
 
the
 
Ãxt
 
h—d”
.

307 --- @ 
Next
 
h—d”
 
as
 
¡ršg
.

308 
funùiÚ
 
6H—d”
:
	$g‘NextH—d”SŒšg
()

309 
loÿl
 
´Ùo
 = 
£lf
:
	$g‘NextH—d”
()

310 
loÿl
 
ş—¹ext
 = ""

312 
´Ùo
 =ğ
6
.
PROTO_ICMP
 
th’


313 
ş—¹ext
 = "(ICMP)"

314 
–£if
 
´Ùo
 =ğ
6
.
PROTO_UDP
 
th’


315 
ş—¹ext
 = "(UDP)"

316 
–£if
 
´Ùo
 =ğ
6
.
PROTO_TCP
 
th’


317 
ş—¹ext
 = "(TCP)"

318 
–£if
 
´Ùo
 =ğ
6
.
PROTO_ESP
 
th’


319 
ş—¹ext
 = "(ESP)"

320 
–£if
 
´Ùo
 =ğ
6
.
PROTO_AH
 
th’


321 
ş—¹ext
 = "(AH)"

322 
–£if
 
´Ùo
 =ğ
6
.
PROTO_GRE
 
th’


323 
ş—¹ext
 = "(GRE)"

325 
ş—¹ext
 = "(unknown)"

326 
’d


328  
	`fÜm©
("0x%02x %s", 
´Ùo
, 
ş—¹ext
)

329 
’d


331 --- 
S‘
 
the
 
time
-
to
-
	`live
 (
TTL
).

332 --- @
·¿m
 
TTL
 
of
 
the
 
6
 
h—d”
 
as
 8 
b™
 
š‹g”
.

333 
funùiÚ
 
6H—d”
:
	$£tTTL
()

334 ğ
Ü
 64

335 
£lf
.
‰l
 = 

336 
’d


338 --- 
R‘r›ve
 
the
 
time
-
to
-
live
.

339 --- @ 
TTL
 
as
 8 
b™
 
š‹g”
.

340 
funùiÚ
 
6H—d”
:
	$g‘TTL
()

341  
£lf
.
‰l


342 
’d


344 --- 
R‘r›ve
 
the
 
time
-
to
-
live
.

345 --- @ 
TTL
 
as
 
¡ršg
.

346 
funùiÚ
 
6H—d”
:
	$g‘TTLSŒšg
()

347  
£lf
:
	$g‘TTL
()

348 
’d


350 --- 
S‘
 
the
 
de¡š©iÚ
 
add»ss
.

351 --- @
·¿m
 
addr
 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

352 
funùiÚ
 
6H—d”
:
	$£tD¡
(
addr
)

353 
£lf
.
d¡
:
	$£t
(
addr
)

354 
’d


356 --- 
R‘r›ve
 
the
 
IP6
 
de¡š©iÚ
 
add»ss
.

357 --- @ 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

358 
funùiÚ
 
6H—d”
:
	$g‘D¡
()

359  
£lf
.
d¡
:
	$g‘
()

360 
’d


362 --- 
S‘
 
the
 
sourû
 
add»ss
.

363 --- @
·¿m
 
addr
 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

364 
funùiÚ
 
6H—d”
:
	$£tSrc
(
addr
)

365 
£lf
.
¤c
:
	$£t
(
addr
)

366 
’d


368 --- 
R‘r›ve
 
the
 
IP6
 
sourû
 
add»ss
.

369 --- @ 
Add»ss
 
š
 'uniÚ ip6_add»ss' 
fÜm©
.

370 
funùiÚ
 
6H—d”
:
	$g‘Src
()

371  
£lf
.
¤c
:
	$g‘
()

372 
’d


374 --- 
S‘
 
the
 
de¡š©iÚ
 
add»ss
.

375 --- @
·¿m
 
¡r
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

376 
funùiÚ
 
6H—d”
:
	$£tD¡SŒšg
(
¡r
)

377 
£lf
:
	`£tD¡
(
	$·r£IP6Add»ss
(
¡r
))

378 
’d


380 --- 
R‘r›ve
 
the
 
IP6
 
de¡š©iÚ
 
add»ss
.

381 --- @ 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

382 
funùiÚ
 
6H—d”
:
	$g‘D¡SŒšg
()

383  
£lf
.
d¡
:
	$g‘SŒšg
()

384 
’d


386 --- 
S‘
 
the
 
sourû
 
add»ss
.

387 --- @
·¿m
 
¡r
 
Add»ss
 
š
 
¡ršg
 
fÜm©
.

388 
funùiÚ
 
6H—d”
:
	$£tSrcSŒšg
(
¡r
)

389 
£lf
:
	`£tSrc
(
	$·r£IP6Add»ss
(
¡r
))

390 
’d


392 --- 
R‘r›ve
 
the
 
IP6
 
sourû
 
add»ss
.

393 --- @ 
Add»ss
 
š
 
sourû
 
fÜm©
.

394 
funùiÚ
 
6H—d”
:
	$g‘SrcSŒšg
()

395  
£lf
.
¤c
:
	$g‘SŒšg
()

396 
’d


398 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
6
 
h—d”
.

399 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

400 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

401 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
6V”siÚ
, 
6T¿fficCÏss
, 
6FlowLab–
, 
6L’gth
, 
6NextH—d”
, 
6TTL
, 
6Src
, 
6D¡


402 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ip6'.

403 --- @
code


404 --- 
	`fl
(è--- 
Úly
  
v®ues


405 --- 
fl
{ 
6Src
="f880::ab", 
6TTL
=101 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 ip6Srø
ªd
 
	g6TTL


406 --- @
’dcode


407 
funùiÚ
 
	g6H—d”
:
	$fl
(
¬gs
, 
´e
)

408 
¬gs
 =‡rg 
Ü
 {
	}
}

409 
´e
 =…» 
Ü
 "ip6"

411 
£lf
:
£tV”siÚ
(
¬gs
[
´e
 .. "Version"])

412 
£lf
:
£tT¿fficCÏss
(
¬gs
[
´e
 .. "TrafficClass"])

413 
£lf
:
£tFlowLab–
(
¬gs
[
´e
 .. "FlowLabel"])

414 
£lf
:
£tL’gth
(
¬gs
[
´e
 .. "Length"])

415 
£lf
:
£tNextH—d”
(
¬gs
[
´e
 .. "NextHeader"])

416 
£lf
:
£tTTL
(
¬gs
[
´e
 .. "TTL"])

418 
loÿl
 
¤c
 = 
´e
 .. "Src"

419 
loÿl
 
d¡
 = 
´e
 .. "Dst"

420 
¬gs
[
¤c
] =‡rgs[¤c] 
Ü
 "fe80::1"

421 
¬gs
[
d¡
] =‡rgs[d¡] 
Ü
 "fe80::2"

423 -- 
some
 
»asÚ
 
the
 
add»ss
 
is
 
š
 'uniÚ ip6_add»ss' 
fÜm©
, 
cİe
 
w™h
 
™


424 
ty³
(
¬gs
[
¤c
]è=ğ"¡ršg" 
th’


425 
£lf
:
	$£tSrcSŒšg
(
¬gs
[
¤c
])

427 
£lf
:
	$£tSrc
(
¬gs
[
¤c
])

428 
’d


429 
	`ty³
(
¬gs
[
d¡
]è=ğ"¡ršg" 
th’


430 
£lf
:
	$£tD¡SŒšg
(
¬gs
[
d¡
])

432 
£lf
:
	$£tD¡
(
¬gs
[
d¡
])

433 
’d


434 
’d


436 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

437 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ip6'.

438 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

439 --- @
£e
 
6H—d”
:
fl


440 
funùiÚ
 
6H—d”
:
	$g‘
(
´e
)

441 
´e
 =…» 
Ü
 "ip6"

443 
loÿl
 
¬gs
 = {
	}
}

444 
¬gs
[
´e
 .. "Src"] = 
£lf
:
	$g‘SrcSŒšg
()

445 
¬gs
[
´e
 .. "D¡"] = 
£lf
:
	$g‘D¡SŒšg
()

446 
¬gs
[
´e
 .. "V”siÚ"] = 
£lf
:
	$g‘V”siÚ
()

447 
¬gs
[
´e
 .. "T¿fficCÏss"] = 
£lf
:
	$g‘T¿fficCÏss
()

448 
¬gs
[
´e
 .. "FlowLab–"] = 
£lf
:
	$g‘FlowLab–
()

449 
¬gs
[
´e
 .. "L’gth"] = 
£lf
:
	$g‘L’gth
()

450 
¬gs
[
´e
 .. "NextH—d”"] = 
£lf
:
	$g‘NextH—d”
()

451 
¬gs
[
´e
 .. "TTL"] = 
£lf
:
	$g‘TTL
()

453  
¬gs


454 
’d


456 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

457 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

458 
funùiÚ
 
6H—d”
:
	$g‘SŒšg
()

459  "IP6 " .. 
£lf
:
	`g‘SrcSŒšg
(è.. " > " .. s–f:
	`g‘D¡SŒšg
(è.. " v” " .. s–f:
	`g‘V”siÚSŒšg
()

460 .. "ø" .. 
£lf
:
	`g‘T¿fficCÏssSŒšg
(è.. " fÈ" .. s–f:
	`g‘FlowLab–SŒšg
(è.. "†’ " .. s–f:
	`g‘L’gthSŒšg
()

461 .. "‚exˆ" .. 
£lf
:
	`g‘NextH—d”SŒšg
(è.. " " .. s–f:
	$g‘TTLSŒšg
()

462 
’d


464 -- 
M­s
 
h—d”s
 
to
 
»¥eùive
 
ÃxtH—d”
 
v®ue
.

465 -- 
This
 
li¡
 
should
 
be
 
ex‹nded
 
wh’ev”
 
a
 
Ãw
 
´ÙocŞ
 
is
 
added
 
to
 'IPv6 constants'.

466 
loÿl
 
m­NamePrÙo
 = {

467 
icmp
 = 
6
.
PROTO_ICMP
,

468 
udp
 = 
6
.
PROTO_UDP
,

469 
tı
 = 
6
.
PROTO_TCP
,

470 
e¥
 = 
6
.
PROTO_ESP
,

471 
ah
 = 
6
.
PROTO_AH
,

472 
g»
 = 
6
.
PROTO_GRE
,

473 
	}
}

475 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
Úe
 (
š
 
a
 
·ck‘
).

476 --- 
FÜ
 
	gš¡ªû
: 
š
 
tı
/
udp
 
ba£d
 
Ú
 
the
 
pÜts
.

477 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


478 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

479 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. 'udp', 'icmp', 
n
)

480 
funùiÚ
 
6H—d”
:
	$»sŞveNextH—d”
()

481 
loÿl
 
´Ùo
 = 
£lf
:
	$g‘NextH—d”
()

482 
Çme
, 
_´Ùo
 
š
 
	$·œs
(
m­NamePrÙo
) do

483 
´Ùo
 =ğ
_´Ùo
 
th’


484  
Çme


485 
’d


486 
’d


487  
n


488 
’d


490 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
).

491 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength.

492 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e
.

493 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl
.

494 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'ip6'

495 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
Also
)

496 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


497 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


498 --- @ 
TabË
 
of
 
ÇmedArgs


499 --- @
£e
 
6H—d”
:
fl


500 
funùiÚ
 
6H—d”
:
	`£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
, 
h—d”L’gth
)

501 -- 
£t
 
Ëngth


502 
nÙ
 
ÇmedArgs
[
´e
 .. "L’gth"] 
ªd
‚amedArgs["pktL’gth"] 
th’


503 
ÇmedArgs
[
´e
 .. "L’gth"] =‚amedArgs["pktL’gth"] - (
accumuÏ‹dL’gth
 + 40)

504 
’d


506 -- 
£t
 
´ÙocŞ


507 
nÙ
 
ÇmedArgs
[
´e
 .. "NextH—d”"] 
th’


508 
Çme
, 
ty³
 
š
 
	$·œs
(
m­NamePrÙo
) do

509 
ÃxtH—d”
 =ğ
Çme
 
th’


510 
ÇmedArgs
[
´e
 .. "NextH—d”"] = 
ty³


512 
’d


513 
’d


514 
’d


515  
ÇmedArgs


516 
’d


520 ---- 
M‘©y³s


523 
ffi
.
	`m‘©y³
("uniÚ ip6_add»ss", 
6Addr
)

524 
6
.
m‘©y³
 = 
6H—d”


526  
6


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ipfix.lua

2 --- @
fe
 
	gfix
.
	glua


3 --- @
br›f
 
IPFIX
 
·ck‘
 
	gg’”©iÚ
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
fix_h—d”
 
	g¡ruùs


5 --- 
	gInşudes
:

6 --- - 
IPFIX
 
cÚ¡ªts


7 --- - 
IPFIX
 
h—d”
 
ut™y


8 --- - 
Defš™iÚ
 
of
 
IPFIX
 
·ck‘s


9 --- - 
FunùiÚs
 
to
 
ü—‹
 
ª
 
IPFIX
 
Mes§ge


12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
»quœe
 "utils"

15 
»quœe
 "proto.template"

16 
loÿl
 
š™H—d”
 = initHeader

18 
loÿl
 
Áoh
, 
	ghtÚ
 =‚toh, 
htÚ


19 
loÿl
 
	gÁoh16
, 
	ghtÚ16
 = 
Áoh16
, 
htÚ16


20 
loÿl
 
	gbsw­
 = 
bsw­


21 
loÿl
 
bsw­16
 = bswap16

22 
loÿl
 
bÜ
, 
	gbªd
, 
	gbnÙ
, 
	grshiá
, 
	glshiá
ğ
b™
.bÜ, 
	gb™
.band, bit.bnot, bit.rshift, bit.lshift

25 ---- 
IPFIX
 
	gcÚ¡ªts


28 --- 
IPFIX
 
´ÙocŞ
 
cÚ¡ªts


29 
loÿl
 
	gfix
 = {}

31 -- 
N‘Flow
 
v5


32 
fix
.
VERSION_NFV5
 = 0x0005

33 -- 
N‘Flow
 
v9


34 
fix
.
VERSION_NFV9
 = 0x0009

35 -- 
IPFIX


36 
fix
.
VERSION_IPFIX
 = 0x000a

38 -- 
S‘
 
ID
 
‹m¶©e
 
£t


39 
fix
.
ID_TEMPLATE_SET
 = 0x0002

40 -- 
S‘
 
ID
 
İtiÚ
 
‹m¶©e
 
£t


41 
fix
.
ID_OPTION_TEMPLATE_SET
 = 0x0003

42 -- 
Mšimum
 
d©a
 
£t
 
ID


43 
fix
.
ID_MIN_DATA_SET
 = 0x00ff

44 -- 
EÁ”´i£
 
b™


45 
fix
.
ENTERPRISE_BIT
 = 0x00

49 ---- 
h‰ps
:

50 ---- 
IPFIX
 
¡ruùu»s


53 
ffi
.
cdef
[[

54 
__©Œibu‹__
((
__·cked__
)è
fix_£t_h—d”
 {

55 
ušt16_t
 
£t_id
;

56 
ušt16_t
 
Ëngth
;

59 
__©Œibu‹__
((
__·cked__
)è
fix_tm¶_»cÜd_h—d”
 {

60 
ušt16_t
 
‹m¶©e_id
;

61 
ušt16_t
 
f›ld_couÁ
;

64 
__©Œibu‹__
((
__·cked__
)è
fix_İts_tm¶_»cÜd_h—d”
 {

65 
ušt16_t
 
‹m¶©e_id
;

66 
ušt16_t
 
f›ld_couÁ
;

67 
ušt16_t
 
scİe_f›ld_couÁ
;

70 
__©Œibu‹__
((
__·cked__
)è
fix_šfÜm©iÚ_–em’t
 {

71 
ušt16_t
 
›_id
;

72 
ušt16_t
 
Ëngth
;

75 
__©Œibu‹__
((
__·cked__
)è
fix_d©a_»cÜd
 {

76 
ušt8_t
 
f›ld_v®ues
[?];

79 
__©Œibu‹__
((
__·cked__
)è
	gfix_tm¶_»cÜd
 {

80 
fix_tm¶_»cÜd_h—d”
 
	g‹m¶©e_h—d”
;

81 
fix_šfÜm©iÚ_–em’t
 
	gšfÜm©iÚ_–em’ts
[5];

84 
__©Œibu‹__
((
__·cked__
)è
	gfix_İts_tm¶_»cÜd
 {

85 
fix_İts_tm¶_»cÜd_h—d”
 
	g‹m¶©e_h—d”
;

86 
fix_šfÜm©iÚ_–em’t
 
	gšfÜm©iÚ_–em’ts
[5];

89 
__©Œibu‹__
((
__·cked__
)è
	gfix_d©a_£t
 {

90 
fix_£t_h—d”
 
	g£t_h—d”
;

91 
ušt8_t
 
	gf›ld_v®ues
[?];

94 
__©Œibu‹__
((
__·cked__
)è
	gfix_tm¶_£t
 {

95 
fix_£t_h—d”
 
	g£t_h—d”
;

96 
fix_tm¶_»cÜd
 
	g»cÜd
;

97 
ušt8_t
 
	g·ddšg
;

100 
__©Œibu‹__
((
__·cked__
)è
	gfix_İts_tm¶_£t
 {

101 
fix_£t_h—d”
 
	g£t_h—d”
;

102 
fix_İts_tm¶_»cÜd
 
	g»cÜd
;

103 
ušt8_t
 
	g·ddšg
;

109 ---- 
IPFix
 
	gh—d”


110 ---- 
	gh‰ps
:

113 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


114 
fix
.
h—d”FÜm©
 = [[

115 
ušt16_t
 
v”siÚ
;

116 
ušt16_t
 
Ëngth
;

117 
ušt32_t
 
expÜt_time
;

118 
ušt32_t
 
£qu’û_numb”
;

119 
ušt32_t
 
ob£rv©iÚ_domaš_id
;

122 --- 
V¬ŸbË
 
sized
 
memb”


123 
	gfix
.
	gh—d”V¬ŸbËMemb”
 = 
n


125 --- 
ModuË
 
fix
 

126 
loÿl
 
fixH—d”
 = 
	$š™H—d”
()

127 
fixH—d”
.
__šdex
 = ipfixHeader

129 --- 
S‘
 
the
 
v”siÚ
.

130 --- @
·¿m
 
v”siÚ
 
of
 
the
 
fix
 
h—d”
 
as
 
a
 16 
b™s
 
š‹g”
.

131 
funùiÚ
 
fixH—d”
:
	$£tV”siÚ
()

132 ğ
Ü
 
fix
.
VERSION_IPFIX


133 
£lf
.
v”siÚ
 = 
	$htÚ16
()

134 
’d


136 --- 
R‘r›ve
 
the
 
v”siÚ
.

137 --- @ 
v”siÚ
 
as
 
a
 16 
b™s
 
š‹g”
.

138 
funùiÚ
 
fixH—d”
:
	$g‘V”siÚ
()

139  
	$htÚ16
(
£lf
.
v”siÚ
)

140 
’d


142 --- 
R‘r›ve
 
the
 
v”siÚ
 
as
 
¡ršg
.

143 --- @ 
v”siÚ
 
as
 
¡ršg
.

144 
funùiÚ
 
fixH—d”
:
	$g‘V”siÚSŒšg
()

145  
£lf
:
	$g‘V”siÚ
()

146 
’d


148 --- 
S‘
 
the
 
h—d”
 
Ëngth
.

149 --- @
·¿m
 
Ëngth
 
of
 
the
 
fix
 
h—d”
 
as
 
a
 16 
b™s
 
š‹g”
.

150 
funùiÚ
 
fixH—d”
:
	$£tL’gth
()

151 ğ
Ü
 0

152 
£lf
.
Ëngth
 = 
	$htÚ16
()

153 
’d


155 --- 
R‘r›ve
 
the
 
Ëngth
.

156 --- @ 
Ëngth
 
as
 
a
 16 
b™s
 
š‹g”
.

157 
funùiÚ
 
fixH—d”
:
	$g‘L’gth
()

158  
	$htÚ16
(
£lf
.
Ëngth
)

159 
’d


161 --- 
R‘r›ve
 
the
 
Ëngth
 
as
 
¡ršg
.

162 --- @ 
Ëngth
 
as
 
¡ršg
.

163 
funùiÚ
 
fixH—d”
:
	$g‘L’gthSŒšg
()

164  
£lf
:
	$g‘L’gth
()

165 
’d


167 --- 
S‘
 
the
 
h—d”
 
expÜt
 
time
.

168 --- @
·¿m
 
expÜt
 
time
 
of
 
the
 
fix
 
h—d”
 
as
 
a
 32 
b™s
 
š‹g”
.

169 
funùiÚ
 
fixH—d”
:
	$£tExpÜtTime
()

170 ğ
Ü
 0

171 
£lf
.
expÜt_time
 = 
	$bsw­
()

172 
’d


174 --- 
R‘r›ve
 
the
 
expÜt
 
time
.

175 --- @ 
expÜt
 
time
 
as
 
a
 32 
b™s
 
š‹g”
.

176 
funùiÚ
 
fixH—d”
:
	$g‘ExpÜtTime
()

177  
	$bsw­
(
£lf
.
expÜt_time
)

178 
’d


180 --- 
R‘r›ve
 
the
 
expÜt
 
time
 
as
 
¡ršg
.

181 --- @ 
expÜt
 
time
 
as
 
¡ršg
.

182 
funùiÚ
 
fixH—d”
:
	$g‘ExpÜtTimeSŒšg
()

183  
£lf
:
	$g‘ExpÜtTime
()

184 
’d


186 --- 
S‘
 
the
 
h—d”
 
£q
.

187 --- @
·¿m
 
£q
 
of
 
the
 
fix
 
h—d”
 
as
 
a
 32 
b™s
 
š‹g”
.

188 
funùiÚ
 
fixH—d”
:
	$£tSeq
()

189 ğ
Ü
 0

190 
£lf
.
£qu’û_numb”
 = 
	$bsw­
()

191 
’d


193 --- 
R‘r›ve
 
the
 
£q
.

194 --- @ 
£q
 
as
 
a
 32 
b™s
 
š‹g”
.

195 
funùiÚ
 
fixH—d”
:
	$g‘Seq
()

196  
	$bsw­
(
£lf
.
£qu’û_numb”
)

197 
’d


199 --- 
R‘r›ve
 
the
 
£q
 
as
 
¡ršg
.

200 --- @ 
£q
 
as
 
¡ršg
.

201 
funùiÚ
 
fixH—d”
:
	$g‘SeqSŒšg
()

202  
£lf
:
	$g‘Seq
()

203 
’d


205 --- 
S‘
 
the
 
h—d”
 
ob£rv©iÚ
 
domaš
.

206 --- @
·¿m
 
ob£rv©iÚ
 
domaš
 
id
 
of
 
the
 
fix
 
h—d”
 
as
 
a
 32 
b™s
 
š‹g”
.

207 
funùiÚ
 
fixH—d”
:
	$£tOb£rv©iÚDomaš
()

208 ğ
Ü
 0

209 
£lf
.
ob£rv©iÚ_domaš_id
 = 
	$bsw­
()

210 
’d


212 --- 
R‘r›ve
 
the
 
ob£rv©iÚ
 
domaš
 
id
.

213 --- @ 
ob£v©iÚ
 
domaš
 
as
 
a
 32 
b™s
 
š‹g”
.

214 
funùiÚ
 
fixH—d”
:
	$g‘Ob£rv©iÚDomaš
()

215  
	$bsw­
(
£lf
.
ob£rv©iÚ_domaš_id
)

216 
’d


218 --- 
R‘r›ve
 
the
 
ob£rv©iÚ
 
domaš
 
as
 
¡ršg
.

219 --- @ 
ob£rv©iÚ
 
domaš
 
as
 
¡ršg
.

220 
funùiÚ
 
fixH—d”
:
	$g‘Ob£rv©iÚDomašSŒšg
()

221  
£lf
:
	$g‘Ob£rv©iÚDomaš
()

222 
’d


225 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
fix
 
h—d”
.

226 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

227 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

228 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
fixXYZ


229 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ipfix'.

230 --- @
code


231 --- 
	`fl
(è-- 
Úly
  
v®ues


232 --- 
fl
{ 
fixXYZ
=1 
	}
} -- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 ipfixXYZ, ...

233 --- @
’dcode


234 
funùiÚ
 
	gfixH—d”
:
	$fl
(
¬gs
, 
´e
)

235 
¬gs
 =‡rg 
Ü
 {
	}
}

236 
´e
 =…» 
Ü
 "ipfix"

238 
£lf
:
£tV”siÚ
 (
¬gs
[
´e
 .. "Version"])

239 
£lf
:
£tL’gth
 (
¬gs
[
´e
 .. "Length"])

240 
£lf
:
£tExpÜtTime
 (
¬gs
[
´e
 .. "ExportTime"])

241 
£lf
:
£tSeq
 (
¬gs
[
´e
 .. "Seq"])

242 
£lf
:
£tOb£rv©iÚDomaš
 (
¬gs
[
´e
 .. "ObservationDomain"])

243 
’d


245 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

246 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ipfix'.

247 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

248 --- @
£e
 
fixH—d”
:
fl


249 
funùiÚ
 
fixH—d”
:
	$g‘
(
´e
)

250 
´e
 =…» 
Ü
 "ipfix"

252 
loÿl
 
¬gs
 = {
	}
}

253 
¬gs
[
´e
 .. "V”siÚ"] = 
£lf
:
	$g‘V”siÚ
()

254 
¬gs
[
´e
 .. "L’gth"] = 
£lf
:
	$g‘L’gth
()

255 
¬gs
[
´e
 .. "ExpÜtTime"] = 
£lf
:
	$g‘ExpÜtTime
()

256 
¬gs
[
´e
 .. "Seq"] = 
£lf
:
	$g‘Seq
()

257 
¬gs
[
´e
 .. "Ob£rv©iÚDomaš"] = 
£lf
:
	$g‘Ob£rv©iÚDomaš
()

259  
¬gs


260 
’d


262 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

263 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

264 
funùiÚ
 
fixH—d”
:
	$g‘SŒšg
()

266 .. " v”siÚ " .. 
£lf
:
	`g‘V”siÚSŒšg
()

267 .. "†’gth " .. 
£lf
:
	`g‘L’gthSŒšg
()

268 .. "ƒxpÜˆtim" .. 
£lf
:
	`g‘ExpÜtTimeSŒšg
()

269 .. " sequ’û‚umb” " .. 
£lf
:
	`g‘SeqSŒšg
()

270 .. " ob£rv©iÚ domaš id " .. 
£lf
:
	$g‘Ob£rv©iÚDomašSŒšg
()

271 
’d


273 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
)

274 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength

275 --- 
S“
 
fix
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e


276 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl


277 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'ipfix'

278 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
mÜe
)

279 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


280 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


281 --- @
£e
 
fixH—d”
:
fl


282 
funùiÚ
 
fixH—d”
:
	$£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
)

283 
nÙ
 
ÇmedArgs
[
´e
 .. "L’gth"] 
ªd
‚amedArgs["pktL’gth"] 
th’


284 
ÇmedArgs
[
´e
 .. "L’gth"] =‚amedArgs["pktL’gth"] - 
accumuÏ‹dL’gth


285 
’d


287  
ÇmedArgs


288 
’d


292 ---- 
IPFix
 
Mes§ge


295 --- 
C»©es
 
ª
 
InfÜm©iÚ
 
EËm’t


296 --- @
·¿m
 
id
 
A
 
num”ic
 
v®ue
 
th©
 
»´e£Ás
 
the
 
InfÜm©iÚ
 
EËm’t


297 --- @
·¿m
 
Ëngth
 
The
†’gth 
of
 
the
 
cÜ»¥Údšg
 
’coded
 
InfÜm©iÚ
 
EËm’t
, 
š
 
où‘s


298 --- @ 
a
 
Ãw
 
InfÜm©iÚ
 
EËm’t


299 
funùiÚ
 
fix
:
	$ü—‹InfÜm©iÚEËm’t
(
id
, 
Ëngth
)

300 
loÿl
 
šfÜm©iÚEËm’t
 = 
	$InfÜm©iÚEËm’t
()

301 
šfÜm©iÚEËm’t
.
›_id
 = 
	$htÚ16
(
id
)

302 
šfÜm©iÚEËm’t
.
Ëngth
 = 
	$htÚ16
(
Ëngth
)

304  
šfÜm©iÚEËm’t


305 
’d


307 --- 
C»©es
 
a
 
S‘
 
H—d”


308 --- @
·¿m
 
id
 
S‘
 
ID


309 --- @
·¿m
 
Ëngth
 
TÙ®
†’gth 
of
 
the
 
S‘
, 
š
 
où‘s
, 
šşudšg
hS‘ 
H—d”
, 
»cÜds
,

310 --- 
ªd
 
the
 
İtiÚ®
 
·ddšg
.

311 --- @ 
a
 
Ãw
 
S‘
 
H—d”


312 
funùiÚ
 
fix
:
	$ü—‹S‘H—d”
(
id
, 
Ëngth
)

313 
loÿl
 
£tH—d”
 = 
	$S‘H—d”
()

314 
£tH—d”
.
£t_id
 = 
	$htÚ16
(
id
)

315 
£tH—d”
.
Ëngth
 = 
	$htÚ16
(
Ëngth
)

317  
£tH—d”


318 
’d


320 --- 
C»©es
 
a
 
Tem¶©e
 
RecÜd
 
H—d”


321 --- @
·¿m
 
id
 
Tem¶©e
 
Id


322 --- @
·¿m
 
f›ldCouÁ
 
Numb”
 
of
 
f›lds
 
š
 
this
 
Tem¶©e
 
RecÜd


323 --- @ 
a
 
Ãw
 
Tem¶©e
 
RecÜd
 
H—d”


324 
funùiÚ
 
fix
:
	$ü—‹Tm¶RecÜdH—d”
(
id
, 
f›ldCouÁ
)

325 
loÿl
 
tm¶RecÜdH—d”
 = 
	$Tm¶RecÜdH—d”
()

326 
tm¶RecÜdH—d”
.
‹m¶©e_id
 = 
	$htÚ16
(
id
)

327 
tm¶RecÜdH—d”
.
f›ld_couÁ
 = 
	$htÚ16
(
f›ldCouÁ
)

329  
tm¶RecÜdH—d”


330 
’d


332 --- 
C»©es
 
ª
 
O±iÚs
 
Tem¶©e
 
RecÜd
 
H—d”


333 --- @
·¿m
 
id
 
O±iÚs
 
Tem¶©e
 
Id


334 --- @
·¿m
 
f›ldCouÁ
 
Numb”
 
of
 
f›lds
 
š
 
this
 
O±iÚs
 
Tem¶©e
 
RecÜd


335 --- @
·¿m
 
scİeF›ldCouÁ
 
Numb”
 
of
 
scİe
 
f›lds
 
š
 
this
 
O±iÚs
 
Tem¶©e
 
RecÜd


336 --- @ 
a
 
Ãw
 
O±iÚs
 
Tem¶©e
 
RecÜd
 
H—d”


337 
funùiÚ
 
fix
:
	$ü—‹O±sTm¶RecÜdH—d”
(
id
, 
f›ldCouÁ
, 
scİeF›ldCouÁ
)

338 
loÿl
 
İtsTm¶RecÜdH—d”
 = 
	$O±sTm¶RecÜdH—d”
()

339 
İtsTm¶RecÜdH—d”
.
‹m¶©e_id
 = 
	$htÚ16
(
id
)

340 
İtsTm¶RecÜdH—d”
.
f›ld_couÁ
 = 
	$htÚ16
(
f›ldCouÁ
)

341 
İtsTm¶RecÜdH—d”
.
scİe_f›ld_couÁ
 = 
	$htÚ16
(
scİeF›ldCouÁ
)

343  
İtsTm¶RecÜdH—d”


344 
’d


346 --- 
C»©es
 
a
 
Tem¶©e
 
S‘
 
w™h
 
the
 
InfÜm©iÚ
 
EËm’ts
 
desüibed
 
š
 'template'

347 --- @
·¿m
 
id
 
Tem¶©e
 
S‘
 
Id


348 --- @
·¿m
 
‹m¶©e
 
CÚšs
 
the
 
InfÜm©iÚ
 
EËm’ts
 
this
 
Tem¶©e
 
S‘
, 
e
.
g
.

349 --- @
code


350 --- 
loÿl
 
‹m¶©e
 ={

351 --- {
id
 = 8, 
Ëngth
 = 4, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(1207959553, 2432696319è
’d
},

352 --- {
id
 = 12, 
Ëngth
 = 4, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(1207959553, 2432696319è
’d
},

353 --- {
id
 = 4, 
Ëngth
 = 1, 
v®ue
 = 
	`funùiÚ
(è 17 
’d
},

354 --- {
id
 = 7, 
Ëngth
 = 2, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(80, 100 
’d
},

355 --- {
id
 = 11, 
Ëngth
 = 2, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(180, 200è
’d
}

356 --- 
	}
}

357 --- @
	g’dcode


358 --- 
id
 
ªd
 
Ëngth
 
¬e
 
defšed
 
	gš
:

359 --- 
h‰p
:

360 --- 
v®ue
 
is
 
a
 
funùiÚ
 
to
 
ÿlcuÏ‹
 
Ü
  
the
hv®utØ
be
 
u£d
 
wh’
 
ü—tšg
‡ 
D©a
 
RecÜd


361 --- @ 
a
 
Ãw
 
Tem¶©e
 
S‘


362 
funùiÚ
 
fix
:
	$ü—‹Tm¶S‘
(
id
, 
‹m¶©e
)

363 
loÿl
 
h—d”L’gth
 = 
ffi
.(
S‘H—d”
)

364 
loÿl
 
»cÜdH—d”L’gth
 = 
ffi
.(
Tm¶RecÜdH—d”
)

365 
loÿl
 
›L’gth
 = 
ffi
.(
InfÜm©iÚEËm’t
)

367 
loÿl
 
£t
 = 
	$Tm¶S‘
()

368 
loÿl
 
numOfF›lds
 = 
bË
.
	$g‘n
(
‹m¶©e
)

369 
loÿl
 
tm¶S‘L’gth
 = 
h—d”L’gth
 + 
»cÜdH—d”L’gth
 + (
›L’gth
 * 
numOfF›lds
)

371 
loÿl
 
h—d”
 = 
£lf
:
	$ü—‹S‘H—d”
(
£lf
.
ID_TEMPLATE_SET
, 
tm¶S‘L’gth
)

372 
loÿl
 
»cÜd
 = 
	$Tm¶RecÜd
()

373 
loÿl
 
»cÜdH—d”
 = 
£lf
:
	$ü—‹Tm¶RecÜdH—d”
(
id
, 
numOfF›lds
)

375 
i
, 
›
 
š
 
	$aœs
(
‹m¶©e
) do

376 
»cÜd
.
šfÜm©iÚ_–em’ts
[
i
-1] = 
£lf
:
	$ü—‹InfÜm©iÚEËm’t
(
›
.
id
, ie.
Ëngth
)

377 
’d


379 
»cÜd
.
‹m¶©e_h—d”
 = 
»cÜdH—d”


380 
£t
.
£t_h—d”
 = 
h—d”


381 
£t
.
»cÜd
 =„ecord

383  
£t


384 
’d


387 --- 
C»©es
 
ª
 
O±iÚs
 
Tem¶©e
 
S‘
 
w™h
 
the
 
InfÜm©iÚ
 
EËm’ts
 
desüibed
 
š
 'opts_template'

388 --- @
·¿m
 
id
 
O±iÚs
 
Tem¶©e
 
S‘
 
Id


389 --- @
·¿m
 
İts_‹m¶©e
 
CÚšs
 
the
 
InfÜm©iÚ
 
EËm’ts
 
this
 
O±iÚs
 
Tem¶©e
 
S‘
, 
e
.
g
.

390 --- @
code


391 --- 
loÿl
 
İts_‹m¶©e
 ={

392 --- {
id
 = 8, 
Ëngth
 = 4, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(1207959553, 2432696319è
’d
},

393 --- {
id
 = 12, 
Ëngth
 = 4, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(1207959553, 2432696319è
’d
},

394 --- {
id
 = 4, 
Ëngth
 = 1, 
v®ue
 = 
	`funùiÚ
(è 17 
’d
},

395 --- {
id
 = 7, 
Ëngth
 = 2, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(80, 100 
’d
},

396 --- {
id
 = 11, 
Ëngth
 = 2, 
v®ue
 = 
	`funùiÚ
(è 
m©h
.
	`¿ndom
(180, 200è
’d
}

397 --- 
	}
}

398 --- @
	g’dcode


399 --- 
id
 
ªd
 
Ëngth
 
¬e
 
defšed
 
	gš
:

400 --- 
h‰p
:

401 --- 
v®ue
 
is
 
a
 
funùiÚ
 
to
 
ÿlcuÏ‹
 
Ü
  
the
hv®utØ
be
 
u£d
 
wh’
 
ü—tšg
‡ 
D©a
 
RecÜd


402 --- @ 
a
 
Ãw
 
O±iÚs
 
Tem¶©e
 
S‘


403 
funùiÚ
 
fix
:
	$ü—‹O±sTm¶S‘
(
id
, 
İts_‹m¶©e
)

404 
loÿl
 
h—d”L’gth
 = 
ffi
.(
S‘H—d”
)

405 
loÿl
 
»cÜdH—d”L’gth
 = 
ffi
.(
O±sTm¶RecÜdH—d”
)

406 
loÿl
 
›L’gth
 = 
ffi
.(
InfÜm©iÚEËm’t
)

408 
loÿl
 
£t
 = 
	$O±sTm¶S‘
()

409 
loÿl
 
numOfF›lds
 = 
bË
.
	`g‘n
(
İts_‹m¶©e
)

410 -- 
Add
 2 
mÜe
 
où‘s
 
which
 
cÜ»¥Úd
 
to
 
the
 
·ddšg
 
f›ld


411 
loÿl
 
İtsTm¶S‘L’gth
 = 
h—d”L’gth
 + 
»cÜdH—d”L’gth
 + 2 + (
›L’gth
 * 
numOfF›lds
)

413 
loÿl
 
h—d”
 = 
£lf
:
	$ü—‹S‘H—d”
(
£lf
.
ID_OPTION_TEMPLATE_SET
, 
İtsTm¶S‘L’gth
)

414 
loÿl
 
»cÜd
 = 
	$O±sTm¶RecÜd
()

415 
loÿl
 
»cÜdH—d”
 = 
£lf
:
	$ü—‹O±sTm¶RecÜdH—d”
(
id
, 
numOfF›lds
, 1)

417 
i
, 
›
 
š
 
	$aœs
(
İts_‹m¶©e
) do

418 
»cÜd
.
šfÜm©iÚ_–em’ts
[
i
-1] = 
£lf
:
	$ü—‹InfÜm©iÚEËm’t
(
›
.
id
, ie.
Ëngth
)

419 
’d


421 
»cÜd
.
‹m¶©e_h—d”
 = 
»cÜdH—d”


422 
£t
.
£t_h—d”
 = 
h—d”


423 
£t
.
»cÜd
 =„ecord

424 
£t
.
·ddšg
 = 
	$htÚ16
(0)

426  
£t


427 
’d


429 --- 
C®cuÏ‹s
 
the
 
Ëngth
, 
š
 
où‘s
, 
of
 
a
 
D©a
 
RecÜd
 
ba£d
 
Ú
 
™s
 
‹m¶©e


430 --- @
·¿m
 
‹m¶©e
 
CÚšs
 
the
 
InfÜm©iÚ
 
EËm’ts
 
this
 
Flow
 
RecÜd


431 --- @ 
Flow
 
RecÜd
's†ength, in octets

432 
funùiÚ
 
fix
:
	$g‘RecÜdL’gth
(
‹m¶©e
)

433 
loÿl
 
Ëngth
 = 0

435 
_
, 
›
 
š
 
	$aœs
(
‹m¶©e
) do

436 
Ëngth
 =†’gth + 
›
.length

437 
’d


439  
Ëngth


440 
’d


442 --- 
C»©es
 
a
 
D©a
 
S‘
 
the
 
InfÜm©iÚ
 
EËm’ts
 
desüibed
 
š
 'template'

443 --- @
·¿m
 
id
 
Tem¶©e
 
Id


444 --- @
·¿m
 
‹m¶©e
 
CÚšs
 
the
 
InfÜm©iÚ
 
EËm’ts
 
this
 
D©a
 
S‘


445 --- @
·¿m
 
»cÜdL’gth
 
L’gth
 
š
 
où‘s
 
—ch
 
D©a
 
RecÜd


446 --- @
·¿m
 
numOfRecÜds
 
Numb”
 
of
 
D©a
 
RecÜds
 
w™hš
 
this
 
S‘


447 --- @ 
a
 
Ãw
 
D©a
 
S‘
 
cÚššg
 
numOfRecÜds
 D©¨
RecÜds


448 
funùiÚ
 
fix
:
	$ü—‹D©aS‘
(
id
, 
‹m¶©e
, 
»cÜdL’gth
, 
numOfRecÜds
)

449 
loÿl
 
h—d”L’gth
 = 
ffi
.(
S‘H—d”
)

451 
loÿl
 
h—d”
 = 
£lf
:
	`ü—‹S‘H—d”
(
id
, 
h—d”L’gth
 + (
numOfRecÜds
 * 
»cÜdL’gth
))

453 
loÿl
 
£t
 = 
	$D©aS‘
(
numOfRecÜds
 * 
»cÜdL’gth
)

454 
loÿl
 
šdex
 = 0

456 
i
 = 1, 
numOfRecÜds
 do

457 
_
, 
›
 
š
 
	$aœs
(
‹m¶©e
) do

458 
loÿl
 
off£t
 = 
›
.
Ëngth
 - 1

460 
off£t
 >= 0 do

461 
£t
.
f›ld_v®ues
[
šdex
] = 
b™
.
	`rshiá
(
›
.
	`v®ue
(), 
off£t
 * 8)

462 
šdex
 = index + 1

463 
off£t
 = offset - 1

464 
’d


465 
’d


466 
’d


468 
£t
.
£t_h—d”
 = 
h—d”


470  
£t


471 
’d


473 --- 
Cİ›s
 
S‘
 
što
 
de¡š©iÚ


474 --- @
·¿m
 
de¡
 
De¡š©iÚ
 
the
 
£t


475 --- @
·¿m
 
pos
 
S¹
 
pos™iÚ
 
this
 
£t
 
š
 
de¡


476 --- @
·¿m
 
£t
 
S‘


477 --- @ 
End
 
pos™iÚ
 
this
 
£t
 
š
 
de¡š©iÚ


478 
funùiÚ
 
fix
:
	$cİyTo
(
de¡
, 
pos
, 
£t
)

479 
loÿl
 
Ëngth
 = 
	$Áoh16
(
£t
.
£t_h—d”
.
Ëngth
)

480 
loÿl
 
s
 = 
ffi
.
	$¡ršg
(
£t
, 
Ëngth
)

481 
loÿl
 
aux
 = 1

483 
Ëngth
 =†’gth + 
pos


485 
pos
 < 
Ëngth
 do

486 
de¡
[
pos
] = 
s
:
	$by‹
(
aux
)

487 
pos
 =…os + 1

488 
aux
 =‡ux + 1

489 
’d


491  
pos


492 
’d


494 --- 
R‘uºs
 
H—d”
's†ength in octets

495 
funùiÚ
 
fix
:
	$g‘H—d”sL’gth
()

496  
ffi
.(ffi.
	`ty³of
("struct ipfix_header"))

497 
’d


501 ---- 
M‘©y³s


504 
fix
.
m‘©y³
 = 
fixH—d”


506 -- 
ùy³s


507 
S‘H—d”
 = 
ffi
.
	`ty³of
("struct ipfix_set_header")

508 
InfÜm©iÚEËm’t
 = 
ffi
.
	`ty³of
("struct ipfix_information_element")

509 
D©aS‘
 = 
ffi
.
	`ty³of
("struct ipfix_data_set")

510 
Tm¶S‘
 = 
ffi
.
	`ty³of
("struct ipfix_tmpl_set")

511 
Tm¶RecÜd
 = 
ffi
.
	`ty³of
("struct ipfix_tmpl_record")

512 
Tm¶RecÜdH—d”
 = 
ffi
.
	`ty³of
("struct ipfix_tmpl_record_header")

513 
O±sTm¶S‘
 = 
ffi
.
	`ty³of
("struct ipfix_opts_tmpl_set")

514 
O±sTm¶RecÜd
 = 
ffi
.
	`ty³of
("struct ipfix_opts_tmpl_record")

515 
O±sTm¶RecÜdH—d”
 = 
ffi
.
	`ty³of
("struct ipfix_opts_tmpl_record_header")

517  
fix


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/lacp.lua

2 --- @
fe
 
	gÏı
.
	glua


3 --- @
br›f
 
Im¶em’tiÚ
 
	gof
 802.3ad 
aka
 
	gLACP
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
Ïı_h—d”
 
	g¡ruùs


5 --- 
	gInşudes
:

6 --- - 
LACP
 
cÚ¡ªts


7 --- - 
LACP
 
h—d”
 
ut™y


8 --- - 
Defš™iÚ
 
of
 
LACP
 
·ck‘s


11 -- 
¡ruùs
 
ªd
 
cÚ¡ªts
 
·¹ŸÎy
 
cİ›d
 
äom
 
O³n
 
vSw™ch
 
Ïı
.
	$c
 (
A·che
 2.0 
liûn£
)

13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

15 
loÿl
 
memÜy
 = 
»quœe
 "memory"

16 
loÿl
 
f‹r
 = 
»quœe
 "filter"

17 
loÿl
 
ns
 = 
»quœe
 "namespaces"

18 
loÿl
 
‘h
 = 
»quœe
 "proto.ethernet"

19 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

20 
»quœe
 "proto.template"

21 
loÿl
 
š™H—d”
 = initHeader

25 ---- 
Ïı
 
cÚ¡ªts


28 --- 
Ïı
 
´ÙocŞ
 
cÚ¡ªts


29 
loÿl
 
Ïı
 = {
	}
}

31 
Ïı
.
PKT_SIZE
 = 124

32 
Ïı
.
DST_MAC
 = 
·r£MacAdd»ss
("01:80:c2:00:00:02")

34 -- 
¡©es


35 
Ïı
.
STATE_ACT
 = 0x01 -- 
Aùiv™y
. 
Aùive
 
Ü
 
·ssive
?

36 
Ïı
.
STATE_TIME
 = 0x02 -- 
Timeout
. 
ShÜt
 
Ü
 
timeout
?

37 
Ïı
.
STATE_AGG
 = 0x04 -- 
Agg»g©iÚ
. 
Is
 
the
 
lšk
 
is
 
bÚdabË
?

38 
Ïı
.
STATE_SYNC
 = 0x08 -- 
SynchrÚiz©iÚ
. 
Is
 
the
 
lšk
 
š
 
up
 
to
 
d©e
?

39 
Ïı
.
STATE_COL
 = 0x10 -- 
CŞËùšg
. 
Is
 
the
 
lšk
 
»ûivšg
 
äames
?

40 
Ïı
.
STATE_DIST
 = 0x20 -- 
Di¡ributšg
. 
Is
 
the
 
lšk
 
£ndšg
 
äames
?

41 
Ïı
.
STATE_DEF
 = 0x40 -- 
DeçuÉed
. 
Usšg
  
·¹Ãr
 
šfo
?

42 
Ïı
.
STATE_EXP
 = 0x80 -- 
Expœed
. 
Usšg
 
expœed
 
·¹Ãr
 
šfo
?

46 ---- 
Ïı
 
¡ruùs


49 
ffi
.
cdef
[[

51 
__©Œibu‹__
((
__·cked__
)è
Ïı_šfo
 {

52 
ušt16_t
 
sys_´iÜ™y
;

53 
mac_add»ss
 
sys_id
;

54 
ušt16_t
 
key
;

55 
ušt16_t
 
pÜt_´iÜ™y
;

56 
ušt16_t
 
pÜt_id
;

57 
ušt8_t
 
¡©e
;

63 ---- 
Ïı
 
	gh—d”


66 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


67 
	gÏı
.
	gh—d”FÜm©
 = [[

68 
ušt8_t
 
subty³
;

69 
ušt8_t
 
v”siÚ
;

71 
ušt8_t
 
aùÜ_ty³
;

72 
ušt8_t
 
aùÜ_Ën
;

73 
Ïı_šfo
 
aùÜ
;

74 
ušt8_t
 
z1
[3];

76 
ušt8_t
 
	g·¹Ãr_ty³
;

77 
ušt8_t
 
	g·¹Ãr_Ën
;

78 
Ïı_šfo
 
	g·¹Ãr
;

79 
ušt8_t
 
	gz2
[3];

81 
ušt8_t
 
	gcŞËùÜ_ty³
;

82 
ušt8_t
 
	gcŞËùÜ_Ën
;

83 
ušt16_t
 
	gcŞËùÜ_d–ay
;

84 
ušt8_t
 
	gz3
[64];

87 --- 
V¬ŸbË
 
sized
 
memb”


88 
	gÏı
.
	gh—d”V¬ŸbËMemb”
 = 
n


90 --- 
ModuË
 
Ïı_add»ss
 

91 
loÿl
 
ÏıH—d”
, 
	gÏıInfo
 = 
š™H—d”
(), {}

92 
	gÏıH—d”
.
	g__šdex
 = 
ÏıH—d”


93 
ÏıInfo
.
__šdex
 =†acpInfo

95 
funùiÚ
 
ÏıInfo
.
	$__eq
(
lhs
, 
rhs
)

96  
lhs
:
	$equ®sIgnÜeS‹
(
rhs
)

97 
ªd
 
lhs
.
¡©e
 =ğ
rhs
.state

98 
’d


100 
funùiÚ
 
ÏıInfo
.
	$equ®sIgnÜeS‹
(
lhs
, 
rhs
)

101  
lhs
.
sys_´iÜ™y
 =ğ
rhs
.sys_priority

102 
ªd
 
lhs
.
sys_id
 =ğ
rhs
.sys_id

103 
ªd
 
lhs
.
key
 =ğ
rhs
.key

104 
ªd
 
lhs
.
pÜt_´iÜ™y
 =ğ
rhs
.port_priority

105 
ªd
 
lhs
.
pÜt_id
 =ğ
rhs
.port_id

106 
’d


108 
funùiÚ
 
ÏıInfo
:
	$£tSysPriÜ™y
()

109 ğ
Ü
 0

110 
£lf
.
sys_´iÜ™y
 = 
	$htÚ16
()

111 
’d


113 
funùiÚ
 
ÏıInfo
:
	$£tKey
()

114 ğ
Ü
 0

115 
£lf
.
key
 = 
	$htÚ16
()

116 
’d


118 
funùiÚ
 
ÏıInfo
:
	$£tPÜtPriÜ™y
()

119 ğ
Ü
 0

120 
£lf
.
pÜt_´iÜ™y
 = 
	$htÚ16
()

121 
’d


123 
funùiÚ
 
ÏıInfo
:
	$£tPÜtId
()

124 ğ
Ü
 0

125 
£lf
.
pÜt_id
 = 
	$htÚ16
()

126 
’d


128 --- @
·¿m
 
¡©e
 
S‹
 
as
 
b™f›ld
, 
£e
 
Ïı
.
STATE_
 
cÚ¡ªts


129 
funùiÚ
 
ÏıInfo
:
	$£tS‹
(
¡©e
)

130 
£lf
.
¡©e
 = s‹ 
Ü
 0

131 
’d


134 
funùiÚ
 
ÏıInfo
:
	$g‘SysPriÜ™y
()

135  
	$Áoh16
(
£lf
.
sys_´iÜ™y
)

136 
’d


138 
funùiÚ
 
ÏıInfo
:
	$g‘Key
()

139  
	$Áoh16
(
£lf
.
key
)

140 
’d


142 
funùiÚ
 
ÏıInfo
:
	$g‘PÜtPriÜ™y
()

143  
	$Áoh16
(
£lf
.
pÜt_´iÜ™y
)

144 
’d


146 
funùiÚ
 
ÏıInfo
:
	$g‘PÜtId
()

147  
	$Áoh16
(
£lf
.
pÜt_id
)

148 
’d


150 --- @ 
S‹
 
as
 
b™f›ld
, 
£e
 
Ïı
.
STATE_
 
cÚ¡ªts


151 
funùiÚ
 
ÏıInfo
:
	$g‘S‹
()

152  
£lf
.
¡©e


153 
’d


155 -- @ 
S‹
 
as
 
¡ršg


156 
funùiÚ
 
ÏıInfo
:
	$g‘S‹SŒšg
()

157 
loÿl
 
¡©e
 = 
£lf
.state

158 
loÿl
 
s
 = "["

159 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_ACT
è~ğ0 
th’


160 
s
 = s .. "Activity, "

161 
’d


162 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_TIME
è~ğ0 
th’


163 
s
 = s .. "Timeout, "

164 
’d


165 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_AGG
è~ğ0 
th’


166 
s
 = s .. "Aggregation, "

167 
’d


168 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_SYNC
è~ğ0 
th’


169 
s
 = s .. "Synchronization, "

170 
’d


171 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_COL
è~ğ0 
th’


172 
s
 = s .. "Collecting, "

173 
’d


174 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_DIST
è~ğ0 
th’


175 
s
 = s .. "Distributing, "

176 
’d


177 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_DEF
è~ğ0 
th’


178 
s
 = s .. "Defaulted, "

179 
’d


180 
b™
.
	`bªd
(
¡©e
, 
Ïı
.
STATE_EXP
è~ğ0 
th’


181 
s
 = s .. "Expired, "

182 
’d


183 
s
:
	`sub
(# - 1è=ğ", " 
th’


184 
s
 = s:
	`sub
(1, #s - 2)

185 
’d


186  
s
 .. "]"

187 
’d


189 
funùiÚ
 
ÏıInfo
:
	$g‘SŒšg
()

190  ("Sy¡em %s, Sy¡em PriÜ™y %d, Key %d, PÜˆ%d, PÜˆPriÜ™y %d, %s"):
	`fÜm©
(

191 
£lf
.
sys_id
:
	`g‘SŒšg
(), s–f:
	`g‘SysPriÜ™y
(), s–f:
	`g‘Key
(), s–f:
	`g‘PÜtId
(), s–f:
	`g‘PÜtPriÜ™y
(), s–f:
	$g‘S‹SŒšg
()

193 
’d


195 --- 
Check
 
wh‘h”
 
a
 
LACPDU
 
is
 
w–l
-
fÜmed


196 
funùiÚ
 
ÏıH—d”
:
	$v®id©e
()

197  
£lf
.
subty³
 == 1

198 
ªd
 
£lf
.
v”siÚ
 == 1

199 
ªd
 
£lf
.
aùÜ_ty³
 == 1

200 
ªd
 
£lf
.
aùÜ_Ën
 == 20

201 
ªd
 
£lf
.
·¹Ãr_ty³
 == 2

202 
ªd
 
£lf
.
·¹Ãr_Ën
 == 20

203 
ªd
 
£lf
.
cŞËùÜ_ty³
 == 3

204 
ªd
 
£lf
.
cŞËùÜ_Ën
 == 16

205 
’d


207 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
Ïı
 
h—d”
.

208 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

209 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

210 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: {
AùÜ
|
P¬Š”
}{SysPriÜ™y|SysId|Key|PÜtPriÜ™y|PÜtId|S‹}

211 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'lacp'.

212 --- @
code


213 --- 
fl
(è-- 
Úly
  
v®ues


214 --- 
fl
{ 
ÏıXYZ
=1 } -- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
†acpXYZ, ...

215 --- @
’dcode


216 
funùiÚ
 
	gÏıH—d”
:
	$fl
(
¬gs
, 
´e
)

217 
¬gs
 =‡rg 
Ü
 {
	}
}

218 
´e
 =…» 
Ü
 "lacp"

219 -- 
´ÙocŞ
 
cÚ¡ªts
, 
makšg
 
the£
 
modifŸbË
 
makes
 
no
 
	g£n£


220 -- (
ju¡
 
£t
 
them
 
your£lf
 
outside
 
of
 
fl
 
you
 
Ãed
 
difã»Á
 
v®ues
 
¡¿nge
 
	g»asÚs
)

221 
	g£lf
.
	gsubty³
 = 1

222 
£lf
.
v”siÚ
 = 1

223 
£lf
.
aùÜ_ty³
 = 1

224 
£lf
.
aùÜ_Ën
 = 20

225 
£lf
.
·¹Ãr_ty³
 = 2

226 
£lf
.
·¹Ãr_Ën
 = 20

227 
£lf
.
cŞËùÜ_ty³
 = 3

228 
£lf
.
cŞËùÜ_Ën
 = 16

229 
£lf
.
cŞËùÜ_d–ay
 = 0

230 -- 
z1
 - 
z3
: 
im¶ic™ly
 
z”Ûd


231 
loÿl
 
aùÜ
 = 
£lf
.actor

232 
aùÜ
:
£tSysPriÜ™y
(
¬gs
[
´e
 .. "ActorSysPriority"])

233 
aùÜ
:
£tKey
(
¬gs
[
´e
 .. "ActorKey"])

234 
aùÜ
:
£tPÜtPriÜ™y
(
¬gs
[
´e
 .. "ActorPortPriority"])

235 
aùÜ
:
£tPÜtId
(
¬gs
[
´e
 .. "ActorPortId"])

236 
aùÜ
:
£tS‹
(
¬gs
[
´e
 .. "ActorState"])

237 
aùÜ
.
sys_id
:
£tSŒšg
(
¬gs
[
´e
 .. "AùÜSysId"] 
Ü
 "00:00:00:00:00:00")

238 
loÿl
 
·¹Ãr
 = 
£lf
.partner

239 
·¹Ãr
:
£tSysPriÜ™y
(
¬gs
[
´e
 .. "PartnerSysPriority"])

240 
·¹Ãr
:
£tKey
(
¬gs
[
´e
 .. "PartnerKey"])

241 
·¹Ãr
:
£tPÜtPriÜ™y
(
¬gs
[
´e
 .. "PartnerPortPriority"])

242 
·¹Ãr
:
£tPÜtId
(
¬gs
[
´e
 .. "PartnerPortId"])

243 
·¹Ãr
:
£tS‹
(
¬gs
[
´e
 .. "PartnerState"])

244 
·¹Ãr
.
sys_id
:
£tSŒšg
(
¬gs
[
´e
 .. "P¬Š”SysId"] 
Ü
 "00:00:00:00:00:00")

245 
’d


247 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

248 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'lacp'.

249 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

250 --- @
£e
 
ÏıH—d”
:
fl


251 
funùiÚ
 
ÏıH—d”
:
	$g‘
(
´e
)

252 
´e
 =…» 
Ü
 "lacp"

253 
	`”rÜ
("NYI"è-- 
I
'm†azy

254 
’d


256 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

257 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

258 
funùiÚ
 
ÏıH—d”
:
	$g‘SŒšg
()

259 
£lf
.
subty³
 ~ğ1 
Ü
 s–f.
v”siÚ
 ~ğ1 
th’


260  "UnknowÀ0x8809…rÙocŞ: Ty³ " .. 
£lf
.
subty³
 .. " V”siÚ " .. s–f.
v”siÚ


261 
’d


262 
nÙ
 
£lf
:
	$v®id©e
(è
th’


264 
’d


266 .. " " .. 
£lf
.
aùÜ
:
	`g‘SŒšg
()

268 .. " " .. 
£lf
.
·¹Ãr
:
	`g‘SŒšg
()

270 .. " Max D–ay " .. 
	$Áoh16
(
£lf
.
cŞËùÜ_d–ay
)

271 
’d


275 ---- 
M‘©y³s


278 
ffi
.
	`m‘©y³
("¡ruù†aı_šfo", 
ÏıInfo
)

279 
Ïı
.
m‘©y³
 = 
ÏıH—d”


283 ---- 
LACP
 
HªdËr
 
Task


286 
Ïı
.
ÏıTask
 = "__MG_LACP_TASK"

288 --- 
S¹
 
a
 
sh¬ed
 
LACP
 
sk
. 
U£
 
muÉË
 
sks
 muÉË 
chªÃls
.

289 --- @
·¿m
 
Çme
 
id’tif›r
 
Ùh”
 
funùiÚs
 
like
 
Ïı
:
	`wa™FÜLšk
(name)

290 --- @
·¿m
 
queues
 
li¡
 
of
 
queue
 
·œs
 
to
 
u£
, 
’Œ›s
: {
rxQueue
 =„xQueue, 
txQueue
 = 
	}
txQueue}

291 -- 
this
 
is
 
Úly
 
a
 
v”y
 
sim¶i¡ic
 
im¶em’tiÚ
 
	gof
 802.3ad 
ªd
 
Ïcks
 
some
 
	gã©u»s


292 -- (
	gexam¶e
, 
™
 
dÛs
 
nÙ
 
check
 
wh‘h”
 
the
 
IDs
 
Ú
 
®l
 
lšks
 
m©ch
 
ªd
h
¿‹
 
is
 
	gh¬dcoded
)

293 -- 
u£
 
the
 
DPDK
 
im¶em’tiÚ
 
you
 
Ãed
 
som‘hšg
 
th©
 
hªdËs
 
®l
 
	gÿ£s


295 -- 
I
 
aùu®ly
 
	gdidn
't„eadhe spec, sohis may be slightly wrong

296 -- 
‹¡ed
 
agaš¡
 
ª
 
Ari¡a
 
	gEOS
 4.15.3FX 
MLAG
 
LACP
 
ªd
 
Lšux
 
bÚdšg


297 
funùiÚ
 
	gÏı
.
	$¡¬tLaıTask
(
Çme
, 
queues
)

298 
libmoÚ
.
	$¡¬tSh¬edTask
(
Ïı
.
ÏıTask
, 
Çme
, 
queues
)

299 
’d


301 
loÿl
 
LACP_TIMEOUT
 = 30

303 
loÿl
 
¡©us
 = 
ns
:
	$g‘
()

305 
funùiÚ
 
Ïı
:
	$wa™FÜLšk
(
Çme
, 
mšLšks
)

306 
£lf
 ~ğ
Ïı
 
th’


307  
Ïı
:
	$wa™FÜLšk
(
£lf
, 
Çme
)

308 
’d


309 
nÙ
 
¡©us
[
Çme
] 
th’


310 
libmoÚ
.
	$¦“pMlisIdË
(100)

311 
’d


312 
nÙ
 
¡©us
[
Çme
] 
th’


313 -- 
yes
, 
this
 
is
 
‹chniÿÎy
 
¥—kšg
 
a
 
¿û
 
cÚd™iÚ
 
the
 
Ùh”
 
th»ad
 
kes
 >ğ100
ms
 
to
 
¡¬tup
...

314 
	`´štf
("PÜˆchªÃÈ% dÛ nÙƒxi¡", 
Çme
)

315 
’d


316 
mšLšks
 = mšLšk 
Ü
 
¡©us
[
Çme
].
numPÜts


317 
	`´štf
("Wa™šg fÜ‡ˆËa¡ %d…Üt Ú LACP chªÃÈ% tØcomup...", 
mšLšks
, 
Çme
)

318 
loÿl
 
cu¼’t
 = 0

319 
Œue
 do

320 
loÿl
 
up
 = 
¡©us
[
Çme
].up

321 
up
 ~ğ
cu¼’t
 
th’


322 
	`´štf
("%d…Üt% up", 
up
, u°> 1 
ªd
 "s" 
Ü
 "")

323 
cu¼’t
 = 
up


324 
up
 >ğ
mšLšks
 
th’


326 
’d


327 
’d


328 
libmoÚ
.
	$¦“pMlisIdË
(100)

329 
’d


330 
’d


332 
funùiÚ
 
Ïı
:
	$g‘Mac
(
Çme
)

333 
£lf
 ~ğ
Ïı
 
th’


334  
Ïı
:
	$g‘Mac
(
£lf
)

335 
’d


336  
¡©us
[
Çme
].
mac


337 
’d


339 
loÿl
 
funùiÚ
 
	$ÏıTask
(
Çme
, 
queues
)

340 
Çme
 =ğ"chªÃlId" 
th’


341 
log
:
	`çl
("name channelId is„eserved")

342 
’d


343 
loÿl
 
ÏıMac
 = 
queues
[1].
txQueue
.
dev
:
	`g‘MacSŒšg
()

344 -- 
g’”©e
 
unique
 
key
 
this
 
chªÃl
 
to
 
suµÜt
 
muÉË
 
sks


345 
¡©us
.
lock
:
	$lock
()

346 
loÿl
 
key
 = (
¡©us
.
chªÃlId
 
Ü
 0) + 1

347 
¡©us
.
chªÃlId
 = 
key


348 
¡©us
.
lock
:
	$uÆock
()

349 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

350 
buf
:
	$g‘LaıPack‘
():
fl
{

351 
ÏıAùÜSysId
 = 
ÏıMac
,

352 
ÏıAùÜSysPriÜ™y
 = 0x7FFF,

353 
ÏıAùÜPÜtPriÜ™y
 = 0x7FFF

354 
	}
}

355 
	g’d
)

356 
loÿl
 
	gbufs
 = 
memÜy
.
	$bufA¼ay
(1)

357 
loÿl
 
txBufs
 = 
mem
:
	$bufA¼ay
(1)

358 
i
, 
pÜt
 
š
 
	$aœs
(
queues
) do

359 
pÜt
.
rxQueue
.
dev
:
	`l2F‹r
(
‘h
.
TYPE_LACP
,…ort.rxQueue)

360 -- 
»ûive
 
¡©e
 
machše


361 
pÜt
.
rxS‹
 = "EXPIRED"

362 
pÜt
.
rxS‹Timeout
 = 0

363 
pÜt
.
·¹ÃrInfo
 = 
ffi
.
	`Ãw
("struct†acp_info")

364 
pÜt
.
aùÜInfo
 = 
ffi
.
	`Ãw
("struct†acp_info")

365 
pÜt
.
¡©eFÏgs
 = 
b™
.
	$bÜ
(
Ïı
.
STATE_ACT
,†aı.
STATE_AGG
,†aı.
STATE_DEF
,†aı.
STATE_EXP
)

366 
’d


367 
¡©us
[
Çme
] = { 
up
 = 0, 
numPÜts
 = #queues, 
mac
 = 
ÏıMac
 
	}
}

368 
loÿl
 
	gÏ¡Upd©e
 = 0

369 
libmoÚ
.
	$ruÂšg
() do

370 
i
, 
pÜt
 
š
 
	$aœs
(
queues
) do

371 -- 
»ûive


372 
loÿl
 
rx
 = 
pÜt
.
rxQueue
:
	$ŒyRecvIdË
(
bufs
, 100)

373 
i
 = 1, 
rx
 do

374 
loÿl
 
pkt
 = 
bufs
[1]:
	$g‘LaıPack‘
()

375 
pkt
.
Ïı
:
	$v®id©e
(è
th’


376 
pÜt
.
rxS‹
 = "CURRENT"

377 
pÜt
.
rxS‹Timeout
 = 
	`g‘MÚÙÚicTime
(è+ 
LACP_TIMEOUT


378 
ffi
.
	`cİy
(
pÜt
.
·¹ÃrInfo
, 
pkt
.
Ïı
.
aùÜ
, ffi.("struct†acp_info"))

379 
pÜt
.
aùÜInfo
:
	$equ®sIgnÜeS‹
(
pkt
.
Ïı
.
·¹Ãr
è
th’


380 
pÜt
.
¡©eFÏgs
 = 
b™
.
	$bÜ
(
pÜt
.
¡©eFÏgs
, 
Ïı
.
STATE_SYNC
)

381 
pÜt
.
¡©eFÏgs
 = 
b™
.
	`bªd
ÕÜt.¡©eFÏgs, b™.
	$bnÙ
(
Ïı
.
STATE_DEF
))

382 
pÜt
.
¡©eFÏgs
 = 
b™
.
	$bÜ
(
pÜt
.
¡©eFÏgs
, 
Ïı
.
STATE_COL
)

383 
’d


384 
loÿl
 
down
 = 
çl£


385 
b™
.
	`bªd
(
pkt
.
Ïı
.
aùÜ
.
¡©e
,†aı.
STATE_COL
è~ğ0 
th’


386 
pÜt
.
¡©eFÏgs
 = 
b™
.
	$bÜ
(
pÜt
.
¡©eFÏgs
, 
Ïı
.
STATE_DIST
)

388 
pÜt
.
¡©eFÏgs
 = 
b™
.
	`bªd
ÕÜt.¡©eFÏgs, b™.
	$bnÙ
(
Ïı
.
STATE_DIST
))

389 
down
 = 
Œue


390 
’d


391 
b™
.
	`bªd
(
pkt
.
Ïı
.
aùÜ
.
¡©e
,†aı.
STATE_DIST
è~ğ0 
th’


392 
pÜt
.
¡©eFÏgs
 = 
b™
.
	$bÜ
(
pÜt
.
¡©eFÏgs
, 
Ïı
.
STATE_COL
)

394 
pÜt
.
¡©eFÏgs
 = 
b™
.
	`bªd
ÕÜt.¡©eFÏgs, b™.
	$bnÙ
(
Ïı
.
STATE_COL
))

395 
down
 = 
Œue


396 
’d


397 
pÜt
.
up
 = 
nÙ
 
down


399 
log
:
	`w¬n
("Received unsupported LACPDU")

400 
’d


401 
’d


402 
bufs
:
	`ä“
(
rx
)

403 -- 
Œªsm™
 
ev”y
 
£cÚd


404 
	`g‘MÚÙÚicTime
(è> 
Ï¡Upd©e
 + 1 
th’


405 
i
, 
pÜt
 
š
 
	$aœs
(
queues
) do

406 
	`g‘MÚÙÚicTime
(è> 
pÜt
.
rxS‹Timeout
 
th’


407 
pÜt
.
rxS‹
 = "EXPIRED"

408 
pÜt
.
¡©eFÏgs
 = 
b™
.
	$bÜ
(
Ïı
.
STATE_ACT
,†aı.
STATE_AGG
,†aı.
STATE_DEF
,†aı.
STATE_EXP
)

409 
pÜt
.
·¹ÃrInfo
 = 
ffi
.
	`Ãw
("struct†acp_info")

410 
pÜt
.
aùÜInfo
 = 
ffi
.
	`Ãw
("struct†acp_info")

411 
’d


412 
pÜt
.
rxS‹
 =ğ"EXPIRED" 
th’


413 
pÜt
.
¡©eFÏgs
 = 
b™
.
	$bÜ
(
pÜt
.
¡©eFÏgs
, 
Ïı
.
STATE_EXP
)

415 
pÜt
.
¡©eFÏgs
 = 
b™
.
	`bªd
ÕÜt.¡©eFÏgs, b™.
	$bnÙ
(
Ïı
.
STATE_EXP
))

416 
’d


417 
txBufs
:
	$®loc
(
Ïı
.
PKT_SIZE
)

418 
loÿl
 
pkt
 = 
txBufs
[1]:
	$g‘LaıPack‘
()

419 
pkt
.
‘h
.
¤c
:
	`£tSŒšg
(
pÜt
.
txQueue
.
dev
:
	$g‘MacSŒšg
())

420 
pkt
.
Ïı
.
aùÜ
:
	$£tKey
(
key
)

421 
pkt
.
Ïı
.
aùÜ
:
	`£tPÜtId
(
pÜt
.
txQueue
.
id
 + 1000)

422 
pkt
.
Ïı
.
aùÜ
:
	$£tS‹
(
pÜt
.
¡©eFÏgs
)

423 
ffi
.
	`cİy
(
pÜt
.
aùÜInfo
, 
pkt
.
Ïı
.
aùÜ
, ffi.("struct†acp_info"))

424 
ffi
.
	`cİy
(
pkt
.
Ïı
.
·¹Ãr
, 
pÜt
.
·¹ÃrInfo
, ffi.("struct†acp_info"))

425 
pÜt
.
txQueue
:
	$£nd
(
txBufs
)

426 
’d


427 
Ï¡Upd©e
 = 
	$g‘MÚÙÚicTime
()

428 
’d


429 
’d


430 
loÿl
 
numPÜtsUp
 = 0

431 
i
, 
pÜt
 
š
 
	$aœs
(
queues
) do

432 
pÜt
.
up
 
th’


433 
numPÜtsUp
 =‚umPortsUp + 1

434 
’d


435 
’d


436 
¡©us
[
Çme
] = { 
up
 = 
numPÜtsUp
, 
numPÜts
 = #queues, 
mac
 = 
ÏıMac
 
	}
}

437 
	glibmoÚ
.
	$¦“pMlisIdË
(1)

438 
’d


439 
’d


441 
__MG_LACP_TASK
 = 
ÏıTask


443  
Ïı


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/newProtocolTemplate.lua

2 --- @
fe
 
	gPROTO
.
	glua


3 --- @
	$br›f
 (
PROTO
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
PROTO_h—d”
 
¡ruùs


5 --- 
Inşudes
:

6 --- - 
PROTO
 
cÚ¡ªts


7 --- - 
PROTO
 
h—d”
 
ut™y


8 --- - 
Defš™iÚ
 
of
 
PROTO
 
·ck‘s


12 -- 
U£
 
this
 
fe
 
as
 
‹m¶©e
 
wh’
 
im¶em’tšg
 
a
 
Ãw
 
	`´ÙocŞ
 (
to
 
im¶em’t
 
®l
 
mªd©Üy
 
¡uff
)

13 -- 
R•Ïû
 
®l
 
occu¼’ûs
 
of
 
PROTO
 
w™h
 
your
 
	`´ÙocŞ
 (
e
.
g
. 
sùp
)

14 -- 
Remove
 
uÂeûs§ry
 
comm’ts
 
š
 
this
 
	`fe
 (comm’t 
šb‘w“n
 [[...]])

15 -- 
Neûs§ry
 
chªges
 
to
 
Ùh”
 
fes
:

16 -- - 
·ck‘
.
lua
: 
the
 
h—d”
 
has
 
a
 
Ëngth
 
memb”
, 
ad­t
 
·ck‘S‘L’gth
;

17 -- 
the
 
·ck‘
 
has
 
a
 
checksum
, 
ad­t
 
	$ü—‹Sck
 (
loİ
 
©
 
’d
 
of
 
funùiÚ
è
ªd
 
·ck‘C®cuÏ‹Checksums


18 -- - 
´Ùo
/´Ùo.
lua
: 
add
 
PROTO
.lu¨
to
 
the
 
li¡
 
so
 
™
 
g‘s
 
lßded


20 
loÿl
 
ffi
 = 
»quœe
 "ffi"

21 
»quœe
 "proto.template"

22 
loÿl
 
š™H—d”
 = initHeader

26 ---- 
PROTO
 
cÚ¡ªts


29 --- 
PROTO
 
´ÙocŞ
 
cÚ¡ªts


30 
loÿl
 
PROTO
 = {
	}
}

34 ---- 
PROTO
 
h—d”


37 
PROTO
.
h—d”FÜm©
 = [[

38 
ušt8_t
 
xyz
;

41 --- 
V¬ŸbË
 
sized
 
memb”


42 
	gPROTO
.
	gh—d”V¬ŸbËMemb”
 = 
n


44 --- 
ModuË
 
PROTO_add»ss
 

45 
loÿl
 
PROTOH—d”
 = 
	$š™H—d”
()

46 
PROTOH—d”
.
__šdex
 = PROTOHeader

48 --[[ 
®l
 
memb”s
 
of
 
the
 
h—d”
 
w™h
 
nÚ
-
¡ªd¬d
 
d©a
 
ty³
: 
£t
, 
g‘
, 
g‘SŒšg


49 -- 
£t
 
®so
 
¥ecify
 
a
 
su™abË
  
v®ue


51 --- 
S‘
 
the
 
XYZ
.

52 --- @
·¿m
 
XYZ
 
of
 
the
 
PROTO
 
h—d”
 
as
 
A
 
b™
 
š‹g”
.

53 
funùiÚ
 
PROTOH—d”
:
	$£tXYZ
()

54 ğ
Ü
 0

55 
’d


57 --- 
R‘r›ve
 
the
 
XYZ
.

58 --- @ 
XYZ
 
as
 
A
 
b™
 
š‹g”
.

59 
funùiÚ
 
PROTOH—d”
:
	$g‘XYZ
()

60  
n


61 
’d


63 --- 
R‘r›ve
 
the
 
XYZ
 
as
 
¡ršg
.

64 --- @ 
XYZ
 
as
 
¡ršg
.

65 
funùiÚ
 
PROTOH—d”
:
	$g‘XYZSŒšg
()

66  
n


67 
’d


69 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
PROTO
 
h—d”
.

70 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

71 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

72 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
PROTOXYZ


73 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'PROTO'.

74 --- @
code


75 --- 
	`fl
(è-- 
Úly
  
v®ues


76 --- 
fl
{ 
PROTOXYZ
=1 
	}
} -- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 PROTOXYZ, ...

77 --- @
’dcode


78 
funùiÚ
 
	gPROTOH—d”
:
	$fl
(
¬gs
, 
´e
)

79 
¬gs
 =‡rg 
Ü
 {
	}
}

80 
´e
 =…» 
Ü
 "PROTO"

82 
£lf
:
£tXYZ
(
¬gs
[
´e
 .. "PROTOXYZ"])

83 
’d


85 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

86 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'PROTO'.

87 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

88 --- @
£e
 
PROTOH—d”
:
fl


89 
funùiÚ
 
PROTOH—d”
:
	$g‘
(
´e
)

90 
´e
 =…» 
Ü
 "PROTO"

92 
loÿl
 
¬gs
 = {
	}
}

93 
¬gs
[
´e
 .. "PROTOXYZ"] = 
£lf
:
	$g‘XYZ
()

95  
¬gs


96 
’d


98 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

99 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

100 
funùiÚ
 
PROTOH—d”
:
	$g‘SŒšg
()

101  "PROTO " .. 
£lf
:
	$g‘XYZSŒšg
()

102 
’d


104 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
	`Úe
 (
š
 
a
 
·ck‘
)

105 --- 
FÜ
 
š¡ªû
: 
š
 
tı
/
udp
 
ba£d
 
Ú
 
the
 
pÜts


106 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


107 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

108 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. '‘h', '4', 
n
)

109 
funùiÚ
 
PROTOH—d”
:
	$»sŞveNextH—d”
()

110  
n


111 
’d


113 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
)

114 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength

115 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e


116 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl


117 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'PROTO'

118 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
mÜe
)

119 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


120 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


121 --- @ 
TabË
 
of
 
ÇmedArgs


122 --- @
£e
 
PROTOH—d”
:
fl


123 
funùiÚ
 
PROTOH—d”
:
	$£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
)

124  
ÇmedArgs


125 
’d


129 ---- 
M‘©y³s


132 
PROTO
.
m‘©y³
 = 
PROTOH—d”


135  
PROTO


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/packetChecks.lua

2 --- @
fe
 
	g·ck‘Checks
.
	glua


3 --- @
br›f
 
Check
 
of
 
·ck‘
 
	gty³s


6 
loÿl
 
	g´Ùo
 = 
»quœe
 "proto/proto"

8 
loÿl
 
mod
 = {}

10 
funùiÚ
 
mod
.
	$isIP4
(
pkt
)

11  
pkt
.
‘h
:
	`g‘Ty³
(è=ğ
´Ùo
.‘h.
TYPE_IP


12 
’d


14 
funùiÚ
 
mod
.
	$isTı4
(
pkt
)

15  
mod
.
	$isIP4
(
pkt
è
ªd
…kt.
4
:
	`g‘PrÙocŞ
(è=ğ
´Ùo
.4.
PROTO_TCP


16 
’d


18  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/proto.lua

2 --- @
fe
 
	g´Ùo
.
	glua


3 --- @
br›f
 
Inşudes
 
®l
 
´ÙocŞ
 
moduËs
 
š
 
Úe
 
	g¶aû
.

5 
loÿl
 
	g´Ùo
 = {}

7 -- 
Üd”
 
is
 
»Ëvªt
 
as
 
š¡ªû
 
¬p
 
»quœes
 
‘h
/

 
add»s£s


8 
´Ùo
.
‘h
 = 
»quœe
 "proto.ethernet"

9 
´Ùo
.
‘h”Ãt
 =…rÙo.
‘h


10 
´Ùo
.
4
 = 
»quœe
 "proto.ip4"

11 
´Ùo
.
6
 = 
»quœe
 "proto.ip6"

12 
´Ùo
.
¬p
 = 
»quœe
 "proto.arp"

13 
´Ùo
.
icmp
 = 
»quœe
 "proto.icmp"

14 
´Ùo
.
udp
 = 
»quœe
 "proto.udp"

15 
´Ùo
.
tı
 = 
»quœe
 "proto.tcp"

16 
´Ùo
.
±p
 = 
»quœe
 "proto.ptp"

17 
´Ùo
.
vxÏn
 = 
»quœe
 "proto.vxlan"

18 
´Ùo
.
e¥
 = 
»quœe
 "proto.esp"

19 
´Ùo
.
ah
 = 
»quœe
 "proto.ah"

20 
´Ùo
.
dns
 = 
»quœe
 "proto.dns"

21 
´Ùo
.
fix
 = 
»quœe
 "proto.ipfix"

22 
´Ùo
.
sæow
 = 
»quœe
 "proto.sflow"

23 
´Ùo
.
Ïı
 = 
»quœe
 "proto.lacp"

24 
´Ùo
.
g»
 = 
»quœe
 "proto.gre"

26  
´Ùo


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ptp.lua

2 --- @
fe
 
	g±p
.
	glua


3 --- @
br›f
 
P»cisiÚ
 
time
 
	$´ÙocŞ
 (
PTP
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
±p_h—d”
 

5 --- 
Inşudes
:

6 --- - 
PTP
 
cÚ¡ªts


7 --- - 
PTP
 
h—d”
 
ut™y


8 --- - 
Defš™iÚ
 
of
 
PTP
 
·ck‘s


11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

13 
»quœe
 "utils"

14 
»quœe
 "proto.template"

15 
loÿl
 
š™H—d”
 = initHeader

17 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

18 
loÿl
 
Áoh16
, 
htÚ16
 =‚toh16, hton16

19 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
ğ
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

20 
loÿl
 
i¡y³
 = 
ffi
.istype

21 
loÿl
 
fÜm©
 = 
¡ršg
.format

25 ---- 
PTP
 
cÚ¡ªts


28 --- 
P
 
´ÙocŞ
 
cÚ¡ªts


29 
loÿl
 
±p
 = {
	}
}

31 -- 
Mes§ge
 
ty³
: 
sync


32 
±p
.
TYPE_SYNC
 = 0

33 -- 
Mes§ge
 
ty³
: 
d–ay
 
»q


34 
±p
.
TYPE_DELAY_REQ
 = 1

35 -- 
Mes§ge
 
ty³
: 
fŞlow
 
up


36 
±p
.
TYPE_FOLLOW_UP
 = 8

37 -- 
Mes§ge
 
ty³
: 
d–ay
 
»¥


38 
±p
.
TYPE_DELAY_RESP
 = 9

40 -- 
Mes§ge
 
cÚŒŞ
: 
sync


41 
±p
.
CONTROL_SYNC
 = 0

42 -- 
Mes§ge
 
cÚŒŞ
: 
d–ay
 
»q


43 
±p
.
CONTROL_DELAY_REQ
 = 1

44 -- 
Mes§ge
 
cÚŒŞ
: 
fŞlow
 
up


45 
±p
.
CONTROL_FOLLOW_UP
 = 2

46 -- 
Mes§ge
 
cÚŒŞ
: 
d–ay
 
»¥


47 
±p
.
CONTROL_DELAY_RESP
 = 3

51 ---- 
PTP
 
h—d”


54 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


55 
±p
.
h—d”FÜm©
 = [[

56 
ušt8_t
 
mes§geTy³
;

57 
ušt8_t
 
v”siÚPTP
;

58 
ušt16_t
 
Ën
;

59 
ušt8_t
 
domaš
;

60 
ušt8_t
 
»£rved
;

61 
ušt16_t
 
æags
;

62 
ušt32_t
 
cÜ»ùiÚ
[2];

63 
ušt32_t
 
	g»£rved2
;

64 
ušt8_t
 
	goui
[3];

65 
ušt8_t
 
	guuid
[5];

66 
ušt16_t
 
	g±pNodePÜt
;

67 
ušt16_t
 
	g£qu’ûId
;

68 
ušt8_t
 
	gcÚŒŞ
;

69 
ušt8_t
 
	glogMes§geIÁ”v®
;

72 --- 
V¬ŸbË
 
sized
 
memb”


73 
	g±p
.
	gh—d”V¬ŸbËMemb”
 = 
n


75 --- 
ModuË
 
±p_h—d”
 

76 
loÿl
 
±pH—d”
 = 
	$š™H—d”
()

77 
±pH—d”
.
__šdex
 =…tpHeader

79 --- 
S‘
 
the
 
mes§ge
 
ty³
.

80 --- @
·¿m
 
mt
 
Mes§ge
 
ty³
 
as
 8 
b™
 
š‹g”
.

81 
funùiÚ
 
±pH—d”
:
	$£tMes§geTy³
(
mt
)

82 
mt
 = mˆ
Ü
 
±p
.
TYPE_SYNC


83 
£lf
.
mes§geTy³
 = 
mt


84 
’d


86 --- 
R‘r›ve
 
the
 
mes§ge
 
ty³
.

87 --- @ 
Mes§ge
 
ty³
 
as
 8 
b™
 
š‹g”
.

88 
funùiÚ
 
±pH—d”
:
	$g‘Mes§geTy³
()

89  
£lf
.
mes§geTy³


90 
’d


92 --- 
R‘r›ve
 
the
 
mes§ge
 
ty³
.

93 --- @ 
Mes§ge
 
ty³
 
š
 
¡ršg
 
fÜm©
.

94 
funùiÚ
 
±pH—d”
:
	$g‘Mes§geTy³SŒšg
()

95 
loÿl
 
ty³
 = 
£lf
:
	$g‘Mes§geTy³
()

96 
loÿl
 
ş—¹ext
 = ""

98 
ty³
 =ğ
±p
.
TYPE_SYNC
 
th’


99 
ş—¹ext
 = "(sync)"

100 
–£if
 
ty³
 =ğ
±p
.
TYPE_DELAY_REQ
 
th’


101 
ş—¹ext
 = "(delay„eq)"

102 
–£if
 
ty³
 =ğ
±p
.
TYPE_FOLLOW_UP
 
th’


103 
ş—¹ext
 = "(follow up)"

104 
–£if
 
ty³
 =ğ
±p
.
TYPE_DELAY_RESP
 
th’


105 
ş—¹ext
 = "(delay„esp)"

107 
ş—¹ext
 = "(unknown)"

108 
’d


110  
	`fÜm©
("0x%02x %s", 
ty³
, 
ş—¹ext
)

111 
’d


113 --- 
S‘
 
the
 
v”siÚ
.

114 --- @
·¿m
 
v
 
V”siÚ
 
as
 8 
b™
 
š‹g”
.

115 
funùiÚ
 
±pH—d”
:
	$£tV”siÚ
(
v
)

116 
v
 = v 
Ü
 0x02 -- 
v”siÚ
 2

117 
£lf
.
v”siÚPTP
 = 
v


118 
’d


120 --- 
R‘r›ve
 
the
 
v”siÚ
.

121 --- @ 
V”siÚ
 
as
 8 
b™
 
š‹g”
.

122 
funùiÚ
 
±pH—d”
:
	$g‘V”siÚ
()

123  
£lf
.
v”siÚPTP


124 
’d


126 --- 
R‘r›ve
 
the
 
v”siÚ
.

127 --- @ 
V”siÚ
 
š
 
¡ršg
 
fÜm©
.

128 
funùiÚ
 
±pH—d”
:
	$g‘V”siÚSŒšg
()

129  
£lf
:
	$g‘V”siÚ
()

130 
’d


132 --- 
S‘
 
the
 
Ëngth
.

133 --- @
·¿m
 
l
 
L’gth
 
as
 16 
b™
 
š‹g”
.

134 
funùiÚ
 
±pH—d”
:
	$£tL’gth
(
l
)

135 
l
 =† 
Ü
 34 + 10 + 0 -- 
h—d”
, 
body
, 
suffix


136 
£lf
.
Ën
 = 
	$htÚ16
(
l
)

137 
’d


139 --- 
R‘r›ve
 
the
 
Ëngth
.

140 --- @ 
L’gth
 
as
 16 
b™
 
š‹g”
.

141 
funùiÚ
 
±pH—d”
:
	$g‘L’gth
()

142  
	$htÚ16
(
£lf
.
Ën
)

143 
’d


145 --- 
R‘r›ve
 
the
 
Ëngth
.

146 --- @ 
L’gth
 
š
 
¡ršg
 
fÜm©
.

147 
funùiÚ
 
±pH—d”
:
	$g‘L’gthSŒšg
()

148  
£lf
:
	$g‘L’gth
()

149 
’d


151 --- 
S‘
 
the
 
domaš
.

152 --- @
·¿m
 
d
 
Domaš
 
as
 8 
b™
 
š‹g”
.

153 
funùiÚ
 
±pH—d”
:
	$£tDomaš
(
d
)

154 
d
 = d 
Ü
 0 --  
domaš


155 
£lf
.
domaš
 = 
d


156 
’d


158 --- 
R‘r›ve
 
the
 
domaš
.

159 --- @ 
Domaš
 
as
 8 
b™
 
š‹g”
.

160 
funùiÚ
 
±pH—d”
:
	$g‘Domaš
()

161  
£lf
.
domaš


162 
’d


164 --- 
R‘r›ve
 
the
 
domaš
.

165 --- @ 
Domaš
 
š
 
¡ršg
 
fÜm©
.

166 
funùiÚ
 
±pH—d”
:
	$g‘DomašSŒšg
()

167  
£lf
:
	$g‘Domaš
()

168 
’d


170 --- 
S‘
 
the
 
»£rved
 
f›ld
.

171 --- @
·¿m
 
ušt8
 
Re£rved
 
as
 8 
b™
 
š‹g”
.

172 
funùiÚ
 
±pH—d”
:
	$£tRe£rved
(
ušt8
)

173 
ušt8
 = ušt8 
Ü
 0

174 
£lf
.
»£rved
 = 
ušt8


175 
’d


177 --- 
R‘r›ve
 
the
 
»£rved
 
f›ld
.

178 --- @ 
Re£rved
 
f›ld
 
as
 8 
b™
 
š‹g”
.

179 
funùiÚ
 
±pH—d”
:
	$g‘Re£rved
()

180  
£lf
.
»£rved


181 
’d


183 --- 
R‘r›ve
 
the
 
»£rved
 
f›ld
.

184 --- @ 
Re£rved
 
f›ld
 
š
 
¡ršg
 
fÜm©
.

185 
funùiÚ
 
±pH—d”
:
	$g‘Re£rvedSŒšg
()

186  
	`fÜm©
("0x%02x", 
£lf
:
	$g‘Re£rved
())

187 
’d


189 --- 
S‘
 
the
 
æags
.

190 --- @
·¿m
 
f
 
FÏgs
 
as
 16 
b™
 
š‹g”
.

191 
funùiÚ
 
±pH—d”
:
	$£tFÏgs
(
f
)

192 
f
 = f 
Ü
 0 -- 
no
 
æags


193 
£lf
.
æags
 = 
	$htÚ16
(
f
)

194 
’d


196 --- 
R‘r›ve
 
the
 
æags
.

197 --- @ 
FÏgs
 
as
 16 
b™
 
š‹g”
.

198 
funùiÚ
 
±pH—d”
:
	$g‘FÏgs
()

199  
	$htÚ16
(
£lf
.
æags
)

200 
’d


202 --- 
R‘r›ve
 
the
 
æags
.

203 --- @ 
FÏgs
 
š
 
¡ršg
 
fÜm©
.

204 
funùiÚ
 
±pH—d”
:
	$g‘FÏgsSŒšg
()

205  
	`fÜm©
("0x%04x", 
£lf
:
	$g‘FÏgs
())

206 
’d


208 --- 
S‘
 
the
 
cÜ»ùiÚ
 
f›ld
.

209 --- @
·¿m
 
c
 
CÜ»ùiÚ
 
f›ld
 
as
 
bË
 
of
 
two
 32 
b™
 
š‹g”s
 { 
high
, 
low
 
	}
}.

210 --- @
todo
 
fšd
 
som‘hšg
 
b‘‹r
 
	gthis
, 64 
b™
 
£ems
 
to
 
be
 
ŒoubË
 
	glua
?

211 --- 
	gc
 = { 
high32b™
, 
low32b™
 }

212 
funùiÚ
 
±pH—d”
:
	$£tCÜ»ùiÚ
(
c
)

213 
c
 = c 
Ü
 { 
high
=0, 
low
=0 
	}
} -- 
cÜ»ùiÚ
 
	goff£t
 0

214 
	g£lf
.
	gcÜ»ùiÚ
[0] = 
	$htÚ
(
c
.
low
)

215 
£lf
.
cÜ»ùiÚ
[1] = 
	$htÚ
(
c
.
high
)

216 
’d


218 --- 
R‘r›ve
 
the
 
cÜ»ùiÚ
 
f›ld
.

219 --- @ 
CÜ»ùiÚ
 
f›ld
 
as
 
bË
 
two
 32 
b™
 
š‹g”s
 { 
high
, 
low
 
	}
}.

220 
funùiÚ
 
±pH—d”
:
	$g‘CÜ»ùiÚ
()

221  { 
high
 = 
	`htÚ
(
£lf
.
cÜ»ùiÚ
[1]), 
low
 = htÚ(£lf.cÜ»ùiÚ[0]è
	}
}

222 
	g’d


224 --- 
R‘r›ve
 
the
 
cÜ»ùiÚ
 
	gf›ld
.

225 --- @ 
CÜ»ùiÚ
 
f›ld
 
š
 
¡ršg
 
	gfÜm©
.

226 
funùiÚ
 
	g±pH—d”
:
	$g‘CÜ»ùiÚSŒšg
()

227 
loÿl
 
t
 = 
£lf
:
	$g‘CÜ»ùiÚ
()

228  
	`fÜm©
("0x%08x%08x", 
t
.
high
,.
low
)

229 
’d


231 --- 
S‘
 
the
 
»£rved2
 
f›ld
.

232 --- @
·¿m
 
ušt32
 
Re£rved2
 
as
 32 
b™
 
š‹g”
.

233 
funùiÚ
 
±pH—d”
:
	$£tRe£rved2
(
ušt32
)

234 
ušt32
 = ušt32 
Ü
 0

235 
£lf
.
»£rved2
 = 
	$htÚ
(
ušt32
)

236 
’d


238 --- 
R‘r›ve
 
the
 
»£rved2
 
f›ld
.

239 --- @ 
Re£rved2
 
f›ld
 
as
 32 
b™
 
š‹g”
.

240 
funùiÚ
 
±pH—d”
:
	$g‘Re£rved2
()

241  
	$htÚ
(
£lf
.
»£rved2
)

242 
’d


244 --- 
R‘r›ve
 
the
 
»£rved2
 
f›ld
.

245 --- @ 
Re£rved2
 
f›ld
 
š
 
¡ršg
 
fÜm©
.

246 
funùiÚ
 
±pH—d”
:
	$g‘Re£rved2SŒšg
()

247  
	`fÜm©
("0x%08x", 
£lf
:
	$g‘Re£rved2
())

248 
’d


250 --- 
S‘
 
the
 
oui
.

251 --- @
·¿m
 
Oui
 
as
 24 
b™
 
š‹g”
.

252 
funùiÚ
 
±pH—d”
:
	$£tOui
()

253 ğ
Ü
 0

255 -- 
X
 3 2 1 -> 1 2 3

256 
£lf
.
oui
[0] = 
	`rshiá
(
	`bªd
(, 0xFF0000), 16)

257 
£lf
.
oui
[1] = 
	`rshiá
(
	`bªd
(, 0x00FF00), 8)

258 
£lf
.
oui
[2] = 
	$bªd
(, 0x0000FF)

259 
’d


261 --- 
R‘r›ve
 
the
 
oui
.

262 --- @ 
Oui
 
as
 24 
b™
 
š‹g”
.

263 
funùiÚ
 
±pH—d”
:
	$g‘Oui
()

264  
	`bÜ
(
	`lshiá
(
£lf
.
oui
[0], 16), bor(lshift(self.oui[1], 8), self.oui[2]))

265 
’d


267 --- 
R‘r›ve
 
the
 
oui
.

268 --- @ 
Oui
 
š
 
¡ršg
 
fÜm©
.

269 
funùiÚ
 
±pH—d”
:
	$g‘OuiSŒšg
()

270  
	`fÜm©
("0x%06x", 
£lf
:
	$g‘Oui
())

271 
’d


273 --- 
S‘
 
the
 
uuid
.

274 --- @
·¿m
 
Uuis
 
as
 
bË
 
of
 
two
 
š‹g”s
 { 
high
, 
low
 
	}
}, high 
	gas
 8 
b™
 
š‹g”
 
ªd
†ow‡ 32 b™ 
	gš‹g”
.

275 --- @
todo
 
§me
 
´obËm
 
as
 
w™h
 
cÜ»ùiÚ
 
	gf›ld


276 --- 
	gc
 = { 
high8b™
, 
low32b™
 }

277 
funùiÚ
 
±pH—d”
:
	$£tUuid
()

278 ğ
Ü
 { 
high
=0, 
low
=0 
	}
}

280 -- 
X
 X 
	gX
 1 5 4 3 2 -> 1 2 3 4 5

281 
	g£lf
.
	guuid
[0] = .
high


282 
£lf
.
uuid
[1] = 
rshiá
(
bªd
(.
low
, 0xFF000000), 24)

283 
	g£lf
.
	guuid
[2] = 
rshiá
(
bªd
(.
low
, 0x00FF0000), 16)

284 
	g£lf
.
	guuid
[3] = 
rshiá
(
bªd
(.
low
, 0x0000FF00), 8)

285 
	g£lf
.
	guuid
[4] = 
	$bªd
(.
low
, 0x000000FF)

286 
’d


288 --- 
R‘r›ve
 
the
 
Uuid
.

289 --- @ 
Uuid
 
as
 
bË
 
of
 
two
 
š‹g”s
 { 
high
, 
low
 
	}
}, high 
is
 
	gª
 8 
b™
 
	gš‹g”
, 
	glow
 32 bit integer.

290 
funùiÚ
 
	g±pH—d”
:
	$g‘Uuid
()

291 
loÿl
 
t
 = {
	}
}

292 
t
.
high
 = 
£lf
.
uuid
[0]

293 
t
.
low
 = 
bÜ
(
lshiá
(
£lf
.
uuid
[1], 24), bor(lshift(self.uuid[2], 16), bor(lshift(self.uuid[3], 8), self.uuid[4])))

294  
t


295 
	g’d


297 --- 
R‘r›ve
 
the
 
	gUuid
.

298 --- @ 
Uuid
 
š
 
¡ršg
 
	gfÜm©
.

299 
funùiÚ
 
	g±pH—d”
:
	$g‘UuidSŒšg
()

300 
loÿl
 
t
 = 
£lf
:
	$g‘Uuid
()

301  
	`fÜm©
("0x%02x%08x", 
t
.
high
,.
low
)

302 
’d


304 --- 
S‘
 
the
 
node
 
pÜt
.

305 --- @
·¿m
 
p
 
Node
 
pÜt
 
as
 16 
b™
 
š‹g”
.

306 
funùiÚ
 
±pH—d”
:
	$£tNodePÜt
(
p
)

307 
p
 =… 
Ü
 1

308 
£lf
.
±pNodePÜt
 = 
	$htÚ16
(
p
)

309 
’d


311 --- 
R‘r›ve
 
the
 
node
 
pÜt
.

312 --- @ 
Node
 
pÜt
 
as
 16 
b™
 
š‹g”
.

313 
funùiÚ
 
±pH—d”
:
	$g‘NodePÜt
()

314  
	$htÚ16
(
£lf
.
±pNodePÜt
)

315 
’d


317 --- 
R‘r›ve
 
the
 
node
 
pÜt
.

318 --- @ 
Node
 
pÜt
 
š
 
¡ršg
 
fÜm©
.

319 
funùiÚ
 
±pH—d”
:
	$g‘NodePÜtSŒšg
()

320  
£lf
:
	$g‘NodePÜt
()

321 
’d


323 --- 
S‘
 
the
 
£qu’û
 
ID
.

324 --- @
·¿m
 
s
 
Sequ’û
 
ID
 
as
 16 
b™
 
š‹g”
.

325 
funùiÚ
 
±pH—d”
:
	$£tSequ’ûID
(
s
)

326 
s
 = s 
Ü
 0

327 
£lf
.
£qu’ûId
 = 
	$htÚ16
(
s
)

328 
’d


330 --- 
R‘r›ve
 
the
 
£qu’û
 
ID
.

331 --- @ 
Sequ’û
 
ID
 
as
 16 
b™
 
š‹g”
.

332 
funùiÚ
 
±pH—d”
:
	$g‘Sequ’ûID
()

333  
	$htÚ16
(
£lf
.
£qu’ûId
)

334 
’d


336 --- 
R‘r›ve
 
the
 
£qu’û
 
ID
.

337 --- @ 
Sequ’û
 
ID
 
š
 
¡ršg
 
fÜm©
.

338 
funùiÚ
 
±pH—d”
:
	$g‘Sequ’ûIDSŒšg
()

339  
£lf
:
	$g‘Sequ’ûID
()

340 
’d


342 --- 
S‘
 
the
 
cÚŒŞ
 
f›ld
.

343 --- @
·¿m
 
c
 
CÚŒŞ
 
f›ld
 
as
 8 
b™
 
š‹g”
.

344 
funùiÚ
 
±pH—d”
:
	$£tCÚŒŞ
(
c
)

345 
c
 = c 
Ü
 
±p
.
CONTROL_SYNC


346 
£lf
.
cÚŒŞ
 = 
c


347 
’d


349 --- 
R‘r›ve
 
the
 
cÚŒŞ
 
f›ld
.

350 --- @ 
CÚŒŞ
 
f›ld
 
as
 8 
b™
 
š‹g”
.

351 
funùiÚ
 
±pH—d”
:
	$g‘CÚŒŞ
()

352  
£lf
.
cÚŒŞ


353 
’d


355 --- 
R‘r›ve
 
the
 
cÚŒŞ
 
f›ld
.

356 --- @ 
CÚŒŞ
 
f›ld
 
š
 
¡ršg
 
fÜm©
.

357 
funùiÚ
 
±pH—d”
:
	$g‘CÚŒŞSŒšg
()

358 
loÿl
 
ty³
 = 
£lf
:
	$g‘CÚŒŞ
()

359 
loÿl
 
ş—¹ext
 = ""

361 
ty³
 =ğ
±p
.
CONTROL_SYNC
 
th’


362 
ş—¹ext
 = "(sync)"

363 
–£if
 
ty³
 =ğ
±p
.
CONTROL_DELAY_REQ
 
th’


364 
ş—¹ext
 = "(delay„eq)"

365 
–£if
 
ty³
 =ğ
±p
.
CONTROL_FOLLOW_UP
 
th’


366 
ş—¹ext
 = "(follow up)"

367 
–£if
 
ty³
 =ğ
±p
.
CONTROL_DELAY_RESP
 
th’


368 
ş—¹ext
 = "(delay„esp)"

370 
ş—¹ext
 = "(unknown)"

371 
’d


373  
	`fÜm©
("0x%02x %s", 
ty³
, 
ş—¹ext
)

374 
’d


376 --- 
S‘
 
the
 
log
 
mes§ge
 
š‹rv®
.

377 --- @
·¿m
 
l
 
Log
 
mes§ge
 
š‹rv®
 
as
 8 
b™
 
š‹g”
.

378 
funùiÚ
 
±pH—d”
:
	$£tLogMes§geIÁ”v®
(
l
)

379 
l
 =† 
Ü
 0x7F --  
v®ue


380 
£lf
.
logMes§geIÁ”v®
 = 
l


381 
’d


383 --- 
R‘r›ve
 
the
 
log
 
mes§ge
 
š‹rv®
.

384 --- @ 
Log
 
mes§ge
 
š‹rv®
 
as
 8 
b™
 
š‹g”
.

385 
funùiÚ
 
±pH—d”
:
	$g‘LogMes§geIÁ”v®
()

386  
£lf
.
logMes§geIÁ”v®


387 
’d


389 --- 
R‘r›ve
 
the
 
log
 
mes§ge
 
š‹rv®
.

390 --- @ 
Log
 
mes§ge
 
š‹rv®
 
š
 
¡ršg
 
fÜm©
.

391 
funùiÚ
 
±pH—d”
:
	$g‘LogMes§geIÁ”v®SŒšg
()

392  
£lf
:
	$g‘LogMes§geIÁ”v®
()

393 
’d


395 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
±p
 
h—d”
.

396 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

397 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

398 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
Mes§geTy³
, 
V”siÚ
, 
L’gth
, 
Domaš
, 
Re£rved
, 
FÏgs
, 
CÜ»ùiÚ
, 
Re£rved2
, 
Oui
, 
Uuid
, 
NodePÜt
, 
Sequ’ûID
, 
CÚŒŞ
, 
LogMes§geIÁ”v®


399 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ptp'.

400 --- @
code


401 --- 
	`fl
(è--- 
Úly
  
v®ues


402 --- 
fl
{ 
±pL’ght
=123, 
TTL
=100 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	g±pL’gth


403 --- @
’dcode


404 
funùiÚ
 
	g±pH—d”
:
	$fl
(
¬gs
, 
´e
)

405 
¬gs
 =‡rg 
Ü
 {
	}
}

406 
´e
 =…» 
Ü
 "ptp"

408 
£lf
:
£tMes§geTy³
(
¬gs
[
´e
 .. "MessageType"])

409 
£lf
:
£tV”siÚ
(
¬gs
[
´e
 .. "Version"])

410 
£lf
:
£tL’gth
(
¬gs
[
´e
 .. "Length"])

411 
£lf
:
£tDomaš
(
¬gs
[
´e
 .. "Domain"])

412 
£lf
:
£tRe£rved
(
¬gs
[
´e
 .. "Reserved"])

413 
£lf
:
£tFÏgs
(
¬gs
[
´e
 .. "Flags"])

414 
£lf
:
£tCÜ»ùiÚ
(
¬gs
[
´e
 .. "Correction"])

415 
£lf
:
£tRe£rved2
(
¬gs
[
´e
 .. "Reserved2"])

416 
£lf
:
£tOui
(
¬gs
[
´e
 .. "Oui"])

417 
£lf
:
£tUuid
(
¬gs
[
´e
 .. "Uuid"])

418 
£lf
:
£tNodePÜt
(
¬gs
[
´e
 .. "NodePort"])

419 
£lf
:
£tSequ’ûID
(
¬gs
[
´e
 .. "SequenceID"])

420 
£lf
:
£tCÚŒŞ
(
¬gs
[
´e
 .. "Control"])

421 
£lf
:
£tLogMes§geIÁ”v®
(
¬gs
[
´e
 .. "LogMessageInterval"])

422 
’d


424 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

425 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'ptp'.

426 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

427 --- @
£e
 
±pH—d”
:
fl


428 
funùiÚ
 
±pH—d”
:
	$g‘
(
´e
)

429 
´e
 =…» 
Ü
 "ptp"

431 
loÿl
 
¬gs
 = {
	}
}

432 
¬gs
[
´e
 .. "Mes§geTyp"] = 
£lf
:
	$g‘Mes§geTy³
()

433 
¬gs
[
´e
 .. "V”siÚ"] = 
£lf
:
	$g‘V”siÚ
()

434 
¬gs
[
´e
 .. "L’gth"] = 
£lf
:
	$g‘L’gth
()

435 
¬gs
[
´e
 .. "Domaš"] = 
£lf
:
	$g‘Domaš
()

436 
¬gs
[
´e
 .. "Re£rved"] = 
£lf
:
	$g‘Re£rved
()

437 
¬gs
[
´e
 .. "FÏgs"] = 
£lf
:
	$g‘FÏgs
()

438 
¬gs
[
´e
 .. "CÜ»ùiÚ"] = 
£lf
:
	$g‘CÜ»ùiÚ
()

439 
¬gs
[
´e
 .. "Re£rved2"] = 
£lf
:
	$g‘Re£rved2
()

440 
¬gs
[
´e
 .. "Oui"] = 
£lf
:
	$g‘Oui
()

441 
¬gs
[
´e
 .. "Uuid"] = 
£lf
:
	$g‘Uuid
()

442 
¬gs
[
´e
 .. "NodePÜt"] = 
£lf
:
	$g‘NodePÜt
()

443 
¬gs
[
´e
 .. "Sequ’ûID"] = 
£lf
:
	$g‘Sequ’ûID
()

444 
¬gs
[
´e
 .. "CÚŒŞ"] = 
£lf
:
	$g‘CÚŒŞ
()

445 
¬gs
[
´e
 .. "LogMes§geIÁ”v®"] = 
£lf
:
	$g‘LogMes§geIÁ”v®
()

447  
¬gs


448 
’d


450 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

451 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

452 
funùiÚ
 
±pH—d”
:
	$g‘SŒšg
()

453  "PTPy°" .. 
£lf
:
	`g‘Mes§geTy³SŒšg
()

454 .. " v” " .. 
£lf
:
	`g‘V”siÚSŒšg
()

455 .. "†’ " .. 
£lf
:
	`g‘L’gthSŒšg
()

456 .. " dom " .. 
£lf
:
	`g‘DomašSŒšg
()

457 .. "„e " .. 
£lf
:
	`g‘Re£rvedSŒšg
()

458 .. " fÏ " .. 
£lf
:
	`g‘FÏgsSŒšg
()

459 .. " cÜ " .. 
£lf
:
	`g‘CÜ»ùiÚSŒšg
()

460 .. "„e " .. 
£lf
:
	`g‘Re£rved2SŒšg
()

461 .. " ou˜" .. 
£lf
:
	`g‘OuiSŒšg
()

462 .. " uuid " .. 
£lf
:
	`g‘UuidSŒšg
()

463 .. "‚od " .. 
£lf
:
	`g‘NodePÜtSŒšg
()

464 .. " seq " .. 
£lf
:
	`g‘Sequ’ûIDSŒšg
()

465 .. " cŒÈ" .. 
£lf
:
	`g‘CÚŒŞSŒšg
()

466 .. "†og " .. 
£lf
:
	$g‘LogMes§geIÁ”v®SŒšg
()

467 
’d


469 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
).

470 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength.

471 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e
.

472 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl
.

473 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'ptp'

474 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
Also
)

475 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


476 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


477 --- @ 
TabË
 
of
 
ÇmedArgs


478 --- @
£e
 
±pH—d”
:
fl


479 
funùiÚ
 
±pH—d”
:
	`£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
)

480 -- 
£t
 
Ëngth


481 
nÙ
 
ÇmedArgs
[
´e
 .. "L’gth"] 
ªd
‚amedArgs["pktL’gth"] 
th’


482 
ÇmedArgs
[
´e
 .. "L’gth"] =‚amedArgs["pktL’gth"] - 
accumuÏ‹dL’gth


483 
’d


484  
ÇmedArgs


485 
’d


489 ---- 
M‘©y³s


492 
±p
.
m‘©y³
 = 
±pH—d”


494  
±p


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/sflow.lua

1 --- 
sFlowv5
 
im¶em’tiÚ


3 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

4 
»quœe
 "proto.template"

5 
loÿl
 
š™H—d”
 = initHeader

7 
loÿl
 
Áoh
, 
	ghtÚ
 =‚toh, 
htÚ


8 
loÿl
 
	gÁoh16
, 
	ghtÚ16
 = 
Áoh16
, 
htÚ16


9 
loÿl
 
	gbÜ
, 
	gbªd
, 
	gbnÙ
, 
	grshiá
, 
	glshiá
ğ
b™
.
bÜ
, 
	gb™
.bªd, b™.bnÙ, b™.rshiá, b™.
lshiá


10 
loÿl
 
	gi¡y³
 = 
ffi
.
i¡y³


11 
loÿl
 
fÜm©
 = 
¡ršg
.format

12 
loÿl
 
ÿ¡
 = 
ffi
.cast

13 
loÿl
 
ušt32
 = 
ffi
.
ty³of
("uint32_t*")

15 -- 
h‰p
:

17 
ffi
.
cdef
[[

18 
__©Œibu‹__
((
__·cked__
)è
sæow_unknown_’Œy
 {

19 
ušt32_t
 
ty³
;

20 
ušt32_t
 
Ën
;

23 
__©Œibu‹__
((
__·cked__
)è
sæow_æow_§m¶e
 {

24 
ušt32_t
 
ty³
;

25 
ušt32_t
 
Ën
;

26 
ušt32_t
 
£q
;

27 
ušt32_t
 
sourû_id
;

28 
ušt32_t
 
§m¶šg_¿‹
;

29 
ušt32_t
 
§m¶e_poŞ
;

30 
ušt32_t
 
drİs
;

31 
ušt32_t
 
šput_pÜt
;

32 
ušt32_t
 
ouut_pÜt
;

33 
ušt32_t
 
num_’Œ›s
;

34 
·ylßd_t
 
·ylßd
;

37 
__©Œibu‹__
((
__·cked__
)è
sæow_ext_sw™ch_d©a
 {

38 
ušt32_t
 
ty³
;

39 
ušt32_t
 
Ën
;

40 
ušt32_t
 
¤c_vÏn
;

41 
ušt32_t
 
¤c_´io
;

42 
ušt32_t
 
d¡_vÏn
;

43 
ušt32_t
 
d¡_´io
;

46 
__©Œibu‹__
((
__·cked__
)è
sæow_¿w_·ck‘
 {

47 
ušt32_t
 
ty³
;

48 
ušt32_t
 
Ën
;

49 
ušt32_t
 
´Ùo
;

50 
ušt32_t
 
·ck‘_Ën
;

51 
ušt32_t
 
¡r³d_by‹s
;

52 
ušt32_t
 
h—d”_size
;

53 
·ylßd_t
 
·ylßd
;

57 
loÿl
 
	gsæowUnknownEÁryTy³
 = 
ffi
.
ty³of
("struct sflow_unknown_entry*")

58 
loÿl
 
sæowFlowSam¶eTy³
 = 
ffi
.
ty³of
("struct sflow_flow_sample*")

59 
loÿl
 
sæowExtSw™chD©aTy³
 = 
ffi
.
ty³of
("struct sflow_ext_switch_data*")

60 
loÿl
 
sæowRawPack‘Ty³
 = 
ffi
.
ty³of
("struct sflow_raw_packet*")

62 --- 
sæow
 
´ÙocŞ
 
cÚ¡ªts


63 
loÿl
 
sæow
 = {}

65 
sæow
.
RECORD_TYPE_FLOW_SAMPLE_BE
 = 
	$htÚ
(0x01)

66 
sæow
.
RECORD_TYPE_EXT_SWITCH_DATA_BE
 = 0xe9030000

67 
sæow
.
RECORD_TYPE_RAW_PACKET_BE
 = 
	`htÚ
(0x01)

69 --- 
sæow
 
6
 
h—d”


70 
sæow
.
6
 = {
	}
}

72 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


73 
sæow
.
6
.
h—d”FÜm©
 = [[

74 
ušt32_t
 
v”siÚ
;

75 
ušt32_t
 
ag’t__ty³
;

76 
6_add»ss
 
ag’t_
;

77 
ušt32_t
 
sub_ag’t_id
;

78 
ušt32_t
 
£q
;

79 
ušt32_t
 
u±ime
;

80 
ušt32_t
 
num_§m¶es
;

81 
ušt8_t
 
·ylßd
[];

84 --- 
V¬ŸbË
 
sized
 
memb”


85 
	gsæow
.
	g6
.
	gh—d”V¬ŸbËMemb”
 = "payload"

87 --- 
¦fow
 
4
 
h—d”


88 
sæow
.
4
 = {}

90 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


91 
sæow
.
4
.
h—d”FÜm©
 = [[

92 
ušt32_t
 
v”siÚ
;

93 
ušt32_t
 
ag’t__ty³
;

94 
4_add»ss
 
ag’t_
;

95 
ušt32_t
 
sub_ag’t_id
;

96 
ušt32_t
 
£q
;

97 
ušt32_t
 
u±ime
;

98 
ušt32_t
 
num_§m¶es
;

99 
ušt8_t
 
·ylßd
[];

102 --- 
V¬ŸbË
 
sized
 
memb”


103 
	gsæow
.
	g4
.
	gh—d”V¬ŸbËMemb”
 = "payload"

105 
sæow
.
deçuÉTy³
 = "ip4"

107 
loÿl
 
sæowH—d”
 = 
	$š™H—d”
()

108 
sæowH—d”
.
__šdex
 = sflowHeader

110 
loÿl
 
sæowUnknownEÁry
 = {
	}
}

111 
sæowUnknownEÁry
.
__šdex
 = sflowUnknownEntry

113 
loÿl
 
sæowFlowSam¶e
 = {}

114 
sæowFlowSam¶e
.
__šdex
 = sflowFlowSample

116 
loÿl
 
sæowExtSw™chD©a
 = {}

117 
sæowExtSw™chD©a
.
__šdex
 = sflowExtSwitchData

119 
loÿl
 
sæowRawPack‘
 = {}

120 
sæowRawPack‘
.
__šdex
 = sflowRawPacket

122 
loÿl
 
funùiÚ
 
	$g’IÁS‘‹r
(
f›ld
)

123  
	$funùiÚ
(
£lf
, )

124 
£lf
[
f›ld
] = 
	$htÚ
(
Ü
 0)

125 
’d


126 
’d


127 
loÿl
 
funùiÚ
 
	$g’IÁG‘‹r
(
f›ld
)

128  
	$funùiÚ
(
£lf
, )

129 
loÿl
 
num
 = 
	$Áoh
(
£lf
[
f›ld
])

130 
num
 < 0 
th’


131 
num
 = 0x100000000 +‚um

132 
’d


133  
num


134 
’d


135 
’d


137 
sæow
.
h—d”Ty³
 = 
sæowH—d”


138 
sæow
.
unknownEÁryTy³
 = 
sæowUnknownEÁryTy³


139 
sæow
.
æowSam¶eTy³
 = 
sæowFlowSam¶eTy³


140 
sæow
.
¿wPack‘Ty³
 = 
sæowRawPack‘Ty³


142 
sæowH—d”
.
£tV”siÚ
 = 
	`g’IÁS‘‹r
("version")

143 
sæowH—d”
.
£tSubAg’tId
 = 
	`g’IÁS‘‹r
("sub_agent_id")

144 
sæowH—d”
.
£tSeq
 = 
	`g’IÁS‘‹r
("seq")

145 
sæowH—d”
.
£tU±ime
 = 
	`g’IÁS‘‹r
("uptime")

146 
sæowH—d”
.
£tNumSam¶es
 = 
	`g’IÁS‘‹r
("num_samples")

148 
sæowH—d”
.
g‘V”siÚ
 = 
	`g’IÁG‘‹r
("version")

149 
sæowH—d”
.
g‘SubAg’tId
 = 
	`g’IÁG‘‹r
("sub_agent_id")

150 
sæowH—d”
.
g‘Seq
 = 
	`g’IÁG‘‹r
("seq")

151 
sæowH—d”
.
g‘U±ime
 = 
	`g’IÁG‘‹r
("uptime")

152 
sæowH—d”
.
g‘NumSam¶es
 = 
	`g’IÁG‘‹r
("num_samples")

155 
sæowUnknownEÁry
.
£tTy³
 = 
	`g’IÁS‘‹r
("type")

156 
sæowUnknownEÁry
.
£tL’
 = 
	`g’IÁS‘‹r
("len")

158 
sæowUnknownEÁry
.
g‘Ty³
 = 
	`g’IÁG‘‹r
("type")

159 
sæowUnknownEÁry
.
g‘L’
 = 
	`g’IÁG‘‹r
("len")

162 
sæowFlowSam¶e
.
£tTy³
 = 
	`g’IÁS‘‹r
("type")

163 
sæowFlowSam¶e
.
£tL’
 = 
	`g’IÁS‘‹r
("len")

164 
sæowFlowSam¶e
.
£tSeq
 = 
	`g’IÁS‘‹r
("seq")

165 
sæowFlowSam¶e
.
£tSourûId
 = 
	`g’IÁS‘‹r
("source_id")

166 
sæowFlowSam¶e
.
£tSam¶šgR©e
 = 
	`g’IÁS‘‹r
("sampling_rate")

167 
sæowFlowSam¶e
.
£tSam¶ePoŞ
 = 
	`g’IÁS‘‹r
("sample_pool")

168 
sæowFlowSam¶e
.
£tDrİs
 = 
	`g’IÁS‘‹r
("drops")

169 
sæowFlowSam¶e
.
£tIÅutPÜt
 = 
	`g’IÁS‘‹r
("input_port")

170 
sæowFlowSam¶e
.
£tOuutPÜt
 = 
	`g’IÁS‘‹r
("output_port")

171 
sæowFlowSam¶e
.
£tNumEÁr›s
 = 
	`g’IÁS‘‹r
("num_entries")

173 
sæowFlowSam¶e
.
g‘Ty³
 = 
	`g’IÁG‘‹r
("type")

174 
sæowFlowSam¶e
.
g‘L’
 = 
	`g’IÁG‘‹r
("len")

175 
sæowFlowSam¶e
.
g‘Seq
 = 
	`g’IÁG‘‹r
("seq")

176 
sæowFlowSam¶e
.
g‘SourûId
 = 
	`g’IÁG‘‹r
("source_id")

177 
sæowFlowSam¶e
.
g‘Sam¶šgR©e
 = 
	`g’IÁG‘‹r
("sampling_rate")

178 
sæowFlowSam¶e
.
g‘Sam¶ePoŞ
 = 
	`g’IÁG‘‹r
("sample_pool")

179 
sæowFlowSam¶e
.
g‘Drİs
 = 
	`g’IÁG‘‹r
("drops")

180 
sæowFlowSam¶e
.
g‘IÅutPÜt
 = 
	`g’IÁG‘‹r
("input_port")

181 
sæowFlowSam¶e
.
g‘OuutPÜt
 = 
	`g’IÁG‘‹r
("output_port")

182 
sæowFlowSam¶e
.
g‘NumEÁr›s
 = 
	`g’IÁG‘‹r
("num_entries")

185 
sæowExtSw™chD©a
.
£tTy³
 = 
	`g’IÁS‘‹r
("type")

186 
sæowExtSw™chD©a
.
£tL’
 = 
	`g’IÁS‘‹r
("len")

187 
sæowExtSw™chD©a
.
£tSrcVÏn
 = 
	`g’IÁS‘‹r
("src_vlan")

188 
sæowExtSw™chD©a
.
£tSrcPrio
 = 
	`g’IÁS‘‹r
("src_prio")

189 
sæowExtSw™chD©a
.
£tD¡VÏn
 = 
	`g’IÁS‘‹r
("dst_vlan")

190 
sæowExtSw™chD©a
.
£tD¡Prio
 = 
	`g’IÁS‘‹r
("dst_prio")

192 
sæowExtSw™chD©a
.
g‘Ty³
 = 
	`g’IÁG‘‹r
("type")

193 
sæowExtSw™chD©a
.
g‘L’
 = 
	`g’IÁG‘‹r
("len")

194 
sæowExtSw™chD©a
.
g‘SrcVÏn
 = 
	`g’IÁG‘‹r
("src_vlan")

195 
sæowExtSw™chD©a
.
g‘SrcPrio
 = 
	`g’IÁG‘‹r
("src_prio")

196 
sæowExtSw™chD©a
.
g‘D¡VÏn
 = 
	`g’IÁG‘‹r
("dst_vlan")

197 
sæowExtSw™chD©a
.
g‘D¡Prio
 = 
	`g’IÁG‘‹r
("dst_prio")

200 
sæowRawPack‘
.
£tTy³
 = 
	`g’IÁS‘‹r
("type")

201 
sæowRawPack‘
.
£tL’
 = 
	`g’IÁS‘‹r
("len")

202 
sæowRawPack‘
.
£tPrÙo
 = 
	`g’IÁS‘‹r
("proto")

203 
sæowRawPack‘
.
£tPack‘L’
 = 
	`g’IÁS‘‹r
("packet_len")

204 
sæowRawPack‘
.
£tSŒ³dBy‹s
 = 
	`g’IÁS‘‹r
("stripped_bytes")

205 
sæowRawPack‘
.
£tH—d”Size
 = 
	`g’IÁS‘‹r
("header_size")

207 
sæowRawPack‘
.
g‘Ty³
 = 
	`g’IÁG‘‹r
("type")

208 
sæowRawPack‘
.
g‘L’
 = 
	`g’IÁG‘‹r
("len")

209 
sæowRawPack‘
.
g‘PrÙo
 = 
	`g’IÁG‘‹r
("proto")

210 
sæowRawPack‘
.
g‘Pack‘L’
 = 
	`g’IÁG‘‹r
("packet_len")

211 
sæowRawPack‘
.
g‘SŒ³dBy‹s
 = 
	`g’IÁG‘‹r
("stripped_bytes")

212 
sæowRawPack‘
.
g‘H—d”Size
 = 
	`g’IÁG‘‹r
("header_size")

214 
loÿl
 
voidPŒTy³
 = voidPtrType

215 
funùiÚ
 
sæowRawPack‘
:
	$g‘D©a
()

216  
	$ÿ¡
(
voidPŒTy³
, 
£lf
.
·ylßd
)

217 
’d


219 
funùiÚ
 
sæowFlowSam¶e
:
	$g‘NumEÁr›s
()

220  
	$Áoh
(
£lf
.
num_’Œ›s
)

221 
’d


223 
funùiÚ
 
sæowH—d”
:
	$£tAg’tIp
(

)

224 
£lf
.
ag’t__ty³
 = 
	$htÚ
(1)

225 
£lf
.
ag’t_
:
	$£t
(

)

226 
’d


228 
funùiÚ
 
sæowH—d”
:
	$g‘Ag’tIp
()

229 
	`as£¹
(
£lf
.
ag’t__ty³
 =ğ
	$htÚ
(1))

230  
£lf
.
ag’t_
:
	$g‘
()

231 
’d


233 
funùiÚ
 
sæowH—d”
:
	$g‘Ag’tIpSŒšg
()

234 
	`as£¹
(
£lf
.
ag’t__ty³
 =ğ
	$htÚ
(1))

235  
£lf
.
ag’t_
:
	$g‘SŒšg
()

236 
’d


239 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
sFlow
 
h—d”
.

240 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

241 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

242 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rguments:

243 --- 
V”siÚ


244 --- 
Ag’tIp


245 --- 
SubAg’tId


246 --- 
Seq


247 --- 
U±ime


248 --- 
NumSam¶es


249 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'sFlow'.

250 --- @
code


251 --- 
	`fl
(è-- 
Úly
  
v®ues


252 --- 
fl
{ 
xyz
=1 
	}
} -- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 xyz, ...

253 --- @
’dcode


254 
funùiÚ
 
	gsæowH—d”
:
	$fl
(
¬gs
, 
´e
)

255 
¬gs
 =‡rg 
Ü
 {
	}
}

256 
´e
 =…» 
Ü
 "sflow"

257 
£lf
:
£tV”siÚ
(
¬gs
[
´e
 .. "Version"])

258 
£lf
:
£tAg’tIp
(
¬gs
[
´e
 .. "Ag’tIp"] 
Ü
 0)

259 
£lf
:
£tSubAg’tId
(
¬gs
[
´e
 .. "SubAgentId"])

260 
£lf
:
£tSeq
(
¬gs
[
´e
 .. "Seq"])

261 
£lf
:
£tU±ime
(
¬gs
[
´e
 .. "Uptime"])

262 
£lf
:
£tNumSam¶es
(
¬gs
[
´e
 .. "NumSamples"])

263 
’d


265 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

266 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'sFlow'.

267 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

268 --- @
£e
 
sæowH—d”
:
fl


269 
funùiÚ
 
sæowH—d”
:
	$g‘
(
´e
)

270 
´e
 =…» 
Ü
 "sflow"

271 
loÿl
 
¬gs
 = {
	}
}

272 
¬gs
[
´e
 .. "V”siÚ"] = 
£lf
:
g‘V”siÚ
(args[pre .. "Version"])

273 
¬gs
[
´e
 .. "Ag’tIp"] = 
£lf
:
g‘V”siÚ
(args[pre .. "AgentIp"])

274 
¬gs
[
´e
 .. "SubAg’tId"] = 
£lf
:
g‘V”siÚ
(args[pre .. "SubAgentId"])

275 
¬gs
[
´e
 .. "Seq"] = 
£lf
:
g‘V”siÚ
(args[pre .. "Seq"])

276 
¬gs
[
´e
 .. "U±ime"] = 
£lf
:
g‘V”siÚ
(args[pre .. "Uptime"])

277 
¬gs
[
´e
 .. "NumSam¶es"] = 
£lf
:
g‘V”siÚ
(args[pre .. "NumSamples"])

278  
¬gs


279 
’d


281 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

282 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

283 
funùiÚ
 
sæowH—d”
:
	$g‘SŒšg
()

284 
loÿl
 
¡r
 = ("sFlowv5,‡g’ˆIP %s, sub‡g’ˆid %d, seq %d, u±im%d, sam¶e %d \n"):
	`fÜm©
(

285 
£lf
:
	`g‘Ag’tIpSŒšg
(), s–f:
	`g‘SubAg’tId
(), s–f:
	`g‘Seq
(), s–f:
	`g‘U±ime
(), s–f:
	$g‘NumSam¶es
()

288 
i
, 
»cÜd
 
š
 
£lf
:
	$™”©eSam¶es
() do

289 
¡r
 = sŒ .. " " .. 
»cÜd
:
	`g‘SŒšg
() .. "\n"

290 
i
, 
’Œy
 
š
 
»cÜd
:
	$™”©eEÁr›s
() do

291 
¡r
 = sŒ .. " " .. 
’Œy
:
	`g‘SŒšg
() .. "\n"

292 
’d


293 
’d


294  
¡r
:
	`sub
(0, #str - 1)

295 
’d


297 
funùiÚ
 
sæowUnknownEÁry
:
	$g‘SŒšg
()

298  ("unsuµÜ‹d„ecÜdy³ %d,†’ %d"):
	`fÜm©
(
£lf
:
	`g‘Ty³
(), s–f:
	$g‘L’
())

299 
’d


301 
funùiÚ
 
sæowFlowSam¶e
:
	$g‘SŒšg
()

302  ("Flow sam¶e,y³ %d,†’ %d, seq %d, sourû id %d, sam¶šg_¿‹ %d, sam¶e_poŞ %d, drİ %d, iÅuˆpÜˆ%d, ouuˆpÜˆ%d,„ecÜd %d"):
	`fÜm©
(

303 
£lf
:
	`g‘Ty³
(), s–f:
	`g‘L’
(), s–f:
	`g‘Seq
(), s–f:
	`g‘SourûId
(), s–f:
	`g‘Sam¶šgR©e
(),

304 
£lf
:
	`g‘Sam¶ePoŞ
(), s–f:
	`g‘Drİs
(), s–f:
	`g‘IÅutPÜt
(), s–f:
	`g‘OuutPÜt
(), s–f:
	$g‘NumEÁr›s
()

306 
’d


308 
funùiÚ
 
sæowExtSw™chD©a
:
	$g‘SŒšg
()

309  ("Ex‹nded sw™ch d©a,y³ %d,†’ %d, sourû vÏÀ%d, srø´iÜ™y %d, de¡ vÏÀ%d, de¡…riÜ™y %d"):
	`fÜm©
(

310 
£lf
:
	`g‘Ty³
(), s–f:
	`g‘L’
(), s–f:
	`g‘SrcVÏn
(), s–f:
	`g‘SrcPrio
(), s–f:
	`g‘D¡VÏn
(), s–f:
	$g‘D¡Prio
()

312 
’d


314 
funùiÚ
 
sæowRawPack‘
:
	$g‘SŒšg
()

315 
loÿl
 
¡r
 = ("Raw…ack‘ d©a,y³ %d,†’ %d,…rÙocŞ %d,…ack‘†’ %d, sŒ³d by‹ %d, h—d” siz%d"):
	`fÜm©
(

316 
£lf
:
	`g‘Ty³
(), s–f:
	`g‘L’
(), s–f:
	`g‘PrÙo
(), s–f:
	`g‘Pack‘L’
(), s–f:
	`g‘SŒ³dBy‹s
(), s–f:
	$g‘H—d”Size
()

318  
¡r


319 
’d


321 
funùiÚ
 
sæowH—d”
:
	$™”©eSam¶es
()

322 
loÿl
 
numSam¶es
 = 
£lf
:
	$g‘NumSam¶es
()

323 
loÿl
 
pos
 = 0

324  
	$funùiÚ
(
£lf
, 
i
)

325 
loÿl
 
·ylßd
 = 
£lf
.payload

326 
i
 =ğ
numSam¶es
 
th’


328 
’d


329 -- 
nİe
, 
th”e
 
is
 
no
 
®ignm’t
 
Ü
 
wh©sÛv”


330 
loÿl
 
»cÜdTy³
 = 
	`ÿ¡
(
ušt32
, 
·ylßd
 + 
pos
)[0]

331 
loÿl
 
»cÜdL’
 = 
	`Áoh
(
	`ÿ¡
(
ušt32
, 
·ylßd
 + 
pos
)[1])

332 
loÿl
 
»cÜd


333 
»cÜdTy³
 =ğ
sæow
.
RECORD_TYPE_FLOW_SAMPLE_BE
 
th’


334 
»cÜd
 = 
	`ÿ¡
(
sæowFlowSam¶eTy³
, 
·ylßd
 + 
pos
)

336 
»cÜd
 = 
	`ÿ¡
(
sæowUnknownEÁryTy³
, 
·ylßd
 + 
pos
)

337 
’d


338 
pos
 =…o + 
»cÜdL’
 + 8

339 
pos
 > 1600 
th’


340 -- 
we
 
unfÜtuÇ‹ly
 dØ
nÙ
 
have
 
the
 
»®
 
·ck‘
 
Ën
 
h”e


341 -- 
howev”
, 
·ck‘
 
bufãrs
 
¬e
 
©
 
Ëa¡
 2048 - 64*3 
by‹s
 

342 -- 
so
 
we
 
©
 
Ëa¡
 w
dÚ
't do‡nything completely stupid here

343 -- (
no
 
we
 
ÿÂÙ
 
suµÜt
 
jumboäames
 
w™h
 
this
 
©
 
the
 
mom’t
)

345 
’d


346  
i
 + 1, 
»cÜd


347 
’d
, 
£lf
, 0

348 
’d


350 
funùiÚ
 
sæowFlowSam¶e
:
	$™”©eEÁr›s
()

351 
loÿl
 
numSam¶es
 = 
£lf
:
	$g‘NumEÁr›s
()

352 
loÿl
 
·ylßd
 = 
£lf
.payload

353 
loÿl
 
pos
 = 0

354  
	$funùiÚ
(
£lf
, 
i
)

355 
i
 =ğ
numSam¶es
 
th’


357 
’d


358 
loÿl
 
»cÜdTy³
 = 
	`ÿ¡
(
ušt32
, 
·ylßd
.
ušt8
 + 
pos
)[0]

359 
loÿl
 
»cÜdL’
 = 
	`Áoh
(
	`ÿ¡
(
ušt32
, 
·ylßd
.
ušt8
 + 
pos
)[1])

360 
loÿl
 
»cÜd


361 
»cÜdTy³
 =ğ
sæow
.
RECORD_TYPE_EXT_SWITCH_DATA_BE
 
th’


362 
»cÜd
 = 
	`ÿ¡
(
sæowExtSw™chD©aTy³
, 
·ylßd
.
ušt8
 + 
pos
)

363 
–£if
 
»cÜdTy³
 =ğ
sæow
.
RECORD_TYPE_RAW_PACKET_BE
 
th’


364 
»cÜd
 = 
	`ÿ¡
(
sæowRawPack‘Ty³
, 
·ylßd
.
ušt8
 + 
pos
)

366 
»cÜd
 = 
	`ÿ¡
(
sæowUnknownEÁryTy³
, 
·ylßd
.
ušt8
 + 
pos
)

367 
’d


368 
pos
 =…o + 
»cÜdL’
 + 8

369 -- 
©
 
Ëa¡
 
´ev’t
 
the
 
wÜ¡
, 
but
 
we
 
ÿn
't do‡ny better withhe current‡rchitecture

370 
pos
 > 1600 
th’


372 
’d


373  
i
 + 1, 
»cÜd


374 
’d
, 
£lf
, 0

375 
’d


377 
loÿl
 
funùiÚ
 
	$™
(è 
’d


378 
funùiÚ
 
sæowUnknownEÁry
:
	$™”©eEÁr›s
()

379  
™


380 
’d


384 
sæow
.
4
.
m‘©y³
 = 
sæowH—d”


385 
ffi
.
	`m‘©y³
("¡ruù sæow_unknown_’Œy", 
sæowUnknownEÁry
)

386 
ffi
.
	`m‘©y³
("¡ruù sæow_æow_§m¶e", 
sæowFlowSam¶e
)

387 
ffi
.
	`m‘©y³
("¡ruù sæow_ext_sw™ch_d©a", 
sæowExtSw™chD©a
)

388 
ffi
.
	`m‘©y³
("¡ruù sæow_¿w_·ck‘", 
sæowRawPack‘
)

391  
sæow


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/tcp.lua

2 --- @
fe
 
	gtı
.
	glua


3 --- @
br›f
 
T¿nsmissiÚ
 
cÚŒŞ
 
	$´ÙocŞ
 (
TCP
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
tı_h—d”
 

5 --- 
Inşudes
:

6 --- - 
TCP
 
cÚ¡ªts


7 --- - 
TCP
 
h—d”
 
ut™y


8 --- - 
Defš™iÚ
 
of
 
TCP
 
·ck‘s


11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

14 
»quœe
 "utils"

15 
»quœe
 "proto.template"

16 
loÿl
 
š™H—d”
 = initHeader

18 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

19 
loÿl
 
Áoh16
, 
htÚ16
 =‚toh16, hton16

20 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
ğ
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

21 
loÿl
 
i¡y³
 = 
ffi
.istype

22 
loÿl
 
fÜm©
 = 
¡ršg
.format

23 
loÿl
 
tÚumb”
 =onumber

24 
loÿl
 
ušt32
 = 
ffi
.
	`ty³of
("uint32_t")

26 
loÿl
 
log
 = 
»quœe
 "log"

28 
loÿl
 
mod
 = {
	}
}

32 ---- 
TCP
 
cÚ¡ªts


37 ---- 
TCP
 
h—d”


40 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


41 
mod
.
h—d”FÜm©
 = [[

42 
ušt16_t
 
¤c
;

43 
ušt16_t
 
d¡
;

44 
ušt32_t
 
£q
;

45 
ušt32_t
 
ack
;

46 
ušt8_t
 
off£t
;

47 
ušt8_t
 
æags
;

48 
ušt16_t
 
wšdow
;

49 
ušt16_t
 
cs
;

50 
ušt16_t
 
urg
;

51 
ušt8_t
 
İtiÚs
[];

54 --- 
V¬ŸbË
 
sized
 
memb”


55 
	gmod
.
	gh—d”V¬ŸbËMemb”
 = "options"

57 --- 
ModuË
 
tı_h—d”
 

58 
loÿl
 
tıH—d”
 = 
	$š™H—d”
()

59 
tıH—d”
.
__šdex
 =cpHeader

61 --- 
S‘
 
the
 
sourû
 
pÜt
.

62 --- @
·¿m
 
PÜt
 
as
 16 
b™
 
š‹g”
.

63 
funùiÚ
 
tıH—d”
:
	$£tSrcPÜt
()

64 ğ
Ü
 1025

65 
£lf
.
¤c
 = 
	$htÚ16
()

66 
’d


68 --- 
S‘
 
the
 
sourû
 
pÜt
. 
AlŸs
 
£tSrcPÜt


69 --- @
·¿m
 
PÜt
 
as
 16 
b™
 
š‹g”
.

70 
funùiÚ
 
tıH—d”
:
	$£tSrc
()

71 
£lf
:
	$£tSrcPÜt
()

72 
’d


74 --- 
R‘r›ve
 
the
 
sourû
 
pÜt
.

75 --- @ 
PÜt
 
as
 16 
b™
 
š‹g”
.

76 
funùiÚ
 
tıH—d”
:
	$g‘SrcPÜt
()

77  
	$htÚ16
(
£lf
.
¤c
)

78 
’d


80 --- 
R‘r›ve
 
the
 
sourû
 
pÜt
. 
AlŸs
 
g‘SrcPÜt


81 --- @ 
PÜt
 
as
 16 
b™
 
š‹g”
.

82 
funùiÚ
 
tıH—d”
:
	$g‘Src
()

83  
£lf
:
	$g‘SrcPÜt
()

84 
’d


86 --- 
R‘r›ve
 
the
 
sourû
 
pÜt
.

87 --- @ 
PÜt
 
š
 
¡ršg
 
fÜm©
.

88 
funùiÚ
 
tıH—d”
:
	$g‘SrcPÜtSŒšg
()

89  
£lf
:
	$g‘SrcPÜt
()

90 
’d


92 --- 
R‘r›ve
 
the
 
sourû
 
pÜt
. 
AlŸs
 
g‘SrcPÜtSŒšg


93 --- @ 
PÜt
 
š
 
¡ršg
 
fÜm©
.

94 
funùiÚ
 
tıH—d”
:
	$g‘SrcSŒšg
()

95  
£lf
:
	$g‘SrcPÜtSŒšg
()

96 
’d


98 --- 
S‘
 
the
 
de¡š©iÚ
 
pÜt
.

99 --- @
·¿m
 
PÜt
 
as
 16 
b™
 
š‹g”
.

100 
funùiÚ
 
tıH—d”
:
	$£tD¡PÜt
()

101 ğ
Ü
 1024

102 
£lf
.
d¡
 = 
	$htÚ16
()

103 
’d


105 --- 
S‘
 
the
 
de¡š©iÚ
 
pÜt
. 
AlŸs
 
£tD¡PÜt


106 --- @
·¿m
 
PÜt
 
as
 16 
b™
 
š‹g”
.

107 
funùiÚ
 
tıH—d”
:
	$£tD¡
()

108 
£lf
:
	$£tD¡PÜt
()

109 
’d


111 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
pÜt
.

112 --- @ 
PÜt
 
as
 16 
b™
 
š‹g”
.

113 
funùiÚ
 
tıH—d”
:
	$g‘D¡PÜt
()

114  
	$htÚ16
(
£lf
.
d¡
)

115 
’d


117 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
pÜt
. 
AlŸs
 
g‘D¡PÜt


118 --- @ 
PÜt
 
as
 16 
b™
 
š‹g”
.

119 
funùiÚ
 
tıH—d”
:
	$g‘D¡
()

120  
£lf
:
	$g‘D¡PÜt
()

121 
’d


123 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
pÜt
.

124 --- @ 
PÜt
 
š
 
¡ršg
 
fÜm©
.

125 
funùiÚ
 
tıH—d”
:
	$g‘D¡PÜtSŒšg
()

126  
£lf
:
	$g‘D¡PÜt
()

127 
’d


129 --- 
R‘r›ve
 
the
 
de¡š©iÚ
 
pÜt
. 
AlŸs
 
g‘D¡PÜtSŒšg


130 --- @ 
PÜt
 
š
 
¡ršg
 
fÜm©
.

131 
funùiÚ
 
tıH—d”
:
	$g‘D¡SŒšg
()

132  
£lf
:
	$g‘D¡PÜtSŒšg
()

133 
’d


135 --- 
S‘
 
the
 
£qu’û
 
numb”
.

136 --- @
·¿m
 
Sequ’û
 
numb”


137 
funùiÚ
 
tıH—d”
:
	$£tSeqNumb”
()

138 ğ
Ü
 0

139 
£lf
.
£q
 = 
	$htÚ
()

140 
’d


143 --- 
R‘r›ve
 
the
 
£qu’û
 
numb”
.

144 --- @ 
Seq
 
numb”
 
as
 32 
b™
 
š
 
lua
 
Numb”
 
fÜm©


145 
funùiÚ
 
tıH—d”
:
	$g‘SeqNumb”
()

146  
	`tÚumb”
(
	`ušt32
(
	$htÚ
(
£lf
.
£q
)))

147 
’d


149 --- 
R‘r›ve
 
the
 
£qu’û
 
numb”
.

150 --- @ 
Sequ’û
 
numb”
 
š
 
¡ršg
 
fÜm©
.

151 
funùiÚ
 
tıH—d”
:
	$g‘SeqNumb”SŒšg
()

152  
	`to¡ršg
(
£lf
:
	$g‘SeqNumb”
())

153 
’d


155 --- 
S‘
 
the
 
acknowËdgem’t
 
numb”
.

156 --- @
·¿m
 
Ack
 
numb”
 
as
 8 
b™
 
š‹g”
.

157 
funùiÚ
 
tıH—d”
:
	$£tAckNumb”
()

158 ğ
Ü
 0

159 
£lf
.
ack
 = 
	$htÚ
()

160 
’d


162 --- 
R‘r›ve
 
the
 
acknowËdgem’t
 
numb”
.

163 --- @ 
Seq
 
numb”
 
as
 8 
b™
 
š‹g”
.

164 
funùiÚ
 
tıH—d”
:
	$g‘AckNumb”
()

165  
	`tÚumb”
(
	`ušt32
(
	$htÚ
(
£lf
.
ack
)))

166 
’d


168 --- 
R‘r›ve
 
the
 
acknowËdgem’t
 
numb”
.

169 --- @ 
Ack
 
numb”
 
š
 
¡ršg
 
fÜm©
.

170 
funùiÚ
 
tıH—d”
:
	$g‘AckNumb”SŒšg
()

171  
	`to¡ršg
(
£lf
:
	$g‘AckNumb”
())

172 
’d


174 --- 
S‘
 
the
 
d©a
 
off£t
.

175 --- @
·¿m
 
Off£t
 
as
 4 
b™
 
š‹g”
. 
H—d”
 
size
 
is
 
couÁed
 
š
 32 b™ 
	`wÜds
 (
mš
. 5 (
no
 
İtiÚs
), 
max
. 15)

176 
funùiÚ
 
tıH—d”
:
	$£tD©aOff£t
()

177 ğ
Ü
 5

178 ğ
	`bªd
(
	`lshiá
(, 4), 0xf0è-- 
fl
 
to
 8 
b™s


180 
Şd
 = 
£lf
.
off£t


181 
Şd
 = 
	`bªd
(Şd, 0x0fè-- 
»move
 old 
v®ue


183 
£lf
.
off£t
 = 
	$bÜ
(
Şd
, )

184 
’d


186 --- 
R‘r›ve
 
the
 
d©a
 
off£t
.

187 --- @ 
Off£t
 
as
 4 
b™
 
š‹g”
.

188 
funùiÚ
 
tıH—d”
:
	$g‘D©aOff£t
()

189  
	`bªd
(
	`rshiá
(
£lf
.
off£t
, 4), 0x0f)

190 
’d


192 --- 
R‘r›ve
 
the
 
d©a
 
off£t
.

193 --- @ 
Off£t
 
š
 
¡ršg
 
fÜm©
.

194 
funùiÚ
 
tıH—d”
:
	$g‘D©aOff£tSŒšg
()

195  
	`fÜm©
("0x%01x", 
£lf
:
	$g‘D©aOff£t
())

196 
’d


198 --- 
S‘
 
the
 
»£rved
 
f›ld
.

199 --- @
·¿m
 
Re£rved
 
f›ld
 
as
 6 
b™
 
š‹g”
.

200 
funùiÚ
 
tıH—d”
:
	$£tRe£rved
()

201 ğ
Ü
 0

202 -- 
off£t
 | 
æags


203 -- 
XXXXOOOO
 
OOXXXXXX


204 -- 
»£rved


206 -- 
fœ¡
, 
off£t
 
f›ld


207 
off
 = 
	`bªd
(
	`rshiá
(, 2), 0x0fè-- 
fl
 
to
 8 
	$b™s
 (4 
highe¡
 
to
 4 
lowe¡
 
b™s
)

209 
Şd
 = 
£lf
.
off£t


210 
Şd
 = 
	`bªd
(Şd, 0xf0è-- 
»move
 old 
v®ue


212 
£lf
.
off£t
 = 
	`bÜ
(
Şd
, 
off
)

214 -- 
£cÚdly
, 
æags
 
f›ld


215 
æa
 = 
	`lshiá
(, 6è-- 
fl
 
to
 8 
	$b™s
 (2 
lowe¡
 
to
 2 
highe¡
 
b™s
)

217 
Şd
 = 
£lf
.
æags


218 
Şd
 = 
	`bªd
(Şd, 0x3fè-- 
»move
 old 
v®ues


220 
£lf
.
æags
 = 
	$bÜ
(
Şd
, 
æa
)

221 
’d


223 --- 
R‘r›ve
 
the
 
»£rved
 
f›ld
.

224 --- @ 
Re£rved
 
f›ld
 
as
 6 
b™
 
š‹g”
.

225 
funùiÚ
 
tıH—d”
:
	$g‘Re£rved
()

226 
»s
 = 
	`lshiá
(
	`bªd
(
£lf
.
off£t
, 0x0f), 2è-- 4 
lowe¡
 
äom
 off£ˆ
to
 4 
highe¡
 from 
»£rved


227 
»s
 = 
	`bÜ
Ôes, 
	`rshiá
(
£lf
.
æags
, 6)è-- 2 
highe¡
 
äom
 fÏg 
to
 2 
lowe¡
 from 
»£rved


228  
»s


229 
’d


231 --- 
R‘r›ve
 
the
 
»£rved
 
f›ld
.

232 --- @ 
Re£rved
 
f›ld
 
š
 
¡ršg
 
fÜm©
.

233 
funùiÚ
 
tıH—d”
:
	$g‘Re£rvedSŒšg
()

234  
	`fÜm©
("0x%02x", 
£lf
:
	$g‘Re£rved
())

235 
’d


237 --- 
S‘
 
the
 
æags
.

238 --- @
·¿m
 
FÏgs
 
as
 6 
b™
 
š‹g”
.

239 --- @
todo
 
TODO
 
RFC
 3168 
¥ecif›s
 
Ãw
 
CWR
 
ªd
 
ECE
 
	$æags
 (
»£rved
 
»duûd
 
to
 4 
b™
)

240 
funùiÚ
 
tıH—d”
:
	$£tFÏgs
()

241 ğ
Ü
 0

243 ğ
	`bªd
(, 0x3fè-- 
fl
 
to
 8 
b™s


245 
Şd
 = 
£lf
.
æags


246 
Şd
 = 
	`bªd
(Şd, 0xc0è-- 
»move
 old 
v®ues


248 
£lf
.
æags
 = 
	$bÜ
(
Şd
, )

249 
’d


251 --- 
R‘r›ve
 
the
 
æags
.

252 --- @ 
FÏgs
 
as
 6 
b™
 
š‹g”
.

253 
funùiÚ
 
tıH—d”
:
	$g‘FÏgs
()

254  
	$bªd
(
£lf
.
æags
, 0x3f)

255 
’d


257 --- 
R‘r›ve
 
the
 
æags
.

258 --- @ 
FÏgs
 
š
 
¡ršg
 
fÜm©
.

259 
funùiÚ
 
tıH—d”
:
	$g‘FÏgsSŒšg
()

260  
	`fÜm©
("0x%02x", 
£lf
:
	$g‘FÏgs
())

261 
’d


263 --- 
S‘
 
the
 
Urg
 
æag
.

264 
funùiÚ
 
tıH—d”
:
	$£tUrg
()

265 
£lf
.
æags
 = 
	$bÜ
(
£lf
.
æags
, 0x20)

266 
’d


268 --- 
Un£t
 
the
 
Urg
 
æag
.

269 
funùiÚ
 
tıH—d”
:
	$un£tUrg
()

270 
£lf
.
æags
 = 
	$bªd
(
£lf
.
æags
, 0xdf)

271 
’d


273 --- 
R‘r›ve
 
the
 
Urg
 
æag
.

274 --- @ 
FÏg
 
as
 
boŞ
.

275 
funùiÚ
 
tıH—d”
:
	$g‘Urg
()

276  
	`rshiá
(
	`bªd
(
£lf
.
æags
, 0x20), 5) == 1

277 
’d


279 --- 
R‘r›ve
 
the
 
Urg
 
æag
.

280 --- @ 
FÏg
 
š
 
¡ršg
 
fÜm©
.

281 
funùiÚ
 
tıH—d”
:
	$g‘UrgSŒšg
()

282 
£lf
:
	$g‘Urg
(è
th’


286 
’d


287 
’d


289 --- 
S‘
 
the
 
Ack
 
æag
.

290 
funùiÚ
 
tıH—d”
:
	$£tAck
()

291 
£lf
.
æags
 = 
	$bÜ
(
£lf
.
æags
, 0x10)

292 
’d


294 --- 
Un£t
 
the
 
Ack
 
æag
.

295 
funùiÚ
 
tıH—d”
:
	$un£tAck
()

296 
£lf
.
æags
 = 
	$bªd
(
£lf
.
æags
, 0xef)

297 
’d


299 --- 
R‘r›ve
 
the
 
Ack
 
æag
.

300 --- @ 
FÏg
 
as
 
boŞ
.

301 
funùiÚ
 
tıH—d”
:
	$g‘Ack
()

302  
	`rshiá
(
	`bªd
(
£lf
.
æags
, 0x10), 4) == 1

303 
’d


305 --- 
R‘r›ve
 
the
 
Ack
 
æag
.

306 --- @ 
FÏg
 
š
 
¡ršg
 
fÜm©
.

307 
funùiÚ
 
tıH—d”
:
	$g‘AckSŒšg
()

308 
£lf
:
	$g‘Ack
(è
th’


312 
’d


313 
’d


315 --- 
S‘
 
the
 
Psh
 
æag
.

316 
funùiÚ
 
tıH—d”
:
	$£tPsh
()

317 
£lf
.
æags
 = 
	$bÜ
(
£lf
.
æags
, 0x08)

318 
’d


320 --- 
Un£t
 
the
 
Psh
 
æag
.

321 
funùiÚ
 
tıH—d”
:
	$un£tPsh
()

322 
£lf
.
æags
 = 
	$bªd
(
£lf
.
æags
, 0xf7)

323 
’d


325 --- 
R‘r›ve
 
the
 
Psh
 
æag
.

326 --- @ 
FÏg
 
as
 
boŞ
.

327 
funùiÚ
 
tıH—d”
:
	$g‘Psh
()

328  
	`rshiá
(
	`bªd
(
£lf
.
æags
, 0x08), 3) == 1

329 
’d


331 --- 
R‘r›ve
 
the
 
Psh
 
æag
.

332 --- @ 
FÏg
 
š
 
¡ršg
 
fÜm©
.

333 
funùiÚ
 
tıH—d”
:
	$g‘PshSŒšg
()

334 
£lf
:
	$g‘Psh
(è
th’


338 
’d


339 
’d


341 --- 
S‘
 
the
 
R¡
 
æag
.

342 
funùiÚ
 
tıH—d”
:
	$£tR¡
()

343 
£lf
.
æags
 = 
	$bÜ
(
£lf
.
æags
, 0x04)

344 
’d


346 --- 
Un£t
 
the
 
R¡
 
æag
.

347 
funùiÚ
 
tıH—d”
:
	$un£tR¡
()

348 
£lf
.
æags
 = 
	$bªd
(
£lf
.
æags
, 0xfb)

349 
’d


351 --- 
R‘r›ve
 
the
 
R¡
 
æag
.

352 --- @ 
FÏg
 
as
 
boŞ
.

353 
funùiÚ
 
tıH—d”
:
	$g‘R¡
()

354  
	`rshiá
(
	`bªd
(
£lf
.
æags
, 0x04), 2) == 1

355 
’d


357 --- 
R‘r›ve
 
the
 
R¡
 
æag
.

358 --- @ 
FÏg
 
š
 
¡ršg
 
fÜm©
.

359 
funùiÚ
 
tıH—d”
:
	$g‘R¡SŒšg
()

360 
£lf
:
	$g‘R¡
(è
th’


364 
’d


365 
’d


367 --- 
S‘
 
the
 
Syn
 
æag
.

368 
funùiÚ
 
tıH—d”
:
	$£tSyn
()

369 
£lf
.
æags
 = 
	$bÜ
(
£lf
.
æags
, 0x02)

370 
’d


372 --- 
Un£t
 
the
 
Syn
 
æag
.

373 
funùiÚ
 
tıH—d”
:
	$un£tSyn
()

374 
£lf
.
æags
 = 
	$bªd
(
£lf
.
æags
, 0xfd)

375 
’d


377 --- 
R‘r›ve
 
the
 
Syn
 
æag
.

378 --- @ 
FÏg
 
as
 
boŞ
.

379 
funùiÚ
 
tıH—d”
:
	$g‘Syn
()

380  
	`rshiá
(
	`bªd
(
£lf
.
æags
, 0x02), 1) == 1

381 
’d


383 --- 
R‘r›ve
 
the
 
Syn
 
æag
.

384 --- @ 
FÏg
 
š
 
¡ršg
 
fÜm©
.

385 
funùiÚ
 
tıH—d”
:
	$g‘SynSŒšg
()

386 
£lf
:
	$g‘Syn
(è
th’


390 
’d


391 
’d


393 --- 
S‘
 
the
 
Fš
 
æag
.

394 
funùiÚ
 
tıH—d”
:
	$£tFš
()

395 
£lf
.
æags
 = 
	$bÜ
(
£lf
.
æags
, 0x01)

396 
’d


398 --- 
Un£t
 
the
 
Fš
 
æag
.

399 
funùiÚ
 
tıH—d”
:
	$un£tFš
()

400 
£lf
.
æags
 = 
	$bªd
(
£lf
.
æags
, 0xfe)

401 
’d


403 --- 
R‘r›ve
 
the
 
Fš
 
æag
.

404 --- @ 
FÏg
 
as
 
boŞ
.

405 
funùiÚ
 
tıH—d”
:
	$g‘Fš
()

406  
	`bªd
(
£lf
.
æags
, 0x01) == 1

407 
’d


409 --- 
R‘r›ve
 
the
 
Fš
 
æag
.

410 --- @ 
FÏg
 
š
 
¡ršg
 
fÜm©
.

411 
funùiÚ
 
tıH—d”
:
	$g‘FšSŒšg
()

412 
£lf
:
	$g‘Fš
(è
th’


416 
’d


417 
’d


419 --- 
S‘
 
the
 
wšdow
 
f›ld
.

420 --- @
·¿m
 
Wšdow
 
as
 16 
b™
 
š‹g”
.

421 
funùiÚ
 
tıH—d”
:
	$£tWšdow
()

422 ğ
Ü
 29200

423 
£lf
.
wšdow
 = 
	$htÚ16
()

424 
’d


426 --- 
R‘r›ve
 
the
 
wšdow
 
f›ld
.

427 --- @ 
Wšdow
 
as
 16 
b™
 
š‹g”
.

428 
funùiÚ
 
tıH—d”
:
	$g‘Wšdow
()

429  
	$htÚ16
(
£lf
.
wšdow
)

430 
’d


432 --- 
R‘r›ve
 
the
 
wšdow
 
f›ld
.

433 --- @ 
Wšdow
 
š
 
¡ršg
 
fÜm©
.

434 
funùiÚ
 
tıH—d”
:
	$g‘WšdowSŒšg
()

435  
£lf
:
	$g‘Wšdow
()

436 
’d


438 --- 
S‘
 
the
 
checksum
.

439 --- @
·¿m
 
Checksum
 
as
 16 
b™
 
š‹g”
.

440 
funùiÚ
 
tıH—d”
:
	$£tChecksum
()

441 ğ
Ü
 0

442 
£lf
.
cs
 = 
	$htÚ16
()

443 
’d


445 --- 
C®cuÏ‹
 
ªd
 
£t
 
the
 
checksum
.

446 --- 
If
 
possibË
 
u£
 
checksum
 
ofæßdšg
 
š¡—d
.

447 --- @
·¿m
 
d©a
 
cd©a
 
objeù
 
of
 
the
 
com¶‘e
 
·ck‘
.

448 --- @
·¿m
 
Ën
 
L’gth
 
of
 
the
 
com¶‘e
 
·ck‘
.

449 --- @
·¿m
 
v4
 
True
 
™s
 
ª
 
IP4
 
·ck‘
. 
DeçuÉ
: 
Œue


450 --- @
£e
 
pkt
:
ofæßdTıChecksum


451 
funùiÚ
 
tıH—d”
:
	`ÿlcuÏ‹Checksum
(
d©a
, 
Ën
, 
v4
)

452 -- 
fœ¡
 
ÿlcuÏ‹
 
checksum
 
the
 
p£udo
 
h—d”


453 -- 
ªd
 
wr™e
 
™
 
što
 
the
 
checksum
 
f›ld


454 -- 
th’
, 
ÿlcuÏ‹
 
»maššg
 
checksum
 
of
 
tı
 
£gm’t


455 -- 
deduù
 
Eth”Ãt
 
ªd
 
IP
 
h—d”
 
Ëngth
 
äom
 
tÙ®
 
size


456 
v4
 
th’


457 
dpdkc
.
	`ÿlc_v4_p£udo_h—d”_checksum
(
d©a
, 25è-- 
off£t
 
š
 16b
™
 
	`š‹g”s
 (
by‹
 #50 
IP4
)

458 
£lf
:
	`£tChecksum
(
	`htÚ16
(
	`checksum
(£lf, 
Ën
 - (14 + 20))))

460 
dpdkc
.
	$ÿlc_v6_p£udo_h—d”_checksum
(
d©a
, 30)

461 
£lf
:
	`£tChecksum
(
	`htÚ16
(
	`checksum
(£lf, 
Ën
 - (14 + 40))))

462 
’d


463 
’d


465 --- 
R‘r›ve
 
the
 
checksum
.

466 --- @ 
Checksum
 
as
 16 
b™
 
š‹g”
.

467 
funùiÚ
 
tıH—d”
:
	$g‘Checksum
()

468  
	$htÚ16
(
£lf
.
cs
)

469 
’d


471 --- 
R‘r›ve
 
the
 
checksum
.

472 --- @ 
Checksum
 
š
 
¡ršg
 
fÜm©
.

473 
funùiÚ
 
tıH—d”
:
	$g‘ChecksumSŒšg
()

474  
	`fÜm©
("0x%04x", 
£lf
:
	$g‘Checksum
())

475 
’d


477 --- 
S‘
 
the
 
urg’t
 
poš‹r
.

478 --- @
·¿m
 
Urg’t
 
poš‹r
 
as
 16 
b™
 
š‹g”
.

479 
funùiÚ
 
tıH—d”
:
	$£tUrg’tPoš‹r
()

480 ğ
Ü
 0

481 
£lf
.
urg
 = 
	$htÚ16
()

482 
’d


484 --- 
R‘r›ve
 
the
 
urg’t
 
poš‹r
.

485 --- @ 
Urg’t
 
poš‹r
 
as
 16 
b™
 
š‹g”
.

486 
funùiÚ
 
tıH—d”
:
	$g‘Urg’tPoš‹r
()

487  
	$htÚ16
(
£lf
.
urg
)

488 
’d


490 --- 
R‘r›ve
 
the
 
urg’t
 
poš‹r
.

491 --- @ 
Urg’t
 
poš‹r
 
š
 
¡ršg
 
fÜm©
.

492 
funùiÚ
 
tıH—d”
:
	$g‘Urg’tPoš‹rSŒšg
()

493  
£lf
:
	$g‘Urg’tPoš‹r
()

494 
’d


498 ---- 
TCP
 
İtiÚs


501 
mod
.
İtiÚ
 = {

502 
”r
 = -1,

503 
eŞ
 = 0,

504 
nİ
 = 1,

505 
mss
 = 2,

506 
ws
 = 3,

507 
ts
 = 8,

508 
	}
}

509 
	gk
, 
v
 
š
 
	$·œs
(
mod
.
İtiÚ
) do

510 
mod
.
İtiÚ
[
v
] = 
k


511 
’d


513 
funùiÚ
 
tıH—d”
:
	$g‘O±iÚs
(
off£t
, 
Ën
)

514 
off£t
 = off£ˆ
Ü
 0

515 
Ën
 =†’ 
Ü
 
£lf
:
	$g‘V¬ŸbËL’gth
()

517 
loÿl
 
İtiÚs
 = {
	}
}

518 
loÿl
 
num
 = 1

519 
loÿl
 
¡¬tšg_off£t
 = 
off£t


520 
off£t
 < 
¡¬tšg_off£t
 + 
Ën
 dØ-- 
this
 
is
 
to
 
´ev’t
 
ª
 
šfš™e
 
loİ


521 
loÿl
 
code
 = 
£lf
.
İtiÚs
[
off£t
]

522 
İtiÚs
[
num
] = { 
ty³
 = 
code
, 
	goff£t
 = 
off£t
 }

523 
	gcode
 =ğ
mod
.
İtiÚ
['eŞ'] 
th’


524 -- 
th”e
 
¬e
 
¡l
 
İtiÚs
 
missšg
, 
add
 
”rÜ
 
İtiÚ
 
w™h
 
numb”
 
of
 missšg 
by‹s


525 
	goff£t
 < 
	g¡¬tšg_off£t
 + (
	gËn
 - 1è
th’


526 
	gİtiÚs
[
num
 + 1] = { 
ty³
 = -1, 
	goff£t
 = 
off£t
, 
	g”rÜ
 = "missšg " .. (
¡¬tšg_off£t
 + (
Ën
 - 1)) - offset .. "b" }

527 
’d


529 
–£if
 
	gcode
 =ğ
mod
.
İtiÚ
['nİ'] 
th’


530 
off£t
 = offset + 1

532 
loÿl
 
Ën
 = 
£lf
.
İtiÚs
[
off£t
 + 1]

533 
Ën
 < 1 
th’
 -- 
´ev’t
 
šfš™e
 
loİ


534 
Ën
 = 1

535 
’d


536 -- 
sim¶y
 
add
 
the
 
by‹s
 
to
 
bË


537 
İtiÚs
[
num
]['byte'] = {}

538 
i
 = 1, 
	gËn
 - 2 do

539 
	gİtiÚs
[
num
]['by‹'][
i
] = 
£lf
.
İtiÚs
[
off£t
 + 1 + i]

540 
’d


541 
off£t
 = off£ˆ+ 
Ën


542 
’d


543 
num
 =‚um + 1

544 
’d


545  
İtiÚs


546 
’d


548 
funùiÚ
 
tıH—d”
:
	$g‘O±iÚsSŒšg
()

549 
loÿl
 
İts
 = 
£lf
:
	$g‘O±iÚs
()

550 
loÿl
 
¡r
 = ""

551 
k
, 
v
 
š
 
	$·œs
(
İts
) do

552 
loÿl
 
t
 = 
v
['type']

553 
¡r
 = str .. ','

554 
t
 =ğ
mod
.
İtiÚ
['”r'] 
th’


555 
¡r
 = sŒ .. 
v
['error']

556 
–£if
 
t
 =ğ
mod
.
İtiÚ
['eŞ'] 
Ü
 =ğmod.İtiÚ['nİ'] 
th’


557 
¡r
 = sŒ .. 
mod
.
İtiÚ
[
t
]

558 
–£if
 
t
 =ğ
mod
.
İtiÚ
['ws'] 
th’


559 
¡r
 = sŒ .. 
£lf
:
	$g‘WSO±iÚSŒšg
(
v
)

560 
–£if
 
t
 =ğ
mod
.
İtiÚ
['mss'] 
th’


561 
¡r
 = sŒ .. 
£lf
:
	$g‘MssO±iÚSŒšg
(
v
)

562 
–£if
 
t
 =ğ
mod
.
İtiÚ
['ts'] 
th’


563 
¡r
 = sŒ .. 
£lf
:
	$g‘TSO±iÚSŒšg
(
v
)

565 
loÿl
 
İt
 = 
mod
.
İtiÚ
[
t
] 
ªd
 mod.İtiÚ[t] 
Ü


566 
¡r
 = sŒ .. 
İt
 .. " 0x"

567 
k
, 
v
 
š
 
	`·œs
(v['byte']) do

568 
¡r
 = sŒ .. 
¡ršg
.
	`fÜm©
("%02x", 
v
)

569 
’d


570 
’d


571 
’d


572  
¡ršg
.
	`sub
(
¡r
, 2, -1)

573 
’d


575 
funùiÚ
 
tıH—d”
:
	$£tNİO±iÚ
(
off£t
)

576 
£lf
.
İtiÚs
[
off£t
] = 1

577  
off£t
 + 1

578 
’d


580 
funùiÚ
 
tıH—d”
:
	$£tEŞO±iÚ
(
off£t
)

581 
£lf
.
İtiÚs
[
off£t
] = 0

582  
off£t
 + 1

583 
’d


585 
funùiÚ
 
tıH—d”
:
	$flO±iÚs
(
off£t
)

586 
off£t
 = off£ˆ
Ü
 0

587 
maxOff£t
 = 
£lf
:
	$g‘V¬ŸbËL’gth
()

588 
off£t
 < 
maxOff£t
 - 1 do

589 
off£t
 = 
£lf
:
	$£tNİO±iÚ
(
off£t
)

590 
’d


591 
off£t
 =ğ
maxOff£t
 - 1 
th’


592 
off£t
 = 
£lf
:
	$£tEŞO±iÚ
(
off£t
)

593 
’d


595  
off£t


596 
’d


598 
funùiÚ
 
tıH—d”
:
	$£tWSO±iÚ
(
off£t
, 
v®ue
)

599 
£lf
.
İtiÚs
[
off£t
] = 
mod
.
İtiÚ
['ws']

600 
£lf
.
İtiÚs
[
off£t
 + 1] = 3

601 
£lf
.
İtiÚs
[
off£t
 + 2] = 
v®ue


602  
off£t
 + 3

603 
’d


605 
funùiÚ
 
tıH—d”
:
	$g‘WSO±iÚ
(
off£t
)

606 
	`ty³
(
off£t
è=ğ
numb”
 
th’


607  
£lf
.
İtiÚs
[
off£t
 + 2]

609  
off£t
['byte'][1]

610 
’d


611 
’d


613 
funùiÚ
 
tıH—d”
:
	$g‘WSO±iÚSŒšg
(
off£t
)

614 
loÿl
 
v®
 = 
£lf
:
	$g‘WSO±iÚ
(
off£t
)

615  "WS " .. 
v®
 .. ' (x' .. 
m©h
.
	`pow
(2, val) .. ')'

616 
’d


618 
funùiÚ
 
tıH—d”
:
	$£tMssO±iÚ
(
off£t
, 
v®ue
)

619 
£lf
.
İtiÚs
[
off£t
] = 
mod
.
İtiÚ
['mss']

620 
£lf
.
İtiÚs
[
off£t
 + 1] = 4

621 
£lf
.
İtiÚs
[
off£t
 + 2] = 
	$rshiá
(
v®ue
, 8)

622 
£lf
.
İtiÚs
[
off£t
 + 3] = 
v®ue


623  
off£t
 + 4

624 
’d


626 
funùiÚ
 
tıH—d”
:
	$g‘MssO±iÚ
(
off£t
)

627 
loÿl
 
d©


628 
	`ty³
(
off£t
è=ğ
numb”
 
th’


629 
d©
 = { 
£lf
.
İtiÚ
[
off£t
 + 2], s–f.İtiÚ[off£ˆ+ 3] 
	}
}

631 
d©
 = 
off£t
['byte']

632 
’d


633  
lshiá
(
d©
[1], 8è+ 
	gd©
[2]

634 
’d


636 
funùiÚ
 
	gtıH—d”
:
	$g‘MssO±iÚSŒšg
(
off£t
)

637  "MSS " .. 
£lf
:
	$g‘MssO±iÚ
(
off£t
)

638 
’d


640 
funùiÚ
 
tıH—d”
:
	$£tTSO±iÚ
(
off£t
, 
tsv®
, 
t£ü
)

641 
£lf
.
İtiÚs
[
off£t
] = 
mod
.
İtiÚ
['ts']

642 
£lf
.
İtiÚs
[
off£t
 + 1] = 10

643 
£lf
.
İtiÚs
[
off£t
 + 2] = 
	$rshiá
(
tsv®
, 24)

644 
£lf
.
İtiÚs
[
off£t
 + 3] = 
	$rshiá
(
tsv®
, 16)

645 
£lf
.
İtiÚs
[
off£t
 + 4] = 
	$rshiá
(
tsv®
, 8)

646 
£lf
.
İtiÚs
[
off£t
 + 5] = 
tsv®


647 
£lf
.
İtiÚs
[
off£t
 + 6] = 
	$rshiá
(
t£ü
, 24)

648 
£lf
.
İtiÚs
[
off£t
 + 7] = 
	$rshiá
(
t£ü
, 16)

649 
£lf
.
İtiÚs
[
off£t
 + 8] = 
	$rshiá
(
t£ü
, 8)

650 
£lf
.
İtiÚs
[
off£t
 + 9] = 
t£ü


651  
off£t
 + 10

652 
’d


654 
funùiÚ
 
tıH—d”
:
	$g‘TSO±iÚ
(
off£t
)

655 
loÿl
 
d©
 = {
	}
}

656 
ty³
(
off£t
è=ğ'numb”' 
th’


657 -- 
Úly
 
š‹»¡ed
 
š
 
aùu®
 
İtiÚ
, 
	gby‹s
 [2:9]

658 
i
 = 2, 9 do

659 -- 
ugly
 
shiá
 
to
 
Ëá
 
as
 
the
 
computiÚ
 
b–ow
 
	gw™h
 'bytes'

660 -- 
assumes
 
th©
 
we
 
Úly
 
have
 
aùu®
 
İtiÚ
 
	$h”e
 (ğ
exşudšg
 
ty³
 
ªd
 
Ëngth
)

661 
d©
[
i
 - 1] = 
£lf
.
İtiÚs
[
off£t
 + i]

662 
’d


664 
d©
 = 
off£t
['byte']

665 
’d


666 
loÿl
 
tsv®
 = 
	`lshiá
(
d©
[1], 24) +†shift(dat[2], 16) +†shift(dat[3], 8) + dat[4]

667 
loÿl
 
t£ü
 = 
	`lshiá
(
d©
[5], 24) +†shift(dat[6], 16) +†shift(dat[7], 8) + dat[8]

668  { 
tsv®
 =sv®, 
t£ü
 =£ü 
	}
}

669 
’d


671 
funùiÚ
 
	gtıH—d”
:
	$g‘TSO±iÚSŒšg
(
off£t
)

672 
loÿl
 
r
 = 
£lf
:
	$g‘TSO±iÚ
(
off£t
)

673  "TSv® " .. 
r
['tsval'] .. " TSecr " ..„['tsecr']

674 
’d


678 ---- 
FunùiÚs
 
fuÎ
 
h—d”


681 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 

 
h—d”
.

682 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

683 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

684 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
Src
, 
D¡
, 
SeqNumb”
, 
AckNumb”
, 
D©aOff£t
, 
Re£rved
, 
FÏgs
, 
Urg
, 
Ack
, 
Psh
, 
R¡
, 
Syn
, 
Fš
, 
Wšdow
, 
Checksum
, 
Urg’tPoš‹r


685 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'tcp'.

686 --- @
code


687 --- 
	`fl
(è--- 
Úly
  
v®ues


688 --- 
fl
{ 
tıSrc
=1234, 
TTL
=100 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	gtıSrc


689 --- @
’dcode


690 
funùiÚ
 
	gtıH—d”
:
	$fl
(
¬gs
, 
´e
)

691 
¬gs
 =‡rg 
Ü
 {
	}
}

692 
´e
 =…» 
Ü
 "tcp"

694 
£lf
:
£tSrcPÜt
(
¬gs
[
´e
 .. "Src"])

695 
£lf
:
£tD¡PÜt
(
¬gs
[
´e
 .. "Dst"])

696 
£lf
:
£tSeqNumb”
(
¬gs
[
´e
 .. "SeqNumber"])

697 
£lf
:
£tAckNumb”
(
¬gs
[
´e
 .. "AckNumber"])

698 
£lf
:
£tD©aOff£t
(
¬gs
[
´e
 .. "DataOffset"])

699 
£lf
:
£tRe£rved
(
¬gs
[
´e
 .. "Reserved"])

700 
£lf
:
£tFÏgs
(
¬gs
[
´e
 .. "Flags"])

701 
¬gs
[
´e
 .. "Urg"] 
ªd
‡rgs[´.. "Urg"] ~ğ0 
th’


702 
£lf
:
	$£tUrg
()

703 
’d


704 
¬gs
[
´e
 .. "Ack"] 
ªd
‡rgs[´.. "Ack"] ~ğ0 
th’


705 
£lf
:
	$£tAck
()

706 
’d


707 
¬gs
[
´e
 .. "Psh"] 
ªd
‡rgs[´.. "Psh"] ~ğ0 
th’


708 
£lf
:
	$£tPsh
()

709 
’d


710 
¬gs
[
´e
 .. "R¡"] 
ªd
‡rgs[´.. "R¡"] ~ğ0 
th’


711 
£lf
:
	$£tR¡
()

712 
’d


713 
¬gs
[
´e
 .. "Syn"] 
ªd
‡rgs[´.. "Syn"] ~ğ0 
th’


714 
£lf
:
	$£tSyn
()

715 
’d


716 
¬gs
[
´e
 .. "Fš"] 
ªd
‡rgs[´.. "Fš"] ~ğ0 
th’


717 
£lf
:
	$£tFš
()

718 
’d


719 
£lf
:
	`£tWšdow
(
¬gs
[
´e
 .. "Window"])

720 
£lf
:
	`£tChecksum
(
¬gs
[
´e
 .. "Checksum"])

721 
£lf
:
	`£tUrg’tPoš‹r
(
¬gs
[
´e
 .. "UrgentPointer"])

722 
’d


724 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

725 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

726 --- @
£e
 
tıH—d”
:
fl


727 
funùiÚ
 
tıH—d”
:
	$g‘
(
´e
)

728 
´e
 =…» 
Ü
 "tcp"

730 
loÿl
 
¬gs
 = {
	}
}

731 
¬gs
[
´e
 .. "Src"] = 
£lf
:
	$g‘SrcPÜt
()

732 
¬gs
[
´e
 .. "D¡"] = 
£lf
:
	$g‘D¡PÜt
()

733 
¬gs
[
´e
 .. "SeqNumb”"] = 
£lf
:
	$g‘SeqNumb”
()

734 
¬gs
[
´e
 .. "AckNumb”"] = 
£lf
:
	$g‘AckNumb”
()

735 
¬gs
[
´e
 .. "D©aOff£t"] = 
£lf
:
	$g‘D©aOff£t
()

736 
¬gs
[
´e
 .. "Re£rved"] = 
£lf
:
	$g‘Re£rved
()

737 
¬gs
[
´e
 .. "FÏgs"] = 
£lf
:
	$g‘FÏgs
()

738 
¬gs
[
´e
 .. "Urg"] = 
£lf
:
	$g‘Urg
()

739 
¬gs
[
´e
 .. "Ack"] = 
£lf
:
	$g‘Ack
()

740 
¬gs
[
´e
 .. "Psh"] = 
£lf
:
	$g‘Psh
()

741 
¬gs
[
´e
 .. "R¡"] = 
£lf
:
	$g‘R¡
()

742 
¬gs
[
´e
 .. "Syn"] = 
£lf
:
	$g‘Syn
()

743 
¬gs
[
´e
 .. "Fš"] = 
£lf
:
	$g‘Fš
()

744 
¬gs
[
´e
 .. "Wšdow"] = 
£lf
:
	$g‘Wšdow
()

745 
¬gs
[
´e
 .. "Checksum"] = 
£lf
:
	$g‘Checksum
()

746 
¬gs
[
´e
 .. "Urg’tPoš‹r"] = 
£lf
:
	$g‘Urg’tPoš‹r
()

748  
¬gs


749 
’d


751 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

752 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

753 
funùiÚ
 
tıH—d”
:
	$g‘SŒšg
()

754  "TCP " .. 
£lf
:
	`g‘SrcPÜtSŒšg
()

755 .. " > " .. 
£lf
:
	`g‘D¡PÜtSŒšg
()

756 .. " seq# " .. 
£lf
:
	`g‘SeqNumb”SŒšg
()

757 .. "‡ck# " .. 
£lf
:
	`g‘AckNumb”SŒšg
()

758 .. " off£ˆ" .. 
£lf
:
	`g‘D©aOff£tSŒšg
()

759 .. "„e£rved " .. 
£lf
:
	`g‘Re£rvedSŒšg
()

760 .. " fÏg " .. 
£lf
:
	`g‘FÏgsSŒšg
()

761 .. " [" .. 
£lf
:
	`g‘UrgSŒšg
()

762 .. "|" .. 
£lf
:
	`g‘AckSŒšg
()

763 .. "|" .. 
£lf
:
	`g‘PshSŒšg
()

764 .. "|" .. 
£lf
:
	`g‘R¡SŒšg
()

765 .. "|" .. 
£lf
:
	`g‘SynSŒšg
()

766 .. "|" .. 
£lf
:
	`g‘FšSŒšg
()

767 .."] wš " .. 
£lf
:
	`g‘WšdowSŒšg
()

768 .. " cksum " .. 
£lf
:
	`g‘ChecksumSŒšg
()

769 .. " urg " .. 
£lf
:
	`g‘Urg’tPoš‹rSŒšg
()

770 .. " [" .. 
£lf
:
	`g‘O±iÚsSŒšg
() .. "]"

771 
’d


773 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
).

774 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength.

775 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e
.

776 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl
.

777 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'tcp'

778 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
Also
)

779 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


780 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


781 --- @ 
TabË
 
of
 
ÇmedArgs


782 --- @
£e
 
tıH—d”
:
fl


783 
funùiÚ
 
tıH—d”
:
	$£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
, 
h—d”L’gth
)

784 
nÙ
 
ÇmedArgs
[
´e
 .. "D©aOff£t"] 
th’


785 
ÇmedArgs
[
´e
 .. "D©aOff£t"] = 
h—d”L’gth
 / 4

786 
’d


787  
ÇmedArgs


788 
’d


790 
funùiÚ
 
tıH—d”
:
	$g‘V¬ŸbËL’gth
()

791 
loÿl
 
r
 = (
£lf
:
	`g‘D©aOff£t
() - 5) * 4

792 
r
 <ğ0 
th’


794 
’d


795  
r


796 
’d


800 ---- 
M‘©y³s


803 
mod
.
m‘©y³
 = 
tıH—d”


805  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/template.lua

1 
loÿl
 
fl


2 
loÿl
 
g‘


3 
loÿl
 
g‘SŒšg


4 
loÿl
 
»sŞveNextH—d”


5 
loÿl
 
£tDeçuÉNamedArgs


6 
loÿl
 
g‘V¬ŸbËL’gth


7 
loÿl
 
	gg‘SubTy³


10 --- 
In™Ÿlize
 
a
 
Ãw
 
h—d”
 
	g¡ruùu»
.

11 --- 
Adds
 
autom©ic
 
g’”©ed
 
	g£t
/
	gg‘
/
g‘SŒšg
 
®l
 
	gmemb”s


12 --- 
WÜks
 
	gušt8_t
, 
ušt16_t
 
ªd
 
	gušt32_t


13 --- 
FÜ
 
®l
 
Ùh”
 
ty³s
 
the
 
ü—‹d
 
funùiÚs
 
have
 
to
 
be
 
mªu®y
 
	gov”wr™‹n


14 --- 
Adds
 
em±y
 
‹m¶©e
 
funùiÚs
 
®l
 
»quœed
 funùiÚ 
Ú
 
the
 
com¶‘e
 
	gh—d”


15 --- 
	gfl
/
	gg‘
/
g‘SŒšg
 
have
 
to
 
be
 
fËd
 
š
 
	gmªu®ly


16 --- 
AÎ
 
Ùh”
 
funùiÚs
 
Úly
 
wh’
 
»quœed
 
this
 
	g´ÙocŞ


17 --- @
·¿m
 
The
 
h—d”
 
fÜm©
 
as
 
	g¡ršg


18 --- @ 
m‘©abË
 
the
 
h—d”
 
¡ruùu»


19 
funùiÚ
 
	$š™H—d”
()

20 
loÿl
 
mod
 = {
	}
}

21 
mod
.
__šdex
 = mod

23 -- 
ü—‹
 
£‰”
 
ªd
 
g‘‹r
 
®l
 
memb”s
 
of
 
the
 
defšed
 
C
 

24 
th’


25 
lše
 
š
 
¡ršg
.
gm©ch
(, "(.-)\n") do

26 -- 
sk
 
em±y
 
lšes


27 
nÙ
 (
lše
 =ğ''è
th’


28 -- 
g‘
 
Çme
 
of
 
memb”
: 
©
 
the
 
’d
 
mu¡
 
be
 
a
 ';', 
befÜe
 
th©
 
might
 
	gbe
 [<>] 
which
 
is
 
ignÜed


29 
loÿl
 
	gmemb”
 = 
¡ršg
.
m©ch
(
lše
, "([^%s%[%]]*)%[?%d*%]?%s*;")

30 
loÿl
 
	gfunc_Çme
 = 
memb”
:
gsub
("^%l", 
¡ršg
.
uµ”
)

31 
loÿl
 
	gty³
 = 
¡ršg
.
m©ch
(
lše
, "%s*(.-)%s+([^%s]*)%s*;")

32 
nÙ
 (
memb”
 =ğ''è
ªd
‚Ù (
ty³
 =ğ''è
th’


33 -- 
autom©iÿÎy
 
£t
 
by‹
 
Üd”
 
š‹g”s


34 
loÿl
 
cÚv”siÚ
 = ''

35 
loÿl
 
şo£_cÚv”siÚ
 = ''

36 
ty³
 =ğ'ušt16_t' 
th’


37 
cÚv”siÚ
 = 'hton16('

38 
şo£_cÚv”siÚ
 = ')'

39 
–£if
 
ty³
 =ğ'ušt32_t' 
th’


40 
cÚv”siÚ
 = 'hton('

41 
şo£_cÚv”siÚ
 = ')'

42 
’d


44 -- 
£t


45 
loÿl
 
¡r
 = [[

46  
	$funùiÚ
(
£lf
, 
v®
)

47 
v®
 = v® 
Ü
 0

48 
£lf
.]] .. 
memb”
 .. [[ = ]] .. 
cÚv”siÚ
 .. [[
v®
]] .. 
şo£_cÚv”siÚ
 .. [[

49 
’d
]]

51 -- 
lßd
 
Ãw
 
funùiÚ
 
ªd
  
™


52 
loÿl
 
func
 = 
	`as£¹
(
	$lßd¡ršg
(
¡r
))()

53 
mod
['£t' .. 
func_Çme
] = 
func


55 -- 
g‘


56 
loÿl
 
¡r
 = [[

57  
	$funùiÚ
(
£lf
)

58  ]] .. 
cÚv”siÚ
 .. [[
£lf
.]] .. 
memb”
 .. 
şo£_cÚv”siÚ
 .. [[

59 
’d
]]

61 -- 
lßd
 
Ãw
 
funùiÚ
 
ªd
  
™


62 
loÿl
 
func
 = 
	`as£¹
(
	$lßd¡ršg
(
¡r
))()

63 
mod
['g‘' .. 
func_Çme
] = 
func


65 -- 
g‘FooSŒšg


66 
loÿl
 
¡r
 = [[

67  
	$funùiÚ
(
£lf
)

68  
	`to¡ršg
(
£lf
:
g‘
]] .. 
func_Çme
 .. [[())

69 
’d
]]

71 -- 
lßd
 
Ãw
 
funùiÚ
 
ªd
  
™


72 
loÿl
 
func
 = 
	`as£¹
(
	$lßd¡ršg
(
¡r
))()

73 
mod
['g‘' .. 
func_Çme
 .. 'SŒšg'] = 
func


75 
	`´št
('Warning:ƒmpty or malicious†ine cannot be…arsed')

76 
’d


77 
’d


78 
’d


79 
’d


81 -- 
add
 
‹m¶©es
 
h—d”
-
wide
 
funùiÚs


82 
mod
.
fl
 = fill

83 
mod
.
g‘
 = get

84 
mod
.
g‘SŒšg
 = getString

85 
mod
.
»sŞveNextH—d”
 =„esolveNextHeader

86 
mod
.
£tDeçuÉNamedArgs
 = setDefaultNamedArgs

87 
mod
.
g‘V¬ŸbËL’gth
 = getVariableLength

88 
mod
.
g‘SubTy³
 = getSubType

90  
	`£tm‘©abË
({
	}
}, 
	gmod
)

91 
’d


93 
funùiÚ
 
	$fl
(
£lf
, 
¬gs
, 
´e
)

94 
’d


96 
funùiÚ
 
	$g‘
(
£lf
, 
´e
)

97  {
	}
}

98 
’d


100 
funùiÚ
 
	$g‘SŒšg
(
£lf
)

102 
’d


104 --- 
Defšes
 
how
, 
ba£d
 
Ú
 
the
 
d©a
 
of
 
this
 
h—d”
,h
Ãxt
 
fŞlowšg
 
´ÙocŞ
 
š
h
¡ack
 
ÿn
 
be
 
»sŞved


105 
funùiÚ
 
	$»sŞveNextH—d”
(
£lf
)

106  
n


107 
’d


109 --- 
Defšes
 
how
, 
ba£d
 
Ú
 
the
 
d©a
 
of
 
this
 
h—d”
 
ªd
h
com¶‘e
 
¡ack
,h 
v®ues
 oàthi 
h—d”s
 
memb”
 
chªge


110 
funùiÚ
 
	$£tDeçuÉNamedArgs
(
£lf
, 
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
, 
h—d”L’gth
)

111  
ÇmedArgs


112 
’d


114 --- 
Defšes
 
how
, 
ba£d
 
Ú
 
the
 
d©a
 
of
 
this
 
h—d”
,h
Ëngth
 oàth
v¬ŸbË
 
sized
 
memb”
 
ÿn
 
be
 
d‘”mšed


115 
funùiÚ
 
	$g‘V¬ŸbËL’gth
(
£lf
)

116  
n


117 
’d


119 --- 
Defšes
 
how
, 
ba£d
 
Ú
 
the
 
d©a
 
of
 
this
 
h—d”
,h
´ÙocŞ
 
subty³
 
ÿn
 
be
 
d‘”mšed


120 
funùiÚ
 
	$g‘SubTy³
(
£lf
)

121  
n


122 
’d


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/udp.lua

2 --- @
fe
 
	gudp
.
	glua


3 --- @
br›f
 
U£r
 
d©ag¿m
 
	$´ÙocŞ
 (
UDP
è
ut™y
.

4 --- 
Ut™y
 
funùiÚs
 
udp_h—d”
 

5 --- 
Inşudes
:

6 --- - 
Udp
 
cÚ¡ªts


7 --- - 
Udp
 
h—d”
 
ut™y


8 --- - 
Defš™iÚ
 
of
 
Udp
 
·ck‘s


11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

13 
»quœe
 "utils"

14 
»quœe
 "proto.template"

15 
loÿl
 
š™H—d”
 = initHeader

17 
loÿl
 
Áoh
, 
htÚ
 =‚toh, hton

18 
loÿl
 
Áoh16
, 
htÚ16
 =‚toh16, hton16

19 
loÿl
 
bÜ
, 
bªd
, 
bnÙ
, 
rshiá
, 
lshiá
ğ
b™
.bor, bit.band, bit.bnot, bit.rshift, bit.lshift

20 
loÿl
 
i¡y³
 = 
ffi
.istype

21 
loÿl
 
fÜm©
 = 
¡ršg
.format

25 ---- 
UDP
 
cÚ¡ªts


28 --- 
Udp
 
´ÙocŞ
 
cÚ¡ªts


29 
loÿl
 
udp
 = {
	}
}

31 -- 
TODO
 
move
 
w–l
-
known
 
pÜts
 
somewh”e
 , 
tho£
 
¬e
 
nÙ
 
Úly
 
Udp


33 
	gudp
.
	gPORT_DNS
 = 53

34 
udp
.
PORT_PTP_EVENTS
 = 319

35 
udp
.
PORT_PTP_GENERAL_MESSAGES
 = 320

36 
udp
.
PORT_IPFIX
 = 4739

37 
udp
.
PORT_VXLAN
 = 4789

38 
udp
.
PORT_SFLOW
 = 6343

42 ---- 
UDP
 
h—d”


45 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


46 
udp
.
h—d”FÜm©
 = [[

47 
ušt16_t
 
¤c
;

48 
ušt16_t
 
d¡
;

49 
ušt16_t
 
Ën
;

50 
ušt16_t
 
cs
;

53 --- 
V¬ŸbË
 
sized
 
memb”


54 
	gudp
.
	gh—d”V¬ŸbËMemb”
 = 
n


56 --- 
ModuË
 
udp_h—d”
 

57 
loÿl
 
udpH—d”
 = 
	$š™H—d”
()

58 
udpH—d”
.
__šdex
 = udpHeader

60 --- 
S‘
 
the
 
sourû
 
pÜt
.

61 --- @
·¿m
 
Sourû
 
pÜt
 
of
 
the
 
udp
 
h—d”
 
as
 16 
b™
 
š‹g”
.

62 
funùiÚ
 
udpH—d”
:
	$£tSrcPÜt
()

63 ğ
Ü
 1024

64 
£lf
.
¤c
 = 
	$htÚ16
()

65 
’d


67 --- 
R‘r›ve
 
the
 
UDP
 
sourû
 
pÜt
.

68 --- @ 
PÜt
 
as
 16 
b™
 
š‹g”
.

69 
funùiÚ
 
udpH—d”
:
	$g‘SrcPÜt
()

70  
	$htÚ16
(
£lf
.
¤c
)

71 
’d


73 --- 
R‘r›ve
 
the
 
UDP
 
sourû
 
pÜt
.

74 --- @ 
PÜt
 
as
 
¡ršg
.

75 
funùiÚ
 
udpH—d”
:
	$g‘SrcPÜtSŒšg
()

76  
£lf
:
	$g‘SrcPÜt
()

77 
’d


79 --- 
S‘
 
the
 
de¡š©iÚ
 
pÜt
.

80 --- @
·¿m
 
De¡š©iÚ
 
pÜt
 
of
 
the
 
udp
 
h—d”
 
as
 16 
b™
 
š‹g”
.

81 
funùiÚ
 
udpH—d”
:
	$£tD¡PÜt
()

82 ğ
Ü
 1025

83 
£lf
.
d¡
 = 
	$htÚ16
()

84 
’d


86 --- 
R‘r›ve
 
the
 
UDP
 
de¡š©iÚ
 
pÜt
.

87 --- @ 
PÜt
 
as
 16 
b™
 
š‹g”
.

88 
funùiÚ
 
udpH—d”
:
	$g‘D¡PÜt
()

89  
	$htÚ16
(
£lf
.
d¡
)

90 
’d


92 --- 
R‘r›ve
 
the
 
UDP
 
de¡š©iÚ
 
pÜt
.

93 --- @ 
PÜt
 
as
 
¡ršg
.

94 
funùiÚ
 
udpH—d”
:
	$g‘D¡PÜtSŒšg
()

95  
£lf
:
	$g‘D¡PÜt
()

96 
’d


98 --- 
S‘
 
the
 
Ëngth
.

99 --- @
·¿m
 
L’gth
 
of
 
the
 
udp
 
h—d”
 
¶us
 
	`·ylßd
 (
exşudšg
 
l2
 
ªd
 
l3
). 16 
b™
 
š‹g”
.

100 
funùiÚ
 
udpH—d”
:
	$£tL’gth
()

101 ğ
Ü
 28 -- 
w™h
 
‘h”Ãt
 + 
IPv4
 
h—d”
 -> 64B

102 
£lf
.
Ën
 = 
	$htÚ16
()

103 
’d


105 --- 
R‘r›ve
 
the
 
Ëngth
.

106 --- @ 
L’gth
 
as
 16 
b™
 
š‹g”
.

107 
funùiÚ
 
udpH—d”
:
	$g‘L’gth
()

108  
	$htÚ16
(
£lf
.
Ën
)

109 
’d


111 --- 
R‘r›ve
 
the
 
Ëngth
.

112 --- @ 
L’gth
 
as
 
¡ršg
.

113 
funùiÚ
 
udpH—d”
:
	$g‘L’gthSŒšg
()

114  
£lf
:
	$g‘L’gth
()

115 
’d


117 --- 
S‘
 
the
 
checksum
.

118 --- @
·¿m
 
Checksum
 
of
 
the
 
udp
 
h—d”
 
as
 16 
b™
 
š‹g”
.

119 
funùiÚ
 
udpH—d”
:
	$£tChecksum
()

120 ğ
Ü
 0

121 
£lf
.
cs
 = 
	$htÚ16
()

122 
’d


124 --- 
C®cuÏ‹
 
the
 
checksum
.

125 --- @
todo
 
FIXME
 
NYI


126 
funùiÚ
 
udpH—d”
:
	$ÿlcuÏ‹Checksum
(
Ën
)

127 
’d


129 --- 
R‘r›ve
 
the
 
checksum
.

130 --- @ 
Checksum
 
as
 16 
b™
 
š‹g”
.

131 
funùiÚ
 
udpH—d”
:
	$g‘Checksum
()

132  
	$htÚ16
(
£lf
.
cs
)

133 
’d


135 --- 
R‘r›ve
 
the
 
checksum
.

136 --- @ 
Checksum
 
as
 
¡ršg
.

137 
funùiÚ
 
udpH—d”
:
	$g‘ChecksumSŒšg
()

138  
	`fÜm©
("0x%04x", 
£lf
:
	$g‘Checksum
())

139 
’d


141 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 
udp
 
h—d”
.

142 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

143 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

144 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
udpSrc
, 
udpD¡
, 
udpL’gth
, 
udpChecksum


145 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'udp'.

146 --- @
code


147 --- 
	`fl
(è--- 
Úly
  
v®ues


148 --- 
fl
{ 
udpSrc
=44566, 
6L’gth
=101 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	gudpSrc


149 --- @
’dcode


150 
funùiÚ
 
	gudpH—d”
:
	$fl
(
¬gs
, 
´e
)

151 
¬gs
 =‡rg 
Ü
 {
	}
}

152 
´e
 =…» 
Ü
 "udp"

154 
£lf
:
£tSrcPÜt
(
¬gs
[
´e
 .. "Src"])

155 
£lf
:
£tD¡PÜt
(
¬gs
[
´e
 .. "Dst"])

156 
£lf
:
£tL’gth
(
¬gs
[
´e
 .. "Length"])

157 
£lf
:
£tChecksum
(
¬gs
[
´e
 .. "Checksum"])

158 
’d


160 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

161 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'udp'.

162 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

163 --- @
£e
 
udpH—d”
:
fl


164 
funùiÚ
 
udpH—d”
:
	$g‘
(
´e
)

165 
´e
 =…» 
Ü
 "udp"

167 
loÿl
 
¬gs
 = {
	}
}

168 
¬gs
[
´e
 .. "Src"] = 
£lf
:
	$g‘SrcPÜt
()

169 
¬gs
[
´e
 .. "D¡"] = 
£lf
:
	$g‘D¡PÜt
()

170 
¬gs
[
´e
 .. "L’gth"] = 
£lf
:
	$g‘L’gth
()

171 
¬gs
[
´e
 .. "Checksum"] = 
£lf
:
	$g‘Checksum
()

173  
¬gs


174 
’d


176 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

177 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

178 
funùiÚ
 
udpH—d”
:
	$g‘SŒšg
()

179  "UDP " .. 
£lf
:
	`g‘SrcPÜtSŒšg
(è.. " > " .. s–f:
	`g‘D¡PÜtSŒšg
(è.. "†’ " .. s–f:
	`g‘L’gthSŒšg
()

180 .. " cksum " .. 
£lf
:
	$g‘ChecksumSŒšg
()

181 
’d


183 -- 
M­s
 
h—d”s
 
to
 
	$»¥eùive
 (
w–l
 
knwÚ
è
pÜt
.

184 -- 
This
 
li¡
 
should
 
be
 
ex‹nded
 
wh’ev”
 
a
 
Ãw
 
´ÙocŞ
 
is
 
added
 
to
 'UDP constants'.

185 
loÿl
 
m­NamePÜt
 = {

186 
±p
 = { 
udp
.
PORT_PTP_EVENTS
, udp.
PORT_PTP_GENERAL_MESSAGES
 },

187 
vxÏn
 = 
udp
.
PORT_VXLAN
,

188 
sæow
 = 
udp
.
PORT_SFLOW
,

189 
dns
 = 
udp
.
PORT_DNS
,

190 
fix
 = 
udp
.
PORT_IPFIX
,

191 
	}
}

193 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
Úe
 (
š
 
a
 
·ck‘
).

194 --- 
FÜ
 
	gš¡ªû
: 
š
 
tı
/
udp
 
ba£d
 
Ú
 
the
 
pÜts
.

195 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


196 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

197 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. 'udp', 'icmp', 
n
)

198 
funùiÚ
 
udpH—d”
:
	$»sŞveNextH—d”
()

199 
loÿl
 
pÜt
 = 
£lf
:
	$g‘D¡PÜt
()

200 
Çme
, 
_pÜt
 
š
 
	$·œs
(
m­NamePÜt
) do

201 
	`ty³
(
_pÜt
è=ğ"bË" 
th’


202 
_
, 
p
 
š
 
	$·œs
(
_pÜt
) do

203 
pÜt
 =ğ
p
 
th’


204  
Çme


205 
’d


206 
’d


207 
–£if
 
pÜt
 =ğ
_pÜt
 
th’


208  
Çme


209 
’d


210 
’d


211  
n


212 
’d


214 --- 
Chªge
 
the
  
v®ues
 
	`ÇmedArgum’ts
 (
fl
/
g‘
).

215 --- 
This
 
ÿn
 
be
 
u£d
 
to
 
š¡ªû
 
ÿlcuÏ‹
 
a
 
Ëngth
 
v®ue
 
ba£d
 
Ú
 
the
 
tÙ®
 
·ck‘
†ength.

216 --- 
S“
 
´Ùo
/
4
.
£tDeçuÉNamedArgs
 
as
 
ª
 
exam¶e
.

217 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
by
 
·ck‘
.
fl
.

218 --- @
·¿m
 
´e
 
The
 
´efix
 
u£d
 
the
 
ÇmedArgs
, 
e
.
g
. 'udp'

219 --- @
·¿m
 
ÇmedArgs
 
TabË
 
of
 
Çmed
 
	`¬gum’ts
 (
£e
 
S“
 
Also
)

220 --- @
·¿m
 
ÃxtH—d”
 
The
 
h—d”
 
fŞlowšg
 
aá”
 
this
 h—d” 
š
 
a
 
·ck‘


221 --- @
·¿m
 
accumuÏ‹dL’gth
 
The
 
so
 
çr
 
accumuÏ‹d
 
Ëngth
 
´evious
 
h—d”s
 
š
 
a
 
·ck‘


222 --- @ 
TabË
 
of
 
ÇmedArgs


223 --- @
£e
 
4H—d”
:
fl


224 
funùiÚ
 
udpH—d”
:
	`£tDeçuÉNamedArgs
(
´e
, 
ÇmedArgs
, 
ÃxtH—d”
, 
accumuÏ‹dL’gth
, 
·ck‘L’gth
)

225 -- 
£t
 
Ëngth


226 
nÙ
 
ÇmedArgs
[
´e
 .. "L’gth"] 
ªd
‚amedArgs["pktL’gth"] 
th’


227 
ÇmedArgs
[
´e
 .. "L’gth"] =‚amedArgs["pktL’gth"] - 
accumuÏ‹dL’gth


228 
’d


230 -- 
£t
 
d¡
 
pÜt


231 
nÙ
 
ÇmedArgs
[
´e
 .. "D¡"] 
th’


232 
Çme
, 
_pÜt
 
š
 
	$·œs
(
m­NamePÜt
) do

233 
ÃxtH—d”
 =ğ
Çme
 
th’


234 
ÇmedArgs
[
´e
 .. "D¡"] = 
	`ty³
(
_pÜt
è=ğ"bË" 
ªd
 _pÜt[1] 
Ü
 _port

236 
’d


237 
’d


238 
’d


239  
ÇmedArgs


240 
’d


244 ---- 
M‘©y³s


247 
udp
.
m‘©y³
 = 
udpH—d”


250  
udp


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/vxlan.lua

2 --- @
fe
 
	gvxÏn
.
	glua


3 --- @
br›f
 
VXLAN
 
	gut™y
.

4 --- 
Ut™y
 
funùiÚs
 
the
 
vxÏn_h—d”
 

5 --- 
	gInşudes
:

6 --- - 
VXLAN
 
cÚ¡ªts


7 --- - 
VXLAN
 
h—d”
 
ut™y


8 --- - 
Defš™iÚ
 
of
 
VXLAN
 
·ck‘s


11 
loÿl
 
ffi
 = 
»quœe
 "ffi"

12 
»quœe
 "proto.template"

13 
loÿl
 
š™H—d”
 = initHeader

15 
loÿl
 
bÜ
, 
	gbªd
, 
	gbnÙ
, 
	grshiá
, 
	glshiá
ğ
b™
.bÜ, 
	gb™
.bªd, b™.bnÙ, b™.rshiá, b™.
lshiá


16 
loÿl
 
	gfÜm©
 = 
¡ršg
.
fÜm©


19 ---- 
vxÏn
 
cÚ¡ªts


22 
loÿl
 
vxÏn
 = {}

26 ---- 
vxÏn
 
h—d”


29 -- 
defš™iÚ
 
of
 
the
 
h—d”
 
fÜm©


30 
vxÏn
.
h—d”FÜm©
 = [[

31 
ušt8_t
 
æags
;

32 
ušt8_t
 
»£rved
[3];

33 
ušt8_t
 
	gvni
[3];

34 
ušt8_t
 
	g»£rved2
;

37 --- 
V¬ŸbË
 
sized
 
memb”


38 
	gvxÏn
.
	gh—d”V¬ŸbËMemb”
 = 
n


40 --- 
ModuË
 
vxÏn_h—d”
 

41 
loÿl
 
vxÏnH—d”
 = 
	$š™H—d”
()

42 
vxÏnH—d”
.
__šdex
 = vxlanHeader

44 --- 
S‘
 
the
 
æags
.

45 --- @
·¿m
 
VXLAN
 
h—d”
 
æags
 
as
 8 
b™
 
š‹g”
.

46 
funùiÚ
 
vxÏnH—d”
:
	$£tFÏgs
()

47 ğ
Ü
 8 -- '00001000'

48 
£lf
.
æags
 = 

49 
’d


51 --- 
R‘r›ve
 
the
 
æags
.

52 --- @ 
FÏgs
 
as
 8 
b™
 
š‹g”
.

53 
funùiÚ
 
vxÏnH—d”
:
	$g‘FÏgs
()

54  
£lf
.
æags


55 
’d


57 --- 
R‘r›ve
 
the
 
æags
.

58 --- @ 
FÏgs
 
as
 
¡ršg
.

59 
funùiÚ
 
vxÏnH—d”
:
	$g‘FÏgsSŒšg
()

60  
	`fÜm©
("0x%02x", 
£lf
:
	$g‘FÏgs
())

61 
’d


63 --- 
S‘
 
the
 
fœ¡
 
»£rved
 
f›ld
.

64 --- @
·¿m
 
VXLAN
 
h—d”
 
fœ¡
 
»£rved
 
f›ld
 
as
 24 
b™
 
š‹g”
.

65 
funùiÚ
 
vxÏnH—d”
:
	$£tRe£rved
()

66 ğ
Ü
 0

68 -- 
X
 3 2 1 -> 1 2 3

69 
£lf
.
»£rved
[0] = 
	`rshiá
(
	`bªd
(, 0xFF0000), 16)

70 
£lf
.
»£rved
[1] = 
	`rshiá
(
	`bªd
(, 0x00FF00), 8)

71 
£lf
.
»£rved
[2] = 
	$bªd
(, 0x0000FF)

72 
’d


74 --- 
R‘r›ve
 
the
 
fœ¡
 
»£rved
 
f›ld
.

75 --- @ 
Fœ¡
 
»£rved
 
f›ld
 
as
 24 
b™
 
š‹g”
.

76 
funùiÚ
 
vxÏnH—d”
:
	$g‘Re£rved
()

77  
	`bÜ
(
	`lshiá
(
£lf
.
»£rved
[0], 16), bor(lshift(self.reserved[1], 8), self.reserved[2]))

78 
’d


80 --- 
R‘r›ve
 
the
 
fœ¡
 
»£rved
 
f›ld
.

81 --- @ 
Fœ¡
 
»£rved
 
f›ld
 
as
 
¡ršg
.

82 
funùiÚ
 
vxÏnH—d”
:
	$g‘Re£rvedSŒšg
()

83  
	`fÜm©
("0x%06x", 
£lf
:
	$g‘Re£rved
())

84 
’d


86 --- 
S‘
 
the
 
VXLAN
 
ÃtwÜk
 
	`id’tif›r
 (
VNI
).

87 --- @
·¿m
 
VXLAN
 
h—d”
 
VNI
 
as
 24 
b™
 
š‹g”
.

88 
funùiÚ
 
vxÏnH—d”
:
	$£tVNI
()

89 ğ
Ü
 0

91 -- 
X
 3 2 1 -> 1 2 3

92 
£lf
.
vni
[0] = 
	`rshiá
(
	`bªd
(, 0xFF0000), 16)

93 
£lf
.
vni
[1] = 
	`rshiá
(
	`bªd
(, 0x00FF00), 8)

94 
£lf
.
vni
[2] = 
	$bªd
(, 0x0000FF)

95 
’d


97 --- 
R‘r›ve
 
the
 
VXLAN
 
ÃtwÜk
 
	`id’tif›r
 (
VNI
).

98 --- @ 
VNI
 
as
 24 
b™
 
š‹g”
.

99 
funùiÚ
 
vxÏnH—d”
:
	$g‘VNI
()

100  
	`bÜ
(
	`lshiá
(
£lf
.
vni
[0], 16), bor(lshift(self.vni[1], 8), self.vni[2]))

101 
’d


103 --- 
R‘r›ve
 
the
 
VXLAN
 
ÃtwÜk
 
	`id’tif›r
 (
VNI
).

104 --- @ 
VNI
 
as
 
¡ršg
.

105 
funùiÚ
 
vxÏnH—d”
:
	$g‘VNISŒšg
()

106  
	`fÜm©
("0x%06x", 
£lf
:
	$g‘VNI
())

107 
’d


109 --- 
S‘
 
the
 
£cÚd
 
»£rved
 
f›ld
.

110 --- @
·¿m
 
VXLAN
 
h—d”
 
£cÚd
 
»£rved
 
f›ld
 
as
 8 
b™
 
š‹g”
.

111 
funùiÚ
 
vxÏnH—d”
:
	$£tRe£rved2
()

112 ğ
Ü
 0

113 
£lf
.
»£rved2
 = 

114 
’d


116 --- 
R‘r›ve
 
the
 
£cÚd
 
»£rved
 
f›ld
.

117 --- @ 
SecÚd
 
»£rved
 
f›ld
 
as
 8 
b™
 
š‹g”
.

118 
funùiÚ
 
vxÏnH—d”
:
	$g‘Re£rved2
()

119  
£lf
.
»£rved2


120 
’d


122 --- 
R‘r›ve
 
the
 
£cÚd
 
»£rved
 
f›ld
.

123 --- @ 
SecÚd
 
»£rved
 
f›ld
 
as
 
¡ršg
.

124 
funùiÚ
 
vxÏnH—d”
:
	$g‘Re£rved2SŒšg
()

125  
	`fÜm©
("0x%02x", 
£lf
:
	$g‘Re£rved2
())

126 
’d


128 --- 
S‘
 
®l
 
memb”s
 
of
 
the
 

 
h—d”
.

129 --- 
P”
 , 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
¥ecif›d
 
š
 
the
 
»¥eùive
 s‘ 
funùiÚ
.

130 --- 
O±iÚ®
 
Çmed
 
¬gum’ts
 
ÿn
 
be
 
u£d
 
to
 
£t
 
a
 
memb”
Ø¨
u£r
-
´ovided
 
v®ue
.

131 --- @
·¿m
 
¬gs
 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
AvaabË
‡rgum’ts: 
FÏgs
, 
Re£rved
, 
VNI
, 
Re£rved2


132 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'vxlan'.

133 --- @
code


134 --- 
	`fl
(è--- 
Úly
  
v®ues


135 --- 
fl
{ 
vxÏnFÏgs
=1 
	}
} --- 
®l
 
memb”s
 
¬e
 
£t
 
to
  
v®ues
 
w™h
 
the
 
exû±iÚ
 
of
 
	gvxÏnFÏgs


136 --- @
’dcode


137 
funùiÚ
 
	gvxÏnH—d”
:
	$fl
(
¬gs
, 
´e
)

138 
¬gs
 =‡rg 
Ü
 {
	}
}

139 
´e
 =…» 
Ü
 "vxlan"

141 
£lf
:
£tFÏgs
(
¬gs
[
´e
 .. "Flags"])

142 
£lf
:
£tRe£rved
(
¬gs
[
´e
 .. "Reserved"])

143 
£lf
:
£tVNI
(
¬gs
[
´e
 .. "VNI"])

144 
£lf
:
£tRe£rved2
(
¬gs
[
´e
 .. "Reserved2"])

145 
’d


147 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

148 --- @
·¿m
 
´e
 
´efix
 
ÇmedArgs
. 
DeçuÉ
 'vxlan'.

149 --- @ 
TabË
 
of
 
Çmed
 
¬gum’ts
. 
FÜ
 
a
 
li¡
 oà¬gum’t 
£e
 "See‡lso".

150 --- @
£e
 
vxÏnH—d”
:
fl


151 
funùiÚ
 
vxÏnH—d”
:
	$g‘
(
´e
)

152 
´e
 =…» 
Ü
 "vxlan"

154 
loÿl
 
¬gs
 = {
	}
}

155 
¬gs
[
´e
 .. "FÏgs"] = 
£lf
:
	$g‘FÏgs
()

156 
¬gs
[
´e
 .. "Re£rved"] = 
£lf
:
	$g‘Re£rved
()

157 
¬gs
[
´e
 .. "VNI"] = 
£lf
:
	$g‘VNI
()

158 
¬gs
[
´e
 .. "Re£rved2"] = 
£lf
:
	$g‘Re£rved2
()

160  
¬gs


161 
’d


163 --- 
R‘r›ve
 
the
 
v®ues
 
of
 
®l
 
memb”s
.

164 --- @ 
V®ues
 
š
 
¡ršg
 
fÜm©
.

165 
funùiÚ
 
vxÏnH—d”
:
	$g‘SŒšg
()

166  "VXLAN fÏg " .. 
£lf
:
	`g‘FÏgsSŒšg
()

167 .. "„e " .. 
£lf
:
	`g‘Re£rvedSŒšg
()

168 .. " vn˜" .. 
£lf
:
	`g‘VNISŒšg
()

169 .. "„e " .. 
£lf
:
	$g‘Re£rved2SŒšg
()

170 
’d


172 --- 
ResŞve
 
which
 
h—d”
 
comes
 
aá”
 
this
 
	`Úe
 (
š
 
a
 
·ck‘
).

173 --- 
FÜ
 
š¡ªû
: 
š
 
tı
/
udp
 
ba£d
 
Ú
 
the
 
pÜts
.

174 --- 
This
 
funùiÚ
 
mu¡
 
exi¡
 
ªd
 
is
 
Úly
 
u£d
 
wh’
 
g‘
/
dump
 i 
execu‹d
 
Ú


175 --- 
ª
 
	$unknown
 (
mbuf
 
nÙ
 
y‘
 
ÿ¡ed
 
to
 
e
.
g
. 
tıv6
 
·ck‘
è
	`·ck‘
 (mbuf)

176 --- @ 
SŒšg
 
Ãxt
 
	`h—d”
 (
e
.
g
. 'udp', 'icmp', 
n
)

177 
funùiÚ
 
vxÏnH—d”
:
	$»sŞveNextH—d”
()

179 
’d


183 ---- 
M‘©y³s


186 
vxÏn
.
m‘©y³
 = 
vxÏnH—d”


189  
vxÏn


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/stats.lua

1 --- 
IO
 
¡©s
 
deviûs


2 
loÿl
 
	gmod
 = {}

4 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

5 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

6 
loÿl
 
deviû
 = 
»quœe
 "device"

7 
loÿl
 
log
 = 
»quœe
 "log"

8 
loÿl
 
cŞÜs
 = 
»quœe
 "colors"

9 
loÿl
 
ns
 = 
»quœe
 "namespaces"

10 
loÿl
 
pe
 = 
»quœe
 "pipe"

12 
mod
.
sh¬e
 = 
ns
:
	$g‘
()

13 
mod
.
sh¬e
.
	`lock
(
	$funùiÚ
()

14 
mod
.
sh¬e
.
š™Ÿlized
 
th’


16 
’d


17 
mod
.
sh¬e
.
couÁ”Id
 = 0

18 
mod
.
sh¬e
.
pe
 =…e:
	$ÃwSlowPe
()

19 
mod
.
sh¬e
.
š™Ÿlized
 = 
Œue


20 
’d
)

22 
loÿl
 
£rv”Pe
 = 
mod
.
sh¬e
.
pe


25 
funùiÚ
 
mod
.
	$av”age
(
d©a
)

26 
loÿl
 
sum
 = 0

27 
i
, 
v
 
š
 
	$aœs
(
d©a
) do

28 
sum
 = sum + 
v


29 
’d


30  
sum
 / #data

31 
’d


33 
funùiÚ
 
mod
.
	$medŸn
(
d©a
)

34  
mod
.
	$³rûÁe
(
d©a
, 50)

35 
’d


37 
funùiÚ
 
mod
.
	$³rûÁe
(
d©a
, 
p
)

38 
loÿl
 
sÜ‹dD©a
 = { 
	}
}

39 
k
, 
v
 
š
 
	$aœs
(
d©a
) do

40 
sÜ‹dD©a
[
k
] = 
v


41 
’d


42 
bË
.
	$sÜt
(
sÜ‹dD©a
)

43  
sÜ‹dD©a
[
m©h
.
	`û
(#d©¨* 
p
 / 100)]

44 
’d


46 
funùiÚ
 
mod
.
	$¡dDev
(
d©a
)

47 
loÿl
 
avg
 = 
mod
.
	$av”age
(
d©a
)

48 
loÿl
 
sum
 = 0

49 
i
, 
v
 
š
 
	$aœs
(
d©a
) do

50 
sum
 = sum + (
v
 - 
avg
) ^ 2

51 
’d


52  (
sum
 / (#data - 1)) ^ 0.5

53 
’d


55 
funùiÚ
 
mod
.
	$sum
(
d©a
)

56 
loÿl
 
sum
 = 0

57 
i
, 
v
 
š
 
	$aœs
(
d©a
) do

58 
sum
 = sum + 
v


59 
’d


60  
sum


61 
’d


63 
funùiÚ
 
mod
.
	$addSts
(
d©a
, 
ignÜeFœ¡AndLa¡
)

64 
loÿl
 
cİy
 = { 
	}
}

65 
ignÜeFœ¡AndLa¡
 
th’


66 
i
 = 2, #data - 1 do

67 
	gcİy
[
i
 - 1] = 
d©a
[i]

68 
’d


70 
i
 = 1, #data do

71 
	gcİy
[
i
] = 
d©a
[i]

72 
’d


73 
’d


74 
d©a
.
avg
 = 
mod
.
	$av”age
(
cİy
)

75 
d©a
.
¡dDev
 = 
mod
.
	$¡dDev
(
cİy
)

76 
d©a
.
medŸn
 = 
mod
.
	$medŸn
(
cİy
)

77 
d©a
.
sum
 = 
mod
.
	$sum
(
cİy
)

78 
’d


80 
funùiÚ
 
mod
.
	$numCouÁ”s
()

81  
mod
.
sh¬e
.
couÁ”Id


82 
’d


84 
loÿl
 
cŞÜs
 = {

85 
RX
 = "cyan",

86 
TX
 = "blue"

87 
	}
}

88 
loÿl
 
funùiÚ
 
	$g‘PÏšUpd©e
(
dœeùiÚ
)

89  
	$funùiÚ
(
¡©s
, 
fe
, 
tÙ®
, 
mµs
, 
mb™
, 
wœeMb™
)

90 
fe
:
	`wr™e
(("%s[%s] %s%s: %.2àMµs, %.0àMb™/ (%.0àMb™/ w™h f¿mšg)\n"):
	`fÜm©
(

91 
	`g‘CŞÜCode
(
cŞÜs
[
dœeùiÚ
]), 
¡©s
.
Çme
, direction, getColorCode(),

92 
mµs
, 
mb™
, 
wœeMb™


94 
fe
:
	$æush
()

95 
’d


96 
’d


98 
loÿl
 
funùiÚ
 
	$g‘PÏšFš®
(
dœeùiÚ
)

99  
	$funùiÚ
(
¡©s
, 
fe
)

100 
fe
:
	`wr™e
(("%s[%s] %s%s: %.2à(StdDev %.2fèMµs, %.0à(StdDev %.0fèMb™/ (%.0àMb™/ w™h f¿mšg),Ù® %d…ack‘ w™h %d by‹ (šş. CRC)\n"):
	`fÜm©
(

101 
	`g‘CŞÜCode
(
cŞÜs
[
dœeùiÚ
]), 
¡©s
.
Çme
, direction, getColorCode(),

102 
¡©s
.
mµs
.
avg
, sts.mµs.
¡dDev
,

103 
¡©s
.
mb™
.
avg
, sts.mb™.
¡dDev
,

104 
¡©s
.
wœeMb™
.
avg
,

105 
¡©s
.
tÙ®
, sts.
tÙ®By‹s


107 
fe
:
	$æush
()

108 
’d


109 
’d


111 
loÿl
 
h—d”sShown
 = {
	}
}

112 
loÿl
 
funùiÚ
 
	$g‘CsvIn™
(
dœeùiÚ
)

113  
	$funùiÚ
(
¡©s
, 
fe
)

114 
nÙ
 
h—d”sShown
[
fe
] 
th’


115 
h—d”sShown
[
fe
] = 
Œue


116 
fe
:
	`wr™e
("Time,Device,Direction,PacketRate,Mbit,MbitWithFraming,TotalPackets,TotalBytes\n")

117 
’d


118 
’d


119 
’d


121 
loÿl
 
funùiÚ
 
	$g‘CsvUpd©e
(
dœeùiÚ
)

122  
	$funùiÚ
(
¡©s
, 
fe
, 
tÙ®
, 
mµs
, 
mb™
, 
wœeMb™
, 
tÙ®By‹s
)

123 
fe
:
	`wr™e
(("%d,%s,%s,%s,%s,%s,%s,%s\n"):
	`fÜm©
(

124 
	`time
(), 
¡©s
.
Çme
, 
dœeùiÚ
,

125 
mµs
, 
mb™
, 
wœeMb™
,

126 
tÙ®
, 
tÙ®By‹s


128 
fe
:
	$æush
()

129 
’d


130 
’d


132 
loÿl
 
funùiÚ
 
	$g‘CsvFš®
(
dœeùiÚ
)

133  
	$funùiÚ
(
¡©s
, 
fe
)

134 
fe
:
	`wr™e
(("%d,%s,%s,%s,%s,%s,%s,%s\n"):
	`fÜm©
(

135 
	`time
(), 
¡©s
.
Çme
, 
dœeùiÚ
,

136 
¡©s
.
mµs
.
avg
,¡©s.
mb™
.avg, sts.
wœeMb™
.avg,

137 
¡©s
.
tÙ®
, sts.
tÙ®By‹s


139 
fe
:
	$æush
()

140 
’d


141 
’d


143 
loÿl
 
fÜm©‹rs
 = {
	}
}

144 
fÜm©‹rs
["plain"] = {

145 
rxStsIn™
 = 
funùiÚ
(è
’d
, -- 
nÙhšg
 
	g¶aš
, 
	gmachše
-
»adabË
 
fÜm©s
 
ÿn
 
´št
 
a
 
h—d”
 
h”e


146 
	grxStsUpd©e
 = 
g‘PÏšUpd©e
("RX"),

147 
	grxStsFš®
 = 
g‘PÏšFš®
("RX"),

149 
	gtxStsIn™
 = 
funùiÚ
(è
’d
,

150 
	gtxStsUpd©e
 = 
g‘PÏšUpd©e
("TX"),

151 
	gtxStsFš®
 = 
g‘PÏšFš®
("TX"),

154 
	gfÜm©‹rs
["CSV"] = {

155 
rxStsIn™
 = 
g‘CsvIn™
("RX"),

156 
	grxStsUpd©e
 = 
g‘CsvUpd©e
("RX"),

157 
	grxStsFš®
 = 
g‘CsvFš®
("RX"),

159 
	gtxStsIn™
 = 
g‘CsvIn™
("TX"),

160 
	gtxStsUpd©e
 = 
g‘CsvUpd©e
("TX"),

161 
	gtxStsFš®
 = 
g‘CsvFš®
("TX"),

163 
	gfÜm©‹rs
["csv"] = 
fÜm©‹rs
["CSV"]

165 -- 
FÜm©‹r
 
th©
 
dÛs
 
nÙhšg


166 
fÜm©‹rs
["nil"] = {

167 
rxStsIn™
 = 
funùiÚ
(è
’d
,

168 
	grxStsUpd©e
 = 
funùiÚ
(è
’d
,

169 
	grxStsFš®
 = 
funùiÚ
(è
’d
,

171 
	gtxStsIn™
 = 
funùiÚ
(è
’d
,

172 
	gtxStsUpd©e
 = 
funùiÚ
(è
’d
,

173 
	gtxStsFš®
 = 
funùiÚ
 (è
’d
,

177 
loÿl
 
	gİ’Fes
 = {}

179 --- 
ba£
 
cÚ¡ruùÜ
 
rx
 
ªd
 
tx
 
couÁ”s


180 
loÿl
 
funùiÚ
 
	$ÃwCouÁ”
(
ùrTy³
, 
Çme
, 
dev
, 
fÜm©
, 
fe
, 
dœeùiÚ
)

181 
loÿl
 
id


182 
mod
.
sh¬e
.
	`lock
(
	$funùiÚ
()

183 
id
 = 
mod
.
sh¬e
.
couÁ”Id
 + 1

184 
mod
.
sh¬e
.
couÁ”Id
 = 
id


185 
’d
)

186 
Çme
 = 
	$to¡ršg
(
Çme
)

187 
Çme
:
	`sub
(1, 1è=ğ"[" 
ªd
‚ame:sub(#Çme, #Çmeè=ğ"]" 
th’


188 
Çme
 =‚ame:
	`sub
(2, #name - 1)

189 
’d


190 
fÜm©
 = fÜm© 
Ü
 "plain"

191 
fe
 = f
Ü
 
io
.
¡dout


192 
loÿl
 
şo£Fe
 = 
çl£


193 
	`ty³
(
fe
è=ğ"¡ršg" 
th’


194 
loÿl
 
feName
 = 
fe


195 
şo£Fe
 = 
fe


196 
İ’Fes
[
fe
] 
th’


197 
İ’Fes
[
feName
].
»fCouÁ
 = openFiles[fileName].refCount + 1

198 
fe
 = 
İ’Fes
[
feName
].file

200 
fe
 = 
io
.
	`İ’
(file, "w+")

201 
İ’Fes
[
feName
] = {
»fCouÁ
 = 1, 
fe
 = 
	}
file}

202 
’d


203 
’d


204 
nÙ
 
	gfÜm©‹rs
[
fÜm©
] 
th’


205 
	glog
:
çl
("UnsuµÜ‹d ouuˆfÜm© " .. 
fÜm©
)

206 
’d


208 
Çme
 =‚ame,

209 
	gdev
 = 
dev
,

210 
	gfÜm©
 = 
fÜm©
,

211 
	gfe
 = 
fe
,

212 
	gşo£Fe
 = 
şo£Fe
,

213 
	gtÙ®
 = 0,

214 
	gtÙ®By‹s
 = 0,

215 
	gcu¼’t
 = 0,

216 
	gcu¼’tBy‹s
 = 0,

217 
	gmµs
 = {},

218 
	gmb™
 = {},

219 
	gwœeMb™
 = {},

220 
	gid
 = 
id
,

221 
	gdœ
 = 
dœeùiÚ


223 
	g’d


225 -- 
ba£
 
şass
 
rx
 
ªd
 
tx
 
couÁ”s


227 
loÿl
 
funùiÚ
 
	$´štSts
(
£lf
, 
¡©sTy³
, 
ev’t
, ...)

228 
loÿl
 
func
 = 
fÜm©‹rs
[
£lf
.
fÜm©
][
¡©sTy³
 .. 
ev’t
]

229 
func
 
th’


230 
	$func
(
£lf
, s–f.
fe
, ...)

232 
	`´št
("[Missšg fÜm©‹¸fÜ " .. 
£lf
.
fÜm©
 .. "]", s–f.
Çme
, 
¡©sTy³
, 
ev’t
, ...)

233 
’d


234 
’d


236 
loÿl
 
web£rv”


237 
loÿl
 
funùiÚ
 
	$upd©eCouÁ”
(
£lf
, 
time
, 
pkts
, 
by‹s
, 
dÚtPršt
)

238 
nÙ
 
£lf
.
Ï¡Upd©e
 
th’


239 -- 
fœ¡
 
ÿÎ
, 
§ve
 
cu¼’t
 
¡©s
 
but
 dØ
nÙ
 
´št
 
ªythšg


240 
£lf
.
tÙ®
, s–f.
tÙ®By‹s
 = 
pkts
, 
by‹s


241 
£lf
.
Ï¡Upd©e
 = 
time


242 
£lf
:
	`´št
("Init")

243  
çl£


244 
’d


245 
loÿl
 
–­£d
 = 
time
 - 
£lf
.
Ï¡Upd©e


246 
£lf
.
Ï¡Upd©e
 = 
time


247 
loÿl
 
mµs
 = (
pkts
 - 
£lf
.
tÙ®
è/ 
–­£d
 / 10^6

248 
loÿl
 
mb™
 = (
by‹s
 - 
£lf
.
tÙ®By‹s
è/ 
–­£d
 / 10^6 * 8

249 
loÿl
 
wœeR©e
 = 
mb™
 + (
mµs
 * 20 * 8)

250 
£lf
.
tÙ®
 = 
pkts


251 
£lf
.
tÙ®By‹s
 = 
by‹s


252 
nÙ
 
dÚtPršt
 
th’


253 
nÙ
 
web£rv”
 
th’


254 
web£rv”
 = 
»quœe
 "webserver"

255 
’d


256 
web£rv”
.
	$ruÂšg
(è
th’


257 
£rv”Pe
:
£nd
{

258 
id
 = 
£lf
.id, 
Çme
 = s–f.Çme, 
dev
 = s–f.dev 
ªd
 s–f.dev.id, 
dœ
 = self.dir,

259 
·ck‘s
 = 
£lf
.
tÙ®
, 
by‹s
 = s–f.
tÙ®By‹s
,

260 
mµs
 = mµs, 
mb™
 = mb™, 
wœeMb™
 = 
wœeR©e
,

261 
time
 = 
_G
.
	`time
()

262 
	}
}

263 
’d


264 
	g£lf
:
´št
("Upd©e", 
£lf
.
tÙ®
, 
mµs
, 
mb™
, 
wœeR©e
, s–f.
tÙ®By‹s
)

265 
’d


266 
	gbË
.
	$š£¹
(
£lf
.
mµs
, mpps)

267 
bË
.
	$š£¹
(
£lf
.
mb™
, mbit)

268 
bË
.
	$š£¹
(
£lf
.
wœeMb™
, 
wœeR©e
)

269  
Œue


270 
’d


272 
loÿl
 
funùiÚ
 
	$g‘Sts
(
£lf
)

273 
mod
.
	$addSts
(
£lf
.
mµs
, 
Œue
)

274 
mod
.
	$addSts
(
£lf
.
mb™
, 
Œue
)

275 
mod
.
	$addSts
(
£lf
.
wœeMb™
, 
Œue
)

276  
£lf
.
mµs
, s–f.
mb™
, s–f.
wœeMb™
, s–f.
tÙ®
, s–f.
tÙ®By‹s


277 
’d


279 
loÿl
 
funùiÚ
 
	`fš®izeCouÁ”
(
£lf
, 
¦“p
)

280 -- 
wa™
 
ªy
 
»maššg
 
·ck‘s
 
to
 
¬rive
/
be
 
£Á
 
Ãûs§ry


281 
libmoÚ
.
	`¦“pMlis
(
¦“p
)

282 -- 
Ï¡
 
¡©s
 
¬e
 
´obably
 
com¶‘e
 
nÚ£n£
, 
e¥ecŸÎy
 
¦“p
 ~= 0

283 -- 
we
 
ju¡
 dØ
this
 
to
 
g‘
 
the
 
cÜ»ù
 
tÙ®s


284 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

285 
	`upd©eCouÁ”
(
£lf
, 
libmoÚ
.
	`g‘Time
(), 
pkts
, 
by‹s
, 
Œue
)

286 
mod
.
	$addSts
(
£lf
.
mµs
, 
Œue
)

287 
mod
.
	$addSts
(
£lf
.
mb™
, 
Œue
)

288 
mod
.
	$addSts
(
£lf
.
wœeMb™
, 
Œue
)

289 
£lf
:
	`´št
("Final")

290 
£lf
.
şo£Fe
 
th’


291 
loÿl
 
fe
 = 
İ’Fes
[
£lf
.
şo£Fe
]

292 
fe
.
»fCouÁ
 =ğ1 
th’


293 
fe
.fe:
	$şo£
()

295 
fe
.
»fCouÁ
 = file.refCount - 1

296 
’d


297 
’d


298 
’d


301 
loÿl
 
rxCouÁ”
 = {
	}
} -- 
ba£
 
şass


302 
loÿl
 
devRxCouÁ”
 = 
£tm‘©abË
({}, 
rxCouÁ”
)

303 
loÿl
 
	gpktRxCouÁ”
 = 
£tm‘©abË
({}, 
rxCouÁ”
)

304 
loÿl
 
	gmªu®RxCouÁ”
 = 
£tm‘©abË
({}, 
rxCouÁ”
)

305 
	grxCouÁ”
.
	g__šdex
 = 
rxCouÁ”


306 
devRxCouÁ”
.
__šdex
 = devRxCounter

307 
pktRxCouÁ”
.
__šdex
 =…ktRxCounter

308 
mªu®RxCouÁ”
.
__šdex
 = manualRxCounter

310 --- 
C»©e
 
a
 
Ãw
 
rx
 
couÁ”
 
usšg
 
deviû
 
¡©i¡ics
 
»gi¡”s
.

311 --- @
·¿m
 
Çme
 
the
‚am
of
h
couÁ”
, 
šşuded
 
š
h
	gouut
. 
deçuÉs
 
to
h
deviû
 
	gÇme


312 --- @
·¿m
 
dev
 
the
 
deviû
 
to
 
	gŒack


313 --- @
·¿m
 
fÜm©
 
the
 
ouut
 
	gfÜm©
, "CSV" 
	gªd
 "¶aš" (è
¬e
 
cu¼’y
 
	gsuµÜ‹d


314 --- @
·¿m
 
fe
 
the
 
ouut
 
	gfe
, 
deçuÉs
 
to
 
¡ªd¬d
 
out


315 
funùiÚ
 
	gmod
:
	$ÃwDevRxCouÁ”
(
Çme
, 
dev
, 
fÜm©
, 
fe
)

316 
	`ty³
(
Çme
è=ğ"bË" 
th’


317  
£lf
:
	$ÃwDevRxCouÁ”
(
n
, 
Çme
, 
dev
, 
fÜm©
)

318 
’d


319 -- 
u£
 
deviû
 
queue
 
objeùs
 
¬e
 
·s£d


320 
dev
 = dev 
ªd
 dev.dev 
Ü
 dev

321 
	`ty³
(
dev
è~ğ"bË" 
th’


322 
log
:
	`çl
("Bad device")

323 
’d


324 
Çme
 =‚am
Ü
 
	$to¡ršg
(
dev
):
	`sub
(2, -2è-- 
¡r
 
b¿ck‘s
 
as
 
they
 
¬e
 
added
 
by
 
the
 '¶aš' 
ouut
 
agaš


325 
loÿl
 
obj
 = 
	`ÃwCouÁ”
("dev", 
Çme
, 
dev
, 
fÜm©
, 
fe
, "rx")

326 
obj
.
¦“p
 = 100

327 
	$£tm‘©abË
(
obj
, 
devRxCouÁ”
)

328 
obj
:
	`ş—rThroughput
(è-- 
»£t
 
¡©s
 
Ú
 
the
 
NIC


329  
obj


330 
’d


332 --- 
C»©e
 
a
 
Ãw
 
rx
 
couÁ”
 
th©
 
ÿn
 
be
 
upd©ed
 
by
 
·ssšg
 
·ck‘
 
bufãrs
 
to
 
™
.

333 --- @
·¿m
 
Çme
 
the
‚am
of
h
couÁ”
, 
šşuded
 
š
h
ouut


334 --- @
·¿m
 
fÜm©
 
the
 
ouut
 fÜm©, "CSV" 
ªd
 "¶aš" (è
¬e
 
cu¼’y
 
suµÜ‹d


335 --- @
·¿m
 
fe
 
the
 
ouut
 fe, 
deçuÉs
 
to
 
¡ªd¬d
 
out


336 
funùiÚ
 
mod
:
	$ÃwPktRxCouÁ”
(
Çme
, 
fÜm©
, 
fe
)

337 
loÿl
 
obj
 = 
	`ÃwCouÁ”
("pkt", 
Çme
, 
n
, 
fÜm©
, 
fe
, "rx")

338  
	$£tm‘©abË
(
obj
, 
pktRxCouÁ”
)

339 
’d


341 --- 
C»©e
 
a
 
Ãw
 
rx
 
couÁ”
 
th©
 
has
 
to
 
be
 
upd©ed
 
mªu®ly
.

342 --- @
·¿m
 
Çme
 
the
‚am
of
h
couÁ”
, 
šşuded
 
š
h
ouut


343 --- @
·¿m
 
fÜm©
 
the
 
ouut
 fÜm©, "CSV" 
ªd
 "¶aš" (è
¬e
 
cu¼’y
 
suµÜ‹d


344 --- @
·¿m
 
fe
 
the
 
ouut
 fe, 
deçuÉs
 
to
 
¡ªd¬d
 
out


345 
funùiÚ
 
mod
:
	$ÃwMªu®RxCouÁ”
(
Çme
, 
fÜm©
, 
fe
)

346 
loÿl
 
obj
 = 
	`ÃwCouÁ”
("mªu®", 
Çme
, 
n
, 
fÜm©
, 
fe
, "rx")

347  
	$£tm‘©abË
(
obj
, 
mªu®RxCouÁ”
)

348 
’d


350 --- 
Ba£
 
şass


351 
funùiÚ
 
rxCouÁ”
:
	$fš®ize
(
¦“p
)

352 
	$fš®izeCouÁ”
(
£lf
, 
¦“p
 
Ü
 self.sleep or 0)

353 
’d


355 
funùiÚ
 
rxCouÁ”
:
	$´št
(
ev’t
, ...)

356 
	`´štSts
(
£lf
, "rxSts", 
ev’t
, ...)

357 
’d


359 
funùiÚ
 
rxCouÁ”
:
	$upd©e
()

360 
loÿl
 
time
 = 
libmoÚ
.
	$g‘Time
()

361 
£lf
.
Ï¡Upd©e
 
ªd
 
time
 <ğ£lf.Ï¡Upd©+ 1 
th’


362  
çl£


363 
’d


364 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

365  
	$upd©eCouÁ”
(
£lf
, 
time
, 
pkts
, 
by‹s
)

366 
’d


368 --- 
G‘
 
accumuÏ‹d
 
¡©i¡ics
.

369 --- 
C®cuÏ‹
 
the
 
av”age
 
throughput
.

370 
funùiÚ
 
rxCouÁ”
:
	$g‘Sts
(
fÜûUpd©e
)

371 
fÜûUpd©e
 
th’


372 -- 
fÜû
 
ª
 
upd©e


373 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

374 
	`upd©eCouÁ”
(
£lf
, 
libmoÚ
.
	`g‘Time
(), 
pkts
, 
by‹s
, 
Œue
)

375 
’d


376  
	$g‘Sts
(
£lf
)

377 
’d


379 --- 
Deviû
-
ba£d
 
couÁ”


380 
funùiÚ
 
devRxCouÁ”
:
	$g‘Throughput
()

381  
£lf
.
dev
:
	$g‘RxSts
()

382 
’d


384 
funùiÚ
 
devRxCouÁ”
:
	$ş—rThroughput
()

385  
£lf
.
dev
:
	$ş—rRxSts
()

386 
’d


388 --- 
Pack‘
-
ba£d
 
couÁ”


389 
funùiÚ
 
pktRxCouÁ”
:
	$couÁPack‘
(
buf
)

390 
£lf
.
cu¼’t
 = self.current + 1

391 
£lf
.
cu¼’tBy‹s
 = s–f.cu¼’tBy‹ + 
buf
.
pkt_Ën
 + 4 -- 
šşude
 
CRC


392 
’d


394 
funùiÚ
 
pktRxCouÁ”
:
	$g‘Throughput
()

395 
loÿl
 
pkts
, 
by‹s
 = 
£lf
.
cu¼’t
, s–f.
cu¼’tBy‹s


396  
pkts
, 
by‹s


397 
’d


400 --- 
Mªu®
 
rx
 
couÁ”


401 
funùiÚ
 
mªu®RxCouÁ”
:
	$upd©e
(
pkts
, 
by‹s
)

402 
£lf
.
cu¼’t
 = s–f.cu¼’ˆ+ 
pkts


403 
£lf
.
cu¼’tBy‹s
 = s–f.cu¼’tBy‹ + 
by‹s


404 
loÿl
 
time
 = 
libmoÚ
.
	$g‘Time
()

405 
£lf
.
Ï¡Upd©e
 
ªd
 
time
 <ğ£lf.Ï¡Upd©+ 1 
th’


406  
çl£


407 
’d


408 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

409  
	$upd©eCouÁ”
(
£lf
, 
time
, 
pkts
, 
by‹s
)

410 
’d


412 
funùiÚ
 
mªu®RxCouÁ”
:
	$g‘Throughput
()

413 
loÿl
 
pkts
, 
by‹s
 = 
£lf
.
cu¼’t
, s–f.
cu¼’tBy‹s


414  
pkts
, 
by‹s


415 
’d


417 
funùiÚ
 
mªu®RxCouÁ”
:
	$upd©eW™hSize
(
pkts
, 
size
)

418 
£lf
.
cu¼’t
 = s–f.cu¼’ˆ+ 
pkts


419 
£lf
.
cu¼’tBy‹s
 = s–f.cu¼’tBy‹ + 
pkts
 * (
size
 + 4)

420 
loÿl
 
time
 = 
libmoÚ
.
	$g‘Time
()

421 
£lf
.
Ï¡Upd©e
 
ªd
 
time
 <ğ£lf.Ï¡Upd©+ 1 
th’


422  
çl£


423 
’d


424 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

425  
	$upd©eCouÁ”
(
£lf
, 
time
, 
pkts
, 
by‹s
)

426 
’d


429 
loÿl
 
txCouÁ”
 = {
	}
} -- 
ba£
 
şass
 
tx
 
couÁ”s


430 
loÿl
 
devTxCouÁ”
 = 
£tm‘©abË
({}, 
txCouÁ”
)

431 
loÿl
 
	gpktTxCouÁ”
 = 
£tm‘©abË
({}, 
txCouÁ”
)

432 
loÿl
 
	gmªu®TxCouÁ”
 = 
£tm‘©abË
({}, 
txCouÁ”
)

433 
	gtxCouÁ”
.
	g__šdex
 = 
txCouÁ”


434 
devTxCouÁ”
.
__šdex
 = devTxCounter

435 
pktTxCouÁ”
.
__šdex
 =…ktTxCounter

436 
mªu®TxCouÁ”
.
__šdex
 = manualTxCounter

438 --- 
C»©e
 
a
 
Ãw
 
tx
 
couÁ”
 
usšg
 
deviû
 
¡©i¡ics
 
»gi¡”s
.

439 --- @
·¿m
 
Çme
 
the
‚am
of
h
couÁ”
, 
šşuded
 
š
h
	gouut
. 
deçuÉs
 
to
h
deviû
 
	gÇme


440 --- @
·¿m
 
dev
 
the
 
deviû
 
to
 
	gŒack


441 --- @
·¿m
 
fÜm©
 
the
 
ouut
 
	gfÜm©
, "CSV" 
	gªd
 "¶aš" (è
¬e
 
cu¼’y
 
	gsuµÜ‹d


442 --- @
·¿m
 
fe
 
the
 
ouut
 
	gfe
, 
deçuÉs
 
to
 
¡ªd¬d
 
out


443 
funùiÚ
 
	gmod
:
	$ÃwDevTxCouÁ”
(
Çme
, 
dev
, 
fÜm©
, 
fe
)

444 
	`ty³
(
Çme
è=ğ"bË" 
th’


445  
£lf
:
	$ÃwDevTxCouÁ”
(
n
, 
Çme
, 
dev
, 
fÜm©
)

446 
’d


447 -- 
u£
 
deviû
 
queue
 
objeùs
 
¬e
 
·s£d


448 
dev
 = dev 
ªd
 dev.dev 
Ü
 dev

449 
	`ty³
(
dev
è~ğ"bË" 
th’


450 
log
:
	`çl
("Bad device")

451 
’d


452 
Çme
 =‚am
Ü
 
	$to¡ršg
(
dev
):
	`sub
(2, -2è-- 
¡r
 
b¿ck‘s
 
as
 
they
 
¬e
 
added
 
by
 
the
 '¶aš' 
ouut
 
agaš


453 
loÿl
 
obj
 = 
	`ÃwCouÁ”
("dev", 
Çme
, 
dev
, 
fÜm©
, 
fe
, "tx")

454 
obj
.
¦“p
 = 50

455 
	$£tm‘©abË
(
obj
, 
devTxCouÁ”
)

456 
obj
:
	`g‘Throughput
(è-- 
»£t
 
¡©s
 
Ú
 
the
 
NIC


457  
obj


458 
’d


460 --- 
C»©e
 
a
 
Ãw
 
tx
 
couÁ”
 
th©
 
ÿn
 
be
 
upd©ed
 
by
 
·ssšg
 
·ck‘
 
bufãrs
 
to
 
™
.

461 --- @
·¿m
 
Çme
 
the
‚am
of
h
couÁ”
, 
šşuded
 
š
h
ouut


462 --- @
·¿m
 
fÜm©
 
the
 
ouut
 fÜm©, "CSV" 
ªd
 "¶aš" (è
¬e
 
cu¼’y
 
suµÜ‹d


463 --- @
·¿m
 
fe
 
the
 
ouut
 fe, 
deçuÉs
 
to
 
¡ªd¬d
 
out


464 
funùiÚ
 
mod
:
	$ÃwPktTxCouÁ”
(
Çme
, 
fÜm©
, 
fe
)

465 
loÿl
 
obj
 = 
	`ÃwCouÁ”
("pkt", 
Çme
, 
n
, 
fÜm©
, 
fe
, "tx")

466  
	$£tm‘©abË
(
obj
, 
pktTxCouÁ”
)

467 
’d


469 --- 
C»©e
 
a
 
Ãw
 
tx
 
couÁ”
 
th©
 
has
 
to
 
be
 
upd©ed
 
mªu®ly
.

470 --- @
·¿m
 
Çme
 
the
‚am
of
h
couÁ”
, 
šşuded
 
š
h
ouut


471 --- @
·¿m
 
fÜm©
 
the
 
ouut
 fÜm©, "CSV" 
ªd
 "¶aš" (è
¬e
 
cu¼’y
 
suµÜ‹d


472 --- @
·¿m
 
fe
 
the
 
ouut
 fe, 
deçuÉs
 
to
 
¡ªd¬d
 
out


473 
funùiÚ
 
mod
:
	$ÃwMªu®TxCouÁ”
(
Çme
, 
fÜm©
, 
fe
)

474 
loÿl
 
obj
 = 
	`ÃwCouÁ”
("mªu®", 
Çme
, 
n
, 
fÜm©
, 
fe
, "tx")

475  
	$£tm‘©abË
(
obj
, 
mªu®TxCouÁ”
)

476 
’d


478 --- 
Ba£
 
şass


479 
funùiÚ
 
txCouÁ”
:
	$fš®ize
(
¦“p
)

480 
	$fš®izeCouÁ”
(
£lf
, 
¦“p
 
Ü
 self.sleep or 0)

481 
’d


483 
funùiÚ
 
txCouÁ”
:
	$´št
(
ev’t
, ...)

484 
	`´štSts
(
£lf
, "txSts", 
ev’t
, ...)

485 
’d


487 --- 
Deviû
-
ba£d
 
couÁ”


488 
funùiÚ
 
txCouÁ”
:
	$upd©e
()

489 
loÿl
 
time
 = 
libmoÚ
.
	$g‘Time
()

490 
£lf
.
Ï¡Upd©e
 
ªd
 
time
 <ğ£lf.Ï¡Upd©+ 1 
th’


491  
çl£


492 
’d


493 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

494  
	$upd©eCouÁ”
(
£lf
, 
time
, 
pkts
, 
by‹s
)

495 
’d


497 --- 
G‘
 
accumuÏ‹d
 
¡©i¡ics
.

498 --- 
C®cuÏ‹
 
the
 
av”age
 
throughput
.

499 
funùiÚ
 
txCouÁ”
:
	$g‘Sts
(
fÜûUpd©e
)

500 
fÜûUpd©e
 
th’


501 -- 
fÜû
 
ª
 
upd©e


502 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

503 
	`upd©eCouÁ”
(
£lf
, 
libmoÚ
.
	`g‘Time
(), 
pkts
, 
by‹s
, 
Œue
)

504 
’d


505  
	$g‘Sts
(
£lf
)

506 
’d


508 
funùiÚ
 
devTxCouÁ”
:
	$g‘Throughput
()

509  
£lf
.
dev
:
	$g‘TxSts
()

510 
’d


512 --- 
Pack‘
-
ba£d
 
couÁ”


513 
funùiÚ
 
pktTxCouÁ”
:
	$couÁPack‘
(
buf
)

514 
£lf
.
cu¼’t
 = self.current + 1

515 
£lf
.
cu¼’tBy‹s
 = s–f.cu¼’tBy‹ + 
buf
.
pkt_Ën
 + 4 -- 
šşude
 
CRC


516 
’d


518 
funùiÚ
 
pktTxCouÁ”
:
	$g‘Throughput
()

519 
loÿl
 
pkts
, 
by‹s
 = 
£lf
.
cu¼’t
, s–f.
cu¼’tBy‹s


520  
pkts
, 
by‹s


521 
’d


523 --- 
Mªu®
 
rx
 
couÁ”


524 
funùiÚ
 
mªu®TxCouÁ”
:
	$upd©e
(
pkts
, 
by‹s
)

525 
£lf
.
cu¼’t
 = s–f.cu¼’ˆ+ 
pkts


526 
£lf
.
cu¼’tBy‹s
 = s–f.cu¼’tBy‹ + 
by‹s


527 
loÿl
 
time
 = 
libmoÚ
.
	$g‘Time
()

528 
£lf
.
Ï¡Upd©e
 
ªd
 
time
 <ğ£lf.Ï¡Upd©+ 1 
th’


529  
çl£


530 
’d


531 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

532  
	$upd©eCouÁ”
(
£lf
, 
time
, 
pkts
, 
by‹s
)

533 
’d


535 
funùiÚ
 
mªu®TxCouÁ”
:
	$upd©eW™hSize
(
pkts
, 
size
)

536 
£lf
.
cu¼’t
 = s–f.cu¼’ˆ+ 
pkts


537 
£lf
.
cu¼’tBy‹s
 = s–f.cu¼’tBy‹ + 
pkts
 * (
size
 + 4)

538 
loÿl
 
time
 = 
libmoÚ
.
	$g‘Time
()

539 
£lf
.
Ï¡Upd©e
 
ªd
 
time
 <ğ£lf.Ï¡Upd©+ 1 
th’


540  
çl£


541 
’d


542 
loÿl
 
pkts
, 
by‹s
 = 
£lf
:
	$g‘Throughput
()

543  
	$upd©eCouÁ”
(
£lf
, 
time
, 
pkts
, 
by‹s
)

544 
’d


546 
funùiÚ
 
mªu®TxCouÁ”
:
	$g‘Throughput
()

547 
loÿl
 
pkts
, 
by‹s
 = 
£lf
.
cu¼’t
, s–f.
cu¼’tBy‹s


548  
pkts
, 
by‹s


549 
’d


551 --- 
S¹
 
a
 
sh¬ed
 
sk
 
th©
 
couÁs
 
¡©i¡ics


552 --- @
·¿m
 
¬gs
 
¬gum’ts
 
as
 
bË


553 --- 
deviûs
: 
li¡
 
of
 deviû 
to
 
Œack
 
bÙh
 
rx
 
ªd
 
tx
 
¡©s


554 --- 
rxDeviûs
: 
li¡
 
of
 
deviûs
 
to
 
Œack
 
rx
 
¡©s


555 --- 
txDeviûs
: 
li¡
 
of
 
deviûs
 
to
 
Œack
 
tx
 
¡©s


556 --- 
fÜm©
: 
ouut
 fÜm©, 
cf
. 
¡©s
 
Œackšg
 
docum’tiÚ
, : 
¶aš


557 --- 
fe
: f
to
 
wr™e
o, : 
¡dout


558 --- 
A
 
deviû
 
is
 
e™h”
 
a
 
nÜm®
 deviû 
objeù
 
Ü
 
ª
 
bË
 
w™h
 
the
 
f›lds
 
dev
, 
fÜm©
, 
ªd
 
fe
.

559 --- 
AÉ”Çtive
 
mode
: 
ju¡
 
the
 
deviûs
 
as
 
ª
 
¬¿y
 
you
 
Úly
 
wªt
 
rx
 
ªd
 
tx
 
¡©s
 
w™h
  
£‰šgs


560 
funùiÚ
 
mod
.
	$¡¬tStsTask
(
¬gs
)

561 
¬gs
.
deviûs
 =‡rgs.deviû 
Ü
 {
	}
}

562 
¬gs
.
rxDeviûs
 =‡rgs.rxDeviû 
Ü
 {}

563 
¬gs
.
txDeviûs
 =‡rgs.txDeviû 
Ü
 {}

564 #¬gs.
deviûs
 =ğ0 
ªd
 #¬gs.
rxDeviûs
 =ğ0‡nd #¬gs.
txDeviûs
 =ğ0 
th’


565 
i
, 
v
 
š
 
	$aœs
(
¬gs
) do

566 
¬gs
.
deviûs
[
i
] = 
v


567 
’d


568 
’d


569 
libmoÚ
.
	`¡¬tSh¬edTask
("__LIBMOON_STATS_TASK", 
¬gs
)

570 
’d


572 
loÿl
 
funùiÚ
 
	$»moveDu¶iÿ‹s
(
tbl
)

573 
loÿl
 
£’
 = {
	}
}

574 
i
 = #tbl, 1, -1 do

575 
loÿl
 
	gid
 = 
tbl
[
i
].
id
 
Ü
bl[i].
dev
.id

576 
£’
[
id
] 
th’


577 
bË
.
	$»move
(
tbl
, 
i
)

578 
’d


579 
£’
[
id
] = 
Œue


580 
’d


581 
’d


583 
loÿl
 
funùiÚ
 
	$¡©sTask
(
¬gs
)

584 
loÿl
 
couÁ”s
 = {
	}
}

585 
i
, 
v
 
š
 
	$aœs
(
¬gs
.
deviûs
) do

586 
bË
.
	$š£¹
(
¬gs
.
rxDeviûs
, 
v
)

587 
bË
.
	$š£¹
(
¬gs
.
txDeviûs
, 
v
)

588 
’d


589 
	$»moveDu¶iÿ‹s
(
¬gs
.
rxDeviûs
)

590 
	$»moveDu¶iÿ‹s
(
¬gs
.
txDeviûs
)

591 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
rxDeviûs
) do

592 
loÿl
 
fÜm©
 = 
¬gs
.format

593 
loÿl
 
fe
 = 
¬gs
.file

594 
nÙ
 
dev
.
id
 
th’


595 
fÜm©
 = 
dev
.format

596 
fe
 = 
dev
.file

597 
dev
 = dev.dev

598 
’d


599 
bË
.
	`š£¹
(
couÁ”s
, 
mod
:
	$ÃwDevRxCouÁ”
(
dev
, 
fÜm©
, 
fe
))

600 
’d


601 
i
, 
dev
 
š
 
	$aœs
(
¬gs
.
txDeviûs
) do

602 
loÿl
 
fÜm©
 = 
¬gs
.format

603 
loÿl
 
fe
 = 
¬gs
.file

604 
nÙ
 
dev
.
id
 
th’


605 
fÜm©
 = 
dev
.format

606 
fe
 = 
dev
.file

607 
dev
 = dev.dev

608 
’d


609 
bË
.
	`š£¹
(
couÁ”s
, 
mod
:
	$ÃwDevTxCouÁ”
(
dev
, 
fÜm©
, 
fe
))

610 
’d


611 
libmoÚ
.
	$ruÂšg
(200) do

612 
i
, 
ùr
 
š
 
	$aœs
(
couÁ”s
) do

613 
ùr
:
	$upd©e
()

614 
’d


615 
libmoÚ
.
	$¦“pMlisIdË
(10)

616 
’d


617 
i
, 
ùr
 
š
 
	$aœs
(
couÁ”s
) do

618 
ùr
:
	$fš®ize
(0)

619 
’d


620 
’d


622 
__LIBMOON_STATS_TASK
 = 
¡©sTask


624  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/timer.lua

1 --- 
Sim¶e
 
tim”
 
	gşass
.

3 
loÿl
 
	gmod
 = {}

5 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

7 
loÿl
 
tim”
 = {}

8 
tim”
.
__šdex
 =imer

10 
funùiÚ
 
mod
:
	$Ãw
(
time
)

11  
	`£tm‘©abË
({

12 
time
 =im
Ü
 0,

13 
¡İ
 = 
libmoÚ
.
	`g‘Time
(è+ (
time
 
Ü
 0)

14 
	}
}, 
	gtim”
)

15 
’d


17 
funùiÚ
 
	gtim”
:
	$ruÂšg
()

18  
£lf
.
¡İ
 > 
libmoÚ
.
	$g‘Time
()

19 
’d


21 
funùiÚ
 
tim”
:
	$expœed
()

22  
£lf
.
¡İ
 <ğ
libmoÚ
.
	$g‘Time
()

23 
’d


25 
funùiÚ
 
tim”
:
	$timeLeá
()

26  
£lf
.
¡İ
 - 
libmoÚ
.
	$g‘Time
()

27 
’d


29 
funùiÚ
 
tim”
:
	$»£t
(
time
)

30 
£lf
.
¡İ
 = 
libmoÚ
.
	`g‘Time
(è+ (
time
 
Ü
 self.time)

31 
’d


33 --- 
P”fÜm
 
a
 
busy
 
wa™
 
Ú
 
the
 
tim”
.

34 -- 
R‘uºs
 
—¾y
 
libmoÚ
 
is
 
	`¡İ³d
 (libmoÚ.
	`ruÂšg
(è=ğ
çl£
).

35 
funùiÚ
 
tim”
:
	$busyWa™
()

36 
nÙ
 
£lf
:
	$expœed
(è
ªd
 
libmoÚ
.
	$ruÂšg
() do

37 
’d


38  
libmoÚ
.
	$ruÂšg
()

39 
’d


41 --- 
P”fÜm
 
a
 
nÚ
-
busy
 
wa™
 
Ú
 
the
 
tim”
.

42 --- 
Might
 
be
 
Ëss
 
accu¿‹
 
thª
 
	$busyWa™
()

43 
funùiÚ
 
tim”
:
	`wa™
()

44 -- 
TODO
: 
im¶em’t


45  
£lf
:
	$busyWa™
()

46 
’d


48  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/timestamping.lua

1 --- 
H¬dw¬e
 
	gtime¡ampšg
.

2 
loÿl
 
	gmod
 = {}

4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

5 
loÿl
 
dpdkc
 = 
»quœe
 "dpdkc"

6 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

7 
loÿl
 
deviû
 = 
»quœe
 "device"

8 
loÿl
 
‘h
 = 
»quœe
 "proto.ethernet"

9 
loÿl
 
memÜy
 = 
»quœe
 "memory"

10 
loÿl
 
tim”
 = 
»quœe
 "timer"

11 
loÿl
 
log
 = 
»quœe
 "log"

12 
loÿl
 
f‹r
 = 
»quœe
 "filter"

13 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

15 
loÿl
 
time¡am³r
 = {}

16 
time¡am³r
.
__šdex
 =imestamper

18 --- 
C»©e
 
a
 
Ãw
 
time¡am³r
.

19 --- 
A
 
NIC
 
ÿn
 
Úly
 
be
 
u£d
 
by
 
Úe
 
th»ad
 
©
 
a
 
time
 
due
 
to
 
şock
 
synchrÚiz©iÚ
.

20 --- 
Be¡
 
cu¼’t
 
´©iû
 
is
 
to
 
u£
 
Úly
 
Úe
 
time¡ampšg
 
th»ad
Ø
avoid
 
´obËms
.

21 
funùiÚ
 
mod
:
	$ÃwTime¡am³r
(
txQueue
, 
rxQueue
, 
mem
, 
udp
, 
doNÙCÚfigu»UdpPÜt
)

22 
mem
 = mem 
Ü
 
memÜy
.
	`ü—‹MemPoŞ
(
	`funùiÚ
(
buf
)

23 -- 
deçuÉs
 
¬e
 
good
 
’ough
 
us
 
h”e


24 
udp
 
th’


25 
buf
:
	$g‘UdpPPack‘
():
fl
{

26 
‘hSrc
 = 
txQueue
,

27 
	}
}

29 
	gbuf
:
	$g‘PPack‘
():
fl
{

30 
‘hSrc
 = 
txQueue
,

31 
	}
}

32 
’d


33 
	g’d
)

34 
	gtxQueue
:
	$’abËTime¡amps
()

35 
rxQueue
:
	$’abËTime¡amps
()

36 
udp
 
ªd
 
rxQueue
.
dev
.
suµÜtsFdœ
 
th’


37 
rxQueue
:
	$f‹rUdpTime¡amps
()

38 
–£if
 
nÙ
 
udp
 
th’


39 
rxQueue
:
	$f‹rL2Time¡amps
()

40 
’d


41  
	`£tm‘©abË
({

42 
mem
 = mem,

43 
txBufs
 = 
mem
:
	`bufA¼ay
(1),

44 
rxBufs
 = 
mem
:
	`bufA¼ay
(128),

45 
txQueue
 =xQueue,

46 
rxQueue
 =„xQueue,

47 
txDev
 = 
txQueue
.
dev
,

48 
rxDev
 = 
rxQueue
.
dev
,

49 
£q
 = 1,

50 
udp
 = udp,

51 
u£Timesync
 = 
rxQueue
.
dev
.
u£TimsyncIds
,

52 
doNÙCÚfigu»UdpPÜt
 = doNotConfigureUdpPort

53 
	}
}, 
	gtime¡am³r
)

54 
	g’d


56 --- 
S“
 
	$ÃwTime¡am³r
()

57 
funùiÚ
 
mod
:
	$ÃwUdpTime¡am³r
(
txQueue
, 
rxQueue
, 
mem
, 
doNÙCÚfigu»UdpPÜt
)

58  
£lf
:
	$ÃwTime¡am³r
(
txQueue
, 
rxQueue
, 
mem
, 
Œue
, 
doNÙCÚfigu»UdpPÜt
)

59 
’d


61 --- 
Try
 
to
 
m—su»
 
the
 
Ï‹ncy
 
of
 
a
 
sšgË
 
·ck‘
.

62 --- @
·¿m
 
pktSize
 
İtiÚ®
, 
the
 
size
 
of
h
g’”©ed
 
·ck‘
, o±iÚ®, 
deçuÉs
 
to
h
sm®Ë¡
 
possibË
 size

63 --- @
·¿m
 
·ck‘Modif›r
 
İtiÚ®
, 
a
 
funùiÚ
 
th©
 
is
 
ÿÎed
 
w™h
 
the
 
g’”©ed
 
·ck‘
, 
e
.
g
. 
to
 
modif›d
 
add»s£s


64 --- @
·¿m
 
maxWa™
 
	$İtiÚ®
 (
ÿÂÙ
 
be
 
the
 
Úly
 
¬gum’t
èth
time
 
š
 
ms
 
to
 
wa™
 
befÜe
h
·ck‘
 
is
 
assumed
Øb
	$lo¡
 ( = 15)

65 
funùiÚ
 
time¡am³r
:
	$m—su»L©’cy
(
pktSize
, 
·ck‘Modif›r
, 
maxWa™
)

66 
	`ty³
(
pktSize
è=ğ"funùiÚ" 
th’
 -- 
İtiÚ®
 
fœ¡
 
¬gum’t
 
was
 
sk³d


67  
£lf
:
	$m—su»L©’cy
(
n
, 
pktSize
, 
·ck‘Modif›r
)

68 
’d


69 
pktSize
 =…ktSiz
Ü
 
£lf
.
udp
 
ªd
 76 or 60

70 
maxWa™
 = (maxWa™ 
Ü
 15) / 1000

71 
£lf
.
txBufs
:
	$®loc
(
pktSize
)

72 
loÿl
 
buf
 = 
£lf
.
txBufs
[1]

73 
buf
:
	$’abËTime¡amps
()

74 
loÿl
 
ex³ùedSeq
 = 
£lf
.
£q


75 
£lf
.
£q
 = (self.seq + 1) % 2^16

76 
£lf
.
udp
 
th’


77 
buf
:
	`g‘UdpPPack‘
().
±p
:
	$£tSequ’ûID
(
ex³ùedSeq
)

79 
buf
:
	`g‘PPack‘
().
±p
:
	$£tSequ’ûID
(
ex³ùedSeq
)

80 
’d


81 
loÿl
 
skRecÚfigu»


82 
·ck‘Modif›r
 
th’


83 
skRecÚfigu»
 = 
	$·ck‘Modif›r
(
buf
)

84 
’d


85 
£lf
.
udp
 
th’


86 
nÙ
 
£lf
.
doNÙCÚfigu»UdpPÜt
 
th’


87 -- 
chªge
 
time¡am³d
 
UDP
 
pÜt
 
as
 
—ch
 
·ck‘
 
may
 
be
 
Ú
 
a
 
difã»Á
…ort

88 
£lf
.
rxQueue
:
	`’abËTime¡amps
(
buf
:
	`g‘UdpPack‘
().
udp
:
	$g‘D¡PÜt
())

89 
’d


90 
buf
:
	$g‘UdpPPack‘
():
	$£tL’gth
(
pktSize
)

91 
£lf
.
txBufs
:
	$ofæßdUdpChecksums
()

92 
£lf
.
rxQueue
.
dev
.
»cÚfigu»UdpTime¡ampF‹r
 
ªd
 
nÙ
 
skRecÚfigu»
 
th’


93 -- 
i40e
 
driv”
 
fdœ
 
f‹rs
 
¬e
 
brok’


94 -- 
™
 
is
 
nÙ
 
possibË
 
to
 
m©ch
 
Ú
 
æex
 
by‹s
 
š
 
udp
 
·ck‘s
 
w™hout
 
m©chšg
 
IPs
 
ªd
 
pÜts
 
as
 
w–l


95 -- 
so
 
we
 
have
 
to
 
look
 
©
 
th©
 
·ck‘
 
ªd
 
»cÚfigu»
 
the
 
f‹rs


96 
£lf
.
rxQueue
.
dev
:
	`»cÚfigu»UdpTime¡ampF‹r
(£lf.rxQueue, 
buf
:
	$g‘UdpPack‘
())

97 
’d


98 
’d


99 
mod
.
	`syncClocks
(
£lf
.
txDev
, s–f.
rxDev
)

100 -- 
ş—r
 
ªy
 "Ëáov”" 
time¡amps


101 
£lf
.
rxDev
:
	$ş—rTime¡amps
()

102 
£lf
.
txQueue
:
	$£nd
(
£lf
.
txBufs
)

103 
loÿl
 
tx
 = 
£lf
.
txQueue
:
	$g‘Time¡amp
(500)

104 
loÿl
 
numPkts
 = 0

105 
tx
 
th’


106 -- 
£Á
 
was
 
sucûssful
, 
Œy
 
to
 
g‘
 
the
 
·ck‘
 
	$back
 (
assume
 
th©
 
™
 
is
 
lo¡
 
aá”
 
a
 
giv’
 
d–ay
)

107 
loÿl
 
tim”
 =im”:
	$Ãw
(
maxWa™
)

108 
tim”
:
	$ruÂšg
() do

109 
loÿl
 
rx
 = 
£lf
.
rxQueue
:
	$ŒyRecv
(
£lf
.
rxBufs
, 1000)

110 
numPkts
 =‚umPkt + 
rx


111 
loÿl
 
time¡am³dPkt
 = 
£lf
.
rxDev
:
	$hasRxTime¡amp
()

112 
nÙ
 
time¡am³dPkt
 
th’


113 -- 
NIC
 
didn
't save‡imestamp yet, justhrow‡wayhe…ackets

114 
£lf
.
rxBufs
:
	$ä“AÎ
()

116 -- 
»ûived
 
a
 
time¡am³d
 
	$·ck‘
 (
nÙ
 
Ãûs§ry
 
š
 
this
 
b©ch
)

117 
i
 = 1, 
rx
 do

118 
loÿl
 
buf
 = 
£lf
.
rxBufs
[
i
]

119 
loÿl
 
timesync
 = 
£lf
.
u£Timesync
 
ªd
 
buf
:
	$g‘Timesync
(è
Ü
 0

120 
loÿl
 
£q
 = (
£lf
.
udp
 
ªd
 
buf
:
	$g‘UdpPPack‘
(è
Ü
 
buf
:
	`g‘PPack‘
()).
±p
:
	$g‘Sequ’ûID
()

121 
buf
:
	$hasTime¡amp
(è
ªd
 
£q
 =ğ
ex³ùedSeq
 
	`ªd
 (£q =ğ
time¡am³dPkt
 
Ü
ime¡am³dPkˆ=ğ-1è
th’


122 -- 
yay
!

123 
loÿl
 
rxTs
 = 
£lf
.
rxQueue
:
	$g‘Time¡amp
(
n
, 
timesync
)

124 
nÙ
 
rxTs
 
th’


125 -- 
ÿn
 
h­³n
 
you
 
hÙ¶ug
 
ÿbËs


126  
n
, 
numPkts


127 
’d


128 
£lf
.
rxBufs
:
	$ä“AÎ
()

129 
loÿl
 
Ït
 = 
rxTs
 - 
tx


130 -- 
loÿl
 
Ït
 = 
tx


131 
Ït
 > 0 
ªd
†© < 2 * 
maxWa™
 * 10^9 
th’


132 -- 
Ãg©ive
 
Ï‹nc›s
 
may
 
h­³n
 
the
 
lšk
 
¡©e
 
chªges


133 -- (
tim”s
 
d•’d
 
Ú
 
a
 
şock
 
th©
 
sÿËs
 
w™h
 
lšk
 
¥“d
 oÀ
some
 
NICs
)

134 -- 
»®ly
 
Ïrge
 
	`Ï‹nc›s
 (
we
 
Úly
 
wa™
 
up
 
to
 
maxWa™
 
ms
)

135 -- 
®so
 
som‘imes
 
h­³n
 
sšû
 
chªgšg
 
to
 
DPDK
 
»adšg
 
the
 
timšg
 
»gi¡”s


136 -- 
´obably
 
som‘hšg
 
wrÚg
 
w™h
 
the
 
DPDK
 
w¿·round
 
Œackšg


137 -- (
but
 
th©
' »®ly„¬ªdh»suÉšg†©’cy >‡ few days, sØwdÚ'
t
 
»®ly
 
ÿ»
)

138  
Ït
, 
numPkts


140  
n
, 
numPkts


141 
’d


142 
–£if
 
buf
:
	$hasTime¡amp
(è
	`ªd
 (
£q
 =ğ
time¡am³dPkt
 
Ü
ime¡am³dPkˆ=ğ-1è
th’


143 -- 
we
 
gÙ
 
a
 
time¡amp
 
but
 
the
 
wrÚg
 
£qu’û
 
numb”
. 
meh
.

144 
£lf
.
rxQueue
:
	`g‘Time¡amp
(
n
, 
timesync
è-- 
ş—rs
 
the
 

145 -- , 
we
 
may
 
¡l
 
g‘
 
our
 
·ck‘
 :)

146 
–£if
 
£q
 =ğ
ex³ùedSeq
 
	`ªd
 (£q ~ğ
time¡am³dPkt
 
ªd
ime¡am³dPkˆ~ğ-1è
th’


147 -- 
we
 
gÙ
 
our
 
·ck‘
 
back
 
but
 
™
 
wa¢
'timestamped

148 -- 
we
 
lik–y
 
¿n
 
što
 
the
 
´evious
 
—¾›r
 
ªd
 
ş—»d
h
ts
 
too
 
Ï‹


149 
£lf
.
rxBufs
:
	$ä“AÎ
()

150  
n
, 
numPkts


151 
’d


152 
’d


153 
’d


154 
’d


155 -- 
looks
 
like
 
our
 
·ck‘
 
gÙ
 
lo¡
 :(

156  
n
, 
numPkts


158 -- 
h­³ns
 
wh’
 
hÙ¶uggšg
 
ÿbËs


159 
log
:
	`w¬n
("Failedoimestamp…acket onransmission")

160 
tim”
:
	$Ãw
(
maxWa™
):
	$wa™
()

161  
n
, 
numPkts


162 
’d


163 
’d


166 
funùiÚ
 
mod
.
	$syncClocks
(
dev1
, 
dev2
)

167 
loÿl
 
»gs1
 = 
dev1
.
timeRegi¡”s


168 
loÿl
 
»gs2
 = 
dev2
.
timeRegi¡”s


169 
»gs1
[1] ~ğ
»gs2
[1]

170 
Ü
 
»gs1
[2] ~ğ
»gs2
[2]

171 
Ü
 
»gs1
[3] ~ğ
»gs2
[3]

172 
Ü
 
»gs1
[4] ~ğ
»gs2
[4] 
th’


173 
log
:
	`çl
("NICs incompatible, cannot sync clocks")

174 
’d


175 
dpdkc
.
	`libmoÚ_sync_şocks
(
dev1
.
id
, 
dev2
.id, 
	`uÅack
(
»gs1
))

176 -- 
ju¡
 
to
 
‹Î
 
the
 
driv”
 
th©
 
we
 
¬e
 
»£‰šg
h
şock


177 -- 
Ùh”wi£
 
the
 
cyşe
 
Œack”
 
becomes
 
cÚfu£d
 
Ú
 
Ï‹nc›s


178 
dev1
:
	$»£tTimeCouÁ”s
()

179 
dev2
:
	$»£tTimeCouÁ”s
()

180 
’d


182  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/utils.lua

1 --- 
G’”®
 
ut™y
 
	gfunùiÚs
.

2 
loÿl
 
	gcŞÜs
 = 
»quœe
 "colors"

4 
loÿl
 
bÜ
, 
	gbªd
, 
	gbnÙ
, 
	grshiá
, 
	glshiá
, 
	gbsw­
 = 
b™
.bÜ, 
	gb™
.bªd, b™.bnÙ, b™.rshiá, b™.lshiá, b™.
bsw­


5 
loÿl
 
	gwr™e
 = 
io
.
wr™e


6 
loÿl
 
fÜm©
 = 
¡ršg
.format

7 
loÿl
 
¿ndom
, 
	glog
, 
	gæoÜ
 = 
m©h
.¿ndom, 
	gm©h
.log, m©h.
æoÜ


8 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

9 
loÿl
 
S
 = 
»quœe
 "syscall"

11 --- 
Pršt
 
a
 
fÜm©‹d
 
¡ršg
.

12 
funùiÚ
 
	$´štf
(
¡r
, ...)

13  
	`´št
(
¡r
:
	$fÜm©
(...))

14 
’d


16 --- 
Equiv®’t
 
to
 
	`”rÜ
(
¡r
:
	$fÜm©
(...))

17 
funùiÚ
 
	$”rÜf
(
¡r
, ...)

18 
	`”rÜ
(
¡r
:
	`fÜm©
(...), 2)

19 
’d


21 
funùiÚ
 
	$m­V¬Arg
(
f
, ...)

22 
loÿl
 
l
 = { ... 
	}
}

23 
i
, 
v
 
š
 
	$aœs
(
l
) do

24 
l
[
i
] = 
	$f
(
v
)

25 
’d


26  
	$uÅack
(
l
)

27 
’d


29 
funùiÚ
 
	$m­
(
t
, 
f
)

30 
i
, 
v
 
š
 
	$aœs
(
t
) do

31 
t
[
i
] = 
	$f
(
v
)

32 
’d


33  
t


34 
’d


36 
funùiÚ
 
	$to¡ršg®l
(...)

37  
	$m­V¬Arg
(
to¡ršg
, ...)

38 
’d


40 
funùiÚ
 
	$tÚumb”®l
(...)

41  
	$m­V¬Arg
(
tÚumb”
, ...)

42 
’d


44 
funùiÚ
 
	$toCsv
(...)

45 
loÿl
 
v®s
 = { 
	`to¡ršg®l
(...è
	}
}

46 
i
, 
v
 
š
 
	$aœs
(
v®s
) do

47 
v
:
	`fšd
("\""è
th’


48 
v
 = v:
	`gsub
("\"", "\"\"")

49 
’d


50 -- 
f›lds
 
ju¡
 
cÚššg
 \
n
 
Ü
 \
r
 
but
 
nÙ
 \n\¸
¬e
‚Ù 
»quœed
 
to
 
be
 
quÙed
 
by
 
RFC
 4180...

51 -- 
but
 
I
 
doubt
 
th©
 
mo¡
 
·r£r
 
could
 
hªdË
 
this
 ;)

52 
v
:
	`fšd
("\n"è
Ü
 v:fšd("\r"èÜ v:fšd("\""èÜ v:fšd(","è
th’


53 
v®s
[
i
] = ("\"%s\""):
	$fÜm©
(
v
)

54 
’d


55 
’d


56  
bË
.
	`cÚÿt
(
v®s
, ",")

57 
’d


59 
funùiÚ
 
	$´štCsv
(...)

60  
	`´št
(
	$toCsv
(...))

61 
’d


63 
funùiÚ
 
	$Œim
(
¡r
)

64  
¡r
:
	`m©ch
("^%s*(.-)%s*$")

65 
’d


67 --- 
G‘
 
the
 
time
 
to
 
	`wa™
 (
š
 
by‹
-
times
èth
Ãxt
 
·ck‘
 
ba£d
 
Ú
 
a
 
poissÚ
 
´oûss
.

68 --- @
·¿m
 
av”age
 
the
‡v”ag
wa™
 
time
 
b‘w“n
 
two
 
·ck‘s


69 --- @
»tuºs
 
the
 
numb”
 
of
 
by‹
-
times
 
to
 
wa™
Ø
ach›ve
h
giv’
 
av”age
 wa™-
time


70 
funùiÚ
 
	$poissÚD–ay
(
av”age
)

71  
	`æoÜ
(-
	`log
(1 - 
	`¿ndom
()è/ (1 / 
av”age
) + 0.5)

72 
’d


74 --- 
CÚv”t
 
a
 
desœed
 
·ck‘
 
¿‹
 
to
 
the
 
by‹
 
d–ay


75 --- @
·¿m
 
¿‹
 
The
 
desœed
„©
š
 
Mb™
 
³r
 
£cÚd


76 --- @
·¿m
 
size
 
The
 siz
of
 
	$the
 (
´evious
è
·ck‘


77 --- @ 
The
 
by‹
 
d–ay


78 
funùiÚ
 
	$¿‹ToBy‹D–ay
(
¿‹
, 
size
)

79 
size
 = siz
Ü
 60

80  10^10 / 8 / (
¿‹
 * 10^6è- 
size
 - 24

81 
’d


83 --- 
CÚv”t
 
a
 
desœed
 
š‹r
-
·ck‘
 
d–ay
 
time
 
to
 
the
 
by‹
 delay

84 --- @
·¿m
 
time
 
The
 
desœed
im
š
 
ns


85 --- @
·¿m
 
¿‹
 
The
 
lšk
„©
š
 
Mb™
 
³r
 
£cÚd


86 --- @
·¿m
 
size
 
The
 siz
of
 
	$the
 (
´evious
è
·ck‘


88 
funùiÚ
 
	$timeToBy‹D–ay
(
time
, 
¿‹
, 
size
)

89 
¿‹
 =„©
Ü
 10000

90 
size
 = siz
Ü
 60

91  
time
 * 1.25 * (
¿‹
 / 10^4è- 
size
 - 24

92 
’d


95 --- 
By‹
 
sw­
 16 
b™
 
š‹g”s


96 --- @
·¿m
 
n
 16 
b™
 
š‹g”


97 --- @ 
By‹
 
sw­³d
 
š‹g”


98 
funùiÚ
 
	$bsw­16
(
n
)

99  
	`bÜ
(
	`rshiá
(
n
, 8), 
	`lshiá
(
	`bªd
(n, 0xFF), 8))

100 
’d


102 
htÚ16
 = 
bsw­16


103 
Áoh16
 = 
htÚ16


105 
_G
.
bsw­
 = bsw­ -- 
expÜt
 
b™
.bsw­ 
to
 
glob®
 
Çme¥aû
Ø
be
 
cÚsi¡’t
 
w™h
 
bsw­16


106 
htÚ
 = 
bsw­


107 
Áoh
 = 
htÚ


109 
ffi
.
cdef
 [[

110 
şockid_t
;

112 
	`g‘timeofday
(
timev®
* 
tv
, * 
tz
);

113 
	`şock_g‘time
(
şockid_t
 
şk_id
, 
time¥ec
 *

);

117 
loÿl
 
tv
 = 
ffi
.
	`Ãw
("structimeval")

119 
funùiÚ
 
	$g‘timeofday
()

120 
ffi
.
C
.
	$g‘timeofday
(
tv
, 
n
)

121  
tv
.
tv_£c
,v.
tv_u£c


122 
’d


124 --- 
R‘uº
 
the
 
cu¼’t
 
w®l
 
şock
 
time


125 --- @ 
The
 
time
 
š
 
	$£cÚds
 (
as
 
a
 )

126 
funùiÚ
 
	$time
()

127 
loÿl
 
£c
, 
u£c
 = 
	$g‘timeofday
()

128  
	`tÚumb”
(
£c
è+Úumb”(
u£c
) / 10^6

129 
’d


131 
w®lTime
 = 
time


133 
loÿl
 
ts
 = 
ffi
.
	`Ãw
("structimespec")

135 --- 
R‘uº
 
the
 
cu¼’t
 
mÚÙÚic
 
şock
 
time


136 --- @ 
The
 
time
 
š
 
	$£cÚds
 (
as
 
a
 )

137 
funùiÚ
 
	`g‘MÚÙÚicTime
()

138 -- 
CLOCK_MONOTONIC
 = 1

139 
ffi
.
C
.
	$şock_g‘time
(1, 
ts
)

140  
	`tÚumb”
(
ts
.
tv_£c
è+Úumb”Ñs.
tv_n£c
) / 10^9

141 
’d


142 
’d


144 --- 
SubŒaù
 
timev®
 
v®ues


145 --- @
·¿m
 
x
 
the
 "Ï‹r" 
	`timev®
 (
Mšu’d
)

146 --- @
·¿m
 
y
 
the
 "—¾›r" 
	`time
 (
SubŒah’d
)

147 --- @ 
The
 
»suÉ
 
š
 
miüo£cÚds


148 
funùiÚ
 
	$timev®S·n
(
x
, 
y
)

149  (
x
.
tv_£c
 - 
y
.tv_£cè* 1000000 + (x.
tv_u£c
 - y.tv_usec)

150 
’d


153 --- 
C®cuÏ‹
 
a
 16 
b™
 
checksum


154 --- @
·¿m
 
d©a
 
cd©a
 
to
 
ÿlcuÏ‹
 
the
 
checksum
 .

155 --- @
·¿m
 
Ën
 
Numb”
 
of
 
by‹s
 
to
 
ÿlcuÏ‹
 
the
 
checksum
 .

156 --- @ 16 
b™
 
š‹g”


157 
funùiÚ
 
	$checksum
(
d©a
, 
Ën
)

158 
d©a
 = 
ffi
.
	`ÿ¡
("uint16_t*", data)

159 
loÿl
 
cs
 = 0

160 
i
 = 0, 
Ën
 / 2 - 1 do

161 
cs
 = c + 
d©a
[
i
]

162 
cs
 >ğ2^16 
th’


163 
cs
 = 
	`bªd
(cs, 0xFFFF) + 1

164 
’d


165 
’d


166 -- 
missšg
 
the
 
v”y
 
Ï¡
 
ušt_8
 
odd
 
sized
 
·ck‘s


167 -- 
nÙe
 
th©
 
this
 
acûss
 
is
 
®ways
 
v®id
 
š
 
libmoÚ


168 -- * 
bufãrs
 
¬e
 
a
 
fixed
 
ev’
 
size
 >ğ
pkt
 
Ën


169 -- * 
pkt
 
Ëngth
 
is
 
ju¡
 
m‘ad©a
 
ªd
 
nÙ
 
the
 
aùu®
†’gth 
of
h
bufãr


170 ià(
Ën
 % 2è=ğ1 
th’


171 -- 
sim¶y
 
nuÎ
 
the
 
by‹
 
outside
 
of
 
our
 
·ck‘


172 
cs
 = c + 
	`bªd
(
d©a
[
Ën
 / 2], 0xFF)

173 
cs
 >ğ2^16 
th’


174 
cs
 = 
	`bªd
(cs, 0xFFFF) + 1

175 
’d


176 
’d


177  
	`bªd
(
	`bnÙ
(
cs
), 0xFFFF)

178 
’d


180 --- 
P¬£
 
a
 
¡ršg
 
to
‡ 
MAC
 
add»ss


181 --- @
·¿m
 
mac
 
add»ss
 
š
 
¡ršg
 
fÜm©


182 -- @
·¿m
 
numb”
  
as
‚umber

183 --- @ 
add»ss
 
š
 
mac_add»ss
 
fÜm©
 
Ü
 
n
 
šv®id
‡ddress

184 
funùiÚ
 
	$·r£MacAdd»ss
(
mac
, 
numb”
)

185 
loÿl
 
by‹s
 = {
¡ršg
.
	`m©ch
(
mac
, '(%x+)[-:](%x+)[-:](%x+)[-:](%x+)[-:](%x+)[-:](%x+)')
	}
}

186 
by‹s
 =ğ
n
 
th’


188 
’d


189 
i
 = 1, 6 do

190 
	gby‹s
[
i
] =ğ
n
 
th’


192 
’d


193 
by‹s
[
i
] = 
	$tÚumb”
(
by‹s
[
i
], 16)

194 
by‹s
[
i
] < 0 
Ü
 by‹s[i] > 0xFF 
th’


196 
’d


197 
’d


199 
numb”
 
th’


200 
loÿl
 
acc
 = 0

201 
i
 = 1, 6 do

202 
acc
 =‡cø+ 
by‹s
[
i
] * 256 ^ (i - 1)

203 
’d


204  
acc


206 
addr
 = 
ffi
.
	`Ãw
("union mac_address")

207 
i
 = 0, 5 do

208 
addr
.
ušt8
[
i
] = 
by‹s
[i + 1]

209 
’d


210  
addr


211 
’d


212 
’d


214 --- 
T¿n¦©es
 
ª
 
IP4
 
š
 
numb”
 
fÜm©
 
što
 
a
 
¡ršg


215 
funùiÚ
 
	$4ToSŒšg
(

)

216  ("%d.%d.%d.%d"):
	`fÜm©
(

217 
b™
.
	`rshiá
(

, 24),

218 
b™
.
	`bªd
(b™.
	`rshiá
(

, 16), 0xFF),

219 
b™
.
	`bªd
(b™.
	`rshiá
(

, 8), 0xFF),

220 
b™
.
	$bªd
(

, 0xFF)

222 
’d


224 --- 
P¬£
 
a
 
¡ršg
 
to
 
ª
 
IP
 
add»ss


225 --- @ 
add»ss
 

‡dd»s 
š
 
4_add»ss
 
Ü
 
6_add»ss
 
fÜm©
 o¸
n
 
šv®id
‡ddress

226 --- @ 
boŞ—n
 
Œue
 
IPv4
 
add»ss
, 
çl£
 
Ùh”wi£


227 
funùiÚ
 
	$·r£IPAdd»ss
(

)

228 

 = 
	$to¡ršg
(

)

229 
loÿl
 
add»ss
 = 
	$·r£IP4Add»ss
(

)

230 
add»ss
 =ğ
n
 
th’


231  
	`·r£IP6Add»ss
(

), 
çl£


232 
’d


233  
add»ss
, 
Œue


234 
’d


236 --- 
P¬£
 
a
 
¡ršg
 
to
 
ª
 
IPv4
 
add»ss


237 --- @
·¿m
 

 
add»ss
 
š
 
¡ršg
 
fÜm©


238 --- @ 
add»ss
 
š
 
ušt32
 
fÜm©
 
Ü
 
n
 
šv®id
‡ddress

239 
funùiÚ
 
	$·r£IP4Add»ss
(

)

240 

 = 
	$to¡ršg
(

)

241 
loÿl
 
by‹s
 = {
¡ršg
.
	`m©ch
(

, '(%d+)%.(%d+)%.(%d+)%.(%d+)')
	}
}

242 
by‹s
 =ğ
n
 
th’


244 
’d


245 
i
 = 1, 4 do

246 
	gby‹s
[
i
] =ğ
n
 
th’


248 
’d


249 
by‹s
[
i
] = 
	$tÚumb”
(
by‹s
[
i
])

250 
by‹s
[
i
] < 0 
Ü
 by‹s[i] > 255 
th’


252 
’d


253 
’d


255 -- 
bud
 
a
 
ušt32


256 

 = 
by‹s
[1]

257 
i
 = 2, 4 do

258 

 = 
	`bÜ
(
	`lshiá
(, 8), 
by‹s
[
i
])

259 
’d


260  



261 
’d


263 
ffi
.
cdef
[[

264 
	`š‘_±Ú
(
af
, cÚ¡ *
¤c
, *
d¡
);

267 --- 
P¬£
 
a
 
¡ršg
 
to
 
ª
 
IPv6
 
add»ss


268 --- @
·¿m
 

 
add»ss
 
š
 
¡ršg
 
fÜm©


269 --- @ 
add»ss
 
š
 
6_add»ss
 
fÜm©
 
Ü
 
n
 
šv®id
‡ddress

270 
funùiÚ
 
	$·r£IP6Add»ss
(

)

271 

 = 
	$to¡ršg
(

)

272 
loÿl
 
LINUX_AF_INET6
 = 10 --
´•roûssÜ
 
cÚ¡ªt
 
of
 
Lšux


273 
loÿl
 
tmp_addr
 = 
ffi
.
	`Ãw
("union ip6_address")

274 
loÿl
 
»s
 = 
ffi
.
C
.
	$š‘_±Ú
(
LINUX_AF_INET6
, 

, 
tmp_addr
)

275 
»s
 =ğ0 
th’


276  
n


277 
’d


279 
loÿl
 
addr
 = 
ffi
.
	`Ãw
("union ip6_address")

280 
addr
.
ušt32
[0] = 
	$bsw­
(
tmp_addr
.
ušt32
[3])

281 
addr
.
ušt32
[1] = 
	$bsw­
(
tmp_addr
.
ušt32
[2])

282 
addr
.
ušt32
[2] = 
	$bsw­
(
tmp_addr
.
ušt32
[1])

283 
addr
.
ušt32
[3] = 
	$bsw­
(
tmp_addr
.
ušt32
[0])

285  
addr


286 
’d


288 --- 
R‘r›ve
 
the
 
sy¡em
 
time
 
w™h
 
miüo£cÚds
 
accu¿cy
.

289 --- @
todo
 
u£
 
some
 
C
 
funùiÚ
 
to
 
g‘
 
miüo£cÚds
.

290 --- @ 
Sy¡em
 
time
 
š
 
hh
:
mm
:
ss
.
uuuuuu
 
fÜm©
.

291 
funùiÚ
 
	$g‘TimeMiüos
()

292 
loÿl
 
t
 = 
	$time
()

293 
loÿl
 
h
, 
m
, 
s
, 
u


294 
s
 = 
m©h
.
	`æoÜ
(
t
è-- 
round
 
to
 
£cÚds


295 
u
 = 
t
 - 
s
 -- 
miüo
 
£cÚds


296 
m
 = 
m©h
.
	`æoÜ
(
s
 / 60è-- 
tÙ®
 
mšu‹s


297 
s
 = s - 
m
 * 60 -- 
»maššg
 
£cÚds


298 
h
 = 
m©h
.
	`æoÜ
(
m
 / 60è-- 
tÙ®
 
hours


299 
m
 = m - 
h
 * 60 -- 
»maššg
 
mšu‹s


300 
h
 = h % 24 -- 
hour
 
of
 
the
 
day


301 
s
 = s + 
u
 -- 
£cÚds
 + 
miüo
 seconds

302  
	`fÜm©
("%02d:%02d:%02.6f", 
h
, 
m
, 
s
)

303 
’d


305 --- 
Pršt
 
a
 
hex
 
dump
 
of
 
cd©a
.

306 --- @
·¿m
 
d©a
 
The
 
cd©a
 
to
 
be
 
dum³d
.

307 --- @
·¿m
 
by‹s
 
Numb”
 
of
 by‹ 
to
 
dump
.

308 --- @
·¿m
 
¡»am
 
the
 sŒ—m 
to
 
wr™e
o, 
deçuÉs
Ø
io
.
¡dout


309 --- @
·¿m
 
£ps
 
A
 
bË
 
w™h
 
the
 
´ÙocŞ
 
off£ts
. 
U£d
 
to
 
cŞÜize
h
ouut


310 --- @
·¿m
 
wœesh¬k
 
Dump
 
š
 wœesh¬k 
com·tibË
 
	`fÜm©
 (
Wœesh¬k
 -> 
ImpÜt
 
äom
 
Hex
 Dump)

311 
funùiÚ
 
	$dumpHex
(
d©a
, 
by‹s
, 
¡»am
, 
£ps
, 
wœesh¬k
)

312 
loÿl
 
d©a
 = 
ffi
.
	`ÿ¡
("uint8_t*", data)

313 
¡»am
 = sŒ—m 
Ü
 
io
.
¡dout


314 
wœesh¬k
 = wœesh¬k 
Ü
 
çl£


316 
loÿl
 
cS•
 = 1

317 
loÿl
 
cCŞÜ
 = 
£ps
 
ªd
 
	$g‘CŞÜCode
(
cS•
è
Ü
 ''

318 
i
 = 0, 
by‹s
 - 1 do

319 -- 
d‘”mše
 
cŞÜ


320 -- 
™s
 
´•’ded
 
to
 
the
 
cu¼’t
 
by‹
 
—ch
 
Ãw
 
lše
 
Ü
 th
cŞÜ
 
chªges


321 -- 
Ùh”wi£
 '' 
g‘s
 
´•’ded


322 
£ps
 
ªd
 
cS•
 <ğ#£p ªd s•s[cS•] =ğ
i
 
th’


323 
cS•
 = cSep + 1

324 
cCŞÜ
 = 
	$g‘CŞÜCode
(
cS•
)

325 
’d


327 -- 
Ãw
 
lše


328 
i
 % 16 =ğ0 
th’


329 
cCŞÜ
 = 
£ps
 
ªd
 
	`g‘CŞÜCode
("wh™e"è
Ü
 ''

330 
¡»am
:
	`wr™e
(
cCŞÜ
 .. 
¡ršg
.
	`fÜm©
(
wœesh¬k
 
ªd
 " %06x " 
Ü
 " 0x%04x: ", 
i
))

331 
cCŞÜ
 = 
£ps
 
ªd
 
	$g‘CŞÜCode
(
cS•
è
Ü
 ''

332 
’d


334 
¡»am
:
	`wr™e
(
cCŞÜ
 .. 
¡ršg
.
	`fÜm©
("%02x", 
d©a
[
i
]))

335 
cCŞÜ
 = ''

337 -- 
sšgË
 
	$by‹s
 (
wœesh¬k
è
Ü
 
groups
 
of
 2

338 
wœesh¬k
 
Ü
 
i
 % 2 =ğ1 
th’


339 
¡»am
:
	`wr™e
(" ")

340 
’d


342 
i
 % 16 =ğ15 
th’
 -- 
’d
 
of
 16 
by‹
 
lše


343 
¡»am
:
	`wr™e
("\n")

344 
’d


345 
’d


346 
¡»am
:
	`wr™e
((
£ps
 
ªd
 
	$g‘CŞÜCode
(è
Ü
 '') .. "\n\n")

347 
’d


349 --- 
M”ge
 
bËs
.

350 --- @
·¿m
 
¬gs
 
Arb™¿ry
 
amouÁ
 
of
 
bËs
 
to
 
g‘
 
m”ged
.

351 
funùiÚ
 
	$m”geTabËs
(...)

352 
loÿl
 
bË
 = {
	}
}

353 
£Ëù
("#", ...è> 0 
th’


354 
	gbË
 = 
	$£Ëù
(1, ...)

355 
i
 = 2, 
	`£Ëù
("#", ...) do

356 
k
,
v
 
š
 
	`·œs
(
	$£Ëù
(
i
, ...)) do

357 
bË
[
k
] = 
v


358 
’d


359 
’d


360 
’d


361  
bË


362 
’d


364 --- 
CÚÿ‹Ç‹
 
two
 
¬¿ys


365 
funùiÚ
 
	$cÚÿtA¼ays
(
tbl1
, 
tbl2
)

366 
loÿl
 
»s
 = {
	}
}

367 
k
, 
v
 
š
 
	$aœs
(
tbl1
) do

368 
»s
[#» + 1] = 
v


369 
’d


370 
k
, 
v
 
š
 
	$aœs
(
tbl2
) do

371 
»s
[#» + 1] = 
v


372 
’d


373  
»s


374 
’d


376 --- 
R‘uº
 
®l
 
š‹g”ss
 
š
 
the
 
¿nge
 [
¡¬t
, 
max
].

377 --- @
·¿m
 
max
 
uµ”
 
bound


378 --- @
·¿m
 
¡¬t
 
low”
 
bound
,  = 1

379 
funùiÚ
 
	$¿nge
(
max
, 
¡¬t
, ...)

380 
¡¬t
 = s¹ 
Ü
 1

381 
¡¬t
 > 
max
 
th’


383 
’d


384  
¡¬t
, 
	`¿nge
(
max
, s¹ + 1, 
	$£Ëù
(2, ...))

385 
’d


387 
loÿl
 
bªd
 = 
b™
.band

388 
loÿl
 
§r
 = 
b™
.
¬shiá


390 --- 
Inüem’t
 
a
 
w¿µšg
 
couÁ”
, 
i
.
e
. (
v®
 + 1è% 
max


391 --- 
This
 
funùiÚ
 
is
 
İtimized
 
to
 
g’”©e
 
b¿nchËss
 
code
 
ªd
 
ç¡”
 
thª
 
a
 
Çive
 
modulo
-
ba£d
 
im¶em’tiÚ
.

392 --- @
nÙe
: 
®l
 
©‹m±s
 
to
 
w¿p
 
this
 
š
 
a
 
niû
 
ªd
 
sim¶e
 
şass
 
have
 
	`çed
 (~30% 
³rfÜmªû
 
im·ù
).

393 --- @
·¿m
 
v®
 
Cu¼’t
 
	`v®ue
 (
numb”
)

394 --- @
·¿m
 
max
 
Maximum
 
®lowed
 
v®ue
 
of
 
	`v®
 (
numb”
)

395 --- @ 
Inüem’‹d
 
ªd
 
w¿µed
 
numb”


396 
funùiÚ
 
	$šcAndW¿p
(
v®
, 
max
)

397  
	`bªd
(
v®
 + 1, 
	`§r
(v® - 
max
 + 1, 31))

398 
’d


400 
loÿl
 
uÅack”s
 = 
	`£tm‘©abË
({
	}
}, { 
	g__šdex
 = 
funùiÚ
(
£lf
, 
n
)

401 
loÿl
 
	gfunc
 = 
lßd¡ršg
(([[

402  
funùiÚ
(
tbl
)

403  ]] .. ("tbl[%d], "):
»p
(
n
):
sub
(0, -3) .. [[

404 
’d


405 ]]):
fÜm©
(
¿nge
(
n
)))()

406 
¿w£t
(
£lf
, 
n
, 
func
)

407  
func


408 
	g’d
 })

410 --- 
	$uÅack
(è
w™h
 
suµÜt
 
¬¿ys
 with 'holes'.

411 --- @
·¿m
 
tbl
 
TabË
 
to
 
uÅack


412 --- @ 
UÅacked
 
v®ues


413 
funùiÚ
 
	$uÅackAÎ
(
tbl
)

414  
uÅack”s
[
bË
.
	`maxn
(
tbl
)](tbl)

415 
’d


418 --- 
G‘
 
the
 
İ”©iÚ
 
sy¡em
 
ty³
 
ªd
 
v”siÚ


419 -- @ 
osName
, 
majÜ
, 
mšÜ
, 
·tch


420 
funùiÚ
 
	$g‘OS
()

421 
loÿl
 
uÇme
 = 
S
.
	$uÇme
()

422 
loÿl
 
majÜ
, 
mšÜ
, 
·tch
 = 
	`tÚumb”®l
(
uÇme
.
»Ëa£
:
	`m©ch
("^(%d+)%.(%d+)%.(%d+)"))

423  
uÇme
.
sy¢ame
, 
majÜ
, 
mšÜ
, 
·tch


424 
’d


426 
funùiÚ
 
	$feExi¡s
(
f
)

427 
loÿl
 
fe
 = 
io
.
	`İ’
(
f
, "r")

428 
fe
 
th’


429 
fe
:
	$şo£
()

430 
’d


431  
nÙ
‚Ù 
fe


432 
’d


434 
ffi
.
cdef
[[

435 cÚ¡ * 
	`¹e_¡»¼Ü
(
”r
);

438 
funùiÚ
 
	$¡rE¼Ü
(
”r
)

439 
”r
 = 
m©h
.
	$abs
(
”r
)

440 
loÿl
 
¡r
 = 
ffi
.
C
.
	`¹e_¡»¼Ü
(
”r
);

441  
ffi
.
	$¡ršg
(
¡r
)

442 
’d


444 -- 
äom
 
h‰p
:

445 
funùiÚ
 
	$¡rS¶™
(
¡r
, 
·t
)

446 
loÿl
 
t
 = {
	}
} -- 
NOTE
: 
u£
 {
n
 = 0} 
š
 
Lua
-5.0

447 
loÿl
 
å©
 = "(.-)" .. 
·t


448 
loÿl
 
Ï¡_’d
 = 1

449 
loÿl
 
s
, 
	ge
, 
	gÿp
 = 
¡r
:
	$fšd
(
å©
, 1)

450 
s
 do

451 
s
 ~ğ1 
Ü
 
ÿp
 ~ğ"" 
th’


452 
bË
.
	$š£¹
(
t
,
ÿp
)

453 
’d


454 
Ï¡_’d
 = 
e
+1

455 
s
, 
e
, 
ÿp
 = 
¡r
:
	$fšd
(
å©
, 
Ï¡_’d
)

456 
’d


457 
Ï¡_’d
 <ğ#¡¸
th’


458 
ÿp
 = 
¡r
:
	$sub
(
Ï¡_’d
)

459 
bË
.
	$š£¹
(
t
, 
ÿp
)

460 
’d


461  
t


462 
’d


464 
funùiÚ
 
	$checkDpdkE¼Ü
(
”r
, 
msg
, 
lvl
)

465 
”r
 ~ğ0 
th’


466 
loÿl
 
log
 = 
»quœe
 "log"

467 
log
[
lvl
 
Ü
 "w¬n"]Öog, "E¼Ü %s: %s", 
msg
, 
	$¡rE¼Ü
(
”r
))

468 
’d


469  
Œue


470 
’d


472 -- 
D“p
 
cİy
's‡able,‡nd„eturnshe copy.

473 -- @
·¿m
 
Üig
 
The
 
Üigš®
 
bË
 
to
 
cİy
.

474 
funùiÚ
 
	$d“pCİy
(
Üig
)

475 
loÿl
 
ÜigTy³
 = 
	$ty³
(
Üig
)

476 
loÿl
 
cİy


477 
ÜigTy³
 =ğ"bË" 
th’


478 
cİy
 = {
	}
}

479 
k
,
v
 
š
 
	gÃxt
, 
	gÜig
, 
n
 do

480 
	gcİy
[
d“pCİy
(
k
)] = 
	$d“pCİy
(
v
)

481 
’d


482 
	`£tm‘©abË
(
cİy
, 
	`d“pCİy
(
	$g‘m‘©abË
(
Üig
)))

483 -- 
sim¶e
 
ty³


484 
cİy
 = 
Üig


485 
’d


486  
cİy


487 
’d


489 -- 
G’”©es
 
a
 
¿ndom
 
·ck‘
 
size
 
accÜdšg
 
to
 
IMIX
.

490 
funùiÚ
 
	$imixSize
()

491 
loÿl
 
ºum
 = 
m©h
.
	$¿ndom
(12)

492 
ºum
 =ğ1 
th’
 -- 1 
š
 12 : [1 - 10] : 10 / 120

494 
–£if
 
ºum
 <ğ5 
th’
 -- 4 
š
 12 : [11 - 50] : 40 / 120

496 -- 7 
š
 12 : [51 - 120] : 70 / 120

498 
’d


499 
’d


501 
funùiÚ
 
	$wa™FÜFunc
(
wa™
, 
f
, ...)

502 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

503 
wa™
 = wa™ 
Ü
 0

504 
»³©


505 
loÿl
 
»s
 = 
	$f
(...)

506 
»s
 
th’


507  
»s


508 
’d


509 
libmoÚ
.
	`¦“pMiüosIdË
(
m©h
.
	$mš
(10, 
wa™
))

510 
wa™
 = wait - 10

511 
nÙ
 
libmoÚ
.
	$ruÂšg
(è
th’


513 
’d


514 
uÁ
 
wa™
 < 0

515  
n


516 
’d


519 -- 
u£ful
 
ty³defs


520 
voidPŒTy³
 = 
ffi
.
	`ty³of
("void*")

	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/webserver-task.lua

1 
loÿl
 
	gmod
 = {}

3 
loÿl
 
deviû
 = 
»quœe
 "device"

4 
loÿl
 
turbo
 = 
»quœe
 "turbo"

5 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

6 
loÿl
 
¡©s
 = 
»quœe
 "stats"

7 
loÿl
 
ffi
 = 
»quœe
 "ffi"

8 
loÿl
 
log
 = 
»quœe
 "log"

10 
loÿl
 
HTTPE¼Ü
 = 
turbo
.
web
.HTTPError

13 
loÿl
 
deviûHªdËr
 = 
şass
("deviûHªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

15 
loÿl
 
funùiÚ
 
	$deviûInfo
(
id
)

16 
loÿl
 
dev
 = 
deviû
.
	$g‘
(
id
)

17 
loÿl
 
šfo
 = 
dev
:
	$g‘Info
()

19 
cÚfigu»d
 = 
dev
.
š™Ÿlized
 
Ü
 
çl£
,

20 
id
 = 
šfo
.
if_šdex
,

21 
rxQueues
 = 
šfo
.
nb_rx_queues
,

22 
txQueues
 = 
šfo
.
nb_tx_queues
,

23 
maxRxQueues
 = 
šfo
.
max_rx_queues
,

24 
maxTxQueues
 = 
šfo
.
max_tx_queues
,

25 
driv”
 = 
ffi
.
	`¡ršg
(
šfo
.
driv”_Çme
),

26 
Çme
 = 
dev
:
	`g‘Name
(),

27 
numaSock‘
 = 
dev
:
	`g‘Sock‘
(),

28 
mac
 = 
dev
:
	`g‘MacSŒšg
(),

29 
lškUp
 = 
dev
:
	`g‘LškStus
().
¡©us
,

30 
lškS³ed
 = 
dev
:
	`g‘LškStus
().
¥“d
,

31 
	}
}

32 
’d


34 
funùiÚ
 
	gdeviûHªdËr
:
	$g‘
(
id
)

35 
id
 =ğ"®l" 
th’


36 
loÿl
 
»suÉ
 = {
	}
}

37 
i
 = 0, 
	gdeviû
.
numDeviûs
() - 1 do

38 
	g»suÉ
[#»suÉ + 1] = 
	$deviûInfo
(
i
)

39 
’d


40 
£lf
:
	$wr™e
(
»suÉ
)

41 
–£if
 
id
 =ğ"num" 
th’


42 
£lf
:
	`wr™e
({
num
 = 
deviû
.
	`numDeviûs
()
	}
})

43 
–£if
 
	$tÚumb”
(
id
è
th’


44 
loÿl
 
id
 = 
	$tÚumb”
(
id
)

45 
id
 >ğ
deviû
.
	$numDeviûs
(è
th’


46 
	`”rÜ
(
	`HTTPE¼Ü
(400, {
mes§ge
 = ("th”¬Úly %d deviûs"):
	`fÜm©
(
deviû
.
	`numDeviûs
())
	}
}))

47 
’d


48 
£lf
:
wr™e
(
	$deviûInfo
(
id
))

50 
£lf
:
	$£t_¡©us
(400)

51 
’d


52 
’d


54 
loÿl
 
couÁ”HªdËr
 = 
	`şass
("couÁ”HªdËr", 
turbo
.
web
.
Reque¡HªdËr
)

56 
loÿl
 
couÁ”s
 = {
	}
}

57 
loÿl
 
¡©sPe
 = 
¡©s
.
sh¬e
.
pe


58 
loÿl
 
funùiÚ
 
	$upd©eCouÁ”s
()

59 
Œue
 do

60 
loÿl
 
d©a
 = 
¡©sPe
:
	$ŒyRecv
()

61 
nÙ
 
d©a
 
th’


63 
’d


64 
couÁ”s
[
d©a
.
id
] = couÁ”s[d©a.id] 
Ü
 {

65 
id
 = 
d©a
.id,

66 
Çme
 = 
d©a
.name,

67 
dœeùiÚ
 = 
d©a
.
dœ
,

68 
d©a
 = {}

69 
	}
}

70 
	gbË
.
š£¹
(
couÁ”s
[
d©a
.
id
].data, data)

71 -- dØ
nÙ
 
»³©
 
the£
 
v®ues
 
ev”y
 
’Œy


72 
	gd©a
.
	gid
 = 
n


73 
d©a
.
Çme
 = 
n


74 
d©a
.
dœ
 = 
n


75 
’d


76 
’d


78 
loÿl
 
funùiÚ
 
	$couÁ”Info
(
id
)

79  
couÁ”s
[
id
] 
Ü
 {
	}
}

80 
’d


83 
funùiÚ
 
couÁ”HªdËr
:
	$g‘
(
id
)

84 
id
 =ğ"®l" 
th’


85 
loÿl
 
»suÉ
 = {
	}
}

86 
i
 = 1, 
	g¡©s
.
	$numCouÁ”s
() do

87 
»suÉ
[#»suÉ + 1] = 
	$couÁ”Info
(
i
)

88 
’d


89 
£lf
:
	$wr™e
(
»suÉ
)

90 
–£if
 
id
 =ğ"num" 
th’


91 
£lf
:
	`wr™e
({
num
 = 
¡©s
.
	`numCouÁ”s
()
	}
})

92 
–£if
 
	$tÚumb”
(
id
è
th’


93 
loÿl
 
id
 = 
	$tÚumb”
(
id
)

94 
id
 > 
¡©s
.
	$numCouÁ”s
(è
th’


95 
	`”rÜ
(
	`HTTPE¼Ü
(400, {
mes§ge
 = ("th”¬Úly %d couÁ”s"):
	`fÜm©
(
¡©s
.
	`numCouÁ”s
())
	}
}))

96 
’d


97 
£lf
:
wr™e
(
	$couÁ”Info
(
id
))

99 
£lf
:
	$£t_¡©us
(400)

100 
’d


101 
’d


104 
funùiÚ
 
mod
.
	$web£rv”Task
(
İtiÚs
, ...)

105 
İtiÚs
 = o±iÚ 
Ü
 {
	}
}

106 
İtiÚs
.
pÜt
 = o±iÚs.pÜˆ
Ü
 8888

107 
log
:
šfo
("S¹šg REST API oÀpÜˆ%d", 
İtiÚs
.
pÜt
)

108 
loÿl
 
	gexŒaHªdËrs
 = {}

109 
İtiÚs
.
š™
 
th’


110 
exŒaHªdËrs
 = 
_G
[
İtiÚs
.
š™
](
turbo
, ...)

111 
’d


112 
loÿl
 
	ghªdËrs
 = {

113 {"^/deviûs/([^/]+)/?$", 
deviûHªdËr
},

114 {"^/couÁ”s/([^/]+)/?$", 
couÁ”HªdËr
},

116 
_
, 
v
 
š
 
	$aœs
(
exŒaHªdËrs
) do

117 
	`ty³
(
v
è~ğ"bË" 
th’


118 
log
:
	`çl
('Init function must„eturn†ist of handlers,ƒ.g., {{"url", handler}, {"url2", handler2}}')

119 
’d


120 
bË
.
	$š£¹
(
hªdËrs
, 
v
)

121 
’d


122 
loÿl
 
­¶iÿtiÚ
 = 
turbo
.
web
.
AµliÿtiÚ
:
	$Ãw
(
hªdËrs
)

123 
­¶iÿtiÚ
:
	`li¡’
(
İtiÚs
.
pÜt
, o±iÚs.
bšd
, {
	}
})

124 
loÿl
 
	giŞoİ
 = 
turbo
.
iŞoİ
.
	$š¡ªû
()

125 
iŞoİ
:
	$£t_š‹rv®
(500, 
upd©eCouÁ”s
)

126 
iŞoİ
:
	`£t_š‹rv®
(50, 
	$funùiÚ
()

127 
nÙ
 
libmoÚ
.
	$ruÂšg
(è
th’


128 
iŞoİ
:
	$şo£
()

129 
’d


130 
’d
)

131 
iŞoİ
:
	$¡¬t
()

132 
’d


135  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/lua/webserver.lua

1 
loÿl
 
	gmod
 = {}

3 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

4 
loÿl
 
ns
 = 
»quœe
 "namespaces"

6 
mod
.
sh¬e
 = 
ns
:
g‘
()

8 --- 
S¹
 
a
 
web£rv”
 
sk
 
w™h
 
some
  
hªdËrs
.

9 --- @
·¿m
 
İtiÚs
, 
bË
 
of
 
£rv”
 
	g£‰šgs


10 --- 
	gš™
: 
Çme
 
of
 
a
 
glob®
 
funùiÚ
 
th©
 
is
 
ÿÎed
 
by
 
the
 
£rv”
 
sk
 
befÜe
h
iŞoİ
 i 
¡¬‹d


11 --- 
»ûives
 
the
 
turbo
 
objeù
 
®s
 
·¿m‘”


12 --- 
this
 
ÿn
 
be
 
u£d
 
to
 
š¡®l
 
cu¡om
 
hªdËrs
 (
d‘as
 
TBD
)

13 --- 
pÜt
:…Üˆ
to
 
li¡’
 
Ú
, : 8888

14 --- 
TODO
: 
SSL
 
İtiÚs


15 --- @
·¿m
 ..., 
v¬¬g
 
·s£d
 
through
 
to
 
the
 
š™
 
funùiÚ
 
aá”
h
turbo
 
·¿m‘”


16 
funùiÚ
 
	gmod
.
	$¡¬tWeb£rv”Task
(
İtiÚs
, ...)

17 
mod
.
sh¬e
.
skRuÂšg
 = 
Œue


18 
libmoÚ
.
	`¡¬tSh¬edTask
("__LM_WEBSERVER_TASK", 
İtiÚs
, ...)

19 
’d


21 
__LM_WEBSERVER_TASK
 = 
»quœe
 "web£rv”-sk".
web£rv”Task


23 
funùiÚ
 
mod
.
	$ruÂšg
()

24 
nÙ
 
mod
.
skRuÂšg
 
th’


25 
mod
.
skRuÂšg
 = mod.
sh¬e
.taskRunning

26 
’d


27  
mod
.
skRuÂšg


28 
’d


30  
mod


	@/home/asabzi/msc-project/MoonGen-1/libmoon/test/task-memory-leaks.lua

1 
loÿl
 
	glm
 = 
»quœe
 "libmoon"

3 
loÿl
 
TBL_SIZE
 = 10 -- 
sm®l
, 
we
 
	gdÚ
't wanto spent‡llheime in (de-)serialization

4 
loÿl
 
	gNUM_LOCAL_TABLES
 = 1000

6 
loÿl
 
funùiÚ
 
	$makeL¬geTabË
()

7 
loÿl
 
tbl
 = {
	}
}

8 
i
 = 1, 
TBL_SIZE
 do

9 
	gtbl
[
to¡ršg
(
i
)] = {1, 2, 3, 4, "Entry " .. i}

10 
’d


11  
tbl


12 
’d


14 
loÿl
 
funùiÚ
 
	$checkResuÉ
(
tbl
)

15 
i
 = 1, 
TBL_SIZE
 do

16 
loÿl
 
’Œy
 = 
tbl
[
	`to¡ršg
(
i
)]

17 
	$as£¹
(
’Œy
)

18 
	`as£¹
(#entry == 5)

19 
	`as£¹
(
’Œy
[5] =ğ"EÁry " .. 
i
)

20 
’d


21 
’d


23 
funùiÚ
 
	$shouldNÙL—k
(
bË
)

24 
	`cŞËùg¬bage
("stop")

25 
i
 = 1, 
NUM_LOCAL_TABLES
 do

26 
	$makeL¬geTabË
()

27 
’d


28  
bË


29 
’d


31 
funùiÚ
 
	$ma¡”
()

32 
i
 = 1, 500 do

33 
	`checkResuÉ
(
lm
.
	`¡¬tTask
("shouldNÙL—k", 
	$makeL¬geTabË
()):
	$wa™
())

34 
’d


35 
’d


	@/home/asabzi/msc-project/MoonGen-1/lua/crc-ratecontrol.lua

1 
loÿl
 
	gdeviû
 = 
»quœe
 "device"

2 
loÿl
 
pkt
 = 
»quœe
 "packet"

3 
loÿl
 
memÜy
 = 
»quœe
 "memory"

4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

5 
loÿl
 
log
 = 
»quœe
 "log"

7 
loÿl
 
txQueue
 = 
deviû
.
__txQueuePrÙÙy³


8 
loÿl
 
deviû
 = deviû.
__deviûPrÙÙy³


9 
loÿl
 
C
 = 
ffi
.C

11 
ffi
.
cdef
[[

12 
moÚg’_£nd_®l_·ck‘s_w™h_d–ay_bad_üc
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
queue_id
, 
¹e_mbuf
** 
lßd_pkts
, ušt16_ˆ
num_pkts
, 
mempoŞ
* 
poŞ
, 
ušt32_t
 
mš_pkt_size
);

15 
loÿl
 
	gmempoŞ


16 --- 
S’d
 
	g¿‹
-
cÚŒŞËd
 
·ck‘s
 
by
 
flšg
 
g­s
 
w™h
 
šv®id
 
	g·ck‘s
.

17 -- @
·¿m
 
	gbufs


18 -- @
·¿m
 
rg‘R©e
 
	gİtiÚ®
, 
hšt
 
to
 
the
 
driv”
 
which
 
tÙ®
 
¿‹
 
you
 
¬e
 
Œyšg
Ø
	gach›ve
.

19 -- 
šü—£s
 
´ecisiÚ
 
©
 
low
 
	gnÚ
-
cbr
 
	g¿‹s


20 -- @
·¿m
 
n
 
	gİtiÚ®
, 
numb”
 
of
 
·ck‘s
 
to
 
	$£nd
 (
deçuÉs
 
to
 
fuÎ
 
bufs
)

21 
funùiÚ
 
txQueue
:
	$£ndW™hD–ay
(
bufs
, 
rg‘R©e
, 
n
)

22 
nÙ
 
£lf
.
dev
.
ücP©ch
 
th’


23 
log
:
	`çl
("Driver does‚ot support disablinghe CRC flag. This feature„equires‡…atched driver.")

24 
’d


25 
rg‘R©e
 =¬g‘R©
Ü
 14.88

26 
£lf
.
u£d
 = 
Œue


27 
mempoŞ
 = mempoŞ 
Ü
 
memÜy
.
ü—‹MemPoŞ
{

28 
func
 = 
	`funùiÚ
(
buf
)

29 -- 
this
 
is
 
tı
 
·ck‘
 
beÿu£
 
the
 
Ãtåga
/
OSNT
 
sy¡em
 
we
 
u£
 
‹¡šg
his

30 -- 
ÿÂÙ
 
hªdË
 
®l
-
z”o
 
·ck‘s
 
	`´İ”ly
 (
f‹rs
 
g‘
 
cÚfu£d
)

31 -- 
the
 
aùu®
 
cÚ‹Ás
 
of
h
·ck‘s
 
dÚ
't matter sinceheir CRC is invalid‡nways

32 
loÿl
 
pkt
 = 
buf
:
	`g‘TıPack‘
()

33 
pkt
:
	`fl
()

34 
’d


35 
	}
}

36 
n
 =‚ 
Ü
 
bufs
.
size


37 
loÿl
 
avgPack‘Size
 = 1.25 / (
rg‘R©e
 * 2) * 1000

38 
loÿl
 
mšPktSize
 = 
£lf
.
dev
.
mšPack‘Size
 
Ü
 64

39 
loÿl
 
maxPktR©e
 = 
£lf
.
dev
.
maxPack‘R©e
 
Ü
 14.88

40 -- 
®low
 
sm®Ër
 
·ck‘s
 
©
 
low
 
¿‹s


41 
rg‘R©e
 < 
maxPktR©e
 / 2 
th’


42 
mšPktSize
 = minPktSize + 20

44 
mšPktSize
 = 
m©h
.
æoÜ
(10 * 10^9 / 10^6 / 8 / 
maxPktR©e
)

45 
’d


46 
C
.
	$moÚg’_£nd_®l_·ck‘s_w™h_d–ay_bad_üc
(
£lf
.
id
, s–f.
qid
, 
bufs
.
¬¿y
, 
n
, 
mempoŞ
, 
mšPktSize
)

47  
bufs
.
size


48 
’d


50 --- 
S‘
 
the
 
time
 
to
 
wa™
 
befÜe
h
·ck‘
 
is
 
£Á
 
soáw¬e
 
¿‹
-
cÚŒŞËd
 
£nd
 
m‘hods
.

51 --- @
·¿m
 
d–ay
 
The
 
time
 
to
 
wa™
 
befÜe
 
this
 
·ck‘
 \(
š
 
by‹s
, 
i
.
e
. 1 =ğ0.8 
Çno£cÚds
 
Ú
 10 
GbE
\)

52 
funùiÚ
 
pkt
:
	$£tD–ay
(
d–ay
)

53 
£lf
.
ud©a64
 = 
d–ay


54 
’d


56 --- 
£ts
 
the
 
	$d–ay
 (
cf
. 
pkt
:
£tD–ay
è
to
 
m©ch
 
a
 
giv’
 
·ck‘
 
¿‹
 
š
 
Mµs


57 
funùiÚ
 
pkt
:
	$£tR©e
(
¿‹
)

58 
£lf
.
ud©a64
 = 10^10 / 8 / (
¿‹
 * 10^6è- s–f.
pkt_Ën
 - 24

59 
’d


61 
ffi
.
cdef
[[

62 
ušt64_t
 
	`moÚg’_g‘_bad_pkts_£Á
(
ušt8_t
 
pÜt_id
);

63 
ušt64_t
 
	`moÚg’_g‘_bad_by‹s_£Á
(
ušt8_t
 
pÜt_id
);

66 
loÿl
 
funùiÚ
 
	$hookTxSts
(
dev
)

67 
dev
.
__txStsHooked
 
th’


69 
’d


70 
dev
.
__txStsHooked
 = 
Œue


71 
loÿl
 
Şd
 = 
dev
.
g‘TxSts


72 
Şd
 
th’


73 
dev
.
g‘TxSts
 = 
	$funùiÚ
(
£lf
)

74 
loÿl
 
pkts
, 
by‹s
 = 
	$Şd
(
£lf
)

75 
loÿl
 
badPkts
 = 
	`tÚumb”
(
C
.
	$moÚg’_g‘_bad_pkts_£Á
(
£lf
.
id
))

76 
loÿl
 
badBy‹s
 = 
	`tÚumb”
(
C
.
	$moÚg’_g‘_bad_by‹s_£Á
(
£lf
.
id
))

77  
pkts
 - 
badPkts
, 
by‹s
 - 
badBy‹s


78 
’d


79 
’d


80 
’d


82 
	$hookTxSts
(
deviû
)

83 
driv”
, 
dev
 
š
 
	`·œs
(
	`»quœe
("drivers")) do

84 
	$to¡ršg
(
driv”
):
	`m©ch
("^Ãt_"è
ªd
 
	`ty³
(
dev
è=ğ"bË" 
th’


85 
	$hookTxSts
(
dev
)

86 
’d


87 
’d


	@/home/asabzi/msc-project/MoonGen-1/lua/hmap.lua

1 --- 
The
 
code
 
Üigš©es
 
äom
 
pud–koMs
 
FlowScİe
 
	g´ojeù
, 
¥ecifiÿÎy
 
this
 
	gfe
: 
h‰ps
:

2 --- 
This
 
v”siÚ
 
has
 
b“n
 
¦ighy
 
modif›d
 
to
 
wÜk
 
tog‘h”
 
w™h
 
MoÚG’
/
libmoÚ
 
š¡—d
 
of
 
FlowScİe
/
æowŒack”


4 
loÿl
 
ffi
 = 
»quœe
 "ffi"

5 
loÿl
 
log
 = 
»quœe
 "log"

6 
loÿl
 
C
 = 
ffi
.C

8 
loÿl
 
hm­Tem¶©e
 = [[

9 
	shm­k
{
key_size
}
v
{
v®ue_size
} 
hm­k
{key_size}v{value_size};

10 
	shm­k
{
key_size
}
v
{
v®ue_size
}
_acûssÜ
 
hm­k
{key_size}v{value_size}_accessor;

11 
hm­k
{
key_size
}
v
{
v®ue_size
}* hm­k{key_size}v{v®ue_size}
_ü—‹
();

12 
hm­k
{
key_size
}
v
{
v®ue_size
}
_d–‘e
(hm­k{key_size}v{v®ue_size}* 
m­
);

13 
hm­k
{
key_size
}
v
{
v®ue_size
}
_ş—r
(hm­k{key_size}v{v®ue_size}* 
m­
);

14 
hm­k
{
key_size
}
v
{
v®ue_size
}
_acûssÜ
* hm­k{key_size}v{v®ue_size}
_Ãw_acûssÜ
();

15 
hm­k
{
key_size
}
v
{
v®ue_size
}
_acûssÜ_ä“
(hm­k{key_size}v{v®ue_size}
_acûssÜ
* 
a
);

16 
hm­k
{
key_size
}
v
{
v®ue_size
}
_acûssÜ_»Ëa£
(hm­k{key_size}v{v®ue_size}
_acûssÜ
* 
a
);

17 
boŞ
 
hm­k
{
key_size
}
v
{
v®ue_size
}
_acûss
(hm­k{key_size}v{v®ue_size}* 
m­
, hm­k{key_size}v{v®ue_size}
_acûssÜ
* 
a
, cÚ¡ * 
key
);

18 
boŞ
 
hm­k
{
key_size
}
v
{
v®ue_size
}
_fšd
(hm­k{key_size}v{v®ue_size}* 
m­
, hm­k{key_size}v{v®ue_size}
_acûssÜ
* 
a
, cÚ¡ * 
key
);

19 
boŞ
 
hm­k
{
key_size
}
v
{
v®ue_size
}
_”a£
(hm­k{key_size}v{v®ue_size}* 
m­
, hm­k{key_size}v{v®ue_size}
_acûssÜ
* 
a
);

20 
ušt8_t
* 
hm­k
{
key_size
}
v
{
v®ue_size
}
_acûssÜ_g‘_v®ue
(hm­k{key_size}v{v®ue_size}
_acûssÜ
* 
a
);

21 
ušt32_t
 
hm­k
{
key_size
}
v
{
v®ue_size
}
_ş—n
(hm­k{key_size}v{v®ue_size}* 
m­
, 
ušt64_t
 
th»ash
);

24 
loÿl
 
	gmoduË
 = {}

26 
loÿl
 
keySizes
 = { 8, 16, 32, 64 }

27 
loÿl
 
v®ueSizes
 = { 8, 16, 32, 64, 128 }

29 -- 
G‘
 
tbb
 
hash
 
m­
 
w™h
 
f™tšg
 
key
 
ªd
 
v®ue
 
size


30 
funùiÚ
 
moduË
.
	$ü—‹Hashm­
(
keySize
, 
v®ueSize
)

31 
loÿl
 
»®KeySize
, 
»®V®ueSize
 = 0, 0

32 
keySize
 <ğ8 
th’


33 
»®KeySize
 = 8

34 
–£if
 
keySize
 <ğ16 
th’


35 
»®KeySize
 = 16

36 
–£if
 
keySize
 <ğ32 
th’


37 
»®KeySize
 = 32

38 
–£if
 
keySize
 <ğ64 
th’


39 
»®KeySize
 = 64

41 
log
:
	`”rÜ
("HashM­: Key oàsiz%d‡»‚Ù suµÜ‹d", 
keySize
)

42  
n


43 
’d


44 
v®ueSize
 <ğ8 
th’


45 
»®V®ueSize
 = 8

46 
–£if
 
v®ueSize
 <ğ16 
th’


47 
»®V®ueSize
 = 16

48 
–£if
 
v®ueSize
 <ğ32 
th’


49 
»®V®ueSize
 = 32

50 
–£if
 
v®ueSize
 <ğ64 
th’


51 
»®V®ueSize
 = 64

52 
–£if
 
v®ueSize
 <ğ128 
th’


53 
»®V®ueSize
 = 128

55 
log
:
	`”rÜ
("HashM­: V®ue oàsiz%d‡»‚Ù suµÜ‹d", 
v®ueSize
)

56  
n


57 
’d


59  
C
["hm­k" .. 
»®KeySize
 .. "v" .. 
»®V®ueSize
 .. "_create"]()

60 
’d


62 
funùiÚ
 
	$makeHashm­FÜ
(
keySize
, 
v®ueSize
)

63 
loÿl
 
m­
 = {
	}
}

64 
funùiÚ
 
m­
:
	$ş—r
()

65 
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_ş—r"](
£lf
)

66 
’d


67 
funùiÚ
 
m­
:
	$d–‘e
()

68 
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_d–‘e"](
£lf
)

69 
’d


70 
funùiÚ
 
m­
:
	$acûss
(
a
, 
l
)

71  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_acûss"](
£lf
, 
a
, 
l
)

72 
’d


73 
funùiÚ
 
m­
:
	$fšd
(
a
, 
l
)

74  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_fšd"](
£lf
, 
a
, 
l
)

75 
’d


76 
funùiÚ
 
m­
.
	$ÃwAcûssÜ
()

77  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_new_accessor"]()

78 
’d


79 
funùiÚ
 
m­
:
	$”a£
(
a
)

80  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_”a£"](
£lf
, 
a
)

81 
’d


82 
funùiÚ
 
m­
.
	$keyBufSize
()

83  
keySize


84 
’d


85 
funùiÚ
 
m­
.
	$v®ueSize
()

86  
v®ueSize


87 
’d


88 
funùiÚ
 
m­
:
	$ş—n
(
th»sh
)

89  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_ş—n"](
£lf
, 
th»sh
)

90 
’d


91 
loÿl
 
acûssÜ
 = {
	}
}

92 
funùiÚ
 
acûssÜ
:
	$g‘
()

93  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_acûssÜ_g‘_v®ue"](
£lf
)

94 
’d


95 
funùiÚ
 
acûssÜ
:
	$ä“
()

96  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_acûssÜ_ä“"](
£lf
)

97 
’d


98 
funùiÚ
 
acûssÜ
:
	$»Ëa£
()

99  
C
["hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_acûssÜ_»Ëa£"](
£lf
)

100 
’d


101 
m­
.
__šdex
 = map

102 
acûssÜ
.
__šdex
 =‡ccessor

103 
ffi
.
	`m‘©y³
("hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
, 
m­
)

104 
ffi
.
	`m‘©y³
("hm­k" .. 
keySize
 .. "v" .. 
v®ueSize
 .. "_acûssÜ", 
acûssÜ
)

105 
’d


107 
_
, 
k
 
š
 
	$·œs
(
keySizes
) do

108 
_
, 
v
 
š
 
	$·œs
(
v®ueSizes
) do

109 
loÿl
 
defš™iÚ
, 
_
 = 
hm­Tem¶©e
:
	`gsub
("{v®ue_size}", 
v
)

110 
defš™iÚ
, 
_
 = defš™iÚ:
	`gsub
("{key_size}", 
k
)

111 
ffi
.
	$cdef
(
defš™iÚ
)

112 
	$makeHashm­FÜ
(
k
, 
v
)

113 
’d


114 
’d


116 -- 
H–³r
 
funùiÚ
 
to
 
g‘
 
the
 
size
 
of
h
Ïrge¡
 
æow
 
key


117 -- 
¬gs
 
is
 
a
 
bË
 
of
 
hash
 
m­s


118 
funùiÚ
 
moduË
.
	$g‘L¬ge¡KeyBufSize
(
¬gs
)

119 
loÿl
 
sz
 = {
	}
}

120 
_
, 
v
 
š
 
	$aœs
(
¬gs
) do

121 
bË
.
	`š£¹
(
sz
, 
v
.
	$keyBufSize
())

122 
’d


123 
bË
.
	$sÜt
(
sz
)

124  
sz
[#sz]

125 
’d


127  
moduË


	@/home/asabzi/msc-project/MoonGen-1/lua/moongen-compat.lua

1 --- 
MoÚG’
 
	g´e
-1.0 
com·tib™y
 
Ïy”


3 
loÿl
 
	glog
 = 
»quœe
 "log"

4 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

5 
loÿl
 
moÚg’
 = 
»quœe
 "moongen"

6 
loÿl
 
deviû
 = 
»quœe
 "device"

8 
dpdk
.
__Çme
 = "dpdk"

9 
moÚg’
.
__Çme
 = "moongen"

11 -- 
make
 
funùiÚs
 
th©
 
w”e
 
moved
 
to
 
the
 
libmoÚs
/
moÚg’
 
moduË
 
avaabË


12 
loÿl
 
funùiÚ
 
	$d•»ÿ‹dFunùiÚ
(
ŞdMod
, 
ŞdName
, 
ÃwMod
, 
ÃwName
)

13 
ÃwName
 =‚ewNam
Ü
 
ŞdName


14 
ŞdMod
[
ŞdName
] = 
	$funùiÚ
(...)

15 
nÙ
 
ŞdMod
.
__d•»ÿ‹dW¬nšgs
 
th’


16 
ŞdMod
.
__d•»ÿ‹dW¬nšgs
 = {
	}
}

17 
’d


18 
nÙ
 
ŞdMod
.
__d•»ÿ‹dW¬nšgs
[
ŞdName
] 
th’


19 
log
:
w¬n
("%s.%s(èi d•»ÿ‹d, u£ %s.%s(èš¡—d.", 
ŞdMod
.
__Çme
, 
ŞdName
, 
ÃwMod
.__Çme, 
ÃwName
)

20 
	gŞdMod
.
	g__d•»ÿ‹dW¬nšgs
[
ŞdName
] = 
Œue


21 
’d


22  
ÃwMod
[
ÃwName
](...)

23 
’d


24 
’d


26 
d•»ÿ‹dFunùiÚ
(
dpdk
, "ÏunchLua", 
moÚg’
, "startTask")

27 
d•»ÿ‹dFunùiÚ
(
dpdk
, "ÏunchLuaOnCÜe", 
moÚg’
, "startTaskOnCore")

28 
d•»ÿ‹dFunùiÚ
(
dpdk
, "wa™FÜSÏves", 
moÚg’
, "waitForTasks")

29 
d•»ÿ‹dFunùiÚ
(
dpdk
, "g‘CÜes", 
moÚg’
)

30 
d•»ÿ‹dFunùiÚ
(
dpdk
, "g‘Cyşes", 
moÚg’
)

31 
d•»ÿ‹dFunùiÚ
(
dpdk
, "g‘CyşesF»qu’cy", 
moÚg’
)

32 
d•»ÿ‹dFunùiÚ
(
dpdk
, "g‘Time", 
moÚg’
)

33 
d•»ÿ‹dFunùiÚ
(
dpdk
, "£tRuÁime", 
moÚg’
)

34 
d•»ÿ‹dFunùiÚ
(
dpdk
, "ruÂšg", 
moÚg’
)

35 
d•»ÿ‹dFunùiÚ
(
dpdk
, "¡İ", 
moÚg’
)

36 
d•»ÿ‹dFunùiÚ
(
dpdk
, "¦“pMlis", 
moÚg’
)

37 
d•»ÿ‹dFunùiÚ
(
dpdk
, "¦“pMiüos", 
moÚg’
)

38 
d•»ÿ‹dFunùiÚ
(
dpdk
, "¦“pMlisIdË", 
moÚg’
)

39 
d•»ÿ‹dFunùiÚ
(
dpdk
, "¦“pMiüosIdË", 
moÚg’
)

40 
d•»ÿ‹dFunùiÚ
(
dpdk
, "g‘CÜe", 
moÚg’
)

41 
d•»ÿ‹dFunùiÚ
(
dpdk
, "di§bËBadSock‘W¬nšg", 
moÚg’
)

44 
loÿl
 
	gŞdCÚfig
 = 
deviû
.
cÚfig


46 
funùiÚ
 
deviû
.
	$cÚfig
(...)

47 
	`ty³
((...)è=ğ"numb”" 
th’


48 
loÿl
 
¬gs
 = {...
	}
}

49 -- 
this
 
is
 
Ëgacy
 
com·tib™y
 
wh’
 
ÿÎšg
 
the
 
funùiÚ
 
w™hout
 
Çmed
 
¬gum’ts


50 
log
:
w¬n
("device.config() without‚amed‡rguments is deprecated‡nd will be„emoved. See documentation for†ibmoons device.config().")

51 
nÙ
 
¬gs
[2] 
Ü
 
ty³
×rgs[2]è=ğ"numb”" 
th’


52 
¬gs
.
pÜt
 =‡rgs[1]

53 
¬gs
.
rxQueues
 =‡rgs[2]

54 
¬gs
.
txQueues
 =‡rgs[3]

55 
¬gs
.
rxDescs
 =‡rgs[4]

56 
¬gs
.
txDescs
 =‡rgs[5]

57 
¬gs
.
¥“d
 =‡rgs[6]

58 
¬gs
.
drİEÇbË
 =‡rgs[7]

59 -- 
ÿÎed
 
w™h
 
mempoŞ
 
which
 
was
 
chªged
 
to
 
	$mempoŞs
 (
Úe
 
³r
 
queue
)

60 
log
:
	`çl
("mempool option was„emoved. See†ibmoon device.config() forhe‚ew \"mempools\" option.")

61 
’d


62  
	$ŞdCÚfig
(
¬gs
)

63 
’d


64 
loÿl
 
¬gs
 = ...

65 
¬gs
.
rssNQueues
 
th’


66 
log
:
	`w¬n
("rssNQueues has been„enamedo„ssQueues, udate your script.")

67 
¬gs
.
rssQueues
 =‡rgs.
rssNQueues


68 
’d


69  
	$ŞdCÚfig
(...)

70 
’d


	@/home/asabzi/msc-project/MoonGen-1/lua/moongen-main.lua

2 -- 
com·tib™y
 
¡uff
 
d•»ÿ‹d
 
funùiÚs


3 
	g»quœe
 "moongen-compat"

5 -- 
lßd
 
	gmoÚg’
-
¥ecific
 
moduËs


6 
	g»quœe
 "software-timestamps"

7 
	g»quœe
 "crc-ratecontrol"

8 
	g»quœe
 "software-ratecontrol"

10 -- 
libmoÚ
 
	gmaš
, 
cÚšs
 
	$maš
()

11 
»quœe
 "main"

	@/home/asabzi/msc-project/MoonGen-1/lua/moongen.lua

1 
loÿl
 
	gmod
 = {}

3 
loÿl
 
lm
 = 
»quœe
 "libmoon"

5 -- 
add
 
moÚg’
-
¥ecific
 
funùiÚs
 
h”e


7 
£tm‘©abË
(
mod
, {
__šdex
 = 
lm
})

9  
	gmod


	@/home/asabzi/msc-project/MoonGen-1/lua/moonsniff-io.lua

1 --- 
Fa¡
 
pÿp
 
	gIO
, 
ÿn
 
	gwr™e
 > 40 
	gGb™
/
	$s
 (
to
 
fs
 
ÿche
è
ªd
 
»ad
 > 30 
	`Mµs
 (
äom
 fs cache).

2 --- 
R—d
/
wr™e
 
³rfÜmªû
 
ÿn
 
§tu¿‹
 
£v”®
 
NVMe
 
SSDs
 
äom
 
a
 
sšgË
 
cÜe
.

4 
loÿl
 
mod
 = {
	}
}

6 
loÿl
 
S
 = 
»quœe
 "syscall"

7 
loÿl
 
ffi
 = 
»quœe
 "ffi"

8 
loÿl
 
log
 = 
»quœe
 "log"

9 
loÿl
 
libmoÚ
 = 
»quœe
 "libmoon"

11 
loÿl
 
ÿ¡
 = 
ffi
.cast

12 
loÿl
 
C
 = 
ffi
.C

14 
ffi
.
cdef
 [[

16 
	sms_¡©s
 {

17 
št64_t
 
av”age_Ï‹ncy
;

18 
št64_t
 
v¬Ÿnû_Ï‹ncy
;

19 
ušt32_t
 
h™s
;

20 
ušt32_t
 
mis£s
;

21 
ušt32_t
 
šv®_ts
;

24 
ms_£t_th»sh
(
št64_t
 
th»sh
);

25 
ms_add_’Œy
(
ušt32_t
 
id’tifiÿtiÚ
, 
ušt64_t
 
time¡amp
);

26 
ms_‹¡_fÜ
(
ušt32_t
 
id’tifiÿtiÚ
, 
ušt64_t
 
time¡amp
);

27 
ms_¡©s
 
ms_ãtch_¡©s
();

28 
ms_log_pkts
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
queue_id
, 
¹e_mbuf
** 
rx_pkts
, ušt16_ˆ
nb_pkts
, 
ušt32_t
 
£qnum_off£t
, cÚ¡ * 
f’ame
);

31 
	smsÿp
 {

32 
ušt64_t
 
time¡amp
;

33 
ušt32_t
 
id’tifiÿtiÚ
;

37 
hs_š™Ÿlize
(
ušt32_t
 
buck‘_size
);

38 
hs_de¡roy
();

39 
boŞ
 
hs_upd©e
(
ušt64_t
 
Ãw_v®
);

40 
hs_fš®ize
();

41 
hs_wr™e
(cÚ¡ * 
f’ame
);

42 
št64_t
 
hs_g‘CouÁ
();

43 
hs_g‘M—n
();

44 
hs_g‘V¬Ÿnû
();

47 
loÿl
 
	gINITIAL_FILE_SIZE
 = 512 * 1024 * 1024

48 
loÿl
 
MSCAP_SIZE
 = 12 -- 
‹chniÿÎy
 16 
by‹s
, 
but
 
the
 
	gÏ¡
 4 
¬e
 
·ddšg


49 
loÿl
 
	gmsÿp_p
 = 
ffi
.
ty³of
("struct mscap*")

51 --- 
S‘
 
the
 
fe
 
size
 
Ãw
 
pÿp
 
wr™”s


52 --- @
·¿m
 
ÃwSizeInBy‹s
 
Ãw
 
fe
 
size
 
š
 
by‹s


53 
funùiÚ
 
mod
:
	$£tIn™ŸlFesize
(
ÃwSizeInBy‹s
)

54 
INITIAL_FILE_SIZE
 = 
ÃwSizeInBy‹s


55 
’d


57 
loÿl
 
wr™”
 = {
	}
}

58 
wr™”
.
__šdex
 = writer

60 --- 
C»©e
 
a
 
Ãw
 
ç¡
 
pÿp
 
wr™”
 
w™h
 
the
 
giv’
 
fe
 
Çme
.

61 --- 
C®l
 :
	$şo£
(è
Ú
 
the
 
wr™”
 
wh’
 
you
 
¬e
 
dÚe
.

62 --- @
·¿m
 
¡¬tTime
 
posix
 
time¡amp
, 
®l
 
time¡amps
 
of
 
š£¹ed
 
·ck‘s
 
wl
 
be
 
»Ïtive
 
to
 
this
imestamp

63 --- : 
»Ïtive
 
to
 
libmoÚ
.
	`g‘Time
() == 0

64 
funùiÚ
 
mod
:
	$ÃwWr™”
(
f’ame
, 
¡¬tTime
)

65 
¡¬tTime
 = s¹Tim
Ü
 
	`w®lTime
(è- 
libmoÚ
.
	$g‘Time
()

66 
loÿl
 
fd
 = 
S
.
	`İ’
(
f’ame
, "creat,„dwr,runc", "0666")

67 
nÙ
 
fd
 
th’


68 
log
:
	`çl
("could‚Ù c»©pÿ°fe: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

69 
’d


70 
fd
:
	$nogc
()

71 
loÿl
 
size
 = 
INITIAL_FILE_SIZE


72 
nÙ
 
S
.
	$çÎoÿ‹
(
fd
, 0, 0, 
size
è
th’


73 
log
:
	`çl
("çÎoÿ‹ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

74 
’d


75 
loÿl
 
±r
 = 
S
.
	`mm­
(
n
, 
size
, "wr™e", "sh¬ed,‚Üe£rve", 
fd
, 0)

76 
nÙ
 
±r
 
th’


77 
log
:
	`çl
("mm­ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

78 
’d


79 
loÿl
 
off£t
 = 0

80 
±r
 = 
	`ÿ¡
("uint8_t*",…tr)

81  
	`£tm‘©abË
({ 
fd
 = fd, 
±r
 =…Œ, 
size
 = size, 
off£t
 = off£t, 
¡¬tTime
 = s¹Time, 
f’ame
 = f’am
	}
}, 
	gwr™”
)

82 
’d


84 
funùiÚ
 
	gwr™”
:
	$»size
(
size
)

85 
nÙ
 
S
.
	$çÎoÿ‹
(
£lf
.
fd
, 0, 0, 
size
è
th’


86 
log
:
	`çl
("çÎoÿ‹ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

87 
’d


88 -- 
two
 
ways
 
to
 
´ev’t
 
MAP_MAYMOVE
 
h”e
 
someÚe
 
wªts
Ø
im¶em’t
 
this
:

89 -- 1è
mm­
 
a
 
Ïrge
 
vœtu®
 
add»ss
 
	`block
 (
ªd
 
u£
 
MAP_FIXED
 
to
 
nÙ
 
have
‡ 
huge
 
fe
)

90 -- 2è
unm­
 
the
 
whŞe
 
Şd
 
¬—
, 
mm­
 
Úly
h
Ãwly
 
®loÿ‹d
 
fe
 
	`¥aû
 (
ªd
h
Ï¡
 
·ge
 
of
hŞd 
¥aû
)

91 -- 
´obËm
 
w™h
 1 
is
: 
wa¡es
 
a
 
lÙ
 
of
 
vœtu®
 
add»ss
 
¥aû
, 
´obËm©ic
 
we
 
have
 
muÉË
 
wr™”s
 
©
 
the
 
§me
 
time


92 -- 
so
 
im¶em’t
 2è
you
 
ã–
 
like
 
	`™
 (
howev”
, 
I
 
hav’
't‚oticed big…roblems withhe current MAP_MAYMOVE implementation)

93 
loÿl
 
±r
 = 
S
.
	`m»m­
(
£lf
.±r, s–f.
size
, size, "maymove")

94 
nÙ
 
±r
 
th’


95 
log
:
	`çl
("m»m­ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

96 
’d


97 
£lf
.
±r
 = 
	`ÿ¡
("uint8_t*",…tr)

98 
£lf
.
size
 = size

99 
’d


101 --- 
Clo£
 
ªd
 
Œunÿ‹
 
the
 
fe
.

102 
funùiÚ
 
wr™”
:
	$şo£
()

103 
S
.
	$munm­
(
£lf
.
±r
, s–f.
size
)

104 
S
.
	$árunÿ‹
(
£lf
.
fd
, s–f.
off£t
)

105 
S
.
	$fsync
(
£lf
.
fd
)

106 
S
.
	$şo£
(
£lf
.
fd
)

107 
£lf
.
fd
 = 
n


108 
£lf
.
±r
 = 
n


109 
’d


111 --- 
Wr™e
 
a
 
·ck‘
 
to
 
the
 
pÿp
 
fe


112 --- @
·¿m
 
time¡amp
 
»Ïtive
 
to
 
the
ime¡am°
¥ecif›d
 
wh’
 
ü—tšg
h
fe


113 
funùiÚ
 
wr™”
:
	$wr™e
(
id’tifiÿtiÚ
, 
time¡amp
)

114 
£lf
.
off£t
 + 
MSCAP_SIZE
 >ğ£lf.
size
 
th’


115 
£lf
:
	$»size
(
£lf
.
size
 * 2)

116 
’d


117 
loÿl
 
d¡
 = 
	`ÿ¡
(
msÿp_p
, 
£lf
.
±r
 + s–f.
off£t
)

118 
d¡
.
id’tifiÿtiÚ
 = identification

119 
d¡
.
time¡amp
 =imestamp

120 
£lf
.
off£t
 = s–f.off£ˆ+ 
MSCAP_SIZE


121 
’d


123 
loÿl
 
»ad”
 = {
	}
}

124 
»ad”
.
__šdex
 =„eader

126 --- 
C»©e
 
a
 
Ãw
 
ç¡
 
pÿp
 
»ad”
 
the
 
giv’
 
fe
 
Çme
.

127 --- 
C®l
 :
	$şo£
(è
Ú
 
the
 
»ad”
 
wh’
 
you
 
¬e
 
dÚe
 
to
 
avoid
 
fd
 
Ëakage
.

128 
funùiÚ
 
mod
:
	$ÃwR—d”
(
f’ame
)

129 
loÿl
 
fd
 = 
S
.
	`İ’
(
f’ame
, "rdonly")

130 
nÙ
 
fd
 
th’


131 
log
:
	`çl
("could‚Ù o³Àpÿ°fe: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

132 
’d


133 
loÿl
 
size
 = 
fd
:
	`¡©
().size

134 
fd
:
	$nogc
()

135 
loÿl
 
±r
 = 
S
.
	`mm­
(
n
, 
size
, "»ad", "´iv©e", 
fd
, 0)

136 
nÙ
 
±r
 
th’


137 
log
:
	`çl
("mm­ faed: %s", 
	`¡rE¼Ü
(
S
.
	$”ºo
()))

138 
’d


139 
loÿl
 
off£t
 = 0

140 
±r
 = 
	`ÿ¡
("uint8_t*",…tr)

141  
	`£tm‘©abË
({ 
fd
 = fd, 
±r
 =…Œ, 
size
 = size, 
off£t
 = off£ˆ
	}
}, 
	g»ad”
)

142 
	g’d


144 --- 
R—d
 
the
 
Ãxt
 
·ck‘
 
što
 
a
 
	gbuf
,h
time¡amp
 
is
 
¡Üed
 
š
h
ud©a64
 
f›ld
 
as
 
	gmiüo£cÚds
.

145 --- 
The
 
	gbufãr
's…acket size correspondsohe original…acket size, cut off bytes‡re zero-filled.

146 
funùiÚ
 
	g»ad”
:
	$»adSšgË
()

147 
loÿl
 
feRemaššg
 = 
£lf
.
size
 - s–f.
off£t


148 
feRemaššg
 < 
MSCAP_SIZE
 
th’
 -- 
h—d”
 
size


149  
n


150 
’d


152 
loÿl
 
msÿp
 = 
	`ÿ¡
(
msÿp_p
, 
£lf
.
±r
 + s–f.
off£t
)

153 
£lf
.
off£t
 = s–f.off£ˆ+ 
MSCAP_SIZE


154  
msÿp


155 
’d


157 
funùiÚ
 
»ad”
:
	$şo£
()

158 
S
.
	$munm­
(
£lf
.
±r
, s–f.
size
)

159 
S
.
	$şo£
(
£lf
.
fd
)

160 
£lf
.
fd
 = 
n


161 
£lf
.
±r
 = 
n


162 
’d


164  
mod


	@/home/asabzi/msc-project/MoonGen-1/lua/software-ratecontrol.lua

1 
loÿl
 
	gffi
 = 
»quœe
 "ffi"

2 
loÿl
 
pe
 = 
»quœe
 "pipe"

3 
loÿl
 
mg
 = 
»quœe
 "moongen"

4 
loÿl
 
£½’t
 = 
»quœe
 "Serpent"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
log
 = 
»quœe
 "log"

8 
loÿl
 
C
 = 
ffi
.C

10 
ffi
.
cdef
[[

11 
	s¿‹_lim™”_b©ch
 {

12 
št32_t
 
size
;

13 * 
bufs
[0];

16 
	slim™”_cÚŒŞ
 {

17 
ušt64_t
 
	mcouÁ
;

18 
ušt64_t
 
	m¡İ
;

21 
mg_¿‹_lim™”_maš_loİ
(
¹e_ršg
* 
ršg
, 
ušt8_t
 
deviû
, 
ušt16_t
 
queue
, 
ušt32_t
 
lšk_¥“d
, 
lim™”_cÚŒŞ
* 
ùl
);

22 
mg_¿‹_lim™”_cbr_maš_loİ
(
¹e_ršg
* 
ršg
, 
ušt8_t
 
deviû
, 
ušt16_t
 
queue
, 
ušt32_t
 
rg‘
, 
lim™”_cÚŒŞ
* 
ùl
);

23 
mg_¿‹_lim™”_poissÚ_maš_loİ
(
¹e_ršg
* 
ršg
, 
ušt8_t
 
deviû
, 
ušt16_t
 
queue
, 
ušt32_t
 
rg‘
, ušt32_ˆ
lšk_¥“d
, 
lim™”_cÚŒŞ
* 
ùl
);

26 
loÿl
 
	gmod
 = {}

27 
loÿl
 
¿‹Lim™”
 = {}

28 
mod
.
¿‹Lim™”
 =„ateLimiter

30 
¿‹Lim™”
.
__šdex
 =„ateLimiter

32 
funùiÚ
 
¿‹Lim™”
:
	$£nd
(
bufs
)

33 
»³©


34 
pe
:
	$£ndToPack‘Ršg
(
£lf
.
ršg
, 
bufs
è
th’


36 
’d


37 
uÁ
 
nÙ
 
mg
.
	$ruÂšg
()

38 
’d


40 
funùiÚ
 
¿‹Lim™”
:
	$£ndN
(
bufs
, 
n
)

41 
»³©


42 
pe
:
	$£ndToPack‘Ršg
(
£lf
.
ršg
, 
bufs
, 
n
è
th’


44 
’d


45 
uÁ
 
nÙ
 
mg
.
	$ruÂšg
()

46 
’d


48 -- 
¡İ
 
a
 
¿‹
 
lim™”
 
th»ad


49 -- 
you
 
mu¡
 
nÙ
  
to
 
u£
 
a
 
¡İ³d
 
¿‹
 
lim™”


50 
funùiÚ
 
¿‹Lim™”
:
	$¡İ
()

51 
£lf
.
ùl
.
¡İ
 = 1

52 
memÜy
.
	$ãnû
()

53 
’d


55 
funùiÚ
 
¿‹Lim™”
:
	$__£rŸlize
()

56  "»quœ'soáw¬e-¿‹cÚŒŞ';„‘uº " .. 
£½’t
.
	`addMt
(£½’t.
	`dumpRaw
(
£lf
), "»quœe('soáw¬e-¿‹cÚŒŞ').¿‹Lim™”"), 
Œue


57 
’d


59 --- 
C»©e
 
a
 
Ãw
 
¿‹
 
lim™”
 
th©
 
®lows
 
´eci£
 
š‹r
-
·ck‘
 
g­
 
g’”©iÚ
 
by
 
w¿µšg
‡ 
tx
 
queue
.

60 -- 
By
  
™
 
u£s
 
·ck‘
 
d–ay
 
šfÜm©iÚ
 
äom
 
buf
:
	`£tD–ay
().

61 -- 
Cª
 
Úly
 
be
 
ü—‹d
 
äom
 
the
 
ma¡”
 
sk
 
beÿu£
 
™
 
¥awns
 
a
 
£·¿‹
 
th»ad
.

62 -- @
·¿m
 
queue
 
the
 
w¿µed
 
tx
 queue

63 -- @
·¿m
 
mode
 
İtiÚ®
, 
e™h”
 "cbr", "poissÚ", 
Ü
 "cu¡om". 
DeçuÉs
 
to
 
cu¡om
.

64 -- @
·¿m
 
d–ay
 
İtiÚ®
, 
š‹r
-
d•¬tu»
 
time
 
š
 
Çno£cÚds
 
cbr
, 1/
	$Ïmbda
 (
av”age
è
poissÚ


65 
funùiÚ
 
mod
:
	$Ãw
(
queue
, 
mode
, 
d–ay
)

66 
mode
 = mod
Ü
 "custom"

67 
mode
 ~ğ"poissÚ" 
ªd
 mod~ğ"cbr"‡nd mod~ğ"cu¡om" 
th’


68 
log
:
	`çl
("UnsuµÜ‹d mod" .. 
mode
)

69 
’d


70 
loÿl
 
ršg
 = 
pe
:
	$ÃwPack‘Ršg
()

71 
loÿl
 
obj
 = 
	`£tm‘©abË
({

72 
ršg
 =„ing.ring,

73 
mode
 = mode,

74 
d–ay
 = delay,

75 
queue
 = queue,

76 
ùl
 = 
memÜy
.
	`®loc
("¡ruù†im™”_cÚŒŞ*", 
ffi
.("struct†imiter_control"))

77 
	}
}, 
	g¿‹Lim™”
)

78 
	gffi
.
fl
(
obj
.
ùl
, 
ffi
.("struct†imiter_control"))

79 
	gmg
.
¡¬tTask
("__MG_RATE_LIMITER_MAIN", 
obj
.
ršg
, 
queue
.
id
, queue.
qid
, 
mode
, 
d–ay
, queue.
dev
:
g‘LškStus
().
¥“d
, obj.
ùl
)

80  
obj


81 
’d


84 
funùiÚ
 
	$__MG_RATE_LIMITER_MAIN
(
ršg
, 
devId
, 
qid
, 
mode
, 
d–ay
, 
¥“d
, 
ùl
)

85 
mode
 =ğ"cbr" 
th’


86 
C
.
	$mg_¿‹_lim™”_cbr_maš_loİ
(
ršg
, 
devId
, 
qid
, 
d–ay
, 
ùl
)

87 
–£if
 
mode
 =ğ"poissÚ" 
th’


88 
C
.
	$mg_¿‹_lim™”_poissÚ_maš_loİ
(
ršg
, 
devId
, 
qid
, 
d–ay
, 
¥“d
, 
ùl
)

90 
C
.
	$mg_¿‹_lim™”_maš_loİ
(
ršg
, 
devId
, 
qid
, 
¥“d
, 
ùl
)

91 
’d


92 
’d


94  
mod


	@/home/asabzi/msc-project/MoonGen-1/lua/software-timestamps.lua

1 
loÿl
 
	gdeviû
 = 
»quœe
 "device"

2 
loÿl
 
ffi
 = 
»quœe
 "ffi"

3 
loÿl
 
pkt
 = 
»quœe
 "packet"

4 
»quœe
 "dpdkc" -- 
defš™iÚs


6 
loÿl
 
txQueue
 = 
deviû
.
__txQueuePrÙÙy³


7 
loÿl
 
C
 = 
ffi
.C

8 
loÿl
 
ušt64PŒ
 = 
ffi
.
ty³of
("uint64_t*")

10 
ffi
.
cdef
[[

11 
moÚg’_£nd_·ck‘_w™h_time¡amp
(
ušt8_t
 
pÜt_id
, 
ušt16_t
 
queue_id
, 
¹e_mbuf
* 
pkt
, ušt16_ˆ
offs
);

14 --- 
S’d
 
a
 
sšgË
 
time¡am³d
 
	g·ck‘


15 -- @
·¿m
 
bufs
 
	gbufA¼ay
, 
Úly
 
the
 
fœ¡
 
·ck‘
 
š
 
™
 
wl
 
be
 
	g£Á


16 -- @
·¿m
 
offs
 
off£t
 
š
 
the
 
·ck‘
 
©
 
which
h
time¡amp
 
wl
 
be
 
	gwr™‹n
. wÈb
®igÃd
 
to
 
a
 
ušt64_t


17 
funùiÚ
 
	gtxQueue
:
	$£ndW™hTime¡amp
(
bufs
, 
offs
)

18 
£lf
.
u£d
 = 
Œue


19 
offs
 = off 
ªd
 off / 8 
Ü
 6 -- 
fœ¡
 8-
by‹
 
®igÃd
 
v®ue
 
š
 
UDP
 
·ylßd


20 
C
.
	$moÚg’_£nd_·ck‘_w™h_time¡amp
(
£lf
.
id
, s–f.
qid
, 
bufs
.
¬¿y
[0], 
offs
)

21 
’d


23 
funùiÚ
 
pkt
:
	$g‘Soáw¬eTxTime¡amp
(
offs
)

24 
loÿl
 
offs
 = off 
ªd
 off / 8 
Ü
 6 --  
äom
 
£ndW™hTime¡amp


25  
	`ušt64PŒ
(
£lf
:
	`g‘D©a
())[
offs
]

26 
’d


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/backtoback.lua

1 
	g·ckage
.
	g·th
 = 
·ckage
.
·th
 .. "rfc2544/?.lua"

3 
loÿl
 
¡ªd®Úe
 = 
çl£


4 
ma¡”
 =ğ
n
 
th’


5 
¡ªd®Úe
 = 
Œue


6 
ma¡”
 = "dummy"

7 
’d


9 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

10 
loÿl
 
memÜy
 = 
»quœe
 "memory"

11 
loÿl
 
deviû
 = 
»quœe
 "device"

12 
loÿl
 
ts
 = 
»quœe
 "timestamping"

13 
loÿl
 
f‹r
 = 
»quœe
 "filter"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
b¬r›r
 = 
»quœe
 "barrier"

16 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

17 
loÿl
 
tim”
 = 
»quœe
 "timer"

18 
loÿl
 
Çme¥aûs
 = 
»quœe
 "namespaces"

19 
loÿl
 
uts
 = 
»quœe
 "utils.utils"

20 
loÿl
 
tikz
 = 
»quœe
 "utils.tikz"

24 
loÿl
 
UDP_PORT
 = 42

26 
loÿl
 
b’chm¬k
 = {}

27 
b’chm¬k
.
__šdex
 = benchmark

29 
funùiÚ
 
b’chm¬k
.
	$ü—‹
()

30 
loÿl
 
£lf
 = 
	`£tm‘©abË
({
	}
}, 
	gb’chm¬k
)

31 
	g£lf
.
	gš™Ÿlized
 = 
çl£


32  
£lf


33 
’d


34 
£tm‘©abË
(
b’chm¬k
, {
__ÿÎ
 = b’chm¬k.
ü—‹
})

36 
funùiÚ
 
	gb’chm¬k
:
	$š™
(
¬g
)

37 
£lf
.
g¿nuÏr™y
 = 
¬g
.g¿nuÏr™y 
Ü
 100

38 
£lf
.
du¿tiÚ
 = 
¬g
.du¿tiÚ 
Ü
 2

39 
£lf
.
numI‹¿tiÚs
 = 
¬g
.numI‹¿tiÚ 
Ü
 50

41 
£lf
.
rxQueues
 = 
¬g
.rxQueues

42 
£lf
.
txQueues
 = 
¬g
.txQueues

44 
£lf
.
skCÚf
 = 
¬g
.skipConf

45 
£lf
.
dut
 = 
¬g
.dut

47 
£lf
.
š™Ÿlized
 = 
Œue


48 
’d


50 
funùiÚ
 
b’chm¬k
:
	$cÚfig
()

51 
£lf
.
undoSck
 = {
	}
}

52 
uts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifIn
, "198.18.1.1", 24)

53 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifIn
, "198.18.1.1", 24}})

55 
	guts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifOut
, "198.19.1.1", 24)

56 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifOut
, "198.19.1.1", 24}})

57 
’d


59 
funùiÚ
 
	gb’chm¬k
:
	$undoCÚfig
()

60 
loÿl
 
Ën
 = #£lf.
undoSck


61 
k
, 
v
 
š
 
	$aœs
(
£lf
.
undoSck
) do

62 --
wÜk
 
š
 
¡ack
 
Üd”


63 
loÿl
 
–em
 = 
£lf
.
undoSck
[
Ën
 - 
k
 + 1]

64 
–em
.
	`foo
(
	$uÅack
(
–em
.
¬gs
))

65 
’d


66 --
ş—r
 
¡ack


67 
£lf
.
undoSck
 = {
	}
}

68 
’d


70 
funùiÚ
 
b’chm¬k
:
	$g‘CSVH—d”
()

71 
loÿl
 
¡r
 = "frameSize,precision,linkspeed,duration"

72 
™”©iÚ
=1, 
£lf
.
numI‹¿tiÚs
 do

73 
¡r
 = sŒ .. ",bur¡siz™”" .. 
™”©iÚ


74 
’d


75  
¡r


76 
’d


78 
funùiÚ
 
b’chm¬k
:
	$»suÉToCSV
(
»suÉ
)

79 
¡r
 = 
»suÉ
.
äameSize
 .. "," .. 
£lf
.
g¿nuÏr™y
 .. "," .. s–f.
txQueues
[1].
dev
:
	`g‘LškStus
().
¥“d
 .. "," .. s–f.
du¿tiÚ
 .. "s"

80 
™”©iÚ
=1, 
£lf
.
numI‹¿tiÚs
 do

81 
¡r
 = sŒ .. "," .. 
»suÉ
[
™”©iÚ
]

82 
’d


83  
¡r


84 
’d


86 
funùiÚ
 
b’chm¬k
:
	$toTikz
(
f’ame
, ...)

87 
loÿl
 
v®ues
 = {
	}
}

89 
loÿl
 
numResuÉs
 = 
£Ëù
("#", ...)

90 
	gi
=1, 
numResuÉs
 do

91 
loÿl
 
	g»suÉ
 = 
	$£Ëù
(
i
, ...)

93 
loÿl
 
avg
 = 0

94 
loÿl
 
numV®s
 = 0

95 
_
, 
v
 
š
 
	$aœs
(
»suÉ
) do

96 
avg
 =‡vg + 
v


97 
numV®s
 =‚umVals + 1

98 
’d


99 
avg
 =‡vg / 
numV®s


101 
bË
.
	`š£¹
(
v®ues
, {
k
 = 
»suÉ
.
äameSize
, 
v
 = 
avg
})

102 
’d


103 
	gbË
.
sÜt
(
v®ues
, 
	$funùiÚ
(
e1
, 
e2
èƒ1.
k
 <ƒ2.k 
’d
)

106 
loÿl
 
xtick
 = ""

107 
loÿl
 
t64
 = 
çl£


108 
loÿl
 
Ï¡
 = -
m©h
.
huge


109 
k
, 
p
 
š
 
	$aœs
(
v®ues
) do

110 ià(
p
.
k
 - 
Ï¡
è>ğ128 
th’


111 
xtick
 = xtick .. 
p
.
k


112 
v®ues
[
k
 + 1] 
th’


113 
xtick
 = xtick .. ","

114 
’d


115 
Ï¡
 = 
p
.
k


116 
’d


117 
’d


119 
loÿl
 
img
 = 
tikz
.
	`Ãw
(
f’ame
 .. ".tikz", [[
xÏb–
={
·ck‘
 
size
 [
by‹
]
	}
}, 
	gyÏb–
={
bur¡
 siz[·ck‘]}, 
	ggrid
=
bÙh
, 
	gymš
=0, 
	gxmš
=0, 
	gxtick
={]] .. 
xtick
 .. [[},
sÿËd
 
ticks
=
çl£
, 
width
=9c
m
, 
height
=4cm, 
cyşe
 
li¡
 
Çme
=
exÙic
]])

121 
img
:
	$¡¬tPlÙ
()

122 
_
, 
p
 
š
 
	$aœs
(
v®ues
) do

123 
img
:
	$addPošt
(
p
.
k
,….
v
)

124 
’d


125 
img
:
	`’dPlÙ
("average burst size")

127 
img
:
	$¡¬tPlÙ
()

128 
_
, 
p
 
š
 
	$aœs
(
v®ues
) do

129 
loÿl
 
v
 = 
m©h
.
	`û
((
£lf
.
txQueues
[1].
dev
:
	`g‘LškStus
().
¥“d
 * 10^6 / ((
p
.
k
 + 20è* 8)è* s–f.
du¿tiÚ
)

130 
img
:
	$addPošt
(
p
.
k
, 
v
)

131 
’d


132 
img
:
	`fš®ize
("max burst size")

133 
’d


135 
funùiÚ
 
b’chm¬k
:
	$b’ch
(
äameSize
)

136 
nÙ
 
£lf
.
š™Ÿlized
 
th’


137  
	`´št
("benchmark‚ot initialized");

138 
–£if
 
äameSize
 =ğ
n
 
th’


139  
	`”rÜ
("benchmark got invalid frameSize");

140 
’d


142 
nÙ
 
£lf
.
skCÚf
 
th’


143 
£lf
:
	$cÚfig
()

144 
’d


146 
loÿl
 
pÜt
 = 
UDP_PORT


147 
loÿl
 
b¬
 = 
b¬r›r
.
	$Ãw
(2)

148 
loÿl
 
»suÉs
 = {
äameSize
 = 
	}
frameSize}

151 
™”©iÚ
=1, 
	g£lf
.
numI‹¿tiÚs
 do

152 
´štf
("¡¬tšg i‹¿tiÚ %d fÜ f¿msiz%d", 
™”©iÚ
, 
äameSize
)

154 
loÿl
 
	glßdSÏve
 = 
dpdk
.
ÏunchLua
("backtobackLßdSÏve", 
£lf
.
txQueues
[1], 
äameSize
, 
n
, 
b¬
, s–f.
g¿nuÏr™y
, s–f.
du¿tiÚ
)

155 
loÿl
 
	gcouÁ”SÏve
 = 
dpdk
.
ÏunchLua
("backtobackCouÁ”SÏve", 
£lf
.
rxQueues
[1], 
äameSize
, 
b¬
, s–f.
g¿nuÏr™y
, s–f.
du¿tiÚ
)

157 
loÿl
 
	glÚge¡S
 = 
lßdSÏve
:
	$wa™
()

158 
loÿl
 
lÚge¡R
 = 
couÁ”SÏve
:
	$wa™
()

160 
lÚge¡
 ~ğ
lßdSÏve
:
	$wa™
(è
th’


161 
	`´štf
("WARNING:†ßdSÏvªd couÁ”SÏv»pÜ‹d difã»Á bur¡ size (£nd”=%d,„eûiv”=%d)", 
lÚge¡S
, 
lÚge¡R
)

162 
»suÉs
[
™”©iÚ
] = -1

164 
»suÉs
[
™”©iÚ
] = 
lÚge¡S


165 
	`´štf
("™”©iÚ %d:†Úge¡ bur¡: %d", 
™”©iÚ
, 
lÚge¡S
)

166 
’d


167 
’d


169 
nÙ
 
£lf
.
skCÚf
 
th’


170 
£lf
:
	$undoCÚfig
()

171 
’d


173  
»suÉs


174 
’d


176 
loÿl
 
r¢s
 = 
Çme¥aûs
.
	$g‘
()

178 
funùiÚ
 
	$£ndBur¡
(
numPkts
, 
mem
, 
queue
, 
size
, 
pÜt
, 
modFoo
)

179 
loÿl
 
£Á
 = 0

180 
loÿl
 
bufs
 = 
mem
:
	$bufA¼ay
(64)

181 
loÿl
 
¡İ
 = 
numPkts
 - (numPkts % 64)

182 
dpdk
.
	$ruÂšg
(è
ªd
 
£Á
 < 
¡İ
 do

183 
bufs
:
	$®loc
(
size
)

184 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

185 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

186 
pkt
.
udp
:
	$£tD¡PÜt
(
pÜt
)

187 
’d


188 
bufs
:
	$ofæßdUdpChecksums
()

189 
£Á
 = s’ˆ+ 
queue
:
	$£nd
(
bufs
)

191 
’d


192 
numPkts
 ~ğ
¡İ
 
th’


193 
bufs
 = 
mem
:
	`bufA¼ay
(
numPkts
 % 64)

194 
bufs
:
	$®loc
(
size
)

195 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

196 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

197 
pkt
.
udp
:
	$£tD¡PÜt
(
pÜt
)

198 
’d


199 
bufs
:
	$ofæßdUdpChecksums
()

200 
£Á
 = s’ˆ+ 
queue
:
	$£nd
(
bufs
)

201 
’d


202  
£Á


203 
’d


205 
funùiÚ
 
	$backtobackLßdSÏve
(
queue
, 
äameSize
, 
modif›r
, 
b¬
, 
g¿nuÏr™y
, 
du¿tiÚ
)

206 
loÿl
 
‘hD¡
 = 
¬p
.
	`blockšgLookup
("198.18.1.1", 10)

207 --
TODO
: 
”rÜ
 
Ú
 
timeout


209 -- 
g’
 
·ylßd
 
‹m¶©e
 
sugge¡ed
 
by
 
RFC2544


210 
loÿl
 
udpPaylßdL’
 = 
äameSize
 - 46

211 
loÿl
 
udpPaylßd
 = 
ffi
.
	`Ãw
("ušt8_t[?]", 
udpPaylßdL’
)

212 
i
 = 0, 
udpPaylßdL’
 - 1 do

213 
udpPaylßd
[
i
] = 
b™
.
	$bªd
(
i
, 0xf)

214 
’d


216 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

217 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

218 
pkt
:
fl
{

219 
pktL’gth
 = 
äameSize
 - 4, -- 
£lf
 
£ts
 
®l
 
Ëngth
 
h—d”s
 
f›lds
 
š
‡Î 
u£d
 
´ÙocŞs
, -4 
FCS


220 
‘hSrc
 = 
queue
, -- 
g‘
 
the
 
¤c
 
mac
 
äom
h
deviû


221 
‘hD¡
 =ƒthDst,

222 -- 
dÛs
 
nÙ
 
afãù
 
³rfÜmªû
, 
as
 
£lf
 
fl
 
is
 
dÚe
 
befÜe
 
ªy
 
·ck‘
 i 
£Á


223 
4Src
 = "198.18.1.2",

224 
4D¡
 = "198.19.1.2",

225 
udpSrc
 = 
UDP_PORT
,

226 -- 
udpSrc
 
wl
 
be
 
£t
 
Ï‹r
 
as
 
™
 
v¬›s


227 
	}
}

228 -- 
fl
 
udp
 
·ylßd
 
w™h
 
´•¬ed
 udp…ayload

229 
	gffi
.
	$cİy
(
pkt
.
·ylßd
, 
udpPaylßd
, 
udpPaylßdL’
)

230 
’d
)

232 --
wa™
 
couÁ”
 
¦ave


233 
b¬
:
	`wa™
()

234 --
TODO
: 
dœty
 
wÜk¬ound
 
»£‰šg
 
a
 
b¬r›r


235 
dpdk
.
	$¦“pMiüos
(100)

236 
b¬
:
	$»š™
(2)

238 
loÿl
 
lškS³ed
 = 
queue
.
dev
:
	`g‘LškStus
().
¥“d


239 
loÿl
 
maxPkts
 = 
m©h
.
	`û
((
lškS³ed
 * 10^6 / ((
äameSize
 + 20è* 8)è* 
du¿tiÚ
è-- 
theÜ‘iÿl
 
max
 
·ck‘s
 
£nd
 
š
 
about
 `du¿tiÚ` 
£cÚds
 
w™h
 
lšk¥“d


240 
loÿl
 
couÁ
 = 
maxPkts


241 
loÿl
 
lÚge¡
 = 0

242 
loÿl
 
bšS—rch
 = 
uts
.
	$bš¬yS—rch
(0, 
maxPkts
)

243 
loÿl
 
fœ¡
 = 
Œue


246 
dpdk
.
	$ruÂšg
() do

247 
loÿl
 
t
 = 
tim”
.
	$Ãw
(0.5)

248 
queue
:
	$£tR©e
(10)

249 
t
:
	$ruÂšg
() do

250 
	`£ndBur¡
(64, 
mem
, 
queue
, 
äameSize
 - 4, 
UDP_PORT
+1)

251 
’d


252 
queue
:
	$£tR©e
(
lškS³ed
)

254 
loÿl
 
£Á
 = 
	`£ndBur¡
(
couÁ
, 
mem
, 
queue
, 
äameSize
 - 4, 
UDP_PORT
)

256 
r¢s
.
£Á
 = sent

258 
b¬
:
	`wa™
()

259 --
TODO
: 
fix
 
b¬r›r
 
»£t


260 -- 
»š™
 
š‹rã»s
 
w™h
 
wa™


261 
dpdk
.
	$¦“pMiüos
(100)

262 
b¬
:
	`»š™
(2)

264 -- dØ
a
 
bš¬y
 
£¬ch


265 -- 
throw
 
away
 
fœt
 
Œy


266 
fœ¡
 
th’


267 
fœ¡
 = 
çl£


269 
loÿl
 
tİ
 = 
£Á
 =ğ
r¢s
.
»ûived


270 --
g‘
 
Ãxt
 
¿‹


271 
loÿl
 
ÃxtCouÁ
, 
fšished
 = 
bšS—rch
:
	`Ãxt
(
couÁ
, 
tİ
, 
g¿nuÏr™y
)

272 -- 
upd©e
 
lÚge¡


273 
lÚge¡
 = (
tİ
 
ªd
 
couÁ
è
Ü
†ongest

274 
fšished
 
th’


276 
’d


277 
	`´štf
("lßdSÏve: s’ˆ%d‡nd„eûived %d => chªgšg from %dØ%d", 
£Á
, 
r¢s
.
»ûived
, 
couÁ
, 
ÃxtCouÁ
)

278 
couÁ
 = 
ÃxtCouÁ


279 
’d


280 
dpdk
.
	$¦“pMlis
(2000)

281 
’d


282  
lÚge¡


283 
’d


285 
funùiÚ
 
	$backtobackCouÁ”SÏve
(
queue
, 
äameSize
, 
b¬
, 
g¿nuÏr™y
, 
du¿tiÚ
)

287 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

289 
loÿl
 
maxPkts
 = 
m©h
.
	`û
((
queue
.
dev
:
	`g‘LškStus
().
¥“d
 * 10^6 / ((
äameSize
 + 20è* 8)è* 
du¿tiÚ
è-- 
theÜ‘iÿl
 
max
 
·ck‘s
 
£nd
 
š
 
about
 `du¿tiÚ` 
£cÚds
 
w™h
 
lšk¥“d


290 
loÿl
 
couÁ
 = 
maxPkts


291 
loÿl
 
lÚge¡
 = 0

292 
loÿl
 
bšS—rch
 = 
uts
.
	$bš¬yS—rch
(0, 
maxPkts
)

293 
loÿl
 
fœ¡
 = 
Œue


296 
loÿl
 
t
 = 
tim”
:
	$Ãw
(0.5)

297 
t
:
	$ruÂšg
() do

298 
queue
:
	$ŒyRecv
(
bufs
, 100)

299 
bufs
:
	$ä“AÎ
()

300 
’d


302 -- 
wa™
 
£nd”
 
to
 
be
 
»ady


303 
b¬
:
	$wa™
()

304 
dpdk
.
	$ruÂšg
() do

305 
loÿl
 
tim”
 =im”:
	`Ãw
(
du¿tiÚ
 + 2)

306 
loÿl
 
couÁ”
 = 0

308 
tim”
:
	$ruÂšg
() do

309 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 1000)

310 
i
 = 1, 
rx
 do

311 
loÿl
 
buf
 = 
bufs
[
i
]

312 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

313 
pkt
.
udp
:
	`g‘D¡PÜt
(è=ğ
UDP_PORT
 
th’


314 
couÁ”
 = counter + 1

315 
’d


316 
’d


317 
bufs
:
	$ä“AÎ
()

318 
couÁ”
 >ğ
couÁ
 
th’


320 
’d


321 
’d


322 
r¢s
.
»ûived
 = 
couÁ”


324 -- 
wa™
 
£nd”
 -> 
bÙh
 
»Ãwed
 
v®ue
 
š
 
r¢s


325 
b¬
:
	`wa™
()

327 -- dØ
a
 
bš¬y
 
£¬ch


328 -- 
throw
 
away
 
fœt
 
Œy


329 
fœ¡
 
th’


330 
fœ¡
 = 
çl£


332 
loÿl
 
tİ
 = 
couÁ”
 =ğ
r¢s
.
£Á


333 --
g‘
 
Ãxt
 
¿‹


334 
loÿl
 
ÃxtCouÁ
, 
fšished
 = 
bšS—rch
:
	`Ãxt
(
couÁ
, 
tİ
, 
g¿nuÏr™y
)

335 -- 
upd©e
 
lÚge¡


336 
lÚge¡
 = (
tİ
 
ªd
 
couÁ
è
Ü
†ongest

337 
fšished
 
th’


339 
’d


340 
	`´štf
("couÁ”SÏve: s’ˆ%d‡nd„eûived %d => chªgšg from %dØ%d", 
r¢s
.
£Á
, 
couÁ”
, 
couÁ
, 
ÃxtCouÁ
)

341 
couÁ
 = 
ÃxtCouÁ


342 
’d


343 
dpdk
.
	$¦“pMlis
(2000)

344 
’d


345  
lÚge¡


346 
’d


348 --
¡ªd®Úe
 
b’chm¬k


349 
¡ªd®Úe
 
th’


350 
funùiÚ
 
	$ma¡”
()

351 
loÿl
 
¬gs
 = 
uts
.
	$·r£Argum’ts
(
¬g
)

352 
loÿl
 
txPÜt
, 
rxPÜt
 = 
¬gs
.
txpÜt
,‡rgs.
rxpÜt


353 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 
th’


354  
	`´št
("usage: --txport <txport> --rxport <rxport> --duration <duration> --iterations <num iterations>")

355 
’d


357 
loÿl
 
rxDev
, 
txDev


358 
txPÜt
 =ğ
rxPÜt
 
th’


359 -- 
£ndšg
 
ªd
 
»ûivšg
 
äom
 
the
 
§me
 
pÜt


360 
txDev
 = 
deviû
.
	`cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 4
	}
})

361 
	grxDev
 = 
txDev


363 -- 
two
 
difã»Á
 
pÜts
, difã»Á 
cÚfigu¿tiÚ


364 
	gtxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 4})

365 
	grxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
rxPÜt
, 
rxQueues
 = 2, 
txQueues
 = 3})

366 
’d


367 
	gdeviû
.
	$wa™FÜLšks
()

368 
txPÜt
 =ğ
rxPÜt
 
th’


369 
dpdk
.
	`ÏunchLua
(
¬p
.
¬pTask
, {

371 
txQueue
 = 
txDev
:
	`g‘TxQueue
(0),

372 
rxQueue
 = 
txDev
:
	`g‘RxQueue
(1),

373 
s
 = {"198.18.1.2", "198.19.1.2"}

375 
	}
})

377 
	gdpdk
.
ÏunchLua
(
¬p
.
¬pTask
, {

379 
txQueue
 = 
txDev
:
g‘TxQueue
(0),

380 
rxQueue
 = 
txDev
:
g‘RxQueue
(1),

381 
s
 = {"198.18.1.2"}

384 
txQueue
 = 
rxDev
:
g‘TxQueue
(0),

385 
rxQueue
 = 
rxDev
:
g‘RxQueue
(1),

386 
s
 = {"198.19.1.2", "198.18.1.1"}

389 
’d


392 
loÿl
 
	gb’ch
 = 
	$b’chm¬k
()

393 
b’ch
:
	`š™
({

394 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1)},

395 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(0)},

396 
g¿nuÏr™y
 = 100,

397 
du¿tiÚ
 = 
¬gs
.duration,

398 
numI‹¿tiÚs
 = 
¬gs
.
™”©iÚs
,

399 
skCÚf
 = 
Œue
,

400 
	}
})

402 
´št
(
b’ch
:
	$g‘CSVH—d”
())

403 
loÿl
 
»suÉs
 = {
	}
}

404 
loÿl
 
FRAME_SIZES
 = {64, 128, 256, 512, 1024, 1280, 1518}

405 
_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

406 
loÿl
 
»suÉ
 = 
b’ch
:
	`b’ch
(
äameSize
)

407 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


408 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

409 
	`´št
(
b’ch
:
	$»suÉToCSV
(
»suÉ
))

410 
’d


411 
b’ch
:
	`toTikz
("btb", 
	$uÅack
(
»suÉs
))

412 
’d


413 
’d


415 
loÿl
 
mod
 = {
	}
}

416 
mod
.
__šdex
 = mod

418 
mod
.
b’chm¬k
 = benchmark

419  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/frameloss.lua

1 
	g·ckage
.
	g·th
 = 
·ckage
.
·th
 .. "rfc2544/?.lua"

3 
loÿl
 
¡ªd®Úe
 = 
çl£


4 
ma¡”
 =ğ
n
 
th’


5 
¡ªd®Úe
 = 
Œue


6 
ma¡”
 = "dummy"

7 
’d


9 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

10 
loÿl
 
memÜy
 = 
»quœe
 "memory"

11 
loÿl
 
deviû
 = 
»quœe
 "device"

12 
loÿl
 
ts
 = 
»quœe
 "timestamping"

13 
loÿl
 
f‹r
 = 
»quœe
 "filter"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
b¬r›r
 = 
»quœe
 "barrier"

16 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

17 
loÿl
 
tim”
 = 
»quœe
 "timer"

18 
loÿl
 
¡©s
 = 
»quœe
 "stats"

19 
loÿl
 
uts
 = 
»quœe
 "utils.utils"

20 
loÿl
 
tikz
 = 
»quœe
 "utils.tikz"

23 
loÿl
 
UDP_PORT
 = 42

25 
loÿl
 
b’chm¬k
 = {}

26 
b’chm¬k
.
__šdex
 = benchmark

28 
funùiÚ
 
b’chm¬k
.
	$ü—‹
()

29 
loÿl
 
£lf
 = 
	`£tm‘©abË
({
	}
}, 
	gb’chm¬k
)

30 
	g£lf
.
	gš™Ÿlized
 = 
çl£


31  
£lf


32 
’d


33 
£tm‘©abË
(
b’chm¬k
, {
__ÿÎ
 = b’chm¬k.
ü—‹
})

35 
funùiÚ
 
	gb’chm¬k
:
	$š™
(
¬g
)

36 
£lf
.
du¿tiÚ
 = 
¬g
.du¿tiÚ 
Ü
 10

37 
£lf
.
g¿nuÏr™y
 = 
¬g
.g¿nuÏr™y 
Ü
 0.05

39 
£lf
.
rxQueues
 = 
¬g
.rxQueues

40 
£lf
.
txQueues
 = 
¬g
.txQueues

42 
£lf
.
skCÚf
 = 
¬g
.skipConf

43 
£lf
.
dut
 = 
¬g
.dut

45 
£lf
.
š™Ÿlized
 = 
Œue


46 
’d


48 
funùiÚ
 
b’chm¬k
:
	$cÚfig
()

49 
£lf
.
undoSck
 = {
	}
}

50 
uts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifIn
, "198.18.1.1", 24)

51 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifIn
, "198.18.1.1", 24}})

53 
	guts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifOut
, "198.19.1.1", 24)

54 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifOut
, "198.19.1.1", 24}})

55 
’d


57 
funùiÚ
 
	gb’chm¬k
:
	$undoCÚfig
()

58 
loÿl
 
Ën
 = #£lf.
undoSck


59 
k
, 
v
 
š
 
	$aœs
(
£lf
.
undoSck
) do

60 --
wÜk
 
š
 
¡ack
 
Üd”


61 
loÿl
 
–em
 = 
£lf
.
undoSck
[
Ën
 - 
k
 + 1]

62 
–em
.
	`foo
(
	$uÅack
(
–em
.
¬gs
))

63 
’d


64 --
ş—r
 
¡ack


65 
£lf
.
undoSck
 = {
	}
}

66 
’d


68 
funùiÚ
 
b’chm¬k
:
	$g‘CSVH—d”
()

69 
loÿl
 
¡r
 = "percent of†ink„ate,frame size,duration,received…ackets,sent…ackets,frameloss in %"

70  
¡r


71 
’d


73 
funùiÚ
 
b’chm¬k
:
	$»suÉToCSV
(
»suÉ
)

74 
loÿl
 
¡r
 = ""

75 
k
,
v
 
š
 
	$aœs
(
»suÉ
) do

76 
¡r
 = sŒ .. 
v
.
muÉi
 .. "," .. v.
size
 .. "," .. 
£lf
.
du¿tiÚ
 .. "," .. v.
½kts
 .. "," .. v.
¥kts
 .. "," .. (v.spkts - v.rpkts) / (v.spkts) * 100

77 
»suÉ
[
k
+1] 
th’


78 
¡r
 = str .. "\n"

79 
’d


80 
’d


81  
¡r


82 
’d


84 
funùiÚ
 
b’chm¬k
:
	$toTikz
(
f’ame
, ...)

85 
loÿl
 
æ
 = 
tikz
.
	`Ãw
(
f’ame
 .. "_³rûÁ" .. ".tikz", [[
xÏb–
={
lšk
 
¿‹
 [\%]
	}
}, 
	gyÏb–
={
äam–oss
 [\%]}, 
	ggrid
=
bÙh
, 
	gymš
=0, 
	gxmš
=0, 
	gxmax
=100,
sÿËd
 
	gticks
=
çl£
, 
	gwidth
=9c
m
, 
	gheight
=4cm, 
cyşe
 
li¡
 
	gÇme
=
exÙic
,
Ëg’d
 
	g¡yË
={
©
={(1.04,1)},
	gªchÜ
=
nÜth
 
we¡
}]])

86 
loÿl
 
	gth
 = 
tikz
.
Ãw
(
f’ame
 .. "_throughput" .. ".tikz", [[
xÏb–
={
ofã»d
 
lßd
 [
mµs
]}, 
yÏb–
={
throughput
 [mµs]}, 
grid
=
bÙh
, 
ymš
=0, 
xmš
=0, 
sÿËd
 
ticks
=
çl£
, 
width
=9c
m
, 
height
=4cm, 
cyşe
 
li¡
 
Çme
=
exÙic
,
Ëg’d
 
¡yË
={
©
={(1.02,1)},
ªchÜ
=
nÜth
 
we¡
}]])

88 
loÿl
 
	gnumResuÉs
 = 
£Ëù
("#", ...)

89 
	gi
=1, 
numResuÉs
 do

90 
loÿl
 
	g»suÉ
 = 
	$£Ëù
(
i
, ...)

92 
æ
:
	$¡¬tPlÙ
()

93 
th
:
	$¡¬tPlÙ
()

95 
loÿl
 
äameSize


96 
_
, 
p
 
š
 
	$aœs
(
»suÉ
) do

97 
äameSize
 = 
p
.
size


99 
æ
:
	`addPošt
(
p
.
muÉi
 * 100, (p.
¥kts
 -….
½kts
) /….spkts * 100)

101 
loÿl
 
ofã»dLßd
 = 
p
.
¥kts
 / 10^6 / 
£lf
.
du¿tiÚ


102 
loÿl
 
throughput
 = 
p
.
½kts
 / 10^6 / 
£lf
.
du¿tiÚ


103 
th
:
	$addPošt
(
ofã»dLßd
, 
throughput
)

104 
’d


105 
æ
:
	$addPošt
(0, 0)

106 
æ
:
	`’dPlÙ
(
äameSize
 .. " bytes")

108 
th
:
	$addPošt
(0, 0)

109 
th
:
	`’dPlÙ
(
äameSize
 .. " bytes")

111 
’d


112 
æ
:
	$fš®ize
()

113 
th
:
	$fš®ize
()

114 
’d


116 
funùiÚ
 
b’chm¬k
:
	$b’ch
(
äameSize
, 
maxLossR©e
)

117 
nÙ
 
£lf
.
š™Ÿlized
 
th’


118  
	`”rÜ
("benchmark‚ot initialized");

119 
–£if
 
äameSize
 =ğ
n
 
th’


120  
	`”rÜ
("benchmark got invalid frameSize");

121 
’d


123 
nÙ
 
£lf
.
skCÚf
 
th’


124 
£lf
:
	$cÚfig
()

125 
’d


127 
loÿl
 
maxLškR©e
 = 
£lf
.
txQueues
[1].
dev
:
	`g‘LškStus
().
¥“d


128 
loÿl
 
¿‹MuÉi
 = 1

129 
loÿl
 
b¬
 = 
b¬r›r
.
	$Ãw
(2)

130 
loÿl
 
»suÉs
 = {
	}
}

131 
loÿl
 
pÜt
 = 
UDP_PORT


132 
loÿl
 
Ï¡NoLo¡F¿me
 = 
çl£


134 -- 
loİ
 
uÁ
 
no
 
·ck‘loss


135 
dpdk
.
	$ruÂšg
(è
ªd
 
¿‹MuÉi
 >= 0.05 do

136 -- 
£t
 
¿‹


137 
loÿl
 
¿‹
 = 
maxLškR©e
 * 
¿‹MuÉi


139 -- 
wÜk¬ound
 
¿‹
 
bug


140 
loÿl
 
numQueues
 = 
¿‹
 > (64 * 64è/ (84 * 84è* 
maxLškR©e
 
ªd
„©< maxLškR©ªd 3 
Ü
 1

141 
b¬
:
	`»š™
(
numQueues
 + 1)

142 
¿‹
 < 
maxLškR©e
 
th’


143 -- 
nÙ
 
maxLškR©e


144 -- 
ev’tu®
 
muÉË
 
¦aves


145 -- 
£t
 
¿‹
 
is
 
·ylßd
„©
nÙ
 
wœe
„ate

146 
i
=1, 
numQueues
 do

147 
	`´štf
("£ˆqueu%˜tØ¿‹ %d", 
i
, 
¿‹
 * 
äameSize
 / (äameSiz+ 20è/ 
numQueues
)

148 
£lf
.
txQueues
[
i
]:
	`£tR©e
(
¿‹
 * 
äameSize
 / (äameSiz+ 20è/ 
numQueues
)

149 
’d


151 -- 
maxLškR©e


152 
£lf
.
txQueues
[1]:
	$£tR©e
(
¿‹
)

153 
’d


155 
loÿl
 
lßdTasks
 = {
	}
}

156 -- 
Œaffic
 
g’”©Ü


157 
i
=1, 
numQueues
 do

158 
	gbË
.
š£¹
(
lßdTasks
, 
dpdk
.
ÏunchLua
("äam–ossLßdSÏve", 
£lf
.
txQueues
[
i
], 
pÜt
, 
äameSize
, s–f.
du¿tiÚ
, 
mod
, 
b¬
))

159 
	g’d


161 -- 
couÁ
 
the
 
šcomšg
 
·ck‘s


162 
loÿl
 
	gùrTask
 = 
dpdk
.
ÏunchLua
("äam–ossCouÁ”SÏve", 
£lf
.
rxQueues
[1], 
pÜt
, 
äameSize
, s–f.
du¿tiÚ
, 
b¬
)

164 -- 
wa™
 
uÁ
 
®l
 
¦aves
 
¬e
 
fšished


165 
loÿl
 
	g¥kts
 = 0

166 
i
, 
lßdTask
 
š
 
	$aœs
(
lßdTasks
) do

167 
¥kts
 = spkt + 
lßdTask
:
	$wa™
()

168 
’d


169 
loÿl
 
½kts
 = 
ùrTask
:
	$wa™
()

172 
loÿl
 
–em
 = {
	}
}

173 
–em
.
muÉi
 = 
¿‹MuÉi


174 
–em
.
size
 = 
äameSize


175 
–em
.
¥kts
 = spkts

176 
–em
.
½kts
 =„pkts

177 
bË
.
	$š£¹
(
»suÉs
, 
–em
)

178 
	`´št
("¿‹="..
¿‹
..",Ù®Reûived="..
½kts
..",Ù®S’t="..
¥kts
..", frameLoss="..(spkts-rpkts)/spkts)

180 
loÿl
 
noLo¡F¿me
 = 
¥kts
 =ğ
½kts


181 
noLo¡F¿me
 
ªd
 
Ï¡NoLo¡F¿me
 
th’


183 
’d


184 
Ï¡NoLo¡F¿me
 = 
noLo¡F¿me


185 
¿‹MuÉi
 =„©eMuÉ˜- 
£lf
.
g¿nuÏr™y


186 
pÜt
 =…ort + 1

188 -- 
TODO
: 
maybe
 
wa™
 
»£‰Ëm’t
 
of
 
	$DUT
 (
RFC2544
)

190 
’d


192 
nÙ
 
£lf
.
skCÚf
 
th’


193 
£lf
:
	$undoCÚfig
()

194 
’d


196  
»suÉs


197 
’d


199 
funùiÚ
 
	$äam–ossLßdSÏve
(
queue
, 
pÜt
, 
äameSize
, 
du¿tiÚ
, 
modif›r
, 
b¬
)

200 
loÿl
 
‘hD¡
 = 
¬p
.
	`blockšgLookup
("198.18.1.1", 10)

201 --
TODO
: 
”rÜ
 
Ú
 
timeout


203 --
wa™
 
couÁ”
 
¦ave


204 
b¬
:
	`wa™
()

206 -- 
g’
 
·ylßd
 
‹m¶©e
 
sugge¡ed
 
by
 
RFC2544


207 
loÿl
 
udpPaylßdL’
 = 
äameSize
 - 46

208 
loÿl
 
udpPaylßd
 = 
ffi
.
	`Ãw
("ušt8_t[?]", 
udpPaylßdL’
)

209 
i
 = 0, 
udpPaylßdL’
 - 1 do

210 
udpPaylßd
[
i
] = 
b™
.
	$bªd
(
i
, 0xf)

211 
’d


213 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

214 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

215 
pkt
:
fl
{

216 
pktL’gth
 = 
äameSize
 - 4, -- 
£lf
 
£ts
 
®l
 
Ëngth
 
h—d”s
 
f›lds
 
š
‡Î 
u£d
 
´ÙocŞs
, -4 
FCS


217 
‘hSrc
 = 
queue
, -- 
g‘
 
the
 
¤c
 
mac
 
äom
h
deviû


218 
‘hD¡
 =ƒthDst,

219 -- 
De¡
 
is
 
dyÇmiÿl
 
ü—‹d
 
™
 i 
ov”wr™‹n


220 -- 
dÛs
 
nÙ
 
afãù
 
³rfÜmªû
, 
as
 
£lf
 
fl
 
is
 
dÚe
 
befÜe
 
ªy
 
·ck‘
 i 
£Á


221 
4Src
 = "198.18.1.2",

222 
4D¡
 = "198.19.1.2",

223 
udpSrc
 = 
UDP_PORT
,

224 -- 
udpSrc
 
wl
 
be
 
£t
 
Ï‹r
 
as
 
™
 
v¬›s


225 
	}
}

226 -- 
fl
 
udp
 
·ylßd
 
w™h
 
´•¬ed
 udp…ayload

227 
	gffi
.
	$cİy
(
pkt
.
·ylßd
, 
udpPaylßd
, 
udpPaylßdL’
)

228 
’d
)

230 
loÿl
 
bufs
 = 
mem
:
	`bufA¼ay
()

231 --
loÿl
 
modif›rFoo
 = 
	$funùiÚ
 (è
’d
--
uts
.
	`g‘PktModif›rFunùiÚ
(
modif›r
, 
ba£Ip
, 
w¿pIp
, 
ba£Eth
, 
w¿pEth
)

233 -- 
TODO
: 
RFC2544
 
routšg
 
upd©es
 
rou‹r


234 -- 
£nd
 
Ë¬nšg
 
äames
:

235 -- 
ARP
 
IP


238 
loÿl
 
£ndBufs
 = 
	`funùiÚ
(
bufs
, 
pÜt
)

239 -- 
®loÿ‹
 
bufãrs
 
äom
 
the
 
mem
 
poŞ
 
ªd
 
¡Üe
 
them
 
š
 
£lf
 
¬¿y


240 
bufs
:
	`®loc
(
äameSize
 - 4)

242 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

243 
loÿl
 
pkt
 = 
buf
:
	`g‘UdpPack‘
()

244 -- 
£t
 
·ck‘
 
udp
 
pÜt


245 
pkt
.
udp
:
	`£tD¡PÜt
(
pÜt
)

246 -- 
­¶y
 
modif›r
 
like
 

 
Ü
 
mac
 
¿ndomi§tiÚ
 
to
 
·ck‘


247 --
	$modif›rFoo
(
pkt
)

248 
’d


249 -- 
£nd
 
·ck‘s


250 
bufs
:
	$ofæßdUdpChecksums
()

251  
queue
:
	$£nd
(
bufs
)

252 
’d


255 -- 
w¬mup
 
pha£
 
to
 
wake
 
up
 
ÿrd


256 
loÿl
 
tim”
 =im”:
	$Ãw
(0.1)

257 
tim”
:
	$ruÂšg
() do

258 
	`£ndBufs
(
bufs
, 
pÜt
 - 1)

259 
’d


261 -- 
b’chm¬k
 
pha£


262 
tim”
:
	$»£t
(
du¿tiÚ
)

263 
loÿl
 
tÙ®
 = 0

264 
tim”
:
	$ruÂšg
() do

265 
tÙ®
 =Ù® + 
	$£ndBufs
(
bufs
, 
pÜt
)

266 
’d


267 
	`´št
("idk why it hangs here if frameSize = 1518‡nd i dont…rint something")

268  
tÙ®


269 
’d


271 
funùiÚ
 
	$äam–ossCouÁ”SÏve
(
queue
, 
pÜt
, 
äameSize
, 
du¿tiÚ
, 
b¬
)

272 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

273 
loÿl
 
ùrs
 = {
	}
}

274 
b¬
:
	$wa™
()

276 
loÿl
 
tim”
 =im”:
	`Ãw
(
du¿tiÚ
 + 3)

277 -- 
loÿl
 
¡©s
 = 
»quœe
 "stats"

278 -- 
loÿl
 
rxCŒ
 = 
¡©s
:
	`ÃwDevRxCouÁ”
(
queue
.
dev
, "plain")

279 
tim”
:
	$ruÂšg
() do

280 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 100)

281 
i
 = 1, 
rx
 do

282 
loÿl
 
buf
 = 
bufs
[
i
]

283 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

284 
loÿl
 
pÜt
 = 
pkt
.
udp
:
	$g‘D¡PÜt
()

285 
ùrs
[
pÜt
] = (ùrs[pÜt] 
Ü
 0) + 1

287 
’d


288 -- 
rxCŒ
:
	$upd©e
()

289 
bufs
:
	$ä“AÎ
()

290 
’d


291 -- 
rxCŒ
:
	$fš®ize
()

292  
ùrs
[
pÜt
] 
Ü
 0

293 
’d


295 --
¡ªd®Úe
 
b’chm¬k


296 
¡ªd®Úe
 
th’


297 
funùiÚ
 
	$ma¡”
(
txPÜt
, 
rxPÜt
, 
du¿tiÚ
)

298 
loÿl
 
¬gs
 = 
uts
.
	$·r£Argum’ts
(
¬g
)

299 
loÿl
 
txPÜt
, 
rxPÜt
 = 
¬gs
.
txpÜt
,‡rgs.
rxpÜt


300 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 
th’


301  
	`´št
("usage: --txport <txport> --rxport <rxport> --duration <duration> --granularity <granularity>")

302 
’d


304 
loÿl
 
rxDev
, 
txDev


305 
txPÜt
 =ğ
rxPÜt
 
th’


306 -- 
£ndšg
 
ªd
 
»ûivšg
 
äom
 
the
 
§me
 
pÜt


307 
txDev
 = 
deviû
.
	`cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 4
	}
})

308 
	grxDev
 = 
txDev


310 -- 
two
 
difã»Á
 
pÜts
, difã»Á 
cÚfigu¿tiÚ


311 
	gtxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 4})

312 
	grxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
rxPÜt
, 
rxQueues
 = 2, 
txQueues
 = 3})

313 
’d


314 
	gdeviû
.
	$wa™FÜLšks
()

315 
txPÜt
 =ğ
rxPÜt
 
th’


316 
dpdk
.
	`ÏunchLua
(
¬p
.
¬pTask
, {

318 
txQueue
 = 
txDev
:
	`g‘TxQueue
(0),

319 
rxQueue
 = 
txDev
:
	`g‘RxQueue
(1),

320 
s
 = {"198.18.1.2", "198.19.1.2"}

322 
	}
})

324 
	gdpdk
.
ÏunchLua
(
¬p
.
¬pTask
, {

326 
txQueue
 = 
txDev
:
g‘TxQueue
(0),

327 
rxQueue
 = 
txDev
:
g‘RxQueue
(1),

328 
s
 = {"198.18.1.2"}

331 
txQueue
 = 
rxDev
:
g‘TxQueue
(0),

332 
rxQueue
 = 
rxDev
:
g‘RxQueue
(1),

333 
s
 = {"198.19.1.2", "198.18.1.1"}

336 
’d


338 
loÿl
 
	gb’ch
 = 
	$b’chm¬k
()

339 
b’ch
:
	`š™
({

340 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1),xDev:getTxQueue(2),xDev:getTxQueue(3)},

341 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(0)},

342 
du¿tiÚ
 = 
¬gs
.duration,

343 
g¿nuÏr™y
 = 
¬gs
.granularity,

344 
skCÚf
 = 
Œue
,

345 
	}
})

347 
´št
(
b’ch
:
	$g‘CSVH—d”
())

348 
loÿl
 
»suÉs
 = {
	}
}

349 
loÿl
 
FRAME_SIZES
 = {64, 128, 256, 512, 1024, 1280, 1518}

350 
_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

351 
loÿl
 
»suÉ
 = 
b’ch
:
	`b’ch
(
äameSize
)

352 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


353 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

354 
	`´št
(
b’ch
:
	$»suÉToCSV
(
»suÉ
))

355 
’d


356 
b’ch
:
	`toTikz
("äam–oss", 
	$uÅack
(
»suÉs
))

357 
’d


358 
’d


360 
loÿl
 
mod
 = {
	}
}

361 
mod
.
__šdex
 = mod

363 
mod
.
b’chm¬k
 = benchmark

364  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/latency.lua

1 
	g·ckage
.
	g·th
 = 
·ckage
.
·th
 .. "rfc2544/?.lua"

3 
loÿl
 
¡ªd®Úe
 = 
çl£


4 
ma¡”
 =ğ
n
 
th’


5 
¡ªd®Úe
 = 
Œue


6 
ma¡”
 = "dummy"

7 
’d


9 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

10 
loÿl
 
memÜy
 = 
»quœe
 "memory"

11 
loÿl
 
deviû
 = 
»quœe
 "device"

12 
loÿl
 
ts
 = 
»quœe
 "timestamping"

13 
loÿl
 
f‹r
 = 
»quœe
 "filter"

14 
loÿl
 
ffi
 = 
»quœe
 "ffi"

15 
loÿl
 
b¬r›r
 = 
»quœe
 "barrier"

16 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

17 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

18 
loÿl
 
tim”
 = 
»quœe
 "timer"

19 
loÿl
 
uts
 = 
»quœe
 "utils.utils"

20 
loÿl
 
tikz
 = 
»quœe
 "utils.tikz"

22 
loÿl
 
UDP_PORT
 = 42

24 
loÿl
 
b’chm¬k
 = {}

25 
b’chm¬k
.
__šdex
 = benchmark

27 
funùiÚ
 
b’chm¬k
.
	$ü—‹
()

28 
loÿl
 
£lf
 = 
	`£tm‘©abË
({
	}
}, 
	gb’chm¬k
)

29 
	g£lf
.
	gš™Ÿlized
 = 
çl£


30  
£lf


31 
’d


32 
£tm‘©abË
(
b’chm¬k
, {
__ÿÎ
 = b’chm¬k.
ü—‹
})

34 
funùiÚ
 
	gb’chm¬k
:
	$š™
(
¬g
)

35 
£lf
.
du¿tiÚ
 = 
¬g
.du¿tiÚ 
Ü
 10

37 
£lf
.
rxQueues
 = 
¬g
.rxQueues

38 
£lf
.
txQueues
 = 
¬g
.txQueues

40 
£lf
.
skCÚf
 = 
¬g
.skipConf

41 
£lf
.
dut
 = 
¬g
.dut

43 
£lf
.
š™Ÿlized
 = 
Œue


44 
’d


46 
funùiÚ
 
b’chm¬k
:
	$cÚfig
()

47 
£lf
.
undoSck
 = {
	}
}

48 
uts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifIn
, "198.18.1.1", 24)

49 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifIn
, "198.18.1.1", 24}})

51 
	guts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifOut
, "198.19.1.1", 24)

52 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifOut
, "198.19.1.1", 24}})

53 
’d


55 
funùiÚ
 
	gb’chm¬k
:
	$undoCÚfig
()

56 
loÿl
 
Ën
 = #£lf.
undoSck


57 
k
, 
v
 
š
 
	$aœs
(
£lf
.
undoSck
) do

58 --
wÜk
 
š
 
¡ack
 
Üd”


59 
loÿl
 
–em
 = 
£lf
.
undoSck
[
Ën
 - 
k
 + 1]

60 
–em
.
	`foo
(
	$uÅack
(
–em
.
¬gs
))

61 
’d


62 --
ş—r
 
¡ack


63 
£lf
.
undoSck
 = {
	}
}

64 
’d


66 
funùiÚ
 
b’chm¬k
:
	$g‘CSVH—d”
()

68 
’d


70 
funùiÚ
 
b’chm¬k
:
	$»suÉToCSV
(
»suÉ
)

71 
loÿl
 
¡r
 = ""

72 
»suÉ
:
	$ÿlc
()

73 
k
 ,
v
 
š
 
	$aœs
(
»suÉ
.
sÜ‹dHi¡o
) do

74 
¡r
 = sŒ .. 
v
.
k
 .. "," .. v.v .. "," .. 
»suÉ
.
äameSize
 .. "," ..„esuÉ.
¿‹
 .. "," .. 
£lf
.
du¿tiÚ


75 
»suÉ
.
sÜ‹dHi¡o
[
k
+1] 
th’


76 
¡r
 = str .. "\n"

77 
’d


78 
’d


79  
¡r


80 
’d


82 
funùiÚ
 
b’chm¬k
:
	$toTikz
(
f’ame
, ...)

83 
loÿl
 
cdf
 = 
tikz
.
	`Ãw
(
f’ame
 .. "_cdf" .. ".tikz", [[
xÏb–
={
Ï‹ncy
 [
$
\
mu$s
]
	}
}, 
	gyÏb–
={
CDF
}, 
	ggrid
=
bÙh
, 
	gymš
=0, 
	gymax
=1, 
m¬k
 
	g»³©
=100, 
sÿËd
 
	gticks
=
çl£
, 
no
 
	gm¬k”s
, 
	gwidth
=9c
m
, 
	gheight
=4cm,
cyşe
 
li¡
 
	gÇme
=
exÙic
]])

85 
loÿl
 
numResuÉs
 = 
£Ëù
("#", ...)

86 
	gi
=1, 
numResuÉs
 do

87 
loÿl
 
	g»suÉ
 = 
	$£Ëù
(
i
, ...)

88 
loÿl
 
hi¡o
 = 
tikz
.
	`Ãw
(
f’ame
 .. "_hi¡o" .. "_" .. 
»suÉ
.
äameSize
 .. ".tikz", [[
xÏb–
={
Ï‹ncy
 [
$
\
mu$s
]
	}
}, 
	gyÏb–
={
´obab™y
 [\%]}, 
	ggrid
=
bÙh
, 
yb¬
 
	gš‹rv®
, 
	gymš
=0, 
	gxtick
={}, 
sÿËd
 
	gticks
=
çl£
, 
tick
 
Ïb–
 
	g¡yË
={/
pgf
/
numb”
 
fÜm©
/
fixed
}, 
x
ick†ab– 
as
 iÁ”v®=çl£, 
	gwidth
=9c
m
, 
	gheight
=4cm ]])

89 
hi¡o
:
	$¡¬tPlÙ
([[
Üªge
, 
fl
=orange]])

90 
cdf
:
	$¡¬tPlÙ
()

92 
»suÉ
:
	$ÿlc
()

93 
loÿl
 
numSam¶es
 = 
»suÉ
.numSamples

94 
loÿl
 
q1
,
q2
,
q3
 = 
»suÉ
:
	$qu¬tes
()

95 
loÿl
 
mš
, 
max
 = 
»suÉ
.
sÜ‹dHi¡o
[1].
k
,„esult.sortedHisto[#result.sortedHisto].k

96 
loÿl
 
bšWidth
 = (
q3
 - 
q1
è/ (
numSam¶es
 ^ (1/2))

97 
loÿl
 
numBšs
 = 
m©h
.
	`û
((
max
 - 
mš
è/ 
bšWidth
) + 1

99 
loÿl
 
bšs
 = {
	}
}

100 
j
=1, 
numBšs
 do

101 
	gbšs
[
j
] = 0

102 
’d


103 
k
, 
v
 
š
 
	$·œs
(
»suÉ
.
hi¡o
) do

104 
loÿl
 
j
 = 
m©h
.
	`æoÜ
((
k
 - 
mš
è/ 
bšWidth
) + 1

105 
bšs
[
j
] = bšs[j] + 
v


106 
’d


108 
loÿl
 
sum
 = 0

109 
k
, 
v
 
š
 
	$aœs
(
bšs
) do

110 
loÿl
 
x
 = (
k
-1è* 
bšWidth
 + 
mš


111 
hi¡o
:
	`addPošt
(
x
 / 1000, 
v
 / 
numSam¶es
 * 100)

112 
sum
 = sum + 
v


113 
cdf
:
	`addPošt
(
x
 / 1000, 
sum
 / 
numSam¶es
)

114 
’d


116 
hi¡o
:
	$fš®ize
()

117 
cdf
:
	`’dPlÙ
(
»suÉ
.
äameSize
 .. "byte")

118 
’d


119 
cdf
:
	$fš®ize
()

120 
’d


122 
funùiÚ
 
b’chm¬k
:
	$b’ch
(
äameSize
, 
¿‹
)

123 
nÙ
 
£lf
.
š™Ÿlized
 
th’


124  
	`´št
("benchmark‚ot initialized");

125 
–£if
 
äameSize
 =ğ
n
 
th’


126  
	`”rÜ
("benchmark got invalid frameSize");

127 
’d


129 
nÙ
 
£lf
.
skCÚf
 
th’


130 
£lf
:
	$cÚfig
()

131 
’d


133 
loÿl
 
maxLškR©e
 = 
£lf
.
txQueues
[1].
dev
:
	`g‘LškStus
().
¥“d


134 
loÿl
 
b¬
 = 
b¬r›r
.
	$Ãw
(0)

135 
loÿl
 
pÜt
 = 
UDP_PORT


137 -- 
wÜk¬ound
 
¿‹
 
bug


138 
loÿl
 
numQueues
 = 
¿‹
 > (64 * 64è/ (84 * 84è* 
maxLškR©e
 
ªd
„©< maxLškR©ªd 3 
Ü
 1

139 
b¬
:
	`»š™
(
numQueues
 + 1)

140 
¿‹
 < 
maxLškR©e
 
th’


141 -- 
nÙ
 
maxLškR©e


142 -- 
ev’tu®
 
muÉË
 
¦aves


143 -- 
£t
 
¿‹
 
is
 
·ylßd
„©
nÙ
 
wœe
„ate

144 
i
=1, 
numQueues
 do

145 
	`´štf
("£ˆqueu%˜tØ¿‹ %d", 
i
, 
¿‹
 * 
äameSize
 / (äameSiz+ 20è/ 
numQueues
)

146 
£lf
.
txQueues
[
i
]:
	`£tR©e
(
¿‹
 * 
äameSize
 / (äameSiz+ 20è/ 
numQueues
)

147 
’d


149 -- 
maxLškR©e


150 
£lf
.
txQueues
[1]:
	$£tR©e
(
¿‹
)

151 
’d


153 -- 
Œaffic
 
g’”©Ü


154 
loÿl
 
lßdSÏves
 = {
	}
}

155 
i
=1, 
numQueues
 do

156 
	gbË
.
š£¹
(
lßdSÏves
, 
dpdk
.
ÏunchLua
("Ï‹ncyLßdSÏve", 
£lf
.
txQueues
[
i
], 
pÜt
, 
äameSize
, s–f.
du¿tiÚ
, 
mod
, 
b¬
))

157 
’d


159 
loÿl
 
	ghi¡
 = 
Ï‹ncyTim”SÏve
(
£lf
.
txQueues
[
numQueues
+1], s–f.
rxQueues
[1], 
pÜt
, 
äameSize
, s–f.
du¿tiÚ
, 
b¬
)

160 
	ghi¡
:
	$´št
()

162 
loÿl
 
¥kts
 = 0

163 
_
, 
¦
 
š
 
	$·œs
(
lßdSÏves
) do

164 
¥kts
 = spkt + 
¦
:
	$wa™
()

165 
’d


167 
nÙ
 
£lf
.
skCÚf
 
th’


168 
£lf
:
	$undoCÚfig
()

169 
’d


170 
hi¡
.
äameSize
 = frameSize

171 
hi¡
.
¿‹
 = 
¥kts
 / 10^6 / 
£lf
.
du¿tiÚ


172  
hi¡


173 
’d


175 
funùiÚ
 
	$Ï‹ncyLßdSÏve
(
queue
, 
pÜt
, 
äameSize
, 
du¿tiÚ
, 
modif›r
, 
b¬
)

176 
loÿl
 
‘hD¡
 = 
¬p
.
	`blockšgLookup
("198.18.1.1", 10)

177 --
TODO
: 
”rÜ
 
Ú
 
timeout


179 -- 
g’
 
·ylßd
 
‹m¶©e
 
sugge¡ed
 
by
 
RFC2544


180 
loÿl
 
udpPaylßdL’
 = 
äameSize
 - 46

181 
loÿl
 
udpPaylßd
 = 
ffi
.
	`Ãw
("ušt8_t[?]", 
udpPaylßdL’
)

182 
i
 = 0, 
udpPaylßdL’
 - 1 do

183 
udpPaylßd
[
i
] = 
b™
.
	$bªd
(
i
, 0xf)

184 
’d


186 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

187 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

188 
pkt
:
fl
{

189 
pktL’gth
 = 
äameSize
 - 4, -- 
£lf
 
£ts
 
®l
 
Ëngth
 
h—d”s
 
f›lds
 
š
‡Î 
u£d
 
´ÙocŞs
, -4 
FCS


190 
‘hSrc
 = 
queue
, -- 
g‘
 
the
 
¤c
 
mac
 
äom
h
deviû


191 
‘hD¡
 =ƒthDst,

192 
4D¡
 = "198.19.1.2",

193 
4Src
 = "198.18.1.2",

194 
udpSrc
 = 
SRC_PORT
,

195 
	}
}

196 -- 
fl
 
udp
 
·ylßd
 
w™h
 
´•¬ed
 udp…ayload

197 
	gffi
.
	$cİy
(
pkt
.
·ylßd
, 
udpPaylßd
, 
udpPaylßdL’
)

198 
’d
)

200 
loÿl
 
bufs
 = 
mem
:
	`bufA¼ay
()

201 --
loÿl
 
modif›rFoo
 = 
uts
.
	`g‘PktModif›rFunùiÚ
(
modif›r
, 
ba£Ip
, 
w¿pIp
, 
ba£Eth
, 
w¿pEth
)

203 -- 
TODO
: 
RFC2544
 
routšg
 
upd©es
 
rou‹r


204 -- 
£nd
 
Ë¬nšg
 
äames
:

205 -- 
ARP
 
IP


207 
loÿl
 
£ndBufs
 = 
	`funùiÚ
(
bufs
, 
pÜt
)

208 -- 
®loÿ‹
 
bufãrs
 
äom
 
the
 
mem
 
poŞ
 
ªd
 
¡Üe
 
them
 
š
 
£lf
 
¬¿y


209 
bufs
:
	`®loc
(
äameSize
 - 4)

211 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

212 
loÿl
 
pkt
 = 
buf
:
	`g‘UdpPack‘
()

213 -- 
£t
 
·ck‘
 
udp
 
pÜt


214 
pkt
.
udp
:
	`£tD¡PÜt
(
pÜt
)

215 -- 
­¶y
 
modif›r
 
like
 

 
Ü
 
mac
 
¿ndomi§tiÚ
 
to
 
·ck‘


216 -- 
	$modif›rFoo
(
pkt
)

217 
’d


218 -- 
£nd
 
·ck‘s


219 
bufs
:
	$ofæßdUdpChecksums
()

220  
queue
:
	$£nd
(
bufs
)

221 
’d


222 -- 
w¬mup
 
pha£
 
to
 
wake
 
up
 
ÿrd


223 
loÿl
 
t
 = 
tim”
:
	$Ãw
(0.1)

224 
t
:
	$ruÂšg
() do

225 
	`£ndBufs
(
bufs
, 
pÜt
 + 1)

226 
’d


229 -- 
sync
 
w™h
 
tim”SÏve


230 
b¬
:
	`wa™
()

232 -- 
b’chm¬k
 
pha£


233 
loÿl
 
tÙ®S’t
 = 0

234 
t
:
	`»£t
(
du¿tiÚ
 + 2)

235 
t
:
	$ruÂšg
() do

236 
tÙ®S’t
 =Ù®S’ˆ+ 
	$£ndBufs
(
bufs
, 
pÜt
)

237 
’d


238  
tÙ®S’t


239 
’d


241 
funùiÚ
 
	`Ï‹ncyTim”SÏve
(
txQueue
, 
rxQueue
, 
pÜt
, 
äameSize
, 
du¿tiÚ
, 
b¬
)

242 --
Time¡am³d
 
·ck‘s
 
mu¡
 
be
 > 80 
	`by‹s
 (+4c
rc
)

243 
äameSize
 = f¿meSiz> 84 
ªd
 f¿meSiz
Ü
 84

245 
loÿl
 
‘hD¡
 = 
¬p
.
	`blockšgLookup
("198.18.1.1", 10)

246 --
TODO
: 
”rÜ
 
Ú
 
timeout


248 
rxQueue
.
dev
:
	$f‹rTime¡amps
(
rxQueue
)

249 
loÿl
 
time¡am³r
 = 
ts
:
	$ÃwUdpTime¡am³r
(
txQueue
, 
rxQueue
)

250 
loÿl
 
hi¡
 = hi¡:
	$Ãw
()

251 
loÿl
 
¿‹Lim™
 = 
tim”
:
	`Ãw
(0.001)

253 -- 
sync
 
w™h
 
lßd
 
¦ave
 
ªd
 
wa™
 
add™iÚ®
 
ãw
 
mli£cÚds
 
to
 
’su»


254 -- 
the
 
Œaffic
 
g’”©Ü
 
has
 
¡¬‹d


255 
b¬
:
	$wa™
()

256 
dpdk
.
	$¦“pMlis
(1000)

258 
loÿl
 
t
 = 
tim”
:
	$Ãw
(
du¿tiÚ
)

259 
t
:
	$ruÂšg
() do

260 
hi¡
:
	`upd©e
(
time¡am³r
:
	`m—su»L©’cy
(
äameSize
 - 4, 
	$funùiÚ
(
buf
)

261 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

262 
pkt
:
	`fl
({

263 -- 
TODO
: 
time¡amp
 
Ú
 
difã»Á
 
IPs


264 
‘hSrc
 = 
txQueue
,

265 
‘hD¡
 =ƒthDst,

266 
4Src
 = "198.18.1.2",

267 
4D¡
 = "198.19.1.2",

268 
udpSrc
 = 
SRC_PORT
,

269 
udpD¡
 = 
pÜt
,

270 
pktL’gth
 = 
äameSize
 - 4

271 
	}
})

272 
	g’d
))

273 
	g¿‹Lim™
:
	$wa™
()

274 
¿‹Lim™
:
	$»£t
()

275 
’d


276  
hi¡


277 
’d


279 --
¡ªd®Úe
 
b’chm¬k


280 
¡ªd®Úe
 
th’


281 
funùiÚ
 
	$ma¡”
()

282 
loÿl
 
¬gs
 = 
uts
.
	$·r£Argum’ts
(
¬g
)

283 
loÿl
 
txPÜt
, 
rxPÜt
 = 
¬gs
.
txpÜt
,‡rgs.
rxpÜt


284 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 
th’


285  
	`´št
("usage: --txport <txport> --rxport <rxport> --duration <duration> --rate <rate>")

286 
’d


288 
loÿl
 
rxDev
, 
txDev


289 
txPÜt
 =ğ
rxPÜt
 
th’


290 -- 
£ndšg
 
ªd
 
»ûivšg
 
äom
 
the
 
§me
 
pÜt


291 
txDev
 = 
deviû
.
	`cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 3, 
txQueues
 = 5
	}
})

292 
	grxDev
 = 
txDev


294 -- 
two
 
difã»Á
 
pÜts
, difã»Á 
cÚfigu¿tiÚ


295 
	gtxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 5})

296 
	grxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
rxPÜt
, 
rxQueues
 = 3, 
txQueues
 = 1})

297 
’d


298 
	gdeviû
.
	$wa™FÜLšks
()

299 
txPÜt
 =ğ
rxPÜt
 
th’


300 
dpdk
.
	`ÏunchLua
(
¬p
.
¬pTask
, {

302 
txQueue
 = 
txDev
:
	`g‘TxQueue
(0),

303 
rxQueue
 = 
txDev
:
	`g‘RxQueue
(1),

304 
s
 = {"198.18.1.2", "198.19.1.2", "198.18.1.1"}

306 
	}
})

308 
	gdpdk
.
ÏunchLua
(
¬p
.
¬pTask
, {

310 
txQueue
 = 
txDev
:
g‘TxQueue
(0),

311 
rxQueue
 = 
txDev
:
g‘RxQueue
(1),

312 
s
 = {"198.18.1.2"}

315 
txQueue
 = 
rxDev
:
g‘TxQueue
(0),

316 
rxQueue
 = 
rxDev
:
g‘RxQueue
(1),

317 
s
 = {"198.19.1.2", "198.18.1.1", "198.18.1.1"}

320 
’d


322 
loÿl
 
	gb’ch
 = 
	$b’chm¬k
()

323 
b’ch
:
	`š™
({

324 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1),xDev:getTxQueue(2),xDev:getTxQueue(3),xDev:getTxQueue(4)},

325 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(2)},

326 
du¿tiÚ
 = 
¬gs
.duration,

327 
skCÚf
 = 
Œue
,

328 
	}
})

330 
´št
(
b’ch
:
	$g‘CSVH—d”
())

331 
loÿl
 
»suÉs
 = {
	}
}

332 
loÿl
 
FRAME_SIZES
 = {64, 128, 256, 512, 1024, 1280, 1518}

333 
_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

334 
loÿl
 
»suÉ
 = 
b’ch
:
	`b’ch
(
äameSize
, 
¬gs
.
¿‹
 
Ü
 5000)

335 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


336 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

337 
	`´št
(
b’ch
:
	$»suÉToCSV
(
»suÉ
))

338 
’d


339 
b’ch
:
	`toTikz
("Ï‹ncy", 
	$uÅack
(
»suÉs
))

340 
’d


341 
’d


343 
loÿl
 
mod
 = {
	}
}

344 
mod
.
__šdex
 = mod

346 
mod
.
b’chm¬k
 = benchmark

347  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/throughput.lua

1 
	g·ckage
.
	g·th
 = 
·ckage
.
·th
 .. "rfc2544/?.lua"

3 
loÿl
 
¡ªd®Úe
 = 
çl£


4 
ma¡”
 =ğ
n
 
th’


5 
¡ªd®Úe
 = 
Œue


6 
ma¡”
 = "dummy"

7 
’d


9 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

10 
loÿl
 
memÜy
 = 
»quœe
 "memory"

11 
loÿl
 
deviû
 = 
»quœe
 "device"

12 
loÿl
 
f‹r
 = 
»quœe
 "filter"

13 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
loÿl
 
b¬r›r
 = 
»quœe
 "barrier"

15 
loÿl
 
tim”
 = 
»quœe
 "timer"

16 
loÿl
 
uts
 = 
»quœe
 "utils.utils"

17 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

18 
loÿl
 
tikz
 = 
»quœe
 "utils.tikz"

20 
loÿl
 
UDP_PORT
 = 42

22 
loÿl
 
b’chm¬k
 = {}

23 
b’chm¬k
.
__šdex
 = benchmark

25 
funùiÚ
 
b’chm¬k
.
	$ü—‹
()

26 
loÿl
 
£lf
 = 
	`£tm‘©abË
({
	}
}, 
	gb’chm¬k
)

27 
	g£lf
.
	gš™Ÿlized
 = 
çl£


28  
£lf


29 
’d


30 
£tm‘©abË
(
b’chm¬k
, {
__ÿÎ
 = b’chm¬k.
ü—‹
})

32 
funùiÚ
 
	gb’chm¬k
:
	$š™
(
¬g
)

33 
£lf
.
du¿tiÚ
 = 
¬g
.du¿tiÚ 
Ü
 10

34 
£lf
.
¿‹Th»shŞd
 = 
¬g
.¿‹Th»shŞd 
Ü
 10

35 
£lf
.
maxLossR©e
 = 
¬g
.maxLossR©
Ü
 0.001

37 
£lf
.
rxQueues
 = 
¬g
.rxQueues

38 
£lf
.
txQueues
 = 
¬g
.txQueues

40 
£lf
.
numI‹¿tiÚs
 = 
¬g
.numI‹¿tiÚ 
Ü
 1

42 
£lf
.
skCÚf
 = 
¬g
.skipConf

43 
£lf
.
dut
 = 
¬g
.dut

45 
£lf
.
š™Ÿlized
 = 
Œue


46 
’d


48 
funùiÚ
 
b’chm¬k
:
	$cÚfig
()

49 
£lf
.
undoSck
 = {
	}
}

50 
uts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifIn
, "198.18.1.1", 24)

51 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifIn
, "198.18.1.1", 24}})

53 
	guts
.
addIÁ”çûIP
(
£lf
.
dut
.
ifOut
, "198.19.1.1", 24)

54 
	gbË
.
š£¹
(
£lf
.
undoSck
, {
foo
 = 
uts
.
d–IÁ”çûIP
, 
¬gs
 = {£lf.
dut
.
ifOut
, "198.19.1.1", 24}})

55 
’d


57 
funùiÚ
 
	gb’chm¬k
:
	$undoCÚfig
()

58 
loÿl
 
Ën
 = #£lf.
undoSck


59 
k
, 
v
 
š
 
	$aœs
(
£lf
.
undoSck
) do

60 --
wÜk
 
š
 
¡ack
 
Üd”


61 
loÿl
 
–em
 = 
£lf
.
undoSck
[
Ën
 - 
k
 + 1]

62 
–em
.
	`foo
(
	$uÅack
(
–em
.
¬gs
))

63 
’d


64 --
ş—r
 
¡ack


65 
£lf
.
undoSck
 = {
	}
}

66 
’d


68 
funùiÚ
 
b’chm¬k
:
	$g‘CSVH—d”
()

69 
loÿl
 
¡r
 = "frame size(byte),duration(s),max†oss„ate(%),ratehreshold(packets)"

70 
i
=1, 
£lf
.
numI‹¿tiÚs
 do

71 
¡r
 = sŒ .. "," .. "¿‹(mµsè™”" .. 
i
 .. ",spkts(byte) iter" .. i .. ",rpkts(byte) iter" .. i

72 
’d


73  
¡r


74 
’d


76 
funùiÚ
 
b’chm¬k
:
	$»suÉToCSV
(
»suÉ
)

77 
loÿl
 
¡r
 = ""

78 
i
=1, 
£lf
.
numI‹¿tiÚs
 do

79 
¡r
 = sŒ .. 
»suÉ
[
i
].
äameSize
 .. "," .. 
£lf
.
du¿tiÚ
 .. "," .. s–f.
maxLossR©e
 * 100 .. "," .. s–f.
¿‹Th»shŞd
 .. "," ..„esuÉ[i].
mµs
 .. "," ..„esuÉ[i].
¥kts
 .. "," ..„esuÉ[i].
½kts


80 
i
 < 
£lf
.
numI‹¿tiÚs
 
th’


81 
¡r
 = str .. "\n"

82 
’d


83 
’d


84  
¡r


85 
’d


87 
funùiÚ
 
b’chm¬k
:
	$toTikz
(
f’ame
, ...)

88 
loÿl
 
v®ues
 = {
	}
}

90 
loÿl
 
numResuÉs
 = 
£Ëù
("#", ...)

91 
	gi
=1, 
numResuÉs
 do

92 
loÿl
 
	g»suÉ
 = 
	$£Ëù
(
i
, ...)

94 
loÿl
 
avg
 = 0

95 
loÿl
 
numV®s
 = 0

96 
loÿl
 
äameSize


97 
_
, 
v
 
š
 
	$aœs
(
»suÉ
) do

98 
äameSize
 = 
v
.frameSize

99 
avg
 =‡vg + 
v
.
mµs


100 
numV®s
 =‚umVals + 1

101 
’d


102 
avg
 =‡vg / 
numV®s


104 
bË
.
	`š£¹
(
v®ues
, {
k
 = 
äameSize
, 
v
 = 
avg
})

105 
’d


106 
	gbË
.
sÜt
(
v®ues
, 
	$funùiÚ
(
e1
, 
e2
èƒ1.
k
 <ƒ2.k 
’d
)

109 
loÿl
 
xtick
 = ""

110 
loÿl
 
t64
 = 
çl£


111 
loÿl
 
Ï¡
 = -
m©h
.
huge


112 
k
, 
p
 
š
 
	$aœs
(
v®ues
) do

113 ià(
p
.
k
 - 
Ï¡
è>ğ128 
th’


114 
xtick
 = xtick .. 
p
.
k


115 
v®ues
[
k
 + 1] 
th’


116 
xtick
 = xtick .. ","

117 
’d


118 
Ï¡
 = 
p
.
k


119 
’d


120 
’d


123 
loÿl
 
imgMµs
 = 
tikz
.
	`Ãw
(
f’ame
 .. "_mµs" .. ".tikz", [[ 
xÏb–
={
·ck‘
 
size
 [
by‹
]
	}
}, 
	gyÏb–
={
¿‹
 [
Mµs
]}, 
	ggrid
=
bÙh
, 
	gymš
=0, 
	gxmš
=0, 
	gxtick
={]] .. 
xtick
 .. [[},
sÿËd
 
ticks
=
çl£
, 
width
=9c
m
, 
height
=4cm, 
cyşe
 
li¡
 
Çme
=
exÙic
]])

124 
loÿl
 
imgMbps
 = 
tikz
.
Ãw
(
f’ame
 .. "_mbps" .. ".tikz", [[ 
xÏb–
={
·ck‘
 
size
 [
by‹
]}, 
yÏb–
={
¿‹
 [
Gb™
/
s
]}, 
grid
=
bÙh
, 
ymš
=0, 
xmš
=0, 
xtick
={]] .. xtick .. [[},
sÿËd
 
ticks
=
çl£
, 
width
=9c
m
, 
height
=4cm, 
cyşe
 
li¡
 
Çme
=
exÙic
,
Ëg’d
 
¡yË
={
©
={(0.99,0.02)},
ªchÜ
=
south
 
—¡
}]])

126 
	gimgMµs
:
	$¡¬tPlÙ
()

127 
imgMbps
:
	$¡¬tPlÙ
()

128 
_
, 
p
 
š
 
	$aœs
(
v®ues
) do

129 
imgMµs
:
	$addPošt
(
p
.
k
,….
v
)

130 
imgMbps
:
	`addPošt
(
p
.
k
,….
v
 * (p.k + 20) * 8 / 1000)

131 
’d


132 
loÿl
 
Ëg’d
 = "throughpuˆ© max " .. 
£lf
.
maxLossR©e
 * 100 .. " \\%…acket†oss"

133 
imgMµs
:
	$’dPlÙ
(
Ëg’d
)

134 
imgMbps
:
	$’dPlÙ
(
Ëg’d
)

136 
imgMµs
:
	$¡¬tPlÙ
()

137 
imgMbps
:
	$¡¬tPlÙ
()

138 
_
, 
p
 
š
 
	$aœs
(
v®ues
) do

139 
loÿl
 
lškR©e
 = 
£lf
.
txQueues
[1].
dev
:
	`g‘LškStus
().
¥“d


140 
imgMµs
:
	`addPošt
(
p
.
k
, 
lškR©e
 / (p.k + 20) / 8)

141 
imgMbps
:
	`addPošt
(
p
.
k
, 
lškR©e
 / 1000)

142 
’d


143 
imgMµs
:
	`fš®ize
("link„ate")

144 
imgMbps
:
	`fš®ize
("link„ate")

145 
’d


147 
funùiÚ
 
b’chm¬k
:
	$b’ch
(
äameSize
)

148 
nÙ
 
£lf
.
š™Ÿlized
 
th’


149  
	`´št
("benchmark‚ot initialized");

150 
–£if
 
äameSize
 =ğ
n
 
th’


151  
	`”rÜ
("benchmark got invalid frameSize");

152 
’d


154 
nÙ
 
£lf
.
skCÚf
 
th’


155 
£lf
:
	$cÚfig
()

156 
’d


158 
loÿl
 
bšS—rch
 = 
uts
.
	$bš¬yS—rch
()

159 
loÿl
 
pktLo¡
 = 
Œue


160 
loÿl
 
maxLškR©e
 = 
£lf
.
txQueues
[1].
dev
:
	`g‘LškStus
().
¥“d


161 
loÿl
 
¿‹
, 
Ï¡R©e


162 
loÿl
 
b¬
 = 
b¬r›r
.
	$Ãw
(2)

163 
loÿl
 
»suÉs
 = {
	}
}

164 
loÿl
 
¿‹Sum
 = 0

165 
loÿl
 
fšished
 = 
çl£


167 --
»³©
 
the
 
‹¡
 
¡©i¡iÿl
 
pu½o£


168 
™”©iÚ
=1,
	g£lf
.
numI‹¿tiÚs
 do

169 
loÿl
 
	gpÜt
 = 
UDP_PORT


170 
bšS—rch
:
	$š™
(0, 
maxLškR©e
)

171 
¿‹
 = 
maxLškR©e
 -- 
¡¬t
 
©
 
maximum
, 
so
 
th”es
 
a
 
chªû
‡ˆ
»achšg
 
	`maximum
 (
Ùh”wi£
 
Úly
 maximum - 
th»shŞd
 
ÿn
 
be
 
»ached
)

172 
Ï¡R©e
 = 
¿‹


174 
	`´štf
("¡¬tšg i‹¿tiÚ %d fÜ f¿meSiz%d", 
™”©iÚ
, 
äameSize
)

175 --
š™
 
maxim®
 
Œªsãr
 
¿‹
 
w™hout
 
·ck‘loss
 
of
 
this
 
™”©iÚ
 
to
 
z”o


176 
»suÉs
[
™”©iÚ
] = {
¥kts
 = 0, 
½kts
 = 0, 
mµs
 = 0, 
äameSize
 = 
	}
frameSize}

177 -- 
loİ
 
uÁ
 
no
 
·ck‘loss


178 
	gdpdk
.
	$ruÂšg
() do

180 -- 
wÜk¬ound
 
¿‹
 
bug


181 
loÿl
 
numQueues
 = 
¿‹
 > (64 * 64è/ (84 * 84è* 
maxLškR©e
 
ªd
„©< maxLškR©ªd 3 
Ü
 1

182 
b¬
:
	`»š™
(
numQueues
 + 1)

183 
¿‹
 < 
maxLškR©e
 
th’


184 -- 
nÙ
 
maxLškR©e


185 -- 
ev’tu®
 
muÉË
 
¦aves


186 -- 
£t
 
¿‹
 
is
 
·ylßd
„©
nÙ
 
wœe
„ate

187 
i
=1, 
numQueues
 do

188 
	`´štf
("£ˆqueu%˜tØ¿‹ %d", 
i
, 
¿‹
 * 
äameSize
 / (äameSiz+ 20è/ 
numQueues
)

189 
£lf
.
txQueues
[
i
]:
	`£tR©e
(
¿‹
 * 
äameSize
 / (äameSiz+ 20è/ 
numQueues
)

190 
’d


192 -- 
maxLškR©e


193 
£lf
.
txQueues
[1]:
	$£tR©e
(
¿‹
)

194 
’d


196 
loÿl
 
lßdTasks
 = {
	}
}

197 -- 
Œaffic
 
g’”©Ü


198 
i
=1, 
numQueues
 do

199 
	gbË
.
š£¹
(
lßdTasks
, 
dpdk
.
ÏunchLua
("throughputLßdSÏve", 
£lf
.
txQueues
[
i
], 
pÜt
, 
äameSize
, s–f.
du¿tiÚ
, 
mod
, 
b¬
))

200 
	g’d


202 -- 
couÁ
 
the
 
šcomšg
 
·ck‘s


203 
loÿl
 
	gùrTask
 = 
dpdk
.
ÏunchLua
("throughputCouÁ”SÏve", 
£lf
.
rxQueues
[1], 
pÜt
, 
äameSize
, s–f.
du¿tiÚ
, 
b¬
)

205 -- 
wa™
 
uÁ
 
®l
 
¦aves
 
¬e
 
fšished


206 
loÿl
 
	g¥kts
 = 0

207 
_
, 
lßdTask
 
š
 
	$·œs
(
lßdTasks
) do

208 
¥kts
 = spkt + 
lßdTask
:
	$wa™
()

209 
’d


210 
loÿl
 
½kts
 = 
ùrTask
:
	$wa™
()

212 
loÿl
 
lossR©e
 = (
¥kts
 - 
½kts
) / spkts

213 
loÿl
 
v®idRun
 = 
lossR©e
 <ğ
£lf
.
maxLossR©e


214 
v®idRun
 
th’


215 -- 
th”es
 
a
 
mšim®
 
g­
 
b‘w“n
 
£lf
.
du¿tiÚ
 
ªd
 
the
 
»®
 
m—su»d
 du¿tiÚ, 
but
 
th©


216 -- 
dÛ¢t
 
m©‹r


217 
»suÉs
[
™”©iÚ
] = { 
¥kts
 = spkts, 
½kts
 =„pkts, 
mµs
 = spkt / 10^6 / 
£lf
.
du¿tiÚ
, 
äameSize
 = 
	}
frameSize}

218 
’d


220 
´štf
("£Á %d…ack‘s,„eûived %d", 
¥kts
, 
½kts
)

221 
´štf
("¿‹ %àªd…ack‘los %à=> %d", 
¿‹
, 
lossR©e
, 
v®idRun
 
ªd
 1 
Ü
 0)

223 
	gÏ¡R©e
 = 
¿‹


224 
¿‹
, 
	gfšished
 = 
bšS—rch
:
	$Ãxt
(
¿‹
, 
v®idRun
, 
£lf
.
¿‹Th»shŞd
)

225 
fšished
 
th’


226 -- 
nÙ
 
£‰šg
 
¿‹
 
š
 
bË
 
as
 
™
 
is
‚Ù 
gu¬ª‹ed
 
th©
 
Ï¡
 
round
 
®l


227 -- 
·ck‘s
 
w”e
 
»ûived
 
´İ”ly


228 
loÿl
 
mµs
 = 
»suÉs
[
™”©iÚ
].mpps

229 
	`´štf
("maxim®„©fÜ…ack‘siz%d: %0.2àMµs, %0.2àMB™/s, %0.2àMB™/ wœ¿‹", 
äameSize
, 
mµs
, mpps * frameSize * 8, mpps * (frameSize + 20) * 8)

230 
¿‹Sum
 =„©eSum + 
»suÉs
[
™”©iÚ
].
mµs


232 
’d


234 
	`´štf
("chªgšg„©äom %d MB™/ tØ%d MB™/s", 
Ï¡R©e
, 
¿‹
)

235 -- 
TODO
: 
maybe
 
wa™
 
»£‰Ëm’t
 
of
 
	$DUT
 (
RFC2544
)

236 
pÜt
 =…ort + 1

237 
dpdk
.
	`¦“pMlis
(100)

238 --
deviû
.
	$»şaimTxBufãrs
()

239 
’d


240 
’d


242 
nÙ
 
£lf
.
skCÚf
 
th’


243 
£lf
:
	$undoCÚfig
()

244 
’d


246  
»suÉs
, 
¿‹Sum
 / 
£lf
.
numI‹¿tiÚs


247 
’d


249 
funùiÚ
 
	$throughputLßdSÏve
(
queue
, 
pÜt
, 
äameSize
, 
du¿tiÚ
, 
modif›r
, 
b¬
)

250 
loÿl
 
‘hD¡
 = 
¬p
.
	`blockšgLookup
("198.18.1.1", 10)

251 --
TODO
: 
”rÜ
 
Ú
 
timeout


253 --
wa™
 
couÁ”
 
¦ave


254 
b¬
:
	`wa™
()

256 -- 
g’
 
·ylßd
 
‹m¶©e
 
sugge¡ed
 
by
 
RFC2544


257 
loÿl
 
udpPaylßdL’
 = 
äameSize
 - 46

258 
loÿl
 
udpPaylßd
 = 
ffi
.
	`Ãw
("ušt8_t[?]", 
udpPaylßdL’
)

259 
i
 = 0, 
udpPaylßdL’
 - 1 do

260 
udpPaylßd
[
i
] = 
b™
.
	$bªd
(
i
, 0xf)

261 
’d


263 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

264 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

265 
pkt
:
fl
{

266 
pktL’gth
 = 
äameSize
 - 4, -- 
£lf
 
£ts
 
®l
 
Ëngth
 
h—d”s
 
f›lds
 
š
‡Î 
u£d
 
´ÙocŞs
, -4 
FCS


267 
‘hSrc
 = 
queue
, -- 
g‘
 
the
 
¤c
 
mac
 
äom
h
deviû


268 
‘hD¡
 =ƒthDst,

269 -- 
TODO
: 
too
 
¦ow
 
w™h
 
cÚd™iÚ®
 -- 
ev’tu®
 
Ïunch
 
a
 
£cÚd
 
¦ave
 
£lf


270 -- 
‘hD¡
 
SHOULD
 
be
 
š
 1% 
of
 
the
 
äames
h
h¬dw¬e
 
brßdÿ¡
 
add»ss


271 -- 
sw™ches
 
‘hD¡
 
®so
 
SHOULD
 
be
 
¿ndomized


273 -- 
De¡
 
is
 
dyÇmiÿl
 
ü—‹d
 
™
 i 
ov”wr™‹n


274 -- 
dÛs
 
nÙ
 
afãù
 
³rfÜmªû
, 
as
 
£lf
 
fl
 
is
 
dÚe
 
befÜe
 
ªy
 
·ck‘
 i 
£Á


275 
4Src
 = "198.18.1.2",

276 
4D¡
 = "198.19.1.2",

277 
udpSrc
 = 
UDP_PORT
,

278 -- 
udpSrc
 
wl
 
be
 
£t
 
Ï‹r
 
as
 
™
 
v¬›s


279 
	}
}

280 -- 
fl
 
udp
 
·ylßd
 
w™h
 
´•¬ed
 udp…ayload

281 
	gffi
.
	$cİy
(
pkt
.
·ylßd
, 
udpPaylßd
, 
udpPaylßdL’
)

282 
’d
)

284 
loÿl
 
bufs
 = 
mem
:
	`bufA¼ay
()

285 --
loÿl
 
modif›rFoo
 = 
uts
.
	`g‘PktModif›rFunùiÚ
(
modif›r
, 
ba£Ip
, 
w¿pIp
, 
ba£Eth
, 
w¿pEth
)

287 -- 
TODO
: 
RFC2544
 
routšg
 
upd©es
 
rou‹r


288 -- 
£nd
 
Ë¬nšg
 
äames
:

289 -- 
ARP
 
IP


292 
loÿl
 
£ndBufs
 = 
	`funùiÚ
(
bufs
, 
pÜt
)

293 -- 
®loÿ‹
 
bufãrs
 
äom
 
the
 
mem
 
poŞ
 
ªd
 
¡Üe
 
them
 
š
 
£lf
 
¬¿y


294 
bufs
:
	`®loc
(
äameSize
 - 4)

296 
_
, 
buf
 
š
 
	$aœs
(
bufs
) do

297 
loÿl
 
pkt
 = 
buf
:
	`g‘UdpPack‘
()

298 -- 
£t
 
·ck‘
 
udp
 
pÜt


299 
pkt
.
udp
:
	`£tD¡PÜt
(
pÜt
)

300 -- 
­¶y
 
modif›r
 
like
 

 
Ü
 
mac
 
¿ndomi§tiÚ
 
to
 
·ck‘


301 -- 
	$modif›rFoo
(
pkt
)

302 
’d


303 -- 
£nd
 
·ck‘s


304 
bufs
:
	$ofæßdUdpChecksums
()

305  
queue
:
	$£nd
(
bufs
)

306 
’d


307 -- 
w¬mup
 
pha£
 
to
 
wake
 
up
 
ÿrd


308 
loÿl
 
tim”
 =im”:
	$Ãw
(0.1)

309 
tim”
:
	$ruÂšg
() do

310 
	`£ndBufs
(
bufs
, 
pÜt
 - 1)

311 
’d


313 -- 
b’chm¬k
 
pha£


314 
tim”
:
	$»£t
(
du¿tiÚ
)

315 
loÿl
 
tÙ®S’t
 = 0

316 
tim”
:
	$ruÂšg
() do

317 
tÙ®S’t
 =Ù®S’ˆ+ 
	$£ndBufs
(
bufs
, 
pÜt
)

318 
’d


319  
tÙ®S’t


320 
’d


322 
funùiÚ
 
	$throughputCouÁ”SÏve
(
queue
, 
pÜt
, 
äameSize
, 
du¿tiÚ
, 
b¬
)

323 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

324 
loÿl
 
¡©s
 = {
	}
}

325 
b¬
:
	$wa™
()

327 
loÿl
 
tim”
 =im”:
	`Ãw
(
du¿tiÚ
 + 3)

328 
tim”
:
	$ruÂšg
() do

329 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 1000)

330 
i
 = 1, 
rx
 do

331 
loÿl
 
buf
 = 
bufs
[
i
]

332 
loÿl
 
pkt
 = 
buf
:
	$g‘UdpPack‘
()

333 
loÿl
 
pÜt
 = 
pkt
.
udp
:
	$g‘D¡PÜt
()

334 
¡©s
[
pÜt
] = (¡©s[pÜt] 
Ü
 0) + 1

335 
’d


336 
bufs
:
	$ä“AÎ
()

337 
’d


338  
¡©s
[
pÜt
] 
Ü
 0

339 
’d


341 --
¡ªd®Úe
 
b’chm¬k


342 
¡ªd®Úe
 
th’


343 
funùiÚ
 
	$ma¡”
()

344 
loÿl
 
¬gs
 = 
uts
.
	$·r£Argum’ts
(
¬g
)

345 
loÿl
 
txPÜt
, 
rxPÜt
 = 
¬gs
.
txpÜt
,‡rgs.
rxpÜt


346 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 
th’


347  
	`´št
("usage: --txport <txport> --rxport <rxport> --duration <duration> --numiterations <numiterations>")

348 
’d


350 
loÿl
 
rxDev
, 
txDev


351 
txPÜt
 =ğ
rxPÜt
 
th’


352 -- 
£ndšg
 
ªd
 
»ûivšg
 
äom
 
the
 
§me
 
pÜt


353 
txDev
 = 
deviû
.
	`cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 4
	}
})

354 
	grxDev
 = 
txDev


356 -- 
two
 
difã»Á
 
pÜts
, difã»Á 
cÚfigu¿tiÚ


357 
	gtxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 4})

358 
	grxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
rxPÜt
, 
rxQueues
 = 2, 
txQueues
 = 3})

359 
’d


360 
	gdeviû
.
	$wa™FÜLšks
()

361 
txPÜt
 =ğ
rxPÜt
 
th’


362 
dpdk
.
	`ÏunchLua
(
¬p
.
¬pTask
, {

364 
txQueue
 = 
txDev
:
	`g‘TxQueue
(0),

365 
rxQueue
 = 
txDev
:
	`g‘RxQueue
(1),

366 
s
 = {"198.18.1.2", "198.19.1.2"}

368 
	}
})

370 
	gdpdk
.
ÏunchLua
(
¬p
.
¬pTask
, {

372 
txQueue
 = 
txDev
:
g‘TxQueue
(0),

373 
rxQueue
 = 
txDev
:
g‘RxQueue
(1),

374 
s
 = {"198.18.1.2"}

377 
txQueue
 = 
rxDev
:
g‘TxQueue
(0),

378 
rxQueue
 = 
rxDev
:
g‘RxQueue
(1),

379 
s
 = {"198.19.1.2", "198.18.1.1"}

382 
’d


384 
loÿl
 
	gb’ch
 = 
	$b’chm¬k
()

385 
b’ch
:
	`š™
({

386 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1),xDev:getTxQueue(2),xDev:getTxQueue(3)},

387 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(0)},

388 
du¿tiÚ
 = 
¬gs
.duration,

389 
numI‹¿tiÚs
 = 
¬gs
.
num™”©iÚs
,

390 
skCÚf
 = 
Œue
,

391 
	}
})

393 
´št
(
b’ch
:
	$g‘CSVH—d”
())

394 
loÿl
 
»suÉs
 = {
	}
}

395 
loÿl
 
FRAME_SIZES
 = {64, 128, 256, 512, 1024, 1280, 1518}

396 
_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

397 
loÿl
 
»suÉ
 = 
b’ch
:
	`b’ch
(
äameSize
)

398 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


399 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

400 
	`´št
(
b’ch
:
	$»suÉToCSV
(
»suÉ
))

401 
’d


402 
b’ch
:
	`toTikz
("throughput", 
	$uÅack
(
»suÉs
))

403 
’d


404 
’d


406 
loÿl
 
mod
 = {
	}
}

407 
mod
.
__šdex
 = mod

409 
mod
.
b’chm¬k
 = benchmark

410  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/config.lua

1 
loÿl
 
	gns
 = 
»quœe
 "namespaces"

3 
loÿl
 
DEFAULT_SSH_USER
 = "root"

4 
loÿl
 
DEFAULT_SSH_PORT
 = 22

5 
loÿl
 
DEFAULT_SSH_HOST
 = "localhost"

6 
loÿl
 
DEFAULT_SSH_PASS
 = "password"

8 
loÿl
 
DEFAULT_SNMP_COMM
 = "public"

11 
loÿl
 
mod
 = {}

12 
mod
.
__šdex
 = mod

14 
loÿl
 
cÚfig
 = 
ns
.
	$g‘
()

16 
funùiÚ
 
mod
.
	$g‘SSHPÜt
()

17  
cÚfig
.
sshPÜt
 
Ü
 
DEFAULT_SSH_PORT


18 
’d


20 
funùiÚ
 
mod
.
	$£tSSHPÜt
(
pÜt
)

21 
cÚfig
.
sshPÜt
 = 
pÜt


22 
’d


24 
funùiÚ
 
mod
.
	$g‘Ho¡
()

25  
cÚfig
.
ho¡
 
Ü
 
DEFAULT_SSH_HOST


26 
’d


28 
funùiÚ
 
mod
.
	$£tHo¡
(
ho¡
)

29 
cÚfig
.
ho¡
 = host

30 
’d


32 
funùiÚ
 
mod
.
	$g‘SSHU£r
()

33  
cÚfig
.
sshU£r
 
Ü
 
DEFAULT_SSH_USER


34 
’d


36 
funùiÚ
 
mod
.
	$£tSSHU£r
(
u£r
)

37 
cÚfig
.
sshU£r
 = 
u£r


38 
’d


40 
funùiÚ
 
mod
.
	$g‘SSHPass
()

41  
cÚfig
.
sshPass
 
Ü
 
DEFAULT_SSH_PASS


42 
’d


44 
funùiÚ
 
mod
.
	$£tSSHPass
(
·ss
)

45 
cÚfig
.
sshPass
 = 
·ss


46 
’d


48 
funùiÚ
 
mod
.
	$g‘SNMPComm
()

49  
cÚfig
.
¢mpComm
 
Ü
 
DEFAULT_SNMP_COMM


50 
’d


52 
funùiÚ
 
mod
.
	$£tSNMPComm
(
comm
)

53 
cÚfig
.
¢mpComm
 = 
comm


54 
’d


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/master.lua

1 
	g·ckage
.
	g·th
 = 
·ckage
.
·th
 .. "rfc2544/?.lua;../rfc2544/?.lua;"

3 
ma¡”
 =ğ
n
 
th’


4 
ma¡”
 = "dummy"

5 
’d


7 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

8 
loÿl
 
deviû
 = 
»quœe
 "device"

9 
loÿl
 
¬p
 = 
»quœe
 "proto.arp"

11 
loÿl
 
throughput
 = 
»quœe
 "benchmarks.throughput"

12 
loÿl
 
Ï‹ncy
 = 
»quœe
 "benchmarks.latency"

13 
loÿl
 
äam–oss
 = 
»quœe
 "benchmarks.frameloss"

14 
loÿl
 
backtoback
 = 
»quœe
 "benchmarks.backtoback"

15 
loÿl
 
uts
 = 
»quœe
 "utils.utils"

17 
loÿl
 
‹¡»pÜt
 = 
»quœe
 "utils.testreport"

19 
loÿl
 
cÚf
 = 
»quœe
 "config"

21 
loÿl
 
FRAME_SIZES
 = {64, 128, 256, 512, 1024, 1280, 1518}

23 
loÿl
 
u§geSŒšg
 = [[

25 --
txpÜt
 <txport>

26 --
rxpÜt
 <rxport>

28 --
¹hs
 <
throughput
 
¿‹
 
th»shŞd
>

29 --
mÌ
 <
max
 
throuput
 
loss
 
¿‹
>

31 --
bths
 <
back
-
to
-back 
äame
 
th»shŞd
>

33 --
du¿tiÚ
 <
sšgË
 
‹¡
 duration>

34 --
™”©iÚs
 <
amouÁ
 
of
 
‹¡
 iterations>

36 --
dš
 <
DuT
 
š
 
š‹rçû
 
Çme
>

37 --
dout
 <
DuT
 
out
 
™”çû
 
Çme
>

38 --
dsk
 <
sk
 
DuT
 
cÚfigu¿tiÚ
>

40 --
askssh·ss
 <
Œue
|
çl£
> [
ask
 
©
 
begšnšg
 
SSH
 
·sswÜd
]

41 --
ssh·ss
 <
SSH
 
·sswÜd
>

42 --
sshu£r
 <
SSH
 
u£r
>

43 --
sshpÜt
 <
SSH
 
pÜt
>

44 --
ask¢mpcomm
 <
Œue
|
çl£
> [
ask
 
©
 
begšnšg
 
SNMP
 
commun™y
 
¡ršg
]

45 --
¢mpcomm
 <
SNMP
 
commun™y
 
¡ršg
>

46 --
ho¡
 <
mgmt
 ho¡ 
Çme
 
of
 
the
 
DuT
>

49 
loÿl
 
d©e
 = 
os
.date("%F_%H-%M")

51 
funùiÚ
 
	$log
(
fe
, 
msg
, 
lšeb»ak
)

52 
	$´št
(
msg
)

53 
fe
:
	$wr™e
(
msg
)

54 
lšeb»ak
 
th’


55 
fe
:
	`wr™e
("\n")

56 
’d


57 
’d


59 
funùiÚ
 
	$ma¡”
()

60 
loÿl
 
¬gum’ts
 = 
uts
.
	$·r£Argum’ts
(
¬g
)

61 
loÿl
 
txPÜt
, 
rxPÜt
 = 
¬gum’ts
.
txpÜt
,‡rgum’ts.
rxpÜt


62 
nÙ
 
txPÜt
 
Ü
‚Ù 
rxPÜt
 
th’


63  
	`´št
("u§ge: " .. 
u§geSŒšg
)

64 
’d


66 
loÿl
 
¿‹Th»shŞd
 = 
¬gum’ts
.
¹hs
 
Ü
 100

67 
loÿl
 
btbTh»shŞd
 = 
¬gum’ts
.
bths
 
Ü
 100

68 
loÿl
 
du¿tiÚ
 = 
¬gum’ts
.du¿tiÚ 
Ü
 10

69 
loÿl
 
maxLossR©e
 = 
¬gum’ts
.
mÌ
 
Ü
 0.001

70 
loÿl
 
dsk
 = 
¬gum’ts
.dskip

71 
loÿl
 
numI‹¿tiÚs
 = 
¬gum’ts
.
™”©iÚs


73 
	`ty³
(
¬gum’ts
.
ssh·ss
è=ğ"¡ršg" 
th’


74 
cÚf
.
	$£tSSHPass
(
¬gum’ts
.
ssh·ss
)

75 
–£if
 
¬gum’ts
.
askssh·ss
 =ğ"Œue" 
th’


76 
io
.
	`wr™e
("password: ")

77 
cÚf
.
	`£tSSHPass
(
io
.
	$»ad
())

78 
’d


79 
	`ty³
(
¬gum’ts
.
sshu£r
è=ğ"¡ršg" 
th’


80 
cÚf
.
	$£tSSHU£r
(
¬gum’ts
.
sshu£r
)

81 
’d


82 
	`ty³
(
¬gum’ts
.
sshpÜt
è=ğ"¡ršg" 
th’


83 
cÚf
.
	`£tSSHPÜt
(
	$tÚumb”
(
¬gum’ts
.
sshpÜt
))

84 
–£if
 
	`ty³
(
¬gum’ts
.
sshpÜt
è=ğ"numb”" 
th’


85 
cÚf
.
	$£tSSHPÜt
(
¬gum’ts
.
sshpÜt
)

86 
’d


88 
	`ty³
(
¬gum’ts
.
¢mpcomm
è=ğ"¡ršg" 
th’


89 
cÚf
.
	$£tSNMPComm
(
¬gum’ts
.
¢mpcomm
)

90 
–£if
 
¬gum’ts
.
ask¢mpcomm
 =ğ"Œue" 
th’


91 
io
.
	`wr™e
("snmp community: ")

92 
cÚf
.
	`£tSNMPComm
(
io
.
	$»ad
())

93 
’d


95 
	`ty³
(
¬gum’ts
.
ho¡
è=ğ"¡ršg" 
th’


96 
cÚf
.
	$£tHo¡
(
¬gum’ts
.
ho¡
)

97 
’d


99 
loÿl
 
dut
 = {

100 
ifIn
 = 
¬gum’ts
.
dš
,

101 
ifOut
 = 
¬gum’ts
.
dout


102 
	}
}

104 
loÿl
 
	grxDev
, 
txDev


105 
	gtxPÜt
 =ğ
rxPÜt
 
th’


106 -- 
£ndšg
 
ªd
 
»ûivšg
 
äom
 
the
 
§me
 
pÜt


107 
txDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 3, 
txQueues
 = 5})

108 
	grxDev
 = 
txDev


110 -- 
two
 
difã»Á
 
pÜts
, difã»Á 
cÚfigu¿tiÚ


111 
	gtxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
txPÜt
, 
rxQueues
 = 2, 
txQueues
 = 5})

112 
	grxDev
 = 
deviû
.
cÚfig
({
pÜt
 = 
rxPÜt
, 
rxQueues
 = 3, 
txQueues
 = 3})

113 
’d


114 
	gdeviû
.
wa™FÜLšks
()

116 -- 
Ïunch
 
background
 
¬p
 
bË
 
sk


117 
	gtxPÜt
 =ğ
rxPÜt
 
th’


118 
dpdk
.
ÏunchLua
(
¬p
.
¬pTask
, {

120 
txQueue
 = 
txDev
:
g‘TxQueue
(0),

121 
rxQueue
 = 
txDev
:
g‘RxQueue
(1),

122 
s
 = {"198.18.1.2", "198.19.1.2"}

126 
	gdpdk
.
ÏunchLua
(
¬p
.
¬pTask
, {

128 
txQueue
 = 
txDev
:
g‘TxQueue
(0),

129 
rxQueue
 = 
txDev
:
g‘RxQueue
(1),

130 
s
 = {"198.18.1.2"}

133 
txQueue
 = 
rxDev
:
g‘TxQueue
(0),

134 
rxQueue
 = 
rxDev
:
g‘RxQueue
(1),

135 
s
 = {"198.19.1.2", "198.18.1.1"}

138 
	g’d


140 -- 
ü—‹
 
‹¡»suÉ
 
fŞd”
 
nÙ
 
	gexi¡


141 -- 
th”e
 
is
 
no
 
ş—n
 
lua
 
way
 
w™hout
 
	gusšg
 3
rd
 
·¹y
 
libs


142 
loÿl
 
	gfŞd”Name
 = "‹¡»suÉs_" .. 
d©e


143 
os
.
execu‹
("mkdœ -°" .. 
fŞd”Name
)

145 
loÿl
 
»pÜt
 = 
‹¡»pÜt
.
Ãw
(
fŞd”Name
 .. "/rfc_2544_testreport.tex")

146 
loÿl
 
»suÉs
 = {}

148 
loÿl
 
thB’ch
 = 
throughput
.
	$b’chm¬k
()

149 
thB’ch
:
	`š™
({

150 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1),xDev:getTxQueue(2),xDev:getTxQueue(3)},

151 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(0)},

152 
du¿tiÚ
 = duration,

153 
¿‹Th»shŞd
 =„ateThreshold,

154 
maxLossR©e
 = maxLossRate,

155 
skCÚf
 = 
dsk
,

156 
dut
 = dut,

157 
numI‹¿tiÚs
 =‚umIterations,

158 
	}
})

159 
loÿl
 
	g¿‹s
 = {}

160 
loÿl
 
fe
 = 
io
.
İ’
(
fŞd”Name
 .. "/throughput.csv", "w")

161 
log
(
fe
, 
thB’ch
:
g‘CSVH—d”
(), 
Œue
)

162 
	g_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

163 
loÿl
 
»suÉ
, 
avgR©e
 = 
thB’ch
:
	$b’ch
(
äameSize
)

164 
¿‹s
[
äameSize
] = 
avgR©e


166 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


167 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

168 
	`log
(
fe
, 
thB’ch
:
	`»suÉToCSV
(
»suÉ
), 
Œue
)

169 
»pÜt
:
	$addThroughput
(
»suÉ
, 
du¿tiÚ
, 
maxLossR©e
, 
¿‹Th»shŞd
)

170 
’d


171 
thB’ch
:
	`toTikz
(
fŞd”Name
 .. "/¶Ù_throughput", 
	$uÅack
(
»suÉs
))

172 
fe
:
	$şo£
()

174 
»suÉs
 = {
	}
}

175 
loÿl
 
ÏtB’ch
 = 
Ï‹ncy
.
	$b’chm¬k
()

176 
ÏtB’ch
:
	`š™
({

177 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1),xDev:getTxQueue(2),xDev:getTxQueue(3),xDev:getTxQueue(4)},

178 -- 
difã»Á
 
»ûivšg
 
queue
, 
time¡ampšg
 
f‹r


179 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(2)},

180 
du¿tiÚ
 = duration,

181 
skCÚf
 = 
dsk
,

182 
dut
 = dut,

183 
	}
})

185 
	gfe
 = 
io
.
İ’
(
fŞd”Name
 .. "/latency.csv", "w")

186 
log
(
fe
, 
ÏtB’ch
:
g‘CSVH—d”
(), 
Œue
)

187 
	g_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

188 
loÿl
 
»suÉ
 = 
ÏtB’ch
:
	`b’ch
(
äameSize
, 
m©h
.
	`û
(
¿‹s
[frameSize] * (frameSize + 20) * 8))

190 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


191 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

192 
	`log
(
fe
, 
ÏtB’ch
:
	`»suÉToCSV
(
»suÉ
), 
Œue
)

193 
»pÜt
:
	$addL©’cy
(
»suÉ
, 
du¿tiÚ
)

194 
’d


195 
ÏtB’ch
:
	`toTikz
(
fŞd”Name
 .. "/¶Ù_Ï‹ncy", 
	$uÅack
(
»suÉs
))

196 
fe
:
	$şo£
()

198 
»suÉs
 = {
	}
}

199 
loÿl
 
æB’ch
 = 
äam–oss
.
	$b’chm¬k
()

200 
æB’ch
:
	`š™
({

201 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1),xDev:getTxQueue(2),xDev:getTxQueue(3)},

202 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(0)},

203 
du¿tiÚ
 = duration,

204 
g¿nuÏr™y
 = 0.05,

205 
skCÚf
 = 
dsk
,

206 
dut
 = dut,

207 
	}
})

208 
	gfe
 = 
io
.
İ’
(
fŞd”Name
 .. "/frameloss.csv", "w")

209 
log
(
fe
, 
æB’ch
:
g‘CSVH—d”
(), 
Œue
)

210 
	g_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

211 
loÿl
 
»suÉ
 = 
æB’ch
:
	`b’ch
(
äameSize
)

213 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


214 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

215 
	`log
(
fe
, 
æB’ch
:
	`»suÉToCSV
(
»suÉ
), 
Œue
)

216 
»pÜt
:
	$addF¿m–oss
(
»suÉ
, 
du¿tiÚ
)

217 
’d


218 
æB’ch
:
	`toTikz
(
fŞd”Name
 .. "/¶Ù_äam–oss", 
	$uÅack
(
»suÉs
))

219 
fe
:
	$şo£
()

221 
»suÉs
 = {
	}
}

222 
loÿl
 
btbB’ch
 = 
backtoback
.
	$b’chm¬k
()

223 
btbB’ch
:
	`š™
({

224 
txQueues
 = {
txDev
:
	`g‘TxQueue
(1)},

225 
rxQueues
 = {
rxDev
:
	`g‘RxQueue
(0)},

226 
g¿nuÏr™y
 = 
btbTh»shŞd
,

227 
skCÚf
 = 
dsk
,

228 
numI‹¿tiÚs
 =‚umIterations,

229 
dut
 = dut,

230 
	}
})

231 
	gfe
 = 
io
.
İ’
(
fŞd”Name
 .. "/backtoback.csv", "w")

232 
log
(
fe
, 
btbB’ch
:
g‘CSVH—d”
(), 
Œue
)

233 
	g_
, 
äameSize
 
š
 
	$aœs
(
FRAME_SIZES
) do

234 
loÿl
 
»suÉ
 = 
btbB’ch
:
	`b’ch
(
äameSize
)

236 -- 
§ve
 
ªd
 
»pÜt
 
»suÉs


237 
bË
.
	$š£¹
(
»suÉs
, 
»suÉ
)

238 
	`log
(
fe
, 
btbB’ch
:
	`»suÉToCSV
(
»suÉ
), 
Œue
)

239 
»pÜt
:
	`addBackToBack
(
»suÉ
, 
btbB’ch
.
du¿tiÚ
, 
btbTh»shŞd
, 
txDev
:
	`g‘LškStus
().
¥“d
)

240 
’d


241 
btbB’ch
:
	`toTikz
(
fŞd”Name
 .. "/¶Ù_backtoback", 
	$uÅack
(
»suÉs
))

242 
fe
:
	$şo£
()

244 
»pÜt
:
	$fš®ize
()

246 
’d


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ffi/ssh.lua

1 -- 
LuaJIT
 
FFI
 
w¿µ”
 
ov”
 
libssh
 (
h‰p
:

2 -- 
It
's†icensed‡s LGPLv2.1 (see http://git.libssh.org/projects/libssh.git/tree/COPYING).

3 
loÿl
 
ffi
 = 
»quœe
("ffi")

5 
ffi
.
cdef
[[

6 
ssh_£ssiÚ_¡ruù
* 
ssh_£ssiÚ
;

7 
ssh_chªÃl_¡ruù
* 
ssh_chªÃl
;

9 
ssh_£ssiÚ
 
ssh_Ãw
();

10 
ssh_İtiÚs_£t
(
ssh_£ssiÚ
 
£ssiÚ
, 
ty³
, cÚ¡ * 
v®ue
);

11 
ssh_ä“
 (
ssh_£ssiÚ
 
£ssiÚ
);

12 
ssh_cÚÃù
 (
ssh_£ssiÚ
 
£ssiÚ
);

13 
ssh_discÚÃù
 (
ssh_£ssiÚ
 
£ssiÚ
);

14 
ssh_is_£rv”_known
 (
ssh_£ssiÚ
 
£ssiÚ
);

15 
ssh_is_cÚÃùed
 (
ssh_£ssiÚ
 
£ssiÚ
);

16 
ssh_wr™e_knownho¡
 (
ssh_£ssiÚ
 
£ssiÚ
);

17 
ssh_u£¿uth_·sswÜd
 (
ssh_£ssiÚ
 
£ssiÚ
, cÚ¡ *
u£ºame
, cÚ¡ *
·sswÜd
);

18 * 
ssh_g‘_issue_bªÃr
(
ssh_£ssiÚ
 
£ssiÚ
);

20 
ssh_chªÃl
 
ssh_chªÃl_Ãw
(
ssh_£ssiÚ
 
£ssiÚ
);

21 
ssh_chªÃl_İ’_£ssiÚ
(
ssh_chªÃl
 
chªÃl
);

22 
ssh_chªÃl_g‘_ex™_¡©us
(
ssh_chªÃl
 
chªÃl
);

23 
ssh_chªÃl_şo£
(
ssh_chªÃl
 
chªÃl
);

24 
ssh_chªÃl_ä“
(
ssh_chªÃl
 
chªÃl
);

25 
ssh_chªÃl_»que¡_exec
 (
ssh_chªÃl
 
chªÃl
, cÚ¡ * 
cmd
);

26 
ssh_chªÃl_»ad
(
ssh_chªÃl
 
chªÃl
, *
de¡
, 
ušt32_t
 
couÁ
, 
is_¡d”r
);

27 
ssh_chªÃl_»ad_nÚblockšg
(
ssh_chªÃl
 
chªÃl
, *
de¡
, 
ušt32_t
 
couÁ
, 
is_¡d”r
);

28 
ssh_chªÃl_£nd_eof
(
ssh_chªÃl
 
chªÃl
);

29 cÚ¡ * 
ssh_g‘_”rÜ
 (* 
”rÜ
);

30 
ssh_´iv©e_key_¡ruù
* 
ssh_´iv©e_key
;

31 
ssh_public_key_¡ruù
* 
ssh_public_key
;

32 
ssh_key_¡ruù
* 
ssh_key
;

33 
ssh_¡ršg_¡ruù
* 
ssh_¡ršg
;

35 
ssh_u£¿uth_autİubkey
(
ssh_£ssiÚ
 
£ssiÚ
, cÚ¡ *
·s¥h¿£
);

36 
ssh_u£¿uth_pubkey
(
ssh_£ssiÚ
 
£ssiÚ
, cÚ¡ *
u£ºame
, 
ssh_¡ršg
 
publickey
, 
ssh_´iv©e_key
 
´iv©ekey
);

37 
ssh_u£¿uth_´iv©ekey_fe
(
ssh_£ssiÚ
 
£ssiÚ
, cÚ¡ *
u£ºame
,

38 cÚ¡ *
f’ame
, cÚ¡ *
·s¥h¿£
);

39 cÚ¡ *
ssh_v”siÚ
(
»q_v”siÚ
);

41 
u¦“p
(
£c
);

44 
loÿl
 
libssh
 = 
ffi
.
lßd
("ssh")

45 
loÿl
 
low_v”siÚ
 = 5 * 2^8 + 2

46 
as£¹
(
libssh
.
ssh_v”siÚ
(
ffi
.
Ãw
("št", 
low_v”siÚ
)), "Your†ibssh isoo old! At†east 0.5.2 is„equired.")

48 
loÿl
 
funùiÚ
 
	$št_to_num
(
i
)

49  
ffi
.
	`Ãw
("št[1]", 
i
)

50 
’d


52 -- 
Debug
 
¡ub
.

53 
loÿl
 
funùiÚ
 
	$debug
(
s
)

54 
	$´št
 (
s
)

55 
’d


57 
loÿl
 
c
 = {

58 -- 
ssh_auth_e


59 
SSH_AUTH_SUCCESS
 = 0,

60 
SSH_AUTH_DENIED
 = 1,

61 
SSH_AUTH_PARTIAL
 = 2,

62 
SSH_AUTH_INFO
 = 3,

63 
SSH_AUTH_AGAIN
 = 4,

64 
SSH_AUTH_ERROR
 = -1,

66 -- 
ssh_£rv”_known_e


67 
SSH_SERVER_ERROR
 = -1,

68 
SSH_SERVER_NOT_KNOWN
 = 0,

69 
SSH_SERVER_KNOWN_OK
 = 1,

70 
SSH_SERVER_KNOWN_CHANGED
 = 2,

71 
SSH_SERVER_FOUND_OTHER
 = 3,

72 
SSH_SERVER_FILE_NOT_FOUND
 = 4,

73 
	}
}

75 
loÿl
 
funùiÚ
 
	$check_auth_¡©us
(
ssh_¡©us
)

76 
ssh_¡©us
 =ğ
c
.
SSH_AUTH_SUCCESS
 
th’


77  
Œue
, "ok"

78 
–£if
 
ssh_¡©us
 =ğ
c
.
SSH_AUTH_PARTIAL
 
th’


79  
Œue
, "partial"

81 -- 
loÿl
 
”r
 = 
libssh
.
	`ssh_g‘_”rÜ
(
£ssiÚ
)

82 -- 
	`debug
 (
ffi
.
	$¡ršg
(
”r
))

83  
n
, 
¡ršg
.
	`fÜm©
("Auth’tiÿtiÚ faed w™h stu %d.", 
ssh_¡©us
)

84 
’d


85 
’d


87 -- 
C»©es
 
£ssiÚ
.

88 -- @ 
£ssiÚ
 
libssh
 session

89 
loÿl
 
funùiÚ
 
	`Ãw
()

90 -- 
In™Ÿlize
 
£ssiÚ


91 
loÿl
 
£ssiÚ
 = 
libssh
.
	`ssh_Ãw
()

92 -- 
Check
 
ev”ythšg
 
is
 
ok


93 
£ssiÚ
 =ğ
n
 
th’


94  
n
, "Cannot create session"

95 
’d


96  
£ssiÚ


97 
’d


99 -- 
CÚÃùs
 
to
 
the
 
£rv”
.

100 -- @
·¿m
 
£ssiÚ


101 -- @
·¿m
 
¡riù_ho¡_key_checkšg


102 
loÿl
 
funùiÚ
 
	$cÚÃù
(
£ssiÚ
, 
¡riù_ho¡_key_checkšg
)

103 
	`as£¹
(
£ssiÚ
 ~ğ
n
, "Session shouldn't be‚il")

104 -- 
CÚÃùšg
 
to
 
the
 
£rv”


105 
libssh
.
	`ssh_cÚÃù
(
£ssiÚ
è~ğ
c
.
SSH_AUTH_SUCCESS
 
th’


106  
n
, "Unableo connect"

107 
’d


108 -- 
V”ifyšg
 
ho¡s
 
fe


109 
known_¡©us
 = 
libssh
.
	$ssh_is_£rv”_known
(
£ssiÚ
)

110 
known_¡©us
 ~ğ
c
.
SSH_SERVER_KNOWN_OK
 
th’


111 ià(
¡riù_ho¡_key_checkšg
è
th’


112  
n
, "Host is unknown"

113 
	$–£if
 (
known_¡©us
 =ğ
c
.
SSH_SERVER_NOT_KNOWN
 
Ü


114 
known_¡©us
 =ğ
c
.
SSH_SERVER_FILE_NOT_FOUND
è
th’


115 
	`debug
("unknown host:‡dding...")

116 
libssh
.
	$ssh_wr™e_knownho¡
(
£ssiÚ
)

118 -- 
TODO
:  
´İ”
 
humª
-
»adabË
 
ex¶aš©iÚ


119  
n
, "Failed checking known hosts!"

120 
’d


121 
’d


122  
Œue


123 
’d


126 -- 
P”fÜms
 
·sswÜd
 
auth’tiÿtiÚ
.

127 -- @
·¿m
 
£ssiÚ


128 -- @
·¿m
 
·sswÜd


129 
loÿl
 
funùiÚ
 
	$auth_·sswÜd
(
£ssiÚ
, 
·sswÜd
)

130 
	`as£¹
(
£ssiÚ
 ~ğ
n
, "Session shouldn't be‚il")

131 ià(
	`ty³
(
·sswÜd
è~ğ"¡ršg"è
th’


132  
n
, "Password should be string"

133 
’d


134 
loÿl
 
auth_¡©us
 = 
libssh
.
	$ssh_u£¿uth_·sswÜd
(
£ssiÚ
, 
n
, 
·sswÜd
)

135  
	$check_auth_¡©us
(
auth_¡©us
)

136 
’d


138 -- 
P”fÜms
 
auth’tiÿtiÚ
 
by
 
public
 
keys
 
š
 ~/.
ssh
 
dœeùÜy
.

139 -- @
·¿m
 
£ssiÚ


140 -- @
·¿m
 
·sswÜd
 
public
 
key
…assword

141 
loÿl
 
funùiÚ
 
	$auth_autİubkey
(
£ssiÚ
, 
·sswÜd
)

142 
	`as£¹
(
£ssiÚ
 ~ğ
n
, "Session shouldn't be‚il")

143 ià(
	`ty³
(
·sswÜd
è~ğ"¡ršg" 
ªd
…asswÜd ~ğ
n
è
th’


144  
n
, "Password should be string"

145 
’d


146 
loÿl
 
auth_¡©us
 = 
libssh
.
	$ssh_u£¿uth_autİubkey
(
£ssiÚ
, 
·sswÜd
)

147  
	$check_auth_¡©us
(
auth_¡©us
)

148 
’d


150 -- 
TODO
: 
auth_publickey_fe
 
ªd
 
auth_gs§pi


152 -- 
S‘s
 
·¹icuÏr
 
İtiÚ
.

153 -- @
·¿m
 
£ssiÚ
 
libssh
 session

154 -- @
·¿m
 
İtiÚ
 o±iÚ 
to
 
£t


155 -- @
·¿m
 
v®ue
 
İtiÚ
 value

156 -- @ 
ok
, 
»asÚ


157 
loÿl
 
funùiÚ
 
	$£t_İtiÚ
(
£ssiÚ
, 
İtiÚ
, 
v®ue
)

158 
	`as£¹
(
£ssiÚ
 ~ğ
n
, "Session shouldn't be‚il")

159 
İtiÚ
 =ğ"ho¡" 
th’


160 
	`as£¹
(
	`ty³
(
v®ue
) == "string", "host must be string")

161  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 0, 
v®ue
) >= 0)

162 
–£if
 
İtiÚ
 =ğ"pÜt" 
th’


163 
	`as£¹
(
	`ty³
(
v®ue
) == "number", "port must be integer")

164  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 1, 
	`št_to_num
(
v®ue
)) >= 0)

165 
–£if
 
İtiÚ
 =ğ"u£r" 
th’


166 
	`as£¹
(
	`ty³
(
v®ue
) == "string", "user must be string")

167  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 4, 
v®ue
) >= 0)

168 
–£if
 
İtiÚ
 =ğ"ssh_dœ" 
th’


169 
	`as£¹
(
	`ty³
(
v®ue
) == "string", "ssh_dir must be string")

170  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 5, 
v®ue
) >= 0)

171 
–£if
 
İtiÚ
 =ğ"id’t™y" 
th’


172 
	`as£¹
(
	`ty³
(
v®ue
) == "string", "identity must be string")

173  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 6, 
v®ue
) >= 0)

174 
–£if
 
İtiÚ
 =ğ"known_ho¡s" 
th’


175 
	`as£¹
(
	`ty³
(
v®ue
) == "string", "known_hosts must be string")

176  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 8, 
v®ue
) >= 0)

177 
–£if
 
İtiÚ
 =ğ"timeout" 
th’


178 
	`as£¹
(
	`ty³
(
v®ue
) == "number", "Timeout must be‚umber")

179  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 9, 
	`št_to_num
(
v®ue
)) >= 0)

180 
–£if
 
İtiÚ
 =ğ"ssh1" 
th’


181 
	`as£¹
(
	`ty³
(
v®ue
) == "boolean", "ssh1 must be boolean")

182  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 11, 
	`št_to_num
(
v®ue
 
ªd
 1 
Ü
 0)) >= 0)

183 
–£if
 
İtiÚ
 =ğ"ssh2" 
th’


184 
	`as£¹
(
	`ty³
(
v®ue
) == "boolean", "ssh2 must be boolean")

185  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 12, 
	`št_to_num
(
v®ue
 
ªd
 1 
Ü
 0)) >= 0)

186 
–£if
 
İtiÚ
 =ğ"¡riù_ho¡key" 
th’


187 
	`as£¹
(
	`ty³
(
v®ue
) == "boolean", "strict_hostkey must be boolean")

188  (
libssh
.
	`ssh_İtiÚs_£t
(
£ssiÚ
, 21, 
	`št_to_num
(
v®ue
 
ªd
 1 
Ü
 0)) >= 0)

190  
n
, "Not implemented"

191 
’d


192  
n
, "Unknown option"

193 
’d


195 -- 
şo£
 
the
 
cÚÃùiÚ
 
ªd
 
ä“
 
memÜy


196 
loÿl
 
funùiÚ
 
	$şo£
(
£ssiÚ
)

197 
	`as£¹
(
£ssiÚ
 ~ğ
n
, "Session shouldn't be‚il")

198 
libssh
.
	$ssh_is_cÚÃùed
(
£ssiÚ
è
th’


199 
libssh
.
	$ssh_discÚÃù
(
£ssiÚ
)

200 
’d


201 
libssh
.
	$ssh_ä“
(
£ssiÚ
)

202  
Œue


203 
’d


205 
loÿl
 
funùiÚ
 
	$g‘_issue_bªÃr
(
£ssiÚ
)

206 
	`as£¹
(
£ssiÚ
 ~ğ
n
, "Session shouldn't be‚il")

207  
libssh
.
	$ssh_g‘_issue_bªÃr
(
£ssiÚ
)

208 
’d


210 
loÿl
 
funùiÚ
 
	$»que¡_exec
(
£ssiÚ
, 
cmd
, 
ÿÎback
)

211 
	`as£¹
(
£ssiÚ
 ~ğ
n
, "Session shouldn't be‚il")

212 
	`as£¹
(
	`ty³
(
cmd
) == "string")

213 
loÿl
 
chªÃl
 = 
libssh
.
	$ssh_chªÃl_Ãw
(
£ssiÚ
)

214 
chªÃl
 =ğ
n
 
th’


215  
n
, "Unableo create channel"

216 
’d


217 
loÿl
 
rc
 = 
libssh
.
	`ssh_chªÃl_İ’_£ssiÚ
(
chªÃl
);

218 
rc
 ~ğ0 
th’


219 
libssh
.
	`ssh_chªÃl_ä“
(
chªÃl
);

220  
n
, "Unableo open channel session"

221 
’d


223 -- 
TODO
: 
»Œeive
 
ex™
 
code


224 
loÿl
 
rc
 = 
libssh
.
	$ssh_chªÃl_»que¡_exec
(
chªÃl
, 
cmd
)

225 
rc
 ~ğ0 
th’


226 -- 
”r
 = 
libssh
.
	`ssh_g‘_”rÜ
(
£ssiÚ
)

227 -- 
	`debug
 (
ffi
.
	$¡ršg
(
”r
))

228 
libssh
.
	`ssh_chªÃl_şo£
(
chªÃl
);

229 
libssh
.
	`ssh_chªÃl_ä“
(
chªÃl
);

230  
n
, "Unableo…erform„equest."

231 
’d


232 
loÿl
 
chunks
 = {
	}
}

233 
loÿl
 
bufãr
 = 
ffi
.
Ãw
("char[1024]", {})

234 
loÿl
 
nby‹s
 = 
libssh
.
ssh_chªÃl_»ad
(
chªÃl
, 
bufãr
, 1024, 0);

235 
nby‹s
 > 0 do

236 
loÿl
 
s
 = 
ffi
.
	$¡ršg
(
bufãr
, 
nby‹s
)

237 
ÿÎback
 
th’


238 
	$ÿÎback
(
s
)

240 
bË
.
	$š£¹
(
chunks
, 
s
)

241 
’d


242 
nby‹s
 = 
libssh
.
	`ssh_chªÃl_»ad
(
chªÃl
, 
bufãr
, 1024, 0);

243 
’d


245 
nby‹s
 < 0 
th’


246 
libssh
.
	`ssh_chªÃl_şo£
(
chªÃl
);

247 
libssh
.
	`ssh_chªÃl_ä“
(
chªÃl
);

248  
n


249 
’d


250 
libssh
.
	$ssh_chªÃl_£nd_eof
(
chªÃl
)

251 
libssh
.
	$ssh_chªÃl_şo£
(
chªÃl
)

252 
loÿl
 
rc


253 
loÿl
 
ùr
 = 0

254 
»³©


255 
ffi
.
C
.
	$u¦“p
(50000)

256 
rc
 = 
libssh
.
	$ssh_chªÃl_g‘_ex™_¡©us
(
chªÃl
)

257 
ùr
 = ctr + 1

258 
uÁ
 
rc
 ~ğ-1 
Ü
 
ùr
 > 20

259 
libssh
.
	$ssh_chªÃl_ä“
(
chªÃl
)

260 
ÿÎback
 
th’


261  
Œue
, 
rc


263  
bË
.
	`cÚÿt
(
chunks
), 
rc


264 
’d


265 
’d


268 
Ãw
 =‚ew,

269 
cÚÃù
 = connect,

270 
auth_·sswÜd
 =‡uth_password,

271 
auth_autİubkey
 =‡uth_autopubkey,

272 
£t_İtiÚ
 = set_option,

273 
şo£
 = close,

274 
g‘_issue_bªÃr
 = get_issue_banner,

275 
»que¡_exec
 =„equest_exec,

276 
	}
}

	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/manual.lua

1 
loÿl
 
	gmod
 = {}

2 
mod
.
__šdex
 = mod

4 
loÿl
 
Çme¥aûs
 = 
»quœe
 "namespaces"

5 
loÿl
 
ns
 = 
Çme¥aûs
.
	$g‘
()

7 
funùiÚ
 
	$cÚfœm
()

8 
loÿl
 
ªsw”


9 
»³©


10 
io
.
	`wr™e
("continue (y/n)? ")

11 
ªsw”
 = 
io
.
	$»ad
()

12 
uÁ
 
ªsw”
 =ğ"y" 
Ü
‡nswer == "n"

13  
ªsw”
 =ğ"y" 
ªd
 0 
Ü
 -1

14 
’d


17 
funùiÚ
 
mod
.
	$addIÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

18 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
("cÚfigu»:‡ddØš‹rçû %  %s/%d", 
š‹rçû
, 

, 
pfx
))

19  
	$cÚfœm
()

20 
’d


22 
funùiÚ
 
mod
.
	$d–IÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

23 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
("cÚfigu»: d–‘äom iÁ”çû %  %s/%d", 
š‹rçû
, 

, 
pfx
))

24  
	$cÚfœm
()

25 
’d


27 
funùiÚ
 
mod
.
	$ş—rIPF‹rs
()

28 
io
.
	`wr™e
("configure: clear IP Filters")

29  
	$cÚfœm
()

30 
’d


32 
funùiÚ
 
mod
.
	$addIPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

33 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
("cÚfigu»:‡dd i°f‹¸äom %s/%dØ%s/%d", 
¤c
, 
sPfx
, 
d¡
, 
dPfx
))

34  
	$cÚfœm
()

35 
’d


37 
funùiÚ
 
mod
.
	$d–IPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

38 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
("cÚfigu»: d–‘ f‹¸äom %s/%dØ%s/%d", 
¤c
, 
sPfx
, 
d¡
, 
dPfx
))

39  
	$cÚfœm
()

40 
’d


42 
funùiÚ
 
mod
.
	$ş—rIPRou‹s
()

43 
io
.
	`wr™e
("configure: clear IP Routes")

44  
	$cÚfœm
()

45 
’d


47 
funùiÚ
 
mod
.
	$addIPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

48 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
("cÚfigu»:‡dd„ou‹Ø%s/%d vŸ % dev %s", 
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
))

49  
	$cÚfœm
()

50 
’d


52 
funùiÚ
 
mod
.
	$d–IPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

53 
io
.
	`wr™e
(
¡ršg
.
	`fÜm©
("cÚfigu»: d–‹„ou‹Ø%s/%d vŸ % dev %s", 
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
))

54  
	$cÚfœm
()

55 
’d


57 
funùiÚ
 
mod
.
	$g‘IPRou‹CouÁ
()

58 
io
.
	`wr™e
("configure: get ip„oute count: ")

59  
	`tÚumb”
(
io
.
	$»ad
())

60 
’d


62 
funùiÚ
 
mod
.
	$g‘DeviûName
()

63 
	`ty³
(
ns
.
deviûName
è~ğ
¡ršg
 
th’


64 
io
.
	`wr™e
("configure: get device‚ame: ")

65 
ns
.
deviûName
 = 
io
.
	$»ad
()

66 
’d


67  
ns
.
deviûName


68 
’d


70 
funùiÚ
 
mod
.
	$g‘DeviûOS
()

71 
	`ty³
(
ns
.
deviûOS
è~ğ
¡ršg
 
th’


72 
io
.
	`wr™e
("configure: get device OS: ")

73 
ns
.
deviûOS
 = 
io
.
	$»ad
()

74 
’d


75  
ns
.
deviûOS


76 
’d


78  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/snmp.lua

1 
loÿl
 
	g¢mpc
 = 
»quœe
 "utils.snmpc"

2 
loÿl
 
cÚf
 = 
»quœe
 "config"

4 
loÿl
 
mod
 = {}

5 
mod
.
__šdex
 = mod

7 
loÿl
 
£ssiÚ
 = 
n


9 
funùiÚ
 
mod
.
	$addIÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

10  
£ssiÚ
:
	$addIp
(

, 
pfx
, 
š‹rçû
)

11 
’d


13 
funùiÚ
 
mod
.
	$d–IÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

14  
£ssiÚ
:
	$d–Ip
(

, 
pfx
, 
š‹rçû
)

15 
’d


17 
funùiÚ
 
mod
.
	$ş—rIPF‹rs
()

19 
’d


21 
funùiÚ
 
mod
.
	$addIPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

23 
’d


25 
funùiÚ
 
mod
.
	$d–IPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

27 
’d


29 
funùiÚ
 
mod
.
	$ş—rIPRou‹s
()

31 
’d


33 
funùiÚ
 
mod
.
	$addIPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

34  
£ssiÚ
:
	$addRou‹EÁry
(
d¡
, 
pfx
, 
g©eway
, 
š‹çû
, 4)

35 
’d


37 
funùiÚ
 
mod
.
	$d–IPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

38  
£ssiÚ
:
	$d–‘eRou‹EÁry
(
d¡
, 
pfx
, 
g©eway
)

39 
’d


41 
funùiÚ
 
mod
.
	$g‘IPRou‹CouÁ
()

43 
’d


45 
funùiÚ
 
mod
.
	$g‘SessiÚ
()

46 
nÙ
 
£ssiÚ
 
th’


47 
£ssiÚ
 = 
¢mp
.
	`£ssiÚ
(
cÚf
.
	`g‘Ho¡
(), 
¢mpc
.
v”siÚ2c
, cÚf.
	$g‘SNMPComm
())

48 
’d


49  
£ssiÚ


50 
’d


53  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ssh-freebsd.lua

1 
loÿl
 
	gcÚf
 = 
»quœe
 "config"

2 
loÿl
 
ssh
 = 
»quœe
 "utils.ffi.ssh"

6 
loÿl
 
mod
 = {}

7 
mod
.
__šdex
 = mod

8 
loÿl
 
£ssiÚ
 = 
n


10 
funùiÚ
 
mod
.
	$addIÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

11  
mod
.
	`exec
("ifcÚfig " .. 
š‹rçû
 .. " iÃˆ" .. 

 .. "/" .. 
pfx
 .. "‡dd")

12 
’d


14 
funùiÚ
 
mod
.
	$d–IÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

15  
mod
.
	`exec
("ifcÚfig " .. 
š‹rçû
 .. " iÃˆ" .. 

 .. " -alias")

16 
’d


17 -- 
The
 
Fœew®l
 
is
 
nÙ
 
suµÜ‹d
 
y‘
. 
K”Ãl
 
mu¡
 
be
 
»comped
 
fœ¡
 
ªd
 
the
 
mod
.
addIPF‹r
‡nd mod.
d–IPF‹r


18 -- 
ÿÂÙ
 
be
 
Œª¦©ed
 
š
 
th©
 
ex‹Á


19 
funùiÚ
 
mod
.
	$ş—rIPF‹rs
()

20  
mod
.
	`exec
("ipf -Fa")

21 
’d


23 
funùiÚ
 
mod
.
	$addIPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

24  
mod
.
	`exec
("´štà\"block iÀäom " .. 
¤c
 .. "/" .. 
sPfx
 .. "Ø" .. 
d¡
 .. "/" .. 
dPfx
 .. "\nblock out from " .. src .. "/" .. sPfx .. "o " .. dst .. "/" .. dPfx .. "\" | ipf -f -")

25 
’d


27 
funùiÚ
 
mod
.
	$d–IPF‹r
()

29 
’d


31 
funùiÚ
 
mod
.
	$ş—rIPRou‹s
()

32  
mod
.
	`exec
("route flush")

33 
’d


34 --
F»eBSD
 
dÛs
 
nÙ
 
suµÜt
 
š‹rçû


35 
funùiÚ
 
mod
.
	$addIPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

36 
g©eway
 
ªd
 
š‹rçû
 
th’


37  
mod
.
	`exec
("rou‹‡dd -Ãt" .. 
d¡
 .. "/" .. 
pfx
 .. 
g©eway
)

38 
–£if
 
g©eway
 
th’


39  
mod
.
	`exec
("rou‹‡dd -Ãt" .. 
d¡
 .. "/" .. 
pfx
 .. 
g©eway
)

40 
–£if
 
š‹rçû
 
th’


41  
mod
.
	`exec
("rou‹‡dd -Ãt" .. 
d¡
 .. "/" .. 
pfx
 .. 
g©eway
)

44 
’d


45 
’d


46 --
Same
 
h”e
: 
F»eBSD
 
dÛs
 
nÙ
 
suµÜt
 
š‹rçû


47 
funùiÚ
 
mod
.
	$d–IPRou‹
()

48 
g©eway
 
ªd
 
š‹rçû
 
th’


49  
mod
.
	`exec
("rou‹ d– " .. 
d¡
 .. "/" .. 
pfx
 .. 
g©eway
)

50 
–£if
 
g©eway
 
th’


51  
mod
.
	`exec
("rou‹ d– " .. 
d¡
 .. "/" .. 
pfx
 .. 
g©eway
)

52 
–£if
 
š‹rçû
 
th’


53  
mod
.
	`exec
("rou‹ d– " .. 
d¡
 .. "/" .. 
pfx
 .. 
g©eway
)

56 
’d


57 
’d


58 --
I
 
dÚt
 
know
 
this
 
wÜks
, 
sšû
 
Ãt¡©
 
di¥Ïys
 
comm’ts


59 
funùiÚ
 
mod
.
	$g‘IPRou‹CouÁ
()

60 
loÿl
 
ok
, 
»s
 = 
mod
.
	`exec
("netstat -rn -4 | wc -l")

61  
ok
, 
	$tÚumb”
(
»s
)

62 
’d


64 
funùiÚ
 
mod
.
	$exec
(
cmd
)

65 
loÿl
 
£ss
, 
”r
 = 
mod
.
	$g‘SessiÚ
()

66 
nÙ
 
£ss
 
Ü
 
”r
 ~ğ0 
th’


67  -1, 
”r


68 
’d


69 
cmd_»s
, 
rc
 = 
ssh
.
	$»que¡_exec
(
£ss
, 
cmd
)

70 
cmd_»s
 =ğ
n
 
th’


71 
	$´št
(
rc
)

72  -1, 
rc


73 
’d


74  
rc
, 
cmd_»s


75 
’d


77 
funùiÚ
 
	$exec
(
cmd
)

78 
loÿl
 
£ss
, 
”r
 = 
	$g‘SessiÚ
()

79 
nÙ
 
£ss
 
Ü
 
”r
 ~ğ0 
th’


80  
”r


81 
’d


82 
cmd_»s
 = 
ssh
.
	$»que¡_exec
(
£ss
, 
cmd
)

83  
	`tÚumb”
(
ssh
.
	`»que¡_exec
(
£ss
, "echØ$?")), 
cmd_»s


84 
’d


87 
funùiÚ
 
mod
.
	$g‘SessiÚ
()

88 
nÙ
 
£ssiÚ
 
th’


89 
	`´št
("ssh:ƒstablishing‚ew connection")

90 
£ssiÚ
 = 
ssh
.
	$Ãw
()

91 
£ssiÚ
 =ğ
n
 
th’


92  
n
, -1

93 
’d


94 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "u£r", 
cÚf
.
	$g‘SSHU£r
())

95 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "ho¡", 
cÚf
.
	$g‘Ho¡
())

96 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "pÜt", 
cÚf
.
	`g‘SSHPÜt
())

97 -- dØ
nÙ
 
ask
 
checkšg
 
ho¡
 
sigÇtu»


98 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "¡riù_ho¡key", 
çl£
)

101 
ssh
.
	$cÚÃù
(
£ssiÚ
)

102 
loÿl
 
ok
 = 
ssh
.
	$auth_autİubkey
(
£ssiÚ
)

103 
nÙ
 
ok
 
th’


104 
ok
 = 
ssh
.
	`auth_·sswÜd
(
£ssiÚ
, 
cÚf
.
	$g‘SSHPass
())

105 
’d


107 
nÙ
 
ok
 
th’


108  
n
, -1

109 
’d


111 -- 
could
 
g‘
 
bªÃr
 
to
 
guess
 
sy¡em


112 -- (
MikrÙik
)

113 -- 
ssh
.
	$g‘_issue_bªÃr
(
£ssiÚ
)

114 
£ssiÚ
 = session

115 
’d


116  
£ssiÚ
, 0

117 
’d


120  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ssh-mikrotik.lua

1 
loÿl
 
	gcÚf
 = 
»quœe
 "config"

2 
loÿl
 
ssh
 = 
»quœe
 "utils.ffi.ssh"

5 
loÿl
 
mod
 = {}

6 
mod
.
__šdex
 = mod

7 
loÿl
 
£ssiÚ
 = 
n


9 
funùiÚ
 
mod
.
	$addIÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

10  
mod
.
	`exec
("/‡dd»s add‡dd»ss=" .. 

 .. "/" .. 
pfx
 .. " iÁ”çû=" .. 
š‹rçû
)

11 
’d


13 
funùiÚ
 
mod
.
	$d–IÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

14  
mod
.
	`exec
("/‡dd»s »mov[/‡dd»s fšd‡dd»ss=\"" .. 

 .. "/" .. 
pfx
 .. "\" iÁ”çû=" .. 
š‹rçû
 .. "]")

15 
’d


17 
funùiÚ
 
mod
.
	$ş—rIPF‹rs
()

18  
mod
.
	`exec
("/ip firewall filter„emove [/ip firewall filter find]")

19 
’d


21 
funùiÚ
 
mod
.
	$addIPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

22  
mod
.
	`exec
("/ fœew®Èf‹¸add chaš=fÜw¬d src-add»ss=" .. 
¤c
 .. "/" .. 
sPfx
 .. " d¡-add»ss=" .. 
d¡
 .. "/" .. 
dPfx
 .. "‡ction=drop")

23 
’d


25 
funùiÚ
 
mod
.
	$d–IPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

26  
mod
.
	`exec
("/ fœew®Èf‹¸»mov[/ fœew®Èf‹¸fšd chaš=fÜw¬d src-add»ss=\"" .. 
¤c
 .. "/" .. 
sPfx
 .. "\" d¡-add»ss=\"" .. 
d¡
 .. "/" .. 
dPfx
 .. "\"‡ction=drop]")

27 
’d


29 
funùiÚ
 
mod
.
	$ş—rIPRou‹s
()

31 
’d


33 
funùiÚ
 
mod
.
	$addIPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

34 
g©eway
 
th’


35  
mod
.
	`exec
("/„ou‹‡dd d¡-add»ss=" .. 
d¡
 .. "/" .. 
pfx
 .. " g©eway=" .. 
g©eway
)

36 
–£if
 
š‹rçû
 
th’


37  
mod
.
	`exec
("/„ou‹‡dd d¡-add»ss=" .. 
d¡
 .. "/" .. 
pfx
 .. " g©eway=" .. 
š‹rçû
)

40 
’d


41 
’d


43 
funùiÚ
 
mod
.
	$d–IPRou‹
()

44 
g©eway
 
ªd
 
š‹rçû
 
th’


45  
mod
.
	`exec
("/„ou‹„emov[/„ou‹ fšd d¡-add»ss=" .. 
d¡
 .. "/" .. 
pfx
 .. " g©eway=" .. 
g©eway
 .. "]")

46 
–£if
 
š‹rçû
 
th’


47  
mod
.
	`exec
("/„ou‹„emov[/„ou‹ fšd d¡-add»ss=" .. 
d¡
 .. "/" .. 
pfx
 .. " g©eway=" .. 
š‹rçû
 .. "]")

50 
’d


51 
’d


53 
funùiÚ
 
mod
.
	$g‘IPRou‹CouÁ
()

54 
loÿl
 
ok
, 
»s
 = 
mod
.
	`exec
("/ip„oute…rint count-only")

55  
ok
, 
	$tÚumb”
(
»s
)

56 
’d


59 
funùiÚ
 
mod
.
	$exec
(
cmd
)

60 
loÿl
 
£ss
, 
”r
 = 
mod
.
	$g‘SessiÚ
()

61 
nÙ
 
£ss
 
Ü
 
”r
 ~ğ0 
th’


62  -1, 
”r


63 
’d


64 
cmd_»s
, 
rc
 = 
ssh
.
	$»que¡_exec
(
£ss
, 
cmd
)

65 
cmd_»s
 =ğ
n
 
th’


66 
	$´št
(
rc
)

67  -1, 
rc


68 
’d


69  
rc
, 
cmd_»s


70 
’d


72 
funùiÚ
 
mod
.
	$g‘SessiÚ
()

73 
nÙ
 
£ssiÚ
 
th’


74 
	`´št
("ssh:ƒstablishing‚ew connection")

75 
£ssiÚ
 = 
ssh
.
	$Ãw
()

76 
£ssiÚ
 =ğ
n
 
th’


77  
n
, -1

78 
’d


79 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "u£r", 
cÚf
.
	$g‘SSHU£r
())

80 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "ho¡", 
cÚf
.
	$g‘Ho¡
())

81 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "pÜt", 
cÚf
.
	`g‘SSHPÜt
())

82 -- dØ
nÙ
 
ask
 
checkšg
 
ho¡
 
sigÇtu»


83 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "¡riù_ho¡key", 
çl£
)

85 
ssh
.
	$cÚÃù
(
£ssiÚ
)

86 
loÿl
 
ok
 = 
ssh
.
	$auth_autİubkey
(
£ssiÚ
)

87 
nÙ
 
ok
 
th’


88 
ok
 = 
ssh
.
	`auth_·sswÜd
(
£ssiÚ
, 
cÚf
.
	$g‘SSHPass
())

89 
’d


91 
nÙ
 
ok
 
th’


92  
n
, -1

93 
’d


94 
’d


95  
£ssiÚ
, 0

96 
’d


99  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ssh.lua

1 
loÿl
 
	gcÚf
 = 
»quœe
 "config"

2 
loÿl
 
ssh
 = 
»quœe
 "utils.ffi.ssh"

6 
loÿl
 
mod
 = {}

7 
mod
.
__šdex
 = mod

8 
loÿl
 
£ssiÚ
 = 
n


10 
funùiÚ
 
mod
.
	$addIÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

11  
mod
.
	`exec
("‡dd¸add " .. 

 .. "/" .. 
pfx
 .. " dev " .. 
š‹rçû
)

12 
’d


14 
funùiÚ
 
mod
.
	$d–IÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

15  
mod
.
	`exec
("‡dd¸d– " .. 

 .. "/" .. 
pfx
 .. " dev " .. 
š‹rçû
)

16 
’d


18 
funùiÚ
 
mod
.
	$ş—rIPF‹rs
()

19  
mod
.
	`exec
("iptables --flush FORWARD")

20 
’d


22 
funùiÚ
 
mod
.
	$addIPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

23  
mod
.
	`exec
("bË -A FORWARD - " .. 
¤c
 .. "/" .. 
sPfx
 .. " -d " .. 
d¡
 .. "/" .. 
dPfx
 .. " -j DROP")

24 
’d


26 
funùiÚ
 
mod
.
	$d–IPF‹r
()

27  
mod
.
	`exec
("bË -D FORWARD - " .. 
¤c
 .. "/" .. 
sPfx
 .. " -d " .. 
d¡
 .. "/" .. 
dPfx
 .. " -j DROP")

28 
’d


30 
funùiÚ
 
mod
.
	$ş—rIPRou‹s
()

31  
mod
.
	`exec
("ip„oute flushable main")

32 
’d


34 
funùiÚ
 
mod
.
	$addIPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

35 
g©eway
 
ªd
 
š‹rçû
 
th’


36  
mod
.
	`exec
("„ou‹‡dd " .. 
d¡
 .. "/" .. 
pfx
 .. " vŸ " .. 
g©eway
 .. " dev " .. 
š‹rçû
)

37 
–£if
 
g©eway
 
th’


38  
mod
.
	`exec
("„ou‹‡dd " .. 
d¡
 .. "/" .. 
pfx
 .. " vŸ " .. 
g©eway
)

39 
–£if
 
š‹rçû
 
th’


40  
mod
.
	`exec
("„ou‹‡dd " .. 
d¡
 .. "/" .. 
pfx
 .. " dev " .. 
š‹rçû
)

43 
’d


44 
’d


46 
funùiÚ
 
mod
.
	$d–IPRou‹
()

47 
g©eway
 
ªd
 
š‹rçû
 
th’


48  
mod
.
	`exec
("„ou‹ d– " .. 
d¡
 .. "/" .. 
pfx
 .. " vŸ " .. 
g©eway
 .. " dev " .. 
š‹rçû
)

49 
–£if
 
g©eway
 
th’


50  
mod
.
	`exec
("„ou‹ d– " .. 
d¡
 .. "/" .. 
pfx
 .. " vŸ " .. 
g©eway
)

51 
–£if
 
š‹rçû
 
th’


52  
mod
.
	`exec
("„ou‹ d– " .. 
d¡
 .. "/" .. 
pfx
 .. " dev " .. 
š‹rçû
)

55 
’d


56 
’d


58 
funùiÚ
 
mod
.
	$g‘IPRou‹CouÁ
()

59 
loÿl
 
ok
, 
»s
 = 
mod
.
	`exec
("ip„oute show | wc -l")

60  
ok
, 
	$tÚumb”
(
»s
)

61 
’d


63 
funùiÚ
 
mod
.
	$exec
(
cmd
)

64 
loÿl
 
£ss
, 
”r
 = 
mod
.
	$g‘SessiÚ
()

65 
nÙ
 
£ss
 
Ü
 
”r
 ~ğ0 
th’


66  -1, 
”r


67 
’d


68 
cmd_»s
, 
rc
 = 
ssh
.
	$»que¡_exec
(
£ss
, 
cmd
)

69 
cmd_»s
 =ğ
n
 
th’


70 
	$´št
(
rc
)

71  -1, 
rc


72 
’d


73  
rc
, 
cmd_»s


74 
’d


76 
funùiÚ
 
	$exec
(
cmd
)

77 
loÿl
 
£ss
, 
”r
 = 
	$g‘SessiÚ
()

78 
nÙ
 
£ss
 
Ü
 
”r
 ~ğ0 
th’


79  
”r


80 
’d


81 
cmd_»s
 = 
ssh
.
	$»que¡_exec
(
£ss
, 
cmd
)

82  
	`tÚumb”
(
ssh
.
	`»que¡_exec
(
£ss
, "echØ$?")), 
cmd_»s


83 
’d


86 
funùiÚ
 
mod
.
	$g‘SessiÚ
()

87 
nÙ
 
£ssiÚ
 
th’


88 
	`´št
("ssh:ƒstablishing‚ew connection")

89 
£ssiÚ
 = 
ssh
.
	$Ãw
()

90 
£ssiÚ
 =ğ
n
 
th’


91  
n
, -1

92 
’d


93 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "u£r", 
cÚf
.
	$g‘SSHU£r
())

94 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "ho¡", 
cÚf
.
	$g‘Ho¡
())

95 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "pÜt", 
cÚf
.
	`g‘SSHPÜt
())

96 -- dØ
nÙ
 
ask
 
checkšg
 
ho¡
 
sigÇtu»


97 
ssh
.
	`£t_İtiÚ
(
£ssiÚ
, "¡riù_ho¡key", 
çl£
)

100 
ssh
.
	$cÚÃù
(
£ssiÚ
)

101 
loÿl
 
ok
 = 
ssh
.
	$auth_autİubkey
(
£ssiÚ
)

102 
nÙ
 
ok
 
th’


103 
ok
 = 
ssh
.
	`auth_·sswÜd
(
£ssiÚ
, 
cÚf
.
	$g‘SSHPass
())

104 
’d


106 
nÙ
 
ok
 
th’


107  
n
, -1

108 
’d


110 -- 
could
 
g‘
 
bªÃr
 
to
 
guess
 
sy¡em


111 -- (
MikrÙik
)

112 -- 
ssh
.
	$g‘_issue_bªÃr
(
£ssiÚ
)

113 
£ssiÚ
 = session

114 
’d


115  
£ssiÚ
, 0

116 
’d


119  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/testreport.lua

1 
loÿl
 
	guts
 = 
»quœe
 "utils.utils"

3 
loÿl
 
mod
 = {}

4 
mod
.
__šdex
 = mod

6 
loÿl
 
‹xHdr
 = [[

7 \
docum’tşass
{
¬tişe
}

8 \
u£·ckage
{
muÉœow
}

9 \
u£·ckage
{
g¿phicx
}

10 \
u£·ckage
{
lÚgbË
,
bu
}

11 \
u£·ckage
[
m¬gš
=1
š
]{
geom‘ry
}

12 \
»Ãwcommªd
{\
thesub£ùiÚ
}{\
¬abic
{
sub£ùiÚ
}}

13 \
begš
{
docum’t
}

14 \
£ùiÚ
*{
RFC
 2544 
Te¡
 
R•Üt
}

17 
loÿl
 
v¥aûTex
 = [[

18 \
v¥aû
*{0.5c
m
}

19 \
Ãwlše


22 
loÿl
 
imgTex
 = [[

23 \
begš
{
ûÁ”
}

24 \
šşudeg¿phics
{##
IMG
##}

25 \
’d
{
ûÁ”
}

28 
loÿl
 
g’”®InfoTex
 = [[

29 \
sub£ùiÚ
{
G’”®
 
Te¡
 
InfÜm©iÚ
}

30 \
begš
{
bu
} 
to
 \
‹xtwidth
{
lX
}

31 
Deviû
 
Und”
 
Te¡
: & ##
DUT_NAME
## \\

32 
O³¿tšg
 
Sy¡em
: & ##
OS_NAME
## \\

33 
D©e
: & ##
DATE
##\\

34 \
’d
{
bu
}

37 
loÿl
 
throughputInfoTex
 = [[

38 \
sub£ùiÚ
{
Throughput
}\
begš
{
bu
} 
to
 \
‹xtwidth
{
lX
}

39 
Te¡
 
Du¿tiÚ
: & ##
DURATION
## \\

40 
Maxim®
 
Loss
 
R©e
: & ##
MAXLOSS
## \\

41 
Accu¿cy
: & ##
ACCURACY
## \\

42 \
’d
{
bu
}

45 
loÿl
 
Ï‹ncyInfoTex
 = [[

46 \
sub£ùiÚ
{
L©’cy
}\
begš
{
bu
} 
to
 \
‹xtwidth
{
lX
}

47 
Te¡
 
Du¿tiÚ
: & ##
DURATION
## \\

48 \
’d
{
bu
}

51 
loÿl
 
äam–ossInfoTex
 = [[

52 \
sub£ùiÚ
{
F¿me
 
loss
 
¿‹
}\
begš
{
bu
} 
to
 \
‹xtwidth
{
lX
}

53 
Te¡
 
Du¿tiÚ
: & ##
DURATION
## \\

54 \
’d
{
bu
}

57 
loÿl
 
btbInfoTex
 = [[

58 \
sub£ùiÚ
{
Back
-
to
-
back
 
äames
}\
begš
{
bu
}Ø\
‹xtwidth
{
lX
}

59 
Te¡
 
Du¿tiÚ
: & ##
DURATION
## \\

60 
Accu¿cy
: & ##
ACCURACY
## \\

61 
R©e
: & ##
RATE
## \\

62 \
’d
{
bu
}

65 
funùiÚ
 
mod
.
	$Ãw
(
f’ame
)

66 
loÿl
 
£lf
 = 
	`£tm‘©abË
({
	}
}, 
	gmod
)

68 
	g£lf
.
	gf’ame
 = 
f’ame


70 
£lf
.
throughput
 = {}

71 
£lf
.
Ï‹ncy
 = {}

72 
£lf
.
äam–oss
 = {}

73 
£lf
.
btb
 = {}

75  
£lf


76 
’d


78 
funùiÚ
 
mod
:
	$addThroughput
(
»suÉ
, 
du¿tiÚ
, 
mÌ
, 
accu¿cy
)

79 
£lf
.
throughput
.
du¿tiÚ
 = duration

80 
£lf
.
throughput
.
mÌ
 = mlr

81 
£lf
.
throughput
.
accu¿cy
 =‡ccuracy

82 
bË
.
	`š£¹
(
£lf
.
throughput
, {
k
 = 
»suÉ
[1].
äameSize
, 
v
 = 
	}
result})

83 
’d


85 
funùiÚ
 
	gmod
:
	$addL©’cy
(
»suÉ
, 
du¿tiÚ
)

86 
£lf
.
Ï‹ncy
.
du¿tiÚ
 = duration

87 
bË
.
	`š£¹
(
£lf
.
Ï‹ncy
, {
k
 = 
»suÉ
.
äameSize
, 
v
 = 
	}
result})

88 
’d


90 
funùiÚ
 
	gmod
:
	$addF¿m–oss
(
»suÉ
, 
du¿tiÚ
)

91 
£lf
.
äam–oss
.
du¿tiÚ
 = duration

92 
bË
.
	`š£¹
(
£lf
.
äam–oss
, {
k
 = 
»suÉ
[1].
size
, 
v
 = 
	}
result})

93 
’d


95 
funùiÚ
 
	gmod
:
	$addBackToBack
(
»suÉ
, 
du¿tiÚ
, 
accu¿cy
, 
¿‹
)

96 
£lf
.
btb
.
du¿tiÚ
 = duration

97 
£lf
.
btb
.
accu¿cy
 =‡ccuracy

98 
£lf
.
btb
.
¿‹
 =„ate

99 
bË
.
	`š£¹
(
£lf
.
btb
, {
k
 = 
»suÉ
.
äameSize
, 
v
 = 
	}
result})

100 
’d


103 
funùiÚ
 
	gmod
:
	$wr™eG’”®Info
(
fe
)

104 
loÿl
 
‹x
 = 
g’”®InfoTex


105 
‹x
 =ex:
	`gsub
("##DUT_NAME##", 
uts
.
	$g‘DeviûName
())

106 
‹x
 =ex:
	`gsub
("##OS_NAME##", 
uts
.
	$g‘DeviûOS
())

107 
‹x
 =ex:
	`gsub
("##DATE##", 
os
.
	`d©e
("%F"))

108 
fe
:
	$wr™e
(
‹x
)

109 
’d


111 
funùiÚ
 
mod
:
	$wr™eThroughput
(
fe
)

112 
loÿl
 
‹x
 = 
throughputInfoTex


113 
‹x
 =ex:
	`gsub
("##DURATION##", 
¡ršg
.
	`fÜm©
("%d s", 
£lf
.
throughput
.
du¿tiÚ
))

114 
‹x
 =ex:
	`gsub
("##MAXLOSS##", 
¡ršg
.
	`fÜm©
("%.3à\\%%%%", 
£lf
.
throughput
.
mÌ
 * 100))

115 
‹x
 =ex:
	`gsub
("##ACCURACY##", 
¡ršg
.
	`fÜm©
("%d Mbps", 
£lf
.
throughput
.
accu¿cy
))

116 
fe
:
	$wr™e
(
‹x
)

117 
fe
:
	$wr™e
(
v¥aûTex
)

118 
fe
:
	`wr™e
("\\begin{longtabu}o \\textwidth {X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]} \\hline\n")

119 
fe
:
	`wr™e
("Frame Size (bytes) & Iteration & Total Tx Frames & Total Rx Frames & Throughput (Mpps) & Throughput (Mbps)\\\\ \\hline\n")

120 
bË
.
	`sÜt
(
£lf
.
throughput
, 
	$funùiÚ
(
e1
, 
e2
èƒ1.
k
 <ƒ2.k 
’d
)

121 
_
, 
p
 
š
 
	$aœs
(
£lf
.
throughput
) do

122 
loÿl
 
muÉœow
 = #p.
v
 > 1

123 
muÉœow
 
th’


124 -- 
muÉœow
 1 
cŞumn
 
dÛs
 
nÙ
 
wÜk
 
w–l


125 
fe
:
	`wr™e
(
¡ršg
.
	`fÜm©
("\\muÉœow{%d}{*}{%d}", #p.
v
, 
p
.
k
))

126 
’d


128 
i
, 
r
 
š
 
	$aœs
(
p
.
v
) do

129 
nÙ
 
muÉœow
 
th’


130 
fe
:
	$wr™e
(
r
.
äameSize
)

131 
’d


132 
fe
:
	`wr™e
(
¡ršg
.
	`fÜm©
(" & %d & %d & %d & %.3à& %.3f\\\\\n", 
i
 , 
r
.
¥kts
,„.
½kts
,„.
mµs
,„.mµ * 8 * (r.
äameSize
 + 20)))

133 
’d


134 
’d


135 
fe
:
	`wr™e
("\\hline\n\\end{longtabu}\n")

136 
loÿl
 
img
 = 
imgTex
:
	`gsub
("##IMG##", "plot_throughput_mpps")

137 
fe
:
	$wr™e
(
img
)

138 
fe
:
	`wr™e
("\\newpage\n")

139 
’d


141 
funùiÚ
 
mod
:
	$wr™eL©’cy
(
fe
)

142 
loÿl
 
‹x
 = 
Ï‹ncyInfoTex


143 
‹x
 =ex:
	`gsub
("##DURATION##", 
¡ršg
.
	`fÜm©
("%d s", 
£lf
.
Ï‹ncy
.
du¿tiÚ
))

144 
fe
:
	$wr™e
(
‹x
)

145 
fe
:
	$wr™e
(
v¥aûTex
)

146 
fe
:
	`wr™e
("\\begin{longtabu}o \\textwidth {X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]X[4,r,m]} \\hline\n")

147 
fe
:
	`wr™e
("Frame Size (bytes) & Throughput (Mpps) & Latency Min ($\\mu$s)& Latency Avg ($\\mu$s)& Latency Max ($\\mu$s)& \\\\ \\hline\n")

148 
_
, 
p
 
š
 
	$aœs
(
£lf
.
Ï‹ncy
) do

149 
loÿl
 
hi¡o
 = 
p
.
v


150 
hi¡o
:
	$ÿlc
()

151 
loÿl
 
n
 = #hi¡o.
sÜ‹dHi¡o


152 
fe
:
	`wr™e
(
¡ršg
.
	`fÜm©
("%d & %.3à& %.1à& %.1à& %.1à& \\šşudeg¿phics[width=\\lšewidth]{¶Ù_Ï‹ncy_hi¡o_%d} \\\\\n", 
p
.
k
, 
hi¡o
.
¿‹
, hi¡o.
sÜ‹dHi¡o
[1].k, hi¡o.
avg
, hi¡o.sÜ‹dHi¡o[
n
].k ,p.k))

153 
’d


154 
fe
:
	`wr™e
("\\hline\n\\end{longtabu}\n\\newpage\n")

155 
’d


157 
funùiÚ
 
mod
:
	$wr™eF¿m–oss
(
fe
)

158 
loÿl
 
‹x
 = 
äam–ossInfoTex


159 
‹x
 =ex:
	`gsub
("##DURATION##", 
¡ršg
.
	`fÜm©
("%d s", 
£lf
.
äam–oss
.
du¿tiÚ
))

160 
fe
:
	$wr™e
(
‹x
)

161 
fe
:
	$wr™e
(
v¥aûTex
)

162 
fe
:
	`wr™e
("\\begin{longtabu}o \\textwidth {X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]} \\hline\n")

163 
fe
:
	`wr™e
("Frame Size (bytes) & Load (\\%) & Total Tx Frames & Total Rx Frames & Total Frames Lost & Frame Loss (\\%) \\\\ \\hline\n")

164 
_
, 
p
 
š
 
	$aœs
(
£lf
.
äam–oss
) do

165 
loÿl
 
n
 = #p.
v


166 
	$´št
(
p
.
k
, 
n
)

167 
fe
:
	`wr™e
(
¡ršg
.
	`fÜm©
("\\muÉœow{%d}{*}{%d}", 
n
, 
p
.
k
))

168 
_
, 
r
 
š
 
	$aœs
(
p
.
v
) do

169 
fe
:
	`wr™e
(
¡ršg
.
	`fÜm©
(" & %.1à& %d & %d & %d & %.4à\\\\ \n", 
r
.
muÉi
 * 100,„.
¥kts
,„.
½kts
, (r.spkts -„.rpkts), (r.spkts -„.rpkts) / (r.spkts) * 100))

170 
’d


171 
fe
:
	`wr™e
("\\hline\n")

172 
’d


173 
fe
:
	`wr™e
("\\end{longtabu}")

174 
loÿl
 
img
 = 
imgTex
:
	`gsub
("##IMG##", "plot_frameloss_percent")

175 
fe
:
	$wr™e
(
img
)

176 
’d


178 
funùiÚ
 
mod
:
	$wr™eBackToBack
(
fe
)

179 
loÿl
 
‹x
 = 
btbInfoTex


180 
‹x
 =ex:
	`gsub
("##DURATION##", 
¡ršg
.
	`fÜm©
("%d s", 
£lf
.
btb
.
du¿tiÚ
))

181 
‹x
 =ex:
	`gsub
("##ACCURACY##", 
¡ršg
.
	`fÜm©
("%d…ack‘s", 
£lf
.
btb
.
accu¿cy
))

182 
‹x
 =ex:
	`gsub
("##RATE##", 
¡ršg
.
	`fÜm©
("%d Mbps", 
£lf
.
btb
.
¿‹
))

183 
fe
:
	$wr™e
(
‹x
)

184 
fe
:
	$wr™e
(
v¥aûTex
)

185 
fe
:
	`wr™e
("\\begin{longtabu}o \\textwidth {X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]X[-1,r,m]} \\hline\n")

186 
fe
:
	`wr™e
("Frame Size (bytes) & Burst size min & Burst size‡vg & Burst size max & Theoretical maximum\\\\ \\hline\n")

187 
_
, 
p
 
š
 
	$aœs
(
£lf
.
btb
) do

188 
loÿl
 
sum
, 
avg
 = 0, 0

189 
loÿl
 
mš
, 
max
 = 
m©h
.
huge
, -math.huge

190 
_
, 
r
 
š
 
	$aœs
(
p
.
v
) do

191 
mš
, 
max
 = 
m©h
.
	`mš
(mš, 
r
), m©h.
	$max
(
max
, 
r
)

192 
sum
 = sum + 
r


193 
’d


194 
avg
 = 
sum
 / #p.
v


195 
fe
:
	`wr™e
(
¡ršg
.
	`fÜm©
("%d & %d & %.1à& %d & %d\\\\\n", 
p
.
k
, 
mš
, 
avg
, 
max
, 
m©h
.
	`û
(
£lf
.
btb
.
¿‹
 / (p.k + 20è/ 8 * s–f.btb.
du¿tiÚ
 * 10^6)))

196 
’d


197 
fe
:
	`wr™e
("\\hline\n\\end{longtabu}\n")

198 
loÿl
 
img
 = 
imgTex
:
	`gsub
("##IMG##", "plot_backtoback")

199 
fe
:
	$wr™e
(
img
)

200 
’d


202 
funùiÚ
 
mod
:
	$fš®ize
()

203 
loÿl
 
‹xFe
 = 
io
.
	`İ’
(
£lf
.
f’ame
, "w")

204 
‹xFe
:
	$wr™e
(
‹xHdr
)

206 
£lf
:
	$wr™eG’”®Info
(
‹xFe
)

208 #£lf.
throughput
 > 0 
th’


209 
£lf
:
	$wr™eThroughput
(
‹xFe
)

210 
’d


212 #£lf.
Ï‹ncy
 > 0 
th’


213 
£lf
:
	$wr™eL©’cy
(
‹xFe
)

214 
’d


216 #£lf.
äam–oss
 > 0 
th’


217 
£lf
:
	$wr™eF¿m–oss
(
‹xFe
)

218 
’d


220 #£lf.
btb
 > 0 
th’


221 
£lf
:
	$wr™eBackToBack
(
‹xFe
)

222 
’d


223 
‹xFe
:
	`wr™e
("\\end{document}")

224 
‹xFe
:
	$şo£
()

225 
’d


227  
mod


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/tikz.lua

2 
loÿl
 
	gtikz
 = {}

3 
tikz
.
__šdex
 =ikz

5 
loÿl
 
¡rS¹
 = [[

6 \
docum’tşass
{
¡ªd®Úe
}

7 \
u£·ckage
{
pgålÙs
}

8 \
pgålÙs£t
{
com·t
=
Ãwe¡
}

10 \
begš
{
docum’t
}

11 \
begš
{
tikzpiùu»
}

12 \
begš
{
axis
}]]

13 
loÿl
 
	g¡rEnd
 = [[

14 \
’d
{
axis
}

15 \
’d
{
tikzpiùu»
}

16 \
’d
{
docum’t
}

19 
funùiÚ
 
	$esÿ³SŒšg
(
¡r
)

20 
¡r
 = sŒ:
	`gsub
("([%%\\%{%}#&_%^~])", "\\%1")

21 
¡r
 = sŒ:
	`gsub
("\\\\", "\\textbackslash{}")

22 
¡r
 = sŒ:
	`gsub
("\\^", "\\textasciicircum{}")

23  
¡r


24 
’d


26 
funùiÚ
 
tikz
.
	$Ãw
(
f’ame
, 
İtiÚs
)

27 
loÿl
 
£lf
 = 
	`£tm‘©abË
({
	}
}, 
	gtikz
)

28 
	g£lf
.
	gfe
 = 
io
.
İ’
(
f’ame
, "w")

29 
	g£lf
.
	g¶Ù
 = 
çl£


31 
£lf
.
fe
:
	$wr™e
(
¡rS¹
)

32 
İtiÚs
 
th’


33 -- 
£lf
.
fe
:
	`wr™e
("[")

34 -- 
k
, 
v
 
š
 
	$·œs
(
İtiÚs
) do

35 -- 
	`ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
	$esÿ³SŒšg
(
v
è
’d


36 -- 
£lf
.
fe
:
	`wr™e
(
k
 .. "={" .. 
v
 .. "},")

37 -- 
’d


38 -- 
£lf
.
fe
:
	`wr™e
("]\n")

39 
£lf
.
fe
:
	`wr™e
("[" .. 
İtiÚs
 .. "]\n")

41 
£lf
.
fe
:
	`wr™e
("\n")

42 
’d


43  
£lf


44 
’d


46 
funùiÚ
 
tikz
:
	$¡¬tPlÙ
(
İtiÚs
)

47 
loÿl
 
fe
 = 
£lf
.file

48 
fe
:
	`wr™e
(" \\addplot")

49 
İtiÚs
 
th’


50 -- 
£lf
.
fe
:
	`wr™e
("[")

51 -- 
k
, 
v
 
š
 
	$·œs
(
İtiÚs
) do

52 -- 
	`ty³
(
v
è=ğ"¡ršg" 
th’
 v = 
	$esÿ³SŒšg
(
v
è
’d


53 -- 
£lf
.
fe
:
	`wr™e
(
k
 .. "={" .. 
v
 .. "},")

54 -- 
’d


55 -- 
£lf
.
fe
:
	`wr™e
("]\n")

56 
£lf
.
fe
:
	`wr™e
("[" .. 
İtiÚs
 .. "]")

57 
’d


58 
fe
:
	`wr™e
(" coordinates {\n")

59 
£lf
.
¶Ù
 = 
Œue


60 
’d


62 
funùiÚ
 
tikz
:
	$addPošt
(
x
, 
y
)

63 
nÙ
 
£lf
.
¶Ù
 
th’


64 
	`”rÜ
("cannot‡dd…air without…lot")

65 
’d


66 
£lf
.
fe
:
	`wr™e
(" (" .. 
x
 .. ", " .. 
y
 .. ")\n")

67 
’d


69 
funùiÚ
 
tikz
:
	$’dPlÙ
(
Ëg’d
)

70 
£lf
.
¶Ù
 = 
çl£


71 
Ëg’d
 
th’


72 
£lf
.
fe
:
	`wr™e
(" };" .. "\\addËg’d’Œy {" .. 
Ëg’d
 .. "}\n")

74 
£lf
.
fe
:
	`wr™e
(" };\n")

75 
’d


76 
’d


78 
funùiÚ
 
tikz
:
	$fš®ize
(
Ëg’d
)

79 
£lf
.
¶Ù
 
th’


80 
£lf
:
	$’dPlÙ
(
Ëg’d
)

81 
’d


82 
£lf
.
fe
:
	$wr™e
(
¡rEnd
)

83 
£lf
.
fe
:
	$şo£
()

84 
’d


	@/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/utils.lua

1 
loÿl
 
	gaùÜs
 = {}

2 
loÿl
 
¡©us
, 
	g¢mp
 = 
pÿÎ
(
»quœe
, 'utils.snmp')

3 
¡©us
 
th’


4 
	gbË
.
	$š£¹
(
aùÜs
, 
¢mp
)

6 
´št
 "unableo†oad snmp module"

7 
’d


9 
loÿl
 
¡©us
, 
sshMikrÙik
 = 
	`pÿÎ
(
»quœe
, 'utils.ssh-mikrotik')

10 
¡©us
 
th’


11 
bË
.
	$š£¹
(
aùÜs
, 
sshMikrÙik
)

13 
´št
 "unableo†oad mikrotik ssh module"

14 
’d


16 
loÿl
 
¡©us
, 
sshF»eBSD
 = 
	`pÿÎ
(
»quœe
, 'utils.ssh-freebsd')

17 
¡©us
 
th’


18 
bË
.
	$š£¹
(
aùÜs
, 
sshF»eBSD
)

20 
´št
 "unableo†oad freeBSD ssh module"

21 
’d


23 
loÿl
 
¡©us
, 
ssh
 = 
	`pÿÎ
(
»quœe
, 'utils.ssh')

24 
¡©us
 
th’


25 
bË
.
	$š£¹
(
aùÜs
, 
ssh
)

27 
´št
 "unableo†oad†inux ssh module"

28 
’d


30 
loÿl
 
mªu®
 = 
»quœe
 "utils.manual"

31 
bË
.
	$š£¹
(
aùÜs
, 
mªu®
)

33 
loÿl
 
mod
 = {
	}
}

34 
mod
.
__šdex
 = mod

36 
funùiÚ
 
mod
.
	$addIÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

37 
loÿl
 
¡©us
 = -1

38 
k
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

39 
¡©us
 = 
aùÜ
.
	$addIÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

40 
¡©us
 =ğ0 
th’


42 
’d


43 
’d


44  
¡©us


45 
’d


47 
funùiÚ
 
mod
.
	$d–IÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

48 
loÿl
 
¡©us
 = -1

49 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

50 
¡©us
 = 
aùÜ
.
	$d–IÁ”çûIP
(
š‹rçû
, 

, 
pfx
)

51 
¡©us
 =ğ0 
th’


53 
’d


54 
’d


55  
¡©us


56 
’d


58 
funùiÚ
 
mod
.
	$ş—rIPF‹rs
()

59 
loÿl
 
¡©us
 = -1

60 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

61 
¡©us
 = 
aùÜ
.
	$ş—rIPF‹rs
()

62 
¡©us
 =ğ0 
th’


64 
’d


65 
’d


66  
¡©us


67 
’d


69 
funùiÚ
 
mod
.
	$addIPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

70 
loÿl
 
¡©us
 = -1

71 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

72 
¡©us
 = 
aùÜ
.
	$addIPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

73 
¡©us
 =ğ0 
th’


75 
’d


76 
’d


77  
¡©us


78 
’d


80 
funùiÚ
 
mod
.
	$d–IPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

81 
loÿl
 
¡©us
 = -1

82 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

83 
¡©us
 = 
aùÜ
.
	$d–IPF‹r
(
¤c
, 
sPfx
, 
d¡
, 
dPfx
)

84 
¡©us
 =ğ0 
th’


86 
’d


87 
’d


88  
¡©us


89 
’d


91 
funùiÚ
 
mod
.
	$ş—rIPRou‹s
()

92 
loÿl
 
¡©us
 = -1

93 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

94 
aùÜ
.
	$ş—rIPRou‹s
()

95 
¡©us
 =ğ0 
th’


97 
’d


98 
’d


99  
¡©us


100 
’d


102 
funùiÚ
 
mod
.
	$addIPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

103 
loÿl
 
¡©us
 = -1

104 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

105 
¡©us
 = 
aùÜ
.
	$addIPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

106 
¡©us
 =ğ0 
th’


108 
’d


109 
’d


110  
¡©us


111 
’d


113 
funùiÚ
 
mod
.
	$d–IPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

114 
loÿl
 
¡©us
 = -1

115 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

116 
¡©us
 = 
aùÜ
.
	$d–IPRou‹
(
d¡
, 
pfx
, 
g©eway
, 
š‹rçû
)

117 
¡©us
 =ğ0 
th’


119 
’d


120 
’d


121  
¡©us


122 
’d


124 
funùiÚ
 
mod
.
	$addIPRou‹Rªge
(
fœ¡IP
, 
Ï¡IP
)

125 
loÿl
 
¡©us
 = -1

126 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

127 
¡©us
 = 
aùÜ
.
	$addIPRou‹Rªge
(
fœ¡IP
, 
Ï¡IP
)

128 
¡©us
 =ğ0 
th’


130 
’d


131 
’d


132  
¡©us


133 
’d


135 
funùiÚ
 
mod
.
	$g‘IPRou‹CouÁ
()

136 
loÿl
 
¡©us
 = -1

137 
_
, 
aùÜ
 
š
 
	$aœs
(
aùÜs
) do

138 
¡©us
 = 
aùÜ
.
	$g‘IPRou‹CouÁ
()

139 
¡©us
 =ğ0 
th’


141 
’d


142 
’d


143  
¡©us


144 
’d


146 
funùiÚ
 
mod
.
	$g‘DeviûName
()

147  
mªu®
.
	$g‘DeviûName
()

148 
’d


150 
funùiÚ
 
mod
.
	$g‘DeviûOS
()

151  
mªu®
.
	$g‘DeviûOS
()

152 
’d


157 
loÿl
 
bš¬yS—rch
 = {
	}
}

158 
bš¬yS—rch
.
__šdex
 = binarySearch

160 
funùiÚ
 
bš¬yS—rch
:
	$ü—‹
(
low”
, 
uµ”
)

161 
loÿl
 
£lf
 = 
	`£tm‘©abË
({
	}
}, 
	gbš¬yS—rch
)

162 
	g£lf
.
	glow”Lim™
 = 
low”


163 
£lf
.
uµ”Lim™
 = 
uµ”


164  
£lf


165 
’d


166 
£tm‘©abË
(
bš¬yS—rch
, { 
__ÿÎ
 = bš¬yS—rch.
ü—‹
 })

168 
funùiÚ
 
	gbš¬yS—rch
:
	$š™
(
low”
, 
uµ”
)

169 
£lf
.
low”Lim™
 = 
low”


170 
£lf
.
uµ”Lim™
 = 
uµ”


171 
’d


173 
funùiÚ
 
bš¬yS—rch
:
	$Ãxt
(
cu¼
, 
tİ
, 
th»shŞd
)

174 
tİ
 
th’


175 
cu¼
 =ğ
£lf
.
uµ”Lim™
 
th’


176  
cu¼
, 
Œue


178 
£lf
.
low”Lim™
 = 
cu¼


179 
’d


181 
cu¼
 =ğ
low”Lim™
 
th’


182  
cu¼
, 
Œue


184 
£lf
.
uµ”Lim™
 = 
cu¼


185 
’d


186 
’d


187 
loÿl
 
ÃxtV®
 = 
m©h
.
	`û
((
£lf
.
low”Lim™
 + s–f.
uµ”Lim™
) / 2)

188 
m©h
.
	`abs
(
ÃxtV®
 - 
cu¼
è< 
th»shŞd
 
th’


189  
cu¼
, 
Œue


190 
’d


191  
ÃxtV®
, 
çl£


192 
’d


194 
mod
.
bš¬yS—rch
 = binarySearch

197 
mod
.
modif›r
 = {

198 
nÚe
 = 0,

199 
¿ndEth
 = 1,

200 
¿ndIp
 = 2

201 
	}
}

203 
funùiÚ
 
	gmod
.
	$g‘PktModif›rFunùiÚ
(
modif›r
, 
ba£Ip
, 
w¿pIp
, 
ba£Eth
, 
w¿pEth
)

204 
loÿl
 
foo
 = 
	$funùiÚ
(è
’d


205 
modif›r
 =ğ
mod
.modif›r.
¿ndEth
 
th’


206 
loÿl
 
‘hCŒ
 = 0

207 
foo
 = 
	$funùiÚ
(
pkt
)

208 
pkt
.

.
d¡
:
	`£tNumb”
(
ba£Eth
 + 
‘hCŒ
)

209 
‘hCŒ
 = 
	$šcAndW¿p
(
‘hCŒ
, 
w¿pEth
)

210 
’d


211 
–£if
 
modif›r
 =ğ
mod
.modif›r.
¿ndIp
 
th’


212 
loÿl
 
CŒ
 = 0

213 
foo
 = 
	$funùiÚ
(
pkt
)

214 
pkt
.

.
d¡
:
	`£t
(
ba£IP
 + 
CŒ
)

215 
CŒ
 = 
	$šcAndW¿p
(
CŒ
, 
w¿pIp
)

216 
’d


217 
’d


218  
foo


219 
’d


221 
b™
 
ç¡”
 
th’
 
macAddr
:
£tNumb”
 
Ü
 macAddr:
£t


222 
ªd
 
ç¡”
 
th’
 
macAddr
:
£tSŒšg


223 
but
 
¡l
 
nÙ
 
ç¡
 
’ough
 
Úe
 
sšgË
 
¦ave
 
ªd
 10
GbE
 @64b 
pkts


224 
£t
 
de¡š©iÚ
 
MAC
 
add»ss


225 
ffi
.
	$cİy
(
macAddr
, 
pkt
.
‘h
.
d¡
.
ušt8
, 6)

226 
macAddr
[0] = (macAddr[0] + 1è% 
macW¿·round


229 
funùiÚ
 
mod
.
	$·r£Argum’ts
(
¬gs
)

230 
loÿl
 
»suÉs
 = {
	}
}

231 
i
=1, #args, 2 do

232 
loÿl
 
	gkey
 = 
¬gs
[
i
]:
gsub
("-", "", 2è-- 
cut
 
off
 
Úe
 
Ü
 
two
 
Ëadšg
 
mšus


233 
	g»suÉs
[
key
] = 
¬gs
[
i
+1]

234 
’d


235  
»suÉs


236 
’d


240  
mod


	@/home/asabzi/msc-project/MoonGen-1/test/config/devices.lua

1 -- 
Ju¡
 
¡¬t
 
	gMoÚG’
.

3 
loÿl
 
	gdpdk
 = 
»quœe
 "dpdk"

5 
funùiÚ
 
	$ma¡”
()

6 
	$¦ave
()

7 
’d


9 -- 
Do
 
nÙhšg
.

10 
funùiÚ
 
	$¦ave
()

11 
’d


	@/home/asabzi/msc-project/MoonGen-1/test/config/pairs.lua

1 -- 
S¹
 
MoÚG’
 
ªd
 
£nd
 
some
 
·ckages
 
äom
 
—ch
 
ÿrd
 
to
 
the
 
	gÃtwÜk
.

2 -- 
Check
 
®l
 
ÿrds
 
they
 
»ûived
 
·ck‘s
 
äom
 
the
 
brßdÿ¡šg
 
	gÿrd
.

4 
loÿl
 
	gdpdk
 = 
»quœe
 "dpdk"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
deviû
 = 
»quœe
 "device"

7 
loÿl
 
tim”
 = 
»quœe
 "timer"

9 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

11 --
memÜy
.
	$’abËCache
()

12 
loÿl
 
PKT_SIZE
 = 100

14 
funùiÚ
 
	$ma¡”
()

15 
loÿl
 
ÿrds
 = 
tcÚfig
.
	$ÿrds
()

16 
loÿl
 
devs
 = {
	}
}

17 
i
=1, #cards do

18 
	gdevs
[
i
] = 
deviû
.
cÚfig
{ 
pÜt
 = 
ÿrds
[i][1], 
	grxQueues
 = 2, 
	gtxQueues
 = 3}

19 
’d


20 
	gdeviû
.
	$wa™FÜLšks
()

21 
i
=1, #devs do

22 
	$brßdÿ¡SÏve
(
devs
[
i
])

23 
dpdk
.
	$¦“pMlis
( 100 )

24 
j
=1, #devs do

25 
	$»ûiveSÏve
(
devs
[
j
],
ÿrds
[j])

26 
’d


27 --
¦ave
:
	$wa™
()

28 
’d


29 
’d


31 
funùiÚ
 
	$brßdÿ¡SÏve
(
dev
)

32 
loÿl
 
queue
 = 
dev
:
	$g‘TxQueue
(0)

33 
dpdk
.
	$¦“pMlis
(100)

34 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
(
	$funùiÚ
(
buf
)

35 
buf
:
	$g‘Eth”ÃtPack‘
():
fl
{

36 
pktL’gth
 = 
PKT_SIZE
,

37 
‘hSrc
 = 
queue
,

38 
‘hD¡
 = "FF:FF:FF:FF:FF:FF:FF:FF"

39 
	}
}

40 
	g’d
)

42 
loÿl
 
	gbufs
 = 
mem
:
	$bufA¼ay
()

44 
loÿl
 
i
 = 0

45 
loÿl
 
max
 = 1

46 
dpdk
.
	$ruÂšg
(è
ªd
 
i
 < 
max
 do

47 -- 
S’d


48 
bufs
:
	$®loc
(
PKT_SIZE
)

49 
queue
:
	$£nd
(
bufs
)

50 
i
 = i + 1

51 
’d


52 
’d


54 
funùiÚ
 
	$»ûiveSÏve
(
dev
,
ÿrd
)

55 
loÿl
 
queue
 = 
dev
:
	$g‘RxQueue
(0)

56 
loÿl
 
bufs
 = 
memÜy
.
	$bufA¼ay
()

57 
ruÁime
 = 
tim”
:
	$Ãw
(0.001)

58 
loÿl
 
lmac
 = "NONE"

59 
ruÁime
:
	$ruÂšg
(è
ªd
 
dpdk
.
	$ruÂšg
() do

60 --
»ûive


61 
maxWa™
 = 1000

62 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 
maxWa™
)

63 
i
=1, 
rx
 do

64 
loÿl
 
buf
 = 
bufs
[
i
]

65 
loÿl
 
pkt
 = 
buf
:
	$g‘Eth”ÃtPack‘
()

66 
loÿl
 
mac
 = 
pkt
.
‘h
:
	$g‘SrcSŒšg
()

67 
	$nÙ
 (
mac
 =ğ
lmac
è
th’


68 
lmac
 = 
mac


69 
	`´št
(
lmac
, " - ", 
ÿrd
[2])

70 
’d


71 
’d


72 
bufs
:
	$ä“
(
rx
)

73 
’d


74 
’d


	@/home/asabzi/msc-project/MoonGen-1/test/config/speed.lua

1 -- 
S¹
 
MoÚG’
 
ªd
 
š™Ÿlize
 
®l
 
	gdeviûs
.

3 
loÿl
 
	gdpdk
 = 
»quœe
 "dpdk"

4 
loÿl
 
deviû
 = 
»quœe
 "device"

6 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

8 
funùiÚ
 
	$ma¡”
()

9 
loÿl
 
ÿrds
 = 
tcÚfig
.
	$ÿrds
()

10 
loÿl
 
devs
 = {
	}
}

11 
i
=1, #cards do

12 
	gdevs
[
i
] = 
deviû
.
cÚfig
{ 
pÜt
 = 
ÿrds
[i][1], 
	grxQueues
 = 2, 
	gtxQueues
 = 3}

13 
’d


14 
	gdeviû
.
	$wa™FÜLšks
()

16 
	$¦ave
()

17 
’d


20 -- 
Do
 
nÙhšg
.

21 
funùiÚ
 
	$¦ave
()

22 
’d


	@/home/asabzi/msc-project/MoonGen-1/test/flows/flow_errors.lua

1 
	gFlow
{"”rÜs", 
	gPack‘
.
	gUdp
{},

2 
	g‹¡
 = 1,

3 
	g¿‹
 = {},

4 
	g·»Á
 = 1,

5 
	gmode
 = 1,

8 
	gFlow
{"”rÜs", 
	gPack‘
.
	gUdp
{},

9 
	g¿‹
 = "mb/s",

10 
	g·»Á
 = "??",

11 
	gmode
 = "??",

14 
	gFlow
{"e1", 
	gPack‘
.
	gUdp
{},

15 
	g¿‹
 = "1a",

18 
	gFlow
{"e2", 
	gPack‘
.
	gUdp
{},

19 
	g¿‹
 = "1b/a",

22 
	gFlow
{"v®id", 
	gPack‘
.
	gUdp
{

23 
	gpktL’gth
 = 60

26 
	gFlow
{"f1", 
	gPack‘
.
	gUdp
{}}

	@/home/asabzi/msc-project/MoonGen-1/test/flows/not_lua.lua

1 
	gFlow
{)

	@/home/asabzi/msc-project/MoonGen-1/test/flows/simple_errors.lua

1 
	$Flow
()

2 
Flow
{{}
	}
}

3 
	gFlow
{""}

4 
Flow
("abc")

5 
	gFlow
{"‡b"}

6 
	gFlow
{";ab"}

7 
	gFlow
{":ab"}

8 
	gFlow
{",ab"}

10 
	$Pack‘
()

11 
Pack‘
{
	}
}

12 
	gPack‘
.
	$abc
()

13 
Pack‘
.
	`abc
("abc")

14 
Pack‘
.
abc
 = "abc"

15 
Pack‘
[{
	}
}]("abc")

16 
Pack‘
[{}]{}

18 
	$
(12)

19 

{
	}
}

20 

""

21 

"abc"

22 

"10.1..."

23 
	$mac
(12)

24 
mac
{
	}
}

25 
mac
""

26 
mac
"abc"

27 
mac
"10:::::"

	@/home/asabzi/msc-project/MoonGen-1/test/testlib.lua

1 -- 
	gTe¡lib
.
lua
 
	gLib¿ry


3 -- 
Provides
 
a
 
£t
 
of
 
ma¡”
 
funùiÚs
 
the
 
‹¡
 
	gäamewÜk
.

4 -- 
Requœes
 
a
 
v®id
 
	gcÚfig
.
lua
 
to
 
	gwÜk
.

5 -- 
Requœes
 
luaun™
 
to
 
d–iv”
 
cÜ»ù
 
‹¡
 
	g»suÉs
.

6 -- 
Some
 
¦aves
 
Ãed
 
to
  
a
 
boŞ—n
 
v®ue
 
cÜ»ù
 
‹¡
 
	g»suÉs
.

7 -- 
	gma¡”PaœX
-
funùiÚs
 
efãùiv–y
 
execu‹
 
—ch
 
¦ave
 
twiû
 
w™h
 
sw™ched
 
šput
 
	gdeviûs
.

9 -- 
AvaabË
 
	gfunùiÚs
:

10 -- - 
‹¡lib
.
£tRuÁime
()

11 -- -- 
S‘
 
the
 
ruÁime
 
®l
 
¦aves
 
ÿÎed


12 -- - 
‹¡lib
.
ma¡”SšgË
()

13 -- -- 
S¹s
 
Úe
 
¦ave
 
—ch
 
ÿrd


14 -- -- (
C®Ëd
 
funùiÚs
: 
¦ave
(
dev
,
ÿrd
))

15 -- - 
	g‹¡lib
.
ma¡”PaœSšgË
()

16 -- -- 
S¹s
 
Úe
 
¦ave
 
—ch
 
	g·œšg


17 -- -- (
C®Ëd
 
	gfunùiÚs
: 
¦ave
(
rxDev
, 
txDev
, 
rxC¬d
, 
txC¬d
))

18 -- - 
	g‹¡lib
.
ma¡”PaœMuÉi
()

19 -- -- 
S¹s
 
two
 
¦aves
 
—ch
 
·œšg
 
ªd
 
a
 
com·»
 
funùiÚ
 
to
 com·» 
theœ
 
»tuºed
 
	gv®ues


20 -- -- (
C®Ëd
 
	gfunùiÚs
: 
¦ave1
(
rxDev
, 
txDev
), 
¦ave2
ÔxDev,xDev), 
	$com·»
(
¦ave1»tuº
, 
¦ave2»tuº
))

22 
loÿl
 
‹¡lib
 = {
	}
}

24 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

25 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

26 
loÿl
 
tim”
 = 
»quœe
 "timer"

27 
loÿl
 
deviû
 = 
»quœe
 "device"

28 
loÿl
 
luaun™
 = 
»quœe
 "luaunit"

29 
loÿl
 
log
 = 
»quœe
 "testlog"

31 -- 
In™
 
ruÁime


32 
‹¡lib
.
wa™
 = 10

34 -- 
In™
 
‹¡
 
¬¿y


35 
Te¡s
 = {}

37 -- 
G‘
 
ruÁime
 
®l
 
¦aves


38 
funùiÚ
 
‹¡lib
:
	$g‘RuÁime
()

39  
‹¡lib
.
wa™


40 
’d


42 -- 
S‘
 
the
 
ruÁime
 
®l
 
¦aves
 |  10 
£cÚds


43 
funùiÚ
 
‹¡lib
:
	$£tRuÁime
Ğ
v®ue
 )

44 
‹¡lib
.
wa™
 = 
v®ue


45 
log
:
	`šfo
("RuÁim³¸‹¡ s‘Ø" .. 
‹¡lib
:
	`g‘RuÁime
() .. " seconds.")

46 
’d


48 -- 
S¹
 
Úe
 
¦ave
 
Ú
 
ev”y
 
avaabË
 
deviû


49 
funùiÚ
 
‹¡lib
:
	`ma¡”SšgË
()

50 -- 
In™
 
deviûs


51 
loÿl
 
ÿrds
 = 
tcÚfig
.
	$ÿrds
()

52 
loÿl
 
devs
 = {
	}
}

53 
i
=1 , #cards do

54 
	gdevs
[ 
i
 ] = 
deviû
.
cÚfig
{ 
pÜt
 = 
ÿrds
[ i ][ 1 ] , 
	grxQueues
 = 2 , 
	gtxQueues
 = 2 }

55 
’d


56 
	gdeviû
.
wa™FÜLšks
()

58 -- 
I‹¿‹s
 
ov”
 
®l
 
deviûs
 
	gto
:

59 -- - 
S¹
 
a
 
¦ave
 
w™h
 
the
 
deviû
 
as
 
šput


60 
i
 = 1 , #cards do

61 
	gTe¡s
[ "Te¡ed deviû: " .. 
ÿrds
[ 
i
 ][ 1 ] ] = 
	$funùiÚ
()

62 
log
:
	`šfo
Ğ"Te¡šg deviû: " .. 
ÿrds
[ 
i
 ][ 1 ] )

63 
loÿl
 
»suÉ
 = 
	$¦ave
Ğ
devs
[ 
i
 ] , 
ÿrds
[ i ] )

64 
dpdk
.
	$wa™FÜSÏves
()

65 
luaun™
.
	$as£¹True
Ğ
»suÉ
 )

66 
’d


67 
’d


69 -- 
Run
 
luaun™


70 
os
.
	`ex™
Ğ
luaun™
.
LuaUn™
.
	$run
() )

72 
’d


74 -- 
S¹
 
two
 
¦aves
 
ev”y
 
·œšg


75 
funùiÚ
 
‹¡lib
:
	`ma¡”PaœSšgË
()

77 -- 
In™
 
deviûs


78 
loÿl
 
ÿrds
 = 
tcÚfig
.
	$ÿrds
()

79 
loÿl
 
·œs
 = 
tcÚfig
.
	$·œs
()

80 
loÿl
 
devs
 = {
	}
}

81 
loÿl
 
devInf
 = {}

82 
i
 = 1 , #pairs do

83 
	gdevs
[ 
i
 ] = 
deviû
.
cÚfig
{ 
pÜt
 = 
ÿrds
[ 
·œs
[ i ][ 1 ] + 1 ][ 1 ] , 
	grxQueues
 = 2 , 
	gtxQueues
 = 2 }

84 
	gdevInf
[ 
i
 ] = 
ÿrds
[ 
·œs
[ i ][ 1 ] + 1 ]

85 
devs
[ 
i
 + 1 ] = 
deviû
.
cÚfig
{ 
pÜt
 = 
ÿrds
[ 
·œs
[ i ][ 2 ] + 1 ][ 1 ] , 
	grxQueue
 = 2 , 
	gtxQueue
 = 2 }

86 
	gdevInf
[ 
i
 + 1 ] = 
ÿrds
[ 
·œs
[ i ][ 2 ] + 1 ]

87 
’d


88 
deviû
.
wa™FÜLšks
()

90 -- 
I‹¿‹s
 
ov”
 
®l
 
deviû
 
·œšgs
 
to
:

91 -- - 
S¹
 
a
 
£t
 
of
 
¦aves
 
the
 
·œšg


92 
i
=1 , #devs , 2 do

93 
	gTe¡s
[ "Te¡ed deviû: " .. 
i
 ] = 
	$funùiÚ
()

94 
log
:
	`šfo
Ğ"Te¡šg deviû: " .. 
ÿrds
[ 
·œs
[ 
i
 ][ 1 ] + 1 ][ 1 ] .. " (" .. cards[…airs[ i ][ 2 ] + 1 ][ 1 ] .. ")" )

95 
loÿl
 
»suÉ
 = 
	`¦ave
Ğ
devs
[ 
i
 ] , devs[ i + 1 ] , 
devInf
[ i ] , devInf[ i + 1 ] )

96 
luaun™
.
	$as£¹True
Ğ
»suÉ
 )

97 
’d


98 -- 
MœrÜ
 
šput
 
deviûs


99 
Te¡s
[ "Te¡ed deviû: " .. 
i
 + 1 ] = 
	$funùiÚ
()

100 
log
:
	`šfo
Ğ"Te¡šg deviû: " .. 
ÿrds
[ 
·œs
[ 
i
 ][ 2 ] + 1 ][ 1 ] .. " (" .. cards[…airs [ i ][ 1 ] + 1 ][ 1 ] .. ")" )

101 
loÿl
 
»suÉ
 = 
	`¦ave
Ğ
devs
[ 
i
 + 1 ] , devs[ i ] , 
devInf
[ i + 1 ] , devInf[ i ] )

102 
luaun™
.
	$as£¹True
Ğ
»suÉ
 )

103 
’d


104 
’d


106 -- 
Run
 
luaun™


107 
os
.
	`ex™
Ğ
luaun™
.
LuaUn™
.
	$run
() )

109 
’d


111 -- 
S¹
 
two
 
·œs
 
of
 
¦aves
 
ev”y
 
avaabË
 
decive
 
·œšg


112 
funùiÚ
 
‹¡lib
:
	`ma¡”PaœMuÉi
()

113 -- 
In™
 
deviûs


114 
loÿl
 
ÿrds
 = 
tcÚfig
.
	$ÿrds
()

115 
loÿl
 
·œs
 = 
tcÚfig
.
	$·œs
()

116 
loÿl
 
devs
 = {
	}
}

117 
i
 = 1 , #pairs do

118 
nÙ
 
	gdevs
[ 
·œs
[ 
i
 ][ 1 ] ] 
th’


119 
	gdevs
[ 
·œs
[ 
i
 ][ 1 ] ] = 
deviû
.
cÚfig
{ 
pÜt
 =…aœs[ i ][ 1 ] , 
	grxQueues
 = 2 , 
	gtxQueues
 = 2 }

120 
’d


121 
nÙ
 
	gdevs
[ 
·œs
[ 
i
 ][ 2 ] ] 
th’


122 
	gdevs
[ 
·œs
[ 
i
 ][ 2 ] ] = 
deviû
.
cÚfig
{ 
pÜt
 =…aœs[ i ][ 2 ] , 
	grxQueue
 = 2 , 
	gtxQueue
 = 2 }

123 
’d


124 
’d


125 
	gdeviû
.
wa™FÜLšks
()

127 -- 
I‹¿‹s
 
ov”
 
®l
 
·œšgs
 
	gto
:

128 -- - 
S¹
 
two
 
£ts
 
of
 
¦aves
 
the
 
·œšg


129 -- - 
C®l
 
a
 
com·»
 
funùiÚ
 
to
 com·» 
theœ
 
ouut


130 
i
 = 1 , #pairs do

131 
loÿl
 
	gdev1
 = 
·œs
[ 
i
 ][ 1 ]

132 
loÿl
 
dev2
 = 
·œs
[ 
i
 ][ 2 ]

133 
Te¡s
[ "Te¡ed deviû: " .. 
i
 ] = 
	$funùiÚ
()

134 
log
:
	`šfo
Ğ"Te¡šg deviû: " .. 
·œs
[ 
i
 ][ 1 ] .. " (" ..…airs[ i ][ 2 ] .. ")")

135 
loÿl
 
¦ave1
 = 
dpdk
.
	`ÏunchLua
Ğ"¦ave1" , 
devs
[ 
dev1
 ] , devs[ 
dev2
 ] )

136 
loÿl
 
¦ave2
 = 
dpdk
.
	`ÏunchLua
Ğ"¦ave2" , 
devs
[ 
dev1
 ] , devs[ 
dev2
 ] , 
»suÉ1
 )

137 
loÿl
 
»tuº1
 = 
¦ave1
:
	$wa™
()

138 
loÿl
 
»tuº2
 = 
¦ave2
:
	$wa™
()

139 
loÿl
 
»tuºC
 = 
	$com·»
Ğ
»tuº1
 , 
»tuº2
 )

140 
luaun™
.
	$as£¹True
Ğ
»tuºC
 )

141 
’d


142 -- 
MœrÜ
 
šput
 
deviûs


143 
Te¡s
[ "Te¡ed deviû: " .. 
i
 .. "(2)" ] = 
	$funùiÚ
 ()

144 
log
:
	`šfo
Ğ"Te¡šg deviû: " .. 
·œs
[ 
i
 ][ 2 ].. " (" ..…airs[ i ][ 1 ] .. ")" )

145 
loÿl
 
¦ave1
 = 
dpdk
.
	`ÏunchLua
Ğ"¦ave1" , 
devs
[ 
dev2
 ] , devs[ 
dev1
 ] )

146 
loÿl
 
¦ave2
 = 
dpdk
.
	`ÏunchLua
Ğ"¦ave2" , 
devs
[ 
dev2
 ] , devs[ 
dev1
 ] )

147 
loÿl
 
»tuº1
 = 
¦ave1
:
	$wa™
()

148 
loÿl
 
»tuº2
 = 
¦ave2
:
	$wa™
()

149 
loÿl
 
»tuºC
 = 
	$com·»
Ğ
»tuº1
 , 
»tuº2
 )

150 
luaun™
.
	$as£¹True
Ğ
»tuºC
 )

151 
’d


152 
’d


154 -- 
Run
 
luaun™


155 
os
.
	`ex™
Ğ
luaun™
.
LuaUn™
.
	$run
() )

157 
’d


159 -- 
R‘uº
 
lib¿ry


160  
‹¡lib


	@/home/asabzi/msc-project/MoonGen-1/test/testlog.lua

1 -- 
	gTe¡log
.
lua
 
	glib¿ry


3 -- 
Ov”rides
 
Ãeded
 
funùiÚs
 
of
 
	glua
/
log
 
to
 
ex‹nd
 
theœ
 
funùiÚ®™y
 
	gto
:

4 -- - 
Add™iÚ®ly
 
wr™e
 
®l
 
ouut
 
to
 
a
 
‹mpÜ¬y
 
log
 
fe


6 
loÿl
 
‹¡log
 = {}

8 
loÿl
 
log
 = 
»quœe
 "log"

10 -- 
Ex‹nd
 
log
:
	$šfo
(
šput
,...)

11 
funùiÚ
 
‹¡log
:
	$šfo
(
šput
,...)

12 
šput
 = iÅut:
	$fÜm©
(...)

13 
loÿl
 
fe
 = 
io
.
	`İ’
("/tmp/testlog.txt", "a")

14 
log
:
	$šfo
(
šput
)

15 
fe
:
	`wr™e
("\\33[1;37m[INFO] " .. 
šput
 .. "\n")

16 
fe
:
	$şo£
()

17 
’d


19 -- 
Ex‹nd
 
log
:
	$w¬n
(
šput
,...)

20 
funùiÚ
 
‹¡log
:
	$w¬n
(
šput
,...)

21 
šput
 = iÅut:
	$fÜm©
(...)

22 
loÿl
 
fe
 = 
io
.
	`İ’
("/tmp/testlog.txt", "a")

23 
log
:
	$w¬n
(
šput
)

24 
fe
:
	`wr™e
("\\33[1;33m[WARN] " .. 
šput
 .. "\n")

25 
fe
:
	$şo£
()

26 
’d


28 -- 
R‘uº
 
lib¿ry


	@/home/asabzi/msc-project/MoonGen-1/test/tests/00-basics.lua

1 -- 
Basic
 
	gfunùiÚ®™y
: 
th»ads
 
ªd
 
mes§ge
-
·ssšg


2 
loÿl
 
lun™
 = 
»quœe
 "luaunit"

3 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

4 
loÿl
 
memÜy
 = 
»quœe
 "memory"

5 
loÿl
 
deviû
 = 
»quœe
 "device"

6 
loÿl
 
tim”
 = 
»quœe
 "timer"

8 
loÿl
 
log
 = 
»quœe
 "testlog"

9 
loÿl
 
‹¡lib
 = 
»quœe
 "testlib"

10 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

12 
loÿl
 
ffi
 = 
»quœe
 "ffi"

14 
ffi
.
cdef
[[

15 
	s‹¡¡ruù
 {

16 
v®ue1
;

17 
ušt64_t
 
v®ue2
;

18 } 
‹¡¡ruù_t
;

22 
funùiÚ
 
	$ma¡”
()

23 
log
:
	`šfo
( "Functionoest: Threads‡nd message-passing" )

24 
loÿl
 
foo
 = 
memÜy
.
	`®loc
("‹¡¡ruù_t*", 
ffi
.("teststruct_t"))

25 
foo
.
v®ue1
 = -0.25

26 
foo
.
v®ue2
 = 0xDEADBEEFDEADBEEFULL

27 
dpdk
.
	`ÏunchLua
("¦ave1", 1, "¡ršg"):
	$wa™
()

28 
dpdk
.
	`ÏunchLua
("¦ave2", {1, { 
foo
 = "b¬", 
ch“£
 = 5 }
	}
}):
	$wa™
()

29 
dpdk
.
	`ÏunchLua
("¦ave3", 
foo
):
	$wa™
()

30 
’d


32 
funùiÚ
 
	$¦ave1
(
num
, 
¡r
)

33 
lun™
.
	$as£¹Equ®s
(
num
, 1)

34 
lun™
.
	`as£¹Equ®s
(
¡r
, "string")

35 
’d


37 
funùiÚ
 
	$¦ave2
(
¬g
)

38 
lun™
.
	`as£¹Equ®s
(
¬g
, {1, {
foo
 = "b¬", 
ch“£
 = 5}
	}
})

39 
’d


41 
funùiÚ
 
	$¦ave3
(
¬g
)

42 
lun™
.
	`as£¹Equ®s
(
¬g
.
v®ue1
, -0.25)

43 
lun™
.
	$as£¹Equ®s
(
¬g
.
v®ue2
, 0xDEADBEEFDEADBEEFULL)

44 
’d


	@/home/asabzi/msc-project/MoonGen-1/test/tests/01-send.lua

1 -- 
FunùiÚ
 
to
 
	g‹¡
: 
S’d


2 -- 
Te¡
 
agaš¡
: 
N‘wÜk
 
ÿrd
 
¥“d
.

4 
loÿl
 
luaun™
 = 
»quœe
 "luaunit"

5 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

6 
loÿl
 
memÜy
 = 
»quœe
 "memory"

7 
loÿl
 
deviû
 = 
»quœe
 "device"

8 
loÿl
 
tim”
 = 
»quœe
 "timer"

10 
loÿl
 
log
 = 
»quœe
 "testlog"

11 
loÿl
 
‹¡lib
 = 
»quœe
 "testlib"

12 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

14 
loÿl
 
PKT_SIZE
 = 124

16 
funùiÚ
 
	$ma¡”
()

17 
log
:
	`šfo
( "Functionoest: Send" )

18 
‹¡lib
:
	$£tRuÁime
( 10 )

19 
‹¡lib
:
	$ma¡”SšgË
()

20 
’d


22 
funùiÚ
 
	`¦ave
Ğ
dev
 , 
ÿrd
 )

24 -- 
C®cuÏ‹
 
ex³ùed
 
¿‹
 | 
”©e
 
£t
 
to
 10 
MB™
/
s
 
b–ow
 
max
 
	`¿‹
 (max. 1% 
of
„ate)

25 
loÿl
 
eR©e
 = 
ÿrd
 [ 3 ]

26 
eR©e
 = 
m©h
.
	`æoÜ
ĞeR©- m©h.
	`mš
( 10 ,ƒRate * 99 / 100 ) )

27 
log
:
	`šfo
Ğ"Ex³ùed„©e: " .. 
eR©e
 .. " MBit/s" )

29 -- 
In™
 
queue


30 
loÿl
 
queue
 = 
dev
:
	`g‘TxQueue
( 0 )

32 -- 
In™
 
memÜy
 & 
bufs


33 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
Ğ
	$funùiÚ
Ğ
buf
 )

34 
buf
:
	$g‘Eth”ÃtPack‘
():
fl
{

35 
pktL’gth
 = 
PKT_SIZE
,

36 
‘hSrc
 = "10:11:12:13:14:15",

37 
‘hD¡
 = "10:11:12:13:14:15"

38 
	}
}

39 
	g’d
)

40 
loÿl
 
	gbufs
 = 
mem
:
bufA¼ay
( 64 )

42 -- 
In™
 
couÁ”
 & 
tim”


43 
loÿl
 
i
 = 0

44 
loÿl
 
ruÁime
 = 
tim”
:
Ãw
Ğ
‹¡lib
.
g‘RuÁime
() )

46 -- 
S’d
 
·ck‘s


47 
dpdk
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

48 
bufs
:
	$®loc
Ğ
PKT_SIZE
 )

49 
queue
:
	$£nd
Ğ
bufs
 )

50 
i
 = i + 64

51 
’d


53 -- 
C®cuÏ‹
 
m—su»d
 
¿‹
 | 
m¿‹
 
equ®s
 
·ck‘s
 * 
·ck‘
 
size
 / 
ruÁime


54 
loÿl
 
mR©e
 = 
m©h
.
	`æoÜ
ĞĞ
i
 * ( 
PKT_SIZE
 + 24 ) * 8 ) / ( 1000 * 1000 ) ) * 1 / 
‹¡lib
.
	`g‘RuÁime
()

56 -- 
Check
 
agaš¡
 
”©e


57 ifĞ
eR©e
 >ğ
mR©e
 ) 
th’


58 
log
:
	`w¬n
Ğ"M—su»d„©e: " .. 
mR©e
 .. " MB™/ | Missšg: " .. 
eR©e
 - mRate .. " MBit/s" )

60 
log
:
	`šfo
Ğ"M—su»d„©e: " .. 
mR©e
 .. " MBit/s" )

61 
’d


63 -- 
R‘uº
 
»suÉ


64  
eR©e
 < 
mR©e


65 
’d


	@/home/asabzi/msc-project/MoonGen-1/test/tests/02-receive.lua

1 -- 
FunùiÚ
 
to
 
	g‹¡
: 
Reûive


2 -- 
Te¡
 
agaš¡
: 
S’dšg
 
ÃtwÜk
 
ÿrd
 
¿‹
.

4 
loÿl
 
luaun™
 = 
»quœe
 "luaunit"

5 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

6 
loÿl
 
memÜy
 = 
»quœe
 "memory"

7 
loÿl
 
deviû
 = 
»quœe
 "device"

8 
loÿl
 
tim”
 = 
»quœe
 "timer"

9 
loÿl
 
¡©s
 = 
»quœe
 "stats"

11 
loÿl
 
log
 = 
»quœe
 "testlog"

12 
loÿl
 
‹¡lib
 = 
»quœe
 "testlib"

13 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

15 
loÿl
 
PKT_SIZE
 = 124

17 
funùiÚ
 
	$ma¡”
()

18 
log
:
	`šfo
( "Functionoest: Receive" )

19 
‹¡lib
:
	$£tRuÁime
( 10 )

20 
‹¡lib
:
	$ma¡”PaœMuÉi
()

21 
’d


23 
funùiÚ
 
	`¦ave1
Ğ
txDev
, 
rxDev
 )

24 -- 
In™
 
queue


25 
loÿl
 
txQueue
 = 
txDev
:
	`g‘TxQueue
( 0 )

27 -- 
In™
 
memÜy
 & 
bufs


28 
loÿl
 
mem
 = 
memÜy
.
	`ü—‹MemPoŞ
Ğ
	$funùiÚ
Ğ
buf
 )

29 
buf
:
	$g‘Eth”ÃtPack‘
():
fl
{

30 
pktL’gth
 = 
PKT_SIZE
,

31 
‘hSrc
 = 
txQueue
,

32 
‘hD¡
 = "10:11:12:13:14:15"

33 
	}
}

34 
	g’d
)

35 
loÿl
 
	gbufs
 = 
mem
:
bufA¼ay
()

37 -- 
In™
 
couÁ”
 & 
tim”


38 
loÿl
 
ùr
 = 
¡©s
:
ÃwDevTxCouÁ”
Ğ
txDev
 , "plain" )

39 
loÿl
 
	gruÁime
 = 
tim”
:
Ãw
Ğ
‹¡lib
.
g‘RuÁime
() )

41 -- 
S’d
 
·ck‘s


42 
dpdk
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

43 
bufs
:
	$®loc
Ğ
PKT_SIZE
 )

44 
txQueue
:
	$£nd
Ğ
bufs
 )

45 
ùr
:
	$upd©e
()

46 
’d


48 -- 
Fš®ize
 
couÁ”
 
ªd
 
g‘
 
¡©s


49 
ùr
:
	$fš®ize
()

50 
loÿl
 
x
 , 
mb™
 = 
ùr
:
	`g‘Sts
()

52 -- 
R‘uº
 
m—su»d
 
¿‹


53  
mb™
.
avg


54 
’d


56 
funùiÚ
 
	`¦ave2
Ğ
txDev
 , 
rxDev
 )

57 -- 
In™
 
queue


58 
loÿl
 
queue
 = 
rxDev
:
	`g‘RxQueue
( 0 )

60 -- 
In™
 
bufs


61 
loÿl
 
bufs
 = 
memÜy
.
	`bufA¼ay
()

63 -- 
In™
 
couÁ”
 & 
tim”


64 
loÿl
 
ùr
 = 
¡©s
:
	`ÃwMªu®RxCouÁ”
(
queue
.
dev
, "plain")

65 
loÿl
 
ruÁime
 = 
tim”
:
	`Ãw
(10)

67 -- 
Reûive
 
·ck‘s


68 
ruÁime
:
	$ruÂšg
(è
ªd
 
dpdk
.
	$ruÂšg
() do

69 
loÿl
 
rx
 = 
queue
:
	$ŒyRecv
(
bufs
, 10)

70 
bufs
:
	$ä“AÎ
()

71 
ùr
:
	$upd©eW™hSize
(
rx
, 
PKT_SIZE
)

72 
’d


74 -- 
Fš®ize
 
couÁ”
 
ªd
 
g‘
 
¡©s


75 
ùr
:
	$fš®ize
()

76 
loÿl
 
x
 , 
mb™
 = 
ùr
:
	`g‘Sts
()

78 -- 
R‘uº
 
m—su»d
 
¿‹


79  
mb™
.
avg


80 
’d


82 -- 
Com·»
 
m—su»d
 
¿‹s


83 
funùiÚ
 
	`com·»
Ğ
sR©e
 , 
rR©e
 )

84 -- 
Round
 
»ûive
 
¿‹
 
down


85 
»tuº2
 = 
m©h
.
	`æoÜ
Ğ
rR©e
 )

87 -- 
Round
 
max
 
¿‹
 
down
 | 
sub¡¿ù
 10 
MB™
/
	`s
 (max. 1% 
of
„ate).

88 
¤©e
 = 
m©h
.
	`æoÜ
Ğm©h.
	`mš
Ğ
sR©e
 - 10 , sRate * 99 / 100 ) )

90 -- 
Com·»
 
¿‹s


91 
log
:
	`šfo
Ğ"Ex³ùed„eûiv¿‹: " .. 
m©h
.
	`æoÜ
Ğ
sR©e
 ) .. " MBit/s" )

92 iàĞ
sR©e
 > 
rR©e
 ) 
th’


93 
log
:
	`w¬n
Ğ"M—su»d„eûiv¿‹: " .. 
rR©e
 .. " MB™/ | Missšg: " .. 
sR©e
 -„Rate .. " MBit/s")

95 
log
:
	`šfo
Ğ"M—su»d„eûiv¿‹: " .. 
m©h
.
	`æoÜ
Ğ
sR©e
 ) .. " MBit/s")

96 
’d


98 -- 
R‘uº
 
»suÉ


99  
sR©e
 <ğ
rR©e


100 
’d


	@/home/asabzi/msc-project/MoonGen-1/test/tests/03-timestamping.lua

1 -- 
FunùiÚ
 
to
 
	g‹¡
: 
Time¡ampšg


2 -- 
Te¡
 
agaš¡
: 
N‘wÜk
 
ÿrd
 
suµÜt
.

4 
loÿl
 
luaun™
 = 
»quœe
 "luaunit"

5 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

6 
loÿl
 
ts
 = 
»quœe
 "timestamping"

7 
loÿl
 
hi¡
 = 
»quœe
 "histogram"

8 
loÿl
 
deviû
 = 
»quœe
 "device"

9 
loÿl
 
tim”
 = 
»quœe
 "timer"

11 
loÿl
 
log
 = 
»quœe
 "testlog"

12 
loÿl
 
‹¡lib
 = 
»quœe
 "testlib"

13 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

15 
loÿl
 
PKT_SIZE
 = 124

17 
funùiÚ
 
	$ma¡”
()

18 
log
:
	`šfo
( "Functionoest: Timestamping" )

19 
‹¡lib
:
	$£tRuÁime
( 10 )

20 
‹¡lib
:
	$ma¡”PaœSšgË
()

21 
’d


23 
funùiÚ
 
	`¦ave
Ğ
rxDev
 , 
txDev
 )

24 -- 
In™
 
queues


25 
loÿl
 
rxQueue
 = 
rxDev
:
	$g‘RxQueue
(0)

26 
loÿl
 
txQueue
 = 
txDev
:
	`g‘TxQueue
(0)

28 -- 
In™
 
time¡am³r
 & 
hi¡og¿m


29 
loÿl
 
time¡am³r
 = 
ts
:
	$ÃwTime¡am³r
Ğ
txQueue
 , 
rxQueue
 )

30 
loÿl
 
hi¡
 = hi¡:
	`Ãw
()

32 -- 
In™
 
tim”


33 
loÿl
 
ruÁime
 = 
tim”
:
	`Ãw
Ğ
‹¡lib
.
	`g‘RuÁime
() )

35 -- 
Do
 
time¡ampšg


36 
ruÁime
:
	$ruÂšg
(è
ªd
 
dpdk
.
	$ruÂšg
() do

37 
hi¡
:
	`upd©e
Ğ
time¡am³r
:
	$m—su»L©’cy
() )

38 
’d


40 -- 
G‘
 
av”age
, 
mšimum
 & 
maximum
 
Ï‹ncy


41 
loÿl
 
av”age
 = 
hi¡
:
	$avg
()

42 
loÿl
 
mšimum
 = 
hi¡
:
	$mš
()

43 
loÿl
 
maximum
 = 
hi¡
:
	$max
()

46 
log
:
	`šfo
( "Expecting maximum deviation: 64‚s" )

47 
log
:
	`šfo
Ğ"RecÜded‡v”agdevŸtiÚ: " .. 
m©h
.
	`æoÜ
Ğ
av”age
 ) .. "‚s" )

49 
log
:
	`šfo
Ğ"Maximum m—su»d†©’cy: " .. 
m©h
.
	`æoÜ
Ğ
maximum
 ) .. "‚s")

50 
log
:
	`šfo
Ğ"Mšimum m—su»d†©’cy: " .. 
m©h
.
	`æoÜ
Ğ
mšimum
 ) .. "‚s" )

52 -- 
Check
 
devŸtiÚ


53 ifĞĞ
maximum
 - 
av”age
 > 64 ) ) 
th’


54 
log
:
	`w¬n
Ğ"Maximum†©’cy oà" .. 
maximum
 "‚ ex“ded 64‚ devŸtiÚ from‡v”ag" .. 
av”age
 .. "‚s" )

55 
’d


56 ifĞĞ
av”age
 - 
mšimum
 > 64 ) ) 
th’


57 
log
:
	`w¬n
Ğ"Mšimum†©’cy oà" .. 
mšimum
 "‚ ex“ded 64‚ devŸtiÚ from‡v”ag" .. 
av”age
 .. "‚s" )

58 
’d


60 -- 
R‘uº
 
»suÉ


61  ( 
maximum
 - 
av”age
 <ğ64 ) 
	`ªd
 (‡v”ag- 
mšimum
 <= 64 )

62 
’d


	@/home/asabzi/msc-project/MoonGen-1/test/tests/04-flowratecontrol.lua

1 -- 
FunùiÚ
 
to
 
	g‹¡
: 
Flow
 
¿‹
 
cÚŒŞ


2 -- 
Te¡
 
agaš¡
: 
N‘wÜk
 
ÿrd
 
suµÜt
.

4 
loÿl
 
dpdk
 = 
»quœe
 "dpdk"

5 
loÿl
 
memÜy
 = 
»quœe
 "memory"

6 
loÿl
 
ts
 = 
»quœe
 "timestamping"

7 
loÿl
 
deviû
 = 
»quœe
 "device"

8 
loÿl
 
f‹r
 = 
»quœe
 "filter"

9 
loÿl
 
tim”
 = 
»quœe
 "timer"

10 
loÿl
 
¡©s
 = 
»quœe
 "stats"

12 
loÿl
 
log
 = 
»quœe
 "testlog"

13 
loÿl
 
tcÚfig
 = 
»quœe
 "tconfig"

14 
loÿl
 
‹¡lib
 = 
»quœe
 "testlib"

16 
loÿl
 
FLOWS
 = 4

17 
loÿl
 
PKT_SIZE
 = 124

19 
funùiÚ
 
	$ma¡”
()

20 
log
:
	`šfo
( "Functionoest: Flow Rate Control" )

21 
‹¡lib
:
	$£tRuÁime
( 5 )

22 
‹¡lib
:
	$ma¡”PaœSšgË
()

23 
’d


25 
funùiÚ
 
	`¦ave
Ğ
rxDev
 , 
txDev
 , 
rxInfo
 , 
txInfo
 )

26 -- 
In™
 
queue


27 
loÿl
 
queue
 = 
txDev
:
	`g‘TxQueue
( 0 )

29 -- 
In™
 
memÜy
 & 
bufs


30 
loÿl
 
mempoŞ
 = 
memÜy
.
	`ü—‹MemPoŞ
Ğ
	$funùiÚ
Ğ
buf
 )

31 
buf
:
	$g‘Eth”ÃtPack‘
():
fl
{

32 
pktL’gth
 = 
PKT_SIZE
,

33 
‘hSrc
 = 
txQueue
,

34 
‘hD¡
 = "FF:FF:FF:FF:FF:FF:FF:FF"

35 
	}
}

36 
	g’d
)

37 
loÿl
 
	gbufs
 = 
mempoŞ
:
bufA¼ay
()

39 -- 
In™
 
couÁ”
 & 
tim”


40 
loÿl
 
txCŒ
 = 
¡©s
:
ÃwDevTxCouÁ”
Ğ
queue
 , "plain" )

41 
loÿl
 
	grxCŒ
 = 
¡©s
:
ÃwDevRxCouÁ”
Ğ
rxDev
 , "plain" )

42 
loÿl
 
	gruÁime
 = 
tim”
:
Ãw
Ğ
‹¡lib
.
g‘RuÁime
() )

44 -- 
In™
 & 
ÿlcuÏ‹
 
¿‹


45 
loÿl
 
·ss
 = 
Œue


46 
x
 = 1 , 3 do

47 
loÿl
 
	g¿‹
 = 
rxInfo
[ 3 ] * 
x
 / 4

48 
queue
:
	$£tR©e
Ğ
¿‹
 )

49 
log
:
	`šfo
Ğ"Ex³ùed„©e: " .. 
m©h
.
	`æoÜ
Ğ
¿‹
 ) .. " MBit/s" )

51 -- 
Do
 
æow
 
¿‹
 
cÚŒŞ


52 
dpdk
.
	$ruÂšg
(è
ªd
 
ruÁime
:
	$ruÂšg
() do

53 
bufs
:
	$®loc
Ğ
PKT_SIZE
 )

54 
queue
:
	$£nd
Ğ
bufs
 )

55 
txCŒ
:
	$upd©e
()

56 
rxCŒ
:
	$upd©e
()

57 
’d


59 -- 
Fš®ize
 
couÁ”
 & 
g‘
 
¡©s


60 
txCŒ
:
	$fš®ize
()

61 
rxCŒ
:
	$fš®ize
()

62 
loÿl
 
y
 , 
tmb™
 = 
txCŒ
:
	$g‘Sts
()

63 
loÿl
 
y
 , 
rmb™
 = 
rxCŒ
:
	`g‘Sts
()

65 -- 
Check
 
m—su»d
 
¿‹s


66 
loÿl
 
rPass
 = 
Œue


67 
	`nÙ
 ( 
tmb™
.
avg
 * 1.1 >ğ
¿‹
 ) 
th’


68 
log
:
	`w¬n
Ğ"Deviû s’t: " .. 
tmb™
.
avg
 .. " MB™/ | Missšg: " .. 
¿‹
 -mbit.avg .. " MBit/s" )

69 
rPass
 = 
çl£


71 
log
:
	`šfo
Ğ"Deviû s’t: " .. 
m©h
.
	`æoÜ
Ğ
tmb™
.
avg
 ) .. " MBit/s")

72 
’d


73 
	`nÙ
 ( 
rmb™
.
avg
 * 1.1 >ğ
¿‹
 ) 
th’


74 
log
:
	`w¬n
Ğ"Deviû„eûived: " .. 
rmb™
.
avg
 .. " MB™/ | Missšg: " .. 
¿‹
 -„mbit.avg .. " MBit/s" )

75 
rPass
 = 
çl£


77 
log
:
	`šfo
Ğ"Deviû„eûived: " .. 
m©h
.
	`æoÜ
Ğ
rmb™
.
avg
 ) .. " MBit/s")

78 
’d


79 
nÙ
 
rPass
 
th’


80 
log
:
	`w¬n
Ğ"R©" .. ( 
¿‹
 ) .. " MBit/s failed!" )

81 
’d


82 
·ss
 =…as 
ªd
 
rPass


84 
’d


86 -- 
R‘uº
 
»suÉ


87  
·ss


88 
’d


	@
1
.
1
/usr/include
417
29713
/home/asabzi/msc-project/MoonGen-1/examples/device-statistics.lua
/home/asabzi/msc-project/MoonGen-1/examples/dump.lua
/home/asabzi/msc-project/MoonGen-1/examples/icmp-arp-responder.lua
/home/asabzi/msc-project/MoonGen-1/examples/inter-arrival-times.lua
/home/asabzi/msc-project/MoonGen-1/examples/ipfix-generation.lua
/home/asabzi/msc-project/MoonGen-1/examples/l2-load-latency.lua
/home/asabzi/msc-project/MoonGen-1/examples/l2-poisson-load-latency.lua
/home/asabzi/msc-project/MoonGen-1/examples/l3-load-latency.lua
/home/asabzi/msc-project/MoonGen-1/examples/l3-tcp-syn-flood.lua
/home/asabzi/msc-project/MoonGen-1/examples/lacp.lua
/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/arrmatch.lua
/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/pkt-matcher.lua
/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/post-processing.lua
/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/sniffer.lua
/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/tbbmatch.lua
/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/test-dev.lua
/home/asabzi/msc-project/MoonGen-1/examples/moonsniff/traffic-gen.lua
/home/asabzi/msc-project/MoonGen-1/examples/netronome-packetgen/packetgen.lua
/home/asabzi/msc-project/MoonGen-1/examples/pcap/replay-pcap.lua
/home/asabzi/msc-project/MoonGen-1/examples/quality-of-service-test.lua
/home/asabzi/msc-project/MoonGen-1/examples/rate-control-methods.lua
/home/asabzi/msc-project/MoonGen-1/examples/rss.lua
/home/asabzi/msc-project/MoonGen-1/examples/rx-pkts-distribution.lua
/home/asabzi/msc-project/MoonGen-1/examples/timestamping-tests/drift.lua
/home/asabzi/msc-project/MoonGen-1/examples/timestamping-tests/timestamps-software.lua
/home/asabzi/msc-project/MoonGen-1/examples/vxlan-example.lua
/home/asabzi/msc-project/MoonGen-1/flows/examples.lua
/home/asabzi/msc-project/MoonGen-1/flows/udp-load.lua
/home/asabzi/msc-project/MoonGen-1/interface/cli/debug.lua
/home/asabzi/msc-project/MoonGen-1/interface/cli/help.lua
/home/asabzi/msc-project/MoonGen-1/interface/cli/init.lua
/home/asabzi/msc-project/MoonGen-1/interface/cli/list.lua
/home/asabzi/msc-project/MoonGen-1/interface/configenv/init.lua
/home/asabzi/msc-project/MoonGen-1/interface/configenv/range.lua
/home/asabzi/msc-project/MoonGen-1/interface/configenv/util.lua
/home/asabzi/msc-project/MoonGen-1/interface/counter.lua
/home/asabzi/msc-project/MoonGen-1/interface/dependencies/arp.lua
/home/asabzi/msc-project/MoonGen-1/interface/dependencies/init.lua
/home/asabzi/msc-project/MoonGen-1/interface/dependencies/queueMac.lua
/home/asabzi/msc-project/MoonGen-1/interface/devmgr.lua
/home/asabzi/msc-project/MoonGen-1/interface/errors.lua
/home/asabzi/msc-project/MoonGen-1/interface/flow/dynvars.lua
/home/asabzi/msc-project/MoonGen-1/interface/flow/init.lua
/home/asabzi/msc-project/MoonGen-1/interface/flow/instance.lua
/home/asabzi/msc-project/MoonGen-1/interface/flow/packet.lua
/home/asabzi/msc-project/MoonGen-1/interface/flowparse.lua
/home/asabzi/msc-project/MoonGen-1/interface/init.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/dataLimit.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/init.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/mode.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/rate.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/ratePattern.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/timeLimit.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/timestamp.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/uid.lua
/home/asabzi/msc-project/MoonGen-1/interface/options/uniquePayload.lua
/home/asabzi/msc-project/MoonGen-1/interface/threads/arp.lua
/home/asabzi/msc-project/MoonGen-1/interface/threads/count.lua
/home/asabzi/msc-project/MoonGen-1/interface/threads/deviceStats.lua
/home/asabzi/msc-project/MoonGen-1/interface/threads/load.lua
/home/asabzi/msc-project/MoonGen-1/interface/threads/timestamp.lua
/home/asabzi/msc-project/MoonGen-1/interface/units.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_arm.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_arm64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_mips.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_mips64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_ppc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_x64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dasm_x86.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/dynasm/dynasm.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/host/genlibbc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/host/genminilua.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/bc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/bcsave.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_arm.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_arm64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_arm64be.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mips.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mips64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mips64el.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_mipsel.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_ppc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_x64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dis_x86.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/dump.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/p.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/v.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/vmdef.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/src/jit/zone.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/bc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/bcsave.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_arm.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_arm64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_arm64be.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mips.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mips64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mips64el.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_mipsel.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_ppc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_x64.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dis_x86.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/dump.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/p.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/v.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/vmdef.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/deps/luajit/usr/local/share/luajit-2.1.0-beta3/jit/zone.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/dpdk-conf.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/c-integration/c-integration.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/dump-pkts.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/filter.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hardware-timestamping.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hello-world.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hyperscan/filter_hyperscan.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/hyperscan/test.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/inter-task-communication.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/l2-forward.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/pktgen.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/reflector.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/examples/webserver.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/barrier.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/bitmask.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/colors.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/device.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/distribute.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/dpdk.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/dpdkc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/ena.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/i40e.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/igb.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/ixgbe.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/ixgbevf.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/mlx5.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/virtio.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/driver/vmxnet3.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/drivers.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/etherc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/filter.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/filter_GenericFlowAPI.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/filter_ixgbe.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/graphite.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/headerc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/histogram.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/hs.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/ipsec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/kni.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/Serpent/init.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/StackTracePlus/init.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/argparse.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/luaunit.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/anf.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/backend.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/bpf.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/expand.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/libpcap.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/match.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/optimize.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/parse.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/pf.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/quickcheck.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/savefile.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/ssa.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/pf/utils.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/abi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bit.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bsd/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bsd/syscalls.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/bsd/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/compat.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/ffitypes.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/c.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/errors.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/fcntl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/syscalls.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/sysctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/util.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/freebsd/version.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/helpers.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/lfs.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/libc.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/arm64/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/c.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/cgroup.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/errors.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/fcntl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/mips/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/netfilter.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/nl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/ppc64le/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/sockopt.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/syscalls.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/util.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x64/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/linux/x86/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/methods.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/c.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/errors.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/fcntl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/ffifunctions.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/ffitypes.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/init.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/nr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/syscalls.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/sysctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/util.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/netbsd/version.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/c.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/errors.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/fcntl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/syscalls.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/sysctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/util.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/openbsd/version.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/c.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/constants.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/errors.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/fcntl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/ioctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/syscalls.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/sysctl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/osx/util.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/rump/c.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/rump/ffirump.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/rump/init.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/shared/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/syscall.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/syscalls.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/syscall/util.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/chatapp/chatapp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/chunked.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/cookie.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/curl.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/githubfeed.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/helloworld.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/helloworld6.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/httpserver.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/iosimple.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/json.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/keepalive.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/mustache.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/parameters.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/parrot.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/securecookie.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/signalfd.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/sslserver.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/static.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/tablehandler.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/thread.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/websocket.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/examples/websocketclient.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/async_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/hash_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/httputil_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/iosimple_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/iostream_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/mustache_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/structs_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/util_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/spec/web_spec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/3rdparty/JSON.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/3rdparty/middleclass.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/3rdparty/middleclass/middleclass.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/async.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/cdef.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/coctx.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/crypto.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/crypto_linux.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/crypto_luasec.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/epoll_ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/escape.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/fs.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/hash.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/http_response_codes.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/httpserver.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/httputil.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/inotify.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/ioloop.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/iosimple.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/iostream.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/log.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/mime_types.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/mustache.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/platform.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/signal.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/socket_ffi.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/sockutil.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/structs/buffer.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/structs/bufferptr.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/structs/deque.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/syscall.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/tcpserver.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/thread.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/util.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/web.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbo/websocket.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lib/turbo/turbovisor.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/libmoon.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lock.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/log.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/lpm.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/main.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/memory.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/namespaces.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/packet.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/pcap.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/pci-ids.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/phobos.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/pipe.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ah.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/arp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/dns.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/esp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ethernet.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/gre.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/icmp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ip4.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ip6.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ipfix.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/lacp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/newProtocolTemplate.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/packetChecks.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/proto.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/ptp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/sflow.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/tcp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/template.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/udp.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/proto/vxlan.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/stats.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/timer.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/timestamping.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/utils.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/webserver-task.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/lua/webserver.lua
/home/asabzi/msc-project/MoonGen-1/libmoon/test/task-memory-leaks.lua
/home/asabzi/msc-project/MoonGen-1/lua/crc-ratecontrol.lua
/home/asabzi/msc-project/MoonGen-1/lua/hmap.lua
/home/asabzi/msc-project/MoonGen-1/lua/moongen-compat.lua
/home/asabzi/msc-project/MoonGen-1/lua/moongen-main.lua
/home/asabzi/msc-project/MoonGen-1/lua/moongen.lua
/home/asabzi/msc-project/MoonGen-1/lua/moonsniff-io.lua
/home/asabzi/msc-project/MoonGen-1/lua/software-ratecontrol.lua
/home/asabzi/msc-project/MoonGen-1/lua/software-timestamps.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/backtoback.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/frameloss.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/latency.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/benchmarks/throughput.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/config.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/master.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ffi/ssh.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/manual.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/snmp.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ssh-freebsd.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ssh-mikrotik.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/ssh.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/testreport.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/tikz.lua
/home/asabzi/msc-project/MoonGen-1/rfc2544/utils/utils.lua
/home/asabzi/msc-project/MoonGen-1/test/config/devices.lua
/home/asabzi/msc-project/MoonGen-1/test/config/pairs.lua
/home/asabzi/msc-project/MoonGen-1/test/config/speed.lua
/home/asabzi/msc-project/MoonGen-1/test/flows/flow_errors.lua
/home/asabzi/msc-project/MoonGen-1/test/flows/not_lua.lua
/home/asabzi/msc-project/MoonGen-1/test/flows/simple_errors.lua
/home/asabzi/msc-project/MoonGen-1/test/testlib.lua
/home/asabzi/msc-project/MoonGen-1/test/testlog.lua
/home/asabzi/msc-project/MoonGen-1/test/tests/00-basics.lua
/home/asabzi/msc-project/MoonGen-1/test/tests/01-send.lua
/home/asabzi/msc-project/MoonGen-1/test/tests/02-receive.lua
/home/asabzi/msc-project/MoonGen-1/test/tests/03-timestamping.lua
/home/asabzi/msc-project/MoonGen-1/test/tests/04-flowratecontrol.lua
